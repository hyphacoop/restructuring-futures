function Ya(i,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in i)){const s=Object.getOwnPropertyDescriptor(n,r);s&&Object.defineProperty(i,r,s.get?s:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function T(){}const Xa=i=>i;function Ye(i,e){for(const t in e)i[t]=e[t];return i}function Ja(i){return!!i&&(typeof i=="object"||typeof i=="function")&&typeof i.then=="function"}function Ou(i){return i()}function ki(){return Object.create(null)}function _e(i){i.forEach(Ou)}function En(i){return typeof i=="function"}function te(i,e){return i!=i?e==e:i!==e||i&&typeof i=="object"||typeof i=="function"}let Jn;function Xe(i,e){return Jn||(Jn=document.createElement("a")),Jn.href=e,i===Jn.href}function eo(i){return Object.keys(i).length===0}function $u(i,...e){if(i==null)return T;const t=i.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Ee(i,e,t){i.$$.on_destroy.push($u(e,t))}function fe(i,e,t,n){if(i){const r=Mu(i,e,t,n);return i[0](r)}}function Mu(i,e,t,n){return i[1]&&n?Ye(t.ctx.slice(),i[1](n(e))):t.ctx}function he(i,e,t,n){if(i[2]&&n){const r=i[2](n(t));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],u=Math.max(e.dirty.length,r.length);for(let a=0;a<u;a+=1)s[a]=e.dirty[a]|r[a];return s}return e.dirty|r}return e.dirty}function de(i,e,t,n,r,s){if(r){const u=Mu(e,t,n,s);i.p(u,r)}}function pe(i){if(i.ctx.length>32){const e=[],t=i.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function qr(i){const e={};for(const t in i)t[0]!=="$"&&(e[t]=i[t]);return e}function Fi(i,e){const t={};e=new Set(e);for(const n in i)!e.has(n)&&n[0]!=="$"&&(t[n]=i[n]);return t}function to(i){return i&&En(i.destroy)?i.destroy:T}const Nu=typeof window<"u";let no=Nu?()=>window.performance.now():()=>Date.now(),ii=Nu?i=>requestAnimationFrame(i):T;const mn=new Set;function ju(i){mn.forEach(e=>{e.c(i)||(mn.delete(e),e.f())}),mn.size!==0&&ii(ju)}function ro(i){let e;return mn.size===0&&ii(ju),{promise:new Promise(t=>{mn.add(e={c:i,f:t})}),abort(){mn.delete(e)}}}function w(i,e){i.appendChild(e)}function Lu(i){if(!i)return document;const e=i.getRootNode?i.getRootNode():i.ownerDocument;return e&&e.host?e:i.ownerDocument}function io(i){const e=b("style");return so(Lu(i),e),e.sheet}function so(i,e){return w(i.head||i,e),e.sheet}function A(i,e,t){i.insertBefore(e,t||null)}function _(i){i.parentNode&&i.parentNode.removeChild(i)}function Yt(i,e){for(let t=0;t<i.length;t+=1)i[t]&&i[t].d(e)}function b(i){return document.createElement(i)}function uo(i){return document.createElementNS("http://www.w3.org/2000/svg",i)}function K(i){return document.createTextNode(i)}function P(){return K(" ")}function J(){return K("")}function G(i,e,t,n){return i.addEventListener(e,t,n),()=>i.removeEventListener(e,t,n)}function Wr(i){return function(e){e.target===this&&i.call(this,e)}}function k(i,e,t){t==null?i.removeAttribute(e):i.getAttribute(e)!==t&&i.setAttribute(e,t)}function ao(i){return Array.from(i.childNodes)}function ge(i,e){e=""+e,i.wholeText!==e&&(i.data=e)}function Tt(i,e){i.value=e??""}function qe(i,e,t,n){t===null?i.style.removeProperty(e):i.style.setProperty(e,t,n?"important":"")}function at(i,e,t){i.classList[t?"add":"remove"](e)}function Uu(i,e,{bubbles:t=!1,cancelable:n=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(i,t,n,e),r}class zu{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,n=null){this.e||(this.is_svg?this.e=uo(t.nodeName):this.e=b(t.nodeName),this.t=t,this.c(e)),this.i(n)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)A(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(_)}}function De(i,e){return new i(e)}const cr=new Map;let fr=0;function oo(i){let e=5381,t=i.length;for(;t--;)e=(e<<5)-e^i.charCodeAt(t);return e>>>0}function lo(i,e){const t={stylesheet:io(e),rules:{}};return cr.set(i,t),t}function vi(i,e,t,n,r,s,u,a=0){const o=16.666/n;let l=`{
`;for(let g=0;g<=1;g+=o){const m=e+(t-e)*s(g);l+=g*100+`%{${u(m,1-m)}}
`}const c=l+`100% {${u(t,1-t)}}
}`,f=`__svelte_${oo(c)}_${a}`,h=Lu(i),{stylesheet:d,rules:p}=cr.get(h)||lo(h,i);p[f]||(p[f]=!0,d.insertRule(`@keyframes ${f} ${c}`,d.cssRules.length));const D=i.style.animation||"";return i.style.animation=`${D?`${D}, `:""}${f} ${n}ms linear ${r}ms 1 both`,fr+=1,f}function co(i,e){const t=(i.style.animation||"").split(", "),n=t.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),r=t.length-n.length;r&&(i.style.animation=n.join(", "),fr-=r,fr||fo())}function fo(){ii(()=>{fr||(cr.forEach(i=>{const{ownerNode:e}=i.stylesheet;e&&_(e)}),cr.clear())})}let qn;function _t(i){qn=i}function Gn(){if(!qn)throw new Error("Function called outside component initialization");return qn}function Rt(i){Gn().$$.on_mount.push(i)}function Xt(){const i=Gn();return(e,t,{cancelable:n=!1}={})=>{const r=i.$$.callbacks[e];if(r){const s=Uu(e,t,{cancelable:n});return r.slice().forEach(u=>{u.call(i,s)}),!s.defaultPrevented}return!0}}function ho(i,e){return Gn().$$.context.set(i,e),e}function po(i){return Gn().$$.context.get(i)}function gn(i,e){const t=i.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const fn=[],hr=[],ar=[],Bi=[],Do=Promise.resolve();let Qr=!1;function mo(){Qr||(Qr=!0,Do.then(si))}function Kt(i){ar.push(i)}const Br=new Set;let an=0;function si(){if(an!==0)return;const i=qn;do{try{for(;an<fn.length;){const e=fn[an];an++,_t(e),go(e.$$)}}catch(e){throw fn.length=0,an=0,e}for(_t(null),fn.length=0,an=0;hr.length;)hr.pop()();for(let e=0;e<ar.length;e+=1){const t=ar[e];Br.has(t)||(Br.add(t),t())}ar.length=0}while(fn.length);for(;Bi.length;)Bi.pop()();Qr=!1,Br.clear(),_t(i)}function go(i){if(i.fragment!==null){i.update(),_e(i.before_update);const e=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,e),i.after_update.forEach(Kt)}}let Pn;function bo(){return Pn||(Pn=Promise.resolve(),Pn.then(()=>{Pn=null})),Pn}function Sr(i,e,t){i.dispatchEvent(Uu(`${e?"intro":"outro"}${t}`))}const or=new Set;let yt;function H(){yt={r:0,c:[],p:yt}}function q(){yt.r||_e(yt.c),yt=yt.p}function y(i,e){i&&i.i&&(or.delete(i),i.i(e))}function C(i,e,t,n){if(i&&i.o){if(or.has(i))return;or.add(i),yt.c.push(()=>{or.delete(i),n&&(t&&i.d(1),n())}),i.o(e)}else n&&n()}const wo={duration:0};function bn(i,e,t,n){const r={direction:"both"};let s=e(i,t,r),u=n?0:1,a=null,o=null,l=null;function c(){l&&co(i,l)}function f(d,p){const D=d.b-u;return p*=Math.abs(D),{a:u,b:d.b,d:D,duration:p,start:d.start,end:d.start+p,group:d.group}}function h(d){const{delay:p=0,duration:D=300,easing:g=Xa,tick:m=T,css:E}=s||wo,B={start:no()+p,b:d};d||(B.group=yt,yt.r+=1),a||o?o=B:(E&&(c(),l=vi(i,u,d,D,p,g,E)),d&&m(0,1),a=f(B,D),Kt(()=>Sr(i,d,"start")),ro(F=>{if(o&&F>o.start&&(a=f(o,D),o=null,Sr(i,a.b,"start"),E&&(c(),l=vi(i,u,a.b,a.duration,0,g,s.css))),a){if(F>=a.end)m(u=a.b,1-u),Sr(i,a.b,"end"),o||(a.b?c():--a.group.r||_e(a.group.c)),a=null;else if(F>=a.start){const v=F-a.start;u=a.a+a.d*g(v/a.duration),m(u,1-u)}}return!!(a||o)}))}return{run(d){En(s)?bo().then(()=>{s=s(r),h(d)}):h(d)},end(){c(),a=o=null}}}function wn(i,e){const t=e.token={};function n(r,s,u,a){if(e.token!==t)return;e.resolved=a;let o=e.ctx;u!==void 0&&(o=o.slice(),o[u]=a);const l=r&&(e.current=r)(o);let c=!1;e.block&&(e.blocks?e.blocks.forEach((f,h)=>{h!==s&&f&&(H(),C(f,1,1,()=>{e.blocks[h]===f&&(e.blocks[h]=null)}),q())}):e.block.d(1),l.c(),y(l,1),l.m(e.mount(),e.anchor),c=!0),e.block=l,e.blocks&&(e.blocks[s]=l),c&&si()}if(Ja(i)){const r=Gn();if(i.then(s=>{_t(r),n(e.then,1,e.value,s),_t(null)},s=>{if(_t(r),n(e.catch,2,e.error,s),_t(null),!e.hasCatch)throw s}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,i),!0;e.resolved=i}}function ui(i,e,t){const n=e.slice(),{resolved:r}=i;i.current===i.then&&(n[i.value]=r),i.current===i.catch&&(n[i.error]=r),i.block.p(n,t)}function ai(i,e){i.d(1),e.delete(i.key)}function Jt(i,e){C(i,1,1,()=>{e.delete(i.key)})}function lt(i,e,t,n,r,s,u,a,o,l,c,f){let h=i.length,d=s.length,p=h;const D={};for(;p--;)D[i[p].key]=p;const g=[],m=new Map,E=new Map;for(p=d;p--;){const x=f(r,s,p),S=t(x);let R=u.get(S);R?n&&R.p(x,e):(R=l(S,x),R.c()),m.set(S,g[p]=R),S in D&&E.set(S,Math.abs(p-D[S]))}const B=new Set,F=new Set;function v(x){y(x,1),x.m(a,c),u.set(x.key,x),c=x.first,d--}for(;h&&d;){const x=g[d-1],S=i[h-1],R=x.key,Q=S.key;x===S?(c=x.first,h--,d--):m.has(Q)?!u.has(R)||B.has(R)?v(x):F.has(Q)?h--:E.get(R)>E.get(Q)?(F.add(R),v(x)):(B.add(Q),h--):(o(S,u),h--)}for(;h--;){const x=i[h];m.has(x.key)||o(x,u)}for(;d;)v(g[d-1]);return g}function en(i,e){const t={},n={},r={$$scope:1};let s=i.length;for(;s--;){const u=i[s],a=e[s];if(a){for(const o in u)o in a||(n[o]=1);for(const o in a)r[o]||(t[o]=a[o],r[o]=1);i[s]=a}else for(const o in u)r[o]=1}for(const u in n)u in t||(t[u]=void 0);return t}function tn(i){return typeof i=="object"&&i!==null?i:{}}function W(i){i&&i.c()}function U(i,e,t,n){const{fragment:r,after_update:s}=i.$$;r&&r.m(e,t),n||Kt(()=>{const u=i.$$.on_mount.map(Ou).filter(En);i.$$.on_destroy?i.$$.on_destroy.push(...u):_e(u),i.$$.on_mount=[]}),s.forEach(Kt)}function z(i,e){const t=i.$$;t.fragment!==null&&(_e(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function _o(i,e){i.$$.dirty[0]===-1&&(fn.push(i),mo(),i.$$.dirty.fill(0)),i.$$.dirty[e/31|0]|=1<<e%31}function ne(i,e,t,n,r,s,u,a=[-1]){const o=qn;_t(i);const l=i.$$={fragment:null,ctx:[],props:s,update:T,not_equal:r,bound:ki(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(o?o.$$.context:[])),callbacks:ki(),dirty:a,skip_bound:!1,root:e.target||o.$$.root};u&&u(l.root);let c=!1;if(l.ctx=t?t(i,e.props||{},(f,h,...d)=>{const p=d.length?d[0]:h;return l.ctx&&r(l.ctx[f],l.ctx[f]=p)&&(!l.skip_bound&&l.bound[f]&&l.bound[f](p),c&&_o(i,f)),h}):[],l.update(),c=!0,_e(l.before_update),l.fragment=n?n(l.ctx):!1,e.target){if(e.hydrate){const f=ao(e.target);l.fragment&&l.fragment.l(f),f.forEach(_)}else l.fragment&&l.fragment.c();e.intro&&y(i.$$.fragment),U(i,e.target,e.anchor,e.customElement),si()}_t(o)}class re{$destroy(){z(this,1),this.$destroy=T}$on(e,t){if(!En(t))return T;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}$set(e){this.$$set&&!eo(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}class Le extends Error{constructor(e){super(e||""),this.name="EarthstarError"}}class $ extends Le{constructor(e){super(e||"Validation error"),this.name="ValidationError"}}class me extends Le{constructor(e){super(e||"a Replica or ReplicaDriver was used after being closed"),this.name="ReplicaIsClosedError"}}class $t extends Le{constructor(e){super(e||"a ReplicaCache was used after being closed"),this.name="ReplicaCacheIsClosedError"}}class Un extends Le{constructor(e){super(e||"Not supported"),this.name="NotSupportedError"}}function M(i){return i instanceof Le}function Hu(i){return!(i instanceof Le)}var Wn={};Object.defineProperty(Wn,"__esModule",{value:!0});var br=Wn.setInterval=Vt=Wn.setTimeout=void 0;const yo=globalThis.setTimeout;function Ao(i,e,...t){const n=yo(i,e,...t);return typeof n=="number"?n:n[Symbol.toPrimitive]()}var Vt=Wn.setTimeout=Ao;const Co=globalThis.setInterval;function Eo(i,e,...t){const n=Co(i,e,...t);return typeof n=="number"?n:n[Symbol.toPrimitive]()}br=Wn.setInterval=Eo;var oi={},Tr,Si;Object.defineProperty(oi,"__esModule",{value:!0});var qu=oi.WeakRef=void 0;qu=oi.WeakRef=(Tr=globalThis.WeakRef)!==null&&Tr!==void 0?Tr:(Si=class{constructor(e){}deref(){throw new Error("WeakRef is not supported in Node 14 and below.")}},Si);const{Blob:Wu}=window,{Request:ko,Response:Fo,Headers:vo,fetch:Qp}=window,{ReadableStream:Gt,ReadableStreamDefaultReader:Kp,ReadableStreamBYOBReader:Vp,ReadableStreamBYOBRequest:Gp,ReadableByteStreamController:Zp,ReadableStreamDefaultController:Yp,TransformStream:kn,TransformStreamDefaultController:Bo,WritableStream:Ge,WritableStreamDefaultWriter:So,WritableStreamDefaultController:Xp,ByteLengthQueuingStrategy:Jp,CountQueuingStrategy:eD,TextEncoderStream:tD,TextDecoderStream:nD}=window;if(!Gt.prototype[Symbol.asyncIterator]){async function*i(){const e=this.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)return;yield n}}finally{e.releaseLock()}}Gt.prototype[Symbol.asyncIterator]=i}var hn=null;typeof WebSocket<"u"?hn=WebSocket:typeof MozWebSocket<"u"?hn=MozWebSocket:typeof global<"u"?hn=global.WebSocket||global.MozWebSocket:typeof window<"u"?hn=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(hn=self.WebSocket||self.MozWebSocket);const _n=hn,{TextDecoder:Qu,TextEncoder:li}=window;function Ti(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Ku(i,e,t){return e&&Ti(i.prototype,e),t&&Ti(i,t),i}function Pi(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=i[t];return n}function dr(i,e){var t=typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t)return(t=t.call(i)).next.bind(t);if(Array.isArray(i)||(t=function(r,s){if(r){if(typeof r=="string")return Pi(r,s);var u=Object.prototype.toString.call(r).slice(8,-1);return u==="Object"&&r.constructor&&(u=r.constructor.name),u==="Map"||u==="Set"?Array.from(r):u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?Pi(r,s):void 0}}(i))||e&&i&&typeof i.length=="number"){t&&(i=t);var n=0;return function(){return n>=i.length?{done:!0}:{done:!1,value:i[n++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var To=/(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDEC0-\uDEEB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/,Po=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/;function Io(i,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(i)}function Vu(i,e){e===void 0&&(e=!1);for(var t=[],n=0;n<i.length;){var r=i[n],s=function(d){if(!e)throw new TypeError(d);t.push({type:"INVALID_CHAR",index:n,value:i[n++]})};if(r!=="*")if(r!=="+"&&r!=="?")if(r!=="\\")if(r!=="{")if(r!=="}")if(r!==":")if(r!=="(")t.push({type:"CHAR",index:n,value:i[n++]});else{var u=1,a="",o=n+1,l=!1;if(i[o]==="?"){s('Pattern cannot start with "?" at '+o);continue}for(;o<i.length;){if(!Io(i[o],!1)){s("Invalid character '"+i[o]+"' at "+o+"."),l=!0;break}if(i[o]!=="\\"){if(i[o]===")"){if(--u==0){o++;break}}else if(i[o]==="("&&(u++,i[o+1]!=="?")){s("Capturing groups are not allowed at "+o),l=!0;break}a+=i[o++]}else a+=i[o++]+i[o++]}if(l)continue;if(u){s("Unbalanced pattern at "+n);continue}if(!a){s("Missing pattern at "+n);continue}t.push({type:"PATTERN",index:n,value:a}),n=o}else{for(var c="",f=n+1;f<i.length;){var h=i.substr(f,1);if(!(f===n+1&&To.test(h)||f!==n+1&&Po.test(h)))break;c+=i[f++]}if(!c){s("Missing parameter name at "+n);continue}t.push({type:"NAME",index:n,value:c}),n=f}else t.push({type:"CLOSE",index:n,value:i[n++]});else t.push({type:"OPEN",index:n,value:i[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:i[n++]});else t.push({type:"MODIFIER",index:n,value:i[n++]});else t.push({type:"ASTERISK",index:n,value:i[n++]})}return t.push({type:"END",index:n,value:""}),t}function Gu(i,e){e===void 0&&(e={});for(var t=Vu(i),n=e.prefixes,r=n===void 0?"./":n,s="[^"+dn(e.delimiter||"/#?")+"]+?",u=[],a=0,o=0,l="",c=new Set,f=function(j){if(o<t.length&&t[o].type===j)return t[o++].value},h=function(){return f("MODIFIER")||f("ASTERISK")},d=function(j){var O=f(j);if(O!==void 0)return O;var ie=t[o];throw new TypeError("Unexpected "+ie.type+" at "+ie.index+", expected "+j)},p=function(){for(var j,O="";j=f("CHAR")||f("ESCAPED_CHAR");)O+=j;return O},D=e.encodePart||function(j){return j};o<t.length;){var g=f("CHAR"),m=f("NAME"),E=f("PATTERN");if(m||E||!f("ASTERISK")||(E=".*"),m||E){var B=g||"";r.indexOf(B)===-1&&(l+=B,B=""),l&&(u.push(D(l)),l="");var F=m||a++;if(c.has(F))throw new TypeError("Duplicate name '"+F+"'.");c.add(F),u.push({name:F,prefix:D(B),suffix:"",pattern:E||s,modifier:h()||""})}else{var v=g||f("ESCAPED_CHAR");if(v)l+=v;else if(f("OPEN")){var x=p(),S=f("NAME")||"",R=f("PATTERN")||"";S||R||!f("ASTERISK")||(R=".*");var Q=p();d("CLOSE");var N=h()||"";if(!S&&!R&&!N){l+=x;continue}if(!S&&!R&&!x)continue;l&&(u.push(D(l)),l=""),u.push({name:S||(R?a++:""),pattern:S&&!R?s:R,prefix:D(x),suffix:D(Q),modifier:N})}else l&&(u.push(D(l)),l=""),d("END")}}return u}function dn(i){return i.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function Zu(i){return i&&i.sensitive?"u":"ui"}function Yu(i,e,t){t===void 0&&(t={});for(var n,r=t.strict,s=r!==void 0&&r,u=t.start,a=u===void 0||u,o=t.end,l=o===void 0||o,c=t.encode,f=c===void 0?function(v){return v}:c,h="["+dn(t.endsWith||"")+"]|$",d="["+dn(t.delimiter||"/#?")+"]",p=a?"^":"",D=dr(i);!(n=D()).done;){var g=n.value;if(typeof g=="string")p+=dn(f(g));else{var m=dn(f(g.prefix)),E=dn(f(g.suffix));g.pattern?(e&&e.push(g),p+=m||E?g.modifier==="+"||g.modifier==="*"?"(?:"+m+"((?:"+g.pattern+")(?:"+E+m+"(?:"+g.pattern+"))*)"+E+")"+(g.modifier==="*"?"?":""):"(?:"+m+"("+g.pattern+")"+E+")"+g.modifier:g.modifier==="+"||g.modifier==="*"?"((?:"+g.pattern+")"+g.modifier+")":"("+g.pattern+")"+g.modifier):p+="(?:"+m+E+")"+g.modifier}}if(l)s||(p+=d+"?"),p+=t.endsWith?"(?="+h+")":"$";else{var B=i[i.length-1],F=typeof B=="string"?d.indexOf(B[B.length-1])>-1:B===void 0;s||(p+="(?:"+d+"(?="+h+"))?"),F||(p+="(?="+d+"|"+h+")")}return new RegExp(p,Zu(t))}function Xu(i,e,t){return i instanceof RegExp?function(n,r){if(!r)return n;for(var s=/\((?:\?<(.*?)>)?(?!\?)/g,u=0,a=s.exec(n.source);a;)r.push({name:a[1]||u++,prefix:"",suffix:"",modifier:"",pattern:""}),a=s.exec(n.source);return n}(i,e):Array.isArray(i)?function(n,r,s){var u=n.map(function(a){return Xu(a,r,s).source});return new RegExp("(?:"+u.join("|")+")",Zu(s))}(i,e,t):function(n,r,s){return Yu(Gu(n,s),r,s)}(i,e,t)}var Bt={delimiter:"",prefixes:"",sensitive:!0,strict:!0},Ro={delimiter:".",prefixes:"",sensitive:!0,strict:!0},xo={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function Ii(i,e){return i.startsWith(e)?i.substring(e.length,i.length):i}function Ju(i){return!(!i||i.length<2||i[0]!=="["&&(i[0]!=="\\"&&i[0]!=="{"||i[1]!=="["))}var Z,ea=["ftp","file","http","https","ws","wss"];function ta(i){if(!i)return!0;for(var e,t=dr(ea);!(e=t()).done;)if(i.test(e.value))return!0;return!1}function na(i){switch(i){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function ci(i){if(i==="")return i;if(/^[-+.A-Za-z0-9]*$/.test(i))return i.toLowerCase();throw new TypeError("Invalid protocol '"+i+"'.")}function Oo(i){if(i==="")return i;var e=new URL("https://example.com");return e.username=i,e.username}function $o(i){if(i==="")return i;var e=new URL("https://example.com");return e.password=i,e.password}function ra(i){if(i==="")return i;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(i))throw new TypeError("Invalid hostname '"+i+"'");var e=new URL("https://example.com");return e.hostname=i,e.hostname}function ia(i){if(i==="")return i;if(/[^0-9a-fA-F[\]:]/g.test(i))throw new TypeError("Invalid IPv6 hostname '"+i+"'");return i.toLowerCase()}function sa(i){if(i===""||/^[0-9]*$/.test(i)&&parseInt(i)<=65535)return i;throw new TypeError("Invalid port '"+i+"'.")}function Mo(i){if(i==="")return i;var e=new URL("https://example.com");return e.pathname=i[0]!=="/"?"/-"+i:i,i[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function No(i){return i===""?i:new URL("data:"+i).pathname}function jo(i){if(i==="")return i;var e=new URL("https://example.com");return e.search=i,e.search.substring(1,e.search.length)}function Lo(i){if(i==="")return i;var e=new URL("https://example.com");return e.hash=i,e.hash.substring(1,e.hash.length)}(function(i){i[i.INIT=0]="INIT",i[i.PROTOCOL=1]="PROTOCOL",i[i.AUTHORITY=2]="AUTHORITY",i[i.USERNAME=3]="USERNAME",i[i.PASSWORD=4]="PASSWORD",i[i.HOSTNAME=5]="HOSTNAME",i[i.PORT=6]="PORT",i[i.PATHNAME=7]="PATHNAME",i[i.SEARCH=8]="SEARCH",i[i.HASH=9]="HASH",i[i.DONE=10]="DONE"})(Z||(Z={}));var Uo=function(){function i(t){this.input=void 0,this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=Z.INIT,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=t}var e=i.prototype;return e.parse=function(){for(this.tokenList=Vu(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===Z.INIT){this.rewind(),this.isHashPrefix()?this.changeState(Z.HASH,1):this.isSearchPrefix()?(this.changeState(Z.SEARCH,1),this.internalResult.hash=""):(this.changeState(Z.PATHNAME,0),this.internalResult.search="",this.internalResult.hash="");continue}if(this.state===Z.AUTHORITY){this.rewindAndSetState(Z.HOSTNAME);continue}this.changeState(Z.DONE,0);break}if(this.groupDepth>0){if(!this.isGroupClose())continue;this.groupDepth-=1}if(this.isGroupOpen())this.groupDepth+=1;else switch(this.state){case Z.INIT:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(Z.PROTOCOL));break;case Z.PROTOCOL:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();var t=Z.PATHNAME,n=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(t=Z.AUTHORITY,n=3):this.shouldTreatAsStandardURL&&(t=Z.AUTHORITY),this.changeState(t,n)}break;case Z.AUTHORITY:this.isIdentityTerminator()?this.rewindAndSetState(Z.USERNAME):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(Z.HOSTNAME);break;case Z.USERNAME:this.isPasswordPrefix()?this.changeState(Z.PASSWORD,1):this.isIdentityTerminator()&&this.changeState(Z.HOSTNAME,1);break;case Z.PASSWORD:this.isIdentityTerminator()&&this.changeState(Z.HOSTNAME,1);break;case Z.HOSTNAME:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(Z.PORT,1):this.isPathnameStart()?this.changeState(Z.PATHNAME,0):this.isSearchPrefix()?this.changeState(Z.SEARCH,1):this.isHashPrefix()&&this.changeState(Z.HASH,1);break;case Z.PORT:this.isPathnameStart()?this.changeState(Z.PATHNAME,0):this.isSearchPrefix()?this.changeState(Z.SEARCH,1):this.isHashPrefix()&&this.changeState(Z.HASH,1);break;case Z.PATHNAME:this.isSearchPrefix()?this.changeState(Z.SEARCH,1):this.isHashPrefix()&&this.changeState(Z.HASH,1);break;case Z.SEARCH:this.isHashPrefix()&&this.changeState(Z.HASH,1)}}},e.changeState=function(t,n){switch(this.state){case Z.INIT:break;case Z.PROTOCOL:this.internalResult.protocol=this.makeComponentString();break;case Z.AUTHORITY:break;case Z.USERNAME:this.internalResult.username=this.makeComponentString();break;case Z.PASSWORD:this.internalResult.password=this.makeComponentString();break;case Z.HOSTNAME:this.internalResult.hostname=this.makeComponentString();break;case Z.PORT:this.internalResult.port=this.makeComponentString();break;case Z.PATHNAME:this.internalResult.pathname=this.makeComponentString();break;case Z.SEARCH:this.internalResult.search=this.makeComponentString();break;case Z.HASH:this.internalResult.hash=this.makeComponentString()}this.changeStateWithoutSettingComponent(t,n)},e.changeStateWithoutSettingComponent=function(t,n){this.state=t,this.componentStart=this.tokenIndex+n,this.tokenIndex+=n,this.tokenIncrement=0},e.rewind=function(){this.tokenIndex=this.componentStart,this.tokenIncrement=0},e.rewindAndSetState=function(t){this.rewind(),this.state=t},e.safeToken=function(t){return t<0&&(t=this.tokenList.length-t),t<this.tokenList.length?this.tokenList[t]:this.tokenList[this.tokenList.length-1]},e.isNonSpecialPatternChar=function(t,n){var r=this.safeToken(t);return r.value===n&&(r.type==="CHAR"||r.type==="ESCAPED_CHAR"||r.type==="INVALID_CHAR")},e.isProtocolSuffix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.nextIsAuthoritySlashes=function(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")},e.isIdentityTerminator=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")},e.isPasswordPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.isPortPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.isPathnameStart=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")},e.isSearchPrefix=function(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;var t=this.safeToken(this.tokenIndex-1);return t.type!=="NAME"&&t.type!=="PATTERN"&&t.type!=="CLOSE"&&t.type!=="ASTERISK"},e.isHashPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")},e.isGroupOpen=function(){return this.tokenList[this.tokenIndex].type=="OPEN"},e.isGroupClose=function(){return this.tokenList[this.tokenIndex].type=="CLOSE"},e.isIPv6Open=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")},e.isIPv6Close=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")},e.makeComponentString=function(){var t=this.tokenList[this.tokenIndex],n=this.safeToken(this.componentStart).index;return this.input.substring(n,t.index)},e.computeShouldTreatAsStandardURL=function(){var t={};Object.assign(t,Bt),t.encodePart=ci;var n=Xu(this.makeComponentString(),void 0,t);this.shouldTreatAsStandardURL=ta(n)},Ku(i,[{key:"result",get:function(){return this.internalResult}}]),i}(),zo=["protocol","username","password","hostname","port","pathname","search","hash"];function Ri(i,e){if(typeof i!="string")throw new TypeError("parameter 1 is not of type 'string'.");var t=new URL(i,e);return{protocol:t.protocol.substring(0,t.protocol.length-1),username:t.username,password:t.password,hostname:t.hostname,port:t.port,pathname:t.pathname,search:t.search!=""?t.search.substring(1,t.search.length):void 0,hash:t.hash!=""?t.hash.substring(1,t.hash.length):void 0}}function Pr(i,e,t){var n;if(typeof e.baseURL=="string")try{n=new URL(e.baseURL),i.protocol=n.protocol?n.protocol.substring(0,n.protocol.length-1):"",i.username=n.username,i.password=n.password,i.hostname=n.hostname,i.port=n.port,i.pathname=n.pathname,i.search=n.search?n.search.substring(1,n.search.length):"",i.hash=n.hash?n.hash.substring(1,n.hash.length):""}catch{throw new TypeError("invalid baseURL '"+e.baseURL+"'.")}if(typeof e.protocol=="string"&&(i.protocol=function(s,u){var a;return s=(a=s).endsWith(":")?a.substr(0,a.length-1):a,u||s===""?s:ci(s)}(e.protocol,t)),typeof e.username=="string"&&(i.username=function(s,u){if(u||s==="")return s;var a=new URL("https://example.com");return a.username=s,a.username}(e.username,t)),typeof e.password=="string"&&(i.password=function(s,u){if(u||s==="")return s;var a=new URL("https://example.com");return a.password=s,a.password}(e.password,t)),typeof e.hostname=="string"&&(i.hostname=function(s,u){return u||s===""?s:Ju(s)?ia(s):ra(s)}(e.hostname,t)),typeof e.port=="string"&&(i.port=function(s,u,a){return na(u)===s&&(s=""),a||s===""?s:sa(s)}(e.port,i.protocol,t)),typeof e.pathname=="string"){if(i.pathname=e.pathname,n&&!function(s,u){return!(!s.length||s[0]!=="/"&&(!u||s.length<2||s[0]!="\\"&&s[0]!="{"||s[1]!="/"))}(i.pathname,t)){var r=n.pathname.lastIndexOf("/");r>=0&&(i.pathname=n.pathname.substring(0,r+1)+i.pathname)}i.pathname=function(s,u,a){if(a||s==="")return s;if(u&&!ea.includes(u))return new URL(u+":"+s).pathname;var o=s[0]=="/";return s=new URL(o?s:"/-"+s,"https://example.com").pathname,o||(s=s.substring(2,s.length)),s}(i.pathname,i.protocol,t)}return typeof e.search=="string"&&(i.search=function(s,u){if(s=Ii(s,"?"),u||s==="")return s;var a=new URL("https://example.com");return a.search=s,a.search?a.search.substring(1,a.search.length):""}(e.search,t)),typeof e.hash=="string"&&(i.hash=function(s,u){if(s=Ii(s,"#"),u||s==="")return s;var a=new URL("https://example.com");return a.hash=s,a.hash?a.hash.substring(1,a.hash.length):""}(e.hash,t)),i}function In(i){return i.replace(/([+*?:{}()\\])/g,"\\$1")}function Ho(i,e){for(var t="[^"+(e.delimiter||"/#?").replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")+"]+?",n=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/,r="",s=0;s<i.length;++s){var u=i[s],a=s>0?i[s-1]:null,o=s<i.length-1?i[s+1]:null;if(typeof u!="string")if(u.pattern!==""){var l=typeof u.name!="number",c=e.prefixes!==void 0?e.prefixes:"./",f=u.suffix!==""||u.prefix!==""&&(u.prefix.length!==1||!c.includes(u.prefix));f||!l||u.pattern!==t||u.modifier!==""||!o||o.prefix||o.suffix||(f=typeof o=="string"?n.test(o.length>0?o[0]:""):typeof o.name=="number"),!f&&u.prefix===""&&a&&typeof a=="string"&&a.length>0&&(f=c.includes(a[a.length-1])),f&&(r+="{"),r+=In(u.prefix),l&&(r+=":"+u.name),u.pattern===".*"?r+=l||a&&typeof a!="string"&&!a.modifier&&!f&&u.prefix===""?"(.*)":"*":u.pattern===t?l||(r+="("+t+")"):r+="("+u.pattern+")",u.pattern===t&&l&&u.suffix!==""&&n.test(u.suffix[0])&&(r+="\\"),r+=In(u.suffix),f&&(r+="}"),r+=u.modifier}else{if(u.modifier===""){r+=In(u.prefix);continue}r+="{"+In(u.prefix)+"}"+u.modifier}else r+=In(u)}return r}var qo=function(){function i(t,n){t===void 0&&(t={}),this.pattern=void 0,this.regexp={},this.keys={},this.component_pattern={};try{if(typeof t=="string"){var r=new Uo(t);if(r.parse(),t=r.result,n){if(typeof n!="string")throw new TypeError("'baseURL' parameter is not of type 'string'.");t.baseURL=n}else if(typeof t.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if(n)throw new TypeError("parameter 1 is not of type 'string'.");if(!t||typeof t!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");var s;this.pattern=Pr({pathname:"*",protocol:"*",username:"*",password:"*",hostname:"*",port:"*",search:"*",hash:"*"},t,!0),na(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");for(var u,a=dr(zo);!(u=a()).done;)if((s=u.value)in this.pattern){var o={},l=this.pattern[s];switch(this.keys[s]=[],s){case"protocol":Object.assign(o,Bt),o.encodePart=ci;break;case"username":Object.assign(o,Bt),o.encodePart=Oo;break;case"password":Object.assign(o,Bt),o.encodePart=$o;break;case"hostname":Object.assign(o,Ro),o.encodePart=Ju(l)?ia:ra;break;case"port":Object.assign(o,Bt),o.encodePart=sa;break;case"pathname":ta(this.regexp.protocol)?(Object.assign(o,xo),o.encodePart=Mo):(Object.assign(o,Bt),o.encodePart=No);break;case"search":Object.assign(o,Bt),o.encodePart=jo;break;case"hash":Object.assign(o,Bt),o.encodePart=Lo}try{var c=Gu(l,o);this.regexp[s]=Yu(c,this.keys[s],o),this.component_pattern[s]=Ho(c,o)}catch{throw new TypeError("invalid "+s+" pattern '"+this.pattern[s]+"'.")}}}catch(f){throw new TypeError("Failed to construct 'URLPattern': "+f.message)}}var e=i.prototype;return e.test=function(t,n){t===void 0&&(t={});var r,s={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&n)throw new TypeError("parameter 1 is not of type 'string'.");if(t===void 0)return!1;try{s=Pr(s,typeof t=="object"?t:Ri(t,n),!1)}catch{return!1}for(r in this.pattern)if(!this.regexp[r].exec(s[r]))return!1;return!0},e.exec=function(t,n){t===void 0&&(t={});var r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&n)throw new TypeError("parameter 1 is not of type 'string'.");if(t!==void 0){try{r=Pr(r,typeof t=="object"?t:Ri(t,n),!1)}catch{return null}var s,u={};for(s in u.inputs=n?[t,n]:[t],this.pattern){var a=this.regexp[s].exec(r[s]);if(!a)return null;for(var o,l={},c=dr(this.keys[s].entries());!(o=c()).done;){var f=o.value,h=f[1];typeof h.name!="string"&&typeof h.name!="number"||(l[h.name]=a[f[0]+1]||"")}u[s]={input:r[s]||"",groups:l}}return u}},Ku(i,[{key:"protocol",get:function(){return this.component_pattern.protocol}},{key:"username",get:function(){return this.component_pattern.username}},{key:"password",get:function(){return this.component_pattern.password}},{key:"hostname",get:function(){return this.component_pattern.hostname}},{key:"port",get:function(){return this.component_pattern.port}},{key:"pathname",get:function(){return this.component_pattern.pathname}},{key:"search",get:function(){return this.component_pattern.search}},{key:"hash",get:function(){return this.component_pattern.hash}}]),i}();const Wo={setInterval:br,setTimeout:Vt,WeakRef:qu,Blob:Wu,Request:ko,Response:Fo,Headers:vo,WritableStream:Ge,TransformStream:kn,ReadableStream:Gt,TransformStreamDefaultController:Bo,WritableStreamDefaultWriter:So,WebSocket:_n,TextEncoder:li,TextDecoder:Qu,URLPattern:qo},ua=Qo(globalThis,Wo);function Qo(i,e){return new Proxy(i,{get(t,n,r){return n in e?e[n]:i[n]},set(t,n,r){return n in e&&delete e[n],i[n]=r,!0},deleteProperty(t,n){let r=!1;return n in e&&(delete e[n],r=!0),n in i&&(delete i[n],r=!0),r},ownKeys(t){const n=Reflect.ownKeys(i),r=Reflect.ownKeys(e),s=new Set(r);return[...n.filter(u=>!s.has(u)),...r]},defineProperty(t,n,r){return n in e&&delete e[n],Reflect.defineProperty(i,n,r),!0},getOwnPropertyDescriptor(t,n){return n in e?Reflect.getOwnPropertyDescriptor(e,n):Reflect.getOwnPropertyDescriptor(i,n)},has(t,n){return n in e||n in i}})}function aa(i,e){if(i===e)return!0;if(!i||!e)return!1;var t=i.length;if(e.length!==t)return!1;for(var n=0;n<t;n++)if(i[n]!==e[n])return!1;return!0}function pr(i,e){if(i===e)return!0;if(!i||!e)return!1;var t=Object.keys(i),n=Object.keys(e),r=t.length;if(n.length!==r)return!1;for(var s=0;s<r;s++){var u=t[s];if(i[u]!==e[u]||!Object.prototype.hasOwnProperty.call(e,u))return!1}return!0}var Ko=function(i,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var t=typeof e.cycles=="boolean"?e.cycles:!1,n=e.cmp&&function(s){return function(u){return function(a,o){var l={key:a,value:u[a]},c={key:o,value:u[o]};return s(l,c)}}}(e.cmp),r=[];return function s(u){if(u&&u.toJSON&&typeof u.toJSON=="function"&&(u=u.toJSON()),u!==void 0){if(typeof u=="number")return isFinite(u)?""+u:"null";if(typeof u!="object")return JSON.stringify(u);var a,o;if(Array.isArray(u)){for(o="[",a=0;a<u.length;a++)a&&(o+=","),o+=s(u[a])||"null";return o+"]"}if(u===null)return"null";if(r.indexOf(u)!==-1){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=r.push(u)-1,c=Object.keys(u).sort(n&&n(u));for(o="",a=0;a<c.length;a++){var f=c[a],h=s(u[f]);h&&(o&&(o+=","),o+=JSON.stringify(f)+":"+h)}return r.splice(l,1),"{"+o+"}"}}(i)},We={};Object.defineProperty(We,"__esModule",{value:!0});function Fn(i,e,t){var n;if(t===void 0&&(t={}),!e.codes){e.codes={};for(var r=0;r<e.chars.length;++r)e.codes[e.chars[r]]=r}if(!t.loose&&i.length*e.bits&7)throw new SyntaxError("Invalid padding");for(var s=i.length;i[s-1]==="=";)if(--s,!t.loose&&!((i.length-s)*e.bits&7))throw new SyntaxError("Invalid padding");for(var u=new((n=t.out)!=null?n:Uint8Array)(s*e.bits/8|0),a=0,o=0,l=0,c=0;c<s;++c){var f=e.codes[i[c]];if(f===void 0)throw new SyntaxError("Invalid character "+i[c]);o=o<<e.bits|f,a+=e.bits,a>=8&&(a-=8,u[l++]=255&o>>a)}if(a>=e.bits||255&o<<8-a)throw new SyntaxError("Unexpected end of data");return u}function vn(i,e,t){t===void 0&&(t={});for(var n=t,r=n.pad,s=r===void 0?!0:r,u=(1<<e.bits)-1,a="",o=0,l=0,c=0;c<i.length;++c)for(l=l<<8|255&i[c],o+=8;o>e.bits;)o-=e.bits,a+=e.chars[u&l>>o];if(o&&(a+=e.chars[u&l<<e.bits-o]),s)for(;a.length*e.bits&7;)a+="=";return a}var xi={chars:"0123456789ABCDEF",bits:4},Oi={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},$i={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},Mi={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},Ni={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},Vo={parse:function(e,t){return Fn(e.toUpperCase(),xi,t)},stringify:function(e,t){return vn(e,xi,t)}},Go={parse:function(e,t){return t===void 0&&(t={}),Fn(t.loose?e.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):e,Oi,t)},stringify:function(e,t){return vn(e,Oi,t)}},Zo={parse:function(e,t){return Fn(e,$i,t)},stringify:function(e,t){return vn(e,$i,t)}},Yo={parse:function(e,t){return Fn(e,Mi,t)},stringify:function(e,t){return vn(e,Mi,t)}},Xo={parse:function(e,t){return Fn(e,Ni,t)},stringify:function(e,t){return vn(e,Ni,t)}},Jo={parse:Fn,stringify:vn};We.base16=Vo;We.base32=Go;We.base32hex=Zo;We.base64=Yo;We.base64url=Xo;We.codec=Jo;const el=We.base16,tl=We.base32,nl=We.base32hex,rl=We.base64,il=We.base64url,sl=We.codec,ul=Object.freeze(Object.defineProperty({__proto__:null,base16:el,base32:tl,base32hex:nl,base64:rl,base64url:il,codec:sl,default:We},Symbol.toStringTag,{value:"Module"}));var Zt={};Object.defineProperty(Zt,"__esModule",{value:!0});var oa=Zt.Hash=la=Zt.createHash=void 0;const al=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],ji={sha256:1};function ol(i){if(i&&!ji[i]&&!ji[i.toLowerCase()])throw new Error("Digest method not supported");return new ca}var la=Zt.createHash=ol;class ca{constructor(){this.A=1779033703,this.B=-1150833019,this.C=1013904242,this.D=-1521486534,this.E=1359893119,this.F=-1694144372,this.G=528734635,this.H=1541459225,this._size=0,this._sp=0,(!er||Rn>=8e3)&&(er=new ArrayBuffer(8e3),Rn=0),this._byte=new Uint8Array(er,Rn,80),this._word=new Int32Array(er,Rn,20),Rn+=80}update(e){if(typeof e=="string")return this._utf8(e);if(e==null)throw new TypeError("Invalid type: "+typeof e);const t=e.byteOffset,n=e.byteLength;let r=n/64|0,s=0;if(r&&!(t&3)&&!(this._size%64)){const a=new Int32Array(e.buffer,t,r*16);for(;r--;)this._int32(a,s>>2),s+=64;this._size+=s}if(e.BYTES_PER_ELEMENT!==1&&e.buffer){const a=new Uint8Array(e.buffer,t+s,n-s);return this._uint8(a)}return s===n?this:this._uint8(e,s)}_uint8(e,t){const{_byte:n,_word:r}=this,s=e.length;for(t=t|0;t<s;){const u=this._size%64;let a=u;for(;t<s&&a<64;)n[a++]=e[t++];a>=64&&this._int32(r),this._size+=a-u}return this}_utf8(e){const{_byte:t,_word:n}=this,r=e.length;let s=this._sp;for(let u=0;u<r;){const a=this._size%64;let o=a;for(;u<r&&o<64;){let l=e.charCodeAt(u++)|0;l<128?t[o++]=l:l<2048?(t[o++]=192|l>>>6,t[o++]=128|l&63):l<55296||l>57343?(t[o++]=224|l>>>12,t[o++]=128|l>>>6&63,t[o++]=128|l&63):s?(l=((s&1023)<<10)+(l&1023)+65536,t[o++]=240|l>>>18,t[o++]=128|l>>>12&63,t[o++]=128|l>>>6&63,t[o++]=128|l&63,s=0):s=l}o>=64&&(this._int32(n),n[0]=n[16]),this._size+=o-a}return this._sp=s,this}_int32(e,t){let{A:n,B:r,C:s,D:u,E:a,F:o,G:l,H:c}=this,f=0;for(t=t|0;f<16;)Mt[f++]=et(e[t++]);for(f=16;f<64;f++)Mt[f]=ml(Mt[f-2])+Mt[f-7]+Dl(Mt[f-15])+Mt[f-16]|0;for(f=0;f<64;f++){const h=c+pl(a)+fl(a,o,l)+al[f]+Mt[f]|0,d=dl(n)+hl(n,r,s)|0;c=l,l=o,o=a,a=u+h|0,u=s,s=r,r=n,n=h+d|0}this.A=n+this.A|0,this.B=r+this.B|0,this.C=s+this.C|0,this.D=u+this.D|0,this.E=a+this.E|0,this.F=o+this.F|0,this.G=l+this.G|0,this.H=c+this.H|0}digest(e){const{_byte:t,_word:n}=this;let r=this._size%64|0;for(t[r++]=128;r&3;)t[r++]=0;if(r>>=2,r>14){for(;r<16;)n[r++]=0;r=0,this._int32(n)}for(;r<16;)n[r++]=0;const s=this._size*8,u=(s&4294967295)>>>0,a=(s-u)/4294967296;return a&&(n[14]=et(a)),u&&(n[15]=et(u)),this._int32(n),e==="hex"?this._hex():this._bin()}_hex(){const{A:e,B:t,C:n,D:r,E:s,F:u,G:a,H:o}=this;return Ft(e)+Ft(t)+Ft(n)+Ft(r)+Ft(s)+Ft(u)+Ft(a)+Ft(o)}_bin(){const{A:e,B:t,C:n,D:r,E:s,F:u,G:a,H:o,_byte:l,_word:c}=this;return c[0]=et(e),c[1]=et(t),c[2]=et(n),c[3]=et(r),c[4]=et(s),c[5]=et(u),c[6]=et(a),c[7]=et(o),l.slice(0,32)}}oa=Zt.Hash=ca;const Mt=new Int32Array(64);let er,Rn=0;const Ft=i=>(i+4294967296).toString(16).substr(-8),ll=i=>i<<24&4278190080|i<<8&16711680|i>>8&65280|i>>24&255,cl=i=>i,et=gl()?cl:ll,fl=(i,e,t)=>t^i&(e^t),hl=(i,e,t)=>i&e|t&(i|e),dl=i=>(i>>>2|i<<30)^(i>>>13|i<<19)^(i>>>22|i<<10),pl=i=>(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),Dl=i=>(i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,ml=i=>(i>>>17|i<<15)^(i>>>19|i<<13)^i>>>10;function gl(){return new Uint8Array(new Uint16Array([65279]).buffer)[0]===254}const bl=Ya({__proto__:null,get Hash(){return oa},get createHash(){return la},default:Zt},[Zt]),wl={};/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const Be=BigInt(0),ue=BigInt(1),je=BigInt(2),fa=BigInt(255),Li=je**BigInt(252)+BigInt("27742317777372353535851937790883648493"),ce={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:je**fa-BigInt(19),l:Li,n:Li,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},ha=je**BigInt(256),zn=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");const _l=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),yl=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Al=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Cl=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class ae{constructor(e,t,n,r){this.x=e,this.y=t,this.z=n,this.t=r}static fromAffine(e){if(!(e instanceof Ae))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(Ae.ZERO)?ae.ZERO:new ae(e.x,e.y,ue,I(e.x*e.y))}static toAffineBatch(e){const t=Fl(e.map(n=>n.z));return e.map((n,r)=>n.toAffine(t[r]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){Ui(e);const{x:t,y:n,z:r}=this,{x:s,y:u,z:a}=e,o=I(t*a),l=I(s*r),c=I(n*a),f=I(u*r);return o===l&&c===f}negate(){return new ae(I(-this.x),this.y,this.z,I(-this.t))}double(){const{x:e,y:t,z:n}=this,{a:r}=ce,s=I(e**je),u=I(t**je),a=I(je*I(n**je)),o=I(r*s),l=I(I((e+t)**je)-s-u),c=o+u,f=c-a,h=o-u,d=I(l*f),p=I(c*h),D=I(l*h),g=I(f*c);return new ae(d,p,g,D)}add(e){Ui(e);const{x:t,y:n,z:r,t:s}=this,{x:u,y:a,z:o,t:l}=e,c=I((n-t)*(a+u)),f=I((n+t)*(a-u)),h=I(f-c);if(h===Be)return this.double();const d=I(r*je*l),p=I(s*je*o),D=p+d,g=f+c,m=p-d,E=I(D*h),B=I(g*m),F=I(D*m),v=I(h*g);return new ae(E,B,v,F)}subtract(e){return this.add(e.negate())}precomputeWindow(e){const t=1+256/e,n=[];let r=this,s=r;for(let u=0;u<t;u++){s=r,n.push(s);for(let a=1;a<2**(e-1);a++)s=s.add(r),n.push(s);r=s.double()}return n}wNAF(e,t){!t&&this.equals(ae.BASE)&&(t=Ae.BASE);const n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let r=t&&Kr.get(t);r||(r=this.precomputeWindow(n),t&&n!==1&&(r=ae.normalizeZ(r),Kr.set(t,r)));let s=ae.ZERO,u=ae.ZERO;const a=1+256/n,o=2**(n-1),l=BigInt(2**n-1),c=2**n,f=BigInt(n);for(let h=0;h<a;h++){const d=h*o;let p=Number(e&l);if(e>>=f,p>o&&(p-=c,e+=ue),p===0){let D=r[d];h%2&&(D=D.negate()),u=u.add(D)}else{let D=r[d+Math.abs(p)-1];p<0&&(D=D.negate()),s=s.add(D)}}return ae.normalizeZ([s,u])[0]}multiply(e,t){return this.wNAF(Dr(e,ce.l),t)}multiplyUnsafe(e){let t=Dr(e,ce.l,!1);const n=ae.BASE,r=ae.ZERO;if(t===Be)return r;if(this.equals(r)||t===ue)return this;if(this.equals(n))return this.wNAF(t);let s=r,u=this;for(;t>Be;)t&ue&&(s=s.add(u)),u=u.double(),t>>=ue;return s}isSmallOrder(){return this.multiplyUnsafe(ce.h).equals(ae.ZERO)}isTorsionFree(){return this.multiplyUnsafe(ce.l).equals(ae.ZERO)}toAffine(e=wr(this.z)){const{x:t,y:n,z:r}=this,s=I(t*e),u=I(n*e);if(I(r*e)!==ue)throw new Error("invZ was invalid");return new Ae(s,u)}fromRistrettoBytes(){Rr()}toRistrettoBytes(){Rr()}fromRistrettoHash(){Rr()}}ae.BASE=new ae(ce.Gx,ce.Gy,ue,I(ce.Gx*ce.Gy));ae.ZERO=new ae(Be,ue,ue,Be);function Ui(i){if(!(i instanceof ae))throw new TypeError("ExtendedPoint expected")}function Ir(i){if(!(i instanceof Ze))throw new TypeError("RistrettoPoint expected")}function Rr(){throw new Error("Legacy method: switch to RistrettoPoint")}class Ze{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){const{d:t}=ce,n=I(zn*e*e),r=I((n+ue)*Al);let s=BigInt(-1);const u=I((s-t*n)*I(n+t));let{isValid:a,value:o}=fi(r,u),l=I(o*e);St(l)||(l=I(-l)),a||(o=l),a||(s=n);const c=I(s*(n-ue)*Cl-u),f=o*o,h=I((o+o)*u),d=I(c*_l),p=I(ue-f),D=I(ue+f);return new ae(I(h*D),I(p*d),I(d*D),I(h*p))}static hashToCurve(e){e=Pt(e,64);const t=xr(e.slice(0,32)),n=this.calcElligatorRistrettoMap(t),r=xr(e.slice(32,64)),s=this.calcElligatorRistrettoMap(r);return new Ze(n.add(s))}static fromHex(e){e=Pt(e,32);const{a:t,d:n}=ce,r="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",s=xr(e);if(!Bl(Kn(s),e)||St(s))throw new Error(r);const u=I(s*s),a=I(ue+t*u),o=I(ue-t*u),l=I(a*a),c=I(o*o),f=I(t*n*l-c),{isValid:h,value:d}=zi(I(f*c)),p=I(d*o),D=I(d*p*f);let g=I((s+s)*p);St(g)&&(g=I(-g));const m=I(a*D),E=I(g*m);if(!h||St(E)||m===Be)throw new Error(r);return new Ze(new ae(g,m,ue,E))}toRawBytes(){let{x:e,y:t,z:n,t:r}=this.ep;const s=I(I(n+t)*I(n-t)),u=I(e*t),{value:a}=zi(I(s*u**je)),o=I(a*s),l=I(a*u),c=I(o*l*r);let f;if(St(r*c)){let d=I(t*zn),p=I(e*zn);e=d,t=p,f=I(o*yl)}else f=l;St(e*c)&&(t=I(-t));let h=I((n-t)*f);return St(h)&&(h=I(-h)),Kn(h)}toHex(){return Zn(this.toRawBytes())}toString(){return this.toHex()}equals(e){Ir(e);const t=this.ep,n=e.ep,r=I(t.x*n.y)===I(t.y*n.x),s=I(t.y*n.y)===I(t.x*n.x);return r||s}add(e){return Ir(e),new Ze(this.ep.add(e.ep))}subtract(e){return Ir(e),new Ze(this.ep.subtract(e.ep))}multiply(e){return new Ze(this.ep.multiply(e))}multiplyUnsafe(e){return new Ze(this.ep.multiplyUnsafe(e))}}Ze.BASE=new Ze(ae.BASE);Ze.ZERO=new Ze(ae.ZERO);const Kr=new WeakMap;class Ae{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,Kr.delete(this)}static fromHex(e,t=!0){const{d:n,P:r}=ce;e=Pt(e,32);const s=e.slice();s[31]=e[31]&-129;const u=Bn(s);if(t&&u>=r)throw new Error("Expected 0 < hex < P");if(!t&&u>=ha)throw new Error("Expected 0 < hex < 2**256");const a=I(u*u),o=I(a-ue),l=I(n*a+ue);let{isValid:c,value:f}=fi(o,l);if(!c)throw new Error("Point.fromHex: invalid y coordinate");const h=(f&ue)===ue;return(e[31]&128)!==0!==h&&(f=I(-f)),new Ae(f,u)}static async fromPrivateKey(e){return(await _r(e)).point}toRawBytes(){const e=Kn(this.y);return e[31]|=this.x&ue?128:0,e}toHex(){return Zn(this.toRawBytes())}toX25519(){const{y:e}=this,t=I((ue+e)*wr(ue-e));return Kn(t)}isTorsionFree(){return ae.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new Ae(I(-this.x),this.y)}add(e){return ae.fromAffine(this).add(ae.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return ae.fromAffine(this).multiply(e,this).toAffine()}}Ae.BASE=new Ae(ce.Gx,ce.Gy);Ae.ZERO=new Ae(Be,ue);class Qn{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromHex(e){const t=Pt(e,64),n=Ae.fromHex(t.slice(0,32),!1),r=Bn(t.slice(32,64));return new Qn(n,r)}assertValidity(){const{r:e,s:t}=this;if(!(e instanceof Ae))throw new Error("Expected Point instance");return Dr(t,ce.l,!1),this}toRawBytes(){const e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(Kn(this.s),32),e}toHex(){return Zn(this.toRawBytes())}}function El(...i){if(!i.every(n=>n instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(i.length===1)return i[0];const e=i.reduce((n,r)=>n+r.length,0),t=new Uint8Array(e);for(let n=0,r=0;n<i.length;n++){const s=i[n];t.set(s,r),r+=s.length}return t}const kl=Array.from({length:256},(i,e)=>e.toString(16).padStart(2,"0"));function Zn(i){if(!(i instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let t=0;t<i.length;t++)e+=kl[i[t]];return e}function da(i){if(typeof i!="string")throw new TypeError("hexToBytes: expected string, got "+typeof i);if(i.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const e=new Uint8Array(i.length/2);for(let t=0;t<e.length;t++){const n=t*2,r=i.slice(n,n+2),s=Number.parseInt(r,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[t]=s}return e}function pa(i){const t=i.toString(16).padStart(64,"0");return da(t)}function Kn(i){return pa(i).reverse()}function St(i){return(I(i)&ue)===ue}function Bn(i){if(!(i instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+Zn(Uint8Array.from(i).reverse()))}function xr(i){return I(Bn(i)&je**fa-ue)}function I(i,e=ce.P){const t=i%e;return t>=Be?t:e+t}function wr(i,e=ce.P){if(i===Be||e<=Be)throw new Error(`invert: expected positive integers, got n=${i} mod=${e}`);let t=I(i,e),n=e,r=Be,s=ue;for(;t!==Be;){const a=n/t,o=n%t,l=r-s*a;n=t,t=o,r=s,s=l}if(n!==ue)throw new Error("invert: does not exist");return I(r,e)}function Fl(i,e=ce.P){const t=new Array(i.length),n=i.reduce((s,u,a)=>u===Be?s:(t[a]=s,I(s*u,e)),ue),r=wr(n,e);return i.reduceRight((s,u,a)=>u===Be?s:(t[a]=I(s*t[a],e),I(s*u,e)),r),t}function it(i,e){const{P:t}=ce;let n=i;for(;e-- >Be;)n*=n,n%=t;return n}function vl(i){const{P:e}=ce,t=BigInt(5),n=BigInt(10),r=BigInt(20),s=BigInt(40),u=BigInt(80),o=i*i%e*i%e,l=it(o,je)*o%e,c=it(l,ue)*i%e,f=it(c,t)*c%e,h=it(f,n)*f%e,d=it(h,r)*h%e,p=it(d,s)*d%e,D=it(p,u)*p%e,g=it(D,u)*p%e,m=it(g,n)*f%e;return{pow_p_5_8:it(m,je)*i%e,b2:o}}function fi(i,e){const t=I(e*e*e),n=I(t*t*e),r=vl(i*n).pow_p_5_8;let s=I(i*t*r);const u=I(e*s*s),a=s,o=I(s*zn),l=u===i,c=u===I(-i),f=u===I(-i*zn);return l&&(s=a),(c||f)&&(s=o),St(s)&&(s=I(-s)),{isValid:l||c,value:s}}function zi(i){return fi(ue,i)}async function Vr(...i){const e=await yr.sha512(El(...i)),t=Bn(e);return I(t,ce.l)}function Bl(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}function Pt(i,e){const t=i instanceof Uint8Array?Uint8Array.from(i):da(i);if(typeof e=="number"&&t.length!==e)throw new Error(`Expected ${e} bytes`);return t}function Dr(i,e,t=!0){if(!e)throw new TypeError("Specify max value");if(typeof i=="number"&&Number.isSafeInteger(i)&&(i=BigInt(i)),typeof i=="bigint"&&i<e){if(t){if(Be<i)return i}else if(Be<=i)return i}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function Sl(i){return i[0]&=248,i[31]&=127,i[31]|=64,i}async function _r(i){if(i=typeof i=="bigint"||typeof i=="number"?pa(Dr(i,ha)):Pt(i),i.length!==32)throw new Error("Expected 32 bytes");const e=await yr.sha512(i),t=Sl(e.slice(0,32)),n=e.slice(32,64),r=I(Bn(t),ce.l),s=Ae.BASE.multiply(r),u=s.toRawBytes();return{head:t,prefix:n,scalar:r,point:s,pointBytes:u}}async function Tl(i){return(await _r(i)).pointBytes}async function Pl(i,e){i=Pt(i);const{prefix:t,scalar:n,pointBytes:r}=await _r(e),s=await Vr(t,i),u=Ae.BASE.multiply(s),a=await Vr(u.toRawBytes(),r,i),o=I(s+a*n,ce.l);return new Qn(u,o).toRawBytes()}async function Il(i,e,t){e=Pt(e),t instanceof Ae||(t=Ae.fromHex(t,!1));const{r:n,s:r}=i instanceof Qn?i.assertValidity():Qn.fromHex(i),s=ae.BASE.multiplyUnsafe(r),u=await Vr(n.toRawBytes(),t.toRawBytes(),e),a=ae.fromAffine(t).multiplyUnsafe(u);return ae.fromAffine(n).add(a).subtract(s).multiplyUnsafe(ce.h).equals(ae.ZERO)}Ae.BASE._setWindowSize(8);const vt={node:wl,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},yr={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:Zn,getExtendedPublicKey:_r,mod:I,invert:wr,hashToPrivateScalar:i=>{if(i=Pt(i),i.length<40||i.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const e=I(Bn(i),ce.l);if(e===Be||e===ue)throw new Error("Invalid private key");return e},randomBytes:(i=32)=>{if(vt.web)return vt.web.getRandomValues(new Uint8Array(i));if(vt.node){const{randomBytes:e}=vt.node;return new Uint8Array(e(i).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>yr.randomBytes(32),sha512:async i=>{if(vt.web){const e=await vt.web.subtle.digest("SHA-512",i.buffer);return new Uint8Array(e)}else{if(vt.node)return Uint8Array.from(vt.node.createHash("sha512").update(i).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(i=8,e=Ae.BASE){const t=e.equals(Ae.BASE)?e:new Ae(e.x,e.y);return t._setWindowSize(i),t.multiply(je),t}};var se=globalThis&&globalThis.__classPrivateFieldGet||function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},ye=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},dt,pt,Dt,mt,gt,bt,qt,Oe;const be=11400714785074694791n,Te=14029467366897019727n,Hi=1609587929392839161n,xn=9650029242287828579n,qi=2870177450012600261n,Da=64n,Rl=2n**Da-1n,xl=new li;function Wi(i,e,t,n){return BigInt(i)|BigInt(e)<<16n|BigInt(t)<<32n|BigInt(n)<<48n}function ft(i,e){return BigInt(i[e])|BigInt(i[e+1])<<8n|BigInt(i[e+2])<<16n|BigInt(i[e+3])<<24n|BigInt(i[e+4])<<32n|BigInt(i[e+5])<<40n|BigInt(i[e+6])<<48n|BigInt(i[e+7])<<56n}function Ce(i,e){return i<<e&Rl|i>>Da-e}function ee(i){return BigInt.asUintN(64,i)}class hi{constructor(e=0){dt.set(this,void 0),pt.set(this,void 0),Dt.set(this,void 0),mt.set(this,void 0),gt.set(this,void 0),bt.set(this,void 0),qt.set(this,void 0),Oe.set(this,void 0),this.reset(e)}reset(e=se(this,dt,"f")){return ye(this,dt,BigInt.asUintN(32,BigInt(e)),"f"),ye(this,pt,ee(se(this,dt,"f")+be+Te),"f"),ye(this,Dt,ee(se(this,dt,"f")+Te),"f"),ye(this,mt,se(this,dt,"f"),"f"),ye(this,gt,ee(se(this,dt,"f")-be),"f"),ye(this,bt,null,"f"),ye(this,qt,0,"f"),ye(this,Oe,0,"f"),this}update(e){typeof e=="string"&&(e=xl.encode(e));let t=0,n=e.length,r=t+n;if(n===0)return this;if(ye(this,qt,se(this,qt,"f")+n,"f"),se(this,Oe,"f")===0&&ye(this,bt,new Uint8Array(32),"f"),se(this,Oe,"f")+n<32)return se(this,bt,"f").set(e.subarray(0,n),se(this,Oe,"f")),ye(this,Oe,se(this,Oe,"f")+n,"f"),this;if(se(this,Oe,"f")>0){se(this,bt,"f").set(e.subarray(0,32-se(this,Oe,"f")),se(this,Oe,"f"));let s=0,u;u=ft(se(this,bt,"f"),s),ye(this,pt,ee(Ce(ee(se(this,pt,"f")+u*Te),31n)*be),"f"),s+=8,u=ft(this.memory,s),ye(this,Dt,ee(Ce(ee(se(this,Dt,"f")+u*Te),31n)*be),"f"),s+=8,u=ft(this.memory,s),ye(this,mt,ee(Ce(ee(se(this,mt,"f")+u*Te),31n)*be),"f"),s+=8,u=ft(this.memory,s),ye(this,gt,ee(Ce(ee(se(this,gt,"f")+u*Te),31n)*be),"f"),t+=32-se(this,Oe,"f"),ye(this,Oe,0,"f")}if(t<=r-32){const s=r-32;do{let u;u=ft(e,t),ye(this,pt,ee(Ce(ee(se(this,pt,"f")+u*Te),31n)*be),"f"),t+=8,u=ft(e,t),ye(this,Dt,ee(Ce(ee(se(this,Dt,"f")+u*Te),31n)*be),"f"),t+=8,u=ft(e,t),ye(this,mt,ee(Ce(ee(se(this,mt,"f")+u*Te),31n)*be),"f"),t+=8,u=ft(e,t),ye(this,gt,ee(Ce(ee(se(this,gt,"f")+u*Te),31n)*be),"f"),t+=8}while(t<=s)}return t<r&&(se(this,bt,"f").set(e.subarray(t,r),se(this,Oe,"f")),ye(this,Oe,r-t,"f")),this}digest(){let e=se(this,bt,"f"),t=se(this,Oe,"f"),n=0,r=0n,s=0n,u=0n;for(se(this,qt,"f")>=32?(r=Ce(se(this,pt,"f"),1n)+Ce(se(this,Dt,"f"),7n)+Ce(se(this,mt,"f"),12n)+Ce(se(this,gt,"f"),18n),r=ee(r^Ce(ee(se(this,pt,"f")*Te),31n)*be),r=ee(r*be+xn),r=ee(r^Ce(ee(se(this,Dt,"f")*Te),31n)*be),r=ee(r*be+xn),r=ee(r^Ce(ee(se(this,mt,"f")*Te),31n)*be),r=ee(r*be+xn),r=ee(r^Ce(ee(se(this,gt,"f")*Te),31n)*be),r=ee(r*be+xn)):r=ee(se(this,dt,"f")+qi),r+=BigInt(se(this,qt,"f"));n<=t-8;)u=ft(e,n),u=ee(Ce(ee(u*Te),31n)*be),r=ee(Ce(r^u,27n)*be+xn),n+=8;for(n+4<=t&&(u=Wi(e[n+1]<<8|e[n],e[n+3]<<8|e[n+2],0,0),r=ee(Ce(r^ee(u*be),23n)*Te+Hi),n+=4);n<t;)u=Wi(e[n++],0,0,0),r=ee(Ce(r^ee(u*qi),11n)*be);return s=ee(r>>33n),r=ee((r^s)*Te),s=ee(r>>29n),r=ee((r^s)*Hi),s=ee(r>>32n),r=ee(r^s),r}}dt=new WeakMap,pt=new WeakMap,Dt=new WeakMap,mt=new WeakMap,gt=new WeakMap,bt=new WeakMap,qt=new WeakMap,Oe=new WeakMap;function Ol(i,e=0){return new hi(e).update(i).digest()}function ma(i,e){return i<e?-1:i>e?1:0}class Wt{constructor(e,t){Object.defineProperty(this,"parent",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"left",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"right",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.left=null,this.right=null}static from(e){const t=new Wt(e.parent,e.value);return t.left=e.left,t.right=e.right,t}directionFromParent(){return this.parent===null?null:this===this.parent.left?"left":this===this.parent.right?"right":null}findMinNode(){let e=this.left;for(;e!=null&&e.left;)e=e.left;return e??this}findMaxNode(){let e=this.right;for(;e!=null&&e.right;)e=e.right;return e??this}findSuccessorNode(){if(this.right!==null)return this.right.findMinNode();let e=this.parent,t=this.directionFromParent();for(;e&&t==="right";)t=e.directionFromParent(),e=e.parent;return e}}class pn{constructor(e=ma){Object.defineProperty(this,"compare",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"root",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_size",{enumerable:!0,configurable:!0,writable:!0,value:0})}static from(e,t){let n,r=[];if(e instanceof pn)if(n=new pn((t==null?void 0:t.compare)??e.compare),t!=null&&t.compare||t!=null&&t.map)r=e;else{const u=[];for(e.root&&(n.root=Wt.from(e.root),u.push(n.root));u.length;){const a=u.pop(),o=a.left?Wt.from(a.left):null,l=a.right?Wt.from(a.right):null;o&&(o.parent=a,u.push(o)),l&&(l.parent=a,u.push(l))}}else n=t!=null&&t.compare?new pn(t.compare):new pn,r=e;const s=t!=null&&t.map?Array.from(r,t.map,t.thisArg):r;for(const u of s)n.insert(u);return n}get size(){return this._size}findNode(e){let t=this.root;for(;t;){const n=this.compare(e,t.value);if(n===0)break;const r=n<0?"left":"right";t=t[r]}return t}rotateNode(e,t){const n=t==="left"?"right":"left";if(!e[n])throw new TypeError(`cannot rotate ${t} without ${n} child`);const r=e[n];if(e[n]=r[t]??null,r[t]&&(r[t].parent=e),r.parent=e.parent,e.parent){const s=e===e.parent[t]?t:n;e.parent[s]=r}else this.root=r;r[t]=e,e.parent=r}insertNode(e,t){if(this.root){let n=this.root;for(;;){const r=this.compare(t,n.value);if(r===0)break;const s=r<0?"left":"right";if(n[s])n=n[s];else return n[s]=new e(n,t),this._size++,n[s]}}else return this.root=new e(null,t),this._size++,this.root;return null}removeNode(e){let t=this.findNode(e);if(t){const n=!t.left||!t.right?t:t.findSuccessorNode(),r=n.left??n.right;r&&(r.parent=n.parent),n.parent?n.parent[n.directionFromParent()]=r:this.root=r,n!==t&&(t.value=n.value,t=n),this._size--}return t}insert(e){return!!this.insertNode(Wt,e)}remove(e){return!!this.removeNode(e)}find(e){var t;return((t=this.findNode(e))==null?void 0:t.value)??null}min(){return this.root?this.root.findMinNode().value:null}max(){return this.root?this.root.findMaxNode().value:null}clear(){this.root=null,this._size=0}isEmpty(){return this.size===0}*lnrValues(){const e=[];let t=this.root;for(;e.length||t;)t?(e.push(t),t=t.left):(t=e.pop(),yield t.value,t=t.right)}*rnlValues(){const e=[];let t=this.root;for(;e.length||t;)t?(e.push(t),t=t.right):(t=e.pop(),yield t.value,t=t.left)}*nlrValues(){const e=[];for(this.root&&e.push(this.root);e.length;){const t=e.pop();yield t.value,t.right&&e.push(t.right),t.left&&e.push(t.left)}}*lrnValues(){const e=[];let t=this.root,n=null;for(;e.length||t;)if(t)e.push(t),t=t.left;else{const r=e[e.length-1];r.right&&r.right!==n?t=r.right:(yield r.value,n=e.pop())}}*lvlValues(){const e=[];let t=this.root;for(;t;)yield t.value,t.left&&e.push(t.left),t.right&&e.push(t.right),t=e.shift()??null}*[Symbol.iterator](){yield*this.lnrValues()}}class Qt extends Wt{constructor(e,t){super(e,t),Object.defineProperty(this,"red",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.red=!0}static from(e){const t=new Qt(e.parent,e.value);return t.left=e.left,t.right=e.right,t.red=e.red,t}}class Dn extends pn{constructor(e=ma){super(e)}static from(e,t){let n,r=[];if(e instanceof Dn)if(n=new Dn((t==null?void 0:t.compare)??e.compare),t!=null&&t.compare||t!=null&&t.map)r=e;else{const u=[];for(e.root&&(n.root=Qt.from(e.root),u.push(n.root));u.length;){const a=u.pop(),o=a.left?Qt.from(a.left):null,l=a.right?Qt.from(a.right):null;o&&(o.parent=a,u.push(o)),l&&(l.parent=a,u.push(l))}}else n=t!=null&&t.compare?new Dn(t.compare):new Dn,r=e;const s=t!=null&&t.map?Array.from(r,t.map,t.thisArg):r;for(const u of s)n.insert(u);return n}removeFixup(e,t){var n,r,s;for(;e&&!(t!=null&&t.red);){const u=e.left===t?"left":"right",a=u==="right"?"left":"right";let o=e[a];o!=null&&o.red&&(o.red=!1,e.red=!0,this.rotateNode(e,u),o=e[a]),o&&(!((n=o.left)!=null&&n.red)&&!((r=o.right)!=null&&r.red)?(o.red=!0,t=e,e=t.parent):((s=o[a])!=null&&s.red||(o[u].red=!1,o.red=!0,this.rotateNode(o,a),o=e[a]),o.red=e.red,e.red=!1,o[a].red=!1,this.rotateNode(e,u),t=this.root,e=null))}t&&(t.red=!1)}insert(e){var n;let t=this.insertNode(Qt,e);if(t){for(;(n=t.parent)!=null&&n.red;){let r=t.parent;const s=r.directionFromParent(),u=s==="right"?"left":"right",a=r.parent[u]??null;a!=null&&a.red?(r.red=!1,a.red=!1,r.parent.red=!0,t=r.parent):(t===r[u]&&(t=r,this.rotateNode(t,s),r=t.parent),r.red=!1,r.parent.red=!0,this.rotateNode(r.parent,u))}this.root.red=!1}return!!t}remove(e){const t=this.removeNode(e);return t&&!t.red&&this.removeFixup(t.parent,t.left??t.right),!!t}}function Or(i,e){return{lift:t=>[i.lift(t),e.lift(t)],combine:(t,n)=>{const r=i.combine(t[0],n[0]),s=e.combine(t[1],n[1]);return[r,s]},neutral:[i.neutral,e.neutral]}}const $l={lift:i=>1,combine:(i,e)=>i+e,neutral:0};class Qi extends Qt{constructor(e,t,n){super(e,t),Object.defineProperty(this,"label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"liftedValue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"monoid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.label=n.neutral,this.liftedValue=n.lift(t),this.monoid=n}updateLabel(e=!0,t){var n;this.left!==null&&this.right===null?this.label=this.monoid.combine(this.left.label,this.liftedValue):this.left===null&&this.right!==null?this.label=this.monoid.combine(this.liftedValue,this.right.label):this.left&&this.right?this.label=this.monoid.combine(this.left.label,this.monoid.combine(this.liftedValue,this.right.label)):this.label=this.liftedValue,e&&((n=this.parent)==null||n.updateLabel(!0,"Updated by child"))}}class Ml extends Dn{constructor(e,t){super(t),Object.defineProperty(this,"monoid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedMinNode",{enumerable:!0,configurable:!0,writable:!0,value:null});const s=Or({lift:u=>[u],combine:(u,a)=>u.concat(a),neutral:[]},{lift:u=>u,combine:(u,a)=>{if(!(u===void 0&&a===void 0))return a===void 0?u:u===void 0?a:t(u,a)>0?u:a},neutral:void 0});this.monoid=Or(e,Or($l,s))}getLowestValue(){if(!this.root)throw new Error("Can't get a range from a tree with no items");return this.cachedMinNode?this.cachedMinNode.value:this.root.findMinNode().value}rotateNode(e,t){var s;const n=t==="left"?"right":"left";if(!e[n])throw new TypeError(`cannot rotate ${t} without ${n} child`);const r=e[n];if(e[n]=r[t]??null,r[t]&&(r[t].parent=e),r.parent=e.parent,e.parent){const u=e===e.parent[t]?t:n;e.parent[u]=r}else this.root=r;r[t]=e,e.parent=r,(s=r[t])==null||s.updateLabel(!1,"Node rotated")}removeFixup(e,t){var n,r,s;for(;e&&!(t!=null&&t.red);){const u=e.left===t?"left":"right",a=u==="right"?"left":"right";let o=e[a];o!=null&&o.red&&(o.red=!1,e.red=!0,this.rotateNode(e,u),o=e[a]),o&&(!((n=o.left)!=null&&n.red)&&!((r=o.right)!=null&&r.red)?(o.red=!0,t=e,e=t.parent):((s=o[a])!=null&&s.red||(o[u].red=!1,o.red=!0,this.rotateNode(o,a),o=e[a]),o.red=e.red,e.red=!1,o[a].red=!1,this.rotateNode(e,u),t=this.root,e=null))}t&&(t.red=!1)}insertFingerprintNode(e){if(this.root){let t=this.root,n=!0;for(;;){const r=this.compare(e,t.value);if(r===0){n=!1;break}const s=r<0?"left":"right";if(n&&s==="right"&&(n=!1),t[s])t=t[s];else return t[s]=new Qi(t,e,this.monoid),this._size++,n&&(this.cachedMinNode=t[s]),t[s]}}else return this.root=new Qi(null,e,this.monoid),this._size++,this.cachedMinNode=this.root,this.root;return null}insert(e){var r;const t=this.insertFingerprintNode(e);let n=t;if(n){for(;(r=n.parent)!=null&&r.red;){let s=n.parent;const u=s.directionFromParent(),a=u==="right"?"left":"right",o=s.parent[a]??null;o!=null&&o.red?(s.red=!1,o.red=!1,s.parent.red=!0,n=s.parent):(n===s[a]&&(n=s,this.rotateNode(n,u),s=n.parent),s.red=!1,s.parent.red=!0,this.rotateNode(s.parent,a))}this.root.red=!1}return t==null||t.updateLabel(!0,"Node inserted"),!!n}remove(e){var n;const t=this.removeNode(e);return t&&!t.red&&this.removeFixup(t.parent,t.left??t.right),t&&((n=t.parent)==null||n.updateLabel(!0,"Child node removed")),!!t}getFingerprint(e,t,n){if(this.root===null)return{fingerprint:this.monoid.neutral[0],size:0,items:[],nextTree:null};const r=this.compare(e,t);if(r===0)return{fingerprint:this.root.label[0],size:this.root.label[1][0],items:this.root.label[1][1][0],nextTree:this.cachedMinNode};if(r<0){const s=this.compare(e,this.cachedMinNode.value)<=0?this.cachedMinNode:null,u=n||s||this.findGteNode(e),{label:a,nextTree:o}=this.aggregateUntil(u,e,t);return{fingerprint:a[0],size:a[1][0],items:a[1][1][0],nextTree:o}}else{const s=this.cachedMinNode,u=this.root.label[1][1][1],a=this.compare(t,s.value)>0,o=this.compare(e,u)<=0;if(a&&o){const{label:l,nextTree:c}=this.aggregateUntil(s,s.value,t),h=[this.monoid.lift(u)[0],[1,[[u],u]]],d=n||this.findGteNode(e),{label:p}=this.aggregateUntil(d,e,u),D=this.monoid.combine(p,h),g=this.monoid.combine(l,D);return{fingerprint:g[0],size:g[1][0],items:g[1][1][0],nextTree:c}}else if(a){const{label:l,nextTree:c}=this.aggregateUntil(s,s.value,t);return{fingerprint:l[0],size:l[1][0],items:l[1][1][0],nextTree:c}}else{const l=this.compare(e,this.cachedMinNode.value)<=0?this.cachedMinNode:null,c=n||l||this.findGteNode(e),{label:f}=this.aggregateUntil(c,e,u),d=[this.monoid.lift(u)[0],[1,[[u],u]]],p=this.monoid.combine(f,d);return{fingerprint:p[0],size:p[1][0],items:p[1][1][0],nextTree:l}}}}findGteNode(e){let t=this.root;for(;t;){const n=this.compare(e,t.value);if(n===0)break;const r=n<0?"left":"right";if(t[r])t=t[r];else break}return t}aggregateUntil(e,t,n){const{label:r,nextTree:s}=this.aggregateUp(e,t,n);return s===null||this.compare(s.value,n)>=0?{label:r,nextTree:s}:this.aggregateDown(s.right,n,this.monoid.combine(r,s.liftedValue))}aggregateUp(e,t,n){var u;let r=this.monoid.neutral,s=e;for(;this.compare(s.label[1][1][1],n)<0;){if(this.compare(s.value,t)>=0&&(r=this.monoid.combine(r,this.monoid.combine(s.liftedValue,((u=s.right)==null?void 0:u.label)||this.monoid.neutral))),s.parent===null)return{label:r,nextTree:null};s=s.parent}return{label:r,nextTree:s}}aggregateDown(e,t,n){var u,a;let r=e,s=n;for(;r!==null;)if(this.compare(r.value,t)<0)s=this.monoid.combine(s,this.monoid.combine(((u=r.left)==null?void 0:u.label)||this.monoid.neutral,r.liftedValue)),r=r.right;else{if(r.left===null||this.compare(r.label[1][1][1],t)<0)return{label:this.monoid.combine(s,((a=r.left)==null?void 0:a.label)||this.monoid.neutral),nextTree:r};r=r.left}return{label:s,nextTree:null}}}function Nl(){let i,e="pending";const t=new Promise((n,r)=>{i={async resolve(s){await s,e="fulfilled",n(s)},reject(s){e="rejected",r(s)}}});return Object.defineProperty(t,"state",{get:()=>e}),Object.assign(t,i)}class jl{constructor(){Object.defineProperty(this,"deferreds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"pending"})}resolve(e){if(this.state==="pending"){this.state="fulfilled";for(const t of this.deferreds)t.resolve(e)}}reject(e){if(this.state==="pending"){this.state="rejected";for(const t of this.deferreds)t.reject(e)}}tee(){const e=Nl();return this.state==="fulfilled"?e.resolve():this.state==="rejected"?e.reject():this.deferreds.add(e),e}}class Ll{constructor(e){Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDoneTee",{enumerable:!0,configurable:!0,writable:!0,value:new jl}),Object.defineProperty(this,"insertionCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"fingerprintEquals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowerBoundFromPrev",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"collatedPayload",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"collatePayloads",{enumerable:!0,configurable:!0,writable:!0,value:t=>{switch(t.type){case"payload":{let n=this.collatedPayload;if(n===null&&(n={type:"payload",lowerBound:t.lowerBound,payload:[],end:{canRespond:!1,upperBound:t.payload}}),n.payload.push(t.payload),this.collatedPayload=n,t.end)return t.end.upperBound?n.end=t.end:n.end={...t.end,upperBound:t.payload},this.collatedPayload=null,n;break}default:return this.collatedPayload&&(this.collatedPayload=null),t}}}),Object.defineProperty(this,"reusableTree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastAdjacentDoneUpperBound",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"isDoneSoFar",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.tree=e.tree,this.fingerprintEquals=e.fingerprintEquals,this.encoding=e.encoding,this.payloadThreshold=e.payloadThreshold,this.rangeDivision=e.rangeDivision}decode(e){const t=this.lowerBoundFromPrev;try{switch(this.encoding.decode.getType(e)){case"payload":{const r=this.encoding.decode.payload(e);return r.end&&(this.lowerBoundFromPrev=r.end.upperBound),{type:"payload",lowerBound:t,payload:r.value,...r.end?{end:r.end}:{}}}case"fingerprint":{const r=this.encoding.decode.fingerprint(e);return this.lowerBoundFromPrev=r.upperBound,{type:"fingerprint",lowerBound:t,fingerprint:r.fingerprint,upperBound:r.upperBound}}case"emptyPayload":{const r=this.encoding.decode.emptyPayload(e);return this.lowerBoundFromPrev=r,{lowerBound:t,type:"emptyPayload",upperBound:r}}case"done":{const r=this.encoding.decode.done(e);return this.lowerBoundFromPrev=r,{lowerBound:t,type:"done",upperBound:r}}case"emptySet":return{type:"emptySet",canRespond:this.encoding.decode.emptySet(e)};case"lowerBound":{const r=this.encoding.decode.lowerBound(e);return this.lowerBoundFromPrev=r,{type:"lowerBound",value:r}}case"terminal":return this.encoding.decode.terminal(e),{type:"terminal"}}}catch(n){console.group("range-reconcile: Could not decode message"),console.warn(e),console.warn(n)}return null}setReusableTree(e){this.reusableTree=e||void 0}process(e){const t=this.reusableTree;switch(e.type){case"lowerBound":case"terminal":case"done":return this.setReusableTree(null),[e];case"emptySet":{if(e.canRespond===!1&&this.isDoneTee.resolve(),this.tree.size===0)return[{type:"emptySet",canRespond:!1}];const n=this.tree.getLowestValue(),r=[{type:"lowerBound",value:n}],{items:s}=this.tree.getFingerprint(n,n);for(let u=0;u<s.length;u++){const a=s[u];u===s.length-1?r.push({type:"payload",payload:a,end:{upperBound:n,canRespond:!1}}):r.push({type:"payload",payload:a})}return r.push({type:"terminal"}),r}case"fingerprint":{const{fingerprint:n,size:r,items:s,nextTree:u}=this.tree.getFingerprint(e.lowerBound,e.upperBound,t);if(this.setReusableTree(u),this.fingerprintEquals(n,e.fingerprint))return[{type:"done",upperBound:e.upperBound}];if(r<=this.payloadThreshold){if(r===0)return[{type:"emptyPayload",upperBound:e.upperBound}];const a=[];for(let o=0;o<r;o++)a.push({type:"payload",payload:s[o],...o===s.length-1?{end:{upperBound:e.upperBound,canRespond:!0}}:{}});return a}else{const a=Math.ceil(r/this.rangeDivision),o=[];if(a<=this.payloadThreshold){for(let h=0;h<s.length;h++)o.push({type:"payload",payload:s[h],...h===s.length-1?{end:{upperBound:e.upperBound,canRespond:!0}}:{}});return o}let l;const c=s;let f=!1;if(e.lowerBound>=e.upperBound){let h=0;for(let d=0;d<=s.length;d++)if(s[d]>=e.lowerBound){h=d;break}if(h>0){const d=c.splice(0,h);c.push(...d),f=!0}}for(let h=0;h<r;h+=a){const d=c[h],p=c[h+a]||e.upperBound,{fingerprint:D,nextTree:g}=this.tree.getFingerprint(d,p,l);l=f?void 0:g||void 0,o.push({type:"fingerprint",fingerprint:D,upperBound:p})}return o}}case"payload":{for(const n of e.payload){this.tree.insert(n);for(const r of this.insertionCallbacks)r(n)}if(e.end.canRespond){const{items:n,size:r,nextTree:s}=this.tree.getFingerprint(e.lowerBound,e.end.upperBound,t);if(this.setReusableTree(s),r===0)return[{type:"emptyPayload",upperBound:e.end.upperBound}];const u=[];for(let a=0;a<r;a++)u.push({type:"payload",payload:n[a],...a===n.length-1?{end:{upperBound:e.end.upperBound,canRespond:!1}}:{}});return u}else return this.setReusableTree(null),[{type:"done",upperBound:e.end.upperBound}]}case"emptyPayload":{this.setReusableTree(null);const{items:n,size:r,nextTree:s}=this.tree.getFingerprint(e.lowerBound,e.upperBound);if(this.setReusableTree(s),r===0)return this.setReusableTree(null),[];const u=[];for(let a=0;a<r;a++)u.push({type:"payload",payload:n[a],...a===n.length-1?{end:{upperBound:e.upperBound,canRespond:!1}}:{}});return u}}}consolidateAdjacentDones(e){switch(e.type){case"done":{this.lastAdjacentDoneUpperBound=e.upperBound;break}default:{const t=this.lastAdjacentDoneUpperBound;return t?(this.lastAdjacentDoneUpperBound=null,[{type:"done",upperBound:t},e]):[e]}}}checkIsDone(e){var t;if(this.isDoneTee.state==="pending")switch(e.type){case"emptySet":{e.canRespond&&(this.isDoneSoFar=!1);break}case"lowerBound":break;case"fingerprint":this.isDoneSoFar=!1;break;case"emptyPayload":this.isDoneSoFar=!1;break;case"payload":((t=e.end)==null?void 0:t.canRespond)===!0&&(this.isDoneSoFar=!1);break;case"terminal":this.isDoneSoFar?this.isDoneTee.resolve():this.isDoneSoFar=!0}}encode(e){let t;switch(e.type){case"emptySet":{t=this.encoding.encode.emptySet(e.canRespond);break}case"lowerBound":{t=this.encoding.encode.lowerBound(e.value);break}case"done":{t=this.encoding.encode.done(e.upperBound);break}case"fingerprint":{t=this.encoding.encode.fingerprint(e.fingerprint,e.upperBound);break}case"payload":{t=this.encoding.encode.payload(e.payload,e.end);break}case"emptyPayload":{t=this.encoding.encode.emptyPayload(e.upperBound);break}case"terminal":{t=this.encoding.encode.terminal();break}}return t}respond(e){if(this.isDone().state==="fulfilled")return[];const t=this.decode(e),n=this.collatePayloads(t);if(n===void 0)return[];const r=this.process(n),s=[];for(const a of r){const o=this.consolidateAdjacentDones(a);o&&s.push(...o)}for(const a of s)this.checkIsDone(a);const u=[];for(const a of s)u.push(this.encode(a));return u}isDone(){return this.isDoneTee.tee()}initialMessages(e){const{tree:t,encoding:n,payloadThreshold:r,rangeDivision:s}=this;function*u(){if(t.size===0){yield n.encode.emptySet(!0);return}const a=t.getLowestValue();yield n.encode.lowerBound(a);const{items:l}=t.getFingerprint(a,a),f=(e||(p=>{const D=Math.ceil(p.length/s),g=[];for(let m=0;m<p.length;m+=D){const E=p.slice(m,m+D);g.push(E)}return g}))(l);let h;for(let p=0;p<f.length;p++){const D=f[p+1]?f[p+1][0]:a,g=f[p];if(g.length<=r)for(let m=0;m<g.length;m++)yield n.encode.payload(g[m],m===g.length-1?{upperBound:D,canRespond:!0}:void 0);else{const m=g[0],{fingerprint:E,nextTree:B}=t.getFingerprint(m,D,h);h=B||void 0,yield n.encode.fingerprint(E,D)}}yield n.encode.terminal()}return u()}onInsertion(e){return this.insertionCallbacks.add(e),()=>{this.insertionCallbacks.delete(e)}}}var Re=globalThis&&globalThis.__classPrivateFieldGet||function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},tr=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},Nt,jt,On,ht,$r,nr;const Ki=Symbol("Stream ended."),Mr=Symbol("Stream errored.");class At{constructor(e){var t,n,r;Nt.add(this),jt.set(this,[]),On.set(this,null),ht.set(this,void 0),Object.defineProperty(this,"push",{enumerable:!0,configurable:!0,writable:!0,value:(...s)=>{s.length?Re(this,Nt,"m",nr).call(this,!1,s):(Re(this,Nt,"m",nr).call(this,!1,[Mr]),Re(this,Nt,"m",$r).call(this,new Error("AsyncQueueError: queue.push was called with no arguments")))}}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:({immediately:s=!1,withError:u}={})=>{u&&Re(this,Nt,"m",$r).call(this,u),Re(this,Nt,"m",nr).call(this,s,[u?Mr:Ki]),this.push=this.close=()=>{}}}),(r=(n=(t=e==null?void 0:e.catch)==null?void 0:t.call(e,s=>this.close({withError:s})))==null?void 0:n.finally)==null||r.call(n,()=>this.close())}get length(){return Re(this,jt,"f").length}async*[(jt=new WeakMap,On=new WeakMap,ht=new WeakMap,Nt=new WeakSet,$r=function(t){Re(this,ht,"f")instanceof AggregateError?Re(this,ht,"f").errors.push(t):Re(this,ht,"f")?tr(this,ht,new AggregateError([Re(this,ht,"f"),t]),"f"):tr(this,ht,t,"f")},nr=function(t,n){var r;Re(this,jt,"f")[t?"unshift":"push"](...n),(r=Re(this,On,"f"))==null||r.call(this,Re(this,jt,"f").shift()),tr(this,On,null,"f")},Symbol.asyncIterator)](){for(;;){const e=Re(this,jt,"f").length?Re(this,jt,"f").shift():await new Promise(t=>{tr(this,On,t,"f")});if(e===Mr)throw Re(this,ht,"f");if(e===Ki)break;yield e}}}function Y(){let i,e="pending";const t=new Promise((n,r)=>{i={async resolve(s){await s,e="fulfilled",n(s)},reject(s){e="rejected",r(s)}}});return Object.defineProperty(t,"state",{get:()=>e}),Object.assign(t,i)}new Qu;const Ul=new li;function Gr(i){return Ul.encode(i)}function zl(i){return Gr(i).length}function Zr(i,e){for(let t of i)if(e.indexOf(t)===-1)return!1;return!0}function Vi(i){return i===""?!1:Yn.indexOf(i)!==-1}const Sn="abcdefghijklmnopqrstuvwxyz",Hl=Sn.toUpperCase(),Yn="0123456789",Ct=Sn+"234567",ga=Sn+Yn,ql=Ct,ba=ga+Ct+"@.",wa=Sn+Yn,Wl=Sn+Yn,_a=wa+Ct+"+.",Ql="/'()-._~!$&+,:=@%",ya=Sn+Hl+Yn+Ql;function Kl(i,e){return`@${i}.${e}`}function Vl(i,e){return`+${i}.${e}`}function di(i){const e=Aa(i);return Hu(e)?!0:e}function xt(i){const e=Ca(i);return Hu(e)?!0:e}function Yr(i){return i.startsWith("@")?Aa(i):i.startsWith("+")?Ca(i):new $("address must start with either @ or +")}function Aa(i){return Ea(i,{sigil:"@",separator:".",minNameLength:4,maxNameLength:4,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:ga,allowedPubkeyCharacters:ql,pubkeyMustStartWithB:!0})}function Ca(i){return Ea(i,{sigil:"+",separator:".",minNameLength:1,maxNameLength:15,minPubkeyLength:1,maxPubkeyLength:53,allowedNameCharacters:wa,allowedPubkeyCharacters:Wl,pubkeyMustStartWithB:!1})}function Ea(i,e){const{sigil:t,separator:n,minNameLength:r,maxNameLength:s,minPubkeyLength:u,maxPubkeyLength:a,allowedNameCharacters:o,allowedPubkeyCharacters:l,pubkeyMustStartWithB:c}=e;if(typeof i!="string")return new $("address must be a string");if(i.length<4)return new $("address is too short");if(i[0]!==t)return new $(`address must start with a sigil: "${t}"`);if(i.indexOf(n)===-1)return new $(`address must contain a separator character: "${n}"`);const f=i.slice(1).split(n);if(f.length!==2)return new $(`address must have exactly 2 parts separated by a "${n}" separator`);const[h,d]=f;return h.length<r||h.length>s?new $(`name must be between ${r} and ${s} characters long, but is ${h.length}`):d.length<u||d.length>a?new $(`pubkey must be between ${u} and ${a} characters long, but is ${d.length}`):Zr(h,o)?Zr(d,l)?Vi(h[0])?new $(`name "${h}" must not start with a digit`):Vi(d[0])?new $(`pubkey "${d}" must not start with a digit`):c&&d[0]!=="b"?new $(`pubkey "${d}" must start with 'b'`):{address:i,name:h,pubkey:d}:new $(`pubkey "${d}" must only have allowed characters`):new $(`name "${h}" must only have allowed characters`)}function pi(i){return!(Object.prototype.toString.call(i)!=="[object Object]"||(""+i.constructor).startsWith("class"))}function ka(i){return e=>e!==i?`expected literal value ${JSON.stringify(i)}`:null}function He(i={}){return e=>{if(i.optional!==!0&&e===void 0)return"required";if(i.optional===!0&&e===void 0)return null;let t=zl(e);return typeof e!="string"?"expected a string but got "+JSON.stringify(e):i.minLen!==void 0&&t<i.minLen?`string shorter than min length of ${i.minLen} chars`:i.maxLen!==void 0&&t>i.maxLen?`string shorter than max length of ${i.maxLen} chars`:i.len!==void 0&&t!==i.len?`string does not have required length of ${i.len} chars: ${e}`:i.allowedChars!==void 0&&!Zr(e,i.allowedChars)?"contains disallowed characters":null}}function Hn(i={}){return e=>i.optional!==!0&&e===void 0?"required":i.optional===!0&&e===void 0?null:i.nullable!==!0&&e===null?"not nullable":i.nullable===!0&&e===null?null:typeof e!="number"?"expected a number but got "+JSON.stringify(e):isNaN(e)?"is NaN":isFinite(e)?e!==Math.round(e)?"expected an integer":i.min!==void 0&&e<i.min?`integer too small (must be >= ${i.min})`:i.max!==void 0&&e>i.max?`integer too large (must be <= ${i.max})`:null:"is Infinity"}function Fa(i={}){return i.allowLiteralUndefined=i.allowLiteralUndefined??!1,i.allowExtraKeys=i.allowExtraKeys??!1,e=>{if(!pi(e))return"expected an object";if(i.allowLiteralUndefined===!1){for(let[t,n]of Object.entries(e))if(n===void 0)return`${t} is explicitly set to undefined but should be missing instead`}if(i.objSchema!==void 0){if(i.allowExtraKeys===!1){let t=Object.keys(e),n=Object.keys(i.objSchema),r=t.filter(s=>n.indexOf(s)===-1);if(r.length>0)return`object has extra keys not in the schema: ${r.join(", ")}`}for(let[t,n]of Object.entries(i.objSchema)){let r=n(e[t]);if(r!==null)return`${t}: ${r}`}}return null}}const{codec:va}=ul,Ba={chars:"abcdefghijklmnopqrstuvwxyz234567",bits:5};function on(i){return"b"+va.stringify(i,Ba,{pad:!1})}function mr(i){if(!i.startsWith("b"))throw new $("can't decode base32 string - it should start with a 'b'. "+i);if(i[i.length-1]==="=")throw new $("can't decode base32 string - it contains padding characters ('=')");return va.parse(i.slice(1),Ba,{loose:!0})}var wt;(function(i){i[i.None=-1]="None",i[i.Error=0]="Error",i[i.Warn=1]="Warn",i[i.Log=2]="Log",i[i.Info=3]="Info",i[i.Debug=4]="Debug"})(wt||(wt={}));const Gl=wt.Error;let Nr={_default:Gl};function Zl(i){return i in Nr?Nr[i]:Nr._default}class $e{constructor(e,t){Object.defineProperty(this,"source",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.source=e,this.color=t||"aqua"}_print(e,t,n,...r){if(e<=Zl(this.source))if(t){const s=`[${this.source}]`;if(this.color!==void 0){const u=[`%c ${s}`,`color: ${this.color}`];console.log(n,...u,...r)}else console.log(n,s,...r)}else console.log(n,...r)}error(...e){this._print(wt.Error,!0,"!!",...e)}warn(...e){this._print(wt.Warn,!0,"! ",...e)}log(...e){this._print(wt.Log,!0,"  ",...e)}info(...e){this._print(wt.Info,!0,"    ",...e)}debug(...e){this._print(wt.Debug,!0,"      ",...e)}blank(){this._print(wt.Info,!1,"")}}class Yl{constructor(e){Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalDigest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.hash=e.hash,this.internalUpdate=e.update,this.internalDigest=e.digest}update(e){return this.hash=this.internalUpdate(this.hash,e),this.hash}digest(){return this.internalDigest(this.hash)}}const{createHash:jr}=bl,Lr=new $e("crypto-driver-noble","cyan"),Xl=class{static sha256(i){return typeof i=="string"?Promise.resolve(jr("sha256").update(i,"utf-8").digest()):Promise.resolve(jr("sha256").update(i).digest())}static updatableSha256(){return new Yl({hash:jr("sha256"),update:(i,e)=>i.update(e),digest:i=>i.digest()})}static async generateKeypairBytes(){Lr.debug("generateKeypairBytes");const i=yr.randomPrivateKey();return{pubkey:await Tl(i),secret:i}}static sign(i,e){return Lr.debug("sign"),typeof e=="string"&&(e=Gr(e)),Pl(e,i.secret)}static async verify(i,e,t){Lr.debug("verify");try{return typeof t=="string"&&(t=Gr(t)),await Il(e,t,i)}catch{return!1}}};function Gi(){return Date.now()*1e3}function Sa(i){return new Promise(e=>{Vt(e,i)})}function Et(){return""+Math.floor(Math.random()*1e3)+Math.floor(Math.random()*1e3)}function Jl(i){try{const e=Ta(i)?i.address:i.shareAddress,t=Yr(e);if(M(t))return t;const n={pubkey:mr(t.pubkey),secret:mr(i.secret)};return n.pubkey.length!==32?new $(`pubkey bytes should be 32 bytes long, not ${n.pubkey.length} after base32 decoding.  ${e}`):n.secret.length!==32?new $(`secret bytes should be 32 bytes long, not ${n.secret.length} after base32 decoding.  ${i.secret}`):n}catch(e){return new $("crash while decoding author keypair: "+e.message)}}function Ta(i){return"address"in i}new $e("crypto","cyan");let ln=Xl,$n=new $e("crypto","cyan");const we=class{static async sha256base32(i){const e=await ln.sha256(i);return on(e)}static updatableSha256(){return ln.updatableSha256()}static async generateAuthorKeypair(i){$n.debug(`generateAuthorKeypair("${i}")`);const e=await ln.generateKeypairBytes(),t={address:Kl(i,on(e.pubkey)),secret:on(e.secret)},n=di(t.address);return M(n)?n:t}static async generateShareKeypair(i){$n.debug(`generateAuthorKeypair("${i}")`);const e=await ln.generateKeypairBytes(),t={shareAddress:Vl(i,on(e.pubkey)),secret:on(e.secret)},n=xt(t.shareAddress);return M(n)?n:t}static async sign(i,e){$n.debug("sign");try{const t=Jl(i);if(M(t))return t;const n=await ln.sign(t,e);return on(n)}catch(t){return new $("unexpected error while signing: "+t.message)}}static verify(i,e,t){$n.debug("verify");try{const n=Yr(i);return M(n)?Promise.resolve(!1):ln.verify(mr(n.pubkey),mr(e),t)}catch{return Promise.resolve(!1)}}static async checkKeypairIsValid(i){$n.debug("checkAuthorKeypairIsValid");const e=Ta(i)?i.address:i.shareAddress;try{if(typeof e!="string"||typeof i.secret!="string")return new $("address and secret must be strings");const t=Yr(e);if(M(t))return t;const n="a test message to sign. "+Et(),r=await this.sign(i,n);return M(r)?r:await this.verify(e,r,n)===!1?new $("pubkey does not match secret"):!0}catch(t){return new $("unexpected error in checkAuthorKeypairIsValid: "+t.message)}}};var Ur;new $e("validator es.4","red");const ec=10,tc=ec*60*1e3*1e3,Zi=1e13,Yi=9007199254740990,nc=4e6,rc=53,ic=104,Xi={objSchema:{format:ka("es.4"),author:He({allowedChars:ba}),content:He({maxLen:nc}),contentHash:He({allowedChars:Ct,len:rc}),deleteAfter:Hn({min:Zi,max:Yi,nullable:!0}),path:He({allowedChars:ya,minLen:2,maxLen:512}),signature:He({allowedChars:Ct,len:ic}),timestamp:Hn({min:Zi,max:Yi}),workspace:He({allowedChars:_a})},allowLiteralUndefined:!1,allowExtraKeys:!1};Ur=class{static hashDocument(i){const e={...i,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},t=this._checkBasicDocumentValidity(e);return M(t)?Promise.resolve(t):we.sha256base32(`author	${i.author}
contentHash	${i.contentHash}
`+(i.deleteAfter===null?"":`deleteAfter	${i.deleteAfter}
`)+`format	${i.format}
path	${i.path}
timestamp	${i.timestamp}
workspace	${i.workspace}
`)}static async generateDocument({input:i,keypair:e,share:t,timestamp:n}){const r={format:"es.4",author:e.address,content:i.content,contentHash:await we.sha256base32(i.content),deleteAfter:i.deleteAfter??null,path:i.path,timestamp:n,workspace:t,signature:"?"},s=await this.signDocument(e,r);return M(s)?s:{doc:s}}static async signDocument(i,e){const t=await this.hashDocument(e);if(M(t))return t;const n=await we.sign(i,t);return M(n)?n:{...e,signature:n}}static async wipeDocument(i,e){if(e.content.length===0)return e;const t=this.removeExtraFields(e);if(M(t))return t;const r={...t.doc,content:"",contentHash:await we.sha256base32(""),signature:"?"};return this.signDocument(i,r)}static removeExtraFields(i){if(!pi(i))return new $("doc is not a plain javascript object");const e=new Set(Object.keys(Xi.objSchema||{})),t={},n={};for(const[r,s]of Object.entries(i))if(e.has(r))t[r]=s;else{if(!r.startsWith("_"))return new $("extra document fields must have names starting with an underscore");n[r]=s}return{doc:t,extras:n}}static async checkDocumentIsValid(i,e){e===void 0&&(e=Date.now()*1e3);const t=this._checkBasicDocumentValidity(i);if(M(t))return t;const n=this._checkTimestampIsOk(i.timestamp,i.deleteAfter,e);if(M(n))return n;const r=this._checkAuthorCanWriteToPath(i.author,i.path);if(M(r))return r;const s=this._checkPathIsValid(i.path,i.deleteAfter);if(M(s))return s;const u=di(i.author);if(M(u))return u;const a=xt(i.workspace);if(M(a))return a;const o=await this._checkAuthorSignatureIsValid(i);if(M(o))return o;const l=await this._checkContentMatchesHash(i.content,i.contentHash);return M(l)?l:!0}static _checkBasicDocumentValidity(i){const e=Fa(Xi)(i);return e!==null?new $(e):!0}static _checkAuthorCanWriteToPath(i,e){return e.indexOf("~")===-1||e.indexOf("~"+i)!==-1?!0:new $(`author ${i} can't write to path ${e}`)}static _checkTimestampIsOk(i,e,t){if(i>t+tc)return new $("timestamp too far in the future");if(e!==null){if(t>e)return new $("ephemeral doc has expired");if(e<=i)return new $("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(i,e){if(!i.startsWith("/"))return new $("invalid path: must start with /");if(i.endsWith("/"))return new $("invalid path: must not end with /");if(i.startsWith("/@"))return new $('invalid path: must not start with "/@"');if(i.indexOf("//")!==-1)return new $("invalid path: must not contain two consecutive slashes");if(e!==void 0){if(i.indexOf("!")===-1&&e!==null)return new $("when deleteAfter is set, path must contain '!'");if(i.indexOf("!")!==-1&&e===null)return new $("when deleteAfter is null, path must not contain '!'")}return!0}static async _checkAuthorSignatureIsValid(i){try{const e=await this.hashDocument(i);return M(e)?e:await we.verify(i.author,i.signature,e)!==!0?new $("signature is invalid"):!0}catch{return new $("signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(i,e){return await we.sha256base32(i)!==e?new $("content does not match contentHash"):!0}static getAttachmentInfo(i){return new $("es.4 does not support attachments")}static updateAttachmentFields(i,e,t,n){return Promise.resolve(new $("es.4 does not support attachments"))}static authorFromCredentials(i){return i.address}},Object.defineProperty(Ur,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.4"});var zr;new $e("validator es.5","red");const sc=10,uc=sc*60*1e3*1e3,Ji=1e13,es=9007199254740990,ac=8e3,ts=53,ns=104,oc=0,lc=Number.MAX_SAFE_INTEGER,rs={objSchema:{format:ka("es.5"),author:He({allowedChars:ba}),text:He({maxLen:ac}),textHash:He({allowedChars:Ct,len:ts}),deleteAfter:Hn({min:Ji,max:es,optional:!0}),path:He({allowedChars:ya,minLen:2,maxLen:512}),signature:He({allowedChars:Ct,len:ns}),shareSignature:He({allowedChars:Ct,len:ns}),timestamp:Hn({min:Ji,max:es}),share:He({allowedChars:_a}),attachmentSize:Hn({min:oc,max:lc,optional:!0}),attachmentHash:He({allowedChars:Ct,len:ts,optional:!0})},allowLiteralUndefined:!1,allowExtraKeys:!1},cc=(zr=class{static hashDocument(i){const e={...i,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",shareSignature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},t=this._checkBasicDocumentValidity(e);return M(t)?Promise.resolve(t):we.sha256base32((i.attachmentHash===void 0?"":`attachmentHash	${i.attachmentHash}
`)+(i.attachmentSize===void 0?"":`attachmentSize	${i.attachmentSize}
`)+`author	${i.author}
`+(i.deleteAfter===void 0?"":`deleteAfter	${i.deleteAfter}
`)+`format	${i.format}
path	${i.path}
textHash	${i.textHash}
timestamp	${i.timestamp}
share	${i.share}
`)}static async generateDocument({input:i,keypair:e,share:t,timestamp:n,prevLatestDoc:r,config:s}){if(i.text===void 0&&(r==null?void 0:r.text)===void 0)return new $("Couldn't determine document text from given input or previous version's text.");const u=i.text!==void 0?i.text:r==null?void 0:r.text,a={...r,format:"es.5",author:e.address,text:u,textHash:await we.sha256base32(u),path:i.path,timestamp:n,share:t,signature:"?",shareSignature:"?"};i.deleteAfter&&(a.deleteAfter=i.deleteAfter);const o=await this.signDocument(e,a,s);return M(o)?o:i.attachment?{doc:o,attachment:i.attachment}:{doc:o}}static async signDocument(i,e,t){const n=await this.hashDocument(e);if(M(n))return n;const r=await we.sign(i,n);if(t.shareSecret===void 0)return new Le(`Tried to write a document to ${e.share} without the secret.`);const s=await we.sign({shareAddress:e.share,secret:t.shareSecret},n);return M(r)?r:M(s)?s:{...e,signature:r,shareSignature:s}}static async wipeDocument(i,e,t){if(e.text.length===0)return e;const n=this.removeExtraFields(e);if(M(n))return n;const r=n.doc;if(r.attachmentHash){const u={...r,text:"",textHash:await we.sha256base32(""),signature:"?",shareSignature:"?",attachmentHash:await we.sha256base32(""),attachmentSize:0};return this.signDocument(i,u,t)}const s={...r,text:"",textHash:await we.sha256base32(""),signature:"?",shareSignature:"?"};return this.signDocument(i,s,t)}static removeExtraFields(i){if(!pi(i))return new $("doc is not a plain javascript object");const e=new Set(Object.keys(rs.objSchema||{})),t={},n={};for(const[r,s]of Object.entries(i))if(e.has(r))t[r]=s;else{if(!r.startsWith("_"))return new $("extra document fields must have names starting with an underscore");n[r]=s}return{doc:t,extras:n}}static async checkDocumentIsValid(i,e){e===void 0&&(e=Date.now()*1e3);const t=this._checkBasicDocumentValidity(i);if(M(t))return t;const n=this._checkTimestampIsOk(i.timestamp,i.deleteAfter?i.deleteAfter:null,e);if(M(n))return n;const r=this._checkAuthorCanWriteToPath(i.author,i.path);if(M(r))return r;const s=this._checkAttachmentFieldsConsistent(i);if(M(s))return s;const u=this._checkPathIsValid(i.path,!!i.attachmentHash,i.deleteAfter);if(M(u))return u;const a=di(i.author);if(M(a))return a;const o=xt(i.share);if(M(o))return o;const l=await this._checkAuthorSignatureIsValid(i);if(M(l))return l;const c=await this._checkShareSignatureIsValid(i);if(M(c))return c;const f=await this._checkContentMatchesHash(i.text,i.textHash);return M(f)?f:!0}static _checkBasicDocumentValidity(i){const e=Fa(rs)(i);return e!==null?new $(e):!0}static _checkAttachmentFieldsConsistent(i){return i.text.length===0&&i.attachmentSize&&i.attachmentSize>0?new $("Documents with attachments must have text."):(i.text.length>0&&i.attachmentSize&&i.attachmentSize,i.attachmentHash&&i.attachmentSize===void 0?new $("Attachment size is undefined while attachment hash is defined"):i.attachmentSize&&i.attachmentHash===void 0?new $("Attachment hash is undefined while attachment size is defined"):!0)}static _checkAuthorCanWriteToPath(i,e){return e.indexOf("~")===-1||e.indexOf("~"+i)!==-1?!0:new $(`author ${i} can't write to path ${e}`)}static _checkTimestampIsOk(i,e,t){if(i>t+uc)return new $("timestamp too far in the future");if(e!==null){if(t>e)return new $("ephemeral doc has expired");if(e<=i)return new $("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(i,e,t){if(!i.startsWith("/"))return new $("invalid path: must start with /");if(i.endsWith("/"))return new $("invalid path: must not end with /");if(i.startsWith("/@"))return new $('invalid path: must not start with "/@"');if(i.indexOf("//")!==-1)return new $("invalid path: must not contain two consecutive slashes");if(t!==void 0){if(i.indexOf("!")===-1&&t!==null)return new $("when deleteAfter is set, path must contain '!'");if(i.indexOf("!")!==-1&&t===null)return new $("when deleteAfter is null, path must not contain '!'")}return!is(i)&&e?new $("when a attachment is provided, the path must end with a file extension"):is(i)&&e===!1?new $("when no attachment is provided, the path cannot end with a file extension"):!0}static async _checkAuthorSignatureIsValid(i){try{const e=await this.hashDocument(i);return M(e)?e:await we.verify(i.author,i.signature,e)!==!0?new $("signature is invalid"):!0}catch{return new $("signature is invalid (unexpected exception)")}}static async _checkShareSignatureIsValid(i){try{const e=await this.hashDocument(i);return M(e)?e:await we.verify(i.share,i.shareSignature,e)!==!0?new $("share signature is invalid"):!0}catch{return new $("share signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(i,e){return await we.sha256base32(i)!==e?new $("content does not match contentHash"):!0}static getAttachmentInfo(i){return i.attachmentHash&&i.attachmentSize===0?new $("This document has had its attachment wiped"):!i.attachmentHash||!i.attachmentSize?new $("This document has no attachment."):{size:i.attachmentSize,hash:i.attachmentHash}}static updateAttachmentFields(i,e,t,n,r){const s={...e,attachmentHash:n,attachmentSize:t};return this.signDocument(i,s,r)}static authorFromCredentials(i){return i.address}},Object.defineProperty(zr,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.5"}),zr),fc=/^.*\.(\w+)$/,hc=/^.*~@\w{4}\.\w{53}$/;function is(i){if(i.indexOf(".")===-1)return!1;const e=i.match(fc);return!(e===null||e[1].length===53&&i.match(hc))}const st=cc,Ar=[st];function ss(i){return i||st}function yn(i){return i||Ar}function dc(i,e){const t=[];for(const n of e)i.includes(n.id)&&t.push(n);return t}function An(i){const e=i||Ar,t={};for(const n of e)t[n.id]=n;return t}class Cr{constructor(){Object.defineProperty(this,"deferreds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"pending"})}resolve(e){if(this.state==="pending"){this.state="fulfilled";for(const t of this.deferreds)t.resolve(e)}}reject(e){if(this.state==="pending"){this.state="rejected";for(const t of this.deferreds)t.reject(e)}}getPromise(){const e=Y();return this.state==="fulfilled"?e.resolve():this.state==="rejected"?e.reject():this.deferreds.add(e),e}}class Vn{constructor(e=!1){Object.defineProperty(this,"promises",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"sealed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"multiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new Cr}),Object.defineProperty(this,"allowRejectedPromises",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.allowRejectedPromises=e}enrol(e){if(this.sealed)throw new Le("Tried to enrol a promise when enrolment was already sealed.");this.promises.add(e),e.then(()=>{this.checkAllDone()}).catch(t=>{if(!this.allowRejectedPromises)throw t})}checkAllDone(){this.sealed&&(this.allowRejectedPromises?Promise.allSettled(this.promises).then(()=>{this.multiDeferred.resolve()}):Promise.all(this.promises).then(()=>{this.multiDeferred.resolve()}).catch(()=>{this.multiDeferred.reject()}))}seal(){this.sealed||(this.sealed=!0,this.checkAllDone())}isSealed(){return this.sealed}isDone(){return this.multiDeferred.getPromise()}}class pc{constructor(){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"transform",{enumerable:!0,configurable:!0,writable:!0,value:new kn({transform(e,t){t.enqueue(e)}})}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:this.transform.writable.getWriter()}),Object.defineProperty(this,"readable",{enumerable:!0,configurable:!0,writable:!0,value:this.transform.readable}),Object.defineProperty(this,"writables",{enumerable:!0,configurable:!0,writable:!0,value:[]})}checkClosed(){if(this.closed)throw"Closed"}getWritableStream(){this.checkClosed();const e=this.writer,t=new Ge({async write(n){await e.ready,await e.write(n)}});return this.writables.push(t),t}async close(){this.checkClosed();for(const e of this.writables)await e.abort();this.transform.writable.abort(),this.closed=!0}isClosed(){return this.closed}}class Dc{constructor(){Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:new kn(new bc)}),Object.defineProperty(this,"sourceReadable",{enumerable:!0,configurable:!0,writable:!0,value:this.transformStream.readable}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:this.transformStream.writable})}getReadableStream(){const[e,t]=this.sourceReadable.tee();return this.sourceReadable=e,t}}class mc{checkClosed(){if(this.closed)throw"Closed"}constructor(){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"subscribers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"writables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=this.subscribers;this.writable=new Ge({write(t){const n=e.map(({writer:r})=>new Promise(s=>{r.ready.then(()=>{r.write(t).then(s)})}));Promise.all(n)}})}getReadableStream(){this.checkClosed();const e=new kn({transform(t,n){n.enqueue(t)}});return this.subscribers.push({transform:e,writer:e.writable.getWriter()}),e.readable}async close(){this.checkClosed();for(const e of this.writables)await e.abort();for(const{transform:e}of this.subscribers)await e.writable.abort(),await e.readable.cancel();this.closed=!0}isClosed(){return this.closed}}class gc{checkClosed(){if(this.closed)throw"Closed"}constructor(e){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineStream",{enumerable:!0,configurable:!0,writable:!0,value:new pc}),Object.defineProperty(this,"cloneStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e?this.cloneStream=new mc:this.cloneStream=new Dc,this.combineStream.readable.pipeTo(this.cloneStream.writable)}getWritableStream(){return this.combineStream.getWritableStream()}getReadableStream(){return this.cloneStream.getReadableStream()}close(){this.checkClosed(),this.combineStream.close(),this.closed=!0}isClosed(){return this.closed}}class Pa{constructor(){Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set})}onWrite(e){return this.callbacks.add(e),()=>{this.callbacks.delete(e)}}async write(e){for(const t of this.callbacks)await t(e)}close(){this.callbacks.clear()}}class nn{constructor(){Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"lock",{enumerable:!0,configurable:!0,writable:!0,value:new Ia})}on(e){return this.callbacks.add(e),()=>{this.callbacks.delete(e)}}async send(e){for(const t of this.callbacks)await this.lock.run(()=>t(e))}}class bc{transform(e,t){t.enqueue(e)}}class Ia{constructor(){Object.defineProperty(this,"doneEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new Vn}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:new Ge({async write(e){await e()}})}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:this.writable.getWriter()}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1})}checkClosed(){if(this.closed)throw"Closed"}async run(e){this.checkClosed(),await this.writer.ready;const t=this.writer.write(e);return this.doneEnroller.enrol(t),t}async close(){this.checkClosed(),this.doneEnroller.seal(),await this.doneEnroller.isDone(),this.writer.releaseLock(),await this.writable.abort(),this.closed=!0}isClosed(){return this.closed}}class wc{constructor(e,t){Object.defineProperty(this,"channel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.channel=e,this.channelKey=t}transform(e,t){if(this.channel==="*"||this.channel===e[this.channelKey]){t.enqueue(e);return}}}class _c{constructor(e,t){Object.defineProperty(this,"multistream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.multistream=new gc(t),this.channelKey=e}getWritableStream(){return this.multistream.getWritableStream()}getReadableStream(e){const t=new kn(new wc(e,this.channelKey));return this.multistream.getReadableStream().pipeThrough(t)}}function yc(i,e){const t=Y(),n=Y(),r=()=>{if(n.state==="pending"){let s;i instanceof _n?s=i:s=new _n(i),n.resolve(s),s.binaryType="arraybuffer",s.readyState===s.OPEN&&t.resolve(),s.onopen=()=>{t.resolve()}}};return new Ge({async write(s,u){r();const a=await n;await t;try{const o=e(s);a.send(o)}catch(o){u.error(o)}a.onclose=()=>{u.error("Socket closed before we were done")}},async close(){r();const s=await n;await t,s.close()},async abort(){r();const s=await n;await t,s.close()}})}function Ac(i,e){const t=Y();let n=!1;const r=()=>{if(t.state==="pending")if(i instanceof _n)t.resolve(i);else try{const s=new _n(i);t.resolve(s)}catch(s){t.reject(s)}};return new Gt({async start(s){r();const u=await t;u.binaryType="arraybuffer",u.onmessage=a=>{const o=e(a);try{s.enqueue(o)}catch{}},u.onclose=()=>{if(!n)try{s.close()}catch{}},u.onerror=a=>{n=!0,s.error(a)}},async cancel(){r(),(await t).close()}})}function Cc(i){let t=i.toString(16);return t.length%2&&(t="0"+t),t}function Ec(i){return BigInt("0x"+i)}const kc={EMPTY_SET:"emptySet",LOWER_BOUND:"lowerBound",PAYLOAD:"payload",EMPTY_PAYLOAD:"emptyPayload",DONE:"done",FINGERPRINT:"fingerprint",TERMINAL:"terminal"},Fc={encode:{emptySet:i=>({type:"EMPTY_SET",canRespond:i}),lowerBound:i=>({type:"LOWER_BOUND",value:i}),payload:(i,e)=>({type:"PAYLOAD",payload:i,...e?{end:e}:{}}),emptyPayload:i=>({type:"EMPTY_PAYLOAD",upperBound:i}),done:i=>({type:"DONE",upperBound:i}),fingerprint:(i,e)=>({type:"FINGERPRINT",fingerprint:Cc(i),upperBound:e}),terminal:()=>({type:"TERMINAL"})},decode:{getType:i=>kc[i.type],emptySet:i=>{if(i.type==="EMPTY_SET")return i.canRespond;throw"Can't decode"},lowerBound:i=>{if(i.type==="LOWER_BOUND")return i.value;throw"Can't decode"},payload:i=>{if(i.type==="PAYLOAD")return{value:i.payload,...i.end?{end:i.end}:{}};throw"Can't decode"},emptyPayload:i=>{if(i.type==="EMPTY_PAYLOAD")return i.upperBound;throw"Can't decode"},done:i=>{if(i.type==="DONE")return i.upperBound;throw"Can't decode"},fingerprint:i=>{if(i.type==="FINGERPRINT")return{fingerprint:Ec(i.fingerprint),upperBound:i.upperBound};throw"Can't decode"},terminal:i=>{if(i.type==="TERMINAL")return!0;throw"Can't decode"}}};class vc extends Ll{constructor(e,t,n){super({tree:e,encoding:Fc,fingerprintEquals:(r,s)=>r===s,payloadThreshold:t,rangeDivision:n})}}class Bc{sendEvent(e){return this.inboundEventQueue.push(e)}events(){return this.outboundEventQueue}getStatus(){return{requestedCount:this.requestedCount,receivedCount:this.receivedDocsCount,sentCount:this.sentDocsCount,status:this.isDoneMultiDeferred.state==="rejected"?"aborted":this.hasPrepared.state==="pending"?"preparing":this.hasReconciled.state==="pending"?"reconciling":this.isDoneMultiDeferred.state==="fulfilled"?"done":"gossiping"}}constructor(e){Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new nn}),Object.defineProperty(this,"isDoneMultiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new Cr}),Object.defineProperty(this,"inboundEventQueue",{enumerable:!0,configurable:!0,writable:!0,value:new At}),Object.defineProperty(this,"outboundEventQueue",{enumerable:!0,configurable:!0,writable:!0,value:new At}),Object.defineProperty(this,"gossiperInboundQueue",{enumerable:!0,configurable:!0,writable:!0,value:new At}),Object.defineProperty(this,"reconcilerInboundQueue",{enumerable:!0,configurable:!0,writable:!0,value:new At}),Object.defineProperty(this,"hasPrepared",{enumerable:!0,configurable:!0,writable:!0,value:Y()}),Object.defineProperty(this,"hasReconciled",{enumerable:!0,configurable:!0,writable:!0,value:Y()}),Object.defineProperty(this,"hasCheckedAllExistingDocsForAttachments",{enumerable:!0,configurable:!0,writable:!0,value:Y()}),Object.defineProperty(this,"requestedCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sentDocsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"receivedDocsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"counterpartId",{enumerable:!0,configurable:!0,writable:!0,value:Et()}),Object.defineProperty(this,"replica",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.replica=e.replica,e.replica.onEvent(u=>{u.kind==="willClose"&&this.cancel()});const{treeIsReady:t}=e.syncerManager.getDocThumbnailTreeAndDocLookup(e.replica.share,yn(e.formats));t.then(()=>{this.hasPrepared.resolve()}),(async()=>{for await(const u of this.inboundEventQueue)switch(u.kind){case"RANGE_MSG":{this.reconcilerInboundQueue.push(u.message);break}default:this.gossiperInboundQueue.push(u)}})(),new Pc({outboundEventQueue:this.outboundEventQueue,formats:e.formats,replica:e.replica,counterpartId:this.counterpartId,transferManager:e.transferManager,hasCheckedAllExistingDocsForAttachments:this.hasCheckedAllExistingDocsForAttachments});const n=new Ic,r=new Tc({inboundEventQueue:this.reconcilerInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:e.syncerManager,formats:e.formats,replica:e.replica,initiateMessaging:e.initiateMessaging,wantTracker:n,payloadThreshold:e.payloadThreshold,rangeDivision:e.rangeDivision,onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}});r.isDone.then(()=>{this.hasReconciled.resolve()}),new Sc({inboundEventQueue:this.gossiperInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:e.syncerManager,formats:e.formats,replica:e.replica,counterpartId:this.counterpartId,transferManager:e.transferManager,cancel:this.cancel.bind(this),reconciliationIsDone:r.isDone,wantTracker:n,syncAppetite:e.syncAppetite,onDocReceived:async()=>{this.receivedDocsCount++,await this.statusBus.send(this.getStatus())},onDocSent:async()=>{this.sentDocsCount++,await this.statusBus.send(this.getStatus())},onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}}).isDone.then(async()=>{await this.hasCheckedAllExistingDocsForAttachments,this.isDoneMultiDeferred.resolve()}),this.statusBus.send(this.getStatus())}onStatusUpdate(e){return this.statusBus.on(e)}async cancel(e){this.isDoneMultiDeferred.state==="fulfilled"||this.isDoneMultiDeferred.state==="rejected"||(this.isDoneMultiDeferred.reject(),await this.statusBus.send(this.getStatus()),this.outboundEventQueue.push({kind:"ABORT"}),this.outboundEventQueue.close(),this.inboundEventQueue.close({immediately:!0}),this.gossiperInboundQueue.close({immediately:!0}),this.reconcilerInboundQueue.close({immediately:!0}))}isDone(){return this.isDoneMultiDeferred.getPromise()}}class Sc{constructor(e){Object.defineProperty(this,"isPartnerFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:Y()}),Object.defineProperty(this,"isFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:Y()});const t=An(e.formats),n=e.syncerManager.getPlumTree(e.replica.share);if(e.syncAppetite==="continuous"){const u=e.replica.getQueryStream(void 0,"new",e.formats),a=new hi;u.pipeTo(new Ge({async write(o){if(o.kind==="success"&&o.sourceId!==e.counterpartId){const l=n.getMode(o.sourceId);a.reset(),a.update(`${o.doc.path} ${o.doc.author}`);const c=a.digest().toString(16),f=`${o.doc.timestamp} ${c}`;if(l==="EAGER"){const h=t[o.doc.format],d=h.getAttachmentInfo(o.doc),p=!M(d);let D=!1;p&&await e.replica.getAttachment(o.doc,h)&&(D=!0),e.outboundEventQueue.push({kind:"DOC",thumbnail:f,doc:o.doc,attachmentHeld:D}),e.onDocSent()}else e.outboundEventQueue.push({kind:"HAVE",thumbnail:f})}}})).catch(()=>{})}const r=e.replica.onEvent(u=>{u.kind==="attachment_ingest"&&u.sourceId!==e.counterpartId&&e.outboundEventQueue.push({kind:"NEW_ATTACHMENT",path:u.doc.path,author:u.doc.author,format:u.doc.format,hash:u.hash})}),{lookup:s}=e.syncerManager.getDocThumbnailTreeAndDocLookup(e.replica.share,yn(e.formats));(async()=>{for await(const u of e.inboundEventQueue)switch(u.kind){case"PRUNE":{n.onPrune(e.counterpartId);break}case"HAVE":{if(e.reconciliationIsDone.state==="fulfilled"&&e.syncAppetite==="once")break;e.wantTracker.addWantedThumbnail(u.thumbnail),n.onLazyMessage(u,a=>{e.outboundEventQueue.push({kind:"WANT",thumbnail:a})}),e.onDocRequested();break}case"WANT":{n.onGraftMessage(e.counterpartId);const[,a]=u.thumbnail.split(" "),o=s[a];if(!o)return;const[,l,c]=o,h=(await e.replica.getAllDocsAtPath(l,e.formats)).find(d=>d.author===c);if(h){const d=t[h.format],p=d.getAttachmentInfo(h),D=!M(p);let g=!1;D&&await e.replica.getAttachment(h,d)&&(g=!0),e.outboundEventQueue.push({kind:"DOC",thumbnail:u.thumbnail,doc:h,attachmentHeld:g}),await e.onDocSent()}else console.error("Got a WANT event for a document not on record.");break}case"DOC":{if(this.isFulfilled.state==="fulfilled"&&e.syncAppetite==="once"||(n.onEagerMessage(e.counterpartId,u)&&e.outboundEventQueue.push({kind:"PRUNE"}),e.wantTracker.isReceived(u.thumbnail)))break;const o=t[u.doc.format];if(!o){console.error(`Was sent a doc with a format we don't know about (${u.doc.format})`);break}if(u.attachmentHeld&&await e.replica.getAttachment(u.doc,t[u.doc.format])===void 0){const c=await e.transferManager.handleDownload(u.doc,e.replica,e.counterpartId);if(M(c)){const f=o.getAttachmentInfo(u.doc);e.transferManager.registerExpectedTransfer(e.replica.share,f.hash),e.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:f.hash,doc:u.doc,shareAddress:e.replica.share})}}await e.replica.ingest(o,u.doc,e.counterpartId),e.wantTracker.receivedWantedThumbnail(u.thumbnail),await e.onDocReceived();break}case"NEW_ATTACHMENT":{if(e.transferManager.isAlreadyQueued(u.hash,"download"))break;const a=t[u.format],l=(await e.replica.getAllDocsAtPath(u.path,[a])).find(f=>u.author===f.author);if(!l)break;if(await e.replica.getAttachment(l,t[l.format])===void 0){const f=await e.transferManager.handleDownload(l,e.replica,e.counterpartId);if(M(f)){const h=a.getAttachmentInfo(l);e.transferManager.registerExpectedTransfer(e.replica.share,h.hash),e.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:h.hash,doc:l,shareAddress:e.replica.share})}}break}case"FULFILLED":this.isPartnerFulfilled.resolve(!0);break;case"WANT_ATTACHMENT":e.transferManager.handleUpload(u,e.replica);break;case"ABORT":await e.cancel()}})(),e.reconciliationIsDone.then(async()=>{e.syncAppetite==="once"&&(r(),e.wantTracker.seal(),await e.wantTracker.isDone(),e.outboundEventQueue.push({kind:"FULFILLED"}),this.isFulfilled.resolve())})}get isDone(){return Promise.all([this.isPartnerFulfilled,this.isFulfilled])}}class Tc{constructor(e){Object.defineProperty(this,"communicationRoundsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isDone",{enumerable:!0,configurable:!0,writable:!0,value:Y()});const{tree:t,lookup:n,treeIsReady:r}=e.syncerManager.getDocThumbnailTreeAndDocLookup(e.replica.share,yn(e.formats));e.initiateMessaging&&r.then(()=>{for(const u of s.initialMessages(a=>{const o=Date.now()-6048e5,l=a.findIndex(f=>{const[h]=f.split(" ");return parseInt(h)/1e3>o});if(l>0&&l>a.length/2)return[a.slice(0,l),a.slice(l)];const c=Math.round(a.length/2);return[a.slice(0,c),a.slice(c)]}))e.outboundEventQueue.push({kind:"RANGE_MSG",message:u})});const s=new vc(t,e.payloadThreshold,e.rangeDivision);s.onInsertion(u=>{const[a,o]=u.split(" "),l=n[o];l&&l[0]>=parseInt(a)||(e.wantTracker.addWantedThumbnail(u),e.outboundEventQueue.push({kind:"WANT",thumbnail:u}),e.onDocRequested())}),(async()=>{await r;for await(const u of e.inboundEventQueue){if(this.isDone.state==="fulfilled")return;u.type==="TERMINAL"&&this.communicationRoundsCount++;const a=s.respond(u);for(const o of a)e.outboundEventQueue.push({kind:"RANGE_MSG",message:o})}})(),s.isDone().then(()=>{this.isDone.resolve(this.communicationRoundsCount)})}}class Pc{constructor(e){const t=e.replica.getQueryStream({orderBy:"localIndex ASC"},"existing",e.formats),n=An(e.formats),r=e.transferManager.handleDownload.bind(e.transferManager);t.pipeTo(new Ge({start(s){e.replica.onEvent(u=>{u.kind==="willClose"&&s.error()})},async write(s){if(s.kind==="existing"||s.kind==="success"){const u=n[s.doc.format],a=await e.replica.getAttachment(s.doc,u);if(M(a))return;if(a===void 0){const o=await r(s.doc,e.replica,e.counterpartId);if(M(o)){const l=u.getAttachmentInfo(s.doc);e.transferManager.registerExpectedTransfer(e.replica.share,l.hash),e.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:l.hash,doc:s.doc,shareAddress:e.replica.share})}}}}})).then(()=>{e.hasCheckedAllExistingDocsForAttachments.resolve()}).catch(()=>{e.hasCheckedAllExistingDocsForAttachments.resolve()})}}class Ic{constructor(){Object.defineProperty(this,"isSealed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"wantedThumbnails",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"enroller",{enumerable:!0,configurable:!0,writable:!0,value:new Vn}),Object.defineProperty(this,"received",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:Et()})}addWantedThumbnail(e){if(!this.isSealed&&!this.wantedThumbnails.has(e)){const t=Y();this.wantedThumbnails.set(e,t),this.enroller.enrol(t)}}receivedWantedThumbnail(e){const t=this.wantedThumbnails.get(e);t&&(t.resolve(),this.received++)}isRequested(e){return this.wantedThumbnails.has(e)}isReceived(e){const t=this.wantedThumbnails.get(e);return t?t.state==="fulfilled":!1}seal(){this.enroller.seal()}isDone(){return this.enroller.isDone()}get requestedCount(){return this.wantedThumbnails.size}get receivedCount(){return this.received}}class Ra{constructor(e,t){Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.cb=e,this.ms=t,this.timeout=Vt(e,t)}bump(){this.closed||(clearTimeout(this.timeout),this.timeout=Vt(this.cb,this.ms))}close(){this.closed=!0,clearTimeout(this.timeout)}}const xa=1e4;class Hr{constructor({stream:e,replica:t,doc:n,format:r,requester:s,counterpartId:u}){Object.defineProperty(this,"kind",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:"ready"}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"expectedSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sourceDoc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new nn}),Object.defineProperty(this,"transferOp",{enumerable:!0,configurable:!0,writable:!0,value:Y()}),Object.defineProperty(this,"abortCb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new Cr}),Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"requester",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.sourceDoc=n,this.share=t.share,this.requester=s;const a=r.getAttachmentInfo(n);if(M(a))throw new $("AttachmentTransfer was given a doc which has no attachment!");this.hash=a.hash,this.expectedSize=a.size;const o=this.updateLoaded.bind(this);if(e instanceof Gt){this.kind="download";let l;this.abortCb=()=>{l?l.cancel():e.cancel()};let c=null;const f=new Gt({async start(h){const d=e.getReader();for(l=d,c=new Ra(()=>{h.error("Attachment download timed out.")},xa);;){const{done:p,value:D}=await d.read();if(c.bump(),p)break;o(D.byteLength),h.enqueue(D)}c.close(),h.close()}});this.transferOp.resolve(()=>{const h=Y();return t.ingestAttachment(r,n,f,u).then(d=>{if(M(d)&&this.loaded===0){this.changeStatus("missing_attachment");return}if(M(d)){console.warn(`Couldn't ingest the attachment for ${n.path} by ${n.author}: ${d.message}`),h.reject(d);return}h.resolve()}).catch(d=>{h.reject(d)}),h})}else this.kind="upload",this.abortCb=()=>{e.abort().catch(()=>{})},t.getAttachment(n,r).then(async l=>{if(!l){await this.changeStatus("missing_attachment"),await e.abort();return}if(M(l)){await this.changeStatus("failed"),await e.abort();return}const c=new kn({transform(f,h){o(f.byteLength),h.enqueue(f)}});this.transferOp.resolve(()=>l.stream().then(f=>f.pipeThrough(c).pipeTo(e)))})}async start(){if(this.status!=="ready")return;const e=await this.transferOp;await this.changeStatus("in_progress"),e().then(async()=>{await this.changeStatus("complete")}).catch(async()=>{await this.changeStatus("failed")})}updateLoaded(e){this.loaded+=e,this.statusBus.send({status:this.status,bytesLoaded:this.loaded,totalBytes:this.expectedSize})}async changeStatus(e){this.status==="complete"||this.status==="failed"||this.status==="missing_attachment"||(this.status=e,await this.statusBus.send({status:e,bytesLoaded:this.loaded,totalBytes:this.expectedSize}),e==="complete"&&this.multiDeferred.resolve(),e==="failed"&&this.multiDeferred.reject("Attachment transfer failed"),e==="missing_attachment"&&this.multiDeferred.reject("The other peer does not have this attachment"))}get doc(){return this.sourceDoc}onProgress(e){return this.statusBus.on(e)}abort(){this.abortCb()}isDone(){return this.multiDeferred.getPromise()}}class Rc{constructor(e){Object.defineProperty(this,"waiting",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"active",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"failed",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"completed",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"activeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transfersRequestedByUsEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new Vn(!0)}),Object.defineProperty(this,"reports",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"reportBus",{enumerable:!0,configurable:!0,writable:!0,value:new nn}),this.activeLimit=e}async activate(e){this.active.add(e),e.isDone().then(()=>{this.completed.add(e)}).catch(()=>{this.failed.add(e)}).finally(()=>{this.active.delete(e),this.admitNext()}),await e.start()}queue(e){this.waiting.push(e)}admitNext(){if(this.waiting.length===0||this.active.size>=this.activeLimit)return;const e=this.waiting.shift();e&&this.activate(e)}async addTransfer(e){e.onProgress(()=>{this.updateTransferStatus(e)}),e.requester==="us"&&this.transfersRequestedByUsEnroller.enrol(e.isDone()),this.active.size<this.activeLimit?await this.activate(e):this.queue(e)}gotAllTransfersRequestedByUs(){this.transfersRequestedByUsEnroller.seal()}cancel(){this.transfersRequestedByUsEnroller.seal();for(const e of this.active)e.abort()}updateTransferStatus(e){this.reports[e.share]||(this.reports[e.share]={}),this.reports[e.share][e.hash+e.kind]={author:e.doc.author,path:e.doc.path,format:e.doc.format,hash:e.hash,kind:e.kind,status:e.status,bytesLoaded:e.loaded,totalBytes:e.expectedSize},this.reportBus.send(this.getReport())}getReport(){const e={};for(const t in this.reports){const n=[],r=this.reports[t];for(const s in r){const u=r[s];n.push(u)}e[t]=n}return e}hasQueuedTransfer(e,t){for(const n of this.waiting)if(n.hash===e&&n.kind===t)return!0;for(const n of this.active)if(n.hash===e&&n.kind===t)return!0;for(const n of this.completed)if(n.hash===e&&n.kind===t)return!0;return!1}onReportUpdate(e){return this.reportBus.on(e)}transfersRequestedByUsFinished(){return this.transfersRequestedByUsEnroller.isDone()}}class xc{constructor(e){Object.defineProperty(this,"partner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"otherSyncerId",{enumerable:!0,configurable:!0,writable:!0,value:Y()}),Object.defineProperty(this,"receivedAllExpectedTransfersEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new Vn}),Object.defineProperty(this,"madeAllAttachmentRequestsEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new Vn(!0)}),Object.defineProperty(this,"formatsLookup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reportDidUpdateBus",{enumerable:!0,configurable:!0,writable:!0,value:new nn}),Object.defineProperty(this,"expectedTransferPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.partner=e.partner,this.queue=new Rc(this.partner.concurrentTransfers),this.formats=e.formats,this.formatsLookup=An(this.formats),this.queue.onReportUpdate(async t=>{await this.reportDidUpdateBus.send(t)}),this.madeAllAttachmentRequestsEnroller.isDone().then(()=>{this.receivedAllExpectedTransfersEnroller.seal()}),this.receivedAllExpectedTransfersEnroller.isDone().then(()=>{this.queue.gotAllTransfersRequestedByUs()})}registerSyncAgent(e){this.madeAllAttachmentRequestsEnroller.enrol(e.isDone())}allSyncAgentsKnown(){this.madeAllAttachmentRequestsEnroller.seal()}registerExpectedTransfer(e,t){const n=`${e}_${t}`;if(this.expectedTransferPromises.has(n))return;const r=Y();this.expectedTransferPromises.set(n,r),this.receivedAllExpectedTransfersEnroller.enrol(r)}async queueTransfer(e){this.queue.hasQueuedTransfer(e.hash,e.kind)||await this.queue.addTransfer(e)}async handleDownload(e,t,n){const r=this.formatsLookup[e.format],s=r.getAttachmentInfo(e);if(M(s))throw new Le("TransferManager: attempted to download doc with no attachment.");const u=await this.partner.getDownload({doc:e,shareAddress:t.share,syncerId:await this.otherSyncerId,attachmentHash:s.hash});if(u===void 0)return"no_attachment";if(M(u))return u;const a=new Hr({replica:t,doc:e,format:r,stream:u,requester:"us",counterpartId:n});return await this.queueTransfer(a),"queued"}async handleUpload(e,t){const n=this.formatsLookup[e.doc.format];if(!await t.getAttachment(e.doc,n))return!1;const s=await this.partner.handleUploadRequest({shareAddress:e.shareAddress,syncerId:await this.otherSyncerId,doc:e.doc,attachmentHash:e.attachmentHash});if(M(s))return!1;try{const u=new Hr({doc:e.doc,format:n,replica:t,stream:s,requester:"them",counterpartId:"unused"});await this.queueTransfer(u)}catch{return!1}return!0}async handleTransferRequest({replica:e,path:t,author:n,source:r,kind:s,formatName:u,counterpartId:a}){const o=await this.partner.handleTransferRequest(r,s);if(o===void 0||M(o))return;const l=An(this.formats)[u];if(!l)return;const f=(await e.getAllDocsAtPath(t,[l])).find(d=>d.author===n);if(!f)return;const h=new Hr({doc:f,format:l,replica:e,stream:o,requester:s==="upload"?"us":"them",counterpartId:a});if(h.requester==="us"){const d=`${h.share}_${h.hash}`,p=this.expectedTransferPromises.get(d);p&&p.resolve()}await this.queueTransfer(h)}cancel(){this.queue.cancel()}getReport(){return this.queue.getReport()}onReportUpdate(e){return this.reportDidUpdateBus.on(e)}transfersRequestedByUsFinished(){return this.queue.transfersRequestedByUsFinished()}registerOtherSyncerId(e){this.otherSyncerId.resolve(e)}isAlreadyQueued(e,t){return this.queue.hasQueuedTransfer(e,t)}}class Oa{constructor(e){Object.defineProperty(this,"peer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:Et()}),Object.defineProperty(this,"manager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"syncAgents",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"syncAgentQueues",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"appetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new nn}),Object.defineProperty(this,"formats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transferManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partnerIsFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:Y()}),Object.defineProperty(this,"isDoneMultiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new Cr}),Object.defineProperty(this,"heartbeatInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bumpingTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.manager=e.manager,this.peer=e.manager.peer,this.appetite=e.partner.syncAppetite,this.formats=yn(e.formats),this.partner=e.partner,this.transferManager=new xc({partner:this.partner,formats:this.formats}),this.transferManager.onReportUpdate(async()=>{await this.statusBus.send(this.getStatus())}),this.heartbeatInterval=br(()=>{this.partner.sendEvent({kind:"HEARTBEAT"})},1e3),(async()=>{try{for await(const n of e.partner.getEvents())this.handleIncomingEvent(n)}catch(n){this.cancel(n||"Partner disconnected")}})();const t=Et();Promise.all(this.peer.shares().map(n=>rr(t,n))).then(n=>{this.partner.sendEvent({kind:"DISCLOSE",salt:t,syncerId:this.id,shares:n,formats:this.formats?this.formats.map(r=>r.id):[st.id],canRespond:!1})}),this.transferManager.transfersRequestedByUsFinished().then(async()=>{e.partner.syncAppetite!=="continuous"&&(await this.partner.sendEvent({kind:"SYNCER_FULFILLED"}),await this.partnerIsFulfilled,clearInterval(this.heartbeatInterval),await this.partner.closeConnection(),this.bumpingTimeout.close(),this.isDoneMultiDeferred.resolve())}),this.peer.onReplicasChange(async n=>{if(this.appetite==="once")return;const r=Array.from(n.keys());for(const[u,a]of this.syncAgents)r.includes(u)===!1&&(await a.cancel("Replica was removed from peer."),this.syncAgents.delete(u));const s=Et();Promise.all(r.map(u=>rr(s,u))).then(u=>{this.partner.sendEvent({kind:"DISCLOSE",salt:s,syncerId:this.id,shares:u,formats:this.formats?this.formats.map(a=>a.id):[st.id],canRespond:!0})})}),this.bumpingTimeout=new Ra(()=>{this.cancel("No communication from the other peer in the last three seconds.")},xa)}addShare(e,t,n){if(this.syncAgents.has(e))return;const r=this.peer.getReplica(e);if(!r){console.error("Couldn't get the replica for a share we had in common.");return}const s=new Bc({replica:r,formats:t,syncerManager:this.manager,transferManager:this.transferManager,initiateMessaging:n,payloadThreshold:this.partner.payloadThreshold,rangeDivision:this.partner.rangeDivision,syncAppetite:this.appetite});s.onStatusUpdate(()=>{this.statusBus.send(this.getStatus())}),this.syncAgents.set(e,s),this.transferManager.registerSyncAgent(s);const u=this.syncAgentQueues.get(e);let a;if(u)a=u;else{const o=new At;a=o,this.syncAgentQueues.set(e,o)}(async()=>{for await(const o of a)s.sendEvent(o)})(),(async()=>{for await(const o of s.events())this.partner.sendEvent({to:e,...o})})()}async handleIncomingEvent(e){switch(this.bumpingTimeout.bump(),e.kind){case"DISCLOSE":{const t=dc(e.formats,this.formats);if(t.length===0)break;const n=new Set(e.shares),r=new Set,s=new Set;for(const a of this.peer.shares()){const o=await rr(e.salt,a);n.has(o)?r.add(a):s.add(a)}const u=this.id>e.syncerId;for(const a of r)this.addShare(a,t,u);for(const a of s){const o=this.syncAgents.get(a);o&&(o.cancel("No longer in common with the other peer."),this.syncAgents.delete(a))}if(this.transferManager.registerOtherSyncerId(e.syncerId),this.appetite==="once"&&this.transferManager.allSyncAgentsKnown(),e.canRespond){const a=Et();Promise.all(this.peer.shares().map(o=>rr(a,o))).then(o=>{this.partner.sendEvent({kind:"DISCLOSE",salt:a,syncerId:this.id,shares:o,formats:this.formats?this.formats.map(l=>l.id):[st.id],canRespond:!1})})}r.size===0&&this.appetite==="once"&&this.partner.sendEvent({kind:"SYNCER_FULFILLED"});break}case"SYNCER_FULFILLED":{this.partnerIsFulfilled.resolve();break}case"HEARTBEAT":break;default:{const{to:t}=e,n=this.syncAgentQueues.get(t);if(!n){const r=new At;r.push(e),this.syncAgentQueues.set(t,r);break}n.push(e)}}}getStatus(){const e={};for(const[t,n]of this.syncAgents)e[t]={docs:n.getStatus(),attachments:this.transferManager.getReport()[t]||[]};return e}onStatusChange(e){return this.statusBus.on(e)}async cancel(e){this.bumpingTimeout.close(),this.isDoneMultiDeferred.reject(e);for(const[t,n]of this.syncAgents)await n.cancel();clearInterval(this.heartbeatInterval),this.transferManager.cancel(),await this.partner.closeConnection()}handleTransferRequest({shareAddress:e,path:t,author:n,source:r,kind:s,formatName:u}){if(this.isDoneMultiDeferred.state==="rejected")return;const a=this.peer.getReplica(e);if(!a)return;let o="unused";if(s==="upload"){const l=this.syncAgents.get(e);l&&(o=l.counterpartId)}return this.transferManager.handleTransferRequest({replica:a,author:n,formatName:u,kind:s,path:t,source:r,counterpartId:o})}isDone(){return this.isDoneMultiDeferred.getPromise()}}function rr(i,e){return we.sha256base32(i+e+i)}class Oc{constructor(e,t,n,r){Object.defineProperty(this,"concurrentTransfers",{enumerable:!0,configurable:!0,writable:!0,value:1024}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"syncAppetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outgoingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new At}),Object.defineProperty(this,"incomingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new At}),Object.defineProperty(this,"partnerPeer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partnerSyncer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.syncAppetite=n,this.partnerPeer=e;const{incomingQueue:s,outgoingQueue:u}=this;this.partnerSyncer=new Oa({manager:e.syncerManager,formats:r,partner:{syncAppetite:n,getEvents(){return s},sendEvent(a){return u.push(a),Promise.resolve()},concurrentTransfers:1024,payloadThreshold:32,rangeDivision:32,async getDownload(a){const o=t.getReplica(a.shareAddress);if(!o)throw new $("Tried to get a receiving transfer for an unknown share.");const l=await o.replicaDriver.attachmentDriver.getAttachment(a.doc.format,a.attachmentHash);if(l&&!M(l))return await l.stream()},closeConnection(){return u.close(),Promise.resolve()},handleUploadRequest(a){return Promise.resolve(new Un("PartnerLocal does not support uploads."))},handleTransferRequest(a,o){return Promise.resolve(new Un("PartnerLocal does not support transfer requests."))}}})}getEvents(){return this.outgoingQueue}sendEvent(e){return this.incomingQueue.push(e),Promise.resolve()}closeConnection(){return this.incomingQueue.close(),Promise.resolve()}async getDownload(e){const t=this.partnerPeer.getReplica(e.shareAddress);if(!t)throw new $("Tried to get a receiving transfer for an unknown share.");const n=await t.replicaDriver.attachmentDriver.getAttachment(e.doc.format,e.attachmentHash);if(n&&!M(n))return await n.stream()}handleUploadRequest(e){return Promise.resolve(new Un("PartnerLocal does not support uploads."))}handleTransferRequest(e,t){return Promise.resolve(new Un("PartnerLocal does not support transfer requests."))}}class $c{constructor(e){Object.defineProperty(this,"syncAppetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"concurrentTransfers",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"isSecure",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wsUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"socket",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"incomingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new At}),Object.defineProperty(this,"socketIsReady",{enumerable:!0,configurable:!0,writable:!0,value:Y()}),this.syncAppetite=e.appetite;const t=new URL(e.url),n=`${t.host}${t.pathname==="/"?"":t.pathname}`;this.isSecure=t.protocol==="https:"||t.protocol==="wss:",this.wsUrl=`${this.isSecure?"wss://":"ws://"}${n}/'`;const r=new URL(e.appetite,this.wsUrl);this.socket=new _n(r.toString()),this.socket.onopen=()=>{this.socketIsReady.resolve()},this.socket.binaryType="arraybuffer",this.socket.onmessage=s=>{this.incomingQueue.push(JSON.parse(s.data))},this.socket.onclose=()=>{this.incomingQueue.close()},this.socket.onerror=s=>{if("error"in s){this.incomingQueue.close({withError:s.error});return}this.incomingQueue.close({withError:new Le("Websocket error.")})}}async sendEvent(e){if(await this.socketIsReady,!(this.socket.readyState===this.socket.CLOSED||this.socket.readyState===this.socket.CLOSING))return this.socket.send(JSON.stringify(e))}getEvents(){return this.incomingQueue}closeConnection(){return this.socket.close(),Promise.resolve()}getDownload(e){const t=new URL(`${e.syncerId}/download/${e.shareAddress}/${e.doc.format}/${e.doc.author}${e.doc.path}`,this.wsUrl),n=Ac(t.toString(),r=>r.data instanceof ArrayBuffer?new Uint8Array(r.data):null);return Promise.resolve(n)}handleUploadRequest(e){const t=new URL(`${e.syncerId}/upload/${e.shareAddress}/${e.doc.format}/${e.doc.author}${e.doc.path}`,this.wsUrl),n=yc(t.toString(),r=>r);return Promise.resolve(n)}handleTransferRequest(e,t){return Promise.resolve(new Un("SyncDriverWebClient does not support external transfer requests."))}}function Mc(i,e){const[t,n]=i.split(" "),[r,s]=e.split(" "),u=parseInt(t),a=parseInt(r);return u>a?1:u<a?-1:n>s?1:n<s?-1:0}const Nc={lift:i=>Ol(i),combine:(i,e)=>i+e,neutral:BigInt(0)};class jc extends Ml{constructor(){super(Nc,Mc)}}class Lc{constructor(){Object.defineProperty(this,"messagingModes",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"eagerMessageThumbnails",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"haveTimeouts",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}getMode(e){const t=this.messagingModes.get(e);if(t)return t;const n=this.messagingModes.size===0?"EAGER":"LAZY";return this.messagingModes.set(e,n),"EAGER"}onEagerMessage(e,t){const n=this.haveTimeouts.get(t.thumbnail);return n?(clearTimeout(n),!1):this.eagerMessageThumbnails.has(t.thumbnail)?(this.messagingModes.set(e,"LAZY"),!0):(this.eagerMessageThumbnails.add(t.thumbnail),!1)}onLazyMessage(e,t){if(!this.haveTimeouts.has(e.thumbnail)){const n=Vt(()=>{t(e.thumbnail)},5);this.haveTimeouts.set(e.thumbnail,n)}}onGraftMessage(e){this.messagingModes.set(e,"EAGER")}onPrune(e){this.messagingModes.set(e,"LAZY")}}class Uc{constructor(e){Object.defineProperty(this,"syncers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"syncerEventBus",{enumerable:!0,configurable:!0,writable:!0,value:new nn}),Object.defineProperty(this,"peer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docThumbnailTreeAndLookup",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"hasher",{enumerable:!0,configurable:!0,writable:!0,value:new hi}),Object.defineProperty(this,"plumTrees",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.peer=e}addPartner(e,t,n){const r=new Oa({manager:this,partner:e,formats:n});return this.syncers.set(r.id,{syncer:r,description:t}),this.syncerEventBus.send(this.syncers),r}getSyncers(){return this.syncers}getDocThumbnailTreeAndDocLookup(e,t){const n=t.map(h=>h.id),r=`${e} ${n}`,s=this.docThumbnailTreeAndLookup.get(r);if(s){const[h,d]=s;return{tree:h,lookup:d,treeIsReady:Promise.resolve(!0)}}const u=this.peer.getReplica(e);if(!u)throw new Le("A DocThumbnailTree was requested for a share the peer doesn't know about, big problem!");const a=this.hasher,o=u.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"everything",t),l=new jc,c={},f=Y();return o.pipeTo(new Ge({write(h){if(h.kind==="processed_all_existing"){f.resolve();return}a.reset(),a.update(`${h.doc.path} ${h.doc.author}`);const d=a.digest().toString(16),p=`${h.doc.timestamp} ${d}`;(h.kind==="existing"||h.kind==="success")&&(c[d]=[h.doc.timestamp,h.doc.path,h.doc.author],l.insert(p)),h.kind==="expire"&&(delete c[d],l.remove(p))}})),{tree:l,lookup:c,treeIsReady:f}}getPlumTree(e){const t=this.plumTrees.get(e);if(t)return t;const n=new Lc;return this.plumTrees.set(e,n),n}onSyncersChange(e){return this.syncerEventBus.on(e)}}const Lt=new $e("peer","orangeRed"),Mn=JSON.stringify;class Er{constructor(){Object.defineProperty(this,"replicaEventBus",{enumerable:!0,configurable:!0,writable:!0,value:new nn}),Object.defineProperty(this,"syncerManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicaMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Lt.debug("constructor"),this.syncerManager=new Uc(this)}hasShare(e){return this.replicaMap.has(e)}shares(){const e=[...this.replicaMap.keys()];return e.sort(),e}replicas(){const e=[...this.replicaMap.keys()];return e.sort(),e.map(t=>this.replicaMap.get(t))}size(){return this.replicaMap.size}getReplica(e){return this.replicaMap.get(e)}async addReplica(e){if(Lt.debug(`addReplica(${Mn(e.share)})`),this.replicaMap.has(e.share))throw Lt.debug("already had a replica with that share"),new Error(`Peer.addReplica: already has a replica with share ${Mn(e.share)}.  Don't add another one.`);this.replicaMap.set(e.share,e),await this.replicaEventBus.send(this.replicaMap),Lt.debug("    ...addReplica: done")}async removeReplicaByShare(e){Lt.debug(`removeReplicaByShare(${Mn(e)})`),this.replicaMap.delete(e),await this.replicaEventBus.send(this.replicaMap)}async removeReplica(e){const t=this.replicaMap.get(e.share);e===t?(Lt.debug(`removeReplica(${Mn(e.share)})`),await this.removeReplicaByShare(e.share)):Lt.debug(`removeReplica(${Mn(e.share)}) -- same share but it's a different instance now; ignoring`)}sync(e,t=!1,n){try{const r=new $c({url:e,appetite:t?"continuous":"once"});return this.syncerManager.addPartner(r,e,n)}catch{if(e instanceof Er){const r=new Oc(e,this,t?"continuous":"once",n);return this.syncerManager.addPartner(r,"Local",n)}console.error("Provided an invalid target for syncing to a peer:",e);return}}addSyncPartner(e,t,n){return this.syncerManager.addPartner(e,t,n)}getSyncers(){return this.syncerManager.getSyncers()}onReplicasChange(e){return this.replicaEventBus.on(e)}onSyncersChange(e){return this.syncerManager.onSyncersChange(e)}}const zc={historyMode:"latest",orderBy:"path ASC",startAfter:void 0,limit:void 0,filter:void 0,formats:["es.5"]},Ut=new $e("query","green");function $a(i){var r,s,u,a;const e={...zc,...i},t={query:{limit:0},isValid:!1,willMatch:"nothing"};if(e.limit!==void 0&&e.limit<0)return Ut.debug("cleanUpQuery: unreasonable limit - returning empty invalid query",t),t;if((r=e.orderBy)!=null&&r.startsWith("path")&&((s=e.startAfter)==null?void 0:s.localIndex)!==void 0)return Ut.debug('cleanUpQuery: orderBy is "path" but startAfter is not compatible - returning empty invalid query',t),t;if((u=e.orderBy)!=null&&u.startsWith("localIndex")&&((a=e.startAfter)==null?void 0:a.path)!==void 0)return Ut.debug('cleanUpQuery: orderBy is "localIndex" but startAfter is not compatible - returning empty invalid query',t),t;if(e.historyMode!==void 0&&e.historyMode!=="all"&&e.historyMode!=="latest")return Ut.debug(`cleanUpQuery: unknown historyMode ${JSON.stringify(e.historyMode)} - returning empty invalid query`,t),t;if(e.orderBy!==void 0&&["path ASC","path DESC","localIndex ASC","localIndex DESC"].indexOf(e.orderBy)===-1)return Ut.debug(`cleanUpQuery: unrecognized orderBy value ${JSON.stringify(e.orderBy)} - returning empty invalid query`,t),t;let n=e.historyMode==="all"?"all":"all-latest";if(e.filter!==void 0&&!pr(e.filter,{})&&(n="some"),e.startAfter!==void 0&&!pr(e.startAfter,{})&&(n="some"),e.limit!==void 0&&(e.limit>0&&(n="some"),e.limit===0&&(n="nothing")),e.filter!==void 0){const o=e.filter;o.path&&o.pathStartsWith&&!o.path.startsWith(o.pathStartsWith)&&(n="nothing"),o.path&&o.pathEndsWith&&!o.path.endsWith(o.pathEndsWith)&&(n="nothing"),o.timestamp&&o.timestampGt&&!(o.timestamp>o.timestampGt)&&(n="nothing"),o.timestamp&&o.timestampLt&&!(o.timestamp<o.timestampLt)&&(n="nothing"),o.timestampGt&&o.timestampLt&&!(o.timestampLt+1<o.timestampGt)&&(n="nothing")}if(n==="nothing"){let o={query:{limit:0},isValid:!0,willMatch:"nothing"};return Ut.debug("cleanUpQuery - this query will match nothing, so returning a simpler query that also matches nothing",o),o}return Ut.debug(`cleanUpQuery - query is ok!  willMatch = ${n}`),{query:e,isValid:!0,willMatch:n}}function Di(i,e){return!(e.path!==void 0&&i.path!==e.path||e.pathStartsWith!==void 0&&!i.path.startsWith(e.pathStartsWith)||e.pathEndsWith!==void 0&&!i.path.endsWith(e.pathEndsWith)||e.author!==void 0&&i.author!==e.author||e.timestamp!==void 0&&i.timestamp!==e.timestamp||e.timestampGt!==void 0&&!(i.timestamp>e.timestampGt)||e.timestampLt!==void 0&&!(i.timestamp<e.timestampLt))}new $e("query helpers","gold");var Ve;(function(i){i[i.LT=-1]="LT",i[i.EQ=0]="EQ",i[i.GT=1]="GT"})(Ve||(Ve={}));function Xr(i,e,t="ASC"){if(Array.isArray(i)&&aa(i,e)||typeof i=="object"&&pr(i,e)||i===e)return Ve.EQ;if(t==="ASC"||t===void 0)return i<e?Ve.LT:Ve.GT;if(t==="DESC")return i>e?Ve.LT:Ve.GT;throw new Error("unexpected sort order to compareBasic: "+JSON.stringify(t))}function mi(i,e,t){let n=Math.min(i.length,e.length);for(let u=0;u<n;u++){let a=(t==null?void 0:t[u])??"ASC",o=Xr(i[u],e[u],a);if(o!==Ve.EQ)return o}if(i.length===e.length)return Ve.EQ;let r=Math.min(i.length,e.length),s=(t==null?void 0:t[r])??"ASC";return Xr(i.length,e.length,s)}function us(i,e="ASC"){return(t,n)=>Xr(t[i],n[i],e)}const Hc=JSON.stringify,Me=new $e("replica","gold"),Ne=new $e("replica set","gold"),xe=new $e("replica ingest","gold");function as(i,e){return mi([i.timestamp,i.signature],[e.timestamp,i.signature],["DESC","ASC"])}class qc{constructor({driver:e,config:t}){var r;Object.defineProperty(this,"replicaId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicaDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formatsConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isClosed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ingestLockStream",{enumerable:!0,configurable:!0,writable:!0,value:new Ia}),Object.defineProperty(this,"eventMultiStream",{enumerable:!0,configurable:!0,writable:!0,value:new _c("kind",!0)}),Object.defineProperty(this,"eventWriter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbackSink",{enumerable:!0,configurable:!0,writable:!0,value:new Pa}),Object.defineProperty(this,"eraseInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"expireEventTimeouts",{enumerable:!0,configurable:!0,writable:!0,value:new Map});const n=xt(e.docDriver.share);if(M(n))throw n;Me.debug(`constructor.  driver = ${(r=e==null?void 0:e.constructor)==null?void 0:r.name}`),this.replicaId="replica-"+Et(),this.share=e.docDriver.share,this.replicaDriver=e,this.formatsConfig=t||{},this.eventWriter=this.eventMultiStream.getWritableStream().getWriter(),this.eventMultiStream.getReadableStream("*").pipeTo(new Ge(this.callbackSink)),this.eraseInterval=br(()=>{this.isClosed()?clearInterval(this.eraseInterval):this.pruneExpiredDocsAndAttachments()},1e3*60*60)}isClosed(){return this._isClosed}async close(e){if(Me.debug("closing..."),this._isClosed)throw new me;await this.ingestLockStream.close();for(const t of this.expireEventTimeouts.values())clearTimeout(t);return Me.debug("    sending willClose blockingly..."),await this.eventWriter.write({kind:"willClose"}),Me.debug("    marking self as closed..."),e===!1&&await this.pruneExpiredDocsAndAttachments(),await this.replicaDriver.attachmentDriver.clearStaging(),this._isClosed=!0,Me.debug(`    closing ReplicaDriver (erase = ${e})...`),await this.replicaDriver.docDriver.close(e),await this.replicaDriver.attachmentDriver.close(e),clearInterval(this.eraseInterval),Me.debug("    sending didClose nonblockingly..."),await this.eventWriter.write({kind:"didClose"}),Me.debug("...closing done"),Promise.resolve()}async getConfig(e){if(this._isClosed)throw new me;return await this.replicaDriver.docDriver.getConfig(e)}async setConfig(e,t){if(this._isClosed)throw new me;return await this.replicaDriver.docDriver.setConfig(e,t)}async listConfigKeys(){if(this._isClosed)throw new me;return await this.replicaDriver.docDriver.listConfigKeys()}async deleteConfig(e){if(this._isClosed)throw new me;return await this.replicaDriver.docDriver.deleteConfig(e)}getMaxLocalIndex(){if(this._isClosed)throw new me;return this.replicaDriver.docDriver.getMaxLocalIndex()}getAllDocs(e){return Me.debug("getAllDocs()"),this.queryDocs({historyMode:"all",orderBy:"path ASC"},e)}getLatestDocs(e){return Me.debug("getLatestDocs()"),this.queryDocs({historyMode:"latest",orderBy:"path ASC"},e)}getAllDocsAtPath(e,t){return Me.debug(`getAllDocsAtPath("${e}")`),this.queryDocs({historyMode:"all",orderBy:"path ASC",filter:{path:e}},t)}async getLatestDocAtPath(e,t){Me.debug(`getLatestDocsAtPath("${e}")`);const n=await this.queryDocs({historyMode:"latest",orderBy:"path ASC",filter:{path:e}},t?[t]:void 0);if(n.length!==0)return n[0]}async queryDocs(e={},t){if(Me.debug("queryDocs",e),this._isClosed)throw new me;const n=yn(t);return await this.replicaDriver.docDriver.queryDocs({...e,formats:n.map(r=>r.id)})}async queryPaths(e={},t){const n=await this.queryDocs(e,t),r=new Set(n.map(({path:s})=>s));return Array.from(r).sort()}async queryAuthors(e={},t){const n=await this.queryDocs(e,t),r=new Set(n.map(({author:s})=>s));return Array.from(r).sort()}async set(e,t,n=st){if(Ne.debug("set",t),this._isClosed)throw new me;Ne.debug("...deciding timestamp: getting latest doc at the same path (from any author)");const r=await this.getLatestDocAtPath(t.path);let s;typeof t.timestamp=="number"?s=t.timestamp:r===void 0?s=Gi():s=Math.max(Gi(),r.timestamp+1),Ne.debug("...generating doc");let u;if(r){const l=n.removeExtraFields(r);M(l)||(u=l.doc)}const a=await n.generateDocument({keypair:e,input:{...t,format:n.id},share:this.share,timestamp:s,prevLatestDoc:u,config:this.formatsConfig[n.id]});if(M(a))return{kind:"failure",reason:"invalid_document",err:a};if(Ne.debug("...signature =",a.doc.signature),a.attachment){const l=await this.replicaDriver.attachmentDriver.stage(n.id,a.attachment);if(M(l))return{kind:"failure",reason:"invalid_document",err:l};const c=await n.updateAttachmentFields(e,a.doc,l.size,l.hash,this.formatsConfig[n.id]);if(M(c))return await l.reject(),{kind:"failure",reason:"invalid_document",err:c};Ne.debug("...ingesting attachment"),Ne.debug("-----------------------"),await l.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:c,hash:l.hash,size:l.size,sourceId:"local"}),Ne.debug("...done ingesting attachment"),Ne.debug("...ingesting"),Ne.debug("-----------------------");const f=await this.ingest(n,c,"local");return Ne.debug("...done ingesting"),Ne.debug("...set is done."),f}Ne.debug("...ingesting"),Ne.debug("-----------------------");const o=await this.ingest(n,a.doc,"local");return Ne.debug("...done ingesting"),Ne.debug("...set is done."),o}async ingest(e,t,n){if(xe.debug("ingest",t),this._isClosed)throw new me;xe.debug("...removing extra fields");const r=e.removeExtraFields(t);if(M(r))return{kind:"failure",reason:"invalid_document",err:r};t=r.doc;const s=r.extras;Object.keys(s).length>0&&xe.debug(`...extra fields found: ${Hc(s)}`);const u=await e.checkDocumentIsValid(t);if(M(u))return{kind:"failure",reason:"invalid_document",err:u};const a=Y();return await this.ingestLockStream.run(async()=>{xe.debug(" >> ingest: start of protected region"),xe.debug("  > getting other history docs at the same path by any author");const o=await this.getAllDocsAtPath(t.path,[e]);xe.debug(`  > ...got ${o.length}`),xe.debug("  > getting prevLatest and prevSameAuthor");const l=o[0]??null,c=o.filter(D=>D.author===t.author)[0]??null;xe.debug("  > checking if new doc is latest at this path"),o.push(t),o.sort(as);const f=o[0]===t;if(xe.debug(`  > ...isLatest: ${f}`),!f&&c!==null){xe.debug("  > new doc is not latest and there is another one from the same author...");const D=as(t,c);if(D===Ve.GT){xe.debug("  > new doc is GT prevSameAuthor, so it is obsolete"),a.resolve({kind:"nothing_happened",reason:"obsolete_from_same_author",doc:t});return}if(D===Ve.EQ){xe.debug("  > new doc is EQ prevSameAuthor, so it is redundant (already_had_it)"),a.resolve({kind:"nothing_happened",reason:"already_had_it",doc:t});return}}xe.debug("  > upserting into ReplicaDriver...");const h=await this.replicaDriver.docDriver.upsert(t);xe.debug("  > ...done upserting into ReplicaDriver"),xe.debug("  > ...getting ReplicaDriver maxLocalIndex...");const d=await this.replicaDriver.docDriver.getMaxLocalIndex();xe.debug(" >> ingest: end of protected region, returning a WriteEvent from the lock");const p={kind:"success",maxLocalIndex:d,doc:h,docIsLatest:f,prevDocFromSameAuthor:c,prevLatestDoc:l,sourceId:n};if(a.resolve(p),await this.eventWriter.write(p),h.deleteAfter){const D=`${h.path}|${h.author}`,g=this.expireEventTimeouts.get(D);g&&clearTimeout(g);const m=h.deleteAfter/1e3-Date.now();this.expireEventTimeouts.set(D,Vt(()=>{this.eventWriter.write({kind:"expire",doc:h})},m))}}),a}async overwriteAllDocsByAuthor(e,t){const n=ss(t);if(Me.debug(`overwriteAllDocsByAuthor("${e.address}")`),this._isClosed)throw new me;const r=await this.queryDocs({filter:{author:e.address},historyMode:"all"},[n]);Me.debug(`    ...found ${r.length} docs to overwrite`);let s=0,u=0;for(const a of r){const o=await this.wipeDocument(e,a,ss(t));if(M(o))return o;s+=1}return Me.debug(`    ...done; ${s} overwritten to be empty; ${u} were already empty; out of total ${r.length} docs`),s}async wipeDocAtPath(e,t,n=st){const r=await this.getLatestDocAtPath(t,n);return r?this.wipeDocument(e,r,n):new $("No document exists at that path")}async wipeDocument(e,t,n){const r={...t,timestamp:Math.max(t.timestamp+1,Date.now()*1e3),author:e.address},s=await n.wipeDocument(e,r,this.formatsConfig[n.id]);if(M(s))return{kind:"failure",err:s,reason:"invalid_document"};const u=await this.ingest(n,s,"local");if(u.kind==="success"){const a=n.getAttachmentInfo(t);if(!M(a)){const o=await this.replicaDriver.attachmentDriver.erase(n.id,a.hash);M(o)||await this.eventWriter.write({kind:"attachment_prune",format:n.id,hash:a.hash})}}return u}async pruneExpiredDocsAndAttachments(e=Ar){const t=await this.replicaDriver.docDriver.eraseExpiredDocs();for(const u of t)await this.eventWriter.write({kind:"expire",doc:u});const n=An(e),r={};await this.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"existing",e).pipeTo(new Ge({write(u){if(u.kind==="existing"){const a=n[u.doc.format],o=a.getAttachmentInfo(u.doc);if(!M(o)){const l=r[a.id];l?l.add(o.hash):r[a.id]=new Set([o.hash])}}}}));const s=await this.replicaDriver.attachmentDriver.filter(r);for(const u of s)await this.eventWriter.write({kind:"attachment_prune",format:u.format,hash:u.hash})}getEventStream(e="*"){return this.eventMultiStream.getReadableStream(e)}getQueryStream(e={},t,n){const r=this.queryDocs.bind(this),s=this.getEventStream.bind(this);return new Gt({async start(u){if(t==="existing"||t==="everything"){const l=await r(e,n);for(const c of l)u.enqueue({kind:"existing",doc:c})}if(u.enqueue({kind:"processed_all_existing"}),t==="existing"){u.close();return}const o=s().getReader();for(;;){const{done:l,value:c}=await o.read();if(l)return;if(c.kind==="expire"||c.kind==="success"){if(e.filter&&Di(c.doc,e.filter)){u.enqueue(c);continue}u.enqueue(c);continue}c.kind==="didClose"&&u.close()}}})}onEvent(e){return this.callbackSink.onWrite(e)}async ingestAttachment(e,t,n,r){if(this._isClosed)throw new me;const s=e.removeExtraFields(t);if(M(s))return Promise.resolve(s);t=s.doc;const u=await e.checkDocumentIsValid(t);if(M(u))return Promise.resolve(u);const a=await this.getAttachment(t,e);if(a&&!M(a))return!1;const o=e.getAttachmentInfo(t);if(M(o))return Promise.resolve(o);const l=await this.replicaDriver.attachmentDriver.stage(t.format,n);return M(l)?l:l.hash!==o.hash?(await l.reject(),new $("Attachment's hash did not match the document's")):l.size!==o.size?(await l.reject(),new $("Attachment's size did not match the document's")):(await l.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:t,hash:l.hash,size:l.size,sourceId:r}),!0)}getAttachment(e,t=st){if(e.deleteAfter&&e.deleteAfter<Date.now()*1e3)return Promise.resolve(new $("This document has expired"));const n=t.getAttachmentInfo(e);return M(n)?Promise.resolve(n):this.replicaDriver.attachmentDriver.getAttachment(e.format,n.hash)}addAttachments(e,t){const n=yn(t),r={};for(const u of n)r[u.id]=u;const s=e.map(u=>new Promise(a=>{const l=r[u.format].getAttachmentInfo(u);if(!M(l))this.replicaDriver.attachmentDriver.getAttachment(u.format,l.hash).then(c=>{a({...u,attachment:c})});else return a({...u,attachment:l})}));return Promise.all(s)}}class Wc extends qc{constructor(e){super({driver:e.driver,config:{"es.5":{shareSecret:e.shareSecret}}})}}const zt=new $e("replica-cache","green");function os({_localIndex:i}){return i}function ls(i,e){const t=[];for(const n of e)if(!(i.orderBy==="path ASC"&&i.startAfter!==void 0&&i.startAfter.path!==void 0&&n.path<=i.startAfter.path)&&!(i.orderBy==="path DESC"&&i.startAfter!==void 0&&i.startAfter.path!==void 0&&n.path>=i.startAfter.path)&&!(i.orderBy==="localIndex ASC"&&i.startAfter!==void 0&&i.startAfter.localIndex!==void 0&&(n._localIndex||0)<=i.startAfter.localIndex)&&!(i.orderBy==="localIndex DESC"&&i.startAfter!==void 0&&i.startAfter.localIndex!==void 0&&(n._localIndex||0)>=i.startAfter.localIndex)&&(t.push(n),i.limit!==void 0&&t.length>=i.limit))break;return t}class Qc{constructor(e,t,n){Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"replica",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"timeToLive",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onCacheUpdatedCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"onFireCacheUpdatedsWrapper",{enumerable:!0,configurable:!0,writable:!0,value:a=>a()}),Object.defineProperty(this,"attachmentCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.replica=e,this.timeToLive=t||1e3,n&&(this.onFireCacheUpdatedsWrapper=n);const r=this.onReplicaEvent.bind(this),s=this.close.bind(this),u=this.isClosed.bind(this);this.replica.getEventStream("*").pipeTo(new Ge({async write(a){a.kind==="attachment_ingest"||a.kind==="success"||a.kind==="expire"?await r(a):a.kind==="willClose"&&!u()&&await s()}})).catch(()=>{})}async close(){if(this.closed)throw new $t;this.closed=!0,await Promise.all(Array.from(this.docCache.values()).map(e=>e.close())),this.docCache.clear(),this.onCacheUpdatedCallbacks.clear()}isClosed(){return this.closed}getAllDocs(e){return this.queryDocs({historyMode:"all",orderBy:"path DESC"},e)}getLatestDocs(e){return this.queryDocs({historyMode:"latest",orderBy:"path DESC"},e)}getAllDocsAtPath(e,t){return this.queryDocs({historyMode:"all",orderBy:"path DESC",filter:{path:e}},t)}getLatestDocAtPath(e,t){const n=this.queryDocs({historyMode:"latest",orderBy:"path DESC",filter:{path:e}},t?[t]:void 0);if(n.length!==0)return n[0]}queryDocs(e={},t){if(this.closed)throw new $t;if(this.replica.isClosed())throw new me;const r={...e,formats:(t||Ar).map(p=>p.id)},s=$a(r);if(s.willMatch==="nothing")return[];const u=Ko(s.query),a=this.docCache.get(u);if(a)return Date.now()>a.expires&&this.replica.queryDocs(e,t).then(p=>{const D=p.map(os).sort(),g=a.docs.map(os).sort();aa(D,g)||(this.docCache.set(u,{stream:a.stream,close:a.close,docs:p,expires:Date.now()+this.timeToLive}),zt.debug("Updated cache because result expired."),this.fireOnCacheUpdateds())}),a.docs;const o=this.replica.getQueryStream(e,"new",t),l=new Pa,c=l.onWrite(p=>{(p.kind==="existing"||p.kind==="success")&&(zt.debug({doc:p.doc.path,queryString:u}),this._updateCache(u,p.doc))}),f=new Ge(l),h=new AbortController;o.pipeTo(f,{signal:h.signal});const d=()=>{c()};return this.docCache.set(u,{stream:o,docs:[],expires:Date.now()+this.timeToLive,close:d}),this.replica.queryDocs(r).then(p=>{this.docCache.set(u,{stream:o,close:d,docs:p,expires:Date.now()+this.timeToLive}),zt.debug("Updated cache with a new entry."),this.fireOnCacheUpdateds()}),[]}queryPaths(e={},t){const n=this.queryDocs(e,t),r=new Set(n.map(({path:s})=>s));return Array.from(r).sort()}queryAuthors(e={},t){const n=this.queryDocs(e,t),r=new Set(n.map(({author:s})=>s));return Array.from(r).sort()}_updateCache(e,t){const n=this.docCache.get(e);if(!n)return;const r=JSON.parse(e),s=()=>{const d=[...n.docs,t];this.docCache.set(e,{...n,docs:ls(r,d)}),this.fireOnCacheUpdateds()},u=({exact:d})=>{const p=n.docs.map(D=>d&&D.path===t.path&&D.author===t.author||!d&&D.path===t.path?t:D);this.docCache.set(e,{...n,docs:ls(r,p)}),this.fireOnCacheUpdateds()},a=n.docs.filter(d=>d.path===t.path),o=n.docs.filter(d=>d.path===t.path&&d.author===t.author);if(a.length===0){(r.filter&&Di(t,r.filter)||!r.filter)&&(zt.debug("Updated cache after appending a doc to a entry with matching filter."),s());return}if((r.historyMode||"latest")==="all"){if(o.length===0){zt.debug("Updated cache after appending a version of a doc to a historyMode: all query."),s();return}zt.debug("Updated cache after replacing a version of a doc in a historyMode: all query."),u({exact:!0});return}const c=a[0],f=t.author!==(c==null?void 0:c.author)||!pr(t,c),h=t.timestamp>c.timestamp;if(f&&h){zt.debug("Updated cache after replacing a doc with its latest version."),u({exact:!1});return}}fireOnCacheUpdateds(){this.version++,this.onFireCacheUpdatedsWrapper(()=>{this.onCacheUpdatedCallbacks.forEach(e=>{e()})})}onCacheUpdated(e){if(this.closed)throw new $t;if(this.replica.isClosed())throw new me;return this.onCacheUpdatedCallbacks.add(e),()=>{this.onCacheUpdatedCallbacks.delete(e)}}set(e,t,n){if(this.closed)throw new $t;return this.replica.set(e,t,n)}overwriteAllDocsByAuthor(e,t){if(this.closed)throw new $t;if(this.replica.isClosed())throw new me;return this.replica.overwriteAllDocsByAuthor(e,t)}wipeDocAtPath(e,t,n=st){if(this.closed)throw new $t;return this.replica.wipeDocAtPath(e,t,n)}async onReplicaEvent(e){const t=`${e.doc.path}|${e.doc.author}`,n=this.attachmentCache.get(t);if(!n)return;const r=await this.replica.getAttachment(e.doc,n.format);this.attachmentCache.set(t,{expires:Date.now()+this.timeToLive,attachment:r,format:n.format}),this.fireOnCacheUpdateds()}getAttachment(e,t=st){if(this.closed)throw new $t;if(this.replica.isClosed())throw new me;const n=t.getAttachmentInfo(e);if(M(n))return n;const r=`${e.path}|${e.author}`,s=this.attachmentCache.get(r);if(s)return Date.now()>s.expires&&this.replica.getAttachment(e,t).then(u=>{this.attachmentCache.set(r,{expires:Date.now()+this.timeToLive,attachment:u,format:t}),this.fireOnCacheUpdateds()}),e.deleteAfter&&Date.now()*1e3>e.deleteAfter?new $("This document has expired"):s.attachment;this.attachmentCache.set(r,{attachment:void 0,expires:Date.now()+this.timeToLive,format:t}),this.replica.getAttachment(e,t).then(u=>{this.attachmentCache.set(r,{expires:Date.now()+this.timeToLive,attachment:u,format:t}),this.fireOnCacheUpdateds()})}addAttachments(e,t){const n=[],r=An(t);for(const s of e){const u=this.getAttachment(s,r[s.format]);n.push({...s,attachment:u})}return n}}new $e("storage driver async memory","yellow");async function Kc(i){let e=new Uint8Array;return await i.pipeTo(new Ge({write(t){const n=new Uint8Array(e.length+t.length);n.set(e),n.set(t,e.length),e=n}})),e}const Vc="earthstar",ir="current_author",Nn="shares",jn="share_secrets",Ln="servers";class gi{constructor(e){Object.defineProperty(this,"namespace",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:localStorage}),Object.defineProperty(this,"authorChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"sharesChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"shareSecretsChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"serversChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),this.namespace=e==null?void 0:e.namespace,e!=null&&e.sessionOnly&&(this.storage=sessionStorage),addEventListener("storage",t=>{switch(t.key){case Fe(ir,this.namespace):{this.fireAuthorEvent();break}case Fe(Nn,this.namespace):{this.fireSharesEvent();break}case Fe(jn,this.namespace):{this.fireSecretsEvent();break}case Fe(Ln,this.namespace):{this.fireServersEvent();break}}})}get author(){const e=Fe(ir,this.namespace);return sr(this.storage,e,Gc)||null}set author(e){const t=Fe(ir,this.namespace);this.storage.setItem(t,JSON.stringify(e)),this.fireAuthorEvent()}get shares(){const e=Fe(Nn,this.namespace);return sr(this.storage,e,Zc)||[]}addShare(e){if(M(xt(e)))return new $("Not a valid share");const t=Fe(Nn,this.namespace),n=new Set([...this.shares,e]),r=Array.from(n);return this.storage.setItem(t,JSON.stringify(r)),this.fireSharesEvent(),r}removeShare(e){const t=this.shares,n=t.findIndex(s=>s===e);if(n===-1)return new $("That share is not known yet");t.splice(n,1);const r=Fe(Nn,this.namespace);return this.storage.setItem(r,JSON.stringify(t)),this.fireSharesEvent(),t}get shareSecrets(){const e=Fe(jn,this.namespace);return sr(this.storage,e,Yc)||{}}async addSecret(e,t){if(!this.shares.find(u=>e===u))return new $("This share is not yet known.");if(M(await we.checkKeypairIsValid({shareAddress:e,secret:t})))return new $("Not the right secret for this share.");const r=Fe(jn,this.namespace),s={...this.shareSecrets,[e]:t};return this.storage.setItem(r,JSON.stringify(s)),this.fireSecretsEvent(),s}removeSecret(e){const t=this.shareSecrets;if(!t[e])return new $("Unknown share");const r=Fe(jn,this.namespace),s={...t};return delete s[e],this.storage.setItem(r,JSON.stringify(s)),this.fireSecretsEvent(),s}get servers(){const e=Fe(Ln,this.namespace);return sr(this.storage,e,Xc)||[]}addServer(e){try{const t=new URL(e),n=new Set([...this.servers,t.toString()]),r=Array.from(n),s=Fe(Ln,this.namespace);return this.storage.setItem(s,JSON.stringify(r)),this.fireServersEvent(),r}catch{return new $("Not a valid URL.")}}removeServer(e){try{const t=new URL(e),n=this.servers,r=n.findIndex(u=>u===t.toString());if(r===-1)return new $("That server is not known yet");n.splice(r,1);const s=Fe(Ln,this.namespace);return this.storage.setItem(s,JSON.stringify(n)),this.fireServersEvent(),n}catch{return new $("Not a valid URL")}}clear(){const e=Fe(ir,this.namespace);this.storage.setItem(e,JSON.stringify(null));const t=Fe(Nn,this.namespace);this.storage.setItem(t,JSON.stringify([]));const n=Fe(jn,this.namespace);this.storage.setItem(n,JSON.stringify({}));const r=Fe(Ln,this.namespace);this.storage.setItem(r,JSON.stringify([])),this.fireAuthorEvent(),this.fireSharesEvent(),this.fireSecretsEvent(),this.fireServersEvent()}onAuthorChanged(e){return this.authorChangedCbs.add(e),()=>{this.authorChangedCbs.delete(e)}}onSharesChanged(e){return this.sharesChangedCbs.add(e),()=>{this.sharesChangedCbs.delete(e)}}onShareSecretsChanged(e){return this.shareSecretsChangedCbs.add(e),()=>{this.shareSecretsChangedCbs.delete(e)}}onServersChanged(e){return this.serversChangedCbs.add(e),()=>{this.serversChangedCbs.delete(e)}}getPeer({sync:e,onCreateReplica:t}){const n=new Er,r=this.shares;for(const l of r){const c=t(l,this.shareSecrets[l]);n.addReplica(c)}const s=this.onSharesChanged(async l=>{const c=n.replicas(),f=n.shares();for(const h of c)l.includes(h.share)||(n.removeReplica(h),await h.close(!1));for(const h of l)if(!f.includes(h)){const d=t(h,this.shareSecrets[h]);n.addReplica(d)}}),u=this.onShareSecretsChanged(async l=>{const c=n.shares(),f=Object.keys(l);for(const h of c)if(!f.includes(h)){const d=n.getReplica(h);d&&(n.removeReplica(d),d.close(!1));const p=t(h);n.addReplica(p)}for(const h of f){const d=n.getReplica(h);if(d!=null&&d.formatsConfig["es.5"]&&d.formatsConfig["es.5"].shareSecret)continue;await(d==null?void 0:d.close(!1)),n.removeReplicaByShare(h);const p=t(h,l[h]);n.addReplica(p)}});if(e)for(const l of this.servers)n.sync(l,e==="continuous");const a=this.onServersChanged(l=>{if(e){const c=n.getSyncers();for(const[f,{description:h,syncer:d}]of c)l.includes(h)||d.cancel();for(const f of l)n.sync(f,e==="continuous")}});return{peer:n,unsubscribeFromSettings:()=>{s(),u(),a()}}}fireAuthorEvent(){const e=this.author;for(const t of this.authorChangedCbs)t(e)}fireSharesEvent(){const e=this.shares;for(const t of this.sharesChangedCbs)t(e)}fireSecretsEvent(){const e=this.shareSecrets;for(const t of this.shareSecretsChangedCbs)t(e)}fireServersEvent(){const e=this.servers;for(const t of this.serversChangedCbs)t(e)}}function Fe(i,e){return`${Vc}:${e?`${e}:`:""}${i}`}function sr(i,e,t){const n=i.getItem(e);if(n!==null)try{const r=JSON.parse(n);return t(r)?r:void 0}catch{return}}function Ma(i){return!(i==null||typeof i!="object")}function Gc(i){return!(!Ma(i)||Object.keys(i).length!==2||!("address"in i)||!("secret"in i))}function Zc(i){return!(!Array.isArray(i)||i.some(e=>typeof e!="string")||i.some(e=>M(xt(e))))}function Yc(i){if(!Ma(i))return!1;for(const e in i){const t=i[e];if(typeof t!="string"||M(we.checkKeypairIsValid({shareAddress:e,secret:t})))return!1}return!0}function Xc(i){if(!Array.isArray(i)||i.some(e=>typeof e!="string"))return!1;for(const e of i)try{new URL(e)}catch{return!1}return!0}function Jc(i){const e=i-1;return e*e*e+1}function Cn(i,{delay:e=0,duration:t=400,easing:n=Jc,x:r=0,y:s=0,opacity:u=0}={}){const a=getComputedStyle(i),o=+a.opacity,l=a.transform==="none"?"":a.transform,c=o*(1-u);return{delay:e,duration:t,easing:n,css:(f,h)=>`
			transform: ${l} translate(${(1-f)*r}px, ${(1-f)*s}px);
			opacity: ${o-c*h}`}}const cn=[];function Xn(i,e){return{subscribe:bi(i,e).subscribe}}function bi(i,e=T){let t;const n=new Set;function r(a){if(te(i,a)&&(i=a,t)){const o=!cn.length;for(const l of n)l[1](),cn.push(l,i);if(o){for(let l=0;l<cn.length;l+=2)cn[l][0](cn[l+1]);cn.length=0}}}function s(a){r(a(i))}function u(a,o=T){const l=[a,o];return n.add(l),n.size===1&&(t=e(r)||T),a(i),()=>{n.delete(l),n.size===0&&(t(),t=null)}}return{set:r,update:s,subscribe:u}}function ef(i,e,t){const n=!Array.isArray(i),r=n?[i]:i,s=e.length<2;return Xn(t,u=>{let a=!1;const o=[];let l=0,c=T;const f=()=>{if(l)return;c();const d=e(n?o[0]:o,u);s?u(d):c=En(d)?d:T},h=r.map((d,p)=>$u(d,D=>{o[p]=D,l&=~(1<<p),a&&f()},()=>{l|=1<<p}));return a=!0,f(),function(){_e(h),c()}})}const It=bi({address:"",secret:""});new $e("storage driver localStorage","gold");const Ht=new $e("replica driver indexeddb","gold");function tf(i,e){return mi([i.path,i.timestamp,i.signature],[e.path,e.timestamp,i.signature],["ASC","DESC","ASC"])}function nf(i,e){return mi([i.path,i.timestamp,i.signature],[e.path,e.timestamp,i.signature],["DESC","DESC","ASC"])}const Qe="docs",tt="config";class rf{constructor(e,t){Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:Y()}),Object.defineProperty(this,"gotInitialMaxLocalIndex",{enumerable:!0,configurable:!0,writable:!0,value:Y()}),Object.defineProperty(this,"localMaxLocalIndex",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1});const n=xt(e);if(M(n))throw n;if(this.share=e,Ht.debug("constructor"),!window.indexedDB)throw new Le("IndexedDB is not supported by this runtime.");const r=ua.indexedDB.open(`earthstar:share_docs:${this.share}${t?`/${t}`:""}`,1);r.onerror=()=>{throw Ht.error(`Could not open IndexedDB for ${this.share}'s attachments.`),Ht.error(r.error),new Le(`Could not open IndexedDB for ${this.share}'s attachments.`)},r.onupgradeneeded=function(){const s=r.result,u=s.createObjectStore(Qe,{keyPath:["path","author"]});u.createIndex("comboIndex",["_localIndex","timestamp","path","author"],{unique:!0}),u.createIndex("pathTimestampIndex",["path","timestamp"],{unique:!1}),u.createIndex("pathAuthorIndex",["path","author"],{unique:!0}),u.createIndex("deleteAfterIndex","deleteAfter",{unique:!1}),u.createIndex("localIndexIndex","_localIndex",{unique:!0}),s.createObjectStore(tt,{keyPath:"key"}).createIndex("keyIndex",["key"],{unique:!0})},r.onsuccess=()=>{this.db.resolve(r.result);const u=r.result.transaction([Qe],"readonly").objectStore(Qe).index("localIndexIndex").openCursor(null,"prev");u.onsuccess=()=>{u.result?this.gotInitialMaxLocalIndex.resolve(u.result.value._localIndex):this.gotInitialMaxLocalIndex.resolve(-1)}},this.gotInitialMaxLocalIndex.then(s=>{this.localMaxLocalIndex=s})}isClosed(){return this.closed}async close(e){if(this.closed)throw new me;this.closed=!0;const t=Y();if(e){const r=(await this.db).transaction([Qe,tt],"readwrite"),s=Y(),u=Y(),a=r.objectStore(Qe).clear().onsuccess=()=>{s.resolve()},o=r.objectStore(tt).clear().onsuccess=()=>{u.resolve()};await Promise.all([a,o]),t.resolve()}else t.resolve();return(await this.db).close(),await Sa(20),t}async getMaxLocalIndex(){return await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex}async queryDocs(e){var c,f,h,d,p,D,g,m,E,B,F,v,x;const n=(await this.db).transaction([Qe],"readonly").objectStore(Qe),r=Y(),{query:s,willMatch:u}=$a(e);if(Ht.debug(`    cleanUpQuery.  willMatch = ${u}`),u==="nothing")return[];if((c=s.filter)!=null&&c.path&&s.historyMode==="latest"){const S=IDBKeyRange.bound([s.filter.path,s.filter.timestampGt||0],[s.filter.path,s.filter.timestampLt||Number.MAX_SAFE_INTEGER]),Q=n.index("pathTimestampIndex").openCursor(S,"prev");Q.onsuccess=()=>{var N;(N=Q.result)!=null&&N.value?r.resolve([Q.result.value]):r.resolve([])}}else if((f=s.filter)!=null&&f.path&&s.historyMode==="all"){const S=n.index("pathAuthorIndex"),R=IDBKeyRange.bound([s.filter.path," "],[s.filter.path,"~"]),Q=S.getAll(R);Q.onsuccess=()=>{Q.result?r.resolve(Array.from(Q.result)):r.resolve([])}}else{const S=((h=s.startAfter)==null?void 0:h.path)||((d=s.filter)==null?void 0:d.path)||((p=s.filter)==null?void 0:p.pathStartsWith)||" ",R=((D=s.filter)==null?void 0:D.author)||" ",Q=((g=s.filter)==null?void 0:g.timestamp)||((m=s.filter)==null?void 0:m.timestampGt)||0,N=((E=s.startAfter)==null?void 0:E.localIndex)||0,j=((B=s.filter)==null?void 0:B.path)||"~",O=((F=s.filter)==null?void 0:F.author)||"~",ie=((v=s.filter)==null?void 0:v.timestamp)||((x=s.filter)==null?void 0:x.timestampLt)||Number.MAX_SAFE_INTEGER,Ie=Number.MAX_SAFE_INTEGER,oe=IDBKeyRange.bound([N,Q,S,R],[Ie,ie,j,O]),Je=n.index("comboIndex").getAll(oe);Je.onsuccess=()=>{Je.result?r.resolve(Je.result):r.resolve([])}}const a=await r;if(s.historyMode==="latest"){const S=a.splice(0,a.length),R=new Map;for(const Q of S){const N=R.get(Q.path);(!N||N.timestamp<Q.timestamp)&&R.set(Q.path,Q)}a.push(...R.values())}const o=[];Ht.debug("    filtering docs");const l=Date.now()*1e3;for(const S of a)S.deleteAfter&&S.deleteAfter<l||s.filter&&!Di(S,s.filter)||o.push(S);if(Ht.debug(`    ordering docs: ${s.orderBy}`),s.orderBy==="path ASC")o.sort(tf);else if(s.orderBy==="path DESC")o.sort(nf);else if(s.orderBy==="localIndex ASC")o.sort(us("_localIndex","ASC"));else if(s.orderBy==="localIndex DESC")o.sort(us("_localIndex","DESC"));else if(s.orderBy)throw new $("unrecognized query orderBy: "+JSON.stringify(s.orderBy));return s.limit!==void 0&&a.length>=s.limit?o.slice(0,s.limit):(Ht.debug(`    queryDocs is done: found ${o.length} docs.`),o)}async upsert(e){const t=await this.db,r=t.transaction([Qe],"readwrite").objectStore(Qe).index("pathAuthorIndex"),s=Y(),u=r.openCursor([e.path,e.author]);if(await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex+=1,e._localIndex=this.localMaxLocalIndex,u.onsuccess=()=>{if(u.result){const f=u.result.update(e);f.onsuccess=()=>{s.resolve(!!f.result)}}else s.resolve(!1)},await s)return e;const l=t.transaction([Qe],"readwrite").objectStore(Qe).put(e),c=Y();return l.onsuccess=()=>{c.resolve()},l.onerror=()=>{throw l.error},await c,e}async eraseExpiredDocs(){const e=[],r=(await this.db).transaction([Qe],"readwrite").objectStore(Qe).index("deleteAfterIndex"),s=Date.now()*1e3,u=IDBKeyRange.bound(0,s),a=r.openCursor(u),o=Y();return a.onsuccess=()=>{var l;if((l=a.result)!=null&&l.value){const c=a.result.value;if(c.deleteAfter!==null&&c.deleteAfter!==void 0){e.push(c);const f=a.result.delete();f.onsuccess=()=>{var h;(h=a.result)==null||h.continue()}}}else o.resolve()},await o,e}async getConfig(e){const n=(await this.db).transaction([tt],"readonly").objectStore(tt),r=Y(),s=n.get(e);return s.onsuccess=()=>{var u;r.resolve((u=s.result)==null?void 0:u.value)},r}async setConfig(e,t){const r=(await this.db).transaction([tt],"readwrite").objectStore(tt),s=Y(),u=r.put({key:e,value:t});return u.onsuccess=()=>{s.resolve()},s}async listConfigKeys(){const t=(await this.db).transaction([tt],"readonly").objectStore(tt),n=Y(),s=t.index("keyIndex").openKeyCursor(),u=[];return s.onsuccess=()=>{s.result?(u.push(s.result.primaryKey),s.result.continue()):n.resolve(u)},n}async deleteConfig(e){const n=(await this.db).transaction([tt],"readwrite").objectStore(tt),r=Y(),s=n.index("keyIndex"),u=IDBKeyRange.bound([e],[e]),a=s.openCursor(u);return a.onsuccess=()=>{if(a.result){const o=a.result.delete();o.onsuccess=()=>{r.resolve(!0)}}else r.resolve(!1)},r}}const cs=new $e("replica driver indexeddb","gold"),nt="attachment_staging_index",Ke="attachments_index",ze="attachments_bytes";class sf{constructor(e,t){if(Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:Y()}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.share=e,!window.indexedDB)throw new Le("IndexedDB is not supported by this runtime.");const n=ua.indexedDB.open(`earthstar:share_attachments:${this.share}${t?`/${t}`:""}`,1);n.onerror=()=>{throw cs.error(`Could not open IndexedDB for ${this.share}'s attachments.`),cs.error(n.error),new Le(`Could not open IndexedDB for ${this.share}'s attachments.`)},n.onupgradeneeded=function(){const r=n.result;r.createObjectStore(ze),r.createObjectStore(Ke,{keyPath:"id"}),r.createObjectStore(nt,{keyPath:"id"})},n.onsuccess=()=>{this.db.resolve(n.result)}}getIndexKey(e,t){return`${e}___${t}`}async getAttachment(e,t){if(this.closed)throw new me;const n=Y(),r=this.getIndexKey(e,t),s=await this.db,a=s.transaction([Ke],"readonly").objectStore(Ke).get(r),o=Y();return a.onerror=()=>{o.reject()},a.onsuccess=()=>{a.result===void 0?o.reject():o.resolve(a.result.blobKey)},o.then(l=>{const f=s.transaction([ze],"readonly").objectStore(ze).get(l);f.onsuccess=()=>{const h=new Wu([f.result]);n.resolve({bytes:async()=>new Uint8Array(await h.arrayBuffer()),stream:()=>Promise.resolve(h.stream())})},f.onerror=()=>{n.resolve(void 0)}}).catch(()=>{n.resolve(void 0)}),n}async erase(e,t){if(this.closed)throw new me;const n=Y(),r=this.getIndexKey(e,t),s=await this.db,a=s.transaction([Ke],"readonly").objectStore(Ke).get(r),o=Y();return a.onerror=()=>{o.reject()},a.onsuccess=()=>{s.transaction([Ke],"readwrite").objectStore(Ke).delete(r),a.result===void 0?o.reject():o.resolve(a.result.blobKey)},o.then(l=>{const c=s.transaction([ze],"readwrite").objectStore(ze).delete(l);c.onsuccess=()=>{n.resolve(!0)},c.onerror=()=>{n.resolve(void 0)}}).catch(()=>{n.resolve(new $("No attachment found"))}),n}async stage(e,t){if(this.closed)throw new me;const n=await this.db,r=t instanceof Uint8Array?t:await Kc(t),s=await we.sha256base32(r),u=this.getIndexKey(e,s),a=`${u}___${Et()}`,o=n.transaction([ze,nt],"readwrite"),l=o.objectStore(ze).put(r,a),c=o.objectStore(nt).put({id:u,blobKey:a}),f=Y(),h=Y();return l.onsuccess=()=>f.resolve(),c.onsuccess=()=>h.resolve(),await f,await h,{hash:s,size:r.byteLength,reject:async()=>{const d=n.transaction([ze,nt],"readwrite"),p=d.objectStore(ze).delete(a),D=d.objectStore(nt).delete(u),g=Y(),m=Y();p.onsuccess=()=>{g.resolve()},D.onsuccess=()=>{m.resolve()},await Promise.all([g,m])},commit:async()=>{const d=n.transaction([Ke,nt],"readwrite"),p=d.objectStore(nt).delete(u),D=d.objectStore(Ke).put({id:u,blobKey:a}),g=Y(),m=Y();p.onsuccess=()=>g.resolve(),D.onsuccess=()=>m.resolve(),await Promise.all([g,m])}}}async wipe(){if(this.closed)throw new me;const t=(await this.db).transaction([ze,Ke,nt],"readwrite"),n=t.objectStore(ze).clear(),r=t.objectStore(Ke).clear(),s=t.objectStore(nt).clear(),u=Y(),a=Y(),o=Y();n.onsuccess=()=>u.resolve(),r.onsuccess=()=>a.resolve(),s.onsuccess=()=>o.resolve(),await Promise.all([u,a,o])}async clearStaging(){if(this.closed)throw new me;const t=(await this.db).transaction([ze,nt]),n=t.objectStore(nt).openCursor(),r=Y();return n.onsuccess=()=>{const s=n.result;if(!s){r.resolve();return}const u=s.value.blobKey,a=t.objectStore(ze).delete(u);s.delete(),a.onsuccess=()=>{s.continue()},a.onerror=()=>{s.continue()}},r}async filter(e){if(this.closed)throw new me;const n=(await this.db).transaction([ze,Ke],"readwrite"),r=50,s=[],u=[],a=Y(),o=(l=null)=>{const c=n.objectStore(Ke).getAll(l,r);c.onsuccess=()=>{const f=c.result;for(const h of f){const[d,p]=h.id.split("___");e[d]&&!e[d].has(p)&&(s.push({format:d,hash:p}),u.push(this.erase(d,p)))}if(f.length===r){const h=f[f.length-1],d=IDBKeyRange.lowerBound(h.id,!0);o(d)}else a.resolve()}};return o(),await a,await Promise.all(u),s}isClosed(){return this.closed}async close(e){if(this.closed)throw new me;e&&await this.wipe(),this.closed=!0,(await this.db).close(),await Sa(20)}}class uf{constructor(e,t){Object.defineProperty(this,"docDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachmentDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.docDriver=new rf(e,t),this.attachmentDriver=new sf(e,t)}}const wi=Xn({shareAddress:"+commons.b27bosxdl43cwmugqh2gg2ulaucikjxteaxkagkxhbmzcbvveb52a",secret:"b434ttewvnr63tiebyb3t3lqwen6wxajj7zh5w52jivgdnin5okga"});let Jr;wi.subscribe(i=>{Jr=i});const af=new Wc({driver:new uf(Jr.shareAddress),shareSecret:Jr.secret}),rn=Xn({replica:af}),of=new gi,ei=bi({settings:of});function lf(i){let e,t,n,r,s;return{c(){e=b("input"),t=P(),n=b("button"),n.textContent="Upload an identity file",qe(e,"display","none"),k(e,"type","file"),k(e,"accept",".json, .txt"),k(n,"class","svelte-wmuf6j"),at(n,"identity-view",i[0]===!0)},m(u,a){A(u,e,a),i[4](e),A(u,t,a),A(u,n,a),r||(s=[G(e,"change",i[3]),G(n,"click",i[5])],r=!0)},p(u,[a]){a&1&&at(n,"identity-view",u[0]===!0)},i:T,o:T,d(u){u&&_(e),i[4](null),u&&_(t),u&&_(n),r=!1,_e(s)}}}function cf(i){return new Promise((e,t)=>{let n=new FileReader;n.onload=()=>{e(n.result)},n.onerror=t,n.readAsBinaryString(i)})}function ff(i,e,t){const n=Xt();let r,s,{identityPg:u=!1}=e;async function a(f){let h=f.target.files[0],d=await cf(h);try{let p=JSON.parse(d);console.log(typeof p),console.log("fileReady",d);let D=p.address;console.log("authorAddress",D);let g=p.secret;console.log("authorSecret",g),It.set({address:D,secret:g}),s=D.slice(1,5),n("alias",s)}catch{n("error")}}const o=f=>a(f);function l(f){hr[f?"unshift":"push"](()=>{r=f,t(1,r)})}const c=()=>{r.click()};return i.$$set=f=>{"identityPg"in f&&t(0,u=f.identityPg)},[u,r,a,o,l,c]}class Na extends re{constructor(e){super(),ne(this,e,ff,lf,te,{identityPg:0})}}function fs(i){let e,t,n,r,s;return{c(){e=b("h1"),e.textContent="Identity Keypair",t=P(),n=b("h2"),r=b("b"),s=K(i[2]),k(e,"class","svelte-fndvt5"),k(n,"class","svelte-fndvt5")},m(u,a){A(u,e,a),A(u,t,a),A(u,n,a),w(n,r),w(r,s)},p(u,a){a&4&&ge(s,u[2])},d(u){u&&_(e),u&&_(t),u&&_(n)}}}function hs(i){let e,t,n;function r(a,o){return a[5]==="ID must be 4 characters long"?Df:a[5]==="ID must start with a letter"?pf:a[5]==="ID must not contain special characters"?df:hf}let s=r(i),u=s(i);return{c(){e=b("blockquote"),u.c()},m(a,o){A(a,e,o),u.m(e,null),n=!0},p(a,o){s!==(s=r(a))&&(u.d(1),u=s(a),u&&(u.c(),u.m(e,null)))},i(a){n||(Kt(()=>{t||(t=bn(e,Cn,{y:200,duration:2e3},!0)),t.run(1)}),n=!0)},o(a){t||(t=bn(e,Cn,{y:200,duration:2e3},!1)),t.run(0),n=!1},d(a){a&&_(e),u.d(),a&&t&&t.end()}}}function hf(i){let e;return{c(){e=K("Press enter to generate a new keypair.")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function df(i){let e;return{c(){e=b("i"),e.innerHTML=`<strong>Special characters are not allowed.</strong> 
                    <br/>`},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function pf(i){let e;return{c(){e=b("i"),e.innerHTML="<strong>A valid alias must begin with a letter.</strong> It needs to be 4 characters long and can only contain letters and numbers."},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function Df(i){let e;return{c(){e=b("i"),e.innerHTML="A valid id <strong>needs to be 4 characters long</strong>."},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function ds(i){let e,t,n;return{c(){e=b("blockquote"),e.innerHTML="<strong>Please upload a valid identity file</strong>"},m(r,s){A(r,e,s),n=!0},i(r){n||(Kt(()=>{t||(t=bn(e,Cn,{y:200,duration:2e3},!0)),t.run(1)}),n=!0)},o(r){t||(t=bn(e,Cn,{y:200,duration:2e3},!1)),t.run(0),n=!1},d(r){r&&_(e),r&&t&&t.end()}}}function mf(i){let e,t,n,r,s,u,a,o,l,c,f,h,d,p,D,g,m,E,B,F,v,x,S,R,Q,N,j,O,ie,Ie,oe,kt,Je,Fr,un,vr,Ei,Ue=i[3].address.length!==0&&fs(i);x=new Na({props:{identityPg:!0}}),x.$on("alias",i[10]),x.$on("error",i[11]);let ve=i[6]&&hs(i),Se=i[7]===!0&&ds();return{c(){e=b("div"),Ue&&Ue.c(),t=P(),n=b("p"),n.textContent="Your identity is represented by a keypair that contains your address and secret.",r=P(),s=b("div"),u=b("p"),a=b("b"),a.textContent="Address:",o=P(),l=K(i[1]),c=P(),f=b("br"),h=P(),d=b("b"),d.textContent="Secret:",p=P(),D=K(i[8]),g=P(),m=b("p"),m.textContent="You can download it and reuse it later.",E=P(),B=b("div"),F=b("button"),F.textContent="Download your identity file",v=P(),W(x.$$.fragment),S=P(),R=b("p"),Q=K(`You can

        `),N=b("button"),N.textContent="generate another identity",j=K(`

    or customize your alias in the box below:`),O=P(),ie=b("p"),Ie=K(`Your alias is 
    `),oe=b("input"),kt=P(),Je=b("div"),ve&&ve.c(),Fr=P(),Se&&Se.c(),k(s,"class","flex svelte-fndvt5"),k(F,"class","svelte-fndvt5"),k(B,"class","flex svelte-fndvt5"),k(N,"class","svelte-fndvt5"),k(oe,"type","text"),k(oe,"spellcheck","false"),k(oe,"maxlength","4"),k(oe,"class","svelte-fndvt5"),k(e,"class","id svelte-fndvt5")},m(ke,ct){A(ke,e,ct),Ue&&Ue.m(e,null),w(e,t),w(e,n),w(e,r),w(e,s),w(s,u),w(u,a),w(u,o),w(u,l),w(u,c),w(u,f),w(u,h),w(u,d),w(u,p),w(u,D),w(e,g),w(e,m),w(e,E),w(e,B),w(B,F),w(B,v),U(x,B,null),w(e,S),w(e,R),w(R,Q),w(R,N),w(R,j),w(e,O),w(e,ie),w(ie,Ie),w(ie,oe),Tt(oe,i[4]),w(e,kt),w(e,Je),ve&&ve.m(Je,null),w(Je,Fr),Se&&Se.m(Je,null),un=!0,vr||(Ei=[G(F,"click",i[12]),G(N,"click",i[13]),G(oe,"input",i[14]),G(oe,"keypress",i[15]),G(oe,"focus",i[16]),G(oe,"keypress",i[17])],vr=!0)},p(ke,[ct]){ke[3].address.length!==0?Ue?Ue.p(ke,ct):(Ue=fs(ke),Ue.c(),Ue.m(e,t)):Ue&&(Ue.d(1),Ue=null),(!un||ct&2)&&ge(l,ke[1]),(!un||ct&256)&&ge(D,ke[8]),ct&16&&oe.value!==ke[4]&&Tt(oe,ke[4]),ke[6]?ve?(ve.p(ke,ct),ct&64&&y(ve,1)):(ve=hs(ke),ve.c(),y(ve,1),ve.m(Je,Fr)):ve&&(H(),C(ve,1,1,()=>{ve=null}),q()),ke[7]===!0?Se?ct&128&&y(Se,1):(Se=ds(),Se.c(),y(Se,1),Se.m(Je,null)):Se&&(H(),C(Se,1,1,()=>{Se=null}),q())},i(ke){un||(y(x.$$.fragment,ke),y(ve),y(Se),un=!0)},o(ke){C(x.$$.fragment,ke),C(ve),C(Se),un=!1},d(ke){ke&&_(e),Ue&&Ue.d(),z(x),ve&&ve.d(),Se&&Se.d(),vr=!1,_e(Ei)}}}function gf(i){return/[0-9]/.test(i)}function bf(i){return/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(i)}function wf(){let i="",e="abcdefghijklmnopqrstuvwxyz",t=e.length,n="abcdefghijklmnopqrstuvwxyz0123456789",r=n.length;i+=e.charAt(Math.floor(Math.random()*t));for(let s=0;s<3;s++)i+=n.charAt(Math.floor(Math.random()*r));return i}function _f(i,e,t){let n,r,s,u;Ee(i,It,S=>t(3,u=S));let a,o,l=!1,c,f=!1;const h=new gi;function d(){let S=document.createElement("a"),R=new Blob([JSON.stringify(u)],{type:"text/plain"}),Q=u.address+".json";S.href=URL.createObjectURL(R),S.download=Q,S.style.display="none",document.body.appendChild(S),S.click()}async function p(S){S=="r"&&t(4,a=wf());let R=a.slice(0,1);if(gf(R))console.log("firstChar",R),t(5,o="ID must start with a letter");else if(a.length!==4)t(5,o="ID must be 4 characters long");else if(bf(a))t(5,o="ID must not contain special characters");else{let Q=await we.generateAuthorKeypair(a),N=Q.address,j=Q.secret;It.set({address:N,secret:j}),t(5,o=null),t(6,l=!1),h.author=Q,ei.set({settings:h})}}function D(S){console.log("event",S),c=S.detail,t(4,a=c),t(7,f=!1)}function g(){t(7,f=!0)}Rt(()=>{u.address.length===0?p("r"):(t(1,n=u.address),t(8,r=u.secret))});const m=()=>d(),E=()=>p("r");function B(){a=this.value,t(4,a),t(2,s),t(1,n),t(3,u)}const F=()=>{t(6,l=!0)},v=()=>{t(6,l=!0)},x=()=>p();return i.$$.update=()=>{i.$$.dirty&8&&t(1,n=u.address),i.$$.dirty&8&&t(8,r=u.secret),i.$$.dirty&2&&t(2,s=n.slice(0,5)),i.$$.dirty&4&&t(4,a=s.slice(1,5))},[p,n,s,u,a,o,l,f,r,d,D,g,m,E,B,F,v,x]}class yf extends re{constructor(e){super(),ne(this,e,_f,mf,te,{generateID:0})}get generateID(){return this.$$.ctx[0]}}let ja;rn.subscribe(i=>{ja=i});const Af=new Qc(ja.replica),kr=Xn({cache:Af});var ti={},Cf={get exports(){return ti},set exports(i){ti=i}},ni={},Ef={get exports(){return ni},set exports(i){ni=i}};(function(){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(t,n){return t<<n|t>>>32-n},rotr:function(t,n){return t<<32-n|t>>>n},endian:function(t){if(t.constructor==Number)return e.rotl(t,8)&16711935|e.rotl(t,24)&4278255360;for(var n=0;n<t.length;n++)t[n]=e.endian(t[n]);return t},randomBytes:function(t){for(var n=[];t>0;t--)n.push(Math.floor(Math.random()*256));return n},bytesToWords:function(t){for(var n=[],r=0,s=0;r<t.length;r++,s+=8)n[s>>>5]|=t[r]<<24-s%32;return n},wordsToBytes:function(t){for(var n=[],r=0;r<t.length*32;r+=8)n.push(t[r>>>5]>>>24-r%32&255);return n},bytesToHex:function(t){for(var n=[],r=0;r<t.length;r++)n.push((t[r]>>>4).toString(16)),n.push((t[r]&15).toString(16));return n.join("")},hexToBytes:function(t){for(var n=[],r=0;r<t.length;r+=2)n.push(parseInt(t.substr(r,2),16));return n},bytesToBase64:function(t){for(var n=[],r=0;r<t.length;r+=3)for(var s=t[r]<<16|t[r+1]<<8|t[r+2],u=0;u<4;u++)r*8+u*6<=t.length*8?n.push(i.charAt(s>>>6*(3-u)&63)):n.push("=");return n.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var n=[],r=0,s=0;r<t.length;s=++r%4)s!=0&&n.push((i.indexOf(t.charAt(r-1))&Math.pow(2,-2*s+8)-1)<<s*2|i.indexOf(t.charAt(r))>>>6-s*2);return n}};Ef.exports=e})();var ri={utf8:{stringToBytes:function(i){return ri.bin.stringToBytes(unescape(encodeURIComponent(i)))},bytesToString:function(i){return decodeURIComponent(escape(ri.bin.bytesToString(i)))}},bin:{stringToBytes:function(i){for(var e=[],t=0;t<i.length;t++)e.push(i.charCodeAt(t)&255);return e},bytesToString:function(i){for(var e=[],t=0;t<i.length;t++)e.push(String.fromCharCode(i[t]));return e.join("")}}},ps=ri;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var kf=function(i){return i!=null&&(La(i)||Ff(i)||!!i._isBuffer)};function La(i){return!!i.constructor&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)}function Ff(i){return typeof i.readFloatLE=="function"&&typeof i.slice=="function"&&La(i.slice(0,0))}(function(){var i=ni,e=ps.utf8,t=kf,n=ps.bin,r=function(s,u){s.constructor==String?u&&u.encoding==="binary"?s=n.stringToBytes(s):s=e.stringToBytes(s):t(s)?s=Array.prototype.slice.call(s,0):!Array.isArray(s)&&s.constructor!==Uint8Array&&(s=s.toString());for(var a=i.bytesToWords(s),o=s.length*8,l=1732584193,c=-271733879,f=-1732584194,h=271733878,d=0;d<a.length;d++)a[d]=(a[d]<<8|a[d]>>>24)&16711935|(a[d]<<24|a[d]>>>8)&4278255360;a[o>>>5]|=128<<o%32,a[(o+64>>>9<<4)+14]=o;for(var p=r._ff,D=r._gg,g=r._hh,m=r._ii,d=0;d<a.length;d+=16){var E=l,B=c,F=f,v=h;l=p(l,c,f,h,a[d+0],7,-680876936),h=p(h,l,c,f,a[d+1],12,-389564586),f=p(f,h,l,c,a[d+2],17,606105819),c=p(c,f,h,l,a[d+3],22,-1044525330),l=p(l,c,f,h,a[d+4],7,-176418897),h=p(h,l,c,f,a[d+5],12,1200080426),f=p(f,h,l,c,a[d+6],17,-1473231341),c=p(c,f,h,l,a[d+7],22,-45705983),l=p(l,c,f,h,a[d+8],7,1770035416),h=p(h,l,c,f,a[d+9],12,-1958414417),f=p(f,h,l,c,a[d+10],17,-42063),c=p(c,f,h,l,a[d+11],22,-1990404162),l=p(l,c,f,h,a[d+12],7,1804603682),h=p(h,l,c,f,a[d+13],12,-40341101),f=p(f,h,l,c,a[d+14],17,-1502002290),c=p(c,f,h,l,a[d+15],22,1236535329),l=D(l,c,f,h,a[d+1],5,-165796510),h=D(h,l,c,f,a[d+6],9,-1069501632),f=D(f,h,l,c,a[d+11],14,643717713),c=D(c,f,h,l,a[d+0],20,-373897302),l=D(l,c,f,h,a[d+5],5,-701558691),h=D(h,l,c,f,a[d+10],9,38016083),f=D(f,h,l,c,a[d+15],14,-660478335),c=D(c,f,h,l,a[d+4],20,-405537848),l=D(l,c,f,h,a[d+9],5,568446438),h=D(h,l,c,f,a[d+14],9,-1019803690),f=D(f,h,l,c,a[d+3],14,-187363961),c=D(c,f,h,l,a[d+8],20,1163531501),l=D(l,c,f,h,a[d+13],5,-1444681467),h=D(h,l,c,f,a[d+2],9,-51403784),f=D(f,h,l,c,a[d+7],14,1735328473),c=D(c,f,h,l,a[d+12],20,-1926607734),l=g(l,c,f,h,a[d+5],4,-378558),h=g(h,l,c,f,a[d+8],11,-2022574463),f=g(f,h,l,c,a[d+11],16,1839030562),c=g(c,f,h,l,a[d+14],23,-35309556),l=g(l,c,f,h,a[d+1],4,-1530992060),h=g(h,l,c,f,a[d+4],11,1272893353),f=g(f,h,l,c,a[d+7],16,-155497632),c=g(c,f,h,l,a[d+10],23,-1094730640),l=g(l,c,f,h,a[d+13],4,681279174),h=g(h,l,c,f,a[d+0],11,-358537222),f=g(f,h,l,c,a[d+3],16,-722521979),c=g(c,f,h,l,a[d+6],23,76029189),l=g(l,c,f,h,a[d+9],4,-640364487),h=g(h,l,c,f,a[d+12],11,-421815835),f=g(f,h,l,c,a[d+15],16,530742520),c=g(c,f,h,l,a[d+2],23,-995338651),l=m(l,c,f,h,a[d+0],6,-198630844),h=m(h,l,c,f,a[d+7],10,1126891415),f=m(f,h,l,c,a[d+14],15,-1416354905),c=m(c,f,h,l,a[d+5],21,-57434055),l=m(l,c,f,h,a[d+12],6,1700485571),h=m(h,l,c,f,a[d+3],10,-1894986606),f=m(f,h,l,c,a[d+10],15,-1051523),c=m(c,f,h,l,a[d+1],21,-2054922799),l=m(l,c,f,h,a[d+8],6,1873313359),h=m(h,l,c,f,a[d+15],10,-30611744),f=m(f,h,l,c,a[d+6],15,-1560198380),c=m(c,f,h,l,a[d+13],21,1309151649),l=m(l,c,f,h,a[d+4],6,-145523070),h=m(h,l,c,f,a[d+11],10,-1120210379),f=m(f,h,l,c,a[d+2],15,718787259),c=m(c,f,h,l,a[d+9],21,-343485551),l=l+E>>>0,c=c+B>>>0,f=f+F>>>0,h=h+v>>>0}return i.endian([l,c,f,h])};r._ff=function(s,u,a,o,l,c,f){var h=s+(u&a|~u&o)+(l>>>0)+f;return(h<<c|h>>>32-c)+u},r._gg=function(s,u,a,o,l,c,f){var h=s+(u&o|a&~o)+(l>>>0)+f;return(h<<c|h>>>32-c)+u},r._hh=function(s,u,a,o,l,c,f){var h=s+(u^a^o)+(l>>>0)+f;return(h<<c|h>>>32-c)+u},r._ii=function(s,u,a,o,l,c,f){var h=s+(a^(u|~o))+(l>>>0)+f;return(h<<c|h>>>32-c)+u},r._blocksize=16,r._digestsize=16,Cf.exports=function(s,u){if(s==null)throw new Error("Illegal argument "+s);var a=i.wordsToBytes(r(s,u));return u&&u.asBytes?a:u&&u.asString?n.bytesToString(a):i.bytesToHex(a)}})();function Ds(i){let e;const t=i[11].default,n=fe(t,i,i[10],null);return{c(){n&&n.c()},m(r,s){n&&n.m(r,s),e=!0},p(r,s){n&&n.p&&(!e||s&1024)&&de(n,t,r,r[10],e?he(t,r[10],s,null):pe(r[10]),null)},i(r){e||(y(n,r),e=!0)},o(r){C(n,r),e=!1},d(r){n&&n.d(r)}}}function vf(i){let e,t,n,r,s,u=i[3]&&Ds(i);return{c(){e=b("div"),u&&u.c(),k(e,"class",t="wrapper "+i[2]+" "+i[0]+" svelte-142y8oi"),k(e,"style",i[1])},m(a,o){A(a,e,o),u&&u.m(e,null),n=!0,r||(s=to(i[4].call(null,e)),r=!0)},p(a,[o]){a[3]?u?(u.p(a,o),o&8&&y(u,1)):(u=Ds(a),u.c(),y(u,1),u.m(e,null)):u&&(H(),C(u,1,1,()=>{u=null}),q()),(!n||o&5&&t!==(t="wrapper "+a[2]+" "+a[0]+" svelte-142y8oi"))&&k(e,"class",t),(!n||o&2)&&k(e,"style",a[1])},i(a){n||(y(u),n=!0)},o(a){C(u),n=!1},d(a){a&&_(e),u&&u.d(),r=!1,s()}}}function Bf(i,e){let t,n;return()=>{const r=+new Date;t&&r<t+e?(clearTimeout(n),n=setTimeout(function(){t=r,i()},e)):(t=r,i())}}function Sf(i,e,t){let{$$slots:n={},$$scope:r}=e;const s=Xt();let{offset:u=0}=e,{throttle:a=250}=e,{c:o=""}=e,{style:l=""}=e,{once:c=!0}=e,{threshold:f=1}=e,{disabled:h=!1}=e,{class:d=""}=e,p=h,D=!1,g=!1,m=()=>{};function E(F,v,x){if(p&&!F){s("enter");return}F&&!g&&s("leave"),c&&F&&!g&&m()}function B(F){if(!window||h)return;if(window.IntersectionObserver&&window.IntersectionObserverEntry){const S=new IntersectionObserver(([{isIntersecting:R}])=>{if(D=p,g=R,D&&c&&!R){E(D);return}t(3,p=R),E(D)},{rootMargin:u+"px",threshold:f});return S.observe(F),m=()=>S.unobserve(F),m}function v(){if(!(F.offsetWidth||F.offsetHeight||F.getClientRects().length))return;let S,R;try{({top:S,height:R}=F.getBoundingClientRect())}catch{({top:S,height:R}=defaultBoundingClientRect)}const Q=window.innerHeight||document.documentElement.clientHeight;if(D=p,g=S-u<=Q&&S+R+u>=0,D&&c&&!isIntersecting){E(D,observer);return}t(3,p=g),E(D)}v();const x=Bf(v,a);return window.addEventListener("scroll",x),window.addEventListener("resize",x),m=()=>{window.removeEventListener("scroll",x),window.removeEventListener("resize",x)},m}return i.$$set=F=>{"offset"in F&&t(5,u=F.offset),"throttle"in F&&t(6,a=F.throttle),"c"in F&&t(0,o=F.c),"style"in F&&t(1,l=F.style),"once"in F&&t(7,c=F.once),"threshold"in F&&t(8,f=F.threshold),"disabled"in F&&t(9,h=F.disabled),"class"in F&&t(2,d=F.class),"$$scope"in F&&t(10,r=F.$$scope)},[o,l,d,p,B,u,a,c,f,h,r,n]}class Tf extends re{constructor(e){super(),ne(this,e,Sf,vf,te,{offset:5,throttle:6,c:0,style:1,once:7,threshold:8,disabled:9,class:2})}}function Pf(i){let e;const t=i[1].default,n=fe(t,i,i[0],null);return{c(){n&&n.c()},m(r,s){n&&n.m(r,s),e=!0},p(r,[s]){n&&n.p&&(!e||s&1)&&de(n,t,r,r[0],e?he(t,r[0],s,null):pe(r[0]),null)},i(r){e||(y(n,r),e=!0)},o(r){C(n,r),e=!1},d(r){n&&n.d(r)}}}function If(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class Rf extends re{constructor(e){super(),ne(this,e,If,Pf,te,{})}}function xf(i){let e,t,n,r,s,u;return{c(){e=b("img"),k(e,"alt",t=typeof i[0]===void 0?`Gravatar for ${i[2]}`:i[0]),k(e,"style",i[7]),k(e,"class",i[8]),Xe(e.src,n=gs()&&!i[9]?i[5]:i[6])||k(e,"src",n),k(e,"srcset",r=i[9]?`${i[5]} 2x`:void 0),k(e,"width",i[4]),k(e,"height",i[4])},m(a,o){A(a,e,o),s||(u=G(e,"error",i[22]),s=!0)},p(a,o){o&5&&t!==(t=typeof a[0]===void 0?`Gravatar for ${a[2]}`:a[0])&&k(e,"alt",t),o&128&&k(e,"style",a[7]),o&256&&k(e,"class",a[8]),o&96&&!Xe(e.src,n=gs()&&!a[9]?a[5]:a[6])&&k(e,"src",n),o&32&&r!==(r=a[9]?`${a[5]} 2x`:void 0)&&k(e,"srcset",r),o&16&&k(e,"width",a[4]),o&16&&k(e,"height",a[4])},d(a){a&&_(e),s=!1,u()}}}function Of(i){let e,t;const n=[i[1]];let r={$$slots:{default:[xf]},$$scope:{ctx:i}};for(let s=0;s<n.length;s+=1)r=Ye(r,n[s]);return e=new i[3]({props:r}),{c(){W(e.$$.fragment)},m(s,u){U(e,s,u),t=!0},p(s,[u]){const a=u&2?en(n,[tn(s[1])]):{};u&16777717&&(a.$$scope={dirty:u,ctx:s}),e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){C(e.$$.fragment,s),t=!1},d(s){z(e,s)}}}function ms(i,e,t,n){return`s=${i*n}&r=${e}&d=${t}`}function gs(){if(typeof window<"u"&&window){let i="(-webkit-min-device-pixel-ratio: 1.25), (min--moz-device-pixel-ratio: 1.25), (-o-min-device-pixel-ratio: 5/4), (min-resolution: 1.25dppx)";if(window.devicePixelRatio>1.25||window.matchMedia&&window.matchMedia(i).matches)return!0}return!1}function $f(i,e,t){let n,r,s,u,a,o,l,c,f,h,d,p,{size:D=50}=e,{alt:g=void 0}=e,{rating:m="g"}=e,{md5:E=""}=e,{protocol:B="//"}=e,{email:F}=e,{useWaypoint:v=!0}=e,{waypointOptions:x={}}=e,{domain:S="en.gravatar.com"}=e,R=typeof window>"u"?!0:"srcset"in document.createElement("img");function Q(N){gn.call(this,i,N)}return i.$$set=N=>{t(23,e=Ye(Ye({},e),qr(N))),"size"in N&&t(10,D=N.size),"alt"in N&&t(0,g=N.alt),"rating"in N&&t(11,m=N.rating),"md5"in N&&t(12,E=N.md5),"protocol"in N&&t(13,B=N.protocol),"email"in N&&t(14,F=N.email),"useWaypoint"in N&&t(15,v=N.useWaypoint),"waypointOptions"in N&&t(1,x=N.waypointOptions),"domain"in N&&t(16,S=N.domain)},i.$$.update=()=>{i.$$.dirty&16384&&t(2,n=(F||"").trim().toLowerCase()),t(21,r=e.default||"retro"),t(8,s=e.class||""),t(7,u=e.style||""),i.$$.dirty&73728&&t(19,a=`${B}${S}/avatar/`),i.$$.dirty&2100224&&t(20,o=ms(D,m,r,1)),i.$$.dirty&2100224&&t(17,l=ms(D,m,r,2)),i.$$.dirty&4100&&t(18,c=E||ti(n,{encoding:"binary"})),i.$$.dirty&1835008&&t(6,f=`${a}${c}?${o}`),i.$$.dirty&917504&&t(5,h=`${a}${c}?${l}`),i.$$.dirty&1024&&t(4,d=typeof D=="number"?`${D}px`:D),i.$$.dirty&32768&&t(3,p=v?Tf:Rf)},e=qr(e),[g,x,n,p,d,h,f,u,s,R,D,m,E,B,F,v,S,l,c,a,o,r,Q]}class _i extends re{constructor(e){super(),ne(this,e,$f,Of,te,{size:10,alt:0,rating:11,md5:12,protocol:13,email:14,useWaypoint:15,waypointOptions:1,domain:16})}}const Ua=Xn(new Date,function(e){const t=setInterval(()=>{e(new Date)},1e3);return function(){clearInterval(t)}}),Mf=new Date,Nf=ef(Ua,i=>Math.round((Number(i)-Number(Mf))/1e3));function bs(i){let e,t,n,r,s,u,a,o=Math.trunc(i[2])+"",l,c,f=i[2]<=1?"minute":"minutes",h,d,p,D,g=Math.trunc((i[3]/1e3-(i[0]*1e3+i[4]))/6e4)+"",m,E,B,F,v,x;return{c(){e=b("div"),t=b("button"),t.textContent="Extend",n=P(),r=b("button"),r.textContent="Shorten",s=P(),u=b("p"),a=K("last interaction was "),l=K(o),c=P(),h=K(f),d=K(" ago"),p=P(),D=b("p"),m=K(g),E=K(" minutes left until deletion"),B=P(),F=b("button"),F.textContent="Delete",k(t,"class","svelte-mmxx8s"),k(r,"class","svelte-mmxx8s"),k(u,"class","svelte-mmxx8s"),k(D,"class","svelte-mmxx8s"),k(F,"class","svelte-mmxx8s"),k(e,"id","flexcontainer"),k(e,"class","svelte-mmxx8s")},m(S,R){A(S,e,R),w(e,t),w(e,n),w(e,r),w(e,s),w(e,u),w(u,a),w(u,l),w(u,c),w(u,h),w(u,d),w(e,p),w(e,D),w(D,m),w(D,E),w(e,B),w(e,F),v||(x=[G(t,"click",i[5]),G(r,"click",i[6]),G(F,"click",i[10])],v=!0)},p(S,R){R&4&&o!==(o=Math.trunc(S[2])+"")&&ge(l,o),R&4&&f!==(f=S[2]<=1?"minute":"minutes")&&ge(h,f),R&9&&g!==(g=Math.trunc((S[3]/1e3-(S[0]*1e3+S[4]))/6e4)+"")&&ge(m,g)},d(S){S&&_(e),v=!1,_e(x)}}}function jf(i){let e,t=i[1]?"Ephemeral":"Ephemeral",n,r,s,u,a,o=i[1]&&bs(i);return{c(){e=b("button"),n=K(t),r=P(),o&&o.c(),s=J(),k(e,"class","svelte-mmxx8s")},m(l,c){A(l,e,c),w(e,n),A(l,r,c),o&&o.m(l,c),A(l,s,c),u||(a=G(e,"click",i[9]),u=!0)},p(l,[c]){c&2&&t!==(t=l[1]?"Ephemeral":"Ephemeral")&&ge(n,t),l[1]?o?o.p(l,c):(o=bs(l),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null)},i:T,o:T,d(l){l&&_(e),l&&_(r),o&&o.d(l),l&&_(s),u=!1,a()}}}function Lf(i,e,t){let n,r,s;Ee(i,Nf,m=>t(0,n=m)),Ee(i,It,m=>t(11,r=m)),Ee(i,rn,m=>t(12,s=m));const u=Xt();let a=Date.now(),o=!1,l=0,{doc:c}=e,f=c.deleteAfter;async function h(){t(3,f+=864e8);let m=r.address.slice(1,5),E=c.path.split("!"),B=E[0].replace("/documents","/studio")+E[1];const F=await s.replica.set(r,{text:c.text+"<br> lifespan extended by "+m+" on "+new Date().toLocaleString(),path:c.path,deleteAfter:f}),v=await s.replica.set(r,{text:c.text+"<br> lifespan extended by "+m+" on "+new Date().toLocaleString(),path:B});console.log("studioPath",B),console.log("doc.path",c.path),console.log("result c",F),console.log("result s",v)}async function d(){let m=r.address.slice(1,5),E=c.path.split("!"),B=E[0].replace("/documents","/studio")+E[1];console.log("studioPath",B),t(3,f-=864e8);const F=await s.replica.set(r,{text:c.text+"<br> lifespan shortened by "+m+" on "+new Date().toLocaleString(),path:c.path,deleteAfter:f}),v=await s.replica.set(r,{text:c.text+"<br> lifespan shortened by "+m+" on "+new Date().toLocaleString(),path:B});console.log("result c",F),console.log("result s",v)}async function p(){u("update");let m=r.address.slice(1,5),E=c.path.split("!"),B=E[0].replace("/documents","/studio")+E[1];const F=await s.replica.set(r,{path:c.path,deleteAfter:(Date.now()+1e3)*1e3}),v=await s.replica.set(r,{text:c.text+"<br> deleted by "+m+" on "+new Date().toLocaleString(),path:B});console.log("studio 'delete'",v),console.log("result delete",F)}const D=()=>t(1,o=!o),g=()=>p();return i.$$set=m=>{"doc"in m&&t(8,c=m.doc)},i.$$.update=()=>{i.$$.dirty&257&&t(2,l=(n+a/1e3-c.timestamp/1e6)/60)},[n,o,l,f,a,h,d,p,c,D,g]}class Uf extends re{constructor(e){super(),ne(this,e,Lf,jf,te,{doc:8})}}function zf(){const i=console.warn;console.warn=e=>{e.includes("unknown prop")||e.includes("unexpected slot")||i(e)},Rt(()=>{console.warn=i})}function ws(i,e,t){const n=i.slice();return n[18]=e[t],n}function _s(i,e,t){const n=i.slice();return n[18]=e[t],n}function ys(i,e,t){const n=i.slice();return n[10]=e[t],n}function As(i,e,t){const n=i.slice();return n[13]=e[t],n[15]=t,n}function Cs(i,e,t){const n=i.slice();return n[16]=e[t],n[15]=t,n}function Es(i,e,t){const n=i.slice();return n[7]=e[t],n}function Hf(i){let e,t,n,r;const s=[Kf,Qf,Wf],u=[];function a(o,l){return o[0]==="table"?0:o[0]==="list"?1:2}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=J()},m(o,l){u[e].m(o,l),A(o,n,l),r=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(H(),C(u[c],1,1,()=>{u[c]=null}),q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),y(t,1),t.m(n.parentNode,n))},i(o){r||(y(t),r=!0)},o(o){C(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function qf(i){let e,t,n=i[1],r=[];for(let u=0;u<n.length;u+=1)r[u]=Ts(Es(i,n,u));const s=u=>C(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=J()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);A(u,e,a),t=!0},p(u,a){if(a&34){n=u[1];let o;for(o=0;o<n.length;o+=1){const l=Es(u,n,o);r[o]?(r[o].p(l,a),y(r[o],1)):(r[o]=Ts(l),r[o].c(),y(r[o],1),r[o].m(e.parentNode,e))}for(H(),o=n.length;o<r.length;o+=1)s(o);q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)y(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)C(r[a]);t=!1},d(u){Yt(r,u),u&&_(e)}}}function Wf(i){let e,t,n;const r=[i[6]];var s=i[5][i[0]];function u(a){let o={$$slots:{default:[Zf]},$$scope:{ctx:a}};for(let l=0;l<r.length;l+=1)o=Ye(o,r[l]);return{props:o}}return s&&(e=De(s,u(i))),{c(){e&&W(e.$$.fragment),t=J()},m(a,o){e&&U(e,a,o),A(a,t,o),n=!0},p(a,o){const l=o&64?en(r,[tn(a[6])]):{};if(o&8388706&&(l.$$scope={dirty:o,ctx:a}),s!==(s=a[5][a[0]])){if(e){H();const c=e;C(c.$$.fragment,1,0,()=>{z(c,1)}),q()}s?(e=De(s,u(a)),W(e.$$.fragment),y(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else s&&e.$set(l)},i(a){n||(e&&y(e.$$.fragment,a),n=!0)},o(a){e&&C(e.$$.fragment,a),n=!1},d(a){a&&_(t),e&&z(e,a)}}}function Qf(i){let e,t,n,r;const s=[Xf,Yf],u=[];function a(o,l){return o[4]?0:1}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=J()},m(o,l){u[e].m(o,l),A(o,n,l),r=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(H(),C(u[c],1,1,()=>{u[c]=null}),q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),y(t,1),t.m(n.parentNode,n))},i(o){r||(y(t),r=!0)},o(o){C(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function Kf(i){let e,t,n;var r=i[5].table;function s(u){return{props:{$$slots:{default:[lh]},$$scope:{ctx:u}}}}return r&&(e=De(r,s(i))),{c(){e&&W(e.$$.fragment),t=J()},m(u,a){e&&U(e,u,a),A(u,t,a),n=!0},p(u,a){const o={};if(a&8388716&&(o.$$scope={dirty:a,ctx:u}),r!==(r=u[5].table)){if(e){H();const l=e;C(l.$$.fragment,1,0,()=>{z(l,1)}),q()}r?(e=De(r,s(u)),W(e.$$.fragment),y(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else r&&e.$set(o)},i(u){n||(e&&y(e.$$.fragment,u),n=!0)},o(u){e&&C(e.$$.fragment,u),n=!1},d(u){u&&_(t),e&&z(e,u)}}}function Vf(i){let e=i[6].raw+"",t;return{c(){t=K(e)},m(n,r){A(n,t,r)},p(n,r){r&64&&e!==(e=n[6].raw+"")&&ge(t,e)},i:T,o:T,d(n){n&&_(t)}}}function Gf(i){let e,t;return e=new sn({props:{tokens:i[1],renderers:i[5]}}),{c(){W(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,r){const s={};r&2&&(s.tokens=n[1]),r&32&&(s.renderers=n[5]),e.$set(s)},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function Zf(i){let e,t,n,r;const s=[Gf,Vf],u=[];function a(o,l){return o[1]?0:1}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=J()},m(o,l){u[e].m(o,l),A(o,n,l),r=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(H(),C(u[c],1,1,()=>{u[c]=null}),q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),y(t,1),t.m(n.parentNode,n))},i(o){r||(y(t),r=!0)},o(o){C(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function Yf(i){let e,t,n;const r=[{ordered:i[4]},i[6]];var s=i[5].list;function u(a){let o={$$slots:{default:[eh]},$$scope:{ctx:a}};for(let l=0;l<r.length;l+=1)o=Ye(o,r[l]);return{props:o}}return s&&(e=De(s,u(i))),{c(){e&&W(e.$$.fragment),t=J()},m(a,o){e&&U(e,a,o),A(a,t,o),n=!0},p(a,o){const l=o&80?en(r,[o&16&&{ordered:a[4]},o&64&&tn(a[6])]):{};if(o&8388704&&(l.$$scope={dirty:o,ctx:a}),s!==(s=a[5].list)){if(e){H();const c=e;C(c.$$.fragment,1,0,()=>{z(c,1)}),q()}s?(e=De(s,u(a)),W(e.$$.fragment),y(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else s&&e.$set(l)},i(a){n||(e&&y(e.$$.fragment,a),n=!0)},o(a){e&&C(e.$$.fragment,a),n=!1},d(a){a&&_(t),e&&z(e,a)}}}function Xf(i){let e,t,n;const r=[{ordered:i[4]},i[6]];var s=i[5].list;function u(a){let o={$$slots:{default:[nh]},$$scope:{ctx:a}};for(let l=0;l<r.length;l+=1)o=Ye(o,r[l]);return{props:o}}return s&&(e=De(s,u(i))),{c(){e&&W(e.$$.fragment),t=J()},m(a,o){e&&U(e,a,o),A(a,t,o),n=!0},p(a,o){const l=o&80?en(r,[o&16&&{ordered:a[4]},o&64&&tn(a[6])]):{};if(o&8388704&&(l.$$scope={dirty:o,ctx:a}),s!==(s=a[5].list)){if(e){H();const c=e;C(c.$$.fragment,1,0,()=>{z(c,1)}),q()}s?(e=De(s,u(a)),W(e.$$.fragment),y(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else s&&e.$set(l)},i(a){n||(e&&y(e.$$.fragment,a),n=!0)},o(a){e&&C(e.$$.fragment,a),n=!1},d(a){a&&_(t),e&&z(e,a)}}}function Jf(i){let e,t,n;return e=new sn({props:{tokens:i[18].tokens,renderers:i[5]}}),{c(){W(e.$$.fragment),t=P()},m(r,s){U(e,r,s),A(r,t,s),n=!0},p(r,s){const u={};s&64&&(u.tokens=r[18].tokens),s&32&&(u.renderers=r[5]),e.$set(u)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){z(e,r),r&&_(t)}}}function ks(i){let e,t,n;const r=[i[18]];var s=i[5].unorderedlistitem||i[5].listitem;function u(a){let o={$$slots:{default:[Jf]},$$scope:{ctx:a}};for(let l=0;l<r.length;l+=1)o=Ye(o,r[l]);return{props:o}}return s&&(e=De(s,u(i))),{c(){e&&W(e.$$.fragment),t=J()},m(a,o){e&&U(e,a,o),A(a,t,o),n=!0},p(a,o){const l=o&64?en(r,[tn(a[18])]):{};if(o&8388704&&(l.$$scope={dirty:o,ctx:a}),s!==(s=a[5].unorderedlistitem||a[5].listitem)){if(e){H();const c=e;C(c.$$.fragment,1,0,()=>{z(c,1)}),q()}s?(e=De(s,u(a)),W(e.$$.fragment),y(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else s&&e.$set(l)},i(a){n||(e&&y(e.$$.fragment,a),n=!0)},o(a){e&&C(e.$$.fragment,a),n=!1},d(a){a&&_(t),e&&z(e,a)}}}function eh(i){let e,t,n=i[6].items,r=[];for(let u=0;u<n.length;u+=1)r[u]=ks(ws(i,n,u));const s=u=>C(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=J()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);A(u,e,a),t=!0},p(u,a){if(a&96){n=u[6].items;let o;for(o=0;o<n.length;o+=1){const l=ws(u,n,o);r[o]?(r[o].p(l,a),y(r[o],1)):(r[o]=ks(l),r[o].c(),y(r[o],1),r[o].m(e.parentNode,e))}for(H(),o=n.length;o<r.length;o+=1)s(o);q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)y(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)C(r[a]);t=!1},d(u){Yt(r,u),u&&_(e)}}}function th(i){let e,t,n;return e=new sn({props:{tokens:i[18].tokens,renderers:i[5]}}),{c(){W(e.$$.fragment),t=P()},m(r,s){U(e,r,s),A(r,t,s),n=!0},p(r,s){const u={};s&64&&(u.tokens=r[18].tokens),s&32&&(u.renderers=r[5]),e.$set(u)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){z(e,r),r&&_(t)}}}function Fs(i){let e,t,n;const r=[i[18]];var s=i[5].orderedlistitem||i[5].listitem;function u(a){let o={$$slots:{default:[th]},$$scope:{ctx:a}};for(let l=0;l<r.length;l+=1)o=Ye(o,r[l]);return{props:o}}return s&&(e=De(s,u(i))),{c(){e&&W(e.$$.fragment),t=J()},m(a,o){e&&U(e,a,o),A(a,t,o),n=!0},p(a,o){const l=o&64?en(r,[tn(a[18])]):{};if(o&8388704&&(l.$$scope={dirty:o,ctx:a}),s!==(s=a[5].orderedlistitem||a[5].listitem)){if(e){H();const c=e;C(c.$$.fragment,1,0,()=>{z(c,1)}),q()}s?(e=De(s,u(a)),W(e.$$.fragment),y(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else s&&e.$set(l)},i(a){n||(e&&y(e.$$.fragment,a),n=!0)},o(a){e&&C(e.$$.fragment,a),n=!1},d(a){a&&_(t),e&&z(e,a)}}}function nh(i){let e,t,n=i[6].items,r=[];for(let u=0;u<n.length;u+=1)r[u]=Fs(_s(i,n,u));const s=u=>C(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=J()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);A(u,e,a),t=!0},p(u,a){if(a&96){n=u[6].items;let o;for(o=0;o<n.length;o+=1){const l=_s(u,n,o);r[o]?(r[o].p(l,a),y(r[o],1)):(r[o]=Fs(l),r[o].c(),y(r[o],1),r[o].m(e.parentNode,e))}for(H(),o=n.length;o<r.length;o+=1)s(o);q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)y(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)C(r[a]);t=!1},d(u){Yt(r,u),u&&_(e)}}}function rh(i){let e,t,n;return e=new sn({props:{tokens:i[16].tokens,renderers:i[5]}}),{c(){W(e.$$.fragment),t=P()},m(r,s){U(e,r,s),A(r,t,s),n=!0},p(r,s){const u={};s&4&&(u.tokens=r[16].tokens),s&32&&(u.renderers=r[5]),e.$set(u)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){z(e,r),r&&_(t)}}}function vs(i){let e,t,n;var r=i[5].tablecell;function s(u){return{props:{header:!0,align:u[6].align[u[15]]||"center",$$slots:{default:[rh]},$$scope:{ctx:u}}}}return r&&(e=De(r,s(i))),{c(){e&&W(e.$$.fragment),t=J()},m(u,a){e&&U(e,u,a),A(u,t,a),n=!0},p(u,a){const o={};if(a&64&&(o.align=u[6].align[u[15]]||"center"),a&8388644&&(o.$$scope={dirty:a,ctx:u}),r!==(r=u[5].tablecell)){if(e){H();const l=e;C(l.$$.fragment,1,0,()=>{z(l,1)}),q()}r?(e=De(r,s(u)),W(e.$$.fragment),y(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else r&&e.$set(o)},i(u){n||(e&&y(e.$$.fragment,u),n=!0)},o(u){e&&C(e.$$.fragment,u),n=!1},d(u){u&&_(t),e&&z(e,u)}}}function ih(i){let e,t,n=i[2],r=[];for(let u=0;u<n.length;u+=1)r[u]=vs(Cs(i,n,u));const s=u=>C(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=J()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);A(u,e,a),t=!0},p(u,a){if(a&100){n=u[2];let o;for(o=0;o<n.length;o+=1){const l=Cs(u,n,o);r[o]?(r[o].p(l,a),y(r[o],1)):(r[o]=vs(l),r[o].c(),y(r[o],1),r[o].m(e.parentNode,e))}for(H(),o=n.length;o<r.length;o+=1)s(o);q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)y(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)C(r[a]);t=!1},d(u){Yt(r,u),u&&_(e)}}}function sh(i){let e,t,n;var r=i[5].tablerow;function s(u){return{props:{$$slots:{default:[ih]},$$scope:{ctx:u}}}}return r&&(e=De(r,s(i))),{c(){e&&W(e.$$.fragment),t=J()},m(u,a){e&&U(e,u,a),A(u,t,a),n=!0},p(u,a){const o={};if(a&8388708&&(o.$$scope={dirty:a,ctx:u}),r!==(r=u[5].tablerow)){if(e){H();const l=e;C(l.$$.fragment,1,0,()=>{z(l,1)}),q()}r?(e=De(r,s(u)),W(e.$$.fragment),y(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else r&&e.$set(o)},i(u){n||(e&&y(e.$$.fragment,u),n=!0)},o(u){e&&C(e.$$.fragment,u),n=!1},d(u){u&&_(t),e&&z(e,u)}}}function uh(i){let e,t;return e=new sn({props:{tokens:i[13].tokens,renderers:i[5]}}),{c(){W(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,r){const s={};r&8&&(s.tokens=n[13].tokens),r&32&&(s.renderers=n[5]),e.$set(s)},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function Bs(i){let e,t,n;var r=i[5].tablecell;function s(u){return{props:{header:!1,align:u[6].align[u[15]]||"center",$$slots:{default:[uh]},$$scope:{ctx:u}}}}return r&&(e=De(r,s(i))),{c(){e&&W(e.$$.fragment),t=J()},m(u,a){e&&U(e,u,a),A(u,t,a),n=!0},p(u,a){const o={};if(a&64&&(o.align=u[6].align[u[15]]||"center"),a&8388648&&(o.$$scope={dirty:a,ctx:u}),r!==(r=u[5].tablecell)){if(e){H();const l=e;C(l.$$.fragment,1,0,()=>{z(l,1)}),q()}r?(e=De(r,s(u)),W(e.$$.fragment),y(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else r&&e.$set(o)},i(u){n||(e&&y(e.$$.fragment,u),n=!0)},o(u){e&&C(e.$$.fragment,u),n=!1},d(u){u&&_(t),e&&z(e,u)}}}function ah(i){let e,t,n=i[10],r=[];for(let u=0;u<n.length;u+=1)r[u]=Bs(As(i,n,u));const s=u=>C(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=P()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);A(u,e,a),t=!0},p(u,a){if(a&104){n=u[10];let o;for(o=0;o<n.length;o+=1){const l=As(u,n,o);r[o]?(r[o].p(l,a),y(r[o],1)):(r[o]=Bs(l),r[o].c(),y(r[o],1),r[o].m(e.parentNode,e))}for(H(),o=n.length;o<r.length;o+=1)s(o);q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)y(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)C(r[a]);t=!1},d(u){Yt(r,u),u&&_(e)}}}function Ss(i){let e,t,n;var r=i[5].tablerow;function s(u){return{props:{$$slots:{default:[ah]},$$scope:{ctx:u}}}}return r&&(e=De(r,s(i))),{c(){e&&W(e.$$.fragment),t=J()},m(u,a){e&&U(e,u,a),A(u,t,a),n=!0},p(u,a){const o={};if(a&8388712&&(o.$$scope={dirty:a,ctx:u}),r!==(r=u[5].tablerow)){if(e){H();const l=e;C(l.$$.fragment,1,0,()=>{z(l,1)}),q()}r?(e=De(r,s(u)),W(e.$$.fragment),y(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else r&&e.$set(o)},i(u){n||(e&&y(e.$$.fragment,u),n=!0)},o(u){e&&C(e.$$.fragment,u),n=!1},d(u){u&&_(t),e&&z(e,u)}}}function oh(i){let e,t,n=i[3],r=[];for(let u=0;u<n.length;u+=1)r[u]=Ss(ys(i,n,u));const s=u=>C(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=J()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);A(u,e,a),t=!0},p(u,a){if(a&104){n=u[3];let o;for(o=0;o<n.length;o+=1){const l=ys(u,n,o);r[o]?(r[o].p(l,a),y(r[o],1)):(r[o]=Ss(l),r[o].c(),y(r[o],1),r[o].m(e.parentNode,e))}for(H(),o=n.length;o<r.length;o+=1)s(o);q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)y(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)C(r[a]);t=!1},d(u){Yt(r,u),u&&_(e)}}}function lh(i){let e,t,n,r,s;var u=i[5].tablehead;function a(c){return{props:{$$slots:{default:[sh]},$$scope:{ctx:c}}}}u&&(e=De(u,a(i)));var o=i[5].tablebody;function l(c){return{props:{$$slots:{default:[oh]},$$scope:{ctx:c}}}}return o&&(n=De(o,l(i))),{c(){e&&W(e.$$.fragment),t=P(),n&&W(n.$$.fragment),r=J()},m(c,f){e&&U(e,c,f),A(c,t,f),n&&U(n,c,f),A(c,r,f),s=!0},p(c,f){const h={};if(f&8388708&&(h.$$scope={dirty:f,ctx:c}),u!==(u=c[5].tablehead)){if(e){H();const p=e;C(p.$$.fragment,1,0,()=>{z(p,1)}),q()}u?(e=De(u,a(c)),W(e.$$.fragment),y(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else u&&e.$set(h);const d={};if(f&8388712&&(d.$$scope={dirty:f,ctx:c}),o!==(o=c[5].tablebody)){if(n){H();const p=n;C(p.$$.fragment,1,0,()=>{z(p,1)}),q()}o?(n=De(o,l(c)),W(n.$$.fragment),y(n.$$.fragment,1),U(n,r.parentNode,r)):n=null}else o&&n.$set(d)},i(c){s||(e&&y(e.$$.fragment,c),n&&y(n.$$.fragment,c),s=!0)},o(c){e&&C(e.$$.fragment,c),n&&C(n.$$.fragment,c),s=!1},d(c){e&&z(e,c),c&&_(t),c&&_(r),n&&z(n,c)}}}function Ts(i){let e,t;const n=[i[7],{renderers:i[5]}];let r={};for(let s=0;s<n.length;s+=1)r=Ye(r,n[s]);return e=new sn({props:r}),{c(){W(e.$$.fragment)},m(s,u){U(e,s,u),t=!0},p(s,u){const a=u&34?en(n,[u&2&&tn(s[7]),u&32&&{renderers:s[5]}]):{};e.$set(a)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){C(e.$$.fragment,s),t=!1},d(s){z(e,s)}}}function ch(i){let e,t,n,r;const s=[qf,Hf],u=[];function a(o,l){return o[0]?o[5][o[0]]?1:-1:0}return~(e=a(i))&&(t=u[e]=s[e](i)),{c(){t&&t.c(),n=J()},m(o,l){~e&&u[e].m(o,l),A(o,n,l),r=!0},p(o,[l]){let c=e;e=a(o),e===c?~e&&u[e].p(o,l):(t&&(H(),C(u[c],1,1,()=>{u[c]=null}),q()),~e?(t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),y(t,1),t.m(n.parentNode,n)):t=null)},i(o){r||(y(t),r=!0)},o(o){C(t),r=!1},d(o){~e&&u[e].d(o),o&&_(n)}}}function fh(i,e,t){const n=["type","tokens","header","rows","ordered","renderers"];let r=Fi(e,n),{type:s=void 0}=e,{tokens:u=void 0}=e,{header:a=void 0}=e,{rows:o=void 0}=e,{ordered:l=!1}=e,{renderers:c}=e;return zf(),i.$$set=f=>{e=Ye(Ye({},e),qr(f)),t(6,r=Fi(e,n)),"type"in f&&t(0,s=f.type),"tokens"in f&&t(1,u=f.tokens),"header"in f&&t(2,a=f.header),"rows"in f&&t(3,o=f.rows),"ordered"in f&&t(4,l=f.ordered),"renderers"in f&&t(5,c=f.renderers)},[s,u,a,o,l,c,r]}let sn=class extends re{constructor(e){super(),ne(this,e,fh,ch,te,{type:0,tokens:1,header:2,rows:3,ordered:4,renderers:5})}};function za(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let Tn=za();function hh(i){Tn=i}const Ha=/[&<>"']/,dh=new RegExp(Ha.source,"g"),qa=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,ph=new RegExp(qa.source,"g"),Dh={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ps=i=>Dh[i];function Pe(i,e){if(e){if(Ha.test(i))return i.replace(dh,Ps)}else if(qa.test(i))return i.replace(ph,Ps);return i}const mh=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function Wa(i){return i.replace(mh,(e,t)=>(t=t.toLowerCase(),t==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}const gh=/(^|[^\[])\^/g;function le(i,e){i=typeof i=="string"?i:i.source,e=e||"";const t={replace:(n,r)=>(r=r.source||r,r=r.replace(gh,"$1"),i=i.replace(n,r),t),getRegex:()=>new RegExp(i,e)};return t}const bh=/[^\w:]/g,wh=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function Is(i,e,t){if(i){let n;try{n=decodeURIComponent(Wa(t)).replace(bh,"").toLowerCase()}catch{return null}if(n.indexOf("javascript:")===0||n.indexOf("vbscript:")===0||n.indexOf("data:")===0)return null}e&&!wh.test(t)&&(t=Ch(e,t));try{t=encodeURI(t).replace(/%25/g,"%")}catch{return null}return t}const ur={},_h=/^[^:]+:\/*[^/]*$/,yh=/^([^:]+:)[\s\S]*$/,Ah=/^([^:]+:\/*[^/]*)[\s\S]*$/;function Ch(i,e){ur[" "+i]||(_h.test(i)?ur[" "+i]=i+"/":ur[" "+i]=lr(i,"/",!0)),i=ur[" "+i];const t=i.indexOf(":")===-1;return e.substring(0,2)==="//"?t?e:i.replace(yh,"$1")+e:e.charAt(0)==="/"?t?e:i.replace(Ah,"$1")+e:i+e}const gr={exec:function(){}};function rt(i){let e=1,t,n;for(;e<arguments.length;e++){t=arguments[e];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i}function Rs(i,e){const t=i.replace(/\|/g,(s,u,a)=>{let o=!1,l=u;for(;--l>=0&&a[l]==="\\";)o=!o;return o?"|":" |"}),n=t.split(/ \|/);let r=0;if(n[0].trim()||n.shift(),n.length>0&&!n[n.length-1].trim()&&n.pop(),n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;r<n.length;r++)n[r]=n[r].trim().replace(/\\\|/g,"|");return n}function lr(i,e,t){const n=i.length;if(n===0)return"";let r=0;for(;r<n;){const s=i.charAt(n-r-1);if(s===e&&!t)r++;else if(s!==e&&t)r++;else break}return i.slice(0,n-r)}function Eh(i,e){if(i.indexOf(e[1])===-1)return-1;const t=i.length;let n=0,r=0;for(;r<t;r++)if(i[r]==="\\")r++;else if(i[r]===e[0])n++;else if(i[r]===e[1]&&(n--,n<0))return r;return-1}function Qa(i){i&&i.sanitize&&!i.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function xs(i,e){if(e<1)return"";let t="";for(;e>1;)e&1&&(t+=i),e>>=1,i+=i;return t+i}function Os(i,e,t,n){const r=e.href,s=e.title?Pe(e.title):null,u=i[1].replace(/\\([\[\]])/g,"$1");if(i[0].charAt(0)!=="!"){n.state.inLink=!0;const a={type:"link",raw:t,href:r,title:s,text:u,tokens:n.inlineTokens(u)};return n.state.inLink=!1,a}return{type:"image",raw:t,href:r,title:s,text:Pe(u)}}function kh(i,e){const t=i.match(/^(\s+)(?:```)/);if(t===null)return e;const n=t[1];return e.split(`
`).map(r=>{const s=r.match(/^\s+/);if(s===null)return r;const[u]=s;return u.length>=n.length?r.slice(n.length):r}).join(`
`)}class yi{constructor(e){this.options=e||Tn}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const n=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:lr(n,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const n=t[0],r=kh(n,t[3]||"");return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline._escapes,"$1"):t[2],text:r}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(/#$/.test(n)){const r=lr(n,"#");(this.options.pedantic||!r||/ $/.test(r))&&(n=r.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){const n=t[0].replace(/^ *>[ \t]?/gm,""),r=this.lexer.state.top;this.lexer.state.top=!0;const s=this.lexer.blockTokens(n);return this.lexer.state.top=r,{type:"blockquote",raw:t[0],tokens:s,text:n}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n,r,s,u,a,o,l,c,f,h,d,p,D=t[1].trim();const g=D.length>1,m={type:"list",raw:"",ordered:g,start:g?+D.slice(0,-1):"",loose:!1,items:[]};D=g?`\\d{1,9}\\${D.slice(-1)}`:`\\${D}`,this.options.pedantic&&(D=g?D:"[*+-]");const E=new RegExp(`^( {0,3}${D})((?:[	 ][^\\n]*)?(?:\\n|$))`);for(;e&&(p=!1,!(!(t=E.exec(e))||this.rules.block.hr.test(e)));){if(n=t[0],e=e.substring(n.length),c=t[2].split(`
`,1)[0].replace(/^\t+/,F=>" ".repeat(3*F.length)),f=e.split(`
`,1)[0],this.options.pedantic?(u=2,d=c.trimLeft()):(u=t[2].search(/[^ ]/),u=u>4?1:u,d=c.slice(u),u+=t[1].length),o=!1,!c&&/^ *$/.test(f)&&(n+=f+`
`,e=e.substring(f.length+1),p=!0),!p){const F=new RegExp(`^ {0,${Math.min(3,u-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),v=new RegExp(`^ {0,${Math.min(3,u-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),x=new RegExp(`^ {0,${Math.min(3,u-1)}}(?:\`\`\`|~~~)`),S=new RegExp(`^ {0,${Math.min(3,u-1)}}#`);for(;e&&(h=e.split(`
`,1)[0],f=h,this.options.pedantic&&(f=f.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(x.test(f)||S.test(f)||F.test(f)||v.test(e)));){if(f.search(/[^ ]/)>=u||!f.trim())d+=`
`+f.slice(u);else{if(o||c.search(/[^ ]/)>=4||x.test(c)||S.test(c)||v.test(c))break;d+=`
`+f}!o&&!f.trim()&&(o=!0),n+=h+`
`,e=e.substring(h.length+1),c=f.slice(u)}}m.loose||(l?m.loose=!0:/\n *\n *$/.test(n)&&(l=!0)),this.options.gfm&&(r=/^\[[ xX]\] /.exec(d),r&&(s=r[0]!=="[ ] ",d=d.replace(/^\[[ xX]\] +/,""))),m.items.push({type:"list_item",raw:n,task:!!r,checked:s,loose:!1,text:d}),m.raw+=n}m.items[m.items.length-1].raw=n.trimRight(),m.items[m.items.length-1].text=d.trimRight(),m.raw=m.raw.trimRight();const B=m.items.length;for(a=0;a<B;a++)if(this.lexer.state.top=!1,m.items[a].tokens=this.lexer.blockTokens(m.items[a].text,[]),!m.loose){const F=m.items[a].tokens.filter(x=>x.type==="space"),v=F.length>0&&F.some(x=>/\n.*\n/.test(x.raw));m.loose=v}if(m.loose)for(a=0;a<B;a++)m.items[a].loose=!0;return m}}html(e){const t=this.rules.block.html.exec(e);if(t){const n={type:"html",raw:t[0],pre:!this.options.sanitizer&&(t[1]==="pre"||t[1]==="script"||t[1]==="style"),text:t[0]};if(this.options.sanitize){const r=this.options.sanitizer?this.options.sanitizer(t[0]):Pe(t[0]);n.type="paragraph",n.text=r,n.tokens=this.lexer.inline(r)}return n}}def(e){const t=this.rules.block.def.exec(e);if(t){const n=t[1].toLowerCase().replace(/\s+/g," "),r=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",s=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline._escapes,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:r,title:s}}}table(e){const t=this.rules.block.table.exec(e);if(t){const n={type:"table",header:Rs(t[1]).map(r=>({text:r})),align:t[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(n.header.length===n.align.length){n.raw=t[0];let r=n.align.length,s,u,a,o;for(s=0;s<r;s++)/^ *-+: *$/.test(n.align[s])?n.align[s]="right":/^ *:-+: *$/.test(n.align[s])?n.align[s]="center":/^ *:-+ *$/.test(n.align[s])?n.align[s]="left":n.align[s]=null;for(r=n.rows.length,s=0;s<r;s++)n.rows[s]=Rs(n.rows[s],n.header.length).map(l=>({text:l}));for(r=n.header.length,u=0;u<r;u++)n.header[u].tokens=this.lexer.inline(n.header[u].text);for(r=n.rows.length,u=0;u<r;u++)for(o=n.rows[u],a=0;a<o.length;a++)o[a].tokens=this.lexer.inline(o[a].text);return n}}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:Pe(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(t[0]):Pe(t[0]):t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const n=t[2].trim();if(!this.options.pedantic&&/^</.test(n)){if(!/>$/.test(n))return;const u=lr(n.slice(0,-1),"\\");if((n.length-u.length)%2===0)return}else{const u=Eh(t[2],"()");if(u>-1){const o=(t[0].indexOf("!")===0?5:4)+t[1].length+u;t[2]=t[2].substring(0,u),t[0]=t[0].substring(0,o).trim(),t[3]=""}}let r=t[2],s="";if(this.options.pedantic){const u=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(r);u&&(r=u[1],s=u[3])}else s=t[3]?t[3].slice(1,-1):"";return r=r.trim(),/^</.test(r)&&(this.options.pedantic&&!/>$/.test(n)?r=r.slice(1):r=r.slice(1,-1)),Os(t,{href:r&&r.replace(this.rules.inline._escapes,"$1"),title:s&&s.replace(this.rules.inline._escapes,"$1")},t[0],this.lexer)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){let r=(n[2]||n[1]).replace(/\s+/g," ");if(r=t[r.toLowerCase()],!r){const s=n[0].charAt(0);return{type:"text",raw:s,text:s}}return Os(n,r,n[0],this.lexer)}}emStrong(e,t,n=""){let r=this.rules.inline.emStrong.lDelim.exec(e);if(!r||r[3]&&n.match(/[\p{L}\p{N}]/u))return;const s=r[1]||r[2]||"";if(!s||s&&(n===""||this.rules.inline.punctuation.exec(n))){const u=r[0].length-1;let a,o,l=u,c=0;const f=r[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(f.lastIndex=0,t=t.slice(-1*e.length+u);(r=f.exec(t))!=null;){if(a=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!a)continue;if(o=a.length,r[3]||r[4]){l+=o;continue}else if((r[5]||r[6])&&u%3&&!((u+o)%3)){c+=o;continue}if(l-=o,l>0)continue;o=Math.min(o,o+l+c);const h=e.slice(0,u+r.index+(r[0].length-a.length)+o);if(Math.min(u,o)%2){const p=h.slice(1,-1);return{type:"em",raw:h,text:p,tokens:this.lexer.inlineTokens(p)}}const d=h.slice(2,-2);return{type:"strong",raw:h,text:d,tokens:this.lexer.inlineTokens(d)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(/\n/g," ");const r=/[^ ]/.test(n),s=/^ /.test(n)&&/ $/.test(n);return r&&s&&(n=n.substring(1,n.length-1)),n=Pe(n,!0),{type:"codespan",raw:t[0],text:n}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e,t){const n=this.rules.inline.autolink.exec(e);if(n){let r,s;return n[2]==="@"?(r=Pe(this.options.mangle?t(n[1]):n[1]),s="mailto:"+r):(r=Pe(n[1]),s=r),{type:"link",raw:n[0],text:r,href:s,tokens:[{type:"text",raw:r,text:r}]}}}url(e,t){let n;if(n=this.rules.inline.url.exec(e)){let r,s;if(n[2]==="@")r=Pe(this.options.mangle?t(n[0]):n[0]),s="mailto:"+r;else{let u;do u=n[0],n[0]=this.rules.inline._backpedal.exec(n[0])[0];while(u!==n[0]);r=Pe(n[0]),n[1]==="www."?s="http://"+n[0]:s=n[0]}return{type:"link",raw:n[0],text:r,href:s,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(e,t){const n=this.rules.inline.text.exec(e);if(n){let r;return this.lexer.state.inRawBlock?r=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(n[0]):Pe(n[0]):n[0]:r=Pe(this.options.smartypants?t(n[0]):n[0]),{type:"text",raw:n[0],text:r}}}}const V={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:gr,lheading:/^((?:.|\n(?!\n))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};V._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;V._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;V.def=le(V.def).replace("label",V._label).replace("title",V._title).getRegex();V.bullet=/(?:[*+-]|\d{1,9}[.)])/;V.listItemStart=le(/^( *)(bull) */).replace("bull",V.bullet).getRegex();V.list=le(V.list).replace(/bull/g,V.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+V.def.source+")").getRegex();V._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";V._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;V.html=le(V.html,"i").replace("comment",V._comment).replace("tag",V._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();V.paragraph=le(V._paragraph).replace("hr",V.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",V._tag).getRegex();V.blockquote=le(V.blockquote).replace("paragraph",V.paragraph).getRegex();V.normal=rt({},V);V.gfm=rt({},V.normal,{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"});V.gfm.table=le(V.gfm.table).replace("hr",V.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",V._tag).getRegex();V.gfm.paragraph=le(V._paragraph).replace("hr",V.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",V.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",V._tag).getRegex();V.pedantic=rt({},V.normal,{html:le(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",V._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:gr,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:le(V.normal._paragraph).replace("hr",V.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",V.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});const L={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:gr,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^(?:[^_*\\]|\\.)*?\_\_(?:[^_*\\]|\\.)*?\*(?:[^_*\\]|\\.)*?(?=\_\_)|(?:[^*\\]|\\.)+(?=[^*])|[punct_](\*+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|(?:[^punct*_\s\\]|\\.)(\*+)(?=[^punct*_\s])/,rDelimUnd:/^(?:[^_*\\]|\\.)*?\*\*(?:[^_*\\]|\\.)*?\_(?:[^_*\\]|\\.)*?(?=\*\*)|(?:[^_\\]|\\.)+(?=[^_])|[punct*](\_+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:gr,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};L._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~";L.punctuation=le(L.punctuation).replace(/punctuation/g,L._punctuation).getRegex();L.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;L.escapedEmSt=/(?:^|[^\\])(?:\\\\)*\\[*_]/g;L._comment=le(V._comment).replace("(?:-->|$)","-->").getRegex();L.emStrong.lDelim=le(L.emStrong.lDelim).replace(/punct/g,L._punctuation).getRegex();L.emStrong.rDelimAst=le(L.emStrong.rDelimAst,"g").replace(/punct/g,L._punctuation).getRegex();L.emStrong.rDelimUnd=le(L.emStrong.rDelimUnd,"g").replace(/punct/g,L._punctuation).getRegex();L._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;L._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;L._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;L.autolink=le(L.autolink).replace("scheme",L._scheme).replace("email",L._email).getRegex();L._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;L.tag=le(L.tag).replace("comment",L._comment).replace("attribute",L._attribute).getRegex();L._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;L._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;L._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;L.link=le(L.link).replace("label",L._label).replace("href",L._href).replace("title",L._title).getRegex();L.reflink=le(L.reflink).replace("label",L._label).replace("ref",V._label).getRegex();L.nolink=le(L.nolink).replace("ref",V._label).getRegex();L.reflinkSearch=le(L.reflinkSearch,"g").replace("reflink",L.reflink).replace("nolink",L.nolink).getRegex();L.normal=rt({},L);L.pedantic=rt({},L.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:le(/^!?\[(label)\]\((.*?)\)/).replace("label",L._label).getRegex(),reflink:le(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",L._label).getRegex()});L.gfm=rt({},L.normal,{escape:le(L.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/});L.gfm.url=le(L.gfm.url,"i").replace("email",L.gfm._extended_email).getRegex();L.breaks=rt({},L.gfm,{br:le(L.br).replace("{2,}","*").getRegex(),text:le(L.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});function Fh(i){return i.replace(/---/g,"").replace(/--/g,"").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1").replace(/'/g,"").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1").replace(/"/g,"").replace(/\.{3}/g,"")}function $s(i){let e="",t,n;const r=i.length;for(t=0;t<r;t++)n=i.charCodeAt(t),Math.random()>.5&&(n="x"+n.toString(16)),e+="&#"+n+";";return e}class ot{constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Tn,this.options.tokenizer=this.options.tokenizer||new yi,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:V.normal,inline:L.normal};this.options.pedantic?(t.block=V.pedantic,t.inline=L.pedantic):this.options.gfm&&(t.block=V.gfm,this.options.breaks?t.inline=L.breaks:t.inline=L.gfm),this.tokenizer.rules=t}static get rules(){return{block:V,inline:L}}static lex(e,t){return new ot(t).lex(e)}static lexInline(e,t){return new ot(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);let t;for(;t=this.inlineQueue.shift();)this.inlineTokens(t.src,t.tokens);return this.tokens}blockTokens(e,t=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(a,o,l)=>o+"    ".repeat(l.length));let n,r,s,u;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(a=>(n=a.call({lexer:this},e,t))?(e=e.substring(n.raw.length),t.push(n),!0):!1))){if(n=this.tokenizer.space(e)){e=e.substring(n.raw.length),n.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(n);continue}if(n=this.tokenizer.code(e)){e=e.substring(n.raw.length),r=t[t.length-1],r&&(r.type==="paragraph"||r.type==="text")?(r.raw+=`
`+n.raw,r.text+=`
`+n.text,this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(n);continue}if(n=this.tokenizer.fences(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.heading(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.hr(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.blockquote(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.list(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.html(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.def(e)){e=e.substring(n.raw.length),r=t[t.length-1],r&&(r.type==="paragraph"||r.type==="text")?(r.raw+=`
`+n.raw,r.text+=`
`+n.raw,this.inlineQueue[this.inlineQueue.length-1].src=r.text):this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title});continue}if(n=this.tokenizer.table(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.lheading(e)){e=e.substring(n.raw.length),t.push(n);continue}if(s=e,this.options.extensions&&this.options.extensions.startBlock){let a=1/0;const o=e.slice(1);let l;this.options.extensions.startBlock.forEach(function(c){l=c.call({lexer:this},o),typeof l=="number"&&l>=0&&(a=Math.min(a,l))}),a<1/0&&a>=0&&(s=e.substring(0,a+1))}if(this.state.top&&(n=this.tokenizer.paragraph(s))){r=t[t.length-1],u&&r.type==="paragraph"?(r.raw+=`
`+n.raw,r.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(n),u=s.length!==e.length,e=e.substring(n.raw.length);continue}if(n=this.tokenizer.text(e)){e=e.substring(n.raw.length),r=t[t.length-1],r&&r.type==="text"?(r.raw+=`
`+n.raw,r.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(n);continue}if(e){const a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n,r,s,u=e,a,o,l;if(this.tokens.links){const c=Object.keys(this.tokens.links);if(c.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(u))!=null;)c.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(u=u.slice(0,a.index)+"["+xs("a",a[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.blockSkip.exec(u))!=null;)u=u.slice(0,a.index)+"["+xs("a",a[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(a=this.tokenizer.rules.inline.escapedEmSt.exec(u))!=null;)u=u.slice(0,a.index+a[0].length-2)+"++"+u.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex),this.tokenizer.rules.inline.escapedEmSt.lastIndex--;for(;e;)if(o||(l=""),o=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(c=>(n=c.call({lexer:this},e,t))?(e=e.substring(n.raw.length),t.push(n),!0):!1))){if(n=this.tokenizer.escape(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.tag(e)){e=e.substring(n.raw.length),r=t[t.length-1],r&&n.type==="text"&&r.type==="text"?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if(n=this.tokenizer.link(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(n.raw.length),r=t[t.length-1],r&&n.type==="text"&&r.type==="text"?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if(n=this.tokenizer.emStrong(e,u,l)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.codespan(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.br(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.del(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.autolink(e,$s)){e=e.substring(n.raw.length),t.push(n);continue}if(!this.state.inLink&&(n=this.tokenizer.url(e,$s))){e=e.substring(n.raw.length),t.push(n);continue}if(s=e,this.options.extensions&&this.options.extensions.startInline){let c=1/0;const f=e.slice(1);let h;this.options.extensions.startInline.forEach(function(d){h=d.call({lexer:this},f),typeof h=="number"&&h>=0&&(c=Math.min(c,h))}),c<1/0&&c>=0&&(s=e.substring(0,c+1))}if(n=this.tokenizer.inlineText(s,Fh)){e=e.substring(n.raw.length),n.raw.slice(-1)!=="_"&&(l=n.raw.slice(-1)),o=!0,r=t[t.length-1],r&&r.type==="text"?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if(e){const c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return t}}class Ai{constructor(e){this.options=e||Tn}code(e,t,n){const r=(t||"").match(/\S*/)[0];if(this.options.highlight){const s=this.options.highlight(e,r);s!=null&&s!==e&&(n=!0,e=s)}return e=e.replace(/\n$/,"")+`
`,r?'<pre><code class="'+this.options.langPrefix+Pe(r)+'">'+(n?e:Pe(e,!0))+`</code></pre>
`:"<pre><code>"+(n?e:Pe(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e){return e}heading(e,t,n,r){if(this.options.headerIds){const s=this.options.headerPrefix+r.slug(n);return`<h${t} id="${s}">${e}</h${t}>
`}return`<h${t}>${e}</h${t}>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(e,t,n){const r=t?"ol":"ul",s=t&&n!==1?' start="'+n+'"':"";return"<"+r+s+`>
`+e+"</"+r+`>
`}listitem(e){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(e){return`<p>${e}</p>
`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+t+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,t){const n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(e){return`<del>${e}</del>`}link(e,t,n){if(e=Is(this.options.sanitize,this.options.baseUrl,e),e===null)return n;let r='<a href="'+e+'"';return t&&(r+=' title="'+t+'"'),r+=">"+n+"</a>",r}image(e,t,n){if(e=Is(this.options.sanitize,this.options.baseUrl,e),e===null)return n;let r=`<img src="${e}" alt="${n}"`;return t&&(r+=` title="${t}"`),r+=this.options.xhtml?"/>":">",r}text(e){return e}}class Ka{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,n){return""+n}image(e,t,n){return""+n}br(){return""}}class Ci{constructor(){this.seen={}}serialize(e){return e.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(e,t){let n=e,r=0;if(this.seen.hasOwnProperty(n)){r=this.seen[e];do r++,n=e+"-"+r;while(this.seen.hasOwnProperty(n))}return t||(this.seen[e]=r,this.seen[n]=0),n}slug(e,t={}){const n=this.serialize(e);return this.getNextSafeSlug(n,t.dryrun)}}class ut{constructor(e){this.options=e||Tn,this.options.renderer=this.options.renderer||new Ai,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new Ka,this.slugger=new Ci}static parse(e,t){return new ut(t).parse(e)}static parseInline(e,t){return new ut(t).parseInline(e)}parse(e,t=!0){let n="",r,s,u,a,o,l,c,f,h,d,p,D,g,m,E,B,F,v,x;const S=e.length;for(r=0;r<S;r++){if(d=e[r],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[d.type]&&(x=this.options.extensions.renderers[d.type].call({parser:this},d),x!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(d.type))){n+=x||"";continue}switch(d.type){case"space":continue;case"hr":{n+=this.renderer.hr();continue}case"heading":{n+=this.renderer.heading(this.parseInline(d.tokens),d.depth,Wa(this.parseInline(d.tokens,this.textRenderer)),this.slugger);continue}case"code":{n+=this.renderer.code(d.text,d.lang,d.escaped);continue}case"table":{for(f="",c="",a=d.header.length,s=0;s<a;s++)c+=this.renderer.tablecell(this.parseInline(d.header[s].tokens),{header:!0,align:d.align[s]});for(f+=this.renderer.tablerow(c),h="",a=d.rows.length,s=0;s<a;s++){for(l=d.rows[s],c="",o=l.length,u=0;u<o;u++)c+=this.renderer.tablecell(this.parseInline(l[u].tokens),{header:!1,align:d.align[u]});h+=this.renderer.tablerow(c)}n+=this.renderer.table(f,h);continue}case"blockquote":{h=this.parse(d.tokens),n+=this.renderer.blockquote(h);continue}case"list":{for(p=d.ordered,D=d.start,g=d.loose,a=d.items.length,h="",s=0;s<a;s++)E=d.items[s],B=E.checked,F=E.task,m="",E.task&&(v=this.renderer.checkbox(B),g?E.tokens.length>0&&E.tokens[0].type==="paragraph"?(E.tokens[0].text=v+" "+E.tokens[0].text,E.tokens[0].tokens&&E.tokens[0].tokens.length>0&&E.tokens[0].tokens[0].type==="text"&&(E.tokens[0].tokens[0].text=v+" "+E.tokens[0].tokens[0].text)):E.tokens.unshift({type:"text",text:v}):m+=v),m+=this.parse(E.tokens,g),h+=this.renderer.listitem(m,F,B);n+=this.renderer.list(h,p,D);continue}case"html":{n+=this.renderer.html(d.text);continue}case"paragraph":{n+=this.renderer.paragraph(this.parseInline(d.tokens));continue}case"text":{for(h=d.tokens?this.parseInline(d.tokens):d.text;r+1<S&&e[r+1].type==="text";)d=e[++r],h+=`
`+(d.tokens?this.parseInline(d.tokens):d.text);n+=t?this.renderer.paragraph(h):h;continue}default:{const R='Token with "'+d.type+'" type was not found.';if(this.options.silent){console.error(R);return}else throw new Error(R)}}}return n}parseInline(e,t){t=t||this.renderer;let n="",r,s,u;const a=e.length;for(r=0;r<a;r++){if(s=e[r],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[s.type]&&(u=this.options.extensions.renderers[s.type].call({parser:this},s),u!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type))){n+=u||"";continue}switch(s.type){case"escape":{n+=t.text(s.text);break}case"html":{n+=t.html(s.text);break}case"link":{n+=t.link(s.href,s.title,this.parseInline(s.tokens,t));break}case"image":{n+=t.image(s.href,s.title,s.text);break}case"strong":{n+=t.strong(this.parseInline(s.tokens,t));break}case"em":{n+=t.em(this.parseInline(s.tokens,t));break}case"codespan":{n+=t.codespan(s.text);break}case"br":{n+=t.br();break}case"del":{n+=t.del(this.parseInline(s.tokens,t));break}case"text":{n+=t.text(s.text);break}default:{const o='Token with "'+s.type+'" type was not found.';if(this.options.silent){console.error(o);return}else throw new Error(o)}}}return n}}function X(i,e,t){if(typeof i>"u"||i===null)throw new Error("marked(): input parameter is undefined or null");if(typeof i!="string")throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(i)+", string expected");if(typeof e=="function"&&(t=e,e=null),e=rt({},X.defaults,e||{}),Qa(e),t){const r=e.highlight;let s;try{s=ot.lex(i,e)}catch(o){return t(o)}const u=function(o){let l;if(!o)try{e.walkTokens&&X.walkTokens(s,e.walkTokens),l=ut.parse(s,e)}catch(c){o=c}return e.highlight=r,o?t(o):t(null,l)};if(!r||r.length<3||(delete e.highlight,!s.length))return u();let a=0;X.walkTokens(s,function(o){o.type==="code"&&(a++,setTimeout(()=>{r(o.text,o.lang,function(l,c){if(l)return u(l);c!=null&&c!==o.text&&(o.text=c,o.escaped=!0),a--,a===0&&u()})},0))}),a===0&&u();return}function n(r){if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,e.silent)return"<p>An error occurred:</p><pre>"+Pe(r.message+"",!0)+"</pre>";throw r}try{const r=ot.lex(i,e);if(e.walkTokens){if(e.async)return Promise.all(X.walkTokens(r,e.walkTokens)).then(()=>ut.parse(r,e)).catch(n);X.walkTokens(r,e.walkTokens)}return ut.parse(r,e)}catch(r){n(r)}}X.options=X.setOptions=function(i){return rt(X.defaults,i),hh(X.defaults),X};X.getDefaults=za;X.defaults=Tn;X.use=function(...i){const e=X.defaults.extensions||{renderers:{},childTokens:{}};i.forEach(t=>{const n=rt({},t);if(n.async=X.defaults.async||n.async,t.extensions&&(t.extensions.forEach(r=>{if(!r.name)throw new Error("extension name required");if(r.renderer){const s=e.renderers[r.name];s?e.renderers[r.name]=function(...u){let a=r.renderer.apply(this,u);return a===!1&&(a=s.apply(this,u)),a}:e.renderers[r.name]=r.renderer}if(r.tokenizer){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");e[r.level]?e[r.level].unshift(r.tokenizer):e[r.level]=[r.tokenizer],r.start&&(r.level==="block"?e.startBlock?e.startBlock.push(r.start):e.startBlock=[r.start]:r.level==="inline"&&(e.startInline?e.startInline.push(r.start):e.startInline=[r.start]))}r.childTokens&&(e.childTokens[r.name]=r.childTokens)}),n.extensions=e),t.renderer){const r=X.defaults.renderer||new Ai;for(const s in t.renderer){const u=r[s];r[s]=(...a)=>{let o=t.renderer[s].apply(r,a);return o===!1&&(o=u.apply(r,a)),o}}n.renderer=r}if(t.tokenizer){const r=X.defaults.tokenizer||new yi;for(const s in t.tokenizer){const u=r[s];r[s]=(...a)=>{let o=t.tokenizer[s].apply(r,a);return o===!1&&(o=u.apply(r,a)),o}}n.tokenizer=r}if(t.walkTokens){const r=X.defaults.walkTokens;n.walkTokens=function(s){let u=[];return u.push(t.walkTokens.call(this,s)),r&&(u=u.concat(r.call(this,s))),u}}X.setOptions(n)})};X.walkTokens=function(i,e){let t=[];for(const n of i)switch(t=t.concat(e.call(X,n)),n.type){case"table":{for(const r of n.header)t=t.concat(X.walkTokens(r.tokens,e));for(const r of n.rows)for(const s of r)t=t.concat(X.walkTokens(s.tokens,e));break}case"list":{t=t.concat(X.walkTokens(n.items,e));break}default:X.defaults.extensions&&X.defaults.extensions.childTokens&&X.defaults.extensions.childTokens[n.type]?X.defaults.extensions.childTokens[n.type].forEach(function(r){t=t.concat(X.walkTokens(n[r],e))}):n.tokens&&(t=t.concat(X.walkTokens(n.tokens,e)))}return t};X.parseInline=function(i,e){if(typeof i>"u"||i===null)throw new Error("marked.parseInline(): input parameter is undefined or null");if(typeof i!="string")throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(i)+", string expected");e=rt({},X.defaults,e||{}),Qa(e);try{const t=ot.lexInline(i,e);return e.walkTokens&&X.walkTokens(t,e.walkTokens),ut.parseInline(t,e)}catch(t){if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,e.silent)return"<p>An error occurred:</p><pre>"+Pe(t.message+"",!0)+"</pre>";throw t}};X.Parser=ut;X.parser=ut.parse;X.Renderer=Ai;X.TextRenderer=Ka;X.Lexer=ot;X.lexer=ot.lex;X.Tokenizer=yi;X.Slugger=Ci;X.parse=X;X.options;X.setOptions;X.use;X.walkTokens;X.parseInline;ut.parse;ot.lex;const Va={};function vh(i){let e;return{c(){e=K(i[1])},m(t,n){A(t,e,n)},p(t,n){n&2&&ge(e,t[1])},i:T,o:T,d(t){t&&_(e)}}}function Bh(i){let e,t;const n=i[5].default,r=fe(n,i,i[4],null);return{c(){e=b("h6"),r&&r.c(),k(e,"id",i[2])},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&16)&&de(r,n,s,s[4],t?he(n,s[4],u,null):pe(s[4]),null),(!t||u&4)&&k(e,"id",s[2])},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Sh(i){let e,t;const n=i[5].default,r=fe(n,i,i[4],null);return{c(){e=b("h5"),r&&r.c(),k(e,"id",i[2])},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&16)&&de(r,n,s,s[4],t?he(n,s[4],u,null):pe(s[4]),null),(!t||u&4)&&k(e,"id",s[2])},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Th(i){let e,t;const n=i[5].default,r=fe(n,i,i[4],null);return{c(){e=b("h4"),r&&r.c(),k(e,"id",i[2])},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&16)&&de(r,n,s,s[4],t?he(n,s[4],u,null):pe(s[4]),null),(!t||u&4)&&k(e,"id",s[2])},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Ph(i){let e,t;const n=i[5].default,r=fe(n,i,i[4],null);return{c(){e=b("h3"),r&&r.c(),k(e,"id",i[2])},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&16)&&de(r,n,s,s[4],t?he(n,s[4],u,null):pe(s[4]),null),(!t||u&4)&&k(e,"id",s[2])},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Ih(i){let e,t;const n=i[5].default,r=fe(n,i,i[4],null);return{c(){e=b("h2"),r&&r.c(),k(e,"id",i[2])},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&16)&&de(r,n,s,s[4],t?he(n,s[4],u,null):pe(s[4]),null),(!t||u&4)&&k(e,"id",s[2])},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Rh(i){let e,t;const n=i[5].default,r=fe(n,i,i[4],null);return{c(){e=b("h1"),r&&r.c(),k(e,"id",i[2])},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&16)&&de(r,n,s,s[4],t?he(n,s[4],u,null):pe(s[4]),null),(!t||u&4)&&k(e,"id",s[2])},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function xh(i){let e,t,n,r;const s=[Rh,Ih,Ph,Th,Sh,Bh,vh],u=[];function a(o,l){return o[0]===1?0:o[0]===2?1:o[0]===3?2:o[0]===4?3:o[0]===5?4:o[0]===6?5:6}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=J()},m(o,l){u[e].m(o,l),A(o,n,l),r=!0},p(o,[l]){let c=e;e=a(o),e===c?u[e].p(o,l):(H(),C(u[c],1,1,()=>{u[c]=null}),q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),y(t,1),t.m(n.parentNode,n))},i(o){r||(y(t),r=!0)},o(o){C(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function Oh(i,e,t){let n,{$$slots:r={},$$scope:s}=e,{depth:u}=e,{raw:a}=e,{text:o}=e;const{slug:l,getOptions:c}=po(Va),f=c();return i.$$set=h=>{"depth"in h&&t(0,u=h.depth),"raw"in h&&t(1,a=h.raw),"text"in h&&t(3,o=h.text),"$$scope"in h&&t(4,s=h.$$scope)},i.$$.update=()=>{i.$$.dirty&8&&t(2,n=f.headerIds?f.headerPrefix+l(o):void 0)},[u,a,n,o,s,r]}class $h extends re{constructor(e){super(),ne(this,e,Oh,xh,te,{depth:0,raw:1,text:3})}}function Mh(i){let e,t;const n=i[1].default,r=fe(n,i,i[0],null);return{c(){e=b("p"),r&&r.c()},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&de(r,n,s,s[0],t?he(n,s[0],u,null):pe(s[0]),null)},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Nh(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class jh extends re{constructor(e){super(),ne(this,e,Nh,Mh,te,{})}}function Lh(i){let e;const t=i[3].default,n=fe(t,i,i[2],null);return{c(){n&&n.c()},m(r,s){n&&n.m(r,s),e=!0},p(r,[s]){n&&n.p&&(!e||s&4)&&de(n,t,r,r[2],e?he(t,r[2],s,null):pe(r[2]),null)},i(r){e||(y(n,r),e=!0)},o(r){C(n,r),e=!1},d(r){n&&n.d(r)}}}function Uh(i,e,t){let{$$slots:n={},$$scope:r}=e,{text:s}=e,{raw:u}=e;return i.$$set=a=>{"text"in a&&t(0,s=a.text),"raw"in a&&t(1,u=a.raw),"$$scope"in a&&t(2,r=a.$$scope)},[s,u,r,n]}class zh extends re{constructor(e){super(),ne(this,e,Uh,Lh,te,{text:0,raw:1})}}function Hh(i){let e,t;return{c(){e=b("img"),Xe(e.src,t=i[0])||k(e,"src",t),k(e,"title",i[1]),k(e,"alt",i[2])},m(n,r){A(n,e,r)},p(n,[r]){r&1&&!Xe(e.src,t=n[0])&&k(e,"src",t),r&2&&k(e,"title",n[1]),r&4&&k(e,"alt",n[2])},i:T,o:T,d(n){n&&_(e)}}}function qh(i,e,t){let{href:n=""}=e,{title:r=void 0}=e,{text:s=""}=e;return i.$$set=u=>{"href"in u&&t(0,n=u.href),"title"in u&&t(1,r=u.title),"text"in u&&t(2,s=u.text)},[n,r,s]}class Wh extends re{constructor(e){super(),ne(this,e,qh,Hh,te,{href:0,title:1,text:2})}}function Qh(i){let e,t;const n=i[3].default,r=fe(n,i,i[2],null);return{c(){e=b("a"),r&&r.c(),k(e,"href",i[0]),k(e,"title",i[1])},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&4)&&de(r,n,s,s[2],t?he(n,s[2],u,null):pe(s[2]),null),(!t||u&1)&&k(e,"href",s[0]),(!t||u&2)&&k(e,"title",s[1])},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Kh(i,e,t){let{$$slots:n={},$$scope:r}=e,{href:s=""}=e,{title:u=void 0}=e;return i.$$set=a=>{"href"in a&&t(0,s=a.href),"title"in a&&t(1,u=a.title),"$$scope"in a&&t(2,r=a.$$scope)},[s,u,r,n]}class Vh extends re{constructor(e){super(),ne(this,e,Kh,Qh,te,{href:0,title:1})}}function Gh(i){let e,t;const n=i[1].default,r=fe(n,i,i[0],null);return{c(){e=b("em"),r&&r.c()},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&de(r,n,s,s[0],t?he(n,s[0],u,null):pe(s[0]),null)},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Zh(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class Yh extends re{constructor(e){super(),ne(this,e,Zh,Gh,te,{})}}function Xh(i){let e,t;const n=i[1].default,r=fe(n,i,i[0],null);return{c(){e=b("del"),r&&r.c()},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&de(r,n,s,s[0],t?he(n,s[0],u,null):pe(s[0]),null)},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Jh(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class ed extends re{constructor(e){super(),ne(this,e,Jh,Xh,te,{})}}function td(i){let e,t=i[0].replace(/`/g,"")+"",n;return{c(){e=b("code"),n=K(t)},m(r,s){A(r,e,s),w(e,n)},p(r,[s]){s&1&&t!==(t=r[0].replace(/`/g,"")+"")&&ge(n,t)},i:T,o:T,d(r){r&&_(e)}}}function nd(i,e,t){let{raw:n}=e;return i.$$set=r=>{"raw"in r&&t(0,n=r.raw)},[n]}class rd extends re{constructor(e){super(),ne(this,e,nd,td,te,{raw:0})}}function id(i){let e,t;const n=i[1].default,r=fe(n,i,i[0],null);return{c(){e=b("strong"),r&&r.c()},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&de(r,n,s,s[0],t?he(n,s[0],u,null):pe(s[0]),null)},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function sd(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class ud extends re{constructor(e){super(),ne(this,e,sd,id,te,{})}}function ad(i){let e,t;const n=i[1].default,r=fe(n,i,i[0],null);return{c(){e=b("table"),r&&r.c()},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&de(r,n,s,s[0],t?he(n,s[0],u,null):pe(s[0]),null)},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function od(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class ld extends re{constructor(e){super(),ne(this,e,od,ad,te,{})}}function cd(i){let e,t;const n=i[1].default,r=fe(n,i,i[0],null);return{c(){e=b("thead"),r&&r.c()},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&de(r,n,s,s[0],t?he(n,s[0],u,null):pe(s[0]),null)},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function fd(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class hd extends re{constructor(e){super(),ne(this,e,fd,cd,te,{})}}function dd(i){let e,t;const n=i[1].default,r=fe(n,i,i[0],null);return{c(){e=b("tbody"),r&&r.c()},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&de(r,n,s,s[0],t?he(n,s[0],u,null):pe(s[0]),null)},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function pd(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class Dd extends re{constructor(e){super(),ne(this,e,pd,dd,te,{})}}function md(i){let e,t;const n=i[1].default,r=fe(n,i,i[0],null);return{c(){e=b("tr"),r&&r.c()},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&de(r,n,s,s[0],t?he(n,s[0],u,null):pe(s[0]),null)},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function gd(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class bd extends re{constructor(e){super(),ne(this,e,gd,md,te,{})}}function wd(i){let e,t;const n=i[3].default,r=fe(n,i,i[2],null);return{c(){e=b("td"),r&&r.c(),k(e,"align",i[1])},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&4)&&de(r,n,s,s[2],t?he(n,s[2],u,null):pe(s[2]),null),(!t||u&2)&&k(e,"align",s[1])},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function _d(i){let e,t;const n=i[3].default,r=fe(n,i,i[2],null);return{c(){e=b("th"),r&&r.c(),k(e,"align",i[1])},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&4)&&de(r,n,s,s[2],t?he(n,s[2],u,null):pe(s[2]),null),(!t||u&2)&&k(e,"align",s[1])},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function yd(i){let e,t,n,r;const s=[_d,wd],u=[];function a(o,l){return o[0]?0:1}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=J()},m(o,l){u[e].m(o,l),A(o,n,l),r=!0},p(o,[l]){let c=e;e=a(o),e===c?u[e].p(o,l):(H(),C(u[c],1,1,()=>{u[c]=null}),q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),y(t,1),t.m(n.parentNode,n))},i(o){r||(y(t),r=!0)},o(o){C(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function Ad(i,e,t){let{$$slots:n={},$$scope:r}=e,{header:s}=e,{align:u}=e;return i.$$set=a=>{"header"in a&&t(0,s=a.header),"align"in a&&t(1,u=a.align),"$$scope"in a&&t(2,r=a.$$scope)},[s,u,r,n]}class Cd extends re{constructor(e){super(),ne(this,e,Ad,yd,te,{header:0,align:1})}}function Ed(i){let e,t;const n=i[3].default,r=fe(n,i,i[2],null);return{c(){e=b("ul"),r&&r.c()},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&4)&&de(r,n,s,s[2],t?he(n,s[2],u,null):pe(s[2]),null)},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function kd(i){let e,t;const n=i[3].default,r=fe(n,i,i[2],null);return{c(){e=b("ol"),r&&r.c(),k(e,"start",i[1])},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&4)&&de(r,n,s,s[2],t?he(n,s[2],u,null):pe(s[2]),null),(!t||u&2)&&k(e,"start",s[1])},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Fd(i){let e,t,n,r;const s=[kd,Ed],u=[];function a(o,l){return o[0]?0:1}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=J()},m(o,l){u[e].m(o,l),A(o,n,l),r=!0},p(o,[l]){let c=e;e=a(o),e===c?u[e].p(o,l):(H(),C(u[c],1,1,()=>{u[c]=null}),q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),y(t,1),t.m(n.parentNode,n))},i(o){r||(y(t),r=!0)},o(o){C(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function vd(i,e,t){let{$$slots:n={},$$scope:r}=e,{ordered:s}=e,{start:u}=e;return i.$$set=a=>{"ordered"in a&&t(0,s=a.ordered),"start"in a&&t(1,u=a.start),"$$scope"in a&&t(2,r=a.$$scope)},[s,u,r,n]}class Bd extends re{constructor(e){super(),ne(this,e,vd,Fd,te,{ordered:0,start:1})}}function Sd(i){let e,t;const n=i[1].default,r=fe(n,i,i[0],null);return{c(){e=b("li"),r&&r.c()},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&de(r,n,s,s[0],t?he(n,s[0],u,null):pe(s[0]),null)},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Td(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class Pd extends re{constructor(e){super(),ne(this,e,Td,Sd,te,{})}}function Id(i){let e;return{c(){e=b("hr")},m(t,n){A(t,e,n)},p:T,i:T,o:T,d(t){t&&_(e)}}}class Rd extends re{constructor(e){super(),ne(this,e,null,Id,te,{})}}function xd(i){let e,t;return{c(){e=new zu(!1),t=J(),e.a=t},m(n,r){e.m(i[0],n,r),A(n,t,r)},p(n,[r]){r&1&&e.p(n[0])},i:T,o:T,d(n){n&&_(t),n&&e.d()}}}function Od(i,e,t){let{text:n}=e;return i.$$set=r=>{"text"in r&&t(0,n=r.text)},[n]}class $d extends re{constructor(e){super(),ne(this,e,Od,xd,te,{text:0})}}function Md(i){let e,t;const n=i[1].default,r=fe(n,i,i[0],null);return{c(){e=b("blockquote"),r&&r.c()},m(s,u){A(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&de(r,n,s,s[0],t?he(n,s[0],u,null):pe(s[0]),null)},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Nd(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class jd extends re{constructor(e){super(),ne(this,e,Nd,Md,te,{})}}function Ld(i){let e,t,n;return{c(){e=b("pre"),t=b("code"),n=K(i[1]),k(e,"class",i[0])},m(r,s){A(r,e,s),w(e,t),w(t,n)},p(r,[s]){s&2&&ge(n,r[1]),s&1&&k(e,"class",r[0])},i:T,o:T,d(r){r&&_(e)}}}function Ud(i,e,t){let{lang:n}=e,{text:r}=e;return i.$$set=s=>{"lang"in s&&t(0,n=s.lang),"text"in s&&t(1,r=s.text)},[n,r]}class zd extends re{constructor(e){super(),ne(this,e,Ud,Ld,te,{lang:0,text:1})}}function Hd(i){let e,t;const n=i[1].default,r=fe(n,i,i[0],null);return{c(){e=b("br"),r&&r.c()},m(s,u){A(s,e,u),r&&r.m(s,u),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&de(r,n,s,s[0],t?he(n,s[0],u,null):pe(s[0]),null)},i(s){t||(y(r,s),t=!0)},o(s){C(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function qd(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class Wd extends re{constructor(e){super(),ne(this,e,qd,Hd,te,{})}}const Qd={heading:$h,paragraph:jh,text:zh,image:Wh,link:Vh,em:Yh,strong:ud,codespan:rd,del:ed,table:ld,tablehead:hd,tablebody:Dd,tablerow:bd,tablecell:Cd,list:Bd,orderedlistitem:null,unorderedlistitem:null,listitem:Pd,hr:Rd,html:$d,blockquote:jd,code:zd,br:Wd},Kd={baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,xhtml:!1};function Vd(i){let e,t;return e=new sn({props:{tokens:i[0],renderers:i[1]}}),{c(){W(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,[r]){const s={};r&1&&(s.tokens=n[0]),r&2&&(s.renderers=n[1]),e.$set(s)},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function Gd(i,e,t){let n,r,s,u,{source:a=[]}=e,{renderers:o={}}=e,{options:l={}}=e,{isInline:c=!1}=e;const f=Xt();let h,d,p;return ho(Va,{slug:D=>r?r.slug(D):"",getOptions:()=>s}),Rt(()=>{t(7,p=!0)}),i.$$set=D=>{"source"in D&&t(2,a=D.source),"renderers"in D&&t(3,o=D.renderers),"options"in D&&t(4,l=D.options),"isInline"in D&&t(5,c=D.isInline)},i.$$.update=()=>{i.$$.dirty&4&&t(8,n=Array.isArray(a)),i.$$.dirty&4&&(r=a?new Ci:void 0),i.$$.dirty&16&&t(9,s={...Kd,...l}),i.$$.dirty&869&&(n?t(0,h=a):(t(6,d=new ot(s)),t(0,h=c?d.inlineTokens(a):d.lex(a)),f("parsed",{tokens:h}))),i.$$.dirty&8&&t(1,u={...Qd,...o}),i.$$.dirty&385&&p&&!n&&f("parsed",{tokens:h})},[h,u,a,o,l,c,d,p,n,s]}class Zd extends re{constructor(e){super(),ne(this,e,Gd,Vd,te,{source:2,renderers:3,options:4,isInline:5})}}function Ms(i){let e,t,n,r={ctx:i,current:null,token:null,hasCatch:!1,pending:a0,then:Xd,catch:Yd,value:13,blocks:[,,,]};return wn(t=i[2],r),{c(){e=J(),r.block.c()},m(s,u){A(s,e,u),r.block.m(s,r.anchor=u),r.mount=()=>e.parentNode,r.anchor=e,n=!0},p(s,u){i=s,r.ctx=i,u&4&&t!==(t=i[2])&&wn(t,r)||ui(r,i,u)},i(s){n||(y(r.block),n=!0)},o(s){for(let u=0;u<3;u+=1){const a=r.blocks[u];C(a)}n=!1},d(s){s&&_(e),r.block.d(s),r.token=null,r=null}}}function Yd(i){return{c:T,m:T,p:T,i:T,o:T,d:T}}function Xd(i){let e,t,n,r;const s=[e0,Jd],u=[];function a(o,l){return o[3]?1:0}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=J()},m(o,l){u[e].m(o,l),A(o,n,l),r=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(H(),C(u[c],1,1,()=>{u[c]=null}),q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),y(t,1),t.m(n.parentNode,n))},i(o){r||(y(t),r=!0)},o(o){C(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function Jd(i){let e,t,n;return{c(){e=b("img"),k(e,"class","dnone svelte-ez0nhx"),Xe(e.src,t=i[13])||k(e,"src",t),k(e,"alt",n=i[0].text)},m(r,s){A(r,e,s)},p(r,s){s&4&&!Xe(e.src,t=r[13])&&k(e,"src",t),s&1&&n!==(n=r[0].text)&&k(e,"alt",n)},i:T,o:T,d(r){r&&_(e)}}}function e0(i){let e,t,n,r,s;const u=[u0,s0,i0,r0,n0,t0],a=[];function o(c,f){return c[4]=="image"?0:c[4]=="text"?1:c[4]=="audio"?2:c[4]=="markdown"?3:c[4]=="pdf"?4:5}e=o(i),t=a[e]=u[e](i);let l=i[1]!==void 0&&Ns(i);return{c(){t.c(),n=P(),l&&l.c(),r=J()},m(c,f){a[e].m(c,f),A(c,n,f),l&&l.m(c,f),A(c,r,f),s=!0},p(c,f){let h=e;e=o(c),e===h?a[e].p(c,f):(H(),C(a[h],1,1,()=>{a[h]=null}),q(),t=a[e],t?t.p(c,f):(t=a[e]=u[e](c),t.c()),y(t,1),t.m(n.parentNode,n)),c[1]!==void 0?l?l.p(c,f):(l=Ns(c),l.c(),l.m(r.parentNode,r)):l&&(l.d(1),l=null)},i(c){s||(y(t),s=!0)},o(c){C(t),s=!1},d(c){a[e].d(c),c&&_(n),l&&l.d(c),c&&_(r)}}}function t0(i){let e;return{c(){e=b("p"),e.textContent="Attachment type not supported"},m(t,n){A(t,e,n)},p:T,i:T,o:T,d(t){t&&_(e)}}}function n0(i){let e;return{c(){e=b("p"),e.textContent="Pdf preview to come"},m(t,n){A(t,e,n)},p:T,i:T,o:T,d(t){t&&_(e)}}}function r0(i){let e,t,n;return t=new Zd({props:{source:i[13]}}),{c(){e=b("div"),W(t.$$.fragment),k(e,"class","markdown svelte-ez0nhx")},m(r,s){A(r,e,s),U(t,e,null),n=!0},p(r,s){const u={};s&4&&(u.source=r[13]),t.$set(u)},i(r){n||(y(t.$$.fragment,r),n=!0)},o(r){C(t.$$.fragment,r),n=!1},d(r){r&&_(e),z(t)}}}function i0(i){let e,t;return{c(){e=b("audio"),Xe(e.src,t=i[13])||k(e,"src",t),e.controls=!0,k(e,"class","svelte-ez0nhx")},m(n,r){A(n,e,r)},p(n,r){r&4&&!Xe(e.src,t=n[13])&&k(e,"src",t)},i:T,o:T,d(n){n&&_(e)}}}function s0(i){let e,t=i[13]+"";return{c(){e=b("p")},m(n,r){A(n,e,r),e.innerHTML=t},p(n,r){r&4&&t!==(t=n[13]+"")&&(e.innerHTML=t)},i:T,o:T,d(n){n&&_(e)}}}function u0(i){let e,t,n;return{c(){e=b("img"),Xe(e.src,t=i[13])||k(e,"src",t),k(e,"alt",n=i[0].text),k(e,"class","svelte-ez0nhx")},m(r,s){A(r,e,s)},p(r,s){s&4&&!Xe(e.src,t=r[13])&&k(e,"src",t),s&1&&n!==(n=r[0].text)&&k(e,"alt",n)},i:T,o:T,d(r){r&&_(e)}}}function Ns(i){let e,t,n,r;return{c(){e=b("p"),t=b("button"),t.textContent="Download attachment",k(t,"class","svelte-ez0nhx")},m(s,u){A(s,e,u),w(e,t),n||(r=G(t,"click",i[8]),n=!0)},p:T,d(s){s&&_(e),n=!1,r()}}}function a0(i){let e;return{c(){e=K("Loading attachment...")},m(t,n){A(t,e,n)},p:T,i:T,o:T,d(t){t&&_(e)}}}function o0(i){let e,t=(i[5],"Attachment"),n,r,s,u,a,o,l=i[5]&&Ms(i);return{c(){e=b("button"),n=K(t),r=P(),l&&l.c(),s=J(),k(e,"class","svelte-ez0nhx")},m(c,f){A(c,e,f),w(e,n),A(c,r,f),l&&l.m(c,f),A(c,s,f),u=!0,a||(o=G(e,"click",function(){En(i[6](i[0]))&&i[6](i[0]).apply(this,arguments)}),a=!0)},p(c,[f]){i=c,(!u||f&32)&&t!==(t=(i[5],"Attachment"))&&ge(n,t),i[5]?l?(l.p(i,f),f&32&&y(l,1)):(l=Ms(i),l.c(),y(l,1),l.m(s.parentNode,s)):l&&(H(),C(l,1,1,()=>{l=null}),q())},i(c){u||(y(l),u=!0)},o(c){C(l),u=!1},d(c){c&&_(e),c&&_(r),l&&l.d(c),c&&_(s),a=!1,o()}}}function l0(i,e,t){let n;Ee(i,rn,D=>t(11,n=D));let{doc:r}=e,s,u,a=!0,o,l,c=!1;async function f(D){const g=await n.replica.getAttachment(D);let m=D.path.split(".").pop();if(g){const F=await g.bytes();console.log("docdata",F);let v=new Uint8Array(F.length);for(var E=0;E<F.length;E++)v[E]=F[E];if(m==="md")t(4,o="markdown"),t(4,o),t(1,s=String.fromCharCode(...v));else if(m=="mp3"||m=="ogg"||m=="webm")t(4,o="audio"),l="audio/"+m,t(4,o),l=l,console.log("this is audio"),console.log(o,l),t(1,s=URL.createObjectURL(new Blob([v],{type:l})));else if(m==="txt"){t(4,o="text"),t(4,o),console.log(o);var B=new TextDecoder("utf-8");t(1,s=B.decode(Uint8Array.from(v)))}else m=="png"||m=="gif"||m=="jpeg"?(t(4,o="image"),console.log("this is an image"),console.log("fileExtension "+m),l="image/"+m,t(4,o),l=l,t(1,s=URL.createObjectURL(new Blob([v],{type:l})))):(t(4,o="other"),t(4,o),console.log(o),t(1,s=URL.createObjectURL(new Blob([v],{type:"application/octet-stream"}))));return s}}function h(D){t(5,c=!c),t(2,u=f(D)),t(3,a=!1)}function d(){let D=document.createElement("a");console.log(s+"attachmentBytes"),s.split(":")[0]!=="blob"&&(console.log("attachmentBytes is a string"),t(1,s=URL.createObjectURL(new Blob([s]))),console.log("attachmentBytes is now a blob")),console.log("type of attachmentBytes ",typeof s);let g=s,m=r.path.split("/")[r.path.split("/").length-1];console.log("type of file",typeof g),D.href=g,D.download=m.slice(1),D.style.display="none",document.body.appendChild(D),D.click()}const p=()=>d();return i.$$set=D=>{"doc"in D&&t(0,r=D.doc)},[r,s,u,a,o,c,h,d,p]}class c0 extends re{constructor(e){super(),ne(this,e,l0,o0,te,{doc:0})}}function js(i,e,t){const n=i.slice();return n[8]=e[t],n}function Ls(i){let e,t,n,r,s,u=i[1]&&Us(i);function a(f,h){return f[3]!==void 0?h0:f0}let o=a(i),l=o(i),c=(i[2]||!i[1])&&qs(i);return{c(){e=b("h2"),e.textContent="Details",t=P(),n=b("div"),u&&u.c(),r=P(),l.c(),s=P(),c&&c.c(),k(n,"class","svelte-fqd2l")},m(f,h){A(f,e,h),A(f,t,h),A(f,n,h),u&&u.m(n,null),w(n,r),l.m(n,null),w(n,s),c&&c.m(n,null)},p(f,h){f[1]?u?u.p(f,h):(u=Us(f),u.c(),u.m(n,r)):u&&(u.d(1),u=null),o===(o=a(f))&&l?l.p(f,h):(l.d(1),l=o(f),l&&(l.c(),l.m(n,s))),f[2]||!f[1]?c?c.p(f,h):(c=qs(f),c.c(),c.m(n,null)):c&&(c.d(1),c=null)},d(f){f&&_(e),f&&_(t),f&&_(n),u&&u.d(),l.d(),c&&c.d()}}}function Us(i){let e,t,n,r,s,u,a=i[0].path.split(".")[i[0].path.split(".").length-1]+"",o,l,c,f,h,d,p=i[0].attachmentSize/1e3+"",D,g;return{c(){e=b("table"),t=b("tr"),n=b("td"),n.textContent="Attachment type:",r=P(),s=b("td"),u=b("strong"),o=K(a),l=P(),c=b("tr"),f=b("td"),f.textContent="Attachment size:",h=P(),d=b("td"),D=K(p),g=K(" kb"),k(e,"class","svelte-fqd2l")},m(m,E){A(m,e,E),w(e,t),w(t,n),w(t,r),w(t,s),w(s,u),w(u,o),w(t,l),w(e,c),w(c,f),w(c,h),w(c,d),w(d,D),w(c,g)},p(m,E){E&1&&a!==(a=m[0].path.split(".")[m[0].path.split(".").length-1]+"")&&ge(o,a),E&1&&p!==(p=m[0].attachmentSize/1e3+"")&&ge(D,p)},d(m){m&&_(e)}}}function f0(i){let e,t=i[0].text+"";return{c(){e=b("h4")},m(n,r){A(n,e,r),e.innerHTML=t},p(n,r){r&1&&t!==(t=n[0].text+"")&&(e.innerHTML=t)},d(n){n&&_(e)}}}function h0(i){let e,t,n,r=i[6]&&zs(i);return{c(){e=b("h3"),t=P(),r&&r.c(),n=J()},m(s,u){A(s,e,u),e.innerHTML=i[3],A(s,t,u),r&&r.m(s,u),A(s,n,u)},p(s,u){u&8&&(e.innerHTML=s[3]),s[6]?r?r.p(s,u):(r=zs(s),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},d(s){s&&_(e),s&&_(t),r&&r.d(s),s&&_(n)}}}function zs(i){let e,t=i[4],n=[];for(let r=0;r<t.length;r+=1)n[r]=Hs(js(i,t,r));return{c(){e=b("ul");for(let r=0;r<n.length;r+=1)n[r].c();k(e,"class","svelte-fqd2l")},m(r,s){A(r,e,s);for(let u=0;u<n.length;u+=1)n[u].m(e,null)},p(r,s){if(s&16){t=r[4];let u;for(u=0;u<t.length;u+=1){const a=js(r,t,u);n[u]?n[u].p(a,s):(n[u]=Hs(a),n[u].c(),n[u].m(e,null))}for(;u<n.length;u+=1)n[u].d(1);n.length=t.length}},d(r){r&&_(e),Yt(n,r)}}}function Hs(i){let e,t,n=i[8]+"",r;return{c(){e=b("li"),t=new zu(!1),r=P(),t.a=r,k(e,"class","svelte-fqd2l")},m(s,u){A(s,e,u),t.m(n,e),w(e,r)},p(s,u){u&16&&n!==(n=s[8]+"")&&t.p(n)},d(s){s&&_(e)}}}function qs(i){let e,t,n,r,s,u=i[0].path+"",a,o,l,c,f,h=i[0].author+"",d,p,D,g,m,E=i[0].share+"",B,F,v,x,S,R=i[0].timestamp/1e3+"",Q;return{c(){e=b("div"),t=b("ul"),n=b("li"),r=b("b"),r.textContent="path:",s=P(),a=K(u),o=P(),l=b("li"),c=b("b"),c.textContent="author:",f=P(),d=K(h),p=P(),D=b("li"),g=b("b"),g.textContent="share:",m=P(),B=K(E),F=P(),v=b("li"),x=b("b"),x.textContent="timestamp:",S=P(),Q=K(R),k(n,"class","svelte-fqd2l"),k(l,"class","svelte-fqd2l"),k(D,"class","svelte-fqd2l"),k(v,"class","svelte-fqd2l"),k(t,"class","svelte-fqd2l"),k(e,"class","svelte-fqd2l")},m(N,j){A(N,e,j),w(e,t),w(t,n),w(n,r),w(n,s),w(n,a),w(t,o),w(t,l),w(l,c),w(l,f),w(l,d),w(t,p),w(t,D),w(D,g),w(D,m),w(D,B),w(t,F),w(t,v),w(v,x),w(v,S),w(v,Q)},p(N,j){j&1&&u!==(u=N[0].path+"")&&ge(a,u),j&1&&h!==(h=N[0].author+"")&&ge(d,h),j&1&&E!==(E=N[0].share+"")&&ge(B,E),j&1&&R!==(R=N[0].timestamp/1e3+"")&&ge(Q,R)},d(N){N&&_(e)}}}function d0(i){let e,t,n,r,s,u=i[5]&&Ls(i);return{c(){e=b("button"),e.textContent="Details",t=P(),u&&u.c(),n=J()},m(a,o){A(a,e,o),A(a,t,o),u&&u.m(a,o),A(a,n,o),r||(s=G(e,"click",i[7]),r=!0)},p(a,[o]){a[5]?u?u.p(a,o):(u=Ls(a),u.c(),u.m(n.parentNode,n)):u&&(u.d(1),u=null)},i:T,o:T,d(a){a&&_(e),a&&_(t),u&&u.d(a),a&&_(n),r=!1,s()}}}function p0(i,e,t){let{doc:n}=e,{attachment:r=!0}=e,{isReply:s=!1}=e,u=!1,a,o,l=!1;const c=()=>t(5,u=!u);return i.$$set=f=>{"doc"in f&&t(0,n=f.doc),"attachment"in f&&t(1,r=f.attachment),"isReply"in f&&t(2,s=f.isReply)},i.$$.update=()=>{i.$$.dirty&25&&n.text!==void 0&&n.text.includes("<br>")&&(t(4,o=n.text.split("<br>")),t(3,a=o.shift()),t(3,a),t(0,n),t(4,o),t(6,l=!0))},[n,r,s,a,o,u,l,c]}class D0 extends re{constructor(e){super(),ne(this,e,p0,d0,te,{doc:0,attachment:1,isReply:2})}}function Ws(i,e,t){const n=i.slice();return n[1]=e[t],n}function m0(i){let e,t=[],n=new Map,r,s=i[2];const u=a=>a[1].signature;for(let a=0;a<s.length;a+=1){let o=Ws(i,s,a),l=u(o);n.set(l,t[a]=Qs(l,o))}return{c(){e=b("ul");for(let a=0;a<t.length;a+=1)t[a].c();k(e,"class","svelte-197mouz")},m(a,o){A(a,e,o);for(let l=0;l<t.length;l+=1)t[l].m(e,null);r=!0},p(a,o){o&69&&(s=a[2],H(),t=lt(t,o,u,1,a,s,n,e,Jt,Qs,null,Ws),q())},i(a){if(!r){for(let o=0;o<s.length;o+=1)y(t[o]);r=!0}},o(a){for(let o=0;o<t.length;o+=1)C(t[o]);r=!1},d(a){a&&_(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function g0(i){let e=i[5]()+"",t;return{c(){t=K(e)},m(n,r){A(n,t,r)},p:T,i:T,o:T,d(n){n&&_(t)}}}function b0(i){let e,t;return e=new Ot({props:{isReply:!0,title:i[1].text,doc:i[1],attachment:!1,inStudio:i[0],reply:!1}}),e.$on("click",i[6]),e.$on("update",i[6]),{c(){W(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,r){const s={};r&4&&(s.title=n[1].text),r&4&&(s.doc=n[1]),r&1&&(s.inStudio=n[0]),e.$set(s)},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function w0(i){let e,t;return e=new Ot({props:{isReply:!0,title:i[1].text,doc:i[1],attachment:!0,inStudio:i[0],reply:!1}}),e.$on("click",i[6]),e.$on("update",i[6]),{c(){W(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,r){const s={};r&4&&(s.title=n[1].text),r&4&&(s.doc=n[1]),r&1&&(s.inStudio=n[0]),e.$set(s)},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function Qs(i,e){let t,n,r,s,u,a,o;const l=[w0,b0],c=[];function f(h,d){return d&4&&(n=null),n==null&&(n=!!h[1].text.includes("replied with voice")),n?0:1}return r=f(e,-1),s=c[r]=l[r](e),{key:i,first:null,c(){t=b("li"),s.c(),u=P(),k(t,"id",a=e[1].textHash),k(t,"class","svelte-197mouz"),this.first=t},m(h,d){A(h,t,d),c[r].m(t,null),w(t,u),o=!0},p(h,d){e=h;let p=r;r=f(e,d),r===p?c[r].p(e,d):(H(),C(c[p],1,1,()=>{c[p]=null}),q(),s=c[r],s?s.p(e,d):(s=c[r]=l[r](e),s.c()),y(s,1),s.m(t,u)),(!o||d&4&&a!==(a=e[1].textHash))&&k(t,"id",a)},i(h){o||(y(s),o=!0)},o(h){C(s),o=!1},d(h){h&&_(t),c[r].d()}}}function _0(i){return{c:T,m:T,d:T}}function y0(i){let e;return{c(){e=b("p"),e.textContent="There are no replies yet.",k(e,"class","max-content svelte-197mouz")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function A0(i){let e,t,n,r,s,u;const a=[g0,m0],o=[];function l(d,p){return d[2]===void 0?0:d[3]?1:-1}~(t=l(i))&&(n=o[t]=a[t](i));function c(d,p){return d[4]?y0:_0}let f=c(i),h=f(i);return{c(){e=b("div"),n&&n.c(),r=P(),s=b("div"),h.c()},m(d,p){A(d,e,p),~t&&o[t].m(e,null),A(d,r,p),A(d,s,p),h.m(s,null),u=!0},p(d,[p]){let D=t;t=l(d),t===D?~t&&o[t].p(d,p):(n&&(H(),C(o[D],1,1,()=>{o[D]=null}),q()),~t?(n=o[t],n?n.p(d,p):(n=o[t]=a[t](d),n.c()),y(n,1),n.m(e,null)):n=null),f!==(f=c(d))&&(h.d(1),h=f(d),h&&(h.c(),h.m(s,null)))},i(d){u||(y(n),u=!0)},o(d){C(n),u=!1},d(d){d&&_(e),~t&&o[t].d(),d&&_(r),d&&_(s),h.d()}}}function C0(i,e,t){let n;Ee(i,kr,f=>t(7,n=f));let{doc:r}=e,{inStudio:s}=e,u=[],a=!0,o=!1;const l=async()=>{let f=r.path.split("!");t(2,u=await n.cache.queryDocs({filter:{pathStartsWith:f[0]}})),t(2,u=u.filter(h=>h.path.split("/").length>6)),t(3,a=!0)};n.cache.onCacheUpdated(()=>{l(),t(2,u)});function c(){setTimeout(()=>{l()},1e3)}return Rt(()=>{l()}),i.$$set=f=>{"doc"in f&&t(1,r=f.doc),"inStudio"in f&&t(0,s=f.inStudio)},i.$$.update=()=>{i.$$.dirty&4&&t(2,u),i.$$.dirty&4&&(u.length>=1?(t(3,a=!0),t(4,o=!1)):t(4,o=!0))},[s,r,u,a,o,l,c]}class E0 extends re{constructor(e){super(),ne(this,e,C0,A0,te,{doc:1,inStudio:0})}}function k0(i){let e;return{c(){e=K("Record audio")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function F0(i){let e;return{c(){e=K("Stop recording")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function v0(i){let e,t,n,r,s,u,a,o;function l(h,d){return h[0]?F0:k0}let c=l(i),f=c(i);return{c(){e=b("div"),t=b("div"),n=b("img"),s=P(),u=b("div"),f.c(),k(n,"class","upload svelte-153yvdv"),Xe(n.src,r=B0)||k(n,"src",r),k(n,"alt","Speaker Icon"),k(u,"class","uploadText svelte-153yvdv"),k(t,"class","svelte-153yvdv"),k(e,"class","svelte-153yvdv")},m(h,d){A(h,e,d),w(e,t),w(t,n),w(t,s),w(t,u),f.m(u,null),a||(o=[G(n,"click",i[5]),G(n,"keypress",i[6]),G(u,"click",i[7]),G(u,"keypress",i[8])],a=!0)},p(h,[d]){c!==(c=l(h))&&(f.d(1),f=c(h),f&&(f.c(),f.m(u,null)))},i:T,o:T,d(h){h&&_(e),f.d(),a=!1,_e(o)}}}let B0="images/Speaker_Icon.png";function S0(i){return new Promise((e,t)=>{let n=new FileReader;n.addEventListener("loadend",r=>e(r.target.result)),n.addEventListener("error",t),n.readAsArrayBuffer(i)})}function T0(i,e,t){let n,r;Ee(i,It,B=>t(13,n=B)),Ee(i,rn,B=>t(14,r=B));const s=Xt();let u,a,o=[],l=null,c=!1,{xy:f=void 0}=e,{inStudio:h}=e,{doc:d=void 0}=e;async function p(){if(c)l.stop(),console.log("mediaRecorder",l),console.log("mediaRecorder mime",l.mimeType),t(0,c=!1),l.ondataavailable=B=>o.push(B.data),l.onstop=async function(B){let F=Date.now(),v=new Date().toLocaleString(),x=(F+25488e5)*1e3,S=l.mimeType;S===""&&(S="audio/ogg; codecs=opus");let Q=S.split(";")[0].split("/")[1];const N=new Blob(o,{type:S});console.log("blob",N);const j=new Uint8Array(await S0(N));console.log("mime",S);let O=n.address.slice(1,5);if(f!==void 0&&f!=="reply")h||(u=await r.replica.set(n,{path:`/documents/${f[1]}/${f[0]}/${F}/!voice-note-by-${O}.${Q}`,text:"Voice note shared by "+O+" on "+v,attachment:j,deleteAfter:x})),a=await r.replica.set(n,{path:`/studio/${f[1]}/${f[0]}/${F}/voice-note-by-${O}.${Q}`,text:"Voice note shared by "+O+" on "+v,attachment:j}),s("upload"),console.log("Upload Result: ",u),console.log("Studio Result: ",a),o=[];else if(f=="reply"){let ie=d.path.split("!"),Ie=ie[0].replace("/documents","/studio");const oe=await r.replica.set(n,{text:O+" replied with voice<br>Shared on "+v,path:ie[0]+F+"/!reply-by-"+O+"."+Q,deleteAfter:x,attachment:j}),kt=await r.replica.set(n,{text:O+" replied with voice<br>Shared on "+v,path:Ie+F+"/reply-by-"+O+"."+Q,attachment:j});return console.log("result ",oe),console.log("studio ",kt),s("success"),oe}};else{const B=await navigator.mediaDevices.getUserMedia({audio:!0});l=new MediaRecorder(B),l.start(),console.log("mediaRecorder",l),console.log("mediaRecorder mime",l.mimeType),console.log("recording"),t(0,c=!0)}}const D=()=>{p()},g=()=>{p()},m=()=>{p()},E=()=>{p()};return i.$$set=B=>{"xy"in B&&t(2,f=B.xy),"inStudio"in B&&t(3,h=B.inStudio),"doc"in B&&t(4,d=B.doc)},[c,p,f,h,d,D,g,m,E]}class Ga extends re{constructor(e){super(),ne(this,e,T0,v0,te,{xy:2,inStudio:3,doc:4})}}function Ks(i){let e,t,n,r,s,u,a,o,l;return{c(){e=b("p"),t=b("input"),n=P(),r=b("p"),s=b("button"),u=K("Send Reply"),qe(t,"width",i[5]+"ch"),k(t,"class","svelte-1oqd7kn"),s.disabled=a=Gs(i[2])},m(c,f){A(c,e,f),w(e,t),Tt(t,i[2]),A(c,n,f),A(c,r,f),w(r,s),w(s,u),o||(l=[G(t,"input",i[10]),G(s,"click",i[7])],o=!0)},p(c,f){f&32&&qe(t,"width",c[5]+"ch"),f&4&&t.value!==c[2]&&Tt(t,c[2]),f&4&&a!==(a=Gs(c[2]))&&(s.disabled=a)},d(c){c&&_(e),c&&_(n),c&&_(r),o=!1,_e(l)}}}function Vs(i){let e,t,n;return t=new Ga({props:{xy:"reply",doc:i[0],inStudio:i[1]}}),{c(){e=b("p"),W(t.$$.fragment)},m(r,s){A(r,e,s),U(t,e,null),n=!0},p(r,s){const u={};s&1&&(u.doc=r[0]),s&2&&(u.inStudio=r[1]),t.$set(u)},i(r){n||(y(t.$$.fragment,r),n=!0)},o(r){C(t.$$.fragment,r),n=!1},d(r){r&&_(e),z(t)}}}function P0(i){let e;return{c(){e=b("span"),e.textContent=`${i[6].kind}`},m(t,n){A(t,e,n)},p:T,d(t){t&&_(e)}}}function I0(i){let e,t,n,r,s,u,a,o,l,c,f,h=i[3]&&Ks(i),d=i[4]&&Vs(i),p=i[6]&&P0(i);return{c(){e=b("div"),t=b("button"),t.textContent="Text reply",n=P(),r=b("button"),r.textContent="Voice reply",s=P(),h&&h.c(),u=P(),d&&d.c(),a=P(),o=b("p"),p&&p.c()},m(D,g){A(D,e,g),w(e,t),w(e,n),w(e,r),w(e,s),h&&h.m(e,null),w(e,u),d&&d.m(e,null),w(e,a),w(e,o),p&&p.m(o,null),l=!0,c||(f=[G(t,"click",i[8]),G(r,"click",i[9])],c=!0)},p(D,[g]){D[3]?h?h.p(D,g):(h=Ks(D),h.c(),h.m(e,u)):h&&(h.d(1),h=null),D[4]?d?(d.p(D,g),g&16&&y(d,1)):(d=Vs(D),d.c(),y(d,1),d.m(e,a)):d&&(H(),C(d,1,1,()=>{d=null}),q()),D[6]&&p.p(D,g)},i(D){l||(y(d),l=!0)},o(D){C(d),l=!1},d(D){D&&_(e),h&&h.d(),d&&d.d(),p&&p.d(),c=!1,_e(f)}}}function Gs(i){return i=="Reply here"}function R0(i,e,t){let n,r;Ee(i,It,E=>t(11,n=E)),Ee(i,rn,E=>t(12,r=E));const s=Xt();let u,a=!1,o=!1;async function l(){let E=n.address.slice(1,5),B=c.path.split("!"),F=c.path.split("/"),v=Date.now();const x=await r.replica.set(n,{text:E+" replied: "+h,path:B[0]+v+"/!reply-by-"+E,deleteAfter:p}),S=await r.replica.set(n,{text:E+" replied: "+h,path:"/studio/"+F[2]+"/"+v+"/reply-by-"+E});return console.log("result ",x),console.log("studio ",S),s("success"),x}let{doc:c}=e,{inStudio:f}=e,h="Reply here",d=h.length,p=(Date.now()+25488e5)*1e3;function D(){t(3,a=!a),t(4,o=!1)}function g(){t(3,a=!1),t(4,o=!o)}function m(){h=this.value,t(2,h),t(6,u)}return i.$$set=E=>{"doc"in E&&t(0,c=E.doc),"inStudio"in E&&t(1,f=E.inStudio)},i.$$.update=()=>{i.$$.dirty&4,i.$$.dirty&4&&h!==void 0&&t(5,d=h.length)},console.log("result",u),[c,f,h,a,o,d,u,l,D,g,m]}class x0 extends re{constructor(e){super(),ne(this,e,R0,I0,te,{doc:0,inStudio:1})}}function Zs(i){let e,t,n,r;return e=new E0({props:{doc:i[0],inStudio:i[1]}}),e.$on("success",i[4]),n=new x0({props:{doc:i[0],inStudio:i[1]}}),n.$on("success",i[5]),{c(){W(e.$$.fragment),t=P(),W(n.$$.fragment)},m(s,u){U(e,s,u),A(s,t,u),U(n,s,u),r=!0},p(s,u){const a={};u&1&&(a.doc=s[0]),u&2&&(a.inStudio=s[1]),e.$set(a);const o={};u&1&&(o.doc=s[0]),u&2&&(o.inStudio=s[1]),n.$set(o)},i(s){r||(y(e.$$.fragment,s),y(n.$$.fragment,s),r=!0)},o(s){C(e.$$.fragment,s),C(n.$$.fragment,s),r=!1},d(s){z(e,s),s&&_(t),z(n,s)}}}function O0(i){let e,t,n,r,s,u,a=i[2]&&Zs(i);return{c(){e=b("div"),t=b("button"),t.textContent="Reply",n=P(),a&&a.c()},m(o,l){A(o,e,l),w(e,t),w(e,n),a&&a.m(e,null),r=!0,s||(u=G(t,"click",i[3]),s=!0)},p(o,[l]){o[2]?a?(a.p(o,l),l&4&&y(a,1)):(a=Zs(o),a.c(),y(a,1),a.m(e,null)):a&&(H(),C(a,1,1,()=>{a=null}),q())},i(o){r||(y(a),r=!0)},o(o){C(a),r=!1},d(o){o&&_(e),a&&a.d(),s=!1,u()}}}function $0(i,e,t){let{doc:n}=e,{inStudio:r}=e,s=!1;function u(){t(2,s=!s)}function a(l){gn.call(this,i,l)}function o(l){gn.call(this,i,l)}return i.$$set=l=>{"doc"in l&&t(0,n=l.doc),"inStudio"in l&&t(1,r=l.inStudio)},[n,r,s,u,a,o]}class M0 extends re{constructor(e){super(),ne(this,e,$0,O0,te,{doc:0,inStudio:1})}}function N0(i){let e,t,n,r,s,u=!i[9]&&Ys(i),a=i[9]&&Js(i);return{c(){e=b("div"),u&&u.c(),t=P(),a&&a.c(),k(e,"class","main svelte-o4utkw"),at(e,"replies",i[6]===!0)},m(o,l){A(o,e,l),u&&u.m(e,null),w(e,t),a&&a.m(e,null),n=!0,r||(s=[G(e,"click",Wr(i[16])),G(e,"keypress",Wr(i[17]))],r=!0)},p(o,l){o[9]?u&&(H(),C(u,1,1,()=>{u=null}),q()):u?(u.p(o,l),l&512&&y(u,1)):(u=Ys(o),u.c(),y(u,1),u.m(e,t)),o[9]?a?(a.p(o,l),l&512&&y(a,1)):(a=Js(o),a.c(),y(a,1),a.m(e,null)):a&&(H(),C(a,1,1,()=>{a=null}),q()),(!n||l&64)&&at(e,"replies",o[6]===!0)},i(o){n||(y(u),y(a),n=!0)},o(o){C(u),C(a),n=!1},d(o){o&&_(e),u&&u.d(),a&&a.d(),r=!1,_e(s)}}}function j0(i){let e,t,n;return t=new _i({props:{style:"margin-bottom:-3px;",email:i[1].text,size:i[8],default:"retro"}}),{c(){e=b("div"),W(t.$$.fragment),k(e,"class","main disabled svelte-o4utkw"),at(e,"replies",i[6]===!0)},m(r,s){A(r,e,s),U(t,e,null),n=!0},p(r,s){const u={};s&2&&(u.email=r[1].text),s&256&&(u.size=r[8]),t.$set(u),(!n||s&64)&&at(e,"replies",r[6]===!0)},i(r){n||(y(t.$$.fragment,r),n=!0)},o(r){C(t.$$.fragment,r),n=!1},d(r){r&&_(e),z(t)}}}function Ys(i){let e,t,n,r,s,u,a;n=new _i({props:{style:"margin-bottom:-3px;",email:i[1].text,size:i[8],default:"retro"}});let o=i[0]!==void 0&&Xs(i);return{c(){e=b("div"),t=b("p"),W(n.$$.fragment),r=P(),o&&o.c(),k(t,"class","svelte-o4utkw"),k(e,"class","flex row svelte-o4utkw")},m(l,c){A(l,e,c),w(e,t),U(n,t,null),w(e,r),o&&o.m(e,null),s=!0,u||(a=[G(t,"click",i[11]),G(t,"keypress",i[12])],u=!0)},p(l,c){const f={};c&2&&(f.email=l[1].text),c&256&&(f.size=l[8]),n.$set(f),l[0]!==void 0?o?o.p(l,c):(o=Xs(l),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i(l){s||(y(n.$$.fragment,l),s=!0)},o(l){C(n.$$.fragment,l),s=!1},d(l){l&&_(e),z(n),o&&o.d(),u=!1,_e(a)}}}function Xs(i){let e;return{c(){e=b("h3"),k(e,"class","svelte-o4utkw")},m(t,n){A(t,e,n),e.innerHTML=i[0]},p(t,n){n&1&&(e.innerHTML=t[0])},d(t){t&&_(e)}}}function Js(i){let e,t,n,r,s,u,a,o,l,c,f,h,d;n=new _i({props:{style:"margin-bottom:-3px;",email:i[1].text,size:"18",default:"retro"}});let p=i[3]&&eu(i);o=new D0({props:{doc:i[1],attachment:i[3],isReply:i[6]}});let D=i[4]&&tu(i),g=!i[2]&&nu(i);return{c(){e=b("div"),t=b("button"),W(n.$$.fragment),r=K(`
            Artifact`),s=P(),p&&p.c(),u=P(),a=b("div"),W(o.$$.fragment),l=P(),D&&D.c(),c=P(),g&&g.c(),k(t,"class","svelte-o4utkw"),k(e,"class","flex svelte-o4utkw")},m(m,E){A(m,e,E),w(e,t),U(n,t,null),w(t,r),w(e,s),p&&p.m(e,null),w(e,u),w(e,a),U(o,a,null),w(e,l),D&&D.m(e,null),w(e,c),g&&g.m(e,null),f=!0,h||(d=[G(t,"click",i[13]),G(t,"keypress",Wr(i[14]))],h=!0)},p(m,E){const B={};E&2&&(B.email=m[1].text),n.$set(B),m[3]?p?(p.p(m,E),E&8&&y(p,1)):(p=eu(m),p.c(),y(p,1),p.m(e,u)):p&&(H(),C(p,1,1,()=>{p=null}),q());const F={};E&2&&(F.doc=m[1]),E&8&&(F.attachment=m[3]),E&64&&(F.isReply=m[6]),o.$set(F),m[4]?D?(D.p(m,E),E&16&&y(D,1)):(D=tu(m),D.c(),y(D,1),D.m(e,c)):D&&(H(),C(D,1,1,()=>{D=null}),q()),m[2]?g&&(H(),C(g,1,1,()=>{g=null}),q()):g?(g.p(m,E),E&4&&y(g,1)):(g=nu(m),g.c(),y(g,1),g.m(e,null))},i(m){f||(y(n.$$.fragment,m),y(p),y(o.$$.fragment,m),y(D),y(g),f=!0)},o(m){C(n.$$.fragment,m),C(p),C(o.$$.fragment,m),C(D),C(g),f=!1},d(m){m&&_(e),z(n),p&&p.d(),z(o),D&&D.d(),g&&g.d(),h=!1,_e(d)}}}function eu(i){let e,t,n;return t=new c0({props:{doc:i[1]}}),{c(){e=b("div"),W(t.$$.fragment)},m(r,s){A(r,e,s),U(t,e,null),n=!0},p(r,s){const u={};s&2&&(u.doc=r[1]),t.$set(u)},i(r){n||(y(t.$$.fragment,r),n=!0)},o(r){C(t.$$.fragment,r),n=!1},d(r){r&&_(e),z(t)}}}function tu(i){let e,t,n;return t=new M0({props:{doc:i[1],inStudio:i[5]}}),{c(){e=b("div"),W(t.$$.fragment)},m(r,s){A(r,e,s),U(t,e,null),n=!0},p(r,s){const u={};s&2&&(u.doc=r[1]),s&32&&(u.inStudio=r[5]),t.$set(u)},i(r){n||(y(t.$$.fragment,r),n=!0)},o(r){C(t.$$.fragment,r),n=!1},d(r){r&&_(e),z(t)}}}function nu(i){let e,t,n;return t=new Uf({props:{doc:i[1]}}),t.$on("update",i[15]),{c(){e=b("div"),W(t.$$.fragment)},m(r,s){A(r,e,s),U(t,e,null),n=!0},p(r,s){const u={};s&2&&(u.doc=r[1]),t.$set(u)},i(r){n||(y(t.$$.fragment,r),n=!0)},o(r){C(t.$$.fragment,r),n=!1},d(r){r&&_(e),z(t)}}}function L0(i){let e,t,n,r;const s=[j0,N0],u=[];function a(o,l){return o[7]?0:1}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=J()},m(o,l){u[e].m(o,l),A(o,n,l),r=!0},p(o,[l]){let c=e;e=a(o),e===c?u[e].p(o,l):(H(),C(u[c],1,1,()=>{u[c]=null}),q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),y(t,1),t.m(n.parentNode,n))},i(o){r||(y(t),r=!0)},o(o){C(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function U0(i,e,t){let n=!1,{doc:r}=e,{studio:s=!1}=e,{attachment:u=!0}=e,{reply:a=!0}=e,{title:o=void 0}=e,{inStudio:l}=e,{isReply:c=!1}=e,{disabled:f=!1}=e,h,d=48;const p=()=>t(9,n=!n),D=()=>t(9,n=!n),g=()=>t(9,n=!n),m=()=>t(9,n=!n);function E(v){gn.call(this,i,v)}const B=()=>t(9,n=!n),F=()=>t(9,n=!n);return i.$$set=v=>{"doc"in v&&t(1,r=v.doc),"studio"in v&&t(2,s=v.studio),"attachment"in v&&t(3,u=v.attachment),"reply"in v&&t(4,a=v.reply),"title"in v&&t(0,o=v.title),"inStudio"in v&&t(5,l=v.inStudio),"isReply"in v&&t(6,c=v.isReply),"disabled"in v&&t(7,f=v.disabled)},i.$$.update=()=>{i.$$.dirty&1091&&(o!==void 0&&o.includes("<br>")?(t(10,h=o.split("<br>")),t(0,o=h.shift()),t(0,o),t(10,h),t(1,r),t(6,c),console.log("content",h),t(8,d=h.length*2+48)):r.text.includes("<br>")?(t(10,h=r.text.split("<br>")),t(8,d=h.length*3+32)):c&&t(8,d=18)),i.$$.dirty&256&&console.log("reaction",d)},[o,r,s,u,a,l,c,f,d,n,h,p,D,g,m,E,B,F]}class Ot extends re{constructor(e){super(),ne(this,e,U0,L0,te,{doc:1,studio:2,attachment:3,reply:4,title:0,inStudio:5,isReply:6,disabled:7})}}function ru(i,e,t){const n=i.slice();return n[5]=e[t],n}function z0(i){let e,t,n,r={ctx:i,current:null,token:null,hasCatch:!1,pending:Q0,then:W0,catch:q0,value:1,blocks:[,,,]};return wn(t=i[1],r),{c(){e=J(),r.block.c()},m(s,u){A(s,e,u),r.block.m(s,r.anchor=u),r.mount=()=>e.parentNode,r.anchor=e,n=!0},p(s,u){i=s,r.ctx=i,u&2&&t!==(t=i[1])&&wn(t,r)||ui(r,i,u)},i(s){n||(y(r.block),n=!0)},o(s){for(let u=0;u<3;u+=1){const a=r.blocks[u];C(a)}n=!1},d(s){s&&_(e),r.block.d(s),r.token=null,r=null}}}function H0(i){let e;return{c(){e=b("p"),e.textContent="No files yet"},m(t,n){A(t,e,n)},p:T,i:T,o:T,d(t){t&&_(e)}}}function q0(i){return{c:T,m:T,p:T,i:T,o:T,d:T}}function W0(i){let e=[],t=new Map,n,r,s=i[1];const u=a=>a[5].textHash+a[5].timestamp;for(let a=0;a<s.length;a+=1){let o=ru(i,s,a),l=u(o);t.set(l,e[a]=iu(l,o))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=J()},m(a,o){for(let l=0;l<e.length;l+=1)e[l].m(a,o);A(a,n,o),r=!0},p(a,o){o&7&&(s=a[1],H(),e=lt(e,o,u,1,a,s,t,n.parentNode,Jt,iu,n,ru),q())},i(a){if(!r){for(let o=0;o<s.length;o+=1)y(e[o]);r=!0}},o(a){for(let o=0;o<e.length;o+=1)C(e[o]);r=!1},d(a){for(let o=0;o<e.length;o+=1)e[o].d(a);a&&_(n)}}}function iu(i,e){let t,n,r,s,u;return n=new Ot({props:{doc:e[5],studio:!0,inStudio:e[0]}}),n.$on("update",e[2]),{key:i,first:null,c(){t=b("div"),W(n.$$.fragment),r=P(),k(t,"id",s=e[5].textHash+e[5].timestamp),k(t,"class","svelte-wx3xyn"),this.first=t},m(a,o){A(a,t,o),U(n,t,null),w(t,r),u=!0},p(a,o){e=a;const l={};o&2&&(l.doc=e[5]),o&1&&(l.inStudio=e[0]),n.$set(l),(!u||o&2&&s!==(s=e[5].textHash+e[5].timestamp))&&k(t,"id",s)},i(a){u||(y(n.$$.fragment,a),u=!0)},o(a){C(n.$$.fragment,a),u=!1},d(a){a&&_(t),z(n)}}}function Q0(i){let e;return{c(){e=b("p"),e.textContent="Loading..."},m(t,n){A(t,e,n)},p:T,i:T,o:T,d(t){t&&_(e)}}}function K0(i){let e,t,n,r,s,u,a;const o=[H0,z0],l=[];function c(f,h){return f[1].length===0?0:1}return s=c(i),u=l[s]=o[s](i),{c(){e=b("div"),t=b("h2"),t.textContent="Studio",n=P(),r=b("div"),u.c(),k(r,"class","flex svelte-wx3xyn")},m(f,h){A(f,e,h),w(e,t),w(e,n),w(e,r),l[s].m(r,null),a=!0},p(f,[h]){let d=s;s=c(f),s===d?l[s].p(f,h):(H(),C(l[d],1,1,()=>{l[d]=null}),q(),u=l[s],u?u.p(f,h):(u=l[s]=o[s](f),u.c()),y(u,1),u.m(r,null))},i(f){a||(y(u),a=!0)},o(f){C(u),a=!1},d(f){f&&_(e),l[s].d()}}}function V0(i,e,t){let n;Ee(i,kr,o=>t(3,n=o));let r=[],{inStudio:s}=e;const u=async()=>{t(1,r=n.cache.queryDocs({filter:{pathStartsWith:"/studio"}})),t(1,r=r.filter(o=>o.path.split("/").length<=6)),console.log("Docs",r)};n.cache.onCacheUpdated(()=>{u()}),Rt(()=>{u()});function a(){setTimeout(()=>{u()},1e3),console.log("UI updated")}return i.$$set=o=>{"inStudio"in o&&t(0,s=o.inStudio)},i.$$.update=()=>{i.$$.dirty&2&&t(1,r)},[s,r,a]}class G0 extends re{constructor(e){super(),ne(this,e,V0,K0,te,{inStudio:0})}}function su(i,e,t){const n=i.slice();return n[5]=e[t],n}function Z0(i){let e,t,n,r={ctx:i,current:null,token:null,hasCatch:!1,pending:ep,then:J0,catch:X0,value:1,blocks:[,,,]};return wn(t=i[1],r),{c(){e=J(),r.block.c()},m(s,u){A(s,e,u),r.block.m(s,r.anchor=u),r.mount=()=>e.parentNode,r.anchor=e,n=!0},p(s,u){i=s,r.ctx=i,u&2&&t!==(t=i[1])&&wn(t,r)||ui(r,i,u)},i(s){n||(y(r.block),n=!0)},o(s){for(let u=0;u<3;u+=1){const a=r.blocks[u];C(a)}n=!1},d(s){s&&_(e),r.block.d(s),r.token=null,r=null}}}function Y0(i){let e;return{c(){e=b("p"),e.textContent="No files yet"},m(t,n){A(t,e,n)},p:T,i:T,o:T,d(t){t&&_(e)}}}function X0(i){return{c:T,m:T,p:T,i:T,o:T,d:T}}function J0(i){let e=[],t=new Map,n,r,s=i[1];const u=a=>a[5].textHash;for(let a=0;a<s.length;a+=1){let o=su(i,s,a),l=u(o);t.set(l,e[a]=uu(l,o))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=J()},m(a,o){for(let l=0;l<e.length;l+=1)e[l].m(a,o);A(a,n,o),r=!0},p(a,o){o&7&&(s=a[1],H(),e=lt(e,o,u,1,a,s,t,n.parentNode,Jt,uu,n,su),q())},i(a){if(!r){for(let o=0;o<s.length;o+=1)y(e[o]);r=!0}},o(a){for(let o=0;o<e.length;o+=1)C(e[o]);r=!1},d(a){for(let o=0;o<e.length;o+=1)e[o].d(a);a&&_(n)}}}function uu(i,e){let t,n,r,s,u;return n=new Ot({props:{doc:e[5],studio:!0,inStudio:e[0]}}),n.$on("update",e[2]),{key:i,first:null,c(){t=b("div"),W(n.$$.fragment),r=P(),k(t,"id",s=e[5].textHash),k(t,"class","svelte-wx3xyn"),this.first=t},m(a,o){A(a,t,o),U(n,t,null),w(t,r),u=!0},p(a,o){e=a;const l={};o&2&&(l.doc=e[5]),o&1&&(l.inStudio=e[0]),n.$set(l),(!u||o&2&&s!==(s=e[5].textHash))&&k(t,"id",s)},i(a){u||(y(n.$$.fragment,a),u=!0)},o(a){C(n.$$.fragment,a),u=!1},d(a){a&&_(t),z(n)}}}function ep(i){let e;return{c(){e=b("p"),e.textContent="Loading..."},m(t,n){A(t,e,n)},p:T,i:T,o:T,d(t){t&&_(e)}}}function tp(i){let e,t,n,r,s,u,a;const o=[Y0,Z0],l=[];function c(f,h){return f[1].length===0?0:1}return s=c(i),u=l[s]=o[s](i),{c(){e=b("div"),t=b("h2"),t.textContent="The Oracle's offerings",n=P(),r=b("div"),u.c(),k(r,"class","flex svelte-wx3xyn")},m(f,h){A(f,e,h),w(e,t),w(e,n),w(e,r),l[s].m(r,null),a=!0},p(f,[h]){let d=s;s=c(f),s===d?l[s].p(f,h):(H(),C(l[d],1,1,()=>{l[d]=null}),q(),u=l[s],u?u.p(f,h):(u=l[s]=o[s](f),u.c()),y(u,1),u.m(r,null))},i(f){a||(y(u),a=!0)},o(f){C(u),a=!1},d(f){f&&_(e),l[s].d()}}}function np(i,e,t){let n;Ee(i,kr,o=>t(3,n=o));let r=[],{inStudio:s}=e;const u=async()=>{t(1,r=n.cache.queryDocs({filter:{pathStartsWith:"/oracle"}})),t(1,r=r.filter(o=>o.path.split("/").length<=6)),console.log("Docs",r)};n.cache.onCacheUpdated(()=>{u()}),Rt(()=>{u()});function a(){setTimeout(()=>{u()},1e3),console.log("UI updated")}return i.$$set=o=>{"inStudio"in o&&t(0,s=o.inStudio)},i.$$.update=()=>{i.$$.dirty&2&&t(1,r)},[s,r,a]}class rp extends re{constructor(e){super(),ne(this,e,np,tp,te,{inStudio:0})}}function ip(i){let e,t,n,r,s,u;return{c(){e=b("img"),n=P(),r=b("div"),r.textContent="Upload file",k(e,"class","upload svelte-hzy29y"),Xe(e.src,t=ap)||k(e,"src",t),k(e,"alt","Comics icons created by Freepik - Flaticon"),k(r,"class","uploadText svelte-hzy29y")},m(a,o){A(a,e,o),A(a,n,o),A(a,r,o),s||(u=[G(e,"click",i[8]),G(e,"keypress",i[9]),G(r,"click",i[10]),G(r,"keypress",i[11])],s=!0)},p:T,d(a){a&&_(e),a&&_(n),a&&_(r),s=!1,_e(u)}}}function sp(i){let e,t,n;return{c(){e=b("button"),e.textContent="make an offering to the oracle",k(e,"class","wrdbtn svelte-hzy29y")},m(r,s){A(r,e,s),t||(n=[G(e,"click",i[6]),G(e,"keypress",i[7])],t=!0)},p:T,d(r){r&&_(e),t=!1,_e(n)}}}function au(i){let e,t,n=i[1].kind+"",r;return{c(){e=b("p"),t=b("strong"),r=K(n)},m(s,u){A(s,e,u),w(e,t),w(t,r)},p(s,u){u&2&&n!==(n=s[1].kind+"")&&ge(r,n)},d(s){s&&_(e)}}}function up(i){let e,t,n,r,s,u,a;function o(h,d){return h[0]?sp:ip}let l=o(i),c=l(i),f=i[1]&&au(i);return{c(){e=b("div"),t=b("div"),c.c(),n=P(),r=b("input"),s=P(),f&&f.c(),qe(r,"display","none"),k(r,"type","file"),k(r,"accept",".jpg, .jpeg, .png, .gif, .txt, .pdf, .md, .webm, .mp3, .ogg, .wav"),k(t,"class","svelte-hzy29y"),k(e,"class","svelte-hzy29y")},m(h,d){A(h,e,d),w(e,t),c.m(t,null),w(t,n),w(t,r),i[13](r),w(e,s),f&&f.m(e,null),u||(a=G(r,"change",i[12]),u=!0)},p(h,[d]){l===(l=o(h))&&c?c.p(h,d):(c.d(1),c=l(h),c&&(c.c(),c.m(t,n))),h[1]?f?f.p(h,d):(f=au(h),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i:T,o:T,d(h){h&&_(e),c.d(),i[13](null),f&&f.d(),u=!1,a()}}}let ap="images/insert-picture-icon.png";function op(i){return new Promise((e,t)=>{let n=new FileReader;n.onload=()=>{e(n.result),console.log("typeof",n.result)},n.onerror=t,n.readAsArrayBuffer(i)})}function lp(i,e,t){let n,r;Ee(i,It,v=>t(16,n=v)),Ee(i,rn,v=>t(17,r=v));const s=Xt();let{inStudio:u}=e,{xy:a=[0,0]}=e,{oracle:o=!1}=e,l,c,f;async function h(v){let x=v.target.files[0],R=x.name.replace(/\s+/g,"_").replace(/[@,\/#!$%\^&\*;:{}=\-`~()]/g,""),Q=R.split(".").pop(),N=R.split(".")[R.split(".").length-2],j;(Q==="JPG"||Q==="jpg")&&(Q="jpeg"),j=N+"."+Q;let O=Date.now(),ie=await op(x),Ie=(Date.now()+25488e5)*1e3,oe=new Uint8Array(ie);return o?await r.replica.set(n,{path:`/oracle/${O}/!${j}`,text:"Offering by "+n.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:oe,deleteAfter:Ie}):(u||t(1,c=await r.replica.set(n,{path:`/documents/${a[1]}/${a[0]}/${O}/!${j}`,text:"Shared by "+n.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:oe,deleteAfter:Ie})),f=await r.replica.set(n,{path:`/studio/${a[1]}/${a[0]}/${O}/${j}`,text:"Shared by "+n.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:oe})),console.log("Result: ",c),M(c)&&console.error(c),console.log("Studio: ",f),M(f)&&console.error(f),s("success"),c}const d=()=>{l.click()},p=()=>{l.click()},D=()=>{l.click()},g=()=>{l.click()},m=()=>{l.click()},E=()=>{l.click()},B=v=>h(v);function F(v){hr[v?"unshift":"push"](()=>{l=v,t(2,l)})}return i.$$set=v=>{"inStudio"in v&&t(4,u=v.inStudio),"xy"in v&&t(5,a=v.xy),"oracle"in v&&t(0,o=v.oracle)},i.$$.update=()=>{i.$$.dirty&2&&t(1,c)},[o,c,l,h,u,a,d,p,D,g,m,E,B,F]}class Za extends re{constructor(e){super(),ne(this,e,lp,up,te,{inStudio:4,xy:5,oracle:0})}}function ou(i,e,t){const n=i.slice();return n[13]=e[t],n[15]=t,n}function lu(i,e,t){const n=i.slice();return n[16]=e[t],n[18]=t,n}function cu(i,e,t){const n=i.slice();return n[16]=e[t],n[20]=t,n}function fu(i,e,t){const n=i.slice();return n[21]=e[t],n}function cp(i){let e=[],t=new Map,n,r,s=i[5];const u=a=>a[15];for(let a=0;a<s.length;a+=1){let o=ou(i,s,a),l=u(o);t.set(l,e[a]=mu(l,o))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=J()},m(a,o){for(let l=0;l<e.length;l+=1)e[l].m(a,o);A(a,n,o),r=!0},p(a,o){o&511&&(s=a[5],H(),e=lt(e,o,u,1,a,s,t,n.parentNode,Jt,mu,n,ou),q())},i(a){if(!r){for(let o=0;o<s.length;o+=1)y(e[o]);r=!0}},o(a){for(let o=0;o<e.length;o+=1)C(e[o]);r=!1},d(a){for(let o=0;o<e.length;o+=1)e[o].d(a);a&&_(n)}}}function fp(i){let e;return{c(){e=b("p"),e.textContent="No files yet"},m(t,n){A(t,e,n)},p:T,i:T,o:T,d(t){t&&_(e)}}}function hu(i){let e,t,n,r,s;const u=[pp,dp,hp],a=[];function o(l,c){return l[13]==l[5][0]?0:l[6]<l[21].deleteAfter-l[13]&&l[6]>l[21].deleteAfter-(l[13]+36e8)?2:1}return t=o(i),n=a[t]=u[t](i),{c(){e=b("div"),n.c(),k(e,"id",r=i[21].textHash+i[21].timestamp),k(e,"class","svelte-1bu1ie4")},m(l,c){A(l,e,c),a[t].m(e,null),s=!0},p(l,c){let f=t;t=o(l),t===f?a[t].p(l,c):(H(),C(a[f],1,1,()=>{a[f]=null}),q(),n=a[t],n?n.p(l,c):(n=a[t]=u[t](l),n.c()),y(n,1),n.m(e,null)),(!s||c&2&&r!==(r=l[21].textHash+l[21].timestamp))&&k(e,"id",r)},i(l){s||(y(n),s=!0)},o(l){C(n),s=!1},d(l){l&&_(e),a[t].d()}}}function hp(i){let e,t;return e=new Ot({props:{doc:i[21],inStudio:i[0]}}),e.$on("update",i[8]),{c(){W(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,r){const s={};r&2&&(s.doc=n[21]),r&1&&(s.inStudio=n[0]),e.$set(s)},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function dp(i){let e,t;return e=new Ot({props:{doc:i[21],inStudio:i[0],disabled:!0}}),e.$on("update",i[8]),{c(){W(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,r){const s={};r&2&&(s.doc=n[21]),r&1&&(s.inStudio=n[0]),e.$set(s)},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function pp(i){let e,t,n,r;const s=[mp,Dp],u=[];function a(o,l){return o[6]<o[21].deleteAfter-o[13]?1:0}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=J()},m(o,l){u[e].m(o,l),A(o,n,l),r=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(H(),C(u[c],1,1,()=>{u[c]=null}),q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),y(t,1),t.m(n.parentNode,n))},i(o){r||(y(t),r=!0)},o(o){C(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function Dp(i){let e,t;return e=new Ot({props:{doc:i[21],inStudio:i[0]}}),e.$on("update",i[8]),{c(){W(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,r){const s={};r&2&&(s.doc=n[21]),r&1&&(s.inStudio=n[0]),e.$set(s)},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function mp(i){let e,t;return e=new Ot({props:{doc:i[21],inStudio:i[0],disabled:!0}}),e.$on("update",i[8]),{c(){W(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,r){const s={};r&2&&(s.doc=n[21]),r&1&&(s.inStudio=n[0]),e.$set(s)},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function du(i,e){let t,n=e[21].path.split("/")[2]==e[20]&&e[21].path.split("/")[3]==e[18],r,s,u=n&&hu(e);return{key:i,first:null,c(){t=J(),u&&u.c(),r=J(),this.first=t},m(a,o){A(a,t,o),u&&u.m(a,o),A(a,r,o),s=!0},p(a,o){e=a,o&2&&(n=e[21].path.split("/")[2]==e[20]&&e[21].path.split("/")[3]==e[18]),n?u?(u.p(e,o),o&2&&y(u,1)):(u=hu(e),u.c(),y(u,1),u.m(r.parentNode,r)):u&&(H(),C(u,1,1,()=>{u=null}),q())},i(a){s||(y(u),s=!0)},o(a){C(u),s=!1},d(a){a&&_(t),u&&u.d(a),a&&_(r)}}}function pu(i,e){let t,n=[],r=new Map,s,u=e[1];const a=o=>o[21].textHash+o[21].timestamp;for(let o=0;o<u.length;o+=1){let l=fu(e,u,o),c=a(l);r.set(c,n[o]=du(c,l))}return{key:i,first:null,c(){t=b("div");for(let o=0;o<n.length;o+=1)n[o].c();k(t,"id",e[18]+"-"+e[20]),k(t,"class","svelte-1bu1ie4"),this.first=t},m(o,l){A(o,t,l);for(let c=0;c<n.length;c+=1)n[c].m(t,null);s=!0},p(o,l){e=o,l&371&&(u=e[1],H(),n=lt(n,l,a,1,e,u,r,t,Jt,du,null,fu),q())},i(o){if(!s){for(let l=0;l<u.length;l+=1)y(n[l]);s=!0}},o(o){for(let l=0;l<n.length;l+=1)C(n[l]);s=!1},d(o){o&&_(t);for(let l=0;l<n.length;l+=1)n[l].d()}}}function Du(i,e){let t,n=[],r=new Map,s,u,a={length:e[4][1]};const o=l=>l[20];for(let l=0;l<a.length;l+=1){let c=cu(e,a,l),f=o(c);r.set(f,n[l]=pu(f,c))}return{key:i,first:null,c(){t=J();for(let l=0;l<n.length;l+=1)n[l].c();s=J(),this.first=t},m(l,c){A(l,t,c);for(let f=0;f<n.length;f+=1)n[f].m(l,c);A(l,s,c),u=!0},p(l,c){e=l,c&371&&(a={length:e[4][1]},H(),n=lt(n,c,o,1,e,a,r,s.parentNode,Jt,pu,s,cu),q())},i(l){if(!u){for(let c=0;c<a.length;c+=1)y(n[c]);u=!0}},o(l){for(let c=0;c<n.length;c+=1)C(n[c]);u=!1},d(l){l&&_(t);for(let c=0;c<n.length;c+=1)n[c].d(l);l&&_(s)}}}function mu(i,e){let t,n=[],r=new Map,s,u,a={length:e[4][0]};const o=l=>l[18];for(let l=0;l<a.length;l+=1){let c=lu(e,a,l),f=o(c);r.set(f,n[l]=Du(f,c))}return{key:i,first:null,c(){t=b("div");for(let l=0;l<n.length;l+=1)n[l].c();s=P(),k(t,"class","container svelte-1bu1ie4"),qe(t,"grid-template-rows",e[2]),qe(t,"grid-template-columns",e[3]),qe(t,"background-color",e[7][e[15]]),this.first=t},m(l,c){A(l,t,c);for(let f=0;f<n.length;f+=1)n[f].m(t,null);w(t,s),u=!0},p(l,c){e=l,c&371&&(a={length:e[4][0]},H(),n=lt(n,c,o,1,e,a,r,t,Jt,Du,s,lu),q()),(!u||c&4)&&qe(t,"grid-template-rows",e[2]),(!u||c&8)&&qe(t,"grid-template-columns",e[3])},i(l){if(!u){for(let c=0;c<a.length;c+=1)y(n[c]);u=!0}},o(l){for(let c=0;c<n.length;c+=1)C(n[c]);u=!1},d(l){l&&_(t);for(let c=0;c<n.length;c+=1)n[c].d()}}}function gp(i){let e,t,n,r,s,u,a,o,l;r=new Za({props:{oracle:bp,inStudio:i[0]}});const c=[fp,cp],f=[];function h(d,p){return d[1].length===0?0:1}return a=h(i),o=f[a]=c[a](i),{c(){e=b("div"),t=b("h2"),t.textContent="The Commons",n=P(),W(r.$$.fragment),s=P(),u=b("div"),o.c(),k(t,"class","svelte-1bu1ie4"),k(u,"class","flex")},m(d,p){A(d,e,p),w(e,t),w(e,n),U(r,e,null),w(e,s),w(e,u),f[a].m(u,null),l=!0},p(d,[p]){const D={};p&1&&(D.inStudio=d[0]),r.$set(D);let g=a;a=h(d),a===g?f[a].p(d,p):(H(),C(f[g],1,1,()=>{f[g]=null}),q(),o=f[a],o?o.p(d,p):(o=f[a]=c[a](d),o.c()),y(o,1),o.m(u,null))},i(d){l||(y(r.$$.fragment,d),y(o),l=!0)},o(d){C(r.$$.fragment,d),C(o),l=!1},d(d){d&&_(e),z(r),f[a].d()}}}let bp=!0;function wp(i,e,t){let n,r,s,u;Ee(i,kr,D=>t(9,s=D)),Ee(i,Ua,D=>t(10,u=D));let a=[4,8],o=[],l=[108e8,72e8,36e8,0],c=u.getTime()*1e3,f=["#b5d1c0","#d3e3d9","#f9dfdd","#fff5d9"],{inStudio:h}=e;const d=async()=>{t(1,o=s.cache.queryDocs({filter:{pathStartsWith:"/documents"}})),t(1,o=o.filter(D=>D.path.split("/").length<=6)),console.log("Docs",o)};s.cache.onCacheUpdated(()=>{d()}),Rt(()=>{d()});function p(){setTimeout(()=>{d()},1e3)}return i.$$set=D=>{"inStudio"in D&&t(0,h=D.inStudio)},i.$$.update=()=>{i.$$.dirty&2&&t(1,o)},t(3,n=`repeat(${a[1]}, 1fr)`),t(2,r=`repeat(${a[0]}, 1fr)`),[h,o,r,n,a,l,c,f,p]}class _p extends re{constructor(e){super(),ne(this,e,wp,gp,te,{inStudio:0})}}function gu(i,e,t){const n=i.slice();return n[16]=e[t],n[18]=t,n}function bu(i,e,t){const n=i.slice();return n[16]=e[t],n[20]=t,n}function wu(i){let e,t,n,r,s;return t=new Za({props:{xy:i[2],inStudio:i[1]}}),t.$on("success",i[9]),r=new Ga({props:{xy:i[2],inStudio:i[1]}}),r.$on("upload",i[10]),{c(){e=b("div"),W(t.$$.fragment),n=P(),W(r.$$.fragment),k(e,"class","flex-row svelte-10uxjwt")},m(u,a){A(u,e,a),U(t,e,null),w(e,n),U(r,e,null),s=!0},p(u,a){const o={};a&4&&(o.xy=u[2]),a&2&&(o.inStudio=u[1]),t.$set(o);const l={};a&4&&(l.xy=u[2]),a&2&&(l.inStudio=u[1]),r.$set(l)},i(u){s||(y(t.$$.fragment,u),y(r.$$.fragment,u),s=!0)},o(u){C(t.$$.fragment,u),C(r.$$.fragment,u),s=!1},d(u){u&&_(e),z(t),z(r)}}}function _u(i){let e,t,n,r=[],s=new Map,u={length:i[0][0]};const a=o=>o[18];for(let o=0;o<u.length;o+=1){let l=gu(i,u,o),c=a(l);s.set(c,r[o]=Au(c,l))}return{c(){e=b("h4"),e.textContent="Select location on map",t=P(),n=b("div");for(let o=0;o<r.length;o+=1)r[o].c();k(n,"class","container svelte-10uxjwt"),qe(n,"grid-template-rows",i[6]),qe(n,"grid-template-columns",i[7])},m(o,l){A(o,e,l),A(o,t,l),A(o,n,l);for(let c=0;c<r.length;c+=1)r[c].m(n,null)},p(o,l){l&289&&(u={length:o[0][0]},r=lt(r,l,a,1,o,u,s,n,ai,Au,null,gu)),l&64&&qe(n,"grid-template-rows",o[6]),l&128&&qe(n,"grid-template-columns",o[7])},d(o){o&&_(e),o&&_(t),o&&_(n);for(let l=0;l<r.length;l+=1)r[l].d()}}}function yu(i,e){let t,n,r;function s(){return e[11](e[18],e[20])}function u(){return e[12](e[18],e[20])}return{key:i,first:null,c(){t=b("div"),k(t,"class","svelte-10uxjwt"),at(t,"active",e[5][e[18]][e[20]]),this.first=t},m(a,o){A(a,t,o),n||(r=[G(t,"click",s),G(t,"keypress",u)],n=!0)},p(a,o){e=a,o&33&&at(t,"active",e[5][e[18]][e[20]])},d(a){a&&_(t),n=!1,_e(r)}}}function Au(i,e){let t,n=[],r=new Map,s,u={length:e[0][1]};const a=o=>o[20];for(let o=0;o<u.length;o+=1){let l=bu(e,u,o),c=a(l);r.set(c,n[o]=yu(c,l))}return{key:i,first:null,c(){t=J();for(let o=0;o<n.length;o+=1)n[o].c();s=J(),this.first=t},m(o,l){A(o,t,l);for(let c=0;c<n.length;c+=1)n[c].m(o,l);A(o,s,l)},p(o,l){e=o,l&289&&(u={length:e[0][1]},n=lt(n,l,a,1,e,u,r,s.parentNode,ai,yu,s,bu))},d(o){o&&_(t);for(let l=0;l<n.length;l+=1)n[l].d(o);o&&_(s)}}}function yp(i){let e,t,n,r,s,u=i[3]&&wu(i),a=i[4]&&_u(i);return{c(){e=b("h3"),e.textContent="Upload artifact",t=P(),u&&u.c(),n=P(),a&&a.c(),r=J()},m(o,l){A(o,e,l),A(o,t,l),u&&u.m(o,l),A(o,n,l),a&&a.m(o,l),A(o,r,l),s=!0},p(o,[l]){o[3]?u?(u.p(o,l),l&8&&y(u,1)):(u=wu(o),u.c(),y(u,1),u.m(n.parentNode,n)):u&&(H(),C(u,1,1,()=>{u=null}),q()),o[4]?a?a.p(o,l):(a=_u(o),a.c(),a.m(r.parentNode,r)):a&&(a.d(1),a=null)},i(o){s||(y(u),s=!0)},o(o){C(u),s=!1},d(o){o&&_(e),o&&_(t),u&&u.d(o),o&&_(n),a&&a.d(o),o&&_(r)}}}function Ap(i,e,t){let n,r,s,{grid:u=[4,8]}=e,a=[],o=!1,l=!0,{inStudio:c}=e;function f(E,B){t(2,a=[E,B]),d([E,B]),setTimeout(()=>{t(3,o=!0),t(4,l=!1)},500)}function h([E,B],[F,v]){return(E-a[0])*(E-F)<=0&&(B-a[1])*(B-v)<=0}function d(E){t(5,s=s.map((B,F)=>B.map((v,x)=>h([F,x],E))))}function p(E){gn.call(this,i,E)}function D(E){gn.call(this,i,E)}const g=(E,B)=>f(E,B),m=(E,B)=>f(E,B);return i.$$set=E=>{"grid"in E&&t(0,u=E.grid),"inStudio"in E&&t(1,c=E.inStudio)},i.$$.update=()=>{i.$$.dirty&1&&t(7,n=`repeat(${u[1]}, 1fr)`),i.$$.dirty&1&&t(6,r=`repeat(${u[0]}, 1fr)`),i.$$.dirty&1&&t(5,s=Array(u[0]).fill(0).map(E=>Array(u[1]).fill(!1)))},[u,c,a,o,l,s,r,n,f,p,D,g,m]}class Cp extends re{constructor(e){super(),ne(this,e,Ap,yp,te,{grid:0,inStudio:1})}}function Cu(i,e,t){const n=i.slice();return n[10]=e[t],n}function Eu(i){let e,t,n,r,s,u,a,o,l,c,f,h,d,p,D,g,m,E,B,F,v,x,S,R,Q,N,j=i[1]&&ku(i);return{c(){e=b("div"),t=b("div"),n=b("h2"),r=K("Status: "),s=b("strong"),s.textContent=`${i[3].status}`,u=P(),a=b("h3"),o=K("Share "),l=b("strong"),l.textContent=`${i[8]}`,c=P(),f=b("div"),h=b("h4"),h.textContent="Documents",d=P(),p=b("p"),D=b("strong"),D.textContent=`${i[5]}`,g=K(" documents sent"),m=P(),E=b("p"),B=b("strong"),B.textContent=`${i[6]}`,F=K(" documents received"),v=P(),x=b("p"),S=b("strong"),S.textContent=`${i[7]}`,R=K(" documents requested"),Q=P(),j&&j.c(),N=J(),k(t,"class","flex-col"),k(f,"class","flex-col left-a svelte-wgmj91"),k(e,"class","flex svelte-wgmj91")},m(O,ie){A(O,e,ie),w(e,t),w(t,n),w(n,r),w(n,s),w(t,u),w(t,a),w(a,o),w(a,l),w(e,c),w(e,f),w(f,h),w(f,d),w(f,p),w(p,D),w(p,g),w(f,m),w(f,E),w(E,B),w(E,F),w(f,v),w(f,x),w(x,S),w(x,R),A(O,Q,ie),j&&j.m(O,ie),A(O,N,ie)},p(O,ie){O[1]?j?j.p(O,ie):(j=ku(O),j.c(),j.m(N.parentNode,N)):j&&(j.d(1),j=null)},d(O){O&&_(e),O&&_(Q),j&&j.d(O),O&&_(N)}}}function ku(i){let e,t,n,r=[],s=new Map,u=i[4];const a=o=>o[10].hash;for(let o=0;o<u.length;o+=1){let l=Cu(i,u,o),c=a(l);s.set(c,r[o]=Fu(c,l))}return{c(){e=b("h4"),e.textContent=`${i[4].length} Attachments`,t=P(),n=b("div");for(let o=0;o<r.length;o+=1)r[o].c();k(e,"class","left-a svelte-wgmj91"),k(n,"class","flex svelte-wgmj91")},m(o,l){A(o,e,l),A(o,t,l),A(o,n,l);for(let c=0;c<r.length;c+=1)r[c].m(n,null)},p(o,l){l&16&&(u=o[4],r=lt(r,l,a,1,o,u,s,n,ai,Fu,null,Cu))},d(o){o&&_(e),o&&_(t),o&&_(n);for(let l=0;l<r.length;l+=1)r[l].d()}}}function Fu(i,e){let t,n,r,s=e[10].kind+"",u,a,o,l=e[10].status+"",c,f,h,d,p,D=e[10].bytesLoaded+"",g,m,E,B,F,v=e[10].totalBytes+"",x,S,R,Q,N,j=e[10].author.slice(0,9)+"",O,ie,Ie;return{key:i,first:null,c(){t=b("div"),n=b("h5"),r=b("span"),u=K(s),a=P(),o=b("strong"),c=K(l),f=P(),h=b("p"),d=K("Bytes loaded: "),p=b("strong"),g=K(D),m=P(),E=b("p"),B=K("Total bytes: "),F=b("strong"),x=K(v),S=P(),R=b("p"),Q=K("Author: "),N=b("strong"),O=K(j),ie=K("..."),Ie=P(),k(r,"class","kind svelte-wgmj91"),this.first=t},m(oe,kt){A(oe,t,kt),w(t,n),w(n,r),w(r,u),w(n,a),w(n,o),w(o,c),w(t,f),w(t,h),w(h,d),w(h,p),w(p,g),w(t,m),w(t,E),w(E,B),w(E,F),w(F,x),w(t,S),w(t,R),w(R,Q),w(R,N),w(N,O),w(N,ie),w(t,Ie)},p(oe,kt){e=oe},d(oe){oe&&_(t)}}}function Ep(i){let e,t,n,r,s,u,a,o=i[2].shareAddress+"",l,c,f,h,d,p=i[2].secret+"",D,g,m=i[0]!==void 0&&Eu(i);return{c(){e=b("div"),t=b("div"),n=b("h2"),n.textContent="Status Panel & Current Share Details",r=P(),s=b("p"),u=b("b"),u.textContent="Address:",a=P(),l=K(o),c=P(),f=b("p"),h=b("b"),h.textContent="Secret:",d=P(),D=K(p),g=P(),m&&m.c(),k(t,"class","left-a svelte-wgmj91")},m(E,B){A(E,e,B),w(e,t),w(t,n),w(t,r),w(t,s),w(s,u),w(s,a),w(s,l),w(t,c),w(t,f),w(f,h),w(f,d),w(f,D),w(e,g),m&&m.m(e,null)},p(E,[B]){B&4&&o!==(o=E[2].shareAddress+"")&&ge(l,o),B&4&&p!==(p=E[2].secret+"")&&ge(D,p),E[0]!==void 0?m?m.p(E,B):(m=Eu(E),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},i:T,o:T,d(E){E&&_(e),m&&m.d()}}}function kp(i,e,t){let n;Ee(i,wi,d=>t(2,n=d));let{status:r=void 0}=e,s=n.shareAddress,u=r[s].docs,a=r[s].attachments,o=!1,l=u.sentCount,c=u.receivedCount,f=u.requestedCount,h=s.slice(0,8);return i.$$set=d=>{"status"in d&&t(0,r=d.status)},i.$$.update=()=>{i.$$.dirty&1&&t(0,r)},a.length>0&&t(1,o=!0),[r,o,n,u,a,l,c,f,h]}class Fp extends re{constructor(e){super(),ne(this,e,kp,Ep,te,{status:0})}}function vu(i){let e,t,n,r,s;return{c(){e=b("input"),t=P(),n=b("button"),n.textContent="Submit address",k(e,"type","text"),k(e,"spellcheck","false"),k(e,"class","svelte-1dmp5sz"),k(n,"class","svelte-1dmp5sz")},m(u,a){A(u,e,a),Tt(e,i[1]),A(u,t,a),A(u,n,a),r||(s=[G(e,"input",i[9]),G(n,"click",i[10])],r=!0)},p(u,a){a&2&&e.value!==u[1]&&Tt(e,u[1])},d(u){u&&_(e),u&&_(t),u&&_(n),r=!1,_e(s)}}}function Bu(i){let e,t,n;return{c(){e=b("p"),t=b("strong"),n=K(i[3])},m(r,s){A(r,e,s),w(e,t),w(t,n)},p(r,s){s&8&&ge(n,r[3])},d(r){r&&_(e)}}}function vp(i){let e,t,n,r,s,u,a,o,l=i[4]&&vu(i),c=i[2]&&Bu(i);return{c(){e=b("div"),t=b("input"),n=P(),r=b("button"),r.textContent="Submit address",s=P(),l&&l.c(),u=P(),c&&c.c(),k(t,"type","text"),k(t,"spellcheck","false"),k(t,"class","svelte-1dmp5sz"),k(r,"class","svelte-1dmp5sz"),k(e,"class","svelte-1dmp5sz")},m(f,h){A(f,e,h),w(e,t),Tt(t,i[0]),w(e,n),w(e,r),w(e,s),l&&l.m(e,null),w(e,u),c&&c.m(e,null),a||(o=[G(t,"input",i[7]),G(r,"click",i[8])],a=!0)},p(f,[h]){h&1&&t.value!==f[0]&&Tt(t,f[0]),f[4]?l?l.p(f,h):(l=vu(f),l.c(),l.m(e,u)):l&&(l.d(1),l=null),f[2]?c?c.p(f,h):(c=Bu(f),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i:T,o:T,d(f){f&&_(e),l&&l.d(),c&&c.d(),a=!1,_e(o)}}}function Bp(i,e,t){let n;Ee(i,wi,g=>t(11,n=g));let r="Add a new share address",s="Add the share's secret",u=!1,a,o=!1;const l=new gi;function c(g){if(M(xt(g))){t(2,u=!0),t(3,a="Not a valid share address");return}else t(2,u=!1),l.addShare(g),ei.set({settings:l}),t(4,o=!0),console.log("You are currently signed in as",l.author||"no-one!"),console.log("You have",l.shares.length,"shares"),console.log("Your shares are",l.shares)}async function f(){let g={address:r,secret:s};const m=await we.checkKeypairIsValid(g);if(console.log(r,typeof r),console.log(s,typeof s),console.log(m),M(m)){t(2,u=!0),t(3,a="Not the right secret for this share.");return}else t(2,u=!1),l.addSecret(r,s),ei.set({settings:l}),console.log("You are currently signed in as",l.author||"no-one!"),console.log("You have",l.shares.length,"shares"),console.log("Your shares are",l.shares),console.log("You know the secret to these shares:",l.shareSecrets)}Rt(()=>{n!==void 0&&(l.addShare(n.shareAddress),l.addSecret(n.shareAddress,n.secret))});function h(){r=this.value,t(0,r)}const d=()=>c(r);function p(){s=this.value,t(1,s)}return[r,s,u,a,o,c,f,h,d,p,()=>f()]}class Sp extends re{constructor(e){super(),ne(this,e,Bp,vp,te,{})}}function Su(i){let e,t,n,r,s,u,a,o,l;r=new Na({}),r.$on("alias",i[8]),r.$on("error",i[9]);let c=i[4]===!0&&Tu();return{c(){e=b("div"),t=b("button"),t.textContent="Generate new Identity",n=P(),W(r.$$.fragment),s=P(),c&&c.c(),u=J(),k(t,"class","wrdfnt svelte-d8179f"),k(e,"class","flex-row svelte-d8179f")},m(f,h){A(f,e,h),w(e,t),w(e,n),U(r,e,null),A(f,s,h),c&&c.m(f,h),A(f,u,h),a=!0,o||(l=G(t,"click",i[16]),o=!0)},p(f,h){f[4]===!0?c?h&16&&y(c,1):(c=Tu(),c.c(),y(c,1),c.m(u.parentNode,u)):c&&(H(),C(c,1,1,()=>{c=null}),q())},i(f){a||(y(r.$$.fragment,f),y(c),a=!0)},o(f){C(r.$$.fragment,f),C(c),a=!1},d(f){f&&_(e),z(r),f&&_(s),c&&c.d(f),f&&_(u),o=!1,l()}}}function Tu(i){let e,t,n;return{c(){e=b("blockquote"),e.textContent="Please upload a valid identity file"},m(r,s){A(r,e,s),n=!0},i(r){n||(Kt(()=>{t||(t=bn(e,Cn,{y:200,duration:2e3},!0)),t.run(1)}),n=!0)},o(r){t||(t=bn(e,Cn,{y:200,duration:2e3},!1)),t.run(0),n=!1},d(r){r&&_(e),r&&t&&t.end()}}}function Tp(i){let e,t=i[7].address.slice(0,5)+"",n,r,s,u,a,o,l,c,f,h,d,p,D,g;const m=[Op,xp,Rp,Ip],E=[];function B(O,ie){return!O[2]&&!O[3]?0:O[10]?1:O[11]?2:O[3]?-1:3}~(s=B(i))&&(u=E[s]=m[s](i));function F(O,ie){return O[2]?Mp:$p}let v=F(i),x=v(i),S=i[6]!==void 0&&Pu(i),R=i[5]&&Iu();function Q(O,ie){return O[5]?Lp:Up}let N=Q(i),j=N(i);return{c(){e=b("button"),n=K(t),r=P(),u&&u.c(),a=P(),o=b("button"),x.c(),l=P(),S&&S.c(),c=P(),f=b("div"),R&&R.c(),h=P(),d=b("button"),j.c(),k(e,"class","topleft svelte-d8179f"),k(o,"class","topright svelte-d8179f"),k(d,"class","svelte-d8179f"),k(f,"class","bottomright svelte-d8179f")},m(O,ie){A(O,e,ie),w(e,n),A(O,r,ie),~s&&E[s].m(O,ie),A(O,a,ie),A(O,o,ie),x.m(o,null),A(O,l,ie),S&&S.m(O,ie),A(O,c,ie),A(O,f,ie),R&&R.m(f,null),w(f,h),w(f,d),j.m(d,null),p=!0,D||(g=[G(e,"click",i[13]),G(o,"click",i[15]),G(d,"click",i[14])],D=!0)},p(O,ie){(!p||ie&128)&&t!==(t=O[7].address.slice(0,5)+"")&&ge(n,t);let Ie=s;s=B(O),s===Ie?~s&&E[s].p(O,ie):(u&&(H(),C(E[Ie],1,1,()=>{E[Ie]=null}),q()),~s?(u=E[s],u?u.p(O,ie):(u=E[s]=m[s](O),u.c()),y(u,1),u.m(a.parentNode,a)):u=null),v!==(v=F(O))&&(x.d(1),x=v(O),x&&(x.c(),x.m(o,null))),O[6]!==void 0?S?S.p(O,ie):(S=Pu(O),S.c(),S.m(c.parentNode,c)):S&&(S.d(1),S=null),O[5]?R?ie&32&&y(R,1):(R=Iu(),R.c(),y(R,1),R.m(f,h)):R&&(H(),C(R,1,1,()=>{R=null}),q()),N!==(N=Q(O))&&(j.d(1),j=N(O),j&&(j.c(),j.m(d,null)))},i(O){p||(y(u),y(R),p=!0)},o(O){C(u),C(R),p=!1},d(O){O&&_(e),O&&_(r),~s&&E[s].d(O),O&&_(a),O&&_(o),x.d(),O&&_(l),S&&S.d(O),O&&_(c),O&&_(f),R&&R.d(),j.d(),D=!1,_e(g)}}}function Pp(i){let e,t,n;return{c(){e=b("button"),e.textContent="Hide identity details",k(e,"class","topleft svelte-d8179f")},m(r,s){A(r,e,s),t||(n=G(e,"click",i[13]),t=!0)},p:T,i:T,o:T,d(r){r&&_(e),t=!1,n()}}}function Ip(i){let e,t;return e=new _p({props:{inStudio:i[10]}}),{c(){W(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p:T,i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function Rp(i){let e,t;return e=new rp({props:{inStudio:i[10]}}),{c(){W(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p:T,i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function xp(i){let e,t;return e=new G0({props:{inStudio:i[10]}}),{c(){W(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p:T,i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function Op(i){let e,t,n;return t=new Cp({props:{inStudio:i[10]}}),t.$on("success",i[17]),t.$on("upload",i[18]),{c(){e=b("div"),W(t.$$.fragment)},m(r,s){A(r,e,s),U(t,e,null),n=!0},p:T,i(r){n||(y(t.$$.fragment,r),n=!0)},o(r){C(t.$$.fragment,r),n=!1},d(r){r&&_(e),z(t)}}}function $p(i){let e;return{c(){e=K("Explore the commons")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function Mp(i){let e;return{c(){e=K("Place an artefact")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function Pu(i){let e,t,n;function r(a,o){return a[3]?Np:jp}let s=r(i),u=s(i);return{c(){e=b("button"),u.c(),k(e,"class","bottomleft svelte-d8179f")},m(a,o){A(a,e,o),u.m(e,null),t||(n=G(e,"click",i[12]),t=!0)},p(a,o){s!==(s=r(a))&&(u.d(1),u=s(a),u&&(u.c(),u.m(e,null)))},d(a){a&&_(e),u.d(),t=!1,n()}}}function Np(i){let e;return{c(){e=K("Hide status panel")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function jp(i){let e;return{c(){e=K("Show status panel")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function Iu(i){let e,t,n;return t=new Sp({}),{c(){e=b("div"),W(t.$$.fragment)},m(r,s){A(r,e,s),U(t,e,null),n=!0},i(r){n||(y(t.$$.fragment,r),n=!0)},o(r){C(t.$$.fragment,r),n=!1},d(r){r&&_(e),z(t)}}}function Lp(i){let e;return{c(){e=K("Hide share settings")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function Up(i){let e;return{c(){e=K("Add a share")},m(t,n){A(t,e,n)},d(t){t&&_(e)}}}function Ru(i){let e,t,n;return t=new yf({}),{c(){e=b("div"),W(t.$$.fragment),k(e,"class","svelte-d8179f"),at(e,"showDetails",i[1])},m(r,s){A(r,e,s),U(t,e,null),n=!0},p(r,s){(!n||s&2)&&at(e,"showDetails",r[1])},i(r){n||(y(t.$$.fragment,r),n=!0)},o(r){C(t.$$.fragment,r),n=!1},d(r){r&&_(e),z(t)}}}function xu(i){let e,t,n;return t=new Fp({props:{status:i[6]}}),{c(){e=b("div"),W(t.$$.fragment)},m(r,s){A(r,e,s),U(t,e,null),n=!0},p(r,s){const u={};s&64&&(u.status=r[6]),t.$set(u)},i(r){n||(y(t.$$.fragment,r),n=!0)},o(r){C(t.$$.fragment,r),n=!1},d(r){r&&_(e),z(t)}}}function zp(i){let e,t,n,r,s,u,a,o,l=!i[0]&&Su(i);const c=[Pp,Tp],f=[];function h(D,g){return D[0]&&!D[1]?0:D[0]&&D[1]?1:-1}~(r=h(i))&&(s=f[r]=c[r](i));let d=i[0]&&Ru(i),p=i[3]&&xu(i);return{c(){e=b("main"),t=b("div"),l&&l.c(),n=P(),s&&s.c(),u=P(),d&&d.c(),a=P(),p&&p.c(),qe(t,"width","100%"),k(e,"class","svelte-d8179f")},m(D,g){A(D,e,g),w(e,t),l&&l.m(t,null),w(t,n),~r&&f[r].m(t,null),w(e,u),d&&d.m(e,null),w(e,a),p&&p.m(e,null),o=!0},p(D,[g]){D[0]?l&&(H(),C(l,1,1,()=>{l=null}),q()):l?(l.p(D,g),g&1&&y(l,1)):(l=Su(D),l.c(),y(l,1),l.m(t,n));let m=r;r=h(D),r===m?~r&&f[r].p(D,g):(s&&(H(),C(f[m],1,1,()=>{f[m]=null}),q()),~r?(s=f[r],s?s.p(D,g):(s=f[r]=c[r](D),s.c()),y(s,1),s.m(t,null)):s=null),D[0]?d?(d.p(D,g),g&1&&y(d,1)):(d=Ru(D),d.c(),y(d,1),d.m(e,a)):d&&(H(),C(d,1,1,()=>{d=null}),q()),D[3]?p?(p.p(D,g),g&8&&y(p,1)):(p=xu(D),p.c(),y(p,1),p.m(e,null)):p&&(H(),C(p,1,1,()=>{p=null}),q())},i(D){o||(y(l),y(s),y(d),y(p),o=!0)},o(D){C(l),C(s),C(d),C(p),o=!1},d(D){D&&_(e),l&&l.d(),~r&&f[r].d(),d&&d.d(),p&&p.d()}}}function Hp(i,e,t){let n,r;Ee(i,rn,j=>t(19,n=j)),Ee(i,It,j=>t(7,r=j));let s=!1,u=!1,a=!0,o=!1,l=!1,c=!1,f;const h=new Er;h.addReplica(n.replica);const d=h.sync("https://earthstar-server.fly.dev/sync",!0),p=h.sync("https://languid-sand-parallelogram.glitch.me/",!0);d.onStatusChange(j=>{t(6,f=j),console.log(j),t(6,f)}),p.onStatusChange(j=>{t(6,f=j),console.log(j),t(6,f)}),d.isDone().then(()=>{console.log("Sync complete")}).catch(j=>{console.error("Sync failed",j)});function D(j){t(0,s=!0),t(1,u=!0)}function g(j){t(4,o=!0)}const m=new URLSearchParams(window.location.search),E=m.has("studio"),B=m.has("oracle");function F(){t(3,l=!l),t(5,c=!1),t(1,u=!0),l?t(2,a=!1):t(2,a=!0)}function v(){t(1,u=!u),t(3,l=!1),t(5,c=!1),u?t(2,a=!0):t(2,a=!1)}function x(){t(5,c=!c)}function S(){t(2,a=!a),t(3,l=!1)}const R=()=>t(0,s=!s),Q=()=>t(2,a=!a),N=()=>t(2,a=!a);return i.$$.update=()=>{i.$$.dirty&1&&console.log("IDcreated",s),i.$$.dirty&8&&console.log("showPanel",l),i.$$.dirty&2&&console.log("showDetails",u),i.$$.dirty&4&&console.log("imageView",a)},console.log("inStudio",E),console.log("oracle",B),[s,u,a,l,o,c,f,r,D,g,E,B,F,v,x,S,R,Q,N]}class qp extends re{constructor(e){super(),ne(this,e,Hp,zp,te,{})}}new qp({target:document.getElementById("app")});
