var Fr=Object.defineProperty;var Tr=(q,_,M)=>_ in q?Fr(q,_,{enumerable:!0,configurable:!0,writable:!0,value:M}):q[_]=M;var Nt=(q,_,M)=>(Tr(q,typeof _!="symbol"?_+"":_,M),M),_n=(q,_,M)=>{if(!_.has(q))throw TypeError("Cannot "+M)};var be=(q,_,M)=>(_n(q,_,"read from private field"),M?M.call(q):_.get(q)),Ye=(q,_,M)=>{if(_.has(q))throw TypeError("Cannot add the same private member more than once");_ instanceof WeakSet?_.add(q):_.set(q,M)},ht=(q,_,M,$)=>(_n(q,_,"write to private field"),$?$.call(q,M):_.set(q,M),M),Wt=(q,_,M,$)=>({set _(j){ht(q,_,j,M)},get _(){return be(q,_,$)}}),st=(q,_,M)=>(_n(q,_,"access private method"),M);import{c as commonjsGlobal,r as require$$5,g as getDefaultExportFromCjs,n as nodeCrypto,i as identity,a as noop,s as subscribe,b as run_all,d as safe_not_equal,e as is_function,S as SvelteComponent,f as init,h as element,j as space,k as set_style,l as attr,m as insert,o as listen,p as detach,q as createEventDispatcher,t as binding_callbacks,u as create_component,v as append,w as set_input_value,x as mount_component,y as transition_in,z as transition_out,A as destroy_component,B as text,C as set_data,D as bubble,E as group_outros,F as check_outros,G as component_subscribe,H as onMount,I as add_render_callback,J as create_bidirectional_transition,K as update_keyed_each,L as destroy_block,M as empty,N as toggle_class,O as compute_rest_props,P as assign,Q as exclude_internal_props,R as destroy_each,T as get_spread_update,U as get_spread_object,V as construct_svelte_component,W as getContext,X as create_slot,Y as update_slot_base,Z as get_all_dirty_from_scope,_ as get_slot_changes,$ as src_url_equal,a0 as HtmlTag,a1 as setContext,a2 as null_to_empty,a3 as create_in_transition,a4 as create_out_transition,a5 as onDestroy,a6 as globals,a7 as tick,a8 as svg_element,a9 as handle_promise,aa as update_await_block_branch,ab as self$1,ac as outro_and_destroy_block,ad as select_option,ae as get_store_value,af as select_value,ag as afterUpdate}from"./svelte-3bb7dd0c.js";function _mergeNamespaces(q,_){for(var M=0;M<_.length;M++){const $=_[M];if(typeof $!="string"&&!Array.isArray($)){for(const j in $)if(j!=="default"&&!(j in q)){const z=Object.getOwnPropertyDescriptor($,j);z&&Object.defineProperty(q,j,z.get?z:{enumerable:!0,get:()=>$[j]})}}}return Object.freeze(Object.defineProperty(q,Symbol.toStringTag,{value:"Module"}))}(function(){const _=document.createElement("link").relList;if(_&&_.supports&&_.supports("modulepreload"))return;for(const j of document.querySelectorAll('link[rel="modulepreload"]'))$(j);new MutationObserver(j=>{for(const z of j)if(z.type==="childList")for(const V of z.addedNodes)V.tagName==="LINK"&&V.rel==="modulepreload"&&$(V)}).observe(document,{childList:!0,subtree:!0});function M(j){const z={};return j.integrity&&(z.integrity=j.integrity),j.referrerPolicy&&(z.referrerPolicy=j.referrerPolicy),j.crossOrigin==="use-credentials"?z.credentials="include":j.crossOrigin==="anonymous"?z.credentials="omit":z.credentials="same-origin",z}function $(j){if(j.ep)return;j.ep=!0;const z=M(j);fetch(j.href,z)}})();const app="";class EarthstarError extends Error{constructor(_){super(_||""),this.name="EarthstarError"}}class ValidationError extends EarthstarError{constructor(_){super(_||"Validation error"),this.name="ValidationError"}}class ReplicaIsClosedError extends EarthstarError{constructor(_){super(_||"a Replica or ReplicaDriver was used after being closed"),this.name="ReplicaIsClosedError"}}class ReplicaCacheIsClosedError extends EarthstarError{constructor(_){super(_||"a ReplicaCache was used after being closed"),this.name="ReplicaCacheIsClosedError"}}class NotSupportedError extends EarthstarError{constructor(_){super(_||"Not supported"),this.name="NotSupportedError"}}function isErr(q){return q instanceof EarthstarError}function notErr(q){return!(q instanceof EarthstarError)}var dist$2={},crypto_types_gen={};Object.defineProperty(crypto_types_gen,"__esModule",{value:!0});(function(q){var _=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(z,V,X,G){G===void 0&&(G=X);var Y=Object.getOwnPropertyDescriptor(V,X);(!Y||("get"in Y?!V.__esModule:Y.writable||Y.configurable))&&(Y={enumerable:!0,get:function(){return V[X]}}),Object.defineProperty(z,G,Y)}:function(z,V,X,G){G===void 0&&(G=X),z[G]=V[X]}),M=commonjsGlobal&&commonjsGlobal.__exportStar||function(z,V){for(var X in z)X!=="default"&&!Object.prototype.hasOwnProperty.call(V,X)&&_(V,z,X)};Object.defineProperty(q,"__esModule",{value:!0}),q.crypto=void 0;const j=require$$5.webcrypto;q.crypto=j,M(crypto_types_gen,q)})(dist$2);var dist$1={};Object.defineProperty(dist$1,"__esModule",{value:!0});var setInterval_1=dist$1.setInterval=setTimeout_1=dist$1.setTimeout=void 0;const originalSetTimeout=globalThis.setTimeout;function setTimeout$1(q,_,...M){const $=originalSetTimeout(q,_,...M);return typeof $=="number"?$:$[Symbol.toPrimitive]()}var setTimeout_1=dist$1.setTimeout=setTimeout$1;const originalSetInterval=globalThis.setInterval;function setInterval$1(q,_,...M){const $=originalSetInterval(q,_,...M);return typeof $=="number"?$:$[Symbol.toPrimitive]()}setInterval_1=dist$1.setInterval=setInterval$1;var dist={},_a$2,_b;Object.defineProperty(dist,"__esModule",{value:!0});var WeakRef_1=dist.WeakRef=void 0;WeakRef_1=dist.WeakRef=(_a$2=globalThis.WeakRef)!==null&&_a$2!==void 0?_a$2:(_b=class{constructor(_){}deref(){throw new Error("WeakRef is not supported in Node 14 and below.")}},_b);const{Blob:Blob$1}=window,{Request,Response,Headers:Headers$1,fetch:fetch$1}=window,{ReadableStream:ReadableStream$1,ReadableStreamDefaultReader,ReadableStreamBYOBReader,ReadableStreamBYOBRequest,ReadableByteStreamController,ReadableStreamDefaultController,TransformStream,TransformStreamDefaultController,WritableStream,WritableStreamDefaultWriter,WritableStreamDefaultController,ByteLengthQueuingStrategy,CountQueuingStrategy,TextEncoderStream,TextDecoderStream}=window;if(!ReadableStream$1.prototype[Symbol.asyncIterator]){async function*q(){const _=this.getReader();try{for(;;){const{done:M,value:$}=await _.read();if(M)return;yield $}}finally{_.releaseLock()}}ReadableStream$1.prototype[Symbol.asyncIterator]=q}var ws=null;typeof WebSocket<"u"?ws=WebSocket:typeof MozWebSocket<"u"?ws=MozWebSocket:typeof global<"u"?ws=global.WebSocket||global.MozWebSocket:typeof window<"u"?ws=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(ws=self.WebSocket||self.MozWebSocket);const WebSocket$1=ws,{TextDecoder:TextDecoder$1,TextEncoder}=window;function u(q,_){for(var M=0;M<_.length;M++){var $=_[M];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(q,$.key,$)}}function D(q,_,M){return _&&u(q.prototype,_),M&&u(q,M),q}function t(q,_){(_==null||_>q.length)&&(_=q.length);for(var M=0,$=new Array(_);M<_;M++)$[M]=q[M];return $}function F(q,_){var M=typeof Symbol<"u"&&q[Symbol.iterator]||q["@@iterator"];if(M)return(M=M.call(q)).next.bind(M);if(Array.isArray(q)||(M=function(j,z){if(j){if(typeof j=="string")return t(j,z);var V=Object.prototype.toString.call(j).slice(8,-1);return V==="Object"&&j.constructor&&(V=j.constructor.name),V==="Map"||V==="Set"?Array.from(j):V==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(V)?t(j,z):void 0}}(q))||_&&q&&typeof q.length=="number"){M&&(q=M);var $=0;return function(){return $>=q.length?{done:!0}:{done:!1,value:q[$++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var e=/(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDEC0-\uDEEB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/,C=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/;function A(q,_){return(_?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(q)}function E(q,_){_===void 0&&(_=!1);for(var M=[],$=0;$<q.length;){var j=q[$],z=function(ee){if(!_)throw new TypeError(ee);M.push({type:"INVALID_CHAR",index:$,value:q[$++]})};if(j!=="*")if(j!=="+"&&j!=="?")if(j!=="\\")if(j!=="{")if(j!=="}")if(j!==":")if(j!=="(")M.push({type:"CHAR",index:$,value:q[$++]});else{var V=1,X="",G=$+1,Y=!1;if(q[G]==="?"){z('Pattern cannot start with "?" at '+G);continue}for(;G<q.length;){if(!A(q[G],!1)){z("Invalid character '"+q[G]+"' at "+G+"."),Y=!0;break}if(q[G]!=="\\"){if(q[G]===")"){if(--V==0){G++;break}}else if(q[G]==="("&&(V++,q[G+1]!=="?")){z("Capturing groups are not allowed at "+G),Y=!0;break}X+=q[G++]}else X+=q[G++]+q[G++]}if(Y)continue;if(V){z("Unbalanced pattern at "+$);continue}if(!X){z("Missing pattern at "+$);continue}M.push({type:"PATTERN",index:$,value:X}),$=G}else{for(var Q="",Z=$+1;Z<q.length;){var te=q.substr(Z,1);if(!(Z===$+1&&e.test(te)||Z!==$+1&&C.test(te)))break;Q+=q[Z++]}if(!Q){z("Missing parameter name at "+$);continue}M.push({type:"NAME",index:$,value:Q}),$=Z}else M.push({type:"CLOSE",index:$,value:q[$++]});else M.push({type:"OPEN",index:$,value:q[$++]});else M.push({type:"ESCAPED_CHAR",index:$++,value:q[$++]});else M.push({type:"MODIFIER",index:$,value:q[$++]});else M.push({type:"ASTERISK",index:$,value:q[$++]})}return M.push({type:"END",index:$,value:""}),M}function n(q,_){_===void 0&&(_={});for(var M=E(q),$=_.prefixes,j=$===void 0?"./":$,z="[^"+r(_.delimiter||"/#?")+"]+?",V=[],X=0,G=0,Y="",Q=new Set,Z=function(we){if(G<M.length&&M[G].type===we)return M[G++].value},te=function(){return Z("MODIFIER")||Z("ASTERISK")},ee=function(we){var ge=Z(we);if(ge!==void 0)return ge;var Ae=M[G];throw new TypeError("Unexpected "+Ae.type+" at "+Ae.index+", expected "+we)},ne=function(){for(var we,ge="";we=Z("CHAR")||Z("ESCAPED_CHAR");)ge+=we;return ge},re=_.encodePart||function(we){return we};G<M.length;){var se=Z("CHAR"),ie=Z("NAME"),oe=Z("PATTERN");if(ie||oe||!Z("ASTERISK")||(oe=".*"),ie||oe){var he=se||"";j.indexOf(he)===-1&&(Y+=he,he=""),Y&&(V.push(re(Y)),Y="");var le=ie||X++;if(Q.has(le))throw new TypeError("Duplicate name '"+le+"'.");Q.add(le),V.push({name:le,prefix:re(he),suffix:"",pattern:oe||z,modifier:te()||""})}else{var ae=se||Z("ESCAPED_CHAR");if(ae)Y+=ae;else if(Z("OPEN")){var ue=ne(),me=Z("NAME")||"",fe=Z("PATTERN")||"";me||fe||!Z("ASTERISK")||(fe=".*");var ce=ne();ee("CLOSE");var _e=te()||"";if(!me&&!fe&&!_e){Y+=ue;continue}if(!me&&!fe&&!ue)continue;Y&&(V.push(re(Y)),Y=""),V.push({name:me||(fe?X++:""),pattern:me&&!fe?z:fe,prefix:re(ue),suffix:re(ce),modifier:_e})}else Y&&(V.push(re(Y)),Y=""),ee("END")}}return V}function r(q){return q.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function i(q){return q&&q.sensitive?"u":"ui"}function s(q,_,M){M===void 0&&(M={});for(var $,j=M.strict,z=j!==void 0&&j,V=M.start,X=V===void 0||V,G=M.end,Y=G===void 0||G,Q=M.encode,Z=Q===void 0?function(ae){return ae}:Q,te="["+r(M.endsWith||"")+"]|$",ee="["+r(M.delimiter||"/#?")+"]",ne=X?"^":"",re=F(q);!($=re()).done;){var se=$.value;if(typeof se=="string")ne+=r(Z(se));else{var ie=r(Z(se.prefix)),oe=r(Z(se.suffix));se.pattern?(_&&_.push(se),ne+=ie||oe?se.modifier==="+"||se.modifier==="*"?"(?:"+ie+"((?:"+se.pattern+")(?:"+oe+ie+"(?:"+se.pattern+"))*)"+oe+")"+(se.modifier==="*"?"?":""):"(?:"+ie+"("+se.pattern+")"+oe+")"+se.modifier:se.modifier==="+"||se.modifier==="*"?"((?:"+se.pattern+")"+se.modifier+")":"("+se.pattern+")"+se.modifier):ne+="(?:"+ie+oe+")"+se.modifier}}if(Y)z||(ne+=ee+"?"),ne+=M.endsWith?"(?="+te+")":"$";else{var he=q[q.length-1],le=typeof he=="string"?ee.indexOf(he[he.length-1])>-1:he===void 0;z||(ne+="(?:"+ee+"(?="+te+"))?"),le||(ne+="(?="+ee+"|"+te+")")}return new RegExp(ne,i(M))}function a(q,_,M){return q instanceof RegExp?function($,j){if(!j)return $;for(var z=/\((?:\?<(.*?)>)?(?!\?)/g,V=0,X=z.exec($.source);X;)j.push({name:X[1]||V++,prefix:"",suffix:"",modifier:"",pattern:""}),X=z.exec($.source);return $}(q,_):Array.isArray(q)?function($,j,z){var V=$.map(function(X){return a(X,j,z).source});return new RegExp("(?:"+V.join("|")+")",i(z))}(q,_,M):function($,j,z){return s(n($,z),j,z)}(q,_,M)}var B={delimiter:"",prefixes:"",sensitive:!0,strict:!0},o={delimiter:".",prefixes:"",sensitive:!0,strict:!0},h={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function p(q,_){return q.startsWith(_)?q.substring(_.length,q.length):q}function c(q){return!(!q||q.length<2||q[0]!=="["&&(q[0]!=="\\"&&q[0]!=="{"||q[1]!=="["))}var f,l=["ftp","file","http","https","ws","wss"];function m(q){if(!q)return!0;for(var _,M=F(l);!(_=M()).done;)if(q.test(_.value))return!0;return!1}function d(q){switch(q){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function g(q){if(q==="")return q;if(/^[-+.A-Za-z0-9]*$/.test(q))return q.toLowerCase();throw new TypeError("Invalid protocol '"+q+"'.")}function x(q){if(q==="")return q;var _=new URL("https://example.com");return _.username=q,_.username}function S(q){if(q==="")return q;var _=new URL("https://example.com");return _.password=q,_.password}function v(q){if(q==="")return q;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(q))throw new TypeError("Invalid hostname '"+q+"'");var _=new URL("https://example.com");return _.hostname=q,_.hostname}function y(q){if(q==="")return q;if(/[^0-9a-fA-F[\]:]/g.test(q))throw new TypeError("Invalid IPv6 hostname '"+q+"'");return q.toLowerCase()}function R(q){if(q===""||/^[0-9]*$/.test(q)&&parseInt(q)<=65535)return q;throw new TypeError("Invalid port '"+q+"'.")}function k(q){if(q==="")return q;var _=new URL("https://example.com");return _.pathname=q[0]!=="/"?"/-"+q:q,q[0]!=="/"?_.pathname.substring(2,_.pathname.length):_.pathname}function w(q){return q===""?q:new URL("data:"+q).pathname}function P(q){if(q==="")return q;var _=new URL("https://example.com");return _.search=q,_.search.substring(1,_.search.length)}function T(q){if(q==="")return q;var _=new URL("https://example.com");return _.hash=q,_.hash.substring(1,_.hash.length)}(function(q){q[q.INIT=0]="INIT",q[q.PROTOCOL=1]="PROTOCOL",q[q.AUTHORITY=2]="AUTHORITY",q[q.USERNAME=3]="USERNAME",q[q.PASSWORD=4]="PASSWORD",q[q.HOSTNAME=5]="HOSTNAME",q[q.PORT=6]="PORT",q[q.PATHNAME=7]="PATHNAME",q[q.SEARCH=8]="SEARCH",q[q.HASH=9]="HASH",q[q.DONE=10]="DONE"})(f||(f={}));var b=function(){function q(M){this.input=void 0,this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=f.INIT,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=M}var _=q.prototype;return _.parse=function(){for(this.tokenList=E(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===f.INIT){this.rewind(),this.isHashPrefix()?this.changeState(f.HASH,1):this.isSearchPrefix()?(this.changeState(f.SEARCH,1),this.internalResult.hash=""):(this.changeState(f.PATHNAME,0),this.internalResult.search="",this.internalResult.hash="");continue}if(this.state===f.AUTHORITY){this.rewindAndSetState(f.HOSTNAME);continue}this.changeState(f.DONE,0);break}if(this.groupDepth>0){if(!this.isGroupClose())continue;this.groupDepth-=1}if(this.isGroupOpen())this.groupDepth+=1;else switch(this.state){case f.INIT:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(f.PROTOCOL));break;case f.PROTOCOL:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();var M=f.PATHNAME,$=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(M=f.AUTHORITY,$=3):this.shouldTreatAsStandardURL&&(M=f.AUTHORITY),this.changeState(M,$)}break;case f.AUTHORITY:this.isIdentityTerminator()?this.rewindAndSetState(f.USERNAME):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(f.HOSTNAME);break;case f.USERNAME:this.isPasswordPrefix()?this.changeState(f.PASSWORD,1):this.isIdentityTerminator()&&this.changeState(f.HOSTNAME,1);break;case f.PASSWORD:this.isIdentityTerminator()&&this.changeState(f.HOSTNAME,1);break;case f.HOSTNAME:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(f.PORT,1):this.isPathnameStart()?this.changeState(f.PATHNAME,0):this.isSearchPrefix()?this.changeState(f.SEARCH,1):this.isHashPrefix()&&this.changeState(f.HASH,1);break;case f.PORT:this.isPathnameStart()?this.changeState(f.PATHNAME,0):this.isSearchPrefix()?this.changeState(f.SEARCH,1):this.isHashPrefix()&&this.changeState(f.HASH,1);break;case f.PATHNAME:this.isSearchPrefix()?this.changeState(f.SEARCH,1):this.isHashPrefix()&&this.changeState(f.HASH,1);break;case f.SEARCH:this.isHashPrefix()&&this.changeState(f.HASH,1)}}},_.changeState=function(M,$){switch(this.state){case f.INIT:break;case f.PROTOCOL:this.internalResult.protocol=this.makeComponentString();break;case f.AUTHORITY:break;case f.USERNAME:this.internalResult.username=this.makeComponentString();break;case f.PASSWORD:this.internalResult.password=this.makeComponentString();break;case f.HOSTNAME:this.internalResult.hostname=this.makeComponentString();break;case f.PORT:this.internalResult.port=this.makeComponentString();break;case f.PATHNAME:this.internalResult.pathname=this.makeComponentString();break;case f.SEARCH:this.internalResult.search=this.makeComponentString();break;case f.HASH:this.internalResult.hash=this.makeComponentString()}this.changeStateWithoutSettingComponent(M,$)},_.changeStateWithoutSettingComponent=function(M,$){this.state=M,this.componentStart=this.tokenIndex+$,this.tokenIndex+=$,this.tokenIncrement=0},_.rewind=function(){this.tokenIndex=this.componentStart,this.tokenIncrement=0},_.rewindAndSetState=function(M){this.rewind(),this.state=M},_.safeToken=function(M){return M<0&&(M=this.tokenList.length-M),M<this.tokenList.length?this.tokenList[M]:this.tokenList[this.tokenList.length-1]},_.isNonSpecialPatternChar=function(M,$){var j=this.safeToken(M);return j.value===$&&(j.type==="CHAR"||j.type==="ESCAPED_CHAR"||j.type==="INVALID_CHAR")},_.isProtocolSuffix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},_.nextIsAuthoritySlashes=function(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")},_.isIdentityTerminator=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")},_.isPasswordPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},_.isPortPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},_.isPathnameStart=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")},_.isSearchPrefix=function(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;var M=this.safeToken(this.tokenIndex-1);return M.type!=="NAME"&&M.type!=="PATTERN"&&M.type!=="CLOSE"&&M.type!=="ASTERISK"},_.isHashPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")},_.isGroupOpen=function(){return this.tokenList[this.tokenIndex].type=="OPEN"},_.isGroupClose=function(){return this.tokenList[this.tokenIndex].type=="CLOSE"},_.isIPv6Open=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")},_.isIPv6Close=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")},_.makeComponentString=function(){var M=this.tokenList[this.tokenIndex],$=this.safeToken(this.componentStart).index;return this.input.substring($,M.index)},_.computeShouldTreatAsStandardURL=function(){var M={};Object.assign(M,B),M.encodePart=g;var $=a(this.makeComponentString(),void 0,M);this.shouldTreatAsStandardURL=m($)},D(q,[{key:"result",get:function(){return this.internalResult}}]),q}(),I=["protocol","username","password","hostname","port","pathname","search","hash"];function O(q,_){if(typeof q!="string")throw new TypeError("parameter 1 is not of type 'string'.");var M=new URL(q,_);return{protocol:M.protocol.substring(0,M.protocol.length-1),username:M.username,password:M.password,hostname:M.hostname,port:M.port,pathname:M.pathname,search:M.search!=""?M.search.substring(1,M.search.length):void 0,hash:M.hash!=""?M.hash.substring(1,M.hash.length):void 0}}function H(q,_,M){var $;if(typeof _.baseURL=="string")try{$=new URL(_.baseURL),q.protocol=$.protocol?$.protocol.substring(0,$.protocol.length-1):"",q.username=$.username,q.password=$.password,q.hostname=$.hostname,q.port=$.port,q.pathname=$.pathname,q.search=$.search?$.search.substring(1,$.search.length):"",q.hash=$.hash?$.hash.substring(1,$.hash.length):""}catch{throw new TypeError("invalid baseURL '"+_.baseURL+"'.")}if(typeof _.protocol=="string"&&(q.protocol=function(z,V){var X;return z=(X=z).endsWith(":")?X.substr(0,X.length-1):X,V||z===""?z:g(z)}(_.protocol,M)),typeof _.username=="string"&&(q.username=function(z,V){if(V||z==="")return z;var X=new URL("https://example.com");return X.username=z,X.username}(_.username,M)),typeof _.password=="string"&&(q.password=function(z,V){if(V||z==="")return z;var X=new URL("https://example.com");return X.password=z,X.password}(_.password,M)),typeof _.hostname=="string"&&(q.hostname=function(z,V){return V||z===""?z:c(z)?y(z):v(z)}(_.hostname,M)),typeof _.port=="string"&&(q.port=function(z,V,X){return d(V)===z&&(z=""),X||z===""?z:R(z)}(_.port,q.protocol,M)),typeof _.pathname=="string"){if(q.pathname=_.pathname,$&&!function(z,V){return!(!z.length||z[0]!=="/"&&(!V||z.length<2||z[0]!="\\"&&z[0]!="{"||z[1]!="/"))}(q.pathname,M)){var j=$.pathname.lastIndexOf("/");j>=0&&(q.pathname=$.pathname.substring(0,j+1)+q.pathname)}q.pathname=function(z,V,X){if(X||z==="")return z;if(V&&!l.includes(V))return new URL(V+":"+z).pathname;var G=z[0]=="/";return z=new URL(G?z:"/-"+z,"https://example.com").pathname,G||(z=z.substring(2,z.length)),z}(q.pathname,q.protocol,M)}return typeof _.search=="string"&&(q.search=function(z,V){if(z=p(z,"?"),V||z==="")return z;var X=new URL("https://example.com");return X.search=z,X.search?X.search.substring(1,X.search.length):""}(_.search,M)),typeof _.hash=="string"&&(q.hash=function(z,V){if(z=p(z,"#"),V||z==="")return z;var X=new URL("https://example.com");return X.hash=z,X.hash?X.hash.substring(1,X.hash.length):""}(_.hash,M)),q}function N(q){return q.replace(/([+*?:{}()\\])/g,"\\$1")}function L(q,_){for(var M="[^"+(_.delimiter||"/#?").replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")+"]+?",$=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/,j="",z=0;z<q.length;++z){var V=q[z],X=z>0?q[z-1]:null,G=z<q.length-1?q[z+1]:null;if(typeof V!="string")if(V.pattern!==""){var Y=typeof V.name!="number",Q=_.prefixes!==void 0?_.prefixes:"./",Z=V.suffix!==""||V.prefix!==""&&(V.prefix.length!==1||!Q.includes(V.prefix));Z||!Y||V.pattern!==M||V.modifier!==""||!G||G.prefix||G.suffix||(Z=typeof G=="string"?$.test(G.length>0?G[0]:""):typeof G.name=="number"),!Z&&V.prefix===""&&X&&typeof X=="string"&&X.length>0&&(Z=Q.includes(X[X.length-1])),Z&&(j+="{"),j+=N(V.prefix),Y&&(j+=":"+V.name),V.pattern===".*"?j+=Y||X&&typeof X!="string"&&!X.modifier&&!Z&&V.prefix===""?"(.*)":"*":V.pattern===M?Y||(j+="("+M+")"):j+="("+V.pattern+")",V.pattern===M&&Y&&V.suffix!==""&&$.test(V.suffix[0])&&(j+="\\"),j+=N(V.suffix),Z&&(j+="}"),j+=V.modifier}else{if(V.modifier===""){j+=N(V.prefix);continue}j+="{"+N(V.prefix)+"}"+V.modifier}else j+=N(V)}return j}var U=function(){function q(M,$){M===void 0&&(M={}),this.pattern=void 0,this.regexp={},this.keys={},this.component_pattern={};try{if(typeof M=="string"){var j=new b(M);if(j.parse(),M=j.result,$){if(typeof $!="string")throw new TypeError("'baseURL' parameter is not of type 'string'.");M.baseURL=$}else if(typeof M.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if($)throw new TypeError("parameter 1 is not of type 'string'.");if(!M||typeof M!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");var z;this.pattern=H({pathname:"*",protocol:"*",username:"*",password:"*",hostname:"*",port:"*",search:"*",hash:"*"},M,!0),d(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");for(var V,X=F(I);!(V=X()).done;)if((z=V.value)in this.pattern){var G={},Y=this.pattern[z];switch(this.keys[z]=[],z){case"protocol":Object.assign(G,B),G.encodePart=g;break;case"username":Object.assign(G,B),G.encodePart=x;break;case"password":Object.assign(G,B),G.encodePart=S;break;case"hostname":Object.assign(G,o),G.encodePart=c(Y)?y:v;break;case"port":Object.assign(G,B),G.encodePart=R;break;case"pathname":m(this.regexp.protocol)?(Object.assign(G,h),G.encodePart=k):(Object.assign(G,B),G.encodePart=w);break;case"search":Object.assign(G,B),G.encodePart=P;break;case"hash":Object.assign(G,B),G.encodePart=T}try{var Q=n(Y,G);this.regexp[z]=s(Q,this.keys[z],G),this.component_pattern[z]=L(Q,G)}catch{throw new TypeError("invalid "+z+" pattern '"+this.pattern[z]+"'.")}}}catch(Z){throw new TypeError("Failed to construct 'URLPattern': "+Z.message)}}var _=q.prototype;return _.test=function(M,$){M===void 0&&(M={});var j,z={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof M!="string"&&$)throw new TypeError("parameter 1 is not of type 'string'.");if(M===void 0)return!1;try{z=H(z,typeof M=="object"?M:O(M,$),!1)}catch{return!1}for(j in this.pattern)if(!this.regexp[j].exec(z[j]))return!1;return!0},_.exec=function(M,$){M===void 0&&(M={});var j={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof M!="string"&&$)throw new TypeError("parameter 1 is not of type 'string'.");if(M!==void 0){try{j=H(j,typeof M=="object"?M:O(M,$),!1)}catch{return null}var z,V={};for(z in V.inputs=$?[M,$]:[M],this.pattern){var X=this.regexp[z].exec(j[z]);if(!X)return null;for(var G,Y={},Q=F(this.keys[z].entries());!(G=Q()).done;){var Z=G.value,te=Z[1];typeof te.name!="string"&&typeof te.name!="number"||(Y[te.name]=X[Z[0]+1]||"")}V[z]={input:j[z]||"",groups:Y}}return V}},D(q,[{key:"protocol",get:function(){return this.component_pattern.protocol}},{key:"username",get:function(){return this.component_pattern.username}},{key:"password",get:function(){return this.component_pattern.password}},{key:"hostname",get:function(){return this.component_pattern.hostname}},{key:"port",get:function(){return this.component_pattern.port}},{key:"pathname",get:function(){return this.component_pattern.pathname}},{key:"search",get:function(){return this.component_pattern.search}},{key:"hash",get:function(){return this.component_pattern.hash}}]),q}();const dntGlobals={crypto:dist$2.crypto,setInterval:setInterval_1,setTimeout:setTimeout_1,WeakRef:WeakRef_1,Blob:Blob$1,Request,Response,Headers:Headers$1,WritableStream,TransformStream,ReadableStream:ReadableStream$1,TransformStreamDefaultController,WritableStreamDefaultWriter,WebSocket:WebSocket$1,TextEncoder,TextDecoder:TextDecoder$1,URLPattern:U},dntGlobalThis=createMergeProxy(globalThis,dntGlobals);function createMergeProxy(q,_){return new Proxy(q,{get(M,$,j){return $ in _?_[$]:q[$]},set(M,$,j){return $ in _&&delete _[$],q[$]=j,!0},deleteProperty(M,$){let j=!1;return $ in _&&(delete _[$],j=!0),$ in q&&(delete q[$],j=!0),j},ownKeys(M){const $=Reflect.ownKeys(q),j=Reflect.ownKeys(_),z=new Set(j);return[...$.filter(V=>!z.has(V)),...j]},defineProperty(M,$,j){return $ in _&&delete _[$],Reflect.defineProperty(q,$,j),!0},getOwnPropertyDescriptor(M,$){return $ in _?Reflect.getOwnPropertyDescriptor(_,$):Reflect.getOwnPropertyDescriptor(q,$)},has(M,$){return $ in _||$ in q}})}function shallowEqualArrays(q,_){if(q===_)return!0;if(!q||!_)return!1;var M=q.length;if(_.length!==M)return!1;for(var $=0;$<M;$++)if(q[$]!==_[$])return!1;return!0}function shallowEqualObjects(q,_){if(q===_)return!0;if(!q||!_)return!1;var M=Object.keys(q),$=Object.keys(_),j=M.length;if($.length!==j)return!1;for(var z=0;z<j;z++){var V=M[z];if(q[V]!==_[V]||!Object.prototype.hasOwnProperty.call(_,V))return!1}return!0}var fastJsonStableStringify=function(q,_){_||(_={}),typeof _=="function"&&(_={cmp:_});var M=typeof _.cycles=="boolean"?_.cycles:!1,$=_.cmp&&function(z){return function(V){return function(X,G){var Y={key:X,value:V[X]},Q={key:G,value:V[G]};return z(Y,Q)}}}(_.cmp),j=[];return function z(V){if(V&&V.toJSON&&typeof V.toJSON=="function"&&(V=V.toJSON()),V!==void 0){if(typeof V=="number")return isFinite(V)?""+V:"null";if(typeof V!="object")return JSON.stringify(V);var X,G;if(Array.isArray(V)){for(G="[",X=0;X<V.length;X++)X&&(G+=","),G+=z(V[X])||"null";return G+"]"}if(V===null)return"null";if(j.indexOf(V)!==-1){if(M)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var Y=j.push(V)-1,Q=Object.keys(V).sort($&&$(V));for(G="",X=0;X<Q.length;X++){var Z=Q[X],te=z(V[Z]);te&&(G&&(G+=","),G+=JSON.stringify(Z)+":"+te)}return j.splice(Y,1),"{"+G+"}"}}(q)};const stringify$1=getDefaultExportFromCjs(fastJsonStableStringify);var lib={};Object.defineProperty(lib,"__esModule",{value:!0});function parse(q,_,M){var $;if(M===void 0&&(M={}),!_.codes){_.codes={};for(var j=0;j<_.chars.length;++j)_.codes[_.chars[j]]=j}if(!M.loose&&q.length*_.bits&7)throw new SyntaxError("Invalid padding");for(var z=q.length;q[z-1]==="=";)if(--z,!M.loose&&!((q.length-z)*_.bits&7))throw new SyntaxError("Invalid padding");for(var V=new(($=M.out)!=null?$:Uint8Array)(z*_.bits/8|0),X=0,G=0,Y=0,Q=0;Q<z;++Q){var Z=_.codes[q[Q]];if(Z===void 0)throw new SyntaxError("Invalid character "+q[Q]);G=G<<_.bits|Z,X+=_.bits,X>=8&&(X-=8,V[Y++]=255&G>>X)}if(X>=_.bits||255&G<<8-X)throw new SyntaxError("Unexpected end of data");return V}function stringify(q,_,M){M===void 0&&(M={});for(var $=M,j=$.pad,z=j===void 0?!0:j,V=(1<<_.bits)-1,X="",G=0,Y=0,Q=0;Q<q.length;++Q)for(Y=Y<<8|255&q[Q],G+=8;G>_.bits;)G-=_.bits,X+=_.chars[V&Y>>G];if(G&&(X+=_.chars[V&Y<<_.bits-G]),z)for(;X.length*_.bits&7;)X+="=";return X}var base16Encoding={chars:"0123456789ABCDEF",bits:4},base32Encoding={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},base32HexEncoding={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},base64Encoding={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},base64UrlEncoding={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},base16$1={parse:function(_,M){return parse(_.toUpperCase(),base16Encoding,M)},stringify:function(_,M){return stringify(_,base16Encoding,M)}},base32$1={parse:function(_,M){return M===void 0&&(M={}),parse(M.loose?_.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):_,base32Encoding,M)},stringify:function(_,M){return stringify(_,base32Encoding,M)}},base32hex$1={parse:function(_,M){return parse(_,base32HexEncoding,M)},stringify:function(_,M){return stringify(_,base32HexEncoding,M)}},base64$1={parse:function(_,M){return parse(_,base64Encoding,M)},stringify:function(_,M){return stringify(_,base64Encoding,M)}},base64url$1={parse:function(_,M){return parse(_,base64UrlEncoding,M)},stringify:function(_,M){return stringify(_,base64UrlEncoding,M)}},codec$2={parse,stringify};lib.base16=base16$1;lib.base32=base32$1;lib.base32hex=base32hex$1;lib.base64=base64$1;lib.base64url=base64url$1;lib.codec=codec$2;const base16=lib.base16,base32=lib.base32,base32hex=lib.base32hex,base64=lib.base64,base64url=lib.base64url,codec$1=lib.codec,rfc4648=Object.freeze(Object.defineProperty({__proto__:null,base16,base32,base32hex,base64,base64url,codec:codec$1,default:lib},Symbol.toStringTag,{value:"Module"}));var sha256Uint8array={};Object.defineProperty(sha256Uint8array,"__esModule",{value:!0});var Hash_1=sha256Uint8array.Hash=createHash_1=sha256Uint8array.createHash=void 0;const K=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],algorithms={sha256:1};function createHash$1(q){if(q&&!algorithms[q]&&!algorithms[q.toLowerCase()])throw new Error("Digest method not supported");return new Hash}var createHash_1=sha256Uint8array.createHash=createHash$1;class Hash{constructor(){this.A=1779033703,this.B=-1150833019,this.C=1013904242,this.D=-1521486534,this.E=1359893119,this.F=-1694144372,this.G=528734635,this.H=1541459225,this._size=0,this._sp=0,(!sharedBuffer||sharedOffset>=8e3)&&(sharedBuffer=new ArrayBuffer(8e3),sharedOffset=0),this._byte=new Uint8Array(sharedBuffer,sharedOffset,80),this._word=new Int32Array(sharedBuffer,sharedOffset,20),sharedOffset+=80}update(_){if(typeof _=="string")return this._utf8(_);if(_==null)throw new TypeError("Invalid type: "+typeof _);const M=_.byteOffset,$=_.byteLength;let j=$/64|0,z=0;if(j&&!(M&3)&&!(this._size%64)){const X=new Int32Array(_.buffer,M,j*16);for(;j--;)this._int32(X,z>>2),z+=64;this._size+=z}if(_.BYTES_PER_ELEMENT!==1&&_.buffer){const X=new Uint8Array(_.buffer,M+z,$-z);return this._uint8(X)}return z===$?this:this._uint8(_,z)}_uint8(_,M){const{_byte:$,_word:j}=this,z=_.length;for(M=M|0;M<z;){const V=this._size%64;let X=V;for(;M<z&&X<64;)$[X++]=_[M++];X>=64&&this._int32(j),this._size+=X-V}return this}_utf8(_){const{_byte:M,_word:$}=this,j=_.length;let z=this._sp;for(let V=0;V<j;){const X=this._size%64;let G=X;for(;V<j&&G<64;){let Y=_.charCodeAt(V++)|0;Y<128?M[G++]=Y:Y<2048?(M[G++]=192|Y>>>6,M[G++]=128|Y&63):Y<55296||Y>57343?(M[G++]=224|Y>>>12,M[G++]=128|Y>>>6&63,M[G++]=128|Y&63):z?(Y=((z&1023)<<10)+(Y&1023)+65536,M[G++]=240|Y>>>18,M[G++]=128|Y>>>12&63,M[G++]=128|Y>>>6&63,M[G++]=128|Y&63,z=0):z=Y}G>=64&&(this._int32($),$[0]=$[16]),this._size+=G-X}return this._sp=z,this}_int32(_,M){let{A:$,B:j,C:z,D:V,E:X,F:G,G:Y,H:Q}=this,Z=0;for(M=M|0;Z<16;)W[Z++]=swap32(_[M++]);for(Z=16;Z<64;Z++)W[Z]=gamma1(W[Z-2])+W[Z-7]+gamma0(W[Z-15])+W[Z-16]|0;for(Z=0;Z<64;Z++){const te=Q+sigma1(X)+ch(X,G,Y)+K[Z]+W[Z]|0,ee=sigma0($)+maj($,j,z)|0;Q=Y,Y=G,G=X,X=V+te|0,V=z,z=j,j=$,$=te+ee|0}this.A=$+this.A|0,this.B=j+this.B|0,this.C=z+this.C|0,this.D=V+this.D|0,this.E=X+this.E|0,this.F=G+this.F|0,this.G=Y+this.G|0,this.H=Q+this.H|0}digest(_){const{_byte:M,_word:$}=this;let j=this._size%64|0;for(M[j++]=128;j&3;)M[j++]=0;if(j>>=2,j>14){for(;j<16;)$[j++]=0;j=0,this._int32($)}for(;j<16;)$[j++]=0;const z=this._size*8,V=(z&4294967295)>>>0,X=(z-V)/4294967296;return X&&($[14]=swap32(X)),V&&($[15]=swap32(V)),this._int32($),_==="hex"?this._hex():this._bin()}_hex(){const{A:_,B:M,C:$,D:j,E:z,F:V,G:X,H:G}=this;return hex32(_)+hex32(M)+hex32($)+hex32(j)+hex32(z)+hex32(V)+hex32(X)+hex32(G)}_bin(){const{A:_,B:M,C:$,D:j,E:z,F:V,G:X,H:G,_byte:Y,_word:Q}=this;return Q[0]=swap32(_),Q[1]=swap32(M),Q[2]=swap32($),Q[3]=swap32(j),Q[4]=swap32(z),Q[5]=swap32(V),Q[6]=swap32(X),Q[7]=swap32(G),Y.slice(0,32)}}Hash_1=sha256Uint8array.Hash=Hash;const W=new Int32Array(64);let sharedBuffer,sharedOffset=0;const hex32=q=>(q+4294967296).toString(16).substr(-8),swapLE=q=>q<<24&4278190080|q<<8&16711680|q>>8&65280|q>>24&255,swapBE=q=>q,swap32=isBE()?swapBE:swapLE,ch=(q,_,M)=>M^q&(_^M),maj=(q,_,M)=>q&_|M&(q|_),sigma0=q=>(q>>>2|q<<30)^(q>>>13|q<<19)^(q>>>22|q<<10),sigma1=q=>(q>>>6|q<<26)^(q>>>11|q<<21)^(q>>>25|q<<7),gamma0=q=>(q>>>7|q<<25)^(q>>>18|q<<14)^q>>>3,gamma1=q=>(q>>>17|q<<15)^(q>>>19|q<<13)^q>>>10;function isBE(){return new Uint8Array(new Uint16Array([65279]).buffer)[0]===254}const sha256_uint8array=_mergeNamespaces({__proto__:null,get Hash(){return Hash_1},get createHash(){return createHash_1},default:sha256Uint8array},[sha256Uint8array]);/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const _0n=BigInt(0),_1n=BigInt(1),_2n=BigInt(2),_255n=BigInt(255),CURVE_ORDER=_2n**BigInt(252)+BigInt("27742317777372353535851937790883648493"),CURVE={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:_2n**_255n-BigInt(19),l:CURVE_ORDER,n:CURVE_ORDER,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},MAX_256B=_2n**BigInt(256),SQRT_M1=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");const SQRT_AD_MINUS_ONE=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),INVSQRT_A_MINUS_D=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),ONE_MINUS_D_SQ=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),D_MINUS_ONE_SQ=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class ExtendedPoint{constructor(_,M,$,j){this.x=_,this.y=M,this.z=$,this.t=j}static fromAffine(_){if(!(_ instanceof Point))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return _.equals(Point.ZERO)?ExtendedPoint.ZERO:new ExtendedPoint(_.x,_.y,_1n,mod(_.x*_.y))}static toAffineBatch(_){const M=invertBatch(_.map($=>$.z));return _.map(($,j)=>$.toAffine(M[j]))}static normalizeZ(_){return this.toAffineBatch(_).map(this.fromAffine)}equals(_){assertExtPoint(_);const{x:M,y:$,z:j}=this,{x:z,y:V,z:X}=_,G=mod(M*X),Y=mod(z*j),Q=mod($*X),Z=mod(V*j);return G===Y&&Q===Z}negate(){return new ExtendedPoint(mod(-this.x),this.y,this.z,mod(-this.t))}double(){const{x:_,y:M,z:$}=this,{a:j}=CURVE,z=mod(_**_2n),V=mod(M**_2n),X=mod(_2n*mod($**_2n)),G=mod(j*z),Y=mod(mod((_+M)**_2n)-z-V),Q=G+V,Z=Q-X,te=G-V,ee=mod(Y*Z),ne=mod(Q*te),re=mod(Y*te),se=mod(Z*Q);return new ExtendedPoint(ee,ne,se,re)}add(_){assertExtPoint(_);const{x:M,y:$,z:j,t:z}=this,{x:V,y:X,z:G,t:Y}=_,Q=mod(($-M)*(X+V)),Z=mod(($+M)*(X-V)),te=mod(Z-Q);if(te===_0n)return this.double();const ee=mod(j*_2n*Y),ne=mod(z*_2n*G),re=ne+ee,se=Z+Q,ie=ne-ee,oe=mod(re*te),he=mod(se*ie),le=mod(re*ie),ae=mod(te*se);return new ExtendedPoint(oe,he,ae,le)}subtract(_){return this.add(_.negate())}precomputeWindow(_){const M=1+256/_,$=[];let j=this,z=j;for(let V=0;V<M;V++){z=j,$.push(z);for(let X=1;X<2**(_-1);X++)z=z.add(j),$.push(z);j=z.double()}return $}wNAF(_,M){!M&&this.equals(ExtendedPoint.BASE)&&(M=Point.BASE);const $=M&&M._WINDOW_SIZE||1;if(256%$)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let j=M&&pointPrecomputes.get(M);j||(j=this.precomputeWindow($),M&&$!==1&&(j=ExtendedPoint.normalizeZ(j),pointPrecomputes.set(M,j)));let z=ExtendedPoint.ZERO,V=ExtendedPoint.ZERO;const X=1+256/$,G=2**($-1),Y=BigInt(2**$-1),Q=2**$,Z=BigInt($);for(let te=0;te<X;te++){const ee=te*G;let ne=Number(_&Y);if(_>>=Z,ne>G&&(ne-=Q,_+=_1n),ne===0){let re=j[ee];te%2&&(re=re.negate()),V=V.add(re)}else{let re=j[ee+Math.abs(ne)-1];ne<0&&(re=re.negate()),z=z.add(re)}}return ExtendedPoint.normalizeZ([z,V])[0]}multiply(_,M){return this.wNAF(normalizeScalar(_,CURVE.l),M)}multiplyUnsafe(_){let M=normalizeScalar(_,CURVE.l,!1);const $=ExtendedPoint.BASE,j=ExtendedPoint.ZERO;if(M===_0n)return j;if(this.equals(j)||M===_1n)return this;if(this.equals($))return this.wNAF(M);let z=j,V=this;for(;M>_0n;)M&_1n&&(z=z.add(V)),V=V.double(),M>>=_1n;return z}isSmallOrder(){return this.multiplyUnsafe(CURVE.h).equals(ExtendedPoint.ZERO)}isTorsionFree(){return this.multiplyUnsafe(CURVE.l).equals(ExtendedPoint.ZERO)}toAffine(_=invert(this.z)){const{x:M,y:$,z:j}=this,z=mod(M*_),V=mod($*_);if(mod(j*_)!==_1n)throw new Error("invZ was invalid");return new Point(z,V)}fromRistrettoBytes(){legacyRist()}toRistrettoBytes(){legacyRist()}fromRistrettoHash(){legacyRist()}}ExtendedPoint.BASE=new ExtendedPoint(CURVE.Gx,CURVE.Gy,_1n,mod(CURVE.Gx*CURVE.Gy));ExtendedPoint.ZERO=new ExtendedPoint(_0n,_1n,_1n,_0n);function assertExtPoint(q){if(!(q instanceof ExtendedPoint))throw new TypeError("ExtendedPoint expected")}function assertRstPoint(q){if(!(q instanceof RistrettoPoint))throw new TypeError("RistrettoPoint expected")}function legacyRist(){throw new Error("Legacy method: switch to RistrettoPoint")}class RistrettoPoint{constructor(_){this.ep=_}static calcElligatorRistrettoMap(_){const{d:M}=CURVE,$=mod(SQRT_M1*_*_),j=mod(($+_1n)*ONE_MINUS_D_SQ);let z=BigInt(-1);const V=mod((z-M*$)*mod($+M));let{isValid:X,value:G}=uvRatio(j,V),Y=mod(G*_);edIsNegative(Y)||(Y=mod(-Y)),X||(G=Y),X||(z=$);const Q=mod(z*($-_1n)*D_MINUS_ONE_SQ-V),Z=G*G,te=mod((G+G)*V),ee=mod(Q*SQRT_AD_MINUS_ONE),ne=mod(_1n-Z),re=mod(_1n+Z);return new ExtendedPoint(mod(te*re),mod(ne*ee),mod(ee*re),mod(te*ne))}static hashToCurve(_){_=ensureBytes(_,64);const M=bytes255ToNumberLE(_.slice(0,32)),$=this.calcElligatorRistrettoMap(M),j=bytes255ToNumberLE(_.slice(32,64)),z=this.calcElligatorRistrettoMap(j);return new RistrettoPoint($.add(z))}static fromHex(_){_=ensureBytes(_,32);const{a:M,d:$}=CURVE,j="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",z=bytes255ToNumberLE(_);if(!equalBytes(numberTo32BytesLE(z),_)||edIsNegative(z))throw new Error(j);const V=mod(z*z),X=mod(_1n+M*V),G=mod(_1n-M*V),Y=mod(X*X),Q=mod(G*G),Z=mod(M*$*Y-Q),{isValid:te,value:ee}=invertSqrt(mod(Z*Q)),ne=mod(ee*G),re=mod(ee*ne*Z);let se=mod((z+z)*ne);edIsNegative(se)&&(se=mod(-se));const ie=mod(X*re),oe=mod(se*ie);if(!te||edIsNegative(oe)||ie===_0n)throw new Error(j);return new RistrettoPoint(new ExtendedPoint(se,ie,_1n,oe))}toRawBytes(){let{x:_,y:M,z:$,t:j}=this.ep;const z=mod(mod($+M)*mod($-M)),V=mod(_*M),{value:X}=invertSqrt(mod(z*V**_2n)),G=mod(X*z),Y=mod(X*V),Q=mod(G*Y*j);let Z;if(edIsNegative(j*Q)){let ee=mod(M*SQRT_M1),ne=mod(_*SQRT_M1);_=ee,M=ne,Z=mod(G*INVSQRT_A_MINUS_D)}else Z=Y;edIsNegative(_*Q)&&(M=mod(-M));let te=mod(($-M)*Z);return edIsNegative(te)&&(te=mod(-te)),numberTo32BytesLE(te)}toHex(){return bytesToHex(this.toRawBytes())}toString(){return this.toHex()}equals(_){assertRstPoint(_);const M=this.ep,$=_.ep,j=mod(M.x*$.y)===mod(M.y*$.x),z=mod(M.y*$.y)===mod(M.x*$.x);return j||z}add(_){return assertRstPoint(_),new RistrettoPoint(this.ep.add(_.ep))}subtract(_){return assertRstPoint(_),new RistrettoPoint(this.ep.subtract(_.ep))}multiply(_){return new RistrettoPoint(this.ep.multiply(_))}multiplyUnsafe(_){return new RistrettoPoint(this.ep.multiplyUnsafe(_))}}RistrettoPoint.BASE=new RistrettoPoint(ExtendedPoint.BASE);RistrettoPoint.ZERO=new RistrettoPoint(ExtendedPoint.ZERO);const pointPrecomputes=new WeakMap;class Point{constructor(_,M){this.x=_,this.y=M}_setWindowSize(_){this._WINDOW_SIZE=_,pointPrecomputes.delete(this)}static fromHex(_,M=!0){const{d:$,P:j}=CURVE;_=ensureBytes(_,32);const z=_.slice();z[31]=_[31]&-129;const V=bytesToNumberLE(z);if(M&&V>=j)throw new Error("Expected 0 < hex < P");if(!M&&V>=MAX_256B)throw new Error("Expected 0 < hex < 2**256");const X=mod(V*V),G=mod(X-_1n),Y=mod($*X+_1n);let{isValid:Q,value:Z}=uvRatio(G,Y);if(!Q)throw new Error("Point.fromHex: invalid y coordinate");const te=(Z&_1n)===_1n;return(_[31]&128)!==0!==te&&(Z=mod(-Z)),new Point(Z,V)}static async fromPrivateKey(_){return(await getExtendedPublicKey(_)).point}toRawBytes(){const _=numberTo32BytesLE(this.y);return _[31]|=this.x&_1n?128:0,_}toHex(){return bytesToHex(this.toRawBytes())}toX25519(){const{y:_}=this,M=mod((_1n+_)*invert(_1n-_));return numberTo32BytesLE(M)}isTorsionFree(){return ExtendedPoint.fromAffine(this).isTorsionFree()}equals(_){return this.x===_.x&&this.y===_.y}negate(){return new Point(mod(-this.x),this.y)}add(_){return ExtendedPoint.fromAffine(this).add(ExtendedPoint.fromAffine(_)).toAffine()}subtract(_){return this.add(_.negate())}multiply(_){return ExtendedPoint.fromAffine(this).multiply(_,this).toAffine()}}Point.BASE=new Point(CURVE.Gx,CURVE.Gy);Point.ZERO=new Point(_0n,_1n);class Signature{constructor(_,M){this.r=_,this.s=M,this.assertValidity()}static fromHex(_){const M=ensureBytes(_,64),$=Point.fromHex(M.slice(0,32),!1),j=bytesToNumberLE(M.slice(32,64));return new Signature($,j)}assertValidity(){const{r:_,s:M}=this;if(!(_ instanceof Point))throw new Error("Expected Point instance");return normalizeScalar(M,CURVE.l,!1),this}toRawBytes(){const _=new Uint8Array(64);return _.set(this.r.toRawBytes()),_.set(numberTo32BytesLE(this.s),32),_}toHex(){return bytesToHex(this.toRawBytes())}}function concatBytes(...q){if(!q.every($=>$ instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(q.length===1)return q[0];const _=q.reduce(($,j)=>$+j.length,0),M=new Uint8Array(_);for(let $=0,j=0;$<q.length;$++){const z=q[$];M.set(z,j),j+=z.length}return M}const hexes=Array.from({length:256},(q,_)=>_.toString(16).padStart(2,"0"));function bytesToHex(q){if(!(q instanceof Uint8Array))throw new Error("Uint8Array expected");let _="";for(let M=0;M<q.length;M++)_+=hexes[q[M]];return _}function hexToBytes(q){if(typeof q!="string")throw new TypeError("hexToBytes: expected string, got "+typeof q);if(q.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const _=new Uint8Array(q.length/2);for(let M=0;M<_.length;M++){const $=M*2,j=q.slice($,$+2),z=Number.parseInt(j,16);if(Number.isNaN(z)||z<0)throw new Error("Invalid byte sequence");_[M]=z}return _}function numberTo32BytesBE(q){const M=q.toString(16).padStart(64,"0");return hexToBytes(M)}function numberTo32BytesLE(q){return numberTo32BytesBE(q).reverse()}function edIsNegative(q){return(mod(q)&_1n)===_1n}function bytesToNumberLE(q){if(!(q instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+bytesToHex(Uint8Array.from(q).reverse()))}function bytes255ToNumberLE(q){return mod(bytesToNumberLE(q)&_2n**_255n-_1n)}function mod(q,_=CURVE.P){const M=q%_;return M>=_0n?M:_+M}function invert(q,_=CURVE.P){if(q===_0n||_<=_0n)throw new Error(`invert: expected positive integers, got n=${q} mod=${_}`);let M=mod(q,_),$=_,j=_0n,z=_1n;for(;M!==_0n;){const X=$/M,G=$%M,Y=j-z*X;$=M,M=G,j=z,z=Y}if($!==_1n)throw new Error("invert: does not exist");return mod(j,_)}function invertBatch(q,_=CURVE.P){const M=new Array(q.length),$=q.reduce((z,V,X)=>V===_0n?z:(M[X]=z,mod(z*V,_)),_1n),j=invert($,_);return q.reduceRight((z,V,X)=>V===_0n?z:(M[X]=mod(z*M[X],_),mod(z*V,_)),j),M}function pow2(q,_){const{P:M}=CURVE;let $=q;for(;_-- >_0n;)$*=$,$%=M;return $}function pow_2_252_3(q){const{P:_}=CURVE,M=BigInt(5),$=BigInt(10),j=BigInt(20),z=BigInt(40),V=BigInt(80),G=q*q%_*q%_,Y=pow2(G,_2n)*G%_,Q=pow2(Y,_1n)*q%_,Z=pow2(Q,M)*Q%_,te=pow2(Z,$)*Z%_,ee=pow2(te,j)*te%_,ne=pow2(ee,z)*ee%_,re=pow2(ne,V)*ne%_,se=pow2(re,V)*ne%_,ie=pow2(se,$)*Z%_;return{pow_p_5_8:pow2(ie,_2n)*q%_,b2:G}}function uvRatio(q,_){const M=mod(_*_*_),$=mod(M*M*_),j=pow_2_252_3(q*$).pow_p_5_8;let z=mod(q*M*j);const V=mod(_*z*z),X=z,G=mod(z*SQRT_M1),Y=V===q,Q=V===mod(-q),Z=V===mod(-q*SQRT_M1);return Y&&(z=X),(Q||Z)&&(z=G),edIsNegative(z)&&(z=mod(-z)),{isValid:Y||Q,value:z}}function invertSqrt(q){return uvRatio(_1n,q)}async function sha512ModqLE(...q){const _=await utils$2.sha512(concatBytes(...q)),M=bytesToNumberLE(_);return mod(M,CURVE.l)}function equalBytes(q,_){if(q.length!==_.length)return!1;for(let M=0;M<q.length;M++)if(q[M]!==_[M])return!1;return!0}function ensureBytes(q,_){const M=q instanceof Uint8Array?Uint8Array.from(q):hexToBytes(q);if(typeof _=="number"&&M.length!==_)throw new Error(`Expected ${_} bytes`);return M}function normalizeScalar(q,_,M=!0){if(!_)throw new TypeError("Specify max value");if(typeof q=="number"&&Number.isSafeInteger(q)&&(q=BigInt(q)),typeof q=="bigint"&&q<_){if(M){if(_0n<q)return q}else if(_0n<=q)return q}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function adjustBytes25519(q){return q[0]&=248,q[31]&=127,q[31]|=64,q}async function getExtendedPublicKey(q){if(q=typeof q=="bigint"||typeof q=="number"?numberTo32BytesBE(normalizeScalar(q,MAX_256B)):ensureBytes(q),q.length!==32)throw new Error("Expected 32 bytes");const _=await utils$2.sha512(q),M=adjustBytes25519(_.slice(0,32)),$=_.slice(32,64),j=mod(bytesToNumberLE(M),CURVE.l),z=Point.BASE.multiply(j),V=z.toRawBytes();return{head:M,prefix:$,scalar:j,point:z,pointBytes:V}}async function getPublicKey(q){return(await getExtendedPublicKey(q)).pointBytes}async function sign(q,_){q=ensureBytes(q);const{prefix:M,scalar:$,pointBytes:j}=await getExtendedPublicKey(_),z=await sha512ModqLE(M,q),V=Point.BASE.multiply(z),X=await sha512ModqLE(V.toRawBytes(),j,q),G=mod(z+X*$,CURVE.l);return new Signature(V,G).toRawBytes()}async function verify(q,_,M){_=ensureBytes(_),M instanceof Point||(M=Point.fromHex(M,!1));const{r:$,s:j}=q instanceof Signature?q.assertValidity():Signature.fromHex(q),z=ExtendedPoint.BASE.multiplyUnsafe(j),V=await sha512ModqLE($.toRawBytes(),M.toRawBytes(),_),X=ExtendedPoint.fromAffine(M).multiplyUnsafe(V);return ExtendedPoint.fromAffine($).add(X).subtract(z).multiplyUnsafe(CURVE.h).equals(ExtendedPoint.ZERO)}Point.BASE._setWindowSize(8);const crypto$1={node:nodeCrypto,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},utils$2={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex,getExtendedPublicKey,mod,invert,hashToPrivateScalar:q=>{if(q=ensureBytes(q),q.length<40||q.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const _=mod(bytesToNumberLE(q),CURVE.l);if(_===_0n||_===_1n)throw new Error("Invalid private key");return _},randomBytes:(q=32)=>{if(crypto$1.web)return crypto$1.web.getRandomValues(new Uint8Array(q));if(crypto$1.node){const{randomBytes:_}=crypto$1.node;return new Uint8Array(_(q).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>utils$2.randomBytes(32),sha512:async q=>{if(crypto$1.web){const _=await crypto$1.web.subtle.digest("SHA-512",q.buffer);return new Uint8Array(_)}else{if(crypto$1.node)return Uint8Array.from(crypto$1.node.createHash("sha512").update(q).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(q=8,_=Point.BASE){const M=_.equals(Point.BASE)?_:new Point(_.x,_.y);return M._setWindowSize(q),M.multiply(_2n),M}};var __classPrivateFieldGet$1=globalThis&&globalThis.__classPrivateFieldGet||function(q,_,M,$){if(M==="a"&&!$)throw new TypeError("Private accessor was defined without a getter");if(typeof _=="function"?q!==_||!$:!_.has(q))throw new TypeError("Cannot read private member from an object whose class did not declare it");return M==="m"?$:M==="a"?$.call(q):$?$.value:_.get(q)},__classPrivateFieldSet$1=globalThis&&globalThis.__classPrivateFieldSet||function(q,_,M,$,j){if($==="m")throw new TypeError("Private method is not writable");if($==="a"&&!j)throw new TypeError("Private accessor was defined without a setter");if(typeof _=="function"?q!==_||!j:!_.has(q))throw new TypeError("Cannot write private member to an object whose class did not declare it");return $==="a"?j.call(q,M):j?j.value=M:_.set(q,M),M},_XXH64_seed,_XXH64_v1,_XXH64_v2,_XXH64_v3,_XXH64_v4,_XXH64_memory,_XXH64_len,_XXH64_memsize;const PRIME64_1=11400714785074694791n,PRIME64_2=14029467366897019727n,PRIME64_3=1609587929392839161n,PRIME64_4=9650029242287828579n,PRIME64_5=2870177450012600261n,BITS=64n,BITMASK=2n**BITS-1n,encoder$1=new TextEncoder;function bitsToBigInt(q,_,M,$){return BigInt(q)|BigInt(_)<<16n|BigInt(M)<<32n|BigInt($)<<48n}function memoryToBigInt(q,_){return BigInt(q[_])|BigInt(q[_+1])<<8n|BigInt(q[_+2])<<16n|BigInt(q[_+3])<<24n|BigInt(q[_+4])<<32n|BigInt(q[_+5])<<40n|BigInt(q[_+6])<<48n|BigInt(q[_+7])<<56n}function rotl(q,_){return q<<_&BITMASK|q>>BITS-_}function trunc(q){return BigInt.asUintN(64,q)}class XXH64{constructor(_=0){_XXH64_seed.set(this,void 0),_XXH64_v1.set(this,void 0),_XXH64_v2.set(this,void 0),_XXH64_v3.set(this,void 0),_XXH64_v4.set(this,void 0),_XXH64_memory.set(this,void 0),_XXH64_len.set(this,void 0),_XXH64_memsize.set(this,void 0),this.reset(_)}reset(_=__classPrivateFieldGet$1(this,_XXH64_seed,"f")){return __classPrivateFieldSet$1(this,_XXH64_seed,BigInt.asUintN(32,BigInt(_)),"f"),__classPrivateFieldSet$1(this,_XXH64_v1,trunc(__classPrivateFieldGet$1(this,_XXH64_seed,"f")+PRIME64_1+PRIME64_2),"f"),__classPrivateFieldSet$1(this,_XXH64_v2,trunc(__classPrivateFieldGet$1(this,_XXH64_seed,"f")+PRIME64_2),"f"),__classPrivateFieldSet$1(this,_XXH64_v3,__classPrivateFieldGet$1(this,_XXH64_seed,"f"),"f"),__classPrivateFieldSet$1(this,_XXH64_v4,trunc(__classPrivateFieldGet$1(this,_XXH64_seed,"f")-PRIME64_1),"f"),__classPrivateFieldSet$1(this,_XXH64_memory,null,"f"),__classPrivateFieldSet$1(this,_XXH64_len,0,"f"),__classPrivateFieldSet$1(this,_XXH64_memsize,0,"f"),this}update(_){typeof _=="string"&&(_=encoder$1.encode(_));let M=0,$=_.length,j=M+$;if($===0)return this;if(__classPrivateFieldSet$1(this,_XXH64_len,__classPrivateFieldGet$1(this,_XXH64_len,"f")+$,"f"),__classPrivateFieldGet$1(this,_XXH64_memsize,"f")===0&&__classPrivateFieldSet$1(this,_XXH64_memory,new Uint8Array(32),"f"),__classPrivateFieldGet$1(this,_XXH64_memsize,"f")+$<32)return __classPrivateFieldGet$1(this,_XXH64_memory,"f").set(_.subarray(0,$),__classPrivateFieldGet$1(this,_XXH64_memsize,"f")),__classPrivateFieldSet$1(this,_XXH64_memsize,__classPrivateFieldGet$1(this,_XXH64_memsize,"f")+$,"f"),this;if(__classPrivateFieldGet$1(this,_XXH64_memsize,"f")>0){__classPrivateFieldGet$1(this,_XXH64_memory,"f").set(_.subarray(0,32-__classPrivateFieldGet$1(this,_XXH64_memsize,"f")),__classPrivateFieldGet$1(this,_XXH64_memsize,"f"));let z=0,V;V=memoryToBigInt(__classPrivateFieldGet$1(this,_XXH64_memory,"f"),z),__classPrivateFieldSet$1(this,_XXH64_v1,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v1,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),z+=8,V=memoryToBigInt(this.memory,z),__classPrivateFieldSet$1(this,_XXH64_v2,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v2,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),z+=8,V=memoryToBigInt(this.memory,z),__classPrivateFieldSet$1(this,_XXH64_v3,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v3,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),z+=8,V=memoryToBigInt(this.memory,z),__classPrivateFieldSet$1(this,_XXH64_v4,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v4,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),M+=32-__classPrivateFieldGet$1(this,_XXH64_memsize,"f"),__classPrivateFieldSet$1(this,_XXH64_memsize,0,"f")}if(M<=j-32){const z=j-32;do{let V;V=memoryToBigInt(_,M),__classPrivateFieldSet$1(this,_XXH64_v1,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v1,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),M+=8,V=memoryToBigInt(_,M),__classPrivateFieldSet$1(this,_XXH64_v2,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v2,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),M+=8,V=memoryToBigInt(_,M),__classPrivateFieldSet$1(this,_XXH64_v3,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v3,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),M+=8,V=memoryToBigInt(_,M),__classPrivateFieldSet$1(this,_XXH64_v4,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v4,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),M+=8}while(M<=z)}return M<j&&(__classPrivateFieldGet$1(this,_XXH64_memory,"f").set(_.subarray(M,j),__classPrivateFieldGet$1(this,_XXH64_memsize,"f")),__classPrivateFieldSet$1(this,_XXH64_memsize,j-M,"f")),this}digest(){let _=__classPrivateFieldGet$1(this,_XXH64_memory,"f"),M=__classPrivateFieldGet$1(this,_XXH64_memsize,"f"),$=0,j=0n,z=0n,V=0n;for(__classPrivateFieldGet$1(this,_XXH64_len,"f")>=32?(j=rotl(__classPrivateFieldGet$1(this,_XXH64_v1,"f"),1n)+rotl(__classPrivateFieldGet$1(this,_XXH64_v2,"f"),7n)+rotl(__classPrivateFieldGet$1(this,_XXH64_v3,"f"),12n)+rotl(__classPrivateFieldGet$1(this,_XXH64_v4,"f"),18n),j=trunc(j^rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v1,"f")*PRIME64_2),31n)*PRIME64_1),j=trunc(j*PRIME64_1+PRIME64_4),j=trunc(j^rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v2,"f")*PRIME64_2),31n)*PRIME64_1),j=trunc(j*PRIME64_1+PRIME64_4),j=trunc(j^rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v3,"f")*PRIME64_2),31n)*PRIME64_1),j=trunc(j*PRIME64_1+PRIME64_4),j=trunc(j^rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v4,"f")*PRIME64_2),31n)*PRIME64_1),j=trunc(j*PRIME64_1+PRIME64_4)):j=trunc(__classPrivateFieldGet$1(this,_XXH64_seed,"f")+PRIME64_5),j+=BigInt(__classPrivateFieldGet$1(this,_XXH64_len,"f"));$<=M-8;)V=memoryToBigInt(_,$),V=trunc(rotl(trunc(V*PRIME64_2),31n)*PRIME64_1),j=trunc(rotl(j^V,27n)*PRIME64_1+PRIME64_4),$+=8;for($+4<=M&&(V=bitsToBigInt(_[$+1]<<8|_[$],_[$+3]<<8|_[$+2],0,0),j=trunc(rotl(j^trunc(V*PRIME64_1),23n)*PRIME64_2+PRIME64_3),$+=4);$<M;)V=bitsToBigInt(_[$++],0,0,0),j=trunc(rotl(j^trunc(V*PRIME64_5),11n)*PRIME64_1);return z=trunc(j>>33n),j=trunc((j^z)*PRIME64_2),z=trunc(j>>29n),j=trunc((j^z)*PRIME64_3),z=trunc(j>>32n),j=trunc(j^z),j}}_XXH64_seed=new WeakMap,_XXH64_v1=new WeakMap,_XXH64_v2=new WeakMap,_XXH64_v3=new WeakMap,_XXH64_v4=new WeakMap,_XXH64_memory=new WeakMap,_XXH64_len=new WeakMap,_XXH64_memsize=new WeakMap;function hash(q,_=0){return new XXH64(_).update(q).digest()}function ascend(q,_){return q<_?-1:q>_?1:0}class BinarySearchNode{constructor(_,M){Object.defineProperty(this,"parent",{enumerable:!0,configurable:!0,writable:!0,value:_}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:M}),Object.defineProperty(this,"left",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"right",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.left=null,this.right=null}static from(_){const M=new BinarySearchNode(_.parent,_.value);return M.left=_.left,M.right=_.right,M}directionFromParent(){return this.parent===null?null:this===this.parent.left?"left":this===this.parent.right?"right":null}findMinNode(){let _=this.left;for(;_!=null&&_.left;)_=_.left;return _??this}findMaxNode(){let _=this.right;for(;_!=null&&_.right;)_=_.right;return _??this}findSuccessorNode(){if(this.right!==null)return this.right.findMinNode();let _=this.parent,M=this.directionFromParent();for(;_&&M==="right";)M=_.directionFromParent(),_=_.parent;return _}}class BinarySearchTree{constructor(_=ascend){Object.defineProperty(this,"compare",{enumerable:!0,configurable:!0,writable:!0,value:_}),Object.defineProperty(this,"root",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_size",{enumerable:!0,configurable:!0,writable:!0,value:0})}static from(_,M){let $,j=[];if(_ instanceof BinarySearchTree)if($=new BinarySearchTree((M==null?void 0:M.compare)??_.compare),M!=null&&M.compare||M!=null&&M.map)j=_;else{const V=[];for(_.root&&($.root=BinarySearchNode.from(_.root),V.push($.root));V.length;){const X=V.pop(),G=X.left?BinarySearchNode.from(X.left):null,Y=X.right?BinarySearchNode.from(X.right):null;G&&(G.parent=X,V.push(G)),Y&&(Y.parent=X,V.push(Y))}}else $=M!=null&&M.compare?new BinarySearchTree(M.compare):new BinarySearchTree,j=_;const z=M!=null&&M.map?Array.from(j,M.map,M.thisArg):j;for(const V of z)$.insert(V);return $}get size(){return this._size}findNode(_){let M=this.root;for(;M;){const $=this.compare(_,M.value);if($===0)break;const j=$<0?"left":"right";M=M[j]}return M}rotateNode(_,M){const $=M==="left"?"right":"left";if(!_[$])throw new TypeError(`cannot rotate ${M} without ${$} child`);const j=_[$];if(_[$]=j[M]??null,j[M]&&(j[M].parent=_),j.parent=_.parent,_.parent){const z=_===_.parent[M]?M:$;_.parent[z]=j}else this.root=j;j[M]=_,_.parent=j}insertNode(_,M){if(this.root){let $=this.root;for(;;){const j=this.compare(M,$.value);if(j===0)break;const z=j<0?"left":"right";if($[z])$=$[z];else return $[z]=new _($,M),this._size++,$[z]}}else return this.root=new _(null,M),this._size++,this.root;return null}removeNode(_){let M=this.findNode(_);if(M){const $=!M.left||!M.right?M:M.findSuccessorNode(),j=$.left??$.right;j&&(j.parent=$.parent),$.parent?$.parent[$.directionFromParent()]=j:this.root=j,$!==M&&(M.value=$.value,M=$),this._size--}return M}insert(_){return!!this.insertNode(BinarySearchNode,_)}remove(_){return!!this.removeNode(_)}find(_){var M;return((M=this.findNode(_))==null?void 0:M.value)??null}min(){return this.root?this.root.findMinNode().value:null}max(){return this.root?this.root.findMaxNode().value:null}clear(){this.root=null,this._size=0}isEmpty(){return this.size===0}*lnrValues(){const _=[];let M=this.root;for(;_.length||M;)M?(_.push(M),M=M.left):(M=_.pop(),yield M.value,M=M.right)}*rnlValues(){const _=[];let M=this.root;for(;_.length||M;)M?(_.push(M),M=M.right):(M=_.pop(),yield M.value,M=M.left)}*nlrValues(){const _=[];for(this.root&&_.push(this.root);_.length;){const M=_.pop();yield M.value,M.right&&_.push(M.right),M.left&&_.push(M.left)}}*lrnValues(){const _=[];let M=this.root,$=null;for(;_.length||M;)if(M)_.push(M),M=M.left;else{const j=_[_.length-1];j.right&&j.right!==$?M=j.right:(yield j.value,$=_.pop())}}*lvlValues(){const _=[];let M=this.root;for(;M;)yield M.value,M.left&&_.push(M.left),M.right&&_.push(M.right),M=_.shift()??null}*[Symbol.iterator](){yield*this.lnrValues()}}class RedBlackNode extends BinarySearchNode{constructor(_,M){super(_,M),Object.defineProperty(this,"red",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.red=!0}static from(_){const M=new RedBlackNode(_.parent,_.value);return M.left=_.left,M.right=_.right,M.red=_.red,M}}class RedBlackTree extends BinarySearchTree{constructor(_=ascend){super(_)}static from(_,M){let $,j=[];if(_ instanceof RedBlackTree)if($=new RedBlackTree((M==null?void 0:M.compare)??_.compare),M!=null&&M.compare||M!=null&&M.map)j=_;else{const V=[];for(_.root&&($.root=RedBlackNode.from(_.root),V.push($.root));V.length;){const X=V.pop(),G=X.left?RedBlackNode.from(X.left):null,Y=X.right?RedBlackNode.from(X.right):null;G&&(G.parent=X,V.push(G)),Y&&(Y.parent=X,V.push(Y))}}else $=M!=null&&M.compare?new RedBlackTree(M.compare):new RedBlackTree,j=_;const z=M!=null&&M.map?Array.from(j,M.map,M.thisArg):j;for(const V of z)$.insert(V);return $}removeFixup(_,M){var $,j,z;for(;_&&!(M!=null&&M.red);){const V=_.left===M?"left":"right",X=V==="right"?"left":"right";let G=_[X];G!=null&&G.red&&(G.red=!1,_.red=!0,this.rotateNode(_,V),G=_[X]),G&&(!(($=G.left)!=null&&$.red)&&!((j=G.right)!=null&&j.red)?(G.red=!0,M=_,_=M.parent):((z=G[X])!=null&&z.red||(G[V].red=!1,G.red=!0,this.rotateNode(G,X),G=_[X]),G.red=_.red,_.red=!1,G[X].red=!1,this.rotateNode(_,V),M=this.root,_=null))}M&&(M.red=!1)}insert(_){var $;let M=this.insertNode(RedBlackNode,_);if(M){for(;($=M.parent)!=null&&$.red;){let j=M.parent;const z=j.directionFromParent(),V=z==="right"?"left":"right",X=j.parent[V]??null;X!=null&&X.red?(j.red=!1,X.red=!1,j.parent.red=!0,M=j.parent):(M===j[V]&&(M=j,this.rotateNode(M,z),j=M.parent),j.red=!1,j.parent.red=!0,this.rotateNode(j.parent,V))}this.root.red=!1}return!!M}remove(_){const M=this.removeNode(_);return M&&!M.red&&this.removeFixup(M.parent,M.left??M.right),!!M}}function combineMonoid(q,_){return{lift:M=>[q.lift(M),_.lift(M)],combine:(M,$)=>{const j=q.combine(M[0],$[0]),z=_.combine(M[1],$[1]);return[j,z]},neutral:[q.neutral,_.neutral]}}const sizeMonoid={lift:q=>1,combine:(q,_)=>q+_,neutral:0};class FingerprintNode extends RedBlackNode{constructor(_,M,$){super(_,M),Object.defineProperty(this,"label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"liftedValue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"monoid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.label=$.neutral,this.liftedValue=$.lift(M),this.monoid=$}updateLabel(_=!0,M){var $;this.left!==null&&this.right===null?this.label=this.monoid.combine(this.left.label,this.liftedValue):this.left===null&&this.right!==null?this.label=this.monoid.combine(this.liftedValue,this.right.label):this.left&&this.right?this.label=this.monoid.combine(this.left.label,this.monoid.combine(this.liftedValue,this.right.label)):this.label=this.liftedValue,_&&(($=this.parent)==null||$.updateLabel(!0,"Updated by child"))}}class FingerprintTree extends RedBlackTree{constructor(_,M){super(M),Object.defineProperty(this,"monoid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedMinNode",{enumerable:!0,configurable:!0,writable:!0,value:null});const z=combineMonoid({lift:V=>[V],combine:(V,X)=>V.concat(X),neutral:[]},{lift:V=>V,combine:(V,X)=>{if(!(V===void 0&&X===void 0))return X===void 0?V:V===void 0?X:M(V,X)>0?V:X},neutral:void 0});this.monoid=combineMonoid(_,combineMonoid(sizeMonoid,z))}getLowestValue(){if(!this.root)throw new Error("Can't get a range from a tree with no items");return this.cachedMinNode?this.cachedMinNode.value:this.root.findMinNode().value}rotateNode(_,M){var z;const $=M==="left"?"right":"left";if(!_[$])throw new TypeError(`cannot rotate ${M} without ${$} child`);const j=_[$];if(_[$]=j[M]??null,j[M]&&(j[M].parent=_),j.parent=_.parent,_.parent){const V=_===_.parent[M]?M:$;_.parent[V]=j}else this.root=j;j[M]=_,_.parent=j,(z=j[M])==null||z.updateLabel(!1,"Node rotated")}removeFixup(_,M){var $,j,z;for(;_&&!(M!=null&&M.red);){const V=_.left===M?"left":"right",X=V==="right"?"left":"right";let G=_[X];G!=null&&G.red&&(G.red=!1,_.red=!0,this.rotateNode(_,V),G=_[X]),G&&(!(($=G.left)!=null&&$.red)&&!((j=G.right)!=null&&j.red)?(G.red=!0,M=_,_=M.parent):((z=G[X])!=null&&z.red||(G[V].red=!1,G.red=!0,this.rotateNode(G,X),G=_[X]),G.red=_.red,_.red=!1,G[X].red=!1,this.rotateNode(_,V),M=this.root,_=null))}M&&(M.red=!1)}insertFingerprintNode(_){if(this.root){let M=this.root,$=!0;for(;;){const j=this.compare(_,M.value);if(j===0){$=!1;break}const z=j<0?"left":"right";if($&&z==="right"&&($=!1),M[z])M=M[z];else return M[z]=new FingerprintNode(M,_,this.monoid),this._size++,$&&(this.cachedMinNode=M[z]),M[z]}}else return this.root=new FingerprintNode(null,_,this.monoid),this._size++,this.cachedMinNode=this.root,this.root;return null}insert(_){var j;const M=this.insertFingerprintNode(_);let $=M;if($){for(;(j=$.parent)!=null&&j.red;){let z=$.parent;const V=z.directionFromParent(),X=V==="right"?"left":"right",G=z.parent[X]??null;G!=null&&G.red?(z.red=!1,G.red=!1,z.parent.red=!0,$=z.parent):($===z[X]&&($=z,this.rotateNode($,V),z=$.parent),z.red=!1,z.parent.red=!0,this.rotateNode(z.parent,X))}this.root.red=!1}return M==null||M.updateLabel(!0,"Node inserted"),!!$}remove(_){var $;const M=this.removeNode(_);return M&&!M.red&&this.removeFixup(M.parent,M.left??M.right),M&&(($=M.parent)==null||$.updateLabel(!0,"Child node removed")),!!M}getFingerprint(_,M,$){if(this.root===null)return{fingerprint:this.monoid.neutral[0],size:0,items:[],nextTree:null};const j=this.compare(_,M);if(j===0)return{fingerprint:this.root.label[0],size:this.root.label[1][0],items:this.root.label[1][1][0],nextTree:this.cachedMinNode};if(j<0){const z=this.compare(_,this.cachedMinNode.value)<=0?this.cachedMinNode:null,V=$||z||this.findGteNode(_),{label:X,nextTree:G}=this.aggregateUntil(V,_,M);return{fingerprint:X[0],size:X[1][0],items:X[1][1][0],nextTree:G}}else{const z=this.cachedMinNode,V=this.root.label[1][1][1],X=this.compare(M,z.value)>0,G=this.compare(_,V)<=0;if(X&&G){const{label:Y,nextTree:Q}=this.aggregateUntil(z,z.value,M),te=[this.monoid.lift(V)[0],[1,[[V],V]]],ee=$||this.findGteNode(_),{label:ne}=this.aggregateUntil(ee,_,V),re=this.monoid.combine(ne,te),se=this.monoid.combine(Y,re);return{fingerprint:se[0],size:se[1][0],items:se[1][1][0],nextTree:Q}}else if(X){const{label:Y,nextTree:Q}=this.aggregateUntil(z,z.value,M);return{fingerprint:Y[0],size:Y[1][0],items:Y[1][1][0],nextTree:Q}}else{const Y=this.compare(_,this.cachedMinNode.value)<=0?this.cachedMinNode:null,Q=$||Y||this.findGteNode(_),{label:Z}=this.aggregateUntil(Q,_,V),ee=[this.monoid.lift(V)[0],[1,[[V],V]]],ne=this.monoid.combine(Z,ee);return{fingerprint:ne[0],size:ne[1][0],items:ne[1][1][0],nextTree:Y}}}}findGteNode(_){let M=this.root;for(;M;){const $=this.compare(_,M.value);if($===0)break;const j=$<0?"left":"right";if(M[j])M=M[j];else break}return M}aggregateUntil(_,M,$){const{label:j,nextTree:z}=this.aggregateUp(_,M,$);return z===null||this.compare(z.value,$)>=0?{label:j,nextTree:z}:this.aggregateDown(z.right,$,this.monoid.combine(j,z.liftedValue))}aggregateUp(_,M,$){var V;let j=this.monoid.neutral,z=_;for(;this.compare(z.label[1][1][1],$)<0;){if(this.compare(z.value,M)>=0&&(j=this.monoid.combine(j,this.monoid.combine(z.liftedValue,((V=z.right)==null?void 0:V.label)||this.monoid.neutral))),z.parent===null)return{label:j,nextTree:null};z=z.parent}return{label:j,nextTree:z}}aggregateDown(_,M,$){var V,X;let j=_,z=$;for(;j!==null;)if(this.compare(j.value,M)<0)z=this.monoid.combine(z,this.monoid.combine(((V=j.left)==null?void 0:V.label)||this.monoid.neutral,j.liftedValue)),j=j.right;else{if(j.left===null||this.compare(j.label[1][1][1],M)<0)return{label:this.monoid.combine(z,((X=j.left)==null?void 0:X.label)||this.monoid.neutral),nextTree:j};j=j.left}return{label:z,nextTree:null}}isValueEqual(_,M){return this.compare(_,M)===0}}function deferred$1(){let q,_="pending";const M=new Promise(($,j)=>{q={async resolve(z){await z,_="fulfilled",$(z)},reject(z){_="rejected",j(z)}}});return Object.defineProperty(M,"state",{get:()=>_}),Object.assign(M,q)}class TeeableDeferred{constructor(){Object.defineProperty(this,"deferreds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"pending"})}resolve(_){if(this.state==="pending"){this.state="fulfilled";for(const M of this.deferreds)M.resolve(_)}}reject(_){if(this.state==="pending"){this.state="rejected";for(const M of this.deferreds)M.reject(_)}}tee(){const _=deferred$1();return this.state==="fulfilled"?_.resolve():this.state==="rejected"?_.reject():this.deferreds.add(_),_}}class RangeMessenger{constructor(_){Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDoneTee",{enumerable:!0,configurable:!0,writable:!0,value:new TeeableDeferred}),Object.defineProperty(this,"insertionCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"fingerprintEquals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowerBoundFromPrev",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"collatedPayload",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"collatePayloads",{enumerable:!0,configurable:!0,writable:!0,value:M=>{switch(M.type){case"payload":{let $=this.collatedPayload;if($===null&&($={type:"payload",lowerBound:M.lowerBound,payload:[],end:{canRespond:!1,upperBound:M.payload}}),$.payload.push(M.payload),this.collatedPayload=$,M.end)return M.end.upperBound?$.end=M.end:$.end={...M.end,upperBound:M.payload},this.collatedPayload=null,$;break}default:return this.collatedPayload&&(this.collatedPayload=null),M}}}),Object.defineProperty(this,"reusableTree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastAdjacentDoneUpperBound",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"isDoneSoFar",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.tree=_.tree,this.fingerprintEquals=_.fingerprintEquals,this.encoding=_.encoding,this.payloadThreshold=_.payloadThreshold,this.rangeDivision=_.rangeDivision}decode(_){const M=this.lowerBoundFromPrev;try{switch(this.encoding.decode.getType(_)){case"payload":{const j=this.encoding.decode.payload(_);return j.end&&(this.lowerBoundFromPrev=j.end.upperBound),{type:"payload",lowerBound:M,payload:j.value,...j.end?{end:j.end}:{}}}case"fingerprint":{const j=this.encoding.decode.fingerprint(_);return this.lowerBoundFromPrev=j.upperBound,{type:"fingerprint",lowerBound:M,fingerprint:j.fingerprint,upperBound:j.upperBound}}case"emptyPayload":{const j=this.encoding.decode.emptyPayload(_);return this.lowerBoundFromPrev=j,{lowerBound:M,type:"emptyPayload",upperBound:j}}case"done":{const j=this.encoding.decode.done(_);return this.lowerBoundFromPrev=j,{lowerBound:M,type:"done",upperBound:j}}case"emptySet":return{type:"emptySet",canRespond:this.encoding.decode.emptySet(_)};case"lowerBound":{const j=this.encoding.decode.lowerBound(_);return this.lowerBoundFromPrev=j,{type:"lowerBound",value:j}}case"terminal":return this.encoding.decode.terminal(_),{type:"terminal"}}}catch($){console.group("range-reconcile: Could not decode message"),console.warn(_),console.warn($)}return null}setReusableTree(_){this.reusableTree=_||void 0}process(_){const M=this.reusableTree;switch(_.type){case"lowerBound":case"terminal":case"done":return this.setReusableTree(null),[_];case"emptySet":{if(_.canRespond===!1&&this.isDoneTee.resolve(),this.tree.size===0)return[{type:"emptySet",canRespond:!1}];const $=this.tree.getLowestValue(),j=[{type:"lowerBound",value:$}],{items:z}=this.tree.getFingerprint($,$);for(let V=0;V<z.length;V++){const X=z[V];V===z.length-1?j.push({type:"payload",payload:X,end:{upperBound:$,canRespond:!1}}):j.push({type:"payload",payload:X})}return j.push({type:"terminal"}),j}case"fingerprint":{const{fingerprint:$,size:j,items:z,nextTree:V}=this.tree.getFingerprint(_.lowerBound,_.upperBound,M);if(this.setReusableTree(V),this.fingerprintEquals($,_.fingerprint))return[{type:"done",upperBound:_.upperBound}];if(j<=this.payloadThreshold){if(j===0)return[{type:"emptyPayload",upperBound:_.upperBound}];const X=[];for(let G=0;G<j;G++)X.push({type:"payload",payload:z[G],...G===z.length-1?{end:{upperBound:_.upperBound,canRespond:!0}}:{}});return X}else{const X=Math.ceil(j/this.rangeDivision),G=[];if(X<=this.payloadThreshold){for(let te=0;te<z.length;te++)G.push({type:"payload",payload:z[te],...te===z.length-1?{end:{upperBound:_.upperBound,canRespond:!0}}:{}});return G}let Y;const Q=z;let Z=!1;if(_.lowerBound>=_.upperBound){let te=0;for(let ee=0;ee<=z.length;ee++)if(z[ee]>=_.lowerBound){te=ee;break}if(te>0){const ee=Q.splice(0,te);Q.push(...ee),Z=!0}}for(let te=0;te<j;te+=X){const ee=Q[te],ne=Q[te+X]||_.upperBound,{fingerprint:re,nextTree:se}=this.tree.getFingerprint(ee,ne,Y);Y=Z?void 0:se||void 0,G.push({type:"fingerprint",fingerprint:re,upperBound:ne})}return G}}case"payload":{for(const $ of _.payload){this.tree.insert($);for(const j of this.insertionCallbacks)j($)}if(_.end.canRespond){const{items:$,size:j,nextTree:z}=this.tree.getFingerprint(_.lowerBound,_.end.upperBound,M);if(this.setReusableTree(z),j===0)return[{type:"emptyPayload",upperBound:_.end.upperBound}];const V=[];for(let G=0;G<j;G++){let Y=!1;for(let Q=0;Q<_.payload.length;Q++)this.tree.isValueEqual($[G],_.payload[Q])&&(Y=!0);Y||V.push({type:"payload",payload:$[G]})}const X=V[V.length-1];return V[V.length-1]={...X,end:{upperBound:_.end.upperBound,canRespond:!1}},V}else return this.setReusableTree(null),[{type:"done",upperBound:_.end.upperBound}]}case"emptyPayload":{this.setReusableTree(null);const{items:$,size:j,nextTree:z}=this.tree.getFingerprint(_.lowerBound,_.upperBound);if(this.setReusableTree(z),j===0)return this.setReusableTree(null),[];const V=[];for(let X=0;X<j;X++)V.push({type:"payload",payload:$[X],...X===$.length-1?{end:{upperBound:_.upperBound,canRespond:!1}}:{}});return V}}}consolidateAdjacentDones(_){switch(_.type){case"done":{this.lastAdjacentDoneUpperBound=_.upperBound;break}default:{const M=this.lastAdjacentDoneUpperBound;return M?(this.lastAdjacentDoneUpperBound=null,[{type:"done",upperBound:M},_]):[_]}}}checkIsDone(_){var M;if(this.isDoneTee.state==="pending")switch(_.type){case"emptySet":{_.canRespond&&(this.isDoneSoFar=!1);break}case"lowerBound":break;case"fingerprint":this.isDoneSoFar=!1;break;case"emptyPayload":this.isDoneSoFar=!1;break;case"payload":((M=_.end)==null?void 0:M.canRespond)===!0&&(this.isDoneSoFar=!1);break;case"terminal":this.isDoneSoFar?this.isDoneTee.resolve():this.isDoneSoFar=!0}}encode(_){let M;switch(_.type){case"emptySet":{M=this.encoding.encode.emptySet(_.canRespond);break}case"lowerBound":{M=this.encoding.encode.lowerBound(_.value);break}case"done":{M=this.encoding.encode.done(_.upperBound);break}case"fingerprint":{M=this.encoding.encode.fingerprint(_.fingerprint,_.upperBound);break}case"payload":{M=this.encoding.encode.payload(_.payload,_.end);break}case"emptyPayload":{M=this.encoding.encode.emptyPayload(_.upperBound);break}case"terminal":{M=this.encoding.encode.terminal();break}}return M}respond(_){if(this.isDone().state==="fulfilled")return[];const M=this.decode(_),$=this.collatePayloads(M);if($===void 0)return[];const j=this.process($),z=[];for(const X of j){const G=this.consolidateAdjacentDones(X);G&&z.push(...G)}for(const X of z)this.checkIsDone(X);const V=[];for(const X of z)V.push(this.encode(X));return V}isDone(){return this.isDoneTee.tee()}initialMessages(_){const{tree:M,encoding:$,payloadThreshold:j,rangeDivision:z}=this;function*V(){if(M.size===0){yield $.encode.emptySet(!0);return}const X=M.getLowestValue();yield $.encode.lowerBound(X);const{items:Y}=M.getFingerprint(X,X),Z=(_||(ne=>{const re=Math.ceil(ne.length/z),se=[];for(let ie=0;ie<ne.length;ie+=re){const oe=ne.slice(ie,ie+re);se.push(oe)}return se}))(Y);let te;for(let ne=0;ne<Z.length;ne++){const re=Z[ne+1]?Z[ne+1][0]:X,se=Z[ne];if(se.length<=j)for(let ie=0;ie<se.length;ie++)yield $.encode.payload(se[ie],ie===se.length-1?{upperBound:re,canRespond:!0}:void 0);else{const ie=se[0],{fingerprint:oe,nextTree:he}=M.getFingerprint(ie,re,te);te=he||void 0,yield $.encode.fingerprint(oe,re)}}yield $.encode.terminal()}return V()}onInsertion(_){return this.insertionCallbacks.add(_),()=>{this.insertionCallbacks.delete(_)}}}var __classPrivateFieldGet=globalThis&&globalThis.__classPrivateFieldGet||function(q,_,M,$){if(M==="a"&&!$)throw new TypeError("Private accessor was defined without a getter");if(typeof _=="function"?q!==_||!$:!_.has(q))throw new TypeError("Cannot read private member from an object whose class did not declare it");return M==="m"?$:M==="a"?$.call(q):$?$.value:_.get(q)},__classPrivateFieldSet=globalThis&&globalThis.__classPrivateFieldSet||function(q,_,M,$,j){if($==="m")throw new TypeError("Private method is not writable");if($==="a"&&!j)throw new TypeError("Private accessor was defined without a setter");if(typeof _=="function"?q!==_||!j:!_.has(q))throw new TypeError("Cannot write private member to an object whose class did not declare it");return $==="a"?j.call(q,M):j?j.value=M:_.set(q,M),M},_AsyncQueue_instances,_AsyncQueue_queue,_AsyncQueue_resolve,_AsyncQueue_error,_AsyncQueue_handleError,_AsyncQueue_enqueue;const END=Symbol("Stream ended."),ERROR=Symbol("Stream errored.");class AsyncQueue{constructor(_){var M,$,j;_AsyncQueue_instances.add(this),_AsyncQueue_queue.set(this,[]),_AsyncQueue_resolve.set(this,null),_AsyncQueue_error.set(this,void 0),Object.defineProperty(this,"push",{enumerable:!0,configurable:!0,writable:!0,value:(...z)=>{z.length?__classPrivateFieldGet(this,_AsyncQueue_instances,"m",_AsyncQueue_enqueue).call(this,!1,z):(__classPrivateFieldGet(this,_AsyncQueue_instances,"m",_AsyncQueue_enqueue).call(this,!1,[ERROR]),__classPrivateFieldGet(this,_AsyncQueue_instances,"m",_AsyncQueue_handleError).call(this,new Error("AsyncQueueError: queue.push was called with no arguments")))}}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:({immediately:z=!1,withError:V}={})=>{V&&__classPrivateFieldGet(this,_AsyncQueue_instances,"m",_AsyncQueue_handleError).call(this,V),__classPrivateFieldGet(this,_AsyncQueue_instances,"m",_AsyncQueue_enqueue).call(this,z,[V?ERROR:END]),this.push=this.close=()=>{}}}),(j=($=(M=_==null?void 0:_.catch)==null?void 0:M.call(_,z=>this.close({withError:z})))==null?void 0:$.finally)==null||j.call($,()=>this.close())}get length(){return __classPrivateFieldGet(this,_AsyncQueue_queue,"f").length}async*[(_AsyncQueue_queue=new WeakMap,_AsyncQueue_resolve=new WeakMap,_AsyncQueue_error=new WeakMap,_AsyncQueue_instances=new WeakSet,_AsyncQueue_handleError=function(M){__classPrivateFieldGet(this,_AsyncQueue_error,"f")instanceof AggregateError?__classPrivateFieldGet(this,_AsyncQueue_error,"f").errors.push(M):__classPrivateFieldGet(this,_AsyncQueue_error,"f")?__classPrivateFieldSet(this,_AsyncQueue_error,new AggregateError([__classPrivateFieldGet(this,_AsyncQueue_error,"f"),M]),"f"):__classPrivateFieldSet(this,_AsyncQueue_error,M,"f")},_AsyncQueue_enqueue=function(M,$){var j;__classPrivateFieldGet(this,_AsyncQueue_queue,"f")[M?"unshift":"push"](...$),(j=__classPrivateFieldGet(this,_AsyncQueue_resolve,"f"))==null||j.call(this,__classPrivateFieldGet(this,_AsyncQueue_queue,"f").shift()),__classPrivateFieldSet(this,_AsyncQueue_resolve,null,"f")},Symbol.asyncIterator)](){for(;;){const _=__classPrivateFieldGet(this,_AsyncQueue_queue,"f").length?__classPrivateFieldGet(this,_AsyncQueue_queue,"f").shift():await new Promise(M=>{__classPrivateFieldSet(this,_AsyncQueue_resolve,M,"f")});if(_===ERROR)throw __classPrivateFieldGet(this,_AsyncQueue_error,"f");if(_===END)break;yield _}}}function deferred(){let q,_="pending";const M=new Promise(($,j)=>{q={async resolve(z){await z,_="fulfilled",$(z)},reject(z){_="rejected",j(z)}}});return Object.defineProperty(M,"state",{get:()=>_}),Object.assign(M,q)}new TextDecoder$1;const encoder=new TextEncoder;function stringToBytes(q){return encoder.encode(q)}function stringLengthInBytes(q){return stringToBytes(q).length}function onlyHasChars(q,_){for(let M of q)if(_.indexOf(M)===-1)return!1;return!0}function isDigit(q){return q===""?!1:digits.indexOf(q)!==-1}const alphaLower="abcdefghijklmnopqrstuvwxyz",alphaUpper=alphaLower.toUpperCase(),digits="0123456789",b32chars=alphaLower+"234567",authorNameChars=alphaLower+digits,authorKeyChars=b32chars,authorAddressChars=authorNameChars+b32chars+"@.",workspaceNameChars=alphaLower+digits,workspaceKeyChars=b32chars,workspaceAddressChars=workspaceNameChars+b32chars+"+.",pathPunctuation="/'()-._~!$&+,:=@%",pathChars=alphaLower+alphaUpper+digits+pathPunctuation;function assembleAuthorAddress(q,_){return`@${q}.${_}`}function assembleShareAddress(q,_){return`+${q}.${_}`}function checkAuthorIsValid(q){const _=parseAuthorAddress(q);return notErr(_)?!0:_}function checkShareIsValid(q){const _=parseShareAddress(q);return notErr(_)?!0:_}function parseAuthorOrShareAddress(q){return q.startsWith("@")?parseAuthorAddress(q):q.startsWith("+")?parseShareAddress(q):new ValidationError("address must start with either @ or +")}function parseAuthorAddress(q){return parseAddress(q,{sigil:"@",separator:".",minNameLength:4,maxNameLength:4,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:authorNameChars,allowedPubkeyCharacters:authorKeyChars,pubkeyMustStartWithB:!0})}function parseShareAddress(q){return parseAddress(q,{sigil:"+",separator:".",minNameLength:1,maxNameLength:15,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:workspaceNameChars,allowedPubkeyCharacters:workspaceKeyChars,pubkeyMustStartWithB:!0})}function parseAddress(q,_){const{sigil:M,separator:$,minNameLength:j,maxNameLength:z,minPubkeyLength:V,maxPubkeyLength:X,allowedNameCharacters:G,allowedPubkeyCharacters:Y,pubkeyMustStartWithB:Q}=_;if(typeof q!="string")return new ValidationError("address must be a string");if(q.length<4)return new ValidationError("address is too short");if(q[0]!==M)return new ValidationError(`address must start with a sigil: "${M}"`);if(q.indexOf($)===-1)return new ValidationError(`address must contain a separator character: "${$}"`);const Z=q.slice(1).split($);if(Z.length!==2)return new ValidationError(`address must have exactly 2 parts separated by a "${$}" separator`);const[te,ee]=Z;return te.length<j||te.length>z?new ValidationError(`name must be between ${j} and ${z} characters long, but is ${te.length}`):ee.length<V||ee.length>X?new ValidationError(`pubkey must be between ${V} and ${X} characters long, but is ${ee.length}`):onlyHasChars(te,G)?onlyHasChars(ee,Y)?isDigit(te[0])?new ValidationError(`name "${te}" must not start with a digit`):isDigit(ee[0])?new ValidationError(`pubkey "${ee}" must not start with a digit`):Q&&ee[0]!=="b"?new ValidationError(`pubkey "${ee}" must start with 'b'`):{address:q,name:te,pubkey:ee}:new ValidationError(`pubkey "${ee}" must only have allowed characters`):new ValidationError(`name "${te}" must only have allowed characters`)}function isPlainObject(q){return!(Object.prototype.toString.call(q)!=="[object Object]"||(""+q.constructor).startsWith("class"))}function checkLiteral(q){return _=>_!==q?`expected literal value ${JSON.stringify(q)}`:null}function checkString(q={}){return _=>{if(q.optional!==!0&&_===void 0)return"required";if(q.optional===!0&&_===void 0)return null;let M=stringLengthInBytes(_);return typeof _!="string"?"expected a string but got "+JSON.stringify(_):q.minLen!==void 0&&M<q.minLen?`string shorter than min length of ${q.minLen} chars`:q.maxLen!==void 0&&M>q.maxLen?`string shorter than max length of ${q.maxLen} chars`:q.len!==void 0&&M!==q.len?`string does not have required length of ${q.len} chars: ${_}`:q.allowedChars!==void 0&&!onlyHasChars(_,q.allowedChars)?"contains disallowed characters":null}}function checkInt(q={}){return _=>q.optional!==!0&&_===void 0?"required":q.optional===!0&&_===void 0?null:q.nullable!==!0&&_===null?"not nullable":q.nullable===!0&&_===null?null:typeof _!="number"?"expected a number but got "+JSON.stringify(_):isNaN(_)?"is NaN":isFinite(_)?_!==Math.round(_)?"expected an integer":q.min!==void 0&&_<q.min?`integer too small (must be >= ${q.min})`:q.max!==void 0&&_>q.max?`integer too large (must be <= ${q.max})`:null:"is Infinity"}function checkObj(q={}){return q.allowLiteralUndefined=q.allowLiteralUndefined??!1,q.allowExtraKeys=q.allowExtraKeys??!1,_=>{if(!isPlainObject(_))return"expected an object";if(q.allowLiteralUndefined===!1){for(let[M,$]of Object.entries(_))if($===void 0)return`${M} is explicitly set to undefined but should be missing instead`}if(q.objSchema!==void 0){if(q.allowExtraKeys===!1){let M=Object.keys(_),$=Object.keys(q.objSchema),j=M.filter(z=>$.indexOf(z)===-1);if(j.length>0)return`object has extra keys not in the schema: ${j.join(", ")}`}for(let[M,$]of Object.entries(q.objSchema)){let j=$(_[M]);if(j!==null)return`${M}: ${j}`}}return null}}const{codec}=rfc4648,myEncoding={chars:"abcdefghijklmnopqrstuvwxyz234567",bits:5};function base32BytesToString(q){return"b"+codec.stringify(q,myEncoding,{pad:!1})}function base32StringToBytes(q){if(!q.startsWith("b"))throw new ValidationError("can't decode base32 string - it should start with a 'b'. "+q);if(q[q.length-1]==="=")throw new ValidationError("can't decode base32 string - it contains padding characters ('=')");return codec.parse(q.slice(1),myEncoding,{loose:!0})}var LogLevel;(function(q){q[q.None=-1]="None",q[q.Error=0]="Error",q[q.Warn=1]="Warn",q[q.Log=2]="Log",q[q.Info=3]="Info",q[q.Debug=4]="Debug"})(LogLevel||(LogLevel={}));const DEFAULT_LOG_LEVEL=LogLevel.Error;let globalLogLevels={_default:DEFAULT_LOG_LEVEL};function getLogLevel(q){return q in globalLogLevels?globalLogLevels[q]:globalLogLevels._default}class Logger{constructor(_,M){Object.defineProperty(this,"source",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.source=_,this.color=M||"aqua"}_print(_,M,$,...j){if(_<=getLogLevel(this.source))if(M){const z=`[${this.source}]`;if(this.color!==void 0){const V=[`%c ${z}`,`color: ${this.color}`];console.log($,...V,...j)}else console.log($,z,...j)}else console.log($,...j)}error(..._){this._print(LogLevel.Error,!0,"!!",..._)}warn(..._){this._print(LogLevel.Warn,!0,"! ",..._)}log(..._){this._print(LogLevel.Log,!0,"  ",..._)}info(..._){this._print(LogLevel.Info,!0,"    ",..._)}debug(..._){this._print(LogLevel.Debug,!0,"      ",..._)}blank(){this._print(LogLevel.Info,!1,"")}}class UpdatableHash{constructor(_){Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalDigest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.hash=_.hash,this.internalUpdate=_.update,this.internalDigest=_.digest}update(_){return this.hash=this.internalUpdate(this.hash,_),this.hash}digest(){return this.internalDigest(this.hash)}}const{createHash}=sha256_uint8array,logger$7=new Logger("crypto-driver-noble","cyan"),CryptoDriverNoble=class{static sha256(q){return typeof q=="string"?Promise.resolve(createHash("sha256").update(q,"utf-8").digest()):Promise.resolve(createHash("sha256").update(q).digest())}static updatableSha256(){return new UpdatableHash({hash:createHash("sha256"),update:(q,_)=>q.update(_),digest:q=>q.digest()})}static async generateKeypairBytes(){logger$7.debug("generateKeypairBytes");const q=utils$2.randomPrivateKey();return{pubkey:await getPublicKey(q),secret:q}}static sign(q,_){return logger$7.debug("sign"),typeof _=="string"&&(_=stringToBytes(_)),sign(_,q.secret)}static async verify(q,_,M){logger$7.debug("verify");try{return typeof M=="string"&&(M=stringToBytes(M)),await verify(_,M,q)}catch{return!1}}};function microsecondNow(){return Date.now()*1e3}function sleep(q){return new Promise(_=>{setTimeout_1(_,q)})}function randomId(){return""+Math.floor(Math.random()*1e3)+Math.floor(Math.random()*1e3)}function decodeKeypairToBytes(q){try{const _=isAuthorKeypair(q)?q.address:q.shareAddress,M=parseAuthorOrShareAddress(_);if(isErr(M))return M;const $={pubkey:base32StringToBytes(M.pubkey),secret:base32StringToBytes(q.secret)};return $.pubkey.length!==32?new ValidationError(`pubkey bytes should be 32 bytes long, not ${$.pubkey.length} after base32 decoding.  ${_}`):$.secret.length!==32?new ValidationError(`secret bytes should be 32 bytes long, not ${$.secret.length} after base32 decoding.  ${q.secret}`):$}catch(_){return new ValidationError("crash while decoding author keypair: "+_.message)}}function isAuthorKeypair(q){return"address"in q}new Logger("crypto","cyan");let GlobalCryptoDriver=CryptoDriverNoble,logger$6=new Logger("crypto","cyan");const Crypto=class{static async sha256base32(q){const _=await GlobalCryptoDriver.sha256(q);return base32BytesToString(_)}static updatableSha256(){return GlobalCryptoDriver.updatableSha256()}static async generateAuthorKeypair(q){logger$6.debug(`generateAuthorKeypair("${q}")`);const _=await GlobalCryptoDriver.generateKeypairBytes(),M={address:assembleAuthorAddress(q,base32BytesToString(_.pubkey)),secret:base32BytesToString(_.secret)},$=checkAuthorIsValid(M.address);return isErr($)?$:M}static async generateShareKeypair(q){logger$6.debug(`generateAuthorKeypair("${q}")`);const _=await GlobalCryptoDriver.generateKeypairBytes(),M={shareAddress:assembleShareAddress(q,base32BytesToString(_.pubkey)),secret:base32BytesToString(_.secret)},$=checkShareIsValid(M.shareAddress);return isErr($)?$:M}static async sign(q,_){logger$6.debug("sign");try{const M=decodeKeypairToBytes(q);if(isErr(M))return M;const $=await GlobalCryptoDriver.sign(M,_);return base32BytesToString($)}catch(M){return new ValidationError("unexpected error while signing: "+M.message)}}static verify(q,_,M){logger$6.debug("verify");try{const $=parseAuthorOrShareAddress(q);return isErr($)?Promise.resolve(!1):GlobalCryptoDriver.verify(base32StringToBytes($.pubkey),base32StringToBytes(_),M)}catch{return Promise.resolve(!1)}}static async checkKeypairIsValid(q){logger$6.debug("checkAuthorKeypairIsValid");const _=isAuthorKeypair(q)?q.address:q.shareAddress;try{if(typeof _!="string"||typeof q.secret!="string")return new ValidationError("address and secret must be strings");const M=parseAuthorOrShareAddress(_);if(isErr(M))return M;const $="a test message to sign. "+randomId(),j=await this.sign(q,$);return isErr(j)?j:await this.verify(_,j,$)===!1?new ValidationError("pubkey does not match secret"):!0}catch(M){return new ValidationError("unexpected error in checkAuthorKeypairIsValid: "+M.message)}}};var __setFunctionName$1=globalThis&&globalThis.__setFunctionName||function(q,_,M){return typeof _=="symbol"&&(_=_.description?"[".concat(_.description,"]"):""),Object.defineProperty(q,"name",{configurable:!0,value:M?"".concat(M," ",_):_})},_a$1;new Logger("validator es.4","red");const FUTURE_CUTOFF_MINUTES$1=10,FUTURE_CUTOFF_MICROSECONDS$1=FUTURE_CUTOFF_MINUTES$1*60*1e3*1e3,MIN_TIMESTAMP$1=1e13,MAX_TIMESTAMP$1=9007199254740990,MAX_CONTENT_LENGTH=4e6,HASH_STR_LEN$1=53,SIG_STR_LEN$1=104,ES4_CORE_SCHEMA={objSchema:{format:checkLiteral("es.4"),author:checkString({allowedChars:authorAddressChars}),content:checkString({maxLen:MAX_CONTENT_LENGTH}),contentHash:checkString({allowedChars:b32chars,len:HASH_STR_LEN$1}),deleteAfter:checkInt({min:MIN_TIMESTAMP$1,max:MAX_TIMESTAMP$1,nullable:!0}),path:checkString({allowedChars:pathChars,minLen:2,maxLen:512}),signature:checkString({allowedChars:b32chars,len:SIG_STR_LEN$1}),timestamp:checkInt({min:MIN_TIMESTAMP$1,max:MAX_TIMESTAMP$1}),workspace:checkString({allowedChars:workspaceAddressChars})},allowLiteralUndefined:!1,allowExtraKeys:!1};_a$1=class{static hashDocument(q){const _={...q,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},M=this._checkBasicDocumentValidity(_);return isErr(M)?Promise.resolve(M):Crypto.sha256base32(`author	${q.author}
contentHash	${q.contentHash}
`+(q.deleteAfter===null?"":`deleteAfter	${q.deleteAfter}
`)+`format	${q.format}
path	${q.path}
timestamp	${q.timestamp}
workspace	${q.workspace}
`)}static async generateDocument({input:q,keypair:_,share:M,timestamp:$}){const j={format:"es.4",author:_.address,content:q.content,contentHash:await Crypto.sha256base32(q.content),deleteAfter:q.deleteAfter??null,path:q.path,timestamp:$,workspace:M,signature:"?"},z=await this.signDocument(_,j);return isErr(z)?z:{doc:z}}static async signDocument(q,_){const M=await this.hashDocument(_);if(isErr(M))return M;const $=await Crypto.sign(q,M);return isErr($)?$:{..._,signature:$}}static async wipeDocument(q,_){if(_.content.length===0)return _;const M=this.removeExtraFields(_);if(isErr(M))return M;const j={...M.doc,content:"",contentHash:await Crypto.sha256base32(""),signature:"?"};return this.signDocument(q,j)}static removeExtraFields(q){if(!isPlainObject(q))return new ValidationError("doc is not a plain javascript object");const _=new Set(Object.keys(ES4_CORE_SCHEMA.objSchema||{})),M={},$={};for(const[j,z]of Object.entries(q))if(_.has(j))M[j]=z;else{if(!j.startsWith("_"))return new ValidationError("extra document fields must have names starting with an underscore");$[j]=z}return{doc:M,extras:$}}static async checkDocumentIsValid(q,_){_===void 0&&(_=Date.now()*1e3);const M=this._checkBasicDocumentValidity(q);if(isErr(M))return M;const $=this._checkTimestampIsOk(q.timestamp,q.deleteAfter,_);if(isErr($))return $;const j=this._checkAuthorCanWriteToPath(q.author,q.path);if(isErr(j))return j;const z=this._checkPathIsValid(q.path,q.deleteAfter);if(isErr(z))return z;const V=checkAuthorIsValid(q.author);if(isErr(V))return V;const X=checkShareIsValid(q.workspace);if(isErr(X))return X;const G=await this._checkAuthorSignatureIsValid(q);if(isErr(G))return G;const Y=await this._checkContentMatchesHash(q.content,q.contentHash);return isErr(Y)?Y:!0}static _checkBasicDocumentValidity(q){const _=checkObj(ES4_CORE_SCHEMA)(q);return _!==null?new ValidationError(_):!0}static _checkAuthorCanWriteToPath(q,_){return _.indexOf("~")===-1||_.indexOf("~"+q)!==-1?!0:new ValidationError(`author ${q} can't write to path ${_}`)}static _checkTimestampIsOk(q,_,M){if(q>M+FUTURE_CUTOFF_MICROSECONDS$1)return new ValidationError("timestamp too far in the future");if(_!==null){if(M>_)return new ValidationError("ephemeral doc has expired");if(_<=q)return new ValidationError("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(q,_){if(!q.startsWith("/"))return new ValidationError("invalid path: must start with /");if(q.endsWith("/"))return new ValidationError("invalid path: must not end with /");if(q.startsWith("/@"))return new ValidationError('invalid path: must not start with "/@"');if(q.indexOf("//")!==-1)return new ValidationError("invalid path: must not contain two consecutive slashes");if(_!==void 0){if(q.indexOf("!")===-1&&_!==null)return new ValidationError("when deleteAfter is set, path must contain '!'");if(q.indexOf("!")!==-1&&_===null)return new ValidationError("when deleteAfter is null, path must not contain '!'")}return!0}static async _checkAuthorSignatureIsValid(q){try{const _=await this.hashDocument(q);return isErr(_)?_:await Crypto.verify(q.author,q.signature,_)!==!0?new ValidationError("signature is invalid"):!0}catch{return new ValidationError("signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(q,_){return await Crypto.sha256base32(q)!==_?new ValidationError("content does not match contentHash"):!0}static getAttachmentInfo(q){return new ValidationError("es.4 does not support attachments")}static updateAttachmentFields(q,_,M,$){return Promise.resolve(new ValidationError("es.4 does not support attachments"))}static authorFromCredentials(q){return q.address}},__setFunctionName$1(_a$1,"FormatEs4"),Object.defineProperty(_a$1,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.4"});var __setFunctionName=globalThis&&globalThis.__setFunctionName||function(q,_,M){return typeof _=="symbol"&&(_=_.description?"[".concat(_.description,"]"):""),Object.defineProperty(q,"name",{configurable:!0,value:M?"".concat(M," ",_):_})},_a;new Logger("validator es.5","red");const FUTURE_CUTOFF_MINUTES=10,FUTURE_CUTOFF_MICROSECONDS=FUTURE_CUTOFF_MINUTES*60*1e3*1e3,MIN_TIMESTAMP=1e13,MAX_TIMESTAMP=9007199254740990,MAX_TEXT_LENGTH=8e3,HASH_STR_LEN=53,SIG_STR_LEN=104,MIN_BLOB_SIZE=0,MAX_BLOB_SIZE=Number.MAX_SAFE_INTEGER,ES5_CORE_SCHEMA={objSchema:{format:checkLiteral("es.5"),author:checkString({allowedChars:authorAddressChars}),text:checkString({maxLen:MAX_TEXT_LENGTH}),textHash:checkString({allowedChars:b32chars,len:HASH_STR_LEN}),deleteAfter:checkInt({min:MIN_TIMESTAMP,max:MAX_TIMESTAMP,optional:!0}),path:checkString({allowedChars:pathChars,minLen:2,maxLen:512}),signature:checkString({allowedChars:b32chars,len:SIG_STR_LEN}),shareSignature:checkString({allowedChars:b32chars,len:SIG_STR_LEN}),timestamp:checkInt({min:MIN_TIMESTAMP,max:MAX_TIMESTAMP}),share:checkString({allowedChars:workspaceAddressChars}),attachmentSize:checkInt({min:MIN_BLOB_SIZE,max:MAX_BLOB_SIZE,optional:!0}),attachmentHash:checkString({allowedChars:b32chars,len:HASH_STR_LEN,optional:!0})},allowLiteralUndefined:!1,allowExtraKeys:!1},FormatEs5=(_a=class{static hashDocument(q){const _={...q,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",shareSignature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},M=this._checkBasicDocumentValidity(_);return isErr(M)?Promise.resolve(M):Crypto.sha256base32((q.attachmentHash===void 0?"":`attachmentHash	${q.attachmentHash}
`)+(q.attachmentSize===void 0?"":`attachmentSize	${q.attachmentSize}
`)+`author	${q.author}
`+(q.deleteAfter===void 0?"":`deleteAfter	${q.deleteAfter}
`)+`format	${q.format}
path	${q.path}
textHash	${q.textHash}
timestamp	${q.timestamp}
share	${q.share}
`)}static async generateDocument({input:q,keypair:_,share:M,timestamp:$,prevLatestDoc:j,config:z}){if(q.text===void 0&&(j==null?void 0:j.text)===void 0)return new ValidationError("Couldn't determine document text from given input or previous version's text.");const V=q.text!==void 0?q.text:j==null?void 0:j.text,X={...j,format:"es.5",author:_.address,text:V,textHash:await Crypto.sha256base32(V),path:q.path,timestamp:$,share:M,signature:"?",shareSignature:"?"};q.deleteAfter&&(X.deleteAfter=q.deleteAfter);const G=await this.signDocument(_,X,z);return isErr(G)?G:q.attachment?{doc:G,attachment:q.attachment}:{doc:G}}static async signDocument(q,_,M){const $=await this.hashDocument(_);if(isErr($))return $;const j=await Crypto.sign(q,$);if(M.shareSecret===void 0)return new EarthstarError(`Tried to write a document to ${_.share} without the secret.`);const z=await Crypto.sign({shareAddress:_.share,secret:M.shareSecret},$);return isErr(j)?j:isErr(z)?z:{..._,signature:j,shareSignature:z}}static async wipeDocument(q,_,M){if(_.text.length===0)return _;const $=this.removeExtraFields(_);if(isErr($))return $;const j=$.doc;if(j.attachmentHash){const V={...j,text:"",textHash:await Crypto.sha256base32(""),signature:"?",shareSignature:"?",attachmentHash:await Crypto.sha256base32(""),attachmentSize:0};return this.signDocument(q,V,M)}const z={...j,text:"",textHash:await Crypto.sha256base32(""),signature:"?",shareSignature:"?"};return this.signDocument(q,z,M)}static removeExtraFields(q){if(!isPlainObject(q))return new ValidationError("doc is not a plain javascript object");const _=new Set(Object.keys(ES5_CORE_SCHEMA.objSchema||{})),M={},$={};for(const[j,z]of Object.entries(q))if(_.has(j))M[j]=z;else{if(!j.startsWith("_"))return new ValidationError("extra document fields must have names starting with an underscore");$[j]=z}return{doc:M,extras:$}}static async checkDocumentIsValid(q,_){_===void 0&&(_=Date.now()*1e3);const M=this._checkBasicDocumentValidity(q);if(isErr(M))return M;const $=this._checkTimestampIsOk(q.timestamp,q.deleteAfter?q.deleteAfter:null,_);if(isErr($))return $;const j=this._checkAuthorCanWriteToPath(q.author,q.path);if(isErr(j))return j;const z=this._checkAttachmentFieldsConsistent(q);if(isErr(z))return z;const V=this._checkPathIsValid(q.path,!!q.attachmentHash,q.deleteAfter);if(isErr(V))return V;const X=checkAuthorIsValid(q.author);if(isErr(X))return X;const G=checkShareIsValid(q.share);if(isErr(G))return G;const Y=await this._checkAuthorSignatureIsValid(q);if(isErr(Y))return Y;const Q=await this._checkShareSignatureIsValid(q);if(isErr(Q))return Q;const Z=await this._checkContentMatchesHash(q.text,q.textHash);return isErr(Z)?Z:!0}static _checkBasicDocumentValidity(q){const _=checkObj(ES5_CORE_SCHEMA)(q);return _!==null?new ValidationError(_):!0}static _checkAttachmentFieldsConsistent(q){return q.text.length===0&&q.attachmentSize&&q.attachmentSize>0?new ValidationError("Documents with attachments must have text."):(q.text.length>0&&q.attachmentSize&&q.attachmentSize,q.attachmentHash&&q.attachmentSize===void 0?new ValidationError("Attachment size is undefined while attachment hash is defined"):q.attachmentSize&&q.attachmentHash===void 0?new ValidationError("Attachment hash is undefined while attachment size is defined"):!0)}static _checkAuthorCanWriteToPath(q,_){return _.indexOf("~")===-1||_.indexOf("~"+q)!==-1?!0:new ValidationError(`author ${q} can't write to path ${_}`)}static _checkTimestampIsOk(q,_,M){if(q>M+FUTURE_CUTOFF_MICROSECONDS)return new ValidationError("timestamp too far in the future");if(_!==null){if(M>_)return new ValidationError("ephemeral doc has expired");if(_<=q)return new ValidationError("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(q,_,M){if(!q.startsWith("/"))return new ValidationError("invalid path: must start with /");if(q.endsWith("/"))return new ValidationError("invalid path: must not end with /");if(q.startsWith("/@"))return new ValidationError('invalid path: must not start with "/@"');if(q.indexOf("//")!==-1)return new ValidationError("invalid path: must not contain two consecutive slashes");if(M!==void 0){if(q.indexOf("!")===-1&&M!==null)return new ValidationError("when deleteAfter is set, path must contain '!'");if(q.indexOf("!")!==-1&&M===null)return new ValidationError("when deleteAfter is null, path must not contain '!'")}return!pathHasFileExtension(q)&&_?new ValidationError("when a attachment is provided, the path must end with a file extension"):pathHasFileExtension(q)&&_===!1?new ValidationError("when no attachment is provided, the path cannot end with a file extension"):!0}static async _checkAuthorSignatureIsValid(q){try{const _=await this.hashDocument(q);return isErr(_)?_:await Crypto.verify(q.author,q.signature,_)!==!0?new ValidationError("signature is invalid"):!0}catch{return new ValidationError("signature is invalid (unexpected exception)")}}static async _checkShareSignatureIsValid(q){try{const _=await this.hashDocument(q);return isErr(_)?_:await Crypto.verify(q.share,q.shareSignature,_)!==!0?new ValidationError("share signature is invalid"):!0}catch{return new ValidationError("share signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(q,_){return await Crypto.sha256base32(q)!==_?new ValidationError("content does not match contentHash"):!0}static getAttachmentInfo(q){return q.attachmentHash&&q.attachmentSize===0?new ValidationError("This document has had its attachment wiped"):!q.attachmentHash||!q.attachmentSize?new ValidationError("This document has no attachment."):{size:q.attachmentSize,hash:q.attachmentHash}}static updateAttachmentFields(q,_,M,$,j){const z={..._,attachmentHash:$,attachmentSize:M};return this.signDocument(q,z,j)}static authorFromCredentials(q){return q.address}},__setFunctionName(_a,"FormatEs5"),Object.defineProperty(_a,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.5"}),_a),fileExtensionRegex=/^.*\.(\w+)$/,endingWithKeypairAddrRegex=/^.*~@\w{4}\.\w{53}$/;function pathHasFileExtension(q){if(q.indexOf(".")===-1)return!1;const _=q.match(fileExtensionRegex);return!(_===null||_[1].length===53&&q.match(endingWithKeypairAddrRegex))}const DEFAULT_FORMAT=FormatEs5,DEFAULT_FORMATS=[DEFAULT_FORMAT];function getFormatWithFallback(q){return q||DEFAULT_FORMAT}function getFormatsWithFallback(q){return q||DEFAULT_FORMATS}function getFormatIntersection(q,_){const M=[];for(const $ of _)q.includes($.id)&&M.push($);return M}function getFormatLookup(q){const _=q||DEFAULT_FORMATS,M={};for(const $ of _)M[$.id]=$;return M}class MultiDeferred{constructor(){Object.defineProperty(this,"deferreds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"pending"})}resolve(_){if(this.state==="pending"){this.state="fulfilled";for(const M of this.deferreds)M.resolve(_)}}reject(_){if(this.state==="pending"){this.state="rejected";for(const M of this.deferreds)M.reject(_)}}getPromise(){const _=deferred();return this.state==="fulfilled"?_.resolve():this.state==="rejected"?_.reject():this.deferreds.add(_),_}}class PromiseEnroller{constructor(_=!1){Object.defineProperty(this,"promises",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"sealed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"multiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new MultiDeferred}),Object.defineProperty(this,"allowRejectedPromises",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.allowRejectedPromises=_}enrol(_){if(this.sealed)throw new EarthstarError("Tried to enrol a promise when enrolment was already sealed.");this.promises.add(_),_.then(()=>{this.checkAllDone()}).catch(M=>{if(!this.allowRejectedPromises)throw M})}checkAllDone(){this.sealed&&(this.allowRejectedPromises?Promise.allSettled(this.promises).then(()=>{this.multiDeferred.resolve()}):Promise.all(this.promises).then(()=>{this.multiDeferred.resolve()}).catch(()=>{this.multiDeferred.reject()}))}seal(){this.sealed||(this.sealed=!0,this.checkAllDone())}isSealed(){return this.sealed}isDone(){return this.multiDeferred.getPromise()}}class CombineStream{constructor(){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"transform",{enumerable:!0,configurable:!0,writable:!0,value:new TransformStream({transform(_,M){M.enqueue(_)}})}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:this.transform.writable.getWriter()}),Object.defineProperty(this,"readable",{enumerable:!0,configurable:!0,writable:!0,value:this.transform.readable}),Object.defineProperty(this,"writables",{enumerable:!0,configurable:!0,writable:!0,value:[]})}checkClosed(){if(this.closed)throw"Closed"}getWritableStream(){this.checkClosed();const _=this.writer,M=new WritableStream({async write($){await _.ready,await _.write($)}});return this.writables.push(M),M}async close(){this.checkClosed();for(const _ of this.writables)await _.abort();this.transform.writable.abort(),this.closed=!0}isClosed(){return this.closed}}class CloneStream{constructor(){Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:new TransformStream(new PassThroughTransformer)}),Object.defineProperty(this,"sourceReadable",{enumerable:!0,configurable:!0,writable:!0,value:this.transformStream.readable}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:this.transformStream.writable})}getReadableStream(){const[_,M]=this.sourceReadable.tee();return this.sourceReadable=_,M}}class CloneMidStream{checkClosed(){if(this.closed)throw"Closed"}constructor(){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"subscribers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"writables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const _=this.subscribers;this.writable=new WritableStream({write(M){const $=_.map(({writer:j})=>new Promise(z=>{j.ready.then(()=>{j.write(M).then(z)})}));Promise.all($)}})}getReadableStream(){this.checkClosed();const _=new TransformStream({transform(M,$){$.enqueue(M)}});return this.subscribers.push({transform:_,writer:_.writable.getWriter()}),_.readable}async close(){this.checkClosed();for(const _ of this.writables)await _.abort();for(const{transform:_}of this.subscribers)await _.writable.abort(),await _.readable.cancel();this.closed=!0}isClosed(){return this.closed}}class MultiStream{checkClosed(){if(this.closed)throw"Closed"}constructor(_){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineStream",{enumerable:!0,configurable:!0,writable:!0,value:new CombineStream}),Object.defineProperty(this,"cloneStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),_?this.cloneStream=new CloneMidStream:this.cloneStream=new CloneStream,this.combineStream.readable.pipeTo(this.cloneStream.writable)}getWritableStream(){return this.combineStream.getWritableStream()}getReadableStream(){return this.cloneStream.getReadableStream()}close(){this.checkClosed(),this.combineStream.close(),this.closed=!0}isClosed(){return this.closed}}class CallbackSink{constructor(){Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set})}onWrite(_){return this.callbacks.add(_),()=>{this.callbacks.delete(_)}}async write(_){for(const M of this.callbacks)await M(_)}close(){this.callbacks.clear()}}class BlockingBus{constructor(){Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"lock",{enumerable:!0,configurable:!0,writable:!0,value:new LockStream})}on(_){return this.callbacks.add(_),()=>{this.callbacks.delete(_)}}async send(_){for(const M of this.callbacks)await this.lock.run(()=>M(_))}}class PassThroughTransformer{transform(_,M){M.enqueue(_)}}class LockStream{constructor(){Object.defineProperty(this,"doneEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new PromiseEnroller}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:new WritableStream({async write(_){await _()}})}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:this.writable.getWriter()}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1})}checkClosed(){if(this.closed)throw"Closed"}async run(_){this.checkClosed(),await this.writer.ready;const M=this.writer.write(_);return this.doneEnroller.enrol(M),M}async close(){this.checkClosed(),this.doneEnroller.seal(),await this.doneEnroller.isDone(),this.writer.releaseLock(),await this.writable.abort(),this.closed=!0}isClosed(){return this.closed}}class ChannelTransformer{constructor(_,M){Object.defineProperty(this,"channel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.channel=_,this.channelKey=M}transform(_,M){if(this.channel==="*"||this.channel===_[this.channelKey]){M.enqueue(_);return}}}class ChannelMultiStream{constructor(_,M){Object.defineProperty(this,"multistream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.multistream=new MultiStream(M),this.channelKey=_}getWritableStream(){return this.multistream.getWritableStream()}getReadableStream(_){const M=new TransformStream(new ChannelTransformer(_,this.channelKey));return this.multistream.getReadableStream().pipeThrough(M)}}function websocketWritable(q,_){const M=deferred(),$=deferred(),j=()=>{if($.state==="pending"){let z;q instanceof WebSocket$1?z=q:z=new WebSocket$1(q),$.resolve(z),z.binaryType="arraybuffer",z.readyState===z.OPEN&&M.resolve(),z.onopen=()=>{M.resolve()}}};return new WritableStream({async write(z,V){j();const X=await $;await M;try{const G=_(z);X.send(G)}catch(G){V.error(G)}X.onclose=()=>{V.error("Socket closed before we were done")}},async close(){j();const z=await $;await M,z.close()},async abort(){j();const z=await $;await M,z.close()}})}function websocketReadable(q,_){const M=deferred();let $=!1;const j=()=>{if(M.state==="pending")if(q instanceof WebSocket$1)M.resolve(q);else try{const z=new WebSocket$1(q);M.resolve(z)}catch(z){M.reject(z)}};return new ReadableStream$1({async start(z){j();const V=await M;V.binaryType="arraybuffer",V.onmessage=X=>{const G=_(X);try{z.enqueue(G)}catch{}},V.onclose=()=>{if(!$)try{z.close()}catch{}},V.onerror=X=>{$=!0,z.error(X)}},async cancel(){j(),(await M).close()}})}function bigIntToHex(q){let M=q.toString(16);return M.length%2&&(M="0"+M),M}function bigIntFromHex(q){return BigInt("0x"+q)}const TYPE_MAPPINGS={EMPTY_SET:"emptySet",LOWER_BOUND:"lowerBound",PAYLOAD:"payload",EMPTY_PAYLOAD:"emptyPayload",DONE:"done",FINGERPRINT:"fingerprint",TERMINAL:"terminal"},encoding={encode:{emptySet:q=>({type:"EMPTY_SET",canRespond:q}),lowerBound:q=>({type:"LOWER_BOUND",value:q}),payload:(q,_)=>({type:"PAYLOAD",payload:q,..._?{end:_}:{}}),emptyPayload:q=>({type:"EMPTY_PAYLOAD",upperBound:q}),done:q=>({type:"DONE",upperBound:q}),fingerprint:(q,_)=>({type:"FINGERPRINT",fingerprint:bigIntToHex(q),upperBound:_}),terminal:()=>({type:"TERMINAL"})},decode:{getType:q=>TYPE_MAPPINGS[q.type],emptySet:q=>{if(q.type==="EMPTY_SET")return q.canRespond;throw"Can't decode"},lowerBound:q=>{if(q.type==="LOWER_BOUND")return q.value;throw"Can't decode"},payload:q=>{if(q.type==="PAYLOAD")return{value:q.payload,...q.end?{end:q.end}:{}};throw"Can't decode"},emptyPayload:q=>{if(q.type==="EMPTY_PAYLOAD")return q.upperBound;throw"Can't decode"},done:q=>{if(q.type==="DONE")return q.upperBound;throw"Can't decode"},fingerprint:q=>{if(q.type==="FINGERPRINT")return{fingerprint:bigIntFromHex(q.fingerprint),upperBound:q.upperBound};throw"Can't decode"},terminal:q=>{if(q.type==="TERMINAL")return!0;throw"Can't decode"}}};class EarthstarRangeMessenger extends RangeMessenger{constructor(_,M,$){super({tree:_,encoding,fingerprintEquals:(j,z)=>j===z,payloadThreshold:M,rangeDivision:$})}}class SyncAgent{sendEvent(_){return this.inboundEventQueue.push(_)}events(){return this.outboundEventQueue}getStatus(){return{requestedCount:this.requestedCount,receivedCount:this.receivedDocsCount,sentCount:this.sentDocsCount,status:this.isDoneMultiDeferred.state==="rejected"?"aborted":this.hasPrepared.state==="pending"?"preparing":this.hasReconciled.state==="pending"?"reconciling":this.isDoneMultiDeferred.state==="fulfilled"?"done":"gossiping"}}constructor(_){Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"isDoneMultiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new MultiDeferred}),Object.defineProperty(this,"inboundEventQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"outboundEventQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"gossiperInboundQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"reconcilerInboundQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"hasPrepared",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"hasReconciled",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"hasCheckedAllExistingDocsForAttachments",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"requestedCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sentDocsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"receivedDocsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"counterpartId",{enumerable:!0,configurable:!0,writable:!0,value:randomId()}),Object.defineProperty(this,"replica",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.replica=_.replica,_.replica.onEvent(V=>{V.kind==="willClose"&&this.cancel()});const{treeIsReady:M}=_.syncerManager.getDocThumbnailTreeAndDocLookup(_.replica.share,getFormatsWithFallback(_.formats));M.then(()=>{this.hasPrepared.resolve()}),(async()=>{for await(const V of this.inboundEventQueue)switch(V.kind){case"RANGE_MSG":{this.reconcilerInboundQueue.push(V.message);break}default:this.gossiperInboundQueue.push(V)}})(),new ExistingDocAttachmentChecker({outboundEventQueue:this.outboundEventQueue,formats:_.formats,replica:_.replica,counterpartId:this.counterpartId,transferManager:_.transferManager,hasCheckedAllExistingDocsForAttachments:this.hasCheckedAllExistingDocsForAttachments});const $=new WantTracker,j=new SyncAgentReconciler({inboundEventQueue:this.reconcilerInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:_.syncerManager,formats:_.formats,replica:_.replica,initiateMessaging:_.initiateMessaging,wantTracker:$,payloadThreshold:_.payloadThreshold,rangeDivision:_.rangeDivision,onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}});j.isDone.then(()=>{this.hasReconciled.resolve()}),new SyncAgentGossiper({inboundEventQueue:this.gossiperInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:_.syncerManager,formats:_.formats,replica:_.replica,counterpartId:this.counterpartId,transferManager:_.transferManager,cancel:this.cancel.bind(this),reconciliationIsDone:j.isDone,wantTracker:$,syncAppetite:_.syncAppetite,onDocReceived:async()=>{this.receivedDocsCount++,await this.statusBus.send(this.getStatus())},onDocSent:async()=>{this.sentDocsCount++,await this.statusBus.send(this.getStatus())},onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}}).isDone.then(async()=>{await this.hasCheckedAllExistingDocsForAttachments,this.isDoneMultiDeferred.resolve()}),this.statusBus.send(this.getStatus())}onStatusUpdate(_){return this.statusBus.on(_)}async cancel(_){this.isDoneMultiDeferred.state==="fulfilled"||this.isDoneMultiDeferred.state==="rejected"||(this.isDoneMultiDeferred.reject(_||"Cancelled"),await this.statusBus.send(this.getStatus()),this.outboundEventQueue.push({kind:"ABORT"}),this.outboundEventQueue.close(),this.inboundEventQueue.close({immediately:!0}),this.gossiperInboundQueue.close({immediately:!0}),this.reconcilerInboundQueue.close({immediately:!0}))}isDone(){return this.isDoneMultiDeferred.getPromise()}}class SyncAgentGossiper{constructor(_){Object.defineProperty(this,"isPartnerFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"isFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:deferred()});const M=getFormatLookup(_.formats),$=_.syncerManager.getPlumTree(_.replica.share);if(_.syncAppetite==="continuous"){const V=_.replica.getQueryStream(void 0,"new",_.formats),X=new XXH64;V.pipeTo(new WritableStream({async write(G){if(G.kind==="success"&&G.sourceId!==_.counterpartId){const Y=$.getMode(G.sourceId);X.reset(),X.update(`${G.doc.path} ${G.doc.author}`);const Q=X.digest().toString(16),Z=`${G.doc.timestamp} ${Q}`;if(Y==="EAGER"){const te=M[G.doc.format],ee=te.getAttachmentInfo(G.doc),ne=!isErr(ee);let re=!1;ne&&await _.replica.getAttachment(G.doc,te)&&(re=!0),_.outboundEventQueue.push({kind:"DOC",thumbnail:Z,doc:G.doc,attachmentHeld:re}),_.onDocSent()}else _.outboundEventQueue.push({kind:"HAVE",thumbnail:Z})}}})).catch(()=>{})}const j=_.replica.onEvent(V=>{V.kind==="attachment_ingest"&&V.sourceId!==_.counterpartId&&_.outboundEventQueue.push({kind:"NEW_ATTACHMENT",path:V.doc.path,author:V.doc.author,format:V.doc.format,hash:V.hash})}),{lookup:z}=_.syncerManager.getDocThumbnailTreeAndDocLookup(_.replica.share,getFormatsWithFallback(_.formats));(async()=>{for await(const V of _.inboundEventQueue)switch(V.kind){case"PRUNE":{$.onPrune(_.counterpartId);break}case"HAVE":{if(_.reconciliationIsDone.state==="fulfilled"&&_.syncAppetite==="once")break;_.wantTracker.addWantedThumbnail(V.thumbnail),$.onLazyMessage(V,X=>{_.outboundEventQueue.push({kind:"WANT",thumbnail:X})}),_.onDocRequested();break}case"WANT":{$.onGraftMessage(_.counterpartId);const[,X]=V.thumbnail.split(" "),G=z[X];if(!G)return;const[,Y,Q]=G,te=(await _.replica.getAllDocsAtPath(Y,_.formats)).find(ee=>ee.author===Q);if(te){const ee=M[te.format],ne=ee.getAttachmentInfo(te),re=!isErr(ne);let se=!1;re&&await _.replica.getAttachment(te,ee)&&(se=!0),_.outboundEventQueue.push({kind:"DOC",thumbnail:V.thumbnail,doc:te,attachmentHeld:se}),await _.onDocSent()}else console.error("Got a WANT event for a document not on record.");break}case"DOC":{if(this.isFulfilled.state==="fulfilled"&&_.syncAppetite==="once"||($.onEagerMessage(_.counterpartId,V)&&_.outboundEventQueue.push({kind:"PRUNE"}),_.wantTracker.isReceived(V.thumbnail)))break;const G=M[V.doc.format];if(!G){console.error(`Was sent a doc with a format we don't know about (${V.doc.format})`);break}if(V.attachmentHeld&&await _.replica.getAttachment(V.doc,M[V.doc.format])===void 0){const Q=await _.transferManager.handleDownload(V.doc,_.replica,_.counterpartId);if(isErr(Q)){const Z=G.getAttachmentInfo(V.doc);_.transferManager.registerExpectedTransfer(_.replica.share,Z.hash),_.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:Z.hash,doc:V.doc,shareAddress:_.replica.share})}}await _.replica.ingest(G,V.doc,_.counterpartId),_.wantTracker.receivedWantedThumbnail(V.thumbnail),await _.onDocReceived();break}case"NEW_ATTACHMENT":{if(_.transferManager.isAlreadyQueued(V.hash,"download"))break;const X=M[V.format],Y=(await _.replica.getAllDocsAtPath(V.path,[X])).find(Z=>V.author===Z.author);if(!Y)break;if(await _.replica.getAttachment(Y,M[Y.format])===void 0){const Z=await _.transferManager.handleDownload(Y,_.replica,_.counterpartId);if(isErr(Z)){const te=X.getAttachmentInfo(Y);_.transferManager.registerExpectedTransfer(_.replica.share,te.hash),_.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:te.hash,doc:Y,shareAddress:_.replica.share})}}break}case"FULFILLED":this.isPartnerFulfilled.resolve(!0);break;case"WANT_ATTACHMENT":_.transferManager.handleUpload(V,_.replica);break;case"ABORT":await _.cancel()}})(),_.reconciliationIsDone.then(async()=>{_.syncAppetite==="once"&&(j(),_.wantTracker.seal(),await _.wantTracker.isDone(),_.outboundEventQueue.push({kind:"FULFILLED"}),this.isFulfilled.resolve())})}get isDone(){return Promise.all([this.isPartnerFulfilled,this.isFulfilled])}}class SyncAgentReconciler{constructor(_){Object.defineProperty(this,"communicationRoundsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isDone",{enumerable:!0,configurable:!0,writable:!0,value:deferred()});const{tree:M,lookup:$,treeIsReady:j}=_.syncerManager.getDocThumbnailTreeAndDocLookup(_.replica.share,getFormatsWithFallback(_.formats));_.initiateMessaging&&j.then(()=>{for(const V of z.initialMessages())_.outboundEventQueue.push({kind:"RANGE_MSG",message:V})});const z=new EarthstarRangeMessenger(M,_.payloadThreshold,_.rangeDivision);z.onInsertion(V=>{const[X,G]=V.split(" "),Y=$[G];Y&&Y[0]>=parseInt(X)||(_.wantTracker.addWantedThumbnail(V),_.outboundEventQueue.push({kind:"WANT",thumbnail:V}),_.onDocRequested())}),(async()=>{await j;for await(const V of _.inboundEventQueue){if(this.isDone.state==="fulfilled")return;V.type==="TERMINAL"&&this.communicationRoundsCount++;const X=z.respond(V);for(const G of X)_.outboundEventQueue.push({kind:"RANGE_MSG",message:G})}})(),z.isDone().then(()=>{this.isDone.resolve(this.communicationRoundsCount)})}}class ExistingDocAttachmentChecker{constructor(_){const M=_.replica.getQueryStream({orderBy:"localIndex ASC"},"existing",_.formats),$=getFormatLookup(_.formats),j=_.transferManager.handleDownload.bind(_.transferManager);M.pipeTo(new WritableStream({start(z){_.replica.onEvent(V=>{V.kind==="willClose"&&z.error()})},async write(z){if(z.kind==="existing"||z.kind==="success"){const V=$[z.doc.format],X=await _.replica.getAttachment(z.doc,V);if(isErr(X))return;if(X===void 0){const G=await j(z.doc,_.replica,_.counterpartId);if(isErr(G)){const Y=V.getAttachmentInfo(z.doc);_.transferManager.registerExpectedTransfer(_.replica.share,Y.hash),_.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:Y.hash,doc:z.doc,shareAddress:_.replica.share})}}}}})).then(()=>{_.hasCheckedAllExistingDocsForAttachments.resolve()}).catch(()=>{_.hasCheckedAllExistingDocsForAttachments.resolve()})}}class WantTracker{constructor(){Object.defineProperty(this,"isSealed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"wantedThumbnails",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"enroller",{enumerable:!0,configurable:!0,writable:!0,value:new PromiseEnroller}),Object.defineProperty(this,"received",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:randomId()})}addWantedThumbnail(_){if(!this.isSealed&&!this.wantedThumbnails.has(_)){const M=deferred();this.wantedThumbnails.set(_,M),this.enroller.enrol(M)}}receivedWantedThumbnail(_){const M=this.wantedThumbnails.get(_);M&&(M.resolve(),this.received++)}isRequested(_){return this.wantedThumbnails.has(_)}isReceived(_){const M=this.wantedThumbnails.get(_);return M?M.state==="fulfilled":!1}seal(){this.enroller.seal()}isDone(){return this.enroller.isDone()}get requestedCount(){return this.wantedThumbnails.size}get receivedCount(){return this.received}}class BumpingTimeout{constructor(_,M){Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.cb=_,this.ms=M,this.timeout=setTimeout_1(_,M)}bump(){this.closed||(clearTimeout(this.timeout),this.timeout=setTimeout_1(this.cb,this.ms))}close(){this.closed=!0,clearTimeout(this.timeout)}}const TIMEOUT_MS=1e4;class AttachmentTransfer{constructor({stream:_,replica:M,doc:$,format:j,requester:z,counterpartId:V}){Object.defineProperty(this,"kind",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:"ready"}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"expectedSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sourceDoc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"transferOp",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"abortCb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new MultiDeferred}),Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"requester",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.sourceDoc=$,this.share=M.share,this.requester=z;const X=j.getAttachmentInfo($);if(isErr(X))throw new ValidationError("AttachmentTransfer was given a doc which has no attachment!");this.hash=X.hash,this.expectedSize=X.size;const G=this.updateLoaded.bind(this);if(_ instanceof ReadableStream$1){this.kind="download";let Y;this.abortCb=()=>{Y?Y.cancel():_.cancel()};const Q=()=>this.loaded,Z=()=>new ReadableStream$1({async start(te){const ee=_.getReader();Y=ee;const ne=new BumpingTimeout(()=>{te.error("Attachment download timed out.")},TIMEOUT_MS);for(;;){const{done:re,value:se}=await ee.read();if(ne.bump(),re||(G(se.byteLength),te.enqueue(se),Q()>=X.size))break}ne.close(),te.close()}});this.transferOp.resolve(()=>{const te=deferred();return M.ingestAttachment(j,$,Z(),V).then(ee=>{if(isErr(ee)&&this.loaded===0){this.changeStatus("missing_attachment");return}if(isErr(ee)){console.warn(`Couldn't ingest the attachment for ${$.path} by ${$.author}: ${ee.message}`),te.reject(ee);return}te.resolve()}).catch(ee=>{console.log(ee),te.reject(ee)}),te})}else this.kind="upload",this.abortCb=()=>{_.abort().catch(()=>{})},M.getAttachment($,j).then(async Y=>{if(!Y){await this.changeStatus("missing_attachment"),await _.abort();return}if(isErr(Y)){await this.changeStatus("failed"),await _.abort();return}const Q=new TransformStream({transform(Z,te){G(Z.byteLength),te.enqueue(Z)}});this.transferOp.resolve(()=>Y.stream().then(Z=>Z.pipeThrough(Q).pipeTo(_)).catch(Z=>{console.log(Z)}))})}async start(){if(this.status!=="ready")return;const _=await this.transferOp;await this.changeStatus("in_progress"),_().then(async()=>{await this.changeStatus("complete")}).catch(async()=>{await this.changeStatus("failed")})}updateLoaded(_){this.loaded+=_,this.statusBus.send({status:this.status,bytesLoaded:this.loaded,totalBytes:this.expectedSize})}async changeStatus(_){this.status==="complete"||this.status==="failed"||this.status==="missing_attachment"||(this.status=_,await this.statusBus.send({status:_,bytesLoaded:this.loaded,totalBytes:this.expectedSize}),_==="complete"&&this.multiDeferred.resolve(),_==="failed"&&this.multiDeferred.reject("Attachment transfer failed"),_==="missing_attachment"&&this.multiDeferred.reject("The other peer does not have this attachment"))}get doc(){return this.sourceDoc}onProgress(_){return this.statusBus.on(_)}abort(){this.abortCb()}isDone(){return this.multiDeferred.getPromise()}}class TransferQueue{constructor(_){Object.defineProperty(this,"waiting",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"active",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"failed",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"completed",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"activeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transfersRequestedByUsEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new PromiseEnroller(!0)}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"reports",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"reportBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),this.activeLimit=_}async activate(_){this.active.add(_),_.isDone().then(()=>{this.completed.add(_)}).catch(()=>{this.failed.add(_)}).finally(()=>{this.active.delete(_),this.admitNext()}),await _.start()}queue(_){this.waiting.push(_)}admitNext(){if(this.waiting.length===0||this.active.size>=this.activeLimit)return;const _=this.waiting.shift();_&&this.activate(_)}async addTransfer(_){if(this.closed){_.abort();return}_.onProgress(()=>{this.updateTransferStatus(_)}),_.requester==="us"&&this.transfersRequestedByUsEnroller.enrol(_.isDone()),this.active.size<this.activeLimit?await this.activate(_):this.queue(_)}gotAllTransfersRequestedByUs(){this.transfersRequestedByUsEnroller.seal()}cancel(){this.closed=!0,this.transfersRequestedByUsEnroller.seal();for(const _ of this.active)_.abort()}updateTransferStatus(_){this.reports[_.share]||(this.reports[_.share]={}),this.reports[_.share][_.hash+_.kind]={author:_.doc.author,path:_.doc.path,format:_.doc.format,hash:_.hash,kind:_.kind,status:_.status,bytesLoaded:_.loaded,totalBytes:_.expectedSize},this.reportBus.send(this.getReport())}getReport(){const _={};for(const M in this.reports){const $=[],j=this.reports[M];for(const z in j){const V=j[z];$.push(V)}_[M]=$}return _}hasQueuedTransfer(_,M){for(const $ of this.waiting)if($.hash===_&&$.kind===M)return!0;for(const $ of this.active)if($.hash===_&&$.kind===M)return!0;for(const $ of this.completed)if($.hash===_&&$.kind===M)return!0;return!1}onReportUpdate(_){return this.reportBus.on(_)}transfersRequestedByUsFinished(){return this.transfersRequestedByUsEnroller.isDone()}}class TransferManager{constructor(_){Object.defineProperty(this,"partner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"otherSyncerId",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"receivedAllExpectedTransfersEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new PromiseEnroller}),Object.defineProperty(this,"madeAllAttachmentRequestsEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new PromiseEnroller(!0)}),Object.defineProperty(this,"formatsLookup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reportDidUpdateBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"expectedTransferPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.partner=_.partner,this.queue=new TransferQueue(this.partner.concurrentTransfers),this.formats=_.formats,this.formatsLookup=getFormatLookup(this.formats),this.queue.onReportUpdate(async M=>{await this.reportDidUpdateBus.send(M)}),this.madeAllAttachmentRequestsEnroller.isDone().then(()=>{this.receivedAllExpectedTransfersEnroller.seal()}),this.receivedAllExpectedTransfersEnroller.isDone().then(()=>{this.queue.gotAllTransfersRequestedByUs()})}registerSyncAgent(_){this.madeAllAttachmentRequestsEnroller.enrol(_.isDone())}allSyncAgentsKnown(){this.madeAllAttachmentRequestsEnroller.seal()}registerExpectedTransfer(_,M){const $=`${_}_${M}`;if(this.expectedTransferPromises.has($))return;const j=deferred();this.expectedTransferPromises.set($,j),this.receivedAllExpectedTransfersEnroller.enrol(j)}async queueTransfer(_){this.queue.hasQueuedTransfer(_.hash,_.kind)||await this.queue.addTransfer(_)}async handleDownload(_,M,$){const j=this.formatsLookup[_.format],z=j.getAttachmentInfo(_);if(isErr(z))throw new EarthstarError("TransferManager: attempted to download doc with no attachment.");if(this.queue.hasQueuedTransfer(z.hash,"download"))return"queued";const V=await this.partner.getDownload({doc:_,shareAddress:M.share,syncerId:await this.otherSyncerId,attachmentHash:z.hash});if(V===void 0)return"no_attachment";if(isErr(V))return V;const X=new AttachmentTransfer({replica:M,doc:_,format:j,stream:V,requester:"us",counterpartId:$});return await this.queueTransfer(X),"queued"}async handleUpload(_,M){if(this.queue.hasQueuedTransfer(_.attachmentHash,"upload"))return!1;const $=this.formatsLookup[_.doc.format];if(!await M.getAttachment(_.doc,$))return!1;const z=await this.partner.handleUploadRequest({shareAddress:_.shareAddress,syncerId:await this.otherSyncerId,doc:_.doc,attachmentHash:_.attachmentHash});if(isErr(z))return!1;try{const V=new AttachmentTransfer({doc:_.doc,format:$,replica:M,stream:z,requester:"them",counterpartId:"unused"});await this.queueTransfer(V)}catch{return!1}return!0}async handleTransferRequest({replica:_,path:M,author:$,source:j,kind:z,formatName:V,counterpartId:X}){const G=await this.partner.handleTransferRequest(j,z);if(G===void 0||isErr(G))return;const Y=getFormatLookup(this.formats)[V];if(!Y)return;const Z=(await _.getAllDocsAtPath(M,[Y])).find(ee=>ee.author===$);if(!Z)return;const te=new AttachmentTransfer({doc:Z,format:Y,replica:_,stream:G,requester:z==="upload"?"us":"them",counterpartId:X});if(te.requester==="us"){const ee=`${te.share}_${te.hash}`,ne=this.expectedTransferPromises.get(ee);ne&&ne.resolve()}await this.queueTransfer(te)}cancel(){this.queue.cancel()}getReport(){return this.queue.getReport()}onReportUpdate(_){return this.reportDidUpdateBus.on(_)}transfersRequestedByUsFinished(){return this.queue.transfersRequestedByUsFinished()}registerOtherSyncerId(_){this.otherSyncerId.resolve(_)}isAlreadyQueued(_,M){return this.queue.hasQueuedTransfer(_,M)}}class Syncer{constructor(_){Object.defineProperty(this,"peer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:randomId()}),Object.defineProperty(this,"manager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"syncAgents",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"syncAgentQueues",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"appetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"formats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transferManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partnerIsFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"isDoneMultiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new MultiDeferred}),Object.defineProperty(this,"heartbeatInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bumpingTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.manager=_.manager,this.peer=_.manager.peer,this.appetite=_.partner.syncAppetite,this.formats=getFormatsWithFallback(_.formats),this.partner=_.partner,this.transferManager=new TransferManager({partner:this.partner,formats:this.formats}),this.transferManager.onReportUpdate(async()=>{await this.statusBus.send(this.getStatus())}),this.heartbeatInterval=setInterval_1(()=>{this.partner.sendEvent({kind:"HEARTBEAT"})},1e3),(async()=>{try{for await(const $ of _.partner.getEvents())this.handleIncomingEvent($)}catch($){this.cancel($||"Partner disconnected")}})();const M=randomId();Promise.all(this.peer.shares().map($=>saltAndHashShare(M,$))).then($=>{this.partner.sendEvent({kind:"DISCLOSE",salt:M,syncerId:this.id,shares:$,formats:this.formats?this.formats.map(j=>j.id):[DEFAULT_FORMAT.id],canRespond:!1})}),this.transferManager.transfersRequestedByUsFinished().then(async()=>{_.partner.syncAppetite!=="continuous"&&(await this.partner.sendEvent({kind:"SYNCER_FULFILLED"}),await this.partnerIsFulfilled,clearInterval(this.heartbeatInterval),await this.partner.closeConnection(),this.bumpingTimeout.close(),this.isDoneMultiDeferred.resolve())}),this.peer.onReplicasChange(async $=>{if(this.appetite==="once")return;const j=Array.from($.keys());for(const[V,X]of this.syncAgents)j.includes(V)===!1&&(await X.cancel("Replica was removed from peer."),this.syncAgents.delete(V));const z=randomId();Promise.all(j.map(V=>saltAndHashShare(z,V))).then(V=>{this.partner.sendEvent({kind:"DISCLOSE",salt:z,syncerId:this.id,shares:V,formats:this.formats?this.formats.map(X=>X.id):[DEFAULT_FORMAT.id],canRespond:!0})})}),this.bumpingTimeout=new BumpingTimeout(()=>{this.cancel("No communication from the other peer in the last three seconds.")},TIMEOUT_MS)}addShare(_,M,$){if(this.syncAgents.has(_))return;const j=this.peer.getReplica(_);if(!j){console.error("Couldn't get the replica for a share we had in common.");return}const z=new SyncAgent({replica:j,formats:M,syncerManager:this.manager,transferManager:this.transferManager,initiateMessaging:$,payloadThreshold:this.partner.payloadThreshold,rangeDivision:this.partner.rangeDivision,syncAppetite:this.appetite});z.onStatusUpdate(()=>{this.statusBus.send(this.getStatus())}),this.syncAgents.set(_,z),this.transferManager.registerSyncAgent(z);const V=this.syncAgentQueues.get(_);let X;if(V)X=V;else{const G=new AsyncQueue;X=G,this.syncAgentQueues.set(_,G)}(async()=>{for await(const G of X)z.sendEvent(G)})(),(async()=>{for await(const G of z.events())await this.partner.sendEvent({to:_,...G})})()}async handleIncomingEvent(_){if(this.bumpingTimeout.bump(),this.isDoneMultiDeferred.state==="pending")switch(_.kind){case"DISCLOSE":{const M=getFormatIntersection(_.formats,this.formats);if(M.length===0)break;const $=new Set(_.shares),j=new Set,z=new Set;for(const X of this.peer.shares()){const G=await saltAndHashShare(_.salt,X);$.has(G)?j.add(X):z.add(X)}const V=this.id>_.syncerId;for(const X of j)this.addShare(X,M,V);for(const X of z){const G=this.syncAgents.get(X);G&&(G.cancel("No longer in common with the other peer."),this.syncAgents.delete(X))}if(this.transferManager.registerOtherSyncerId(_.syncerId),this.appetite==="once"&&this.transferManager.allSyncAgentsKnown(),_.canRespond){const X=randomId();Promise.all(this.peer.shares().map(G=>saltAndHashShare(X,G))).then(G=>{this.partner.sendEvent({kind:"DISCLOSE",salt:X,syncerId:this.id,shares:G,formats:this.formats?this.formats.map(Y=>Y.id):[DEFAULT_FORMAT.id],canRespond:!1})})}j.size===0&&this.appetite==="once"&&this.partner.sendEvent({kind:"SYNCER_FULFILLED"});break}case"SYNCER_FULFILLED":{this.partnerIsFulfilled.resolve();break}case"HEARTBEAT":break;default:{const{to:M}=_,$=this.syncAgentQueues.get(M);if(!$){const j=new AsyncQueue;j.push(_),this.syncAgentQueues.set(M,j);break}$.push(_)}}}getStatus(){const _={};for(const[M,$]of this.syncAgents)_[M]={docs:$.getStatus(),attachments:this.transferManager.getReport()[M]||[]};return _}onStatusChange(_){return this.statusBus.on(_)}async cancel(_){this.bumpingTimeout.close(),this.isDoneMultiDeferred.reject(_);for(const[M,$]of this.syncAgents)await $.cancel();clearInterval(this.heartbeatInterval),this.transferManager.cancel(),await this.partner.closeConnection()}handleTransferRequest({shareAddress:_,path:M,author:$,source:j,kind:z,formatName:V}){if(this.isDoneMultiDeferred.state!=="pending")return;const X=this.peer.getReplica(_);if(!X)return;let G="unused";if(z==="upload"){const Y=this.syncAgents.get(_);Y&&(G=Y.counterpartId)}return this.transferManager.handleTransferRequest({replica:X,author:$,formatName:V,kind:z,path:M,source:j,counterpartId:G})}isDone(){return this.isDoneMultiDeferred.getPromise()}}function saltAndHashShare(q,_){return Crypto.sha256base32(q+_+q)}class PartnerLocal{constructor(_,M,$,j){Object.defineProperty(this,"concurrentTransfers",{enumerable:!0,configurable:!0,writable:!0,value:1024}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"syncAppetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outgoingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"incomingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"partnerPeer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partnerSyncer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.syncAppetite=$,this.partnerPeer=_;const{incomingQueue:z,outgoingQueue:V}=this;this.partnerSyncer=new Syncer({manager:_.syncerManager,formats:j,partner:{syncAppetite:$,getEvents(){return z},sendEvent(X){return V.push(X),Promise.resolve()},concurrentTransfers:1024,payloadThreshold:32,rangeDivision:32,async getDownload(X){const G=M.getReplica(X.shareAddress);if(!G)throw new ValidationError("Tried to get a receiving transfer for an unknown share.");const Y=await G.replicaDriver.attachmentDriver.getAttachment(X.doc.format,X.attachmentHash);if(Y&&!isErr(Y))return await Y.stream()},closeConnection(){return V.close(),Promise.resolve()},handleUploadRequest(X){return Promise.resolve(new NotSupportedError("PartnerLocal does not support uploads."))},handleTransferRequest(X,G){return Promise.resolve(new NotSupportedError("PartnerLocal does not support transfer requests."))}}})}getEvents(){return this.outgoingQueue}sendEvent(_){return this.incomingQueue.push(_),Promise.resolve()}closeConnection(){return this.incomingQueue.close(),Promise.resolve()}async getDownload(_){const M=this.partnerPeer.getReplica(_.shareAddress);if(!M)throw new ValidationError("Tried to get a receiving transfer for an unknown share.");const $=await M.replicaDriver.attachmentDriver.getAttachment(_.doc.format,_.attachmentHash);if($&&!isErr($))return await $.stream()}handleUploadRequest(_){return Promise.resolve(new NotSupportedError("PartnerLocal does not support uploads."))}handleTransferRequest(_,M){return Promise.resolve(new NotSupportedError("PartnerLocal does not support transfer requests."))}}class PartnerWebServer{constructor(_){Object.defineProperty(this,"syncAppetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"concurrentTransfers",{enumerable:!0,configurable:!0,writable:!0,value:24}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"isSecure",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wsUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"socket",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"incomingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"socketIsReady",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),this.syncAppetite=_.appetite;const M=new URL(_.url),$=`${M.host}${M.pathname==="/"?"":M.pathname}`;this.isSecure=M.protocol==="https:"||M.protocol==="wss:",this.wsUrl=`${this.isSecure?"wss://":"ws://"}${$}/'`;const j=new URL(_.appetite,this.wsUrl);this.socket=new WebSocket$1(j.toString()),this.socket.onopen=()=>{this.socketIsReady.resolve()},this.socket.binaryType="arraybuffer",this.socket.onmessage=z=>{this.incomingQueue.push(JSON.parse(z.data))},this.socket.onclose=()=>{this.incomingQueue.close()},this.socket.onerror=z=>{if("error"in z){this.incomingQueue.close({withError:z.error});return}this.incomingQueue.close({withError:new EarthstarError("Websocket error.")})}}async sendEvent(_){if(await this.socketIsReady,!(this.socket.readyState===this.socket.CLOSED||this.socket.readyState===this.socket.CLOSING))return this.socket.send(JSON.stringify(_))}getEvents(){return this.incomingQueue}closeConnection(){return this.socket.close(),Promise.resolve()}getDownload(_){const M=new URL(`${_.syncerId}/download/${_.shareAddress}/${_.doc.format}/${_.doc.author}${_.doc.path}`,this.wsUrl),$=websocketReadable(M.toString(),j=>j.data instanceof ArrayBuffer?new Uint8Array(j.data):null);return Promise.resolve($)}handleUploadRequest(_){const M=new URL(`${_.syncerId}/upload/${_.shareAddress}/${_.doc.format}/${_.doc.author}${_.doc.path}`,this.wsUrl),$=websocketWritable(M.toString(),j=>j);return Promise.resolve($)}handleTransferRequest(_,M){return Promise.resolve(new NotSupportedError("SyncDriverWebClient does not support external transfer requests."))}}function compareThumbnails(q,_){const[M,$]=q.split(" "),[j,z]=_.split(" "),V=parseInt(M),X=parseInt(j);return V>X?1:V<X?-1:$>z?1:$<z?-1:0}const docThumbnailMonoid={lift:q=>hash(q),combine:(q,_)=>q+_,neutral:BigInt(0)};class DocThumbnailTree extends FingerprintTree{constructor(){super(docThumbnailMonoid,compareThumbnails)}}class PlumTree{constructor(){Object.defineProperty(this,"messagingModes",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"eagerMessageThumbnails",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"haveTimeouts",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}getMode(_){const M=this.messagingModes.get(_);if(M)return M;const $=this.messagingModes.size===0?"EAGER":"LAZY";return this.messagingModes.set(_,$),"EAGER"}onEagerMessage(_,M){const $=this.haveTimeouts.get(M.thumbnail);return $?(clearTimeout($),!1):this.eagerMessageThumbnails.has(M.thumbnail)?(this.messagingModes.set(_,"LAZY"),!0):(this.eagerMessageThumbnails.add(M.thumbnail),!1)}onLazyMessage(_,M){if(!this.haveTimeouts.has(_.thumbnail)){const $=setTimeout_1(()=>{M(_.thumbnail)},5);this.haveTimeouts.set(_.thumbnail,$)}}onGraftMessage(_){this.messagingModes.set(_,"EAGER")}onPrune(_){this.messagingModes.set(_,"LAZY")}}class SyncerManager{constructor(_){Object.defineProperty(this,"syncers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"syncerEventBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"peer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docThumbnailTreeAndLookup",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"hasher",{enumerable:!0,configurable:!0,writable:!0,value:new XXH64}),Object.defineProperty(this,"plumTrees",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.peer=_}addPartner(_,M,$){const j=new Syncer({manager:this,partner:_,formats:$});return this.syncers.set(j.id,{syncer:j,description:M}),this.syncerEventBus.send(this.syncers),j}getSyncers(){return this.syncers}getDocThumbnailTreeAndDocLookup(_,M){const $=M.map(te=>te.id),j=`${_} ${$}`,z=this.docThumbnailTreeAndLookup.get(j);if(z){const[te,ee]=z;return{tree:te,lookup:ee,treeIsReady:Promise.resolve(!0)}}const V=this.peer.getReplica(_);if(!V)throw new EarthstarError("A DocThumbnailTree was requested for a share the peer doesn't know about, big problem!");const X=this.hasher,G=V.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"everything",M),Y=new DocThumbnailTree,Q={},Z=deferred();return G.pipeTo(new WritableStream({write(te){if(te.kind==="processed_all_existing"){Z.resolve();return}X.reset(),X.update(`${te.doc.path} ${te.doc.author}`);const ee=X.digest().toString(16),ne=`${te.doc.timestamp} ${ee}`;(te.kind==="existing"||te.kind==="success")&&(Q[ee]=[te.doc.timestamp,te.doc.path,te.doc.author],Y.insert(ne)),te.kind==="expire"&&(delete Q[ee],Y.remove(ne))}})),{tree:Y,lookup:Q,treeIsReady:Z}}getPlumTree(_){const M=this.plumTrees.get(_);if(M)return M;const $=new PlumTree;return this.plumTrees.set(_,$),$}onSyncersChange(_){return this.syncerEventBus.on(_)}}const logger$5=new Logger("peer","orangeRed"),J$1=JSON.stringify;class Peer{constructor(){Object.defineProperty(this,"replicaEventBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"syncerManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicaMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),logger$5.debug("constructor"),this.syncerManager=new SyncerManager(this)}hasShare(_){return this.replicaMap.has(_)}shares(){const _=[...this.replicaMap.keys()];return _.sort(),_}replicas(){const _=[...this.replicaMap.keys()];return _.sort(),_.map(M=>this.replicaMap.get(M))}size(){return this.replicaMap.size}getReplica(_){return this.replicaMap.get(_)}async addReplica(_){if(logger$5.debug(`addReplica(${J$1(_.share)})`),this.replicaMap.has(_.share))throw logger$5.debug("already had a replica with that share"),new Error(`Peer.addReplica: already has a replica with share ${J$1(_.share)}.  Don't add another one.`);this.replicaMap.set(_.share,_),await this.replicaEventBus.send(this.replicaMap),logger$5.debug("    ...addReplica: done")}async removeReplicaByShare(_){logger$5.debug(`removeReplicaByShare(${J$1(_)})`),this.replicaMap.delete(_),await this.replicaEventBus.send(this.replicaMap)}async removeReplica(_){const M=this.replicaMap.get(_.share);_===M?(logger$5.debug(`removeReplica(${J$1(_.share)})`),await this.removeReplicaByShare(_.share)):logger$5.debug(`removeReplica(${J$1(_.share)}) -- same share but it's a different instance now; ignoring`)}sync(_,M=!1,$){try{const j=new PartnerWebServer({url:_,appetite:M?"continuous":"once"});return this.syncerManager.addPartner(j,_,$)}catch{if(_ instanceof Peer){const j=new PartnerLocal(_,this,M?"continuous":"once",$);return this.syncerManager.addPartner(j,"Local",$)}console.error("Provided an invalid target for syncing to a peer:",_);return}}addSyncPartner(_,M,$){return this.syncerManager.addPartner(_,M,$)}getSyncers(){return this.syncerManager.getSyncers()}onReplicasChange(_){return this.replicaEventBus.on(_)}onSyncersChange(_){return this.syncerManager.onSyncersChange(_)}discover(_){const M=this;return{async*[Symbol.asyncIterator](){for await(const $ of _.events){if($.kind==="SERVICE_STOPPED")break;if($.kind==="PEER_EXITED"){yield $;continue}if($.kind==="PEER_INITIATED_SYNC"){const j=await $.begin(M);yield{kind:"PEER_INITIATED_SYNC",description:$.description,syncer:j};continue}yield{kind:"PEER_DISCOVERED",description:$.description,sync:async j=>await $.begin(M,j!=null&&j.syncContinuously?"continuous":"once")}}}}}}const DEFAULT_QUERY={historyMode:"latest",orderBy:"path ASC",startAfter:void 0,limit:void 0,filter:void 0,formats:["es.5"]},logger$4=new Logger("query","green");function cleanUpQuery(q){var j,z,V,X;const _={...DEFAULT_QUERY,...q},M={query:{limit:0},isValid:!1,willMatch:"nothing"};if(_.limit!==void 0&&_.limit<0)return logger$4.debug("cleanUpQuery: unreasonable limit - returning empty invalid query",M),M;if((j=_.orderBy)!=null&&j.startsWith("path")&&((z=_.startAfter)==null?void 0:z.localIndex)!==void 0)return logger$4.debug('cleanUpQuery: orderBy is "path" but startAfter is not compatible - returning empty invalid query',M),M;if((V=_.orderBy)!=null&&V.startsWith("localIndex")&&((X=_.startAfter)==null?void 0:X.path)!==void 0)return logger$4.debug('cleanUpQuery: orderBy is "localIndex" but startAfter is not compatible - returning empty invalid query',M),M;if(_.historyMode!==void 0&&_.historyMode!=="all"&&_.historyMode!=="latest")return logger$4.debug(`cleanUpQuery: unknown historyMode ${JSON.stringify(_.historyMode)} - returning empty invalid query`,M),M;if(_.orderBy!==void 0&&["path ASC","path DESC","localIndex ASC","localIndex DESC"].indexOf(_.orderBy)===-1)return logger$4.debug(`cleanUpQuery: unrecognized orderBy value ${JSON.stringify(_.orderBy)} - returning empty invalid query`,M),M;let $=_.historyMode==="all"?"all":"all-latest";if(_.filter!==void 0&&!shallowEqualObjects(_.filter,{})&&($="some"),_.startAfter!==void 0&&!shallowEqualObjects(_.startAfter,{})&&($="some"),_.limit!==void 0&&(_.limit>0&&($="some"),_.limit===0&&($="nothing")),_.filter!==void 0){const G=_.filter;G.path&&G.pathStartsWith&&!G.path.startsWith(G.pathStartsWith)&&($="nothing"),G.path&&G.pathEndsWith&&!G.path.endsWith(G.pathEndsWith)&&($="nothing"),G.timestamp&&G.timestampGt&&!(G.timestamp>G.timestampGt)&&($="nothing"),G.timestamp&&G.timestampLt&&!(G.timestamp<G.timestampLt)&&($="nothing"),G.timestampGt&&G.timestampLt&&!(G.timestampLt+1<G.timestampGt)&&($="nothing")}if($==="nothing"){let G={query:{limit:0},isValid:!0,willMatch:"nothing"};return logger$4.debug("cleanUpQuery - this query will match nothing, so returning a simpler query that also matches nothing",G),G}return logger$4.debug(`cleanUpQuery - query is ok!  willMatch = ${$}`),{query:_,isValid:!0,willMatch:$}}function docMatchesFilter(q,_){return!(_.path!==void 0&&q.path!==_.path||_.pathStartsWith!==void 0&&!q.path.startsWith(_.pathStartsWith)||_.pathEndsWith!==void 0&&!q.path.endsWith(_.pathEndsWith)||_.author!==void 0&&q.author!==_.author||_.timestamp!==void 0&&q.timestamp!==_.timestamp||_.timestampGt!==void 0&&!(q.timestamp>_.timestampGt)||_.timestampLt!==void 0&&!(q.timestamp<_.timestampLt))}new Logger("query helpers","gold");var Cmp;(function(q){q[q.LT=-1]="LT",q[q.EQ=0]="EQ",q[q.GT=1]="GT"})(Cmp||(Cmp={}));function compareBasic(q,_,M="ASC"){if(Array.isArray(q)&&shallowEqualArrays(q,_)||typeof q=="object"&&shallowEqualObjects(q,_)||q===_)return Cmp.EQ;if(M==="ASC"||M===void 0)return q<_?Cmp.LT:Cmp.GT;if(M==="DESC")return q>_?Cmp.LT:Cmp.GT;throw new Error("unexpected sort order to compareBasic: "+JSON.stringify(M))}function compareArrays(q,_,M){let $=Math.min(q.length,_.length);for(let V=0;V<$;V++){let X=(M==null?void 0:M[V])??"ASC",G=compareBasic(q[V],_[V],X);if(G!==Cmp.EQ)return G}if(q.length===_.length)return Cmp.EQ;let j=Math.min(q.length,_.length),z=(M==null?void 0:M[j])??"ASC";return compareBasic(q.length,_.length,z)}function compareByObjKey(q,_="ASC"){return(M,$)=>compareBasic(M[q],$[q],_)}const J=JSON.stringify,logger$3=new Logger("replica","gold"),loggerSet=new Logger("replica set","gold"),loggerIngest=new Logger("replica ingest","gold");function docCompareNewestFirst(q,_){return compareArrays([q.timestamp,q.signature],[_.timestamp,q.signature],["DESC","ASC"])}class MultiformatReplica{constructor({driver:_,config:M}){var j;Object.defineProperty(this,"replicaId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicaDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formatsConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isClosed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ingestLockStream",{enumerable:!0,configurable:!0,writable:!0,value:new LockStream}),Object.defineProperty(this,"eventMultiStream",{enumerable:!0,configurable:!0,writable:!0,value:new ChannelMultiStream("kind",!0)}),Object.defineProperty(this,"eventWriter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbackSink",{enumerable:!0,configurable:!0,writable:!0,value:new CallbackSink}),Object.defineProperty(this,"eraseInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"expireEventTimeouts",{enumerable:!0,configurable:!0,writable:!0,value:new Map});const $=checkShareIsValid(_.docDriver.share);if(isErr($))throw $;logger$3.debug(`constructor.  driver = ${(j=_==null?void 0:_.constructor)==null?void 0:j.name}`),this.replicaId="replica-"+randomId(),this.share=_.docDriver.share,this.replicaDriver=_,this.formatsConfig=M||{},this.eventWriter=this.eventMultiStream.getWritableStream().getWriter(),this.eventMultiStream.getReadableStream("*").pipeTo(new WritableStream(this.callbackSink)),this.eraseInterval=setInterval_1(()=>{this.isClosed()?clearInterval(this.eraseInterval):this.pruneExpiredDocsAndAttachments()},1e3*60*60)}isClosed(){return this._isClosed}async close(_){if(logger$3.debug("closing..."),this._isClosed)throw new ReplicaIsClosedError;await this.ingestLockStream.close();for(const M of this.expireEventTimeouts.values())clearTimeout(M);return logger$3.debug("    sending willClose blockingly..."),await this.eventWriter.write({kind:"willClose"}),logger$3.debug("    marking self as closed..."),_===!1&&await this.pruneExpiredDocsAndAttachments(),await this.replicaDriver.attachmentDriver.clearStaging(),this._isClosed=!0,logger$3.debug(`    closing ReplicaDriver (erase = ${_})...`),await this.replicaDriver.docDriver.close(_),await this.replicaDriver.attachmentDriver.close(_),clearInterval(this.eraseInterval),logger$3.debug("    sending didClose nonblockingly..."),await this.eventWriter.write({kind:"didClose"}),logger$3.debug("...closing done"),Promise.resolve()}async getConfig(_){if(this._isClosed)throw new ReplicaIsClosedError;return await this.replicaDriver.docDriver.getConfig(_)}async setConfig(_,M){if(this._isClosed)throw new ReplicaIsClosedError;return await this.replicaDriver.docDriver.setConfig(_,M)}async listConfigKeys(){if(this._isClosed)throw new ReplicaIsClosedError;return await this.replicaDriver.docDriver.listConfigKeys()}async deleteConfig(_){if(this._isClosed)throw new ReplicaIsClosedError;return await this.replicaDriver.docDriver.deleteConfig(_)}getMaxLocalIndex(){if(this._isClosed)throw new ReplicaIsClosedError;return this.replicaDriver.docDriver.getMaxLocalIndex()}getAllDocs(_){return logger$3.debug("getAllDocs()"),this.queryDocs({historyMode:"all",orderBy:"path ASC"},_)}getLatestDocs(_){return logger$3.debug("getLatestDocs()"),this.queryDocs({historyMode:"latest",orderBy:"path ASC"},_)}getAllDocsAtPath(_,M){return logger$3.debug(`getAllDocsAtPath("${_}")`),this.queryDocs({historyMode:"all",orderBy:"path ASC",filter:{path:_}},M)}async getLatestDocAtPath(_,M){logger$3.debug(`getLatestDocsAtPath("${_}")`);const $=await this.queryDocs({historyMode:"latest",orderBy:"path ASC",filter:{path:_}},M?[M]:void 0);if($.length!==0)return $[0]}async queryDocs(_={},M){if(logger$3.debug("queryDocs",_),this._isClosed)throw new ReplicaIsClosedError;const $=getFormatsWithFallback(M);return await this.replicaDriver.docDriver.queryDocs({..._,formats:$.map(j=>j.id)})}async queryPaths(_={},M){const $=await this.queryDocs(_,M),j=new Set($.map(({path:z})=>z));return Array.from(j).sort()}async queryAuthors(_={},M){const $=await this.queryDocs(_,M),j=new Set($.map(({author:z})=>z));return Array.from(j).sort()}async set(_,M,$=DEFAULT_FORMAT){if(loggerSet.debug("set",M),this._isClosed)throw new ReplicaIsClosedError;loggerSet.debug("...deciding timestamp: getting latest doc at the same path (from any author)");const j=await this.getLatestDocAtPath(M.path);let z;typeof M.timestamp=="number"?z=M.timestamp:j===void 0?z=microsecondNow():z=Math.max(microsecondNow(),j.timestamp+1),loggerSet.debug("...generating doc");let V;if(j){const Y=$.removeExtraFields(j);isErr(Y)||(V=Y.doc)}const X=await $.generateDocument({keypair:_,input:{...M,format:$.id},share:this.share,timestamp:z,prevLatestDoc:V,config:this.formatsConfig[$.id]});if(isErr(X))return{kind:"failure",reason:"invalid_document",err:X};if(loggerSet.debug("...signature =",X.doc.signature),X.attachment){const Y=await this.replicaDriver.attachmentDriver.stage($.id,X.attachment);if(isErr(Y))return{kind:"failure",reason:"invalid_document",err:Y};const Q=await $.updateAttachmentFields(_,X.doc,Y.size,Y.hash,this.formatsConfig[$.id]);if(isErr(Q))return await Y.reject(),{kind:"failure",reason:"invalid_document",err:Q};loggerSet.debug("...ingesting attachment"),loggerSet.debug("-----------------------"),await Y.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:Q,hash:Y.hash,size:Y.size,sourceId:"local"}),loggerSet.debug("...done ingesting attachment"),loggerSet.debug("...ingesting"),loggerSet.debug("-----------------------");const Z=await this.ingest($,Q,"local");return loggerSet.debug("...done ingesting"),loggerSet.debug("...set is done."),Z}loggerSet.debug("...ingesting"),loggerSet.debug("-----------------------");const G=await this.ingest($,X.doc,"local");return loggerSet.debug("...done ingesting"),loggerSet.debug("...set is done."),G}async ingest(_,M,$){if(loggerIngest.debug("ingest",M),this._isClosed)throw new ReplicaIsClosedError;loggerIngest.debug("...removing extra fields");const j=_.removeExtraFields(M);if(isErr(j))return{kind:"failure",reason:"invalid_document",err:j};M=j.doc;const z=j.extras;Object.keys(z).length>0&&loggerIngest.debug(`...extra fields found: ${J(z)}`);const V=await _.checkDocumentIsValid(M);if(isErr(V))return{kind:"failure",reason:"invalid_document",err:V};const X=deferred();return await this.ingestLockStream.run(async()=>{loggerIngest.debug(" >> ingest: start of protected region"),loggerIngest.debug("  > getting other history docs at the same path by any author");const G=await this.getAllDocsAtPath(M.path,[_]);loggerIngest.debug(`  > ...got ${G.length}`),loggerIngest.debug("  > getting prevLatest and prevSameAuthor");const Y=G[0]??null,Q=G.filter(re=>re.author===M.author)[0]??null;loggerIngest.debug("  > checking if new doc is latest at this path"),G.push(M),G.sort(docCompareNewestFirst);const Z=G[0]===M;if(loggerIngest.debug(`  > ...isLatest: ${Z}`),!Z&&Q!==null){loggerIngest.debug("  > new doc is not latest and there is another one from the same author...");const re=docCompareNewestFirst(M,Q);if(re===Cmp.GT){loggerIngest.debug("  > new doc is GT prevSameAuthor, so it is obsolete"),X.resolve({kind:"nothing_happened",reason:"obsolete_from_same_author",doc:M});return}if(re===Cmp.EQ){loggerIngest.debug("  > new doc is EQ prevSameAuthor, so it is redundant (already_had_it)"),X.resolve({kind:"nothing_happened",reason:"already_had_it",doc:M});return}}loggerIngest.debug("  > upserting into ReplicaDriver...");const te=await this.replicaDriver.docDriver.upsert(M);loggerIngest.debug("  > ...done upserting into ReplicaDriver"),loggerIngest.debug("  > ...getting ReplicaDriver maxLocalIndex...");const ee=await this.replicaDriver.docDriver.getMaxLocalIndex();loggerIngest.debug(" >> ingest: end of protected region, returning a WriteEvent from the lock");const ne={kind:"success",maxLocalIndex:ee,doc:te,docIsLatest:Z,prevDocFromSameAuthor:Q,prevLatestDoc:Y,sourceId:$};if(X.resolve(ne),await this.eventWriter.write(ne),te.deleteAfter){const re=`${te.path}|${te.author}`,se=this.expireEventTimeouts.get(re);se&&clearTimeout(se);const ie=te.deleteAfter/1e3-Date.now();this.expireEventTimeouts.set(re,setTimeout_1(()=>{this.eventWriter.write({kind:"expire",doc:te})},ie))}}),X}async overwriteAllDocsByAuthor(_,M){const $=getFormatWithFallback(M);if(logger$3.debug(`overwriteAllDocsByAuthor("${_.address}")`),this._isClosed)throw new ReplicaIsClosedError;const j=await this.queryDocs({filter:{author:_.address},historyMode:"all"},[$]);logger$3.debug(`    ...found ${j.length} docs to overwrite`);let z=0,V=0;for(const X of j){const G=await this.wipeDocument(_,X,getFormatWithFallback(M));if(isErr(G))return G;z+=1}return logger$3.debug(`    ...done; ${z} overwritten to be empty; ${V} were already empty; out of total ${j.length} docs`),z}async wipeDocAtPath(_,M,$=DEFAULT_FORMAT){const j=await this.getLatestDocAtPath(M,$);return j?this.wipeDocument(_,j,$):new ValidationError("No document exists at that path")}async wipeDocument(_,M,$){const j={...M,timestamp:Math.max(M.timestamp+1,Date.now()*1e3),author:_.address},z=await $.wipeDocument(_,j,this.formatsConfig[$.id]);if(isErr(z))return{kind:"failure",err:z,reason:"invalid_document"};const V=await this.ingest($,z,"local");if(V.kind==="success"){const X=$.getAttachmentInfo(M);if(!isErr(X)){const G=await this.replicaDriver.attachmentDriver.erase($.id,X.hash);isErr(G)||await this.eventWriter.write({kind:"attachment_prune",format:$.id,hash:X.hash})}}return V}async pruneExpiredDocsAndAttachments(_=DEFAULT_FORMATS){const M=await this.replicaDriver.docDriver.eraseExpiredDocs();for(const V of M)await this.eventWriter.write({kind:"expire",doc:V});const $=getFormatLookup(_),j={};await this.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"existing",_).pipeTo(new WritableStream({write(V){if(V.kind==="existing"){const X=$[V.doc.format],G=X.getAttachmentInfo(V.doc);if(!isErr(G)){const Y=j[X.id];Y?Y.add(G.hash):j[X.id]=new Set([G.hash])}}}}));const z=await this.replicaDriver.attachmentDriver.filter(j);for(const V of z)await this.eventWriter.write({kind:"attachment_prune",format:V.format,hash:V.hash})}getEventStream(_="*"){return this.eventMultiStream.getReadableStream(_)}getQueryStream(_={},M,$){const j=this.queryDocs.bind(this),z=this.getEventStream.bind(this);return new ReadableStream$1({async start(V){if(M==="existing"||M==="everything"){const Y=await j(_,$);for(const Q of Y)V.enqueue({kind:"existing",doc:Q})}if(V.enqueue({kind:"processed_all_existing"}),M==="existing"){V.close();return}const G=z().getReader();for(;;){const{done:Y,value:Q}=await G.read();if(Y)return;if(Q.kind==="expire"||Q.kind==="success"){if(_.filter&&docMatchesFilter(Q.doc,_.filter)){V.enqueue(Q);continue}V.enqueue(Q);continue}Q.kind==="didClose"&&V.close()}}})}onEvent(_){return this.callbackSink.onWrite(_)}async ingestAttachment(_,M,$,j){if(this._isClosed)throw new ReplicaIsClosedError;const z=_.removeExtraFields(M);if(isErr(z))return Promise.resolve(z);M=z.doc;const V=await _.checkDocumentIsValid(M);if(isErr(V))return Promise.resolve(V);const X=await this.getAttachment(M,_);if(X&&!isErr(X))return!1;const G=_.getAttachmentInfo(M);if(isErr(G))return Promise.resolve(G);const Y=await this.replicaDriver.attachmentDriver.stage(M.format,$);return isErr(Y)?Y:Y.hash!==G.hash?(await Y.reject(),new ValidationError("Attachment's hash did not match the document's")):Y.size!==G.size?(await Y.reject(),new ValidationError("Attachment's size did not match the document's")):(await Y.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:M,hash:Y.hash,size:Y.size,sourceId:j}),!0)}getAttachment(_,M=DEFAULT_FORMAT){if(_.deleteAfter&&_.deleteAfter<Date.now()*1e3)return Promise.resolve(new ValidationError("This document has expired"));const $=M.getAttachmentInfo(_);return isErr($)?Promise.resolve($):this.replicaDriver.attachmentDriver.getAttachment(_.format,$.hash)}addAttachments(_,M){const $=getFormatsWithFallback(M),j={};for(const V of $)j[V.id]=V;const z=_.map(V=>new Promise(X=>{const Y=j[V.format].getAttachmentInfo(V);if(!isErr(Y))this.replicaDriver.attachmentDriver.getAttachment(V.format,Y.hash).then(Q=>{X({...V,attachment:Q})});else return X({...V,attachment:Y})}));return Promise.all(z)}}class Replica extends MultiformatReplica{constructor(_){super({driver:_.driver,config:{"es.5":{shareSecret:_.shareSecret}}})}}const logger$2=new Logger("replica-cache","green");function justLocalIndex({_localIndex:q}){return q}function sortAndLimit(q,_){const M=[];for(const $ of _)if(!(q.orderBy==="path ASC"&&q.startAfter!==void 0&&q.startAfter.path!==void 0&&$.path<=q.startAfter.path)&&!(q.orderBy==="path DESC"&&q.startAfter!==void 0&&q.startAfter.path!==void 0&&$.path>=q.startAfter.path)&&!(q.orderBy==="localIndex ASC"&&q.startAfter!==void 0&&q.startAfter.localIndex!==void 0&&($._localIndex||0)<=q.startAfter.localIndex)&&!(q.orderBy==="localIndex DESC"&&q.startAfter!==void 0&&q.startAfter.localIndex!==void 0&&($._localIndex||0)>=q.startAfter.localIndex)&&(M.push($),q.limit!==void 0&&M.length>=q.limit))break;return M}class ReplicaCache{constructor(_,M,$){Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"replica",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"timeToLive",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onCacheUpdatedCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"onFireCacheUpdatedsWrapper",{enumerable:!0,configurable:!0,writable:!0,value:X=>X()}),Object.defineProperty(this,"attachmentCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.replica=_,this.timeToLive=M||1e3,$&&(this.onFireCacheUpdatedsWrapper=$);const j=this.onReplicaEvent.bind(this),z=this.close.bind(this),V=this.isClosed.bind(this);this.replica.getEventStream("*").pipeTo(new WritableStream({async write(X){X.kind==="attachment_ingest"||X.kind==="success"||X.kind==="expire"?await j(X):X.kind==="willClose"&&!V()&&await z()}})).catch(()=>{})}async close(){if(this.closed)throw new ReplicaCacheIsClosedError;this.closed=!0,await Promise.all(Array.from(this.docCache.values()).map(_=>_.close())),this.docCache.clear(),this.onCacheUpdatedCallbacks.clear()}isClosed(){return this.closed}getAllDocs(_){return this.queryDocs({historyMode:"all",orderBy:"path DESC"},_)}getLatestDocs(_){return this.queryDocs({historyMode:"latest",orderBy:"path DESC"},_)}getAllDocsAtPath(_,M){return this.queryDocs({historyMode:"all",orderBy:"path DESC",filter:{path:_}},M)}getLatestDocAtPath(_,M){const $=this.queryDocs({historyMode:"latest",orderBy:"path DESC",filter:{path:_}},M?[M]:void 0);if($.length!==0)return $[0]}queryDocs(_={},M){if(this.closed)throw new ReplicaCacheIsClosedError;if(this.replica.isClosed())throw new ReplicaIsClosedError;const j={..._,formats:(M||DEFAULT_FORMATS).map(ne=>ne.id)},z=cleanUpQuery(j);if(z.willMatch==="nothing")return[];const V=stringify$1(z.query),X=this.docCache.get(V);if(X)return Date.now()>X.expires&&this.replica.queryDocs(_,M).then(ne=>{const re=ne.map(justLocalIndex).sort(),se=X.docs.map(justLocalIndex).sort();shallowEqualArrays(re,se)||(this.docCache.set(V,{stream:X.stream,close:X.close,docs:ne,expires:Date.now()+this.timeToLive}),logger$2.debug("Updated cache because result expired."),this.fireOnCacheUpdateds())}),X.docs;const G=this.replica.getQueryStream(_,"new",M),Y=new CallbackSink,Q=Y.onWrite(ne=>{(ne.kind==="existing"||ne.kind==="success")&&(logger$2.debug({doc:ne.doc.path,queryString:V}),this._updateCache(V,ne.doc))}),Z=new WritableStream(Y),te=new AbortController;G.pipeTo(Z,{signal:te.signal});const ee=()=>{Q()};return this.docCache.set(V,{stream:G,docs:[],expires:Date.now()+this.timeToLive,close:ee}),this.replica.queryDocs(j).then(ne=>{this.docCache.set(V,{stream:G,close:ee,docs:ne,expires:Date.now()+this.timeToLive}),logger$2.debug("Updated cache with a new entry."),this.fireOnCacheUpdateds()}),[]}queryPaths(_={},M){const $=this.queryDocs(_,M),j=new Set($.map(({path:z})=>z));return Array.from(j).sort()}queryAuthors(_={},M){const $=this.queryDocs(_,M),j=new Set($.map(({author:z})=>z));return Array.from(j).sort()}_updateCache(_,M){const $=this.docCache.get(_);if(!$)return;const j=JSON.parse(_),z=()=>{const ee=[...$.docs,M];this.docCache.set(_,{...$,docs:sortAndLimit(j,ee)}),this.fireOnCacheUpdateds()},V=({exact:ee})=>{const ne=$.docs.map(re=>ee&&re.path===M.path&&re.author===M.author||!ee&&re.path===M.path?M:re);this.docCache.set(_,{...$,docs:sortAndLimit(j,ne)}),this.fireOnCacheUpdateds()},X=$.docs.filter(ee=>ee.path===M.path),G=$.docs.filter(ee=>ee.path===M.path&&ee.author===M.author);if(X.length===0){(j.filter&&docMatchesFilter(M,j.filter)||!j.filter)&&(logger$2.debug("Updated cache after appending a doc to a entry with matching filter."),z());return}if((j.historyMode||"latest")==="all"){if(G.length===0){logger$2.debug("Updated cache after appending a version of a doc to a historyMode: all query."),z();return}logger$2.debug("Updated cache after replacing a version of a doc in a historyMode: all query."),V({exact:!0});return}const Q=X[0],Z=M.author!==(Q==null?void 0:Q.author)||!shallowEqualObjects(M,Q),te=M.timestamp>Q.timestamp;if(Z&&te){logger$2.debug("Updated cache after replacing a doc with its latest version."),V({exact:!1});return}}fireOnCacheUpdateds(){this.version++,this.onFireCacheUpdatedsWrapper(()=>{this.onCacheUpdatedCallbacks.forEach(_=>{_()})})}onCacheUpdated(_){if(this.closed)throw new ReplicaCacheIsClosedError;if(this.replica.isClosed())throw new ReplicaIsClosedError;return this.onCacheUpdatedCallbacks.add(_),()=>{this.onCacheUpdatedCallbacks.delete(_)}}set(_,M,$){if(this.closed)throw new ReplicaCacheIsClosedError;return this.replica.set(_,M,$)}overwriteAllDocsByAuthor(_,M){if(this.closed)throw new ReplicaCacheIsClosedError;if(this.replica.isClosed())throw new ReplicaIsClosedError;return this.replica.overwriteAllDocsByAuthor(_,M)}wipeDocAtPath(_,M,$=DEFAULT_FORMAT){if(this.closed)throw new ReplicaCacheIsClosedError;return this.replica.wipeDocAtPath(_,M,$)}async onReplicaEvent(_){const M=`${_.doc.path}|${_.doc.author}`,$=this.attachmentCache.get(M);if(!$)return;const j=await this.replica.getAttachment(_.doc,$.format);this.attachmentCache.set(M,{expires:Date.now()+this.timeToLive,attachment:j,format:$.format}),this.fireOnCacheUpdateds()}getAttachment(_,M=DEFAULT_FORMAT){if(this.closed)throw new ReplicaCacheIsClosedError;if(this.replica.isClosed())throw new ReplicaIsClosedError;const $=M.getAttachmentInfo(_);if(isErr($))return $;const j=`${_.path}|${_.author}`,z=this.attachmentCache.get(j);if(z)return Date.now()>z.expires&&this.replica.getAttachment(_,M).then(V=>{this.attachmentCache.set(j,{expires:Date.now()+this.timeToLive,attachment:V,format:M}),this.fireOnCacheUpdateds()}),_.deleteAfter&&Date.now()*1e3>_.deleteAfter?new ValidationError("This document has expired"):z.attachment;this.attachmentCache.set(j,{attachment:void 0,expires:Date.now()+this.timeToLive,format:M}),this.replica.getAttachment(_,M).then(V=>{this.attachmentCache.set(j,{expires:Date.now()+this.timeToLive,attachment:V,format:M}),this.fireOnCacheUpdateds()})}addAttachments(_,M){const $=[],j=getFormatLookup(M);for(const z of _){const V=this.getAttachment(z,j[z.format]);$.push({...z,attachment:V})}return $}}new Logger("storage driver async memory","yellow");async function streamToBytes(q){let _=new Uint8Array;return await q.pipeTo(new WritableStream({write(M){const $=new Uint8Array(_.length+M.length);$.set(_),$.set(M,_.length),_=$}})),_}async function createInvitationURL(q,_,M){const $=parseShareAddress(q);if(isErr($))return new ValidationError("Invalid share address.");for(const X of _)try{new URL(X)}catch{return new ValidationError(`Could not parse ${X} as a URL.`)}const j=_.map(X=>`&server=${X}`).join("&");let z="";if(M){const X=await Crypto.checkKeypairIsValid({shareAddress:q,secret:M});if(isErr(X))return new ValidationError(`Supplied the wrong secret for ${q}`);z=`&secret=${M}`}return`earthstar://${q}/?invite${j}${z}&v=2`}async function parseInvitationURL(q){try{const _=new URL(q),M=_.hostname.length>0?_.hostname:_.pathname.replaceAll("/",""),$=parseShareAddress(M);if(isErr($))return new ValidationError("Invitation did not include a valid share address.");const j=new URLSearchParams(_.search),z=j.get("invite"),V=j.get("v");if(z===null)return new ValidationError("Not an invitation URL");if(V===null)return new ValidationError("Invitation version not specified.");if(V!=="2")return new ValidationError(`Invitation version is ${V}, expected version 2.`);const X=j.getAll("server");for(const Y of X)try{new URL(Y)}catch{return new ValidationError(`Invitation's servers included a malformed URL: ${Y}`)}const G=j.get("secret");if(G){const Y=await Crypto.checkKeypairIsValid({shareAddress:M,secret:G});if(isErr(Y))return new ValidationError(`Invitation contains the wrong secret for share ${M}.`)}return{shareAddress:M,secret:G||void 0,servers:X}}catch{return new ValidationError("Could not parse the invitation URL.")}}const EARTHSTAR_KEY="earthstar",AUTHOR_KEY="current_author",SHARES_KEY="shares",SHARE_SECRETS_KEY="share_secrets",SERVERS_KEY="servers";class SharedSettings{constructor(_){Object.defineProperty(this,"namespace",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:localStorage}),Object.defineProperty(this,"authorChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"sharesChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"shareSecretsChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"serversChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),this.namespace=_==null?void 0:_.namespace,_!=null&&_.sessionOnly&&(this.storage=sessionStorage),addEventListener("storage",M=>{switch(M.key){case makeStorageKey(AUTHOR_KEY,this.namespace):{this.fireAuthorEvent();break}case makeStorageKey(SHARES_KEY,this.namespace):{this.fireSharesEvent();break}case makeStorageKey(SHARE_SECRETS_KEY,this.namespace):{this.fireSecretsEvent();break}case makeStorageKey(SERVERS_KEY,this.namespace):{this.fireServersEvent();break}}})}get author(){const _=makeStorageKey(AUTHOR_KEY,this.namespace);return getParsedValue(this.storage,_,isParsedAuthorKeypair)||null}set author(_){const M=makeStorageKey(AUTHOR_KEY,this.namespace);this.storage.setItem(M,JSON.stringify(_)),this.fireAuthorEvent()}get shares(){const _=makeStorageKey(SHARES_KEY,this.namespace);return getParsedValue(this.storage,_,isParsedSharesArray)||[]}addShare(_){if(isErr(checkShareIsValid(_)))return new ValidationError("Not a valid share");const M=makeStorageKey(SHARES_KEY,this.namespace),$=new Set([...this.shares,_]),j=Array.from($);return this.storage.setItem(M,JSON.stringify(j)),this.fireSharesEvent(),j}removeShare(_){const M=this.shares,$=M.findIndex(z=>z===_);if($===-1)return new ValidationError("That share is not known yet");M.splice($,1);const j=makeStorageKey(SHARES_KEY,this.namespace);return this.storage.setItem(j,JSON.stringify(M)),this.fireSharesEvent(),M}get shareSecrets(){const _=makeStorageKey(SHARE_SECRETS_KEY,this.namespace);return getParsedValue(this.storage,_,isParsedSecretsDict)||{}}async addSecret(_,M){if(!this.shares.find(V=>_===V))return new ValidationError("This share is not yet known.");if(isErr(await Crypto.checkKeypairIsValid({shareAddress:_,secret:M})))return new ValidationError("Not the right secret for this share.");const j=makeStorageKey(SHARE_SECRETS_KEY,this.namespace),z={...this.shareSecrets,[_]:M};return this.storage.setItem(j,JSON.stringify(z)),this.fireSecretsEvent(),z}removeSecret(_){const M=this.shareSecrets;if(!M[_])return new ValidationError("Unknown share");const j=makeStorageKey(SHARE_SECRETS_KEY,this.namespace),z={...M};return delete z[_],this.storage.setItem(j,JSON.stringify(z)),this.fireSecretsEvent(),z}get servers(){const _=makeStorageKey(SERVERS_KEY,this.namespace);return getParsedValue(this.storage,_,isParsedUrlArray)||[]}addServer(_){try{const M=new URL(_),$=new Set([...this.servers,M.toString()]),j=Array.from($),z=makeStorageKey(SERVERS_KEY,this.namespace);return this.storage.setItem(z,JSON.stringify(j)),this.fireServersEvent(),j}catch{return new ValidationError("Not a valid URL.")}}removeServer(_){try{const M=new URL(_),$=this.servers,j=$.findIndex(V=>V===M.toString());if(j===-1)return new ValidationError("That server is not known yet");$.splice(j,1);const z=makeStorageKey(SERVERS_KEY,this.namespace);return this.storage.setItem(z,JSON.stringify($)),this.fireServersEvent(),$}catch{return new ValidationError("Not a valid URL")}}clear(){const _=makeStorageKey(AUTHOR_KEY,this.namespace);this.storage.setItem(_,JSON.stringify(null));const M=makeStorageKey(SHARES_KEY,this.namespace);this.storage.setItem(M,JSON.stringify([]));const $=makeStorageKey(SHARE_SECRETS_KEY,this.namespace);this.storage.setItem($,JSON.stringify({}));const j=makeStorageKey(SERVERS_KEY,this.namespace);this.storage.setItem(j,JSON.stringify([])),this.fireAuthorEvent(),this.fireSharesEvent(),this.fireSecretsEvent(),this.fireServersEvent()}onAuthorChanged(_){return this.authorChangedCbs.add(_),()=>{this.authorChangedCbs.delete(_)}}onSharesChanged(_){return this.sharesChangedCbs.add(_),()=>{this.sharesChangedCbs.delete(_)}}onShareSecretsChanged(_){return this.shareSecretsChangedCbs.add(_),()=>{this.shareSecretsChangedCbs.delete(_)}}onServersChanged(_){return this.serversChangedCbs.add(_),()=>{this.serversChangedCbs.delete(_)}}getPeer({sync:_,onCreateReplica:M}){const $=new Peer,j=this.shares;for(const Y of j){const Q=M(Y,this.shareSecrets[Y]);$.addReplica(Q)}const z=this.onSharesChanged(async Y=>{const Q=$.replicas(),Z=$.shares();for(const te of Q)Y.includes(te.share)||($.removeReplica(te),await te.close(!1));for(const te of Y)if(!Z.includes(te)){const ee=M(te,this.shareSecrets[te]);$.addReplica(ee)}}),V=this.onShareSecretsChanged(async Y=>{const Q=$.shares(),Z=Object.keys(Y);for(const te of Q)if(!Z.includes(te)){const ee=$.getReplica(te);ee&&($.removeReplica(ee),ee.close(!1));const ne=M(te);$.addReplica(ne)}for(const te of Z){const ee=$.getReplica(te);if(ee!=null&&ee.formatsConfig["es.5"]&&ee.formatsConfig["es.5"].shareSecret)continue;await(ee==null?void 0:ee.close(!1)),$.removeReplicaByShare(te);const ne=M(te,Y[te]);$.addReplica(ne)}});if(_)for(const Y of this.servers)$.sync(Y,_==="continuous");const X=this.onServersChanged(Y=>{if(_){const Q=$.getSyncers();for(const[Z,{description:te,syncer:ee}]of Q)Y.includes(te)||ee.cancel();for(const Z of Y)$.sync(Z,_==="continuous")}});return{peer:$,unsubscribeFromSettings:()=>{z(),V(),X()}}}fireAuthorEvent(){const _=this.author;for(const M of this.authorChangedCbs)M(_)}fireSharesEvent(){const _=this.shares;for(const M of this.sharesChangedCbs)M(_)}fireSecretsEvent(){const _=this.shareSecrets;for(const M of this.shareSecretsChangedCbs)M(_)}fireServersEvent(){const _=this.servers;for(const M of this.serversChangedCbs)M(_)}async redeemInvitationURL(_){const M=await parseInvitationURL(_);if(isErr(M))return M;this.addShare(M.shareAddress);for(const $ of M.servers)this.addServer($);return M.secret&&this.addSecret(M.shareAddress,M.secret),!0}}function makeStorageKey(q,_){return`${EARTHSTAR_KEY}:${_?`${_}:`:""}${q}`}function getParsedValue(q,_,M){const $=q.getItem(_);if($!==null)try{const j=JSON.parse($);return M(j)?j:void 0}catch{return}}function isObject(q){return!(q==null||typeof q!="object")}function isParsedAuthorKeypair(q){return!(!isObject(q)||Object.keys(q).length!==2||!("address"in q)||!("secret"in q))}function isParsedSharesArray(q){return!(!Array.isArray(q)||q.some(_=>typeof _!="string")||q.some(_=>isErr(checkShareIsValid(_))))}function isParsedSecretsDict(q){if(!isObject(q))return!1;for(const _ in q){const M=q[_];if(typeof M!="string"||isErr(Crypto.checkKeypairIsValid({shareAddress:_,secret:M})))return!1}return!0}function isParsedUrlArray(q){if(!Array.isArray(q)||q.some(_=>typeof _!="string"))return!1;for(const _ of q)try{new URL(_)}catch{return!1}return!0}function cubicOut(q){const _=q-1;return _*_*_+1}function fade(q,{delay:_=0,duration:M=400,easing:$=identity}={}){const j=+getComputedStyle(q).opacity;return{delay:_,duration:M,easing:$,css:z=>`opacity: ${z*j}`}}function fly(q,{delay:_=0,duration:M=400,easing:$=cubicOut,x:j=0,y:z=0,opacity:V=0}={}){const X=getComputedStyle(q),G=+X.opacity,Y=X.transform==="none"?"":X.transform,Q=G*(1-V);return{delay:_,duration:M,easing:$,css:(Z,te)=>`
			transform: ${Y} translate(${(1-Z)*j}px, ${(1-Z)*z}px);
			opacity: ${G-Q*te}`}}function scale(q,{delay:_=0,duration:M=400,easing:$=cubicOut,start:j=0,opacity:z=0}={}){const V=getComputedStyle(q),X=+V.opacity,G=V.transform==="none"?"":V.transform,Y=1-j,Q=X*(1-z);return{delay:_,duration:M,easing:$,css:(Z,te)=>`
			transform: ${G} scale(${1-Y*te});
			opacity: ${X-Q*te}
		`}}const subscriber_queue=[];function readable(q,_){return{subscribe:writable(q,_).subscribe}}function writable(q,_=noop){let M;const $=new Set;function j(X){if(safe_not_equal(q,X)&&(q=X,M)){const G=!subscriber_queue.length;for(const Y of $)Y[1](),subscriber_queue.push(Y,q);if(G){for(let Y=0;Y<subscriber_queue.length;Y+=2)subscriber_queue[Y][0](subscriber_queue[Y+1]);subscriber_queue.length=0}}}function z(X){j(X(q))}function V(X,G=noop){const Y=[X,G];return $.add(Y),$.size===1&&(M=_(j)||noop),X(q),()=>{$.delete(Y),$.size===0&&(M(),M=null)}}return{set:j,update:z,subscribe:V}}function derived(q,_,M){const $=!Array.isArray(q),j=$?[q]:q,z=_.length<2;return readable(M,V=>{let X=!1;const G=[];let Y=0,Q=noop;const Z=()=>{if(Y)return;Q();const ee=_($?G[0]:G,V);z?V(ee):Q=is_function(ee)?ee:noop},te=j.map((ee,ne)=>subscribe(ee,re=>{G[ne]=re,Y&=~(1<<ne),X&&Z()},()=>{Y|=1<<ne}));return X=!0,Z(),function(){run_all(te),Q()}})}const authorKeypair=writable({address:"",secret:""});new Logger("storage driver localStorage","gold");const logger$1=new Logger("replica driver indexeddb","gold");function docComparePathASCthenNewestFirst(q,_){return compareArrays([q.path,q.timestamp,q.signature],[_.path,_.timestamp,q.signature],["ASC","DESC","ASC"])}function docComparePathDESCthenNewestFirst(q,_){return compareArrays([q.path,q.timestamp,q.signature],[_.path,_.timestamp,q.signature],["DESC","DESC","ASC"])}const DOCS_STORE="docs",CONFIG_STORE="config";class DocDriverIndexedDB{constructor(_,M){Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"gotInitialMaxLocalIndex",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"localMaxLocalIndex",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1});const $=checkShareIsValid(_);if(isErr($))throw $;if(this.share=_,logger$1.debug("constructor"),!window.indexedDB)throw new EarthstarError("IndexedDB is not supported by this runtime.");const j=dntGlobalThis.indexedDB.open(`earthstar:share_docs:${this.share}${M?`/${M}`:""}`,1);j.onerror=()=>{throw logger$1.error(`Could not open IndexedDB for ${this.share}'s attachments.`),logger$1.error(j.error),new EarthstarError(`Could not open IndexedDB for ${this.share}'s attachments.`)},j.onupgradeneeded=function(){const z=j.result,V=z.createObjectStore(DOCS_STORE,{keyPath:["path","author"]});V.createIndex("comboIndex",["_localIndex","timestamp","path","author"],{unique:!0}),V.createIndex("pathTimestampIndex",["path","timestamp"],{unique:!1}),V.createIndex("pathAuthorIndex",["path","author"],{unique:!0}),V.createIndex("deleteAfterIndex","deleteAfter",{unique:!1}),V.createIndex("localIndexIndex","_localIndex",{unique:!0}),z.createObjectStore(CONFIG_STORE,{keyPath:"key"}).createIndex("keyIndex",["key"],{unique:!0})},j.onsuccess=()=>{this.db.resolve(j.result);const V=j.result.transaction([DOCS_STORE],"readonly").objectStore(DOCS_STORE).index("localIndexIndex").openCursor(null,"prev");V.onsuccess=()=>{V.result?this.gotInitialMaxLocalIndex.resolve(V.result.value._localIndex):this.gotInitialMaxLocalIndex.resolve(-1)}},this.gotInitialMaxLocalIndex.then(z=>{this.localMaxLocalIndex=z})}isClosed(){return this.closed}async close(_){if(this.closed)throw new ReplicaIsClosedError;this.closed=!0;const M=deferred();if(_){const j=(await this.db).transaction([DOCS_STORE,CONFIG_STORE],"readwrite"),z=deferred(),V=deferred(),X=j.objectStore(DOCS_STORE).clear().onsuccess=()=>{z.resolve()},G=j.objectStore(CONFIG_STORE).clear().onsuccess=()=>{V.resolve()};await Promise.all([X,G]),M.resolve()}else M.resolve();return(await this.db).close(),await sleep(20),M}async getMaxLocalIndex(){return await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex}async queryDocs(_){var Q,Z,te,ee,ne,re,se,ie,oe,he,le,ae,ue;const $=(await this.db).transaction([DOCS_STORE],"readonly").objectStore(DOCS_STORE),j=deferred(),{query:z,willMatch:V}=cleanUpQuery(_);if(logger$1.debug(`    cleanUpQuery.  willMatch = ${V}`),V==="nothing")return[];if((Q=z.filter)!=null&&Q.path&&z.historyMode==="latest"){const me=IDBKeyRange.bound([z.filter.path,z.filter.timestampGt||0],[z.filter.path,z.filter.timestampLt||Number.MAX_SAFE_INTEGER]),ce=$.index("pathTimestampIndex").openCursor(me,"prev");ce.onsuccess=()=>{var _e;(_e=ce.result)!=null&&_e.value?j.resolve([ce.result.value]):j.resolve([])}}else if((Z=z.filter)!=null&&Z.path&&z.historyMode==="all"){const me=$.index("pathAuthorIndex"),fe=IDBKeyRange.bound([z.filter.path," "],[z.filter.path,"~"]),ce=me.getAll(fe);ce.onsuccess=()=>{ce.result?j.resolve(Array.from(ce.result)):j.resolve([])}}else{const me=((te=z.startAfter)==null?void 0:te.path)||((ee=z.filter)==null?void 0:ee.path)||((ne=z.filter)==null?void 0:ne.pathStartsWith)||" ",fe=((re=z.filter)==null?void 0:re.author)||" ",ce=((se=z.filter)==null?void 0:se.timestamp)||((ie=z.filter)==null?void 0:ie.timestampGt)||0,_e=((oe=z.startAfter)==null?void 0:oe.localIndex)||0,we=((he=z.filter)==null?void 0:he.path)||"~",ge=((le=z.filter)==null?void 0:le.author)||"~",Ae=((ae=z.filter)==null?void 0:ae.timestamp)||((ue=z.filter)==null?void 0:ue.timestampLt)||Number.MAX_SAFE_INTEGER,de=Number.MAX_SAFE_INTEGER,De=IDBKeyRange.bound([_e,ce,me,fe],[de,Ae,we,ge]),Ee=$.index("comboIndex").getAll(De);Ee.onsuccess=()=>{Ee.result?j.resolve(Ee.result):j.resolve([])}}const X=await j;if(z.historyMode==="latest"){const me=X.splice(0,X.length),fe=new Map;for(const ce of me){const _e=fe.get(ce.path);(!_e||_e.timestamp<ce.timestamp)&&fe.set(ce.path,ce)}X.push(...fe.values())}const G=[];logger$1.debug("    filtering docs");const Y=Date.now()*1e3;for(const me of X)me.deleteAfter&&me.deleteAfter<Y||z.filter&&!docMatchesFilter(me,z.filter)||G.push(me);if(logger$1.debug(`    ordering docs: ${z.orderBy}`),z.orderBy==="path ASC")G.sort(docComparePathASCthenNewestFirst);else if(z.orderBy==="path DESC")G.sort(docComparePathDESCthenNewestFirst);else if(z.orderBy==="localIndex ASC")G.sort(compareByObjKey("_localIndex","ASC"));else if(z.orderBy==="localIndex DESC")G.sort(compareByObjKey("_localIndex","DESC"));else if(z.orderBy)throw new ValidationError("unrecognized query orderBy: "+JSON.stringify(z.orderBy));return z.limit!==void 0&&X.length>=z.limit?G.slice(0,z.limit):(logger$1.debug(`    queryDocs is done: found ${G.length} docs.`),G)}async upsert(_){const M=await this.db,j=M.transaction([DOCS_STORE],"readwrite").objectStore(DOCS_STORE).index("pathAuthorIndex"),z=deferred(),V=j.openCursor([_.path,_.author]);if(await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex+=1,_._localIndex=this.localMaxLocalIndex,V.onsuccess=()=>{if(V.result){const Z=V.result.update(_);Z.onsuccess=()=>{z.resolve(!!Z.result)}}else z.resolve(!1)},await z)return _;const Y=M.transaction([DOCS_STORE],"readwrite").objectStore(DOCS_STORE).put(_),Q=deferred();return Y.onsuccess=()=>{Q.resolve()},Y.onerror=()=>{throw Y.error},await Q,_}async eraseExpiredDocs(){const _=[],j=(await this.db).transaction([DOCS_STORE],"readwrite").objectStore(DOCS_STORE).index("deleteAfterIndex"),z=Date.now()*1e3,V=IDBKeyRange.bound(0,z),X=j.openCursor(V),G=deferred();return X.onsuccess=()=>{var Y;if((Y=X.result)!=null&&Y.value){const Q=X.result.value;if(Q.deleteAfter!==null&&Q.deleteAfter!==void 0){_.push(Q);const Z=X.result.delete();Z.onsuccess=()=>{var te;(te=X.result)==null||te.continue()}}}else G.resolve()},await G,_}async getConfig(_){const $=(await this.db).transaction([CONFIG_STORE],"readonly").objectStore(CONFIG_STORE),j=deferred(),z=$.get(_);return z.onsuccess=()=>{var V;j.resolve((V=z.result)==null?void 0:V.value)},j}async setConfig(_,M){const j=(await this.db).transaction([CONFIG_STORE],"readwrite").objectStore(CONFIG_STORE),z=deferred(),V=j.put({key:_,value:M});return V.onsuccess=()=>{z.resolve()},z}async listConfigKeys(){const M=(await this.db).transaction([CONFIG_STORE],"readonly").objectStore(CONFIG_STORE),$=deferred(),z=M.index("keyIndex").openKeyCursor(),V=[];return z.onsuccess=()=>{z.result?(V.push(z.result.primaryKey),z.result.continue()):$.resolve(V)},$}async deleteConfig(_){const $=(await this.db).transaction([CONFIG_STORE],"readwrite").objectStore(CONFIG_STORE),j=deferred(),z=$.index("keyIndex"),V=IDBKeyRange.bound([_],[_]),X=z.openCursor(V);return X.onsuccess=()=>{if(X.result){const G=X.result.delete();G.onsuccess=()=>{j.resolve(!0)}}else j.resolve(!1)},j}}const logger=new Logger("replica driver indexeddb","gold"),ATTACHMENT_STAGING_STORE="attachment_staging_index",ATTACHMENT_INDEX_STORE="attachments_index",ATTACHMENT_BYTES_STORE="attachments_bytes";class AttachmentDriverIndexedDB{constructor(_,M){if(Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.share=_,!window.indexedDB)throw new EarthstarError("IndexedDB is not supported by this runtime.");const $=dntGlobalThis.indexedDB.open(`earthstar:share_attachments:${this.share}${M?`/${M}`:""}`,1);$.onerror=()=>{throw logger.error(`Could not open IndexedDB for ${this.share}'s attachments.`),logger.error($.error),new EarthstarError(`Could not open IndexedDB for ${this.share}'s attachments.`)},$.onupgradeneeded=function(){const j=$.result;j.createObjectStore(ATTACHMENT_BYTES_STORE),j.createObjectStore(ATTACHMENT_INDEX_STORE,{keyPath:"id"}),j.createObjectStore(ATTACHMENT_STAGING_STORE,{keyPath:"id"})},$.onsuccess=()=>{this.db.resolve($.result)}}getIndexKey(_,M){return`${_}___${M}`}async getAttachment(_,M){if(this.closed)throw new ReplicaIsClosedError;const $=deferred(),j=this.getIndexKey(_,M),z=await this.db,X=z.transaction([ATTACHMENT_INDEX_STORE],"readonly").objectStore(ATTACHMENT_INDEX_STORE).get(j),G=deferred();return X.onerror=()=>{G.reject()},X.onsuccess=()=>{X.result===void 0?G.reject():G.resolve(X.result.blobKey)},G.then(Y=>{const Z=z.transaction([ATTACHMENT_BYTES_STORE],"readonly").objectStore(ATTACHMENT_BYTES_STORE).get(Y);Z.onsuccess=()=>{const te=new Blob$1([Z.result]);$.resolve({bytes:async()=>new Uint8Array(await te.arrayBuffer()),stream:()=>Promise.resolve(te.stream())})},Z.onerror=()=>{$.resolve(void 0)}}).catch(()=>{$.resolve(void 0)}),$}async erase(_,M){if(this.closed)throw new ReplicaIsClosedError;const $=deferred(),j=this.getIndexKey(_,M),z=await this.db,X=z.transaction([ATTACHMENT_INDEX_STORE],"readonly").objectStore(ATTACHMENT_INDEX_STORE).get(j),G=deferred();return X.onerror=()=>{G.reject()},X.onsuccess=()=>{z.transaction([ATTACHMENT_INDEX_STORE],"readwrite").objectStore(ATTACHMENT_INDEX_STORE).delete(j),X.result===void 0?G.reject():G.resolve(X.result.blobKey)},G.then(Y=>{const Q=z.transaction([ATTACHMENT_BYTES_STORE],"readwrite").objectStore(ATTACHMENT_BYTES_STORE).delete(Y);Q.onsuccess=()=>{$.resolve(!0)},Q.onerror=()=>{$.resolve(void 0)}}).catch(()=>{$.resolve(new ValidationError("No attachment found"))}),$}async stage(_,M){if(this.closed)throw new ReplicaIsClosedError;const $=await this.db,j=M instanceof Uint8Array?M:await streamToBytes(M),z=await Crypto.sha256base32(j),V=this.getIndexKey(_,z),X=`${V}___${randomId()}`,G=$.transaction([ATTACHMENT_BYTES_STORE,ATTACHMENT_STAGING_STORE],"readwrite"),Y=G.objectStore(ATTACHMENT_BYTES_STORE).put(j,X),Q=G.objectStore(ATTACHMENT_STAGING_STORE).put({id:V,blobKey:X}),Z=deferred(),te=deferred();return Y.onsuccess=()=>Z.resolve(),Q.onsuccess=()=>te.resolve(),await Z,await te,{hash:z,size:j.byteLength,reject:async()=>{const ee=$.transaction([ATTACHMENT_BYTES_STORE,ATTACHMENT_STAGING_STORE],"readwrite"),ne=ee.objectStore(ATTACHMENT_BYTES_STORE).delete(X),re=ee.objectStore(ATTACHMENT_STAGING_STORE).delete(V),se=deferred(),ie=deferred();ne.onsuccess=()=>{se.resolve()},re.onsuccess=()=>{ie.resolve()},await Promise.all([se,ie])},commit:async()=>{const ee=$.transaction([ATTACHMENT_INDEX_STORE,ATTACHMENT_STAGING_STORE],"readwrite"),ne=ee.objectStore(ATTACHMENT_STAGING_STORE).delete(V),re=ee.objectStore(ATTACHMENT_INDEX_STORE).put({id:V,blobKey:X}),se=deferred(),ie=deferred();ne.onsuccess=()=>se.resolve(),re.onsuccess=()=>ie.resolve(),await Promise.all([se,ie])}}}async wipe(){if(this.closed)throw new ReplicaIsClosedError;const M=(await this.db).transaction([ATTACHMENT_BYTES_STORE,ATTACHMENT_INDEX_STORE,ATTACHMENT_STAGING_STORE],"readwrite"),$=M.objectStore(ATTACHMENT_BYTES_STORE).clear(),j=M.objectStore(ATTACHMENT_INDEX_STORE).clear(),z=M.objectStore(ATTACHMENT_STAGING_STORE).clear(),V=deferred(),X=deferred(),G=deferred();$.onsuccess=()=>V.resolve(),j.onsuccess=()=>X.resolve(),z.onsuccess=()=>G.resolve(),await Promise.all([V,X,G])}async clearStaging(){if(this.closed)throw new ReplicaIsClosedError;const M=(await this.db).transaction([ATTACHMENT_BYTES_STORE,ATTACHMENT_STAGING_STORE]),$=M.objectStore(ATTACHMENT_STAGING_STORE).openCursor(),j=deferred();return $.onsuccess=()=>{const z=$.result;if(!z){j.resolve();return}const V=z.value.blobKey,X=M.objectStore(ATTACHMENT_BYTES_STORE).delete(V);z.delete(),X.onsuccess=()=>{z.continue()},X.onerror=()=>{z.continue()}},j}async filter(_){if(this.closed)throw new ReplicaIsClosedError;const $=(await this.db).transaction([ATTACHMENT_BYTES_STORE,ATTACHMENT_INDEX_STORE],"readwrite"),j=50,z=[],V=[],X=deferred(),G=(Y=null)=>{const Q=$.objectStore(ATTACHMENT_INDEX_STORE).getAll(Y,j);Q.onsuccess=()=>{const Z=Q.result;for(const te of Z){const[ee,ne]=te.id.split("___");_[ee]&&!_[ee].has(ne)&&(z.push({format:ee,hash:ne}),V.push(this.erase(ee,ne)))}if(Z.length===j){const te=Z[Z.length-1],ee=IDBKeyRange.lowerBound(te.id,!0);G(ee)}else X.resolve()}};return G(),await X,await Promise.all(V),z}isClosed(){return this.closed}async close(_){if(this.closed)throw new ReplicaIsClosedError;_&&await this.wipe(),this.closed=!0,(await this.db).close(),await sleep(20)}}class ReplicaDriverWeb{constructor(_,M){Object.defineProperty(this,"docDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachmentDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.docDriver=new DocDriverIndexedDB(_,M),this.attachmentDriver=new AttachmentDriverIndexedDB(_,M)}}const initialKeypair={shareAddress:"+commons.b7q4gt64yiefosdafnmhvtxz43akzk6gw54aesdahtf4kdgpbyeia",secret:"bigzorlvyjy5fy5a3kglfzcyfzramsic3cihj4rqphmd6x5wo5jcq"},shareKeypair=writable(initialKeypair),replicaDetails=writable(null);shareKeypair.subscribe(q=>{console.log("shareKeypair store changed:",q);const _=q.shareAddress,M=q.secret,$=new Replica({driver:new ReplicaDriverWeb(_),shareSecret:M});replicaDetails.set({replica:$})});const settings=new SharedSettings,shares=writable(settings.shares);settings.onSharesChanged(q=>{shares.set(q)});function removeShare(q){const _=settings.removeShare(q);Array.isArray(_)?shares.set(_):console.error(_)}function updateShares(q){shares.set(q)}const studioShares=derived(shares,q=>q.filter(_=>_.includes("studio"))),UploadId_svelte_svelte_type_style_lang="";function create_fragment$$(q){let _,M,$,j,z;return{c(){_=element("input"),M=space(),$=element("button"),$.innerHTML=`Upload ID

    <span class="tooltiptext svelte-zq0ldm">It is a JSON file</span>`,set_style(_,"display","none"),attr(_,"type","file"),attr(_,"accept",".json, .txt"),attr($,"class","tooltip phase1 mx-4 my-2 svelte-zq0ldm")},m(V,X){insert(V,_,X),q[4](_),insert(V,M,X),insert(V,$,X),j||(z=[listen(_,"change",q[3]),listen($,"click",q[5])],j=!0)},p:noop,i:noop,o:noop,d(V){V&&detach(_),q[4](null),V&&detach(M),V&&detach($),j=!1,run_all(z)}}}function readFileAsync$1(q){return new Promise((_,M)=>{let $=new FileReader;$.onload=()=>{_($.result)},$.onerror=M,$.readAsBinaryString(q)})}function instance$Y(q,_,M){const $=createEventDispatcher();let j,z,{identityPg:V=!1}=_;async function X(Z){let te=Z.target.files[0],ee=await readFileAsync$1(te);try{let ne=JSON.parse(ee);console.log(typeof ne),console.log("fileReady",ee);let re=ne.address;console.log("authorAddress",re);let se=ne.secret;console.log("authorSecret",se),authorKeypair.set({address:re,secret:se}),z=re.slice(1,5),$("alias",z)}catch{$("error")}}const G=Z=>X(Z);function Y(Z){binding_callbacks[Z?"unshift":"push"](()=>{j=Z,M(0,j)})}const Q=()=>{j.click()};return q.$$set=Z=>{"identityPg"in Z&&M(2,V=Z.identityPg)},[j,X,V,G,Y,Q]}class UploadId extends SvelteComponent{constructor(_){super(),init(this,_,instance$Y,create_fragment$$,safe_not_equal,{identityPg:2})}}const ValidateId_svelte_svelte_type_style_lang="";function create_if_block$v(q){let _,M;return{c(){_=element("p"),M=text(q[1]),attr(_,"class","text-2xl")},m($,j){insert($,_,j),append(_,M)},p($,j){j&2&&set_data(M,$[1])},d($){$&&detach(_)}}}function create_fragment$_(q){let _,M,$,j,z,V,X,G,Y,Q,Z,te,ee;Y=new UploadId({}),Y.$on("alias",q[4]),Y.$on("error",q[5]);let ne=q[1]&&create_if_block$v(q);return{c(){_=element("div"),M=element("label"),M.textContent="Have an existing ID?",$=space(),j=element("div"),z=element("textarea"),V=space(),X=element("button"),X.textContent="Validate ID",G=space(),create_component(Y.$$.fragment),Q=space(),ne&&ne.c(),attr(M,"for","keypair"),attr(z,"class","px-5 my-2 svelte-5at67e"),attr(z,"id","keypair"),attr(z,"placeholder",`Paste it here:       
{
"address": "", 
"secret": ""
}`),attr(X,"class","phase1 mx-4 my-2"),attr(j,"class","flex md:flex-row items-end mx-0 flex-col svelte-5at67e"),attr(_,"class","flex flex-col items-start mx-0 svelte-5at67e")},m(re,se){insert(re,_,se),append(_,M),append(_,$),append(_,j),append(j,z),set_input_value(z,q[0]),append(j,V),append(j,X),append(j,G),mount_component(Y,j,null),append(_,Q),ne&&ne.m(_,null),Z=!0,te||(ee=[listen(z,"input",q[3]),listen(X,"click",q[2])],te=!0)},p(re,[se]){se&1&&set_input_value(z,re[0]),re[1]?ne?ne.p(re,se):(ne=create_if_block$v(re),ne.c(),ne.m(_,null)):ne&&(ne.d(1),ne=null)},i(re){Z||(transition_in(Y.$$.fragment,re),Z=!0)},o(re){transition_out(Y.$$.fragment,re),Z=!1},d(re){re&&detach(_),destroy_component(Y),ne&&ne.d(),te=!1,run_all(ee)}}}function instance$X(q,_,M){const $=createEventDispatcher();let j="",z="";function V(){try{let Q=JSON.parse(j);Q.address&&Q.secret?isErr(checkAuthorIsValid(Q.address))?(M(1,z="Invalid address"),$("error")):(authorKeypair.set({address:Q.address,secret:Q.secret}),settings.author=Q,$("validated")):(M(1,z="Invalid keypair"),$("error"))}catch{M(1,z="Invalid JSON"),$("error")}}function X(){j=this.value,M(0,j)}function G(Q){bubble.call(this,q,Q)}function Y(Q){bubble.call(this,q,Q)}return[j,z,V,X,G,Y]}class ValidateId extends SvelteComponent{constructor(_){super(),init(this,_,instance$X,create_fragment$_,safe_not_equal,{})}}const Identity_svelte_svelte_type_style_lang="";function create_if_block_5$6(q){let _,M,$,j,z;return{c(){_=element("h4"),_.textContent="Your current Identity Keypair:",M=space(),$=element("h4"),j=element("b"),z=text(q[1]),attr($,"class","my-4")},m(V,X){insert(V,_,X),insert(V,M,X),insert(V,$,X),append($,j),append(j,z)},p(V,X){X&2&&set_data(z,V[1])},d(V){V&&detach(_),V&&detach(M),V&&detach($)}}}function create_if_block_1$l(q){let _,M,$;function j(X,G){return X[5]==="ID must be 4 characters long"?create_if_block_2$j:X[5]==="ID must start with a letter"?create_if_block_3$e:X[5]==="ID must not contain special characters"?create_if_block_4$9:create_else_block$d}let z=j(q),V=z(q);return{c(){_=element("blockquote"),V.c()},m(X,G){insert(X,_,G),V.m(_,null),$=!0},p(X,G){z!==(z=j(X))&&(V.d(1),V=z(X),V&&(V.c(),V.m(_,null)))},i(X){$||(add_render_callback(()=>{M||(M=create_bidirectional_transition(_,fly,{y:200,duration:2e3},!0)),M.run(1)}),$=!0)},o(X){M||(M=create_bidirectional_transition(_,fly,{y:200,duration:2e3},!1)),M.run(0),$=!1},d(X){X&&detach(_),V.d(),X&&M&&M.end()}}}function create_else_block$d(q){let _;return{c(){_=text("Press enter to generate a new keypair.")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_4$9(q){let _;return{c(){_=element("i"),_.innerHTML=`<strong>Special characters are not allowed.</strong> 
                    <br/>`},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_3$e(q){let _;return{c(){_=element("i"),_.innerHTML="<strong>A valid alias must begin with a letter.</strong> It needs to be 4 characters long and can only contain letters and numbers."},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_2$j(q){let _;return{c(){_=element("i"),_.innerHTML="A valid id <strong>needs to be 4 characters long</strong>."},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block$u(q){let _,M,$;return{c(){_=element("blockquote"),_.innerHTML="<strong>Please upload a valid identity file</strong>"},m(j,z){insert(j,_,z),$=!0},i(j){$||(add_render_callback(()=>{M||(M=create_bidirectional_transition(_,fly,{y:200,duration:2e3},!0)),M.run(1)}),$=!0)},o(j){M||(M=create_bidirectional_transition(_,fly,{y:200,duration:2e3},!1)),M.run(0),$=!1},d(j){j&&detach(_),j&&M&&M.end()}}}function create_fragment$Z(q){let _,M,$,j,z,V,X,G,Y,Q,Z,te,ee,ne,re,se,ie,oe,he,le,ae,ue,me,fe,ce,_e,we,ge,Ae,de,De,Me,Ee,Te,xe,He=q[3].address.length!==0&&create_if_block_5$6(q),Oe=q[6]&&create_if_block_1$l(q),$e=q[7]===!0&&create_if_block$u();return{c(){_=element("div"),He&&He.c(),M=space(),$=element("div"),$.textContent="Your identity is represented by the keypair seen below. It contains your address and secret.",j=space(),z=element("div"),V=element("div"),X=element("b"),X.textContent="Address:",G=space(),Y=text(q[2]),Q=space(),Z=element("br"),te=space(),ee=element("b"),ee.textContent="Secret:",ne=space(),re=text(q[8]),se=space(),ie=element("div"),oe=text(`You can

        `),he=element("button"),he.textContent="generate another identity",le=text(`

    or customize your alias in the box below.`),ae=space(),ue=element("div"),me=text(`Your alias is 
    `),fe=element("input"),ce=space(),_e=element("div"),_e.textContent="You can download it and reuse it later.",we=space(),ge=element("div"),Ae=element("button"),Ae.textContent="Download your identity file",de=space(),De=element("div"),Oe&&Oe.c(),Me=space(),$e&&$e.c(),attr(z,"class","my-6"),attr(he,"class","phase1 svelte-3j8vy0"),attr(fe,"type","text"),attr(fe,"spellcheck","false"),attr(fe,"maxlength","4"),attr(fe,"class","svelte-3j8vy0"),attr(ue,"class","my-4"),attr(_e,"class","mt-6"),attr(Ae,"class","phase1 w-auto svelte-3j8vy0"),attr(ge,"class","flex items-start align-left flex-col"),attr(_,"class","p-4 w-full text-left")},m(Pe,ve){insert(Pe,_,ve),He&&He.m(_,null),append(_,M),append(_,$),append(_,j),append(_,z),append(z,V),append(V,X),append(V,G),append(V,Y),append(V,Q),append(V,Z),append(V,te),append(V,ee),append(V,ne),append(V,re),append(_,se),append(_,ie),append(ie,oe),append(ie,he),append(ie,le),append(_,ae),append(_,ue),append(ue,me),append(ue,fe),set_input_value(fe,q[4]),append(_,ce),append(_,_e),append(_,we),append(_,ge),append(ge,Ae),append(_,de),append(_,De),Oe&&Oe.m(De,null),append(De,Me),$e&&$e.m(De,null),Ee=!0,Te||(xe=[listen(he,"click",q[10]),listen(fe,"input",q[11]),listen(fe,"keypress",q[12]),listen(fe,"focus",q[13]),listen(fe,"keypress",q[14]),listen(Ae,"click",q[15])],Te=!0)},p(Pe,[ve]){Pe[3].address.length!==0?He?He.p(Pe,ve):(He=create_if_block_5$6(Pe),He.c(),He.m(_,M)):He&&(He.d(1),He=null),(!Ee||ve&4)&&set_data(Y,Pe[2]),(!Ee||ve&256)&&set_data(re,Pe[8]),ve&16&&fe.value!==Pe[4]&&set_input_value(fe,Pe[4]),Pe[6]?Oe?(Oe.p(Pe,ve),ve&64&&transition_in(Oe,1)):(Oe=create_if_block_1$l(Pe),Oe.c(),transition_in(Oe,1),Oe.m(De,Me)):Oe&&(group_outros(),transition_out(Oe,1,1,()=>{Oe=null}),check_outros()),Pe[7]===!0?$e?ve&128&&transition_in($e,1):($e=create_if_block$u(),$e.c(),transition_in($e,1),$e.m(De,null)):$e&&(group_outros(),transition_out($e,1,1,()=>{$e=null}),check_outros())},i(Pe){Ee||(transition_in(Oe),transition_in($e),Ee=!0)},o(Pe){transition_out(Oe),transition_out($e),Ee=!1},d(Pe){Pe&&detach(_),He&&He.d(),Oe&&Oe.d(),$e&&$e.d(),Te=!1,run_all(xe)}}}function isNumber(q){return/[0-9]/.test(q)}function isSpecialChar(q){return/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(q)}function RandomId(){let q="",_="abcdefghijklmnopqrstuvwxyz",M=_.length,$="abcdefghijklmnopqrstuvwxyz0123456789",j=$.length;q+=_.charAt(Math.floor(Math.random()*M));for(let z=0;z<3;z++)q+=$.charAt(Math.floor(Math.random()*j));return q}function instance$W(q,_,M){let $,j,z,V;component_subscribe(q,authorKeypair,he=>M(3,V=he));let X,G,Y=!1,Q=!1;function Z(){let he=document.createElement("a"),le=new Blob([JSON.stringify(V)],{type:"text/plain"}),ae=V.address+".json";he.href=URL.createObjectURL(le),he.download=ae,he.style.display="none",document.body.appendChild(he),he.click()}async function te(he){he=="r"&&M(4,X=RandomId());let le=X.slice(0,1);if(isNumber(le))console.log("firstChar",le),M(5,G="ID must start with a letter");else if(X.length!==4)M(5,G="ID must be 4 characters long");else if(isSpecialChar(X))M(5,G="ID must not contain special characters");else{let ae=await Crypto.generateAuthorKeypair(X),ue=ae.address,me=ae.secret;authorKeypair.set({address:ue,secret:me}),M(5,G=null),M(6,Y=!1),settings.author=ae}}onMount(async()=>{settings.author?authorKeypair.set(settings.author):te("r")});const ee=()=>te("r");function ne(){X=this.value,M(4,X),M(1,z),M(2,$),M(3,V)}const re=()=>{M(6,Y=!0)},se=()=>{M(6,Y=!0)},ie=()=>te(),oe=()=>Z();return q.$$.update=()=>{q.$$.dirty&8&&M(2,$=V.address),q.$$.dirty&8&&M(8,j=V.secret),q.$$.dirty&4&&M(1,z=$.slice(0,5)),q.$$.dirty&2&&M(4,X=z.slice(1,5))},[te,z,$,V,X,G,Y,Q,j,Z,ee,ne,re,se,ie,oe]}class Identity extends SvelteComponent{constructor(_){super(),init(this,_,instance$W,create_fragment$Z,safe_not_equal,{generateID:0})}get generateID(){return this.$$.ctx[0]}}const FileSharing_svelte_svelte_type_style_lang="";function create_fragment$Y(q){let _,M,$,j,z;return{c(){_=element("div"),M=element("div"),$=element("button"),$.textContent="file upload",attr($,"class","phase1"),attr(M,"class","svelte-1483hci"),attr(_,"class","svelte-1483hci")},m(V,X){insert(V,_,X),append(_,M),append(M,$),j||(z=[listen($,"click",q[0]),listen($,"keypress",q[0])],j=!0)},p:noop,i:noop,o:noop,d(V){V&&detach(_),j=!1,run_all(z)}}}function instance$V(q,_,M){const $=createEventDispatcher();let{xy:j=void 0}=_;function z(){$("selected",{type:"file",location:j})}return q.$$set=V=>{"xy"in V&&M(1,j=V.xy)},[z,j]}class FileSharing extends SvelteComponent{constructor(_){super(),init(this,_,instance$V,create_fragment$Y,safe_not_equal,{xy:1})}}const cacheDetails=writable(null);replicaDetails.subscribe(q=>{if(!q||!q.replica){console.error("Replica is undefined or does not contain a valid replica property");return}try{const _=new ReplicaCache(q.replica);cacheDetails.set(_)}catch(_){console.error("Failed to create new cache:",_)}});const time=readable(new Date,function(_){const M=setInterval(()=>{_(new Date)},1e3);return function(){clearInterval(M)}}),start=new Date,elapsed=derived(time,q=>Math.round((Number(q)-Number(start))/1e3)),Voice_svelte_svelte_type_style_lang$1="";function create_fragment$X(q){let _,M,$,j;return{c(){_=element("div"),M=element("button"),M.textContent="record audio",attr(M,"class","phase1"),attr(_,"class","svelte-lllvde")},m(z,V){insert(z,_,V),append(_,M),$||(j=listen(M,"click",q[0]),$=!0)},p:noop,i:noop,o:noop,d(z){z&&detach(_),$=!1,j()}}}function instance$U(q,_,M){const $=createEventDispatcher();let{xy:j=void 0}=_;function z(){$("selected",{type:"audio",location:j})}return q.$$set=V=>{"xy"in V&&M(1,j=V.xy)},[z,j]}let Voice$1=class extends SvelteComponent{constructor(_){super(),init(this,_,instance$U,create_fragment$X,safe_not_equal,{xy:1})}};const TextInput_svelte_svelte_type_style_lang="";function create_fragment$W(q){let _,M,$,j,z;return{c(){_=element("div"),M=element("div"),$=element("button"),$.textContent="written text",attr($,"class","phase1"),attr(M,"class","svelte-j8m7xm"),attr(_,"class","svelte-j8m7xm")},m(V,X){insert(V,_,X),append(_,M),append(M,$),j||(z=listen($,"click",q[0]),j=!0)},p:noop,i:noop,o:noop,d(V){V&&detach(_),j=!1,z()}}}function instance$T(q,_,M){const $=createEventDispatcher();let{xy:j=[0,0]}=_;function z(){$("selected",{type:"text",location:j})}return q.$$set=V=>{"xy"in V&&M(1,j=V.xy)},[z,j]}class TextInput extends SvelteComponent{constructor(_){super(),init(this,_,instance$T,create_fragment$W,safe_not_equal,{xy:1})}}const GridUpload_svelte_svelte_type_style_lang="";function get_each_context$b(q,_,M){const $=q.slice();return $[19]=_[M],$[21]=M,$}function get_each_context_1$3(q,_,M){const $=q.slice();return $[19]=_[M],$[23]=M,$}function create_if_block$t(q){let _,M,$,j,z,V=mapNumberToLetter$1(q[5][1])+"",X,G,Y=q[5][0]+1+"",Q,Z,te,ee,ne,re,se,ie,oe,he,le,ae,ue;return ee=new TextInput({props:{xy:q[5]}}),ee.$on("selected",q[11]),re=new FileSharing({props:{xy:q[5]}}),re.$on("selected",q[12]),ie=new Voice$1({props:{xy:q[5]}}),ie.$on("selected",q[13]),{c(){_=element("div"),M=element("div"),$=text(`What artefact would you like to create? 
      `),j=element("br"),z=space(),X=text(V),G=text(", "),Q=text(Y),Z=space(),te=element("div"),create_component(ee.$$.fragment),ne=space(),create_component(re.$$.fragment),se=space(),create_component(ie.$$.fragment),oe=space(),he=element("button"),he.textContent="close",attr(M,"class","mt-6 brown text-left px-6 svelte-beup2s"),attr(he,"class","phase1"),attr(te,"class","flex-col"),attr(_,"class","modal pb-6  svelte-beup2s"),attr(_,"style",q[6])},m(me,fe){insert(me,_,fe),append(_,M),append(M,$),append(M,j),append(M,z),append(M,X),append(M,G),append(M,Q),append(_,Z),append(_,te),mount_component(ee,te,null),append(te,ne),mount_component(re,te,null),append(te,se),mount_component(ie,te,null),append(te,oe),append(te,he),le=!0,ae||(ue=listen(he,"click",q[8]),ae=!0)},p(me,fe){(!le||fe&32)&&V!==(V=mapNumberToLetter$1(me[5][1])+"")&&set_data(X,V),(!le||fe&32)&&Y!==(Y=me[5][0]+1+"")&&set_data(Q,Y);const ce={};fe&32&&(ce.xy=me[5]),ee.$set(ce);const _e={};fe&32&&(_e.xy=me[5]),re.$set(_e);const we={};fe&32&&(we.xy=me[5]),ie.$set(we),(!le||fe&64)&&attr(_,"style",me[6])},i(me){le||(transition_in(ee.$$.fragment,me),transition_in(re.$$.fragment,me),transition_in(ie.$$.fragment,me),le=!0)},o(me){transition_out(ee.$$.fragment,me),transition_out(re.$$.fragment,me),transition_out(ie.$$.fragment,me),le=!1},d(me){me&&detach(_),destroy_component(ee),destroy_component(re),destroy_component(ie),ae=!1,ue()}}}function create_each_block_1$3(q,_){let M,$=mapNumberToLetter$1(_[23])+"",j,z,V=_[21]+1+"",X,G,Y,Q;function Z(){return _[14](_[21],_[23])}function te(){return _[15](_[21],_[23])}return{key:q,first:null,c(){M=element("div"),j=text($),z=text(", "),X=text(V),G=space(),set_style(M,"display","flex"),set_style(M,"justify-content","center"),set_style(M,"align-items","center"),set_style(M,"height","100%"),attr(M,"class","svelte-beup2s"),toggle_class(M,"active",_[4][_[21]][_[23]]),this.first=M},m(ee,ne){insert(ee,M,ne),append(M,j),append(M,z),append(M,X),append(M,G),Y||(Q=[listen(M,"click",Z),listen(M,"keypress",te)],Y=!0)},p(ee,ne){_=ee,ne&1&&$!==($=mapNumberToLetter$1(_[23])+"")&&set_data(j,$),ne&1&&V!==(V=_[21]+1+"")&&set_data(X,V),ne&17&&toggle_class(M,"active",_[4][_[21]][_[23]])},d(ee){ee&&detach(M),Y=!1,run_all(Q)}}}function create_each_block$b(q,_){let M,$=[],j=new Map,z,V={length:_[0][1]};const X=G=>G[23];for(let G=0;G<V.length;G+=1){let Y=get_each_context_1$3(_,V,G),Q=X(Y);j.set(Q,$[G]=create_each_block_1$3(Q,Y))}return{key:q,first:null,c(){M=empty();for(let G=0;G<$.length;G+=1)$[G].c();z=empty(),this.first=M},m(G,Y){insert(G,M,Y);for(let Q=0;Q<$.length;Q+=1)$[Q].m(G,Y);insert(G,z,Y)},p(G,Y){_=G,Y&145&&(V={length:_[0][1]},$=update_keyed_each($,Y,X,1,_,V,j,z.parentNode,destroy_block,create_each_block_1$3,z,get_each_context_1$3))},d(G){G&&detach(M);for(let Y=0;Y<$.length;Y+=1)$[Y].d(G);G&&detach(z)}}}function create_fragment$V(q){let _,M,$,j,z,V,X,G=[],Y=new Map,Q,Z=q[1]&&create_if_block$t(q),te={length:q[0][0]};const ee=ne=>ne[21];for(let ne=0;ne<te.length;ne+=1){let re=get_each_context$b(q,te,ne),se=ee(re);Y.set(se,G[ne]=create_each_block$b(se,re))}return{c(){_=element("div"),M=element("div"),Z&&Z.c(),$=space(),j=element("div"),z=element("h4"),z.textContent="Select location on map",V=space(),X=element("div");for(let ne=0;ne<G.length;ne+=1)G[ne].c();attr(z,"class","svelte-beup2s"),attr(X,"class","container svelte-beup2s"),set_style(X,"grid-template-rows",q[3]),set_style(X,"grid-template-columns",q[2]),attr(j,"class","w-4/5"),set_style(M,"position","relative"),set_style(M,"z-index","52"),set_style(_,"position","fixed")},m(ne,re){insert(ne,_,re),append(_,M),Z&&Z.m(M,null),append(M,$),append(M,j),append(j,z),append(j,V),append(j,X);for(let se=0;se<G.length;se+=1)G[se].m(X,null);Q=!0},p(ne,[re]){ne[1]?Z?(Z.p(ne,re),re&2&&transition_in(Z,1)):(Z=create_if_block$t(ne),Z.c(),transition_in(Z,1),Z.m(M,$)):Z&&(group_outros(),transition_out(Z,1,1,()=>{Z=null}),check_outros()),re&145&&(te={length:ne[0][0]},G=update_keyed_each(G,re,ee,1,ne,te,Y,X,destroy_block,create_each_block$b,null,get_each_context$b)),(!Q||re&8)&&set_style(X,"grid-template-rows",ne[3]),(!Q||re&4)&&set_style(X,"grid-template-columns",ne[2])},i(ne){Q||(transition_in(Z),Q=!0)},o(ne){transition_out(Z),Q=!1},d(ne){ne&&detach(_),Z&&Z.d();for(let re=0;re<G.length;re+=1)G[re].d()}}}function mapNumberToLetter$1(q){return String.fromCharCode(65+q)}function instance$S(q,_,M){let $,{windowWidth:j}=_,z,V,X,G,Y=[],Q=!1,Z=["0px","0px"];function te(ae,ue){M(5,Y=[ae,ue]),ne([ae,ue]),setTimeout(()=>{M(1,Q=!0),M(10,Z=[ae*50+"px",ue*50+50+"px"])},500)}function ee([ae,ue],[me,fe]){return(ae-Y[0])*(ae-me)<=0&&(ue-Y[1])*(ue-fe)<=0}function ne(ae){M(4,G=G.map((ue,me)=>ue.map((fe,ce)=>ee([me,ce],ae))))}function re(){M(1,Q=!1),M(4,G=Array(z[0]).fill(0).map(ae=>Array(z[1]).fill(!1)))}function se(ae){bubble.call(this,q,ae)}function ie(ae){bubble.call(this,q,ae)}function oe(ae){bubble.call(this,q,ae)}const he=(ae,ue)=>te(ae,ue),le=(ae,ue)=>te(ae,ue);return q.$$set=ae=>{"windowWidth"in ae&&M(9,j=ae.windowWidth)},q.$$.update=()=>{q.$$.dirty&513&&(j<=768?M(0,z=[18,3]):M(0,z=[6,9]),M(2,V=`repeat(${z[1]}, 1fr)`),M(3,X=`repeat(${z[0]}, 1fr)`),M(4,G=Array(z[0]).fill(0).map(ae=>Array(z[1]).fill(!1)))),q.$$.dirty&1026&&M(6,$=`top: ${Z[0]}; left: ${Z[1]}; visibility: ${Q?"visible":"hidden"};`)},[z,Q,V,X,G,Y,$,te,re,j,Z,se,ie,oe,he,le]}class GridUpload extends SvelteComponent{constructor(_){super(),init(this,_,instance$S,create_fragment$V,safe_not_equal,{windowWidth:9})}}function supressWarnings(){const q=console.warn;console.warn=_=>{_.includes("unknown prop")||_.includes("unexpected slot")||q(_)},onMount(()=>{console.warn=q})}function get_each_context_5$1(q,_,M){const $=q.slice();return $[18]=_[M],$}function get_each_context_4$1(q,_,M){const $=q.slice();return $[18]=_[M],$}function get_each_context_1$2(q,_,M){const $=q.slice();return $[10]=_[M],$}function get_each_context_2$1(q,_,M){const $=q.slice();return $[13]=_[M],$[15]=M,$}function get_each_context_3$1(q,_,M){const $=q.slice();return $[16]=_[M],$[15]=M,$}function get_each_context$a(q,_,M){const $=q.slice();return $[7]=_[M],$}function create_if_block_1$k(q){let _,M,$,j;const z=[create_if_block_2$i,create_if_block_3$d,create_else_block_1$6],V=[];function X(G,Y){return G[0]==="table"?0:G[0]==="list"?1:2}return _=X(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(G,Y){V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,Y){let Q=_;_=X(G),_===Q?V[_].p(G,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){V[_].d(G),G&&detach($)}}}function create_if_block$s(q){let _,M,$=q[1],j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block$a(get_each_context$a(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=empty()},m(V,X){for(let G=0;G<j.length;G+=1)j[G].m(V,X);insert(V,_,X),M=!0},p(V,X){if(X&34){$=V[1];let G;for(G=0;G<$.length;G+=1){const Y=get_each_context$a(V,$,G);j[G]?(j[G].p(Y,X),transition_in(j[G],1)):(j[G]=create_each_block$a(Y),j[G].c(),transition_in(j[G],1),j[G].m(_.parentNode,_))}for(group_outros(),G=$.length;G<j.length;G+=1)z(G);check_outros()}},i(V){if(!M){for(let X=0;X<$.length;X+=1)transition_in(j[X]);M=!0}},o(V){j=j.filter(Boolean);for(let X=0;X<j.length;X+=1)transition_out(j[X]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_else_block_1$6(q){let _,M,$;const j=[q[6]];var z=q[5][q[0]];function V(X){let G={$$slots:{default:[create_default_slot_11]},$$scope:{ctx:X}};for(let Y=0;Y<j.length;Y+=1)G=assign(G,j[Y]);return{props:G}}return z&&(_=construct_svelte_component(z,V(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(X,G){_&&mount_component(_,X,G),insert(X,M,G),$=!0},p(X,G){const Y=G&64?get_spread_update(j,[get_spread_object(X[6])]):{};if(G&8388706&&(Y.$$scope={dirty:G,ctx:X}),z!==(z=X[5][X[0]])){if(_){group_outros();const Q=_;transition_out(Q.$$.fragment,1,0,()=>{destroy_component(Q,1)}),check_outros()}z?(_=construct_svelte_component(z,V(X)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else z&&_.$set(Y)},i(X){$||(_&&transition_in(_.$$.fragment,X),$=!0)},o(X){_&&transition_out(_.$$.fragment,X),$=!1},d(X){X&&detach(M),_&&destroy_component(_,X)}}}function create_if_block_3$d(q){let _,M,$,j;const z=[create_if_block_4$8,create_else_block$c],V=[];function X(G,Y){return G[4]?0:1}return _=X(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(G,Y){V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,Y){let Q=_;_=X(G),_===Q?V[_].p(G,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){V[_].d(G),G&&detach($)}}}function create_if_block_2$i(q){let _,M,$;var j=q[5].table;function z(V){return{props:{$$slots:{default:[create_default_slot$2]},$$scope:{ctx:V}}}}return j&&(_=construct_svelte_component(j,z(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(V,X){_&&mount_component(_,V,X),insert(V,M,X),$=!0},p(V,X){const G={};if(X&8388716&&(G.$$scope={dirty:X,ctx:V}),j!==(j=V[5].table)){if(_){group_outros();const Y=_;transition_out(Y.$$.fragment,1,0,()=>{destroy_component(Y,1)}),check_outros()}j?(_=construct_svelte_component(j,z(V)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else j&&_.$set(G)},i(V){$||(_&&transition_in(_.$$.fragment,V),$=!0)},o(V){_&&transition_out(_.$$.fragment,V),$=!1},d(V){V&&detach(M),_&&destroy_component(_,V)}}}function create_else_block_2$1(q){let _=q[6].raw+"",M;return{c(){M=text(_)},m($,j){insert($,M,j)},p($,j){j&64&&_!==(_=$[6].raw+"")&&set_data(M,_)},i:noop,o:noop,d($){$&&detach(M)}}}function create_if_block_5$5(q){let _,M;return _=new Parser$1({props:{tokens:q[1],renderers:q[5]}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.tokens=$[1]),j&32&&(z.renderers=$[5]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_default_slot_11(q){let _,M,$,j;const z=[create_if_block_5$5,create_else_block_2$1],V=[];function X(G,Y){return G[1]?0:1}return _=X(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(G,Y){V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,Y){let Q=_;_=X(G),_===Q?V[_].p(G,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){V[_].d(G),G&&detach($)}}}function create_else_block$c(q){let _,M,$;const j=[{ordered:q[4]},q[6]];var z=q[5].list;function V(X){let G={$$slots:{default:[create_default_slot_9]},$$scope:{ctx:X}};for(let Y=0;Y<j.length;Y+=1)G=assign(G,j[Y]);return{props:G}}return z&&(_=construct_svelte_component(z,V(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(X,G){_&&mount_component(_,X,G),insert(X,M,G),$=!0},p(X,G){const Y=G&80?get_spread_update(j,[G&16&&{ordered:X[4]},G&64&&get_spread_object(X[6])]):{};if(G&8388704&&(Y.$$scope={dirty:G,ctx:X}),z!==(z=X[5].list)){if(_){group_outros();const Q=_;transition_out(Q.$$.fragment,1,0,()=>{destroy_component(Q,1)}),check_outros()}z?(_=construct_svelte_component(z,V(X)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else z&&_.$set(Y)},i(X){$||(_&&transition_in(_.$$.fragment,X),$=!0)},o(X){_&&transition_out(_.$$.fragment,X),$=!1},d(X){X&&detach(M),_&&destroy_component(_,X)}}}function create_if_block_4$8(q){let _,M,$;const j=[{ordered:q[4]},q[6]];var z=q[5].list;function V(X){let G={$$slots:{default:[create_default_slot_7$1]},$$scope:{ctx:X}};for(let Y=0;Y<j.length;Y+=1)G=assign(G,j[Y]);return{props:G}}return z&&(_=construct_svelte_component(z,V(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(X,G){_&&mount_component(_,X,G),insert(X,M,G),$=!0},p(X,G){const Y=G&80?get_spread_update(j,[G&16&&{ordered:X[4]},G&64&&get_spread_object(X[6])]):{};if(G&8388704&&(Y.$$scope={dirty:G,ctx:X}),z!==(z=X[5].list)){if(_){group_outros();const Q=_;transition_out(Q.$$.fragment,1,0,()=>{destroy_component(Q,1)}),check_outros()}z?(_=construct_svelte_component(z,V(X)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else z&&_.$set(Y)},i(X){$||(_&&transition_in(_.$$.fragment,X),$=!0)},o(X){_&&transition_out(_.$$.fragment,X),$=!1},d(X){X&&detach(M),_&&destroy_component(_,X)}}}function create_default_slot_10(q){let _,M,$;return _=new Parser$1({props:{tokens:q[18].tokens,renderers:q[5]}}),{c(){create_component(_.$$.fragment),M=space()},m(j,z){mount_component(_,j,z),insert(j,M,z),$=!0},p(j,z){const V={};z&64&&(V.tokens=j[18].tokens),z&32&&(V.renderers=j[5]),_.$set(V)},i(j){$||(transition_in(_.$$.fragment,j),$=!0)},o(j){transition_out(_.$$.fragment,j),$=!1},d(j){destroy_component(_,j),j&&detach(M)}}}function create_each_block_5$1(q){let _,M,$;const j=[q[18]];var z=q[5].unorderedlistitem||q[5].listitem;function V(X){let G={$$slots:{default:[create_default_slot_10]},$$scope:{ctx:X}};for(let Y=0;Y<j.length;Y+=1)G=assign(G,j[Y]);return{props:G}}return z&&(_=construct_svelte_component(z,V(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(X,G){_&&mount_component(_,X,G),insert(X,M,G),$=!0},p(X,G){const Y=G&64?get_spread_update(j,[get_spread_object(X[18])]):{};if(G&8388704&&(Y.$$scope={dirty:G,ctx:X}),z!==(z=X[5].unorderedlistitem||X[5].listitem)){if(_){group_outros();const Q=_;transition_out(Q.$$.fragment,1,0,()=>{destroy_component(Q,1)}),check_outros()}z?(_=construct_svelte_component(z,V(X)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else z&&_.$set(Y)},i(X){$||(_&&transition_in(_.$$.fragment,X),$=!0)},o(X){_&&transition_out(_.$$.fragment,X),$=!1},d(X){X&&detach(M),_&&destroy_component(_,X)}}}function create_default_slot_9(q){let _,M,$=q[6].items,j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block_5$1(get_each_context_5$1(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=empty()},m(V,X){for(let G=0;G<j.length;G+=1)j[G].m(V,X);insert(V,_,X),M=!0},p(V,X){if(X&96){$=V[6].items;let G;for(G=0;G<$.length;G+=1){const Y=get_each_context_5$1(V,$,G);j[G]?(j[G].p(Y,X),transition_in(j[G],1)):(j[G]=create_each_block_5$1(Y),j[G].c(),transition_in(j[G],1),j[G].m(_.parentNode,_))}for(group_outros(),G=$.length;G<j.length;G+=1)z(G);check_outros()}},i(V){if(!M){for(let X=0;X<$.length;X+=1)transition_in(j[X]);M=!0}},o(V){j=j.filter(Boolean);for(let X=0;X<j.length;X+=1)transition_out(j[X]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_default_slot_8$1(q){let _,M,$;return _=new Parser$1({props:{tokens:q[18].tokens,renderers:q[5]}}),{c(){create_component(_.$$.fragment),M=space()},m(j,z){mount_component(_,j,z),insert(j,M,z),$=!0},p(j,z){const V={};z&64&&(V.tokens=j[18].tokens),z&32&&(V.renderers=j[5]),_.$set(V)},i(j){$||(transition_in(_.$$.fragment,j),$=!0)},o(j){transition_out(_.$$.fragment,j),$=!1},d(j){destroy_component(_,j),j&&detach(M)}}}function create_each_block_4$1(q){let _,M,$;const j=[q[18]];var z=q[5].orderedlistitem||q[5].listitem;function V(X){let G={$$slots:{default:[create_default_slot_8$1]},$$scope:{ctx:X}};for(let Y=0;Y<j.length;Y+=1)G=assign(G,j[Y]);return{props:G}}return z&&(_=construct_svelte_component(z,V(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(X,G){_&&mount_component(_,X,G),insert(X,M,G),$=!0},p(X,G){const Y=G&64?get_spread_update(j,[get_spread_object(X[18])]):{};if(G&8388704&&(Y.$$scope={dirty:G,ctx:X}),z!==(z=X[5].orderedlistitem||X[5].listitem)){if(_){group_outros();const Q=_;transition_out(Q.$$.fragment,1,0,()=>{destroy_component(Q,1)}),check_outros()}z?(_=construct_svelte_component(z,V(X)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else z&&_.$set(Y)},i(X){$||(_&&transition_in(_.$$.fragment,X),$=!0)},o(X){_&&transition_out(_.$$.fragment,X),$=!1},d(X){X&&detach(M),_&&destroy_component(_,X)}}}function create_default_slot_7$1(q){let _,M,$=q[6].items,j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block_4$1(get_each_context_4$1(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=empty()},m(V,X){for(let G=0;G<j.length;G+=1)j[G].m(V,X);insert(V,_,X),M=!0},p(V,X){if(X&96){$=V[6].items;let G;for(G=0;G<$.length;G+=1){const Y=get_each_context_4$1(V,$,G);j[G]?(j[G].p(Y,X),transition_in(j[G],1)):(j[G]=create_each_block_4$1(Y),j[G].c(),transition_in(j[G],1),j[G].m(_.parentNode,_))}for(group_outros(),G=$.length;G<j.length;G+=1)z(G);check_outros()}},i(V){if(!M){for(let X=0;X<$.length;X+=1)transition_in(j[X]);M=!0}},o(V){j=j.filter(Boolean);for(let X=0;X<j.length;X+=1)transition_out(j[X]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_default_slot_6$1(q){let _,M,$;return _=new Parser$1({props:{tokens:q[16].tokens,renderers:q[5]}}),{c(){create_component(_.$$.fragment),M=space()},m(j,z){mount_component(_,j,z),insert(j,M,z),$=!0},p(j,z){const V={};z&4&&(V.tokens=j[16].tokens),z&32&&(V.renderers=j[5]),_.$set(V)},i(j){$||(transition_in(_.$$.fragment,j),$=!0)},o(j){transition_out(_.$$.fragment,j),$=!1},d(j){destroy_component(_,j),j&&detach(M)}}}function create_each_block_3$1(q){let _,M,$;var j=q[5].tablecell;function z(V){return{props:{header:!0,align:V[6].align[V[15]]||"center",$$slots:{default:[create_default_slot_6$1]},$$scope:{ctx:V}}}}return j&&(_=construct_svelte_component(j,z(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(V,X){_&&mount_component(_,V,X),insert(V,M,X),$=!0},p(V,X){const G={};if(X&64&&(G.align=V[6].align[V[15]]||"center"),X&8388644&&(G.$$scope={dirty:X,ctx:V}),j!==(j=V[5].tablecell)){if(_){group_outros();const Y=_;transition_out(Y.$$.fragment,1,0,()=>{destroy_component(Y,1)}),check_outros()}j?(_=construct_svelte_component(j,z(V)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else j&&_.$set(G)},i(V){$||(_&&transition_in(_.$$.fragment,V),$=!0)},o(V){_&&transition_out(_.$$.fragment,V),$=!1},d(V){V&&detach(M),_&&destroy_component(_,V)}}}function create_default_slot_5$1(q){let _,M,$=q[2],j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block_3$1(get_each_context_3$1(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=empty()},m(V,X){for(let G=0;G<j.length;G+=1)j[G].m(V,X);insert(V,_,X),M=!0},p(V,X){if(X&100){$=V[2];let G;for(G=0;G<$.length;G+=1){const Y=get_each_context_3$1(V,$,G);j[G]?(j[G].p(Y,X),transition_in(j[G],1)):(j[G]=create_each_block_3$1(Y),j[G].c(),transition_in(j[G],1),j[G].m(_.parentNode,_))}for(group_outros(),G=$.length;G<j.length;G+=1)z(G);check_outros()}},i(V){if(!M){for(let X=0;X<$.length;X+=1)transition_in(j[X]);M=!0}},o(V){j=j.filter(Boolean);for(let X=0;X<j.length;X+=1)transition_out(j[X]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_default_slot_4$1(q){let _,M,$;var j=q[5].tablerow;function z(V){return{props:{$$slots:{default:[create_default_slot_5$1]},$$scope:{ctx:V}}}}return j&&(_=construct_svelte_component(j,z(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(V,X){_&&mount_component(_,V,X),insert(V,M,X),$=!0},p(V,X){const G={};if(X&8388708&&(G.$$scope={dirty:X,ctx:V}),j!==(j=V[5].tablerow)){if(_){group_outros();const Y=_;transition_out(Y.$$.fragment,1,0,()=>{destroy_component(Y,1)}),check_outros()}j?(_=construct_svelte_component(j,z(V)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else j&&_.$set(G)},i(V){$||(_&&transition_in(_.$$.fragment,V),$=!0)},o(V){_&&transition_out(_.$$.fragment,V),$=!1},d(V){V&&detach(M),_&&destroy_component(_,V)}}}function create_default_slot_3$1(q){let _,M;return _=new Parser$1({props:{tokens:q[13].tokens,renderers:q[5]}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&8&&(z.tokens=$[13].tokens),j&32&&(z.renderers=$[5]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_each_block_2$1(q){let _,M,$;var j=q[5].tablecell;function z(V){return{props:{header:!1,align:V[6].align[V[15]]||"center",$$slots:{default:[create_default_slot_3$1]},$$scope:{ctx:V}}}}return j&&(_=construct_svelte_component(j,z(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(V,X){_&&mount_component(_,V,X),insert(V,M,X),$=!0},p(V,X){const G={};if(X&64&&(G.align=V[6].align[V[15]]||"center"),X&8388648&&(G.$$scope={dirty:X,ctx:V}),j!==(j=V[5].tablecell)){if(_){group_outros();const Y=_;transition_out(Y.$$.fragment,1,0,()=>{destroy_component(Y,1)}),check_outros()}j?(_=construct_svelte_component(j,z(V)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else j&&_.$set(G)},i(V){$||(_&&transition_in(_.$$.fragment,V),$=!0)},o(V){_&&transition_out(_.$$.fragment,V),$=!1},d(V){V&&detach(M),_&&destroy_component(_,V)}}}function create_default_slot_2$1(q){let _,M,$=q[10],j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block_2$1(get_each_context_2$1(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=space()},m(V,X){for(let G=0;G<j.length;G+=1)j[G].m(V,X);insert(V,_,X),M=!0},p(V,X){if(X&104){$=V[10];let G;for(G=0;G<$.length;G+=1){const Y=get_each_context_2$1(V,$,G);j[G]?(j[G].p(Y,X),transition_in(j[G],1)):(j[G]=create_each_block_2$1(Y),j[G].c(),transition_in(j[G],1),j[G].m(_.parentNode,_))}for(group_outros(),G=$.length;G<j.length;G+=1)z(G);check_outros()}},i(V){if(!M){for(let X=0;X<$.length;X+=1)transition_in(j[X]);M=!0}},o(V){j=j.filter(Boolean);for(let X=0;X<j.length;X+=1)transition_out(j[X]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_each_block_1$2(q){let _,M,$;var j=q[5].tablerow;function z(V){return{props:{$$slots:{default:[create_default_slot_2$1]},$$scope:{ctx:V}}}}return j&&(_=construct_svelte_component(j,z(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(V,X){_&&mount_component(_,V,X),insert(V,M,X),$=!0},p(V,X){const G={};if(X&8388712&&(G.$$scope={dirty:X,ctx:V}),j!==(j=V[5].tablerow)){if(_){group_outros();const Y=_;transition_out(Y.$$.fragment,1,0,()=>{destroy_component(Y,1)}),check_outros()}j?(_=construct_svelte_component(j,z(V)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else j&&_.$set(G)},i(V){$||(_&&transition_in(_.$$.fragment,V),$=!0)},o(V){_&&transition_out(_.$$.fragment,V),$=!1},d(V){V&&detach(M),_&&destroy_component(_,V)}}}function create_default_slot_1$1(q){let _,M,$=q[3],j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block_1$2(get_each_context_1$2(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=empty()},m(V,X){for(let G=0;G<j.length;G+=1)j[G].m(V,X);insert(V,_,X),M=!0},p(V,X){if(X&104){$=V[3];let G;for(G=0;G<$.length;G+=1){const Y=get_each_context_1$2(V,$,G);j[G]?(j[G].p(Y,X),transition_in(j[G],1)):(j[G]=create_each_block_1$2(Y),j[G].c(),transition_in(j[G],1),j[G].m(_.parentNode,_))}for(group_outros(),G=$.length;G<j.length;G+=1)z(G);check_outros()}},i(V){if(!M){for(let X=0;X<$.length;X+=1)transition_in(j[X]);M=!0}},o(V){j=j.filter(Boolean);for(let X=0;X<j.length;X+=1)transition_out(j[X]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_default_slot$2(q){let _,M,$,j,z;var V=q[5].tablehead;function X(Q){return{props:{$$slots:{default:[create_default_slot_4$1]},$$scope:{ctx:Q}}}}V&&(_=construct_svelte_component(V,X(q)));var G=q[5].tablebody;function Y(Q){return{props:{$$slots:{default:[create_default_slot_1$1]},$$scope:{ctx:Q}}}}return G&&($=construct_svelte_component(G,Y(q))),{c(){_&&create_component(_.$$.fragment),M=space(),$&&create_component($.$$.fragment),j=empty()},m(Q,Z){_&&mount_component(_,Q,Z),insert(Q,M,Z),$&&mount_component($,Q,Z),insert(Q,j,Z),z=!0},p(Q,Z){const te={};if(Z&8388708&&(te.$$scope={dirty:Z,ctx:Q}),V!==(V=Q[5].tablehead)){if(_){group_outros();const ne=_;transition_out(ne.$$.fragment,1,0,()=>{destroy_component(ne,1)}),check_outros()}V?(_=construct_svelte_component(V,X(Q)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else V&&_.$set(te);const ee={};if(Z&8388712&&(ee.$$scope={dirty:Z,ctx:Q}),G!==(G=Q[5].tablebody)){if($){group_outros();const ne=$;transition_out(ne.$$.fragment,1,0,()=>{destroy_component(ne,1)}),check_outros()}G?($=construct_svelte_component(G,Y(Q)),create_component($.$$.fragment),transition_in($.$$.fragment,1),mount_component($,j.parentNode,j)):$=null}else G&&$.$set(ee)},i(Q){z||(_&&transition_in(_.$$.fragment,Q),$&&transition_in($.$$.fragment,Q),z=!0)},o(Q){_&&transition_out(_.$$.fragment,Q),$&&transition_out($.$$.fragment,Q),z=!1},d(Q){_&&destroy_component(_,Q),Q&&detach(M),Q&&detach(j),$&&destroy_component($,Q)}}}function create_each_block$a(q){let _,M;const $=[q[7],{renderers:q[5]}];let j={};for(let z=0;z<$.length;z+=1)j=assign(j,$[z]);return _=new Parser$1({props:j}),{c(){create_component(_.$$.fragment)},m(z,V){mount_component(_,z,V),M=!0},p(z,V){const X=V&34?get_spread_update($,[V&2&&get_spread_object(z[7]),V&32&&{renderers:z[5]}]):{};_.$set(X)},i(z){M||(transition_in(_.$$.fragment,z),M=!0)},o(z){transition_out(_.$$.fragment,z),M=!1},d(z){destroy_component(_,z)}}}function create_fragment$U(q){let _,M,$,j;const z=[create_if_block$s,create_if_block_1$k],V=[];function X(G,Y){return G[0]?G[5][G[0]]?1:-1:0}return~(_=X(q))&&(M=V[_]=z[_](q)),{c(){M&&M.c(),$=empty()},m(G,Y){~_&&V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,[Y]){let Q=_;_=X(G),_===Q?~_&&V[_].p(G,Y):(M&&(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros()),~_?(M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$)):M=null)},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){~_&&V[_].d(G),G&&detach($)}}}function instance$R(q,_,M){const $=["type","tokens","header","rows","ordered","renderers"];let j=compute_rest_props(_,$),{type:z=void 0}=_,{tokens:V=void 0}=_,{header:X=void 0}=_,{rows:G=void 0}=_,{ordered:Y=!1}=_,{renderers:Q}=_;return supressWarnings(),q.$$set=Z=>{_=assign(assign({},_),exclude_internal_props(Z)),M(6,j=compute_rest_props(_,$)),"type"in Z&&M(0,z=Z.type),"tokens"in Z&&M(1,V=Z.tokens),"header"in Z&&M(2,X=Z.header),"rows"in Z&&M(3,G=Z.rows),"ordered"in Z&&M(4,Y=Z.ordered),"renderers"in Z&&M(5,Q=Z.renderers)},[z,V,X,G,Y,Q,j]}let Parser$1=class extends SvelteComponent{constructor(_){super(),init(this,_,instance$R,create_fragment$U,safe_not_equal,{type:0,tokens:1,header:2,rows:3,ordered:4,renderers:5})}};function getDefaults(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let defaults=getDefaults();function changeDefaults(q){defaults=q}const escapeTest=/[&<>"']/,escapeReplace=new RegExp(escapeTest.source,"g"),escapeTestNoEncode=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode=new RegExp(escapeTestNoEncode.source,"g"),escapeReplacements={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},getEscapeReplacement=q=>escapeReplacements[q];function escape$1(q,_){if(_){if(escapeTest.test(q))return q.replace(escapeReplace,getEscapeReplacement)}else if(escapeTestNoEncode.test(q))return q.replace(escapeReplaceNoEncode,getEscapeReplacement);return q}const unescapeTest=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function unescape$1(q){return q.replace(unescapeTest,(_,M)=>(M=M.toLowerCase(),M==="colon"?":":M.charAt(0)==="#"?M.charAt(1)==="x"?String.fromCharCode(parseInt(M.substring(2),16)):String.fromCharCode(+M.substring(1)):""))}const caret=/(^|[^\[])\^/g;function edit(q,_){q=typeof q=="string"?q:q.source,_=_||"";const M={replace:($,j)=>(j=j.source||j,j=j.replace(caret,"$1"),q=q.replace($,j),M),getRegex:()=>new RegExp(q,_)};return M}const nonWordAndColonTest=/[^\w:]/g,originIndependentUrl=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function cleanUrl(q,_,M){if(q){let $;try{$=decodeURIComponent(unescape$1(M)).replace(nonWordAndColonTest,"").toLowerCase()}catch{return null}if($.indexOf("javascript:")===0||$.indexOf("vbscript:")===0||$.indexOf("data:")===0)return null}_&&!originIndependentUrl.test(M)&&(M=resolveUrl(_,M));try{M=encodeURI(M).replace(/%25/g,"%")}catch{return null}return M}const baseUrls={},justDomain=/^[^:]+:\/*[^/]*$/,protocol=/^([^:]+:)[\s\S]*$/,domain=/^([^:]+:\/*[^/]*)[\s\S]*$/;function resolveUrl(q,_){baseUrls[" "+q]||(justDomain.test(q)?baseUrls[" "+q]=q+"/":baseUrls[" "+q]=rtrim(q,"/",!0)),q=baseUrls[" "+q];const M=q.indexOf(":")===-1;return _.substring(0,2)==="//"?M?_:q.replace(protocol,"$1")+_:_.charAt(0)==="/"?M?_:q.replace(domain,"$1")+_:q+_}const noopTest={exec:function(){}};function splitCells(q,_){const M=q.replace(/\|/g,(z,V,X)=>{let G=!1,Y=V;for(;--Y>=0&&X[Y]==="\\";)G=!G;return G?"|":" |"}),$=M.split(/ \|/);let j=0;if($[0].trim()||$.shift(),$.length>0&&!$[$.length-1].trim()&&$.pop(),$.length>_)$.splice(_);else for(;$.length<_;)$.push("");for(;j<$.length;j++)$[j]=$[j].trim().replace(/\\\|/g,"|");return $}function rtrim(q,_,M){const $=q.length;if($===0)return"";let j=0;for(;j<$;){const z=q.charAt($-j-1);if(z===_&&!M)j++;else if(z!==_&&M)j++;else break}return q.slice(0,$-j)}function findClosingBracket(q,_){if(q.indexOf(_[1])===-1)return-1;const M=q.length;let $=0,j=0;for(;j<M;j++)if(q[j]==="\\")j++;else if(q[j]===_[0])$++;else if(q[j]===_[1]&&($--,$<0))return j;return-1}function checkSanitizeDeprecation(q){q&&q.sanitize&&!q.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function repeatString(q,_){if(_<1)return"";let M="";for(;_>1;)_&1&&(M+=q),_>>=1,q+=q;return M+q}function outputLink(q,_,M,$){const j=_.href,z=_.title?escape$1(_.title):null,V=q[1].replace(/\\([\[\]])/g,"$1");if(q[0].charAt(0)!=="!"){$.state.inLink=!0;const X={type:"link",raw:M,href:j,title:z,text:V,tokens:$.inlineTokens(V)};return $.state.inLink=!1,X}return{type:"image",raw:M,href:j,title:z,text:escape$1(V)}}function indentCodeCompensation(q,_){const M=q.match(/^(\s+)(?:```)/);if(M===null)return _;const $=M[1];return _.split(`
`).map(j=>{const z=j.match(/^\s+/);if(z===null)return j;const[V]=z;return V.length>=$.length?j.slice($.length):j}).join(`
`)}class Tokenizer{constructor(_){this.options=_||defaults}space(_){const M=this.rules.block.newline.exec(_);if(M&&M[0].length>0)return{type:"space",raw:M[0]}}code(_){const M=this.rules.block.code.exec(_);if(M){const $=M[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:M[0],codeBlockStyle:"indented",text:this.options.pedantic?$:rtrim($,`
`)}}}fences(_){const M=this.rules.block.fences.exec(_);if(M){const $=M[0],j=indentCodeCompensation($,M[3]||"");return{type:"code",raw:$,lang:M[2]?M[2].trim().replace(this.rules.inline._escapes,"$1"):M[2],text:j}}}heading(_){const M=this.rules.block.heading.exec(_);if(M){let $=M[2].trim();if(/#$/.test($)){const j=rtrim($,"#");(this.options.pedantic||!j||/ $/.test(j))&&($=j.trim())}return{type:"heading",raw:M[0],depth:M[1].length,text:$,tokens:this.lexer.inline($)}}}hr(_){const M=this.rules.block.hr.exec(_);if(M)return{type:"hr",raw:M[0]}}blockquote(_){const M=this.rules.block.blockquote.exec(_);if(M){const $=M[0].replace(/^ *>[ \t]?/gm,""),j=this.lexer.state.top;this.lexer.state.top=!0;const z=this.lexer.blockTokens($);return this.lexer.state.top=j,{type:"blockquote",raw:M[0],tokens:z,text:$}}}list(_){let M=this.rules.block.list.exec(_);if(M){let $,j,z,V,X,G,Y,Q,Z,te,ee,ne,re=M[1].trim();const se=re.length>1,ie={type:"list",raw:"",ordered:se,start:se?+re.slice(0,-1):"",loose:!1,items:[]};re=se?`\\d{1,9}\\${re.slice(-1)}`:`\\${re}`,this.options.pedantic&&(re=se?re:"[*+-]");const oe=new RegExp(`^( {0,3}${re})((?:[	 ][^\\n]*)?(?:\\n|$))`);for(;_&&(ne=!1,!(!(M=oe.exec(_))||this.rules.block.hr.test(_)));){if($=M[0],_=_.substring($.length),Q=M[2].split(`
`,1)[0].replace(/^\t+/,le=>" ".repeat(3*le.length)),Z=_.split(`
`,1)[0],this.options.pedantic?(V=2,ee=Q.trimLeft()):(V=M[2].search(/[^ ]/),V=V>4?1:V,ee=Q.slice(V),V+=M[1].length),G=!1,!Q&&/^ *$/.test(Z)&&($+=Z+`
`,_=_.substring(Z.length+1),ne=!0),!ne){const le=new RegExp(`^ {0,${Math.min(3,V-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),ae=new RegExp(`^ {0,${Math.min(3,V-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),ue=new RegExp(`^ {0,${Math.min(3,V-1)}}(?:\`\`\`|~~~)`),me=new RegExp(`^ {0,${Math.min(3,V-1)}}#`);for(;_&&(te=_.split(`
`,1)[0],Z=te,this.options.pedantic&&(Z=Z.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(ue.test(Z)||me.test(Z)||le.test(Z)||ae.test(_)));){if(Z.search(/[^ ]/)>=V||!Z.trim())ee+=`
`+Z.slice(V);else{if(G||Q.search(/[^ ]/)>=4||ue.test(Q)||me.test(Q)||ae.test(Q))break;ee+=`
`+Z}!G&&!Z.trim()&&(G=!0),$+=te+`
`,_=_.substring(te.length+1),Q=Z.slice(V)}}ie.loose||(Y?ie.loose=!0:/\n *\n *$/.test($)&&(Y=!0)),this.options.gfm&&(j=/^\[[ xX]\] /.exec(ee),j&&(z=j[0]!=="[ ] ",ee=ee.replace(/^\[[ xX]\] +/,""))),ie.items.push({type:"list_item",raw:$,task:!!j,checked:z,loose:!1,text:ee}),ie.raw+=$}ie.items[ie.items.length-1].raw=$.trimRight(),ie.items[ie.items.length-1].text=ee.trimRight(),ie.raw=ie.raw.trimRight();const he=ie.items.length;for(X=0;X<he;X++)if(this.lexer.state.top=!1,ie.items[X].tokens=this.lexer.blockTokens(ie.items[X].text,[]),!ie.loose){const le=ie.items[X].tokens.filter(ue=>ue.type==="space"),ae=le.length>0&&le.some(ue=>/\n.*\n/.test(ue.raw));ie.loose=ae}if(ie.loose)for(X=0;X<he;X++)ie.items[X].loose=!0;return ie}}html(_){const M=this.rules.block.html.exec(_);if(M){const $={type:"html",raw:M[0],pre:!this.options.sanitizer&&(M[1]==="pre"||M[1]==="script"||M[1]==="style"),text:M[0]};if(this.options.sanitize){const j=this.options.sanitizer?this.options.sanitizer(M[0]):escape$1(M[0]);$.type="paragraph",$.text=j,$.tokens=this.lexer.inline(j)}return $}}def(_){const M=this.rules.block.def.exec(_);if(M){const $=M[1].toLowerCase().replace(/\s+/g," "),j=M[2]?M[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",z=M[3]?M[3].substring(1,M[3].length-1).replace(this.rules.inline._escapes,"$1"):M[3];return{type:"def",tag:$,raw:M[0],href:j,title:z}}}table(_){const M=this.rules.block.table.exec(_);if(M){const $={type:"table",header:splitCells(M[1]).map(j=>({text:j})),align:M[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:M[3]&&M[3].trim()?M[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if($.header.length===$.align.length){$.raw=M[0];let j=$.align.length,z,V,X,G;for(z=0;z<j;z++)/^ *-+: *$/.test($.align[z])?$.align[z]="right":/^ *:-+: *$/.test($.align[z])?$.align[z]="center":/^ *:-+ *$/.test($.align[z])?$.align[z]="left":$.align[z]=null;for(j=$.rows.length,z=0;z<j;z++)$.rows[z]=splitCells($.rows[z],$.header.length).map(Y=>({text:Y}));for(j=$.header.length,V=0;V<j;V++)$.header[V].tokens=this.lexer.inline($.header[V].text);for(j=$.rows.length,V=0;V<j;V++)for(G=$.rows[V],X=0;X<G.length;X++)G[X].tokens=this.lexer.inline(G[X].text);return $}}}lheading(_){const M=this.rules.block.lheading.exec(_);if(M)return{type:"heading",raw:M[0],depth:M[2].charAt(0)==="="?1:2,text:M[1],tokens:this.lexer.inline(M[1])}}paragraph(_){const M=this.rules.block.paragraph.exec(_);if(M){const $=M[1].charAt(M[1].length-1)===`
`?M[1].slice(0,-1):M[1];return{type:"paragraph",raw:M[0],text:$,tokens:this.lexer.inline($)}}}text(_){const M=this.rules.block.text.exec(_);if(M)return{type:"text",raw:M[0],text:M[0],tokens:this.lexer.inline(M[0])}}escape(_){const M=this.rules.inline.escape.exec(_);if(M)return{type:"escape",raw:M[0],text:escape$1(M[1])}}tag(_){const M=this.rules.inline.tag.exec(_);if(M)return!this.lexer.state.inLink&&/^<a /i.test(M[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(M[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(M[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(M[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:M[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(M[0]):escape$1(M[0]):M[0]}}link(_){const M=this.rules.inline.link.exec(_);if(M){const $=M[2].trim();if(!this.options.pedantic&&/^</.test($)){if(!/>$/.test($))return;const V=rtrim($.slice(0,-1),"\\");if(($.length-V.length)%2===0)return}else{const V=findClosingBracket(M[2],"()");if(V>-1){const G=(M[0].indexOf("!")===0?5:4)+M[1].length+V;M[2]=M[2].substring(0,V),M[0]=M[0].substring(0,G).trim(),M[3]=""}}let j=M[2],z="";if(this.options.pedantic){const V=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(j);V&&(j=V[1],z=V[3])}else z=M[3]?M[3].slice(1,-1):"";return j=j.trim(),/^</.test(j)&&(this.options.pedantic&&!/>$/.test($)?j=j.slice(1):j=j.slice(1,-1)),outputLink(M,{href:j&&j.replace(this.rules.inline._escapes,"$1"),title:z&&z.replace(this.rules.inline._escapes,"$1")},M[0],this.lexer)}}reflink(_,M){let $;if(($=this.rules.inline.reflink.exec(_))||($=this.rules.inline.nolink.exec(_))){let j=($[2]||$[1]).replace(/\s+/g," ");if(j=M[j.toLowerCase()],!j){const z=$[0].charAt(0);return{type:"text",raw:z,text:z}}return outputLink($,j,$[0],this.lexer)}}emStrong(_,M,$=""){let j=this.rules.inline.emStrong.lDelim.exec(_);if(!j||j[3]&&$.match(/[\p{L}\p{N}]/u))return;const z=j[1]||j[2]||"";if(!z||z&&($===""||this.rules.inline.punctuation.exec($))){const V=j[0].length-1;let X,G,Y=V,Q=0;const Z=j[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(Z.lastIndex=0,M=M.slice(-1*_.length+V);(j=Z.exec(M))!=null;){if(X=j[1]||j[2]||j[3]||j[4]||j[5]||j[6],!X)continue;if(G=X.length,j[3]||j[4]){Y+=G;continue}else if((j[5]||j[6])&&V%3&&!((V+G)%3)){Q+=G;continue}if(Y-=G,Y>0)continue;G=Math.min(G,G+Y+Q);const te=_.slice(0,V+j.index+(j[0].length-X.length)+G);if(Math.min(V,G)%2){const ne=te.slice(1,-1);return{type:"em",raw:te,text:ne,tokens:this.lexer.inlineTokens(ne)}}const ee=te.slice(2,-2);return{type:"strong",raw:te,text:ee,tokens:this.lexer.inlineTokens(ee)}}}}codespan(_){const M=this.rules.inline.code.exec(_);if(M){let $=M[2].replace(/\n/g," ");const j=/[^ ]/.test($),z=/^ /.test($)&&/ $/.test($);return j&&z&&($=$.substring(1,$.length-1)),$=escape$1($,!0),{type:"codespan",raw:M[0],text:$}}}br(_){const M=this.rules.inline.br.exec(_);if(M)return{type:"br",raw:M[0]}}del(_){const M=this.rules.inline.del.exec(_);if(M)return{type:"del",raw:M[0],text:M[2],tokens:this.lexer.inlineTokens(M[2])}}autolink(_,M){const $=this.rules.inline.autolink.exec(_);if($){let j,z;return $[2]==="@"?(j=escape$1(this.options.mangle?M($[1]):$[1]),z="mailto:"+j):(j=escape$1($[1]),z=j),{type:"link",raw:$[0],text:j,href:z,tokens:[{type:"text",raw:j,text:j}]}}}url(_,M){let $;if($=this.rules.inline.url.exec(_)){let j,z;if($[2]==="@")j=escape$1(this.options.mangle?M($[0]):$[0]),z="mailto:"+j;else{let V;do V=$[0],$[0]=this.rules.inline._backpedal.exec($[0])[0];while(V!==$[0]);j=escape$1($[0]),$[1]==="www."?z="http://"+$[0]:z=$[0]}return{type:"link",raw:$[0],text:j,href:z,tokens:[{type:"text",raw:j,text:j}]}}}inlineText(_,M){const $=this.rules.inline.text.exec(_);if($){let j;return this.lexer.state.inRawBlock?j=this.options.sanitize?this.options.sanitizer?this.options.sanitizer($[0]):escape$1($[0]):$[0]:j=escape$1(this.options.smartypants?M($[0]):$[0]),{type:"text",raw:$[0],text:j}}}}const block={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:noopTest,lheading:/^((?:.|\n(?!\n))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};block._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;block._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;block.def=edit(block.def).replace("label",block._label).replace("title",block._title).getRegex();block.bullet=/(?:[*+-]|\d{1,9}[.)])/;block.listItemStart=edit(/^( *)(bull) */).replace("bull",block.bullet).getRegex();block.list=edit(block.list).replace(/bull/g,block.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+block.def.source+")").getRegex();block._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";block._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;block.html=edit(block.html,"i").replace("comment",block._comment).replace("tag",block._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();block.paragraph=edit(block._paragraph).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.blockquote=edit(block.blockquote).replace("paragraph",block.paragraph).getRegex();block.normal={...block};block.gfm={...block.normal,table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"};block.gfm.table=edit(block.gfm.table).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.gfm.paragraph=edit(block._paragraph).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",block.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.pedantic={...block.normal,html:edit(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",block._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:noopTest,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:edit(block.normal._paragraph).replace("hr",block.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",block.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()};const inline={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:noopTest,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^(?:[^_*\\]|\\.)*?\_\_(?:[^_*\\]|\\.)*?\*(?:[^_*\\]|\\.)*?(?=\_\_)|(?:[^*\\]|\\.)+(?=[^*])|[punct_](\*+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|(?:[^punct*_\s\\]|\\.)(\*+)(?=[^punct*_\s])/,rDelimUnd:/^(?:[^_*\\]|\\.)*?\*\*(?:[^_*\\]|\\.)*?\_(?:[^_*\\]|\\.)*?(?=\*\*)|(?:[^_\\]|\\.)+(?=[^_])|[punct*](\_+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:noopTest,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};inline._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~";inline.punctuation=edit(inline.punctuation).replace(/punctuation/g,inline._punctuation).getRegex();inline.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;inline.escapedEmSt=/(?:^|[^\\])(?:\\\\)*\\[*_]/g;inline._comment=edit(block._comment).replace("(?:-->|$)","-->").getRegex();inline.emStrong.lDelim=edit(inline.emStrong.lDelim).replace(/punct/g,inline._punctuation).getRegex();inline.emStrong.rDelimAst=edit(inline.emStrong.rDelimAst,"g").replace(/punct/g,inline._punctuation).getRegex();inline.emStrong.rDelimUnd=edit(inline.emStrong.rDelimUnd,"g").replace(/punct/g,inline._punctuation).getRegex();inline._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;inline._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;inline._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;inline.autolink=edit(inline.autolink).replace("scheme",inline._scheme).replace("email",inline._email).getRegex();inline._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;inline.tag=edit(inline.tag).replace("comment",inline._comment).replace("attribute",inline._attribute).getRegex();inline._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;inline._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;inline._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;inline.link=edit(inline.link).replace("label",inline._label).replace("href",inline._href).replace("title",inline._title).getRegex();inline.reflink=edit(inline.reflink).replace("label",inline._label).replace("ref",block._label).getRegex();inline.nolink=edit(inline.nolink).replace("ref",block._label).getRegex();inline.reflinkSearch=edit(inline.reflinkSearch,"g").replace("reflink",inline.reflink).replace("nolink",inline.nolink).getRegex();inline.normal={...inline};inline.pedantic={...inline.normal,strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:edit(/^!?\[(label)\]\((.*?)\)/).replace("label",inline._label).getRegex(),reflink:edit(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",inline._label).getRegex()};inline.gfm={...inline.normal,escape:edit(inline.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/};inline.gfm.url=edit(inline.gfm.url,"i").replace("email",inline.gfm._extended_email).getRegex();inline.breaks={...inline.gfm,br:edit(inline.br).replace("{2,}","*").getRegex(),text:edit(inline.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()};function smartypants(q){return q.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…")}function mangle(q){let _="",M,$;const j=q.length;for(M=0;M<j;M++)$=q.charCodeAt(M),Math.random()>.5&&($="x"+$.toString(16)),_+="&#"+$+";";return _}class Lexer{constructor(_){this.tokens=[],this.tokens.links=Object.create(null),this.options=_||defaults,this.options.tokenizer=this.options.tokenizer||new Tokenizer,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const M={block:block.normal,inline:inline.normal};this.options.pedantic?(M.block=block.pedantic,M.inline=inline.pedantic):this.options.gfm&&(M.block=block.gfm,this.options.breaks?M.inline=inline.breaks:M.inline=inline.gfm),this.tokenizer.rules=M}static get rules(){return{block,inline}}static lex(_,M){return new Lexer(M).lex(_)}static lexInline(_,M){return new Lexer(M).inlineTokens(_)}lex(_){_=_.replace(/\r\n|\r/g,`
`),this.blockTokens(_,this.tokens);let M;for(;M=this.inlineQueue.shift();)this.inlineTokens(M.src,M.tokens);return this.tokens}blockTokens(_,M=[]){this.options.pedantic?_=_.replace(/\t/g,"    ").replace(/^ +$/gm,""):_=_.replace(/^( *)(\t+)/gm,(X,G,Y)=>G+"    ".repeat(Y.length));let $,j,z,V;for(;_;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(X=>($=X.call({lexer:this},_,M))?(_=_.substring($.raw.length),M.push($),!0):!1))){if($=this.tokenizer.space(_)){_=_.substring($.raw.length),$.raw.length===1&&M.length>0?M[M.length-1].raw+=`
`:M.push($);continue}if($=this.tokenizer.code(_)){_=_.substring($.raw.length),j=M[M.length-1],j&&(j.type==="paragraph"||j.type==="text")?(j.raw+=`
`+$.raw,j.text+=`
`+$.text,this.inlineQueue[this.inlineQueue.length-1].src=j.text):M.push($);continue}if($=this.tokenizer.fences(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.heading(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.hr(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.blockquote(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.list(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.html(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.def(_)){_=_.substring($.raw.length),j=M[M.length-1],j&&(j.type==="paragraph"||j.type==="text")?(j.raw+=`
`+$.raw,j.text+=`
`+$.raw,this.inlineQueue[this.inlineQueue.length-1].src=j.text):this.tokens.links[$.tag]||(this.tokens.links[$.tag]={href:$.href,title:$.title});continue}if($=this.tokenizer.table(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.lheading(_)){_=_.substring($.raw.length),M.push($);continue}if(z=_,this.options.extensions&&this.options.extensions.startBlock){let X=1/0;const G=_.slice(1);let Y;this.options.extensions.startBlock.forEach(function(Q){Y=Q.call({lexer:this},G),typeof Y=="number"&&Y>=0&&(X=Math.min(X,Y))}),X<1/0&&X>=0&&(z=_.substring(0,X+1))}if(this.state.top&&($=this.tokenizer.paragraph(z))){j=M[M.length-1],V&&j.type==="paragraph"?(j.raw+=`
`+$.raw,j.text+=`
`+$.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=j.text):M.push($),V=z.length!==_.length,_=_.substring($.raw.length);continue}if($=this.tokenizer.text(_)){_=_.substring($.raw.length),j=M[M.length-1],j&&j.type==="text"?(j.raw+=`
`+$.raw,j.text+=`
`+$.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=j.text):M.push($);continue}if(_){const X="Infinite loop on byte: "+_.charCodeAt(0);if(this.options.silent){console.error(X);break}else throw new Error(X)}}return this.state.top=!0,M}inline(_,M=[]){return this.inlineQueue.push({src:_,tokens:M}),M}inlineTokens(_,M=[]){let $,j,z,V=_,X,G,Y;if(this.tokens.links){const Q=Object.keys(this.tokens.links);if(Q.length>0)for(;(X=this.tokenizer.rules.inline.reflinkSearch.exec(V))!=null;)Q.includes(X[0].slice(X[0].lastIndexOf("[")+1,-1))&&(V=V.slice(0,X.index)+"["+repeatString("a",X[0].length-2)+"]"+V.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(X=this.tokenizer.rules.inline.blockSkip.exec(V))!=null;)V=V.slice(0,X.index)+"["+repeatString("a",X[0].length-2)+"]"+V.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(X=this.tokenizer.rules.inline.escapedEmSt.exec(V))!=null;)V=V.slice(0,X.index+X[0].length-2)+"++"+V.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex),this.tokenizer.rules.inline.escapedEmSt.lastIndex--;for(;_;)if(G||(Y=""),G=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(Q=>($=Q.call({lexer:this},_,M))?(_=_.substring($.raw.length),M.push($),!0):!1))){if($=this.tokenizer.escape(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.tag(_)){_=_.substring($.raw.length),j=M[M.length-1],j&&$.type==="text"&&j.type==="text"?(j.raw+=$.raw,j.text+=$.text):M.push($);continue}if($=this.tokenizer.link(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.reflink(_,this.tokens.links)){_=_.substring($.raw.length),j=M[M.length-1],j&&$.type==="text"&&j.type==="text"?(j.raw+=$.raw,j.text+=$.text):M.push($);continue}if($=this.tokenizer.emStrong(_,V,Y)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.codespan(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.br(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.del(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.autolink(_,mangle)){_=_.substring($.raw.length),M.push($);continue}if(!this.state.inLink&&($=this.tokenizer.url(_,mangle))){_=_.substring($.raw.length),M.push($);continue}if(z=_,this.options.extensions&&this.options.extensions.startInline){let Q=1/0;const Z=_.slice(1);let te;this.options.extensions.startInline.forEach(function(ee){te=ee.call({lexer:this},Z),typeof te=="number"&&te>=0&&(Q=Math.min(Q,te))}),Q<1/0&&Q>=0&&(z=_.substring(0,Q+1))}if($=this.tokenizer.inlineText(z,smartypants)){_=_.substring($.raw.length),$.raw.slice(-1)!=="_"&&(Y=$.raw.slice(-1)),G=!0,j=M[M.length-1],j&&j.type==="text"?(j.raw+=$.raw,j.text+=$.text):M.push($);continue}if(_){const Q="Infinite loop on byte: "+_.charCodeAt(0);if(this.options.silent){console.error(Q);break}else throw new Error(Q)}}return M}}class Renderer{constructor(_){this.options=_||defaults}code(_,M,$){const j=(M||"").match(/\S*/)[0];if(this.options.highlight){const z=this.options.highlight(_,j);z!=null&&z!==_&&($=!0,_=z)}return _=_.replace(/\n$/,"")+`
`,j?'<pre><code class="'+this.options.langPrefix+escape$1(j)+'">'+($?_:escape$1(_,!0))+`</code></pre>
`:"<pre><code>"+($?_:escape$1(_,!0))+`</code></pre>
`}blockquote(_){return`<blockquote>
${_}</blockquote>
`}html(_){return _}heading(_,M,$,j){if(this.options.headerIds){const z=this.options.headerPrefix+j.slug($);return`<h${M} id="${z}">${_}</h${M}>
`}return`<h${M}>${_}</h${M}>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(_,M,$){const j=M?"ol":"ul",z=M&&$!==1?' start="'+$+'"':"";return"<"+j+z+`>
`+_+"</"+j+`>
`}listitem(_){return`<li>${_}</li>
`}checkbox(_){return"<input "+(_?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(_){return`<p>${_}</p>
`}table(_,M){return M&&(M=`<tbody>${M}</tbody>`),`<table>
<thead>
`+_+`</thead>
`+M+`</table>
`}tablerow(_){return`<tr>
${_}</tr>
`}tablecell(_,M){const $=M.header?"th":"td";return(M.align?`<${$} align="${M.align}">`:`<${$}>`)+_+`</${$}>
`}strong(_){return`<strong>${_}</strong>`}em(_){return`<em>${_}</em>`}codespan(_){return`<code>${_}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(_){return`<del>${_}</del>`}link(_,M,$){if(_=cleanUrl(this.options.sanitize,this.options.baseUrl,_),_===null)return $;let j='<a href="'+_+'"';return M&&(j+=' title="'+M+'"'),j+=">"+$+"</a>",j}image(_,M,$){if(_=cleanUrl(this.options.sanitize,this.options.baseUrl,_),_===null)return $;let j=`<img src="${_}" alt="${$}"`;return M&&(j+=` title="${M}"`),j+=this.options.xhtml?"/>":">",j}text(_){return _}}class TextRenderer{strong(_){return _}em(_){return _}codespan(_){return _}del(_){return _}html(_){return _}text(_){return _}link(_,M,$){return""+$}image(_,M,$){return""+$}br(){return""}}class Slugger{constructor(){this.seen={}}serialize(_){return _.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(_,M){let $=_,j=0;if(this.seen.hasOwnProperty($)){j=this.seen[_];do j++,$=_+"-"+j;while(this.seen.hasOwnProperty($))}return M||(this.seen[_]=j,this.seen[$]=0),$}slug(_,M={}){const $=this.serialize(_);return this.getNextSafeSlug($,M.dryrun)}}class Parser{constructor(_){this.options=_||defaults,this.options.renderer=this.options.renderer||new Renderer,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new TextRenderer,this.slugger=new Slugger}static parse(_,M){return new Parser(M).parse(_)}static parseInline(_,M){return new Parser(M).parseInline(_)}parse(_,M=!0){let $="",j,z,V,X,G,Y,Q,Z,te,ee,ne,re,se,ie,oe,he,le,ae,ue;const me=_.length;for(j=0;j<me;j++){if(ee=_[j],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[ee.type]&&(ue=this.options.extensions.renderers[ee.type].call({parser:this},ee),ue!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(ee.type))){$+=ue||"";continue}switch(ee.type){case"space":continue;case"hr":{$+=this.renderer.hr();continue}case"heading":{$+=this.renderer.heading(this.parseInline(ee.tokens),ee.depth,unescape$1(this.parseInline(ee.tokens,this.textRenderer)),this.slugger);continue}case"code":{$+=this.renderer.code(ee.text,ee.lang,ee.escaped);continue}case"table":{for(Z="",Q="",X=ee.header.length,z=0;z<X;z++)Q+=this.renderer.tablecell(this.parseInline(ee.header[z].tokens),{header:!0,align:ee.align[z]});for(Z+=this.renderer.tablerow(Q),te="",X=ee.rows.length,z=0;z<X;z++){for(Y=ee.rows[z],Q="",G=Y.length,V=0;V<G;V++)Q+=this.renderer.tablecell(this.parseInline(Y[V].tokens),{header:!1,align:ee.align[V]});te+=this.renderer.tablerow(Q)}$+=this.renderer.table(Z,te);continue}case"blockquote":{te=this.parse(ee.tokens),$+=this.renderer.blockquote(te);continue}case"list":{for(ne=ee.ordered,re=ee.start,se=ee.loose,X=ee.items.length,te="",z=0;z<X;z++)oe=ee.items[z],he=oe.checked,le=oe.task,ie="",oe.task&&(ae=this.renderer.checkbox(he),se?oe.tokens.length>0&&oe.tokens[0].type==="paragraph"?(oe.tokens[0].text=ae+" "+oe.tokens[0].text,oe.tokens[0].tokens&&oe.tokens[0].tokens.length>0&&oe.tokens[0].tokens[0].type==="text"&&(oe.tokens[0].tokens[0].text=ae+" "+oe.tokens[0].tokens[0].text)):oe.tokens.unshift({type:"text",text:ae}):ie+=ae),ie+=this.parse(oe.tokens,se),te+=this.renderer.listitem(ie,le,he);$+=this.renderer.list(te,ne,re);continue}case"html":{$+=this.renderer.html(ee.text);continue}case"paragraph":{$+=this.renderer.paragraph(this.parseInline(ee.tokens));continue}case"text":{for(te=ee.tokens?this.parseInline(ee.tokens):ee.text;j+1<me&&_[j+1].type==="text";)ee=_[++j],te+=`
`+(ee.tokens?this.parseInline(ee.tokens):ee.text);$+=M?this.renderer.paragraph(te):te;continue}default:{const fe='Token with "'+ee.type+'" type was not found.';if(this.options.silent){console.error(fe);return}else throw new Error(fe)}}}return $}parseInline(_,M){M=M||this.renderer;let $="",j,z,V;const X=_.length;for(j=0;j<X;j++){if(z=_[j],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[z.type]&&(V=this.options.extensions.renderers[z.type].call({parser:this},z),V!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(z.type))){$+=V||"";continue}switch(z.type){case"escape":{$+=M.text(z.text);break}case"html":{$+=M.html(z.text);break}case"link":{$+=M.link(z.href,z.title,this.parseInline(z.tokens,M));break}case"image":{$+=M.image(z.href,z.title,z.text);break}case"strong":{$+=M.strong(this.parseInline(z.tokens,M));break}case"em":{$+=M.em(this.parseInline(z.tokens,M));break}case"codespan":{$+=M.codespan(z.text);break}case"br":{$+=M.br();break}case"del":{$+=M.del(this.parseInline(z.tokens,M));break}case"text":{$+=M.text(z.text);break}default:{const G='Token with "'+z.type+'" type was not found.';if(this.options.silent){console.error(G);return}else throw new Error(G)}}}return $}}class Hooks{constructor(_){this.options=_||defaults}preprocess(_){return _}postprocess(_){return _}}Nt(Hooks,"passThroughHooks",new Set(["preprocess","postprocess"]));function onError(q,_,M){return $=>{if($.message+=`
Please report this to https://github.com/markedjs/marked.`,q){const j="<p>An error occurred:</p><pre>"+escape$1($.message+"",!0)+"</pre>";if(_)return Promise.resolve(j);if(M){M(null,j);return}return j}if(_)return Promise.reject($);if(M){M($);return}throw $}}function parseMarkdown(q,_){return(M,$,j)=>{typeof $=="function"&&(j=$,$=null);const z={...$};$={...marked.defaults,...z};const V=onError($.silent,$.async,j);if(typeof M>"u"||M===null)return V(new Error("marked(): input parameter is undefined or null"));if(typeof M!="string")return V(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(M)+", string expected"));if(checkSanitizeDeprecation($),$.hooks&&($.hooks.options=$),j){const X=$.highlight;let G;try{$.hooks&&(M=$.hooks.preprocess(M)),G=q(M,$)}catch(Z){return V(Z)}const Y=function(Z){let te;if(!Z)try{$.walkTokens&&marked.walkTokens(G,$.walkTokens),te=_(G,$),$.hooks&&(te=$.hooks.postprocess(te))}catch(ee){Z=ee}return $.highlight=X,Z?V(Z):j(null,te)};if(!X||X.length<3||(delete $.highlight,!G.length))return Y();let Q=0;marked.walkTokens(G,function(Z){Z.type==="code"&&(Q++,setTimeout(()=>{X(Z.text,Z.lang,function(te,ee){if(te)return Y(te);ee!=null&&ee!==Z.text&&(Z.text=ee,Z.escaped=!0),Q--,Q===0&&Y()})},0))}),Q===0&&Y();return}if($.async)return Promise.resolve($.hooks?$.hooks.preprocess(M):M).then(X=>q(X,$)).then(X=>$.walkTokens?Promise.all(marked.walkTokens(X,$.walkTokens)).then(()=>X):X).then(X=>_(X,$)).then(X=>$.hooks?$.hooks.postprocess(X):X).catch(V);try{$.hooks&&(M=$.hooks.preprocess(M));const X=q(M,$);$.walkTokens&&marked.walkTokens(X,$.walkTokens);let G=_(X,$);return $.hooks&&(G=$.hooks.postprocess(G)),G}catch(X){return V(X)}}}function marked(q,_,M){return parseMarkdown(Lexer.lex,Parser.parse)(q,_,M)}marked.options=marked.setOptions=function(q){return marked.defaults={...marked.defaults,...q},changeDefaults(marked.defaults),marked};marked.getDefaults=getDefaults;marked.defaults=defaults;marked.use=function(...q){const _=marked.defaults.extensions||{renderers:{},childTokens:{}};q.forEach(M=>{const $={...M};if($.async=marked.defaults.async||$.async||!1,M.extensions&&(M.extensions.forEach(j=>{if(!j.name)throw new Error("extension name required");if(j.renderer){const z=_.renderers[j.name];z?_.renderers[j.name]=function(...V){let X=j.renderer.apply(this,V);return X===!1&&(X=z.apply(this,V)),X}:_.renderers[j.name]=j.renderer}if(j.tokenizer){if(!j.level||j.level!=="block"&&j.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");_[j.level]?_[j.level].unshift(j.tokenizer):_[j.level]=[j.tokenizer],j.start&&(j.level==="block"?_.startBlock?_.startBlock.push(j.start):_.startBlock=[j.start]:j.level==="inline"&&(_.startInline?_.startInline.push(j.start):_.startInline=[j.start]))}j.childTokens&&(_.childTokens[j.name]=j.childTokens)}),$.extensions=_),M.renderer){const j=marked.defaults.renderer||new Renderer;for(const z in M.renderer){const V=j[z];j[z]=(...X)=>{let G=M.renderer[z].apply(j,X);return G===!1&&(G=V.apply(j,X)),G}}$.renderer=j}if(M.tokenizer){const j=marked.defaults.tokenizer||new Tokenizer;for(const z in M.tokenizer){const V=j[z];j[z]=(...X)=>{let G=M.tokenizer[z].apply(j,X);return G===!1&&(G=V.apply(j,X)),G}}$.tokenizer=j}if(M.hooks){const j=marked.defaults.hooks||new Hooks;for(const z in M.hooks){const V=j[z];Hooks.passThroughHooks.has(z)?j[z]=X=>{if(marked.defaults.async)return Promise.resolve(M.hooks[z].call(j,X)).then(Y=>V.call(j,Y));const G=M.hooks[z].call(j,X);return V.call(j,G)}:j[z]=(...X)=>{let G=M.hooks[z].apply(j,X);return G===!1&&(G=V.apply(j,X)),G}}$.hooks=j}if(M.walkTokens){const j=marked.defaults.walkTokens;$.walkTokens=function(z){let V=[];return V.push(M.walkTokens.call(this,z)),j&&(V=V.concat(j.call(this,z))),V}}marked.setOptions($)})};marked.walkTokens=function(q,_){let M=[];for(const $ of q)switch(M=M.concat(_.call(marked,$)),$.type){case"table":{for(const j of $.header)M=M.concat(marked.walkTokens(j.tokens,_));for(const j of $.rows)for(const z of j)M=M.concat(marked.walkTokens(z.tokens,_));break}case"list":{M=M.concat(marked.walkTokens($.items,_));break}default:marked.defaults.extensions&&marked.defaults.extensions.childTokens&&marked.defaults.extensions.childTokens[$.type]?marked.defaults.extensions.childTokens[$.type].forEach(function(j){M=M.concat(marked.walkTokens($[j],_))}):$.tokens&&(M=M.concat(marked.walkTokens($.tokens,_)))}return M};marked.parseInline=parseMarkdown(Lexer.lexInline,Parser.parseInline);marked.Parser=Parser;marked.parser=Parser.parse;marked.Renderer=Renderer;marked.TextRenderer=TextRenderer;marked.Lexer=Lexer;marked.lexer=Lexer.lex;marked.Tokenizer=Tokenizer;marked.Slugger=Slugger;marked.Hooks=Hooks;marked.parse=marked;marked.options;marked.setOptions;marked.use;marked.walkTokens;marked.parseInline;Parser.parse;Lexer.lex;const key={};function create_else_block$b(q){let _;return{c(){_=text(q[1])},m(M,$){insert(M,_,$)},p(M,$){$&2&&set_data(_,M[1])},i:noop,o:noop,d(M){M&&detach(_)}}}function create_if_block_5$4(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h6"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block_4$7(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h5"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block_3$c(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h4"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block_2$h(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h3"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block_1$j(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h2"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block$r(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h1"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_fragment$T(q){let _,M,$,j;const z=[create_if_block$r,create_if_block_1$j,create_if_block_2$h,create_if_block_3$c,create_if_block_4$7,create_if_block_5$4,create_else_block$b],V=[];function X(G,Y){return G[0]===1?0:G[0]===2?1:G[0]===3?2:G[0]===4?3:G[0]===5?4:G[0]===6?5:6}return _=X(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(G,Y){V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,[Y]){let Q=_;_=X(G),_===Q?V[_].p(G,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){V[_].d(G),G&&detach($)}}}function instance$Q(q,_,M){let $,{$$slots:j={},$$scope:z}=_,{depth:V}=_,{raw:X}=_,{text:G}=_;const{slug:Y,getOptions:Q}=getContext(key),Z=Q();return q.$$set=te=>{"depth"in te&&M(0,V=te.depth),"raw"in te&&M(1,X=te.raw),"text"in te&&M(3,G=te.text),"$$scope"in te&&M(4,z=te.$$scope)},q.$$.update=()=>{q.$$.dirty&8&&M(2,$=Z.headerIds?Z.headerPrefix+Y(G):void 0)},[V,X,$,G,z,j]}class Heading extends SvelteComponent{constructor(_){super(),init(this,_,instance$Q,create_fragment$T,safe_not_equal,{depth:0,raw:1,text:3})}}function create_fragment$S(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("p"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$P(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Paragraph extends SvelteComponent{constructor(_){super(),init(this,_,instance$P,create_fragment$S,safe_not_equal,{})}}function create_fragment$R(q){let _;const M=q[3].default,$=create_slot(M,q,q[2],null);return{c(){$&&$.c()},m(j,z){$&&$.m(j,z),_=!0},p(j,[z]){$&&$.p&&(!_||z&4)&&update_slot_base($,M,j,j[2],_?get_slot_changes(M,j[2],z,null):get_all_dirty_from_scope(j[2]),null)},i(j){_||(transition_in($,j),_=!0)},o(j){transition_out($,j),_=!1},d(j){$&&$.d(j)}}}function instance$O(q,_,M){let{$$slots:$={},$$scope:j}=_,{text:z}=_,{raw:V}=_;return q.$$set=X=>{"text"in X&&M(0,z=X.text),"raw"in X&&M(1,V=X.raw),"$$scope"in X&&M(2,j=X.$$scope)},[z,V,j,$]}class Text extends SvelteComponent{constructor(_){super(),init(this,_,instance$O,create_fragment$R,safe_not_equal,{text:0,raw:1})}}function create_fragment$Q(q){let _,M;return{c(){_=element("img"),src_url_equal(_.src,M=q[0])||attr(_,"src",M),attr(_,"title",q[1]),attr(_,"alt",q[2])},m($,j){insert($,_,j)},p($,[j]){j&1&&!src_url_equal(_.src,M=$[0])&&attr(_,"src",M),j&2&&attr(_,"title",$[1]),j&4&&attr(_,"alt",$[2])},i:noop,o:noop,d($){$&&detach(_)}}}function instance$N(q,_,M){let{href:$=""}=_,{title:j=void 0}=_,{text:z=""}=_;return q.$$set=V=>{"href"in V&&M(0,$=V.href),"title"in V&&M(1,j=V.title),"text"in V&&M(2,z=V.text)},[$,j,z]}let Image$1=class extends SvelteComponent{constructor(_){super(),init(this,_,instance$N,create_fragment$Q,safe_not_equal,{href:0,title:1,text:2})}};function create_fragment$P(q){let _,M;const $=q[3].default,j=create_slot($,q,q[2],null);return{c(){_=element("a"),j&&j.c(),attr(_,"href",q[0]),attr(_,"title",q[1])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&4)&&update_slot_base(j,$,z,z[2],M?get_slot_changes($,z[2],V,null):get_all_dirty_from_scope(z[2]),null),(!M||V&1)&&attr(_,"href",z[0]),(!M||V&2)&&attr(_,"title",z[1])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$M(q,_,M){let{$$slots:$={},$$scope:j}=_,{href:z=""}=_,{title:V=void 0}=_;return q.$$set=X=>{"href"in X&&M(0,z=X.href),"title"in X&&M(1,V=X.title),"$$scope"in X&&M(2,j=X.$$scope)},[z,V,j,$]}class Link extends SvelteComponent{constructor(_){super(),init(this,_,instance$M,create_fragment$P,safe_not_equal,{href:0,title:1})}}function create_fragment$O(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("em"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$L(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Em extends SvelteComponent{constructor(_){super(),init(this,_,instance$L,create_fragment$O,safe_not_equal,{})}}function create_fragment$N(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("del"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$K(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Del extends SvelteComponent{constructor(_){super(),init(this,_,instance$K,create_fragment$N,safe_not_equal,{})}}function create_fragment$M(q){let _,M=q[0].replace(/`/g,"")+"",$;return{c(){_=element("code"),$=text(M)},m(j,z){insert(j,_,z),append(_,$)},p(j,[z]){z&1&&M!==(M=j[0].replace(/`/g,"")+"")&&set_data($,M)},i:noop,o:noop,d(j){j&&detach(_)}}}function instance$J(q,_,M){let{raw:$}=_;return q.$$set=j=>{"raw"in j&&M(0,$=j.raw)},[$]}class Codespan extends SvelteComponent{constructor(_){super(),init(this,_,instance$J,create_fragment$M,safe_not_equal,{raw:0})}}function create_fragment$L(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("strong"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$I(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Strong extends SvelteComponent{constructor(_){super(),init(this,_,instance$I,create_fragment$L,safe_not_equal,{})}}function create_fragment$K(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("table"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$H(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Table extends SvelteComponent{constructor(_){super(),init(this,_,instance$H,create_fragment$K,safe_not_equal,{})}}function create_fragment$J(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("thead"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$G(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class TableHead extends SvelteComponent{constructor(_){super(),init(this,_,instance$G,create_fragment$J,safe_not_equal,{})}}function create_fragment$I(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("tbody"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$F(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class TableBody extends SvelteComponent{constructor(_){super(),init(this,_,instance$F,create_fragment$I,safe_not_equal,{})}}function create_fragment$H(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("tr"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$E(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class TableRow extends SvelteComponent{constructor(_){super(),init(this,_,instance$E,create_fragment$H,safe_not_equal,{})}}function create_else_block$a(q){let _,M;const $=q[3].default,j=create_slot($,q,q[2],null);return{c(){_=element("td"),j&&j.c(),attr(_,"align",q[1])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&4)&&update_slot_base(j,$,z,z[2],M?get_slot_changes($,z[2],V,null):get_all_dirty_from_scope(z[2]),null),(!M||V&2)&&attr(_,"align",z[1])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block$q(q){let _,M;const $=q[3].default,j=create_slot($,q,q[2],null);return{c(){_=element("th"),j&&j.c(),attr(_,"align",q[1])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&4)&&update_slot_base(j,$,z,z[2],M?get_slot_changes($,z[2],V,null):get_all_dirty_from_scope(z[2]),null),(!M||V&2)&&attr(_,"align",z[1])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_fragment$G(q){let _,M,$,j;const z=[create_if_block$q,create_else_block$a],V=[];function X(G,Y){return G[0]?0:1}return _=X(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(G,Y){V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,[Y]){let Q=_;_=X(G),_===Q?V[_].p(G,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){V[_].d(G),G&&detach($)}}}function instance$D(q,_,M){let{$$slots:$={},$$scope:j}=_,{header:z}=_,{align:V}=_;return q.$$set=X=>{"header"in X&&M(0,z=X.header),"align"in X&&M(1,V=X.align),"$$scope"in X&&M(2,j=X.$$scope)},[z,V,j,$]}class TableCell extends SvelteComponent{constructor(_){super(),init(this,_,instance$D,create_fragment$G,safe_not_equal,{header:0,align:1})}}function create_else_block$9(q){let _,M;const $=q[3].default,j=create_slot($,q,q[2],null);return{c(){_=element("ul"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&4)&&update_slot_base(j,$,z,z[2],M?get_slot_changes($,z[2],V,null):get_all_dirty_from_scope(z[2]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block$p(q){let _,M;const $=q[3].default,j=create_slot($,q,q[2],null);return{c(){_=element("ol"),j&&j.c(),attr(_,"start",q[1])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&4)&&update_slot_base(j,$,z,z[2],M?get_slot_changes($,z[2],V,null):get_all_dirty_from_scope(z[2]),null),(!M||V&2)&&attr(_,"start",z[1])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_fragment$F(q){let _,M,$,j;const z=[create_if_block$p,create_else_block$9],V=[];function X(G,Y){return G[0]?0:1}return _=X(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(G,Y){V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,[Y]){let Q=_;_=X(G),_===Q?V[_].p(G,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){V[_].d(G),G&&detach($)}}}function instance$C(q,_,M){let{$$slots:$={},$$scope:j}=_,{ordered:z}=_,{start:V}=_;return q.$$set=X=>{"ordered"in X&&M(0,z=X.ordered),"start"in X&&M(1,V=X.start),"$$scope"in X&&M(2,j=X.$$scope)},[z,V,j,$]}class List extends SvelteComponent{constructor(_){super(),init(this,_,instance$C,create_fragment$F,safe_not_equal,{ordered:0,start:1})}}function create_fragment$E(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("li"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$B(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class ListItem extends SvelteComponent{constructor(_){super(),init(this,_,instance$B,create_fragment$E,safe_not_equal,{})}}function create_fragment$D(q){let _;return{c(){_=element("hr")},m(M,$){insert(M,_,$)},p:noop,i:noop,o:noop,d(M){M&&detach(_)}}}class Hr extends SvelteComponent{constructor(_){super(),init(this,_,null,create_fragment$D,safe_not_equal,{})}}function create_fragment$C(q){let _,M;return{c(){_=new HtmlTag(!1),M=empty(),_.a=M},m($,j){_.m(q[0],$,j),insert($,M,j)},p($,[j]){j&1&&_.p($[0])},i:noop,o:noop,d($){$&&detach(M),$&&_.d()}}}function instance$A(q,_,M){let{text:$}=_;return q.$$set=j=>{"text"in j&&M(0,$=j.text)},[$]}class Html extends SvelteComponent{constructor(_){super(),init(this,_,instance$A,create_fragment$C,safe_not_equal,{text:0})}}function create_fragment$B(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("blockquote"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$z(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Blockquote extends SvelteComponent{constructor(_){super(),init(this,_,instance$z,create_fragment$B,safe_not_equal,{})}}function create_fragment$A(q){let _,M,$;return{c(){_=element("pre"),M=element("code"),$=text(q[1]),attr(_,"class",q[0])},m(j,z){insert(j,_,z),append(_,M),append(M,$)},p(j,[z]){z&2&&set_data($,j[1]),z&1&&attr(_,"class",j[0])},i:noop,o:noop,d(j){j&&detach(_)}}}function instance$y(q,_,M){let{lang:$}=_,{text:j}=_;return q.$$set=z=>{"lang"in z&&M(0,$=z.lang),"text"in z&&M(1,j=z.text)},[$,j]}class Code extends SvelteComponent{constructor(_){super(),init(this,_,instance$y,create_fragment$A,safe_not_equal,{lang:0,text:1})}}function create_fragment$z(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("br"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(z,V),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$x(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Br extends SvelteComponent{constructor(_){super(),init(this,_,instance$x,create_fragment$z,safe_not_equal,{})}}const defaultRenderers={heading:Heading,paragraph:Paragraph,text:Text,image:Image$1,link:Link,em:Em,strong:Strong,codespan:Codespan,del:Del,table:Table,tablehead:TableHead,tablebody:TableBody,tablerow:TableRow,tablecell:TableCell,list:List,orderedlistitem:null,unorderedlistitem:null,listitem:ListItem,hr:Hr,html:Html,blockquote:Blockquote,code:Code,br:Br},defaultOptions={baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,xhtml:!1};function create_fragment$y(q){let _,M;return _=new Parser$1({props:{tokens:q[0],renderers:q[1]}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,[j]){const z={};j&1&&(z.tokens=$[0]),j&2&&(z.renderers=$[1]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function instance$w(q,_,M){let $,j,z,V,{source:X=[]}=_,{renderers:G={}}=_,{options:Y={}}=_,{isInline:Q=!1}=_;const Z=createEventDispatcher();let te,ee,ne;return setContext(key,{slug:re=>j?j.slug(re):"",getOptions:()=>z}),onMount(()=>{M(7,ne=!0)}),q.$$set=re=>{"source"in re&&M(2,X=re.source),"renderers"in re&&M(3,G=re.renderers),"options"in re&&M(4,Y=re.options),"isInline"in re&&M(5,Q=re.isInline)},q.$$.update=()=>{q.$$.dirty&4&&M(8,$=Array.isArray(X)),q.$$.dirty&4&&(j=X?new Slugger:void 0),q.$$.dirty&16&&M(9,z={...defaultOptions,...Y}),q.$$.dirty&869&&($?M(0,te=X):(M(6,ee=new Lexer(z)),M(0,te=Q?ee.inlineTokens(X):ee.lex(X)),Z("parsed",{tokens:te}))),q.$$.dirty&8&&M(1,V={...defaultRenderers,...G}),q.$$.dirty&385&&ne&&!$&&Z("parsed",{tokens:te})},[te,V,X,G,Y,Q,ee,ne,$,z]}class SvelteMarkdown extends SvelteComponent{constructor(_){super(),init(this,_,instance$w,create_fragment$y,safe_not_equal,{source:2,renderers:3,options:4,isInline:5})}}function commonjsRequire(q){throw new Error('Could not dynamically require "'+q+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};(function(module,exports){(function(_,M){module.exports=M()})(globalThis,()=>(()=>{var __webpack_modules__=[,(q,_)=>{var Dt;Object.defineProperty(_,"__esModule",{value:!0}),_.VerbosityLevel=_.Util=_.UnknownErrorException=_.UnexpectedResponseException=_.TextRenderingMode=_.RenderingIntentFlag=_.PromiseCapability=_.PermissionFlag=_.PasswordResponses=_.PasswordException=_.PageActionEventType=_.OPS=_.MissingPDFException=_.MAX_IMAGE_SIZE_TO_CACHE=_.LINE_FACTOR=_.LINE_DESCENT_FACTOR=_.InvalidPDFException=_.ImageKind=_.IDENTITY_MATRIX=_.FormatError=_.FeatureTest=_.FONT_IDENTITY_MATRIX=_.DocumentActionEventType=_.CMapCompressionType=_.BaseException=_.BASELINE_FACTOR=_.AnnotationType=_.AnnotationReplyType=_.AnnotationMode=_.AnnotationFlag=_.AnnotationFieldFlag=_.AnnotationEditorType=_.AnnotationEditorPrefix=_.AnnotationEditorParamsType=_.AnnotationBorderStyleType=_.AnnotationActionEventType=_.AbortException=void 0,_.assert=xe,_.bytesToString=Ze,_.createValidAbsoluteUrl=Oe,_.getModificationDate=_t,_.getUuid=Tt,_.getVerbosityLevel=De,_.info=Me,_.isArrayBuffer=Je,_.isArrayEqual=lt,_.isNodeJS=void 0,_.normalizeUnicode=xt,_.objectFromMap=We,_.objectSize=pe,_.setVerbosityLevel=de,_.shadow=$e,_.string32=ot,_.stringToBytes=ut,_.stringToPDFString=qe,_.stringToUTF8String=Ve,_.unreachable=Te,_.utf8StringToString=Xe,_.warn=Ee;const M=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");_.isNodeJS=M;const $=[1,0,0,1,0,0];_.IDENTITY_MATRIX=$;const j=[.001,0,0,.001,0,0];_.FONT_IDENTITY_MATRIX=j;const z=1e7;_.MAX_IMAGE_SIZE_TO_CACHE=z;const V=1.35;_.LINE_FACTOR=V;const X=.35;_.LINE_DESCENT_FACTOR=X;const G=X/V;_.BASELINE_FACTOR=G;const Y={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};_.RenderingIntentFlag=Y;const Q={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};_.AnnotationMode=Q;const Z="pdfjs_internal_editor_";_.AnnotationEditorPrefix=Z;const te={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};_.AnnotationEditorType=te;const ee={RESIZE:1,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};_.AnnotationEditorParamsType=ee;const ne={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};_.PermissionFlag=ne;const re={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};_.TextRenderingMode=re;const se={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};_.ImageKind=se;const ie={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};_.AnnotationType=ie;const oe={GROUP:"Group",REPLY:"R"};_.AnnotationReplyType=oe;const he={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};_.AnnotationFlag=he;const le={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};_.AnnotationFieldFlag=le;const ae={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};_.AnnotationBorderStyleType=ae;const ue={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};_.AnnotationActionEventType=ue;const me={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};_.DocumentActionEventType=me;const fe={O:"PageOpen",C:"PageClose"};_.PageActionEventType=fe;const ce={ERRORS:0,WARNINGS:1,INFOS:5};_.VerbosityLevel=ce;const _e={NONE:0,BINARY:1};_.CMapCompressionType=_e;const we={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};_.OPS=we;const ge={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};_.PasswordResponses=ge;let Ae=ce.WARNINGS;function de(tt){Number.isInteger(tt)&&(Ae=tt)}function De(){return Ae}function Me(tt){Ae>=ce.INFOS&&console.log(`Info: ${tt}`)}function Ee(tt){Ae>=ce.WARNINGS&&console.log(`Warning: ${tt}`)}function Te(tt){throw new Error(tt)}function xe(tt,it){tt||Te(it)}function He(tt){switch(tt==null?void 0:tt.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Oe(tt,it=null,nt=null){if(!tt)return null;try{if(nt&&typeof tt=="string"){if(nt.addDefaultProtocol&&tt.startsWith("www.")){const Rt=tt.match(/\./g);(Rt==null?void 0:Rt.length)>=2&&(tt=`http://${tt}`)}if(nt.tryConvertEncoding)try{tt=Ve(tt)}catch{}}const gt=it?new URL(tt,it):new URL(tt);if(He(gt))return gt}catch{}return null}function $e(tt,it,nt,gt=!1){return Object.defineProperty(tt,it,{value:nt,enumerable:!gt,configurable:!0,writable:!1}),nt}const Pe=function(){function it(nt,gt){this.constructor===it&&Te("Cannot initialize BaseException."),this.message=nt,this.name=gt}return it.prototype=new Error,it.constructor=it,it}();_.BaseException=Pe;class ve extends Pe{constructor(it,nt){super(it,"PasswordException"),this.code=nt}}_.PasswordException=ve;class ye extends Pe{constructor(it,nt){super(it,"UnknownErrorException"),this.details=nt}}_.UnknownErrorException=ye;class Fe extends Pe{constructor(it){super(it,"InvalidPDFException")}}_.InvalidPDFException=Fe;class je extends Pe{constructor(it){super(it,"MissingPDFException")}}_.MissingPDFException=je;class Be extends Pe{constructor(it,nt){super(it,"UnexpectedResponseException"),this.status=nt}}_.UnexpectedResponseException=Be;class Ne extends Pe{constructor(it){super(it,"FormatError")}}_.FormatError=Ne;class ze extends Pe{constructor(it){super(it,"AbortException")}}_.AbortException=ze;function Ze(tt){(typeof tt!="object"||(tt==null?void 0:tt.length)===void 0)&&Te("Invalid argument for bytesToString");const it=tt.length,nt=8192;if(it<nt)return String.fromCharCode.apply(null,tt);const gt=[];for(let Rt=0;Rt<it;Rt+=nt){const St=Math.min(Rt+nt,it),Bt=tt.subarray(Rt,St);gt.push(String.fromCharCode.apply(null,Bt))}return gt.join("")}function ut(tt){typeof tt!="string"&&Te("Invalid argument for stringToBytes");const it=tt.length,nt=new Uint8Array(it);for(let gt=0;gt<it;++gt)nt[gt]=tt.charCodeAt(gt)&255;return nt}function ot(tt){return String.fromCharCode(tt>>24&255,tt>>16&255,tt>>8&255,tt&255)}function pe(tt){return Object.keys(tt).length}function We(tt){const it=Object.create(null);for(const[nt,gt]of tt)it[nt]=gt;return it}function Qe(){const tt=new Uint8Array(4);return tt[0]=1,new Uint32Array(tt.buffer,0,1)[0]===1}function Ce(){try{return new Function(""),!0}catch{return!1}}class Ie{static get isLittleEndian(){return $e(this,"isLittleEndian",Qe())}static get isEvalSupported(){return $e(this,"isEvalSupported",Ce())}static get isOffscreenCanvasSupported(){return $e(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?$e(this,"platform",{isWin:!1,isMac:!1}):$e(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}}_.FeatureTest=Ie;const Ge=[...Array(256).keys()].map(tt=>tt.toString(16).padStart(2,"0"));class rt{static makeHexColor(it,nt,gt){return`#${Ge[it]}${Ge[nt]}${Ge[gt]}`}static scaleMinMax(it,nt){let gt;it[0]?(it[0]<0&&(gt=nt[0],nt[0]=nt[1],nt[1]=gt),nt[0]*=it[0],nt[1]*=it[0],it[3]<0&&(gt=nt[2],nt[2]=nt[3],nt[3]=gt),nt[2]*=it[3],nt[3]*=it[3]):(gt=nt[0],nt[0]=nt[2],nt[2]=gt,gt=nt[1],nt[1]=nt[3],nt[3]=gt,it[1]<0&&(gt=nt[2],nt[2]=nt[3],nt[3]=gt),nt[2]*=it[1],nt[3]*=it[1],it[2]<0&&(gt=nt[0],nt[0]=nt[1],nt[1]=gt),nt[0]*=it[2],nt[1]*=it[2]),nt[0]+=it[4],nt[1]+=it[4],nt[2]+=it[5],nt[3]+=it[5]}static transform(it,nt){return[it[0]*nt[0]+it[2]*nt[1],it[1]*nt[0]+it[3]*nt[1],it[0]*nt[2]+it[2]*nt[3],it[1]*nt[2]+it[3]*nt[3],it[0]*nt[4]+it[2]*nt[5]+it[4],it[1]*nt[4]+it[3]*nt[5]+it[5]]}static applyTransform(it,nt){const gt=it[0]*nt[0]+it[1]*nt[2]+nt[4],Rt=it[0]*nt[1]+it[1]*nt[3]+nt[5];return[gt,Rt]}static applyInverseTransform(it,nt){const gt=nt[0]*nt[3]-nt[1]*nt[2],Rt=(it[0]*nt[3]-it[1]*nt[2]+nt[2]*nt[5]-nt[4]*nt[3])/gt,St=(-it[0]*nt[1]+it[1]*nt[0]+nt[4]*nt[1]-nt[5]*nt[0])/gt;return[Rt,St]}static getAxialAlignedBoundingBox(it,nt){const gt=this.applyTransform(it,nt),Rt=this.applyTransform(it.slice(2,4),nt),St=this.applyTransform([it[0],it[3]],nt),Bt=this.applyTransform([it[2],it[1]],nt);return[Math.min(gt[0],Rt[0],St[0],Bt[0]),Math.min(gt[1],Rt[1],St[1],Bt[1]),Math.max(gt[0],Rt[0],St[0],Bt[0]),Math.max(gt[1],Rt[1],St[1],Bt[1])]}static inverseTransform(it){const nt=it[0]*it[3]-it[1]*it[2];return[it[3]/nt,-it[1]/nt,-it[2]/nt,it[0]/nt,(it[2]*it[5]-it[4]*it[3])/nt,(it[4]*it[1]-it[5]*it[0])/nt]}static singularValueDecompose2dScale(it){const nt=[it[0],it[2],it[1],it[3]],gt=it[0]*nt[0]+it[1]*nt[2],Rt=it[0]*nt[1]+it[1]*nt[3],St=it[2]*nt[0]+it[3]*nt[2],Bt=it[2]*nt[1]+it[3]*nt[3],Lt=(gt+Bt)/2,Se=Math.sqrt((gt+Bt)**2-4*(gt*Bt-St*Rt))/2,et=Lt+Se||1,ft=Lt-Se||1;return[Math.sqrt(et),Math.sqrt(ft)]}static normalizeRect(it){const nt=it.slice(0);return it[0]>it[2]&&(nt[0]=it[2],nt[2]=it[0]),it[1]>it[3]&&(nt[1]=it[3],nt[3]=it[1]),nt}static intersect(it,nt){const gt=Math.max(Math.min(it[0],it[2]),Math.min(nt[0],nt[2])),Rt=Math.min(Math.max(it[0],it[2]),Math.max(nt[0],nt[2]));if(gt>Rt)return null;const St=Math.max(Math.min(it[1],it[3]),Math.min(nt[1],nt[3])),Bt=Math.min(Math.max(it[1],it[3]),Math.max(nt[1],nt[3]));return St>Bt?null:[gt,St,Rt,Bt]}static bezierBoundingBox(it,nt,gt,Rt,St,Bt,Lt,Se){const et=[],ft=[[],[]];let dt,Re,ke,Ue,Le,Ke,at,pt;for(let Ft=0;Ft<2;++Ft){if(Ft===0?(Re=6*it-12*gt+6*St,dt=-3*it+9*gt-9*St+3*Lt,ke=3*gt-3*it):(Re=6*nt-12*Rt+6*Bt,dt=-3*nt+9*Rt-9*Bt+3*Se,ke=3*Rt-3*nt),Math.abs(dt)<1e-12){if(Math.abs(Re)<1e-12)continue;Ue=-ke/Re,0<Ue&&Ue<1&&et.push(Ue);continue}at=Re*Re-4*ke*dt,pt=Math.sqrt(at),!(at<0)&&(Le=(-Re+pt)/(2*dt),0<Le&&Le<1&&et.push(Le),Ke=(-Re-pt)/(2*dt),0<Ke&&Ke<1&&et.push(Ke))}let wt=et.length,At;const bt=wt;for(;wt--;)Ue=et[wt],At=1-Ue,ft[0][wt]=At*At*At*it+3*At*At*Ue*gt+3*At*Ue*Ue*St+Ue*Ue*Ue*Lt,ft[1][wt]=At*At*At*nt+3*At*At*Ue*Rt+3*At*Ue*Ue*Bt+Ue*Ue*Ue*Se;return ft[0][bt]=it,ft[1][bt]=nt,ft[0][bt+1]=Lt,ft[1][bt+1]=Se,ft[0].length=ft[1].length=bt+2,[Math.min(...ft[0]),Math.min(...ft[1]),Math.max(...ft[0]),Math.max(...ft[1])]}}_.Util=rt;const ct=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function qe(tt){if(tt[0]>="ï"){let nt;if(tt[0]==="þ"&&tt[1]==="ÿ"?nt="utf-16be":tt[0]==="ÿ"&&tt[1]==="þ"?nt="utf-16le":tt[0]==="ï"&&tt[1]==="»"&&tt[2]==="¿"&&(nt="utf-8"),nt)try{const gt=new TextDecoder(nt,{fatal:!0}),Rt=ut(tt);return gt.decode(Rt)}catch(gt){Ee(`stringToPDFString: "${gt}".`)}}const it=[];for(let nt=0,gt=tt.length;nt<gt;nt++){const Rt=ct[tt.charCodeAt(nt)];it.push(Rt?String.fromCharCode(Rt):tt.charAt(nt))}return it.join("")}function Ve(tt){return decodeURIComponent(escape(tt))}function Xe(tt){return unescape(encodeURIComponent(tt))}function Je(tt){return typeof tt=="object"&&(tt==null?void 0:tt.byteLength)!==void 0}function lt(tt,it){if(tt.length!==it.length)return!1;for(let nt=0,gt=tt.length;nt<gt;nt++)if(tt[nt]!==it[nt])return!1;return!0}function _t(tt=new Date){return[tt.getUTCFullYear().toString(),(tt.getUTCMonth()+1).toString().padStart(2,"0"),tt.getUTCDate().toString().padStart(2,"0"),tt.getUTCHours().toString().padStart(2,"0"),tt.getUTCMinutes().toString().padStart(2,"0"),tt.getUTCSeconds().toString().padStart(2,"0")].join("")}class mt{constructor(){Ye(this,Dt,!1);this.promise=new Promise((it,nt)=>{this.resolve=gt=>{ht(this,Dt,!0),it(gt)},this.reject=gt=>{ht(this,Dt,!0),nt(gt)}})}get settled(){return be(this,Dt)}}Dt=new WeakMap,_.PromiseCapability=mt;let Ct=null,Et=null;function xt(tt){return Ct||(Ct=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Et=new Map([["ﬅ","ſt"]])),tt.replaceAll(Ct,(it,nt,gt)=>nt?nt.normalize("NFKC"):Et.get(gt))}function Tt(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const tt=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(tt);else for(let it=0;it<32;it++)tt[it]=Math.floor(Math.random()*255);return Ze(tt)}},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var q,M,$,j,Xt,V,an,G,Y,Q,Z,te,ee,ne,re,se,mn,oe,he,gn,ae,ue;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports.build=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(fe){if(typeof fe=="string"||fe instanceof URL?fe={url:fe}:(0,_util.isArrayBuffer)(fe)&&(fe={data:fe}),typeof fe!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!fe.url&&!fe.data&&!fe.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const ce=new PDFDocumentLoadingTask,{docId:_e}=ce,we=fe.url?getUrlProp(fe.url):null,ge=fe.data?getDataProp(fe.data):null,Ae=fe.httpHeaders||null,de=fe.withCredentials===!0,De=fe.password??null,Me=fe.range instanceof PDFDataRangeTransport?fe.range:null,Ee=Number.isInteger(fe.rangeChunkSize)&&fe.rangeChunkSize>0?fe.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let Te=fe.worker instanceof PDFWorker?fe.worker:null;const xe=fe.verbosity,He=typeof fe.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(fe.docBaseUrl)?fe.docBaseUrl:null,Oe=typeof fe.cMapUrl=="string"?fe.cMapUrl:null,$e=fe.cMapPacked!==!1,Pe=fe.CMapReaderFactory||DefaultCMapReaderFactory,ve=typeof fe.standardFontDataUrl=="string"?fe.standardFontDataUrl:null,ye=fe.StandardFontDataFactory||DefaultStandardFontDataFactory,Fe=fe.stopAtErrors!==!0,je=Number.isInteger(fe.maxImageSize)&&fe.maxImageSize>-1?fe.maxImageSize:-1,Be=fe.isEvalSupported!==!1,Ne=typeof fe.isOffscreenCanvasSupported=="boolean"?fe.isOffscreenCanvasSupported:!_util.isNodeJS,ze=Number.isInteger(fe.canvasMaxAreaInBytes)?fe.canvasMaxAreaInBytes:-1,Ze=typeof fe.disableFontFace=="boolean"?fe.disableFontFace:_util.isNodeJS,ut=fe.fontExtraProperties===!0,ot=fe.enableXfa===!0,pe=fe.ownerDocument||globalThis.document,We=fe.disableRange===!0,Qe=fe.disableStream===!0,Ce=fe.disableAutoFetch===!0,Ie=fe.pdfBug===!0,Ge=Me?Me.length:fe.length??NaN,rt=typeof fe.useSystemFonts=="boolean"?fe.useSystemFonts:!_util.isNodeJS&&!Ze,ct=typeof fe.useWorkerFetch=="boolean"?fe.useWorkerFetch:Pe===_display_utils.DOMCMapReaderFactory&&ye===_display_utils.DOMStandardFontDataFactory&&Oe&&ve&&(0,_display_utils.isValidFetchUrl)(Oe,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(ve,document.baseURI),qe=fe.canvasFactory||new DefaultCanvasFactory({ownerDocument:pe}),Ve=fe.filterFactory||new DefaultFilterFactory({docId:_e,ownerDocument:pe}),Xe=null;(0,_util.setVerbosityLevel)(xe);const Je={canvasFactory:qe,filterFactory:Ve};if(ct||(Je.cMapReaderFactory=new Pe({baseUrl:Oe,isCompressed:$e}),Je.standardFontDataFactory=new ye({baseUrl:ve})),!Te){const mt={verbosity:xe,port:_worker_options.GlobalWorkerOptions.workerPort};Te=mt.port?PDFWorker.fromPort(mt):new PDFWorker(mt),ce._worker=Te}const lt={docId:_e,apiVersion:"3.9.179",data:ge,password:De,disableAutoFetch:Ce,rangeChunkSize:Ee,length:Ge,docBaseUrl:He,enableXfa:ot,evaluatorOptions:{maxImageSize:je,disableFontFace:Ze,ignoreErrors:Fe,isEvalSupported:Be,isOffscreenCanvasSupported:Ne,canvasMaxAreaInBytes:ze,fontExtraProperties:ut,useSystemFonts:rt,cMapUrl:ct?Oe:null,standardFontDataUrl:ct?ve:null}},_t={ignoreErrors:Fe,isEvalSupported:Be,disableFontFace:Ze,fontExtraProperties:ut,enableXfa:ot,ownerDocument:pe,disableAutoFetch:Ce,pdfBug:Ie,styleElement:Xe};return Te.promise.then(function(){if(ce.destroyed)throw new Error("Loading aborted");const mt=_fetchDocument(Te,lt),Ct=new Promise(function(Et){let xt;Me?xt=new _transport_stream.PDFDataTransportStream({length:Ge,initialData:Me.initialData,progressiveDone:Me.progressiveDone,contentDispositionFilename:Me.contentDispositionFilename,disableRange:We,disableStream:Qe},Me):ge||(xt=(Dt=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(Dt):(0,_display_utils.isValidFetchUrl)(Dt.url)?new _displayFetch_stream.PDFFetchStream(Dt):new _displayNetwork.PDFNetworkStream(Dt))({url:we,length:Ge,httpHeaders:Ae,withCredentials:de,rangeChunkSize:Ee,disableRange:We,disableStream:Qe})),Et(xt)});return Promise.all([mt,Ct]).then(function([Et,xt]){if(ce.destroyed)throw new Error("Loading aborted");const Tt=new _message_handler.MessageHandler(_e,Et,Te.port),Dt=new WorkerTransport(Tt,ce,xt,_t,Je);ce._transport=Dt,Tt.send("Ready",null)})}).catch(ce._capability.reject),ce}async function _fetchDocument(fe,ce){if(fe.destroyed)throw new Error("Worker was destroyed");const _e=await fe.messageHandler.sendWithPromise("GetDocRequest",ce,ce.data?[ce.data.buffer]:null);if(fe.destroyed)throw new Error("Worker was destroyed");return _e}function getUrlProp(fe){if(fe instanceof URL)return fe.href;try{return new URL(fe,window.location).href}catch{if(_util.isNodeJS&&typeof fe=="string")return fe}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(fe){if(_util.isNodeJS&&typeof Buffer<"u"&&fe instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(fe instanceof Uint8Array&&fe.byteLength===fe.buffer.byteLength)return fe;if(typeof fe=="string")return(0,_util.stringToBytes)(fe);if(typeof fe=="object"&&!isNaN(fe==null?void 0:fe.length)||(0,_util.isArrayBuffer)(fe))return new Uint8Array(fe);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const _=class{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${Wt(_,q)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var ce;this.destroyed=!0,await((ce=this._transport)==null?void 0:ce.destroy()),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};let PDFDocumentLoadingTask=_;q=new WeakMap,Ye(PDFDocumentLoadingTask,q,0),exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(ce,_e,we=!1,ge=null){this.length=ce,this.initialData=_e,this.progressiveDone=we,this.contentDispositionFilename=ge,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(ce){this._rangeListeners.push(ce)}addProgressListener(ce){this._progressListeners.push(ce)}addProgressiveReadListener(ce){this._progressiveReadListeners.push(ce)}addProgressiveDoneListener(ce){this._progressiveDoneListeners.push(ce)}onDataRange(ce,_e){for(const we of this._rangeListeners)we(ce,_e)}onDataProgress(ce,_e){this._readyCapability.promise.then(()=>{for(const we of this._progressListeners)we(ce,_e)})}onDataProgressiveRead(ce){this._readyCapability.promise.then(()=>{for(const _e of this._progressiveReadListeners)_e(ce)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const ce of this._progressiveDoneListeners)ce()})}transportReady(){this._readyCapability.resolve()}requestDataRange(ce,_e){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(ce,_e){this._pdfInfo=ce,this._transport=_e}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(ce){return this._transport.getPage(ce)}getPageIndex(ce){return this._transport.getPageIndex(ce)}getDestinations(){return this._transport.getDestinations()}getDestination(ce){return this._transport.getDestination(ce)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(ce=!1){return this._transport.startCleanup(ce||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(ce,_e,we,ge=!1){Ye(this,j);Ye(this,V);Ye(this,M,null);Ye(this,$,!1);this._pageIndex=ce,this._pageInfo=_e,this._transport=we,this._stats=ge?new _display_utils.StatTimer:null,this._pdfBug=ge,this.commonObjs=we.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:ce,rotation:_e=this.rotate,offsetX:we=0,offsetY:ge=0,dontFlip:Ae=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:ce,rotation:_e,offsetX:we,offsetY:ge,dontFlip:Ae})}getAnnotations({intent:ce="display"}={}){const _e=this._transport.getRenderingIntent(ce);return this._transport.getAnnotations(this._pageIndex,_e.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var ce;return((ce=this._transport._htmlForXfa)==null?void 0:ce.children[this._pageIndex])||null}render({canvasContext:ce,viewport:_e,intent:we="display",annotationMode:ge=_util.AnnotationMode.ENABLE,transform:Ae=null,background:de=null,optionalContentConfigPromise:De=null,annotationCanvasMap:Me=null,pageColors:Ee=null,printAnnotationStorage:Te=null}){var ye,Fe;(ye=this._stats)==null||ye.time("Overall");const xe=this._transport.getRenderingIntent(we,ge,Te);ht(this,$,!1),st(this,V,an).call(this),De||(De=this._transport.getOptionalContentConfig());let He=this._intentStates.get(xe.cacheKey);He||(He=Object.create(null),this._intentStates.set(xe.cacheKey,He)),He.streamReaderCancelTimeout&&(clearTimeout(He.streamReaderCancelTimeout),He.streamReaderCancelTimeout=null);const Oe=!!(xe.renderingIntent&_util.RenderingIntentFlag.PRINT);He.displayReadyCapability||(He.displayReadyCapability=new _util.PromiseCapability,He.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(Fe=this._stats)==null||Fe.time("Page Request"),this._pumpOperatorList(xe));const $e=je=>{var Be,Ne;He.renderTasks.delete(Pe),(this._maybeCleanupAfterRender||Oe)&&ht(this,$,!0),st(this,j,Xt).call(this,!Oe),je?(Pe.capability.reject(je),this._abortOperatorList({intentState:He,reason:je instanceof Error?je:new Error(je)})):Pe.capability.resolve(),(Be=this._stats)==null||Be.timeEnd("Rendering"),(Ne=this._stats)==null||Ne.timeEnd("Overall")},Pe=new InternalRenderTask({callback:$e,params:{canvasContext:ce,viewport:_e,transform:Ae,background:de},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:Me,operatorList:He.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!Oe,pdfBug:this._pdfBug,pageColors:Ee});(He.renderTasks||(He.renderTasks=new Set)).add(Pe);const ve=Pe.task;return Promise.all([He.displayReadyCapability.promise,De]).then(([je,Be])=>{var Ne;if(this.destroyed){$e();return}(Ne=this._stats)==null||Ne.time("Rendering"),Pe.initializeGraphics({transparency:je,optionalContentConfig:Be}),Pe.operatorListChanged()}).catch($e),ve}getOperatorList({intent:ce="display",annotationMode:_e=_util.AnnotationMode.ENABLE,printAnnotationStorage:we=null}={}){var Me;function ge(){de.operatorList.lastChunk&&(de.opListReadCapability.resolve(de.operatorList),de.renderTasks.delete(De))}const Ae=this._transport.getRenderingIntent(ce,_e,we,!0);let de=this._intentStates.get(Ae.cacheKey);de||(de=Object.create(null),this._intentStates.set(Ae.cacheKey,de));let De;return de.opListReadCapability||(De=Object.create(null),De.operatorListChanged=ge,de.opListReadCapability=new _util.PromiseCapability,(de.renderTasks||(de.renderTasks=new Set)).add(De),de.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(Me=this._stats)==null||Me.time("Page Request"),this._pumpOperatorList(Ae)),de.opListReadCapability.promise}streamTextContent({includeMarkedContent:ce=!1,disableNormalization:_e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:ce===!0,disableNormalization:_e===!0},{highWaterMark:100,size(ge){return ge.items.length}})}getTextContent(ce={}){if(this._transport._htmlForXfa)return this.getXfa().then(we=>_xfa_text.XfaText.textContent(we));const _e=this.streamTextContent(ce);return new Promise(function(we,ge){function Ae(){de.read().then(function({value:Me,done:Ee}){if(Ee){we(De);return}Object.assign(De.styles,Me.styles),De.items.push(...Me.items),Ae()},ge)}const de=_e.getReader(),De={items:[],styles:Object.create(null)};Ae()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const ce=[];for(const _e of this._intentStates.values())if(this._abortOperatorList({intentState:_e,reason:new Error("Page was destroyed."),force:!0}),!_e.opListReadCapability)for(const we of _e.renderTasks)ce.push(we.completed),we.cancel();return this.objs.clear(),ht(this,$,!1),st(this,V,an).call(this),Promise.all(ce)}cleanup(ce=!1){ht(this,$,!0);const _e=st(this,j,Xt).call(this,!1);return ce&&_e&&this._stats&&(this._stats=new _display_utils.StatTimer),_e}_startRenderPage(ce,_e){var ge,Ae;const we=this._intentStates.get(_e);we&&((ge=this._stats)==null||ge.timeEnd("Page Request"),(Ae=we.displayReadyCapability)==null||Ae.resolve(ce))}_renderPageChunk(ce,_e){for(let we=0,ge=ce.length;we<ge;we++)_e.operatorList.fnArray.push(ce.fnArray[we]),_e.operatorList.argsArray.push(ce.argsArray[we]);_e.operatorList.lastChunk=ce.lastChunk,_e.operatorList.separateAnnots=ce.separateAnnots;for(const we of _e.renderTasks)we.operatorListChanged();ce.lastChunk&&st(this,j,Xt).call(this,!0)}_pumpOperatorList({renderingIntent:ce,cacheKey:_e,annotationStorageSerializable:we}){const{map:ge,transfers:Ae}=we,De=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:ce,cacheKey:_e,annotationStorage:ge},Ae).getReader(),Me=this._intentStates.get(_e);Me.streamReader=De;const Ee=()=>{De.read().then(({value:Te,done:xe})=>{if(xe){Me.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(Te,Me),Ee())},Te=>{if(Me.streamReader=null,!this._transport.destroyed){if(Me.operatorList){Me.operatorList.lastChunk=!0;for(const xe of Me.renderTasks)xe.operatorListChanged();st(this,j,Xt).call(this,!0)}if(Me.displayReadyCapability)Me.displayReadyCapability.reject(Te);else if(Me.opListReadCapability)Me.opListReadCapability.reject(Te);else throw Te}})};Ee()}_abortOperatorList({intentState:ce,reason:_e,force:we=!1}){if(ce.streamReader){if(ce.streamReaderCancelTimeout&&(clearTimeout(ce.streamReaderCancelTimeout),ce.streamReaderCancelTimeout=null),!we){if(ce.renderTasks.size>0)return;if(_e instanceof _display_utils.RenderingCancelledException){let ge=RENDERING_CANCELLED_TIMEOUT;_e.extraDelay>0&&_e.extraDelay<1e3&&(ge+=_e.extraDelay),ce.streamReaderCancelTimeout=setTimeout(()=>{ce.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:ce,reason:_e,force:!0})},ge);return}}if(ce.streamReader.cancel(new _util.AbortException(_e.message)).catch(()=>{}),ce.streamReader=null,!this._transport.destroyed){for(const[ge,Ae]of this._intentStates)if(Ae===ce){this._intentStates.delete(ge);break}this.cleanup()}}}get stats(){return this._stats}}M=new WeakMap,$=new WeakMap,j=new WeakSet,Xt=function(ce=!1){if(st(this,V,an).call(this),!be(this,$)||this.destroyed)return!1;if(ce)return ht(this,M,setTimeout(()=>{ht(this,M,null),st(this,j,Xt).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:_e,operatorList:we}of this._intentStates.values())if(_e.size>0||!we.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),ht(this,$,!1),!0},V=new WeakSet,an=function(){be(this,M)&&(clearTimeout(be(this,M)),ht(this,M,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){Ye(this,G,new Set);Ye(this,Y,Promise.resolve())}postMessage(ce,_e){const we={data:structuredClone(ce,_e?{transfer:_e}:null)};be(this,Y).then(()=>{for(const ge of be(this,G))ge.call(this,we)})}addEventListener(ce,_e){be(this,G).add(_e)}removeEventListener(ce,_e){be(this,G).delete(_e)}terminate(){be(this,G).clear()}}G=new WeakMap,Y=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const fe=(Q=document==null?void 0:document.currentScript)==null?void 0:Q.src;fe&&(PDFWorkerUtil.fallbackWorkerSrc=fe.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(fe,ce){let _e;try{if(_e=new URL(fe),!_e.origin||_e.origin==="null")return!1}catch{return!1}const we=new URL(ce,_e);return _e.origin===we.origin},PDFWorkerUtil.createCDNWrapper=function(fe){const ce=`importScripts("${fe}");`;return URL.createObjectURL(new Blob([ce]))}}const _PDFWorker=class{constructor({name:fe=null,port:ce=null,verbosity:_e=(0,_util.getVerbosityLevel)()}={}){if(ce&&be(_PDFWorker,Z).has(ce))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=fe,this.destroyed=!1,this.verbosity=_e,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,ce){be(_PDFWorker,Z).set(ce,this),this._initializeFromPort(ce);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(fe){this._port=fe,this._messageHandler=new _message_handler.MessageHandler("main","worker",fe),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:fe}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,fe)||(fe=PDFWorkerUtil.createCDNWrapper(new URL(fe,window.location).href));const ce=new Worker(fe),_e=new _message_handler.MessageHandler("main","worker",ce),we=()=>{ce.removeEventListener("error",ge),_e.destroy(),ce.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},ge=()=>{this._webWorker||we()};ce.addEventListener("error",ge),_e.on("test",de=>{if(ce.removeEventListener("error",ge),this.destroyed){we();return}de?(this._messageHandler=_e,this._port=ce,this._webWorker=ce,this._readyCapability.resolve(),_e.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),_e.destroy(),ce.terminate())}),_e.on("ready",de=>{if(ce.removeEventListener("error",ge),this.destroyed){we();return}try{Ae()}catch{this._setupFakeWorker()}});const Ae=()=>{const de=new Uint8Array;_e.send("test",de,[de.buffer])};Ae();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(fe=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const ce=new LoopbackPort;this._port=ce;const _e=`fake${PDFWorkerUtil.fakeWorkerId++}`,we=new _message_handler.MessageHandler(_e+"_worker",_e,ce);fe.setup(we,ce);const ge=new _message_handler.MessageHandler(_e,_e+"_worker",ce);this._messageHandler=ge,this._readyCapability.resolve(),ge.send("configure",{verbosity:this.verbosity})}).catch(fe=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${fe.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),be(_PDFWorker,Z).delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(fe){if(!(fe!=null&&fe.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return be(this,Z).has(fe.port)?be(this,Z).get(fe.port):new _PDFWorker(fe)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var fe;try{return((fe=globalThis.pdfjsWorker)==null?void 0:fe.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};let PDFWorker=_PDFWorker;Z=new WeakMap,Ye(PDFWorker,Z,new WeakMap),exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(ce,_e,we,ge,Ae){Ye(this,se);Ye(this,te,new Map);Ye(this,ee,new Map);Ye(this,ne,new Map);Ye(this,re,null);this.messageHandler=ce,this.loadingTask=_e,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:ge.ownerDocument,styleElement:ge.styleElement}),this._params=ge,this.canvasFactory=Ae.canvasFactory,this.filterFactory=Ae.filterFactory,this.cMapReaderFactory=Ae.cMapReaderFactory,this.standardFontDataFactory=Ae.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=we,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(ce,_e=_util.AnnotationMode.ENABLE,we=null,ge=!1){let Ae=_util.RenderingIntentFlag.DISPLAY,de=_annotation_storage.SerializableEmpty;switch(ce){case"any":Ae=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":Ae=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${ce}`)}switch(_e){case _util.AnnotationMode.DISABLE:Ae+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:Ae+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:Ae+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,de=(Ae&_util.RenderingIntentFlag.PRINT&&we instanceof _annotation_storage.PrintAnnotationStorage?we:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${_e}`)}return ge&&(Ae+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:Ae,cacheKey:`${Ae}_${de.hash}`,annotationStorageSerializable:de}}destroy(){var we;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,(we=be(this,re))==null||we.reject(new Error("Worker was destroyed during onPassword callback"));const ce=[];for(const ge of be(this,ee).values())ce.push(ge._destroy());be(this,ee).clear(),be(this,ne).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const _e=this.messageHandler.sendWithPromise("Terminate",null);return ce.push(_e),Promise.all(ce).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),be(this,te).clear(),this.filterFactory.destroy(),this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:ce,loadingTask:_e}=this;ce.on("GetReader",(we,ge)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=Ae=>{this._lastProgress={loaded:Ae.loaded,total:Ae.total}},ge.onPull=()=>{this._fullReader.read().then(function({value:Ae,done:de}){if(de){ge.close();return}(0,_util.assert)(Ae instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),ge.enqueue(new Uint8Array(Ae),1,[Ae])}).catch(Ae=>{ge.error(Ae)})},ge.onCancel=Ae=>{this._fullReader.cancel(Ae),ge.ready.catch(de=>{if(!this.destroyed)throw de})}}),ce.on("ReaderHeadersReady",we=>{const ge=new _util.PromiseCapability,Ae=this._fullReader;return Ae.headersReady.then(()=>{var de;(!Ae.isStreamingSupported||!Ae.isRangeSupported)&&(this._lastProgress&&((de=_e.onProgress)==null||de.call(_e,this._lastProgress)),Ae.onProgress=De=>{var Me;(Me=_e.onProgress)==null||Me.call(_e,{loaded:De.loaded,total:De.total})}),ge.resolve({isStreamingSupported:Ae.isStreamingSupported,isRangeSupported:Ae.isRangeSupported,contentLength:Ae.contentLength})},ge.reject),ge.promise}),ce.on("GetRangeReader",(we,ge)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const Ae=this._networkStream.getRangeReader(we.begin,we.end);if(!Ae){ge.close();return}ge.onPull=()=>{Ae.read().then(function({value:de,done:De}){if(De){ge.close();return}(0,_util.assert)(de instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),ge.enqueue(new Uint8Array(de),1,[de])}).catch(de=>{ge.error(de)})},ge.onCancel=de=>{Ae.cancel(de),ge.ready.catch(De=>{if(!this.destroyed)throw De})}}),ce.on("GetDoc",({pdfInfo:we})=>{this._numPages=we.numPages,this._htmlForXfa=we.htmlForXfa,delete we.htmlForXfa,_e._capability.resolve(new PDFDocumentProxy(we,this))}),ce.on("DocException",function(we){let ge;switch(we.name){case"PasswordException":ge=new _util.PasswordException(we.message,we.code);break;case"InvalidPDFException":ge=new _util.InvalidPDFException(we.message);break;case"MissingPDFException":ge=new _util.MissingPDFException(we.message);break;case"UnexpectedResponseException":ge=new _util.UnexpectedResponseException(we.message,we.status);break;case"UnknownErrorException":ge=new _util.UnknownErrorException(we.message,we.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}_e._capability.reject(ge)}),ce.on("PasswordRequest",we=>{if(ht(this,re,new _util.PromiseCapability),_e.onPassword){const ge=Ae=>{Ae instanceof Error?be(this,re).reject(Ae):be(this,re).resolve({password:Ae})};try{_e.onPassword(ge,we.code)}catch(Ae){be(this,re).reject(Ae)}}else be(this,re).reject(new _util.PasswordException(we.message,we.code));return be(this,re).promise}),ce.on("DataLoaded",we=>{var ge;(ge=_e.onProgress)==null||ge.call(_e,{loaded:we.length,total:we.length}),this.downloadInfoCapability.resolve(we)}),ce.on("StartRenderPage",we=>{if(this.destroyed)return;be(this,ee).get(we.pageIndex)._startRenderPage(we.transparency,we.cacheKey)}),ce.on("commonobj",([we,ge,Ae])=>{var de;if(!this.destroyed&&!this.commonObjs.has(we))switch(ge){case"Font":const De=this._params;if("error"in Ae){const Te=Ae.error;(0,_util.warn)(`Error during font loading: ${Te}`),this.commonObjs.resolve(we,Te);break}const Me=De.pdfBug&&((de=globalThis.FontInspector)!=null&&de.enabled)?(Te,xe)=>globalThis.FontInspector.fontAdded(Te,xe):null,Ee=new _font_loader.FontFaceObject(Ae,{isEvalSupported:De.isEvalSupported,disableFontFace:De.disableFontFace,ignoreErrors:De.ignoreErrors,inspectFont:Me});this.fontLoader.bind(Ee).catch(Te=>ce.sendWithPromise("FontFallback",{id:we})).finally(()=>{!De.fontExtraProperties&&Ee.data&&(Ee.data=null),this.commonObjs.resolve(we,Ee)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(we,Ae);break;default:throw new Error(`Got unknown common object type ${ge}`)}}),ce.on("obj",([we,ge,Ae,de])=>{var Me;if(this.destroyed)return;const De=be(this,ee).get(ge);if(!De.objs.has(we))switch(Ae){case"Image":if(De.objs.resolve(we,de),de){let Ee;if(de.bitmap){const{width:Te,height:xe}=de;Ee=Te*xe*4}else Ee=((Me=de.data)==null?void 0:Me.length)||0;Ee>_util.MAX_IMAGE_SIZE_TO_CACHE&&(De._maybeCleanupAfterRender=!0)}break;case"Pattern":De.objs.resolve(we,de);break;default:throw new Error(`Got unknown object type ${Ae}`)}}),ce.on("DocProgress",we=>{var ge;this.destroyed||(ge=_e.onProgress)==null||ge.call(_e,{loaded:we.loaded,total:we.total})}),ce.on("FetchBuiltInCMap",we=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(we):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),ce.on("FetchStandardFontData",we=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(we):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var we;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:ce,transfers:_e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:ce,filename:((we=this._fullReader)==null?void 0:we.filename)??null},_e).finally(()=>{this.annotationStorage.resetModified()})}getPage(ce){if(!Number.isInteger(ce)||ce<=0||ce>this._numPages)return Promise.reject(new Error("Invalid page request."));const _e=ce-1,we=be(this,ne).get(_e);if(we)return we;const ge=this.messageHandler.sendWithPromise("GetPage",{pageIndex:_e}).then(Ae=>{if(this.destroyed)throw new Error("Transport destroyed");const de=new PDFPageProxy(_e,Ae,this,this._params.pdfBug);return be(this,ee).set(_e,de),de});return be(this,ne).set(_e,ge),ge}getPageIndex(ce){return typeof ce!="object"||ce===null||!Number.isInteger(ce.num)||ce.num<0||!Number.isInteger(ce.gen)||ce.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:ce.num,gen:ce.gen})}getAnnotations(ce,_e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:ce,intent:_e})}getFieldObjects(){return st(this,se,mn).call(this,"GetFieldObjects")}hasJSActions(){return st(this,se,mn).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(ce){return typeof ce!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:ce})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(ce){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:ce})}getStructTree(ce){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:ce})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(ce=>new _optional_content_config.OptionalContentConfig(ce))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const ce="GetMetadata",_e=be(this,te).get(ce);if(_e)return _e;const we=this.messageHandler.sendWithPromise(ce,null).then(ge=>{var Ae,de;return{info:ge[0],metadata:ge[1]?new _metadata.Metadata(ge[1]):null,contentDispositionFilename:((Ae=this._fullReader)==null?void 0:Ae.filename)??null,contentLength:((de=this._fullReader)==null?void 0:de.contentLength)??null}});return be(this,te).set(ce,we),we}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(ce=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const _e of be(this,ee).values())if(!_e.cleanup())throw new Error(`startCleanup: Page ${_e.pageNumber} is currently rendering.`);this.commonObjs.clear(),ce||this.fontLoader.clear(),be(this,te).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:ce,enableXfa:_e}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:ce,enableXfa:_e})}}te=new WeakMap,ee=new WeakMap,ne=new WeakMap,re=new WeakMap,se=new WeakSet,mn=function(ce,_e=null){const we=be(this,te).get(ce);if(we)return we;const ge=this.messageHandler.sendWithPromise(ce,_e);return be(this,te).set(ce,ge),ge};class PDFObjects{constructor(){Ye(this,he);Ye(this,oe,Object.create(null))}get(ce,_e=null){if(_e){const ge=st(this,he,gn).call(this,ce);return ge.capability.promise.then(()=>_e(ge.data)),null}const we=be(this,oe)[ce];if(!(we!=null&&we.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${ce}.`);return we.data}has(ce){const _e=be(this,oe)[ce];return(_e==null?void 0:_e.capability.settled)||!1}resolve(ce,_e=null){const we=st(this,he,gn).call(this,ce);we.data=_e,we.capability.resolve()}clear(){var ce;for(const _e in be(this,oe)){const{data:we}=be(this,oe)[_e];(ce=we==null?void 0:we.bitmap)==null||ce.close()}ht(this,oe,Object.create(null))}}oe=new WeakMap,he=new WeakSet,gn=function(ce){const _e=be(this,oe)[ce];return _e||(be(this,oe)[ce]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(ce){Ye(this,ae,null);ht(this,ae,ce),this.onContinue=null}get promise(){return be(this,ae).capability.promise}cancel(ce=0){be(this,ae).cancel(null,ce)}get separateAnnots(){const{separateAnnots:ce}=be(this,ae).operatorList;if(!ce)return!1;const{annotationCanvasMap:_e}=be(this,ae);return ce.form||ce.canvas&&(_e==null?void 0:_e.size)>0}}ae=new WeakMap,exports.RenderTask=RenderTask;const me=class{constructor({callback:ce,params:_e,objs:we,commonObjs:ge,annotationCanvasMap:Ae,operatorList:de,pageIndex:De,canvasFactory:Me,filterFactory:Ee,useRequestAnimationFrame:Te=!1,pdfBug:xe=!1,pageColors:He=null}){this.callback=ce,this.params=_e,this.objs=we,this.commonObjs=ge,this.annotationCanvasMap=Ae,this.operatorListIdx=null,this.operatorList=de,this._pageIndex=De,this.canvasFactory=Me,this.filterFactory=Ee,this._pdfBug=xe,this.pageColors=He,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=Te===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=_e.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:ce=!1,optionalContentConfig:_e}){var De,Me;if(this.cancelled)return;if(this._canvas){if(be(me,ue).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");be(me,ue).add(this._canvas)}this._pdfBug&&((De=globalThis.StepperManager)!=null&&De.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:we,viewport:ge,transform:Ae,background:de}=this.params;this.gfx=new _canvas.CanvasGraphics(we,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:_e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:Ae,viewport:ge,transparency:ce,background:de}),this.operatorListIdx=0,this.graphicsReady=!0,(Me=this.graphicsReadyCallback)==null||Me.call(this)}cancel(ce=null,_e=0){var we;this.running=!1,this.cancelled=!0,(we=this.gfx)==null||we.endDrawing(),this._canvas&&be(me,ue).delete(this._canvas),this.callback(ce||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,_e))}operatorListChanged(){var ce;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(ce=this.stepper)==null||ce.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(this.pageColors),this._canvas&&be(me,ue).delete(this._canvas),this.callback())))}};let InternalRenderTask=me;ue=new WeakMap,Ye(InternalRenderTask,ue,new WeakSet);const version="3.9.179";exports.version=version;const build="1ef6fbc52";exports.build=build},(q,_,M)=>{var Y,Q,Z,Vn,ee;Object.defineProperty(_,"__esModule",{value:!0}),_.SerializableEmpty=_.PrintAnnotationStorage=_.AnnotationStorage=void 0;var $=M(1),j=M(4),z=M(8);const V=Object.freeze({map:null,hash:"",transfers:void 0});_.SerializableEmpty=V;class X{constructor(){Ye(this,Z);Ye(this,Y,!1);Ye(this,Q,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(re,se){const ie=be(this,Q).get(re);return ie===void 0?se:Object.assign(se,ie)}getRawValue(re){return be(this,Q).get(re)}remove(re){if(be(this,Q).delete(re),be(this,Q).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const se of be(this,Q).values())if(se instanceof j.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(re,se){const ie=be(this,Q).get(re);let oe=!1;if(ie!==void 0)for(const[he,le]of Object.entries(se))ie[he]!==le&&(oe=!0,ie[he]=le);else oe=!0,be(this,Q).set(re,se);oe&&st(this,Z,Vn).call(this),se instanceof j.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(se.constructor._type)}has(re){return be(this,Q).has(re)}getAll(){return be(this,Q).size>0?(0,$.objectFromMap)(be(this,Q)):null}setAll(re){for(const[se,ie]of Object.entries(re))this.setValue(se,ie)}get size(){return be(this,Q).size}resetModified(){be(this,Y)&&(ht(this,Y,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new G(this)}get serializable(){if(be(this,Q).size===0)return V;const re=new Map,se=new z.MurmurHash3_64,ie=[],oe=Object.create(null);let he=!1;for(const[le,ae]of be(this,Q)){const ue=ae instanceof j.AnnotationEditor?ae.serialize(!1,oe):ae;ue&&(re.set(le,ue),se.update(`${le}:${JSON.stringify(ue)}`),he||(he=!!ue.bitmap))}if(he)for(const le of re.values())le.bitmap&&ie.push(le.bitmap);return re.size>0?{map:re,hash:se.hexdigest(),transfers:ie}:V}}Y=new WeakMap,Q=new WeakMap,Z=new WeakSet,Vn=function(){be(this,Y)||(ht(this,Y,!0),typeof this.onSetModified=="function"&&this.onSetModified())},_.AnnotationStorage=X;class G extends X{constructor(se){super();Ye(this,ee,void 0);const{map:ie,hash:oe,transfers:he}=se.serializable,le=structuredClone(ie,he?{transfer:he}:null);ht(this,ee,{map:le,hash:oe,transfers:he})}get print(){(0,$.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return be(this,ee)}}ee=new WeakMap,_.PrintAnnotationStorage=G},(q,_,M)=>{var X,G,Y,Q,Z,te,ee,ne,re,se,bn,oe,Gn,le,Xn,ue,Kn;Object.defineProperty(_,"__esModule",{value:!0}),_.AnnotationEditor=void 0;var $=M(1),j=M(5);const fe=class{constructor(_e){Ye(this,se);Ye(this,oe);Ye(this,le);Ye(this,ue);Ye(this,X,!1);Ye(this,G,null);Ye(this,Y,null);Ye(this,Q,this.focusin.bind(this));Ye(this,Z,this.focusout.bind(this));Ye(this,te,!1);Ye(this,ee,!1);Ye(this,ne,!1);Nt(this,"_uiManager",null);Ye(this,re,fe._zIndex++);this.constructor===fe&&(0,$.unreachable)("Cannot initialize AnnotationEditor."),this.parent=_e.parent,this.id=_e.id,this.width=this.height=null,this.pageIndex=_e.parent.pageIndex,this.name=_e.name,this.div=null,this._uiManager=_e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1;const{rotation:we,rawDims:{pageWidth:ge,pageHeight:Ae,pageX:de,pageY:De}}=this.parent.viewport;this.rotation=we,this.pageRotation=(360+we-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[ge,Ae],this.pageTranslation=[de,De];const[Me,Ee]=this.parentDimensions;this.x=_e.x/Me,this.y=_e.y/Ee,this.isAttachedToDOM=!1,this.deleted=!1}static get _defaultLineColor(){return(0,$.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(_e){const we=new V({id:_e.parent.getNextId(),parent:_e.parent,uiManager:_e._uiManager});we.annotationElementId=_e.annotationElementId,we.deleted=!0,we._uiManager.addToAnnotationStorage(we)}static initialize(_e){}static updateDefaultParams(_e,we){}static get defaultPropertiesToUpdate(){return[]}get propertiesToUpdate(){return[]}addCommands(_e){this._uiManager.addCommands(_e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=be(this,re)}setParent(_e){_e!==null&&(this.pageIndex=_e.pageIndex,this.pageDimensions=_e.pageDimensions),this.parent=_e}focusin(_e){be(this,te)?ht(this,te,!1):this.parent.setSelected(this)}focusout(_e){var ge;if(!this.isAttachedToDOM)return;const we=_e.relatedTarget;we!=null&&we.closest(`#${this.id}`)||(_e.preventDefault(),(ge=this.parent)!=null&&ge.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}dragstart(_e){const we=this.parent.div.getBoundingClientRect();this.startX=_e.clientX-we.x,this.startY=_e.clientY-we.y,_e.dataTransfer.setData("text/plain",this.id),_e.dataTransfer.effectAllowed="move"}setAt(_e,we,ge,Ae){const[de,De]=this.parentDimensions;[ge,Ae]=this.screenToPageTranslation(ge,Ae),this.x=(_e+ge)/de,this.y=(we+Ae)/De,this.fixAndSetPosition()}translate(_e,we){st(this,se,bn).call(this,this.parentDimensions,_e,we)}translateInPage(_e,we){st(this,se,bn).call(this,this.pageDimensions,_e,we),this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[_e,we]=this.pageDimensions;let{x:ge,y:Ae,width:de,height:De}=this;switch(de*=_e,De*=we,ge*=_e,Ae*=we,this.rotation){case 0:ge=Math.max(0,Math.min(_e-de,ge)),Ae=Math.max(0,Math.min(we-De,Ae));break;case 90:ge=Math.max(0,Math.min(_e-De,ge)),Ae=Math.min(we,Math.max(de,Ae));break;case 180:ge=Math.min(_e,Math.max(de,ge)),Ae=Math.min(we,Math.max(De,Ae));break;case 270:ge=Math.min(_e,Math.max(De,ge)),Ae=Math.max(0,Math.min(we-de,Ae));break}this.x=ge/_e,this.y=Ae/we,this.div.style.left=`${(100*this.x).toFixed(2)}%`,this.div.style.top=`${(100*this.y).toFixed(2)}%`}screenToPageTranslation(_e,we){switch(this.parentRotation){case 90:return[we,-_e];case 180:return[-_e,-we];case 270:return[-we,_e];default:return[_e,we]}}pageTranslationToScreen(_e,we){switch(this.parentRotation){case 90:return[-we,_e];case 180:return[-_e,-we];case 270:return[we,-_e];default:return[_e,we]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{realScale:_e}=this._uiManager.viewParameters,[we,ge]=this.pageDimensions;return[we*_e,ge*_e]}setDims(_e,we){const[ge,Ae]=this.parentDimensions;this.div.style.width=`${(100*_e/ge).toFixed(2)}%`,be(this,X)||(this.div.style.height=`${(100*we/Ae).toFixed(2)}%`)}fixDims(){const{style:_e}=this.div,{height:we,width:ge}=_e,Ae=ge.endsWith("%"),de=!be(this,X)&&we.endsWith("%");if(Ae&&de)return;const[De,Me]=this.parentDimensions;Ae||(_e.width=`${(100*parseFloat(ge)/De).toFixed(2)}%`),!be(this,X)&&!de&&(_e.height=`${(100*parseFloat(we)/Me).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",be(this,Q)),this.div.addEventListener("focusout",be(this,Z));const[_e,we]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*we/_e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*_e/we).toFixed(2)}%`);const[ge,Ae]=this.getInitialTranslation();return this.translate(ge,Ae),(0,j.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(_e){const{isMac:we}=$.FeatureTest.platform;if(_e.button!==0||_e.ctrlKey&&we){_e.preventDefault();return}_e.ctrlKey&&!we||_e.shiftKey||_e.metaKey&&we?this.parent.toggleSelected(this):this.parent.setSelected(this),ht(this,te,!0)}getRect(_e,we){const ge=this.parentScale,[Ae,de]=this.pageDimensions,[De,Me]=this.pageTranslation,Ee=_e/ge,Te=we/ge,xe=this.x*Ae,He=this.y*de,Oe=this.width*Ae,$e=this.height*de;switch(this.rotation){case 0:return[xe+Ee+De,de-He-Te-$e+Me,xe+Ee+Oe+De,de-He-Te+Me];case 90:return[xe+Te+De,de-He+Ee+Me,xe+Te+$e+De,de-He+Ee+Oe+Me];case 180:return[xe-Ee-Oe+De,de-He+Te+Me,xe-Ee+De,de-He+Te+$e+Me];case 270:return[xe-Te-$e+De,de-He-Ee-Oe+Me,xe-Te+De,de-He-Ee+Me];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(_e,we){const[ge,Ae,de,De]=_e,Me=de-ge,Ee=De-Ae;switch(this.rotation){case 0:return[ge,we-De,Me,Ee];case 90:return[ge,we-Ae,Ee,Me];case 180:return[de,we-Ae,Me,Ee];case 270:return[de,we-De,Ee,Me];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){ht(this,ne,!0)}disableEditMode(){ht(this,ne,!1)}isInEditMode(){return be(this,ne)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var _e,we;(_e=this.div)==null||_e.addEventListener("focusin",be(this,Q)),(we=this.div)==null||we.addEventListener("focusout",be(this,Z))}serialize(_e=!1,we=null){(0,$.unreachable)("An editor must be serializable")}static deserialize(_e,we,ge){const Ae=new this.prototype.constructor({parent:we,id:we.getNextId(),uiManager:ge});Ae.rotation=_e.rotation;const[de,De]=Ae.pageDimensions,[Me,Ee,Te,xe]=Ae.getRectInCurrentCoords(_e.rect,De);return Ae.x=Me/de,Ae.y=Ee/De,Ae.width=Te/de,Ae.height=xe/De,Ae}remove(){this.div.removeEventListener("focusin",be(this,Q)),this.div.removeEventListener("focusout",be(this,Z)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this)}get isResizable(){return!1}makeResizable(){this.isResizable&&(st(this,oe,Gn).call(this),be(this,G).classList.remove("hidden"))}select(){var _e;this.makeResizable(),(_e=this.div)==null||_e.classList.add("selectedEditor")}unselect(){var _e,we,ge;(_e=be(this,G))==null||_e.classList.add("hidden"),(we=this.div)==null||we.classList.remove("selectedEditor"),(ge=this.div)!=null&&ge.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(_e,we){}disableEditing(){}enableEditing(){}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return be(this,ee)}set isEditing(_e){ht(this,ee,_e),this.parent&&(_e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(_e,we){ht(this,X,!0);const ge=_e/we,{style:Ae}=this.div;Ae.aspectRatio=ge,Ae.height="auto"}static get MIN_SIZE(){return 16}};let z=fe;X=new WeakMap,G=new WeakMap,Y=new WeakMap,Q=new WeakMap,Z=new WeakMap,te=new WeakMap,ee=new WeakMap,ne=new WeakMap,re=new WeakMap,se=new WeakSet,bn=function([_e,we],ge,Ae){[ge,Ae]=this.screenToPageTranslation(ge,Ae),this.x+=ge/_e,this.y+=Ae/we,this.fixAndSetPosition()},oe=new WeakSet,Gn=function(){if(be(this,G))return;ht(this,G,document.createElement("div")),be(this,G).classList.add("resizers");const _e=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||_e.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const we of _e){const ge=document.createElement("div");be(this,G).append(ge),ge.classList.add("resizer",we),ge.addEventListener("pointerdown",st(this,le,Xn).bind(this,we))}this.div.prepend(be(this,G))},le=new WeakSet,Xn=function(_e,we){we.preventDefault(),ht(this,Y,[we.clientX,we.clientY]);const ge=st(this,ue,Kn).bind(this,_e),Ae=this.div.draggable;this.div.draggable=!1;const de=`resizing${_e.charAt(0).toUpperCase()}${_e.slice(1)}`;this.parent.div.classList.add(de);const De={passive:!0,capture:!0};window.addEventListener("pointermove",ge,De);const Me=()=>{this._uiManager.stopUndoAccumulation(),this.div.draggable=Ae,this.parent.div.classList.remove(de),window.removeEventListener("pointermove",ge,De)};window.addEventListener("pointerup",Me,{once:!0})},ue=new WeakSet,Kn=function(_e,we){const{clientX:ge,clientY:Ae}=we,de=ge-be(this,Y)[0],De=Ae-be(this,Y)[1];be(this,Y)[0]=ge,be(this,Y)[1]=Ae;const[Me,Ee]=this.parentDimensions,Te=this.x,xe=this.y,He=this.width,Oe=this.height,$e=fe.MIN_SIZE/Me,Pe=fe.MIN_SIZE/Ee;let ve;const ye=Be=>Math.round(Be*1e4)/1e4,Fe=(Be,Ne)=>{const[ze,Ze]=this.parentDimensions;this.setDims(ze*Be,Ze*Ne),this.fixAndSetPosition()},je=()=>{this.width=He,this.height=Oe,this.x=Te,this.y=xe,Fe(He,Oe)};switch(_e){case"topLeft":{if(Math.sign(de)*Math.sign(De)<0)return;const Be=Math.hypot(de,De),Ne=Math.hypot(He*Me,Oe*Ee),ze=ye(Te+He),Ze=ye(xe+Oe),ut=Math.max(Math.min(1-Math.sign(de)*(Be/Ne),1/He,1/Oe),$e/He,Pe/Oe),ot=ye(He*ut),pe=ye(Oe*ut),We=ze-ot,Qe=Ze-pe;ve=()=>{this.width=ot,this.height=pe,this.x=We,this.y=Qe,Fe(ot,pe)};break}case"topMiddle":{const Be=ye(this.y+Oe),Ne=ye(Math.max(Pe,Math.min(1,Oe-De/Ee))),ze=Be-Ne;ve=()=>{this.height=Ne,this.y=ze,Fe(He,Ne)};break}case"topRight":{if(Math.sign(de)*Math.sign(De)>0)return;const Be=Math.hypot(de,De),Ne=Math.hypot(this.width*Me,this.height*Ee),ze=ye(xe+this.height),Ze=Math.max(Math.min(1+Math.sign(de)*(Be/Ne),1/He,1/Oe),$e/He,Pe/Oe),ut=ye(He*Ze),ot=ye(Oe*Ze),pe=ze-ot;ve=()=>{this.width=ut,this.height=ot,this.y=pe,Fe(ut,ot)};break}case"middleRight":{const Be=ye(Math.max($e,Math.min(1,He+de/Me)));ve=()=>{this.width=Be,Fe(Be,Oe)};break}case"bottomRight":{if(Math.sign(de)*Math.sign(De)<0)return;const Be=Math.hypot(de,De),Ne=Math.hypot(this.width*Me,this.height*Ee),ze=Math.max(Math.min(1+Math.sign(de)*(Be/Ne),1/He,1/Oe),$e/He,Pe/Oe),Ze=ye(He*ze),ut=ye(Oe*ze);ve=()=>{this.width=Ze,this.height=ut,Fe(Ze,ut)};break}case"bottomMiddle":{const Be=ye(Math.max(Pe,Math.min(1,Oe+De/Ee)));ve=()=>{this.height=Be,Fe(He,Be)};break}case"bottomLeft":{if(Math.sign(de)*Math.sign(De)>0)return;const Be=Math.hypot(de,De),Ne=Math.hypot(this.width*Me,this.height*Ee),ze=ye(Te+this.width),Ze=Math.max(Math.min(1-Math.sign(de)*(Be/Ne),1/He,1/Oe),$e/He,Pe/Oe),ut=ye(He*Ze),ot=ye(Oe*Ze),pe=ze-ut;ve=()=>{this.width=ut,this.height=ot,this.x=pe,Fe(ut,ot)};break}case"middleLeft":{const Be=ye(Te+He),Ne=ye(Math.max($e,Math.min(1,He-de/Me))),ze=Be-Ne;ve=()=>{this.width=Ne,this.x=ze,Fe(Ne,Oe)};break}}this.addCommands({cmd:ve,undo:je,mustExec:!0,type:$.AnnotationEditorParamsType.RESIZE,overwriteIfSameType:!0,keepUndo:!0})},Nt(z,"_colorManager",new j.ColorManager),Nt(z,"_zIndex",1),_.AnnotationEditor=z;class V extends z{constructor(_e){super(_e),this.annotationElementId=_e.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(q,_,M)=>{var ee,ne,re,se,ie,yn,he,le,ae,ue,me,Yn,_e,we,ge,Ae,de,De,Me,Ee,Te,xe,He,Oe,$e,Pe,ve,ye,Fe,je,Be,Ne,ze,Ze,ut,ot,pe,We,Qe,Ce,Ie,Qn,rt,vn,qe,Zn,Xe,Jn,lt,Ht,mt,Jt,Et,er,Tt,tr,tt,wn,nt,en,Rt,Dn;Object.defineProperty(_,"__esModule",{value:!0}),_.KeyboardManager=_.CommandManager=_.ColorManager=_.AnnotationEditorUIManager=void 0,_.bindEvents=z,_.opacityToHex=V;var $=M(1),j=M(6);function z(Lt,Se,et){for(const ft of et)Se.addEventListener(ft,Lt[ft].bind(Lt))}function V(Lt){return Math.round(Math.min(255,Math.max(1,255*Lt))).toString(16).padStart(2,"0")}class X{constructor(){Ye(this,ee,0)}getId(){return`${$.AnnotationEditorPrefix}${Wt(this,ee)._++}`}}ee=new WeakMap;class G{constructor(){Ye(this,ie);Ye(this,ne,(0,$.getUuid)());Ye(this,re,0);Ye(this,se,null)}async getFromFile(Se){const{lastModified:et,name:ft,size:dt,type:Re}=Se;return st(this,ie,yn).call(this,`${et}_${ft}_${dt}_${Re}`,Se)}async getFromUrl(Se){return st(this,ie,yn).call(this,Se,Se)}async getFromId(Se){be(this,se)||ht(this,se,new Map);const et=be(this,se).get(Se);return et?et.bitmap?(et.refCounter+=1,et):et.file?this.getFromFile(et.file):this.getFromUrl(et.url):null}getSvgUrl(Se){const et=be(this,se).get(Se);return et!=null&&et.isSvg?et.svgUrl:null}deleteId(Se){be(this,se)||ht(this,se,new Map);const et=be(this,se).get(Se);et&&(et.refCounter-=1,et.refCounter===0&&(et.bitmap=null))}isValidId(Se){return Se.startsWith(`image_${be(this,ne)}_`)}}ne=new WeakMap,re=new WeakMap,se=new WeakMap,ie=new WeakSet,yn=async function(Se,et){be(this,se)||ht(this,se,new Map);let ft=be(this,se).get(Se);if(ft===null)return null;if(ft!=null&&ft.bitmap)return ft.refCounter+=1,ft;try{ft||(ft={bitmap:null,id:`image_${be(this,ne)}_${Wt(this,re)._++}`,refCounter:0,isSvg:!1});let dt;if(typeof et=="string"){ft.url=et;const Re=await fetch(et);if(!Re.ok)throw new Error(Re.statusText);dt=await Re.blob()}else dt=ft.file=et;if(dt.type==="image/svg+xml"){const Re=new FileReader,ke=new Image,Ue=new Promise((Le,Ke)=>{ke.onload=()=>{ft.bitmap=ke,ft.isSvg=!0,Le()},Re.onload=()=>{ke.src=ft.svgUrl=Re.result},ke.onerror=Re.onerror=Ke});Re.readAsDataURL(dt),await Ue}else ft.bitmap=await createImageBitmap(dt);ft.refCounter=1}catch(dt){console.error(dt),ft=null}return be(this,se).set(Se,ft),ft&&be(this,se).set(ft.id,ft),ft};class Y{constructor(Se=128){Ye(this,he,[]);Ye(this,le,!1);Ye(this,ae,void 0);Ye(this,ue,-1);ht(this,ae,Se)}add({cmd:Se,undo:et,mustExec:ft,type:dt=NaN,overwriteIfSameType:Re=!1,keepUndo:ke=!1}){if(ft&&Se(),be(this,le))return;const Ue={cmd:Se,undo:et,type:dt};if(be(this,ue)===-1){be(this,he).length>0&&(be(this,he).length=0),ht(this,ue,0),be(this,he).push(Ue);return}if(Re&&be(this,he)[be(this,ue)].type===dt){ke&&(Ue.undo=be(this,he)[be(this,ue)].undo),be(this,he)[be(this,ue)]=Ue;return}const Le=be(this,ue)+1;Le===be(this,ae)?be(this,he).splice(0,1):(ht(this,ue,Le),Le<be(this,he).length&&be(this,he).splice(Le)),be(this,he).push(Ue)}stopUndoAccumulation(){be(this,ue)!==-1&&(be(this,he)[be(this,ue)].type=NaN)}undo(){be(this,ue)!==-1&&(ht(this,le,!0),be(this,he)[be(this,ue)].undo(),ht(this,le,!1),ht(this,ue,be(this,ue)-1))}redo(){be(this,ue)<be(this,he).length-1&&(ht(this,ue,be(this,ue)+1),ht(this,le,!0),be(this,he)[be(this,ue)].cmd(),ht(this,le,!1))}hasSomethingToUndo(){return be(this,ue)!==-1}hasSomethingToRedo(){return be(this,ue)<be(this,he).length-1}destroy(){ht(this,he,null)}}he=new WeakMap,le=new WeakMap,ae=new WeakMap,ue=new WeakMap,_.CommandManager=Y;class Q{constructor(Se){Ye(this,me);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:et}=$.FeatureTest.platform;for(const[ft,dt,Re={}]of Se)for(const ke of ft){const Ue=ke.startsWith("mac+");et&&Ue?(this.callbacks.set(ke.slice(4),{callback:dt,options:Re}),this.allKeys.add(ke.split("+").at(-1))):!et&&!Ue&&(this.callbacks.set(ke,{callback:dt,options:Re}),this.allKeys.add(ke.split("+").at(-1)))}}exec(Se,et){if(!this.allKeys.has(et.key))return;const ft=this.callbacks.get(st(this,me,Yn).call(this,et));if(!ft)return;const{callback:dt,options:{bubbles:Re=!1,args:ke=[],checker:Ue=null}}=ft;Ue&&!Ue(Se,et)||(dt.bind(Se,...ke)(),Re||(et.stopPropagation(),et.preventDefault()))}}me=new WeakSet,Yn=function(Se){Se.altKey&&this.buffer.push("alt"),Se.ctrlKey&&this.buffer.push("ctrl"),Se.metaKey&&this.buffer.push("meta"),Se.shiftKey&&this.buffer.push("shift"),this.buffer.push(Se.key);const et=this.buffer.join("+");return this.buffer.length=0,et},_.KeyboardManager=Q;const ce=class{get _colors(){const Se=new Map([["CanvasText",null],["Canvas",null]]);return(0,j.getColorValues)(Se),(0,$.shadow)(this,"_colors",Se)}convert(Se){const et=(0,j.getRGB)(Se);if(!window.matchMedia("(forced-colors: active)").matches)return et;for(const[ft,dt]of this._colors)if(dt.every((Re,ke)=>Re===et[ke]))return ce._colorsMapping.get(ft);return et}getHexCode(Se){const et=this._colors.get(Se);return et?$.Util.makeHexColor(...et):Se}};let Z=ce;Nt(Z,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]])),_.ColorManager=Z;const Bt=class{constructor(Se,et,ft,dt){Ye(this,Ie);Ye(this,rt);Ye(this,qe);Ye(this,Xe);Ye(this,lt);Ye(this,mt);Ye(this,Et);Ye(this,Tt);Ye(this,tt);Ye(this,nt);Ye(this,Rt);Ye(this,_e,null);Ye(this,we,new Map);Ye(this,ge,new Map);Ye(this,Ae,null);Ye(this,de,new Y);Ye(this,De,0);Ye(this,Me,new Set);Ye(this,Ee,null);Ye(this,Te,new Set);Ye(this,xe,null);Ye(this,He,null);Ye(this,Oe,new X);Ye(this,$e,!1);Ye(this,Pe,$.AnnotationEditorType.NONE);Ye(this,ve,new Set);Ye(this,ye,null);Ye(this,Fe,this.copy.bind(this));Ye(this,je,this.cut.bind(this));Ye(this,Be,this.paste.bind(this));Ye(this,Ne,this.keydown.bind(this));Ye(this,ze,this.onEditingAction.bind(this));Ye(this,Ze,this.onPageChanging.bind(this));Ye(this,ut,this.onScaleChanging.bind(this));Ye(this,ot,this.onRotationChanging.bind(this));Ye(this,pe,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});Ye(this,We,[0,0]);Ye(this,Qe,null);Ye(this,Ce,null);ht(this,Ce,Se),ht(this,xe,et),be(this,xe)._on("editingaction",be(this,ze)),be(this,xe)._on("pagechanging",be(this,Ze)),be(this,xe)._on("scalechanging",be(this,ut)),be(this,xe)._on("rotationchanging",be(this,ot)),ht(this,Ae,ft.annotationStorage),ht(this,He,ft.filterFactory),ht(this,ye,dt),this.viewParameters={realScale:j.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const Se=Bt.prototype,et=Re=>{const{activeElement:ke}=document;return ke&&be(Re,Ce).contains(ke)&&Re.hasSomethingToControl()},ft=this.TRANSLATE_SMALL,dt=this.TRANSLATE_BIG;return(0,$.shadow)(this,"_keyboardManager",new Q([[["ctrl+a","mac+meta+a"],Se.selectAll],[["ctrl+z","mac+meta+z"],Se.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],Se.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],Se.delete],[["Escape","mac+Escape"],Se.unselectAll],[["ArrowLeft","mac+ArrowLeft"],Se.translateSelectedEditors,{args:[-ft,0],checker:et}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],Se.translateSelectedEditors,{args:[-dt,0],checker:et}],[["ArrowRight","mac+ArrowRight"],Se.translateSelectedEditors,{args:[ft,0],checker:et}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],Se.translateSelectedEditors,{args:[dt,0],checker:et}],[["ArrowUp","mac+ArrowUp"],Se.translateSelectedEditors,{args:[0,-ft],checker:et}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],Se.translateSelectedEditors,{args:[0,-dt],checker:et}],[["ArrowDown","mac+ArrowDown"],Se.translateSelectedEditors,{args:[0,ft],checker:et}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],Se.translateSelectedEditors,{args:[0,dt],checker:et}]]))}destroy(){st(this,rt,vn).call(this),be(this,xe)._off("editingaction",be(this,ze)),be(this,xe)._off("pagechanging",be(this,Ze)),be(this,xe)._off("scalechanging",be(this,ut)),be(this,xe)._off("rotationchanging",be(this,ot));for(const Se of be(this,ge).values())Se.destroy();be(this,ge).clear(),be(this,we).clear(),be(this,Te).clear(),ht(this,_e,null),be(this,ve).clear(),be(this,de).destroy()}get hcmFilter(){return(0,$.shadow)(this,"hcmFilter",be(this,ye)?be(this,He).addHCMFilter(be(this,ye).foreground,be(this,ye).background):"none")}onPageChanging({pageNumber:Se}){ht(this,De,Se-1)}focusMainContainer(){be(this,Ce).focus()}addShouldRescale(Se){be(this,Te).add(Se)}removeShouldRescale(Se){be(this,Te).delete(Se)}onScaleChanging({scale:Se}){this.commitOrRemove(),this.viewParameters.realScale=Se*j.PixelsPerInch.PDF_TO_CSS_UNITS;for(const et of be(this,Te))et.onScaleChanging()}onRotationChanging({pagesRotation:Se}){this.commitOrRemove(),this.viewParameters.rotation=Se}addToAnnotationStorage(Se){!Se.isEmpty()&&be(this,Ae)&&!be(this,Ae).has(Se.id)&&be(this,Ae).setValue(Se.id,Se)}copy(Se){if(Se.preventDefault(),be(this,_e)&&be(this,_e).commitOrRemove(),!this.hasSelection)return;const et=[];for(const ft of be(this,ve)){const dt=ft.serialize(!0);dt&&et.push(dt)}et.length!==0&&Se.clipboardData.setData("application/pdfjs",JSON.stringify(et))}cut(Se){this.copy(Se),this.delete()}paste(Se){Se.preventDefault();let et=Se.clipboardData.getData("application/pdfjs");if(!et)return;try{et=JSON.parse(et)}catch(dt){(0,$.warn)(`paste: "${dt.message}".`);return}if(!Array.isArray(et))return;this.unselectAll();const ft=this.currentLayer;try{const dt=[];for(const Ue of et){const Le=ft.deserialize(Ue);if(!Le)return;dt.push(Le)}const Re=()=>{for(const Ue of dt)st(this,tt,wn).call(this,Ue);st(this,Rt,Dn).call(this,dt)},ke=()=>{for(const Ue of dt)Ue.remove()};this.addCommands({cmd:Re,undo:ke,mustExec:!0})}catch(dt){(0,$.warn)(`paste: "${dt.message}".`)}}keydown(Se){var et;(et=this.getActive())!=null&&et.shouldGetKeyboardEvents()||Bt._keyboardManager.exec(this,Se)}onEditingAction(Se){["undo","redo","delete","selectAll"].includes(Se.name)&&this[Se.name]()}setEditingState(Se){Se?(st(this,Ie,Qn).call(this),st(this,qe,Zn).call(this),st(this,lt,Ht).call(this,{isEditing:be(this,Pe)!==$.AnnotationEditorType.NONE,isEmpty:st(this,nt,en).call(this),hasSomethingToUndo:be(this,de).hasSomethingToUndo(),hasSomethingToRedo:be(this,de).hasSomethingToRedo(),hasSelectedEditor:!1})):(st(this,rt,vn).call(this),st(this,Xe,Jn).call(this),st(this,lt,Ht).call(this,{isEditing:!1}))}registerEditorTypes(Se){if(!be(this,Ee)){ht(this,Ee,Se);for(const et of be(this,Ee))st(this,mt,Jt).call(this,et.defaultPropertiesToUpdate)}}getId(){return be(this,Oe).getId()}get currentLayer(){return be(this,ge).get(be(this,De))}get currentPageIndex(){return be(this,De)}addLayer(Se){be(this,ge).set(Se.pageIndex,Se),be(this,$e)?Se.enable():Se.disable()}removeLayer(Se){be(this,ge).delete(Se.pageIndex)}updateMode(Se,et=null){if(ht(this,Pe,Se),Se===$.AnnotationEditorType.NONE){this.setEditingState(!1),st(this,Tt,tr).call(this);return}this.setEditingState(!0),st(this,Et,er).call(this);for(const ft of be(this,ge).values())ft.updateMode(Se);if(et){for(const ft of be(this,we).values())if(ft.annotationElementId===et){this.setSelected(ft),ft.enterInEditMode();break}}}updateToolbar(Se){Se!==be(this,Pe)&&be(this,xe).dispatch("switchannotationeditormode",{source:this,mode:Se})}updateParams(Se,et){if(be(this,Ee)){for(const ft of be(this,ve))ft.updateParams(Se,et);for(const ft of be(this,Ee))ft.updateDefaultParams(Se,et)}}getEditors(Se){const et=[];for(const ft of be(this,we).values())ft.pageIndex===Se&&et.push(ft);return et}getEditor(Se){return be(this,we).get(Se)}addEditor(Se){be(this,we).set(Se.id,Se)}removeEditor(Se){var et;be(this,we).delete(Se.id),this.unselect(Se),(!Se.annotationElementId||!be(this,Me).has(Se.annotationElementId))&&((et=be(this,Ae))==null||et.remove(Se.id))}addDeletedAnnotationElement(Se){be(this,Me).add(Se.annotationElementId),Se.deleted=!0}isDeletedAnnotationElement(Se){return be(this,Me).has(Se)}removeDeletedAnnotationElement(Se){be(this,Me).delete(Se.annotationElementId),Se.deleted=!1}setActiveEditor(Se){be(this,_e)!==Se&&(ht(this,_e,Se),Se&&st(this,mt,Jt).call(this,Se.propertiesToUpdate))}toggleSelected(Se){if(be(this,ve).has(Se)){be(this,ve).delete(Se),Se.unselect(),st(this,lt,Ht).call(this,{hasSelectedEditor:this.hasSelection});return}be(this,ve).add(Se),Se.select(),st(this,mt,Jt).call(this,Se.propertiesToUpdate),st(this,lt,Ht).call(this,{hasSelectedEditor:!0})}setSelected(Se){for(const et of be(this,ve))et!==Se&&et.unselect();be(this,ve).clear(),be(this,ve).add(Se),Se.select(),st(this,mt,Jt).call(this,Se.propertiesToUpdate),st(this,lt,Ht).call(this,{hasSelectedEditor:!0})}isSelected(Se){return be(this,ve).has(Se)}unselect(Se){Se.unselect(),be(this,ve).delete(Se),st(this,lt,Ht).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return be(this,ve).size!==0}stopUndoAccumulation(){be(this,de).stopUndoAccumulation()}undo(){be(this,de).undo(),st(this,lt,Ht).call(this,{hasSomethingToUndo:be(this,de).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:st(this,nt,en).call(this)})}redo(){be(this,de).redo(),st(this,lt,Ht).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:be(this,de).hasSomethingToRedo(),isEmpty:st(this,nt,en).call(this)})}addCommands(Se){be(this,de).add(Se),st(this,lt,Ht).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:st(this,nt,en).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const Se=[...be(this,ve)],et=()=>{for(const dt of Se)dt.remove()},ft=()=>{for(const dt of Se)st(this,tt,wn).call(this,dt)};this.addCommands({cmd:et,undo:ft,mustExec:!0})}commitOrRemove(){var Se;(Se=be(this,_e))==null||Se.commitOrRemove()}hasSomethingToControl(){return be(this,_e)||this.hasSelection}selectAll(){for(const Se of be(this,ve))Se.commit();st(this,Rt,Dn).call(this,be(this,we).values())}unselectAll(){if(be(this,_e)){be(this,_e).commitOrRemove();return}if(this.hasSelection){for(const Se of be(this,ve))Se.unselect();be(this,ve).clear(),st(this,lt,Ht).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(Se,et,ft=!1){if(ft||this.commitOrRemove(),!this.hasSelection)return;be(this,We)[0]+=Se,be(this,We)[1]+=et;const[dt,Re]=be(this,We),ke=[...be(this,ve)],Ue=1e3;be(this,Qe)&&clearTimeout(be(this,Qe)),ht(this,Qe,setTimeout(()=>{ht(this,Qe,null),be(this,We)[0]=be(this,We)[1]=0,this.addCommands({cmd:()=>{for(const Le of ke)be(this,we).has(Le.id)&&Le.translateInPage(dt,Re)},undo:()=>{for(const Le of ke)be(this,we).has(Le.id)&&Le.translateInPage(-dt,-Re)},mustExec:!1})},Ue));for(const Le of ke)Le.translateInPage(Se,et)}isActive(Se){return be(this,_e)===Se}getActive(){return be(this,_e)}getMode(){return be(this,Pe)}get imageManager(){return(0,$.shadow)(this,"imageManager",new G)}};let te=Bt;_e=new WeakMap,we=new WeakMap,ge=new WeakMap,Ae=new WeakMap,de=new WeakMap,De=new WeakMap,Me=new WeakMap,Ee=new WeakMap,Te=new WeakMap,xe=new WeakMap,He=new WeakMap,Oe=new WeakMap,$e=new WeakMap,Pe=new WeakMap,ve=new WeakMap,ye=new WeakMap,Fe=new WeakMap,je=new WeakMap,Be=new WeakMap,Ne=new WeakMap,ze=new WeakMap,Ze=new WeakMap,ut=new WeakMap,ot=new WeakMap,pe=new WeakMap,We=new WeakMap,Qe=new WeakMap,Ce=new WeakMap,Ie=new WeakSet,Qn=function(){window.addEventListener("keydown",be(this,Ne),{capture:!0})},rt=new WeakSet,vn=function(){window.removeEventListener("keydown",be(this,Ne),{capture:!0})},qe=new WeakSet,Zn=function(){document.addEventListener("copy",be(this,Fe)),document.addEventListener("cut",be(this,je)),document.addEventListener("paste",be(this,Be))},Xe=new WeakSet,Jn=function(){document.removeEventListener("copy",be(this,Fe)),document.removeEventListener("cut",be(this,je)),document.removeEventListener("paste",be(this,Be))},lt=new WeakSet,Ht=function(Se){Object.entries(Se).some(([ft,dt])=>be(this,pe)[ft]!==dt)&&be(this,xe).dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(be(this,pe),Se)})},mt=new WeakSet,Jt=function(Se){be(this,xe).dispatch("annotationeditorparamschanged",{source:this,details:Se})},Et=new WeakSet,er=function(){if(!be(this,$e)){ht(this,$e,!0);for(const Se of be(this,ge).values())Se.enable()}},Tt=new WeakSet,tr=function(){if(this.unselectAll(),be(this,$e)){ht(this,$e,!1);for(const Se of be(this,ge).values())Se.disable()}},tt=new WeakSet,wn=function(Se){const et=be(this,ge).get(Se.pageIndex);et?et.addOrRebuild(Se):this.addEditor(Se)},nt=new WeakSet,en=function(){if(be(this,we).size===0)return!0;if(be(this,we).size===1)for(const Se of be(this,we).values())return Se.isEmpty();return!1},Rt=new WeakSet,Dn=function(Se){be(this,ve).clear();for(const et of Se)et.isEmpty()||(be(this,ve).add(et),et.select());st(this,lt,Ht).call(this,{hasSelectedEditor:!0})},Nt(te,"TRANSLATE_SMALL",1),Nt(te,"TRANSLATE_BIG",10),_.AnnotationEditorUIManager=te},(q,_,M)=>{var Ee,Te,xe,He,Oe,$e,Pe,ve,ye,Fe,je,Be,Kt,ze,Yt,ut,An,pe,on,Qe,ln,Ie,tn,rt,nn;Object.defineProperty(_,"__esModule",{value:!0}),_.StatTimer=_.RenderingCancelledException=_.PixelsPerInch=_.PageViewport=_.PDFDateString=_.DOMStandardFontDataFactory=_.DOMSVGFactory=_.DOMFilterFactory=_.DOMCanvasFactory=_.DOMCMapReaderFactory=_.AnnotationPrefix=void 0,_.deprecated=me,_.getColorValues=ge,_.getCurrentTransform=Ae,_.getCurrentTransformInverse=de,_.getFilenameFromUrl=oe,_.getPdfFilenameFromUrl=he,_.getRGB=we,_.getXfaPageViewport=_e,_.isDataScheme=se,_.isPdfFile=ie,_.isValidFetchUrl=ae,_.loadScript=ue,_.setLayerDimensions=De;var $=M(7),j=M(1);const z="http://www.w3.org/2000/svg",V="pdfjs_internal_id_";_.AnnotationPrefix=V;const Me=class{};let X=Me;Nt(X,"CSS",96),Nt(X,"PDF",72),Nt(X,"PDF_TO_CSS_UNITS",Me.CSS/Me.PDF),_.PixelsPerInch=X;class G extends $.BaseFilterFactory{constructor({docId:Xe,ownerDocument:Je=globalThis.document}={}){super();Ye(this,Be);Ye(this,ze);Ye(this,ut);Ye(this,pe);Ye(this,Qe);Ye(this,Ie);Ye(this,rt);Ye(this,Ee,void 0);Ye(this,Te,void 0);Ye(this,xe,void 0);Ye(this,He,void 0);Ye(this,Oe,void 0);Ye(this,$e,void 0);Ye(this,Pe,void 0);Ye(this,ve,void 0);Ye(this,ye,void 0);Ye(this,Fe,void 0);Ye(this,je,0);ht(this,xe,Xe),ht(this,He,Je)}addFilter(Xe){if(!Xe)return"none";let Je=be(this,Be,Kt).get(Xe);if(Je)return Je;let lt,_t,mt,Ct;if(Xe.length===1){const Dt=Xe[0],tt=new Array(256);for(let it=0;it<256;it++)tt[it]=Dt[it]/255;Ct=lt=_t=mt=tt.join(",")}else{const[Dt,tt,it]=Xe,nt=new Array(256),gt=new Array(256),Rt=new Array(256);for(let St=0;St<256;St++)nt[St]=Dt[St]/255,gt[St]=tt[St]/255,Rt[St]=it[St]/255;lt=nt.join(","),_t=gt.join(","),mt=Rt.join(","),Ct=`${lt}${_t}${mt}`}if(Je=be(this,Be,Kt).get(Ct),Je)return be(this,Be,Kt).set(Xe,Je),Je;const Et=`g_${be(this,xe)}_transfer_map_${Wt(this,je)._++}`,xt=`url(#${Et})`;be(this,Be,Kt).set(Xe,xt),be(this,Be,Kt).set(Ct,xt);const Tt=st(this,pe,on).call(this,Et);return st(this,Ie,tn).call(this,lt,_t,mt,Tt),xt}addHCMFilter(Xe,Je){var tt;const lt=`${Xe}-${Je}`;if(be(this,$e)===lt)return be(this,Pe);if(ht(this,$e,lt),ht(this,Pe,"none"),(tt=be(this,Oe))==null||tt.remove(),!Xe||!Je)return be(this,Pe);const _t=st(this,rt,nn).call(this,Xe);Xe=j.Util.makeHexColor(..._t);const mt=st(this,rt,nn).call(this,Je);if(Je=j.Util.makeHexColor(...mt),be(this,ze,Yt).style.color="",Xe==="#000000"&&Je==="#ffffff"||Xe===Je)return be(this,Pe);const Ct=new Array(256);for(let it=0;it<=255;it++){const nt=it/255;Ct[it]=nt<=.03928?nt/12.92:((nt+.055)/1.055)**2.4}const Et=Ct.join(","),xt=`g_${be(this,xe)}_hcm_filter`,Tt=ht(this,ve,st(this,pe,on).call(this,xt));st(this,Ie,tn).call(this,Et,Et,Et,Tt),st(this,ut,An).call(this,Tt);const Dt=(it,nt)=>{const gt=_t[it]/255,Rt=mt[it]/255,St=new Array(nt+1);for(let Bt=0;Bt<=nt;Bt++)St[Bt]=gt+Bt/nt*(Rt-gt);return St.join(",")};return st(this,Ie,tn).call(this,Dt(0,5),Dt(1,5),Dt(2,5),Tt),ht(this,Pe,`url(#${xt})`),be(this,Pe)}addHighlightHCMFilter(Xe,Je,lt,_t){var Rt;const mt=`${Xe}-${Je}-${lt}-${_t}`;if(be(this,ye)===mt)return be(this,Fe);if(ht(this,ye,mt),ht(this,Fe,"none"),(Rt=be(this,ve))==null||Rt.remove(),!Xe||!Je)return be(this,Fe);const[Ct,Et]=[Xe,Je].map(st(this,rt,nn).bind(this));let xt=Math.round(.2126*Ct[0]+.7152*Ct[1]+.0722*Ct[2]),Tt=Math.round(.2126*Et[0]+.7152*Et[1]+.0722*Et[2]),[Dt,tt]=[lt,_t].map(st(this,rt,nn).bind(this));Tt<xt&&([xt,Tt,Dt,tt]=[Tt,xt,tt,Dt]),be(this,ze,Yt).style.color="";const it=(St,Bt,Lt)=>{const Se=new Array(256),et=(Tt-xt)/Lt,ft=St/255,dt=(Bt-St)/(255*Lt);let Re=0;for(let ke=0;ke<=Lt;ke++){const Ue=Math.round(xt+ke*et),Le=ft+ke*dt;for(let Ke=Re;Ke<=Ue;Ke++)Se[Ke]=Le;Re=Ue+1}for(let ke=Re;ke<256;ke++)Se[ke]=Se[Re-1];return Se.join(",")},nt=`g_${be(this,xe)}_hcm_highlight_filter`,gt=ht(this,ve,st(this,pe,on).call(this,nt));return st(this,ut,An).call(this,gt),st(this,Ie,tn).call(this,it(Dt[0],tt[0],5),it(Dt[1],tt[1],5),it(Dt[2],tt[2],5),gt),ht(this,Fe,`url(#${nt})`),be(this,Fe)}destroy(Xe=!1){Xe&&(be(this,Pe)||be(this,Fe))||(be(this,Te)&&(be(this,Te).parentNode.parentNode.remove(),ht(this,Te,null)),be(this,Ee)&&(be(this,Ee).clear(),ht(this,Ee,null)),ht(this,je,0))}}Ee=new WeakMap,Te=new WeakMap,xe=new WeakMap,He=new WeakMap,Oe=new WeakMap,$e=new WeakMap,Pe=new WeakMap,ve=new WeakMap,ye=new WeakMap,Fe=new WeakMap,je=new WeakMap,Be=new WeakSet,Kt=function(){return be(this,Ee)||ht(this,Ee,new Map)},ze=new WeakSet,Yt=function(){if(!be(this,Te)){const Xe=be(this,He).createElement("div"),{style:Je}=Xe;Je.visibility="hidden",Je.contain="strict",Je.width=Je.height=0,Je.position="absolute",Je.top=Je.left=0,Je.zIndex=-1;const lt=be(this,He).createElementNS(z,"svg");lt.setAttribute("width",0),lt.setAttribute("height",0),ht(this,Te,be(this,He).createElementNS(z,"defs")),Xe.append(lt),lt.append(be(this,Te)),be(this,He).body.append(Xe)}return be(this,Te)},ut=new WeakSet,An=function(Xe){const Je=be(this,He).createElementNS(z,"feColorMatrix");Je.setAttribute("type","matrix"),Je.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),Xe.append(Je)},pe=new WeakSet,on=function(Xe){const Je=be(this,He).createElementNS(z,"filter");return Je.setAttribute("color-interpolation-filters","sRGB"),Je.setAttribute("id",Xe),be(this,ze,Yt).append(Je),Je},Qe=new WeakSet,ln=function(Xe,Je,lt){const _t=be(this,He).createElementNS(z,Je);_t.setAttribute("type","discrete"),_t.setAttribute("tableValues",lt),Xe.append(_t)},Ie=new WeakSet,tn=function(Xe,Je,lt,_t){const mt=be(this,He).createElementNS(z,"feComponentTransfer");_t.append(mt),st(this,Qe,ln).call(this,mt,"feFuncR",Xe),st(this,Qe,ln).call(this,mt,"feFuncG",Je),st(this,Qe,ln).call(this,mt,"feFuncB",lt)},rt=new WeakSet,nn=function(Xe){return be(this,ze,Yt).style.color=Xe,we(getComputedStyle(be(this,ze,Yt)).getPropertyValue("color"))},_.DOMFilterFactory=G;class Y extends $.BaseCanvasFactory{constructor({ownerDocument:Ve=globalThis.document}={}){super(),this._document=Ve}_createCanvas(Ve,Xe){const Je=this._document.createElement("canvas");return Je.width=Ve,Je.height=Xe,Je}}_.DOMCanvasFactory=Y;async function Q(qe,Ve=!1){if(ae(qe,document.baseURI)){const Xe=await fetch(qe);if(!Xe.ok)throw new Error(Xe.statusText);return Ve?new Uint8Array(await Xe.arrayBuffer()):(0,j.stringToBytes)(await Xe.text())}return new Promise((Xe,Je)=>{const lt=new XMLHttpRequest;lt.open("GET",qe,!0),Ve&&(lt.responseType="arraybuffer"),lt.onreadystatechange=()=>{if(lt.readyState===XMLHttpRequest.DONE){if(lt.status===200||lt.status===0){let _t;if(Ve&&lt.response?_t=new Uint8Array(lt.response):!Ve&&lt.responseText&&(_t=(0,j.stringToBytes)(lt.responseText)),_t){Xe(_t);return}}Je(new Error(lt.statusText))}},lt.send(null)})}class Z extends $.BaseCMapReaderFactory{_fetchData(Ve,Xe){return Q(Ve,this.isCompressed).then(Je=>({cMapData:Je,compressionType:Xe}))}}_.DOMCMapReaderFactory=Z;class te extends $.BaseStandardFontDataFactory{_fetchData(Ve){return Q(Ve,!0)}}_.DOMStandardFontDataFactory=te;class ee extends $.BaseSVGFactory{_createSVG(Ve){return document.createElementNS(z,Ve)}}_.DOMSVGFactory=ee;class ne{constructor({viewBox:Ve,scale:Xe,rotation:Je,offsetX:lt=0,offsetY:_t=0,dontFlip:mt=!1}){this.viewBox=Ve,this.scale=Xe,this.rotation=Je,this.offsetX=lt,this.offsetY=_t;const Ct=(Ve[2]+Ve[0])/2,Et=(Ve[3]+Ve[1])/2;let xt,Tt,Dt,tt;switch(Je%=360,Je<0&&(Je+=360),Je){case 180:xt=-1,Tt=0,Dt=0,tt=1;break;case 90:xt=0,Tt=1,Dt=1,tt=0;break;case 270:xt=0,Tt=-1,Dt=-1,tt=0;break;case 0:xt=1,Tt=0,Dt=0,tt=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}mt&&(Dt=-Dt,tt=-tt);let it,nt,gt,Rt;xt===0?(it=Math.abs(Et-Ve[1])*Xe+lt,nt=Math.abs(Ct-Ve[0])*Xe+_t,gt=(Ve[3]-Ve[1])*Xe,Rt=(Ve[2]-Ve[0])*Xe):(it=Math.abs(Ct-Ve[0])*Xe+lt,nt=Math.abs(Et-Ve[1])*Xe+_t,gt=(Ve[2]-Ve[0])*Xe,Rt=(Ve[3]-Ve[1])*Xe),this.transform=[xt*Xe,Tt*Xe,Dt*Xe,tt*Xe,it-xt*Xe*Ct-Dt*Xe*Et,nt-Tt*Xe*Ct-tt*Xe*Et],this.width=gt,this.height=Rt}get rawDims(){const{viewBox:Ve}=this;return(0,j.shadow)(this,"rawDims",{pageWidth:Ve[2]-Ve[0],pageHeight:Ve[3]-Ve[1],pageX:Ve[0],pageY:Ve[1]})}clone({scale:Ve=this.scale,rotation:Xe=this.rotation,offsetX:Je=this.offsetX,offsetY:lt=this.offsetY,dontFlip:_t=!1}={}){return new ne({viewBox:this.viewBox.slice(),scale:Ve,rotation:Xe,offsetX:Je,offsetY:lt,dontFlip:_t})}convertToViewportPoint(Ve,Xe){return j.Util.applyTransform([Ve,Xe],this.transform)}convertToViewportRectangle(Ve){const Xe=j.Util.applyTransform([Ve[0],Ve[1]],this.transform),Je=j.Util.applyTransform([Ve[2],Ve[3]],this.transform);return[Xe[0],Xe[1],Je[0],Je[1]]}convertToPdfPoint(Ve,Xe){return j.Util.applyInverseTransform([Ve,Xe],this.transform)}}_.PageViewport=ne;class re extends j.BaseException{constructor(Ve,Xe=0){super(Ve,"RenderingCancelledException"),this.extraDelay=Xe}}_.RenderingCancelledException=re;function se(qe){const Ve=qe.length;let Xe=0;for(;Xe<Ve&&qe[Xe].trim()==="";)Xe++;return qe.substring(Xe,Xe+5).toLowerCase()==="data:"}function ie(qe){return typeof qe=="string"&&/\.pdf$/i.test(qe)}function oe(qe,Ve=!1){return Ve||([qe]=qe.split(/[#?]/,1)),qe.substring(qe.lastIndexOf("/")+1)}function he(qe,Ve="document.pdf"){if(typeof qe!="string")return Ve;if(se(qe))return(0,j.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),Ve;const Xe=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,Je=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,lt=Xe.exec(qe);let _t=Je.exec(lt[1])||Je.exec(lt[2])||Je.exec(lt[3]);if(_t&&(_t=_t[0],_t.includes("%")))try{_t=Je.exec(decodeURIComponent(_t))[0]}catch{}return _t||Ve}class le{constructor(){Nt(this,"started",Object.create(null));Nt(this,"times",[])}time(Ve){Ve in this.started&&(0,j.warn)(`Timer is already running for ${Ve}`),this.started[Ve]=Date.now()}timeEnd(Ve){Ve in this.started||(0,j.warn)(`Timer has not been started for ${Ve}`),this.times.push({name:Ve,start:this.started[Ve],end:Date.now()}),delete this.started[Ve]}toString(){const Ve=[];let Xe=0;for(const{name:Je}of this.times)Xe=Math.max(Je.length,Xe);for(const{name:Je,start:lt,end:_t}of this.times)Ve.push(`${Je.padEnd(Xe)} ${_t-lt}ms
`);return Ve.join("")}}_.StatTimer=le;function ae(qe,Ve){try{const{protocol:Xe}=Ve?new URL(qe,Ve):new URL(qe);return Xe==="http:"||Xe==="https:"}catch{return!1}}function ue(qe,Ve=!1){return new Promise((Xe,Je)=>{const lt=document.createElement("script");lt.src=qe,lt.onload=function(_t){Ve&&lt.remove(),Xe(_t)},lt.onerror=function(){Je(new Error(`Cannot load script at: ${lt.src}`))},(document.head||document.documentElement).append(lt)})}function me(qe){console.log("Deprecated API usage: "+qe)}let fe;class ce{static toDateObject(Ve){if(!Ve||typeof Ve!="string")return null;fe||(fe=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const Xe=fe.exec(Ve);if(!Xe)return null;const Je=parseInt(Xe[1],10);let lt=parseInt(Xe[2],10);lt=lt>=1&&lt<=12?lt-1:0;let _t=parseInt(Xe[3],10);_t=_t>=1&&_t<=31?_t:1;let mt=parseInt(Xe[4],10);mt=mt>=0&&mt<=23?mt:0;let Ct=parseInt(Xe[5],10);Ct=Ct>=0&&Ct<=59?Ct:0;let Et=parseInt(Xe[6],10);Et=Et>=0&&Et<=59?Et:0;const xt=Xe[7]||"Z";let Tt=parseInt(Xe[8],10);Tt=Tt>=0&&Tt<=23?Tt:0;let Dt=parseInt(Xe[9],10)||0;return Dt=Dt>=0&&Dt<=59?Dt:0,xt==="-"?(mt+=Tt,Ct+=Dt):xt==="+"&&(mt-=Tt,Ct-=Dt),new Date(Date.UTC(Je,lt,_t,mt,Ct,Et))}}_.PDFDateString=ce;function _e(qe,{scale:Ve=1,rotation:Xe=0}){const{width:Je,height:lt}=qe.attributes.style,_t=[0,0,parseInt(Je),parseInt(lt)];return new ne({viewBox:_t,scale:Ve,rotation:Xe})}function we(qe){if(qe.startsWith("#")){const Ve=parseInt(qe.slice(1),16);return[(Ve&16711680)>>16,(Ve&65280)>>8,Ve&255]}return qe.startsWith("rgb(")?qe.slice(4,-1).split(",").map(Ve=>parseInt(Ve)):qe.startsWith("rgba(")?qe.slice(5,-1).split(",").map(Ve=>parseInt(Ve)).slice(0,3):((0,j.warn)(`Not a valid color format: "${qe}"`),[0,0,0])}function ge(qe){const Ve=document.createElement("span");Ve.style.visibility="hidden",document.body.append(Ve);for(const Xe of qe.keys()){Ve.style.color=Xe;const Je=window.getComputedStyle(Ve).color;qe.set(Xe,we(Je))}Ve.remove()}function Ae(qe){const{a:Ve,b:Xe,c:Je,d:lt,e:_t,f:mt}=qe.getTransform();return[Ve,Xe,Je,lt,_t,mt]}function de(qe){const{a:Ve,b:Xe,c:Je,d:lt,e:_t,f:mt}=qe.getTransform().invertSelf();return[Ve,Xe,Je,lt,_t,mt]}function De(qe,Ve,Xe=!1,Je=!0){if(Ve instanceof ne){const{pageWidth:lt,pageHeight:_t}=Ve.rawDims,{style:mt}=qe,Ct=`calc(var(--scale-factor) * ${lt}px)`,Et=`calc(var(--scale-factor) * ${_t}px)`;!Xe||Ve.rotation%180===0?(mt.width=Ct,mt.height=Et):(mt.width=Et,mt.height=Ct)}Je&&qe.setAttribute("data-main-rotation",Ve.rotation)}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.BaseStandardFontDataFactory=_.BaseSVGFactory=_.BaseFilterFactory=_.BaseCanvasFactory=_.BaseCMapReaderFactory=void 0;var $=M(1);class j{constructor(){this.constructor===j&&(0,$.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(Q){return"none"}addHCMFilter(Q,Z){return"none"}addHighlightHCMFilter(Q,Z,te,ee){return"none"}destroy(Q=!1){}}_.BaseFilterFactory=j;class z{constructor(){this.constructor===z&&(0,$.unreachable)("Cannot initialize BaseCanvasFactory.")}create(Q,Z){if(Q<=0||Z<=0)throw new Error("Invalid canvas size");const te=this._createCanvas(Q,Z);return{canvas:te,context:te.getContext("2d")}}reset(Q,Z,te){if(!Q.canvas)throw new Error("Canvas is not specified");if(Z<=0||te<=0)throw new Error("Invalid canvas size");Q.canvas.width=Z,Q.canvas.height=te}destroy(Q){if(!Q.canvas)throw new Error("Canvas is not specified");Q.canvas.width=0,Q.canvas.height=0,Q.canvas=null,Q.context=null}_createCanvas(Q,Z){(0,$.unreachable)("Abstract method `_createCanvas` called.")}}_.BaseCanvasFactory=z;class V{constructor({baseUrl:Q=null,isCompressed:Z=!0}){this.constructor===V&&(0,$.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=Q,this.isCompressed=Z}async fetch({name:Q}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!Q)throw new Error("CMap name must be specified.");const Z=this.baseUrl+Q+(this.isCompressed?".bcmap":""),te=this.isCompressed?$.CMapCompressionType.BINARY:$.CMapCompressionType.NONE;return this._fetchData(Z,te).catch(ee=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${Z}`)})}_fetchData(Q,Z){(0,$.unreachable)("Abstract method `_fetchData` called.")}}_.BaseCMapReaderFactory=V;class X{constructor({baseUrl:Q=null}){this.constructor===X&&(0,$.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=Q}async fetch({filename:Q}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!Q)throw new Error("Font filename must be specified.");const Z=`${this.baseUrl}${Q}`;return this._fetchData(Z).catch(te=>{throw new Error(`Unable to load font data at: ${Z}`)})}_fetchData(Q){(0,$.unreachable)("Abstract method `_fetchData` called.")}}_.BaseStandardFontDataFactory=X;class G{constructor(){this.constructor===G&&(0,$.unreachable)("Cannot initialize BaseSVGFactory.")}create(Q,Z,te=!1){if(Q<=0||Z<=0)throw new Error("Invalid SVG dimensions");const ee=this._createSVG("svg:svg");return ee.setAttribute("version","1.1"),te||(ee.setAttribute("width",`${Q}px`),ee.setAttribute("height",`${Z}px`)),ee.setAttribute("preserveAspectRatio","none"),ee.setAttribute("viewBox",`0 0 ${Q} ${Z}`),ee}createElement(Q){if(typeof Q!="string")throw new Error("Invalid SVG element type");return this._createSVG(Q)}_createSVG(Q){(0,$.unreachable)("Abstract method `_createSVG` called.")}}_.BaseSVGFactory=G},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.MurmurHash3_64=void 0;var $=M(1);const j=3285377520,z=4294901760,V=65535;class X{constructor(Y){this.h1=Y?Y&4294967295:j,this.h2=Y?Y&4294967295:j}update(Y){let Q,Z;if(typeof Y=="string"){Q=new Uint8Array(Y.length*2),Z=0;for(let me=0,fe=Y.length;me<fe;me++){const ce=Y.charCodeAt(me);ce<=255?Q[Z++]=ce:(Q[Z++]=ce>>>8,Q[Z++]=ce&255)}}else if((0,$.isArrayBuffer)(Y))Q=Y.slice(),Z=Q.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const te=Z>>2,ee=Z-te*4,ne=new Uint32Array(Q.buffer,0,te);let re=0,se=0,ie=this.h1,oe=this.h2;const he=3432918353,le=461845907,ae=he&V,ue=le&V;for(let me=0;me<te;me++)me&1?(re=ne[me],re=re*he&z|re*ae&V,re=re<<15|re>>>17,re=re*le&z|re*ue&V,ie^=re,ie=ie<<13|ie>>>19,ie=ie*5+3864292196):(se=ne[me],se=se*he&z|se*ae&V,se=se<<15|se>>>17,se=se*le&z|se*ue&V,oe^=se,oe=oe<<13|oe>>>19,oe=oe*5+3864292196);switch(re=0,ee){case 3:re^=Q[te*4+2]<<16;case 2:re^=Q[te*4+1]<<8;case 1:re^=Q[te*4],re=re*he&z|re*ae&V,re=re<<15|re>>>17,re=re*le&z|re*ue&V,te&1?ie^=re:oe^=re}this.h1=ie,this.h2=oe}hexdigest(){let Y=this.h1,Q=this.h2;return Y^=Q>>>1,Y=Y*3981806797&z|Y*36045&V,Q=Q*4283543511&z|((Q<<16|Y>>>16)*2950163797&z)>>>16,Y^=Q>>>1,Y=Y*444984403&z|Y*60499&V,Q=Q*3301882366&z|((Q<<16|Y>>>16)*3120437893&z)>>>16,Y^=Q>>>1,(Y>>>0).toString(16).padStart(8,"0")+(Q>>>0).toString(16).padStart(8,"0")}}_.MurmurHash3_64=X},(q,_,M)=>{var V;Object.defineProperty(_,"__esModule",{value:!0}),_.FontLoader=_.FontFaceObject=void 0;var $=M(1);class j{constructor({ownerDocument:G=globalThis.document,styleElement:Y=null}){Ye(this,V,new Set);this._document=G,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(G){this.nativeFontFaces.add(G),this._document.fonts.add(G)}removeNativeFontFace(G){this.nativeFontFaces.delete(G),this._document.fonts.delete(G)}insertRule(G){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const Y=this.styleElement.sheet;Y.insertRule(G,Y.cssRules.length)}clear(){for(const G of this.nativeFontFaces)this._document.fonts.delete(G);this.nativeFontFaces.clear(),be(this,V).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(G){if(!(!G||be(this,V).has(G.loadedName))){if((0,$.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:Y,src:Q,style:Z}=G,te=new FontFace(Y,Q,Z);this.addNativeFontFace(te);try{await te.load(),be(this,V).add(Y)}catch{(0,$.warn)(`Cannot load system font: ${G.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(te)}return}(0,$.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(G){if(G.attached||G.missingFile&&!G.systemFontInfo)return;if(G.attached=!0,G.systemFontInfo){await this.loadSystemFont(G.systemFontInfo);return}if(this.isFontLoadingAPISupported){const Q=G.createNativeFontFace();if(Q){this.addNativeFontFace(Q);try{await Q.loaded}catch(Z){throw(0,$.warn)(`Failed to load font '${Q.family}': '${Z}'.`),G.disableFontFace=!0,Z}}return}const Y=G.createFontFaceRule();if(Y){if(this.insertRule(Y),this.isSyncFontLoadingSupported)return;await new Promise(Q=>{const Z=this._queueLoadingCallback(Q);this._prepareFontLoadEvent(G,Z)})}}get isFontLoadingAPISupported(){var Y;const G=!!((Y=this._document)!=null&&Y.fonts);return(0,$.shadow)(this,"isFontLoadingAPISupported",G)}get isSyncFontLoadingSupported(){let G=!1;return($.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(G=!0),(0,$.shadow)(this,"isSyncFontLoadingSupported",G)}_queueLoadingCallback(G){function Y(){for((0,$.assert)(!Z.done,"completeRequest() cannot be called twice."),Z.done=!0;Q.length>0&&Q[0].done;){const te=Q.shift();setTimeout(te.callback,0)}}const{loadingRequests:Q}=this,Z={done:!1,complete:Y,callback:G};return Q.push(Z),Z}get _loadTestFont(){const G=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,$.shadow)(this,"_loadTestFont",G)}_prepareFontLoadEvent(G,Y){function Q(we,ge){return we.charCodeAt(ge)<<24|we.charCodeAt(ge+1)<<16|we.charCodeAt(ge+2)<<8|we.charCodeAt(ge+3)&255}function Z(we,ge,Ae,de){const De=we.substring(0,ge),Me=we.substring(ge+Ae);return De+de+Me}let te,ee;const ne=this._document.createElement("canvas");ne.width=1,ne.height=1;const re=ne.getContext("2d");let se=0;function ie(we,ge){if(++se>30){(0,$.warn)("Load test font never loaded."),ge();return}if(re.font="30px "+we,re.fillText(".",0,20),re.getImageData(0,0,1,1).data[3]>0){ge();return}setTimeout(ie.bind(null,we,ge))}const oe=`lt${Date.now()}${this.loadTestFontId++}`;let he=this._loadTestFont;he=Z(he,976,oe.length,oe);const ae=16,ue=1482184792;let me=Q(he,ae);for(te=0,ee=oe.length-3;te<ee;te+=4)me=me-ue+Q(oe,te)|0;te<oe.length&&(me=me-ue+Q(oe+"XXX",te)|0),he=Z(he,ae,4,(0,$.string32)(me));const fe=`url(data:font/opentype;base64,${btoa(he)});`,ce=`@font-face {font-family:"${oe}";src:${fe}}`;this.insertRule(ce);const _e=this._document.createElement("div");_e.style.visibility="hidden",_e.style.width=_e.style.height="10px",_e.style.position="absolute",_e.style.top=_e.style.left="0px";for(const we of[G.loadedName,oe]){const ge=this._document.createElement("span");ge.textContent="Hi",ge.style.fontFamily=we,_e.append(ge)}this._document.body.append(_e),ie(oe,()=>{_e.remove(),Y.complete()})}}V=new WeakMap,_.FontLoader=j;class z{constructor(G,{isEvalSupported:Y=!0,disableFontFace:Q=!1,ignoreErrors:Z=!1,inspectFont:te=null}){this.compiledGlyphs=Object.create(null);for(const ee in G)this[ee]=G[ee];this.isEvalSupported=Y!==!1,this.disableFontFace=Q===!0,this.ignoreErrors=Z===!0,this._inspectFont=te}createNativeFontFace(){var Y;if(!this.data||this.disableFontFace)return null;let G;if(!this.cssFontInfo)G=new FontFace(this.loadedName,this.data,{});else{const Q={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(Q.style=`oblique ${this.cssFontInfo.italicAngle}deg`),G=new FontFace(this.cssFontInfo.fontFamily,this.data,Q)}return(Y=this._inspectFont)==null||Y.call(this,this),G}createFontFaceRule(){var Z;if(!this.data||this.disableFontFace)return null;const G=(0,$.bytesToString)(this.data),Y=`url(data:${this.mimetype};base64,${btoa(G)});`;let Q;if(!this.cssFontInfo)Q=`@font-face {font-family:"${this.loadedName}";src:${Y}}`;else{let te=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(te+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),Q=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${te}src:${Y}}`}return(Z=this._inspectFont)==null||Z.call(this,this,Y),Q}getPathGenerator(G,Y){if(this.compiledGlyphs[Y]!==void 0)return this.compiledGlyphs[Y];let Q;try{Q=G.get(this.loadedName+"_path_"+Y)}catch(Z){if(!this.ignoreErrors)throw Z;return(0,$.warn)(`getPathGenerator - ignoring character: "${Z}".`),this.compiledGlyphs[Y]=function(te,ee){}}if(this.isEvalSupported&&$.FeatureTest.isEvalSupported){const Z=[];for(const te of Q){const ee=te.args!==void 0?te.args.join(","):"";Z.push("c.",te.cmd,"(",ee,`);
`)}return this.compiledGlyphs[Y]=new Function("c","size",Z.join(""))}return this.compiledGlyphs[Y]=function(Z,te){for(const ee of Q)ee.cmd==="scale"&&(ee.args=[te,-te]),Z[ee.cmd].apply(Z,ee.args)}}}_.FontFaceObject=z},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.NodeStandardFontDataFactory=_.NodeFilterFactory=_.NodeCanvasFactory=_.NodeCMapReaderFactory=void 0;var $=M(7);M(1);const j=function(Y){return new Promise((Q,Z)=>{require$$5.readFile(Y,(ee,ne)=>{if(ee||!ne){Z(new Error(ee));return}Q(new Uint8Array(ne))})})};class z extends $.BaseFilterFactory{}_.NodeFilterFactory=z;class V extends $.BaseCanvasFactory{_createCanvas(Q,Z){return require$$5.createCanvas(Q,Z)}}_.NodeCanvasFactory=V;class X extends $.BaseCMapReaderFactory{_fetchData(Q,Z){return j(Q).then(te=>({cMapData:te,compressionType:Z}))}}_.NodeCMapReaderFactory=X;class G extends $.BaseStandardFontDataFactory{_fetchData(Q){return j(Q)}}_.NodeStandardFontDataFactory=G},(q,_,M)=>{var Te,En,He,kn;Object.defineProperty(_,"__esModule",{value:!0}),_.CanvasGraphics=void 0;var $=M(1),j=M(6),z=M(12),V=M(13);const X=16,G=100,Y=4096,Q=15,Z=10,te=1e3,ee=16;function ne(Pe,ve){if(Pe._removeMirroring)throw new Error("Context is already forwarding operations.");Pe.__originalSave=Pe.save,Pe.__originalRestore=Pe.restore,Pe.__originalRotate=Pe.rotate,Pe.__originalScale=Pe.scale,Pe.__originalTranslate=Pe.translate,Pe.__originalTransform=Pe.transform,Pe.__originalSetTransform=Pe.setTransform,Pe.__originalResetTransform=Pe.resetTransform,Pe.__originalClip=Pe.clip,Pe.__originalMoveTo=Pe.moveTo,Pe.__originalLineTo=Pe.lineTo,Pe.__originalBezierCurveTo=Pe.bezierCurveTo,Pe.__originalRect=Pe.rect,Pe.__originalClosePath=Pe.closePath,Pe.__originalBeginPath=Pe.beginPath,Pe._removeMirroring=()=>{Pe.save=Pe.__originalSave,Pe.restore=Pe.__originalRestore,Pe.rotate=Pe.__originalRotate,Pe.scale=Pe.__originalScale,Pe.translate=Pe.__originalTranslate,Pe.transform=Pe.__originalTransform,Pe.setTransform=Pe.__originalSetTransform,Pe.resetTransform=Pe.__originalResetTransform,Pe.clip=Pe.__originalClip,Pe.moveTo=Pe.__originalMoveTo,Pe.lineTo=Pe.__originalLineTo,Pe.bezierCurveTo=Pe.__originalBezierCurveTo,Pe.rect=Pe.__originalRect,Pe.closePath=Pe.__originalClosePath,Pe.beginPath=Pe.__originalBeginPath,delete Pe._removeMirroring},Pe.save=function(){ve.save(),this.__originalSave()},Pe.restore=function(){ve.restore(),this.__originalRestore()},Pe.translate=function(Fe,je){ve.translate(Fe,je),this.__originalTranslate(Fe,je)},Pe.scale=function(Fe,je){ve.scale(Fe,je),this.__originalScale(Fe,je)},Pe.transform=function(Fe,je,Be,Ne,ze,Ze){ve.transform(Fe,je,Be,Ne,ze,Ze),this.__originalTransform(Fe,je,Be,Ne,ze,Ze)},Pe.setTransform=function(Fe,je,Be,Ne,ze,Ze){ve.setTransform(Fe,je,Be,Ne,ze,Ze),this.__originalSetTransform(Fe,je,Be,Ne,ze,Ze)},Pe.resetTransform=function(){ve.resetTransform(),this.__originalResetTransform()},Pe.rotate=function(Fe){ve.rotate(Fe),this.__originalRotate(Fe)},Pe.clip=function(Fe){ve.clip(Fe),this.__originalClip(Fe)},Pe.moveTo=function(ye,Fe){ve.moveTo(ye,Fe),this.__originalMoveTo(ye,Fe)},Pe.lineTo=function(ye,Fe){ve.lineTo(ye,Fe),this.__originalLineTo(ye,Fe)},Pe.bezierCurveTo=function(ye,Fe,je,Be,Ne,ze){ve.bezierCurveTo(ye,Fe,je,Be,Ne,ze),this.__originalBezierCurveTo(ye,Fe,je,Be,Ne,ze)},Pe.rect=function(ye,Fe,je,Be){ve.rect(ye,Fe,je,Be),this.__originalRect(ye,Fe,je,Be)},Pe.closePath=function(){ve.closePath(),this.__originalClosePath()},Pe.beginPath=function(){ve.beginPath(),this.__originalBeginPath()}}class re{constructor(ve){this.canvasFactory=ve,this.cache=Object.create(null)}getCanvas(ve,ye,Fe){let je;return this.cache[ve]!==void 0?(je=this.cache[ve],this.canvasFactory.reset(je,ye,Fe)):(je=this.canvasFactory.create(ye,Fe),this.cache[ve]=je),je}delete(ve){delete this.cache[ve]}clear(){for(const ve in this.cache){const ye=this.cache[ve];this.canvasFactory.destroy(ye),delete this.cache[ve]}}}function se(Pe,ve,ye,Fe,je,Be,Ne,ze,Ze,ut){const[ot,pe,We,Qe,Ce,Ie]=(0,j.getCurrentTransform)(Pe);if(pe===0&&We===0){const ct=Ne*ot+Ce,qe=Math.round(ct),Ve=ze*Qe+Ie,Xe=Math.round(Ve),Je=(Ne+Ze)*ot+Ce,lt=Math.abs(Math.round(Je)-qe)||1,_t=(ze+ut)*Qe+Ie,mt=Math.abs(Math.round(_t)-Xe)||1;return Pe.setTransform(Math.sign(ot),0,0,Math.sign(Qe),qe,Xe),Pe.drawImage(ve,ye,Fe,je,Be,0,0,lt,mt),Pe.setTransform(ot,pe,We,Qe,Ce,Ie),[lt,mt]}if(ot===0&&Qe===0){const ct=ze*We+Ce,qe=Math.round(ct),Ve=Ne*pe+Ie,Xe=Math.round(Ve),Je=(ze+ut)*We+Ce,lt=Math.abs(Math.round(Je)-qe)||1,_t=(Ne+Ze)*pe+Ie,mt=Math.abs(Math.round(_t)-Xe)||1;return Pe.setTransform(0,Math.sign(pe),Math.sign(We),0,qe,Xe),Pe.drawImage(ve,ye,Fe,je,Be,0,0,mt,lt),Pe.setTransform(ot,pe,We,Qe,Ce,Ie),[mt,lt]}Pe.drawImage(ve,ye,Fe,je,Be,Ne,ze,Ze,ut);const Ge=Math.hypot(ot,pe),rt=Math.hypot(We,Qe);return[Ge*Ze,rt*ut]}function ie(Pe){const{width:ve,height:ye}=Pe;if(ve>te||ye>te)return null;const Fe=1e3,je=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),Be=ve+1;let Ne=new Uint8Array(Be*(ye+1)),ze,Ze,ut;const ot=ve+7&-8;let pe=new Uint8Array(ot*ye),We=0;for(const rt of Pe.data){let ct=128;for(;ct>0;)pe[We++]=rt&ct?0:255,ct>>=1}let Qe=0;for(We=0,pe[We]!==0&&(Ne[0]=1,++Qe),Ze=1;Ze<ve;Ze++)pe[We]!==pe[We+1]&&(Ne[Ze]=pe[We]?2:1,++Qe),We++;for(pe[We]!==0&&(Ne[Ze]=2,++Qe),ze=1;ze<ye;ze++){We=ze*ot,ut=ze*Be,pe[We-ot]!==pe[We]&&(Ne[ut]=pe[We]?1:8,++Qe);let rt=(pe[We]?4:0)+(pe[We-ot]?8:0);for(Ze=1;Ze<ve;Ze++)rt=(rt>>2)+(pe[We+1]?4:0)+(pe[We-ot+1]?8:0),je[rt]&&(Ne[ut+Ze]=je[rt],++Qe),We++;if(pe[We-ot]!==pe[We]&&(Ne[ut+Ze]=pe[We]?2:4,++Qe),Qe>Fe)return null}for(We=ot*(ye-1),ut=ze*Be,pe[We]!==0&&(Ne[ut]=8,++Qe),Ze=1;Ze<ve;Ze++)pe[We]!==pe[We+1]&&(Ne[ut+Ze]=pe[We]?4:8,++Qe),We++;if(pe[We]!==0&&(Ne[ut+Ze]=4,++Qe),Qe>Fe)return null;const Ce=new Int32Array([0,Be,-1,0,-Be,0,0,0,1]),Ie=new Path2D;for(ze=0;Qe&&ze<=ye;ze++){let rt=ze*Be;const ct=rt+ve;for(;rt<ct&&!Ne[rt];)rt++;if(rt===ct)continue;Ie.moveTo(rt%Be,ze);const qe=rt;let Ve=Ne[rt];do{const Xe=Ce[Ve];do rt+=Xe;while(!Ne[rt]);const Je=Ne[rt];Je!==5&&Je!==10?(Ve=Je,Ne[rt]=0):(Ve=Je&51*Ve>>4,Ne[rt]&=Ve>>2|Ve<<2),Ie.lineTo(rt%Be,rt/Be|0),Ne[rt]||--Qe}while(qe!==rt);--ze}return pe=null,Ne=null,function(rt){rt.save(),rt.scale(1/ve,-1/ye),rt.translate(0,-ye),rt.fill(Ie),rt.beginPath(),rt.restore()}}class oe{constructor(ve,ye){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=$.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=$.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=$.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,ve,ye])}clone(){const ve=Object.create(this);return ve.clipBox=this.clipBox.slice(),ve}setCurrentPoint(ve,ye){this.x=ve,this.y=ye}updatePathMinMax(ve,ye,Fe){[ye,Fe]=$.Util.applyTransform([ye,Fe],ve),this.minX=Math.min(this.minX,ye),this.minY=Math.min(this.minY,Fe),this.maxX=Math.max(this.maxX,ye),this.maxY=Math.max(this.maxY,Fe)}updateRectMinMax(ve,ye){const Fe=$.Util.applyTransform(ye,ve),je=$.Util.applyTransform(ye.slice(2),ve);this.minX=Math.min(this.minX,Fe[0],je[0]),this.minY=Math.min(this.minY,Fe[1],je[1]),this.maxX=Math.max(this.maxX,Fe[0],je[0]),this.maxY=Math.max(this.maxY,Fe[1],je[1])}updateScalingPathMinMax(ve,ye){$.Util.scaleMinMax(ve,ye),this.minX=Math.min(this.minX,ye[0]),this.maxX=Math.max(this.maxX,ye[1]),this.minY=Math.min(this.minY,ye[2]),this.maxY=Math.max(this.maxY,ye[3])}updateCurvePathMinMax(ve,ye,Fe,je,Be,Ne,ze,Ze,ut,ot){const pe=$.Util.bezierBoundingBox(ye,Fe,je,Be,Ne,ze,Ze,ut);if(ot){ot[0]=Math.min(ot[0],pe[0],pe[2]),ot[1]=Math.max(ot[1],pe[0],pe[2]),ot[2]=Math.min(ot[2],pe[1],pe[3]),ot[3]=Math.max(ot[3],pe[1],pe[3]);return}this.updateRectMinMax(ve,pe)}getPathBoundingBox(ve=z.PathType.FILL,ye=null){const Fe=[this.minX,this.minY,this.maxX,this.maxY];if(ve===z.PathType.STROKE){ye||(0,$.unreachable)("Stroke bounding box must include transform.");const je=$.Util.singularValueDecompose2dScale(ye),Be=je[0]*this.lineWidth/2,Ne=je[1]*this.lineWidth/2;Fe[0]-=Be,Fe[1]-=Ne,Fe[2]+=Be,Fe[3]+=Ne}return Fe}updateClipFromPath(){const ve=$.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(ve||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(ve){this.clipBox=ve,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(ve=z.PathType.FILL,ye=null){return $.Util.intersect(this.clipBox,this.getPathBoundingBox(ve,ye))}}function he(Pe,ve){if(typeof ImageData<"u"&&ve instanceof ImageData){Pe.putImageData(ve,0,0);return}const ye=ve.height,Fe=ve.width,je=ye%ee,Be=(ye-je)/ee,Ne=je===0?Be:Be+1,ze=Pe.createImageData(Fe,ee);let Ze=0,ut;const ot=ve.data,pe=ze.data;let We,Qe,Ce,Ie;if(ve.kind===$.ImageKind.GRAYSCALE_1BPP){const Ge=ot.byteLength,rt=new Uint32Array(pe.buffer,0,pe.byteLength>>2),ct=rt.length,qe=Fe+7>>3,Ve=4294967295,Xe=$.FeatureTest.isLittleEndian?4278190080:255;for(We=0;We<Ne;We++){for(Ce=We<Be?ee:je,ut=0,Qe=0;Qe<Ce;Qe++){const Je=Ge-Ze;let lt=0;const _t=Je>qe?Fe:Je*8-7,mt=_t&-8;let Ct=0,Et=0;for(;lt<mt;lt+=8)Et=ot[Ze++],rt[ut++]=Et&128?Ve:Xe,rt[ut++]=Et&64?Ve:Xe,rt[ut++]=Et&32?Ve:Xe,rt[ut++]=Et&16?Ve:Xe,rt[ut++]=Et&8?Ve:Xe,rt[ut++]=Et&4?Ve:Xe,rt[ut++]=Et&2?Ve:Xe,rt[ut++]=Et&1?Ve:Xe;for(;lt<_t;lt++)Ct===0&&(Et=ot[Ze++],Ct=128),rt[ut++]=Et&Ct?Ve:Xe,Ct>>=1}for(;ut<ct;)rt[ut++]=0;Pe.putImageData(ze,0,We*ee)}}else if(ve.kind===$.ImageKind.RGBA_32BPP){for(Qe=0,Ie=Fe*ee*4,We=0;We<Be;We++)pe.set(ot.subarray(Ze,Ze+Ie)),Ze+=Ie,Pe.putImageData(ze,0,Qe),Qe+=ee;We<Ne&&(Ie=Fe*je*4,pe.set(ot.subarray(Ze,Ze+Ie)),Pe.putImageData(ze,0,Qe))}else if(ve.kind===$.ImageKind.RGB_24BPP)for(Ce=ee,Ie=Fe*Ce,We=0;We<Ne;We++){for(We>=Be&&(Ce=je,Ie=Fe*Ce),ut=0,Qe=Ie;Qe--;)pe[ut++]=ot[Ze++],pe[ut++]=ot[Ze++],pe[ut++]=ot[Ze++],pe[ut++]=255;Pe.putImageData(ze,0,We*ee)}else throw new Error(`bad image kind: ${ve.kind}`)}function le(Pe,ve){if(ve.bitmap){Pe.drawImage(ve.bitmap,0,0);return}const ye=ve.height,Fe=ve.width,je=ye%ee,Be=(ye-je)/ee,Ne=je===0?Be:Be+1,ze=Pe.createImageData(Fe,ee);let Ze=0;const ut=ve.data,ot=ze.data;for(let pe=0;pe<Ne;pe++){const We=pe<Be?ee:je;({srcPos:Ze}=(0,V.convertBlackAndWhiteToRGBA)({src:ut,srcPos:Ze,dest:ot,width:Fe,height:We,nonBlackColor:0})),Pe.putImageData(ze,0,pe*ee)}}function ae(Pe,ve){const ye=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const Fe of ye)Pe[Fe]!==void 0&&(ve[Fe]=Pe[Fe]);Pe.setLineDash!==void 0&&(ve.setLineDash(Pe.getLineDash()),ve.lineDashOffset=Pe.lineDashOffset)}function ue(Pe){if(Pe.strokeStyle=Pe.fillStyle="#000000",Pe.fillRule="nonzero",Pe.globalAlpha=1,Pe.lineWidth=1,Pe.lineCap="butt",Pe.lineJoin="miter",Pe.miterLimit=10,Pe.globalCompositeOperation="source-over",Pe.font="10px sans-serif",Pe.setLineDash!==void 0&&(Pe.setLineDash([]),Pe.lineDashOffset=0),!$.isNodeJS){const{filter:ve}=Pe;ve!=="none"&&ve!==""&&(Pe.filter="none")}}function me(Pe,ve,ye,Fe){const je=Pe.length;for(let Be=3;Be<je;Be+=4){const Ne=Pe[Be];if(Ne===0)Pe[Be-3]=ve,Pe[Be-2]=ye,Pe[Be-1]=Fe;else if(Ne<255){const ze=255-Ne;Pe[Be-3]=Pe[Be-3]*Ne+ve*ze>>8,Pe[Be-2]=Pe[Be-2]*Ne+ye*ze>>8,Pe[Be-1]=Pe[Be-1]*Ne+Fe*ze>>8}}}function fe(Pe,ve,ye){const Fe=Pe.length,je=1/255;for(let Be=3;Be<Fe;Be+=4){const Ne=ye?ye[Pe[Be]]:Pe[Be];ve[Be]=ve[Be]*Ne*je|0}}function ce(Pe,ve,ye){const Fe=Pe.length;for(let je=3;je<Fe;je+=4){const Be=Pe[je-3]*77+Pe[je-2]*152+Pe[je-1]*28;ve[je]=ye?ve[je]*ye[Be>>8]>>8:ve[je]*Be>>16}}function _e(Pe,ve,ye,Fe,je,Be,Ne,ze,Ze,ut,ot){const pe=!!Be,We=pe?Be[0]:0,Qe=pe?Be[1]:0,Ce=pe?Be[2]:0,Ie=je==="Luminosity"?ce:fe,rt=Math.min(Fe,Math.ceil(1048576/ye));for(let ct=0;ct<Fe;ct+=rt){const qe=Math.min(rt,Fe-ct),Ve=Pe.getImageData(ze-ut,ct+(Ze-ot),ye,qe),Xe=ve.getImageData(ze,ct+Ze,ye,qe);pe&&me(Ve.data,We,Qe,Ce),Ie(Ve.data,Xe.data,Ne),ve.putImageData(Xe,ze,ct+Ze)}}function we(Pe,ve,ye,Fe){const je=Fe[0],Be=Fe[1],Ne=Fe[2]-je,ze=Fe[3]-Be;Ne===0||ze===0||(_e(ve.context,ye,Ne,ze,ve.subtype,ve.backdrop,ve.transferMap,je,Be,ve.offsetX,ve.offsetY),Pe.save(),Pe.globalAlpha=1,Pe.globalCompositeOperation="source-over",Pe.setTransform(1,0,0,1,0,0),Pe.drawImage(ye.canvas,0,0),Pe.restore())}function ge(Pe,ve){const ye=$.Util.singularValueDecompose2dScale(Pe);ye[0]=Math.fround(ye[0]),ye[1]=Math.fround(ye[1]);const Fe=Math.fround((globalThis.devicePixelRatio||1)*j.PixelsPerInch.PDF_TO_CSS_UNITS);return ve!==void 0?ve:ye[0]<=Fe||ye[1]<=Fe}const Ae=["butt","round","square"],de=["miter","round","bevel"],De={},Me={},$e=class{constructor(ve,ye,Fe,je,Be,{optionalContentConfig:Ne,markedContentStack:ze=null},Ze,ut){Ye(this,Te);Ye(this,He);this.ctx=ve,this.current=new oe(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=ye,this.objs=Fe,this.canvasFactory=je,this.filterFactory=Be,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=ze||[],this.optionalContentConfig=Ne,this.cachedCanvases=new re(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=Ze,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=ut,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(ve,ye=null){return typeof ve=="string"?ve.startsWith("g_")?this.commonObjs.get(ve):this.objs.get(ve):ye}beginDrawing({transform:ve,viewport:ye,transparency:Fe=!1,background:je=null}){const Be=this.ctx.canvas.width,Ne=this.ctx.canvas.height,ze=this.ctx.fillStyle;if(this.ctx.fillStyle=je||"#ffffff",this.ctx.fillRect(0,0,Be,Ne),this.ctx.fillStyle=ze,Fe){const Ze=this.cachedCanvases.getCanvas("transparent",Be,Ne);this.compositeCtx=this.ctx,this.transparentCanvas=Ze.canvas,this.ctx=Ze.context,this.ctx.save(),this.ctx.transform(...(0,j.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),ue(this.ctx),ve&&(this.ctx.transform(...ve),this.outputScaleX=ve[0],this.outputScaleY=ve[0]),this.ctx.transform(...ye.transform),this.viewportScale=ye.scale,this.baseTransform=(0,j.getCurrentTransform)(this.ctx)}executeOperatorList(ve,ye,Fe,je){const Be=ve.argsArray,Ne=ve.fnArray;let ze=ye||0;const Ze=Be.length;if(Ze===ze)return ze;const ut=Ze-ze>Z&&typeof Fe=="function",ot=ut?Date.now()+Q:0;let pe=0;const We=this.commonObjs,Qe=this.objs;let Ce;for(;;){if(je!==void 0&&ze===je.nextBreakPoint)return je.breakIt(ze,Fe),ze;if(Ce=Ne[ze],Ce!==$.OPS.dependency)this[Ce].apply(this,Be[ze]);else for(const Ie of Be[ze]){const Ge=Ie.startsWith("g_")?We:Qe;if(!Ge.has(Ie))return Ge.get(Ie,Fe),ze}if(ze++,ze===Ze)return ze;if(ut&&++pe>Z){if(Date.now()>ot)return Fe(),ze;pe=0}}}endDrawing(){st(this,Te,En).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const ve of this._cachedBitmapsMap.values()){for(const ye of ve.values())typeof HTMLCanvasElement<"u"&&ye instanceof HTMLCanvasElement&&(ye.width=ye.height=0);ve.clear()}this._cachedBitmapsMap.clear(),st(this,He,kn).call(this)}_scaleImage(ve,ye){const Fe=ve.width,je=ve.height;let Be=Math.max(Math.hypot(ye[0],ye[1]),1),Ne=Math.max(Math.hypot(ye[2],ye[3]),1),ze=Fe,Ze=je,ut="prescale1",ot,pe;for(;Be>2&&ze>1||Ne>2&&Ze>1;){let We=ze,Qe=Ze;Be>2&&ze>1&&(We=ze>=16384?Math.floor(ze/2)-1||1:Math.ceil(ze/2),Be/=ze/We),Ne>2&&Ze>1&&(Qe=Ze>=16384?Math.floor(Ze/2)-1||1:Math.ceil(Ze)/2,Ne/=Ze/Qe),ot=this.cachedCanvases.getCanvas(ut,We,Qe),pe=ot.context,pe.clearRect(0,0,We,Qe),pe.drawImage(ve,0,0,ze,Ze,0,0,We,Qe),ve=ot.canvas,ze=We,Ze=Qe,ut=ut==="prescale1"?"prescale2":"prescale1"}return{img:ve,paintWidth:ze,paintHeight:Ze}}_createMaskCanvas(ve){const ye=this.ctx,{width:Fe,height:je}=ve,Be=this.current.fillColor,Ne=this.current.patternFill,ze=(0,j.getCurrentTransform)(ye);let Ze,ut,ot,pe;if((ve.bitmap||ve.data)&&ve.count>1){const lt=ve.bitmap||ve.data.buffer;ut=JSON.stringify(Ne?ze:[ze.slice(0,4),Be]),Ze=this._cachedBitmapsMap.get(lt),Ze||(Ze=new Map,this._cachedBitmapsMap.set(lt,Ze));const _t=Ze.get(ut);if(_t&&!Ne){const mt=Math.round(Math.min(ze[0],ze[2])+ze[4]),Ct=Math.round(Math.min(ze[1],ze[3])+ze[5]);return{canvas:_t,offsetX:mt,offsetY:Ct}}ot=_t}ot||(pe=this.cachedCanvases.getCanvas("maskCanvas",Fe,je),le(pe.context,ve));let We=$.Util.transform(ze,[1/Fe,0,0,-1/je,0,0]);We=$.Util.transform(We,[1,0,0,1,0,-je]);const Qe=$.Util.applyTransform([0,0],We),Ce=$.Util.applyTransform([Fe,je],We),Ie=$.Util.normalizeRect([Qe[0],Qe[1],Ce[0],Ce[1]]),Ge=Math.round(Ie[2]-Ie[0])||1,rt=Math.round(Ie[3]-Ie[1])||1,ct=this.cachedCanvases.getCanvas("fillCanvas",Ge,rt),qe=ct.context,Ve=Math.min(Qe[0],Ce[0]),Xe=Math.min(Qe[1],Ce[1]);qe.translate(-Ve,-Xe),qe.transform(...We),ot||(ot=this._scaleImage(pe.canvas,(0,j.getCurrentTransformInverse)(qe)),ot=ot.img,Ze&&Ne&&Ze.set(ut,ot)),qe.imageSmoothingEnabled=ge((0,j.getCurrentTransform)(qe),ve.interpolate),se(qe,ot,0,0,ot.width,ot.height,0,0,Fe,je),qe.globalCompositeOperation="source-in";const Je=$.Util.transform((0,j.getCurrentTransformInverse)(qe),[1,0,0,1,-Ve,-Xe]);return qe.fillStyle=Ne?Be.getPattern(ye,this,Je,z.PathType.FILL):Be,qe.fillRect(0,0,Fe,je),Ze&&!Ne&&(this.cachedCanvases.delete("fillCanvas"),Ze.set(ut,ct.canvas)),{canvas:ct.canvas,offsetX:Math.round(Ve),offsetY:Math.round(Xe)}}setLineWidth(ve){ve!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=ve,this.ctx.lineWidth=ve}setLineCap(ve){this.ctx.lineCap=Ae[ve]}setLineJoin(ve){this.ctx.lineJoin=de[ve]}setMiterLimit(ve){this.ctx.miterLimit=ve}setDash(ve,ye){const Fe=this.ctx;Fe.setLineDash!==void 0&&(Fe.setLineDash(ve),Fe.lineDashOffset=ye)}setRenderingIntent(ve){}setFlatness(ve){}setGState(ve){for(const[ye,Fe]of ve)switch(ye){case"LW":this.setLineWidth(Fe);break;case"LC":this.setLineCap(Fe);break;case"LJ":this.setLineJoin(Fe);break;case"ML":this.setMiterLimit(Fe);break;case"D":this.setDash(Fe[0],Fe[1]);break;case"RI":this.setRenderingIntent(Fe);break;case"FL":this.setFlatness(Fe);break;case"Font":this.setFont(Fe[0],Fe[1]);break;case"CA":this.current.strokeAlpha=Fe;break;case"ca":this.current.fillAlpha=Fe,this.ctx.globalAlpha=Fe;break;case"BM":this.ctx.globalCompositeOperation=Fe;break;case"SMask":this.current.activeSMask=Fe?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(Fe);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const ve=this.inSMaskMode;this.current.activeSMask&&!ve?this.beginSMaskMode():!this.current.activeSMask&&ve&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const ve=this.ctx.canvas.width,ye=this.ctx.canvas.height,Fe="smaskGroupAt"+this.groupLevel,je=this.cachedCanvases.getCanvas(Fe,ve,ye);this.suspendedCtx=this.ctx,this.ctx=je.context;const Be=this.ctx;Be.setTransform(...(0,j.getCurrentTransform)(this.suspendedCtx)),ae(this.suspendedCtx,Be),ne(Be,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ae(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(ve){if(!this.current.activeSMask)return;ve?(ve[0]=Math.floor(ve[0]),ve[1]=Math.floor(ve[1]),ve[2]=Math.ceil(ve[2]),ve[3]=Math.ceil(ve[3])):ve=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const ye=this.current.activeSMask,Fe=this.suspendedCtx;we(Fe,ye,this.ctx,ve),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(ae(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const ve=this.current;this.stateStack.push(ve),this.current=ve.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),ae(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(ve,ye,Fe,je,Be,Ne){this.ctx.transform(ve,ye,Fe,je,Be,Ne),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(ve,ye,Fe){const je=this.ctx,Be=this.current;let Ne=Be.x,ze=Be.y,Ze,ut;const ot=(0,j.getCurrentTransform)(je),pe=ot[0]===0&&ot[3]===0||ot[1]===0&&ot[2]===0,We=pe?Fe.slice(0):null;for(let Qe=0,Ce=0,Ie=ve.length;Qe<Ie;Qe++)switch(ve[Qe]|0){case $.OPS.rectangle:Ne=ye[Ce++],ze=ye[Ce++];const Ge=ye[Ce++],rt=ye[Ce++],ct=Ne+Ge,qe=ze+rt;je.moveTo(Ne,ze),Ge===0||rt===0?je.lineTo(ct,qe):(je.lineTo(ct,ze),je.lineTo(ct,qe),je.lineTo(Ne,qe)),pe||Be.updateRectMinMax(ot,[Ne,ze,ct,qe]),je.closePath();break;case $.OPS.moveTo:Ne=ye[Ce++],ze=ye[Ce++],je.moveTo(Ne,ze),pe||Be.updatePathMinMax(ot,Ne,ze);break;case $.OPS.lineTo:Ne=ye[Ce++],ze=ye[Ce++],je.lineTo(Ne,ze),pe||Be.updatePathMinMax(ot,Ne,ze);break;case $.OPS.curveTo:Ze=Ne,ut=ze,Ne=ye[Ce+4],ze=ye[Ce+5],je.bezierCurveTo(ye[Ce],ye[Ce+1],ye[Ce+2],ye[Ce+3],Ne,ze),Be.updateCurvePathMinMax(ot,Ze,ut,ye[Ce],ye[Ce+1],ye[Ce+2],ye[Ce+3],Ne,ze,We),Ce+=6;break;case $.OPS.curveTo2:Ze=Ne,ut=ze,je.bezierCurveTo(Ne,ze,ye[Ce],ye[Ce+1],ye[Ce+2],ye[Ce+3]),Be.updateCurvePathMinMax(ot,Ze,ut,Ne,ze,ye[Ce],ye[Ce+1],ye[Ce+2],ye[Ce+3],We),Ne=ye[Ce+2],ze=ye[Ce+3],Ce+=4;break;case $.OPS.curveTo3:Ze=Ne,ut=ze,Ne=ye[Ce+2],ze=ye[Ce+3],je.bezierCurveTo(ye[Ce],ye[Ce+1],Ne,ze,Ne,ze),Be.updateCurvePathMinMax(ot,Ze,ut,ye[Ce],ye[Ce+1],Ne,ze,Ne,ze,We),Ce+=4;break;case $.OPS.closePath:je.closePath();break}pe&&Be.updateScalingPathMinMax(ot,We),Be.setCurrentPoint(Ne,ze)}closePath(){this.ctx.closePath()}stroke(ve=!0){const ye=this.ctx,Fe=this.current.strokeColor;ye.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof Fe=="object"&&(Fe!=null&&Fe.getPattern)?(ye.save(),ye.strokeStyle=Fe.getPattern(ye,this,(0,j.getCurrentTransformInverse)(ye),z.PathType.STROKE),this.rescaleAndStroke(!1),ye.restore()):this.rescaleAndStroke(!0)),ve&&this.consumePath(this.current.getClippedPathBoundingBox()),ye.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(ve=!0){const ye=this.ctx,Fe=this.current.fillColor,je=this.current.patternFill;let Be=!1;je&&(ye.save(),ye.fillStyle=Fe.getPattern(ye,this,(0,j.getCurrentTransformInverse)(ye),z.PathType.FILL),Be=!0);const Ne=this.current.getClippedPathBoundingBox();this.contentVisible&&Ne!==null&&(this.pendingEOFill?(ye.fill("evenodd"),this.pendingEOFill=!1):ye.fill()),Be&&ye.restore(),ve&&this.consumePath(Ne)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=De}eoClip(){this.pendingClip=Me}beginText(){this.current.textMatrix=$.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const ve=this.pendingTextPaths,ye=this.ctx;if(ve===void 0){ye.beginPath();return}ye.save(),ye.beginPath();for(const Fe of ve)ye.setTransform(...Fe.transform),ye.translate(Fe.x,Fe.y),Fe.addToPath(ye,Fe.fontSize);ye.restore(),ye.clip(),ye.beginPath(),delete this.pendingTextPaths}setCharSpacing(ve){this.current.charSpacing=ve}setWordSpacing(ve){this.current.wordSpacing=ve}setHScale(ve){this.current.textHScale=ve/100}setLeading(ve){this.current.leading=-ve}setFont(ve,ye){var ot;const Fe=this.commonObjs.get(ve),je=this.current;if(!Fe)throw new Error(`Can't find font for ${ve}`);if(je.fontMatrix=Fe.fontMatrix||$.FONT_IDENTITY_MATRIX,(je.fontMatrix[0]===0||je.fontMatrix[3]===0)&&(0,$.warn)("Invalid font matrix for font "+ve),ye<0?(ye=-ye,je.fontDirection=-1):je.fontDirection=1,this.current.font=Fe,this.current.fontSize=ye,Fe.isType3Font)return;const Be=Fe.loadedName||"sans-serif",Ne=((ot=Fe.systemFontInfo)==null?void 0:ot.css)||`"${Be}", ${Fe.fallbackName}`;let ze="normal";Fe.black?ze="900":Fe.bold&&(ze="bold");const Ze=Fe.italic?"italic":"normal";let ut=ye;ye<X?ut=X:ye>G&&(ut=G),this.current.fontSizeScale=ye/ut,this.ctx.font=`${Ze} ${ze} ${ut}px ${Ne}`}setTextRenderingMode(ve){this.current.textRenderingMode=ve}setTextRise(ve){this.current.textRise=ve}moveText(ve,ye){this.current.x=this.current.lineX+=ve,this.current.y=this.current.lineY+=ye}setLeadingMoveText(ve,ye){this.setLeading(-ye),this.moveText(ve,ye)}setTextMatrix(ve,ye,Fe,je,Be,Ne){this.current.textMatrix=[ve,ye,Fe,je,Be,Ne],this.current.textMatrixScale=Math.hypot(ve,ye),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(ve,ye,Fe,je){const Be=this.ctx,Ne=this.current,ze=Ne.font,Ze=Ne.textRenderingMode,ut=Ne.fontSize/Ne.fontSizeScale,ot=Ze&$.TextRenderingMode.FILL_STROKE_MASK,pe=!!(Ze&$.TextRenderingMode.ADD_TO_PATH_FLAG),We=Ne.patternFill&&!ze.missingFile;let Qe;(ze.disableFontFace||pe||We)&&(Qe=ze.getPathGenerator(this.commonObjs,ve)),ze.disableFontFace||We?(Be.save(),Be.translate(ye,Fe),Be.beginPath(),Qe(Be,ut),je&&Be.setTransform(...je),(ot===$.TextRenderingMode.FILL||ot===$.TextRenderingMode.FILL_STROKE)&&Be.fill(),(ot===$.TextRenderingMode.STROKE||ot===$.TextRenderingMode.FILL_STROKE)&&Be.stroke(),Be.restore()):((ot===$.TextRenderingMode.FILL||ot===$.TextRenderingMode.FILL_STROKE)&&Be.fillText(ve,ye,Fe),(ot===$.TextRenderingMode.STROKE||ot===$.TextRenderingMode.FILL_STROKE)&&Be.strokeText(ve,ye,Fe)),pe&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,j.getCurrentTransform)(Be),x:ye,y:Fe,fontSize:ut,addToPath:Qe})}get isFontSubpixelAAEnabled(){const{context:ve}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);ve.scale(1.5,1),ve.fillText("I",0,10);const ye=ve.getImageData(0,0,10,10).data;let Fe=!1;for(let je=3;je<ye.length;je+=4)if(ye[je]>0&&ye[je]<255){Fe=!0;break}return(0,$.shadow)(this,"isFontSubpixelAAEnabled",Fe)}showText(ve){const ye=this.current,Fe=ye.font;if(Fe.isType3Font)return this.showType3Text(ve);const je=ye.fontSize;if(je===0)return;const Be=this.ctx,Ne=ye.fontSizeScale,ze=ye.charSpacing,Ze=ye.wordSpacing,ut=ye.fontDirection,ot=ye.textHScale*ut,pe=ve.length,We=Fe.vertical,Qe=We?1:-1,Ce=Fe.defaultVMetrics,Ie=je*ye.fontMatrix[0],Ge=ye.textRenderingMode===$.TextRenderingMode.FILL&&!Fe.disableFontFace&&!ye.patternFill;Be.save(),Be.transform(...ye.textMatrix),Be.translate(ye.x,ye.y+ye.textRise),ut>0?Be.scale(ot,-1):Be.scale(ot,1);let rt;if(ye.patternFill){Be.save();const Je=ye.fillColor.getPattern(Be,this,(0,j.getCurrentTransformInverse)(Be),z.PathType.FILL);rt=(0,j.getCurrentTransform)(Be),Be.restore(),Be.fillStyle=Je}let ct=ye.lineWidth;const qe=ye.textMatrixScale;if(qe===0||ct===0){const Je=ye.textRenderingMode&$.TextRenderingMode.FILL_STROKE_MASK;(Je===$.TextRenderingMode.STROKE||Je===$.TextRenderingMode.FILL_STROKE)&&(ct=this.getSinglePixelWidth())}else ct/=qe;if(Ne!==1&&(Be.scale(Ne,Ne),ct/=Ne),Be.lineWidth=ct,Fe.isInvalidPDFjsFont){const Je=[];let lt=0;for(const _t of ve)Je.push(_t.unicode),lt+=_t.width;Be.fillText(Je.join(""),0,0),ye.x+=lt*Ie*ot,Be.restore(),this.compose();return}let Ve=0,Xe;for(Xe=0;Xe<pe;++Xe){const Je=ve[Xe];if(typeof Je=="number"){Ve+=Qe*Je*je/1e3;continue}let lt=!1;const _t=(Je.isSpace?Ze:0)+ze,mt=Je.fontChar,Ct=Je.accent;let Et,xt,Tt=Je.width;if(We){const tt=Je.vmetric||Ce,it=-(Je.vmetric?tt[1]:Tt*.5)*Ie,nt=tt[2]*Ie;Tt=tt?-tt[0]:Tt,Et=it/Ne,xt=(Ve+nt)/Ne}else Et=Ve/Ne,xt=0;if(Fe.remeasure&&Tt>0){const tt=Be.measureText(mt).width*1e3/je*Ne;if(Tt<tt&&this.isFontSubpixelAAEnabled){const it=Tt/tt;lt=!0,Be.save(),Be.scale(it,1),Et/=it}else Tt!==tt&&(Et+=(Tt-tt)/2e3*je/Ne)}if(this.contentVisible&&(Je.isInFont||Fe.missingFile)){if(Ge&&!Ct)Be.fillText(mt,Et,xt);else if(this.paintChar(mt,Et,xt,rt),Ct){const tt=Et+je*Ct.offset.x/Ne,it=xt-je*Ct.offset.y/Ne;this.paintChar(Ct.fontChar,tt,it,rt)}}const Dt=We?Tt*Ie-_t*ut:Tt*Ie+_t*ut;Ve+=Dt,lt&&Be.restore()}We?ye.y-=Ve:ye.x+=Ve*ot,Be.restore(),this.compose()}showType3Text(ve){const ye=this.ctx,Fe=this.current,je=Fe.font,Be=Fe.fontSize,Ne=Fe.fontDirection,ze=je.vertical?1:-1,Ze=Fe.charSpacing,ut=Fe.wordSpacing,ot=Fe.textHScale*Ne,pe=Fe.fontMatrix||$.FONT_IDENTITY_MATRIX,We=ve.length,Qe=Fe.textRenderingMode===$.TextRenderingMode.INVISIBLE;let Ce,Ie,Ge,rt;if(!(Qe||Be===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,ye.save(),ye.transform(...Fe.textMatrix),ye.translate(Fe.x,Fe.y),ye.scale(ot,Ne),Ce=0;Ce<We;++Ce){if(Ie=ve[Ce],typeof Ie=="number"){rt=ze*Ie*Be/1e3,this.ctx.translate(rt,0),Fe.x+=rt*ot;continue}const ct=(Ie.isSpace?ut:0)+Ze,qe=je.charProcOperatorList[Ie.operatorListId];if(!qe){(0,$.warn)(`Type3 character "${Ie.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=Ie,this.save(),ye.scale(Be,Be),ye.transform(...pe),this.executeOperatorList(qe),this.restore()),Ge=$.Util.applyTransform([Ie.width,0],pe)[0]*Be+ct,ye.translate(Ge,0),Fe.x+=Ge*ot}ye.restore(),this.processingType3=null}}setCharWidth(ve,ye){}setCharWidthAndBounds(ve,ye,Fe,je,Be,Ne){this.ctx.rect(Fe,je,Be-Fe,Ne-je),this.ctx.clip(),this.endPath()}getColorN_Pattern(ve){let ye;if(ve[0]==="TilingPattern"){const Fe=ve[1],je=this.baseTransform||(0,j.getCurrentTransform)(this.ctx),Be={createCanvasGraphics:Ne=>new $e(Ne,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};ye=new z.TilingPattern(ve,Fe,this.ctx,Be,je)}else ye=this._getPattern(ve[1],ve[2]);return ye}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(ve,ye,Fe){const je=$.Util.makeHexColor(ve,ye,Fe);this.ctx.strokeStyle=je,this.current.strokeColor=je}setFillRGBColor(ve,ye,Fe){const je=$.Util.makeHexColor(ve,ye,Fe);this.ctx.fillStyle=je,this.current.fillColor=je,this.current.patternFill=!1}_getPattern(ve,ye=null){let Fe;return this.cachedPatterns.has(ve)?Fe=this.cachedPatterns.get(ve):(Fe=(0,z.getShadingPattern)(this.getObject(ve)),this.cachedPatterns.set(ve,Fe)),ye&&(Fe.matrix=ye),Fe}shadingFill(ve){if(!this.contentVisible)return;const ye=this.ctx;this.save();const Fe=this._getPattern(ve);ye.fillStyle=Fe.getPattern(ye,this,(0,j.getCurrentTransformInverse)(ye),z.PathType.SHADING);const je=(0,j.getCurrentTransformInverse)(ye);if(je){const{width:Be,height:Ne}=ye.canvas,[ze,Ze,ut,ot]=$.Util.getAxialAlignedBoundingBox([0,0,Be,Ne],je);this.ctx.fillRect(ze,Ze,ut-ze,ot-Ze)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,$.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,$.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(ve,ye){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(ve)&&ve.length===6&&this.transform(...ve),this.baseTransform=(0,j.getCurrentTransform)(this.ctx),ye)){const Fe=ye[2]-ye[0],je=ye[3]-ye[1];this.ctx.rect(ye[0],ye[1],Fe,je),this.current.updateRectMinMax((0,j.getCurrentTransform)(this.ctx),ye),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(ve){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const ye=this.ctx;ve.isolated||(0,$.info)("TODO: Support non-isolated groups."),ve.knockout&&(0,$.warn)("Knockout groups not supported.");const Fe=(0,j.getCurrentTransform)(ye);if(ve.matrix&&ye.transform(...ve.matrix),!ve.bbox)throw new Error("Bounding box is required.");let je=$.Util.getAxialAlignedBoundingBox(ve.bbox,(0,j.getCurrentTransform)(ye));const Be=[0,0,ye.canvas.width,ye.canvas.height];je=$.Util.intersect(je,Be)||[0,0,0,0];const Ne=Math.floor(je[0]),ze=Math.floor(je[1]);let Ze=Math.max(Math.ceil(je[2])-Ne,1),ut=Math.max(Math.ceil(je[3])-ze,1),ot=1,pe=1;Ze>Y&&(ot=Ze/Y,Ze=Y),ut>Y&&(pe=ut/Y,ut=Y),this.current.startNewPathAndClipBox([0,0,Ze,ut]);let We="groupAt"+this.groupLevel;ve.smask&&(We+="_smask_"+this.smaskCounter++%2);const Qe=this.cachedCanvases.getCanvas(We,Ze,ut),Ce=Qe.context;Ce.scale(1/ot,1/pe),Ce.translate(-Ne,-ze),Ce.transform(...Fe),ve.smask?this.smaskStack.push({canvas:Qe.canvas,context:Ce,offsetX:Ne,offsetY:ze,scaleX:ot,scaleY:pe,subtype:ve.smask.subtype,backdrop:ve.smask.backdrop,transferMap:ve.smask.transferMap||null,startTransformInverse:null}):(ye.setTransform(1,0,0,1,0,0),ye.translate(Ne,ze),ye.scale(ot,pe),ye.save()),ae(ye,Ce),this.ctx=Ce,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(ye),this.groupLevel++}endGroup(ve){if(!this.contentVisible)return;this.groupLevel--;const ye=this.ctx,Fe=this.groupStack.pop();if(this.ctx=Fe,this.ctx.imageSmoothingEnabled=!1,ve.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const je=(0,j.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...je);const Be=$.Util.getAxialAlignedBoundingBox([0,0,ye.canvas.width,ye.canvas.height],je);this.ctx.drawImage(ye.canvas,0,0),this.ctx.restore(),this.compose(Be)}}beginAnnotation(ve,ye,Fe,je,Be){if(st(this,Te,En).call(this),ue(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(ye)&&ye.length===4){const Ne=ye[2]-ye[0],ze=ye[3]-ye[1];if(Be&&this.annotationCanvasMap){Fe=Fe.slice(),Fe[4]-=ye[0],Fe[5]-=ye[1],ye=ye.slice(),ye[0]=ye[1]=0,ye[2]=Ne,ye[3]=ze;const[Ze,ut]=$.Util.singularValueDecompose2dScale((0,j.getCurrentTransform)(this.ctx)),{viewportScale:ot}=this,pe=Math.ceil(Ne*this.outputScaleX*ot),We=Math.ceil(ze*this.outputScaleY*ot);this.annotationCanvas=this.canvasFactory.create(pe,We);const{canvas:Qe,context:Ce}=this.annotationCanvas;this.annotationCanvasMap.set(ve,Qe),this.annotationCanvas.savedCtx=this.ctx,this.ctx=Ce,this.ctx.save(),this.ctx.setTransform(Ze,0,0,-ut,0,ze*ut),ue(this.ctx)}else ue(this.ctx),this.ctx.rect(ye[0],ye[1],Ne,ze),this.ctx.clip(),this.endPath()}this.current=new oe(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...Fe),this.transform(...je)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),st(this,He,kn).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(ve){if(!this.contentVisible)return;const ye=ve.count;ve=this.getObject(ve.data,ve),ve.count=ye;const Fe=this.ctx,je=this.processingType3;if(je&&(je.compiled===void 0&&(je.compiled=ie(ve)),je.compiled)){je.compiled(Fe);return}const Be=this._createMaskCanvas(ve),Ne=Be.canvas;Fe.save(),Fe.setTransform(1,0,0,1,0,0),Fe.drawImage(Ne,Be.offsetX,Be.offsetY),Fe.restore(),this.compose()}paintImageMaskXObjectRepeat(ve,ye,Fe=0,je=0,Be,Ne){if(!this.contentVisible)return;ve=this.getObject(ve.data,ve);const ze=this.ctx;ze.save();const Ze=(0,j.getCurrentTransform)(ze);ze.transform(ye,Fe,je,Be,0,0);const ut=this._createMaskCanvas(ve);ze.setTransform(1,0,0,1,ut.offsetX-Ze[4],ut.offsetY-Ze[5]);for(let ot=0,pe=Ne.length;ot<pe;ot+=2){const We=$.Util.transform(Ze,[ye,Fe,je,Be,Ne[ot],Ne[ot+1]]),[Qe,Ce]=$.Util.applyTransform([0,0],We);ze.drawImage(ut.canvas,Qe,Ce)}ze.restore(),this.compose()}paintImageMaskXObjectGroup(ve){if(!this.contentVisible)return;const ye=this.ctx,Fe=this.current.fillColor,je=this.current.patternFill;for(const Be of ve){const{data:Ne,width:ze,height:Ze,transform:ut}=Be,ot=this.cachedCanvases.getCanvas("maskCanvas",ze,Ze),pe=ot.context;pe.save();const We=this.getObject(Ne,Be);le(pe,We),pe.globalCompositeOperation="source-in",pe.fillStyle=je?Fe.getPattern(pe,this,(0,j.getCurrentTransformInverse)(ye),z.PathType.FILL):Fe,pe.fillRect(0,0,ze,Ze),pe.restore(),ye.save(),ye.transform(...ut),ye.scale(1,-1),se(ye,ot.canvas,0,0,ze,Ze,0,-1,1,1),ye.restore()}this.compose()}paintImageXObject(ve){if(!this.contentVisible)return;const ye=this.getObject(ve);if(!ye){(0,$.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(ye)}paintImageXObjectRepeat(ve,ye,Fe,je){if(!this.contentVisible)return;const Be=this.getObject(ve);if(!Be){(0,$.warn)("Dependent image isn't ready yet");return}const Ne=Be.width,ze=Be.height,Ze=[];for(let ut=0,ot=je.length;ut<ot;ut+=2)Ze.push({transform:[ye,0,0,Fe,je[ut],je[ut+1]],x:0,y:0,w:Ne,h:ze});this.paintInlineImageXObjectGroup(Be,Ze)}applyTransferMapsToCanvas(ve){return this.current.transferMaps!=="none"&&(ve.filter=this.current.transferMaps,ve.drawImage(ve.canvas,0,0),ve.filter="none"),ve.canvas}applyTransferMapsToBitmap(ve){if(this.current.transferMaps==="none")return ve.bitmap;const{bitmap:ye,width:Fe,height:je}=ve,Be=this.cachedCanvases.getCanvas("inlineImage",Fe,je),Ne=Be.context;return Ne.filter=this.current.transferMaps,Ne.drawImage(ye,0,0),Ne.filter="none",Be.canvas}paintInlineImageXObject(ve){if(!this.contentVisible)return;const ye=ve.width,Fe=ve.height,je=this.ctx;if(this.save(),!$.isNodeJS){const{filter:ze}=je;ze!=="none"&&ze!==""&&(je.filter="none")}je.scale(1/ye,-1/Fe);let Be;if(ve.bitmap)Be=this.applyTransferMapsToBitmap(ve);else if(typeof HTMLElement=="function"&&ve instanceof HTMLElement||!ve.data)Be=ve;else{const Ze=this.cachedCanvases.getCanvas("inlineImage",ye,Fe).context;he(Ze,ve),Be=this.applyTransferMapsToCanvas(Ze)}const Ne=this._scaleImage(Be,(0,j.getCurrentTransformInverse)(je));je.imageSmoothingEnabled=ge((0,j.getCurrentTransform)(je),ve.interpolate),se(je,Ne.img,0,0,Ne.paintWidth,Ne.paintHeight,0,-Fe,ye,Fe),this.compose(),this.restore()}paintInlineImageXObjectGroup(ve,ye){if(!this.contentVisible)return;const Fe=this.ctx;let je;if(ve.bitmap)je=ve.bitmap;else{const Be=ve.width,Ne=ve.height,Ze=this.cachedCanvases.getCanvas("inlineImage",Be,Ne).context;he(Ze,ve),je=this.applyTransferMapsToCanvas(Ze)}for(const Be of ye)Fe.save(),Fe.transform(...Be.transform),Fe.scale(1,-1),se(Fe,je,Be.x,Be.y,Be.w,Be.h,0,-1,1,1),Fe.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(ve){}markPointProps(ve,ye){}beginMarkedContent(ve){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(ve,ye){ve==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(ye)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(ve){const ye=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(ve);const Fe=this.ctx;this.pendingClip&&(ye||(this.pendingClip===Me?Fe.clip("evenodd"):Fe.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),Fe.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const ve=(0,j.getCurrentTransform)(this.ctx);if(ve[1]===0&&ve[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(ve[0]),Math.abs(ve[3]));else{const ye=Math.abs(ve[0]*ve[3]-ve[2]*ve[1]),Fe=Math.hypot(ve[0],ve[2]),je=Math.hypot(ve[1],ve[3]);this._cachedGetSinglePixelWidth=Math.max(Fe,je)/ye}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:ve}=this.current,{a:ye,b:Fe,c:je,d:Be}=this.ctx.getTransform();let Ne,ze;if(Fe===0&&je===0){const Ze=Math.abs(ye),ut=Math.abs(Be);if(Ze===ut)if(ve===0)Ne=ze=1/Ze;else{const ot=Ze*ve;Ne=ze=ot<1?1/ot:1}else if(ve===0)Ne=1/Ze,ze=1/ut;else{const ot=Ze*ve,pe=ut*ve;Ne=ot<1?1/ot:1,ze=pe<1?1/pe:1}}else{const Ze=Math.abs(ye*Be-Fe*je),ut=Math.hypot(ye,Fe),ot=Math.hypot(je,Be);if(ve===0)Ne=ot/Ze,ze=ut/Ze;else{const pe=ve*Ze;Ne=ot>pe?ot/pe:1,ze=ut>pe?ut/pe:1}}this._cachedScaleForStroking[0]=Ne,this._cachedScaleForStroking[1]=ze}return this._cachedScaleForStroking}rescaleAndStroke(ve){const{ctx:ye}=this,{lineWidth:Fe}=this.current,[je,Be]=this.getScaleForStroking();if(ye.lineWidth=Fe||1,je===1&&Be===1){ye.stroke();return}const Ne=ye.getLineDash();if(ve&&ye.save(),ye.scale(je,Be),Ne.length>0){const ze=Math.max(je,Be);ye.setLineDash(Ne.map(Ze=>Ze/ze)),ye.lineDashOffset/=ze}ye.stroke(),ve&&ye.restore()}isContentVisible(){for(let ve=this.markedContentStack.length-1;ve>=0;ve--)if(!this.markedContentStack[ve].visible)return!1;return!0}};let Ee=$e;Te=new WeakSet,En=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},He=new WeakSet,kn=function(){if(this.pageColors){const ve=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(ve!=="none"){const ye=this.ctx.filter;this.ctx.filter=ve,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=ye}}},_.CanvasGraphics=Ee;for(const Pe in $.OPS)Ee.prototype[Pe]!==void 0&&(Ee.prototype[$.OPS[Pe]]=Ee.prototype[Pe])},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.TilingPattern=_.PathType=void 0,_.getShadingPattern=ee;var $=M(1),j=M(6);const z={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};_.PathType=z;function V(ie,oe){if(!oe)return;const he=oe[2]-oe[0],le=oe[3]-oe[1],ae=new Path2D;ae.rect(oe[0],oe[1],he,le),ie.clip(ae)}class X{constructor(){this.constructor===X&&(0,$.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,$.unreachable)("Abstract method `getPattern` called.")}}class G extends X{constructor(oe){super(),this._type=oe[1],this._bbox=oe[2],this._colorStops=oe[3],this._p0=oe[4],this._p1=oe[5],this._r0=oe[6],this._r1=oe[7],this.matrix=null}_createGradient(oe){let he;this._type==="axial"?he=oe.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(he=oe.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const le of this._colorStops)he.addColorStop(le[0],le[1]);return he}getPattern(oe,he,le,ae){let ue;if(ae===z.STROKE||ae===z.FILL){const me=he.current.getClippedPathBoundingBox(ae,(0,j.getCurrentTransform)(oe))||[0,0,0,0],fe=Math.ceil(me[2]-me[0])||1,ce=Math.ceil(me[3]-me[1])||1,_e=he.cachedCanvases.getCanvas("pattern",fe,ce,!0),we=_e.context;we.clearRect(0,0,we.canvas.width,we.canvas.height),we.beginPath(),we.rect(0,0,we.canvas.width,we.canvas.height),we.translate(-me[0],-me[1]),le=$.Util.transform(le,[1,0,0,1,me[0],me[1]]),we.transform(...he.baseTransform),this.matrix&&we.transform(...this.matrix),V(we,this._bbox),we.fillStyle=this._createGradient(we),we.fill(),ue=oe.createPattern(_e.canvas,"no-repeat");const ge=new DOMMatrix(le);ue.setTransform(ge)}else V(oe,this._bbox),ue=this._createGradient(oe);return ue}}function Y(ie,oe,he,le,ae,ue,me,fe){const ce=oe.coords,_e=oe.colors,we=ie.data,ge=ie.width*4;let Ae;ce[he+1]>ce[le+1]&&(Ae=he,he=le,le=Ae,Ae=ue,ue=me,me=Ae),ce[le+1]>ce[ae+1]&&(Ae=le,le=ae,ae=Ae,Ae=me,me=fe,fe=Ae),ce[he+1]>ce[le+1]&&(Ae=he,he=le,le=Ae,Ae=ue,ue=me,me=Ae);const de=(ce[he]+oe.offsetX)*oe.scaleX,De=(ce[he+1]+oe.offsetY)*oe.scaleY,Me=(ce[le]+oe.offsetX)*oe.scaleX,Ee=(ce[le+1]+oe.offsetY)*oe.scaleY,Te=(ce[ae]+oe.offsetX)*oe.scaleX,xe=(ce[ae+1]+oe.offsetY)*oe.scaleY;if(De>=xe)return;const He=_e[ue],Oe=_e[ue+1],$e=_e[ue+2],Pe=_e[me],ve=_e[me+1],ye=_e[me+2],Fe=_e[fe],je=_e[fe+1],Be=_e[fe+2],Ne=Math.round(De),ze=Math.round(xe);let Ze,ut,ot,pe,We,Qe,Ce,Ie;for(let Ge=Ne;Ge<=ze;Ge++){if(Ge<Ee){const Xe=Ge<De?0:(De-Ge)/(De-Ee);Ze=de-(de-Me)*Xe,ut=He-(He-Pe)*Xe,ot=Oe-(Oe-ve)*Xe,pe=$e-($e-ye)*Xe}else{let Xe;Ge>xe?Xe=1:Ee===xe?Xe=0:Xe=(Ee-Ge)/(Ee-xe),Ze=Me-(Me-Te)*Xe,ut=Pe-(Pe-Fe)*Xe,ot=ve-(ve-je)*Xe,pe=ye-(ye-Be)*Xe}let rt;Ge<De?rt=0:Ge>xe?rt=1:rt=(De-Ge)/(De-xe),We=de-(de-Te)*rt,Qe=He-(He-Fe)*rt,Ce=Oe-(Oe-je)*rt,Ie=$e-($e-Be)*rt;const ct=Math.round(Math.min(Ze,We)),qe=Math.round(Math.max(Ze,We));let Ve=ge*Ge+ct*4;for(let Xe=ct;Xe<=qe;Xe++)rt=(Ze-Xe)/(Ze-We),rt<0?rt=0:rt>1&&(rt=1),we[Ve++]=ut-(ut-Qe)*rt|0,we[Ve++]=ot-(ot-Ce)*rt|0,we[Ve++]=pe-(pe-Ie)*rt|0,we[Ve++]=255}}function Q(ie,oe,he){const le=oe.coords,ae=oe.colors;let ue,me;switch(oe.type){case"lattice":const fe=oe.verticesPerRow,ce=Math.floor(le.length/fe)-1,_e=fe-1;for(ue=0;ue<ce;ue++){let we=ue*fe;for(let ge=0;ge<_e;ge++,we++)Y(ie,he,le[we],le[we+1],le[we+fe],ae[we],ae[we+1],ae[we+fe]),Y(ie,he,le[we+fe+1],le[we+1],le[we+fe],ae[we+fe+1],ae[we+1],ae[we+fe])}break;case"triangles":for(ue=0,me=le.length;ue<me;ue+=3)Y(ie,he,le[ue],le[ue+1],le[ue+2],ae[ue],ae[ue+1],ae[ue+2]);break;default:throw new Error("illegal figure")}}class Z extends X{constructor(oe){super(),this._coords=oe[2],this._colors=oe[3],this._figures=oe[4],this._bounds=oe[5],this._bbox=oe[7],this._background=oe[8],this.matrix=null}_createMeshCanvas(oe,he,le){const fe=Math.floor(this._bounds[0]),ce=Math.floor(this._bounds[1]),_e=Math.ceil(this._bounds[2])-fe,we=Math.ceil(this._bounds[3])-ce,ge=Math.min(Math.ceil(Math.abs(_e*oe[0]*1.1)),3e3),Ae=Math.min(Math.ceil(Math.abs(we*oe[1]*1.1)),3e3),de=_e/ge,De=we/Ae,Me={coords:this._coords,colors:this._colors,offsetX:-fe,offsetY:-ce,scaleX:1/de,scaleY:1/De},Ee=ge+2*2,Te=Ae+2*2,xe=le.getCanvas("mesh",Ee,Te,!1),He=xe.context,Oe=He.createImageData(ge,Ae);if(he){const Pe=Oe.data;for(let ve=0,ye=Pe.length;ve<ye;ve+=4)Pe[ve]=he[0],Pe[ve+1]=he[1],Pe[ve+2]=he[2],Pe[ve+3]=255}for(const Pe of this._figures)Q(Oe,Pe,Me);return He.putImageData(Oe,2,2),{canvas:xe.canvas,offsetX:fe-2*de,offsetY:ce-2*De,scaleX:de,scaleY:De}}getPattern(oe,he,le,ae){V(oe,this._bbox);let ue;if(ae===z.SHADING)ue=$.Util.singularValueDecompose2dScale((0,j.getCurrentTransform)(oe));else if(ue=$.Util.singularValueDecompose2dScale(he.baseTransform),this.matrix){const fe=$.Util.singularValueDecompose2dScale(this.matrix);ue=[ue[0]*fe[0],ue[1]*fe[1]]}const me=this._createMeshCanvas(ue,ae===z.SHADING?null:this._background,he.cachedCanvases);return ae!==z.SHADING&&(oe.setTransform(...he.baseTransform),this.matrix&&oe.transform(...this.matrix)),oe.translate(me.offsetX,me.offsetY),oe.scale(me.scaleX,me.scaleY),oe.createPattern(me.canvas,"no-repeat")}}class te extends X{getPattern(){return"hotpink"}}function ee(ie){switch(ie[0]){case"RadialAxial":return new G(ie);case"Mesh":return new Z(ie);case"Dummy":return new te}throw new Error(`Unknown IR type: ${ie[0]}`)}const ne={COLORED:1,UNCOLORED:2},se=class{constructor(oe,he,le,ae,ue){this.operatorList=oe[2],this.matrix=oe[3]||[1,0,0,1,0,0],this.bbox=oe[4],this.xstep=oe[5],this.ystep=oe[6],this.paintType=oe[7],this.tilingType=oe[8],this.color=he,this.ctx=le,this.canvasGraphicsFactory=ae,this.baseTransform=ue}createPatternCanvas(oe){const he=this.operatorList,le=this.bbox,ae=this.xstep,ue=this.ystep,me=this.paintType,fe=this.tilingType,ce=this.color,_e=this.canvasGraphicsFactory;(0,$.info)("TilingType: "+fe);const we=le[0],ge=le[1],Ae=le[2],de=le[3],De=$.Util.singularValueDecompose2dScale(this.matrix),Me=$.Util.singularValueDecompose2dScale(this.baseTransform),Ee=[De[0]*Me[0],De[1]*Me[1]],Te=this.getSizeAndScale(ae,this.ctx.canvas.width,Ee[0]),xe=this.getSizeAndScale(ue,this.ctx.canvas.height,Ee[1]),He=oe.cachedCanvases.getCanvas("pattern",Te.size,xe.size,!0),Oe=He.context,$e=_e.createCanvasGraphics(Oe);$e.groupLevel=oe.groupLevel,this.setFillAndStrokeStyleToContext($e,me,ce);let Pe=we,ve=ge,ye=Ae,Fe=de;return we<0&&(Pe=0,ye+=Math.abs(we)),ge<0&&(ve=0,Fe+=Math.abs(ge)),Oe.translate(-(Te.scale*Pe),-(xe.scale*ve)),$e.transform(Te.scale,0,0,xe.scale,0,0),Oe.save(),this.clipBbox($e,Pe,ve,ye,Fe),$e.baseTransform=(0,j.getCurrentTransform)($e.ctx),$e.executeOperatorList(he),$e.endDrawing(),{canvas:He.canvas,scaleX:Te.scale,scaleY:xe.scale,offsetX:Pe,offsetY:ve}}getSizeAndScale(oe,he,le){oe=Math.abs(oe);const ae=Math.max(se.MAX_PATTERN_SIZE,he);let ue=Math.ceil(oe*le);return ue>=ae?ue=ae:le=ue/oe,{scale:le,size:ue}}clipBbox(oe,he,le,ae,ue){const me=ae-he,fe=ue-le;oe.ctx.rect(he,le,me,fe),oe.current.updateRectMinMax((0,j.getCurrentTransform)(oe.ctx),[he,le,ae,ue]),oe.clip(),oe.endPath()}setFillAndStrokeStyleToContext(oe,he,le){const ae=oe.ctx,ue=oe.current;switch(he){case ne.COLORED:const me=this.ctx;ae.fillStyle=me.fillStyle,ae.strokeStyle=me.strokeStyle,ue.fillColor=me.fillStyle,ue.strokeColor=me.strokeStyle;break;case ne.UNCOLORED:const fe=$.Util.makeHexColor(le[0],le[1],le[2]);ae.fillStyle=fe,ae.strokeStyle=fe,ue.fillColor=fe,ue.strokeColor=fe;break;default:throw new $.FormatError(`Unsupported paint type: ${he}`)}}getPattern(oe,he,le,ae){let ue=le;ae!==z.SHADING&&(ue=$.Util.transform(ue,he.baseTransform),this.matrix&&(ue=$.Util.transform(ue,this.matrix)));const me=this.createPatternCanvas(he);let fe=new DOMMatrix(ue);fe=fe.translate(me.offsetX,me.offsetY),fe=fe.scale(1/me.scaleX,1/me.scaleY);const ce=oe.createPattern(me.canvas,"repeat");return ce.setTransform(fe),ce}};let re=se;Nt(re,"MAX_PATTERN_SIZE",3e3),_.TilingPattern=re},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.convertBlackAndWhiteToRGBA=z,_.convertToRGBA=j,_.grayToRGBA=X;var $=M(1);function j(G){switch(G.kind){case $.ImageKind.GRAYSCALE_1BPP:return z(G);case $.ImageKind.RGB_24BPP:return V(G)}return null}function z({src:G,srcPos:Y=0,dest:Q,width:Z,height:te,nonBlackColor:ee=4294967295,inverseDecode:ne=!1}){const re=$.FeatureTest.isLittleEndian?4278190080:255,[se,ie]=ne?[ee,re]:[re,ee],oe=Z>>3,he=Z&7,le=G.length;Q=new Uint32Array(Q.buffer);let ae=0;for(let ue=0;ue<te;ue++){for(const fe=Y+oe;Y<fe;Y++){const ce=Y<le?G[Y]:255;Q[ae++]=ce&128?ie:se,Q[ae++]=ce&64?ie:se,Q[ae++]=ce&32?ie:se,Q[ae++]=ce&16?ie:se,Q[ae++]=ce&8?ie:se,Q[ae++]=ce&4?ie:se,Q[ae++]=ce&2?ie:se,Q[ae++]=ce&1?ie:se}if(he===0)continue;const me=Y<le?G[Y++]:255;for(let fe=0;fe<he;fe++)Q[ae++]=me&1<<7-fe?ie:se}return{srcPos:Y,destPos:ae}}function V({src:G,srcPos:Y=0,dest:Q,destPos:Z=0,width:te,height:ee}){let ne=0;const re=G.length>>2,se=new Uint32Array(G.buffer,Y,re);if($.FeatureTest.isLittleEndian){for(;ne<re-2;ne+=3,Z+=4){const ie=se[ne],oe=se[ne+1],he=se[ne+2];Q[Z]=ie|4278190080,Q[Z+1]=ie>>>24|oe<<8|4278190080,Q[Z+2]=oe>>>16|he<<16|4278190080,Q[Z+3]=he>>>8|4278190080}for(let ie=ne*4,oe=G.length;ie<oe;ie+=3)Q[Z++]=G[ie]|G[ie+1]<<8|G[ie+2]<<16|4278190080}else{for(;ne<re-2;ne+=3,Z+=4){const ie=se[ne],oe=se[ne+1],he=se[ne+2];Q[Z]=ie|255,Q[Z+1]=ie<<24|oe>>>8|255,Q[Z+2]=oe<<16|he>>>16|255,Q[Z+3]=he<<8|255}for(let ie=ne*4,oe=G.length;ie<oe;ie+=3)Q[Z++]=G[ie]<<24|G[ie+1]<<16|G[ie+2]<<8|255}return{srcPos:Y,destPos:Z}}function X(G,Y){if($.FeatureTest.isLittleEndian)for(let Q=0,Z=G.length;Q<Z;Q++)Y[Q]=G[Q]*65793|4278190080;else for(let Q=0,Z=G.length;Q<Z;Q++)Y[Q]=G[Q]*16843008|255}},(q,_)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.GlobalWorkerOptions=void 0;const M=Object.create(null);_.GlobalWorkerOptions=M,M.workerPort=null,M.workerSrc=""},(q,_,M)=>{var G,nr,Q,rr,te,un;Object.defineProperty(_,"__esModule",{value:!0}),_.MessageHandler=void 0;var $=M(1);const j={UNKNOWN:0,DATA:1,ERROR:2},z={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function V(ne){switch(ne instanceof Error||typeof ne=="object"&&ne!==null||(0,$.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),ne.name){case"AbortException":return new $.AbortException(ne.message);case"MissingPDFException":return new $.MissingPDFException(ne.message);case"PasswordException":return new $.PasswordException(ne.message,ne.code);case"UnexpectedResponseException":return new $.UnexpectedResponseException(ne.message,ne.status);case"UnknownErrorException":return new $.UnknownErrorException(ne.message,ne.details);default:return new $.UnknownErrorException(ne.message,ne.toString())}}class X{constructor(re,se,ie){Ye(this,G);Ye(this,Q);Ye(this,te);this.sourceName=re,this.targetName=se,this.comObj=ie,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=oe=>{const he=oe.data;if(he.targetName!==this.sourceName)return;if(he.stream){st(this,Q,rr).call(this,he);return}if(he.callback){const ae=he.callbackId,ue=this.callbackCapabilities[ae];if(!ue)throw new Error(`Cannot resolve callback ${ae}`);if(delete this.callbackCapabilities[ae],he.callback===j.DATA)ue.resolve(he.data);else if(he.callback===j.ERROR)ue.reject(V(he.reason));else throw new Error("Unexpected callback case");return}const le=this.actionHandler[he.action];if(!le)throw new Error(`Unknown action from worker: ${he.action}`);if(he.callbackId){const ae=this.sourceName,ue=he.sourceName;new Promise(function(me){me(le(he.data))}).then(function(me){ie.postMessage({sourceName:ae,targetName:ue,callback:j.DATA,callbackId:he.callbackId,data:me})},function(me){ie.postMessage({sourceName:ae,targetName:ue,callback:j.ERROR,callbackId:he.callbackId,reason:V(me)})});return}if(he.streamId){st(this,G,nr).call(this,he);return}le(he.data)},ie.addEventListener("message",this._onComObjOnMessage)}on(re,se){const ie=this.actionHandler;if(ie[re])throw new Error(`There is already an actionName called "${re}"`);ie[re]=se}send(re,se,ie){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:re,data:se},ie)}sendWithPromise(re,se,ie){const oe=this.callbackId++,he=new $.PromiseCapability;this.callbackCapabilities[oe]=he;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:re,callbackId:oe,data:se},ie)}catch(le){he.reject(le)}return he.promise}sendWithStream(re,se,ie,oe){const he=this.streamId++,le=this.sourceName,ae=this.targetName,ue=this.comObj;return new ReadableStream({start:me=>{const fe=new $.PromiseCapability;return this.streamControllers[he]={controller:me,startCall:fe,pullCall:null,cancelCall:null,isClosed:!1},ue.postMessage({sourceName:le,targetName:ae,action:re,streamId:he,data:se,desiredSize:me.desiredSize},oe),fe.promise},pull:me=>{const fe=new $.PromiseCapability;return this.streamControllers[he].pullCall=fe,ue.postMessage({sourceName:le,targetName:ae,stream:z.PULL,streamId:he,desiredSize:me.desiredSize}),fe.promise},cancel:me=>{(0,$.assert)(me instanceof Error,"cancel must have a valid reason");const fe=new $.PromiseCapability;return this.streamControllers[he].cancelCall=fe,this.streamControllers[he].isClosed=!0,ue.postMessage({sourceName:le,targetName:ae,stream:z.CANCEL,streamId:he,reason:V(me)}),fe.promise}},ie)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}G=new WeakSet,nr=function(re){const se=re.streamId,ie=this.sourceName,oe=re.sourceName,he=this.comObj,le=this,ae=this.actionHandler[re.action],ue={enqueue(me,fe=1,ce){if(this.isCancelled)return;const _e=this.desiredSize;this.desiredSize-=fe,_e>0&&this.desiredSize<=0&&(this.sinkCapability=new $.PromiseCapability,this.ready=this.sinkCapability.promise),he.postMessage({sourceName:ie,targetName:oe,stream:z.ENQUEUE,streamId:se,chunk:me},ce)},close(){this.isCancelled||(this.isCancelled=!0,he.postMessage({sourceName:ie,targetName:oe,stream:z.CLOSE,streamId:se}),delete le.streamSinks[se])},error(me){(0,$.assert)(me instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,he.postMessage({sourceName:ie,targetName:oe,stream:z.ERROR,streamId:se,reason:V(me)}))},sinkCapability:new $.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:re.desiredSize,ready:null};ue.sinkCapability.resolve(),ue.ready=ue.sinkCapability.promise,this.streamSinks[se]=ue,new Promise(function(me){me(ae(re.data,ue))}).then(function(){he.postMessage({sourceName:ie,targetName:oe,stream:z.START_COMPLETE,streamId:se,success:!0})},function(me){he.postMessage({sourceName:ie,targetName:oe,stream:z.START_COMPLETE,streamId:se,reason:V(me)})})},Q=new WeakSet,rr=function(re){const se=re.streamId,ie=this.sourceName,oe=re.sourceName,he=this.comObj,le=this.streamControllers[se],ae=this.streamSinks[se];switch(re.stream){case z.START_COMPLETE:re.success?le.startCall.resolve():le.startCall.reject(V(re.reason));break;case z.PULL_COMPLETE:re.success?le.pullCall.resolve():le.pullCall.reject(V(re.reason));break;case z.PULL:if(!ae){he.postMessage({sourceName:ie,targetName:oe,stream:z.PULL_COMPLETE,streamId:se,success:!0});break}ae.desiredSize<=0&&re.desiredSize>0&&ae.sinkCapability.resolve(),ae.desiredSize=re.desiredSize,new Promise(function(ue){var me;ue((me=ae.onPull)==null?void 0:me.call(ae))}).then(function(){he.postMessage({sourceName:ie,targetName:oe,stream:z.PULL_COMPLETE,streamId:se,success:!0})},function(ue){he.postMessage({sourceName:ie,targetName:oe,stream:z.PULL_COMPLETE,streamId:se,reason:V(ue)})});break;case z.ENQUEUE:if((0,$.assert)(le,"enqueue should have stream controller"),le.isClosed)break;le.controller.enqueue(re.chunk);break;case z.CLOSE:if((0,$.assert)(le,"close should have stream controller"),le.isClosed)break;le.isClosed=!0,le.controller.close(),st(this,te,un).call(this,le,se);break;case z.ERROR:(0,$.assert)(le,"error should have stream controller"),le.controller.error(V(re.reason)),st(this,te,un).call(this,le,se);break;case z.CANCEL_COMPLETE:re.success?le.cancelCall.resolve():le.cancelCall.reject(V(re.reason)),st(this,te,un).call(this,le,se);break;case z.CANCEL:if(!ae)break;new Promise(function(ue){var me;ue((me=ae.onCancel)==null?void 0:me.call(ae,V(re.reason)))}).then(function(){he.postMessage({sourceName:ie,targetName:oe,stream:z.CANCEL_COMPLETE,streamId:se,success:!0})},function(ue){he.postMessage({sourceName:ie,targetName:oe,stream:z.CANCEL_COMPLETE,streamId:se,reason:V(ue)})}),ae.sinkCapability.reject(V(re.reason)),ae.isCancelled=!0,delete this.streamSinks[se];break;default:throw new Error("Unexpected stream case")}},te=new WeakSet,un=async function(re,se){var ie,oe,he;await Promise.allSettled([(ie=re.startCall)==null?void 0:ie.promise,(oe=re.pullCall)==null?void 0:oe.promise,(he=re.cancelCall)==null?void 0:he.promise]),delete this.streamControllers[se]},_.MessageHandler=X},(q,_,M)=>{var z,V;Object.defineProperty(_,"__esModule",{value:!0}),_.Metadata=void 0;var $=M(1);class j{constructor({parsedData:G,rawData:Y}){Ye(this,z,void 0);Ye(this,V,void 0);ht(this,z,G),ht(this,V,Y)}getRaw(){return be(this,V)}get(G){return be(this,z).get(G)??null}getAll(){return(0,$.objectFromMap)(be(this,z))}has(G){return be(this,z).has(G)}}z=new WeakMap,V=new WeakMap,_.Metadata=j},(q,_,M)=>{var G,Y,Q,Z,te,ee,Cn;Object.defineProperty(_,"__esModule",{value:!0}),_.OptionalContentConfig=void 0;var $=M(1),j=M(8);const z=Symbol("INTERNAL");class V{constructor(se,ie){Ye(this,G,!0);this.name=se,this.intent=ie}get visible(){return be(this,G)}_setVisible(se,ie){se!==z&&(0,$.unreachable)("Internal method `_setVisible` called."),ht(this,G,ie)}}G=new WeakMap;class X{constructor(se){Ye(this,ee);Ye(this,Y,null);Ye(this,Q,new Map);Ye(this,Z,null);Ye(this,te,null);if(this.name=null,this.creator=null,se!==null){this.name=se.name,this.creator=se.creator,ht(this,te,se.order);for(const ie of se.groups)be(this,Q).set(ie.id,new V(ie.name,ie.intent));if(se.baseState==="OFF")for(const ie of be(this,Q).values())ie._setVisible(z,!1);for(const ie of se.on)be(this,Q).get(ie)._setVisible(z,!0);for(const ie of se.off)be(this,Q).get(ie)._setVisible(z,!1);ht(this,Z,this.getHash())}}isVisible(se){if(be(this,Q).size===0)return!0;if(!se)return(0,$.warn)("Optional content group not defined."),!0;if(se.type==="OCG")return be(this,Q).has(se.id)?be(this,Q).get(se.id).visible:((0,$.warn)(`Optional content group not found: ${se.id}`),!0);if(se.type==="OCMD"){if(se.expression)return st(this,ee,Cn).call(this,se.expression);if(!se.policy||se.policy==="AnyOn"){for(const ie of se.ids){if(!be(this,Q).has(ie))return(0,$.warn)(`Optional content group not found: ${ie}`),!0;if(be(this,Q).get(ie).visible)return!0}return!1}else if(se.policy==="AllOn"){for(const ie of se.ids){if(!be(this,Q).has(ie))return(0,$.warn)(`Optional content group not found: ${ie}`),!0;if(!be(this,Q).get(ie).visible)return!1}return!0}else if(se.policy==="AnyOff"){for(const ie of se.ids){if(!be(this,Q).has(ie))return(0,$.warn)(`Optional content group not found: ${ie}`),!0;if(!be(this,Q).get(ie).visible)return!0}return!1}else if(se.policy==="AllOff"){for(const ie of se.ids){if(!be(this,Q).has(ie))return(0,$.warn)(`Optional content group not found: ${ie}`),!0;if(be(this,Q).get(ie).visible)return!1}return!0}return(0,$.warn)(`Unknown optional content policy ${se.policy}.`),!0}return(0,$.warn)(`Unknown group type ${se.type}.`),!0}setVisibility(se,ie=!0){if(!be(this,Q).has(se)){(0,$.warn)(`Optional content group not found: ${se}`);return}be(this,Q).get(se)._setVisible(z,!!ie),ht(this,Y,null)}get hasInitialVisibility(){return this.getHash()===be(this,Z)}getOrder(){return be(this,Q).size?be(this,te)?be(this,te).slice():[...be(this,Q).keys()]:null}getGroups(){return be(this,Q).size>0?(0,$.objectFromMap)(be(this,Q)):null}getGroup(se){return be(this,Q).get(se)||null}getHash(){if(be(this,Y)!==null)return be(this,Y);const se=new j.MurmurHash3_64;for(const[ie,oe]of be(this,Q))se.update(`${ie}:${oe.visible}`);return ht(this,Y,se.hexdigest())}}Y=new WeakMap,Q=new WeakMap,Z=new WeakMap,te=new WeakMap,ee=new WeakSet,Cn=function(se){const ie=se.length;if(ie<2)return!0;const oe=se[0];for(let he=1;he<ie;he++){const le=se[he];let ae;if(Array.isArray(le))ae=st(this,ee,Cn).call(this,le);else if(be(this,Q).has(le))ae=be(this,Q).get(le).visible;else return(0,$.warn)(`Optional content group not found: ${le}`),!0;switch(oe){case"And":if(!ae)return!1;break;case"Or":if(ae)return!0;break;case"Not":return!ae;default:return!0}}return oe==="And"},_.OptionalContentConfig=X},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.PDFDataTransportStream=void 0;var $=M(1),j=M(6);class z{constructor({length:Y,initialData:Q,progressiveDone:Z=!1,contentDispositionFilename:te=null,disableRange:ee=!1,disableStream:ne=!1},re){if((0,$.assert)(re,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=Z,this._contentDispositionFilename=te,(Q==null?void 0:Q.length)>0){const se=Q instanceof Uint8Array&&Q.byteLength===Q.buffer.byteLength?Q.buffer:new Uint8Array(Q).buffer;this._queuedChunks.push(se)}this._pdfDataRangeTransport=re,this._isStreamingSupported=!ne,this._isRangeSupported=!ee,this._contentLength=Y,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((se,ie)=>{this._onReceiveData({begin:se,chunk:ie})}),this._pdfDataRangeTransport.addProgressListener((se,ie)=>{this._onProgress({loaded:se,total:ie})}),this._pdfDataRangeTransport.addProgressiveReadListener(se=>{this._onReceiveData({chunk:se})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:Y,chunk:Q}){const Z=Q instanceof Uint8Array&&Q.byteLength===Q.buffer.byteLength?Q.buffer:new Uint8Array(Q).buffer;if(Y===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(Z):this._queuedChunks.push(Z);else{const te=this._rangeReaders.some(function(ee){return ee._begin!==Y?!1:(ee._enqueue(Z),!0)});(0,$.assert)(te,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var Y;return((Y=this._fullRequestReader)==null?void 0:Y._loaded)??0}_onProgress(Y){var Q,Z,te,ee;Y.total===void 0?(Z=(Q=this._rangeReaders[0])==null?void 0:Q.onProgress)==null||Z.call(Q,{loaded:Y.loaded}):(ee=(te=this._fullRequestReader)==null?void 0:te.onProgress)==null||ee.call(te,{loaded:Y.loaded,total:Y.total})}_onProgressiveDone(){var Y;(Y=this._fullRequestReader)==null||Y.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(Y){const Q=this._rangeReaders.indexOf(Y);Q>=0&&this._rangeReaders.splice(Q,1)}getFullReader(){(0,$.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const Y=this._queuedChunks;return this._queuedChunks=null,new V(this,Y,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(Y,Q){if(Q<=this._progressiveDataLength)return null;const Z=new X(this,Y,Q);return this._pdfDataRangeTransport.requestDataRange(Y,Q),this._rangeReaders.push(Z),Z}cancelAllRequests(Y){var Q;(Q=this._fullRequestReader)==null||Q.cancel(Y);for(const Z of this._rangeReaders.slice(0))Z.cancel(Y);this._pdfDataRangeTransport.abort()}}_.PDFDataTransportStream=z;class V{constructor(Y,Q,Z=!1,te=null){this._stream=Y,this._done=Z||!1,this._filename=(0,j.isPdfFile)(te)?te:null,this._queuedChunks=Q||[],this._loaded=0;for(const ee of this._queuedChunks)this._loaded+=ee.byteLength;this._requests=[],this._headersReady=Promise.resolve(),Y._fullRequestReader=this,this.onProgress=null}_enqueue(Y){this._done||(this._requests.length>0?this._requests.shift().resolve({value:Y,done:!1}):this._queuedChunks.push(Y),this._loaded+=Y.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const Y=new $.PromiseCapability;return this._requests.push(Y),Y.promise}cancel(Y){this._done=!0;for(const Q of this._requests)Q.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class X{constructor(Y,Q,Z){this._stream=Y,this._begin=Q,this._end=Z,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(Y){if(!this._done){if(this._requests.length===0)this._queuedChunk=Y;else{this._requests.shift().resolve({value:Y,done:!1});for(const Z of this._requests)Z.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const Q=this._queuedChunk;return this._queuedChunk=null,{value:Q,done:!1}}if(this._done)return{value:void 0,done:!0};const Y=new $.PromiseCapability;return this._requests.push(Y),Y.promise}cancel(Y){this._done=!0;for(const Q of this._requests)Q.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.PDFFetchStream=void 0;var $=M(1),j=M(20);function z(Z,te,ee){return{method:"GET",headers:Z,signal:ee.signal,mode:"cors",credentials:te?"include":"same-origin",redirect:"follow"}}function V(Z){const te=new Headers;for(const ee in Z){const ne=Z[ee];ne!==void 0&&te.append(ee,ne)}return te}function X(Z){return Z instanceof Uint8Array?Z.buffer:Z instanceof ArrayBuffer?Z:((0,$.warn)(`getArrayBuffer - unexpected data format: ${Z}`),new Uint8Array(Z).buffer)}class G{constructor(te){this.source=te,this.isHttp=/^https?:/i.test(te.url),this.httpHeaders=this.isHttp&&te.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var te;return((te=this._fullRequestReader)==null?void 0:te._loaded)??0}getFullReader(){return(0,$.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Y(this),this._fullRequestReader}getRangeReader(te,ee){if(ee<=this._progressiveDataLength)return null;const ne=new Q(this,te,ee);return this._rangeRequestReaders.push(ne),ne}cancelAllRequests(te){var ee;(ee=this._fullRequestReader)==null||ee.cancel(te);for(const ne of this._rangeRequestReaders.slice(0))ne.cancel(te)}}_.PDFFetchStream=G;class Y{constructor(te){this._stream=te,this._reader=null,this._loaded=0,this._filename=null;const ee=te.source;this._withCredentials=ee.withCredentials||!1,this._contentLength=ee.length,this._headersCapability=new $.PromiseCapability,this._disableRange=ee.disableRange||!1,this._rangeChunkSize=ee.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!ee.disableStream,this._isRangeSupported=!ee.disableRange,this._headers=V(this._stream.httpHeaders);const ne=ee.url;fetch(ne,z(this._headers,this._withCredentials,this._abortController)).then(re=>{if(!(0,j.validateResponseStatus)(re.status))throw(0,j.createResponseStatusError)(re.status,ne);this._reader=re.body.getReader(),this._headersCapability.resolve();const se=he=>re.headers.get(he),{allowRangeRequests:ie,suggestedLength:oe}=(0,j.validateRangeRequestCapabilities)({getResponseHeader:se,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=ie,this._contentLength=oe||this._contentLength,this._filename=(0,j.extractFilenameFromHeader)(se),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new $.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var ne;await this._headersCapability.promise;const{value:te,done:ee}=await this._reader.read();return ee?{value:te,done:ee}:(this._loaded+=te.byteLength,(ne=this.onProgress)==null||ne.call(this,{loaded:this._loaded,total:this._contentLength}),{value:X(te),done:!1})}cancel(te){var ee;(ee=this._reader)==null||ee.cancel(te),this._abortController.abort()}}class Q{constructor(te,ee,ne){this._stream=te,this._reader=null,this._loaded=0;const re=te.source;this._withCredentials=re.withCredentials||!1,this._readCapability=new $.PromiseCapability,this._isStreamingSupported=!re.disableStream,this._abortController=new AbortController,this._headers=V(this._stream.httpHeaders),this._headers.append("Range",`bytes=${ee}-${ne-1}`);const se=re.url;fetch(se,z(this._headers,this._withCredentials,this._abortController)).then(ie=>{if(!(0,j.validateResponseStatus)(ie.status))throw(0,j.createResponseStatusError)(ie.status,se);this._readCapability.resolve(),this._reader=ie.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var ne;await this._readCapability.promise;const{value:te,done:ee}=await this._reader.read();return ee?{value:te,done:ee}:(this._loaded+=te.byteLength,(ne=this.onProgress)==null||ne.call(this,{loaded:this._loaded}),{value:X(te),done:!1})}cancel(te){var ee;(ee=this._reader)==null||ee.cancel(te),this._abortController.abort()}}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.createResponseStatusError=G,_.extractFilenameFromHeader=X,_.validateRangeRequestCapabilities=V,_.validateResponseStatus=Y;var $=M(1),j=M(21),z=M(6);function V({getResponseHeader:Q,isHttp:Z,rangeChunkSize:te,disableRange:ee}){const ne={allowRangeRequests:!1,suggestedLength:void 0},re=parseInt(Q("Content-Length"),10);return!Number.isInteger(re)||(ne.suggestedLength=re,re<=2*te)||ee||!Z||Q("Accept-Ranges")!=="bytes"||(Q("Content-Encoding")||"identity")!=="identity"||(ne.allowRangeRequests=!0),ne}function X(Q){const Z=Q("Content-Disposition");if(Z){let te=(0,j.getFilenameFromContentDispositionHeader)(Z);if(te.includes("%"))try{te=decodeURIComponent(te)}catch{}if((0,z.isPdfFile)(te))return te}return null}function G(Q,Z){return Q===404||Q===0&&Z.startsWith("file:")?new $.MissingPDFException('Missing PDF "'+Z+'".'):new $.UnexpectedResponseException(`Unexpected server response (${Q}) while retrieving PDF "${Z}".`,Q)}function Y(Q){return Q===200||Q===206}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.getFilenameFromContentDispositionHeader=j;var $=M(1);function j(z){let V=!0,X=G("filename\\*","i").exec(z);if(X){X=X[1];let re=te(X);return re=unescape(re),re=ee(re),re=ne(re),Q(re)}if(X=Z(z),X){const re=ne(X);return Q(re)}if(X=G("filename","i").exec(z),X){X=X[1];let re=te(X);return re=ne(re),Q(re)}function G(re,se){return new RegExp("(?:^|;)\\s*"+re+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',se)}function Y(re,se){if(re){if(!/^[\x00-\xFF]+$/.test(se))return se;try{const ie=new TextDecoder(re,{fatal:!0}),oe=(0,$.stringToBytes)(se);se=ie.decode(oe),V=!1}catch{}}return se}function Q(re){return V&&/[\x80-\xff]/.test(re)&&(re=Y("utf-8",re),V&&(re=Y("iso-8859-1",re))),re}function Z(re){const se=[];let ie;const oe=G("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(ie=oe.exec(re))!==null;){let[,le,ae,ue]=ie;if(le=parseInt(le,10),le in se){if(le===0)break;continue}se[le]=[ae,ue]}const he=[];for(let le=0;le<se.length&&le in se;++le){let[ae,ue]=se[le];ue=te(ue),ae&&(ue=unescape(ue),le===0&&(ue=ee(ue))),he.push(ue)}return he.join("")}function te(re){if(re.startsWith('"')){const se=re.slice(1).split('\\"');for(let ie=0;ie<se.length;++ie){const oe=se[ie].indexOf('"');oe!==-1&&(se[ie]=se[ie].slice(0,oe),se.length=ie+1),se[ie]=se[ie].replaceAll(/\\(.)/g,"$1")}re=se.join('"')}return re}function ee(re){const se=re.indexOf("'");if(se===-1)return re;const ie=re.slice(0,se),he=re.slice(se+1).replace(/^[^']*'/,"");return Y(ie,he)}function ne(re){return!re.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(re)?re:re.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(se,ie,oe,he){if(oe==="q"||oe==="Q")return he=he.replaceAll("_"," "),he=he.replaceAll(/=([0-9a-fA-F]{2})/g,function(le,ae){return String.fromCharCode(parseInt(ae,16))}),Y(ie,he);try{he=atob(he)}catch{}return Y(ie,he)})}return""}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.PDFNetworkStream=void 0;var $=M(1),j=M(20);const z=200,V=206;function X(te){const ee=te.response;return typeof ee!="string"?ee:(0,$.stringToBytes)(ee).buffer}class G{constructor(ee,ne={}){this.url=ee,this.isHttp=/^https?:/i.test(ee),this.httpHeaders=this.isHttp&&ne.httpHeaders||Object.create(null),this.withCredentials=ne.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(ee,ne,re){const se={begin:ee,end:ne};for(const ie in re)se[ie]=re[ie];return this.request(se)}requestFull(ee){return this.request(ee)}request(ee){const ne=new XMLHttpRequest,re=this.currXhrId++,se=this.pendingRequests[re]={xhr:ne};ne.open("GET",this.url),ne.withCredentials=this.withCredentials;for(const ie in this.httpHeaders){const oe=this.httpHeaders[ie];oe!==void 0&&ne.setRequestHeader(ie,oe)}return this.isHttp&&"begin"in ee&&"end"in ee?(ne.setRequestHeader("Range",`bytes=${ee.begin}-${ee.end-1}`),se.expectedStatus=V):se.expectedStatus=z,ne.responseType="arraybuffer",ee.onError&&(ne.onerror=function(ie){ee.onError(ne.status)}),ne.onreadystatechange=this.onStateChange.bind(this,re),ne.onprogress=this.onProgress.bind(this,re),se.onHeadersReceived=ee.onHeadersReceived,se.onDone=ee.onDone,se.onError=ee.onError,se.onProgress=ee.onProgress,ne.send(null),re}onProgress(ee,ne){var se;const re=this.pendingRequests[ee];re&&((se=re.onProgress)==null||se.call(re,ne))}onStateChange(ee,ne){var le,ae,ue;const re=this.pendingRequests[ee];if(!re)return;const se=re.xhr;if(se.readyState>=2&&re.onHeadersReceived&&(re.onHeadersReceived(),delete re.onHeadersReceived),se.readyState!==4||!(ee in this.pendingRequests))return;if(delete this.pendingRequests[ee],se.status===0&&this.isHttp){(le=re.onError)==null||le.call(re,se.status);return}const ie=se.status||z;if(!(ie===z&&re.expectedStatus===V)&&ie!==re.expectedStatus){(ae=re.onError)==null||ae.call(re,se.status);return}const he=X(se);if(ie===V){const me=se.getResponseHeader("Content-Range"),fe=/bytes (\d+)-(\d+)\/(\d+)/.exec(me);re.onDone({begin:parseInt(fe[1],10),chunk:he})}else he?re.onDone({begin:0,chunk:he}):(ue=re.onError)==null||ue.call(re,se.status)}getRequestXhr(ee){return this.pendingRequests[ee].xhr}isPendingRequest(ee){return ee in this.pendingRequests}abortRequest(ee){const ne=this.pendingRequests[ee].xhr;delete this.pendingRequests[ee],ne.abort()}}class Y{constructor(ee){this._source=ee,this._manager=new G(ee.url,{httpHeaders:ee.httpHeaders,withCredentials:ee.withCredentials}),this._rangeChunkSize=ee.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(ee){const ne=this._rangeRequestReaders.indexOf(ee);ne>=0&&this._rangeRequestReaders.splice(ne,1)}getFullReader(){return(0,$.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Q(this._manager,this._source),this._fullRequestReader}getRangeReader(ee,ne){const re=new Z(this._manager,ee,ne);return re.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(re),re}cancelAllRequests(ee){var ne;(ne=this._fullRequestReader)==null||ne.cancel(ee);for(const re of this._rangeRequestReaders.slice(0))re.cancel(ee)}}_.PDFNetworkStream=Y;class Q{constructor(ee,ne){this._manager=ee;const re={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=ne.url,this._fullRequestId=ee.requestFull(re),this._headersReceivedCapability=new $.PromiseCapability,this._disableRange=ne.disableRange||!1,this._contentLength=ne.length,this._rangeChunkSize=ne.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const ee=this._fullRequestId,ne=this._manager.getRequestXhr(ee),re=oe=>ne.getResponseHeader(oe),{allowRangeRequests:se,suggestedLength:ie}=(0,j.validateRangeRequestCapabilities)({getResponseHeader:re,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});se&&(this._isRangeSupported=!0),this._contentLength=ie||this._contentLength,this._filename=(0,j.extractFilenameFromHeader)(re),this._isRangeSupported&&this._manager.abortRequest(ee),this._headersReceivedCapability.resolve()}_onDone(ee){if(ee&&(this._requests.length>0?this._requests.shift().resolve({value:ee.chunk,done:!1}):this._cachedChunks.push(ee.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const ne of this._requests)ne.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(ee){this._storedError=(0,j.createResponseStatusError)(ee,this._url),this._headersReceivedCapability.reject(this._storedError);for(const ne of this._requests)ne.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(ee){var ne;(ne=this.onProgress)==null||ne.call(this,{loaded:ee.loaded,total:ee.lengthComputable?ee.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const ee=new $.PromiseCapability;return this._requests.push(ee),ee.promise}cancel(ee){this._done=!0,this._headersReceivedCapability.reject(ee);for(const ne of this._requests)ne.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Z{constructor(ee,ne,re){this._manager=ee;const se={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=ee.url,this._requestId=ee.requestRange(ne,re,se),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var ee;(ee=this.onClosed)==null||ee.call(this,this)}_onDone(ee){const ne=ee.chunk;this._requests.length>0?this._requests.shift().resolve({value:ne,done:!1}):this._queuedChunk=ne,this._done=!0;for(const re of this._requests)re.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(ee){this._storedError=(0,j.createResponseStatusError)(ee,this._url);for(const ne of this._requests)ne.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(ee){var ne;this.isStreamingSupported||(ne=this.onProgress)==null||ne.call(this,{loaded:ee.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const ne=this._queuedChunk;return this._queuedChunk=null,{value:ne,done:!1}}if(this._done)return{value:void 0,done:!0};const ee=new $.PromiseCapability;return this._requests.push(ee),ee.promise}cancel(ee){this._done=!0;for(const ne of this._requests)ne.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.PDFNodeStream=void 0;var $=M(1),j=M(20);const z=/^file:\/\/\/[a-zA-Z]:\//;function V(re){const se=require$$5,ie=se.parse(re);return ie.protocol==="file:"||ie.host?ie:/^[a-z]:[/\\]/i.test(re)?se.parse(`file:///${re}`):(ie.host||(ie.protocol="file:"),ie)}class X{constructor(se){this.source=se,this.url=V(se.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&se.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var se;return((se=this._fullRequestReader)==null?void 0:se._loaded)??0}getFullReader(){return(0,$.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new ee(this):new Z(this),this._fullRequestReader}getRangeReader(se,ie){if(ie<=this._progressiveDataLength)return null;const oe=this.isFsUrl?new ne(this,se,ie):new te(this,se,ie);return this._rangeRequestReaders.push(oe),oe}cancelAllRequests(se){var ie;(ie=this._fullRequestReader)==null||ie.cancel(se);for(const oe of this._rangeRequestReaders.slice(0))oe.cancel(se)}}_.PDFNodeStream=X;class G{constructor(se){this._url=se.url,this._done=!1,this._storedError=null,this.onProgress=null;const ie=se.source;this._contentLength=ie.length,this._loaded=0,this._filename=null,this._disableRange=ie.disableRange||!1,this._rangeChunkSize=ie.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!ie.disableStream,this._isRangeSupported=!ie.disableRange,this._readableStream=null,this._readCapability=new $.PromiseCapability,this._headersCapability=new $.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var oe;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const se=this._readableStream.read();return se===null?(this._readCapability=new $.PromiseCapability,this.read()):(this._loaded+=se.length,(oe=this.onProgress)==null||oe.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(se).buffer,done:!1})}cancel(se){if(!this._readableStream){this._error(se);return}this._readableStream.destroy(se)}_error(se){this._storedError=se,this._readCapability.resolve()}_setReadableStream(se){this._readableStream=se,se.on("readable",()=>{this._readCapability.resolve()}),se.on("end",()=>{se.destroy(),this._done=!0,this._readCapability.resolve()}),se.on("error",ie=>{this._error(ie)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new $.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Y{constructor(se){this._url=se.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new $.PromiseCapability;const ie=se.source;this._isStreamingSupported=!ie.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var oe;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const se=this._readableStream.read();return se===null?(this._readCapability=new $.PromiseCapability,this.read()):(this._loaded+=se.length,(oe=this.onProgress)==null||oe.call(this,{loaded:this._loaded}),{value:new Uint8Array(se).buffer,done:!1})}cancel(se){if(!this._readableStream){this._error(se);return}this._readableStream.destroy(se)}_error(se){this._storedError=se,this._readCapability.resolve()}_setReadableStream(se){this._readableStream=se,se.on("readable",()=>{this._readCapability.resolve()}),se.on("end",()=>{se.destroy(),this._done=!0,this._readCapability.resolve()}),se.on("error",ie=>{this._error(ie)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function Q(re,se){return{protocol:re.protocol,auth:re.auth,host:re.hostname,port:re.port,path:re.path,method:"GET",headers:se}}class Z extends G{constructor(se){super(se);const ie=oe=>{if(oe.statusCode===404){const ue=new $.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=ue,this._headersCapability.reject(ue);return}this._headersCapability.resolve(),this._setReadableStream(oe);const he=ue=>this._readableStream.headers[ue.toLowerCase()],{allowRangeRequests:le,suggestedLength:ae}=(0,j.validateRangeRequestCapabilities)({getResponseHeader:he,isHttp:se.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=le,this._contentLength=ae||this._contentLength,this._filename=(0,j.extractFilenameFromHeader)(he)};if(this._request=null,this._url.protocol==="http:"){const oe=require$$5;this._request=oe.request(Q(this._url,se.httpHeaders),ie)}else{const oe=require$$5;this._request=oe.request(Q(this._url,se.httpHeaders),ie)}this._request.on("error",oe=>{this._storedError=oe,this._headersCapability.reject(oe)}),this._request.end()}}class te extends Y{constructor(se,ie,oe){super(se),this._httpHeaders={};for(const le in se.httpHeaders){const ae=se.httpHeaders[le];ae!==void 0&&(this._httpHeaders[le]=ae)}this._httpHeaders.Range=`bytes=${ie}-${oe-1}`;const he=le=>{if(le.statusCode===404){const ae=new $.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=ae;return}this._setReadableStream(le)};if(this._request=null,this._url.protocol==="http:"){const le=require$$5;this._request=le.request(Q(this._url,this._httpHeaders),he)}else{const le=require$$5;this._request=le.request(Q(this._url,this._httpHeaders),he)}this._request.on("error",le=>{this._storedError=le}),this._request.end()}}class ee extends G{constructor(se){super(se);let ie=decodeURIComponent(this._url.path);z.test(this._url.href)&&(ie=ie.replace(/^\//,""));const oe=require$$5;oe.lstat(ie,(he,le)=>{if(he){he.code==="ENOENT"&&(he=new $.MissingPDFException(`Missing PDF "${ie}".`)),this._storedError=he,this._headersCapability.reject(he);return}this._contentLength=le.size,this._setReadableStream(oe.createReadStream(ie)),this._headersCapability.resolve()})}}class ne extends Y{constructor(se,ie,oe){super(se);let he=decodeURIComponent(this._url.path);z.test(this._url.href)&&(he=he.replace(/^\//,""));const le=require$$5;this._setReadableStream(le.createReadStream(he,{start:ie,end:oe-1}))}}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.SVGGraphics=void 0;var $=M(6),j=M(1);const z={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},V="http://www.w3.org/XML/1998/namespace",X="http://www.w3.org/1999/xlink",G=["butt","round","square"],Y=["miter","round","bevel"],Q=function(le,ae="",ue=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!ue)return URL.createObjectURL(new Blob([le],{type:ae}));const me="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let fe=`data:${ae};base64,`;for(let ce=0,_e=le.length;ce<_e;ce+=3){const we=le[ce]&255,ge=le[ce+1]&255,Ae=le[ce+2]&255,de=we>>2,De=(we&3)<<4|ge>>4,Me=ce+1<_e?(ge&15)<<2|Ae>>6:64,Ee=ce+2<_e?Ae&63:64;fe+=me[de]+me[De]+me[Me]+me[Ee]}return fe},Z=function(){const le=new Uint8Array([137,80,78,71,13,10,26,10]),ae=12,ue=new Int32Array(256);for(let Ae=0;Ae<256;Ae++){let de=Ae;for(let De=0;De<8;De++)de=de&1?3988292384^de>>1&2147483647:de>>1&2147483647;ue[Ae]=de}function me(Ae,de,De){let Me=-1;for(let Ee=de;Ee<De;Ee++){const Te=(Me^Ae[Ee])&255,xe=ue[Te];Me=Me>>>8^xe}return Me^-1}function fe(Ae,de,De,Me){let Ee=Me;const Te=de.length;De[Ee]=Te>>24&255,De[Ee+1]=Te>>16&255,De[Ee+2]=Te>>8&255,De[Ee+3]=Te&255,Ee+=4,De[Ee]=Ae.charCodeAt(0)&255,De[Ee+1]=Ae.charCodeAt(1)&255,De[Ee+2]=Ae.charCodeAt(2)&255,De[Ee+3]=Ae.charCodeAt(3)&255,Ee+=4,De.set(de,Ee),Ee+=de.length;const xe=me(De,Me+4,Ee);De[Ee]=xe>>24&255,De[Ee+1]=xe>>16&255,De[Ee+2]=xe>>8&255,De[Ee+3]=xe&255}function ce(Ae,de,De){let Me=1,Ee=0;for(let Te=de;Te<De;++Te)Me=(Me+(Ae[Te]&255))%65521,Ee=(Ee+Me)%65521;return Ee<<16|Me}function _e(Ae){if(!j.isNodeJS)return we(Ae);try{const de=parseInt(process.versions.node)>=8?Ae:Buffer.from(Ae),De=require$$5.deflateSync(de,{level:9});return De instanceof Uint8Array?De:new Uint8Array(De)}catch(de){(0,j.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+de)}return we(Ae)}function we(Ae){let de=Ae.length;const De=65535,Me=Math.ceil(de/De),Ee=new Uint8Array(2+de+Me*5+4);let Te=0;Ee[Te++]=120,Ee[Te++]=156;let xe=0;for(;de>De;)Ee[Te++]=0,Ee[Te++]=255,Ee[Te++]=255,Ee[Te++]=0,Ee[Te++]=0,Ee.set(Ae.subarray(xe,xe+De),Te),Te+=De,xe+=De,de-=De;Ee[Te++]=1,Ee[Te++]=de&255,Ee[Te++]=de>>8&255,Ee[Te++]=~de&65535&255,Ee[Te++]=(~de&65535)>>8&255,Ee.set(Ae.subarray(xe),Te),Te+=Ae.length-xe;const He=ce(Ae,0,Ae.length);return Ee[Te++]=He>>24&255,Ee[Te++]=He>>16&255,Ee[Te++]=He>>8&255,Ee[Te++]=He&255,Ee}function ge(Ae,de,De,Me){const Ee=Ae.width,Te=Ae.height;let xe,He,Oe;const $e=Ae.data;switch(de){case j.ImageKind.GRAYSCALE_1BPP:He=0,xe=1,Oe=Ee+7>>3;break;case j.ImageKind.RGB_24BPP:He=2,xe=8,Oe=Ee*3;break;case j.ImageKind.RGBA_32BPP:He=6,xe=8,Oe=Ee*4;break;default:throw new Error("invalid format")}const Pe=new Uint8Array((1+Oe)*Te);let ve=0,ye=0;for(let Ze=0;Ze<Te;++Ze)Pe[ve++]=0,Pe.set($e.subarray(ye,ye+Oe),ve),ye+=Oe,ve+=Oe;if(de===j.ImageKind.GRAYSCALE_1BPP&&Me){ve=0;for(let Ze=0;Ze<Te;Ze++){ve++;for(let ut=0;ut<Oe;ut++)Pe[ve++]^=255}}const Fe=new Uint8Array([Ee>>24&255,Ee>>16&255,Ee>>8&255,Ee&255,Te>>24&255,Te>>16&255,Te>>8&255,Te&255,xe,He,0,0,0]),je=_e(Pe),Be=le.length+ae*3+Fe.length+je.length,Ne=new Uint8Array(Be);let ze=0;return Ne.set(le,ze),ze+=le.length,fe("IHDR",Fe,Ne,ze),ze+=ae+Fe.length,fe("IDATA",je,Ne,ze),ze+=ae+je.length,fe("IEND",new Uint8Array(0),Ne,ze),Q(Ne,"image/png",De)}return function(de,De,Me){const Ee=de.kind===void 0?j.ImageKind.GRAYSCALE_1BPP:de.kind;return ge(de,Ee,De,Me)}}();class te{constructor(){this.fontSizeScale=1,this.fontWeight=z.fontWeight,this.fontSize=0,this.textMatrix=j.IDENTITY_MATRIX,this.fontMatrix=j.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=j.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=z.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(ae,ue){this.x=ae,this.y=ue}}function ee(le){let ae=[];const ue=[];for(const me of le){if(me.fn==="save"){ae.push({fnId:92,fn:"group",items:[]}),ue.push(ae),ae=ae.at(-1).items;continue}me.fn==="restore"?ae=ue.pop():ae.push(me)}return ae}function ne(le){if(Number.isInteger(le))return le.toString();const ae=le.toFixed(10);let ue=ae.length-1;if(ae[ue]!=="0")return ae;do ue--;while(ae[ue]==="0");return ae.substring(0,ae[ue]==="."?ue:ue+1)}function re(le){if(le[4]===0&&le[5]===0){if(le[1]===0&&le[2]===0)return le[0]===1&&le[3]===1?"":`scale(${ne(le[0])} ${ne(le[3])})`;if(le[0]===le[3]&&le[1]===-le[2]){const ae=Math.acos(le[0])*180/Math.PI;return`rotate(${ne(ae)})`}}else if(le[0]===1&&le[1]===0&&le[2]===0&&le[3]===1)return`translate(${ne(le[4])} ${ne(le[5])})`;return`matrix(${ne(le[0])} ${ne(le[1])} ${ne(le[2])} ${ne(le[3])} ${ne(le[4])} ${ne(le[5])})`}let se=0,ie=0,oe=0;class he{constructor(ae,ue,me=!1){(0,$.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new $.DOMSVGFactory,this.current=new te,this.transformMatrix=j.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=ae,this.objs=ue,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!me,this._operatorIdMapping=[];for(const fe in j.OPS)this._operatorIdMapping[j.OPS[fe]]=fe}getObject(ae,ue=null){return typeof ae=="string"?ae.startsWith("g_")?this.commonObjs.get(ae):this.objs.get(ae):ue}save(){this.transformStack.push(this.transformMatrix);const ae=this.current;this.extraStack.push(ae),this.current=ae.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(ae){this.save(),this.executeOpTree(ae),this.restore()}loadDependencies(ae){const ue=ae.fnArray,me=ae.argsArray;for(let fe=0,ce=ue.length;fe<ce;fe++)if(ue[fe]===j.OPS.dependency)for(const _e of me[fe]){const we=_e.startsWith("g_")?this.commonObjs:this.objs,ge=new Promise(Ae=>{we.get(_e,Ae)});this.current.dependencies.push(ge)}return Promise.all(this.current.dependencies)}transform(ae,ue,me,fe,ce,_e){const we=[ae,ue,me,fe,ce,_e];this.transformMatrix=j.Util.transform(this.transformMatrix,we),this.tgrp=null}getSVG(ae,ue){this.viewport=ue;const me=this._initialize(ue);return this.loadDependencies(ae).then(()=>(this.transformMatrix=j.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(ae)),me))}convertOpList(ae){const ue=this._operatorIdMapping,me=ae.argsArray,fe=ae.fnArray,ce=[];for(let _e=0,we=fe.length;_e<we;_e++){const ge=fe[_e];ce.push({fnId:ge,fn:ue[ge],args:me[_e]})}return ee(ce)}executeOpTree(ae){for(const ue of ae){const me=ue.fn,fe=ue.fnId,ce=ue.args;switch(fe|0){case j.OPS.beginText:this.beginText();break;case j.OPS.dependency:break;case j.OPS.setLeading:this.setLeading(ce);break;case j.OPS.setLeadingMoveText:this.setLeadingMoveText(ce[0],ce[1]);break;case j.OPS.setFont:this.setFont(ce);break;case j.OPS.showText:this.showText(ce[0]);break;case j.OPS.showSpacedText:this.showText(ce[0]);break;case j.OPS.endText:this.endText();break;case j.OPS.moveText:this.moveText(ce[0],ce[1]);break;case j.OPS.setCharSpacing:this.setCharSpacing(ce[0]);break;case j.OPS.setWordSpacing:this.setWordSpacing(ce[0]);break;case j.OPS.setHScale:this.setHScale(ce[0]);break;case j.OPS.setTextMatrix:this.setTextMatrix(ce[0],ce[1],ce[2],ce[3],ce[4],ce[5]);break;case j.OPS.setTextRise:this.setTextRise(ce[0]);break;case j.OPS.setTextRenderingMode:this.setTextRenderingMode(ce[0]);break;case j.OPS.setLineWidth:this.setLineWidth(ce[0]);break;case j.OPS.setLineJoin:this.setLineJoin(ce[0]);break;case j.OPS.setLineCap:this.setLineCap(ce[0]);break;case j.OPS.setMiterLimit:this.setMiterLimit(ce[0]);break;case j.OPS.setFillRGBColor:this.setFillRGBColor(ce[0],ce[1],ce[2]);break;case j.OPS.setStrokeRGBColor:this.setStrokeRGBColor(ce[0],ce[1],ce[2]);break;case j.OPS.setStrokeColorN:this.setStrokeColorN(ce);break;case j.OPS.setFillColorN:this.setFillColorN(ce);break;case j.OPS.shadingFill:this.shadingFill(ce[0]);break;case j.OPS.setDash:this.setDash(ce[0],ce[1]);break;case j.OPS.setRenderingIntent:this.setRenderingIntent(ce[0]);break;case j.OPS.setFlatness:this.setFlatness(ce[0]);break;case j.OPS.setGState:this.setGState(ce[0]);break;case j.OPS.fill:this.fill();break;case j.OPS.eoFill:this.eoFill();break;case j.OPS.stroke:this.stroke();break;case j.OPS.fillStroke:this.fillStroke();break;case j.OPS.eoFillStroke:this.eoFillStroke();break;case j.OPS.clip:this.clip("nonzero");break;case j.OPS.eoClip:this.clip("evenodd");break;case j.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case j.OPS.paintImageXObject:this.paintImageXObject(ce[0]);break;case j.OPS.paintInlineImageXObject:this.paintInlineImageXObject(ce[0]);break;case j.OPS.paintImageMaskXObject:this.paintImageMaskXObject(ce[0]);break;case j.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(ce[0],ce[1]);break;case j.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case j.OPS.closePath:this.closePath();break;case j.OPS.closeStroke:this.closeStroke();break;case j.OPS.closeFillStroke:this.closeFillStroke();break;case j.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case j.OPS.nextLine:this.nextLine();break;case j.OPS.transform:this.transform(ce[0],ce[1],ce[2],ce[3],ce[4],ce[5]);break;case j.OPS.constructPath:this.constructPath(ce[0],ce[1]);break;case j.OPS.endPath:this.endPath();break;case 92:this.group(ue.items);break;default:(0,j.warn)(`Unimplemented operator ${me}`);break}}}setWordSpacing(ae){this.current.wordSpacing=ae}setCharSpacing(ae){this.current.charSpacing=ae}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(ae,ue,me,fe,ce,_e){const we=this.current;we.textMatrix=we.lineMatrix=[ae,ue,me,fe,ce,_e],we.textMatrixScale=Math.hypot(ae,ue),we.x=we.lineX=0,we.y=we.lineY=0,we.xcoords=[],we.ycoords=[],we.tspan=this.svgFactory.createElement("svg:tspan"),we.tspan.setAttributeNS(null,"font-family",we.fontFamily),we.tspan.setAttributeNS(null,"font-size",`${ne(we.fontSize)}px`),we.tspan.setAttributeNS(null,"y",ne(-we.y)),we.txtElement=this.svgFactory.createElement("svg:text"),we.txtElement.append(we.tspan)}beginText(){const ae=this.current;ae.x=ae.lineX=0,ae.y=ae.lineY=0,ae.textMatrix=j.IDENTITY_MATRIX,ae.lineMatrix=j.IDENTITY_MATRIX,ae.textMatrixScale=1,ae.tspan=this.svgFactory.createElement("svg:tspan"),ae.txtElement=this.svgFactory.createElement("svg:text"),ae.txtgrp=this.svgFactory.createElement("svg:g"),ae.xcoords=[],ae.ycoords=[]}moveText(ae,ue){const me=this.current;me.x=me.lineX+=ae,me.y=me.lineY+=ue,me.xcoords=[],me.ycoords=[],me.tspan=this.svgFactory.createElement("svg:tspan"),me.tspan.setAttributeNS(null,"font-family",me.fontFamily),me.tspan.setAttributeNS(null,"font-size",`${ne(me.fontSize)}px`),me.tspan.setAttributeNS(null,"y",ne(-me.y))}showText(ae){const ue=this.current,me=ue.font,fe=ue.fontSize;if(fe===0)return;const ce=ue.fontSizeScale,_e=ue.charSpacing,we=ue.wordSpacing,ge=ue.fontDirection,Ae=ue.textHScale*ge,de=me.vertical,De=de?1:-1,Me=me.defaultVMetrics,Ee=fe*ue.fontMatrix[0];let Te=0;for(const Oe of ae){if(Oe===null){Te+=ge*we;continue}else if(typeof Oe=="number"){Te+=De*Oe*fe/1e3;continue}const $e=(Oe.isSpace?we:0)+_e,Pe=Oe.fontChar;let ve,ye,Fe=Oe.width;if(de){let Be;const Ne=Oe.vmetric||Me;Be=Oe.vmetric?Ne[1]:Fe*.5,Be=-Be*Ee;const ze=Ne[2]*Ee;Fe=Ne?-Ne[0]:Fe,ve=Be/ce,ye=(Te+ze)/ce}else ve=Te/ce,ye=0;(Oe.isInFont||me.missingFile)&&(ue.xcoords.push(ue.x+ve),de&&ue.ycoords.push(-ue.y+ye),ue.tspan.textContent+=Pe);const je=de?Fe*Ee-$e*ge:Fe*Ee+$e*ge;Te+=je}ue.tspan.setAttributeNS(null,"x",ue.xcoords.map(ne).join(" ")),de?ue.tspan.setAttributeNS(null,"y",ue.ycoords.map(ne).join(" ")):ue.tspan.setAttributeNS(null,"y",ne(-ue.y)),de?ue.y-=Te:ue.x+=Te*Ae,ue.tspan.setAttributeNS(null,"font-family",ue.fontFamily),ue.tspan.setAttributeNS(null,"font-size",`${ne(ue.fontSize)}px`),ue.fontStyle!==z.fontStyle&&ue.tspan.setAttributeNS(null,"font-style",ue.fontStyle),ue.fontWeight!==z.fontWeight&&ue.tspan.setAttributeNS(null,"font-weight",ue.fontWeight);const xe=ue.textRenderingMode&j.TextRenderingMode.FILL_STROKE_MASK;if(xe===j.TextRenderingMode.FILL||xe===j.TextRenderingMode.FILL_STROKE?(ue.fillColor!==z.fillColor&&ue.tspan.setAttributeNS(null,"fill",ue.fillColor),ue.fillAlpha<1&&ue.tspan.setAttributeNS(null,"fill-opacity",ue.fillAlpha)):ue.textRenderingMode===j.TextRenderingMode.ADD_TO_PATH?ue.tspan.setAttributeNS(null,"fill","transparent"):ue.tspan.setAttributeNS(null,"fill","none"),xe===j.TextRenderingMode.STROKE||xe===j.TextRenderingMode.FILL_STROKE){const Oe=1/(ue.textMatrixScale||1);this._setStrokeAttributes(ue.tspan,Oe)}let He=ue.textMatrix;ue.textRise!==0&&(He=He.slice(),He[5]+=ue.textRise),ue.txtElement.setAttributeNS(null,"transform",`${re(He)} scale(${ne(Ae)}, -1)`),ue.txtElement.setAttributeNS(V,"xml:space","preserve"),ue.txtElement.append(ue.tspan),ue.txtgrp.append(ue.txtElement),this._ensureTransformGroup().append(ue.txtElement)}setLeadingMoveText(ae,ue){this.setLeading(-ue),this.moveText(ae,ue)}addFontStyle(ae){if(!ae.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const ue=Q(ae.data,ae.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${ae.loadedName}"; src: url(${ue}); }
`}setFont(ae){const ue=this.current,me=this.commonObjs.get(ae[0]);let fe=ae[1];ue.font=me,this.embedFonts&&!me.missingFile&&!this.embeddedFonts[me.loadedName]&&(this.addFontStyle(me),this.embeddedFonts[me.loadedName]=me),ue.fontMatrix=me.fontMatrix||j.FONT_IDENTITY_MATRIX;let ce="normal";me.black?ce="900":me.bold&&(ce="bold");const _e=me.italic?"italic":"normal";fe<0?(fe=-fe,ue.fontDirection=-1):ue.fontDirection=1,ue.fontSize=fe,ue.fontFamily=me.loadedName,ue.fontWeight=ce,ue.fontStyle=_e,ue.tspan=this.svgFactory.createElement("svg:tspan"),ue.tspan.setAttributeNS(null,"y",ne(-ue.y)),ue.xcoords=[],ue.ycoords=[]}endText(){var ue;const ae=this.current;ae.textRenderingMode&j.TextRenderingMode.ADD_TO_PATH_FLAG&&((ue=ae.txtElement)!=null&&ue.hasChildNodes())&&(ae.element=ae.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(ae){ae>0&&(this.current.lineWidth=ae)}setLineCap(ae){this.current.lineCap=G[ae]}setLineJoin(ae){this.current.lineJoin=Y[ae]}setMiterLimit(ae){this.current.miterLimit=ae}setStrokeAlpha(ae){this.current.strokeAlpha=ae}setStrokeRGBColor(ae,ue,me){this.current.strokeColor=j.Util.makeHexColor(ae,ue,me)}setFillAlpha(ae){this.current.fillAlpha=ae}setFillRGBColor(ae,ue,me){this.current.fillColor=j.Util.makeHexColor(ae,ue,me),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(ae){this.current.strokeColor=this._makeColorN_Pattern(ae)}setFillColorN(ae){this.current.fillColor=this._makeColorN_Pattern(ae)}shadingFill(ae){const{width:ue,height:me}=this.viewport,fe=j.Util.inverseTransform(this.transformMatrix),[ce,_e,we,ge]=j.Util.getAxialAlignedBoundingBox([0,0,ue,me],fe),Ae=this.svgFactory.createElement("svg:rect");Ae.setAttributeNS(null,"x",ce),Ae.setAttributeNS(null,"y",_e),Ae.setAttributeNS(null,"width",we-ce),Ae.setAttributeNS(null,"height",ge-_e),Ae.setAttributeNS(null,"fill",this._makeShadingPattern(ae)),this.current.fillAlpha<1&&Ae.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(Ae)}_makeColorN_Pattern(ae){return ae[0]==="TilingPattern"?this._makeTilingPattern(ae):this._makeShadingPattern(ae)}_makeTilingPattern(ae){const ue=ae[1],me=ae[2],fe=ae[3]||j.IDENTITY_MATRIX,[ce,_e,we,ge]=ae[4],Ae=ae[5],de=ae[6],De=ae[7],Me=`shading${oe++}`,[Ee,Te,xe,He]=j.Util.normalizeRect([...j.Util.applyTransform([ce,_e],fe),...j.Util.applyTransform([we,ge],fe)]),[Oe,$e]=j.Util.singularValueDecompose2dScale(fe),Pe=Ae*Oe,ve=de*$e,ye=this.svgFactory.createElement("svg:pattern");ye.setAttributeNS(null,"id",Me),ye.setAttributeNS(null,"patternUnits","userSpaceOnUse"),ye.setAttributeNS(null,"width",Pe),ye.setAttributeNS(null,"height",ve),ye.setAttributeNS(null,"x",`${Ee}`),ye.setAttributeNS(null,"y",`${Te}`);const Fe=this.svg,je=this.transformMatrix,Be=this.current.fillColor,Ne=this.current.strokeColor,ze=this.svgFactory.create(xe-Ee,He-Te);if(this.svg=ze,this.transformMatrix=fe,De===2){const Ze=j.Util.makeHexColor(...ue);this.current.fillColor=Ze,this.current.strokeColor=Ze}return this.executeOpTree(this.convertOpList(me)),this.svg=Fe,this.transformMatrix=je,this.current.fillColor=Be,this.current.strokeColor=Ne,ye.append(ze.childNodes[0]),this.defs.append(ye),`url(#${Me})`}_makeShadingPattern(ae){switch(typeof ae=="string"&&(ae=this.objs.get(ae)),ae[0]){case"RadialAxial":const ue=`shading${oe++}`,me=ae[3];let fe;switch(ae[1]){case"axial":const ce=ae[4],_e=ae[5];fe=this.svgFactory.createElement("svg:linearGradient"),fe.setAttributeNS(null,"id",ue),fe.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),fe.setAttributeNS(null,"x1",ce[0]),fe.setAttributeNS(null,"y1",ce[1]),fe.setAttributeNS(null,"x2",_e[0]),fe.setAttributeNS(null,"y2",_e[1]);break;case"radial":const we=ae[4],ge=ae[5],Ae=ae[6],de=ae[7];fe=this.svgFactory.createElement("svg:radialGradient"),fe.setAttributeNS(null,"id",ue),fe.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),fe.setAttributeNS(null,"cx",ge[0]),fe.setAttributeNS(null,"cy",ge[1]),fe.setAttributeNS(null,"r",de),fe.setAttributeNS(null,"fx",we[0]),fe.setAttributeNS(null,"fy",we[1]),fe.setAttributeNS(null,"fr",Ae);break;default:throw new Error(`Unknown RadialAxial type: ${ae[1]}`)}for(const ce of me){const _e=this.svgFactory.createElement("svg:stop");_e.setAttributeNS(null,"offset",ce[0]),_e.setAttributeNS(null,"stop-color",ce[1]),fe.append(_e)}return this.defs.append(fe),`url(#${ue})`;case"Mesh":return(0,j.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${ae[0]}`)}}setDash(ae,ue){this.current.dashArray=ae,this.current.dashPhase=ue}constructPath(ae,ue){const me=this.current;let fe=me.x,ce=me.y,_e=[],we=0;for(const ge of ae)switch(ge|0){case j.OPS.rectangle:fe=ue[we++],ce=ue[we++];const Ae=ue[we++],de=ue[we++],De=fe+Ae,Me=ce+de;_e.push("M",ne(fe),ne(ce),"L",ne(De),ne(ce),"L",ne(De),ne(Me),"L",ne(fe),ne(Me),"Z");break;case j.OPS.moveTo:fe=ue[we++],ce=ue[we++],_e.push("M",ne(fe),ne(ce));break;case j.OPS.lineTo:fe=ue[we++],ce=ue[we++],_e.push("L",ne(fe),ne(ce));break;case j.OPS.curveTo:fe=ue[we+4],ce=ue[we+5],_e.push("C",ne(ue[we]),ne(ue[we+1]),ne(ue[we+2]),ne(ue[we+3]),ne(fe),ne(ce)),we+=6;break;case j.OPS.curveTo2:_e.push("C",ne(fe),ne(ce),ne(ue[we]),ne(ue[we+1]),ne(ue[we+2]),ne(ue[we+3])),fe=ue[we+2],ce=ue[we+3],we+=4;break;case j.OPS.curveTo3:fe=ue[we+2],ce=ue[we+3],_e.push("C",ne(ue[we]),ne(ue[we+1]),ne(fe),ne(ce),ne(fe),ne(ce)),we+=4;break;case j.OPS.closePath:_e.push("Z");break}_e=_e.join(" "),me.path&&ae.length>0&&ae[0]!==j.OPS.rectangle&&ae[0]!==j.OPS.moveTo?_e=me.path.getAttributeNS(null,"d")+_e:(me.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(me.path)),me.path.setAttributeNS(null,"d",_e),me.path.setAttributeNS(null,"fill","none"),me.element=me.path,me.setCurrentPoint(fe,ce)}endPath(){const ae=this.current;if(ae.path=null,!this.pendingClip)return;if(!ae.element){this.pendingClip=null;return}const ue=`clippath${se++}`,me=this.svgFactory.createElement("svg:clipPath");me.setAttributeNS(null,"id",ue),me.setAttributeNS(null,"transform",re(this.transformMatrix));const fe=ae.element.cloneNode(!0);if(this.pendingClip==="evenodd"?fe.setAttributeNS(null,"clip-rule","evenodd"):fe.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,me.append(fe),this.defs.append(me),ae.activeClipUrl){ae.clipGroup=null;for(const ce of this.extraStack)ce.clipGroup=null;me.setAttributeNS(null,"clip-path",ae.activeClipUrl)}ae.activeClipUrl=`url(#${ue})`,this.tgrp=null}clip(ae){this.pendingClip=ae}closePath(){const ae=this.current;if(ae.path){const ue=`${ae.path.getAttributeNS(null,"d")}Z`;ae.path.setAttributeNS(null,"d",ue)}}setLeading(ae){this.current.leading=-ae}setTextRise(ae){this.current.textRise=ae}setTextRenderingMode(ae){this.current.textRenderingMode=ae}setHScale(ae){this.current.textHScale=ae/100}setRenderingIntent(ae){}setFlatness(ae){}setGState(ae){for(const[ue,me]of ae)switch(ue){case"LW":this.setLineWidth(me);break;case"LC":this.setLineCap(me);break;case"LJ":this.setLineJoin(me);break;case"ML":this.setMiterLimit(me);break;case"D":this.setDash(me[0],me[1]);break;case"RI":this.setRenderingIntent(me);break;case"FL":this.setFlatness(me);break;case"Font":this.setFont(me);break;case"CA":this.setStrokeAlpha(me);break;case"ca":this.setFillAlpha(me);break;default:(0,j.warn)(`Unimplemented graphic state operator ${ue}`);break}}fill(){const ae=this.current;ae.element&&(ae.element.setAttributeNS(null,"fill",ae.fillColor),ae.element.setAttributeNS(null,"fill-opacity",ae.fillAlpha),this.endPath())}stroke(){const ae=this.current;ae.element&&(this._setStrokeAttributes(ae.element),ae.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(ae,ue=1){const me=this.current;let fe=me.dashArray;ue!==1&&fe.length>0&&(fe=fe.map(function(ce){return ue*ce})),ae.setAttributeNS(null,"stroke",me.strokeColor),ae.setAttributeNS(null,"stroke-opacity",me.strokeAlpha),ae.setAttributeNS(null,"stroke-miterlimit",ne(me.miterLimit)),ae.setAttributeNS(null,"stroke-linecap",me.lineCap),ae.setAttributeNS(null,"stroke-linejoin",me.lineJoin),ae.setAttributeNS(null,"stroke-width",ne(ue*me.lineWidth)+"px"),ae.setAttributeNS(null,"stroke-dasharray",fe.map(ne).join(" ")),ae.setAttributeNS(null,"stroke-dashoffset",ne(ue*me.dashPhase)+"px")}eoFill(){var ae;(ae=this.current.element)==null||ae.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var ae;(ae=this.current.element)==null||ae.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const ae=this.svgFactory.createElement("svg:rect");ae.setAttributeNS(null,"x","0"),ae.setAttributeNS(null,"y","0"),ae.setAttributeNS(null,"width","1px"),ae.setAttributeNS(null,"height","1px"),ae.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(ae)}paintImageXObject(ae){const ue=this.getObject(ae);if(!ue){(0,j.warn)(`Dependent image with object ID ${ae} is not ready yet`);return}this.paintInlineImageXObject(ue)}paintInlineImageXObject(ae,ue){const me=ae.width,fe=ae.height,ce=Z(ae,this.forceDataSchema,!!ue),_e=this.svgFactory.createElement("svg:rect");_e.setAttributeNS(null,"x","0"),_e.setAttributeNS(null,"y","0"),_e.setAttributeNS(null,"width",ne(me)),_e.setAttributeNS(null,"height",ne(fe)),this.current.element=_e,this.clip("nonzero");const we=this.svgFactory.createElement("svg:image");we.setAttributeNS(X,"xlink:href",ce),we.setAttributeNS(null,"x","0"),we.setAttributeNS(null,"y",ne(-fe)),we.setAttributeNS(null,"width",ne(me)+"px"),we.setAttributeNS(null,"height",ne(fe)+"px"),we.setAttributeNS(null,"transform",`scale(${ne(1/me)} ${ne(-1/fe)})`),ue?ue.append(we):this._ensureTransformGroup().append(we)}paintImageMaskXObject(ae){const ue=this.getObject(ae.data,ae);if(ue.bitmap){(0,j.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const me=this.current,fe=ue.width,ce=ue.height,_e=me.fillColor;me.maskId=`mask${ie++}`;const we=this.svgFactory.createElement("svg:mask");we.setAttributeNS(null,"id",me.maskId);const ge=this.svgFactory.createElement("svg:rect");ge.setAttributeNS(null,"x","0"),ge.setAttributeNS(null,"y","0"),ge.setAttributeNS(null,"width",ne(fe)),ge.setAttributeNS(null,"height",ne(ce)),ge.setAttributeNS(null,"fill",_e),ge.setAttributeNS(null,"mask",`url(#${me.maskId})`),this.defs.append(we),this._ensureTransformGroup().append(ge),this.paintInlineImageXObject(ue,we)}paintFormXObjectBegin(ae,ue){if(Array.isArray(ae)&&ae.length===6&&this.transform(ae[0],ae[1],ae[2],ae[3],ae[4],ae[5]),ue){const me=ue[2]-ue[0],fe=ue[3]-ue[1],ce=this.svgFactory.createElement("svg:rect");ce.setAttributeNS(null,"x",ue[0]),ce.setAttributeNS(null,"y",ue[1]),ce.setAttributeNS(null,"width",ne(me)),ce.setAttributeNS(null,"height",ne(fe)),this.current.element=ce,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(ae){const ue=this.svgFactory.create(ae.width,ae.height),me=this.svgFactory.createElement("svg:defs");ue.append(me),this.defs=me;const fe=this.svgFactory.createElement("svg:g");return fe.setAttributeNS(null,"transform",re(ae.transform)),ue.append(fe),this.svg=fe,ue}_ensureClipGroup(){if(!this.current.clipGroup){const ae=this.svgFactory.createElement("svg:g");ae.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(ae),this.current.clipGroup=ae}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",re(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}_.SVGGraphics=he},(q,_)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.XfaText=void 0;class M{static textContent(j){const z=[],V={items:z,styles:Object.create(null)};function X(G){var Z;if(!G)return;let Y=null;const Q=G.name;if(Q==="#text")Y=G.value;else if(M.shouldBuildText(Q))(Z=G==null?void 0:G.attributes)!=null&&Z.textContent?Y=G.attributes.textContent:G.value&&(Y=G.value);else return;if(Y!==null&&z.push({str:Y}),!!G.children)for(const te of G.children)X(te)}return X(j),V}static shouldBuildText(j){return!(j==="textarea"||j==="input"||j==="option"||j==="select")}}_.XfaText=M},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.TextLayerRenderTask=void 0,_.renderTextLayer=re,_.updateTextLayer=se;var $=M(1),j=M(6);const z=1e5,V=30,X=.8,G=new Map;function Y(ie,oe){let he;if(oe&&$.FeatureTest.isOffscreenCanvasSupported)he=new OffscreenCanvas(ie,ie).getContext("2d",{alpha:!1});else{const le=document.createElement("canvas");le.width=le.height=ie,he=le.getContext("2d",{alpha:!1})}return he}function Q(ie,oe){const he=G.get(ie);if(he)return he;const le=Y(V,oe);le.font=`${V}px ${ie}`;const ae=le.measureText("");let ue=ae.fontBoundingBoxAscent,me=Math.abs(ae.fontBoundingBoxDescent);if(ue){const ce=ue/(ue+me);return G.set(ie,ce),le.canvas.width=le.canvas.height=0,ce}le.strokeStyle="red",le.clearRect(0,0,V,V),le.strokeText("g",0,0);let fe=le.getImageData(0,0,V,V).data;me=0;for(let ce=fe.length-1-3;ce>=0;ce-=4)if(fe[ce]>0){me=Math.ceil(ce/4/V);break}le.clearRect(0,0,V,V),le.strokeText("A",0,V),fe=le.getImageData(0,0,V,V).data,ue=0;for(let ce=0,_e=fe.length;ce<_e;ce+=4)if(fe[ce]>0){ue=V-Math.floor(ce/4/V);break}if(le.canvas.width=le.canvas.height=0,ue){const ce=ue/(ue+me);return G.set(ie,ce),ce}return G.set(ie,X),X}function Z(ie,oe,he){const le=document.createElement("span"),ae={angle:0,canvasWidth:0,hasText:oe.str!=="",hasEOL:oe.hasEOL,fontSize:0};ie._textDivs.push(le);const ue=$.Util.transform(ie._transform,oe.transform);let me=Math.atan2(ue[1],ue[0]);const fe=he[oe.fontName];fe.vertical&&(me+=Math.PI/2);const ce=Math.hypot(ue[2],ue[3]),_e=ce*Q(fe.fontFamily,ie._isOffscreenCanvasSupported);let we,ge;me===0?(we=ue[4],ge=ue[5]-_e):(we=ue[4]+_e*Math.sin(me),ge=ue[5]-_e*Math.cos(me));const Ae="calc(var(--scale-factor)*",de=le.style;ie._container===ie._rootContainer?(de.left=`${(100*we/ie._pageWidth).toFixed(2)}%`,de.top=`${(100*ge/ie._pageHeight).toFixed(2)}%`):(de.left=`${Ae}${we.toFixed(2)}px)`,de.top=`${Ae}${ge.toFixed(2)}px)`),de.fontSize=`${Ae}${ce.toFixed(2)}px)`,de.fontFamily=fe.fontFamily,ae.fontSize=ce,le.setAttribute("role","presentation"),le.textContent=oe.str,le.dir=oe.dir,ie._fontInspectorEnabled&&(le.dataset.fontName=oe.fontName),me!==0&&(ae.angle=me*(180/Math.PI));let De=!1;if(oe.str.length>1)De=!0;else if(oe.str!==" "&&oe.transform[0]!==oe.transform[3]){const Me=Math.abs(oe.transform[0]),Ee=Math.abs(oe.transform[3]);Me!==Ee&&Math.max(Me,Ee)/Math.min(Me,Ee)>1.5&&(De=!0)}De&&(ae.canvasWidth=fe.vertical?oe.height:oe.width),ie._textDivProperties.set(le,ae),ie._isReadableStream&&ie._layoutText(le)}function te(ie){const{div:oe,scale:he,properties:le,ctx:ae,prevFontSize:ue,prevFontFamily:me}=ie,{style:fe}=oe;let ce="";if(le.canvasWidth!==0&&le.hasText){const{fontFamily:_e}=fe,{canvasWidth:we,fontSize:ge}=le;(ue!==ge||me!==_e)&&(ae.font=`${ge*he}px ${_e}`,ie.prevFontSize=ge,ie.prevFontFamily=_e);const{width:Ae}=ae.measureText(oe.textContent);Ae>0&&(ce=`scaleX(${we*he/Ae})`)}le.angle!==0&&(ce=`rotate(${le.angle}deg) ${ce}`),ce.length>0&&(fe.transform=ce)}function ee(ie){if(ie._canceled)return;const oe=ie._textDivs,he=ie._capability;if(oe.length>z){he.resolve();return}if(!ie._isReadableStream)for(const ae of oe)ie._layoutText(ae);he.resolve()}class ne{constructor({textContentSource:oe,container:he,viewport:le,textDivs:ae,textDivProperties:ue,textContentItemsStr:me,isOffscreenCanvasSupported:fe}){var Ae;this._textContentSource=oe,this._isReadableStream=oe instanceof ReadableStream,this._container=this._rootContainer=he,this._textDivs=ae||[],this._textContentItemsStr=me||[],this._isOffscreenCanvasSupported=fe,this._fontInspectorEnabled=!!((Ae=globalThis.FontInspector)!=null&&Ae.enabled),this._reader=null,this._textDivProperties=ue||new WeakMap,this._canceled=!1,this._capability=new $.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:le.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:Y(0,fe)};const{pageWidth:ce,pageHeight:_e,pageX:we,pageY:ge}=le.rawDims;this._transform=[1,0,0,-1,-we,ge+_e],this._pageWidth=ce,this._pageHeight=_e,(0,j.setLayerDimensions)(he,le),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new $.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new $.AbortException("TextLayer task cancelled."))}_processItems(oe,he){for(const le of oe){if(le.str===void 0){if(le.type==="beginMarkedContentProps"||le.type==="beginMarkedContent"){const ae=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),le.id!==null&&this._container.setAttribute("id",`${le.id}`),ae.append(this._container)}else le.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(le.str),Z(this,le,he)}}_layoutText(oe){const he=this._layoutTextParams.properties=this._textDivProperties.get(oe);if(this._layoutTextParams.div=oe,te(this._layoutTextParams),he.hasText&&this._container.append(oe),he.hasEOL){const le=document.createElement("br");le.setAttribute("role","presentation"),this._container.append(le)}}_render(){const oe=new $.PromiseCapability;let he=Object.create(null);if(this._isReadableStream){const le=()=>{this._reader.read().then(({value:ae,done:ue})=>{if(ue){oe.resolve();return}Object.assign(he,ae.styles),this._processItems(ae.items,he),le()},oe.reject)};this._reader=this._textContentSource.getReader(),le()}else if(this._textContentSource){const{items:le,styles:ae}=this._textContentSource;this._processItems(le,ae),oe.resolve()}else throw new Error('No "textContentSource" parameter specified.');oe.promise.then(()=>{he=null,ee(this)},this._capability.reject)}}_.TextLayerRenderTask=ne;function re(ie){!ie.textContentSource&&(ie.textContent||ie.textContentStream)&&((0,j.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),ie.textContentSource=ie.textContent||ie.textContentStream);const{container:oe,viewport:he}=ie,le=getComputedStyle(oe),ae=le.getPropertyValue("visibility"),ue=parseFloat(le.getPropertyValue("--scale-factor"));ae==="visible"&&(!ue||Math.abs(ue-he.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const me=new ne(ie);return me._render(),me}function se({container:ie,viewport:oe,textDivs:he,textDivProperties:le,isOffscreenCanvasSupported:ae,mustRotate:ue=!0,mustRescale:me=!0}){if(ue&&(0,j.setLayerDimensions)(ie,{rotation:oe.rotation}),me){const fe=Y(0,ae),_e={prevFontSize:null,prevFontFamily:null,div:null,scale:oe.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:fe};for(const we of he)_e.properties=le.get(we),_e.div=we,te(_e)}}},(q,_,M)=>{var Z,te,ee,ne,re,se,ie,oe,he,le,ae,Sn,me,ir,ce,Fn,we,Tn;Object.defineProperty(_,"__esModule",{value:!0}),_.AnnotationEditorLayer=void 0;var $=M(1),j=M(4),z=M(5),V=M(28),X=M(33),G=M(6),Y=M(34);const Ae=class{constructor({uiManager:De,pageIndex:Me,div:Ee,accessibilityManager:Te,annotationLayer:xe,viewport:He,l10n:Oe}){Ye(this,ae);Ye(this,me);Ye(this,ce);Ye(this,we);Ye(this,Z,void 0);Ye(this,te,!1);Ye(this,ee,null);Ye(this,ne,this.pointerup.bind(this));Ye(this,re,this.pointerdown.bind(this));Ye(this,se,new Map);Ye(this,ie,!1);Ye(this,oe,!1);Ye(this,he,!1);Ye(this,le,void 0);const $e=[V.FreeTextEditor,X.InkEditor,Y.StampEditor];if(!Ae._initialized){Ae._initialized=!0;for(const Pe of $e)Pe.initialize(Oe)}De.registerEditorTypes($e),ht(this,le,De),this.pageIndex=Me,this.div=Ee,ht(this,Z,Te),ht(this,ee,xe),this.viewport=He,be(this,le).addLayer(this)}get isEmpty(){return be(this,se).size===0}updateToolbar(De){be(this,le).updateToolbar(De)}updateMode(De=be(this,le).getMode()){st(this,we,Tn).call(this),De===$.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),be(this,le).unselectAll(),De!==$.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",De===$.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",De===$.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",De===$.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(De){if(!De&&be(this,le).getMode()!==$.AnnotationEditorType.INK)return;if(!De){for(const Ee of be(this,se).values())if(Ee.isEmpty()){Ee.setInBackground();return}}st(this,ce,Fn).call(this,{offsetX:0,offsetY:0}).setInBackground()}setEditingState(De){be(this,le).setEditingState(De)}addCommands(De){be(this,le).addCommands(De)}enable(){this.div.style.pointerEvents="auto";const De=new Set;for(const Ee of be(this,se).values())Ee.enableEditing(),Ee.annotationElementId&&De.add(Ee.annotationElementId);if(!be(this,ee))return;const Me=be(this,ee).getEditableAnnotations();for(const Ee of Me){if(Ee.hide(),be(this,le).isDeletedAnnotationElement(Ee.data.id)||De.has(Ee.data.id))continue;const Te=this.deserialize(Ee);Te&&(this.addOrRebuild(Te),Te.enableEditing())}}disable(){var Me;ht(this,he,!0),this.div.style.pointerEvents="none";const De=new Set;for(const Ee of be(this,se).values()){if(Ee.disableEditing(),!Ee.annotationElementId||Ee.serialize()!==null){De.add(Ee.annotationElementId);continue}(Me=this.getEditableAnnotation(Ee.annotationElementId))==null||Me.show(),Ee.remove()}if(be(this,ee)){const Ee=be(this,ee).getEditableAnnotations();for(const Te of Ee){const{id:xe}=Te.data;De.has(xe)||be(this,le).isDeletedAnnotationElement(xe)||Te.show()}}st(this,we,Tn).call(this),this.isEmpty&&(this.div.hidden=!0),ht(this,he,!1)}getEditableAnnotation(De){var Me;return((Me=be(this,ee))==null?void 0:Me.getEditableAnnotation(De))||null}setActiveEditor(De){be(this,le).getActive()!==De&&be(this,le).setActiveEditor(De)}enableClick(){this.div.addEventListener("pointerdown",be(this,re)),this.div.addEventListener("pointerup",be(this,ne))}disableClick(){this.div.removeEventListener("pointerdown",be(this,re)),this.div.removeEventListener("pointerup",be(this,ne))}attach(De){be(this,se).set(De.id,De);const{annotationElementId:Me}=De;Me&&be(this,le).isDeletedAnnotationElement(Me)&&be(this,le).removeDeletedAnnotationElement(De)}detach(De){var Me;be(this,se).delete(De.id),(Me=be(this,Z))==null||Me.removePointerInTextLayer(De.contentDiv),!be(this,he)&&De.annotationElementId&&be(this,le).addDeletedAnnotationElement(De)}remove(De){this.detach(De),be(this,le).removeEditor(De),De.div.style.display="none",setTimeout(()=>{De.div.style.display="",De.div.remove(),De.isAttachedToDOM=!1,document.activeElement===document.body&&be(this,le).focusMainContainer()},0),be(this,oe)||this.addInkEditorIfNeeded(!1)}add(De){if(st(this,ae,Sn).call(this,De),be(this,le).addEditor(De),this.attach(De),!De.isAttachedToDOM){const Me=De.render();this.div.append(Me),De.isAttachedToDOM=!0}this.moveEditorInDOM(De),De.onceAdded(),be(this,le).addToAnnotationStorage(De)}moveEditorInDOM(De){var Me;(Me=be(this,Z))==null||Me.moveElementInDOM(this.div,De.div,De.contentDiv,!0)}addOrRebuild(De){De.needsToBeRebuilt()?De.rebuild():this.add(De)}addUndoableEditor(De){const Me=()=>{this.addOrRebuild(De)},Ee=()=>{De.remove()};this.addCommands({cmd:Me,undo:Ee,mustExec:!1})}getNextId(){return be(this,le).getId()}deserialize(De){switch(De.annotationType??De.annotationEditorType){case $.AnnotationEditorType.FREETEXT:return V.FreeTextEditor.deserialize(De,this,be(this,le));case $.AnnotationEditorType.INK:return X.InkEditor.deserialize(De,this,be(this,le));case $.AnnotationEditorType.STAMP:return Y.StampEditor.deserialize(De,this,be(this,le))}return null}setSelected(De){be(this,le).setSelected(De)}toggleSelected(De){be(this,le).toggleSelected(De)}isSelected(De){return be(this,le).isSelected(De)}unselect(De){be(this,le).unselect(De)}pointerup(De){const{isMac:Me}=$.FeatureTest.platform;if(!(De.button!==0||De.ctrlKey&&Me)&&De.target===this.div&&be(this,ie)){if(ht(this,ie,!1),!be(this,te)){ht(this,te,!0);return}st(this,ce,Fn).call(this,De)}}pointerdown(De){if(be(this,ie)){ht(this,ie,!1);return}const{isMac:Me}=$.FeatureTest.platform;if(De.button!==0||De.ctrlKey&&Me||De.target!==this.div)return;ht(this,ie,!0);const Ee=be(this,le).getActive();ht(this,te,!Ee||Ee.isEmpty())}drop(De){const Me=De.dataTransfer.getData("text/plain"),Ee=be(this,le).getEditor(Me);if(!Ee)return;De.preventDefault(),De.dataTransfer.dropEffect="move",st(this,ae,Sn).call(this,Ee);const Te=this.div.getBoundingClientRect(),xe=De.clientX-Te.x,He=De.clientY-Te.y;Ee.translate(xe-Ee.startX,He-Ee.startY),this.moveEditorInDOM(Ee),Ee.div.focus()}dragover(De){De.preventDefault()}destroy(){var De,Me;((De=be(this,le).getActive())==null?void 0:De.parent)===this&&be(this,le).setActiveEditor(null);for(const Ee of be(this,se).values())(Me=be(this,Z))==null||Me.removePointerInTextLayer(Ee.contentDiv),Ee.setParent(null),Ee.isAttachedToDOM=!1,Ee.div.remove();this.div=null,be(this,se).clear(),be(this,le).removeLayer(this)}render({viewport:De}){this.viewport=De,(0,G.setLayerDimensions)(this.div,De),(0,z.bindEvents)(this,this.div,["dragover","drop"]);for(const Me of be(this,le).getEditors(this.pageIndex))this.add(Me);this.updateMode()}update({viewport:De}){be(this,le).commitOrRemove(),this.viewport=De,(0,G.setLayerDimensions)(this.div,{rotation:De.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:De,pageHeight:Me}=this.viewport.rawDims;return[De,Me]}};let Q=Ae;Z=new WeakMap,te=new WeakMap,ee=new WeakMap,ne=new WeakMap,re=new WeakMap,se=new WeakMap,ie=new WeakMap,oe=new WeakMap,he=new WeakMap,le=new WeakMap,ae=new WeakSet,Sn=function(De){var Me;De.parent!==this&&(De.annotationElementId&&(be(this,le).addDeletedAnnotationElement(De.annotationElementId),j.AnnotationEditor.deleteAnnotationElement(De),De.annotationElementId=null),this.attach(De),(Me=De.parent)==null||Me.detach(De),De.setParent(this),De.div&&De.isAttachedToDOM&&(De.div.remove(),this.div.append(De.div)))},me=new WeakSet,ir=function(De){switch(be(this,le).getMode()){case $.AnnotationEditorType.FREETEXT:return new V.FreeTextEditor(De);case $.AnnotationEditorType.INK:return new X.InkEditor(De);case $.AnnotationEditorType.STAMP:return new Y.StampEditor(De)}return null},ce=new WeakSet,Fn=function(De){const Me=this.getNextId(),Ee=st(this,me,ir).call(this,{parent:this,id:Me,x:De.offsetX,y:De.offsetY,uiManager:be(this,le)});return Ee&&this.add(Ee),Ee},we=new WeakSet,Tn=function(){ht(this,oe,!0);for(const De of be(this,se).values())De.isEmpty()&&De.remove();ht(this,oe,!1)},Nt(Q,"_initialized",!1),_.AnnotationEditorLayer=Q},(q,_,M)=>{var G,Y,Q,Z,te,ee,ne,re,se,ie,sr,he,ar,ae,or,me,rn,ce,Rn,we,lr,Ae,Pn;Object.defineProperty(_,"__esModule",{value:!0}),_.FreeTextEditor=void 0;var $=M(1),j=M(5),z=M(4),V=M(29);const De=class extends z.AnnotationEditor{constructor(Te){super({...Te,name:"freeTextEditor"});Ye(this,ie);Ye(this,he);Ye(this,ae);Ye(this,me);Ye(this,ce);Ye(this,we);Ye(this,Ae);Ye(this,G,this.editorDivBlur.bind(this));Ye(this,Y,this.editorDivFocus.bind(this));Ye(this,Q,this.editorDivInput.bind(this));Ye(this,Z,this.editorDivKeydown.bind(this));Ye(this,te,void 0);Ye(this,ee,"");Ye(this,ne,`${this.id}-editor`);Ye(this,re,void 0);Ye(this,se,null);ht(this,te,Te.color||De._defaultColor||z.AnnotationEditor._defaultLineColor),ht(this,re,Te.fontSize||De._defaultFontSize)}static get _keyboardManager(){const Te=De.prototype,xe=$e=>$e.isEmpty(),He=j.AnnotationEditorUIManager.TRANSLATE_SMALL,Oe=j.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,$.shadow)(this,"_keyboardManager",new j.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],Te.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],Te.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],Te._translateEmpty,{args:[-He,0],checker:xe}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],Te._translateEmpty,{args:[-Oe,0],checker:xe}],[["ArrowRight","mac+ArrowRight"],Te._translateEmpty,{args:[He,0],checker:xe}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],Te._translateEmpty,{args:[Oe,0],checker:xe}],[["ArrowUp","mac+ArrowUp"],Te._translateEmpty,{args:[0,-He],checker:xe}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],Te._translateEmpty,{args:[0,-Oe],checker:xe}],[["ArrowDown","mac+ArrowDown"],Te._translateEmpty,{args:[0,He],checker:xe}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],Te._translateEmpty,{args:[0,Oe],checker:xe}]]))}static initialize(Te){this._l10nPromise=new Map(["free_text2_default_content","editor_free_text2_aria_label"].map(He=>[He,Te.get(He)]));const xe=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(xe.getPropertyValue("--freetext-padding"))}static updateDefaultParams(Te,xe){switch(Te){case $.AnnotationEditorParamsType.FREETEXT_SIZE:De._defaultFontSize=xe;break;case $.AnnotationEditorParamsType.FREETEXT_COLOR:De._defaultColor=xe;break}}updateParams(Te,xe){switch(Te){case $.AnnotationEditorParamsType.FREETEXT_SIZE:st(this,ie,sr).call(this,xe);break;case $.AnnotationEditorParamsType.FREETEXT_COLOR:st(this,he,ar).call(this,xe);break}}static get defaultPropertiesToUpdate(){return[[$.AnnotationEditorParamsType.FREETEXT_SIZE,De._defaultFontSize],[$.AnnotationEditorParamsType.FREETEXT_COLOR,De._defaultColor||z.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[$.AnnotationEditorParamsType.FREETEXT_SIZE,be(this,re)],[$.AnnotationEditorParamsType.FREETEXT_COLOR,be(this,te)]]}_translateEmpty(Te,xe){this._uiManager.translateSelectedEditors(Te,xe,!0)}getInitialTranslation(){const Te=this.parentScale;return[-De._internalPadding*Te,-(De._internalPadding+be(this,re))*Te]}rebuild(){super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar($.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",be(this,Z)),this.editorDiv.addEventListener("focus",be(this,Y)),this.editorDiv.addEventListener("blur",be(this,G)),this.editorDiv.addEventListener("input",be(this,Q)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",be(this,ne)),this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",be(this,Z)),this.editorDiv.removeEventListener("focus",be(this,Y)),this.editorDiv.removeEventListener("blur",be(this,G)),this.editorDiv.removeEventListener("input",be(this,Q)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(Te){super.focusin(Te),Te.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){if(this.width){st(this,Ae,Pn).call(this);return}this.enableEditMode(),this.editorDiv.focus()}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const Te=be(this,ee),xe=ht(this,ee,st(this,ae,or).call(this).trimEnd());if(Te===xe)return;const He=Oe=>{if(ht(this,ee,Oe),!Oe){this.remove();return}st(this,ce,Rn).call(this),this.rebuild(),st(this,me,rn).call(this)};this.addCommands({cmd:()=>{He(xe)},undo:()=>{He(Te)},mustExec:!1}),st(this,me,rn).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(Te){this.enterInEditMode()}keydown(Te){Te.target===this.div&&Te.key==="Enter"&&this.enterInEditMode()}editorDivKeydown(Te){De._keyboardManager.exec(this,Te)}editorDivFocus(Te){this.isEditing=!0}editorDivBlur(Te){this.isEditing=!1}editorDivInput(Te){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let Te,xe;this.width&&(Te=this.x,xe=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",be(this,ne)),this.enableEditing(),De._l10nPromise.get("editor_free_text2_aria_label").then(Oe=>{var $e;return($e=this.editorDiv)==null?void 0:$e.setAttribute("aria-label",Oe)}),De._l10nPromise.get("free_text2_default_content").then(Oe=>{var $e;return($e=this.editorDiv)==null?void 0:$e.setAttribute("default-content",Oe)}),this.editorDiv.contentEditable=!0;const{style:He}=this.editorDiv;if(He.fontSize=`calc(${be(this,re)}px * var(--scale-factor))`,He.color=be(this,te),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,j.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[Oe,$e]=this.parentDimensions;if(this.annotationElementId){const{position:Pe}=be(this,se);let[ve,ye]=this.getInitialTranslation();[ve,ye]=this.pageTranslationToScreen(ve,ye);const[Fe,je]=this.pageDimensions,[Be,Ne]=this.pageTranslation;let ze,Ze;switch(this.rotation){case 0:ze=Te+(Pe[0]-Be)/Fe,Ze=xe+this.height-(Pe[1]-Ne)/je;break;case 90:ze=Te+(Pe[0]-Be)/Fe,Ze=xe-(Pe[1]-Ne)/je,[ve,ye]=[ye,-ve];break;case 180:ze=Te-this.width+(Pe[0]-Be)/Fe,Ze=xe-(Pe[1]-Ne)/je,[ve,ye]=[-ve,-ye];break;case 270:ze=Te+(Pe[0]-Be-this.height*je)/Fe,Ze=xe+(Pe[1]-Ne-this.width*Fe)/je,[ve,ye]=[-ye,ve];break}this.setAt(ze*Oe,Ze*$e,ve,ye)}else this.setAt(Te*Oe,xe*$e,this.width*Oe,this.height*$e);st(this,ce,Rn).call(this),this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(Te,xe,He){let Oe=null;if(Te instanceof V.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:Pe,fontColor:ve},rect:ye,rotation:Fe,id:je},textContent:Be,textPosition:Ne,parent:{page:{pageNumber:ze}}}=Te;if(!Be||Be.length===0)return null;Oe=Te={annotationType:$.AnnotationEditorType.FREETEXT,color:Array.from(ve),fontSize:Pe,value:Be.join(`
`),position:Ne,pageIndex:ze-1,rect:ye,rotation:Fe,id:je,deleted:!1}}const $e=super.deserialize(Te,xe,He);return ht($e,re,Te.fontSize),ht($e,te,$.Util.makeHexColor(...Te.color)),ht($e,ee,Te.value),$e.annotationElementId=Te.id||null,ht($e,se,Oe),$e}serialize(Te=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const xe=De._internalPadding*this.parentScale,He=this.getRect(xe,xe),Oe=z.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:be(this,te)),$e={annotationType:$.AnnotationEditorType.FREETEXT,color:Oe,fontSize:be(this,re),value:be(this,ee),pageIndex:this.pageIndex,rect:He,rotation:this.rotation};return Te?$e:this.annotationElementId&&!st(this,we,lr).call(this,$e)?null:($e.id=this.annotationElementId,$e)}};let X=De;G=new WeakMap,Y=new WeakMap,Q=new WeakMap,Z=new WeakMap,te=new WeakMap,ee=new WeakMap,ne=new WeakMap,re=new WeakMap,se=new WeakMap,ie=new WeakSet,sr=function(Te){const xe=Oe=>{this.editorDiv.style.fontSize=`calc(${Oe}px * var(--scale-factor))`,this.translate(0,-(Oe-be(this,re))*this.parentScale),ht(this,re,Oe),st(this,me,rn).call(this)},He=be(this,re);this.addCommands({cmd:()=>{xe(Te)},undo:()=>{xe(He)},mustExec:!0,type:$.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},he=new WeakSet,ar=function(Te){const xe=be(this,te);this.addCommands({cmd:()=>{ht(this,te,this.editorDiv.style.color=Te)},undo:()=>{ht(this,te,this.editorDiv.style.color=xe)},mustExec:!0,type:$.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},ae=new WeakSet,or=function(){const Te=this.editorDiv.getElementsByTagName("div");if(Te.length===0)return this.editorDiv.innerText;const xe=[];for(const He of Te)xe.push(He.innerText.replace(/\r\n?|\n/,""));return xe.join(`
`)},me=new WeakSet,rn=function(){const[Te,xe]=this.parentDimensions;let He;if(this.isAttachedToDOM)He=this.div.getBoundingClientRect();else{const{currentLayer:Oe,div:$e}=this,Pe=$e.style.display;$e.style.display="hidden",Oe.div.append(this.div),He=$e.getBoundingClientRect(),$e.remove(),$e.style.display=Pe}this.rotation%180===this.parentRotation%180?(this.width=He.width/Te,this.height=He.height/xe):(this.width=He.height/Te,this.height=He.width/xe),this.fixAndSetPosition()},ce=new WeakSet,Rn=function(){if(this.editorDiv.replaceChildren(),!!be(this,ee))for(const Te of be(this,ee).split(`
`)){const xe=document.createElement("div");xe.append(Te?document.createTextNode(Te):document.createElement("br")),this.editorDiv.append(xe)}},we=new WeakSet,lr=function(Te){const{value:xe,fontSize:He,color:Oe,rect:$e,pageIndex:Pe}=be(this,se);return Te.value!==xe||Te.fontSize!==He||Te.rect.some((ve,ye)=>Math.abs(ve-$e[ye])>=1)||Te.color.some((ve,ye)=>ve!==Oe[ye])||Te.pageIndex!==Pe},Ae=new WeakSet,Pn=function(Te=!1){if(!this.annotationElementId)return;if(st(this,me,rn).call(this),!Te&&(this.width===0||this.height===0)){setTimeout(()=>st(this,Ae,Pn).call(this,!0),0);return}const xe=De._internalPadding*this.parentScale;be(this,se).rect=this.getRect(xe,xe)},Nt(X,"_freeTextDefaultContent",""),Nt(X,"_l10nPromise"),Nt(X,"_internalPadding",0),Nt(X,"_defaultColor",null),Nt(X,"_defaultFontSize",10),Nt(X,"_type","freetext"),_.FreeTextEditor=X},(q,_,M)=>{var ye,Fe,Gt,Be,ur,ze,Ze,ut,ot,pe,We,Qe,Ce,Ie,Ge,rt,ct,qe,Ve,Xe,Je,lt,xn,mt,In,Et,Bn,Tt,Dt,tt,it,nt,gt,Rt,St,Bt,Lt,cr,et,Mn;Object.defineProperty(_,"__esModule",{value:!0}),_.StampAnnotationElement=_.InkAnnotationElement=_.FreeTextAnnotationElement=_.AnnotationLayer=void 0;var $=M(1),j=M(6),z=M(3),V=M(30),X=M(31),G=M(32);const Y=1e3,Q=9,Z=new WeakSet;function te(dt){return{width:dt[2]-dt[0],height:dt[3]-dt[1]}}class ee{static create(Re){switch(Re.data.annotationType){case $.AnnotationType.LINK:return new re(Re);case $.AnnotationType.TEXT:return new se(Re);case $.AnnotationType.WIDGET:switch(Re.data.fieldType){case"Tx":return new oe(Re);case"Btn":return Re.data.radioButton?new ae(Re):Re.data.checkBox?new le(Re):new ue(Re);case"Ch":return new me(Re);case"Sig":return new he(Re)}return new ie(Re);case $.AnnotationType.POPUP:return new fe(Re);case $.AnnotationType.FREETEXT:return new _e(Re);case $.AnnotationType.LINE:return new we(Re);case $.AnnotationType.SQUARE:return new ge(Re);case $.AnnotationType.CIRCLE:return new Ae(Re);case $.AnnotationType.POLYLINE:return new de(Re);case $.AnnotationType.CARET:return new Me(Re);case $.AnnotationType.INK:return new Ee(Re);case $.AnnotationType.POLYGON:return new De(Re);case $.AnnotationType.HIGHLIGHT:return new Te(Re);case $.AnnotationType.UNDERLINE:return new xe(Re);case $.AnnotationType.SQUIGGLY:return new He(Re);case $.AnnotationType.STRIKEOUT:return new Oe(Re);case $.AnnotationType.STAMP:return new $e(Re);case $.AnnotationType.FILEATTACHMENT:return new Pe(Re);default:return new ne(Re)}}}class ne{constructor(Re,{isRenderable:ke=!1,ignoreBorder:Ue=!1,createQuadrilaterals:Le=!1}={}){Ye(this,ye,!1);this.isRenderable=ke,this.data=Re.data,this.layer=Re.layer,this.linkService=Re.linkService,this.downloadManager=Re.downloadManager,this.imageResourcesPath=Re.imageResourcesPath,this.renderForms=Re.renderForms,this.svgFactory=Re.svgFactory,this.annotationStorage=Re.annotationStorage,this.enableScripting=Re.enableScripting,this.hasJSActions=Re.hasJSActions,this._fieldObjects=Re.fieldObjects,this.parent=Re.parent,ke&&(this.container=this._createContainer(Ue)),Le&&this._createQuadrilaterals()}_createContainer(Re){const{data:ke,parent:{page:Ue,viewport:Le}}=this,Ke=document.createElement("section");Ke.setAttribute("data-annotation-id",ke.id),Ke.style.zIndex=this.parent.zIndex++,this.data.popupRef&&Ke.setAttribute("aria-haspopup","dialog"),ke.noRotate&&Ke.classList.add("norotate");const{pageWidth:at,pageHeight:pt,pageX:wt,pageY:At}=Le.rawDims;if(!ke.rect||this instanceof fe){const{rotation:kt}=ke;return!ke.hasOwnCanvas&&kt!==0&&this.setRotation(kt,Ke),Ke}const{width:bt,height:Ft}=te(ke.rect),yt=$.Util.normalizeRect([ke.rect[0],Ue.view[3]-ke.rect[1]+Ue.view[1],ke.rect[2],Ue.view[3]-ke.rect[3]+Ue.view[1]]);if(!Re&&ke.borderStyle.width>0){Ke.style.borderWidth=`${ke.borderStyle.width}px`;const kt=ke.borderStyle.horizontalCornerRadius,Pt=ke.borderStyle.verticalCornerRadius;if(kt>0||Pt>0){const Mt=`calc(${kt}px * var(--scale-factor)) / calc(${Pt}px * var(--scale-factor))`;Ke.style.borderRadius=Mt}else if(this instanceof ae){const Mt=`calc(${bt}px * var(--scale-factor)) / calc(${Ft}px * var(--scale-factor))`;Ke.style.borderRadius=Mt}switch(ke.borderStyle.style){case $.AnnotationBorderStyleType.SOLID:Ke.style.borderStyle="solid";break;case $.AnnotationBorderStyleType.DASHED:Ke.style.borderStyle="dashed";break;case $.AnnotationBorderStyleType.BEVELED:(0,$.warn)("Unimplemented border style: beveled");break;case $.AnnotationBorderStyleType.INSET:(0,$.warn)("Unimplemented border style: inset");break;case $.AnnotationBorderStyleType.UNDERLINE:Ke.style.borderBottomStyle="solid";break}const It=ke.borderColor||null;It?(ht(this,ye,!0),Ke.style.borderColor=$.Util.makeHexColor(It[0]|0,It[1]|0,It[2]|0)):Ke.style.borderWidth=0}Ke.style.left=`${100*(yt[0]-wt)/at}%`,Ke.style.top=`${100*(yt[1]-At)/pt}%`;const{rotation:vt}=ke;return ke.hasOwnCanvas||vt===0?(Ke.style.width=`${100*bt/at}%`,Ke.style.height=`${100*Ft/pt}%`):this.setRotation(vt,Ke),Ke}setRotation(Re,ke=this.container){if(!this.data.rect)return;const{pageWidth:Ue,pageHeight:Le}=this.parent.viewport.rawDims,{width:Ke,height:at}=te(this.data.rect);let pt,wt;Re%180===0?(pt=100*Ke/Ue,wt=100*at/Le):(pt=100*at/Ue,wt=100*Ke/Le),ke.style.width=`${pt}%`,ke.style.height=`${wt}%`,ke.setAttribute("data-main-rotation",(360-Re)%360)}get _commonActions(){const Re=(ke,Ue,Le)=>{const Ke=Le.detail[ke];Le.target.style[Ue]=V.ColorConverters[`${Ke[0]}_HTML`](Ke.slice(1))};return(0,$.shadow)(this,"_commonActions",{display:ke=>{const Ue=ke.detail.display%2===1;this.container.style.visibility=Ue?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:Ue,print:ke.detail.display===0||ke.detail.display===3})},print:ke=>{this.annotationStorage.setValue(this.data.id,{print:ke.detail.print})},hidden:ke=>{this.container.style.visibility=ke.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:ke.detail.hidden})},focus:ke=>{setTimeout(()=>ke.target.focus({preventScroll:!1}),0)},userName:ke=>{ke.target.title=ke.detail.userName},readonly:ke=>{ke.detail.readonly?ke.target.setAttribute("readonly",""):ke.target.removeAttribute("readonly")},required:ke=>{this._setRequired(ke.target,ke.detail.required)},bgColor:ke=>{Re("bgColor","backgroundColor",ke)},fillColor:ke=>{Re("fillColor","backgroundColor",ke)},fgColor:ke=>{Re("fgColor","color",ke)},textColor:ke=>{Re("textColor","color",ke)},borderColor:ke=>{Re("borderColor","borderColor",ke)},strokeColor:ke=>{Re("strokeColor","borderColor",ke)},rotation:ke=>{const Ue=ke.detail.rotation;this.setRotation(Ue),this.annotationStorage.setValue(this.data.id,{rotation:Ue})}})}_dispatchEventFromSandbox(Re,ke){const Ue=this._commonActions;for(const Le of Object.keys(ke.detail)){const Ke=Re[Le]||Ue[Le];Ke==null||Ke(ke)}}_setDefaultPropertiesFromJS(Re){if(!this.enableScripting)return;const ke=this.annotationStorage.getRawValue(this.data.id);if(!ke)return;const Ue=this._commonActions;for(const[Le,Ke]of Object.entries(ke)){const at=Ue[Le];if(at){const pt={detail:{[Le]:Ke},target:Re};at(pt),delete ke[Le]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:Re}=this.data;if(!Re)return;const[ke,Ue,Le,Ke]=this.data.rect;if(Re.length===1){const[,{x:Pt,y:It},{x:Mt,y:$t}]=Re[0];if(Le===Pt&&Ke===It&&ke===Mt&&Ue===$t)return}const{style:at}=this.container;let pt;if(be(this,ye)){const{borderColor:Pt,borderWidth:It}=at;at.borderWidth=0,pt=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${Pt}" stroke-width="${It}">`],this.container.classList.add("hasBorder")}const wt=Le-ke,At=Ke-Ue,{svgFactory:bt}=this,Ft=bt.createElement("svg");Ft.classList.add("quadrilateralsContainer"),Ft.setAttribute("width",0),Ft.setAttribute("height",0);const yt=bt.createElement("defs");Ft.append(yt);const vt=bt.createElement("clipPath"),kt=`clippath_${this.data.id}`;vt.setAttribute("id",kt),vt.setAttribute("clipPathUnits","objectBoundingBox"),yt.append(vt);for(const[,{x:Pt,y:It},{x:Mt,y:$t}]of Re){const Ot=bt.createElement("rect"),Ut=(Mt-ke)/wt,zt=(Ke-It)/At,jt=(Pt-Mt)/wt,Vt=(It-$t)/At;Ot.setAttribute("x",Ut),Ot.setAttribute("y",zt),Ot.setAttribute("width",jt),Ot.setAttribute("height",Vt),vt.append(Ot),pt==null||pt.push(`<rect vector-effect="non-scaling-stroke" x="${Ut}" y="${zt}" width="${jt}" height="${Vt}"/>`)}be(this,ye)&&(pt.push("</g></svg>')"),at.backgroundImage=pt.join("")),this.container.append(Ft),this.container.style.clipPath=`url(#${kt})`}_createPopup(){const{container:Re,data:ke}=this;Re.setAttribute("aria-haspopup","dialog");const Ue=new fe({data:{color:ke.color,titleObj:ke.titleObj,modificationDate:ke.modificationDate,contentsObj:ke.contentsObj,richText:ke.richText,parentRect:ke.rect,borderStyle:0,id:`popup_${ke.id}`,rotation:ke.rotation},parent:this.parent,elements:[this]});this.parent.div.append(Ue.render())}render(){(0,$.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(Re,ke=null){const Ue=[];if(this._fieldObjects){const Le=this._fieldObjects[Re];if(Le)for(const{page:Ke,id:at,exportValues:pt}of Le){if(Ke===-1||at===ke)continue;const wt=typeof pt=="string"?pt:null,At=document.querySelector(`[data-element-id="${at}"]`);if(At&&!Z.has(At)){(0,$.warn)(`_getElementsByName - element not allowed: ${at}`);continue}Ue.push({id:at,exportValue:wt,domElement:At})}return Ue}for(const Le of document.getElementsByName(Re)){const{exportValue:Ke}=Le,at=Le.getAttribute("data-element-id");at!==ke&&Z.has(Le)&&Ue.push({id:at,exportValue:Ke,domElement:Le})}return Ue}show(){var Re;this.container&&(this.container.hidden=!1),(Re=this.popup)==null||Re.maybeShow()}hide(){var Re;this.container&&(this.container.hidden=!0),(Re=this.popup)==null||Re.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const Re=this.getElementsToTriggerPopup();if(Array.isArray(Re))for(const ke of Re)ke.classList.add("highlightArea");else Re.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:Re,data:{id:ke}}=this;this.container.addEventListener("dblclick",()=>{var Ue;(Ue=this.linkService.eventBus)==null||Ue.dispatch("switchannotationeditormode",{source:this,mode:Re,editId:ke})})}}ye=new WeakMap;class re extends ne{constructor(ke,Ue=null){super(ke,{isRenderable:!0,ignoreBorder:!!(Ue!=null&&Ue.ignoreBorder),createQuadrilaterals:!0});Ye(this,Fe);Ye(this,Be);this.isTooltipOnly=ke.data.isTooltipOnly}render(){const{data:ke,linkService:Ue}=this,Le=document.createElement("a");Le.setAttribute("data-element-id",ke.id);let Ke=!1;return ke.url?(Ue.addLinkAttributes(Le,ke.url,ke.newWindow),Ke=!0):ke.action?(this._bindNamedAction(Le,ke.action),Ke=!0):ke.attachment?(this._bindAttachment(Le,ke.attachment),Ke=!0):ke.setOCGState?(st(this,Be,ur).call(this,Le,ke.setOCGState),Ke=!0):ke.dest?(this._bindLink(Le,ke.dest),Ke=!0):(ke.actions&&(ke.actions.Action||ke.actions["Mouse Up"]||ke.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(Le,ke),Ke=!0),ke.resetForm?(this._bindResetFormAction(Le,ke.resetForm),Ke=!0):this.isTooltipOnly&&!Ke&&(this._bindLink(Le,""),Ke=!0)),this.container.classList.add("linkAnnotation"),Ke&&this.container.append(Le),this.container}_bindLink(ke,Ue){ke.href=this.linkService.getDestinationHash(Ue),ke.onclick=()=>(Ue&&this.linkService.goToDestination(Ue),!1),(Ue||Ue==="")&&st(this,Fe,Gt).call(this)}_bindNamedAction(ke,Ue){ke.href=this.linkService.getAnchorUrl(""),ke.onclick=()=>(this.linkService.executeNamedAction(Ue),!1),st(this,Fe,Gt).call(this)}_bindAttachment(ke,Ue){ke.href=this.linkService.getAnchorUrl(""),ke.onclick=()=>{var Le;return(Le=this.downloadManager)==null||Le.openOrDownloadData(this.container,Ue.content,Ue.filename),!1},st(this,Fe,Gt).call(this)}_bindJSAction(ke,Ue){ke.href=this.linkService.getAnchorUrl("");const Le=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const Ke of Object.keys(Ue.actions)){const at=Le.get(Ke);at&&(ke[at]=()=>{var pt;return(pt=this.linkService.eventBus)==null||pt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Ue.id,name:Ke}}),!1})}ke.onclick||(ke.onclick=()=>!1),st(this,Fe,Gt).call(this)}_bindResetFormAction(ke,Ue){const Le=ke.onclick;if(Le||(ke.href=this.linkService.getAnchorUrl("")),st(this,Fe,Gt).call(this),!this._fieldObjects){(0,$.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),Le||(ke.onclick=()=>!1);return}ke.onclick=()=>{var Ft;Le==null||Le();const{fields:Ke,refs:at,include:pt}=Ue,wt=[];if(Ke.length!==0||at.length!==0){const yt=new Set(at);for(const vt of Ke){const kt=this._fieldObjects[vt]||[];for(const{id:Pt}of kt)yt.add(Pt)}for(const vt of Object.values(this._fieldObjects))for(const kt of vt)yt.has(kt.id)===pt&&wt.push(kt)}else for(const yt of Object.values(this._fieldObjects))wt.push(...yt);const At=this.annotationStorage,bt=[];for(const yt of wt){const{id:vt}=yt;switch(bt.push(vt),yt.type){case"text":{const Pt=yt.defaultValue||"";At.setValue(vt,{value:Pt});break}case"checkbox":case"radiobutton":{const Pt=yt.defaultValue===yt.exportValues;At.setValue(vt,{value:Pt});break}case"combobox":case"listbox":{const Pt=yt.defaultValue||"";At.setValue(vt,{value:Pt});break}default:continue}const kt=document.querySelector(`[data-element-id="${vt}"]`);if(kt){if(!Z.has(kt)){(0,$.warn)(`_bindResetFormAction - element not allowed: ${vt}`);continue}}else continue;kt.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((Ft=this.linkService.eventBus)==null||Ft.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:bt,name:"ResetForm"}})),!1}}}Fe=new WeakSet,Gt=function(){this.container.setAttribute("data-internal-link","")},Be=new WeakSet,ur=function(ke,Ue){ke.href=this.linkService.getAnchorUrl(""),ke.onclick=()=>(this.linkService.executeSetOCGState(Ue),!1),st(this,Fe,Gt).call(this)};class se extends ne{constructor(Re){var Ue,Le,Ke;const ke=!!(Re.data.popupRef||(Ue=Re.data.titleObj)!=null&&Ue.str||(Le=Re.data.contentsObj)!=null&&Le.str||(Ke=Re.data.richText)!=null&&Ke.str);super(Re,{isRenderable:ke})}render(){this.container.classList.add("textAnnotation");const Re=document.createElement("img");return Re.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",Re.alt="[{{type}} Annotation]",Re.dataset.l10nId="text_annotation_type",Re.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.popupRef||this._createPopup(),this.container.append(Re),this.container}}class ie extends ne{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(Re){var ke;this.data.hasOwnCanvas&&(((ke=Re.previousSibling)==null?void 0:ke.nodeName)==="CANVAS"&&(Re.previousSibling.hidden=!0),Re.hidden=!1)}_getKeyModifier(Re){const{isWin:ke,isMac:Ue}=$.FeatureTest.platform;return ke&&Re.ctrlKey||Ue&&Re.metaKey}_setEventListener(Re,ke,Ue,Le){ke.includes("mouse")?Re.addEventListener(ke,Ke=>{var at;(at=this.linkService.eventBus)==null||at.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:Ue,value:Le(Ke),shift:Ke.shiftKey,modifier:this._getKeyModifier(Ke)}})}):Re.addEventListener(ke,Ke=>{var at;(at=this.linkService.eventBus)==null||at.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:Ue,value:Le(Ke)}})})}_setEventListeners(Re,ke,Ue){var Le;for(const[Ke,at]of ke)(at==="Action"||(Le=this.data.actions)!=null&&Le[at])&&this._setEventListener(Re,Ke,at,Ue)}_setBackgroundColor(Re){const ke=this.data.backgroundColor||null;Re.style.backgroundColor=ke===null?"transparent":$.Util.makeHexColor(ke[0],ke[1],ke[2])}_setTextStyle(Re){const ke=["left","center","right"],{fontColor:Ue}=this.data.defaultAppearanceData,Le=this.data.defaultAppearanceData.fontSize||Q,Ke=Re.style;let at;const pt=2,wt=At=>Math.round(10*At)/10;if(this.data.multiLine){const At=Math.abs(this.data.rect[3]-this.data.rect[1]-pt),bt=Math.round(At/($.LINE_FACTOR*Le))||1,Ft=At/bt;at=Math.min(Le,wt(Ft/$.LINE_FACTOR))}else{const At=Math.abs(this.data.rect[3]-this.data.rect[1]-pt);at=Math.min(Le,wt(At/$.LINE_FACTOR))}Ke.fontSize=`calc(${at}px * var(--scale-factor))`,Ke.color=$.Util.makeHexColor(Ue[0],Ue[1],Ue[2]),this.data.textAlignment!==null&&(Ke.textAlign=ke[this.data.textAlignment])}_setRequired(Re,ke){ke?Re.setAttribute("required",!0):Re.removeAttribute("required"),Re.setAttribute("aria-required",ke)}}class oe extends ie{constructor(Re){const ke=Re.renderForms||!Re.data.hasAppearance&&!!Re.data.fieldValue;super(Re,{isRenderable:ke})}setPropertyOnSiblings(Re,ke,Ue,Le){const Ke=this.annotationStorage;for(const at of this._getElementsByName(Re.name,Re.id))at.domElement&&(at.domElement[ke]=Ue),Ke.setValue(at.id,{[Le]:Ue})}render(){var Le,Ke;const Re=this.annotationStorage,ke=this.data.id;this.container.classList.add("textWidgetAnnotation");let Ue=null;if(this.renderForms){const at=Re.getValue(ke,{value:this.data.fieldValue});let pt=at.value||"";const wt=Re.getValue(ke,{charLimit:this.data.maxLen}).charLimit;wt&&pt.length>wt&&(pt=pt.slice(0,wt));let At=at.formattedValue||((Le=this.data.textContent)==null?void 0:Le.join(`
`))||null;At&&this.data.comb&&(At=At.replaceAll(/\s+/g,""));const bt={userValue:pt,formattedValue:At,lastCommittedValue:null,commitKey:1};this.data.multiLine?(Ue=document.createElement("textarea"),Ue.textContent=At??pt,this.data.doNotScroll&&(Ue.style.overflowY="hidden")):(Ue=document.createElement("input"),Ue.type="text",Ue.setAttribute("value",At??pt),this.data.doNotScroll&&(Ue.style.overflowX="hidden")),this.data.hasOwnCanvas&&(Ue.hidden=!0),Z.add(Ue),Ue.setAttribute("data-element-id",ke),Ue.disabled=this.data.readOnly,Ue.name=this.data.baseFieldName||this.data.fieldName,Ue.tabIndex=Y,this._setRequired(Ue,this.data.required),wt&&(Ue.maxLength=wt),Ue.addEventListener("input",yt=>{Re.setValue(ke,{value:yt.target.value}),this.setPropertyOnSiblings(Ue,"value",yt.target.value,"value"),bt.formattedValue=null}),Ue.addEventListener("resetform",yt=>{const vt=this.data.defaultFieldValue??"";Ue.value=bt.userValue=vt,bt.formattedValue=null});let Ft=yt=>{const{formattedValue:vt}=bt;vt!=null&&(yt.target.value=vt),yt.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){Ue.addEventListener("focus",vt=>{const{target:kt}=vt;bt.userValue&&(kt.value=bt.userValue),bt.lastCommittedValue=kt.value,bt.commitKey=1}),Ue.addEventListener("updatefromsandbox",vt=>{this.showElementAndHideCanvas(vt.target);const kt={value(Pt){bt.userValue=Pt.detail.value??"",Re.setValue(ke,{value:bt.userValue.toString()}),Pt.target.value=bt.userValue},formattedValue(Pt){const{formattedValue:It}=Pt.detail;bt.formattedValue=It,It!=null&&Pt.target!==document.activeElement&&(Pt.target.value=It),Re.setValue(ke,{formattedValue:It})},selRange(Pt){Pt.target.setSelectionRange(...Pt.detail.selRange)},charLimit:Pt=>{var Ot;const{charLimit:It}=Pt.detail,{target:Mt}=Pt;if(It===0){Mt.removeAttribute("maxLength");return}Mt.setAttribute("maxLength",It);let $t=bt.userValue;!$t||$t.length<=It||($t=$t.slice(0,It),Mt.value=bt.userValue=$t,Re.setValue(ke,{value:$t}),(Ot=this.linkService.eventBus)==null||Ot.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ke,name:"Keystroke",value:$t,willCommit:!0,commitKey:1,selStart:Mt.selectionStart,selEnd:Mt.selectionEnd}}))}};this._dispatchEventFromSandbox(kt,vt)}),Ue.addEventListener("keydown",vt=>{var It;bt.commitKey=1;let kt=-1;if(vt.key==="Escape"?kt=0:vt.key==="Enter"&&!this.data.multiLine?kt=2:vt.key==="Tab"&&(bt.commitKey=3),kt===-1)return;const{value:Pt}=vt.target;bt.lastCommittedValue!==Pt&&(bt.lastCommittedValue=Pt,bt.userValue=Pt,(It=this.linkService.eventBus)==null||It.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ke,name:"Keystroke",value:Pt,willCommit:!0,commitKey:kt,selStart:vt.target.selectionStart,selEnd:vt.target.selectionEnd}}))});const yt=Ft;Ft=null,Ue.addEventListener("blur",vt=>{var Pt;if(!vt.relatedTarget)return;const{value:kt}=vt.target;bt.userValue=kt,bt.lastCommittedValue!==kt&&((Pt=this.linkService.eventBus)==null||Pt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ke,name:"Keystroke",value:kt,willCommit:!0,commitKey:bt.commitKey,selStart:vt.target.selectionStart,selEnd:vt.target.selectionEnd}})),yt(vt)}),(Ke=this.data.actions)!=null&&Ke.Keystroke&&Ue.addEventListener("beforeinput",vt=>{var zt;bt.lastCommittedValue=null;const{data:kt,target:Pt}=vt,{value:It,selectionStart:Mt,selectionEnd:$t}=Pt;let Ot=Mt,Ut=$t;switch(vt.inputType){case"deleteWordBackward":{const jt=It.substring(0,Mt).match(/\w*[^\w]*$/);jt&&(Ot-=jt[0].length);break}case"deleteWordForward":{const jt=It.substring(Mt).match(/^[^\w]*\w*/);jt&&(Ut+=jt[0].length);break}case"deleteContentBackward":Mt===$t&&(Ot-=1);break;case"deleteContentForward":Mt===$t&&(Ut+=1);break}vt.preventDefault(),(zt=this.linkService.eventBus)==null||zt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ke,name:"Keystroke",value:It,change:kt||"",willCommit:!1,selStart:Ot,selEnd:Ut}})}),this._setEventListeners(Ue,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],vt=>vt.target.value)}if(Ft&&Ue.addEventListener("blur",Ft),this.data.comb){const vt=(this.data.rect[2]-this.data.rect[0])/wt;Ue.classList.add("comb"),Ue.style.letterSpacing=`calc(${vt}px * var(--scale-factor) - 1ch)`}}else Ue=document.createElement("div"),Ue.textContent=this.data.fieldValue,Ue.style.verticalAlign="middle",Ue.style.display="table-cell";return this._setTextStyle(Ue),this._setBackgroundColor(Ue),this._setDefaultPropertiesFromJS(Ue),this.container.append(Ue),this.container}}class he extends ie{constructor(Re){super(Re,{isRenderable:!!Re.data.hasOwnCanvas})}}class le extends ie{constructor(Re){super(Re,{isRenderable:Re.renderForms})}render(){const Re=this.annotationStorage,ke=this.data,Ue=ke.id;let Le=Re.getValue(Ue,{value:ke.exportValue===ke.fieldValue}).value;typeof Le=="string"&&(Le=Le!=="Off",Re.setValue(Ue,{value:Le})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const Ke=document.createElement("input");return Z.add(Ke),Ke.setAttribute("data-element-id",Ue),Ke.disabled=ke.readOnly,this._setRequired(Ke,this.data.required),Ke.type="checkbox",Ke.name=ke.baseFieldName||ke.fieldName,Le&&Ke.setAttribute("checked",!0),Ke.setAttribute("exportValue",ke.exportValue),Ke.tabIndex=Y,Ke.addEventListener("change",at=>{const{name:pt,checked:wt}=at.target;for(const At of this._getElementsByName(pt,Ue)){const bt=wt&&At.exportValue===ke.exportValue;At.domElement&&(At.domElement.checked=bt),Re.setValue(At.id,{value:bt})}Re.setValue(Ue,{value:wt})}),Ke.addEventListener("resetform",at=>{const pt=ke.defaultFieldValue||"Off";at.target.checked=pt===ke.exportValue}),this.enableScripting&&this.hasJSActions&&(Ke.addEventListener("updatefromsandbox",at=>{const pt={value(wt){wt.target.checked=wt.detail.value!=="Off",Re.setValue(Ue,{value:wt.target.checked})}};this._dispatchEventFromSandbox(pt,at)}),this._setEventListeners(Ke,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],at=>at.target.checked)),this._setBackgroundColor(Ke),this._setDefaultPropertiesFromJS(Ke),this.container.append(Ke),this.container}}class ae extends ie{constructor(Re){super(Re,{isRenderable:Re.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const Re=this.annotationStorage,ke=this.data,Ue=ke.id;let Le=Re.getValue(Ue,{value:ke.fieldValue===ke.buttonValue}).value;typeof Le=="string"&&(Le=Le!==ke.buttonValue,Re.setValue(Ue,{value:Le}));const Ke=document.createElement("input");if(Z.add(Ke),Ke.setAttribute("data-element-id",Ue),Ke.disabled=ke.readOnly,this._setRequired(Ke,this.data.required),Ke.type="radio",Ke.name=ke.baseFieldName||ke.fieldName,Le&&Ke.setAttribute("checked",!0),Ke.tabIndex=Y,Ke.addEventListener("change",at=>{const{name:pt,checked:wt}=at.target;for(const At of this._getElementsByName(pt,Ue))Re.setValue(At.id,{value:!1});Re.setValue(Ue,{value:wt})}),Ke.addEventListener("resetform",at=>{const pt=ke.defaultFieldValue;at.target.checked=pt!=null&&pt===ke.buttonValue}),this.enableScripting&&this.hasJSActions){const at=ke.buttonValue;Ke.addEventListener("updatefromsandbox",pt=>{const wt={value:At=>{const bt=at===At.detail.value;for(const Ft of this._getElementsByName(At.target.name)){const yt=bt&&Ft.id===Ue;Ft.domElement&&(Ft.domElement.checked=yt),Re.setValue(Ft.id,{value:yt})}}};this._dispatchEventFromSandbox(wt,pt)}),this._setEventListeners(Ke,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],pt=>pt.target.checked)}return this._setBackgroundColor(Ke),this._setDefaultPropertiesFromJS(Ke),this.container.append(Ke),this.container}}class ue extends re{constructor(Re){super(Re,{ignoreBorder:Re.data.hasAppearance})}render(){const Re=super.render();Re.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(Re.title=this.data.alternativeText);const ke=Re.lastChild;return this.enableScripting&&this.hasJSActions&&ke&&(this._setDefaultPropertiesFromJS(ke),ke.addEventListener("updatefromsandbox",Ue=>{this._dispatchEventFromSandbox({},Ue)})),Re}}class me extends ie{constructor(Re){super(Re,{isRenderable:Re.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const Re=this.annotationStorage,ke=this.data.id,Ue=Re.getValue(ke,{value:this.data.fieldValue}),Le=document.createElement("select");Z.add(Le),Le.setAttribute("data-element-id",ke),Le.disabled=this.data.readOnly,this._setRequired(Le,this.data.required),Le.name=this.data.baseFieldName||this.data.fieldName,Le.tabIndex=Y;let Ke=this.data.combo&&this.data.options.length>0;this.data.combo||(Le.size=this.data.options.length,this.data.multiSelect&&(Le.multiple=!0)),Le.addEventListener("resetform",bt=>{const Ft=this.data.defaultFieldValue;for(const yt of Le.options)yt.selected=yt.value===Ft});for(const bt of this.data.options){const Ft=document.createElement("option");Ft.textContent=bt.displayValue,Ft.value=bt.exportValue,Ue.value.includes(bt.exportValue)&&(Ft.setAttribute("selected",!0),Ke=!1),Le.append(Ft)}let at=null;if(Ke){const bt=document.createElement("option");bt.value=" ",bt.setAttribute("hidden",!0),bt.setAttribute("selected",!0),Le.prepend(bt),at=()=>{bt.remove(),Le.removeEventListener("input",at),at=null},Le.addEventListener("input",at)}const pt=bt=>{const Ft=bt?"value":"textContent",{options:yt,multiple:vt}=Le;return vt?Array.prototype.filter.call(yt,kt=>kt.selected).map(kt=>kt[Ft]):yt.selectedIndex===-1?null:yt[yt.selectedIndex][Ft]};let wt=pt(!1);const At=bt=>{const Ft=bt.target.options;return Array.prototype.map.call(Ft,yt=>({displayValue:yt.textContent,exportValue:yt.value}))};return this.enableScripting&&this.hasJSActions?(Le.addEventListener("updatefromsandbox",bt=>{const Ft={value(yt){at==null||at();const vt=yt.detail.value,kt=new Set(Array.isArray(vt)?vt:[vt]);for(const Pt of Le.options)Pt.selected=kt.has(Pt.value);Re.setValue(ke,{value:pt(!0)}),wt=pt(!1)},multipleSelection(yt){Le.multiple=!0},remove(yt){const vt=Le.options,kt=yt.detail.remove;vt[kt].selected=!1,Le.remove(kt),vt.length>0&&Array.prototype.findIndex.call(vt,It=>It.selected)===-1&&(vt[0].selected=!0),Re.setValue(ke,{value:pt(!0),items:At(yt)}),wt=pt(!1)},clear(yt){for(;Le.length!==0;)Le.remove(0);Re.setValue(ke,{value:null,items:[]}),wt=pt(!1)},insert(yt){const{index:vt,displayValue:kt,exportValue:Pt}=yt.detail.insert,It=Le.children[vt],Mt=document.createElement("option");Mt.textContent=kt,Mt.value=Pt,It?It.before(Mt):Le.append(Mt),Re.setValue(ke,{value:pt(!0),items:At(yt)}),wt=pt(!1)},items(yt){const{items:vt}=yt.detail;for(;Le.length!==0;)Le.remove(0);for(const kt of vt){const{displayValue:Pt,exportValue:It}=kt,Mt=document.createElement("option");Mt.textContent=Pt,Mt.value=It,Le.append(Mt)}Le.options.length>0&&(Le.options[0].selected=!0),Re.setValue(ke,{value:pt(!0),items:At(yt)}),wt=pt(!1)},indices(yt){const vt=new Set(yt.detail.indices);for(const kt of yt.target.options)kt.selected=vt.has(kt.index);Re.setValue(ke,{value:pt(!0)}),wt=pt(!1)},editable(yt){yt.target.disabled=!yt.detail.editable}};this._dispatchEventFromSandbox(Ft,bt)}),Le.addEventListener("input",bt=>{var yt;const Ft=pt(!0);Re.setValue(ke,{value:Ft}),bt.preventDefault(),(yt=this.linkService.eventBus)==null||yt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ke,name:"Keystroke",value:wt,changeEx:Ft,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(Le,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],bt=>bt.target.value)):Le.addEventListener("input",function(bt){Re.setValue(ke,{value:pt(!0)})}),this.data.combo&&this._setTextStyle(Le),this._setBackgroundColor(Le),this._setDefaultPropertiesFromJS(Le),this.container.append(Le),this.container}}class fe extends ne{constructor(Re){var Ke,at,pt;const{data:ke,elements:Ue}=Re,Le=!!((Ke=ke.titleObj)!=null&&Ke.str||(at=ke.contentsObj)!=null&&at.str||(pt=ke.richText)!=null&&pt.str);super(Re,{isRenderable:Le}),this.elements=Ue}render(){this.container.classList.add("popupAnnotation");const Re=new ce({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),ke=[];for(const Ue of this.elements)Ue.popup=Re,ke.push(Ue.data.id),Ue.addHighlightArea();return this.container.setAttribute("aria-controls",ke.join(",")),this.container}}class ce{constructor({container:Re,color:ke,elements:Ue,titleObj:Le,modificationDate:Ke,contentsObj:at,richText:pt,parent:wt,rect:At,parentRect:bt,open:Ft}){Ye(this,lt);Ye(this,mt);Ye(this,Et);Ye(this,ze,null);Ye(this,Ze,st(this,Et,Bn).bind(this));Ye(this,ut,st(this,mt,In).bind(this));Ye(this,ot,st(this,lt,xn).bind(this));Ye(this,pe,null);Ye(this,We,null);Ye(this,Qe,null);Ye(this,Ce,null);Ye(this,Ie,null);Ye(this,Ge,null);Ye(this,rt,!1);Ye(this,ct,null);Ye(this,qe,null);Ye(this,Ve,null);Ye(this,Xe,null);Ye(this,Je,!1);ht(this,We,Re),ht(this,Xe,Le),ht(this,Qe,at),ht(this,Ve,pt),ht(this,Ie,wt),ht(this,pe,ke),ht(this,qe,At),ht(this,Ge,bt),ht(this,Ce,Ue);const yt=j.PDFDateString.toDateObject(Ke);yt&&ht(this,ze,wt.l10n.get("annotation_date_string",{date:yt.toLocaleDateString(),time:yt.toLocaleTimeString()})),this.trigger=Ue.flatMap(vt=>vt.getElementsToTriggerPopup());for(const vt of this.trigger)vt.addEventListener("click",be(this,ot)),vt.addEventListener("mouseenter",be(this,ut)),vt.addEventListener("mouseleave",be(this,Ze));be(this,We).hidden=!0,Ft&&st(this,lt,xn).call(this)}render(){if(be(this,ct))return;const{page:{view:Re},viewport:{rawDims:{pageWidth:ke,pageHeight:Ue,pageX:Le,pageY:Ke}}}=be(this,Ie),at=ht(this,ct,document.createElement("div"));if(at.className="popup",be(this,pe)){const Ot=at.style.outlineColor=$.Util.makeHexColor(...be(this,pe));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?at.style.backgroundColor=`color-mix(in srgb, ${Ot} 30%, white)`:at.style.backgroundColor=$.Util.makeHexColor(...be(this,pe).map(zt=>Math.floor(.7*(255-zt)+zt)))}const pt=document.createElement("span");pt.className="header";const wt=document.createElement("h1");if(pt.append(wt),{dir:wt.dir,str:wt.textContent}=be(this,Xe),at.append(pt),be(this,ze)){const Ot=document.createElement("span");Ot.classList.add("popupDate"),be(this,ze).then(Ut=>{Ot.textContent=Ut}),pt.append(Ot)}const At=be(this,Qe),bt=be(this,Ve);if(bt!=null&&bt.str&&(!(At!=null&&At.str)||At.str===bt.str))G.XfaLayer.render({xfaHtml:bt.html,intent:"richText",div:at}),at.lastChild.classList.add("richText","popupContent");else{const Ot=this._formatContents(At);at.append(Ot)}let Ft=!!be(this,Ge),yt=Ft?be(this,Ge):be(this,qe);for(const Ot of be(this,Ce))if(!yt||$.Util.intersect(Ot.data.rect,yt)!==null){yt=Ot.data.rect,Ft=!0;break}const vt=$.Util.normalizeRect([yt[0],Re[3]-yt[1]+Re[1],yt[2],Re[3]-yt[3]+Re[1]]),kt=5,Pt=Ft?yt[2]-yt[0]+kt:0,It=vt[0]+Pt,Mt=vt[1],{style:$t}=be(this,We);$t.left=`${100*(It-Le)/ke}%`,$t.top=`${100*(Mt-Ke)/Ue}%`,be(this,We).append(at)}_formatContents({str:Re,dir:ke}){const Ue=document.createElement("p");Ue.classList.add("popupContent"),Ue.dir=ke;const Le=Re.split(/(?:\r\n?|\n)/);for(let Ke=0,at=Le.length;Ke<at;++Ke){const pt=Le[Ke];Ue.append(document.createTextNode(pt)),Ke<at-1&&Ue.append(document.createElement("br"))}return Ue}forceHide(){ht(this,Je,this.isVisible),be(this,Je)&&(be(this,We).hidden=!0)}maybeShow(){be(this,Je)&&(ht(this,Je,!1),be(this,We).hidden=!1)}get isVisible(){return be(this,We).hidden===!1}}ze=new WeakMap,Ze=new WeakMap,ut=new WeakMap,ot=new WeakMap,pe=new WeakMap,We=new WeakMap,Qe=new WeakMap,Ce=new WeakMap,Ie=new WeakMap,Ge=new WeakMap,rt=new WeakMap,ct=new WeakMap,qe=new WeakMap,Ve=new WeakMap,Xe=new WeakMap,Je=new WeakMap,lt=new WeakSet,xn=function(){ht(this,rt,!be(this,rt)),be(this,rt)?(st(this,mt,In).call(this),be(this,We).addEventListener("click",be(this,ot))):(st(this,Et,Bn).call(this),be(this,We).removeEventListener("click",be(this,ot)))},mt=new WeakSet,In=function(){be(this,ct)||this.render(),this.isVisible?be(this,rt)&&be(this,We).classList.add("focused"):(be(this,We).hidden=!1,be(this,We).style.zIndex=parseInt(be(this,We).style.zIndex)+1e3)},Et=new WeakSet,Bn=function(){be(this,We).classList.remove("focused"),!(be(this,rt)||!this.isVisible)&&(be(this,We).hidden=!0,be(this,We).style.zIndex=parseInt(be(this,We).style.zIndex)-1e3)};class _e extends ne{constructor(Re){var Ue,Le,Ke;const ke=!!(Re.data.popupRef||(Ue=Re.data.titleObj)!=null&&Ue.str||(Le=Re.data.contentsObj)!=null&&Le.str||(Ke=Re.data.richText)!=null&&Ke.str);super(Re,{isRenderable:ke,ignoreBorder:!0}),this.textContent=Re.data.textContent,this.textPosition=Re.data.textPosition,this.annotationEditorType=$.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const Re=document.createElement("div");Re.classList.add("annotationTextContent"),Re.setAttribute("role","comment");for(const ke of this.textContent){const Ue=document.createElement("span");Ue.textContent=ke,Re.append(Ue)}this.container.append(Re)}return this.data.popupRef||this._createPopup(),this._editOnDoubleClick(),this.container}}_.FreeTextAnnotationElement=_e;class we extends ne{constructor(ke){var Le,Ke,at;const Ue=!!(ke.data.popupRef||(Le=ke.data.titleObj)!=null&&Le.str||(Ke=ke.data.contentsObj)!=null&&Ke.str||(at=ke.data.richText)!=null&&at.str);super(ke,{isRenderable:Ue,ignoreBorder:!0});Ye(this,Tt,null)}render(){this.container.classList.add("lineAnnotation");const ke=this.data,{width:Ue,height:Le}=te(ke.rect),Ke=this.svgFactory.create(Ue,Le,!0),at=ht(this,Tt,this.svgFactory.createElement("svg:line"));return at.setAttribute("x1",ke.rect[2]-ke.lineCoordinates[0]),at.setAttribute("y1",ke.rect[3]-ke.lineCoordinates[1]),at.setAttribute("x2",ke.rect[2]-ke.lineCoordinates[2]),at.setAttribute("y2",ke.rect[3]-ke.lineCoordinates[3]),at.setAttribute("stroke-width",ke.borderStyle.width||1),at.setAttribute("stroke","transparent"),at.setAttribute("fill","transparent"),Ke.append(at),this.container.append(Ke),ke.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return be(this,Tt)}addHighlightArea(){this.container.classList.add("highlightArea")}}Tt=new WeakMap;class ge extends ne{constructor(ke){var Le,Ke,at;const Ue=!!(ke.data.popupRef||(Le=ke.data.titleObj)!=null&&Le.str||(Ke=ke.data.contentsObj)!=null&&Ke.str||(at=ke.data.richText)!=null&&at.str);super(ke,{isRenderable:Ue,ignoreBorder:!0});Ye(this,Dt,null)}render(){this.container.classList.add("squareAnnotation");const ke=this.data,{width:Ue,height:Le}=te(ke.rect),Ke=this.svgFactory.create(Ue,Le,!0),at=ke.borderStyle.width,pt=ht(this,Dt,this.svgFactory.createElement("svg:rect"));return pt.setAttribute("x",at/2),pt.setAttribute("y",at/2),pt.setAttribute("width",Ue-at),pt.setAttribute("height",Le-at),pt.setAttribute("stroke-width",at||1),pt.setAttribute("stroke","transparent"),pt.setAttribute("fill","transparent"),Ke.append(pt),this.container.append(Ke),ke.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return be(this,Dt)}addHighlightArea(){this.container.classList.add("highlightArea")}}Dt=new WeakMap;class Ae extends ne{constructor(ke){var Le,Ke,at;const Ue=!!(ke.data.popupRef||(Le=ke.data.titleObj)!=null&&Le.str||(Ke=ke.data.contentsObj)!=null&&Ke.str||(at=ke.data.richText)!=null&&at.str);super(ke,{isRenderable:Ue,ignoreBorder:!0});Ye(this,tt,null)}render(){this.container.classList.add("circleAnnotation");const ke=this.data,{width:Ue,height:Le}=te(ke.rect),Ke=this.svgFactory.create(Ue,Le,!0),at=ke.borderStyle.width,pt=ht(this,tt,this.svgFactory.createElement("svg:ellipse"));return pt.setAttribute("cx",Ue/2),pt.setAttribute("cy",Le/2),pt.setAttribute("rx",Ue/2-at/2),pt.setAttribute("ry",Le/2-at/2),pt.setAttribute("stroke-width",at||1),pt.setAttribute("stroke","transparent"),pt.setAttribute("fill","transparent"),Ke.append(pt),this.container.append(Ke),ke.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return be(this,tt)}addHighlightArea(){this.container.classList.add("highlightArea")}}tt=new WeakMap;class de extends ne{constructor(ke){var Le,Ke,at;const Ue=!!(ke.data.popupRef||(Le=ke.data.titleObj)!=null&&Le.str||(Ke=ke.data.contentsObj)!=null&&Ke.str||(at=ke.data.richText)!=null&&at.str);super(ke,{isRenderable:Ue,ignoreBorder:!0});Ye(this,it,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const ke=this.data,{width:Ue,height:Le}=te(ke.rect),Ke=this.svgFactory.create(Ue,Le,!0);let at=[];for(const wt of ke.vertices){const At=wt.x-ke.rect[0],bt=ke.rect[3]-wt.y;at.push(At+","+bt)}at=at.join(" ");const pt=ht(this,it,this.svgFactory.createElement(this.svgElementName));return pt.setAttribute("points",at),pt.setAttribute("stroke-width",ke.borderStyle.width||1),pt.setAttribute("stroke","transparent"),pt.setAttribute("fill","transparent"),Ke.append(pt),this.container.append(Ke),ke.popupRef||this._createPopup(pt,ke),this.container}getElementsToTriggerPopup(){return be(this,it)}addHighlightArea(){this.container.classList.add("highlightArea")}}it=new WeakMap;class De extends de{constructor(Re){super(Re),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Me extends ne{constructor(Re){var Ue,Le,Ke;const ke=!!(Re.data.popupRef||(Ue=Re.data.titleObj)!=null&&Ue.str||(Le=Re.data.contentsObj)!=null&&Le.str||(Ke=Re.data.richText)!=null&&Ke.str);super(Re,{isRenderable:ke,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),this.data.popupRef||this._createPopup(),this.container}}class Ee extends ne{constructor(ke){var Le,Ke,at;const Ue=!!(ke.data.popupRef||(Le=ke.data.titleObj)!=null&&Le.str||(Ke=ke.data.contentsObj)!=null&&Ke.str||(at=ke.data.richText)!=null&&at.str);super(ke,{isRenderable:Ue,ignoreBorder:!0});Ye(this,nt,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=$.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const ke=this.data,{width:Ue,height:Le}=te(ke.rect),Ke=this.svgFactory.create(Ue,Le,!0);for(const at of ke.inkLists){let pt=[];for(const At of at){const bt=At.x-ke.rect[0],Ft=ke.rect[3]-At.y;pt.push(`${bt},${Ft}`)}pt=pt.join(" ");const wt=this.svgFactory.createElement(this.svgElementName);be(this,nt).push(wt),wt.setAttribute("points",pt),wt.setAttribute("stroke-width",ke.borderStyle.width||1),wt.setAttribute("stroke","transparent"),wt.setAttribute("fill","transparent"),ke.popupRef||this._createPopup(wt,ke),Ke.append(wt)}return this.container.append(Ke),this.container}getElementsToTriggerPopup(){return be(this,nt)}addHighlightArea(){this.container.classList.add("highlightArea")}}nt=new WeakMap,_.InkAnnotationElement=Ee;class Te extends ne{constructor(Re){var Ue,Le,Ke;const ke=!!(Re.data.popupRef||(Ue=Re.data.titleObj)!=null&&Ue.str||(Le=Re.data.contentsObj)!=null&&Le.str||(Ke=Re.data.richText)!=null&&Ke.str);super(Re,{isRenderable:ke,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class xe extends ne{constructor(Re){var Ue,Le,Ke;const ke=!!(Re.data.popupRef||(Ue=Re.data.titleObj)!=null&&Ue.str||(Le=Re.data.contentsObj)!=null&&Le.str||(Ke=Re.data.richText)!=null&&Ke.str);super(Re,{isRenderable:ke,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class He extends ne{constructor(Re){var Ue,Le,Ke;const ke=!!(Re.data.popupRef||(Ue=Re.data.titleObj)!=null&&Ue.str||(Le=Re.data.contentsObj)!=null&&Le.str||(Ke=Re.data.richText)!=null&&Ke.str);super(Re,{isRenderable:ke,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Oe extends ne{constructor(Re){var Ue,Le,Ke;const ke=!!(Re.data.popupRef||(Ue=Re.data.titleObj)!=null&&Ue.str||(Le=Re.data.contentsObj)!=null&&Le.str||(Ke=Re.data.richText)!=null&&Ke.str);super(Re,{isRenderable:ke,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class $e extends ne{constructor(Re){var Ue,Le,Ke;const ke=!!(Re.data.popupRef||(Ue=Re.data.titleObj)!=null&&Ue.str||(Le=Re.data.contentsObj)!=null&&Le.str||(Ke=Re.data.richText)!=null&&Ke.str);super(Re,{isRenderable:ke,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),this.data.popupRef||this._createPopup(),this.container}}_.StampAnnotationElement=$e;class Pe extends ne{constructor(ke){var Ke;super(ke,{isRenderable:!0});Ye(this,gt,null);const{filename:Ue,content:Le}=this.data.file;this.filename=(0,j.getFilenameFromUrl)(Ue,!0),this.content=Le,(Ke=this.linkService.eventBus)==null||Ke.dispatch("fileattachmentannotation",{source:this,filename:Ue,content:Le})}render(){var Ue,Le;this.container.classList.add("fileAttachmentAnnotation");let ke;return this.data.hasAppearance?ke=document.createElement("div"):(ke=document.createElement("img"),ke.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(this.data.name)?"paperclip":"pushpin"}.svg`),ke.classList.add("popupTriggerArea"),ke.addEventListener("dblclick",this._download.bind(this)),ht(this,gt,ke),!this.data.popupRef&&((Ue=this.data.titleObj)!=null&&Ue.str||(Le=this.data.contentsObj)!=null&&Le.str||this.data.richText)&&this._createPopup(),this.container.append(ke),this.container}getElementsToTriggerPopup(){return be(this,gt)}addHighlightArea(){this.container.classList.add("highlightArea")}_download(){var ke;(ke=this.downloadManager)==null||ke.openOrDownloadData(this.container,this.content,this.filename)}}gt=new WeakMap;class ve{constructor({div:Re,accessibilityManager:ke,annotationCanvasMap:Ue,l10n:Le,page:Ke,viewport:at}){Ye(this,Lt);Ye(this,et);Ye(this,Rt,null);Ye(this,St,null);Ye(this,Bt,new Map);this.div=Re,ht(this,Rt,ke),ht(this,St,Ue),this.l10n=Le,this.page=Ke,this.viewport=at,this.zIndex=0,this.l10n||(this.l10n=X.NullL10n)}async render(Re){const{annotations:ke}=Re,Ue=this.div;(0,j.setLayerDimensions)(Ue,this.viewport);const Le=new Map,Ke={data:null,layer:Ue,linkService:Re.linkService,downloadManager:Re.downloadManager,imageResourcesPath:Re.imageResourcesPath||"",renderForms:Re.renderForms!==!1,svgFactory:new j.DOMSVGFactory,annotationStorage:Re.annotationStorage||new z.AnnotationStorage,enableScripting:Re.enableScripting===!0,hasJSActions:Re.hasJSActions,fieldObjects:Re.fieldObjects,parent:this,elements:null};for(const at of ke){if(at.noHTML)continue;const pt=at.annotationType===$.AnnotationType.POPUP;if(pt){const bt=Le.get(at.id);if(!bt)continue;Ke.elements=bt}else{const{width:bt,height:Ft}=te(at.rect);if(bt<=0||Ft<=0)continue}Ke.data=at;const wt=ee.create(Ke);if(!wt.isRenderable)continue;if(!pt&&at.popupRef){const bt=Le.get(at.popupRef);bt?bt.push(wt):Le.set(at.popupRef,[wt])}wt.annotationEditorType>0&&be(this,Bt).set(wt.data.id,wt);const At=wt.render();at.hidden&&(At.style.visibility="hidden"),st(this,Lt,cr).call(this,At,at.id)}st(this,et,Mn).call(this),await this.l10n.translate(Ue)}update({viewport:Re}){const ke=this.div;this.viewport=Re,(0,j.setLayerDimensions)(ke,{rotation:Re.rotation}),st(this,et,Mn).call(this),ke.hidden=!1}getEditableAnnotations(){return Array.from(be(this,Bt).values())}getEditableAnnotation(Re){return be(this,Bt).get(Re)}}Rt=new WeakMap,St=new WeakMap,Bt=new WeakMap,Lt=new WeakSet,cr=function(Re,ke){var Le;const Ue=Re.firstChild||Re;Ue.id=`${j.AnnotationPrefix}${ke}`,this.div.append(Re),(Le=be(this,Rt))==null||Le.moveElementInDOM(this.div,Re,Ue,!1)},et=new WeakSet,Mn=function(){if(!be(this,St))return;const Re=this.div;for(const[ke,Ue]of be(this,St)){const Le=Re.querySelector(`[data-annotation-id="${ke}"]`);if(!Le)continue;const{firstChild:Ke}=Le;Ke?Ke.nodeName==="CANVAS"?Ke.replaceWith(Ue):Ke.before(Ue):Le.append(Ue)}be(this,St).clear()},_.AnnotationLayer=ve},(q,_)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.ColorConverters=void 0;function M(j){return Math.floor(Math.max(0,Math.min(1,j))*255).toString(16).padStart(2,"0")}class ${static CMYK_G([z,V,X,G]){return["G",1-Math.min(1,.3*z+.59*X+.11*V+G)]}static G_CMYK([z]){return["CMYK",0,0,0,1-z]}static G_RGB([z]){return["RGB",z,z,z]}static G_HTML([z]){const V=M(z);return`#${V}${V}${V}`}static RGB_G([z,V,X]){return["G",.3*z+.59*V+.11*X]}static RGB_HTML([z,V,X]){const G=M(z),Y=M(V),Q=M(X);return`#${G}${Y}${Q}`}static T_HTML(){return"#00000000"}static CMYK_RGB([z,V,X,G]){return["RGB",1-Math.min(1,z+G),1-Math.min(1,X+G),1-Math.min(1,V+G)]}static CMYK_HTML(z){const V=this.CMYK_RGB(z).slice(1);return this.RGB_HTML(V)}static RGB_CMYK([z,V,X]){const G=1-z,Y=1-V,Q=1-X,Z=Math.min(G,Y,Q);return["CMYK",G,Y,Q,Z]}}_.ColorConverters=$},(q,_)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.NullL10n=void 0,_.getL10nFallback=$;const M={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image"};M.print_progress_percent="{{progress}}%";function $(V,X){switch(V){case"find_match_count":V=`find_match_count[${X.total===1?"one":"other"}]`;break;case"find_match_count_limit":V=`find_match_count_limit[${X.limit===1?"one":"other"}]`;break}return M[V]||""}function j(V,X){return X?V.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(G,Y)=>Y in X?X[Y]:"{{"+Y+"}}"):V}const z={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(V,X=null,G=$(V,X)){return j(G,X)},async translate(V){}};_.NullL10n=z},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.XfaLayer=void 0;var $=M(25);class j{static setupStorage(V,X,G,Y,Q){const Z=Y.getValue(X,{value:null});switch(G.name){case"textarea":if(Z.value!==null&&(V.textContent=Z.value),Q==="print")break;V.addEventListener("input",te=>{Y.setValue(X,{value:te.target.value})});break;case"input":if(G.attributes.type==="radio"||G.attributes.type==="checkbox"){if(Z.value===G.attributes.xfaOn?V.setAttribute("checked",!0):Z.value===G.attributes.xfaOff&&V.removeAttribute("checked"),Q==="print")break;V.addEventListener("change",te=>{Y.setValue(X,{value:te.target.checked?te.target.getAttribute("xfaOn"):te.target.getAttribute("xfaOff")})})}else{if(Z.value!==null&&V.setAttribute("value",Z.value),Q==="print")break;V.addEventListener("input",te=>{Y.setValue(X,{value:te.target.value})})}break;case"select":if(Z.value!==null){V.setAttribute("value",Z.value);for(const te of G.children)te.attributes.value===Z.value?te.attributes.selected=!0:te.attributes.hasOwnProperty("selected")&&delete te.attributes.selected}V.addEventListener("input",te=>{const ee=te.target.options,ne=ee.selectedIndex===-1?"":ee[ee.selectedIndex].value;Y.setValue(X,{value:ne})});break}}static setAttributes({html:V,element:X,storage:G=null,intent:Y,linkService:Q}){const{attributes:Z}=X,te=V instanceof HTMLAnchorElement;Z.type==="radio"&&(Z.name=`${Z.name}-${Y}`);for(const[ee,ne]of Object.entries(Z))if(ne!=null)switch(ee){case"class":ne.length&&V.setAttribute(ee,ne.join(" "));break;case"dataId":break;case"id":V.setAttribute("data-element-id",ne);break;case"style":Object.assign(V.style,ne);break;case"textContent":V.textContent=ne;break;default:(!te||ee!=="href"&&ee!=="newWindow")&&V.setAttribute(ee,ne)}te&&Q.addLinkAttributes(V,Z.href,Z.newWindow),G&&Z.dataId&&this.setupStorage(V,Z.dataId,X,G)}static render(V){var re;const X=V.annotationStorage,G=V.linkService,Y=V.xfaHtml,Q=V.intent||"display",Z=document.createElement(Y.name);Y.attributes&&this.setAttributes({html:Z,element:Y,intent:Q,linkService:G});const te=[[Y,-1,Z]],ee=V.div;if(ee.append(Z),V.viewport){const se=`matrix(${V.viewport.transform.join(",")})`;ee.style.transform=se}Q!=="richText"&&ee.setAttribute("class","xfaLayer xfaFont");const ne=[];for(;te.length>0;){const[se,ie,oe]=te.at(-1);if(ie+1===se.children.length){te.pop();continue}const he=se.children[++te.at(-1)[1]];if(he===null)continue;const{name:le}=he;if(le==="#text"){const ue=document.createTextNode(he.value);ne.push(ue),oe.append(ue);continue}const ae=(re=he==null?void 0:he.attributes)!=null&&re.xmlns?document.createElementNS(he.attributes.xmlns,le):document.createElement(le);if(oe.append(ae),he.attributes&&this.setAttributes({html:ae,element:he,storage:X,intent:Q,linkService:G}),he.children&&he.children.length>0)te.push([he,-1,ae]);else if(he.value){const ue=document.createTextNode(he.value);$.XfaText.shouldBuildText(le)&&ne.push(ue),ae.append(ue)}}for(const se of ee.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))se.setAttribute("readOnly",!0);return{textDivs:ne}}static update(V){const X=`matrix(${V.viewport.transform.join(",")})`;V.div.style.transform=X,V.div.hidden=!1}}_.XfaLayer=j},(q,_,M)=>{var G,Y,Q,Z,te,ee,ne,re,se,ie,oe,he,le,ae,ue,me,hr,ce,dr,we,fr,Ae,pr,De,On,Ee,_r,xe,Ln,Oe,mr,Pe,gr,ye,br,je,yr,Ne,vr,Ze,qt,ot,Nn,We,cn,Ce,hn,Ge,Qt,ct,$n,Ve,dn,Je,wr,_t,Un,Ct,Dr,xt,Ar,Dt,jn,it,fn,gt,Zt;Object.defineProperty(_,"__esModule",{value:!0}),_.InkEditor=void 0;var $=M(1),j=M(4),z=M(29),V=M(5);const St=class extends j.AnnotationEditor{constructor(Se){super({...Se,name:"inkEditor"});Ye(this,me);Ye(this,ce);Ye(this,we);Ye(this,Ae);Ye(this,De);Ye(this,Ee);Ye(this,xe);Ye(this,Oe);Ye(this,Pe);Ye(this,ye);Ye(this,je);Ye(this,Ne);Ye(this,Ze);Ye(this,ot);Ye(this,We);Ye(this,Ce);Ye(this,Ge);Ye(this,ct);Ye(this,Ve);Ye(this,xt);Ye(this,Dt);Ye(this,it);Ye(this,gt);Ye(this,G,0);Ye(this,Y,0);Ye(this,Q,this.canvasContextMenu.bind(this));Ye(this,Z,this.canvasPointermove.bind(this));Ye(this,te,this.canvasPointerleave.bind(this));Ye(this,ee,this.canvasPointerup.bind(this));Ye(this,ne,this.canvasPointerdown.bind(this));Ye(this,re,new Path2D);Ye(this,se,!1);Ye(this,ie,!1);Ye(this,oe,!1);Ye(this,he,null);Ye(this,le,0);Ye(this,ae,0);Ye(this,ue,null);this.color=Se.color||null,this.thickness=Se.thickness||null,this.opacity=Se.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(Se){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink2_aria_label"].map(et=>[et,Se.get(et)]))}static updateDefaultParams(Se,et){switch(Se){case $.AnnotationEditorParamsType.INK_THICKNESS:St._defaultThickness=et;break;case $.AnnotationEditorParamsType.INK_COLOR:St._defaultColor=et;break;case $.AnnotationEditorParamsType.INK_OPACITY:St._defaultOpacity=et/100;break}}updateParams(Se,et){switch(Se){case $.AnnotationEditorParamsType.INK_THICKNESS:st(this,me,hr).call(this,et);break;case $.AnnotationEditorParamsType.INK_COLOR:st(this,ce,dr).call(this,et);break;case $.AnnotationEditorParamsType.INK_OPACITY:st(this,we,fr).call(this,et);break}}static get defaultPropertiesToUpdate(){return[[$.AnnotationEditorParamsType.INK_THICKNESS,St._defaultThickness],[$.AnnotationEditorParamsType.INK_COLOR,St._defaultColor||j.AnnotationEditor._defaultLineColor],[$.AnnotationEditorParamsType.INK_OPACITY,Math.round(St._defaultOpacity*100)]]}get propertiesToUpdate(){return[[$.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||St._defaultThickness],[$.AnnotationEditorParamsType.INK_COLOR,this.color||St._defaultColor||j.AnnotationEditor._defaultLineColor],[$.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??St._defaultOpacity))]]}rebuild(){super.rebuild(),this.div!==null&&(this.canvas||(st(this,We,cn).call(this),st(this,Ce,hn).call(this)),this.isAttachedToDOM||(this.parent.add(this),st(this,Ge,Qt).call(this)),st(this,gt,Zt).call(this))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,be(this,he).disconnect(),ht(this,he,null),super.remove())}setParent(Se){!this.parent&&Se?this._uiManager.removeShouldRescale(this):this.parent&&Se===null&&this._uiManager.addShouldRescale(this),super.setParent(Se)}onScaleChanging(){const[Se,et]=this.parentDimensions,ft=this.width*Se,dt=this.height*et;this.setDimensions(ft,dt)}enableEditMode(){be(this,se)||this.canvas===null||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",be(this,ne)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",be(this,ne)))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){be(this,se)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),ht(this,se,!0),this.div.classList.add("disabled"),st(this,gt,Zt).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus({preventScroll:!0}))}focusin(Se){super.focusin(Se),this.enableEditMode()}canvasPointerdown(Se){Se.button!==0||!this.isInEditMode()||be(this,se)||(this.setInForeground(),Se.preventDefault(),Se.type!=="mouse"&&this.div.focus(),st(this,Ee,_r).call(this,Se.offsetX,Se.offsetY))}canvasContextMenu(Se){Se.preventDefault()}canvasPointermove(Se){Se.preventDefault(),st(this,xe,Ln).call(this,Se.offsetX,Se.offsetY)}canvasPointerup(Se){Se.preventDefault(),st(this,ot,Nn).call(this,Se)}canvasPointerleave(Se){st(this,ot,Nn).call(this,Se)}get isResizable(){return!this.isEmpty()&&be(this,se)}render(){if(this.div)return this.div;let Se,et;this.width&&(Se=this.x,et=this.y),super.render(),St._l10nPromise.get("editor_ink2_aria_label").then(Ue=>{var Le;return(Le=this.div)==null?void 0:Le.setAttribute("aria-label",Ue)});const[ft,dt,Re,ke]=st(this,Ae,pr).call(this);if(this.setAt(ft,dt,0,0),this.setDims(Re,ke),st(this,We,cn).call(this),this.width){const[Ue,Le]=this.parentDimensions;this.setAspectRatio(this.width*Ue,this.height*Le),this.setAt(Se*Ue,et*Le,this.width*Ue,this.height*Le),ht(this,oe,!0),st(this,Ge,Qt).call(this),this.setDims(this.width*Ue,this.height*Le),st(this,Ze,qt).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return st(this,Ce,hn).call(this),this.div}setDimensions(Se,et){const ft=Math.round(Se),dt=Math.round(et);if(be(this,le)===ft&&be(this,ae)===dt)return;ht(this,le,ft),ht(this,ae,dt),this.canvas.style.visibility="hidden";const[Re,ke]=this.parentDimensions;this.width=Se/Re,this.height=et/ke,this.fixAndSetPosition(),be(this,se)&&st(this,ct,$n).call(this,Se,et),st(this,Ge,Qt).call(this),st(this,Ze,qt).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(Se,et,ft){var Ft,yt,vt;if(Se instanceof z.InkAnnotationElement)return null;const dt=super.deserialize(Se,et,ft);dt.thickness=Se.thickness,dt.color=$.Util.makeHexColor(...Se.color),dt.opacity=Se.opacity;const[Re,ke]=dt.pageDimensions,Ue=dt.width*Re,Le=dt.height*ke,Ke=dt.parentScale,at=Se.thickness/2;ht(dt,se,!0),ht(dt,le,Math.round(Ue)),ht(dt,ae,Math.round(Le));const{paths:pt,rect:wt,rotation:At}=Se;for(let{bezier:kt}of pt){kt=st(Ft=St,Ct,Dr).call(Ft,kt,wt,At);const Pt=[];dt.paths.push(Pt);let It=Ke*(kt[0]-at),Mt=Ke*(kt[1]-at);for(let Ot=2,Ut=kt.length;Ot<Ut;Ot+=6){const zt=Ke*(kt[Ot]-at),jt=Ke*(kt[Ot+1]-at),Vt=Ke*(kt[Ot+2]-at),Sr=Ke*(kt[Ot+3]-at),Wn=Ke*(kt[Ot+4]-at),qn=Ke*(kt[Ot+5]-at);Pt.push([[It,Mt],[zt,jt],[Vt,Sr],[Wn,qn]]),It=Wn,Mt=qn}const $t=st(this,Je,wr).call(this,Pt);dt.bezierPath2D.push($t)}const bt=st(yt=dt,Dt,jn).call(yt);return ht(dt,Y,Math.max(j.AnnotationEditor.MIN_SIZE,bt[2]-bt[0])),ht(dt,G,Math.max(j.AnnotationEditor.MIN_SIZE,bt[3]-bt[1])),st(vt=dt,ct,$n).call(vt,Ue,Le),dt}serialize(){if(this.isEmpty())return null;const Se=this.getRect(0,0),et=j.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:$.AnnotationEditorType.INK,color:et,thickness:this.thickness,opacity:this.opacity,paths:st(this,xt,Ar).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,Se),pageIndex:this.pageIndex,rect:Se,rotation:this.rotation}}};let X=St;G=new WeakMap,Y=new WeakMap,Q=new WeakMap,Z=new WeakMap,te=new WeakMap,ee=new WeakMap,ne=new WeakMap,re=new WeakMap,se=new WeakMap,ie=new WeakMap,oe=new WeakMap,he=new WeakMap,le=new WeakMap,ae=new WeakMap,ue=new WeakMap,me=new WeakSet,hr=function(Se){const et=this.thickness;this.addCommands({cmd:()=>{this.thickness=Se,st(this,gt,Zt).call(this)},undo:()=>{this.thickness=et,st(this,gt,Zt).call(this)},mustExec:!0,type:$.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},ce=new WeakSet,dr=function(Se){const et=this.color;this.addCommands({cmd:()=>{this.color=Se,st(this,Ze,qt).call(this)},undo:()=>{this.color=et,st(this,Ze,qt).call(this)},mustExec:!0,type:$.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},we=new WeakSet,fr=function(Se){Se/=100;const et=this.opacity;this.addCommands({cmd:()=>{this.opacity=Se,st(this,Ze,qt).call(this)},undo:()=>{this.opacity=et,st(this,Ze,qt).call(this)},mustExec:!0,type:$.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},Ae=new WeakSet,pr=function(){const{parentRotation:Se,parentDimensions:[et,ft]}=this;switch(Se){case 90:return[0,ft,ft,et];case 180:return[et,ft,et,ft];case 270:return[et,0,ft,et];default:return[0,0,et,ft]}},De=new WeakSet,On=function(){const{ctx:Se,color:et,opacity:ft,thickness:dt,parentScale:Re,scaleFactor:ke}=this;Se.lineWidth=dt*Re/ke,Se.lineCap="round",Se.lineJoin="round",Se.miterLimit=10,Se.strokeStyle=`${et}${(0,V.opacityToHex)(ft)}`},Ee=new WeakSet,_r=function(Se,et){this.canvas.addEventListener("contextmenu",be(this,Q)),this.canvas.addEventListener("pointerleave",be(this,te)),this.canvas.addEventListener("pointermove",be(this,Z)),this.canvas.addEventListener("pointerup",be(this,ee)),this.canvas.removeEventListener("pointerdown",be(this,ne)),this.isEditing=!0,be(this,oe)||(ht(this,oe,!0),st(this,Ge,Qt).call(this),this.thickness||(this.thickness=St._defaultThickness),this.color||(this.color=St._defaultColor||j.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=St._defaultOpacity)),this.currentPath.push([Se,et]),ht(this,ie,!1),st(this,De,On).call(this),ht(this,ue,()=>{st(this,ye,br).call(this),be(this,ue)&&window.requestAnimationFrame(be(this,ue))}),window.requestAnimationFrame(be(this,ue))},xe=new WeakSet,Ln=function(Se,et){const[ft,dt]=this.currentPath.at(-1);if(this.currentPath.length>1&&Se===ft&&et===dt)return;const Re=this.currentPath;let ke=be(this,re);if(Re.push([Se,et]),ht(this,ie,!0),Re.length<=2){ke.moveTo(...Re[0]),ke.lineTo(Se,et);return}Re.length===3&&(ht(this,re,ke=new Path2D),ke.moveTo(...Re[0])),st(this,je,yr).call(this,ke,...Re.at(-3),...Re.at(-2),Se,et)},Oe=new WeakSet,mr=function(){if(this.currentPath.length===0)return;const Se=this.currentPath.at(-1);be(this,re).lineTo(...Se)},Pe=new WeakSet,gr=function(Se,et){ht(this,ue,null),Se=Math.min(Math.max(Se,0),this.canvas.width),et=Math.min(Math.max(et,0),this.canvas.height),st(this,xe,Ln).call(this,Se,et),st(this,Oe,mr).call(this);let ft;if(this.currentPath.length!==1)ft=st(this,Ne,vr).call(this);else{const Le=[Se,et];ft=[[Le,Le.slice(),Le.slice(),Le]]}const dt=be(this,re),Re=this.currentPath;this.currentPath=[],ht(this,re,new Path2D);const ke=()=>{this.allRawPaths.push(Re),this.paths.push(ft),this.bezierPath2D.push(dt),this.rebuild()},Ue=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(st(this,We,cn).call(this),st(this,Ce,hn).call(this)),st(this,gt,Zt).call(this))};this.addCommands({cmd:ke,undo:Ue,mustExec:!0})},ye=new WeakSet,br=function(){if(!be(this,ie))return;ht(this,ie,!1);const Se=Math.ceil(this.thickness*this.parentScale),et=this.currentPath.slice(-3),ft=et.map(ke=>ke[0]),dt=et.map(ke=>ke[1]);Math.min(...ft)-Se,Math.max(...ft)+Se,Math.min(...dt)-Se,Math.max(...dt)+Se;const{ctx:Re}=this;Re.save(),Re.clearRect(0,0,this.canvas.width,this.canvas.height);for(const ke of this.bezierPath2D)Re.stroke(ke);Re.stroke(be(this,re)),Re.restore()},je=new WeakSet,yr=function(Se,et,ft,dt,Re,ke,Ue){const Le=(et+dt)/2,Ke=(ft+Re)/2,at=(dt+ke)/2,pt=(Re+Ue)/2;Se.bezierCurveTo(Le+2*(dt-Le)/3,Ke+2*(Re-Ke)/3,at+2*(dt-at)/3,pt+2*(Re-pt)/3,at,pt)},Ne=new WeakSet,vr=function(){const Se=this.currentPath;if(Se.length<=2)return[[Se[0],Se[0],Se.at(-1),Se.at(-1)]];const et=[];let ft,[dt,Re]=Se[0];for(ft=1;ft<Se.length-2;ft++){const[wt,At]=Se[ft],[bt,Ft]=Se[ft+1],yt=(wt+bt)/2,vt=(At+Ft)/2,kt=[dt+2*(wt-dt)/3,Re+2*(At-Re)/3],Pt=[yt+2*(wt-yt)/3,vt+2*(At-vt)/3];et.push([[dt,Re],kt,Pt,[yt,vt]]),[dt,Re]=[yt,vt]}const[ke,Ue]=Se[ft],[Le,Ke]=Se[ft+1],at=[dt+2*(ke-dt)/3,Re+2*(Ue-Re)/3],pt=[Le+2*(ke-Le)/3,Ke+2*(Ue-Ke)/3];return et.push([[dt,Re],at,pt,[Le,Ke]]),et},Ze=new WeakSet,qt=function(){if(this.isEmpty()){st(this,Ve,dn).call(this);return}st(this,De,On).call(this);const{canvas:Se,ctx:et}=this;et.setTransform(1,0,0,1,0,0),et.clearRect(0,0,Se.width,Se.height),st(this,Ve,dn).call(this);for(const ft of this.bezierPath2D)et.stroke(ft)},ot=new WeakSet,Nn=function(Se){this.canvas.removeEventListener("pointerleave",be(this,te)),this.canvas.removeEventListener("pointermove",be(this,Z)),this.canvas.removeEventListener("pointerup",be(this,ee)),this.canvas.addEventListener("pointerdown",be(this,ne)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",be(this,Q))},10),st(this,Pe,gr).call(this,Se.offsetX,Se.offsetY),this.addToAnnotationStorage(),this.setInBackground()},We=new WeakSet,cn=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",St._l10nPromise.get("editor_ink_canvas_aria_label").then(Se=>{var et;return(et=this.canvas)==null?void 0:et.setAttribute("aria-label",Se)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},Ce=new WeakSet,hn=function(){ht(this,he,new ResizeObserver(Se=>{const et=Se[0].contentRect;et.width&&et.height&&this.setDimensions(et.width,et.height)})),be(this,he).observe(this.div)},Ge=new WeakSet,Qt=function(){if(!be(this,oe))return;const[Se,et]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*Se),this.canvas.height=Math.ceil(this.height*et),st(this,Ve,dn).call(this)},ct=new WeakSet,$n=function(Se,et){const ft=st(this,it,fn).call(this),dt=(Se-ft)/be(this,Y),Re=(et-ft)/be(this,G);this.scaleFactor=Math.min(dt,Re)},Ve=new WeakSet,dn=function(){const Se=st(this,it,fn).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+Se,this.translationY*this.scaleFactor+Se)},Je=new WeakSet,wr=function(Se){const et=new Path2D;for(let ft=0,dt=Se.length;ft<dt;ft++){const[Re,ke,Ue,Le]=Se[ft];ft===0&&et.moveTo(...Re),et.bezierCurveTo(ke[0],ke[1],Ue[0],Ue[1],Le[0],Le[1])}return et},_t=new WeakSet,Un=function(Se,et,ft){const[dt,Re,ke,Ue]=et;switch(ft){case 0:for(let Le=0,Ke=Se.length;Le<Ke;Le+=2)Se[Le]+=dt,Se[Le+1]=Ue-Se[Le+1];break;case 90:for(let Le=0,Ke=Se.length;Le<Ke;Le+=2){const at=Se[Le];Se[Le]=Se[Le+1]+dt,Se[Le+1]=at+Re}break;case 180:for(let Le=0,Ke=Se.length;Le<Ke;Le+=2)Se[Le]=ke-Se[Le],Se[Le+1]+=Re;break;case 270:for(let Le=0,Ke=Se.length;Le<Ke;Le+=2){const at=Se[Le];Se[Le]=ke-Se[Le+1],Se[Le+1]=Ue-at}break;default:throw new Error("Invalid rotation")}return Se},Ct=new WeakSet,Dr=function(Se,et,ft){const[dt,Re,ke,Ue]=et;switch(ft){case 0:for(let Le=0,Ke=Se.length;Le<Ke;Le+=2)Se[Le]-=dt,Se[Le+1]=Ue-Se[Le+1];break;case 90:for(let Le=0,Ke=Se.length;Le<Ke;Le+=2){const at=Se[Le];Se[Le]=Se[Le+1]-Re,Se[Le+1]=at-dt}break;case 180:for(let Le=0,Ke=Se.length;Le<Ke;Le+=2)Se[Le]=ke-Se[Le],Se[Le+1]-=Re;break;case 270:for(let Le=0,Ke=Se.length;Le<Ke;Le+=2){const at=Se[Le];Se[Le]=Ue-Se[Le+1],Se[Le+1]=ke-at}break;default:throw new Error("Invalid rotation")}return Se},xt=new WeakSet,Ar=function(Se,et,ft,dt){var Ke,at;const Re=[],ke=this.thickness/2,Ue=Se*et+ke,Le=Se*ft+ke;for(const pt of this.paths){const wt=[],At=[];for(let bt=0,Ft=pt.length;bt<Ft;bt++){const[yt,vt,kt,Pt]=pt[bt],It=Se*yt[0]+Ue,Mt=Se*yt[1]+Le,$t=Se*vt[0]+Ue,Ot=Se*vt[1]+Le,Ut=Se*kt[0]+Ue,zt=Se*kt[1]+Le,jt=Se*Pt[0]+Ue,Vt=Se*Pt[1]+Le;bt===0&&(wt.push(It,Mt),At.push(It,Mt)),wt.push($t,Ot,Ut,zt,jt,Vt),At.push($t,Ot),bt===Ft-1&&At.push(jt,Vt)}Re.push({bezier:st(Ke=St,_t,Un).call(Ke,wt,dt,this.rotation),points:st(at=St,_t,Un).call(at,At,dt,this.rotation)})}return Re},Dt=new WeakSet,jn=function(){let Se=1/0,et=-1/0,ft=1/0,dt=-1/0;for(const Re of this.paths)for(const[ke,Ue,Le,Ke]of Re){const at=$.Util.bezierBoundingBox(...ke,...Ue,...Le,...Ke);Se=Math.min(Se,at[0]),ft=Math.min(ft,at[1]),et=Math.max(et,at[2]),dt=Math.max(dt,at[3])}return[Se,ft,et,dt]},it=new WeakSet,fn=function(){return be(this,se)?Math.ceil(this.thickness*this.parentScale):0},gt=new WeakSet,Zt=function(Se=!1){if(this.isEmpty())return;if(!be(this,se)){st(this,Ze,qt).call(this);return}const et=st(this,Dt,jn).call(this),ft=st(this,it,fn).call(this);ht(this,Y,Math.max(j.AnnotationEditor.MIN_SIZE,et[2]-et[0])),ht(this,G,Math.max(j.AnnotationEditor.MIN_SIZE,et[3]-et[1]));const dt=Math.ceil(ft+be(this,Y)*this.scaleFactor),Re=Math.ceil(ft+be(this,G)*this.scaleFactor),[ke,Ue]=this.parentDimensions;this.width=dt/ke,this.height=Re/Ue,this.setAspectRatio(dt,Re);const Le=this.translationX,Ke=this.translationY;this.translationX=-et[0],this.translationY=-et[1],st(this,Ge,Qt).call(this),st(this,Ze,qt).call(this),ht(this,le,dt),ht(this,ae,Re),this.setDims(dt,Re);const at=Se?ft/this.scaleFactor/2:0;this.translate(Le-this.translationX-at,Ke-this.translationY-at)},Ye(X,Je),Ye(X,_t),Ye(X,Ct),Nt(X,"_defaultColor",null),Nt(X,"_defaultOpacity",1),Nt(X,"_defaultThickness",1),Nt(X,"_l10nPromise"),Nt(X,"_type","ink"),_.InkEditor=X},(q,_,M)=>{var G,Y,Q,Z,te,ee,ne,re,se,zn,oe,sn,le,Er,ue,kr,fe,Hn,_e,pn,ge,Cr;Object.defineProperty(_,"__esModule",{value:!0}),_.StampEditor=void 0;var $=M(4),j=M(1),z=M(6),V=M(29);class X extends $.AnnotationEditor{constructor(Me){super({...Me,name:"stampEditor"});Ye(this,se);Ye(this,oe);Ye(this,le);Ye(this,ue);Ye(this,fe);Ye(this,_e);Ye(this,ge);Ye(this,G,null);Ye(this,Y,null);Ye(this,Q,null);Ye(this,Z,null);Ye(this,te,null);Ye(this,ee,null);Ye(this,ne,null);Ye(this,re,!1);ht(this,Z,Me.bitmapUrl)}remove(){var Me,Ee;be(this,Y)&&(ht(this,G,null),this._uiManager.imageManager.deleteId(be(this,Y)),(Me=be(this,te))==null||Me.remove(),ht(this,te,null),(Ee=be(this,ee))==null||Ee.disconnect(),ht(this,ee,null)),super.remove()}rebuild(){super.rebuild(),this.div!==null&&(be(this,Y)&&st(this,se,zn).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this.div.draggable=!0,this.parent.addUndoableEditor(this),this.div.focus()}isEmpty(){return be(this,Q)===null&&be(this,G)===null&&be(this,Z)===null}get isResizable(){return!0}render(){if(this.div)return this.div;let Me,Ee;if(this.width&&(Me=this.x,Ee=this.y),super.render(),be(this,G)?st(this,oe,sn).call(this):(this.div.classList.add("loading"),st(this,se,zn).call(this)),this.width){const[Te,xe]=this.parentDimensions;this.setAt(Me*Te,Ee*xe,this.width*Te,this.height*xe)}return this.div}static deserialize(Me,Ee,Te){if(Me instanceof V.StampAnnotationElement)return null;const xe=super.deserialize(Me,Ee,Te),{rect:He,bitmapUrl:Oe,bitmapId:$e,isSvg:Pe}=Me;$e&&Te.imageManager.isValidId($e)?ht(xe,Y,$e):ht(xe,Z,Oe),ht(xe,re,Pe);const[ve,ye]=xe.pageDimensions;return xe.width=(He[2]-He[0])/ve,xe.height=(He[3]-He[1])/ye,xe}serialize(Me=!1,Ee=null){if(this.isEmpty())return null;const Te={annotationType:j.AnnotationEditorType.STAMP,bitmapId:be(this,Y),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:be(this,re)};if(Me)return Te.bitmapUrl=st(this,_e,pn).call(this,!0),Te;if(Ee===null)return Te;Ee.stamps||(Ee.stamps=new Map);const xe=be(this,re)?(Te.rect[2]-Te.rect[0])*(Te.rect[3]-Te.rect[1]):null;if(!Ee.stamps.has(be(this,Y)))Ee.stamps.set(be(this,Y),{area:xe,serialized:Te}),Te.bitmap=st(this,_e,pn).call(this,!1);else if(be(this,re)){const He=Ee.stamps.get(be(this,Y));xe>He.area&&(He.area=xe,He.serialized.bitmap.close(),He.serialized.bitmap=st(this,_e,pn).call(this,!1))}return Te}}G=new WeakMap,Y=new WeakMap,Q=new WeakMap,Z=new WeakMap,te=new WeakMap,ee=new WeakMap,ne=new WeakMap,re=new WeakMap,se=new WeakSet,zn=function(){if(be(this,Y)){this._uiManager.imageManager.getFromId(be(this,Y)).then(Ee=>{if(!Ee){this.remove();return}ht(this,G,Ee.bitmap),st(this,oe,sn).call(this)});return}if(be(this,Z)){const Ee=be(this,Z);ht(this,Z,null),ht(this,Q,this._uiManager.imageManager.getFromUrl(Ee).then(Te=>{if(ht(this,Q,null),!Te){this.remove();return}({bitmap:Wt(this,G)._,id:Wt(this,Y)._,isSvg:Wt(this,re)._}=Te),st(this,oe,sn).call(this)}));return}const Me=document.createElement("input");Me.type="file",Me.accept="image/*",ht(this,Q,new Promise(Ee=>{Me.addEventListener("change",async()=>{if(ht(this,Q,null),!Me.files||Me.files.length===0)this.remove();else{const Te=await this._uiManager.imageManager.getFromFile(Me.files[0]);if(!Te){this.remove();return}({bitmap:Wt(this,G)._,id:Wt(this,Y)._,isSvg:Wt(this,re)._}=Te),st(this,oe,sn).call(this)}Ee()}),Me.addEventListener("cancel",()=>{ht(this,Q,null),this.remove(),Ee()})})),Me.click()},oe=new WeakSet,sn=function(){const{div:Me}=this;let{width:Ee,height:Te}=be(this,G);const[xe,He]=this.pageDimensions,Oe=.75;if(this.width)Ee=this.width*xe,Te=this.height*He;else if(Ee>Oe*xe||Te>Oe*He){const ye=Math.min(Oe*xe/Ee,Oe*He/Te);Ee*=ye,Te*=ye}const[$e,Pe]=this.parentDimensions;this.setDims(Ee*$e/xe,Te*Pe/He);const ve=ht(this,te,document.createElement("canvas"));Me.append(ve),st(this,fe,Hn).call(this,Ee,Te),st(this,ge,Cr).call(this),Me.classList.remove("loading")},le=new WeakSet,Er=function(Me,Ee){const[Te,xe]=this.parentDimensions;this.width=Me/Te,this.height=Ee/xe,this.setDims(Me,Ee),this.fixAndSetPosition(),be(this,ne)!==null&&clearTimeout(be(this,ne)),ht(this,ne,setTimeout(()=>{ht(this,ne,null),st(this,fe,Hn).call(this,Me,Ee)},200))},ue=new WeakSet,kr=function(Me,Ee){const{width:Te,height:xe}=be(this,G);let He=Te,Oe=xe,$e=be(this,G);for(;He>2*Me||Oe>2*Ee;){const Pe=He,ve=Oe;He>2*Me&&(He=He>=16384?Math.floor(He/2)-1:Math.ceil(He/2)),Oe>2*Ee&&(Oe=Oe>=16384?Math.floor(Oe/2)-1:Math.ceil(Oe/2));const ye=new OffscreenCanvas(He,Oe);ye.getContext("2d").drawImage($e,0,0,Pe,ve,0,0,He,Oe),$e=ye.transferToImageBitmap()}return $e},fe=new WeakSet,Hn=function(Me,Ee){const Te=be(this,te);if(!Te||Te.width===Me&&Te.height===Ee)return;Te.width=Me,Te.height=Ee;const xe=be(this,re)?be(this,G):st(this,ue,kr).call(this,Me,Ee),He=Te.getContext("2d");He.filter=this._uiManager.hcmFilter,He.drawImage(xe,0,0,xe.width,xe.height,0,0,Me,Ee)},_e=new WeakSet,pn=function(Me){if(Me){if(be(this,re)){const xe=this._uiManager.imageManager.getSvgUrl(be(this,Y));if(xe)return xe}const Ee=document.createElement("canvas");return{width:Ee.width,height:Ee.height}=be(this,G),Ee.getContext("2d").drawImage(be(this,G),0,0),Ee.toDataURL()}if(be(this,re)){const[Ee,Te]=this.pageDimensions,xe=Math.round(this.width*Ee*z.PixelsPerInch.PDF_TO_CSS_UNITS),He=Math.round(this.height*Te*z.PixelsPerInch.PDF_TO_CSS_UNITS),Oe=new OffscreenCanvas(xe,He);return Oe.getContext("2d").drawImage(be(this,G),0,0,be(this,G).width,be(this,G).height,0,0,xe,He),Oe.transferToImageBitmap()}return structuredClone(be(this,G))},ge=new WeakSet,Cr=function(){ht(this,ee,new ResizeObserver(Me=>{const Ee=Me[0].contentRect;Ee.width&&Ee.height&&st(this,le,Er).call(this,Ee.width,Ee.height)})),be(this,ee).observe(this.div)},Nt(X,"_type","stamp"),_.StampEditor=X}],__webpack_module_cache__={};function __w_pdfjs_require__(q){var _=__webpack_module_cache__[q];if(_!==void 0)return _.exports;var M=__webpack_module_cache__[q]={exports:{}};return __webpack_modules__[q](M,M.exports,__w_pdfjs_require__),M.exports}var __webpack_exports__={};return(()=>{var q=__webpack_exports__;Object.defineProperty(q,"__esModule",{value:!0}),Object.defineProperty(q,"AbortException",{enumerable:!0,get:function(){return _.AbortException}}),Object.defineProperty(q,"AnnotationEditorLayer",{enumerable:!0,get:function(){return z.AnnotationEditorLayer}}),Object.defineProperty(q,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return _.AnnotationEditorParamsType}}),Object.defineProperty(q,"AnnotationEditorType",{enumerable:!0,get:function(){return _.AnnotationEditorType}}),Object.defineProperty(q,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return V.AnnotationEditorUIManager}}),Object.defineProperty(q,"AnnotationLayer",{enumerable:!0,get:function(){return X.AnnotationLayer}}),Object.defineProperty(q,"AnnotationMode",{enumerable:!0,get:function(){return _.AnnotationMode}}),Object.defineProperty(q,"CMapCompressionType",{enumerable:!0,get:function(){return _.CMapCompressionType}}),Object.defineProperty(q,"FeatureTest",{enumerable:!0,get:function(){return _.FeatureTest}}),Object.defineProperty(q,"GlobalWorkerOptions",{enumerable:!0,get:function(){return G.GlobalWorkerOptions}}),Object.defineProperty(q,"ImageKind",{enumerable:!0,get:function(){return _.ImageKind}}),Object.defineProperty(q,"InvalidPDFException",{enumerable:!0,get:function(){return _.InvalidPDFException}}),Object.defineProperty(q,"MissingPDFException",{enumerable:!0,get:function(){return _.MissingPDFException}}),Object.defineProperty(q,"OPS",{enumerable:!0,get:function(){return _.OPS}}),Object.defineProperty(q,"PDFDataRangeTransport",{enumerable:!0,get:function(){return M.PDFDataRangeTransport}}),Object.defineProperty(q,"PDFDateString",{enumerable:!0,get:function(){return $.PDFDateString}}),Object.defineProperty(q,"PDFWorker",{enumerable:!0,get:function(){return M.PDFWorker}}),Object.defineProperty(q,"PasswordResponses",{enumerable:!0,get:function(){return _.PasswordResponses}}),Object.defineProperty(q,"PermissionFlag",{enumerable:!0,get:function(){return _.PermissionFlag}}),Object.defineProperty(q,"PixelsPerInch",{enumerable:!0,get:function(){return $.PixelsPerInch}}),Object.defineProperty(q,"PromiseCapability",{enumerable:!0,get:function(){return _.PromiseCapability}}),Object.defineProperty(q,"RenderingCancelledException",{enumerable:!0,get:function(){return $.RenderingCancelledException}}),Object.defineProperty(q,"SVGGraphics",{enumerable:!0,get:function(){return M.SVGGraphics}}),Object.defineProperty(q,"UnexpectedResponseException",{enumerable:!0,get:function(){return _.UnexpectedResponseException}}),Object.defineProperty(q,"Util",{enumerable:!0,get:function(){return _.Util}}),Object.defineProperty(q,"VerbosityLevel",{enumerable:!0,get:function(){return _.VerbosityLevel}}),Object.defineProperty(q,"XfaLayer",{enumerable:!0,get:function(){return Y.XfaLayer}}),Object.defineProperty(q,"build",{enumerable:!0,get:function(){return M.build}}),Object.defineProperty(q,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return _.createValidAbsoluteUrl}}),Object.defineProperty(q,"getDocument",{enumerable:!0,get:function(){return M.getDocument}}),Object.defineProperty(q,"getFilenameFromUrl",{enumerable:!0,get:function(){return $.getFilenameFromUrl}}),Object.defineProperty(q,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return $.getPdfFilenameFromUrl}}),Object.defineProperty(q,"getXfaPageViewport",{enumerable:!0,get:function(){return $.getXfaPageViewport}}),Object.defineProperty(q,"isDataScheme",{enumerable:!0,get:function(){return $.isDataScheme}}),Object.defineProperty(q,"isPdfFile",{enumerable:!0,get:function(){return $.isPdfFile}}),Object.defineProperty(q,"loadScript",{enumerable:!0,get:function(){return $.loadScript}}),Object.defineProperty(q,"normalizeUnicode",{enumerable:!0,get:function(){return _.normalizeUnicode}}),Object.defineProperty(q,"renderTextLayer",{enumerable:!0,get:function(){return j.renderTextLayer}}),Object.defineProperty(q,"setLayerDimensions",{enumerable:!0,get:function(){return $.setLayerDimensions}}),Object.defineProperty(q,"shadow",{enumerable:!0,get:function(){return _.shadow}}),Object.defineProperty(q,"updateTextLayer",{enumerable:!0,get:function(){return j.updateTextLayer}}),Object.defineProperty(q,"version",{enumerable:!0,get:function(){return M.version}});var _=__w_pdfjs_require__(1),M=__w_pdfjs_require__(2),$=__w_pdfjs_require__(6),j=__w_pdfjs_require__(26),z=__w_pdfjs_require__(27),V=__w_pdfjs_require__(5),X=__w_pdfjs_require__(29),G=__w_pdfjs_require__(14),Y=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;const onPrint=q=>{let _;_||(_=document.createElement("iframe"),document.body.appendChild(_),_.style.display="none",_.onload=function(){setTimeout(function(){_.focus(),_.contentWindow.print()},1)}),_.src=q},calcRT=q=>{let M=q.split(" ").length;if(M>0)return Math.ceil(M/200)},getPageText=(q,_)=>new Promise(function(M,$){_.getPage(q).then(function(j){j.getTextContent().then(function(z){for(var V=z.items,X="",G=0;G<V.length;G++){var Y=V[G];X+=Y.str+" "}M(X)})})}),savePDF=async({fileUrl:q,data:_,name:M="download.pdf"})=>{const $=document.createElement("a");$.download=M,$.rel="noopener",q||(q=`data:application/pdf;base64,${btoa(_)}`);let j=await fetch(q).then(V=>V.blob());(!j||!(j instanceof Blob))&&console.log("Invalid blob object passed to URL.createObjectURL()"),typeof URL.createObjectURL>"u"&&console.log("Your browser does not support URL.createObjectURL()");const z=URL.createObjectURL(j);$.href=z,$.click(),URL.revokeObjectURL($.href)};class ClassBuilder{constructor(_,M){this.defaults=typeof _=="function"?_(M):_,this.classes=this.defaults}flush(){return this.classes=this.defaults,this}extend(..._){return this}get(){return this.classes}replace(_,M=!0){return M&&_&&(this.classes=Object.keys(_).reduce(($,j)=>$.replace(new RegExp(j,"g"),_[j]),this.classes)),this}remove(_,M=!0){return M&&_&&(this.classes=_.split(" ").reduce(($,j)=>$.replace(new RegExp(j,"g"),""),this.classes)),this}add(_,M=!0,$){if(!M||!_)return this;switch(typeof _){case"string":default:return this.classes+=` ${_} `,this;case"function":return this.classes+=` ${_($||this.classes)} `,this}}}const Tooltip_svelte_svelte_type_style_lang="",get_activator_slot_changes=q=>({}),get_activator_slot_context=q=>({});function create_if_block$o(q){let _,M,$,j,z;const V=q[8].default,X=create_slot(V,q,q[7],null);return{c(){_=element("div"),X&&X.c(),attr(_,"class",M=null_to_empty(q[1])+" svelte-10lk5cm")},m(G,Y){insert(G,_,Y),X&&X.m(_,null),z=!0},p(G,Y){X&&X.p&&(!z||Y&128)&&update_slot_base(X,V,G,G[7],z?get_slot_changes(V,G[7],Y,null):get_all_dirty_from_scope(G[7]),null),(!z||Y&2&&M!==(M=null_to_empty(G[1])+" svelte-10lk5cm"))&&attr(_,"class",M)},i(G){z||(transition_in(X,G),add_render_callback(()=>{j&&j.end(1),$=create_in_transition(_,scale,{duration:150}),$.start()}),z=!0)},o(G){transition_out(X,G),$&&$.invalidate(),j=create_out_transition(_,scale,{duration:150,delay:100}),z=!1},d(G){G&&detach(_),X&&X.d(G),G&&j&&j.end()}}}function create_fragment$x(q){let _,M,$,j,z,V;const X=q[8].activator,G=create_slot(X,q,q[7],get_activator_slot_context);let Y=q[0]&&create_if_block$o(q);return{c(){_=element("div"),M=element("div"),G&&G.c(),$=space(),Y&&Y.c(),attr(_,"class","activator svelte-10lk5cm")},m(Q,Z){insert(Q,_,Z),append(_,M),G&&G.m(M,null),append(_,$),Y&&Y.m(_,null),j=!0,z||(V=[listen(M,"mouseenter",debounce(q[2],100)),listen(M,"mouseleave",debounce(q[3],500)),listen(M,"mouseenter",q[9]),listen(M,"mouseleave",q[10]),listen(M,"focus",q[11]),listen(M,"blur",q[12])],z=!0)},p(Q,[Z]){G&&G.p&&(!j||Z&128)&&update_slot_base(G,X,Q,Q[7],j?get_slot_changes(X,Q[7],Z,get_activator_slot_changes):get_all_dirty_from_scope(Q[7]),get_activator_slot_context),Q[0]?Y?(Y.p(Q,Z),Z&1&&transition_in(Y,1)):(Y=create_if_block$o(Q),Y.c(),transition_in(Y,1),Y.m(_,null)):Y&&(group_outros(),transition_out(Y,1,1,()=>{Y=null}),check_outros())},i(Q){j||(transition_in(G,Q),transition_in(Y),j=!0)},o(Q){transition_out(G,Q),transition_out(Y),j=!1},d(Q){Q&&detach(_),G&&G.d(Q),Y&&Y.d(),z=!1,run_all(V)}}}const classesDefault="tooltip";function debounce(q,_,M){let $;return function(){let j=this,z=arguments,V=function(){$=null,M||q.apply(j,z)},X=M&&!$;clearTimeout($),$=setTimeout(V,_),X&&q.apply(j,z)}}function instance$v(q,_,M){let $,{$$slots:j={},$$scope:z}=_,{class:V=""}=_,{classes:X=classesDefault}=_,{show:G=!1}=_,{timeout:Y=null}=_;const Q=new ClassBuilder(X,classesDefault);function Z(){G||(M(0,G=!0),Y&&M(4,Y=setTimeout(()=>{M(0,G=!1)},Y)))}function te(){G&&(M(0,G=!1),clearTimeout(Y))}function ee(ie){bubble.call(this,q,ie)}function ne(ie){bubble.call(this,q,ie)}function re(ie){bubble.call(this,q,ie)}function se(ie){bubble.call(this,q,ie)}return q.$$set=ie=>{"class"in ie&&M(5,V=ie.class),"classes"in ie&&M(6,X=ie.classes),"show"in ie&&M(0,G=ie.show),"timeout"in ie&&M(4,Y=ie.timeout),"$$scope"in ie&&M(7,z=ie.$$scope)},q.$$.update=()=>{q.$$.dirty&96&&M(1,$=Q.flush().add(X,!0,classesDefault).add(V).get())},[G,$,Z,te,Y,V,X,z,j,ee,ne,re,se]}let Tooltip$1=class extends SvelteComponent{constructor(_){super(),init(this,_,instance$v,create_fragment$x,safe_not_equal,{class:5,classes:6,show:0,timeout:4})}};const PdfViewer_svelte_svelte_type_style_lang="",{window:window_1}=globals;function create_else_block_1$5(q){let _,M,$;return{c(){_=element("div"),M=element("canvas"),attr(M,"class","svelte-19h83wp"),attr(_,"class",$=null_to_empty(q[6]===!0?"viewer":"null")+" svelte-19h83wp")},m(j,z){insert(j,_,z),append(_,M),q[54](M)},p(j,z){z[0]&64&&$!==($=null_to_empty(j[6]===!0?"viewer":"null")+" svelte-19h83wp")&&attr(_,"class",$)},i:noop,o:noop,d(j){j&&detach(_),q[54](null)}}}function create_if_block_1$i(q){let _,M,$=q[5].includes("navigation"),j,z=q[5].includes("zoom"),V,X=q[5].includes("print"),G,Y=q[5].includes("rotate"),Q,Z=q[5].includes("download"),te,ee=q[5].includes("autoflip"),ne,re,se,ie,oe,he,le,ae,ue,me,fe,ce,_e,we,ge,Ae,de,De,Me,Ee,Te,xe,He,Oe,$e,Pe=$&&create_if_block_8$2(q),ve=z&&create_if_block_7$3(q),ye=X&&create_if_block_6$3(q),Fe=Y&&create_if_block_5$3(q),je=Z&&create_if_block_4$6(q),Be=ee&&create_if_block_2$g(q);return{c(){_=element("div"),M=element("div"),Pe&&Pe.c(),j=space(),ve&&ve.c(),V=space(),ye&&ye.c(),G=space(),Fe&&Fe.c(),Q=space(),je&&je.c(),te=space(),Be&&Be.c(),ne=space(),re=element("span"),se=svg_element("svg"),ie=svg_element("path"),oe=space(),he=element("span"),le=text(q[10]),ae=text(" min read"),me=space(),fe=element("span"),ce=svg_element("svg"),_e=svg_element("path"),we=space(),ge=element("div"),Ae=text(`Page :
              `),de=element("span"),De=text(`
              /
              `),Me=element("span"),Te=space(),xe=element("div"),He=element("canvas"),attr(ie,"d",`M16.32 7.1A8 8 0 1 1 9 4.06V2h2v2.06c1.46.18 2.8.76 3.9
                1.62l1.46-1.46 1.42 1.42-1.46 1.45zM10 18a6 6 0 1 0 0-12 6 6 0 0
                0 0 12zM7 0h6v2H7V0zm5.12 8.46l1.42 1.42L10 13.4 8.59
                12l3.53-3.54z`),attr(se,"class","icon svelte-19h83wp"),attr(se,"xmlns","http://www.w3.org/2000/svg"),attr(se,"viewBox","0 0 20 20"),attr(he,"class","text svelte-19h83wp"),attr(re,"class","page-info svelte-19h83wp"),attr(re,"style",ue=q[5].includes("timeInfo")?"":"display: none;"),attr(_e,"d",`M16 2h4v15a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V0h16v2zm0 2v13a1 1 0
                0 0 1 1 1 1 0 0 0 1-1V4h-2zM2 2v15a1 1 0 0 0 1 1h11.17a2.98 2.98
                0 0 1-.17-1V2H2zm2 8h8v2H4v-2zm0 4h8v2H4v-2zM4 4h8v4H4V4z`),attr(ce,"class","icon svelte-19h83wp"),attr(ce,"xmlns","http://www.w3.org/2000/svg"),attr(ce,"viewBox","0 0 20 20"),attr(ge,"class","text svelte-19h83wp"),attr(fe,"class","page-info svelte-19h83wp"),attr(fe,"style",Ee=q[5].includes("pageInfo")?"":"display: none;"),attr(M,"class","line svelte-19h83wp"),attr(He,"width",q[16]),attr(He,"height",q[17]),attr(He,"class","svelte-19h83wp"),attr(xe,"class",Oe=null_to_empty(q[6]===!0?"viewer":"null")+" svelte-19h83wp"),attr(_,"class","control-start svelte-19h83wp")},m(Ne,ze){insert(Ne,_,ze),append(_,M),Pe&&Pe.m(M,null),append(M,j),ve&&ve.m(M,null),append(M,V),ye&&ye.m(M,null),append(M,G),Fe&&Fe.m(M,null),append(M,Q),je&&je.m(M,null),append(M,te),Be&&Be.m(M,null),append(M,ne),append(M,re),append(re,se),append(se,ie),append(re,oe),append(re,he),append(he,le),append(he,ae),append(M,me),append(M,fe),append(fe,ce),append(ce,_e),append(fe,we),append(fe,ge),append(ge,Ae),append(ge,de),q[51](de),append(ge,De),append(ge,Me),q[52](Me),append(_,Te),append(_,xe),append(xe,He),q[53](He),$e=!0},p(Ne,ze){ze[0]&32&&($=Ne[5].includes("navigation")),$?Pe?(Pe.p(Ne,ze),ze[0]&32&&transition_in(Pe,1)):(Pe=create_if_block_8$2(Ne),Pe.c(),transition_in(Pe,1),Pe.m(M,j)):Pe&&(group_outros(),transition_out(Pe,1,1,()=>{Pe=null}),check_outros()),ze[0]&32&&(z=Ne[5].includes("zoom")),z?ve?(ve.p(Ne,ze),ze[0]&32&&transition_in(ve,1)):(ve=create_if_block_7$3(Ne),ve.c(),transition_in(ve,1),ve.m(M,V)):ve&&(group_outros(),transition_out(ve,1,1,()=>{ve=null}),check_outros()),ze[0]&32&&(X=Ne[5].includes("print")),X?ye?(ye.p(Ne,ze),ze[0]&32&&transition_in(ye,1)):(ye=create_if_block_6$3(Ne),ye.c(),transition_in(ye,1),ye.m(M,G)):ye&&(group_outros(),transition_out(ye,1,1,()=>{ye=null}),check_outros()),ze[0]&32&&(Y=Ne[5].includes("rotate")),Y?Fe?(Fe.p(Ne,ze),ze[0]&32&&transition_in(Fe,1)):(Fe=create_if_block_5$3(Ne),Fe.c(),transition_in(Fe,1),Fe.m(M,Q)):Fe&&(group_outros(),transition_out(Fe,1,1,()=>{Fe=null}),check_outros()),ze[0]&32&&(Z=Ne[5].includes("download")),Z?je?(je.p(Ne,ze),ze[0]&32&&transition_in(je,1)):(je=create_if_block_4$6(Ne),je.c(),transition_in(je,1),je.m(M,te)):je&&(group_outros(),transition_out(je,1,1,()=>{je=null}),check_outros()),ze[0]&32&&(ee=Ne[5].includes("autoflip")),ee?Be?(Be.p(Ne,ze),ze[0]&32&&transition_in(Be,1)):(Be=create_if_block_2$g(Ne),Be.c(),transition_in(Be,1),Be.m(M,ne)):Be&&(group_outros(),transition_out(Be,1,1,()=>{Be=null}),check_outros()),(!$e||ze[0]&1024)&&set_data(le,Ne[10]),(!$e||ze[0]&32&&ue!==(ue=Ne[5].includes("timeInfo")?"":"display: none;"))&&attr(re,"style",ue),(!$e||ze[0]&32&&Ee!==(Ee=Ne[5].includes("pageInfo")?"":"display: none;"))&&attr(fe,"style",Ee),(!$e||ze[0]&65536)&&attr(He,"width",Ne[16]),(!$e||ze[0]&131072)&&attr(He,"height",Ne[17]),(!$e||ze[0]&64&&Oe!==(Oe=null_to_empty(Ne[6]===!0?"viewer":"null")+" svelte-19h83wp"))&&attr(xe,"class",Oe)},i(Ne){$e||(transition_in(Pe),transition_in(ve),transition_in(ye),transition_in(Fe),transition_in(je),transition_in(Be),$e=!0)},o(Ne){transition_out(Pe),transition_out(ve),transition_out(ye),transition_out(Fe),transition_out(je),transition_out(Be),$e=!1},d(Ne){Ne&&detach(_),Pe&&Pe.d(),ve&&ve.d(),ye&&ye.d(),Fe&&Fe.d(),je&&je.d(),Be&&Be.d(),q[51](null),q[52](null),q[53](null)}}}function create_if_block$n(q){let _,M,$,j,z,V,X,G,Y,Q,Z,te;return{c(){_=element("div"),M=element("p"),M.textContent="This document requires a password to open:",$=space(),j=element("p"),z=text(q[15]),V=space(),X=element("div"),G=element("input"),Y=space(),Q=element("button"),Q.textContent="Submit",attr(j,"class","password-message svelte-19h83wp"),attr(G,"type","password"),attr(G,"class","password-input svelte-19h83wp"),attr(Q,"class","password-button svelte-19h83wp"),attr(X,"class","password-container svelte-19h83wp"),attr(_,"class","password-viewer svelte-19h83wp")},m(ee,ne){insert(ee,_,ne),append(_,M),append(_,$),append(_,j),append(j,z),append(_,V),append(_,X),append(X,G),set_input_value(G,q[13]),append(X,Y),append(X,Q),Z||(te=[listen(G,"input",q[41]),listen(Q,"click",q[25])],Z=!0)},p(ee,ne){ne[0]&32768&&set_data(z,ee[15]),ne[0]&8192&&G.value!==ee[13]&&set_input_value(G,ee[13])},i:noop,o:noop,d(ee){ee&&detach(_),Z=!1,run_all(te)}}}function create_if_block_8$2(q){let _,M,$,j;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_8],default:[create_default_slot_8]},$$scope:{ctx:q}}}),$=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_7],default:[create_default_slot_7]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment),M=space(),create_component($.$$.fragment)},m(z,V){mount_component(_,z,V),insert(z,M,V),mount_component($,z,V),j=!0},p(z,V){const X={};V[0]&1|V[2]&64&&(X.$$scope={dirty:V,ctx:z}),_.$set(X);const G={};V[0]&5|V[2]&64&&(G.$$scope={dirty:V,ctx:z}),$.$set(G)},i(z){j||(transition_in(_.$$.fragment,z),transition_in($.$$.fragment,z),j=!0)},o(z){transition_out(_.$$.fragment,z),transition_out($.$$.fragment,z),j=!1},d(z){destroy_component(_,z),z&&detach(M),destroy_component($,z)}}}function create_default_slot_8(q){let _;return{c(){_=text("Previous")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_8(q){let _,M,$,j,z,V;return{c(){_=element("span"),M=svg_element("svg"),$=svg_element("polygon"),attr($,"points",`3.828 9 9.899 2.929 8.485 1.515 0 10 .707 10.707 8.485
                  18.485 9.899 17.071 3.828 11 20 11 20 9 3.828 9`),attr(M,"class","icon svelte-19h83wp"),attr(M,"xmlns","http://www.w3.org/2000/svg"),attr(M,"viewBox","0 0 20 20"),attr(_,"slot","activator"),attr(_,"class",j="button-control "+(q[0]<=1?"disabled":null)+" svelte-19h83wp")},m(X,G){insert(X,_,G),append(_,M),append(M,$),z||(V=[listen(_,"click",q[42]),listen(_,"keydown",q[39])],z=!0)},p(X,G){G[0]&1&&j!==(j="button-control "+(X[0]<=1?"disabled":null)+" svelte-19h83wp")&&attr(_,"class",j)},d(X){X&&detach(_),z=!1,run_all(V)}}}function create_default_slot_7(q){let _;return{c(){_=text("Next")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_7(q){let _,M,$,j,z,V;return{c(){_=element("span"),M=svg_element("svg"),$=svg_element("polygon"),attr($,"points",`16.172 9 10.101 2.929 11.515 1.515 20 10 19.293 10.707
                  11.515 18.485 10.101 17.071 16.172 11 0 11 0 9`),attr(M,"class","icon svelte-19h83wp"),attr(M,"xmlns","http://www.w3.org/2000/svg"),attr(M,"viewBox","0 0 20 20"),attr(_,"slot","activator"),attr(_,"class",j="button-control "+(q[0]>=q[2]?"disabled":null)+" svelte-19h83wp")},m(X,G){insert(X,_,G),append(_,M),append(M,$),z||(V=[listen(_,"click",q[43]),listen(_,"keydown",q[38])],z=!0)},p(X,G){G[0]&5&&j!==(j="button-control "+(X[0]>=X[2]?"disabled":null)+" svelte-19h83wp")&&attr(_,"class",j)},d(X){X&&detach(_),z=!1,run_all(V)}}}function create_if_block_7$3(q){let _,M,$,j;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_6],default:[create_default_slot_6]},$$scope:{ctx:q}}}),$=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_5],default:[create_default_slot_5]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment),M=space(),create_component($.$$.fragment)},m(z,V){mount_component(_,z,V),insert(z,M,V),mount_component($,z,V),j=!0},p(z,V){const X={};V[0]&2|V[2]&64&&(X.$$scope={dirty:V,ctx:z}),_.$set(X);const G={};V[0]&2|V[2]&64&&(G.$$scope={dirty:V,ctx:z}),$.$set(G)},i(z){j||(transition_in(_.$$.fragment,z),transition_in($.$$.fragment,z),j=!0)},o(z){transition_out(_.$$.fragment,z),transition_out($.$$.fragment,z),j=!1},d(z){destroy_component(_,z),z&&detach(M),destroy_component($,z)}}}function create_default_slot_6(q){let _;return{c(){_=text("Zoom In")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_6(q){let _,M,$,j,z,V;return{c(){_=element("span"),M=svg_element("svg"),$=svg_element("path"),attr($,"fill-rule","evenodd"),attr($,"d",`M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42
                  1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12zM7
                  7V5h2v2h2v2H9v2H7V9H5V7h2z`),attr(M,"class","icon svelte-19h83wp"),attr(M,"xmlns","http://www.w3.org/2000/svg"),attr(M,"viewBox","0 0 20 20"),attr(_,"slot","activator"),attr(_,"class",j="button-control "+(q[1]>=maxScale?"disabled":null)+" svelte-19h83wp")},m(X,G){insert(X,_,G),append(_,M),append(M,$),z||(V=[listen(_,"click",q[44]),listen(_,"keydown",q[37])],z=!0)},p(X,G){G[0]&2&&j!==(j="button-control "+(X[1]>=maxScale?"disabled":null)+" svelte-19h83wp")&&attr(_,"class",j)},d(X){X&&detach(_),z=!1,run_all(V)}}}function create_default_slot_5(q){let _;return{c(){_=text("Zoom Out")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_5(q){let _,M,$,j,z,V;return{c(){_=element("span"),M=svg_element("svg"),$=svg_element("path"),attr($,"fill-rule","evenodd"),attr($,"d",`M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42
                  1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12zM5
                  7h6v2H5V7z`),attr(M,"class","icon svelte-19h83wp"),attr(M,"xmlns","http://www.w3.org/2000/svg"),attr(M,"viewBox","0 0 20 20"),attr(_,"slot","activator"),attr(_,"class",j="button-control "+(q[1]<=minScale?"disabled":null)+" svelte-19h83wp")},m(X,G){insert(X,_,G),append(_,M),append(M,$),z||(V=[listen(_,"click",q[45]),listen(_,"keydown",q[36])],z=!0)},p(X,G){G[0]&2&&j!==(j="button-control "+(X[1]<=minScale?"disabled":null)+" svelte-19h83wp")&&attr(_,"class",j)},d(X){X&&detach(_),z=!1,run_all(V)}}}function create_if_block_6$3(q){let _,M;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_4],default:[create_default_slot_4]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j[0]&8|j[2]&64&&(z.$$scope={dirty:j,ctx:$}),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_default_slot_4(q){let _;return{c(){_=text("Print")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_4(q){let _,M,$;return{c(){_=element("span"),_.innerHTML=`<svg class="icon svelte-19h83wp" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M4 16H0V6h20v10h-4v4H4v-4zm2-4v6h8v-6H6zM4 0h12v5H4V0zM2
                  8v2h2V8H2zm4 0v2h2V8H6z"></path></svg>`,attr(_,"slot","activator"),attr(_,"class","button-control svelte-19h83wp")},m(j,z){insert(j,_,z),M||($=[listen(_,"click",q[46]),listen(_,"keydown",q[35])],M=!0)},p:noop,d(j){j&&detach(_),M=!1,run_all($)}}}function create_if_block_5$3(q){let _,M,$,j;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_3],default:[create_default_slot_3]},$$scope:{ctx:q}}}),$=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_2],default:[create_default_slot_2]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment),M=space(),create_component($.$$.fragment)},m(z,V){mount_component(_,z,V),insert(z,M,V),mount_component($,z,V),j=!0},p(z,V){const X={};V[2]&64&&(X.$$scope={dirty:V,ctx:z}),_.$set(X);const G={};V[2]&64&&(G.$$scope={dirty:V,ctx:z}),$.$set(G)},i(z){j||(transition_in(_.$$.fragment,z),transition_in($.$$.fragment,z),j=!0)},o(z){transition_out(_.$$.fragment,z),transition_out($.$$.fragment,z),j=!1},d(z){destroy_component(_,z),z&&detach(M),destroy_component($,z)}}}function create_default_slot_3(q){let _;return{c(){_=text("Anti-Clockwise")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_3(q){let _,M,$;return{c(){_=element("span"),_.innerHTML=`<svg class="icon rot-icon svelte-19h83wp" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M14.66 15.66A8 8 0 1 1 17 10h-2a6 6 0 1 0-1.76 4.24l1.42
                  1.42zM12 10h8l-4 4-4-4z"></path></svg>`,attr(_,"slot","activator"),attr(_,"class","button-control svelte-19h83wp")},m(j,z){insert(j,_,z),M||($=[listen(_,"click",q[47]),listen(_,"keydown",q[34])],M=!0)},p:noop,d(j){j&&detach(_),M=!1,run_all($)}}}function create_default_slot_2(q){let _;return{c(){_=text("Clockwise")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_2(q){let _,M,$;return{c(){_=element("span"),_.innerHTML=`<svg class="icon svelte-19h83wp" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M14.66 15.66A8 8 0 1 1 17 10h-2a6 6 0 1 0-1.76 4.24l1.42
                  1.42zM12 10h8l-4 4-4-4z"></path></svg>`,attr(_,"slot","activator"),attr(_,"class","button-control svelte-19h83wp")},m(j,z){insert(j,_,z),M||($=[listen(_,"click",q[48]),listen(_,"keydown",q[33])],M=!0)},p:noop,d(j){j&&detach(_),M=!1,run_all($)}}}function create_if_block_4$6(q){let _,M;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_1],default:[create_default_slot_1]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j[0]&24|j[2]&64&&(z.$$scope={dirty:j,ctx:$}),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_default_slot_1(q){let _;return{c(){_=text("Download")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_1(q){let _,M,$;return{c(){_=element("span"),_.innerHTML='<svg class="icon svelte-19h83wp" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M13 8V2H7v6H2l8 8 8-8h-5zM0 18h20v2H0v-2z"></path></svg>',attr(_,"slot","activator"),attr(_,"class","button-control svelte-19h83wp")},m(j,z){insert(j,_,z),M||($=[listen(_,"click",q[49]),listen(_,"keydown",q[32])],M=!0)},p:noop,d(j){j&&detach(_),M=!1,run_all($)}}}function create_if_block_2$g(q){let _,M;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot],default:[create_default_slot$1]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j[0]&6144|j[2]&64&&(z.$$scope={dirty:j,ctx:$}),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_default_slot$1(q){let _=(q[11]===!0?q[12]:"Auto Turn Page")+"",M;return{c(){M=text(_)},m($,j){insert($,M,j)},p($,j){j[0]&6144&&_!==(_=($[11]===!0?$[12]:"Auto Turn Page")+"")&&set_data(M,_)},d($){$&&detach(M)}}}function create_else_block$8(q){let _;return{c(){_=svg_element("path"),attr(_,"d",`M9.896,3.838L0.792,1.562v14.794l9.104,2.276L19,16.356V1.562L9.896,3.838z
                    M9.327,17.332L1.93,15.219V3.27 l7.397,1.585V17.332z
                    M17.862,15.219l-7.397,2.113V4.855l7.397-1.585V15.219z`)},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_3$b(q){let _;return{c(){_=svg_element("path"),attr(_,"d","M4 18h12V6h-4V2H4v16zm-2 1V0h12l4 4v16H2v-1z")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot(q){let _,M,$,j;function z(G,Y){return G[11]===!0?create_if_block_3$b:create_else_block$8}let V=z(q),X=V(q);return{c(){_=element("span"),M=svg_element("svg"),X.c(),attr(M,"class","icon svelte-19h83wp"),attr(M,"xmlns","http://www.w3.org/2000/svg"),attr(M,"viewBox","0 0 20 20"),attr(_,"slot","activator"),attr(_,"class","page-info button-control svelte-19h83wp")},m(G,Y){insert(G,_,Y),append(_,M),X.m(M,null),$||(j=[listen(_,"click",q[50]),listen(_,"keydown",q[31])],$=!0)},p(G,Y){V!==(V=z(G))&&(X.d(1),X=V(G),X&&(X.c(),X.m(M,null)))},d(G){G&&detach(_),X.d(),$=!1,run_all(j)}}}function create_fragment$w(q){let _,M,$,j,z,V,X,G,Y,Q;add_render_callback(q[40]);const Z=[create_if_block$n,create_if_block_1$i,create_else_block_1$5],te=[];function ee(ne,re){return ne[14]===!0?0:ne[5].length?1:2}return $=ee(q),j=te[$]=Z[$](q),{c(){_=element("div"),M=element("div"),j.c(),V=space(),X=element("button"),X.innerHTML='<svg class="icon svelte-19h83wp" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M7 10v8h6v-8h5l-8-8-8 8h5z"></path></svg>',attr(M,"class",z=null_to_empty(q[6]===!0?"control":"null")+" svelte-19h83wp"),attr(X,"id","topBtn"),attr(X,"class","svelte-19h83wp"),attr(_,"class","parent svelte-19h83wp")},m(ne,re){insert(ne,_,re),append(_,M),te[$].m(M,null),append(_,V),append(_,X),G=!0,Y||(Q=[listen(window_1,"resize",q[40]),listen(X,"click",q[55])],Y=!0)},p(ne,re){let se=$;$=ee(ne),$===se?te[$].p(ne,re):(group_outros(),transition_out(te[se],1,1,()=>{te[se]=null}),check_outros(),j=te[$],j?j.p(ne,re):(j=te[$]=Z[$](ne),j.c()),transition_in(j,1),j.m(M,null)),(!G||re[0]&64&&z!==(z=null_to_empty(ne[6]===!0?"control":"null")+" svelte-19h83wp"))&&attr(M,"class",z)},i(ne){G||(transition_in(j),G=!0)},o(ne){transition_out(j),G=!1},d(ne){ne&&detach(_),te[$].d(),Y=!1,run_all(Q)}}}const minScale=1,maxScale=2.3;function instance$u(q,_,M){let{url:$}=_,{data:j}=_,{scale:z=1.8}=_,{pageNum:V=1}=_,{flipTime:X=120}=_,{showButtons:G=["navigation","zoom","print","rotate","download","autoflip","timeInfo","pageInfo"]}=_,{showBorder:Y=!0}=_,{totalPage:Q=0}=_,{downloadFileName:Z=""}=_;pdfExports.GlobalWorkerOptions.workerSrc=new URL(""+new URL("pdf.worker-cec92788.js",import.meta.url).href,self.location);let te,ee=0,ne=0,re=null,se=!1,ie=null,oe=0,he="",le=0,ae=!1,ue,me,fe=X,ce=[],_e="",we=!1,ge="",Ae=!1;const de=tt=>{se=!0,re.getPage(tt).then(function(it){let nt=it.getViewport({scale:z,rotation:oe});const gt=te.getContext("2d");M(7,te.height=nt.height,te),M(7,te.width=nt.width,te);let Rt={canvasContext:gt,viewport:nt};it.render(Rt).promise.then(function(){if(se=!1,ie!==null){if(V<re.totalPage)ce[V]=te,M(0,V++,V),re.getPage(V).then(de);else for(let Bt=1;Bt<ce.length;Bt++)te.appendChild(ce[Bt]);ie=null}})}),G.length&&M(8,ee.textContent=tt,ee)},De=tt=>{se?ie=tt:de(tt)},Me=()=>{V<=1||(M(0,V--,V),De(V))},Ee=()=>{V>=re.numPages||(M(0,V++,V),De(V))},Te=()=>{z<=maxScale&&(M(1,z=z+.1),De(V))},xe=()=>{z>=minScale&&(M(1,z=z-.1),De(V))},He=tt=>{onPrint(tt)},Oe=()=>{oe=oe+90,De(V)},$e=()=>{oe=oe-90,De(V)},Pe=()=>{ve()},ve=async()=>{pdfExports.getDocument({...$&&{url:$},...j&&{data:j},..._e&&{password:_e}}).promise.then(async function(it){if(re=it,M(14,we=!1),await tick(),G.length&&M(9,ne.textContent=re.numPages,ne),M(2,Q=re.numPages),G.length)for(let nt=1;nt<=Q;nt++)getPageText(nt,re).then(function(gt){he=he.concat(gt),M(10,le=calcRT(he))});M(30,Ae=!0)}).catch(function(it){M(14,we=!0),M(15,ge=it.message)})};ve();const ye=()=>{M(11,ae=!ae),ae===!1&&(clearInterval(ue),clearInterval(me)),ae===!0&&V<=Q&&(me=setInterval(()=>{M(12,fe=fe-1)},1e3),ue=setInterval(()=>{M(12,fe=X),Ee()},X*1e3))},Fe=({url:tt,data:it})=>{let nt=Z||tt&&tt.substring(tt.lastIndexOf("/")+1);savePDF({fileURL:tt,data:it,name:nt})};onDestroy(()=>{clearInterval(ue),clearInterval(me)});let je,Be;function Ne(tt){bubble.call(this,q,tt)}function ze(tt){bubble.call(this,q,tt)}function Ze(tt){bubble.call(this,q,tt)}function ut(tt){bubble.call(this,q,tt)}function ot(tt){bubble.call(this,q,tt)}function pe(tt){bubble.call(this,q,tt)}function We(tt){bubble.call(this,q,tt)}function Qe(tt){bubble.call(this,q,tt)}function Ce(tt){bubble.call(this,q,tt)}function Ie(){M(16,je=window_1.innerWidth),M(17,Be=window_1.innerHeight)}function Ge(){_e=this.value,M(13,_e)}const rt=()=>Me(),ct=()=>Ee(),qe=()=>Te(),Ve=()=>xe(),Xe=()=>He($),Je=()=>$e(),lt=()=>Oe(),_t=()=>Fe({url:$,data:j}),mt=()=>ye();function Ct(tt){binding_callbacks[tt?"unshift":"push"](()=>{ee=tt,M(8,ee)})}function Et(tt){binding_callbacks[tt?"unshift":"push"](()=>{ne=tt,M(9,ne)})}function xt(tt){binding_callbacks[tt?"unshift":"push"](()=>{te=tt,M(7,te)})}function Tt(tt){binding_callbacks[tt?"unshift":"push"](()=>{te=tt,M(7,te)})}const Dt=()=>window.scrollTo(0,0);return q.$$set=tt=>{"url"in tt&&M(3,$=tt.url),"data"in tt&&M(4,j=tt.data),"scale"in tt&&M(1,z=tt.scale),"pageNum"in tt&&M(0,V=tt.pageNum),"flipTime"in tt&&M(28,X=tt.flipTime),"showButtons"in tt&&M(5,G=tt.showButtons),"showBorder"in tt&&M(6,Y=tt.showBorder),"totalPage"in tt&&M(2,Q=tt.totalPage),"downloadFileName"in tt&&M(29,Z=tt.downloadFileName)},q.$$.update=()=>{q.$$.dirty[0]&1073741825&&Ae&&De(V)},[V,z,Q,$,j,G,Y,te,ee,ne,le,ae,fe,_e,we,ge,je,Be,Me,Ee,Te,xe,He,Oe,$e,Pe,ye,Fe,X,Z,Ae,Ne,ze,Ze,ut,ot,pe,We,Qe,Ce,Ie,Ge,rt,ct,qe,Ve,Xe,Je,lt,_t,mt,Ct,Et,xt,Tt,Dt]}class PdfViewer extends SvelteComponent{constructor(_){super(),init(this,_,instance$u,create_fragment$w,safe_not_equal,{url:3,data:4,scale:1,pageNum:0,flipTime:28,showButtons:5,showBorder:6,totalPage:2,downloadFileName:29},null,[-1,-1,-1])}}const GetAttachment_svelte_svelte_type_style_lang="";function create_if_block$m(q){let _,M,$,j={ctx:q,current:null,token:null,hasCatch:!1,pending:create_pending_block,then:create_then_block,catch:create_catch_block,value:13,blocks:[,,,]};return handle_promise(M=q[4],j),{c(){_=empty(),j.block.c()},m(z,V){insert(z,_,V),j.block.m(z,j.anchor=V),j.mount=()=>_.parentNode,j.anchor=_,$=!0},p(z,V){q=z,j.ctx=q,V&16&&M!==(M=q[4])&&handle_promise(M,j)||update_await_block_branch(j,q,V)},i(z){$||(transition_in(j.block),$=!0)},o(z){for(let V=0;V<3;V+=1){const X=j.blocks[V];transition_out(X)}$=!1},d(z){z&&detach(_),j.block.d(z),j.token=null,j=null}}}function create_catch_block(q){return{c:noop,m:noop,p:noop,i:noop,o:noop,d:noop}}function create_then_block(q){let _,M,$,j=!q[2]&&create_if_block_3$a(q),z=q[3]!==void 0&&q[1]!=="true"&&create_if_block_1$h(q);return{c(){_=element("div"),j&&j.c(),M=space(),z&&z.c(),attr(_,"class","flex flex-row mb-4 flex-wrap")},m(V,X){insert(V,_,X),j&&j.m(_,null),append(_,M),z&&z.m(_,null),$=!0},p(V,X){V[2]?j&&(group_outros(),transition_out(j,1,1,()=>{j=null}),check_outros()):j?(j.p(V,X),X&4&&transition_in(j,1)):(j=create_if_block_3$a(V),j.c(),transition_in(j,1),j.m(_,M)),V[3]!==void 0&&V[1]!=="true"?z?z.p(V,X):(z=create_if_block_1$h(V),z.c(),z.m(_,null)):z&&(z.d(1),z=null)},i(V){$||(transition_in(j),$=!0)},o(V){transition_out(j),$=!1},d(V){V&&detach(_),j&&j.d(),z&&z.d()}}}function create_if_block_3$a(q){let _,M,$,j,z;const V=[create_if_block_4$5,create_if_block_5$2,create_if_block_6$2,create_if_block_7$2,create_if_block_8$1,create_else_block$7],X=[];function G(Y,Q){return Y[6]=="image"?0:Y[6]=="text"?1:Y[6]=="audio"?2:Y[6]=="markdown"?3:Y[6]=="pdf"?4:5}return $=G(q),j=X[$]=V[$](q),{c(){_=element("div"),M=element("div"),j.c(),attr(M,"class","mt-2"),attr(_,"class","flex flex-col justify-between h-auto")},m(Y,Q){insert(Y,_,Q),append(_,M),X[$].m(M,null),z=!0},p(Y,Q){let Z=$;$=G(Y),$===Z?X[$].p(Y,Q):(group_outros(),transition_out(X[Z],1,1,()=>{X[Z]=null}),check_outros(),j=X[$],j?j.p(Y,Q):(j=X[$]=V[$](Y),j.c()),transition_in(j,1),j.m(M,null))},i(Y){z||(transition_in(j),z=!0)},o(Y){transition_out(j),z=!1},d(Y){Y&&detach(_),X[$].d()}}}function create_else_block$7(q){let _;return{c(){_=element("p"),_.textContent="Attachment type not supported"},m(M,$){insert(M,_,$)},p:noop,i:noop,o:noop,d(M){M&&detach(_)}}}function create_if_block_8$1(q){let _,M,$;return M=new PdfViewer({props:{url:q[13],showButtons:["navigation","pageInfo"],showBorder:!1}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","pdfViewer svelte-1un3rdf")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&16&&(V.url=j[13]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_7$2(q){let _,M,$;return M=new SvelteMarkdown({props:{source:q[13]}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","markdown svelte-1un3rdf")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&16&&(V.source=j[13]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_6$2(q){let _,M,$;return{c(){_=element("div"),M=element("audio"),src_url_equal(M.src,$=q[13])||attr(M,"src",$),M.controls=!0,attr(M,"class","svelte-1un3rdf"),attr(_,"class","w-auto")},m(j,z){insert(j,_,z),append(_,M)},p(j,z){z&16&&!src_url_equal(M.src,$=j[13])&&attr(M,"src",$)},i:noop,o:noop,d(j){j&&detach(_)}}}function create_if_block_5$2(q){let _,M=q[13]+"";return{c(){_=element("p"),attr(_,"class","my-6 textbox svelte-1un3rdf")},m($,j){insert($,_,j),_.innerHTML=M},p($,j){j&16&&M!==(M=$[13]+"")&&(_.innerHTML=M)},i:noop,o:noop,d($){$&&detach(_)}}}function create_if_block_4$5(q){let _,M,$;return{c(){_=element("img"),src_url_equal(_.src,M=q[13])||attr(_,"src",M),attr(_,"alt",$=q[0].text),attr(_,"class","svelte-1un3rdf")},m(j,z){insert(j,_,z)},p(j,z){z&16&&!src_url_equal(_.src,M=j[13])&&attr(_,"src",M),z&1&&$!==($=j[0].text)&&attr(_,"alt",$)},i:noop,o:noop,d(j){j&&detach(_)}}}function create_if_block_1$h(q){let _,M,$=!q[5]&&create_if_block_2$f(q);return{c(){_=element("div"),M=element("p"),$&&$.c(),attr(M,"class","mx-4"),attr(_,"class","flex flex-row mb-4 items-end pb-8")},m(j,z){insert(j,_,z),append(_,M),$&&$.m(M,null)},p(j,z){j[5]?$&&($.d(1),$=null):$?$.p(j,z):($=create_if_block_2$f(j),$.c(),$.m(M,null))},d(j){j&&detach(_),$&&$.d()}}}function create_if_block_2$f(q){let _,M,$;return{c(){_=element("button"),_.textContent="Get attachment",attr(_,"class","svelte-1un3rdf")},m(j,z){insert(j,_,z),M||($=listen(_,"click",function(){is_function(q[7](q[0]))&&q[7](q[0]).apply(this,arguments)}),M=!0)},p(j,z){q=j},d(j){j&&detach(_),M=!1,$()}}}function create_pending_block(q){let _;return{c(){_=text("Loading attachment...")},m(M,$){insert(M,_,$)},p:noop,i:noop,o:noop,d(M){M&&detach(_)}}}function create_fragment$v(q){let _,M,$=create_if_block$m(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,[z]){$.p(j,z)},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function instance$t(q,_,M){let $;component_subscribe(q,replicaDetails,ne=>M(10,$=ne));let{doc:j}=_,{replies:z}=_,V,X,G=!1,Y=!0,Q,Z;async function te(ne){const re=await $.replica.getAttachment(ne);let se=ne.path.split(".").pop();if(re!==void 0){console.log("fileExtension",se);const he=await re.bytes();console.log("docdata",he);let le=new Uint8Array(he.length);for(var ie=0;ie<he.length;ie++)le[ie]=he[ie];if(se==="md")M(6,Q="markdown"),M(6,Q),M(3,V=String.fromCharCode(...le));else if(se=="mp3"||se=="ogg"||se=="webm")M(6,Q="audio"),Z="audio/"+se,M(6,Q),Z=Z,console.log("this is audio"),console.log(Q,Z),M(3,V=URL.createObjectURL(new Blob([le],{type:Z})));else if(se==="txt"){M(6,Q="text"),M(6,Q),console.log(Q);var oe=new TextDecoder("utf-8");M(3,V=oe.decode(Uint8Array.from(le)))}else se=="png"||se=="gif"||se=="jpeg"?(M(6,Q="image"),console.log("this is an image"),console.log("fileExtension "+se),Z="image/"+se,M(6,Q),Z=Z,M(3,V=URL.createObjectURL(new Blob([le],{type:Z})))):se==="pdf"?(M(6,Q="pdf"),M(3,V=URL.createObjectURL(new Blob([le],{type:"application/pdf"})))):(M(6,Q="other"),M(6,Q),console.log(Q),M(3,V=URL.createObjectURL(new Blob([le],{type:"application/octet-stream"}))));return V}}function ee(ne){M(4,X=te(ne)),M(5,G=!0),M(2,Y=!1)}return q.$$set=ne=>{"doc"in ne&&M(0,j=ne.doc),"replies"in ne&&M(1,z=ne.replies)},q.$$.update=()=>{q.$$.dirty&1&&j&&(M(4,X=te(j)),M(5,G=!0),M(2,Y=!1)),q.$$.dirty&4,q.$$.dirty&1&&console.log("selectedDoc in GetAttachment",j)},[j,z,Y,V,X,G,Q,ee]}class GetAttachment extends SvelteComponent{constructor(_){super(),init(this,_,instance$t,create_fragment$v,safe_not_equal,{doc:0,replies:1})}}const Ephemerality_svelte_svelte_type_style_lang="";function create_if_block$l(q){let _,M,$,j,z,V,X,G=Math.trunc(q[2])+"",Y,Q,Z=q[2]<=1?"minute":"minutes",te,ee,ne,re,se=Math.trunc((q[3]/1e3-(q[0]*1e3+q[4]))/6e4)+"",ie,oe,he,le,ae,ue;return{c(){_=element("div"),M=element("button"),M.textContent="➕Extend",$=space(),j=element("button"),j.textContent="➖Shorten",z=space(),V=element("p"),X=text("last interaction was "),Y=text(G),Q=space(),te=text(Z),ee=text(" ago"),ne=space(),re=element("p"),ie=text(se),oe=text(" minutes left until deletion"),he=space(),le=element("button"),le.textContent="🗑️Delete",attr(M,"class","svelte-mmxx8s"),attr(j,"class","svelte-mmxx8s"),attr(V,"class","svelte-mmxx8s"),attr(re,"class","svelte-mmxx8s"),attr(le,"class","svelte-mmxx8s"),attr(_,"id","flexcontainer"),attr(_,"class","svelte-mmxx8s")},m(me,fe){insert(me,_,fe),append(_,M),append(_,$),append(_,j),append(_,z),append(_,V),append(V,X),append(V,Y),append(V,Q),append(V,te),append(V,ee),append(_,ne),append(_,re),append(re,ie),append(re,oe),append(_,he),append(_,le),ae||(ue=[listen(M,"click",q[5]),listen(j,"click",q[6]),listen(le,"click",q[10])],ae=!0)},p(me,fe){fe&4&&G!==(G=Math.trunc(me[2])+"")&&set_data(Y,G),fe&4&&Z!==(Z=me[2]<=1?"minute":"minutes")&&set_data(te,Z),fe&9&&se!==(se=Math.trunc((me[3]/1e3-(me[0]*1e3+me[4]))/6e4)+"")&&set_data(ie,se)},d(me){me&&detach(_),ae=!1,run_all(ue)}}}function create_fragment$u(q){let _,M=q[1]?"⌛Ephemeral":"⏳Ephemeral",$,j,z,V,X,G=q[1]&&create_if_block$l(q);return{c(){_=element("button"),$=text(M),j=space(),G&&G.c(),z=empty(),attr(_,"class","svelte-mmxx8s")},m(Y,Q){insert(Y,_,Q),append(_,$),insert(Y,j,Q),G&&G.m(Y,Q),insert(Y,z,Q),V||(X=listen(_,"click",q[9]),V=!0)},p(Y,[Q]){Q&2&&M!==(M=Y[1]?"⌛Ephemeral":"⏳Ephemeral")&&set_data($,M),Y[1]?G?G.p(Y,Q):(G=create_if_block$l(Y),G.c(),G.m(z.parentNode,z)):G&&(G.d(1),G=null)},i:noop,o:noop,d(Y){Y&&detach(_),Y&&detach(j),G&&G.d(Y),Y&&detach(z),V=!1,X()}}}function instance$s(q,_,M){let $,j,z;component_subscribe(q,elapsed,ie=>M(0,$=ie)),component_subscribe(q,authorKeypair,ie=>M(11,j=ie)),component_subscribe(q,replicaDetails,ie=>M(12,z=ie));const V=createEventDispatcher();let X=Date.now(),G=!1,Y=0,{doc:Q}=_,Z=Q.deleteAfter;async function te(){M(3,Z+=36e8);let ie=j.address.slice(1,5),oe=Q.path.split("!"),he=oe[0].replace("/documents","/studio")+oe[1];const le=await z.replica.set(j,{text:Q.text+"<br> lifespan extended by "+ie+" on "+new Date().toLocaleString(),path:Q.path,deleteAfter:Z}),ae=await z.replica.set(j,{text:Q.text+"<br> lifespan extended by "+ie+" on "+new Date().toLocaleString(),path:he});console.log("studioPath",he),console.log("doc.path",Q.path),console.log("result c",le),console.log("result s",ae)}async function ee(){let ie=j.address.slice(1,5),oe=Q.path.split("!"),he=oe[0].replace("/documents","/studio")+oe[1];console.log("studioPath",he),M(3,Z-=864e8);const le=await z.replica.set(j,{text:Q.text+"<br> lifespan shortened by "+ie+" on "+new Date().toLocaleString(),path:Q.path,deleteAfter:Z}),ae=await z.replica.set(j,{text:Q.text+"<br> lifespan shortened by "+ie+" on "+new Date().toLocaleString(),path:he});console.log("result c",le),console.log("result s",ae)}async function ne(){V("update");let ie=j.address.slice(1,5),oe=Q.path.split("!"),he=oe[0].replace("/documents","/studio")+oe[1];const le=await z.replica.set(j,{path:Q.path,deleteAfter:(Date.now()+1e3)*1e3}),ae=await z.replica.set(j,{text:Q.text+"<br> deleted by "+ie+" on "+new Date().toLocaleString(),path:he});console.log("studio 'delete'",ae),console.log("result delete",le)}const re=()=>M(1,G=!G),se=()=>ne();return q.$$set=ie=>{"doc"in ie&&M(8,Q=ie.doc)},q.$$.update=()=>{q.$$.dirty&257&&M(2,Y=($+X/1e3-Q.timestamp/1e6)/60)},[$,G,Y,Z,X,te,ee,ne,Q,re,se]}class Ephemerality extends SvelteComponent{constructor(_){super(),init(this,_,instance$s,create_fragment$u,safe_not_equal,{doc:8})}}const DocDetails_svelte_svelte_type_style_lang="";function get_each_context$9(q,_,M){const $=q.slice();return $[8]=_[M],$}function create_else_block_1$4(q){let _;return{c(){_=text("📄Show details")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_4$4(q){let _;return{c(){_=text("📄Hide details")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block$k(q){let _,M,$,j,z,V,X,G,Y=q[0].path+"",Q,Z,te,ee,ne,re=q[0].author+"",se,ie,oe,he,le,ae=q[0].share+"",ue,me,fe,ce,_e,we=q[0].timestamp/1e3+"",ge,Ae=q[1]&&create_if_block_3$9(q);function de(Ee,Te){return Ee[2]!==void 0?create_if_block_1$g:create_else_block$6}let De=de(q),Me=De(q);return{c(){_=element("div"),Ae&&Ae.c(),M=space(),Me.c(),$=space(),j=element("div"),z=element("ul"),V=element("li"),X=element("b"),X.textContent="path:",G=space(),Q=text(Y),Z=space(),te=element("li"),ee=element("b"),ee.textContent="author:",ne=space(),se=text(re),ie=space(),oe=element("li"),he=element("b"),he.textContent="share:",le=space(),ue=text(ae),me=space(),fe=element("li"),ce=element("b"),ce.textContent="timestamp:",_e=space(),ge=text(we),attr(V,"class","svelte-1ob97v4"),attr(te,"class","svelte-1ob97v4"),attr(oe,"class","svelte-1ob97v4"),attr(fe,"class","svelte-1ob97v4"),attr(z,"class","svelte-1ob97v4"),attr(j,"class","my-4 break-all svelte-1ob97v4"),attr(_,"class","svelte-1ob97v4")},m(Ee,Te){insert(Ee,_,Te),Ae&&Ae.m(_,null),append(_,M),Me.m(_,null),append(_,$),append(_,j),append(j,z),append(z,V),append(V,X),append(V,G),append(V,Q),append(z,Z),append(z,te),append(te,ee),append(te,ne),append(te,se),append(z,ie),append(z,oe),append(oe,he),append(oe,le),append(oe,ue),append(z,me),append(z,fe),append(fe,ce),append(fe,_e),append(fe,ge)},p(Ee,Te){Ee[1]?Ae?Ae.p(Ee,Te):(Ae=create_if_block_3$9(Ee),Ae.c(),Ae.m(_,M)):Ae&&(Ae.d(1),Ae=null),De===(De=de(Ee))&&Me?Me.p(Ee,Te):(Me.d(1),Me=De(Ee),Me&&(Me.c(),Me.m(_,$))),Te&1&&Y!==(Y=Ee[0].path+"")&&set_data(Q,Y),Te&1&&re!==(re=Ee[0].author+"")&&set_data(se,re),Te&1&&ae!==(ae=Ee[0].share+"")&&set_data(ue,ae),Te&1&&we!==(we=Ee[0].timestamp/1e3+"")&&set_data(ge,we)},d(Ee){Ee&&detach(_),Ae&&Ae.d(),Me.d()}}}function create_if_block_3$9(q){let _,M,$,j,z,V,X=q[0].path.split(".")[q[0].path.split(".").length-1]+"",G,Y,Q,Z,te,ee,ne=q[0].attachmentSize/1e3+"",re,se;return{c(){_=element("table"),M=element("tr"),$=element("td"),$.textContent="Attachment type:",j=space(),z=element("td"),V=element("strong"),G=text(X),Y=space(),Q=element("tr"),Z=element("td"),Z.textContent="Attachment size:",te=space(),ee=element("td"),re=text(ne),se=text(" kb"),attr(_,"class","my-4 svelte-1ob97v4")},m(ie,oe){insert(ie,_,oe),append(_,M),append(M,$),append(M,j),append(M,z),append(z,V),append(V,G),append(_,Y),append(_,Q),append(Q,Z),append(Q,te),append(Q,ee),append(ee,re),append(Q,se)},p(ie,oe){oe&1&&X!==(X=ie[0].path.split(".")[ie[0].path.split(".").length-1]+"")&&set_data(G,X),oe&1&&ne!==(ne=ie[0].attachmentSize/1e3+"")&&set_data(re,ne)},d(ie){ie&&detach(_)}}}function create_else_block$6(q){let _,M=removeTitleContent(q[0].text)+"";return{c(){_=element("div"),attr(_,"class","my-4 break-words")},m($,j){insert($,_,j),_.innerHTML=M},p($,j){j&1&&M!==(M=removeTitleContent($[0].text)+"")&&(_.innerHTML=M)},d($){$&&detach(_)}}}function create_if_block_1$g(q){let _,M,$,j=q[5]&&create_if_block_2$e(q);return{c(){_=element("div"),M=space(),j&&j.c(),$=empty()},m(z,V){insert(z,_,V),_.innerHTML=q[2],insert(z,M,V),j&&j.m(z,V),insert(z,$,V)},p(z,V){V&4&&(_.innerHTML=z[2]),z[5]?j?j.p(z,V):(j=create_if_block_2$e(z),j.c(),j.m($.parentNode,$)):j&&(j.d(1),j=null)},d(z){z&&detach(_),z&&detach(M),j&&j.d(z),z&&detach($)}}}function create_if_block_2$e(q){let _,M=q[3],$=[];for(let j=0;j<M.length;j+=1)$[j]=create_each_block$9(get_each_context$9(q,M,j));return{c(){_=element("ul");for(let j=0;j<$.length;j+=1)$[j].c();attr(_,"class","svelte-1ob97v4")},m(j,z){insert(j,_,z);for(let V=0;V<$.length;V+=1)$[V].m(_,null)},p(j,z){if(z&8){M=j[3];let V;for(V=0;V<M.length;V+=1){const X=get_each_context$9(j,M,V);$[V]?$[V].p(X,z):($[V]=create_each_block$9(X),$[V].c(),$[V].m(_,null))}for(;V<$.length;V+=1)$[V].d(1);$.length=M.length}},d(j){j&&detach(_),destroy_each($,j)}}}function create_each_block$9(q){let _,M,$=q[8]+"",j;return{c(){_=element("li"),M=new HtmlTag(!1),j=space(),M.a=j,attr(_,"class","svelte-1ob97v4")},m(z,V){insert(z,_,V),M.m($,_),append(_,j)},p(z,V){V&8&&$!==($=z[8]+"")&&M.p($)},d(z){z&&detach(_)}}}function create_fragment$t(q){let _,M,$,j,z;function V(Q,Z){return Q[4]?create_if_block_4$4:create_else_block_1$4}let X=V(q),G=X(q),Y=q[4]&&create_if_block$k(q);return{c(){_=element("div"),M=element("button"),G.c(),$=space(),Y&&Y.c(),attr(_,"class","my-4 text-left svelte-1ob97v4")},m(Q,Z){insert(Q,_,Z),append(_,M),G.m(M,null),append(_,$),Y&&Y.m(_,null),j||(z=listen(M,"click",q[7]),j=!0)},p(Q,[Z]){X!==(X=V(Q))&&(G.d(1),G=X(Q),G&&(G.c(),G.m(M,null))),Q[4]?Y?Y.p(Q,Z):(Y=create_if_block$k(Q),Y.c(),Y.m(_,null)):Y&&(Y.d(1),Y=null)},i:noop,o:noop,d(Q){Q&&detach(_),G.d(),Y&&Y.d(),j=!1,z()}}}function removeTitleContent(q){var _=q.indexOf("#Title:"),M=q.indexOf("#Notes:");if(_!==-1&&M!==-1&&_<M){var $=q.substring(0,_),j=q.substring(M);return $+" "+j}return q}function instance$r(q,_,M){let{doc:$}=_,{attachment:j=!0}=_,{isReply:z=!1}=_,V=!1,X,G,Y=!1;onMount(()=>{M(4,V=!0)});const Q=()=>M(4,V=!V);return q.$$set=Z=>{"doc"in Z&&M(0,$=Z.doc),"attachment"in Z&&M(1,j=Z.attachment),"isReply"in Z&&M(6,z=Z.isReply)},q.$$.update=()=>{q.$$.dirty&13&&$.text!==void 0&&$.text.includes("<br>")&&(M(3,G=$.text.split("<br>")),M(2,X=G.shift()),M(2,X),M(0,$),M(3,G),M(5,Y=!0))},[$,j,X,G,V,Y,z,Q]}class DocDetails extends SvelteComponent{constructor(_){super(),init(this,_,instance$r,create_fragment$t,safe_not_equal,{doc:0,attachment:1,isReply:6})}}const SingleDoc_svelte_svelte_type_style_lang="";function create_else_block$5(q){let _,M,$,j,z,V=!q[9]&&create_if_block_5$1(q),X=q[9]&&create_if_block_1$f(q);return{c(){_=element("div"),V&&V.c(),M=space(),X&&X.c(),attr(_,"class","main svelte-tithd8"),toggle_class(_,"replies",q[5]===!0)},m(G,Y){insert(G,_,Y),V&&V.m(_,null),append(_,M),X&&X.m(_,null),$=!0,j||(z=[listen(_,"click",self$1(q[18])),listen(_,"keypress",self$1(q[19]))],j=!0)},p(G,Y){G[9]?V&&(group_outros(),transition_out(V,1,1,()=>{V=null}),check_outros()):V?(V.p(G,Y),Y&512&&transition_in(V,1)):(V=create_if_block_5$1(G),V.c(),transition_in(V,1),V.m(_,M)),G[9]?X?(X.p(G,Y),Y&512&&transition_in(X,1)):(X=create_if_block_1$f(G),X.c(),transition_in(X,1),X.m(_,null)):X&&(group_outros(),transition_out(X,1,1,()=>{X=null}),check_outros()),(!$||Y&32)&&toggle_class(_,"replies",G[5]===!0)},i(G){$||(transition_in(V),transition_in(X),$=!0)},o(G){transition_out(V),transition_out(X),$=!1},d(G){G&&detach(_),V&&V.d(),X&&X.d(),j=!1,run_all(z)}}}function create_if_block$j(q){let _;return{c(){_=element("div"),attr(_,"class","main disabled svelte-tithd8"),toggle_class(_,"replies",q[5]===!0)},m(M,$){insert(M,_,$)},p(M,$){$&32&&toggle_class(_,"replies",M[5]===!0)},i:noop,o:noop,d(M){M&&detach(_)}}}function create_if_block_5$1(q){let _,M,$,j,z,V,X=q[0]!==void 0&&create_if_block_6$1(q);return{c(){_=element("div"),M=element("p"),$=space(),X&&X.c(),attr(M,"class","svelte-tithd8"),attr(_,"class","flex flex-col svelte-tithd8")},m(G,Y){insert(G,_,Y),append(_,M),append(_,$),X&&X.m(_,null),j=!0,z||(V=[listen(M,"click",q[13]),listen(M,"keypress",q[14])],z=!0)},p(G,Y){G[0]!==void 0?X?(X.p(G,Y),Y&1&&transition_in(X,1)):(X=create_if_block_6$1(G),X.c(),transition_in(X,1),X.m(_,null)):X&&(group_outros(),transition_out(X,1,1,()=>{X=null}),check_outros())},i(G){j||(transition_in(X),j=!0)},o(G){transition_out(X),j=!1},d(G){G&&detach(_),X&&X.d(),z=!1,run_all(V)}}}function create_if_block_6$1(q){let _,M,$,j,z=q[3]&&create_if_block_7$1(q);return{c(){_=element("div"),M=space(),z&&z.c(),$=empty(),attr(_,"class","svelte-tithd8")},m(V,X){insert(V,_,X),_.innerHTML=q[0],insert(V,M,X),z&&z.m(V,X),insert(V,$,X),j=!0},p(V,X){(!j||X&1)&&(_.innerHTML=V[0]),V[3]?z?(z.p(V,X),X&8&&transition_in(z,1)):(z=create_if_block_7$1(V),z.c(),transition_in(z,1),z.m($.parentNode,$)):z&&(group_outros(),transition_out(z,1,1,()=>{z=null}),check_outros())},i(V){j||(transition_in(z),j=!0)},o(V){transition_out(z),j=!1},d(V){V&&detach(_),V&&detach(M),z&&z.d(V),V&&detach($)}}}function create_if_block_7$1(q){let _,M,$;return M=new GetAttachment({props:{doc:q[1],replies:"true"}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","svelte-tithd8")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&2&&(V.doc=j[1]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_1$f(q){let _,M,$,j,z,V,X,G,Y,Q,Z,te,ee,ne,re=q[3]&&create_if_block_4$3(q);Y=new DocDetails({props:{doc:q[1],attachment:q[3],isReply:q[5]}});let se=q[4]&&create_if_block_3$8(q),ie=!q[2]&&create_if_block_2$d(q);return{c(){_=element("div"),M=element("button"),$=element("img"),z=text(`
            Artifact`),V=space(),re&&re.c(),X=space(),G=element("div"),create_component(Y.$$.fragment),Q=space(),se&&se.c(),Z=space(),ie&&ie.c(),set_style($,"margin-bottom","-3px"),src_url_equal($.src,j=q[11][q[8]])||attr($,"src",j),attr($,"alt","document icon"),attr($,"width",q[7]),attr($,"height",q[7]),attr($,"class","svelte-tithd8"),attr(M,"class","svelte-tithd8"),attr(G,"class","svelte-tithd8"),attr(_,"class","flex svelte-tithd8")},m(oe,he){insert(oe,_,he),append(_,M),append(M,$),append(M,z),append(_,V),re&&re.m(_,null),append(_,X),append(_,G),mount_component(Y,G,null),append(_,Q),se&&se.m(_,null),append(_,Z),ie&&ie.m(_,null),te=!0,ee||(ne=[listen(M,"click",q[15]),listen(M,"keypress",self$1(q[16]))],ee=!0)},p(oe,he){(!te||he&256&&!src_url_equal($.src,j=oe[11][oe[8]]))&&attr($,"src",j),(!te||he&128)&&attr($,"width",oe[7]),(!te||he&128)&&attr($,"height",oe[7]),oe[3]?re?(re.p(oe,he),he&8&&transition_in(re,1)):(re=create_if_block_4$3(oe),re.c(),transition_in(re,1),re.m(_,X)):re&&(group_outros(),transition_out(re,1,1,()=>{re=null}),check_outros());const le={};he&2&&(le.doc=oe[1]),he&8&&(le.attachment=oe[3]),he&32&&(le.isReply=oe[5]),Y.$set(le),oe[4]?se?(se.p(oe,he),he&16&&transition_in(se,1)):(se=create_if_block_3$8(oe),se.c(),transition_in(se,1),se.m(_,Z)):se&&(group_outros(),transition_out(se,1,1,()=>{se=null}),check_outros()),oe[2]?ie&&(group_outros(),transition_out(ie,1,1,()=>{ie=null}),check_outros()):ie?(ie.p(oe,he),he&4&&transition_in(ie,1)):(ie=create_if_block_2$d(oe),ie.c(),transition_in(ie,1),ie.m(_,null))},i(oe){te||(transition_in(re),transition_in(Y.$$.fragment,oe),transition_in(se),transition_in(ie),te=!0)},o(oe){transition_out(re),transition_out(Y.$$.fragment,oe),transition_out(se),transition_out(ie),te=!1},d(oe){oe&&detach(_),re&&re.d(),destroy_component(Y),se&&se.d(),ie&&ie.d(),ee=!1,run_all(ne)}}}function create_if_block_4$3(q){let _,M,$;return M=new GetAttachment({props:{doc:q[1],replies:"true"}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","svelte-tithd8")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&2&&(V.doc=j[1]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_3$8(q){let _,M,$;return M=new Reply({props:{doc:q[1]}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","svelte-tithd8")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&2&&(V.doc=j[1]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_2$d(q){let _,M,$;return M=new Ephemerality({props:{doc:q[1]}}),M.$on("update",q[17]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","svelte-tithd8")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&2&&(V.doc=j[1]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_fragment$s(q){let _,M,$,j;const z=[create_if_block$j,create_else_block$5],V=[];function X(G,Y){return G[6]?0:1}return _=X(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(G,Y){V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,[Y]){let Q=_;_=X(G),_===Q?V[_].p(G,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){V[_].d(G),G&&detach($)}}}function instance$q(q,_,M){const $=createEventDispatcher();let j=["icons/mountain-phase-0-02.png","icons/mountain-phase-1-02.png","icons/mountain-phase-2-02.png","icons/mountain-phase-3-02.png","icons/mountain-phase-4-02.png","icons/mountain-phase-5-02.png","icons/mountain-phase-6-02.png","icons/mountain-phase-7-02.png","icons/mountain-phase-8-02.png"],z=!1,{doc:V}=_,{studio:X=!1}=_,{attachment:G=!0}=_,{reply:Y=!0}=_,{title:Q=void 0}=_,{isReply:Z=!1}=_,{disabled:te=!1}=_,ee=V.deleteAfter,ne,re=24,se;const ie=()=>{M(9,z=!z),$("click",V)},oe=()=>M(9,z=!z),he=()=>M(9,z=!z),le=()=>M(9,z=!z);function ae(fe){bubble.call(this,q,fe)}const ue=()=>{$("click",V)},me=()=>M(9,z=!z);return q.$$set=fe=>{"doc"in fe&&M(1,V=fe.doc),"studio"in fe&&M(2,X=fe.studio),"attachment"in fe&&M(3,G=fe.attachment),"reply"in fe&&M(4,Y=fe.reply),"title"in fe&&M(0,Q=fe.title),"isReply"in fe&&M(5,Z=fe.isReply),"disabled"in fe&&M(6,te=fe.disabled)},q.$$.update=()=>{q.$$.dirty&258&&console.log(V.path+"phase "+se),q.$$.dirty&4131&&(Q!==void 0&&Q.includes("<br>")?(M(12,ne=Q.split("<br>")),M(0,Q=ne.shift()),M(0,Q),M(12,ne),M(1,V),M(5,Z),console.log("content",ne),M(7,re=ne.length*2+12)):V.text.includes("<br>")?(M(12,ne=V.text.split("<br>")),M(7,re=ne.length*3+8)):Z&&M(7,re=10)),q.$$.dirty&128&&console.log("reaction",re)},console.log("deletionTime"+ee),M(8,se=Math.floor((ee-Date.now())/(25488e8/9))%9),[Q,V,X,G,Y,Z,te,re,se,z,$,j,ne,ie,oe,he,le,ae,ue,me]}class SingleDoc extends SvelteComponent{constructor(_){super(),init(this,_,instance$q,create_fragment$s,safe_not_equal,{doc:1,studio:2,attachment:3,reply:4,title:0,isReply:5,disabled:6})}}const ShowReply_svelte_svelte_type_style_lang="";function get_each_context$8(q,_,M){const $=q.slice();return $[0]=_[M],$}function create_if_block_2$c(q){let _,M=[],$=new Map,j,z=q[1];const V=X=>X[0].signature;for(let X=0;X<z.length;X+=1){let G=get_each_context$8(q,z,X),Y=V(G);$.set(Y,M[X]=create_each_block$8(Y,G))}return{c(){_=element("ul");for(let X=0;X<M.length;X+=1)M[X].c();attr(_,"class","svelte-zu5h6d")},m(X,G){insert(X,_,G);for(let Y=0;Y<M.length;Y+=1)M[Y].m(_,null);j=!0},p(X,G){G&34&&(z=X[1],group_outros(),M=update_keyed_each(M,G,V,1,X,z,$,_,outro_and_destroy_block,create_each_block$8,null,get_each_context$8),check_outros())},i(X){if(!j){for(let G=0;G<z.length;G+=1)transition_in(M[G]);j=!0}},o(X){for(let G=0;G<M.length;G+=1)transition_out(M[G]);j=!1},d(X){X&&detach(_);for(let G=0;G<M.length;G+=1)M[G].d()}}}function create_if_block_1$e(q){let _=q[4]()+"",M;return{c(){M=text(_)},m($,j){insert($,M,j)},p:noop,i:noop,o:noop,d($){$&&detach(M)}}}function create_else_block_1$3(q){let _,M;return _=new SingleDoc({props:{isReply:!0,title:q[0].text,doc:q[0],attachment:!1,reply:!1}}),_.$on("click",q[5]),_.$on("update",q[5]),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.title=$[0].text),j&2&&(z.doc=$[0]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block_3$7(q){let _,M;return _=new SingleDoc({props:{isReply:!0,title:q[0].text,doc:q[0],attachment:!0,reply:!1}}),_.$on("click",q[5]),_.$on("update",q[5]),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.title=$[0].text),j&2&&(z.doc=$[0]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_each_block$8(q,_){let M,$,j,z,V,X,G;const Y=[create_if_block_3$7,create_else_block_1$3],Q=[];function Z(te,ee){return ee&2&&($=null),$==null&&($=!!te[0].text.includes("replied with voice")),$?0:1}return j=Z(_,-1),z=Q[j]=Y[j](_),{key:q,first:null,c(){M=element("li"),z.c(),V=space(),attr(M,"id",X=_[0].textHash),attr(M,"class","svelte-zu5h6d"),this.first=M},m(te,ee){insert(te,M,ee),Q[j].m(M,null),append(M,V),G=!0},p(te,ee){_=te;let ne=j;j=Z(_,ee),j===ne?Q[j].p(_,ee):(group_outros(),transition_out(Q[ne],1,1,()=>{Q[ne]=null}),check_outros(),z=Q[j],z?z.p(_,ee):(z=Q[j]=Y[j](_),z.c()),transition_in(z,1),z.m(M,V)),(!G||ee&2&&X!==(X=_[0].textHash))&&attr(M,"id",X)},i(te){G||(transition_in(z),G=!0)},o(te){transition_out(z),G=!1},d(te){te&&detach(M),Q[j].d()}}}function create_else_block$4(q){return{c:noop,m:noop,d:noop}}function create_if_block$i(q){let _;return{c(){_=element("p"),_.textContent="There are no replies yet.",attr(_,"class","max-content svelte-zu5h6d")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_fragment$r(q){let _,M,$,j,z,V;const X=[create_if_block_1$e,create_if_block_2$c],G=[];function Y(ee,ne){return ee[1]===void 0?0:ee[2]?1:-1}~(M=Y(q))&&($=G[M]=X[M](q));function Q(ee,ne){return ee[3]?create_if_block$i:create_else_block$4}let Z=Q(q),te=Z(q);return{c(){_=element("div"),$&&$.c(),j=space(),z=element("div"),te.c()},m(ee,ne){insert(ee,_,ne),~M&&G[M].m(_,null),insert(ee,j,ne),insert(ee,z,ne),te.m(z,null),V=!0},p(ee,[ne]){let re=M;M=Y(ee),M===re?~M&&G[M].p(ee,ne):($&&(group_outros(),transition_out(G[re],1,1,()=>{G[re]=null}),check_outros()),~M?($=G[M],$?$.p(ee,ne):($=G[M]=X[M](ee),$.c()),transition_in($,1),$.m(_,null)):$=null),Z!==(Z=Q(ee))&&(te.d(1),te=Z(ee),te&&(te.c(),te.m(z,null)))},i(ee){V||(transition_in($),V=!0)},o(ee){transition_out($),V=!1},d(ee){ee&&detach(_),~M&&G[M].d(),ee&&detach(j),ee&&detach(z),te.d()}}}function instance$p(q,_,M){let $;component_subscribe(q,cacheDetails,Q=>M(6,$=Q));let{doc:j}=_,z=[],V=!0,X=!1;const G=async()=>{let Q=j.path.split("!");M(1,z=await $.queryDocs({filter:{pathStartsWith:Q[0]}})),M(1,z=z.filter(Z=>Z.path.split("/").length>6)),M(2,V=!0)};$.onCacheUpdated(()=>{G(),M(1,z)});function Y(){setTimeout(()=>{G()},1e3)}return onMount(()=>{G()}),q.$$set=Q=>{"doc"in Q&&M(0,j=Q.doc)},q.$$.update=()=>{q.$$.dirty&2&&M(1,z),q.$$.dirty&2&&(z.length>=1?(M(2,V=!0),M(3,X=!1)):M(3,X=!0))},[j,z,V,X,G,Y]}class ShowReply extends SvelteComponent{constructor(_){super(),init(this,_,instance$p,create_fragment$r,safe_not_equal,{doc:0})}}const Voice_svelte_svelte_type_style_lang="";function create_else_block$3(q){let _,M,$,j,z,V,X,G=q[0]!=="reply"&&create_if_block_3$6();function Y(te,ee){return te[2]?create_if_block_2$b:create_else_block_1$2}let Q=Y(q),Z=Q(q);return{c(){_=element("div"),M=element("div"),G&&G.c(),$=space(),j=element("div"),z=element("button"),Z.c(),attr(z,"class","phase1 mt-6 svelte-1n9oqk8"),attr(j,"class","mt-6 svelte-1n9oqk8"),attr(M,"class","svelte-1n9oqk8"),attr(_,"class","text-left svelte-1n9oqk8")},m(te,ee){insert(te,_,ee),append(_,M),G&&G.m(M,null),append(M,$),append(M,j),append(j,z),Z.m(z,null),V||(X=[listen(z,"click",q[10]),listen(z,"keypress",q[11])],V=!0)},p(te,ee){te[0]!=="reply"?G||(G=create_if_block_3$6(),G.c(),G.m(M,$)):G&&(G.d(1),G=null),Q!==(Q=Y(te))&&(Z.d(1),Z=Q(te),Z&&(Z.c(),Z.m(z,null)))},d(te){te&&detach(_),G&&G.d(),Z.d(),V=!1,run_all(X)}}}function create_if_block$h(q){let _,M,$,j,z,V,X,G,Y,Q,Z,te,ee,ne,re,se,ie=!q[1]&&create_if_block_1$d();return{c(){_=element("div"),M=element("h5"),M.textContent="Review your recording",$=space(),j=element("audio"),z=element("source"),X=text(`
            Your browser does not support the audio element.`),G=space(),ie&&ie.c(),Y=space(),Q=element("button"),Q.textContent="Record again",Z=space(),te=element("button"),ee=text("Upload"),attr(M,"class","m-2 svelte-1n9oqk8"),src_url_equal(z.src,V=q[3])||attr(z,"src",V),attr(z,"type","audio/ogg"),j.controls=!0,attr(j,"class","my-6 mx-2 svelte-1n9oqk8"),attr(Q,"class","svelte-1n9oqk8"),te.disabled=ne=!q[1],attr(te,"class","svelte-1n9oqk8"),attr(_,"class","text-left m-2 svelte-1n9oqk8")},m(oe,he){insert(oe,_,he),append(_,M),append(_,$),append(_,j),append(j,z),append(j,X),append(_,G),ie&&ie.m(_,null),append(_,Y),append(_,Q),append(_,Z),append(_,te),append(te,ee),re||(se=[listen(Q,"click",q[6]),listen(te,"click",q[5])],re=!0)},p(oe,he){he&8&&!src_url_equal(z.src,V=oe[3])&&attr(z,"src",V),oe[1]?ie&&(ie.d(1),ie=null):ie||(ie=create_if_block_1$d(),ie.c(),ie.m(_,Y)),he&2&&ne!==(ne=!oe[1])&&(te.disabled=ne)},d(oe){oe&&detach(_),ie&&ie.d(),re=!1,run_all(se)}}}function create_if_block_3$6(q){let _,M,$;return{c(){_=element("h5"),_.textContent="Record your voice note",M=space(),$=element("div"),$.textContent="Click the button below to start recording. Click again to stop.",attr(_,"class","m-2 svelte-1n9oqk8"),attr($,"class","svelte-1n9oqk8")},m(j,z){insert(j,_,z),insert(j,M,z),insert(j,$,z)},d(j){j&&detach(_),j&&detach(M),j&&detach($)}}}function create_else_block_1$2(q){let _;return{c(){_=text("Record audio")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_2$b(q){let _;return{c(){_=text("Stop recording")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_1$d(q){let _;return{c(){_=element("div"),_.textContent="The upload button is disabled because a title is required.",attr(_,"class","svelte-1n9oqk8")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_fragment$q(q){let _;function M(z,V){return z[3]?create_if_block$h:create_else_block$3}let $=M(q),j=$(q);return{c(){j.c(),_=empty()},m(z,V){j.m(z,V),insert(z,_,V)},p(z,[V]){$===($=M(z))&&j?j.p(z,V):(j.d(1),j=$(z),j&&(j.c(),j.m(_.parentNode,_)))},i:noop,o:noop,d(z){j.d(z),z&&detach(_)}}}function readBlobAsArrayBuffer(q){return new Promise((_,M)=>{const $=new FileReader;$.onloadend=()=>_($.result),$.onerror=M,$.readAsArrayBuffer(q)})}function instance$o(q,_,M){let $,j;component_subscribe(q,authorKeypair,me=>M(17,$=me)),component_subscribe(q,replicaDetails,me=>M(18,j=me));const z=createEventDispatcher();let V,X=[],G=null,Y=!1,Q=null,Z=null,te=null,{xy:ee=void 0}=_,{doc:ne=void 0}=_,{title:re=void 0}=_,{notes:se=void 0}=_,{isValid:ie=!0}=_;async function oe(){if(Y){G.stop();let me=G.mimeType;me===""&&(me="audio/ogg; codecs=opus"),console.log("mediaRecorder",G),console.log("mediaRecorder mime",G.mimeType),M(2,Y=!1),G.ondataavailable=fe=>X.push(fe.data),await new Promise(fe=>{G.onstop=function(){Z=new Blob(X,{type:me}),M(3,Q=URL.createObjectURL(Z)),console.log("blob",Z),fe()}})}else{const me=await navigator.mediaDevices.getUserMedia({audio:!0});G=new MediaRecorder(me),G.start(),console.log("mediaRecorder",G),console.log("mediaRecorder mime",G.mimeType),console.log("recording"),M(2,Y=!0)}}async function he(){se&&re?te="#Title: "+re+"#Notes: "+se:re?te="#Title: "+re:te="";let me=Date.now(),fe=new Date().toLocaleString(),ce=(Date.now()+25488e5)*1e3,_e=G.mimeType;_e===""&&(_e="audio/ogg; codecs=opus");let ge=_e.split(";")[0].split("/")[1];const Ae=await readBlobAsArrayBuffer(Z),de=new Uint8Array(Ae);console.log("mime",_e);let De=$.address.slice(1,5);if(ee!==void 0&&ee!=="reply")V=await j.replica.set($,{path:`/documents/${ee[0]}/${ee[1]}/${me}/!voice-note-by-${De}.${ge}`,text:"Voice note shared by "+De+" on "+fe+te,attachment:de,deleteAfter:ce}),z("upload"),console.log("Upload Result: ",V),X=[];else if(ee=="reply"){let Me=ne.path.split("!");const Ee=await j.replica.set($,{text:De+" replied with voice<br>Shared on "+fe,path:Me[0]+me+"/!reply-by-"+De+"."+ge,deleteAfter:ne.deleteAfter,attachment:de});return console.log("result ",Ee),z("success"),Ee}}async function le(){M(3,Q=null),X=[],await oe()}const ae=async()=>{oe()},ue=async()=>{oe()};return q.$$set=me=>{"xy"in me&&M(0,ee=me.xy),"doc"in me&&M(7,ne=me.doc),"title"in me&&M(8,re=me.title),"notes"in me&&M(9,se=me.notes),"isValid"in me&&M(1,ie=me.isValid)},q.$$.update=()=>{q.$$.dirty&768&&re&&se&&console.log("title and note",re,se)},[ee,ie,Y,Q,oe,he,le,ne,re,se,ae,ue]}class Voice extends SvelteComponent{constructor(_){super(),init(this,_,instance$o,create_fragment$q,safe_not_equal,{xy:0,doc:7,title:8,notes:9,isValid:1})}}function create_if_block_2$a(q){let _,M,$,j,z,V,X,G,Y;return{c(){_=element("p"),M=element("textarea"),$=space(),j=element("p"),z=element("button"),V=text("Send Reply"),attr(M,"class","my-2"),attr(M,"placeholder",q[4]),set_style(M,"width","100%"),z.disabled=X=q[5](q[1])},m(Q,Z){insert(Q,_,Z),append(_,M),set_input_value(M,q[1]),insert(Q,$,Z),insert(Q,j,Z),append(j,z),append(z,V),G||(Y=[listen(M,"input",q[10]),listen(z,"click",q[7])],G=!0)},p(Q,Z){Z&16&&attr(M,"placeholder",Q[4]),Z&2&&set_input_value(M,Q[1]),Z&2&&X!==(X=Q[5](Q[1]))&&(z.disabled=X)},d(Q){Q&&detach(_),Q&&detach($),Q&&detach(j),G=!1,run_all(Y)}}}function create_if_block_1$c(q){let _,M;return _=new Voice({props:{xy:"reply",doc:q[0]}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&1&&(z.doc=$[0]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block$g(q){let _;return{c(){_=element("span"),_.textContent=`${q[6].kind}`},m(M,$){insert(M,_,$)},p:noop,d(M){M&&detach(_)}}}function create_fragment$p(q){let _,M,$,j,z,V,X,G,Y,Q,Z,te,ee=q[2]&&create_if_block_2$a(q),ne=q[3]&&create_if_block_1$c(q),re=q[6]&&create_if_block$g(q);return{c(){_=element("div"),M=element("div"),$=element("button"),$.textContent="📝Text reply",j=space(),z=element("button"),z.textContent="🔊Voice reply",V=space(),ee&&ee.c(),X=space(),ne&&ne.c(),G=space(),Y=element("p"),re&&re.c(),attr($,"class","mb-2")},m(se,ie){insert(se,_,ie),append(_,M),append(M,$),append(M,j),append(M,z),append(_,V),ee&&ee.m(_,null),append(_,X),ne&&ne.m(_,null),append(_,G),append(_,Y),re&&re.m(Y,null),Q=!0,Z||(te=[listen($,"click",q[8]),listen(z,"click",q[9])],Z=!0)},p(se,[ie]){se[2]?ee?ee.p(se,ie):(ee=create_if_block_2$a(se),ee.c(),ee.m(_,X)):ee&&(ee.d(1),ee=null),se[3]?ne?(ne.p(se,ie),ie&8&&transition_in(ne,1)):(ne=create_if_block_1$c(se),ne.c(),transition_in(ne,1),ne.m(_,G)):ne&&(group_outros(),transition_out(ne,1,1,()=>{ne=null}),check_outros()),se[6]&&re.p(se,ie)},i(se){Q||(transition_in(ne),Q=!0)},o(se){transition_out(ne),Q=!1},d(se){se&&detach(_),ee&&ee.d(),ne&&ne.d(),re&&re.d(),Z=!1,run_all(te)}}}function instance$n(q,_,M){let $,j;component_subscribe(q,authorKeypair,ie=>M(12,$=ie)),component_subscribe(q,replicaDetails,ie=>M(13,j=ie));const z=createEventDispatcher();function V(ie){return ie==Z}let X,G=!1,Y=!1,Q="",Z="Type your reply here";Q.length;async function te(){let ie=$.address.slice(1,5),oe=ee.path.split("!"),he=ee.deleteAfter,le=Date.now();const ae=await j.replica.set($,{text:ie+" replied: "+Q,path:oe[0]+le+"/!reply-by-"+ie,deleteAfter:he});return console.log("result ",ae),z("success"),M(1,Q=""),ae}let{doc:ee}=_;function ne(){M(2,G=!G),M(3,Y=!1)}function re(){M(2,G=!1),M(3,Y=!Y)}function se(){Q=this.value,M(1,Q),M(6,X)}return q.$$set=ie=>{"doc"in ie&&M(0,ee=ie.doc)},q.$$.update=()=>{q.$$.dirty&2&&Q!==void 0&&Q.length},console.log("result",X),[ee,Q,G,Y,Z,V,X,te,ne,re,se]}class SendReply extends SvelteComponent{constructor(_){super(),init(this,_,instance$n,create_fragment$p,safe_not_equal,{doc:0})}}const Reply_svelte_svelte_type_style_lang="";function create_if_block$f(q){let _,M,$,j,z,V;return $=new ShowReply({props:{doc:q[0]}}),$.$on("success",q[1]),z=new SendReply({props:{doc:q[0]}}),z.$on("success",q[2]),{c(){_=element("div"),M=element("div"),create_component($.$$.fragment),j=space(),create_component(z.$$.fragment),attr(M,"class","replies mb-2 svelte-1gwlcd9")},m(X,G){insert(X,_,G),append(_,M),mount_component($,M,null),append(_,j),mount_component(z,_,null),V=!0},p(X,G){const Y={};G&1&&(Y.doc=X[0]),$.$set(Y);const Q={};G&1&&(Q.doc=X[0]),z.$set(Q)},i(X){V||(transition_in($.$$.fragment,X),transition_in(z.$$.fragment,X),V=!0)},o(X){transition_out($.$$.fragment,X),transition_out(z.$$.fragment,X),V=!1},d(X){X&&detach(_),destroy_component($),destroy_component(z)}}}function create_fragment$o(q){let _,M,$=create_if_block$f(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,[z]){$.p(j,z)},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function instance$m(q,_,M){let{doc:$}=_;function j(V){bubble.call(this,q,V)}function z(V){bubble.call(this,q,V)}return q.$$set=V=>{"doc"in V&&M(0,$=V.doc)},[$,j,z]}class Reply extends SvelteComponent{constructor(_){super(),init(this,_,instance$m,create_fragment$o,safe_not_equal,{doc:0})}}const View_svelte_svelte_type_style_lang="";function create_if_block_2$9(q){let _,M;return{c(){_=element("h4"),M=text(q[3]),attr(_,"class","mt-12 p-2")},m($,j){insert($,_,j),append(_,M)},p($,j){j&8&&set_data(M,$[3])},d($){$&&detach(_)}}}function create_if_block_1$b(q){let _,M,$;return M=new GetAttachment({props:{doc:q[0],replies:"false"}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","attachmentbox svelte-1vj0bce")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&1&&(V.doc=j[0]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block$e(q){let _,M,$;return M=new Reply({props:{doc:q[0]}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","mr-6")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&1&&(V.doc=j[0]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_fragment$n(q){let _,M,$,j,z,V,X,G,Y=q[3]&&create_if_block_2$9(q),Q=q[1]&&create_if_block_1$b(q),Z=q[2]&&create_if_block$e(q);return{c(){Y&&Y.c(),_=space(),M=element("div"),Q&&Q.c(),$=space(),Z&&Z.c(),j=space(),z=element("button"),z.textContent="close",attr(M,"class","flex flex-row justify-between w-full"),attr(z,"class","top-right svelte-1vj0bce")},m(te,ee){Y&&Y.m(te,ee),insert(te,_,ee),insert(te,M,ee),Q&&Q.m(M,null),append(M,$),Z&&Z.m(M,null),insert(te,j,ee),insert(te,z,ee),V=!0,X||(G=listen(z,"click",q[4]),X=!0)},p(te,[ee]){te[3]?Y?Y.p(te,ee):(Y=create_if_block_2$9(te),Y.c(),Y.m(_.parentNode,_)):Y&&(Y.d(1),Y=null),te[1]?Q?(Q.p(te,ee),ee&2&&transition_in(Q,1)):(Q=create_if_block_1$b(te),Q.c(),transition_in(Q,1),Q.m(M,$)):Q&&(group_outros(),transition_out(Q,1,1,()=>{Q=null}),check_outros()),te[2]?Z?(Z.p(te,ee),ee&4&&transition_in(Z,1)):(Z=create_if_block$e(te),Z.c(),transition_in(Z,1),Z.m(M,null)):Z&&(group_outros(),transition_out(Z,1,1,()=>{Z=null}),check_outros())},i(te){V||(transition_in(Q),transition_in(Z),V=!0)},o(te){transition_out(Q),transition_out(Z),V=!1},d(te){Y&&Y.d(te),te&&detach(_),te&&detach(M),Q&&Q.d(),Z&&Z.d(),te&&detach(j),te&&detach(z),X=!1,G()}}}function instance$l(q,_,M){const $=createEventDispatcher();let{selectedDocument:j}=_,{attachment:z=!0}=_,{reply:V=!0}=_,X;function G(){$("close")}return q.$$set=Y=>{"selectedDocument"in Y&&M(0,j=Y.selectedDocument),"attachment"in Y&&M(1,z=Y.attachment),"reply"in Y&&M(2,V=Y.reply)},q.$$.update=()=>{q.$$.dirty&1&&j&&(j.text.includes("#Title:")&&j.text.includes("#Notes:")?M(3,X=j.text.split("#Title:")[1].split("#Notes:")[0].trim()):j.text.includes("#Title:")&&!j.text.includes("#Notes:")?M(3,X=j.text.split("#Title:")[1].trim()):M(3,X="")),q.$$.dirty&1&&console.log("selectedDocument in ArtifactView",j)},[j,z,V,X,G]}class View extends SvelteComponent{constructor(_){super(),init(this,_,instance$l,create_fragment$n,safe_not_equal,{selectedDocument:0,attachment:1,reply:2})}}const Icon_svelte_svelte_type_style_lang="";function create_else_block$2(q){let _,M,$,j,z,V,X;return{c(){_=element("div"),M=element("img"),src_url_equal(M.src,$=q[3][q[5]])||attr(M,"src",$),attr(M,"alt",j="document icon, phase #"+q[1]),attr(M,"class",z=null_to_empty(q[2]?"small-icon":"")+" svelte-1agx8j1"),attr(_,"class","svelte-1agx8j1")},m(G,Y){insert(G,_,Y),append(_,M),V||(X=[listen(_,"click",q[4]),listen(_,"keypress",q[4])],V=!0)},p(G,Y){Y&8&&!src_url_equal(M.src,$=G[3][G[5]])&&attr(M,"src",$),Y&2&&j!==(j="document icon, phase #"+G[1])&&attr(M,"alt",j),Y&4&&z!==(z=null_to_empty(G[2]?"small-icon":"")+" svelte-1agx8j1")&&attr(M,"class",z)},d(G){G&&detach(_),V=!1,run_all(X)}}}function create_if_block$d(q){let _,M,$;return{c(){_=element("div"),M=element("img"),src_url_equal(M.src,$=q[3][q[5]])||attr(M,"src",$),attr(M,"alt","document icon"),set_style(M,"filter","blur(1px)"),attr(M,"class","svelte-1agx8j1"),attr(_,"class","svelte-1agx8j1")},m(j,z){insert(j,_,z),append(_,M)},p(j,z){z&8&&!src_url_equal(M.src,$=j[3][j[5]])&&attr(M,"src",$)},d(j){j&&detach(_)}}}function create_fragment$m(q){let _;function M(z,V){return z[0]?create_if_block$d:create_else_block$2}let $=M(q),j=$(q);return{c(){j.c(),_=empty()},m(z,V){j.m(z,V),insert(z,_,V)},p(z,[V]){$===($=M(z))&&j?j.p(z,V):(j.d(1),j=$(z),j&&(j.c(),j.m(_.parentNode,_)))},i:noop,o:noop,d(z){j.d(z),z&&detach(_)}}}function instance$k(q,_,M){const $=createEventDispatcher();let j=["icons/mountain-phase-0-02.png","icons/mountain-phase-1-02.png","icons/mountain-phase-2-02.png","icons/mountain-phase-3-02.png","icons/mountain-phase-4-02.png","icons/mountain-phase-5-02.png","icons/mountain-phase-6-02.png","icons/mountain-phase-7-02.png","icons/mountain-phase-8-02.png"],z=["icons/flower-phase-0-02.png","icons/flower-phase-1-02.png","icons/flower-phase-2-02.png","icons/flower-phase-3-02.png","icons/flower-phase-4-02.png","icons/flower-phase-5-02.png","icons/flower-phase-6-02.png","icons/flower-phase-7-02.png","icons/flower-phase-8-02.png"],{doc:V}=_,{disabled:X=!1}=_,{phase:G}=_,{replies:Y=!1}=_,Q,Z=V.deleteAfter;function te(ne){console.log("clicked"),$("click",ne)}V.path.endsWith(".md")?Q=j:Q=z;let ee=Math.floor((Z-Date.now())/(25488e8/Q.length))%Q.length;return q.$$set=ne=>{"doc"in ne&&M(6,V=ne.doc),"disabled"in ne&&M(0,X=ne.disabled),"phase"in ne&&M(1,G=ne.phase),"replies"in ne&&M(2,Y=ne.replies)},[X,G,Y,Q,te,ee,V]}class Icon extends SvelteComponent{constructor(_){super(),init(this,_,instance$k,create_fragment$m,safe_not_equal,{doc:6,disabled:0,phase:1,replies:2})}}const File_svelte_svelte_type_style_lang="";function create_if_block_1$a(q){let _;return{c(){_=element("div"),_.textContent="The upload button is disabled because a title is required.",attr(_,"class","svelte-902auw")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block$c(q){let _,M,$=q[1].kind+"",j;return{c(){_=element("p"),M=element("strong"),j=text($)},m(z,V){insert(z,_,V),append(_,M),append(M,j)},p(z,V){V&2&&$!==($=z[1].kind+"")&&set_data(j,$)},d(z){z&&detach(_)}}}function create_fragment$l(q){let _,M,$,j,z,V,X,G,Y,Q,Z,te,ee,ne,re,se,ie,oe=!q[0]&&create_if_block_1$a(),he=q[1]&&create_if_block$c(q);return{c(){_=element("div"),M=element("div"),$=element("h5"),$.textContent="Upload a file",j=space(),z=element("div"),z.textContent="Start by entering your title and the optional note.",V=space(),X=element("div"),X.textContent="Once the file is selected, it will be automatically uploaded.",G=space(),oe&&oe.c(),Y=space(),Q=element("button"),Z=text("file upload"),ee=space(),ne=element("input"),re=space(),he&&he.c(),attr($,"class","m-2"),attr(z,"class","svelte-902auw"),attr(X,"class","svelte-902auw"),attr(Q,"class","phase1 m-2 svelte-902auw"),Q.disabled=te=!q[0],set_style(ne,"display","none"),attr(ne,"type","file"),attr(ne,"accept",".jpg, .jpeg, .png, .gif, .txt, .pdf, .md, .webm, .mp3, .ogg, .wav"),attr(M,"class","text-left svelte-902auw"),attr(_,"class","svelte-902auw")},m(le,ae){insert(le,_,ae),append(_,M),append(M,$),append(M,j),append(M,z),append(M,V),append(M,X),append(M,G),oe&&oe.m(M,null),append(M,Y),append(M,Q),append(Q,Z),append(M,ee),append(M,ne),q[10](ne),append(_,re),he&&he.m(_,null),se||(ie=[listen(Q,"click",q[7]),listen(Q,"keypress",q[8]),listen(ne,"change",q[9])],se=!0)},p(le,[ae]){le[0]?oe&&(oe.d(1),oe=null):oe||(oe=create_if_block_1$a(),oe.c(),oe.m(M,Y)),ae&1&&te!==(te=!le[0])&&(Q.disabled=te),le[1]?he?he.p(le,ae):(he=create_if_block$c(le),he.c(),he.m(_,null)):he&&(he.d(1),he=null)},i:noop,o:noop,d(le){le&&detach(_),oe&&oe.d(),q[10](null),he&&he.d(),se=!1,run_all(ie)}}}function readFileAsync(q){return new Promise((_,M)=>{let $=new FileReader;$.onload=()=>{_($.result),console.log("typeof",$.result)},$.onerror=M,$.readAsArrayBuffer(q)})}function instance$j(q,_,M){let $,j;component_subscribe(q,authorKeypair,oe=>M(13,$=oe)),component_subscribe(q,replicaDetails,oe=>M(14,j=oe));const z=createEventDispatcher();let{xy:V=[0,0]}=_,X,G,Y,{title:Q=void 0}=_,{notes:Z=void 0}=_,{isValid:te=!0}=_;async function ee(oe){Z&&Q?Y="#Title: "+Q+"#Notes: "+Z:Q?Y="#Title: "+Q:Y="";let he=oe.target.files[0],ae=he.name.replace(/\s+/g,"_").replace(/[@·,\/#!$%\^&\*;:{}=\-`~()]/g,""),ue=ae.split(".").pop(),me=ae.split(".")[ae.split(".").length-2],fe;(ue==="JPG"||ue==="jpg")&&(ue="jpeg"),fe=me+"."+ue;let ce=Date.now(),_e=await readFileAsync(he),we=(Date.now()+25488e5)*1e3,ge=new Uint8Array(_e);return M(1,G=await j.replica.set($,{path:`/documents/${V[0]}/${V[1]}/${ce}/!${fe}`,text:"Shared by "+$.address.slice(1,5)+" on "+new Date().toLocaleString()+" "+Y,attachment:ge,deleteAfter:we})),console.log("Result: ",G),isErr(G)?(console.error(G),G.message):(console.log("Success!"),z("upload")),G}const ne=()=>{X.click()},re=()=>{X.click()},se=oe=>ee(oe);function ie(oe){binding_callbacks[oe?"unshift":"push"](()=>{X=oe,M(2,X)})}return q.$$set=oe=>{"xy"in oe&&M(4,V=oe.xy),"title"in oe&&M(5,Q=oe.title),"notes"in oe&&M(6,Z=oe.notes),"isValid"in oe&&M(0,te=oe.isValid)},q.$$.update=()=>{q.$$.dirty&2&&M(1,G)},[te,G,X,ee,V,Q,Z,ne,re,se,ie]}class File extends SvelteComponent{constructor(_){super(),init(this,_,instance$j,create_fragment$l,safe_not_equal,{xy:4,title:5,notes:6,isValid:0})}}const Upload_svelte_svelte_type_style_lang="";function create_if_block_4$2(q){let _,M;return _=new File({props:{xy:q[1],title:q[2],notes:q[5],isValid:q[3]}}),_.$on("upload",q[8]),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.xy=$[1]),j&4&&(z.title=$[2]),j&32&&(z.notes=$[5]),j&8&&(z.isValid=$[3]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block_3$5(q){let _,M;return _=new Voice({props:{xy:q[1],title:q[2],notes:q[5],isValid:q[3]}}),_.$on("upload",q[8]),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.xy=$[1]),j&4&&(z.title=$[2]),j&32&&(z.notes=$[5]),j&8&&(z.isValid=$[3]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block_2$8(q){let _,M,$;return{c(){_=element("textarea"),attr(_,"id","mainInput"),attr(_,"placeholder","Enter text"),attr(_,"class","svelte-xye4z5")},m(j,z){insert(j,_,z),set_input_value(_,q[4]),M||($=listen(_,"input",q[11]),M=!0)},p(j,z){z&16&&set_input_value(_,j[4])},i:noop,o:noop,d(j){j&&detach(_),M=!1,$()}}}function create_if_block$b(q){let _,M,$,j,z,V,X=!q[3]&&create_if_block_1$9();return{c(){X&&X.c(),_=space(),M=element("button"),$=text("Submit"),attr(M,"class","phase1 svelte-xye4z5"),M.disabled=j=!q[3]},m(G,Y){X&&X.m(G,Y),insert(G,_,Y),insert(G,M,Y),append(M,$),z||(V=listen(M,"click",q[7]),z=!0)},p(G,Y){G[3]?X&&(X.d(1),X=null):X||(X=create_if_block_1$9(),X.c(),X.m(_.parentNode,_)),Y&8&&j!==(j=!G[3])&&(M.disabled=j)},d(G){X&&X.d(G),G&&detach(_),G&&detach(M),z=!1,V()}}}function create_if_block_1$9(q){let _;return{c(){_=element("div"),_.textContent="Title is required."},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_fragment$k(q){let _,M,$,j,z,V,X,G,Y,Q,Z,te,ee,ne,re,se,ie,oe,he,le,ae,ue,me,fe;const ce=[create_if_block_2$8,create_if_block_3$5,create_if_block_4$2],_e=[];function we(Ae,de){return Ae[0]==="text"?0:Ae[0]==="audio"?1:Ae[0]==="file"?2:-1}~(te=we(q))&&(ee=_e[te]=ce[te](q));let ge=q[0]==="text"&&create_if_block$b(q);return{c(){_=element("div"),M=element("div"),$=element("div"),j=element("div"),z=element("button"),z.textContent="Close",V=space(),X=element("div"),G=element("input"),Y=space(),Q=element("div"),Z=element("div"),ee&&ee.c(),ne=space(),re=element("div"),se=element("h5"),se.textContent="Notes",ie=space(),oe=element("input"),he=space(),le=element("div"),ae=element("div"),ge&&ge.c(),attr(z,"class","close-button svelte-xye4z5"),attr(G,"id","titleInput"),attr(G,"class","align-left my-2 svelte-xye4z5"),attr(G,"type","text"),attr(G,"placeholder","Enter a title (required)"),attr(X,"class","flex flex-row justify-start"),attr(Z,"class","flex flex-col w-[50vw] items-start"),attr(se,"class","text-left"),attr(oe,"type","text"),attr(oe,"placeholder","Enter optional notes"),attr(re,"class","pr-6"),attr(Q,"class","flex flex-row justify-between"),attr(ae,"class","flex flex-col"),attr(le,"class","flex flex-row justify-end my-6"),attr(j,"class","p-6 w-full h-full bg-white"),attr($,"class","h-[80vh] w-full"),set_style(M,"position","relative"),set_style(M,"z-index","52"),set_style(_,"position","fixed"),set_style(_,"width","79vw")},m(Ae,de){insert(Ae,_,de),append(_,M),append(M,$),append($,j),append(j,z),append(j,V),append(j,X),append(X,G),set_input_value(G,q[2]),append(j,Y),append(j,Q),append(Q,Z),~te&&_e[te].m(Z,null),append(Q,ne),append(Q,re),append(re,se),append(re,ie),append(re,oe),set_input_value(oe,q[5]),append(j,he),append(j,le),append(le,ae),ge&&ge.m(ae,null),ue=!0,me||(fe=[listen(z,"click",q[9]),listen(G,"input",q[10]),listen(oe,"input",q[12])],me=!0)},p(Ae,[de]){de&4&&G.value!==Ae[2]&&set_input_value(G,Ae[2]);let De=te;te=we(Ae),te===De?~te&&_e[te].p(Ae,de):(ee&&(group_outros(),transition_out(_e[De],1,1,()=>{_e[De]=null}),check_outros()),~te?(ee=_e[te],ee?ee.p(Ae,de):(ee=_e[te]=ce[te](Ae),ee.c()),transition_in(ee,1),ee.m(Z,null)):ee=null),de&32&&oe.value!==Ae[5]&&set_input_value(oe,Ae[5]),Ae[0]==="text"?ge?ge.p(Ae,de):(ge=create_if_block$b(Ae),ge.c(),ge.m(ae,null)):ge&&(ge.d(1),ge=null)},i(Ae){ue||(transition_in(ee),ue=!0)},o(Ae){transition_out(ee),ue=!1},d(Ae){Ae&&detach(_),~te&&_e[te].d(),ge&&ge.d(),me=!1,run_all(fe)}}}function instance$i(q,_,M){let $,j;component_subscribe(q,authorKeypair,ue=>M(15,$=ue)),component_subscribe(q,replicaDetails,ue=>M(16,j=ue));let{filetype:z}=_,{xy:V=[0,0]}=_,X,G="",Y="",Q,Z,te=!0,ee=Date.now(),ne=(Date.now()+25488e5)*1e3;const re=createEventDispatcher();async function se(){let me=await new Blob([X],{type:"text/markdown"}).arrayBuffer(),fe=new Uint8Array(me),ce=$.address.slice(1,5);return Y?Q="#Title: "+G+"#Notes: "+Y:Q="#Title: "+G,Z=await j.replica.set($,{path:`/documents/${V[0]}/${V[1]}/${ee}/!text-input-by-${ce}.md`,text:"Text input by "+$.address.slice(1,5)+" on "+new Date().toLocaleString()+Q,attachment:fe,deleteAfter:ne}),console.log("Result: ",Z),isErr(Z)&&console.error(Z),re("success"),Z}function ie(ue){console.log("event in Upload.svelte",ue),re("success")}const oe=()=>re("close");function he(){G=this.value,M(2,G)}function le(){X=this.value,M(4,X)}function ae(){Y=this.value,M(5,Y)}return q.$$set=ue=>{"filetype"in ue&&M(0,z=ue.filetype),"xy"in ue&&M(1,V=ue.xy)},q.$$.update=()=>{q.$$.dirty&4&&(G&&G.trim()!==""?M(3,te=!0):M(3,te=!1)),q.$$.dirty&8&&console.log("isValid",te),q.$$.dirty&1&&console.log("filetype in Upload.svelte",z),q.$$.dirty&1&&console.log("filetype in Upload.svelte",z)},[z,V,G,te,X,Y,re,se,ie,oe,he,le,ae]}class Upload extends SvelteComponent{constructor(_){super(),init(this,_,instance$i,create_fragment$k,safe_not_equal,{filetype:0,xy:1})}}const OrbitingIcons_svelte_svelte_type_style_lang="";function create_fragment$j(q){let _,M,$;return M=new Icon({props:{doc:q[0],phase:q[1]%9,replies:replies$1}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","icon-container svelte-1p6jdr4")},m(j,z){insert(j,_,z),mount_component(M,_,null),q[4](_),$=!0},p(j,[z]){const V={};z&1&&(V.doc=j[0]),z&2&&(V.phase=j[1]%9),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M),q[4](null)}}}let replies$1=!0;function instance$h(q,_,M){let{doc:$}=_,{index:j}=_,{orbitDiameter:z}=_,V;onMount(()=>{let G=Math.random()*360;const Y=1.2;function Q(){if(V){G+=Y;const Z=G*Math.PI/180,te=z/4-j*19,ee=Math.cos(Z)*te,ne=Math.sin(Z)*te;M(2,V.style.transform=`translate(${ee}px, ${ne}px)`,V),requestAnimationFrame(Q)}}Q()});function X(G){binding_callbacks[G?"unshift":"push"](()=>{V=G,M(2,V)})}return q.$$set=G=>{"doc"in G&&M(0,$=G.doc),"index"in G&&M(1,j=G.index),"orbitDiameter"in G&&M(3,z=G.orbitDiameter)},[$,j,V,z,X]}class OrbitingIcons extends SvelteComponent{constructor(_){super(),init(this,_,instance$h,create_fragment$j,safe_not_equal,{doc:0,index:1,orbitDiameter:3})}}const OrbitingReplies_svelte_svelte_type_style_lang="";function get_each_context$7(q,_,M){const $=q.slice();return $[5]=_[M],$[7]=M,$}function create_each_block$7(q,_){let M,$,j;return $=new OrbitingIcons({props:{doc:_[0],index:_[7],orbitDiameter}}),{key:q,first:null,c(){M=empty(),create_component($.$$.fragment),this.first=M},m(z,V){insert(z,M,V),mount_component($,z,V),j=!0},p(z,V){_=z;const X={};V&1&&(X.doc=_[0]),V&4&&(X.index=_[7]),$.$set(X)},i(z){j||(transition_in($.$$.fragment,z),j=!0)},o(z){transition_out($.$$.fragment,z),j=!1},d(z){z&&detach(M),destroy_component($,z)}}}function create_fragment$i(q){let _,M=[],$=new Map,j,z=q[2];const V=X=>X[5].textHash+X[5].timestamp;for(let X=0;X<z.length;X+=1){let G=get_each_context$7(q,z,X),Y=V(G);$.set(Y,M[X]=create_each_block$7(Y,G))}return{c(){_=element("div");for(let X=0;X<M.length;X+=1)M[X].c();attr(_,"id","circle-orbit-container"),set_style(_,"height",orbitDiameter+"px"),set_style(_,"width",orbitDiameter+"px"),attr(_,"class","svelte-1018vin"),toggle_class(_,"disabled",q[1])},m(X,G){insert(X,_,G);for(let Y=0;Y<M.length;Y+=1)M[Y].m(_,null);j=!0},p(X,[G]){G&5&&(z=X[2],group_outros(),M=update_keyed_each(M,G,V,1,X,z,$,_,outro_and_destroy_block,create_each_block$7,null,get_each_context$7),check_outros()),(!j||G&2)&&toggle_class(_,"disabled",X[1])},i(X){if(!j){for(let G=0;G<z.length;G+=1)transition_in(M[G]);j=!0}},o(X){for(let G=0;G<M.length;G+=1)transition_out(M[G]);j=!1},d(X){X&&detach(_);for(let G=0;G<M.length;G+=1)M[G].d()}}}const orbitDiameter=160;function instance$g(q,_,M){let $;component_subscribe(q,cacheDetails,G=>M(3,$=G));let{doc:j=null}=_,{disabled:z=!1}=_,V=[];const X=async()=>{const G=j.path.split("/");G.pop();const Y=G.join("/");let Q=await $.queryDocs({filter:{pathStartsWith:Y}});M(2,V=Q.slice(1))};return onMount(X),q.$$set=G=>{"doc"in G&&M(0,j=G.doc),"disabled"in G&&M(1,z=G.disabled)},q.$$.update=()=>{q.$$.dirty&1&&j&&X()},[j,z,V]}class OrbitingReplies extends SvelteComponent{constructor(_){super(),init(this,_,instance$g,create_fragment$i,safe_not_equal,{doc:0,disabled:1})}}function create_if_block$a(q){let _,M;return{c(){_=element("div"),M=text(q[0]),set_style(_,"position","absolute"),set_style(_,"top","10px"),set_style(_,"left","10px"),set_style(_,"background","lightgray"),set_style(_,"padding","10px"),set_style(_,"border-radius","5px"),set_style(_,"z-index","1")},m($,j){insert($,_,j),append(_,M)},p($,j){j&1&&set_data(M,$[0])},d($){$&&detach(_)}}}function create_fragment$h(q){let _,M,$;const j=q[4].default,z=create_slot(j,q,q[3],null);let V=q[2]&&create_if_block$a(q);return{c(){_=element("div"),z&&z.c(),M=space(),V&&V.c(),set_style(_,"position","relative")},m(X,G){insert(X,_,G),z&&z.m(_,null),append(_,M),V&&V.m(_,null),q[5](_),$=!0},p(X,[G]){z&&z.p&&(!$||G&8)&&update_slot_base(z,j,X,X[3],$?get_slot_changes(j,X[3],G,null):get_all_dirty_from_scope(X[3]),null),X[2]?V?V.p(X,G):(V=create_if_block$a(X),V.c(),V.m(_,null)):V&&(V.d(1),V=null)},i(X){$||(transition_in(z,X),$=!0)},o(X){transition_out(z,X),$=!1},d(X){X&&detach(_),z&&z.d(X),V&&V.d(),q[5](null)}}}function instance$f(q,_,M){let{$$slots:$={},$$scope:j}=_,z,{text:V=""}=_,X=!1;onMount(()=>{z.addEventListener("mouseover",()=>{M(2,X=!0)}),z.addEventListener("mouseout",()=>{M(2,X=!1)})});function G(Y){binding_callbacks[Y?"unshift":"push"](()=>{z=Y,M(1,z)})}return q.$$set=Y=>{"text"in Y&&M(0,V=Y.text),"$$scope"in Y&&M(3,j=Y.$$scope)},[V,z,X,j,$,G]}class Tooltip extends SvelteComponent{constructor(_){super(),init(this,_,instance$f,create_fragment$h,safe_not_equal,{text:0})}}const StudioPortal_svelte_svelte_type_style_lang="";function get_each_context$6(q,_,M){const $=q.slice();return $[5]=_[M],$}function create_default_slot(q){let _;return{c(){_=element("p"),_.innerHTML="You have reached the Beginning of Studio portals. <br/>Choose the Studio you want to enter:",attr(_,"class","svelte-as39s0")},m(M,$){insert(M,_,$)},p:noop,d(M){M&&detach(_)}}}function create_each_block$6(q,_){let M,$=_[5]+"",j,z;return{key:q,first:null,c(){M=element("option"),j=text($),M.__value=z=_[5],M.value=M.__value,this.first=M},m(V,X){insert(V,M,X),append(M,j)},p(V,X){_=V,X&2&&$!==($=_[5]+"")&&set_data(j,$),X&2&&z!==(z=_[5])&&(M.__value=z,M.value=M.__value)},d(V){V&&detach(M)}}}function create_fragment$g(q){let _,M,$,j,z,V,X,G=[],Y=new Map,Q,Z,te,ee,ne;$=new Tooltip({props:{text:"You can choose from any studio you saved in the share in settings. Settings can be accessed from the top left corner under 'workspace settings'.",$$slots:{default:[create_default_slot]},$$scope:{ctx:q}}});let re=q[1];const se=ie=>ie[5];for(let ie=0;ie<re.length;ie+=1){let oe=get_each_context$6(q,re,ie),he=se(oe);Y.set(he,G[ie]=create_each_block$6(he,oe))}return{c(){_=element("div"),M=element("div"),create_component($.$$.fragment),j=space(),z=element("label"),z.textContent="Select Workspace",V=space(),X=element("select");for(let ie=0;ie<G.length;ie+=1)G[ie].c();Q=space(),Z=element("button"),Z.textContent="enter selected studio",attr(z,"for","share-switcher"),attr(z,"class","text-center svelte-as39s0"),attr(X,"id","share-switcher"),attr(X,"class","form-control svelte-as39s0"),q[0]===void 0&&add_render_callback(()=>q[3].call(X)),attr(Z,"class","phase1 my-2"),attr(M,"class","flex flex-col items-center justify-center max-w-3xl mx-auto w-full md:w-1/2 svelte-as39s0"),attr(_,"class","flex flex-col items-center justify-center svelte-as39s0")},m(ie,oe){insert(ie,_,oe),append(_,M),mount_component($,M,null),append(M,j),append(M,z),append(M,V),append(M,X);for(let he=0;he<G.length;he+=1)G[he].m(X,null);select_option(X,q[0]),append(M,Q),append(M,Z),te=!0,ee||(ne=[listen(X,"change",q[3]),listen(Z,"click",q[2])],ee=!0)},p(ie,[oe]){const he={};oe&256&&(he.$$scope={dirty:oe,ctx:ie}),$.$set(he),oe&2&&(re=ie[1],G=update_keyed_each(G,oe,se,1,ie,re,Y,X,destroy_block,create_each_block$6,null,get_each_context$6)),oe&3&&select_option(X,ie[0])},i(ie){te||(transition_in($.$$.fragment,ie),te=!0)},o(ie){transition_out($.$$.fragment,ie),te=!1},d(ie){ie&&detach(_),destroy_component($);for(let oe=0;oe<G.length;oe+=1)G[oe].d();ee=!1,run_all(ne)}}}function instance$e(q,_,M){const $=createEventDispatcher();let j=get_store_value(shareKeypair).shareAddress;shareKeypair.subscribe(G=>{M(0,j=G.shareAddress)});function z(){const G=j,Y=settings.shareSecrets[G];shareKeypair.set({shareAddress:G,secret:Y}),$("shareUpdated")}let V=[];studioShares.subscribe(G=>{M(1,V=[...G])});function X(){j=select_value(this),M(0,j),M(1,V)}return[j,V,z,X]}class StudioPortal extends SvelteComponent{constructor(_){super(),init(this,_,instance$e,create_fragment$g,safe_not_equal,{})}}var jszip_min={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(q,_){(function(M){q.exports=M()})(function(){return function M($,j,z){function V(Y,Q){if(!j[Y]){if(!$[Y]){var Z=typeof commonjsRequire=="function"&&commonjsRequire;if(!Q&&Z)return Z(Y,!0);if(X)return X(Y,!0);var te=new Error("Cannot find module '"+Y+"'");throw te.code="MODULE_NOT_FOUND",te}var ee=j[Y]={exports:{}};$[Y][0].call(ee.exports,function(ne){var re=$[Y][1][ne];return V(re||ne)},ee,ee.exports,M,$,j,z)}return j[Y].exports}for(var X=typeof commonjsRequire=="function"&&commonjsRequire,G=0;G<z.length;G++)V(z[G]);return V}({1:[function(M,$,j){var z=M("./utils"),V=M("./support"),X="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";j.encode=function(G){for(var Y,Q,Z,te,ee,ne,re,se=[],ie=0,oe=G.length,he=oe,le=z.getTypeOf(G)!=="string";ie<G.length;)he=oe-ie,Z=le?(Y=G[ie++],Q=ie<oe?G[ie++]:0,ie<oe?G[ie++]:0):(Y=G.charCodeAt(ie++),Q=ie<oe?G.charCodeAt(ie++):0,ie<oe?G.charCodeAt(ie++):0),te=Y>>2,ee=(3&Y)<<4|Q>>4,ne=1<he?(15&Q)<<2|Z>>6:64,re=2<he?63&Z:64,se.push(X.charAt(te)+X.charAt(ee)+X.charAt(ne)+X.charAt(re));return se.join("")},j.decode=function(G){var Y,Q,Z,te,ee,ne,re=0,se=0,ie="data:";if(G.substr(0,ie.length)===ie)throw new Error("Invalid base64 input, it looks like a data url.");var oe,he=3*(G=G.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(G.charAt(G.length-1)===X.charAt(64)&&he--,G.charAt(G.length-2)===X.charAt(64)&&he--,he%1!=0)throw new Error("Invalid base64 input, bad content length.");for(oe=V.uint8array?new Uint8Array(0|he):new Array(0|he);re<G.length;)Y=X.indexOf(G.charAt(re++))<<2|(te=X.indexOf(G.charAt(re++)))>>4,Q=(15&te)<<4|(ee=X.indexOf(G.charAt(re++)))>>2,Z=(3&ee)<<6|(ne=X.indexOf(G.charAt(re++))),oe[se++]=Y,ee!==64&&(oe[se++]=Q),ne!==64&&(oe[se++]=Z);return oe}},{"./support":30,"./utils":32}],2:[function(M,$,j){var z=M("./external"),V=M("./stream/DataWorker"),X=M("./stream/Crc32Probe"),G=M("./stream/DataLengthProbe");function Y(Q,Z,te,ee,ne){this.compressedSize=Q,this.uncompressedSize=Z,this.crc32=te,this.compression=ee,this.compressedContent=ne}Y.prototype={getContentWorker:function(){var Q=new V(z.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new G("data_length")),Z=this;return Q.on("end",function(){if(this.streamInfo.data_length!==Z.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),Q},getCompressedWorker:function(){return new V(z.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},Y.createWorkerFrom=function(Q,Z,te){return Q.pipe(new X).pipe(new G("uncompressedSize")).pipe(Z.compressWorker(te)).pipe(new G("compressedSize")).withStreamInfo("compression",Z)},$.exports=Y},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(M,$,j){var z=M("./stream/GenericWorker");j.STORE={magic:"\0\0",compressWorker:function(){return new z("STORE compression")},uncompressWorker:function(){return new z("STORE decompression")}},j.DEFLATE=M("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(M,$,j){var z=M("./utils"),V=function(){for(var X,G=[],Y=0;Y<256;Y++){X=Y;for(var Q=0;Q<8;Q++)X=1&X?3988292384^X>>>1:X>>>1;G[Y]=X}return G}();$.exports=function(X,G){return X!==void 0&&X.length?z.getTypeOf(X)!=="string"?function(Y,Q,Z,te){var ee=V,ne=te+Z;Y^=-1;for(var re=te;re<ne;re++)Y=Y>>>8^ee[255&(Y^Q[re])];return-1^Y}(0|G,X,X.length,0):function(Y,Q,Z,te){var ee=V,ne=te+Z;Y^=-1;for(var re=te;re<ne;re++)Y=Y>>>8^ee[255&(Y^Q.charCodeAt(re))];return-1^Y}(0|G,X,X.length,0):0}},{"./utils":32}],5:[function(M,$,j){j.base64=!1,j.binary=!1,j.dir=!1,j.createFolders=!0,j.date=null,j.compression=null,j.compressionOptions=null,j.comment=null,j.unixPermissions=null,j.dosPermissions=null},{}],6:[function(M,$,j){var z=null;z=typeof Promise<"u"?Promise:M("lie"),$.exports={Promise:z}},{lie:37}],7:[function(M,$,j){var z=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",V=M("pako"),X=M("./utils"),G=M("./stream/GenericWorker"),Y=z?"uint8array":"array";function Q(Z,te){G.call(this,"FlateWorker/"+Z),this._pako=null,this._pakoAction=Z,this._pakoOptions=te,this.meta={}}j.magic="\b\0",X.inherits(Q,G),Q.prototype.processChunk=function(Z){this.meta=Z.meta,this._pako===null&&this._createPako(),this._pako.push(X.transformTo(Y,Z.data),!1)},Q.prototype.flush=function(){G.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},Q.prototype.cleanUp=function(){G.prototype.cleanUp.call(this),this._pako=null},Q.prototype._createPako=function(){this._pako=new V[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var Z=this;this._pako.onData=function(te){Z.push({data:te,meta:Z.meta})}},j.compressWorker=function(Z){return new Q("Deflate",Z)},j.uncompressWorker=function(){return new Q("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(M,$,j){function z(ee,ne){var re,se="";for(re=0;re<ne;re++)se+=String.fromCharCode(255&ee),ee>>>=8;return se}function V(ee,ne,re,se,ie,oe){var he,le,ae=ee.file,ue=ee.compression,me=oe!==Y.utf8encode,fe=X.transformTo("string",oe(ae.name)),ce=X.transformTo("string",Y.utf8encode(ae.name)),_e=ae.comment,we=X.transformTo("string",oe(_e)),ge=X.transformTo("string",Y.utf8encode(_e)),Ae=ce.length!==ae.name.length,de=ge.length!==_e.length,De="",Me="",Ee="",Te=ae.dir,xe=ae.date,He={crc32:0,compressedSize:0,uncompressedSize:0};ne&&!re||(He.crc32=ee.crc32,He.compressedSize=ee.compressedSize,He.uncompressedSize=ee.uncompressedSize);var Oe=0;ne&&(Oe|=8),me||!Ae&&!de||(Oe|=2048);var $e=0,Pe=0;Te&&($e|=16),ie==="UNIX"?(Pe=798,$e|=function(ye,Fe){var je=ye;return ye||(je=Fe?16893:33204),(65535&je)<<16}(ae.unixPermissions,Te)):(Pe=20,$e|=function(ye){return 63&(ye||0)}(ae.dosPermissions)),he=xe.getUTCHours(),he<<=6,he|=xe.getUTCMinutes(),he<<=5,he|=xe.getUTCSeconds()/2,le=xe.getUTCFullYear()-1980,le<<=4,le|=xe.getUTCMonth()+1,le<<=5,le|=xe.getUTCDate(),Ae&&(Me=z(1,1)+z(Q(fe),4)+ce,De+="up"+z(Me.length,2)+Me),de&&(Ee=z(1,1)+z(Q(we),4)+ge,De+="uc"+z(Ee.length,2)+Ee);var ve="";return ve+=`
\0`,ve+=z(Oe,2),ve+=ue.magic,ve+=z(he,2),ve+=z(le,2),ve+=z(He.crc32,4),ve+=z(He.compressedSize,4),ve+=z(He.uncompressedSize,4),ve+=z(fe.length,2),ve+=z(De.length,2),{fileRecord:Z.LOCAL_FILE_HEADER+ve+fe+De,dirRecord:Z.CENTRAL_FILE_HEADER+z(Pe,2)+ve+z(we.length,2)+"\0\0\0\0"+z($e,4)+z(se,4)+fe+De+we}}var X=M("../utils"),G=M("../stream/GenericWorker"),Y=M("../utf8"),Q=M("../crc32"),Z=M("../signature");function te(ee,ne,re,se){G.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=ne,this.zipPlatform=re,this.encodeFileName=se,this.streamFiles=ee,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}X.inherits(te,G),te.prototype.push=function(ee){var ne=ee.meta.percent||0,re=this.entriesCount,se=this._sources.length;this.accumulate?this.contentBuffer.push(ee):(this.bytesWritten+=ee.data.length,G.prototype.push.call(this,{data:ee.data,meta:{currentFile:this.currentFile,percent:re?(ne+100*(re-se-1))/re:100}}))},te.prototype.openedSource=function(ee){this.currentSourceOffset=this.bytesWritten,this.currentFile=ee.file.name;var ne=this.streamFiles&&!ee.file.dir;if(ne){var re=V(ee,ne,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:re.fileRecord,meta:{percent:0}})}else this.accumulate=!0},te.prototype.closedSource=function(ee){this.accumulate=!1;var ne=this.streamFiles&&!ee.file.dir,re=V(ee,ne,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(re.dirRecord),ne)this.push({data:function(se){return Z.DATA_DESCRIPTOR+z(se.crc32,4)+z(se.compressedSize,4)+z(se.uncompressedSize,4)}(ee),meta:{percent:100}});else for(this.push({data:re.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},te.prototype.flush=function(){for(var ee=this.bytesWritten,ne=0;ne<this.dirRecords.length;ne++)this.push({data:this.dirRecords[ne],meta:{percent:100}});var re=this.bytesWritten-ee,se=function(ie,oe,he,le,ae){var ue=X.transformTo("string",ae(le));return Z.CENTRAL_DIRECTORY_END+"\0\0\0\0"+z(ie,2)+z(ie,2)+z(oe,4)+z(he,4)+z(ue.length,2)+ue}(this.dirRecords.length,re,ee,this.zipComment,this.encodeFileName);this.push({data:se,meta:{percent:100}})},te.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},te.prototype.registerPrevious=function(ee){this._sources.push(ee);var ne=this;return ee.on("data",function(re){ne.processChunk(re)}),ee.on("end",function(){ne.closedSource(ne.previous.streamInfo),ne._sources.length?ne.prepareNextSource():ne.end()}),ee.on("error",function(re){ne.error(re)}),this},te.prototype.resume=function(){return!!G.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},te.prototype.error=function(ee){var ne=this._sources;if(!G.prototype.error.call(this,ee))return!1;for(var re=0;re<ne.length;re++)try{ne[re].error(ee)}catch{}return!0},te.prototype.lock=function(){G.prototype.lock.call(this);for(var ee=this._sources,ne=0;ne<ee.length;ne++)ee[ne].lock()},$.exports=te},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(M,$,j){var z=M("../compressions"),V=M("./ZipFileWorker");j.generateWorker=function(X,G,Y){var Q=new V(G.streamFiles,Y,G.platform,G.encodeFileName),Z=0;try{X.forEach(function(te,ee){Z++;var ne=function(oe,he){var le=oe||he,ae=z[le];if(!ae)throw new Error(le+" is not a valid compression method !");return ae}(ee.options.compression,G.compression),re=ee.options.compressionOptions||G.compressionOptions||{},se=ee.dir,ie=ee.date;ee._compressWorker(ne,re).withStreamInfo("file",{name:te,dir:se,date:ie,comment:ee.comment||"",unixPermissions:ee.unixPermissions,dosPermissions:ee.dosPermissions}).pipe(Q)}),Q.entriesCount=Z}catch(te){Q.error(te)}return Q}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(M,$,j){function z(){if(!(this instanceof z))return new z;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var V=new z;for(var X in this)typeof this[X]!="function"&&(V[X]=this[X]);return V}}(z.prototype=M("./object")).loadAsync=M("./load"),z.support=M("./support"),z.defaults=M("./defaults"),z.version="3.10.1",z.loadAsync=function(V,X){return new z().loadAsync(V,X)},z.external=M("./external"),$.exports=z},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(M,$,j){var z=M("./utils"),V=M("./external"),X=M("./utf8"),G=M("./zipEntries"),Y=M("./stream/Crc32Probe"),Q=M("./nodejsUtils");function Z(te){return new V.Promise(function(ee,ne){var re=te.decompressed.getContentWorker().pipe(new Y);re.on("error",function(se){ne(se)}).on("end",function(){re.streamInfo.crc32!==te.decompressed.crc32?ne(new Error("Corrupted zip : CRC32 mismatch")):ee()}).resume()})}$.exports=function(te,ee){var ne=this;return ee=z.extend(ee||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:X.utf8decode}),Q.isNode&&Q.isStream(te)?V.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):z.prepareContent("the loaded zip file",te,!0,ee.optimizedBinaryString,ee.base64).then(function(re){var se=new G(ee);return se.load(re),se}).then(function(re){var se=[V.Promise.resolve(re)],ie=re.files;if(ee.checkCRC32)for(var oe=0;oe<ie.length;oe++)se.push(Z(ie[oe]));return V.Promise.all(se)}).then(function(re){for(var se=re.shift(),ie=se.files,oe=0;oe<ie.length;oe++){var he=ie[oe],le=he.fileNameStr,ae=z.resolve(he.fileNameStr);ne.file(ae,he.decompressed,{binary:!0,optimizedBinaryString:!0,date:he.date,dir:he.dir,comment:he.fileCommentStr.length?he.fileCommentStr:null,unixPermissions:he.unixPermissions,dosPermissions:he.dosPermissions,createFolders:ee.createFolders}),he.dir||(ne.file(ae).unsafeOriginalName=le)}return se.zipComment.length&&(ne.comment=se.zipComment),ne})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(M,$,j){var z=M("../utils"),V=M("../stream/GenericWorker");function X(G,Y){V.call(this,"Nodejs stream input adapter for "+G),this._upstreamEnded=!1,this._bindStream(Y)}z.inherits(X,V),X.prototype._bindStream=function(G){var Y=this;(this._stream=G).pause(),G.on("data",function(Q){Y.push({data:Q,meta:{percent:0}})}).on("error",function(Q){Y.isPaused?this.generatedError=Q:Y.error(Q)}).on("end",function(){Y.isPaused?Y._upstreamEnded=!0:Y.end()})},X.prototype.pause=function(){return!!V.prototype.pause.call(this)&&(this._stream.pause(),!0)},X.prototype.resume=function(){return!!V.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},$.exports=X},{"../stream/GenericWorker":28,"../utils":32}],13:[function(M,$,j){var z=M("readable-stream").Readable;function V(X,G,Y){z.call(this,G),this._helper=X;var Q=this;X.on("data",function(Z,te){Q.push(Z)||Q._helper.pause(),Y&&Y(te)}).on("error",function(Z){Q.emit("error",Z)}).on("end",function(){Q.push(null)})}M("../utils").inherits(V,z),V.prototype._read=function(){this._helper.resume()},$.exports=V},{"../utils":32,"readable-stream":16}],14:[function(M,$,j){$.exports={isNode:typeof Buffer<"u",newBufferFrom:function(z,V){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(z,V);if(typeof z=="number")throw new Error('The "data" argument must not be a number');return new Buffer(z,V)},allocBuffer:function(z){if(Buffer.alloc)return Buffer.alloc(z);var V=new Buffer(z);return V.fill(0),V},isBuffer:function(z){return Buffer.isBuffer(z)},isStream:function(z){return z&&typeof z.on=="function"&&typeof z.pause=="function"&&typeof z.resume=="function"}}},{}],15:[function(M,$,j){function z(ae,ue,me){var fe,ce=X.getTypeOf(ue),_e=X.extend(me||{},Q);_e.date=_e.date||new Date,_e.compression!==null&&(_e.compression=_e.compression.toUpperCase()),typeof _e.unixPermissions=="string"&&(_e.unixPermissions=parseInt(_e.unixPermissions,8)),_e.unixPermissions&&16384&_e.unixPermissions&&(_e.dir=!0),_e.dosPermissions&&16&_e.dosPermissions&&(_e.dir=!0),_e.dir&&(ae=ie(ae)),_e.createFolders&&(fe=se(ae))&&oe.call(this,fe,!0);var we=ce==="string"&&_e.binary===!1&&_e.base64===!1;me&&me.binary!==void 0||(_e.binary=!we),(ue instanceof Z&&ue.uncompressedSize===0||_e.dir||!ue||ue.length===0)&&(_e.base64=!1,_e.binary=!0,ue="",_e.compression="STORE",ce="string");var ge=null;ge=ue instanceof Z||ue instanceof G?ue:ne.isNode&&ne.isStream(ue)?new re(ae,ue):X.prepareContent(ae,ue,_e.binary,_e.optimizedBinaryString,_e.base64);var Ae=new te(ae,ge,_e);this.files[ae]=Ae}var V=M("./utf8"),X=M("./utils"),G=M("./stream/GenericWorker"),Y=M("./stream/StreamHelper"),Q=M("./defaults"),Z=M("./compressedObject"),te=M("./zipObject"),ee=M("./generate"),ne=M("./nodejsUtils"),re=M("./nodejs/NodejsStreamInputAdapter"),se=function(ae){ae.slice(-1)==="/"&&(ae=ae.substring(0,ae.length-1));var ue=ae.lastIndexOf("/");return 0<ue?ae.substring(0,ue):""},ie=function(ae){return ae.slice(-1)!=="/"&&(ae+="/"),ae},oe=function(ae,ue){return ue=ue!==void 0?ue:Q.createFolders,ae=ie(ae),this.files[ae]||z.call(this,ae,null,{dir:!0,createFolders:ue}),this.files[ae]};function he(ae){return Object.prototype.toString.call(ae)==="[object RegExp]"}var le={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(ae){var ue,me,fe;for(ue in this.files)fe=this.files[ue],(me=ue.slice(this.root.length,ue.length))&&ue.slice(0,this.root.length)===this.root&&ae(me,fe)},filter:function(ae){var ue=[];return this.forEach(function(me,fe){ae(me,fe)&&ue.push(fe)}),ue},file:function(ae,ue,me){if(arguments.length!==1)return ae=this.root+ae,z.call(this,ae,ue,me),this;if(he(ae)){var fe=ae;return this.filter(function(_e,we){return!we.dir&&fe.test(_e)})}var ce=this.files[this.root+ae];return ce&&!ce.dir?ce:null},folder:function(ae){if(!ae)return this;if(he(ae))return this.filter(function(ce,_e){return _e.dir&&ae.test(ce)});var ue=this.root+ae,me=oe.call(this,ue),fe=this.clone();return fe.root=me.name,fe},remove:function(ae){ae=this.root+ae;var ue=this.files[ae];if(ue||(ae.slice(-1)!=="/"&&(ae+="/"),ue=this.files[ae]),ue&&!ue.dir)delete this.files[ae];else for(var me=this.filter(function(ce,_e){return _e.name.slice(0,ae.length)===ae}),fe=0;fe<me.length;fe++)delete this.files[me[fe].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(ae){var ue,me={};try{if((me=X.extend(ae||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:V.utf8encode})).type=me.type.toLowerCase(),me.compression=me.compression.toUpperCase(),me.type==="binarystring"&&(me.type="string"),!me.type)throw new Error("No output type specified.");X.checkSupport(me.type),me.platform!=="darwin"&&me.platform!=="freebsd"&&me.platform!=="linux"&&me.platform!=="sunos"||(me.platform="UNIX"),me.platform==="win32"&&(me.platform="DOS");var fe=me.comment||this.comment||"";ue=ee.generateWorker(this,me,fe)}catch(ce){(ue=new G("error")).error(ce)}return new Y(ue,me.type||"string",me.mimeType)},generateAsync:function(ae,ue){return this.generateInternalStream(ae).accumulate(ue)},generateNodeStream:function(ae,ue){return(ae=ae||{}).type||(ae.type="nodebuffer"),this.generateInternalStream(ae).toNodejsStream(ue)}};$.exports=le},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(M,$,j){$.exports=M("stream")},{stream:void 0}],17:[function(M,$,j){var z=M("./DataReader");function V(X){z.call(this,X);for(var G=0;G<this.data.length;G++)X[G]=255&X[G]}M("../utils").inherits(V,z),V.prototype.byteAt=function(X){return this.data[this.zero+X]},V.prototype.lastIndexOfSignature=function(X){for(var G=X.charCodeAt(0),Y=X.charCodeAt(1),Q=X.charCodeAt(2),Z=X.charCodeAt(3),te=this.length-4;0<=te;--te)if(this.data[te]===G&&this.data[te+1]===Y&&this.data[te+2]===Q&&this.data[te+3]===Z)return te-this.zero;return-1},V.prototype.readAndCheckSignature=function(X){var G=X.charCodeAt(0),Y=X.charCodeAt(1),Q=X.charCodeAt(2),Z=X.charCodeAt(3),te=this.readData(4);return G===te[0]&&Y===te[1]&&Q===te[2]&&Z===te[3]},V.prototype.readData=function(X){if(this.checkOffset(X),X===0)return[];var G=this.data.slice(this.zero+this.index,this.zero+this.index+X);return this.index+=X,G},$.exports=V},{"../utils":32,"./DataReader":18}],18:[function(M,$,j){var z=M("../utils");function V(X){this.data=X,this.length=X.length,this.index=0,this.zero=0}V.prototype={checkOffset:function(X){this.checkIndex(this.index+X)},checkIndex:function(X){if(this.length<this.zero+X||X<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+X+"). Corrupted zip ?")},setIndex:function(X){this.checkIndex(X),this.index=X},skip:function(X){this.setIndex(this.index+X)},byteAt:function(){},readInt:function(X){var G,Y=0;for(this.checkOffset(X),G=this.index+X-1;G>=this.index;G--)Y=(Y<<8)+this.byteAt(G);return this.index+=X,Y},readString:function(X){return z.transformTo("string",this.readData(X))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var X=this.readInt(4);return new Date(Date.UTC(1980+(X>>25&127),(X>>21&15)-1,X>>16&31,X>>11&31,X>>5&63,(31&X)<<1))}},$.exports=V},{"../utils":32}],19:[function(M,$,j){var z=M("./Uint8ArrayReader");function V(X){z.call(this,X)}M("../utils").inherits(V,z),V.prototype.readData=function(X){this.checkOffset(X);var G=this.data.slice(this.zero+this.index,this.zero+this.index+X);return this.index+=X,G},$.exports=V},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(M,$,j){var z=M("./DataReader");function V(X){z.call(this,X)}M("../utils").inherits(V,z),V.prototype.byteAt=function(X){return this.data.charCodeAt(this.zero+X)},V.prototype.lastIndexOfSignature=function(X){return this.data.lastIndexOf(X)-this.zero},V.prototype.readAndCheckSignature=function(X){return X===this.readData(4)},V.prototype.readData=function(X){this.checkOffset(X);var G=this.data.slice(this.zero+this.index,this.zero+this.index+X);return this.index+=X,G},$.exports=V},{"../utils":32,"./DataReader":18}],21:[function(M,$,j){var z=M("./ArrayReader");function V(X){z.call(this,X)}M("../utils").inherits(V,z),V.prototype.readData=function(X){if(this.checkOffset(X),X===0)return new Uint8Array(0);var G=this.data.subarray(this.zero+this.index,this.zero+this.index+X);return this.index+=X,G},$.exports=V},{"../utils":32,"./ArrayReader":17}],22:[function(M,$,j){var z=M("../utils"),V=M("../support"),X=M("./ArrayReader"),G=M("./StringReader"),Y=M("./NodeBufferReader"),Q=M("./Uint8ArrayReader");$.exports=function(Z){var te=z.getTypeOf(Z);return z.checkSupport(te),te!=="string"||V.uint8array?te==="nodebuffer"?new Y(Z):V.uint8array?new Q(z.transformTo("uint8array",Z)):new X(z.transformTo("array",Z)):new G(Z)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(M,$,j){j.LOCAL_FILE_HEADER="PK",j.CENTRAL_FILE_HEADER="PK",j.CENTRAL_DIRECTORY_END="PK",j.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",j.ZIP64_CENTRAL_DIRECTORY_END="PK",j.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(M,$,j){var z=M("./GenericWorker"),V=M("../utils");function X(G){z.call(this,"ConvertWorker to "+G),this.destType=G}V.inherits(X,z),X.prototype.processChunk=function(G){this.push({data:V.transformTo(this.destType,G.data),meta:G.meta})},$.exports=X},{"../utils":32,"./GenericWorker":28}],25:[function(M,$,j){var z=M("./GenericWorker"),V=M("../crc32");function X(){z.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}M("../utils").inherits(X,z),X.prototype.processChunk=function(G){this.streamInfo.crc32=V(G.data,this.streamInfo.crc32||0),this.push(G)},$.exports=X},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(M,$,j){var z=M("../utils"),V=M("./GenericWorker");function X(G){V.call(this,"DataLengthProbe for "+G),this.propName=G,this.withStreamInfo(G,0)}z.inherits(X,V),X.prototype.processChunk=function(G){if(G){var Y=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=Y+G.data.length}V.prototype.processChunk.call(this,G)},$.exports=X},{"../utils":32,"./GenericWorker":28}],27:[function(M,$,j){var z=M("../utils"),V=M("./GenericWorker");function X(G){V.call(this,"DataWorker");var Y=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,G.then(function(Q){Y.dataIsReady=!0,Y.data=Q,Y.max=Q&&Q.length||0,Y.type=z.getTypeOf(Q),Y.isPaused||Y._tickAndRepeat()},function(Q){Y.error(Q)})}z.inherits(X,V),X.prototype.cleanUp=function(){V.prototype.cleanUp.call(this),this.data=null},X.prototype.resume=function(){return!!V.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,z.delay(this._tickAndRepeat,[],this)),!0)},X.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(z.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},X.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var G=null,Y=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":G=this.data.substring(this.index,Y);break;case"uint8array":G=this.data.subarray(this.index,Y);break;case"array":case"nodebuffer":G=this.data.slice(this.index,Y)}return this.index=Y,this.push({data:G,meta:{percent:this.max?this.index/this.max*100:0}})},$.exports=X},{"../utils":32,"./GenericWorker":28}],28:[function(M,$,j){function z(V){this.name=V||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}z.prototype={push:function(V){this.emit("data",V)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(V){this.emit("error",V)}return!0},error:function(V){return!this.isFinished&&(this.isPaused?this.generatedError=V:(this.isFinished=!0,this.emit("error",V),this.previous&&this.previous.error(V),this.cleanUp()),!0)},on:function(V,X){return this._listeners[V].push(X),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(V,X){if(this._listeners[V])for(var G=0;G<this._listeners[V].length;G++)this._listeners[V][G].call(this,X)},pipe:function(V){return V.registerPrevious(this)},registerPrevious:function(V){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=V.streamInfo,this.mergeStreamInfo(),this.previous=V;var X=this;return V.on("data",function(G){X.processChunk(G)}),V.on("end",function(){X.end()}),V.on("error",function(G){X.error(G)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var V=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),V=!0),this.previous&&this.previous.resume(),!V},flush:function(){},processChunk:function(V){this.push(V)},withStreamInfo:function(V,X){return this.extraStreamInfo[V]=X,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var V in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,V)&&(this.streamInfo[V]=this.extraStreamInfo[V])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var V="Worker "+this.name;return this.previous?this.previous+" -> "+V:V}},$.exports=z},{}],29:[function(M,$,j){var z=M("../utils"),V=M("./ConvertWorker"),X=M("./GenericWorker"),G=M("../base64"),Y=M("../support"),Q=M("../external"),Z=null;if(Y.nodestream)try{Z=M("../nodejs/NodejsStreamOutputAdapter")}catch{}function te(ne,re){return new Q.Promise(function(se,ie){var oe=[],he=ne._internalType,le=ne._outputType,ae=ne._mimeType;ne.on("data",function(ue,me){oe.push(ue),re&&re(me)}).on("error",function(ue){oe=[],ie(ue)}).on("end",function(){try{var ue=function(me,fe,ce){switch(me){case"blob":return z.newBlob(z.transformTo("arraybuffer",fe),ce);case"base64":return G.encode(fe);default:return z.transformTo(me,fe)}}(le,function(me,fe){var ce,_e=0,we=null,ge=0;for(ce=0;ce<fe.length;ce++)ge+=fe[ce].length;switch(me){case"string":return fe.join("");case"array":return Array.prototype.concat.apply([],fe);case"uint8array":for(we=new Uint8Array(ge),ce=0;ce<fe.length;ce++)we.set(fe[ce],_e),_e+=fe[ce].length;return we;case"nodebuffer":return Buffer.concat(fe);default:throw new Error("concat : unsupported type '"+me+"'")}}(he,oe),ae);se(ue)}catch(me){ie(me)}oe=[]}).resume()})}function ee(ne,re,se){var ie=re;switch(re){case"blob":case"arraybuffer":ie="uint8array";break;case"base64":ie="string"}try{this._internalType=ie,this._outputType=re,this._mimeType=se,z.checkSupport(ie),this._worker=ne.pipe(new V(ie)),ne.lock()}catch(oe){this._worker=new X("error"),this._worker.error(oe)}}ee.prototype={accumulate:function(ne){return te(this,ne)},on:function(ne,re){var se=this;return ne==="data"?this._worker.on(ne,function(ie){re.call(se,ie.data,ie.meta)}):this._worker.on(ne,function(){z.delay(re,arguments,se)}),this},resume:function(){return z.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(ne){if(z.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new Z(this,{objectMode:this._outputType!=="nodebuffer"},ne)}},$.exports=ee},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(M,$,j){if(j.base64=!0,j.array=!0,j.string=!0,j.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",j.nodebuffer=typeof Buffer<"u",j.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")j.blob=!1;else{var z=new ArrayBuffer(0);try{j.blob=new Blob([z],{type:"application/zip"}).size===0}catch{try{var V=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);V.append(z),j.blob=V.getBlob("application/zip").size===0}catch{j.blob=!1}}}try{j.nodestream=!!M("readable-stream").Readable}catch{j.nodestream=!1}},{"readable-stream":16}],31:[function(M,$,j){for(var z=M("./utils"),V=M("./support"),X=M("./nodejsUtils"),G=M("./stream/GenericWorker"),Y=new Array(256),Q=0;Q<256;Q++)Y[Q]=252<=Q?6:248<=Q?5:240<=Q?4:224<=Q?3:192<=Q?2:1;Y[254]=Y[254]=1;function Z(){G.call(this,"utf-8 decode"),this.leftOver=null}function te(){G.call(this,"utf-8 encode")}j.utf8encode=function(ee){return V.nodebuffer?X.newBufferFrom(ee,"utf-8"):function(ne){var re,se,ie,oe,he,le=ne.length,ae=0;for(oe=0;oe<le;oe++)(64512&(se=ne.charCodeAt(oe)))==55296&&oe+1<le&&(64512&(ie=ne.charCodeAt(oe+1)))==56320&&(se=65536+(se-55296<<10)+(ie-56320),oe++),ae+=se<128?1:se<2048?2:se<65536?3:4;for(re=V.uint8array?new Uint8Array(ae):new Array(ae),oe=he=0;he<ae;oe++)(64512&(se=ne.charCodeAt(oe)))==55296&&oe+1<le&&(64512&(ie=ne.charCodeAt(oe+1)))==56320&&(se=65536+(se-55296<<10)+(ie-56320),oe++),se<128?re[he++]=se:(se<2048?re[he++]=192|se>>>6:(se<65536?re[he++]=224|se>>>12:(re[he++]=240|se>>>18,re[he++]=128|se>>>12&63),re[he++]=128|se>>>6&63),re[he++]=128|63&se);return re}(ee)},j.utf8decode=function(ee){return V.nodebuffer?z.transformTo("nodebuffer",ee).toString("utf-8"):function(ne){var re,se,ie,oe,he=ne.length,le=new Array(2*he);for(re=se=0;re<he;)if((ie=ne[re++])<128)le[se++]=ie;else if(4<(oe=Y[ie]))le[se++]=65533,re+=oe-1;else{for(ie&=oe===2?31:oe===3?15:7;1<oe&&re<he;)ie=ie<<6|63&ne[re++],oe--;1<oe?le[se++]=65533:ie<65536?le[se++]=ie:(ie-=65536,le[se++]=55296|ie>>10&1023,le[se++]=56320|1023&ie)}return le.length!==se&&(le.subarray?le=le.subarray(0,se):le.length=se),z.applyFromCharCode(le)}(ee=z.transformTo(V.uint8array?"uint8array":"array",ee))},z.inherits(Z,G),Z.prototype.processChunk=function(ee){var ne=z.transformTo(V.uint8array?"uint8array":"array",ee.data);if(this.leftOver&&this.leftOver.length){if(V.uint8array){var re=ne;(ne=new Uint8Array(re.length+this.leftOver.length)).set(this.leftOver,0),ne.set(re,this.leftOver.length)}else ne=this.leftOver.concat(ne);this.leftOver=null}var se=function(oe,he){var le;for((he=he||oe.length)>oe.length&&(he=oe.length),le=he-1;0<=le&&(192&oe[le])==128;)le--;return le<0||le===0?he:le+Y[oe[le]]>he?le:he}(ne),ie=ne;se!==ne.length&&(V.uint8array?(ie=ne.subarray(0,se),this.leftOver=ne.subarray(se,ne.length)):(ie=ne.slice(0,se),this.leftOver=ne.slice(se,ne.length))),this.push({data:j.utf8decode(ie),meta:ee.meta})},Z.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:j.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},j.Utf8DecodeWorker=Z,z.inherits(te,G),te.prototype.processChunk=function(ee){this.push({data:j.utf8encode(ee.data),meta:ee.meta})},j.Utf8EncodeWorker=te},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(M,$,j){var z=M("./support"),V=M("./base64"),X=M("./nodejsUtils"),G=M("./external");function Y(re){return re}function Q(re,se){for(var ie=0;ie<re.length;++ie)se[ie]=255&re.charCodeAt(ie);return se}M("setimmediate"),j.newBlob=function(re,se){j.checkSupport("blob");try{return new Blob([re],{type:se})}catch{try{var ie=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return ie.append(re),ie.getBlob(se)}catch{throw new Error("Bug : can't construct the Blob.")}}};var Z={stringifyByChunk:function(re,se,ie){var oe=[],he=0,le=re.length;if(le<=ie)return String.fromCharCode.apply(null,re);for(;he<le;)se==="array"||se==="nodebuffer"?oe.push(String.fromCharCode.apply(null,re.slice(he,Math.min(he+ie,le)))):oe.push(String.fromCharCode.apply(null,re.subarray(he,Math.min(he+ie,le)))),he+=ie;return oe.join("")},stringifyByChar:function(re){for(var se="",ie=0;ie<re.length;ie++)se+=String.fromCharCode(re[ie]);return se},applyCanBeUsed:{uint8array:function(){try{return z.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return z.nodebuffer&&String.fromCharCode.apply(null,X.allocBuffer(1)).length===1}catch{return!1}}()}};function te(re){var se=65536,ie=j.getTypeOf(re),oe=!0;if(ie==="uint8array"?oe=Z.applyCanBeUsed.uint8array:ie==="nodebuffer"&&(oe=Z.applyCanBeUsed.nodebuffer),oe)for(;1<se;)try{return Z.stringifyByChunk(re,ie,se)}catch{se=Math.floor(se/2)}return Z.stringifyByChar(re)}function ee(re,se){for(var ie=0;ie<re.length;ie++)se[ie]=re[ie];return se}j.applyFromCharCode=te;var ne={};ne.string={string:Y,array:function(re){return Q(re,new Array(re.length))},arraybuffer:function(re){return ne.string.uint8array(re).buffer},uint8array:function(re){return Q(re,new Uint8Array(re.length))},nodebuffer:function(re){return Q(re,X.allocBuffer(re.length))}},ne.array={string:te,array:Y,arraybuffer:function(re){return new Uint8Array(re).buffer},uint8array:function(re){return new Uint8Array(re)},nodebuffer:function(re){return X.newBufferFrom(re)}},ne.arraybuffer={string:function(re){return te(new Uint8Array(re))},array:function(re){return ee(new Uint8Array(re),new Array(re.byteLength))},arraybuffer:Y,uint8array:function(re){return new Uint8Array(re)},nodebuffer:function(re){return X.newBufferFrom(new Uint8Array(re))}},ne.uint8array={string:te,array:function(re){return ee(re,new Array(re.length))},arraybuffer:function(re){return re.buffer},uint8array:Y,nodebuffer:function(re){return X.newBufferFrom(re)}},ne.nodebuffer={string:te,array:function(re){return ee(re,new Array(re.length))},arraybuffer:function(re){return ne.nodebuffer.uint8array(re).buffer},uint8array:function(re){return ee(re,new Uint8Array(re.length))},nodebuffer:Y},j.transformTo=function(re,se){if(se=se||"",!re)return se;j.checkSupport(re);var ie=j.getTypeOf(se);return ne[ie][re](se)},j.resolve=function(re){for(var se=re.split("/"),ie=[],oe=0;oe<se.length;oe++){var he=se[oe];he==="."||he===""&&oe!==0&&oe!==se.length-1||(he===".."?ie.pop():ie.push(he))}return ie.join("/")},j.getTypeOf=function(re){return typeof re=="string"?"string":Object.prototype.toString.call(re)==="[object Array]"?"array":z.nodebuffer&&X.isBuffer(re)?"nodebuffer":z.uint8array&&re instanceof Uint8Array?"uint8array":z.arraybuffer&&re instanceof ArrayBuffer?"arraybuffer":void 0},j.checkSupport=function(re){if(!z[re.toLowerCase()])throw new Error(re+" is not supported by this platform")},j.MAX_VALUE_16BITS=65535,j.MAX_VALUE_32BITS=-1,j.pretty=function(re){var se,ie,oe="";for(ie=0;ie<(re||"").length;ie++)oe+="\\x"+((se=re.charCodeAt(ie))<16?"0":"")+se.toString(16).toUpperCase();return oe},j.delay=function(re,se,ie){setImmediate(function(){re.apply(ie||null,se||[])})},j.inherits=function(re,se){function ie(){}ie.prototype=se.prototype,re.prototype=new ie},j.extend=function(){var re,se,ie={};for(re=0;re<arguments.length;re++)for(se in arguments[re])Object.prototype.hasOwnProperty.call(arguments[re],se)&&ie[se]===void 0&&(ie[se]=arguments[re][se]);return ie},j.prepareContent=function(re,se,ie,oe,he){return G.Promise.resolve(se).then(function(le){return z.blob&&(le instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(le))!==-1)&&typeof FileReader<"u"?new G.Promise(function(ae,ue){var me=new FileReader;me.onload=function(fe){ae(fe.target.result)},me.onerror=function(fe){ue(fe.target.error)},me.readAsArrayBuffer(le)}):le}).then(function(le){var ae=j.getTypeOf(le);return ae?(ae==="arraybuffer"?le=j.transformTo("uint8array",le):ae==="string"&&(he?le=V.decode(le):ie&&oe!==!0&&(le=function(ue){return Q(ue,z.uint8array?new Uint8Array(ue.length):new Array(ue.length))}(le))),le):G.Promise.reject(new Error("Can't read the data of '"+re+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(M,$,j){var z=M("./reader/readerFor"),V=M("./utils"),X=M("./signature"),G=M("./zipEntry"),Y=M("./support");function Q(Z){this.files=[],this.loadOptions=Z}Q.prototype={checkSignature:function(Z){if(!this.reader.readAndCheckSignature(Z)){this.reader.index-=4;var te=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+V.pretty(te)+", expected "+V.pretty(Z)+")")}},isSignature:function(Z,te){var ee=this.reader.index;this.reader.setIndex(Z);var ne=this.reader.readString(4)===te;return this.reader.setIndex(ee),ne},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var Z=this.reader.readData(this.zipCommentLength),te=Y.uint8array?"uint8array":"array",ee=V.transformTo(te,Z);this.zipComment=this.loadOptions.decodeFileName(ee)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var Z,te,ee,ne=this.zip64EndOfCentralSize-44;0<ne;)Z=this.reader.readInt(2),te=this.reader.readInt(4),ee=this.reader.readData(te),this.zip64ExtensibleData[Z]={id:Z,length:te,value:ee}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var Z,te;for(Z=0;Z<this.files.length;Z++)te=this.files[Z],this.reader.setIndex(te.localHeaderOffset),this.checkSignature(X.LOCAL_FILE_HEADER),te.readLocalPart(this.reader),te.handleUTF8(),te.processAttributes()},readCentralDir:function(){var Z;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(X.CENTRAL_FILE_HEADER);)(Z=new G({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(Z);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var Z=this.reader.lastIndexOfSignature(X.CENTRAL_DIRECTORY_END);if(Z<0)throw this.isSignature(0,X.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(Z);var te=Z;if(this.checkSignature(X.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===V.MAX_VALUE_16BITS||this.diskWithCentralDirStart===V.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===V.MAX_VALUE_16BITS||this.centralDirRecords===V.MAX_VALUE_16BITS||this.centralDirSize===V.MAX_VALUE_32BITS||this.centralDirOffset===V.MAX_VALUE_32BITS){if(this.zip64=!0,(Z=this.reader.lastIndexOfSignature(X.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(Z),this.checkSignature(X.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,X.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(X.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(X.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var ee=this.centralDirOffset+this.centralDirSize;this.zip64&&(ee+=20,ee+=12+this.zip64EndOfCentralSize);var ne=te-ee;if(0<ne)this.isSignature(te,X.CENTRAL_FILE_HEADER)||(this.reader.zero=ne);else if(ne<0)throw new Error("Corrupted zip: missing "+Math.abs(ne)+" bytes.")},prepareReader:function(Z){this.reader=z(Z)},load:function(Z){this.prepareReader(Z),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},$.exports=Q},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(M,$,j){var z=M("./reader/readerFor"),V=M("./utils"),X=M("./compressedObject"),G=M("./crc32"),Y=M("./utf8"),Q=M("./compressions"),Z=M("./support");function te(ee,ne){this.options=ee,this.loadOptions=ne}te.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(ee){var ne,re;if(ee.skip(22),this.fileNameLength=ee.readInt(2),re=ee.readInt(2),this.fileName=ee.readData(this.fileNameLength),ee.skip(re),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((ne=function(se){for(var ie in Q)if(Object.prototype.hasOwnProperty.call(Q,ie)&&Q[ie].magic===se)return Q[ie];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+V.pretty(this.compressionMethod)+" unknown (inner file : "+V.transformTo("string",this.fileName)+")");this.decompressed=new X(this.compressedSize,this.uncompressedSize,this.crc32,ne,ee.readData(this.compressedSize))},readCentralPart:function(ee){this.versionMadeBy=ee.readInt(2),ee.skip(2),this.bitFlag=ee.readInt(2),this.compressionMethod=ee.readString(2),this.date=ee.readDate(),this.crc32=ee.readInt(4),this.compressedSize=ee.readInt(4),this.uncompressedSize=ee.readInt(4);var ne=ee.readInt(2);if(this.extraFieldsLength=ee.readInt(2),this.fileCommentLength=ee.readInt(2),this.diskNumberStart=ee.readInt(2),this.internalFileAttributes=ee.readInt(2),this.externalFileAttributes=ee.readInt(4),this.localHeaderOffset=ee.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");ee.skip(ne),this.readExtraFields(ee),this.parseZIP64ExtraField(ee),this.fileComment=ee.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var ee=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),ee==0&&(this.dosPermissions=63&this.externalFileAttributes),ee==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var ee=z(this.extraFields[1].value);this.uncompressedSize===V.MAX_VALUE_32BITS&&(this.uncompressedSize=ee.readInt(8)),this.compressedSize===V.MAX_VALUE_32BITS&&(this.compressedSize=ee.readInt(8)),this.localHeaderOffset===V.MAX_VALUE_32BITS&&(this.localHeaderOffset=ee.readInt(8)),this.diskNumberStart===V.MAX_VALUE_32BITS&&(this.diskNumberStart=ee.readInt(4))}},readExtraFields:function(ee){var ne,re,se,ie=ee.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});ee.index+4<ie;)ne=ee.readInt(2),re=ee.readInt(2),se=ee.readData(re),this.extraFields[ne]={id:ne,length:re,value:se};ee.setIndex(ie)},handleUTF8:function(){var ee=Z.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=Y.utf8decode(this.fileName),this.fileCommentStr=Y.utf8decode(this.fileComment);else{var ne=this.findExtraFieldUnicodePath();if(ne!==null)this.fileNameStr=ne;else{var re=V.transformTo(ee,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(re)}var se=this.findExtraFieldUnicodeComment();if(se!==null)this.fileCommentStr=se;else{var ie=V.transformTo(ee,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(ie)}}},findExtraFieldUnicodePath:function(){var ee=this.extraFields[28789];if(ee){var ne=z(ee.value);return ne.readInt(1)!==1||G(this.fileName)!==ne.readInt(4)?null:Y.utf8decode(ne.readData(ee.length-5))}return null},findExtraFieldUnicodeComment:function(){var ee=this.extraFields[25461];if(ee){var ne=z(ee.value);return ne.readInt(1)!==1||G(this.fileComment)!==ne.readInt(4)?null:Y.utf8decode(ne.readData(ee.length-5))}return null}},$.exports=te},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(M,$,j){function z(ne,re,se){this.name=ne,this.dir=se.dir,this.date=se.date,this.comment=se.comment,this.unixPermissions=se.unixPermissions,this.dosPermissions=se.dosPermissions,this._data=re,this._dataBinary=se.binary,this.options={compression:se.compression,compressionOptions:se.compressionOptions}}var V=M("./stream/StreamHelper"),X=M("./stream/DataWorker"),G=M("./utf8"),Y=M("./compressedObject"),Q=M("./stream/GenericWorker");z.prototype={internalStream:function(ne){var re=null,se="string";try{if(!ne)throw new Error("No output type specified.");var ie=(se=ne.toLowerCase())==="string"||se==="text";se!=="binarystring"&&se!=="text"||(se="string"),re=this._decompressWorker();var oe=!this._dataBinary;oe&&!ie&&(re=re.pipe(new G.Utf8EncodeWorker)),!oe&&ie&&(re=re.pipe(new G.Utf8DecodeWorker))}catch(he){(re=new Q("error")).error(he)}return new V(re,se,"")},async:function(ne,re){return this.internalStream(ne).accumulate(re)},nodeStream:function(ne,re){return this.internalStream(ne||"nodebuffer").toNodejsStream(re)},_compressWorker:function(ne,re){if(this._data instanceof Y&&this._data.compression.magic===ne.magic)return this._data.getCompressedWorker();var se=this._decompressWorker();return this._dataBinary||(se=se.pipe(new G.Utf8EncodeWorker)),Y.createWorkerFrom(se,ne,re)},_decompressWorker:function(){return this._data instanceof Y?this._data.getContentWorker():this._data instanceof Q?this._data:new X(this._data)}};for(var Z=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],te=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},ee=0;ee<Z.length;ee++)z.prototype[Z[ee]]=te;$.exports=z},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(M,$,j){(function(z){var V,X,G=z.MutationObserver||z.WebKitMutationObserver;if(G){var Y=0,Q=new G(ne),Z=z.document.createTextNode("");Q.observe(Z,{characterData:!0}),V=function(){Z.data=Y=++Y%2}}else if(z.setImmediate||z.MessageChannel===void 0)V="document"in z&&"onreadystatechange"in z.document.createElement("script")?function(){var re=z.document.createElement("script");re.onreadystatechange=function(){ne(),re.onreadystatechange=null,re.parentNode.removeChild(re),re=null},z.document.documentElement.appendChild(re)}:function(){setTimeout(ne,0)};else{var te=new z.MessageChannel;te.port1.onmessage=ne,V=function(){te.port2.postMessage(0)}}var ee=[];function ne(){var re,se;X=!0;for(var ie=ee.length;ie;){for(se=ee,ee=[],re=-1;++re<ie;)se[re]();ie=ee.length}X=!1}$.exports=function(re){ee.push(re)!==1||X||V()}}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(M,$,j){var z=M("immediate");function V(){}var X={},G=["REJECTED"],Y=["FULFILLED"],Q=["PENDING"];function Z(ie){if(typeof ie!="function")throw new TypeError("resolver must be a function");this.state=Q,this.queue=[],this.outcome=void 0,ie!==V&&re(this,ie)}function te(ie,oe,he){this.promise=ie,typeof oe=="function"&&(this.onFulfilled=oe,this.callFulfilled=this.otherCallFulfilled),typeof he=="function"&&(this.onRejected=he,this.callRejected=this.otherCallRejected)}function ee(ie,oe,he){z(function(){var le;try{le=oe(he)}catch(ae){return X.reject(ie,ae)}le===ie?X.reject(ie,new TypeError("Cannot resolve promise with itself")):X.resolve(ie,le)})}function ne(ie){var oe=ie&&ie.then;if(ie&&(typeof ie=="object"||typeof ie=="function")&&typeof oe=="function")return function(){oe.apply(ie,arguments)}}function re(ie,oe){var he=!1;function le(me){he||(he=!0,X.reject(ie,me))}function ae(me){he||(he=!0,X.resolve(ie,me))}var ue=se(function(){oe(ae,le)});ue.status==="error"&&le(ue.value)}function se(ie,oe){var he={};try{he.value=ie(oe),he.status="success"}catch(le){he.status="error",he.value=le}return he}($.exports=Z).prototype.finally=function(ie){if(typeof ie!="function")return this;var oe=this.constructor;return this.then(function(he){return oe.resolve(ie()).then(function(){return he})},function(he){return oe.resolve(ie()).then(function(){throw he})})},Z.prototype.catch=function(ie){return this.then(null,ie)},Z.prototype.then=function(ie,oe){if(typeof ie!="function"&&this.state===Y||typeof oe!="function"&&this.state===G)return this;var he=new this.constructor(V);return this.state!==Q?ee(he,this.state===Y?ie:oe,this.outcome):this.queue.push(new te(he,ie,oe)),he},te.prototype.callFulfilled=function(ie){X.resolve(this.promise,ie)},te.prototype.otherCallFulfilled=function(ie){ee(this.promise,this.onFulfilled,ie)},te.prototype.callRejected=function(ie){X.reject(this.promise,ie)},te.prototype.otherCallRejected=function(ie){ee(this.promise,this.onRejected,ie)},X.resolve=function(ie,oe){var he=se(ne,oe);if(he.status==="error")return X.reject(ie,he.value);var le=he.value;if(le)re(ie,le);else{ie.state=Y,ie.outcome=oe;for(var ae=-1,ue=ie.queue.length;++ae<ue;)ie.queue[ae].callFulfilled(oe)}return ie},X.reject=function(ie,oe){ie.state=G,ie.outcome=oe;for(var he=-1,le=ie.queue.length;++he<le;)ie.queue[he].callRejected(oe);return ie},Z.resolve=function(ie){return ie instanceof this?ie:X.resolve(new this(V),ie)},Z.reject=function(ie){var oe=new this(V);return X.reject(oe,ie)},Z.all=function(ie){var oe=this;if(Object.prototype.toString.call(ie)!=="[object Array]")return this.reject(new TypeError("must be an array"));var he=ie.length,le=!1;if(!he)return this.resolve([]);for(var ae=new Array(he),ue=0,me=-1,fe=new this(V);++me<he;)ce(ie[me],me);return fe;function ce(_e,we){oe.resolve(_e).then(function(ge){ae[we]=ge,++ue!==he||le||(le=!0,X.resolve(fe,ae))},function(ge){le||(le=!0,X.reject(fe,ge))})}},Z.race=function(ie){var oe=this;if(Object.prototype.toString.call(ie)!=="[object Array]")return this.reject(new TypeError("must be an array"));var he=ie.length,le=!1;if(!he)return this.resolve([]);for(var ae=-1,ue=new this(V);++ae<he;)me=ie[ae],oe.resolve(me).then(function(fe){le||(le=!0,X.resolve(ue,fe))},function(fe){le||(le=!0,X.reject(ue,fe))});var me;return ue}},{immediate:36}],38:[function(M,$,j){var z={};(0,M("./lib/utils/common").assign)(z,M("./lib/deflate"),M("./lib/inflate"),M("./lib/zlib/constants")),$.exports=z},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(M,$,j){var z=M("./zlib/deflate"),V=M("./utils/common"),X=M("./utils/strings"),G=M("./zlib/messages"),Y=M("./zlib/zstream"),Q=Object.prototype.toString,Z=0,te=-1,ee=0,ne=8;function re(ie){if(!(this instanceof re))return new re(ie);this.options=V.assign({level:te,method:ne,chunkSize:16384,windowBits:15,memLevel:8,strategy:ee,to:""},ie||{});var oe=this.options;oe.raw&&0<oe.windowBits?oe.windowBits=-oe.windowBits:oe.gzip&&0<oe.windowBits&&oe.windowBits<16&&(oe.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Y,this.strm.avail_out=0;var he=z.deflateInit2(this.strm,oe.level,oe.method,oe.windowBits,oe.memLevel,oe.strategy);if(he!==Z)throw new Error(G[he]);if(oe.header&&z.deflateSetHeader(this.strm,oe.header),oe.dictionary){var le;if(le=typeof oe.dictionary=="string"?X.string2buf(oe.dictionary):Q.call(oe.dictionary)==="[object ArrayBuffer]"?new Uint8Array(oe.dictionary):oe.dictionary,(he=z.deflateSetDictionary(this.strm,le))!==Z)throw new Error(G[he]);this._dict_set=!0}}function se(ie,oe){var he=new re(oe);if(he.push(ie,!0),he.err)throw he.msg||G[he.err];return he.result}re.prototype.push=function(ie,oe){var he,le,ae=this.strm,ue=this.options.chunkSize;if(this.ended)return!1;le=oe===~~oe?oe:oe===!0?4:0,typeof ie=="string"?ae.input=X.string2buf(ie):Q.call(ie)==="[object ArrayBuffer]"?ae.input=new Uint8Array(ie):ae.input=ie,ae.next_in=0,ae.avail_in=ae.input.length;do{if(ae.avail_out===0&&(ae.output=new V.Buf8(ue),ae.next_out=0,ae.avail_out=ue),(he=z.deflate(ae,le))!==1&&he!==Z)return this.onEnd(he),!(this.ended=!0);ae.avail_out!==0&&(ae.avail_in!==0||le!==4&&le!==2)||(this.options.to==="string"?this.onData(X.buf2binstring(V.shrinkBuf(ae.output,ae.next_out))):this.onData(V.shrinkBuf(ae.output,ae.next_out)))}while((0<ae.avail_in||ae.avail_out===0)&&he!==1);return le===4?(he=z.deflateEnd(this.strm),this.onEnd(he),this.ended=!0,he===Z):le!==2||(this.onEnd(Z),!(ae.avail_out=0))},re.prototype.onData=function(ie){this.chunks.push(ie)},re.prototype.onEnd=function(ie){ie===Z&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=V.flattenChunks(this.chunks)),this.chunks=[],this.err=ie,this.msg=this.strm.msg},j.Deflate=re,j.deflate=se,j.deflateRaw=function(ie,oe){return(oe=oe||{}).raw=!0,se(ie,oe)},j.gzip=function(ie,oe){return(oe=oe||{}).gzip=!0,se(ie,oe)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(M,$,j){var z=M("./zlib/inflate"),V=M("./utils/common"),X=M("./utils/strings"),G=M("./zlib/constants"),Y=M("./zlib/messages"),Q=M("./zlib/zstream"),Z=M("./zlib/gzheader"),te=Object.prototype.toString;function ee(re){if(!(this instanceof ee))return new ee(re);this.options=V.assign({chunkSize:16384,windowBits:0,to:""},re||{});var se=this.options;se.raw&&0<=se.windowBits&&se.windowBits<16&&(se.windowBits=-se.windowBits,se.windowBits===0&&(se.windowBits=-15)),!(0<=se.windowBits&&se.windowBits<16)||re&&re.windowBits||(se.windowBits+=32),15<se.windowBits&&se.windowBits<48&&!(15&se.windowBits)&&(se.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Q,this.strm.avail_out=0;var ie=z.inflateInit2(this.strm,se.windowBits);if(ie!==G.Z_OK)throw new Error(Y[ie]);this.header=new Z,z.inflateGetHeader(this.strm,this.header)}function ne(re,se){var ie=new ee(se);if(ie.push(re,!0),ie.err)throw ie.msg||Y[ie.err];return ie.result}ee.prototype.push=function(re,se){var ie,oe,he,le,ae,ue,me=this.strm,fe=this.options.chunkSize,ce=this.options.dictionary,_e=!1;if(this.ended)return!1;oe=se===~~se?se:se===!0?G.Z_FINISH:G.Z_NO_FLUSH,typeof re=="string"?me.input=X.binstring2buf(re):te.call(re)==="[object ArrayBuffer]"?me.input=new Uint8Array(re):me.input=re,me.next_in=0,me.avail_in=me.input.length;do{if(me.avail_out===0&&(me.output=new V.Buf8(fe),me.next_out=0,me.avail_out=fe),(ie=z.inflate(me,G.Z_NO_FLUSH))===G.Z_NEED_DICT&&ce&&(ue=typeof ce=="string"?X.string2buf(ce):te.call(ce)==="[object ArrayBuffer]"?new Uint8Array(ce):ce,ie=z.inflateSetDictionary(this.strm,ue)),ie===G.Z_BUF_ERROR&&_e===!0&&(ie=G.Z_OK,_e=!1),ie!==G.Z_STREAM_END&&ie!==G.Z_OK)return this.onEnd(ie),!(this.ended=!0);me.next_out&&(me.avail_out!==0&&ie!==G.Z_STREAM_END&&(me.avail_in!==0||oe!==G.Z_FINISH&&oe!==G.Z_SYNC_FLUSH)||(this.options.to==="string"?(he=X.utf8border(me.output,me.next_out),le=me.next_out-he,ae=X.buf2string(me.output,he),me.next_out=le,me.avail_out=fe-le,le&&V.arraySet(me.output,me.output,he,le,0),this.onData(ae)):this.onData(V.shrinkBuf(me.output,me.next_out)))),me.avail_in===0&&me.avail_out===0&&(_e=!0)}while((0<me.avail_in||me.avail_out===0)&&ie!==G.Z_STREAM_END);return ie===G.Z_STREAM_END&&(oe=G.Z_FINISH),oe===G.Z_FINISH?(ie=z.inflateEnd(this.strm),this.onEnd(ie),this.ended=!0,ie===G.Z_OK):oe!==G.Z_SYNC_FLUSH||(this.onEnd(G.Z_OK),!(me.avail_out=0))},ee.prototype.onData=function(re){this.chunks.push(re)},ee.prototype.onEnd=function(re){re===G.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=V.flattenChunks(this.chunks)),this.chunks=[],this.err=re,this.msg=this.strm.msg},j.Inflate=ee,j.inflate=ne,j.inflateRaw=function(re,se){return(se=se||{}).raw=!0,ne(re,se)},j.ungzip=ne},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(M,$,j){var z=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";j.assign=function(G){for(var Y=Array.prototype.slice.call(arguments,1);Y.length;){var Q=Y.shift();if(Q){if(typeof Q!="object")throw new TypeError(Q+"must be non-object");for(var Z in Q)Q.hasOwnProperty(Z)&&(G[Z]=Q[Z])}}return G},j.shrinkBuf=function(G,Y){return G.length===Y?G:G.subarray?G.subarray(0,Y):(G.length=Y,G)};var V={arraySet:function(G,Y,Q,Z,te){if(Y.subarray&&G.subarray)G.set(Y.subarray(Q,Q+Z),te);else for(var ee=0;ee<Z;ee++)G[te+ee]=Y[Q+ee]},flattenChunks:function(G){var Y,Q,Z,te,ee,ne;for(Y=Z=0,Q=G.length;Y<Q;Y++)Z+=G[Y].length;for(ne=new Uint8Array(Z),Y=te=0,Q=G.length;Y<Q;Y++)ee=G[Y],ne.set(ee,te),te+=ee.length;return ne}},X={arraySet:function(G,Y,Q,Z,te){for(var ee=0;ee<Z;ee++)G[te+ee]=Y[Q+ee]},flattenChunks:function(G){return[].concat.apply([],G)}};j.setTyped=function(G){G?(j.Buf8=Uint8Array,j.Buf16=Uint16Array,j.Buf32=Int32Array,j.assign(j,V)):(j.Buf8=Array,j.Buf16=Array,j.Buf32=Array,j.assign(j,X))},j.setTyped(z)},{}],42:[function(M,$,j){var z=M("./common"),V=!0,X=!0;try{String.fromCharCode.apply(null,[0])}catch{V=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{X=!1}for(var G=new z.Buf8(256),Y=0;Y<256;Y++)G[Y]=252<=Y?6:248<=Y?5:240<=Y?4:224<=Y?3:192<=Y?2:1;function Q(Z,te){if(te<65537&&(Z.subarray&&X||!Z.subarray&&V))return String.fromCharCode.apply(null,z.shrinkBuf(Z,te));for(var ee="",ne=0;ne<te;ne++)ee+=String.fromCharCode(Z[ne]);return ee}G[254]=G[254]=1,j.string2buf=function(Z){var te,ee,ne,re,se,ie=Z.length,oe=0;for(re=0;re<ie;re++)(64512&(ee=Z.charCodeAt(re)))==55296&&re+1<ie&&(64512&(ne=Z.charCodeAt(re+1)))==56320&&(ee=65536+(ee-55296<<10)+(ne-56320),re++),oe+=ee<128?1:ee<2048?2:ee<65536?3:4;for(te=new z.Buf8(oe),re=se=0;se<oe;re++)(64512&(ee=Z.charCodeAt(re)))==55296&&re+1<ie&&(64512&(ne=Z.charCodeAt(re+1)))==56320&&(ee=65536+(ee-55296<<10)+(ne-56320),re++),ee<128?te[se++]=ee:(ee<2048?te[se++]=192|ee>>>6:(ee<65536?te[se++]=224|ee>>>12:(te[se++]=240|ee>>>18,te[se++]=128|ee>>>12&63),te[se++]=128|ee>>>6&63),te[se++]=128|63&ee);return te},j.buf2binstring=function(Z){return Q(Z,Z.length)},j.binstring2buf=function(Z){for(var te=new z.Buf8(Z.length),ee=0,ne=te.length;ee<ne;ee++)te[ee]=Z.charCodeAt(ee);return te},j.buf2string=function(Z,te){var ee,ne,re,se,ie=te||Z.length,oe=new Array(2*ie);for(ee=ne=0;ee<ie;)if((re=Z[ee++])<128)oe[ne++]=re;else if(4<(se=G[re]))oe[ne++]=65533,ee+=se-1;else{for(re&=se===2?31:se===3?15:7;1<se&&ee<ie;)re=re<<6|63&Z[ee++],se--;1<se?oe[ne++]=65533:re<65536?oe[ne++]=re:(re-=65536,oe[ne++]=55296|re>>10&1023,oe[ne++]=56320|1023&re)}return Q(oe,ne)},j.utf8border=function(Z,te){var ee;for((te=te||Z.length)>Z.length&&(te=Z.length),ee=te-1;0<=ee&&(192&Z[ee])==128;)ee--;return ee<0||ee===0?te:ee+G[Z[ee]]>te?ee:te}},{"./common":41}],43:[function(M,$,j){$.exports=function(z,V,X,G){for(var Y=65535&z|0,Q=z>>>16&65535|0,Z=0;X!==0;){for(X-=Z=2e3<X?2e3:X;Q=Q+(Y=Y+V[G++]|0)|0,--Z;);Y%=65521,Q%=65521}return Y|Q<<16|0}},{}],44:[function(M,$,j){$.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(M,$,j){var z=function(){for(var V,X=[],G=0;G<256;G++){V=G;for(var Y=0;Y<8;Y++)V=1&V?3988292384^V>>>1:V>>>1;X[G]=V}return X}();$.exports=function(V,X,G,Y){var Q=z,Z=Y+G;V^=-1;for(var te=Y;te<Z;te++)V=V>>>8^Q[255&(V^X[te])];return-1^V}},{}],46:[function(M,$,j){var z,V=M("../utils/common"),X=M("./trees"),G=M("./adler32"),Y=M("./crc32"),Q=M("./messages"),Z=0,te=4,ee=0,ne=-2,re=-1,se=4,ie=2,oe=8,he=9,le=286,ae=30,ue=19,me=2*le+1,fe=15,ce=3,_e=258,we=_e+ce+1,ge=42,Ae=113,de=1,De=2,Me=3,Ee=4;function Te(pe,We){return pe.msg=Q[We],We}function xe(pe){return(pe<<1)-(4<pe?9:0)}function He(pe){for(var We=pe.length;0<=--We;)pe[We]=0}function Oe(pe){var We=pe.state,Qe=We.pending;Qe>pe.avail_out&&(Qe=pe.avail_out),Qe!==0&&(V.arraySet(pe.output,We.pending_buf,We.pending_out,Qe,pe.next_out),pe.next_out+=Qe,We.pending_out+=Qe,pe.total_out+=Qe,pe.avail_out-=Qe,We.pending-=Qe,We.pending===0&&(We.pending_out=0))}function $e(pe,We){X._tr_flush_block(pe,0<=pe.block_start?pe.block_start:-1,pe.strstart-pe.block_start,We),pe.block_start=pe.strstart,Oe(pe.strm)}function Pe(pe,We){pe.pending_buf[pe.pending++]=We}function ve(pe,We){pe.pending_buf[pe.pending++]=We>>>8&255,pe.pending_buf[pe.pending++]=255&We}function ye(pe,We){var Qe,Ce,Ie=pe.max_chain_length,Ge=pe.strstart,rt=pe.prev_length,ct=pe.nice_match,qe=pe.strstart>pe.w_size-we?pe.strstart-(pe.w_size-we):0,Ve=pe.window,Xe=pe.w_mask,Je=pe.prev,lt=pe.strstart+_e,_t=Ve[Ge+rt-1],mt=Ve[Ge+rt];pe.prev_length>=pe.good_match&&(Ie>>=2),ct>pe.lookahead&&(ct=pe.lookahead);do if(Ve[(Qe=We)+rt]===mt&&Ve[Qe+rt-1]===_t&&Ve[Qe]===Ve[Ge]&&Ve[++Qe]===Ve[Ge+1]){Ge+=2,Qe++;do;while(Ve[++Ge]===Ve[++Qe]&&Ve[++Ge]===Ve[++Qe]&&Ve[++Ge]===Ve[++Qe]&&Ve[++Ge]===Ve[++Qe]&&Ve[++Ge]===Ve[++Qe]&&Ve[++Ge]===Ve[++Qe]&&Ve[++Ge]===Ve[++Qe]&&Ve[++Ge]===Ve[++Qe]&&Ge<lt);if(Ce=_e-(lt-Ge),Ge=lt-_e,rt<Ce){if(pe.match_start=We,ct<=(rt=Ce))break;_t=Ve[Ge+rt-1],mt=Ve[Ge+rt]}}while((We=Je[We&Xe])>qe&&--Ie!=0);return rt<=pe.lookahead?rt:pe.lookahead}function Fe(pe){var We,Qe,Ce,Ie,Ge,rt,ct,qe,Ve,Xe,Je=pe.w_size;do{if(Ie=pe.window_size-pe.lookahead-pe.strstart,pe.strstart>=Je+(Je-we)){for(V.arraySet(pe.window,pe.window,Je,Je,0),pe.match_start-=Je,pe.strstart-=Je,pe.block_start-=Je,We=Qe=pe.hash_size;Ce=pe.head[--We],pe.head[We]=Je<=Ce?Ce-Je:0,--Qe;);for(We=Qe=Je;Ce=pe.prev[--We],pe.prev[We]=Je<=Ce?Ce-Je:0,--Qe;);Ie+=Je}if(pe.strm.avail_in===0)break;if(rt=pe.strm,ct=pe.window,qe=pe.strstart+pe.lookahead,Ve=Ie,Xe=void 0,Xe=rt.avail_in,Ve<Xe&&(Xe=Ve),Qe=Xe===0?0:(rt.avail_in-=Xe,V.arraySet(ct,rt.input,rt.next_in,Xe,qe),rt.state.wrap===1?rt.adler=G(rt.adler,ct,Xe,qe):rt.state.wrap===2&&(rt.adler=Y(rt.adler,ct,Xe,qe)),rt.next_in+=Xe,rt.total_in+=Xe,Xe),pe.lookahead+=Qe,pe.lookahead+pe.insert>=ce)for(Ge=pe.strstart-pe.insert,pe.ins_h=pe.window[Ge],pe.ins_h=(pe.ins_h<<pe.hash_shift^pe.window[Ge+1])&pe.hash_mask;pe.insert&&(pe.ins_h=(pe.ins_h<<pe.hash_shift^pe.window[Ge+ce-1])&pe.hash_mask,pe.prev[Ge&pe.w_mask]=pe.head[pe.ins_h],pe.head[pe.ins_h]=Ge,Ge++,pe.insert--,!(pe.lookahead+pe.insert<ce)););}while(pe.lookahead<we&&pe.strm.avail_in!==0)}function je(pe,We){for(var Qe,Ce;;){if(pe.lookahead<we){if(Fe(pe),pe.lookahead<we&&We===Z)return de;if(pe.lookahead===0)break}if(Qe=0,pe.lookahead>=ce&&(pe.ins_h=(pe.ins_h<<pe.hash_shift^pe.window[pe.strstart+ce-1])&pe.hash_mask,Qe=pe.prev[pe.strstart&pe.w_mask]=pe.head[pe.ins_h],pe.head[pe.ins_h]=pe.strstart),Qe!==0&&pe.strstart-Qe<=pe.w_size-we&&(pe.match_length=ye(pe,Qe)),pe.match_length>=ce)if(Ce=X._tr_tally(pe,pe.strstart-pe.match_start,pe.match_length-ce),pe.lookahead-=pe.match_length,pe.match_length<=pe.max_lazy_match&&pe.lookahead>=ce){for(pe.match_length--;pe.strstart++,pe.ins_h=(pe.ins_h<<pe.hash_shift^pe.window[pe.strstart+ce-1])&pe.hash_mask,Qe=pe.prev[pe.strstart&pe.w_mask]=pe.head[pe.ins_h],pe.head[pe.ins_h]=pe.strstart,--pe.match_length!=0;);pe.strstart++}else pe.strstart+=pe.match_length,pe.match_length=0,pe.ins_h=pe.window[pe.strstart],pe.ins_h=(pe.ins_h<<pe.hash_shift^pe.window[pe.strstart+1])&pe.hash_mask;else Ce=X._tr_tally(pe,0,pe.window[pe.strstart]),pe.lookahead--,pe.strstart++;if(Ce&&($e(pe,!1),pe.strm.avail_out===0))return de}return pe.insert=pe.strstart<ce-1?pe.strstart:ce-1,We===te?($e(pe,!0),pe.strm.avail_out===0?Me:Ee):pe.last_lit&&($e(pe,!1),pe.strm.avail_out===0)?de:De}function Be(pe,We){for(var Qe,Ce,Ie;;){if(pe.lookahead<we){if(Fe(pe),pe.lookahead<we&&We===Z)return de;if(pe.lookahead===0)break}if(Qe=0,pe.lookahead>=ce&&(pe.ins_h=(pe.ins_h<<pe.hash_shift^pe.window[pe.strstart+ce-1])&pe.hash_mask,Qe=pe.prev[pe.strstart&pe.w_mask]=pe.head[pe.ins_h],pe.head[pe.ins_h]=pe.strstart),pe.prev_length=pe.match_length,pe.prev_match=pe.match_start,pe.match_length=ce-1,Qe!==0&&pe.prev_length<pe.max_lazy_match&&pe.strstart-Qe<=pe.w_size-we&&(pe.match_length=ye(pe,Qe),pe.match_length<=5&&(pe.strategy===1||pe.match_length===ce&&4096<pe.strstart-pe.match_start)&&(pe.match_length=ce-1)),pe.prev_length>=ce&&pe.match_length<=pe.prev_length){for(Ie=pe.strstart+pe.lookahead-ce,Ce=X._tr_tally(pe,pe.strstart-1-pe.prev_match,pe.prev_length-ce),pe.lookahead-=pe.prev_length-1,pe.prev_length-=2;++pe.strstart<=Ie&&(pe.ins_h=(pe.ins_h<<pe.hash_shift^pe.window[pe.strstart+ce-1])&pe.hash_mask,Qe=pe.prev[pe.strstart&pe.w_mask]=pe.head[pe.ins_h],pe.head[pe.ins_h]=pe.strstart),--pe.prev_length!=0;);if(pe.match_available=0,pe.match_length=ce-1,pe.strstart++,Ce&&($e(pe,!1),pe.strm.avail_out===0))return de}else if(pe.match_available){if((Ce=X._tr_tally(pe,0,pe.window[pe.strstart-1]))&&$e(pe,!1),pe.strstart++,pe.lookahead--,pe.strm.avail_out===0)return de}else pe.match_available=1,pe.strstart++,pe.lookahead--}return pe.match_available&&(Ce=X._tr_tally(pe,0,pe.window[pe.strstart-1]),pe.match_available=0),pe.insert=pe.strstart<ce-1?pe.strstart:ce-1,We===te?($e(pe,!0),pe.strm.avail_out===0?Me:Ee):pe.last_lit&&($e(pe,!1),pe.strm.avail_out===0)?de:De}function Ne(pe,We,Qe,Ce,Ie){this.good_length=pe,this.max_lazy=We,this.nice_length=Qe,this.max_chain=Ce,this.func=Ie}function ze(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=oe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new V.Buf16(2*me),this.dyn_dtree=new V.Buf16(2*(2*ae+1)),this.bl_tree=new V.Buf16(2*(2*ue+1)),He(this.dyn_ltree),He(this.dyn_dtree),He(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new V.Buf16(fe+1),this.heap=new V.Buf16(2*le+1),He(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new V.Buf16(2*le+1),He(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ze(pe){var We;return pe&&pe.state?(pe.total_in=pe.total_out=0,pe.data_type=ie,(We=pe.state).pending=0,We.pending_out=0,We.wrap<0&&(We.wrap=-We.wrap),We.status=We.wrap?ge:Ae,pe.adler=We.wrap===2?0:1,We.last_flush=Z,X._tr_init(We),ee):Te(pe,ne)}function ut(pe){var We=Ze(pe);return We===ee&&function(Qe){Qe.window_size=2*Qe.w_size,He(Qe.head),Qe.max_lazy_match=z[Qe.level].max_lazy,Qe.good_match=z[Qe.level].good_length,Qe.nice_match=z[Qe.level].nice_length,Qe.max_chain_length=z[Qe.level].max_chain,Qe.strstart=0,Qe.block_start=0,Qe.lookahead=0,Qe.insert=0,Qe.match_length=Qe.prev_length=ce-1,Qe.match_available=0,Qe.ins_h=0}(pe.state),We}function ot(pe,We,Qe,Ce,Ie,Ge){if(!pe)return ne;var rt=1;if(We===re&&(We=6),Ce<0?(rt=0,Ce=-Ce):15<Ce&&(rt=2,Ce-=16),Ie<1||he<Ie||Qe!==oe||Ce<8||15<Ce||We<0||9<We||Ge<0||se<Ge)return Te(pe,ne);Ce===8&&(Ce=9);var ct=new ze;return(pe.state=ct).strm=pe,ct.wrap=rt,ct.gzhead=null,ct.w_bits=Ce,ct.w_size=1<<ct.w_bits,ct.w_mask=ct.w_size-1,ct.hash_bits=Ie+7,ct.hash_size=1<<ct.hash_bits,ct.hash_mask=ct.hash_size-1,ct.hash_shift=~~((ct.hash_bits+ce-1)/ce),ct.window=new V.Buf8(2*ct.w_size),ct.head=new V.Buf16(ct.hash_size),ct.prev=new V.Buf16(ct.w_size),ct.lit_bufsize=1<<Ie+6,ct.pending_buf_size=4*ct.lit_bufsize,ct.pending_buf=new V.Buf8(ct.pending_buf_size),ct.d_buf=1*ct.lit_bufsize,ct.l_buf=3*ct.lit_bufsize,ct.level=We,ct.strategy=Ge,ct.method=Qe,ut(pe)}z=[new Ne(0,0,0,0,function(pe,We){var Qe=65535;for(Qe>pe.pending_buf_size-5&&(Qe=pe.pending_buf_size-5);;){if(pe.lookahead<=1){if(Fe(pe),pe.lookahead===0&&We===Z)return de;if(pe.lookahead===0)break}pe.strstart+=pe.lookahead,pe.lookahead=0;var Ce=pe.block_start+Qe;if((pe.strstart===0||pe.strstart>=Ce)&&(pe.lookahead=pe.strstart-Ce,pe.strstart=Ce,$e(pe,!1),pe.strm.avail_out===0)||pe.strstart-pe.block_start>=pe.w_size-we&&($e(pe,!1),pe.strm.avail_out===0))return de}return pe.insert=0,We===te?($e(pe,!0),pe.strm.avail_out===0?Me:Ee):(pe.strstart>pe.block_start&&($e(pe,!1),pe.strm.avail_out),de)}),new Ne(4,4,8,4,je),new Ne(4,5,16,8,je),new Ne(4,6,32,32,je),new Ne(4,4,16,16,Be),new Ne(8,16,32,32,Be),new Ne(8,16,128,128,Be),new Ne(8,32,128,256,Be),new Ne(32,128,258,1024,Be),new Ne(32,258,258,4096,Be)],j.deflateInit=function(pe,We){return ot(pe,We,oe,15,8,0)},j.deflateInit2=ot,j.deflateReset=ut,j.deflateResetKeep=Ze,j.deflateSetHeader=function(pe,We){return pe&&pe.state?pe.state.wrap!==2?ne:(pe.state.gzhead=We,ee):ne},j.deflate=function(pe,We){var Qe,Ce,Ie,Ge;if(!pe||!pe.state||5<We||We<0)return pe?Te(pe,ne):ne;if(Ce=pe.state,!pe.output||!pe.input&&pe.avail_in!==0||Ce.status===666&&We!==te)return Te(pe,pe.avail_out===0?-5:ne);if(Ce.strm=pe,Qe=Ce.last_flush,Ce.last_flush=We,Ce.status===ge)if(Ce.wrap===2)pe.adler=0,Pe(Ce,31),Pe(Ce,139),Pe(Ce,8),Ce.gzhead?(Pe(Ce,(Ce.gzhead.text?1:0)+(Ce.gzhead.hcrc?2:0)+(Ce.gzhead.extra?4:0)+(Ce.gzhead.name?8:0)+(Ce.gzhead.comment?16:0)),Pe(Ce,255&Ce.gzhead.time),Pe(Ce,Ce.gzhead.time>>8&255),Pe(Ce,Ce.gzhead.time>>16&255),Pe(Ce,Ce.gzhead.time>>24&255),Pe(Ce,Ce.level===9?2:2<=Ce.strategy||Ce.level<2?4:0),Pe(Ce,255&Ce.gzhead.os),Ce.gzhead.extra&&Ce.gzhead.extra.length&&(Pe(Ce,255&Ce.gzhead.extra.length),Pe(Ce,Ce.gzhead.extra.length>>8&255)),Ce.gzhead.hcrc&&(pe.adler=Y(pe.adler,Ce.pending_buf,Ce.pending,0)),Ce.gzindex=0,Ce.status=69):(Pe(Ce,0),Pe(Ce,0),Pe(Ce,0),Pe(Ce,0),Pe(Ce,0),Pe(Ce,Ce.level===9?2:2<=Ce.strategy||Ce.level<2?4:0),Pe(Ce,3),Ce.status=Ae);else{var rt=oe+(Ce.w_bits-8<<4)<<8;rt|=(2<=Ce.strategy||Ce.level<2?0:Ce.level<6?1:Ce.level===6?2:3)<<6,Ce.strstart!==0&&(rt|=32),rt+=31-rt%31,Ce.status=Ae,ve(Ce,rt),Ce.strstart!==0&&(ve(Ce,pe.adler>>>16),ve(Ce,65535&pe.adler)),pe.adler=1}if(Ce.status===69)if(Ce.gzhead.extra){for(Ie=Ce.pending;Ce.gzindex<(65535&Ce.gzhead.extra.length)&&(Ce.pending!==Ce.pending_buf_size||(Ce.gzhead.hcrc&&Ce.pending>Ie&&(pe.adler=Y(pe.adler,Ce.pending_buf,Ce.pending-Ie,Ie)),Oe(pe),Ie=Ce.pending,Ce.pending!==Ce.pending_buf_size));)Pe(Ce,255&Ce.gzhead.extra[Ce.gzindex]),Ce.gzindex++;Ce.gzhead.hcrc&&Ce.pending>Ie&&(pe.adler=Y(pe.adler,Ce.pending_buf,Ce.pending-Ie,Ie)),Ce.gzindex===Ce.gzhead.extra.length&&(Ce.gzindex=0,Ce.status=73)}else Ce.status=73;if(Ce.status===73)if(Ce.gzhead.name){Ie=Ce.pending;do{if(Ce.pending===Ce.pending_buf_size&&(Ce.gzhead.hcrc&&Ce.pending>Ie&&(pe.adler=Y(pe.adler,Ce.pending_buf,Ce.pending-Ie,Ie)),Oe(pe),Ie=Ce.pending,Ce.pending===Ce.pending_buf_size)){Ge=1;break}Ge=Ce.gzindex<Ce.gzhead.name.length?255&Ce.gzhead.name.charCodeAt(Ce.gzindex++):0,Pe(Ce,Ge)}while(Ge!==0);Ce.gzhead.hcrc&&Ce.pending>Ie&&(pe.adler=Y(pe.adler,Ce.pending_buf,Ce.pending-Ie,Ie)),Ge===0&&(Ce.gzindex=0,Ce.status=91)}else Ce.status=91;if(Ce.status===91)if(Ce.gzhead.comment){Ie=Ce.pending;do{if(Ce.pending===Ce.pending_buf_size&&(Ce.gzhead.hcrc&&Ce.pending>Ie&&(pe.adler=Y(pe.adler,Ce.pending_buf,Ce.pending-Ie,Ie)),Oe(pe),Ie=Ce.pending,Ce.pending===Ce.pending_buf_size)){Ge=1;break}Ge=Ce.gzindex<Ce.gzhead.comment.length?255&Ce.gzhead.comment.charCodeAt(Ce.gzindex++):0,Pe(Ce,Ge)}while(Ge!==0);Ce.gzhead.hcrc&&Ce.pending>Ie&&(pe.adler=Y(pe.adler,Ce.pending_buf,Ce.pending-Ie,Ie)),Ge===0&&(Ce.status=103)}else Ce.status=103;if(Ce.status===103&&(Ce.gzhead.hcrc?(Ce.pending+2>Ce.pending_buf_size&&Oe(pe),Ce.pending+2<=Ce.pending_buf_size&&(Pe(Ce,255&pe.adler),Pe(Ce,pe.adler>>8&255),pe.adler=0,Ce.status=Ae)):Ce.status=Ae),Ce.pending!==0){if(Oe(pe),pe.avail_out===0)return Ce.last_flush=-1,ee}else if(pe.avail_in===0&&xe(We)<=xe(Qe)&&We!==te)return Te(pe,-5);if(Ce.status===666&&pe.avail_in!==0)return Te(pe,-5);if(pe.avail_in!==0||Ce.lookahead!==0||We!==Z&&Ce.status!==666){var ct=Ce.strategy===2?function(qe,Ve){for(var Xe;;){if(qe.lookahead===0&&(Fe(qe),qe.lookahead===0)){if(Ve===Z)return de;break}if(qe.match_length=0,Xe=X._tr_tally(qe,0,qe.window[qe.strstart]),qe.lookahead--,qe.strstart++,Xe&&($e(qe,!1),qe.strm.avail_out===0))return de}return qe.insert=0,Ve===te?($e(qe,!0),qe.strm.avail_out===0?Me:Ee):qe.last_lit&&($e(qe,!1),qe.strm.avail_out===0)?de:De}(Ce,We):Ce.strategy===3?function(qe,Ve){for(var Xe,Je,lt,_t,mt=qe.window;;){if(qe.lookahead<=_e){if(Fe(qe),qe.lookahead<=_e&&Ve===Z)return de;if(qe.lookahead===0)break}if(qe.match_length=0,qe.lookahead>=ce&&0<qe.strstart&&(Je=mt[lt=qe.strstart-1])===mt[++lt]&&Je===mt[++lt]&&Je===mt[++lt]){_t=qe.strstart+_e;do;while(Je===mt[++lt]&&Je===mt[++lt]&&Je===mt[++lt]&&Je===mt[++lt]&&Je===mt[++lt]&&Je===mt[++lt]&&Je===mt[++lt]&&Je===mt[++lt]&&lt<_t);qe.match_length=_e-(_t-lt),qe.match_length>qe.lookahead&&(qe.match_length=qe.lookahead)}if(qe.match_length>=ce?(Xe=X._tr_tally(qe,1,qe.match_length-ce),qe.lookahead-=qe.match_length,qe.strstart+=qe.match_length,qe.match_length=0):(Xe=X._tr_tally(qe,0,qe.window[qe.strstart]),qe.lookahead--,qe.strstart++),Xe&&($e(qe,!1),qe.strm.avail_out===0))return de}return qe.insert=0,Ve===te?($e(qe,!0),qe.strm.avail_out===0?Me:Ee):qe.last_lit&&($e(qe,!1),qe.strm.avail_out===0)?de:De}(Ce,We):z[Ce.level].func(Ce,We);if(ct!==Me&&ct!==Ee||(Ce.status=666),ct===de||ct===Me)return pe.avail_out===0&&(Ce.last_flush=-1),ee;if(ct===De&&(We===1?X._tr_align(Ce):We!==5&&(X._tr_stored_block(Ce,0,0,!1),We===3&&(He(Ce.head),Ce.lookahead===0&&(Ce.strstart=0,Ce.block_start=0,Ce.insert=0))),Oe(pe),pe.avail_out===0))return Ce.last_flush=-1,ee}return We!==te?ee:Ce.wrap<=0?1:(Ce.wrap===2?(Pe(Ce,255&pe.adler),Pe(Ce,pe.adler>>8&255),Pe(Ce,pe.adler>>16&255),Pe(Ce,pe.adler>>24&255),Pe(Ce,255&pe.total_in),Pe(Ce,pe.total_in>>8&255),Pe(Ce,pe.total_in>>16&255),Pe(Ce,pe.total_in>>24&255)):(ve(Ce,pe.adler>>>16),ve(Ce,65535&pe.adler)),Oe(pe),0<Ce.wrap&&(Ce.wrap=-Ce.wrap),Ce.pending!==0?ee:1)},j.deflateEnd=function(pe){var We;return pe&&pe.state?(We=pe.state.status)!==ge&&We!==69&&We!==73&&We!==91&&We!==103&&We!==Ae&&We!==666?Te(pe,ne):(pe.state=null,We===Ae?Te(pe,-3):ee):ne},j.deflateSetDictionary=function(pe,We){var Qe,Ce,Ie,Ge,rt,ct,qe,Ve,Xe=We.length;if(!pe||!pe.state||(Ge=(Qe=pe.state).wrap)===2||Ge===1&&Qe.status!==ge||Qe.lookahead)return ne;for(Ge===1&&(pe.adler=G(pe.adler,We,Xe,0)),Qe.wrap=0,Xe>=Qe.w_size&&(Ge===0&&(He(Qe.head),Qe.strstart=0,Qe.block_start=0,Qe.insert=0),Ve=new V.Buf8(Qe.w_size),V.arraySet(Ve,We,Xe-Qe.w_size,Qe.w_size,0),We=Ve,Xe=Qe.w_size),rt=pe.avail_in,ct=pe.next_in,qe=pe.input,pe.avail_in=Xe,pe.next_in=0,pe.input=We,Fe(Qe);Qe.lookahead>=ce;){for(Ce=Qe.strstart,Ie=Qe.lookahead-(ce-1);Qe.ins_h=(Qe.ins_h<<Qe.hash_shift^Qe.window[Ce+ce-1])&Qe.hash_mask,Qe.prev[Ce&Qe.w_mask]=Qe.head[Qe.ins_h],Qe.head[Qe.ins_h]=Ce,Ce++,--Ie;);Qe.strstart=Ce,Qe.lookahead=ce-1,Fe(Qe)}return Qe.strstart+=Qe.lookahead,Qe.block_start=Qe.strstart,Qe.insert=Qe.lookahead,Qe.lookahead=0,Qe.match_length=Qe.prev_length=ce-1,Qe.match_available=0,pe.next_in=ct,pe.input=qe,pe.avail_in=rt,Qe.wrap=Ge,ee},j.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(M,$,j){$.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(M,$,j){$.exports=function(z,V){var X,G,Y,Q,Z,te,ee,ne,re,se,ie,oe,he,le,ae,ue,me,fe,ce,_e,we,ge,Ae,de,De;X=z.state,G=z.next_in,de=z.input,Y=G+(z.avail_in-5),Q=z.next_out,De=z.output,Z=Q-(V-z.avail_out),te=Q+(z.avail_out-257),ee=X.dmax,ne=X.wsize,re=X.whave,se=X.wnext,ie=X.window,oe=X.hold,he=X.bits,le=X.lencode,ae=X.distcode,ue=(1<<X.lenbits)-1,me=(1<<X.distbits)-1;e:do{he<15&&(oe+=de[G++]<<he,he+=8,oe+=de[G++]<<he,he+=8),fe=le[oe&ue];t:for(;;){if(oe>>>=ce=fe>>>24,he-=ce,(ce=fe>>>16&255)===0)De[Q++]=65535&fe;else{if(!(16&ce)){if(!(64&ce)){fe=le[(65535&fe)+(oe&(1<<ce)-1)];continue t}if(32&ce){X.mode=12;break e}z.msg="invalid literal/length code",X.mode=30;break e}_e=65535&fe,(ce&=15)&&(he<ce&&(oe+=de[G++]<<he,he+=8),_e+=oe&(1<<ce)-1,oe>>>=ce,he-=ce),he<15&&(oe+=de[G++]<<he,he+=8,oe+=de[G++]<<he,he+=8),fe=ae[oe&me];n:for(;;){if(oe>>>=ce=fe>>>24,he-=ce,!(16&(ce=fe>>>16&255))){if(!(64&ce)){fe=ae[(65535&fe)+(oe&(1<<ce)-1)];continue n}z.msg="invalid distance code",X.mode=30;break e}if(we=65535&fe,he<(ce&=15)&&(oe+=de[G++]<<he,(he+=8)<ce&&(oe+=de[G++]<<he,he+=8)),ee<(we+=oe&(1<<ce)-1)){z.msg="invalid distance too far back",X.mode=30;break e}if(oe>>>=ce,he-=ce,(ce=Q-Z)<we){if(re<(ce=we-ce)&&X.sane){z.msg="invalid distance too far back",X.mode=30;break e}if(Ae=ie,(ge=0)===se){if(ge+=ne-ce,ce<_e){for(_e-=ce;De[Q++]=ie[ge++],--ce;);ge=Q-we,Ae=De}}else if(se<ce){if(ge+=ne+se-ce,(ce-=se)<_e){for(_e-=ce;De[Q++]=ie[ge++],--ce;);if(ge=0,se<_e){for(_e-=ce=se;De[Q++]=ie[ge++],--ce;);ge=Q-we,Ae=De}}}else if(ge+=se-ce,ce<_e){for(_e-=ce;De[Q++]=ie[ge++],--ce;);ge=Q-we,Ae=De}for(;2<_e;)De[Q++]=Ae[ge++],De[Q++]=Ae[ge++],De[Q++]=Ae[ge++],_e-=3;_e&&(De[Q++]=Ae[ge++],1<_e&&(De[Q++]=Ae[ge++]))}else{for(ge=Q-we;De[Q++]=De[ge++],De[Q++]=De[ge++],De[Q++]=De[ge++],2<(_e-=3););_e&&(De[Q++]=De[ge++],1<_e&&(De[Q++]=De[ge++]))}break}}break}}while(G<Y&&Q<te);G-=_e=he>>3,oe&=(1<<(he-=_e<<3))-1,z.next_in=G,z.next_out=Q,z.avail_in=G<Y?Y-G+5:5-(G-Y),z.avail_out=Q<te?te-Q+257:257-(Q-te),X.hold=oe,X.bits=he}},{}],49:[function(M,$,j){var z=M("../utils/common"),V=M("./adler32"),X=M("./crc32"),G=M("./inffast"),Y=M("./inftrees"),Q=1,Z=2,te=0,ee=-2,ne=1,re=852,se=592;function ie(ge){return(ge>>>24&255)+(ge>>>8&65280)+((65280&ge)<<8)+((255&ge)<<24)}function oe(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new z.Buf16(320),this.work=new z.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function he(ge){var Ae;return ge&&ge.state?(Ae=ge.state,ge.total_in=ge.total_out=Ae.total=0,ge.msg="",Ae.wrap&&(ge.adler=1&Ae.wrap),Ae.mode=ne,Ae.last=0,Ae.havedict=0,Ae.dmax=32768,Ae.head=null,Ae.hold=0,Ae.bits=0,Ae.lencode=Ae.lendyn=new z.Buf32(re),Ae.distcode=Ae.distdyn=new z.Buf32(se),Ae.sane=1,Ae.back=-1,te):ee}function le(ge){var Ae;return ge&&ge.state?((Ae=ge.state).wsize=0,Ae.whave=0,Ae.wnext=0,he(ge)):ee}function ae(ge,Ae){var de,De;return ge&&ge.state?(De=ge.state,Ae<0?(de=0,Ae=-Ae):(de=1+(Ae>>4),Ae<48&&(Ae&=15)),Ae&&(Ae<8||15<Ae)?ee:(De.window!==null&&De.wbits!==Ae&&(De.window=null),De.wrap=de,De.wbits=Ae,le(ge))):ee}function ue(ge,Ae){var de,De;return ge?(De=new oe,(ge.state=De).window=null,(de=ae(ge,Ae))!==te&&(ge.state=null),de):ee}var me,fe,ce=!0;function _e(ge){if(ce){var Ae;for(me=new z.Buf32(512),fe=new z.Buf32(32),Ae=0;Ae<144;)ge.lens[Ae++]=8;for(;Ae<256;)ge.lens[Ae++]=9;for(;Ae<280;)ge.lens[Ae++]=7;for(;Ae<288;)ge.lens[Ae++]=8;for(Y(Q,ge.lens,0,288,me,0,ge.work,{bits:9}),Ae=0;Ae<32;)ge.lens[Ae++]=5;Y(Z,ge.lens,0,32,fe,0,ge.work,{bits:5}),ce=!1}ge.lencode=me,ge.lenbits=9,ge.distcode=fe,ge.distbits=5}function we(ge,Ae,de,De){var Me,Ee=ge.state;return Ee.window===null&&(Ee.wsize=1<<Ee.wbits,Ee.wnext=0,Ee.whave=0,Ee.window=new z.Buf8(Ee.wsize)),De>=Ee.wsize?(z.arraySet(Ee.window,Ae,de-Ee.wsize,Ee.wsize,0),Ee.wnext=0,Ee.whave=Ee.wsize):(De<(Me=Ee.wsize-Ee.wnext)&&(Me=De),z.arraySet(Ee.window,Ae,de-De,Me,Ee.wnext),(De-=Me)?(z.arraySet(Ee.window,Ae,de-De,De,0),Ee.wnext=De,Ee.whave=Ee.wsize):(Ee.wnext+=Me,Ee.wnext===Ee.wsize&&(Ee.wnext=0),Ee.whave<Ee.wsize&&(Ee.whave+=Me))),0}j.inflateReset=le,j.inflateReset2=ae,j.inflateResetKeep=he,j.inflateInit=function(ge){return ue(ge,15)},j.inflateInit2=ue,j.inflate=function(ge,Ae){var de,De,Me,Ee,Te,xe,He,Oe,$e,Pe,ve,ye,Fe,je,Be,Ne,ze,Ze,ut,ot,pe,We,Qe,Ce,Ie=0,Ge=new z.Buf8(4),rt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ge||!ge.state||!ge.output||!ge.input&&ge.avail_in!==0)return ee;(de=ge.state).mode===12&&(de.mode=13),Te=ge.next_out,Me=ge.output,He=ge.avail_out,Ee=ge.next_in,De=ge.input,xe=ge.avail_in,Oe=de.hold,$e=de.bits,Pe=xe,ve=He,We=te;e:for(;;)switch(de.mode){case ne:if(de.wrap===0){de.mode=13;break}for(;$e<16;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}if(2&de.wrap&&Oe===35615){Ge[de.check=0]=255&Oe,Ge[1]=Oe>>>8&255,de.check=X(de.check,Ge,2,0),$e=Oe=0,de.mode=2;break}if(de.flags=0,de.head&&(de.head.done=!1),!(1&de.wrap)||(((255&Oe)<<8)+(Oe>>8))%31){ge.msg="incorrect header check",de.mode=30;break}if((15&Oe)!=8){ge.msg="unknown compression method",de.mode=30;break}if($e-=4,pe=8+(15&(Oe>>>=4)),de.wbits===0)de.wbits=pe;else if(pe>de.wbits){ge.msg="invalid window size",de.mode=30;break}de.dmax=1<<pe,ge.adler=de.check=1,de.mode=512&Oe?10:12,$e=Oe=0;break;case 2:for(;$e<16;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}if(de.flags=Oe,(255&de.flags)!=8){ge.msg="unknown compression method",de.mode=30;break}if(57344&de.flags){ge.msg="unknown header flags set",de.mode=30;break}de.head&&(de.head.text=Oe>>8&1),512&de.flags&&(Ge[0]=255&Oe,Ge[1]=Oe>>>8&255,de.check=X(de.check,Ge,2,0)),$e=Oe=0,de.mode=3;case 3:for(;$e<32;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}de.head&&(de.head.time=Oe),512&de.flags&&(Ge[0]=255&Oe,Ge[1]=Oe>>>8&255,Ge[2]=Oe>>>16&255,Ge[3]=Oe>>>24&255,de.check=X(de.check,Ge,4,0)),$e=Oe=0,de.mode=4;case 4:for(;$e<16;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}de.head&&(de.head.xflags=255&Oe,de.head.os=Oe>>8),512&de.flags&&(Ge[0]=255&Oe,Ge[1]=Oe>>>8&255,de.check=X(de.check,Ge,2,0)),$e=Oe=0,de.mode=5;case 5:if(1024&de.flags){for(;$e<16;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}de.length=Oe,de.head&&(de.head.extra_len=Oe),512&de.flags&&(Ge[0]=255&Oe,Ge[1]=Oe>>>8&255,de.check=X(de.check,Ge,2,0)),$e=Oe=0}else de.head&&(de.head.extra=null);de.mode=6;case 6:if(1024&de.flags&&(xe<(ye=de.length)&&(ye=xe),ye&&(de.head&&(pe=de.head.extra_len-de.length,de.head.extra||(de.head.extra=new Array(de.head.extra_len)),z.arraySet(de.head.extra,De,Ee,ye,pe)),512&de.flags&&(de.check=X(de.check,De,ye,Ee)),xe-=ye,Ee+=ye,de.length-=ye),de.length))break e;de.length=0,de.mode=7;case 7:if(2048&de.flags){if(xe===0)break e;for(ye=0;pe=De[Ee+ye++],de.head&&pe&&de.length<65536&&(de.head.name+=String.fromCharCode(pe)),pe&&ye<xe;);if(512&de.flags&&(de.check=X(de.check,De,ye,Ee)),xe-=ye,Ee+=ye,pe)break e}else de.head&&(de.head.name=null);de.length=0,de.mode=8;case 8:if(4096&de.flags){if(xe===0)break e;for(ye=0;pe=De[Ee+ye++],de.head&&pe&&de.length<65536&&(de.head.comment+=String.fromCharCode(pe)),pe&&ye<xe;);if(512&de.flags&&(de.check=X(de.check,De,ye,Ee)),xe-=ye,Ee+=ye,pe)break e}else de.head&&(de.head.comment=null);de.mode=9;case 9:if(512&de.flags){for(;$e<16;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}if(Oe!==(65535&de.check)){ge.msg="header crc mismatch",de.mode=30;break}$e=Oe=0}de.head&&(de.head.hcrc=de.flags>>9&1,de.head.done=!0),ge.adler=de.check=0,de.mode=12;break;case 10:for(;$e<32;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}ge.adler=de.check=ie(Oe),$e=Oe=0,de.mode=11;case 11:if(de.havedict===0)return ge.next_out=Te,ge.avail_out=He,ge.next_in=Ee,ge.avail_in=xe,de.hold=Oe,de.bits=$e,2;ge.adler=de.check=1,de.mode=12;case 12:if(Ae===5||Ae===6)break e;case 13:if(de.last){Oe>>>=7&$e,$e-=7&$e,de.mode=27;break}for(;$e<3;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}switch(de.last=1&Oe,$e-=1,3&(Oe>>>=1)){case 0:de.mode=14;break;case 1:if(_e(de),de.mode=20,Ae!==6)break;Oe>>>=2,$e-=2;break e;case 2:de.mode=17;break;case 3:ge.msg="invalid block type",de.mode=30}Oe>>>=2,$e-=2;break;case 14:for(Oe>>>=7&$e,$e-=7&$e;$e<32;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}if((65535&Oe)!=(Oe>>>16^65535)){ge.msg="invalid stored block lengths",de.mode=30;break}if(de.length=65535&Oe,$e=Oe=0,de.mode=15,Ae===6)break e;case 15:de.mode=16;case 16:if(ye=de.length){if(xe<ye&&(ye=xe),He<ye&&(ye=He),ye===0)break e;z.arraySet(Me,De,Ee,ye,Te),xe-=ye,Ee+=ye,He-=ye,Te+=ye,de.length-=ye;break}de.mode=12;break;case 17:for(;$e<14;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}if(de.nlen=257+(31&Oe),Oe>>>=5,$e-=5,de.ndist=1+(31&Oe),Oe>>>=5,$e-=5,de.ncode=4+(15&Oe),Oe>>>=4,$e-=4,286<de.nlen||30<de.ndist){ge.msg="too many length or distance symbols",de.mode=30;break}de.have=0,de.mode=18;case 18:for(;de.have<de.ncode;){for(;$e<3;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}de.lens[rt[de.have++]]=7&Oe,Oe>>>=3,$e-=3}for(;de.have<19;)de.lens[rt[de.have++]]=0;if(de.lencode=de.lendyn,de.lenbits=7,Qe={bits:de.lenbits},We=Y(0,de.lens,0,19,de.lencode,0,de.work,Qe),de.lenbits=Qe.bits,We){ge.msg="invalid code lengths set",de.mode=30;break}de.have=0,de.mode=19;case 19:for(;de.have<de.nlen+de.ndist;){for(;Ne=(Ie=de.lencode[Oe&(1<<de.lenbits)-1])>>>16&255,ze=65535&Ie,!((Be=Ie>>>24)<=$e);){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}if(ze<16)Oe>>>=Be,$e-=Be,de.lens[de.have++]=ze;else{if(ze===16){for(Ce=Be+2;$e<Ce;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}if(Oe>>>=Be,$e-=Be,de.have===0){ge.msg="invalid bit length repeat",de.mode=30;break}pe=de.lens[de.have-1],ye=3+(3&Oe),Oe>>>=2,$e-=2}else if(ze===17){for(Ce=Be+3;$e<Ce;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}$e-=Be,pe=0,ye=3+(7&(Oe>>>=Be)),Oe>>>=3,$e-=3}else{for(Ce=Be+7;$e<Ce;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}$e-=Be,pe=0,ye=11+(127&(Oe>>>=Be)),Oe>>>=7,$e-=7}if(de.have+ye>de.nlen+de.ndist){ge.msg="invalid bit length repeat",de.mode=30;break}for(;ye--;)de.lens[de.have++]=pe}}if(de.mode===30)break;if(de.lens[256]===0){ge.msg="invalid code -- missing end-of-block",de.mode=30;break}if(de.lenbits=9,Qe={bits:de.lenbits},We=Y(Q,de.lens,0,de.nlen,de.lencode,0,de.work,Qe),de.lenbits=Qe.bits,We){ge.msg="invalid literal/lengths set",de.mode=30;break}if(de.distbits=6,de.distcode=de.distdyn,Qe={bits:de.distbits},We=Y(Z,de.lens,de.nlen,de.ndist,de.distcode,0,de.work,Qe),de.distbits=Qe.bits,We){ge.msg="invalid distances set",de.mode=30;break}if(de.mode=20,Ae===6)break e;case 20:de.mode=21;case 21:if(6<=xe&&258<=He){ge.next_out=Te,ge.avail_out=He,ge.next_in=Ee,ge.avail_in=xe,de.hold=Oe,de.bits=$e,G(ge,ve),Te=ge.next_out,Me=ge.output,He=ge.avail_out,Ee=ge.next_in,De=ge.input,xe=ge.avail_in,Oe=de.hold,$e=de.bits,de.mode===12&&(de.back=-1);break}for(de.back=0;Ne=(Ie=de.lencode[Oe&(1<<de.lenbits)-1])>>>16&255,ze=65535&Ie,!((Be=Ie>>>24)<=$e);){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}if(Ne&&!(240&Ne)){for(Ze=Be,ut=Ne,ot=ze;Ne=(Ie=de.lencode[ot+((Oe&(1<<Ze+ut)-1)>>Ze)])>>>16&255,ze=65535&Ie,!(Ze+(Be=Ie>>>24)<=$e);){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}Oe>>>=Ze,$e-=Ze,de.back+=Ze}if(Oe>>>=Be,$e-=Be,de.back+=Be,de.length=ze,Ne===0){de.mode=26;break}if(32&Ne){de.back=-1,de.mode=12;break}if(64&Ne){ge.msg="invalid literal/length code",de.mode=30;break}de.extra=15&Ne,de.mode=22;case 22:if(de.extra){for(Ce=de.extra;$e<Ce;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}de.length+=Oe&(1<<de.extra)-1,Oe>>>=de.extra,$e-=de.extra,de.back+=de.extra}de.was=de.length,de.mode=23;case 23:for(;Ne=(Ie=de.distcode[Oe&(1<<de.distbits)-1])>>>16&255,ze=65535&Ie,!((Be=Ie>>>24)<=$e);){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}if(!(240&Ne)){for(Ze=Be,ut=Ne,ot=ze;Ne=(Ie=de.distcode[ot+((Oe&(1<<Ze+ut)-1)>>Ze)])>>>16&255,ze=65535&Ie,!(Ze+(Be=Ie>>>24)<=$e);){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}Oe>>>=Ze,$e-=Ze,de.back+=Ze}if(Oe>>>=Be,$e-=Be,de.back+=Be,64&Ne){ge.msg="invalid distance code",de.mode=30;break}de.offset=ze,de.extra=15&Ne,de.mode=24;case 24:if(de.extra){for(Ce=de.extra;$e<Ce;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}de.offset+=Oe&(1<<de.extra)-1,Oe>>>=de.extra,$e-=de.extra,de.back+=de.extra}if(de.offset>de.dmax){ge.msg="invalid distance too far back",de.mode=30;break}de.mode=25;case 25:if(He===0)break e;if(ye=ve-He,de.offset>ye){if((ye=de.offset-ye)>de.whave&&de.sane){ge.msg="invalid distance too far back",de.mode=30;break}Fe=ye>de.wnext?(ye-=de.wnext,de.wsize-ye):de.wnext-ye,ye>de.length&&(ye=de.length),je=de.window}else je=Me,Fe=Te-de.offset,ye=de.length;for(He<ye&&(ye=He),He-=ye,de.length-=ye;Me[Te++]=je[Fe++],--ye;);de.length===0&&(de.mode=21);break;case 26:if(He===0)break e;Me[Te++]=de.length,He--,de.mode=21;break;case 27:if(de.wrap){for(;$e<32;){if(xe===0)break e;xe--,Oe|=De[Ee++]<<$e,$e+=8}if(ve-=He,ge.total_out+=ve,de.total+=ve,ve&&(ge.adler=de.check=de.flags?X(de.check,Me,ve,Te-ve):V(de.check,Me,ve,Te-ve)),ve=He,(de.flags?Oe:ie(Oe))!==de.check){ge.msg="incorrect data check",de.mode=30;break}$e=Oe=0}de.mode=28;case 28:if(de.wrap&&de.flags){for(;$e<32;){if(xe===0)break e;xe--,Oe+=De[Ee++]<<$e,$e+=8}if(Oe!==(4294967295&de.total)){ge.msg="incorrect length check",de.mode=30;break}$e=Oe=0}de.mode=29;case 29:We=1;break e;case 30:We=-3;break e;case 31:return-4;case 32:default:return ee}return ge.next_out=Te,ge.avail_out=He,ge.next_in=Ee,ge.avail_in=xe,de.hold=Oe,de.bits=$e,(de.wsize||ve!==ge.avail_out&&de.mode<30&&(de.mode<27||Ae!==4))&&we(ge,ge.output,ge.next_out,ve-ge.avail_out)?(de.mode=31,-4):(Pe-=ge.avail_in,ve-=ge.avail_out,ge.total_in+=Pe,ge.total_out+=ve,de.total+=ve,de.wrap&&ve&&(ge.adler=de.check=de.flags?X(de.check,Me,ve,ge.next_out-ve):V(de.check,Me,ve,ge.next_out-ve)),ge.data_type=de.bits+(de.last?64:0)+(de.mode===12?128:0)+(de.mode===20||de.mode===15?256:0),(Pe==0&&ve===0||Ae===4)&&We===te&&(We=-5),We)},j.inflateEnd=function(ge){if(!ge||!ge.state)return ee;var Ae=ge.state;return Ae.window&&(Ae.window=null),ge.state=null,te},j.inflateGetHeader=function(ge,Ae){var de;return ge&&ge.state&&2&(de=ge.state).wrap?((de.head=Ae).done=!1,te):ee},j.inflateSetDictionary=function(ge,Ae){var de,De=Ae.length;return ge&&ge.state?(de=ge.state).wrap!==0&&de.mode!==11?ee:de.mode===11&&V(1,Ae,De,0)!==de.check?-3:we(ge,Ae,De,De)?(de.mode=31,-4):(de.havedict=1,te):ee},j.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(M,$,j){var z=M("../utils/common"),V=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],X=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],G=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Y=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];$.exports=function(Q,Z,te,ee,ne,re,se,ie){var oe,he,le,ae,ue,me,fe,ce,_e,we=ie.bits,ge=0,Ae=0,de=0,De=0,Me=0,Ee=0,Te=0,xe=0,He=0,Oe=0,$e=null,Pe=0,ve=new z.Buf16(16),ye=new z.Buf16(16),Fe=null,je=0;for(ge=0;ge<=15;ge++)ve[ge]=0;for(Ae=0;Ae<ee;Ae++)ve[Z[te+Ae]]++;for(Me=we,De=15;1<=De&&ve[De]===0;De--);if(De<Me&&(Me=De),De===0)return ne[re++]=20971520,ne[re++]=20971520,ie.bits=1,0;for(de=1;de<De&&ve[de]===0;de++);for(Me<de&&(Me=de),ge=xe=1;ge<=15;ge++)if(xe<<=1,(xe-=ve[ge])<0)return-1;if(0<xe&&(Q===0||De!==1))return-1;for(ye[1]=0,ge=1;ge<15;ge++)ye[ge+1]=ye[ge]+ve[ge];for(Ae=0;Ae<ee;Ae++)Z[te+Ae]!==0&&(se[ye[Z[te+Ae]]++]=Ae);if(me=Q===0?($e=Fe=se,19):Q===1?($e=V,Pe-=257,Fe=X,je-=257,256):($e=G,Fe=Y,-1),ge=de,ue=re,Te=Ae=Oe=0,le=-1,ae=(He=1<<(Ee=Me))-1,Q===1&&852<He||Q===2&&592<He)return 1;for(;;){for(fe=ge-Te,_e=se[Ae]<me?(ce=0,se[Ae]):se[Ae]>me?(ce=Fe[je+se[Ae]],$e[Pe+se[Ae]]):(ce=96,0),oe=1<<ge-Te,de=he=1<<Ee;ne[ue+(Oe>>Te)+(he-=oe)]=fe<<24|ce<<16|_e|0,he!==0;);for(oe=1<<ge-1;Oe&oe;)oe>>=1;if(oe!==0?(Oe&=oe-1,Oe+=oe):Oe=0,Ae++,--ve[ge]==0){if(ge===De)break;ge=Z[te+se[Ae]]}if(Me<ge&&(Oe&ae)!==le){for(Te===0&&(Te=Me),ue+=de,xe=1<<(Ee=ge-Te);Ee+Te<De&&!((xe-=ve[Ee+Te])<=0);)Ee++,xe<<=1;if(He+=1<<Ee,Q===1&&852<He||Q===2&&592<He)return 1;ne[le=Oe&ae]=Me<<24|Ee<<16|ue-re|0}}return Oe!==0&&(ne[ue+Oe]=ge-Te<<24|64<<16|0),ie.bits=Me,0}},{"../utils/common":41}],51:[function(M,$,j){$.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(M,$,j){var z=M("../utils/common"),V=0,X=1;function G(Ie){for(var Ge=Ie.length;0<=--Ge;)Ie[Ge]=0}var Y=0,Q=29,Z=256,te=Z+1+Q,ee=30,ne=19,re=2*te+1,se=15,ie=16,oe=7,he=256,le=16,ae=17,ue=18,me=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],fe=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ce=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],_e=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],we=new Array(2*(te+2));G(we);var ge=new Array(2*ee);G(ge);var Ae=new Array(512);G(Ae);var de=new Array(256);G(de);var De=new Array(Q);G(De);var Me,Ee,Te,xe=new Array(ee);function He(Ie,Ge,rt,ct,qe){this.static_tree=Ie,this.extra_bits=Ge,this.extra_base=rt,this.elems=ct,this.max_length=qe,this.has_stree=Ie&&Ie.length}function Oe(Ie,Ge){this.dyn_tree=Ie,this.max_code=0,this.stat_desc=Ge}function $e(Ie){return Ie<256?Ae[Ie]:Ae[256+(Ie>>>7)]}function Pe(Ie,Ge){Ie.pending_buf[Ie.pending++]=255&Ge,Ie.pending_buf[Ie.pending++]=Ge>>>8&255}function ve(Ie,Ge,rt){Ie.bi_valid>ie-rt?(Ie.bi_buf|=Ge<<Ie.bi_valid&65535,Pe(Ie,Ie.bi_buf),Ie.bi_buf=Ge>>ie-Ie.bi_valid,Ie.bi_valid+=rt-ie):(Ie.bi_buf|=Ge<<Ie.bi_valid&65535,Ie.bi_valid+=rt)}function ye(Ie,Ge,rt){ve(Ie,rt[2*Ge],rt[2*Ge+1])}function Fe(Ie,Ge){for(var rt=0;rt|=1&Ie,Ie>>>=1,rt<<=1,0<--Ge;);return rt>>>1}function je(Ie,Ge,rt){var ct,qe,Ve=new Array(se+1),Xe=0;for(ct=1;ct<=se;ct++)Ve[ct]=Xe=Xe+rt[ct-1]<<1;for(qe=0;qe<=Ge;qe++){var Je=Ie[2*qe+1];Je!==0&&(Ie[2*qe]=Fe(Ve[Je]++,Je))}}function Be(Ie){var Ge;for(Ge=0;Ge<te;Ge++)Ie.dyn_ltree[2*Ge]=0;for(Ge=0;Ge<ee;Ge++)Ie.dyn_dtree[2*Ge]=0;for(Ge=0;Ge<ne;Ge++)Ie.bl_tree[2*Ge]=0;Ie.dyn_ltree[2*he]=1,Ie.opt_len=Ie.static_len=0,Ie.last_lit=Ie.matches=0}function Ne(Ie){8<Ie.bi_valid?Pe(Ie,Ie.bi_buf):0<Ie.bi_valid&&(Ie.pending_buf[Ie.pending++]=Ie.bi_buf),Ie.bi_buf=0,Ie.bi_valid=0}function ze(Ie,Ge,rt,ct){var qe=2*Ge,Ve=2*rt;return Ie[qe]<Ie[Ve]||Ie[qe]===Ie[Ve]&&ct[Ge]<=ct[rt]}function Ze(Ie,Ge,rt){for(var ct=Ie.heap[rt],qe=rt<<1;qe<=Ie.heap_len&&(qe<Ie.heap_len&&ze(Ge,Ie.heap[qe+1],Ie.heap[qe],Ie.depth)&&qe++,!ze(Ge,ct,Ie.heap[qe],Ie.depth));)Ie.heap[rt]=Ie.heap[qe],rt=qe,qe<<=1;Ie.heap[rt]=ct}function ut(Ie,Ge,rt){var ct,qe,Ve,Xe,Je=0;if(Ie.last_lit!==0)for(;ct=Ie.pending_buf[Ie.d_buf+2*Je]<<8|Ie.pending_buf[Ie.d_buf+2*Je+1],qe=Ie.pending_buf[Ie.l_buf+Je],Je++,ct===0?ye(Ie,qe,Ge):(ye(Ie,(Ve=de[qe])+Z+1,Ge),(Xe=me[Ve])!==0&&ve(Ie,qe-=De[Ve],Xe),ye(Ie,Ve=$e(--ct),rt),(Xe=fe[Ve])!==0&&ve(Ie,ct-=xe[Ve],Xe)),Je<Ie.last_lit;);ye(Ie,he,Ge)}function ot(Ie,Ge){var rt,ct,qe,Ve=Ge.dyn_tree,Xe=Ge.stat_desc.static_tree,Je=Ge.stat_desc.has_stree,lt=Ge.stat_desc.elems,_t=-1;for(Ie.heap_len=0,Ie.heap_max=re,rt=0;rt<lt;rt++)Ve[2*rt]!==0?(Ie.heap[++Ie.heap_len]=_t=rt,Ie.depth[rt]=0):Ve[2*rt+1]=0;for(;Ie.heap_len<2;)Ve[2*(qe=Ie.heap[++Ie.heap_len]=_t<2?++_t:0)]=1,Ie.depth[qe]=0,Ie.opt_len--,Je&&(Ie.static_len-=Xe[2*qe+1]);for(Ge.max_code=_t,rt=Ie.heap_len>>1;1<=rt;rt--)Ze(Ie,Ve,rt);for(qe=lt;rt=Ie.heap[1],Ie.heap[1]=Ie.heap[Ie.heap_len--],Ze(Ie,Ve,1),ct=Ie.heap[1],Ie.heap[--Ie.heap_max]=rt,Ie.heap[--Ie.heap_max]=ct,Ve[2*qe]=Ve[2*rt]+Ve[2*ct],Ie.depth[qe]=(Ie.depth[rt]>=Ie.depth[ct]?Ie.depth[rt]:Ie.depth[ct])+1,Ve[2*rt+1]=Ve[2*ct+1]=qe,Ie.heap[1]=qe++,Ze(Ie,Ve,1),2<=Ie.heap_len;);Ie.heap[--Ie.heap_max]=Ie.heap[1],function(mt,Ct){var Et,xt,Tt,Dt,tt,it,nt=Ct.dyn_tree,gt=Ct.max_code,Rt=Ct.stat_desc.static_tree,St=Ct.stat_desc.has_stree,Bt=Ct.stat_desc.extra_bits,Lt=Ct.stat_desc.extra_base,Se=Ct.stat_desc.max_length,et=0;for(Dt=0;Dt<=se;Dt++)mt.bl_count[Dt]=0;for(nt[2*mt.heap[mt.heap_max]+1]=0,Et=mt.heap_max+1;Et<re;Et++)Se<(Dt=nt[2*nt[2*(xt=mt.heap[Et])+1]+1]+1)&&(Dt=Se,et++),nt[2*xt+1]=Dt,gt<xt||(mt.bl_count[Dt]++,tt=0,Lt<=xt&&(tt=Bt[xt-Lt]),it=nt[2*xt],mt.opt_len+=it*(Dt+tt),St&&(mt.static_len+=it*(Rt[2*xt+1]+tt)));if(et!==0){do{for(Dt=Se-1;mt.bl_count[Dt]===0;)Dt--;mt.bl_count[Dt]--,mt.bl_count[Dt+1]+=2,mt.bl_count[Se]--,et-=2}while(0<et);for(Dt=Se;Dt!==0;Dt--)for(xt=mt.bl_count[Dt];xt!==0;)gt<(Tt=mt.heap[--Et])||(nt[2*Tt+1]!==Dt&&(mt.opt_len+=(Dt-nt[2*Tt+1])*nt[2*Tt],nt[2*Tt+1]=Dt),xt--)}}(Ie,Ge),je(Ve,_t,Ie.bl_count)}function pe(Ie,Ge,rt){var ct,qe,Ve=-1,Xe=Ge[1],Je=0,lt=7,_t=4;for(Xe===0&&(lt=138,_t=3),Ge[2*(rt+1)+1]=65535,ct=0;ct<=rt;ct++)qe=Xe,Xe=Ge[2*(ct+1)+1],++Je<lt&&qe===Xe||(Je<_t?Ie.bl_tree[2*qe]+=Je:qe!==0?(qe!==Ve&&Ie.bl_tree[2*qe]++,Ie.bl_tree[2*le]++):Je<=10?Ie.bl_tree[2*ae]++:Ie.bl_tree[2*ue]++,Ve=qe,_t=(Je=0)===Xe?(lt=138,3):qe===Xe?(lt=6,3):(lt=7,4))}function We(Ie,Ge,rt){var ct,qe,Ve=-1,Xe=Ge[1],Je=0,lt=7,_t=4;for(Xe===0&&(lt=138,_t=3),ct=0;ct<=rt;ct++)if(qe=Xe,Xe=Ge[2*(ct+1)+1],!(++Je<lt&&qe===Xe)){if(Je<_t)for(;ye(Ie,qe,Ie.bl_tree),--Je!=0;);else qe!==0?(qe!==Ve&&(ye(Ie,qe,Ie.bl_tree),Je--),ye(Ie,le,Ie.bl_tree),ve(Ie,Je-3,2)):Je<=10?(ye(Ie,ae,Ie.bl_tree),ve(Ie,Je-3,3)):(ye(Ie,ue,Ie.bl_tree),ve(Ie,Je-11,7));Ve=qe,_t=(Je=0)===Xe?(lt=138,3):qe===Xe?(lt=6,3):(lt=7,4)}}G(xe);var Qe=!1;function Ce(Ie,Ge,rt,ct){ve(Ie,(Y<<1)+(ct?1:0),3),function(qe,Ve,Xe,Je){Ne(qe),Je&&(Pe(qe,Xe),Pe(qe,~Xe)),z.arraySet(qe.pending_buf,qe.window,Ve,Xe,qe.pending),qe.pending+=Xe}(Ie,Ge,rt,!0)}j._tr_init=function(Ie){Qe||(function(){var Ge,rt,ct,qe,Ve,Xe=new Array(se+1);for(qe=ct=0;qe<Q-1;qe++)for(De[qe]=ct,Ge=0;Ge<1<<me[qe];Ge++)de[ct++]=qe;for(de[ct-1]=qe,qe=Ve=0;qe<16;qe++)for(xe[qe]=Ve,Ge=0;Ge<1<<fe[qe];Ge++)Ae[Ve++]=qe;for(Ve>>=7;qe<ee;qe++)for(xe[qe]=Ve<<7,Ge=0;Ge<1<<fe[qe]-7;Ge++)Ae[256+Ve++]=qe;for(rt=0;rt<=se;rt++)Xe[rt]=0;for(Ge=0;Ge<=143;)we[2*Ge+1]=8,Ge++,Xe[8]++;for(;Ge<=255;)we[2*Ge+1]=9,Ge++,Xe[9]++;for(;Ge<=279;)we[2*Ge+1]=7,Ge++,Xe[7]++;for(;Ge<=287;)we[2*Ge+1]=8,Ge++,Xe[8]++;for(je(we,te+1,Xe),Ge=0;Ge<ee;Ge++)ge[2*Ge+1]=5,ge[2*Ge]=Fe(Ge,5);Me=new He(we,me,Z+1,te,se),Ee=new He(ge,fe,0,ee,se),Te=new He(new Array(0),ce,0,ne,oe)}(),Qe=!0),Ie.l_desc=new Oe(Ie.dyn_ltree,Me),Ie.d_desc=new Oe(Ie.dyn_dtree,Ee),Ie.bl_desc=new Oe(Ie.bl_tree,Te),Ie.bi_buf=0,Ie.bi_valid=0,Be(Ie)},j._tr_stored_block=Ce,j._tr_flush_block=function(Ie,Ge,rt,ct){var qe,Ve,Xe=0;0<Ie.level?(Ie.strm.data_type===2&&(Ie.strm.data_type=function(Je){var lt,_t=4093624447;for(lt=0;lt<=31;lt++,_t>>>=1)if(1&_t&&Je.dyn_ltree[2*lt]!==0)return V;if(Je.dyn_ltree[18]!==0||Je.dyn_ltree[20]!==0||Je.dyn_ltree[26]!==0)return X;for(lt=32;lt<Z;lt++)if(Je.dyn_ltree[2*lt]!==0)return X;return V}(Ie)),ot(Ie,Ie.l_desc),ot(Ie,Ie.d_desc),Xe=function(Je){var lt;for(pe(Je,Je.dyn_ltree,Je.l_desc.max_code),pe(Je,Je.dyn_dtree,Je.d_desc.max_code),ot(Je,Je.bl_desc),lt=ne-1;3<=lt&&Je.bl_tree[2*_e[lt]+1]===0;lt--);return Je.opt_len+=3*(lt+1)+5+5+4,lt}(Ie),qe=Ie.opt_len+3+7>>>3,(Ve=Ie.static_len+3+7>>>3)<=qe&&(qe=Ve)):qe=Ve=rt+5,rt+4<=qe&&Ge!==-1?Ce(Ie,Ge,rt,ct):Ie.strategy===4||Ve===qe?(ve(Ie,2+(ct?1:0),3),ut(Ie,we,ge)):(ve(Ie,4+(ct?1:0),3),function(Je,lt,_t,mt){var Ct;for(ve(Je,lt-257,5),ve(Je,_t-1,5),ve(Je,mt-4,4),Ct=0;Ct<mt;Ct++)ve(Je,Je.bl_tree[2*_e[Ct]+1],3);We(Je,Je.dyn_ltree,lt-1),We(Je,Je.dyn_dtree,_t-1)}(Ie,Ie.l_desc.max_code+1,Ie.d_desc.max_code+1,Xe+1),ut(Ie,Ie.dyn_ltree,Ie.dyn_dtree)),Be(Ie),ct&&Ne(Ie)},j._tr_tally=function(Ie,Ge,rt){return Ie.pending_buf[Ie.d_buf+2*Ie.last_lit]=Ge>>>8&255,Ie.pending_buf[Ie.d_buf+2*Ie.last_lit+1]=255&Ge,Ie.pending_buf[Ie.l_buf+Ie.last_lit]=255&rt,Ie.last_lit++,Ge===0?Ie.dyn_ltree[2*rt]++:(Ie.matches++,Ge--,Ie.dyn_ltree[2*(de[rt]+Z+1)]++,Ie.dyn_dtree[2*$e(Ge)]++),Ie.last_lit===Ie.lit_bufsize-1},j._tr_align=function(Ie){ve(Ie,2,3),ye(Ie,he,we),function(Ge){Ge.bi_valid===16?(Pe(Ge,Ge.bi_buf),Ge.bi_buf=0,Ge.bi_valid=0):8<=Ge.bi_valid&&(Ge.pending_buf[Ge.pending++]=255&Ge.bi_buf,Ge.bi_buf>>=8,Ge.bi_valid-=8)}(Ie)}},{"../utils/common":41}],53:[function(M,$,j){$.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(M,$,j){(function(z){(function(V,X){if(!V.setImmediate){var G,Y,Q,Z,te=1,ee={},ne=!1,re=V.document,se=Object.getPrototypeOf&&Object.getPrototypeOf(V);se=se&&se.setTimeout?se:V,G={}.toString.call(V.process)==="[object process]"?function(le){process.nextTick(function(){oe(le)})}:function(){if(V.postMessage&&!V.importScripts){var le=!0,ae=V.onmessage;return V.onmessage=function(){le=!1},V.postMessage("","*"),V.onmessage=ae,le}}()?(Z="setImmediate$"+Math.random()+"$",V.addEventListener?V.addEventListener("message",he,!1):V.attachEvent("onmessage",he),function(le){V.postMessage(Z+le,"*")}):V.MessageChannel?((Q=new MessageChannel).port1.onmessage=function(le){oe(le.data)},function(le){Q.port2.postMessage(le)}):re&&"onreadystatechange"in re.createElement("script")?(Y=re.documentElement,function(le){var ae=re.createElement("script");ae.onreadystatechange=function(){oe(le),ae.onreadystatechange=null,Y.removeChild(ae),ae=null},Y.appendChild(ae)}):function(le){setTimeout(oe,0,le)},se.setImmediate=function(le){typeof le!="function"&&(le=new Function(""+le));for(var ae=new Array(arguments.length-1),ue=0;ue<ae.length;ue++)ae[ue]=arguments[ue+1];var me={callback:le,args:ae};return ee[te]=me,G(te),te++},se.clearImmediate=ie}function ie(le){delete ee[le]}function oe(le){if(ne)setTimeout(oe,0,le);else{var ae=ee[le];if(ae){ne=!0;try{(function(ue){var me=ue.callback,fe=ue.args;switch(fe.length){case 0:me();break;case 1:me(fe[0]);break;case 2:me(fe[0],fe[1]);break;case 3:me(fe[0],fe[1],fe[2]);break;default:me.apply(X,fe)}})(ae)}finally{ie(le),ne=!1}}}}function he(le){le.source===V&&typeof le.data=="string"&&le.data.indexOf(Z)===0&&oe(+le.data.slice(Z.length))}})(typeof self>"u"?z===void 0?this:z:self)}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(jszip_min);var jszip_minExports=jszip_min.exports;const JSZip=getDefaultExportFromCjs(jszip_minExports);function create_if_block$9(q){let _,M,$,j,z=q[0]>1?"times":"time",V;return{c(){_=element("p"),M=text("This button was used "),$=text(q[0]),j=space(),V=text(z),attr(_,"class","text-left")},m(X,G){insert(X,_,G),append(_,M),append(_,$),append(_,j),append(_,V)},p(X,G){G&1&&set_data($,X[0]),G&1&&z!==(z=X[0]>1?"times":"time")&&set_data(V,z)},d(X){X&&detach(_)}}}function create_fragment$f(q){let _,M,$,j,z,V=q[0]&&create_if_block$9(q);return{c(){_=element("button"),_.textContent="Create Archive",M=space(),V&&V.c(),$=empty()},m(X,G){insert(X,_,G),insert(X,M,G),V&&V.m(X,G),insert(X,$,G),j||(z=listen(_,"click",q[1]),j=!0)},p(X,[G]){X[0]?V?V.p(X,G):(V=create_if_block$9(X),V.c(),V.m($.parentNode,$)):V&&(V.d(1),V=null)},i:noop,o:noop,d(X){X&&detach(_),X&&detach(M),V&&V.d(X),X&&detach($),j=!1,z()}}}function instance$d(q,_,M){let $,j,z;component_subscribe(q,replicaDetails,ne=>M(4,$=ne)),component_subscribe(q,cacheDetails,ne=>M(5,j=ne)),component_subscribe(q,authorKeypair,ne=>M(6,z=ne));let V=[],X;const G=async()=>{let ne=await j.queryDocs({filter:{pathStartsWith:"/counter"}});ne.length>0?M(0,X=ne[0].text):M(0,X="0")};onMount(async()=>{await G()});const Y=async()=>{await G();let ne=X,oe=(parseInt(ne||"0")+1).toString(),he=await $.replica.set(z,{path:"/counter/number",text:oe});console.log("new count",he),M(0,X=oe)},Q=async()=>{V=j.queryDocs({filter:{pathStartsWith:"/documents"}}),V.map(ne=>ne.path)},Z=async ne=>{for(let re of V){let se=ne.folder(re.path.replace("/","_"));if(se.file("document.txt",JSON.stringify(re)),re.attachmentSize){let ie=await $.replica.getAttachment(re),oe=ie?await ie.bytes():void 0,he=re.path.split("/").pop().replace("!","");se.file(he,oe)}}},te=async ne=>{let re=await ne.generateAsync({type:"blob"}),se=document.createElement("a"),ie=new Date().toISOString().slice(0,10);se.href=URL.createObjectURL(re),se.download="archive_"+ie+".zip",se.style.display="none",document.body.appendChild(se),se.click()};return[X,async()=>{let ne=new JSZip;await Q(),await Z(ne),await te(ne),await Y()}]}class DownloadTool extends SvelteComponent{constructor(_){super(),init(this,_,instance$d,create_fragment$f,safe_not_equal,{})}}const ONE_WEEK=7*24*60*60*1e3*1e3,PHASE_DURATION=[4*ONE_WEEK,3*ONE_WEEK,2*ONE_WEEK,ONE_WEEK];function calculateLunarPhase(q){let _=0,M=0;q.forEach(j=>{const z=parseInt(j.path.split("/")[2]),V=parseInt(j.path.split("/")[3]);_=Math.max(_,z),M=Math.max(M,V)});let $=Array(M+1);for(let j=0;j<M+1;j++)$[j]=Array(_+1).fill().map(()=>[]);return q.forEach(j=>{const z=parseInt(j.path.split("/")[2]),V=parseInt(j.path.split("/")[3]),X=j.deleteAfter,G=Date.now()*1e3,Y=X-G;let Q;Y>PHASE_DURATION[1]?Q=0:Y>PHASE_DURATION[2]?Q=1:Y>PHASE_DURATION[3]?Q=2:Q=3,$[V][z].push({doc:j,lunarPhase:Q})}),$}function createObserver(q,_){return new IntersectionObserver(q,{threshold:_})}function observeElement(q,_){_&&q&&q.observe(_)}function disconnectObserver(q){q&&q.disconnect()}const LUNAR_PHASE=[191808e7,127872e7,63936e7,0],COLOR_CYCLE=["#fff5d9","#d3e3d9","#F9DFDD","#CCE9F0"],GridView_svelte_svelte_type_style_lang="";function get_each_context_5(q,_,M){const $=q.slice();return $[53]=_[M],$[55]=M,$}function get_each_context_6(q,_,M){const $=q.slice();return $[53]=_[M],$[57]=M,$}function get_each_context_8(q,_,M){const $=q.slice();return $[61]=_[M],$}function get_each_context_7(q,_,M){const $=q.slice();return $[58]=_[M],$}function get_each_context$5(q,_,M){const $=q.slice();return $[50]=_[M],$[52]=M,$}function get_each_context_1$1(q,_,M){const $=q.slice();return $[53]=_[M],$[55]=M,$}function get_each_context_2(q,_,M){const $=q.slice();return $[53]=_[M],$[57]=M,$}function get_each_context_4(q,_,M){const $=q.slice();return $[61]=_[M],$}function get_each_context_3(q,_,M){const $=q.slice();return $[58]=_[M],$}function create_if_block_23(q){let _,M=q[18].address.slice(0,5)+"",$,j,z;return{c(){_=element("button"),$=text(M),attr(_,"class","h-auto mr-6")},m(V,X){insert(V,_,X),append(_,$),j||(z=listen(_,"click",q[24]),j=!0)},p(V,X){X[0]&262144&&M!==(M=V[18].address.slice(0,5)+"")&&set_data($,M)},d(V){V&&detach(_),j=!1,z()}}}function create_if_block_22(q){let _,M,$;return M=new DocDetails({props:{doc:q[3],attachment:q[1],isReply:q[2]}}),{c(){_=element("div"),create_component(M.$$.fragment)},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z[0]&8&&(V.doc=j[3]),z[0]&2&&(V.attachment=j[1]),z[0]&4&&(V.isReply=j[2]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_else_block_6(q){let _;return{c(){_=text("Back to viewing")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_21(q){let _;return{c(){_=text("Place an artefact")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_20(q){let _,M,$;return M=new Upload({props:{filetype:q[14],xy:q[15]}}),M.$on("success",q[27]),M.$on("close",q[28]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","relative"),set_style(_,"z-index","51")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z[0]&16384&&(V.filetype=j[14]),z[0]&32768&&(V.xy=j[15]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_19(q){let _,M,$;return M=new GridUpload({props:{windowWidth:q[4]}}),M.$on("success",q[36]),M.$on("upload",q[37]),M.$on("selected",q[26]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","relative"),set_style(_,"z-index","51")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z[0]&16&&(V.windowWidth=j[4]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_18(q){let _,M,$;return M=new View({props:{selectedDocument:q[3]}}),M.$on("close",q[35]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","artifact-overlay mt-[14vh] h-[80vh] w-4/5 fixed svelte-h0jpqy")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z[0]&8&&(V.selectedDocument=j[3]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_else_block_4(q){let _,M=[],$=new Map,j,z,V={length:q[19][0]};const X=G=>G[55];for(let G=0;G<V.length;G+=1){let Y=get_each_context_5(q,V,G),Q=X(Y);$.set(Q,M[G]=create_each_block_5(Q,Y))}return{c(){_=element("div");for(let G=0;G<M.length;G+=1)M[G].c();attr(_,"id","Studio"),attr(_,"class","my-grid-container w-screen svelte-h0jpqy"),attr(_,"style",j=`background-color: white; ${q[8]?"grid-template-columns: repeat(3, 1fr); grid-template-rows: auto;":`grid-template-columns: ${q[16]}; grid-template-rows: ${q[17]};`}`)},m(G,Y){insert(G,_,Y);for(let Q=0;Q<M.length;Q+=1)M[Q].m(_,null);z=!0},p(G,Y){Y[0]&2621888&&(V={length:G[19][0]},group_outros(),M=update_keyed_each(M,Y,X,1,G,V,$,_,outro_and_destroy_block,create_each_block_5,null,get_each_context_5),check_outros()),(!z||Y[0]&196864&&j!==(j=`background-color: white; ${G[8]?"grid-template-columns: repeat(3, 1fr); grid-template-rows: auto;":`grid-template-columns: ${G[16]}; grid-template-rows: ${G[17]};`}`))&&attr(_,"style",j)},i(G){if(!z){for(let Y=0;Y<V.length;Y+=1)transition_in(M[Y]);z=!0}},o(G){for(let Y=0;Y<M.length;Y+=1)transition_out(M[Y]);z=!1},d(G){G&&detach(_);for(let Y=0;Y<M.length;Y+=1)M[Y].d()}}}function create_if_block_1$8(q){let _=[],M=new Map,$,j,z,V=LUNAR_PHASE;const X=G=>G[52];for(let G=0;G<V.length;G+=1){let Y=get_each_context$5(q,V,G),Q=X(Y);M.set(Q,_[G]=create_each_block$5(Q,Y))}return j=new StudioPortal({}),j.$on("shareUpdated",q[22]),{c(){for(let G=0;G<_.length;G+=1)_[G].c();$=space(),create_component(j.$$.fragment)},m(G,Y){for(let Q=0;Q<_.length;Q+=1)_[Q].m(G,Y);insert(G,$,Y),mount_component(j,G,Y),z=!0},p(G,Y){Y[0]&3867072&&(V=LUNAR_PHASE,group_outros(),_=update_keyed_each(_,Y,X,1,G,V,M,$.parentNode,outro_and_destroy_block,create_each_block$5,$,get_each_context$5),check_outros())},i(G){if(!z){for(let Y=0;Y<V.length;Y+=1)transition_in(_[Y]);transition_in(j.$$.fragment,G),z=!0}},o(G){for(let Y=0;Y<_.length;Y+=1)transition_out(_[Y]);transition_out(j.$$.fragment,G),z=!1},d(G){for(let Y=0;Y<_.length;Y+=1)_[Y].d(G);G&&detach($),destroy_component(j,G)}}}function create_if_block$8(q){let _;return{c(){_=element("div"),_.innerHTML='<h3 class="p-6">No files yet</h3>',attr(_,"class","flex flex-col items-center justify-center align-middle h-[60vh]")},m(M,$){insert(M,_,$)},p:noop,i:noop,o:noop,d(M){M&&detach(_)}}}function create_else_block_5(q){let _,M,$=q[7].find(V),j,z;function V(...Z){return q[33](q[55],q[57],...Z)}function X(Z,te){if(Z[55]===0)return create_if_block_15;if(Z[57]===0)return create_if_block_17}let G=X(q),Y=G&&G(q),Q=$&&create_if_block_14(q);return{c(){_=element("div"),Y&&Y.c(),M=space(),Q&&Q.c(),j=space(),attr(_,"class","grid-cell svelte-h0jpqy")},m(Z,te){insert(Z,_,te),Y&&Y.m(_,null),append(_,M),Q&&Q.m(_,null),append(_,j),z=!0},p(Z,te){q=Z,Y&&Y.p(q,te),te[0]&128&&($=q[7].find(V)),$?Q?(Q.p(q,te),te[0]&128&&transition_in(Q,1)):(Q=create_if_block_14(q),Q.c(),transition_in(Q,1),Q.m(_,j)):Q&&(group_outros(),transition_out(Q,1,1,()=>{Q=null}),check_outros())},i(Z){z||(transition_in(Q),z=!0)},o(Z){transition_out(Q),z=!1},d(Z){Z&&detach(_),Y&&Y.d(),Q&&Q.d()}}}function create_if_block_12(q){let _,M,$=q[6][q[57]][q[55]]&&q[6][q[57]][q[55]].length>0&&create_if_block_13(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,z){j[6][j[57]][j[55]]&&j[6][j[57]][j[55]].length>0?$?($.p(j,z),z[0]&64&&transition_in($,1)):($=create_if_block_13(j),$.c(),transition_in($,1),$.m(_.parentNode,_)):$&&(group_outros(),transition_out($,1,1,()=>{$=null}),check_outros())},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function create_if_block_17(q){let _,M=q[55]+1+"",$;return{c(){_=element("p"),$=text(M),attr(_,"class","text-left text-xl")},m(j,z){insert(j,_,z),append(_,$)},p:noop,d(j){j&&detach(_)}}}function create_if_block_15(q){let _,M=mapNumberToLetter(q[57])+"",$,j,z,V=q[57]===0&&create_if_block_16(q);return{c(){_=element("p"),$=text(M),j=space(),V&&V.c(),z=empty(),attr(_,"class","text-xl")},m(X,G){insert(X,_,G),append(_,$),insert(X,j,G),V&&V.m(X,G),insert(X,z,G)},p(X,G){X[57]===0&&V.p(X,G)},d(X){X&&detach(_),X&&detach(j),V&&V.d(X),X&&detach(z)}}}function create_if_block_16(q){let _,M=q[55]+1+"",$;return{c(){_=element("p"),$=text(M),attr(_,"class","text-left text-xl")},m(j,z){insert(j,_,z),append(_,$)},p:noop,d(j){j&&detach(_)}}}function create_if_block_14(q){let _=[],M=new Map,$,j;function z(...G){return q[43](q[55],q[57],...G)}let V=q[7].filter(z);const X=G=>G[61].textHash+G[61].timestamp;for(let G=0;G<V.length;G+=1){let Y=get_each_context_8(q,V,G),Q=X(Y);M.set(Q,_[G]=create_each_block_8(Q,Y))}return{c(){for(let G=0;G<_.length;G+=1)_[G].c();$=empty()},m(G,Y){for(let Q=0;Q<_.length;Q+=1)_[Q].m(G,Y);insert(G,$,Y),j=!0},p(G,Y){q=G,Y[0]&2621568&&(V=q[7].filter(z),group_outros(),_=update_keyed_each(_,Y,X,1,q,V,M,$.parentNode,outro_and_destroy_block,create_each_block_8,$,get_each_context_8),check_outros())},i(G){if(!j){for(let Y=0;Y<V.length;Y+=1)transition_in(_[Y]);j=!0}},o(G){for(let Y=0;Y<_.length;Y+=1)transition_out(_[Y]);j=!1},d(G){for(let Y=0;Y<_.length;Y+=1)_[Y].d(G);G&&detach($)}}}function create_each_block_8(q,_){let M,$,j,z,V,X,G,Y;$=new OrbitingReplies({props:{doc:_[61]}});function Q(){return _[44](_[61])}return V=new Icon({props:{replies,phase:"1",doc:_[61]}}),V.$on("click",Q),{key:q,first:null,c(){M=element("div"),create_component($.$$.fragment),j=space(),z=element("div"),create_component(V.$$.fragment),X=space(),attr(z,"class","orbit-icon svelte-h0jpqy"),attr(M,"id",G=_[61].textHash+_[61].timestamp),attr(M,"class","orbit-icon-container svelte-h0jpqy"),this.first=M},m(Z,te){insert(Z,M,te),mount_component($,M,null),append(M,j),append(M,z),mount_component(V,z,null),append(M,X),Y=!0},p(Z,te){_=Z;const ee={};te[0]&128&&(ee.doc=_[61]),$.$set(ee);const ne={};te[0]&128&&(ne.doc=_[61]),V.$set(ne),(!Y||te[0]&128&&G!==(G=_[61].textHash+_[61].timestamp))&&attr(M,"id",G)},i(Z){Y||(transition_in($.$$.fragment,Z),transition_in(V.$$.fragment,Z),Y=!0)},o(Z){transition_out($.$$.fragment,Z),transition_out(V.$$.fragment,Z),Y=!1},d(Z){Z&&detach(M),destroy_component($),destroy_component(V)}}}function create_if_block_13(q){let _,M=q[55]+"",$,j,z=q[57]+"",V,X,G,Y,Q=q[6][q[57]][q[55]],Z=[];for(let ee=0;ee<Q.length;ee+=1)Z[ee]=create_each_block_7(get_each_context_7(q,Q,ee));const te=ee=>transition_out(Z[ee],1,1,()=>{Z[ee]=null});return{c(){_=element("div"),$=text(M),j=text(","),V=text(z),X=space();for(let ee=0;ee<Z.length;ee+=1)Z[ee].c();G=space(),attr(_,"id",`Studio_cell_${q[55]}_${q[57]}`),attr(_,"class","grid-cell svelte-h0jpqy")},m(ee,ne){insert(ee,_,ne),append(_,$),append(_,j),append(_,V),append(_,X);for(let re=0;re<Z.length;re+=1)Z[re].m(_,null);append(_,G),Y=!0},p(ee,ne){if(ne[0]&2621504){Q=ee[6][ee[57]][ee[55]];let re;for(re=0;re<Q.length;re+=1){const se=get_each_context_7(ee,Q,re);Z[re]?(Z[re].p(se,ne),transition_in(Z[re],1)):(Z[re]=create_each_block_7(se),Z[re].c(),transition_in(Z[re],1),Z[re].m(_,G))}for(group_outros(),re=Q.length;re<Z.length;re+=1)te(re);check_outros()}},i(ee){if(!Y){for(let ne=0;ne<Q.length;ne+=1)transition_in(Z[ne]);Y=!0}},o(ee){Z=Z.filter(Boolean);for(let ne=0;ne<Z.length;ne+=1)transition_out(Z[ne]);Y=!1},d(ee){ee&&detach(_),destroy_each(Z,ee)}}}function create_each_block_7(q){let _,M,$,j,z,V,X;M=new OrbitingReplies({props:{doc:q[58].doc}});function G(){return q[42](q[58])}return z=new Icon({props:{replies,phase:1,doc:q[58].doc}}),z.$on("click",G),{c(){_=element("div"),create_component(M.$$.fragment),$=space(),j=element("div"),create_component(z.$$.fragment),attr(j,"class","orbit-icon svelte-h0jpqy"),attr(_,"id",V=q[55]+q[57]+q[58].doc.textHash+q[58].doc.timestamp),attr(_,"class","orbit-icon-container svelte-h0jpqy")},m(Y,Q){insert(Y,_,Q),mount_component(M,_,null),append(_,$),append(_,j),mount_component(z,j,null),X=!0},p(Y,Q){q=Y;const Z={};Q[0]&64&&(Z.doc=q[58].doc),M.$set(Z);const te={};Q[0]&64&&(te.doc=q[58].doc),z.$set(te),(!X||Q[0]&64&&V!==(V=q[55]+q[57]+q[58].doc.textHash+q[58].doc.timestamp))&&attr(_,"id",V)},i(Y){X||(transition_in(M.$$.fragment,Y),transition_in(z.$$.fragment,Y),X=!0)},o(Y){transition_out(M.$$.fragment,Y),transition_out(z.$$.fragment,Y),X=!1},d(Y){Y&&detach(_),destroy_component(M),destroy_component(z)}}}function create_each_block_6(q,_){let M,$,j,z,V;const X=[create_if_block_12,create_else_block_5],G=[];function Y(Q,Z){return Q[8]?0:1}return $=Y(_),j=G[$]=X[$](_),{key:q,first:null,c(){M=empty(),j.c(),z=empty(),this.first=M},m(Q,Z){insert(Q,M,Z),G[$].m(Q,Z),insert(Q,z,Z),V=!0},p(Q,Z){_=Q;let te=$;$=Y(_),$===te?G[$].p(_,Z):(group_outros(),transition_out(G[te],1,1,()=>{G[te]=null}),check_outros(),j=G[$],j?j.p(_,Z):(j=G[$]=X[$](_),j.c()),transition_in(j,1),j.m(z.parentNode,z))},i(Q){V||(transition_in(j),V=!0)},o(Q){transition_out(j),V=!1},d(Q){Q&&detach(M),G[$].d(Q),Q&&detach(z)}}}function create_each_block_5(q,_){let M,$=[],j=new Map,z,V,X={length:_[19][1]};const G=Y=>Y[57];for(let Y=0;Y<X.length;Y+=1){let Q=get_each_context_6(_,X,Y),Z=G(Q);j.set(Z,$[Y]=create_each_block_6(Z,Q))}return{key:q,first:null,c(){M=empty();for(let Y=0;Y<$.length;Y+=1)$[Y].c();z=empty(),this.first=M},m(Y,Q){insert(Y,M,Q);for(let Z=0;Z<$.length;Z+=1)$[Z].m(Y,Q);insert(Y,z,Q),V=!0},p(Y,Q){_=Y,Q[0]&2621888&&(X={length:_[19][1]},group_outros(),$=update_keyed_each($,Q,G,1,_,X,j,z.parentNode,outro_and_destroy_block,create_each_block_6,z,get_each_context_6),check_outros())},i(Y){if(!V){for(let Q=0;Q<X.length;Q+=1)transition_in($[Q]);V=!0}},o(Y){for(let Q=0;Q<$.length;Q+=1)transition_out($[Q]);V=!1},d(Y){Y&&detach(M);for(let Q=0;Q<$.length;Q+=1)$[Q].d(Y);Y&&detach(z)}}}function create_else_block_1$1(q){let _,M,$=q[7].find(z),j;function z(...Q){return q[32](q[55],q[57],...Q)}function V(Q,Z){if(Q[55]===0)return create_if_block_9;if(Q[57]===0)return create_if_block_11}let X=V(q),G=X&&X(q),Y=$&&create_if_block_5(q);return{c(){_=element("div"),G&&G.c(),M=space(),Y&&Y.c(),attr(_,"class","grid-cell svelte-h0jpqy")},m(Q,Z){insert(Q,_,Z),G&&G.m(_,null),append(_,M),Y&&Y.m(_,null),j=!0},p(Q,Z){q=Q,G&&G.p(q,Z),Z[0]&128&&($=q[7].find(z)),$?Y?(Y.p(q,Z),Z[0]&128&&transition_in(Y,1)):(Y=create_if_block_5(q),Y.c(),transition_in(Y,1),Y.m(_,null)):Y&&(group_outros(),transition_out(Y,1,1,()=>{Y=null}),check_outros())},i(Q){j||(transition_in(Y),j=!0)},o(Q){transition_out(Y),j=!1},d(Q){Q&&detach(_),G&&G.d(),Y&&Y.d()}}}function create_if_block_2$7(q){let _,M,$=q[6][q[57]][q[55]]&&q[6][q[57]][q[55]].length>0&&create_if_block_3$4(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,z){j[6][j[57]][j[55]]&&j[6][j[57]][j[55]].length>0?$?($.p(j,z),z[0]&64&&transition_in($,1)):($=create_if_block_3$4(j),$.c(),transition_in($,1),$.m(_.parentNode,_)):$&&(group_outros(),transition_out($,1,1,()=>{$=null}),check_outros())},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function create_if_block_11(q){let _,M=q[55]+1+"",$;return{c(){_=element("p"),$=text(M),attr(_,"class","text-left text-xl")},m(j,z){insert(j,_,z),append(_,$)},p:noop,d(j){j&&detach(_)}}}function create_if_block_9(q){let _,M=mapNumberToLetter(q[57])+"",$,j,z,V=q[57]===0&&create_if_block_10(q);return{c(){_=element("p"),$=text(M),j=space(),V&&V.c(),z=empty(),attr(_,"class","text-xl")},m(X,G){insert(X,_,G),append(_,$),insert(X,j,G),V&&V.m(X,G),insert(X,z,G)},p(X,G){X[57]===0&&V.p(X,G)},d(X){X&&detach(_),X&&detach(j),V&&V.d(X),X&&detach(z)}}}function create_if_block_10(q){let _,M=q[55]+1+"",$;return{c(){_=element("p"),$=text(M),attr(_,"class","text-left text-xl")},m(j,z){insert(j,_,z),append(_,$)},p:noop,d(j){j&&detach(_)}}}function create_if_block_5(q){let _=[],M=new Map,$,j;function z(...G){return q[39](q[55],q[57],...G)}let V=q[7].filter(z);const X=G=>G[61].textHash+G[61].timestamp;for(let G=0;G<V.length;G+=1){let Y=get_each_context_4(q,V,G),Q=X(Y);M.set(Q,_[G]=create_each_block_4(Q,Y))}return{c(){for(let G=0;G<_.length;G+=1)_[G].c();$=empty()},m(G,Y){for(let Q=0;Q<_.length;Q+=1)_[Q].m(G,Y);insert(G,$,Y),j=!0},p(G,Y){q=G,Y[0]&3670144&&(V=q[7].filter(z),group_outros(),_=update_keyed_each(_,Y,X,1,q,V,M,$.parentNode,outro_and_destroy_block,create_each_block_4,$,get_each_context_4),check_outros())},i(G){if(!j){for(let Y=0;Y<V.length;Y+=1)transition_in(_[Y]);j=!0}},o(G){for(let Y=0;Y<_.length;Y+=1)transition_out(_[Y]);j=!1},d(G){for(let Y=0;Y<_.length;Y+=1)_[Y].d(G);G&&detach($)}}}function create_else_block_3(q){let _,M,$,j,z;_=new OrbitingReplies({props:{doc:q[61]}});function V(){return q[41](q[61])}return j=new Icon({props:{replies,phase:q[50],doc:q[61]}}),j.$on("click",V),{c(){create_component(_.$$.fragment),M=space(),$=element("div"),create_component(j.$$.fragment),attr($,"class","orbit-icon svelte-h0jpqy")},m(X,G){mount_component(_,X,G),insert(X,M,G),insert(X,$,G),mount_component(j,$,null),z=!0},p(X,G){q=X;const Y={};G[0]&128&&(Y.doc=q[61]),_.$set(Y);const Q={};G[0]&128&&(Q.doc=q[61]),j.$set(Q)},i(X){z||(transition_in(_.$$.fragment,X),transition_in(j.$$.fragment,X),z=!0)},o(X){transition_out(_.$$.fragment,X),transition_out(j.$$.fragment,X),z=!1},d(X){destroy_component(_,X),X&&detach(M),X&&detach($),destroy_component(j)}}}function create_if_block_8(q){let _,M,$,j,z;return _=new OrbitingReplies({props:{doc:q[61],disabled:!0}}),j=new Icon({props:{replies,phase:q[50],doc:q[61],disabled:!0}}),{c(){create_component(_.$$.fragment),M=space(),$=element("div"),create_component(j.$$.fragment),attr($,"class","orbit-icon svelte-h0jpqy")},m(V,X){mount_component(_,V,X),insert(V,M,X),insert(V,$,X),mount_component(j,$,null),z=!0},p(V,X){const G={};X[0]&128&&(G.doc=V[61]),_.$set(G);const Y={};X[0]&128&&(Y.doc=V[61]),j.$set(Y)},i(V){z||(transition_in(_.$$.fragment,V),transition_in(j.$$.fragment,V),z=!0)},o(V){transition_out(_.$$.fragment,V),transition_out(j.$$.fragment,V),z=!1},d(V){destroy_component(_,V),V&&detach(M),V&&detach($),destroy_component(j)}}}function create_if_block_6(q){let _,M,$,j;const z=[create_if_block_7,create_else_block_2],V=[];function X(G,Y){return G[20]<G[61].deleteAfter-G[50]?1:0}return _=X(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(G,Y){V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,Y){let Q=_;_=X(G),_===Q?V[_].p(G,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){V[_].d(G),G&&detach($)}}}function create_else_block_2(q){let _,M,$,j,z;_=new OrbitingReplies({props:{doc:q[61]}});function V(){return q[40](q[61])}return j=new Icon({props:{replies,phase:q[50],doc:q[61]}}),j.$on("click",V),{c(){create_component(_.$$.fragment),M=space(),$=element("div"),create_component(j.$$.fragment),attr($,"class","orbit-icon svelte-h0jpqy")},m(X,G){mount_component(_,X,G),insert(X,M,G),insert(X,$,G),mount_component(j,$,null),z=!0},p(X,G){q=X;const Y={};G[0]&128&&(Y.doc=q[61]),_.$set(Y);const Q={};G[0]&128&&(Q.doc=q[61]),j.$set(Q)},i(X){z||(transition_in(_.$$.fragment,X),transition_in(j.$$.fragment,X),z=!0)},o(X){transition_out(_.$$.fragment,X),transition_out(j.$$.fragment,X),z=!1},d(X){destroy_component(_,X),X&&detach(M),X&&detach($),destroy_component(j)}}}function create_if_block_7(q){let _,M,$,j,z;return _=new OrbitingReplies({props:{doc:q[61],disabled:!0}}),j=new Icon({props:{replies,phase:q[50],doc:q[61],disabled:!0}}),{c(){create_component(_.$$.fragment),M=space(),$=element("div"),create_component(j.$$.fragment),attr($,"class","orbit-icon svelte-h0jpqy")},m(V,X){mount_component(_,V,X),insert(V,M,X),insert(V,$,X),mount_component(j,$,null),z=!0},p(V,X){const G={};X[0]&128&&(G.doc=V[61]),_.$set(G);const Y={};X[0]&128&&(Y.doc=V[61]),j.$set(Y)},i(V){z||(transition_in(_.$$.fragment,V),transition_in(j.$$.fragment,V),z=!0)},o(V){transition_out(_.$$.fragment,V),transition_out(j.$$.fragment,V),z=!1},d(V){destroy_component(_,V),V&&detach(M),V&&detach($),destroy_component(j)}}}function create_each_block_4(q,_){let M,$,j,z,V;const X=[create_if_block_6,create_if_block_8,create_else_block_3],G=[];function Y(Q,Z){return Q[50]==LUNAR_PHASE[0]?0:Q[20]<Q[61].deleteAfter-Q[50]&&Q[20]>Q[61].deleteAfter-(Q[50]+63936e7)?2:1}return $=Y(_),j=G[$]=X[$](_),{key:q,first:null,c(){M=element("div"),j.c(),attr(M,"id",z=_[61].textHash+_[61].timestamp),attr(M,"class","orbit-icon-container svelte-h0jpqy"),this.first=M},m(Q,Z){insert(Q,M,Z),G[$].m(M,null),V=!0},p(Q,Z){_=Q;let te=$;$=Y(_),$===te?G[$].p(_,Z):(group_outros(),transition_out(G[te],1,1,()=>{G[te]=null}),check_outros(),j=G[$],j?j.p(_,Z):(j=G[$]=X[$](_),j.c()),transition_in(j,1),j.m(M,null)),(!V||Z[0]&128&&z!==(z=_[61].textHash+_[61].timestamp))&&attr(M,"id",z)},i(Q){V||(transition_in(j),V=!0)},o(Q){transition_out(j),V=!1},d(Q){Q&&detach(M),G[$].d()}}}function create_if_block_3$4(q){let _,M=q[55]+"",$,j,z=q[57]+"",V,X,G,Y=q[6][q[57]][q[55]],Q=[];for(let te=0;te<Y.length;te+=1)Q[te]=create_each_block_3(get_each_context_3(q,Y,te));const Z=te=>transition_out(Q[te],1,1,()=>{Q[te]=null});return{c(){_=element("div"),$=text(M),j=text(","),V=text(z),X=space();for(let te=0;te<Q.length;te+=1)Q[te].c();attr(_,"id",`phase${q[52]}_cell_${q[55]}_${q[57]}`),attr(_,"class","grid-cell svelte-h0jpqy")},m(te,ee){insert(te,_,ee),append(_,$),append(_,j),append(_,V),append(_,X);for(let ne=0;ne<Q.length;ne+=1)Q[ne].m(_,null);G=!0},p(te,ee){if(ee[0]&2621504){Y=te[6][te[57]][te[55]];let ne;for(ne=0;ne<Y.length;ne+=1){const re=get_each_context_3(te,Y,ne);Q[ne]?(Q[ne].p(re,ee),transition_in(Q[ne],1)):(Q[ne]=create_each_block_3(re),Q[ne].c(),transition_in(Q[ne],1),Q[ne].m(_,null))}for(group_outros(),ne=Y.length;ne<Q.length;ne+=1)Z(ne);check_outros()}},i(te){if(!G){for(let ee=0;ee<Y.length;ee+=1)transition_in(Q[ee]);G=!0}},o(te){Q=Q.filter(Boolean);for(let ee=0;ee<Q.length;ee+=1)transition_out(Q[ee]);G=!1},d(te){te&&detach(_),destroy_each(Q,te)}}}function create_else_block$1(q){let _,M,$,j,z;return _=new OrbitingReplies({props:{doc:q[58].doc,disabled:!0}}),j=new Icon({props:{replies,phase:q[50],doc:q[58].doc,disabled:!0}}),{c(){create_component(_.$$.fragment),M=space(),$=element("div"),create_component(j.$$.fragment),attr($,"class","orbit-icon svelte-h0jpqy")},m(V,X){mount_component(_,V,X),insert(V,M,X),insert(V,$,X),mount_component(j,$,null),z=!0},p(V,X){const G={};X[0]&64&&(G.doc=V[58].doc),_.$set(G);const Y={};X[0]&64&&(Y.doc=V[58].doc),j.$set(Y)},i(V){z||(transition_in(_.$$.fragment,V),transition_in(j.$$.fragment,V),z=!0)},o(V){transition_out(_.$$.fragment,V),transition_out(j.$$.fragment,V),z=!1},d(V){destroy_component(_,V),V&&detach(M),V&&detach($),destroy_component(j)}}}function create_if_block_4$1(q){let _,M,$,j,z;_=new OrbitingReplies({props:{doc:q[58].doc}});function V(){return q[38](q[58])}return j=new Icon({props:{replies,phase:q[52],doc:q[58].doc}}),j.$on("click",V),{c(){create_component(_.$$.fragment),M=space(),$=element("div"),create_component(j.$$.fragment),attr($,"class","orbit-icon svelte-h0jpqy")},m(X,G){mount_component(_,X,G),insert(X,M,G),insert(X,$,G),mount_component(j,$,null),z=!0},p(X,G){q=X;const Y={};G[0]&64&&(Y.doc=q[58].doc),_.$set(Y);const Q={};G[0]&64&&(Q.doc=q[58].doc),j.$set(Q)},i(X){z||(transition_in(_.$$.fragment,X),transition_in(j.$$.fragment,X),z=!0)},o(X){transition_out(_.$$.fragment,X),transition_out(j.$$.fragment,X),z=!1},d(X){destroy_component(_,X),X&&detach(M),X&&detach($),destroy_component(j)}}}function create_each_block_3(q){let _,M,$,j,z;const V=[create_if_block_4$1,create_else_block$1],X=[];function G(Y,Q){return Y[58].lunarPhase===Y[52]?0:1}return M=G(q),$=X[M]=V[M](q),{c(){_=element("div"),$.c(),attr(_,"id",j=q[55]+q[57]+q[58].doc.textHash+q[58].doc.timestamp),attr(_,"class","orbit-icon-container svelte-h0jpqy")},m(Y,Q){insert(Y,_,Q),X[M].m(_,null),z=!0},p(Y,Q){let Z=M;M=G(Y),M===Z?X[M].p(Y,Q):(group_outros(),transition_out(X[Z],1,1,()=>{X[Z]=null}),check_outros(),$=X[M],$?$.p(Y,Q):($=X[M]=V[M](Y),$.c()),transition_in($,1),$.m(_,null)),(!z||Q[0]&64&&j!==(j=Y[55]+Y[57]+Y[58].doc.textHash+Y[58].doc.timestamp))&&attr(_,"id",j)},i(Y){z||(transition_in($),z=!0)},o(Y){transition_out($),z=!1},d(Y){Y&&detach(_),X[M].d()}}}function create_each_block_2(q,_){let M,$,j,z,V;const X=[create_if_block_2$7,create_else_block_1$1],G=[];function Y(Q,Z){return Q[8]?0:1}return $=Y(_),j=G[$]=X[$](_),{key:q,first:null,c(){M=empty(),j.c(),z=empty(),this.first=M},m(Q,Z){insert(Q,M,Z),G[$].m(Q,Z),insert(Q,z,Z),V=!0},p(Q,Z){_=Q;let te=$;$=Y(_),$===te?G[$].p(_,Z):(group_outros(),transition_out(G[te],1,1,()=>{G[te]=null}),check_outros(),j=G[$],j?j.p(_,Z):(j=G[$]=X[$](_),j.c()),transition_in(j,1),j.m(z.parentNode,z))},i(Q){V||(transition_in(j),V=!0)},o(Q){transition_out(j),V=!1},d(Q){Q&&detach(M),G[$].d(Q),Q&&detach(z)}}}function create_each_block_1$1(q,_){let M,$=[],j=new Map,z,V,X={length:_[19][1]};const G=Y=>Y[57];for(let Y=0;Y<X.length;Y+=1){let Q=get_each_context_2(_,X,Y),Z=G(Q);j.set(Z,$[Y]=create_each_block_2(Z,Q))}return{key:q,first:null,c(){M=empty();for(let Y=0;Y<$.length;Y+=1)$[Y].c();z=empty(),this.first=M},m(Y,Q){insert(Y,M,Q);for(let Z=0;Z<$.length;Z+=1)$[Z].m(Y,Q);insert(Y,z,Q),V=!0},p(Y,Q){_=Y,Q[0]&3670464&&(X={length:_[19][1]},group_outros(),$=update_keyed_each($,Q,G,1,_,X,j,z.parentNode,outro_and_destroy_block,create_each_block_2,z,get_each_context_2),check_outros())},i(Y){if(!V){for(let Q=0;Q<X.length;Q+=1)transition_in($[Q]);V=!0}},o(Y){for(let Q=0;Q<$.length;Q+=1)transition_out($[Q]);V=!1},d(Y){Y&&detach(M);for(let Q=0;Q<$.length;Q+=1)$[Q].d(Y);Y&&detach(z)}}}function create_each_block$5(q,_){let M,$=[],j=new Map,z,V,X={length:_[19][0]};const G=Y=>Y[55];for(let Y=0;Y<X.length;Y+=1){let Q=get_each_context_1$1(_,X,Y),Z=G(Q);j.set(Z,$[Y]=create_each_block_1$1(Z,Q))}return{key:q,first:null,c(){M=element("div");for(let Y=0;Y<$.length;Y+=1)$[Y].c();attr(M,"id",`section${_[52]}`),attr(M,"class","my-grid-container w-screen svelte-h0jpqy"),attr(M,"style",z=`background-color: ${COLOR_CYCLE[_[52]]}; ${_[8]?"grid-template-columns: repeat(3, 1fr); grid-template-rows: auto;":`grid-template-columns: ${_[16]}; grid-template-rows: ${_[17]};`}`),this.first=M},m(Y,Q){insert(Y,M,Q);for(let Z=0;Z<$.length;Z+=1)$[Z].m(M,null);V=!0},p(Y,Q){_=Y,Q[0]&3670464&&(X={length:_[19][0]},group_outros(),$=update_keyed_each($,Q,G,1,_,X,j,M,outro_and_destroy_block,create_each_block_1$1,null,get_each_context_1$1),check_outros()),(!V||Q[0]&196864&&z!==(z=`background-color: ${COLOR_CYCLE[_[52]]}; ${_[8]?"grid-template-columns: repeat(3, 1fr); grid-template-rows: auto;":`grid-template-columns: ${_[16]}; grid-template-rows: ${_[17]};`}`))&&attr(M,"style",z)},i(Y){if(!V){for(let Q=0;Q<X.length;Q+=1)transition_in($[Q]);V=!0}},o(Y){for(let Q=0;Q<$.length;Q+=1)transition_out($[Q]);V=!1},d(Y){Y&&detach(M);for(let Q=0;Q<$.length;Q+=1)$[Q].d()}}}function create_fragment$e(q){let _,M,$,j,z,V=q[3]?`${q[12]}, ${q[11]} `:"",X,G,Y,Q,Z,te,ee,ne,re,se,ie,oe,he,le,ae,ue,me,fe=q[0]&&create_if_block_23(q),ce=q[3]&&create_if_block_22(q);function _e(xe,He){return xe[10]?create_if_block_21:create_else_block_6}let we=_e(q),ge=we(q);const Ae=[create_if_block_18,create_if_block_19,create_if_block_20],de=[];function De(xe,He){return xe[3]?0:xe[10]?xe[13]?2:-1:1}~(ne=De(q))&&(re=de[ne]=Ae[ne](q));const Me=[create_if_block$8,create_if_block_1$8,create_else_block_4],Ee=[];function Te(xe,He){return He[0]&32&&(oe=null),xe[7].length===0?0:(oe==null&&(oe=!!xe[5].includes("commons")),oe?1:2)}return he=Te(q,[-1,-1,-1]),le=Ee[he]=Me[he](q),{c(){_=element("div"),fe&&fe.c(),M=space(),$=element("div"),j=element("div"),z=element("p"),X=text(V),G=space(),ce&&ce.c(),Y=space(),Q=element("button"),ge.c(),Z=space(),te=element("div"),ee=element("div"),re&&re.c(),se=space(),ie=element("div"),le.c(),attr(_,"class","w-screen flex flex-row justify-end h-[10vh]"),attr(z,"class","text-left text-xl font-bold mb-2"),attr(Q,"class","my-6"),attr(j,"class","mx-1 mt-[-10vh] sm:mt-10 sm:w-1/5 side-bar flex flex-row sm:flex-col p-8 h-auto sm:h-[80vh] fixed z-50"),set_style(j,"background-color",q[9]),set_style(j,"transition","background-color 1s ease"),attr(ie,"class","flex flex-col w-auto"),attr(ee,"class","my-grid-container-wrapper svelte-h0jpqy"),attr(te,"class","w-full sm:w-[80vw] mt-16 sm:mt-10 sm:ml-[20vw]"),attr($,"class","the-scroll flex flex-row sm:flex-col min-h-screen overflow-y-auto svelte-h0jpqy")},m(xe,He){insert(xe,_,He),fe&&fe.m(_,null),insert(xe,M,He),insert(xe,$,He),append($,j),append(j,z),append(z,X),append(j,G),ce&&ce.m(j,null),append(j,Y),append(j,Q),ge.m(Q,null),append($,Z),append($,te),append(te,ee),~ne&&de[ne].m(ee,null),append(ee,se),append(ee,ie),Ee[he].m(ie,null),ae=!0,ue||(me=[listen(_,"click",q[34]),listen(_,"keydown",q[25]),listen(Q,"click",q[23])],ue=!0)},p(xe,He){xe[0]?fe?fe.p(xe,He):(fe=create_if_block_23(xe),fe.c(),fe.m(_,null)):fe&&(fe.d(1),fe=null),(!ae||He[0]&6152)&&V!==(V=xe[3]?`${xe[12]}, ${xe[11]} `:"")&&set_data(X,V),xe[3]?ce?(ce.p(xe,He),He[0]&8&&transition_in(ce,1)):(ce=create_if_block_22(xe),ce.c(),transition_in(ce,1),ce.m(j,Y)):ce&&(group_outros(),transition_out(ce,1,1,()=>{ce=null}),check_outros()),we!==(we=_e(xe))&&(ge.d(1),ge=we(xe),ge&&(ge.c(),ge.m(Q,null))),(!ae||He[0]&512)&&set_style(j,"background-color",xe[9]);let Oe=ne;ne=De(xe),ne===Oe?~ne&&de[ne].p(xe,He):(re&&(group_outros(),transition_out(de[Oe],1,1,()=>{de[Oe]=null}),check_outros()),~ne?(re=de[ne],re?re.p(xe,He):(re=de[ne]=Ae[ne](xe),re.c()),transition_in(re,1),re.m(ee,se)):re=null);let $e=he;he=Te(xe,He),he===$e?Ee[he].p(xe,He):(group_outros(),transition_out(Ee[$e],1,1,()=>{Ee[$e]=null}),check_outros(),le=Ee[he],le?le.p(xe,He):(le=Ee[he]=Me[he](xe),le.c()),transition_in(le,1),le.m(ie,null))},i(xe){ae||(transition_in(ce),transition_in(re),transition_in(le),ae=!0)},o(xe){transition_out(ce),transition_out(re),transition_out(le),ae=!1},d(xe){xe&&detach(_),fe&&fe.d(),xe&&detach(M),xe&&detach($),ce&&ce.d(),ge.d(),~ne&&de[ne].d(),Ee[he].d(),ue=!1,run_all(me)}}}let replies=!1;function mapNumberToLetter(q){return String.fromCharCode(65+q)}function instance$c(q,_,M){let $,j,z;component_subscribe(q,cacheDetails,Ce=>M(46,$=Ce)),component_subscribe(q,time,Ce=>M(47,j=Ce)),component_subscribe(q,authorKeypair,Ce=>M(18,z=Ce));const V=createEventDispatcher();let X=get_store_value(shareKeypair).shareAddress;shareKeypair.subscribe(Ce=>{M(5,X=Ce.shareAddress)});let{showDetails:G=!0}=_,{IDcreated:Y=!1}=_,{attachment:Q=!0}=_,{isReply:Z=!1}=_,te=[6,9],ee=Array(te[0]).fill().map(()=>Array(te[1]).fill(!1)),ne=[],re=j.getTime()*1e3,se=!1,ie,oe=COLOR_CYCLE[0];function he(){disconnectObserver(ie);let Ce;window.innerWidth<=768?Ce=.45:Ce=.5,ie=createObserver(Ge=>{Ge.forEach(rt=>{if(rt.isIntersecting){let ct=parseInt(rt.target.getAttribute("id").replace("section",""));M(9,oe=COLOR_CYCLE[ct%COLOR_CYCLE.length])}})},Ce)}afterUpdate(()=>{LUNAR_PHASE.forEach((Ce,Ie)=>{const Ge=document.querySelector(`#section${Ie}`);observeElement(ie,Ge)})}),onDestroy(()=>{disconnectObserver(ie)});let le=!0,ae=null,ue,me,fe,ce,_e=!1,we=null,ge=[0,0],Ae,de;cacheDetails.subscribe(Ce=>{console.log("Cache details changed:",Ce)});function De(Ce){M(3,ae=Ce),console.log("selecteddoc",Ce)}const Me=async()=>{M(7,ne=$.queryDocs({filter:{pathStartsWith:"/documents"}})),M(7,ne=ne.filter(Ce=>Ce.path.split("/").length<=6)),console.log("Docs",ne),M(6,ee=calculateLunarPhase(ne))};$.onCacheUpdated(()=>{Me()}),onMount(()=>{Me()});function Ee(){M(10,le=!le),M(3,ae=null)}function Te(){V("toggle")}function xe(Ce){Ce.key==="Escape"&&M(3,ae=null)}function He(Ce){M(13,_e=!0),M(10,le=!0),M(3,ae=null),M(14,we=Ce.detail.type),M(15,ge=Ce.detail.location),console.log("filetype",we),console.log("xy",ge)}function Oe(){M(13,_e=!1),M(10,le=!0),M(3,ae=null),M(14,we=null),M(15,ge=[0,0])}function $e(){M(13,_e=!1),M(10,le=!0),M(3,ae=null),M(14,we=null),M(15,ge=[0,0])}let Pe;onMount(()=>{M(4,Pe=window.innerWidth),window.addEventListener("resize",()=>{M(4,Pe=window.innerWidth)})});const ve=(Ce,Ie,Ge)=>parseInt(Ge.path.split("/")[2])==Ce&&parseInt(Ge.path.split("/")[3])==Ie,ye=(Ce,Ie,Ge)=>parseInt(Ge.path.split("/")[2])==Ce&&parseInt(Ge.path.split("/")[3])==Ie,Fe=()=>M(3,ae=null),je=()=>M(3,ae=null),Be=()=>M(10,le=!le),Ne=()=>M(10,le=!le),ze=Ce=>De(Ce.doc),Ze=(Ce,Ie,Ge)=>parseInt(Ge.path.split("/")[2])==Ce&&parseInt(Ge.path.split("/")[3])==Ie,ut=Ce=>De(Ce),ot=Ce=>De(Ce),pe=Ce=>De(Ce.doc),We=(Ce,Ie,Ge)=>parseInt(Ge.path.split("/")[2])==Ce&&parseInt(Ge.path.split("/")[3])==Ie,Qe=Ce=>De(Ce);return q.$$set=Ce=>{"showDetails"in Ce&&M(29,G=Ce.showDetails),"IDcreated"in Ce&&M(0,Y=Ce.IDcreated),"attachment"in Ce&&M(1,Q=Ce.attachment),"isReply"in Ce&&M(2,Z=Ce.isReply)},q.$$.update=()=>{if(q.$$.dirty[0]&1073741832|q.$$.dirty[1]&1&&ae){let Ce=ae.path.split("/");M(30,ue=Ce[2]),M(31,me=Ce[3]),M(11,fe=Number(ue)+1),M(12,ce=mapNumberToLetter(Number(me)))}q.$$.dirty[0]&16&&(Pe<=768?(M(8,se=!0),M(16,Ae="repeat(3, minmax(min-content, 1fr))"),M(17,de="repeat(18, minmax(min-content, 1fr))")):(M(8,se=!1),M(16,Ae="repeat("+te[1]+", minmax(min-content, 1fr))"),M(17,de="repeat("+te[0]+", minmax(min-content, 1fr))")),he())},M(4,Pe=window.innerWidth),[Y,Q,Z,ae,Pe,X,ee,ne,se,oe,le,fe,ce,_e,we,ge,Ae,de,z,te,re,De,Me,Ee,Te,xe,He,Oe,$e,G,ue,me,ve,ye,Fe,je,Be,Ne,ze,Ze,ut,ot,pe,We,Qe]}class GridView extends SvelteComponent{constructor(_){super(),init(this,_,instance$c,create_fragment$e,safe_not_equal,{showDetails:29,IDcreated:0,attachment:1,isReply:2},null,[-1,-1,-1])}}const StatusPanel_svelte_svelte_type_style_lang="";function get_each_context$4(q,_,M){const $=q.slice();return $[10]=_[M],$}function get_each_context_1(q,_,M){const $=q.slice();return $[13]=_[M],$[15]=M,$}function create_if_block_2$6(q){let _,M,$,j,z,V=[],X=new Map,G=settings.servers;const Y=Q=>Q[15];for(let Q=0;Q<G.length;Q+=1){let Z=get_each_context_1(q,G,Q),te=Y(Z);X.set(te,V[Q]=create_each_block_1(te,Z))}return{c(){_=element("div"),M=element("p"),$=element("b"),$.textContent=`${settings.servers.length===1?"Server:":`${settings.servers.length} Servers:`}`,j=space(),z=element("ul");for(let Q=0;Q<V.length;Q+=1)V[Q].c();attr(M,"class","svelte-1vxr72o")},m(Q,Z){insert(Q,_,Z),append(_,M),append(M,$),append(_,j),append(_,z);for(let te=0;te<V.length;te+=1)V[te].m(z,null)},p(Q,Z){Z&0&&(G=settings.servers,V=update_keyed_each(V,Z,Y,1,Q,G,X,z,destroy_block,create_each_block_1,null,get_each_context_1))},d(Q){Q&&detach(_);for(let Z=0;Z<V.length;Z+=1)V[Z].d()}}}function create_each_block_1(q,_){let M,$=_[13]+"",j;return{key:q,first:null,c(){M=element("li"),j=text($),this.first=M},m(z,V){insert(z,M,V),append(M,j)},p(z,V){_=z},d(z){z&&detach(M)}}}function create_if_block$7(q){let _,M,$,j,z,V=q[1].status+"",X,G,Y,Q,Z,te,ee,ne,re,se,ie,oe,he,le,ae,ue,me,fe,ce,_e,we,ge,Ae,de,De,Me,Ee=q[6]&&create_if_block_1$7(q);return{c(){_=element("div"),M=element("div"),$=element("h4"),j=text("Status: "),z=element("strong"),X=text(V),G=space(),Y=element("h4"),Q=text("Share "),Z=element("strong"),te=text(q[7]),ee=space(),ne=element("div"),re=element("h4"),re.textContent="Documents",se=space(),ie=element("p"),oe=element("strong"),he=text(q[3]),le=text(" documents sent"),ae=space(),ue=element("p"),me=element("strong"),fe=text(q[4]),ce=text(" documents received"),_e=space(),we=element("p"),ge=element("strong"),Ae=text(q[5]),de=text(" documents requested"),De=space(),Ee&&Ee.c(),Me=empty(),attr(M,"class","flex-col py-4"),attr(ie,"class","svelte-1vxr72o"),attr(ue,"class","svelte-1vxr72o"),attr(we,"class","svelte-1vxr72o"),attr(ne,"class","flex-col items-center py-4"),attr(_,"class","flex flex-col")},m(Te,xe){insert(Te,_,xe),append(_,M),append(M,$),append($,j),append($,z),append(z,X),append(M,G),append(M,Y),append(Y,Q),append(Y,Z),append(Z,te),append(_,ee),append(_,ne),append(ne,re),append(ne,se),append(ne,ie),append(ie,oe),append(oe,he),append(ie,le),append(ne,ae),append(ne,ue),append(ue,me),append(me,fe),append(ue,ce),append(ne,_e),append(ne,we),append(we,ge),append(ge,Ae),append(we,de),insert(Te,De,xe),Ee&&Ee.m(Te,xe),insert(Te,Me,xe)},p(Te,xe){xe&2&&V!==(V=Te[1].status+"")&&set_data(X,V),xe&128&&set_data(te,Te[7]),xe&8&&set_data(he,Te[3]),xe&16&&set_data(fe,Te[4]),xe&32&&set_data(Ae,Te[5]),Te[6]?Ee?Ee.p(Te,xe):(Ee=create_if_block_1$7(Te),Ee.c(),Ee.m(Me.parentNode,Me)):Ee&&(Ee.d(1),Ee=null)},d(Te){Te&&detach(_),Te&&detach(De),Ee&&Ee.d(Te),Te&&detach(Me)}}}function create_if_block_1$7(q){let _,M=q[2].length+"",$,j,z=q[2]>1?"Attachments":"Attachment",V,X,G,Y=[],Q=new Map,Z=q[2];const te=ee=>ee[10].hash;for(let ee=0;ee<Z.length;ee+=1){let ne=get_each_context$4(q,Z,ee),re=te(ne);Q.set(re,Y[ee]=create_each_block$4(re,ne))}return{c(){_=element("h4"),$=text(M),j=space(),V=text(z),X=space(),G=element("div");for(let ee=0;ee<Y.length;ee+=1)Y[ee].c();attr(_,"class","py-4"),attr(G,"class","flex flex-col py-4 h-50vh overflow-y-scroll svelte-1vxr72o")},m(ee,ne){insert(ee,_,ne),append(_,$),append(_,j),append(_,V),insert(ee,X,ne),insert(ee,G,ne);for(let re=0;re<Y.length;re+=1)Y[re].m(G,null)},p(ee,ne){ne&4&&M!==(M=ee[2].length+"")&&set_data($,M),ne&4&&z!==(z=ee[2]>1?"Attachments":"Attachment")&&set_data(V,z),ne&4&&(Z=ee[2],Y=update_keyed_each(Y,ne,te,1,ee,Z,Q,G,destroy_block,create_each_block$4,null,get_each_context$4))},d(ee){ee&&detach(_),ee&&detach(X),ee&&detach(G);for(let ne=0;ne<Y.length;ne+=1)Y[ne].d()}}}function create_each_block$4(q,_){let M,$,j,z=_[10].kind+"",V,X,G,Y=_[10].status+"",Q,Z,te,ee,ne,re=_[10].bytesLoaded+"",se,ie,oe,he,le,ae=_[10].totalBytes+"",ue,me,fe,ce,_e,we=_[10].author.slice(0,9)+"",ge,Ae,de;return{key:q,first:null,c(){M=element("div"),$=element("h5"),j=element("span"),V=text(z),X=space(),G=element("strong"),Q=text(Y),Z=space(),te=element("p"),ee=text("Bytes loaded: "),ne=element("strong"),se=text(re),ie=space(),oe=element("p"),he=text("Total bytes: "),le=element("strong"),ue=text(ae),me=space(),fe=element("p"),ce=text("Author: "),_e=element("strong"),ge=text(we),Ae=text("..."),de=space(),attr(j,"class","kind svelte-1vxr72o"),attr(te,"class","svelte-1vxr72o"),attr(oe,"class","svelte-1vxr72o"),attr(fe,"class","svelte-1vxr72o"),this.first=M},m(De,Me){insert(De,M,Me),append(M,$),append($,j),append(j,V),append($,X),append($,G),append(G,Q),append(M,Z),append(M,te),append(te,ee),append(te,ne),append(ne,se),append(M,ie),append(M,oe),append(oe,he),append(oe,le),append(le,ue),append(M,me),append(M,fe),append(fe,ce),append(fe,_e),append(_e,ge),append(_e,Ae),append(M,de)},p(De,Me){_=De,Me&4&&z!==(z=_[10].kind+"")&&set_data(V,z),Me&4&&Y!==(Y=_[10].status+"")&&set_data(Q,Y),Me&4&&re!==(re=_[10].bytesLoaded+"")&&set_data(se,re),Me&4&&ae!==(ae=_[10].totalBytes+"")&&set_data(ue,ae),Me&4&&we!==(we=_[10].author.slice(0,9)+"")&&set_data(ge,we)},d(De){De&&detach(M)}}}function create_fragment$d(q){let _,M,$,j,z,V,X,G=q[8].shareAddress+"",Y,Q,Z,te,ee,ne=q[8].secret+"",re,se,ie,oe,he,le,ae,ue=settings.servers.length>0&&create_if_block_2$6(q),me=q[0]!==void 0&&create_if_block$7(q);return le=new DownloadTool({}),{c(){_=element("div"),M=element("div"),$=element("h4"),$.textContent="Status Panel & Current Share Details",j=space(),z=element("p"),V=element("b"),V.textContent="Address:",X=space(),Y=text(G),Q=space(),Z=element("p"),te=element("b"),te.textContent="Secret:",ee=space(),re=text(ne),se=space(),ue&&ue.c(),ie=space(),me&&me.c(),oe=space(),he=element("div"),create_component(le.$$.fragment),attr($,"class","mb-6"),attr(z,"class","svelte-1vxr72o"),attr(Z,"class","svelte-1vxr72o"),attr(M,"class","flex flex-col items-left"),attr(he,"class","my-4"),attr(_,"class","flex flex-col px-8 p-4 w-full text-left")},m(fe,ce){insert(fe,_,ce),append(_,M),append(M,$),append(M,j),append(M,z),append(z,V),append(z,X),append(z,Y),append(M,Q),append(M,Z),append(Z,te),append(Z,ee),append(Z,re),append(_,se),ue&&ue.m(_,null),append(_,ie),me&&me.m(_,null),append(_,oe),append(_,he),mount_component(le,he,null),ae=!0},p(fe,[ce]){(!ae||ce&256)&&G!==(G=fe[8].shareAddress+"")&&set_data(Y,G),(!ae||ce&256)&&ne!==(ne=fe[8].secret+"")&&set_data(re,ne),settings.servers.length>0&&ue.p(fe,ce),fe[0]!==void 0?me?me.p(fe,ce):(me=create_if_block$7(fe),me.c(),me.m(_,oe)):me&&(me.d(1),me=null)},i(fe){ae||(transition_in(le.$$.fragment,fe),ae=!0)},o(fe){transition_out(le.$$.fragment,fe),ae=!1},d(fe){fe&&detach(_),ue&&ue.d(),me&&me.d(),destroy_component(le)}}}function instance$b(q,_,M){let $;component_subscribe(q,shareKeypair,ee=>M(8,$=ee));let{status:j=void 0}=_,z,V,X,G,Y,Q=!1,Z,te;return shareKeypair.subscribe(ee=>{M(9,te=ee.shareAddress),M(7,Z=te.slice(0,8))}),q.$$set=ee=>{"status"in ee&&M(0,j=ee.status)},q.$$.update=()=>{q.$$.dirty&519&&j&&j[te]&&(M(1,z=j[te].docs),M(2,V=j[te].attachments),M(3,X=z.sentCount),M(4,G=z.receivedCount),M(5,Y=z.requestedCount),M(6,Q=V&&V.length>0))},[j,z,V,X,G,Y,Q,Z,$,te]}class StatusPanel extends SvelteComponent{constructor(_){super(),init(this,_,instance$b,create_fragment$d,safe_not_equal,{status:0})}}const AddShare_svelte_svelte_type_style_lang="";function create_if_block_1$6(q){let _,M,$,j,z;return{c(){_=element("input"),M=space(),$=element("button"),$.textContent="Submit address",attr(_,"type","text"),attr(_,"spellcheck","false"),attr(_,"placeholder","Add the secret for this share"),attr(_,"class","svelte-1sh2tfc"),attr($,"class","svelte-1sh2tfc")},m(V,X){insert(V,_,X),set_input_value(_,q[1]),insert(V,M,X),insert(V,$,X),j||(z=[listen(_,"input",q[9]),listen($,"click",q[10])],j=!0)},p(V,X){X&2&&_.value!==V[1]&&set_input_value(_,V[1])},d(V){V&&detach(_),V&&detach(M),V&&detach($),j=!1,run_all(z)}}}function create_if_block$6(q){let _,M,$;return{c(){_=element("p"),M=element("strong"),$=text(q[3])},m(j,z){insert(j,_,z),append(_,M),append(M,$)},p(j,z){z&8&&set_data($,j[3])},d(j){j&&detach(_)}}}function create_fragment$c(q){let _,M,$,j,z,V,X,G,Y,Q,Z=q[4]&&create_if_block_1$6(q),te=q[2]&&create_if_block$6(q);return{c(){_=element("div"),M=element("label"),$=text(`Add an existing share address
    `),j=element("input"),z=space(),V=element("button"),V.textContent="Submit address",X=space(),Z&&Z.c(),G=space(),te&&te.c(),attr(j,"id","shareAddress"),attr(j,"type","text"),attr(j,"spellcheck","false"),attr(j,"placeholder","Add a new share address"),attr(j,"class","svelte-1sh2tfc"),attr(V,"class","svelte-1sh2tfc"),attr(M,"for","shareAddress"),set_style(M,"text-align","left"),attr(_,"class","svelte-1sh2tfc")},m(ee,ne){insert(ee,_,ne),append(_,M),append(M,$),append(M,j),set_input_value(j,q[0]),append(M,z),append(M,V),append(M,X),Z&&Z.m(M,null),append(M,G),te&&te.m(M,null),Y||(Q=[listen(j,"input",q[7]),listen(V,"click",q[8])],Y=!0)},p(ee,[ne]){ne&1&&j.value!==ee[0]&&set_input_value(j,ee[0]),ee[4]?Z?Z.p(ee,ne):(Z=create_if_block_1$6(ee),Z.c(),Z.m(M,G)):Z&&(Z.d(1),Z=null),ee[2]?te?te.p(ee,ne):(te=create_if_block$6(ee),te.c(),te.m(M,null)):te&&(te.d(1),te=null)},i:noop,o:noop,d(ee){ee&&detach(_),Z&&Z.d(),te&&te.d(),Y=!1,run_all(Q)}}}function instance$a(q,_,M){let $;component_subscribe(q,shareKeypair,re=>M(11,$=re));let j,z,V=!1,X,G=!1;function Y(re){if(isErr(checkShareIsValid(re))){M(2,V=!0),M(3,X="Not a valid share address");return}else M(2,V=!1),settings.addShare(re),M(4,G=!0),console.log("You are currently signed in as",settings.author||"no-one!"),console.log("You have",settings.shares.length,"shares"),console.log("Your shares are",settings.shares)}async function Q(){let re={address:j,secret:z};const se=await Crypto.checkKeypairIsValid(re);if(console.log(j,typeof j),console.log(z,typeof z),console.log(se),isErr(se)){M(2,V=!0),M(3,X="Not the right secret for this share.");return}else M(2,V=!1),settings.addSecret(j,z),console.log("You are currently signed in as",settings.author||"no-one!"),console.log("You have",settings.shares.length,"shares"),console.log("Your shares are",settings.shares),console.log("You know the secret to these shares:",settings.shareSecrets)}onMount(()=>{$!==void 0&&(settings.addShare($.shareAddress),settings.addSecret($.shareAddress,$.secret))});function Z(){j=this.value,M(0,j)}const te=()=>Y(j);function ee(){z=this.value,M(1,z)}return[j,z,V,X,G,Y,Q,Z,te,ee,()=>Q()]}class AddShare extends SvelteComponent{constructor(_){super(),init(this,_,instance$a,create_fragment$c,safe_not_equal,{})}}const ShareSwitcher_svelte_svelte_type_style_lang="";function get_each_context$3(q,_,M){const $=q.slice();return $[4]=_[M],$}function create_each_block$3(q,_){let M,$=_[4]+"",j,z;return{key:q,first:null,c(){M=element("option"),j=text($),M.__value=z=_[4],M.value=M.__value,this.first=M},m(V,X){insert(V,M,X),append(M,j)},p(V,X){_=V,X&2&&$!==($=_[4]+"")&&set_data(j,$),X&2&&z!==(z=_[4])&&(M.__value=z,M.value=M.__value)},d(V){V&&detach(M)}}}function create_fragment$b(q){let _,M,$,j,z=[],V=new Map,X,G,Y=q[1];const Q=Z=>Z[4];for(let Z=0;Z<Y.length;Z+=1){let te=get_each_context$3(q,Y,Z),ee=Q(te);V.set(ee,z[Z]=create_each_block$3(ee,te))}return{c(){_=element("div"),M=element("label"),M.textContent="Select Workspace",$=space(),j=element("select");for(let Z=0;Z<z.length;Z+=1)z[Z].c();attr(M,"for","share-switcher"),attr(M,"class","svelte-1k22enp"),attr(j,"id","share-switcher"),attr(j,"class","form-control svelte-1k22enp"),q[0]===void 0&&add_render_callback(()=>q[3].call(j)),attr(_,"class","svelte-1k22enp")},m(Z,te){insert(Z,_,te),append(_,M),append(_,$),append(_,j);for(let ee=0;ee<z.length;ee+=1)z[ee].m(j,null);select_option(j,q[0]),X||(G=[listen(j,"change",q[3]),listen(j,"change",q[2])],X=!0)},p(Z,[te]){te&2&&(Y=Z[1],z=update_keyed_each(z,te,Q,1,Z,Y,V,j,destroy_block,create_each_block$3,null,get_each_context$3)),te&3&&select_option(j,Z[0])},i:noop,o:noop,d(Z){Z&&detach(_);for(let te=0;te<z.length;te+=1)z[te].d();X=!1,run_all(G)}}}function instance$9(q,_,M){let $=get_store_value(shareKeypair).shareAddress;shareKeypair.subscribe(X=>{M(0,$=X.shareAddress)});function j(X){const G=X.target.value,Y=settings.shareSecrets[G];shareKeypair.set({shareAddress:G,secret:Y})}let z=[];shares.subscribe(X=>{M(1,z=[...X])});function V(){$=select_value(this),M(0,$),M(1,z)}return[$,z,j,V]}class ShareSwitcher extends SvelteComponent{constructor(_){super(),init(this,_,instance$9,create_fragment$b,safe_not_equal,{})}}const RemoveShare_svelte_svelte_type_style_lang="";function get_each_context$2(q,_,M){const $=q.slice();return $[5]=_[M],$}function create_each_block$2(q,_){let M,$=_[5]+"",j,z;return{key:q,first:null,c(){M=element("option"),j=text($),M.__value=z=_[5],M.value=M.__value,this.first=M},m(V,X){insert(V,M,X),append(M,j)},p(V,X){_=V,X&4&&$!==($=_[5]+"")&&set_data(j,$),X&4&&z!==(z=_[5])&&(M.__value=z,M.value=M.__value)},d(V){V&&detach(M)}}}function create_fragment$a(q){let _,M,$,j,z=[],V=new Map,X,G,Y,Q,Z,te,ee,ne=q[2];const re=se=>se[5];for(let se=0;se<ne.length;se+=1){let ie=get_each_context$2(q,ne,se),oe=re(ie);V.set(oe,z[se]=create_each_block$2(oe,ie))}return{c(){_=element("div"),M=element("label"),M.textContent="Remove Share / Workspace",$=space(),j=element("select");for(let se=0;se<z.length;se+=1)z[se].c();X=space(),G=element("button"),G.textContent="Remove Share",Y=space(),Q=element("p"),Z=text(q[1]),attr(M,"for","share-switcher"),attr(M,"class","svelte-1i5hrjc"),attr(j,"id","share-selecter"),attr(j,"class","form-control svelte-1i5hrjc"),q[0]===void 0&&add_render_callback(()=>q[4].call(j)),attr(G,"class","svelte-1i5hrjc"),attr(_,"class","svelte-1i5hrjc")},m(se,ie){insert(se,_,ie),append(_,M),append(_,$),append(_,j);for(let oe=0;oe<z.length;oe+=1)z[oe].m(j,null);select_option(j,q[0]),append(_,X),append(_,G),append(_,Y),append(_,Q),append(Q,Z),te||(ee=[listen(j,"change",q[4]),listen(G,"click",q[3])],te=!0)},p(se,[ie]){ie&4&&(ne=se[2],z=update_keyed_each(z,ie,re,1,se,ne,V,j,destroy_block,create_each_block$2,null,get_each_context$2)),ie&5&&select_option(j,se[0]),ie&2&&set_data(Z,se[1])},i:noop,o:noop,d(se){se&&detach(_);for(let ie=0;ie<z.length;ie+=1)z[ie].d();te=!1,run_all(ee)}}}function instance$8(q,_,M){let $;component_subscribe(q,shares,G=>M(2,$=G));let j=get_store_value(shareKeypair).shareAddress,z="";shareKeypair.subscribe(G=>{M(0,j=G.shareAddress)});async function V(){if(!j)return;const G=j;removeShare(G),M(1,z=`Share ${G} has been removed.`),get_store_value(shareKeypair).shareAddress===G&&shareKeypair.set({shareAddress:null,secret:null})}function X(){j=select_value(this),M(0,j)}return[j,z,$,V,X]}class RemoveShare extends SvelteComponent{constructor(_){super(),init(this,_,instance$8,create_fragment$a,safe_not_equal,{})}}const GenerateShare_svelte_svelte_type_style_lang="";function create_if_block_1$5(q){let _,M,$,j,z,V=q[3]&&create_if_block_2$5(q);return{c(){_=element("div"),M=element("p"),M.textContent="Successfully generated new share keypair!",$=space(),V&&V.c(),j=space(),z=element("p"),z.textContent="This new share has been added to your workspace.",attr(_,"class","text-left svelte-1kdn0fs")},m(X,G){insert(X,_,G),append(_,M),append(_,$),V&&V.m(_,null),append(_,j),append(_,z)},p(X,G){X[3]?V?V.p(X,G):(V=create_if_block_2$5(X),V.c(),V.m(_,j)):V&&(V.d(1),V=null)},d(X){X&&detach(_),V&&V.d()}}}function create_if_block$5(q){let _,M,$=q[1].message+"",j;return{c(){_=element("p"),M=text("Error: "),j=text($)},m(z,V){insert(z,_,V),append(_,M),append(_,j)},p(z,V){V&2&&$!==($=z[1].message+"")&&set_data(j,$)},d(z){z&&detach(_)}}}function create_if_block_2$5(q){let _,M=q[3].shareAddress+"",$,j,z,V=q[3].secret+"",X;return{c(){_=element("p"),$=text(M),j=space(),z=element("p"),X=text(V)},m(G,Y){insert(G,_,Y),append(_,$),insert(G,j,Y),insert(G,z,Y),append(z,X)},p(G,Y){Y&8&&M!==(M=G[3].shareAddress+"")&&set_data($,M),Y&8&&V!==(V=G[3].secret+"")&&set_data(X,V)},d(G){G&&detach(_),G&&detach(j),G&&detach(z)}}}function create_fragment$9(q){let _,M,$,j,z,V,X,G,Y,Q;function Z(ne,re){if(ne[1])return create_if_block$5;if(ne[2])return create_if_block_1$5}let te=Z(q),ee=te&&te(q);return{c(){_=element("div"),M=element("label"),$=text(`Generate a new share keypair
    `),j=element("input"),z=space(),V=element("button"),V.textContent="Generate New Share Keypair",X=space(),ee&&ee.c(),G=empty(),attr(j,"id","dbName"),attr(j,"type","text"),attr(j,"placeholder","Enter share name"),attr(j,"class","svelte-1kdn0fs"),attr(M,"for","dbName"),attr(V,"class","svelte-1kdn0fs"),attr(_,"class","svelte-1kdn0fs")},m(ne,re){insert(ne,_,re),append(_,M),append(M,$),append(M,j),set_input_value(j,q[0]),append(_,z),append(_,V),insert(ne,X,re),ee&&ee.m(ne,re),insert(ne,G,re),Y||(Q=[listen(j,"input",q[5]),listen(V,"click",q[4])],Y=!0)},p(ne,[re]){re&1&&j.value!==ne[0]&&set_input_value(j,ne[0]),te===(te=Z(ne))&&ee?ee.p(ne,re):(ee&&ee.d(1),ee=te&&te(ne),ee&&(ee.c(),ee.m(G.parentNode,G)))},i:noop,o:noop,d(ne){ne&&detach(_),ne&&detach(X),ee&&ee.d(ne),ne&&detach(G),Y=!1,run_all(Q)}}}function instance$7(q,_,M){let $="",j,z=!1,V;const X=async()=>{try{if(M(3,V=await Crypto.generateShareKeypair($)),console.log(V),settings){const Y=settings.addShare(V.shareAddress),Q=settings.addSecret(V.shareAddress,V.secret);if(typeof Y!="string"&&typeof Q!="string")M(2,z=!0),M(1,j=null),updateShares(settings.shares);else throw new Error("Error adding new share keypair")}}catch(Y){M(1,j=Y),M(2,z=!1)}};function G(){$=this.value,M(0,$)}return[$,j,z,V,X,G]}class GenerateShare extends SvelteComponent{constructor(_){super(),init(this,_,instance$7,create_fragment$9,safe_not_equal,{})}}const ShareSettings_svelte_svelte_type_style_lang="";function create_fragment$8(q){let _,M,$,j,z,V,X,G,Y,Q,Z;return j=new ShareSwitcher({}),V=new GenerateShare({}),G=new AddShare({}),Q=new RemoveShare({}),{c(){_=element("div"),M=element("h4"),M.textContent="Share Settings",$=space(),create_component(j.$$.fragment),z=space(),create_component(V.$$.fragment),X=space(),create_component(G.$$.fragment),Y=space(),create_component(Q.$$.fragment),attr(_,"class","svelte-wv4uud")},m(te,ee){insert(te,_,ee),append(_,M),append(_,$),mount_component(j,_,null),append(_,z),mount_component(V,_,null),append(_,X),mount_component(G,_,null),append(_,Y),mount_component(Q,_,null),Z=!0},p:noop,i(te){Z||(transition_in(j.$$.fragment,te),transition_in(V.$$.fragment,te),transition_in(G.$$.fragment,te),transition_in(Q.$$.fragment,te),Z=!0)},o(te){transition_out(j.$$.fragment,te),transition_out(V.$$.fragment,te),transition_out(G.$$.fragment,te),transition_out(Q.$$.fragment,te),Z=!1},d(te){te&&detach(_),destroy_component(j),destroy_component(V),destroy_component(G),destroy_component(Q)}}}class ShareSettings extends SvelteComponent{constructor(_){super(),init(this,_,null,create_fragment$8,safe_not_equal,{})}}const ServerSettings_svelte_svelte_type_style_lang="";function get_each_context$1(q,_,M){const $=q.slice();return $[13]=_[M],$}function create_if_block_3$3(q){let _;return{c(){_=element("p"),_.innerHTML="<strong>Server was added successfully!</strong>"},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_2$4(q){let _;return{c(){_=element("p"),_.innerHTML="<strong>Sync is complete!</strong>"},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_1$4(q){let _,M,$;return{c(){_=element("p"),M=element("strong"),$=text(q[4])},m(j,z){insert(j,_,z),append(_,M),append(M,$)},p(j,z){z&16&&set_data($,j[4])},d(j){j&&detach(_)}}}function create_each_block$1(q,_){let M,$=_[13]+"",j;return{key:q,first:null,c(){M=element("option"),j=text($),M.__value=_[13],M.value=M.__value,this.first=M},m(z,V){insert(z,M,V),append(M,j)},p(z,V){_=z},d(z){z&&detach(M)}}}function create_if_block$4(q){let _;return{c(){_=element("p"),_.innerHTML="<strong>Server was removed successfully!</strong>"},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_fragment$7(q){let _,M,$,j,z,V,X,G,Y,Q,Z,te=[],ee=new Map,ne,re,se,ie,oe,he=q[5]&&create_if_block_3$3(),le=q[6]&&create_if_block_2$4(),ae=q[3]&&create_if_block_1$4(q),ue=settings.servers;const me=ce=>ce[13];for(let ce=0;ce<ue.length;ce+=1){let _e=get_each_context$1(q,ue,ce),we=me(_e);ee.set(we,te[ce]=create_each_block$1(we,_e))}let fe=q[2]&&create_if_block$4();return{c(){_=element("div"),M=element("input"),$=space(),j=element("button"),j.textContent="Add server",z=space(),he&&he.c(),V=space(),le&&le.c(),X=space(),ae&&ae.c(),G=space(),Y=element("div"),Q=element("select"),Z=element("option"),Z.textContent="Select a server to remove";for(let ce=0;ce<te.length;ce+=1)te[ce].c();ne=space(),re=element("button"),re.textContent="Remove server",se=space(),fe&&fe.c(),attr(M,"type","text"),attr(M,"spellcheck","false"),attr(M,"placeholder","Add a new server URL"),attr(M,"class","svelte-s2f1tg"),attr(j,"class","svelte-s2f1tg"),attr(_,"class","svelte-s2f1tg"),Z.__value="",Z.value=Z.__value,attr(Q,"class","svelte-s2f1tg"),q[1]===void 0&&add_render_callback(()=>q[11].call(Q)),attr(re,"class","svelte-s2f1tg"),attr(Y,"class","svelte-s2f1tg")},m(ce,_e){insert(ce,_,_e),append(_,M),set_input_value(M,q[0]),append(_,$),append(_,j),append(_,z),he&&he.m(_,null),append(_,V),le&&le.m(_,null),append(_,X),ae&&ae.m(_,null),insert(ce,G,_e),insert(ce,Y,_e),append(Y,Q),append(Q,Z);for(let we=0;we<te.length;we+=1)te[we].m(Q,null);select_option(Q,q[1]),append(Y,ne),append(Y,re),append(Y,se),fe&&fe.m(Y,null),ie||(oe=[listen(M,"input",q[9]),listen(j,"click",q[10]),listen(Q,"change",q[11]),listen(re,"click",q[8])],ie=!0)},p(ce,[_e]){_e&1&&M.value!==ce[0]&&set_input_value(M,ce[0]),ce[5]?he||(he=create_if_block_3$3(),he.c(),he.m(_,V)):he&&(he.d(1),he=null),ce[6]?le||(le=create_if_block_2$4(),le.c(),le.m(_,X)):le&&(le.d(1),le=null),ce[3]?ae?ae.p(ce,_e):(ae=create_if_block_1$4(ce),ae.c(),ae.m(_,null)):ae&&(ae.d(1),ae=null),_e&0&&(ue=settings.servers,te=update_keyed_each(te,_e,me,1,ce,ue,ee,Q,destroy_block,create_each_block$1,null,get_each_context$1)),_e&2&&select_option(Q,ce[1]),ce[2]?fe||(fe=create_if_block$4(),fe.c(),fe.m(Y,null)):fe&&(fe.d(1),fe=null)},i:noop,o:noop,d(ce){ce&&detach(_),he&&he.d(),le&&le.d(),ae&&ae.d(),ce&&detach(G),ce&&detach(Y);for(let _e=0;_e<te.length;_e+=1)te[_e].d();fe&&fe.d(),ie=!1,run_all(oe)}}}function instance$6(q,_,M){let $,j,z=!1,V=!1,X,G=!1,Y=!1,Q;replicaDetails.subscribe(se=>{Q=se.replica});async function Z(se){let ie=settings.addServer(se);if(isErr(ie)){M(3,V=!0),M(4,X="Not a valid server URL");return}else{M(3,V=!1),M(5,G=!0),console.log("You have",settings.servers.length,"servers"),console.log("Your servers are",settings.servers);const oe=new Peer;oe.addReplica(Q),await oe.sync(se).isDone(),M(6,Y=!0),console.log("Sync is done")}}function te(){let se=settings.removeServer(j);isErr(se)?(M(3,V=!0),M(4,X="Failed to remove server")):(M(3,V=!1),M(2,z=!0),console.log("You have",settings.servers.length,"servers"),console.log("Your servers are",settings.servers))}function ee(){$=this.value,M(0,$)}const ne=()=>Z($);function re(){j=select_value(this),M(1,j)}return[$,j,z,V,X,G,Y,Z,te,ee,ne,re]}class ServerSettings extends SvelteComponent{constructor(_){super(),init(this,_,instance$6,create_fragment$7,safe_not_equal,{})}}const RedeemInvitation_svelte_svelte_type_style_lang="";function create_if_block_2$3(q){let _,M,$,j=JSON.stringify(q[1],null,2)+"",z;return{c(){_=element("p"),_.textContent="Parsed Invitation:",M=space(),$=element("pre"),z=text(j)},m(V,X){insert(V,_,X),insert(V,M,X),insert(V,$,X),append($,z)},p(V,X){X&2&&j!==(j=JSON.stringify(V[1],null,2)+"")&&set_data(z,j)},d(V){V&&detach(_),V&&detach(M),V&&detach($)}}}function create_if_block_1$3(q){let _;return{c(){_=element("p"),_.textContent="Successfully redeemed invitation!"},m(M,$){insert(M,_,$)},p:noop,d(M){M&&detach(_)}}}function create_if_block$3(q){let _,M,$=q[2].message+"",j;return{c(){_=element("p"),M=text("Error: "),j=text($)},m(z,V){insert(z,_,V),append(_,M),append(_,j)},p(z,V){V&4&&$!==($=z[2].message+"")&&set_data(j,$)},d(z){z&&detach(_)}}}function create_fragment$6(q){let _,M,$,j,z,V,X;function G(Z,te){if(Z[2])return create_if_block$3;if(Z[3])return create_if_block_1$3;if(Z[1])return create_if_block_2$3}let Y=G(q),Q=Y&&Y(q);return{c(){_=element("input"),M=space(),$=element("button"),$.textContent="Redeem Invitation URL",j=space(),Q&&Q.c(),z=empty(),attr(_,"class","my-2 svelte-1xrndge"),attr(_,"type","text"),attr(_,"placeholder","Enter invitation URL")},m(Z,te){insert(Z,_,te),set_input_value(_,q[0]),insert(Z,M,te),insert(Z,$,te),insert(Z,j,te),Q&&Q.m(Z,te),insert(Z,z,te),V||(X=[listen(_,"input",q[5]),listen($,"click",q[4])],V=!0)},p(Z,[te]){te&1&&_.value!==Z[0]&&set_input_value(_,Z[0]),Y===(Y=G(Z))&&Q?Q.p(Z,te):(Q&&Q.d(1),Q=Y&&Y(Z),Q&&(Q.c(),Q.m(z.parentNode,z)))},i:noop,o:noop,d(Z){Z&&detach(_),Z&&detach(M),Z&&detach($),Z&&detach(j),Q&&Q.d(Z),Z&&detach(z),V=!1,run_all(X)}}}function instance$5(q,_,M){let $="",j,z,V=!1;const X=async()=>{try{const Q=await settings.redeemInvitationURL($);Q===!0?(M(3,V=!0),M(2,z=null)):(M(2,z=Q),M(3,V=!1))}catch(Q){M(2,z=Q),M(3,V=!1)}},G=async()=>{await X()};function Y(){$=this.value,M(0,$)}return[$,j,z,V,G,Y]}class RedeemInvitation extends SvelteComponent{constructor(_){super(),init(this,_,instance$5,create_fragment$6,safe_not_equal,{})}}var browser={},canPromise$1=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},qrcode={},utils$1={};let toSJISFunction;const CODEWORDS_COUNT=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];utils$1.getSymbolSize=function q(_){if(!_)throw new Error('"version" cannot be null or undefined');if(_<1||_>40)throw new Error('"version" should be in range from 1 to 40');return _*4+17};utils$1.getSymbolTotalCodewords=function q(_){return CODEWORDS_COUNT[_]};utils$1.getBCHDigit=function(q){let _=0;for(;q!==0;)_++,q>>>=1;return _};utils$1.setToSJISFunction=function q(_){if(typeof _!="function")throw new Error('"toSJISFunc" is not a valid function.');toSJISFunction=_};utils$1.isKanjiModeEnabled=function(){return typeof toSJISFunction<"u"};utils$1.toSJIS=function q(_){return toSJISFunction(_)};var errorCorrectionLevel={};(function(q){q.L={bit:1},q.M={bit:0},q.Q={bit:3},q.H={bit:2};function _(M){if(typeof M!="string")throw new Error("Param is not a string");switch(M.toLowerCase()){case"l":case"low":return q.L;case"m":case"medium":return q.M;case"q":case"quartile":return q.Q;case"h":case"high":return q.H;default:throw new Error("Unknown EC Level: "+M)}}q.isValid=function($){return $&&typeof $.bit<"u"&&$.bit>=0&&$.bit<4},q.from=function($,j){if(q.isValid($))return $;try{return _($)}catch{return j}}})(errorCorrectionLevel);function BitBuffer$1(){this.buffer=[],this.length=0}BitBuffer$1.prototype={get:function(q){const _=Math.floor(q/8);return(this.buffer[_]>>>7-q%8&1)===1},put:function(q,_){for(let M=0;M<_;M++)this.putBit((q>>>_-M-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(q){const _=Math.floor(this.length/8);this.buffer.length<=_&&this.buffer.push(0),q&&(this.buffer[_]|=128>>>this.length%8),this.length++}};var bitBuffer=BitBuffer$1;function BitMatrix$1(q){if(!q||q<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=q,this.data=new Uint8Array(q*q),this.reservedBit=new Uint8Array(q*q)}BitMatrix$1.prototype.set=function(q,_,M,$){const j=q*this.size+_;this.data[j]=M,$&&(this.reservedBit[j]=!0)};BitMatrix$1.prototype.get=function(q,_){return this.data[q*this.size+_]};BitMatrix$1.prototype.xor=function(q,_,M){this.data[q*this.size+_]^=M};BitMatrix$1.prototype.isReserved=function(q,_){return this.reservedBit[q*this.size+_]};var bitMatrix=BitMatrix$1,alignmentPattern={};(function(q){const _=utils$1.getSymbolSize;q.getRowColCoords=function($){if($===1)return[];const j=Math.floor($/7)+2,z=_($),V=z===145?26:Math.ceil((z-13)/(2*j-2))*2,X=[z-7];for(let G=1;G<j-1;G++)X[G]=X[G-1]-V;return X.push(6),X.reverse()},q.getPositions=function($){const j=[],z=q.getRowColCoords($),V=z.length;for(let X=0;X<V;X++)for(let G=0;G<V;G++)X===0&&G===0||X===0&&G===V-1||X===V-1&&G===0||j.push([z[X],z[G]]);return j}})(alignmentPattern);var finderPattern={};const getSymbolSize=utils$1.getSymbolSize,FINDER_PATTERN_SIZE=7;finderPattern.getPositions=function q(_){const M=getSymbolSize(_);return[[0,0],[M-FINDER_PATTERN_SIZE,0],[0,M-FINDER_PATTERN_SIZE]]};var maskPattern={};(function(q){q.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const _={N1:3,N2:3,N3:40,N4:10};q.isValid=function(j){return j!=null&&j!==""&&!isNaN(j)&&j>=0&&j<=7},q.from=function(j){return q.isValid(j)?parseInt(j,10):void 0},q.getPenaltyN1=function(j){const z=j.size;let V=0,X=0,G=0,Y=null,Q=null;for(let Z=0;Z<z;Z++){X=G=0,Y=Q=null;for(let te=0;te<z;te++){let ee=j.get(Z,te);ee===Y?X++:(X>=5&&(V+=_.N1+(X-5)),Y=ee,X=1),ee=j.get(te,Z),ee===Q?G++:(G>=5&&(V+=_.N1+(G-5)),Q=ee,G=1)}X>=5&&(V+=_.N1+(X-5)),G>=5&&(V+=_.N1+(G-5))}return V},q.getPenaltyN2=function(j){const z=j.size;let V=0;for(let X=0;X<z-1;X++)for(let G=0;G<z-1;G++){const Y=j.get(X,G)+j.get(X,G+1)+j.get(X+1,G)+j.get(X+1,G+1);(Y===4||Y===0)&&V++}return V*_.N2},q.getPenaltyN3=function(j){const z=j.size;let V=0,X=0,G=0;for(let Y=0;Y<z;Y++){X=G=0;for(let Q=0;Q<z;Q++)X=X<<1&2047|j.get(Y,Q),Q>=10&&(X===1488||X===93)&&V++,G=G<<1&2047|j.get(Q,Y),Q>=10&&(G===1488||G===93)&&V++}return V*_.N3},q.getPenaltyN4=function(j){let z=0;const V=j.data.length;for(let G=0;G<V;G++)z+=j.data[G];return Math.abs(Math.ceil(z*100/V/5)-10)*_.N4};function M($,j,z){switch($){case q.Patterns.PATTERN000:return(j+z)%2===0;case q.Patterns.PATTERN001:return j%2===0;case q.Patterns.PATTERN010:return z%3===0;case q.Patterns.PATTERN011:return(j+z)%3===0;case q.Patterns.PATTERN100:return(Math.floor(j/2)+Math.floor(z/3))%2===0;case q.Patterns.PATTERN101:return j*z%2+j*z%3===0;case q.Patterns.PATTERN110:return(j*z%2+j*z%3)%2===0;case q.Patterns.PATTERN111:return(j*z%3+(j+z)%2)%2===0;default:throw new Error("bad maskPattern:"+$)}}q.applyMask=function(j,z){const V=z.size;for(let X=0;X<V;X++)for(let G=0;G<V;G++)z.isReserved(G,X)||z.xor(G,X,M(j,G,X))},q.getBestMask=function(j,z){const V=Object.keys(q.Patterns).length;let X=0,G=1/0;for(let Y=0;Y<V;Y++){z(Y),q.applyMask(Y,j);const Q=q.getPenaltyN1(j)+q.getPenaltyN2(j)+q.getPenaltyN3(j)+q.getPenaltyN4(j);q.applyMask(Y,j),Q<G&&(G=Q,X=Y)}return X}})(maskPattern);var errorCorrectionCode={};const ECLevel$1=errorCorrectionLevel,EC_BLOCKS_TABLE=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],EC_CODEWORDS_TABLE=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];errorCorrectionCode.getBlocksCount=function q(_,M){switch(M){case ECLevel$1.L:return EC_BLOCKS_TABLE[(_-1)*4+0];case ECLevel$1.M:return EC_BLOCKS_TABLE[(_-1)*4+1];case ECLevel$1.Q:return EC_BLOCKS_TABLE[(_-1)*4+2];case ECLevel$1.H:return EC_BLOCKS_TABLE[(_-1)*4+3];default:return}};errorCorrectionCode.getTotalCodewordsCount=function q(_,M){switch(M){case ECLevel$1.L:return EC_CODEWORDS_TABLE[(_-1)*4+0];case ECLevel$1.M:return EC_CODEWORDS_TABLE[(_-1)*4+1];case ECLevel$1.Q:return EC_CODEWORDS_TABLE[(_-1)*4+2];case ECLevel$1.H:return EC_CODEWORDS_TABLE[(_-1)*4+3];default:return}};var polynomial={},galoisField={};const EXP_TABLE=new Uint8Array(512),LOG_TABLE=new Uint8Array(256);(function q(){let _=1;for(let M=0;M<255;M++)EXP_TABLE[M]=_,LOG_TABLE[_]=M,_<<=1,_&256&&(_^=285);for(let M=255;M<512;M++)EXP_TABLE[M]=EXP_TABLE[M-255]})();galoisField.log=function q(_){if(_<1)throw new Error("log("+_+")");return LOG_TABLE[_]};galoisField.exp=function q(_){return EXP_TABLE[_]};galoisField.mul=function q(_,M){return _===0||M===0?0:EXP_TABLE[LOG_TABLE[_]+LOG_TABLE[M]]};(function(q){const _=galoisField;q.mul=function($,j){const z=new Uint8Array($.length+j.length-1);for(let V=0;V<$.length;V++)for(let X=0;X<j.length;X++)z[V+X]^=_.mul($[V],j[X]);return z},q.mod=function($,j){let z=new Uint8Array($);for(;z.length-j.length>=0;){const V=z[0];for(let G=0;G<j.length;G++)z[G]^=_.mul(j[G],V);let X=0;for(;X<z.length&&z[X]===0;)X++;z=z.slice(X)}return z},q.generateECPolynomial=function($){let j=new Uint8Array([1]);for(let z=0;z<$;z++)j=q.mul(j,new Uint8Array([1,_.exp(z)]));return j}})(polynomial);const Polynomial=polynomial;function ReedSolomonEncoder$1(q){this.genPoly=void 0,this.degree=q,this.degree&&this.initialize(this.degree)}ReedSolomonEncoder$1.prototype.initialize=function q(_){this.degree=_,this.genPoly=Polynomial.generateECPolynomial(this.degree)};ReedSolomonEncoder$1.prototype.encode=function q(_){if(!this.genPoly)throw new Error("Encoder not initialized");const M=new Uint8Array(_.length+this.degree);M.set(_);const $=Polynomial.mod(M,this.genPoly),j=this.degree-$.length;if(j>0){const z=new Uint8Array(this.degree);return z.set($,j),z}return $};var reedSolomonEncoder=ReedSolomonEncoder$1,version={},mode={},versionCheck={};versionCheck.isValid=function q(_){return!isNaN(_)&&_>=1&&_<=40};var regex={};const numeric="[0-9]+",alphanumeric="[A-Z $%*+\\-./:]+";let kanji="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";kanji=kanji.replace(/u/g,"\\u");const byte="(?:(?![A-Z0-9 $%*+\\-./:]|"+kanji+`)(?:.|[\r
]))+`;regex.KANJI=new RegExp(kanji,"g");regex.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");regex.BYTE=new RegExp(byte,"g");regex.NUMERIC=new RegExp(numeric,"g");regex.ALPHANUMERIC=new RegExp(alphanumeric,"g");const TEST_KANJI=new RegExp("^"+kanji+"$"),TEST_NUMERIC=new RegExp("^"+numeric+"$"),TEST_ALPHANUMERIC=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");regex.testKanji=function q(_){return TEST_KANJI.test(_)};regex.testNumeric=function q(_){return TEST_NUMERIC.test(_)};regex.testAlphanumeric=function q(_){return TEST_ALPHANUMERIC.test(_)};(function(q){const _=versionCheck,M=regex;q.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},q.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},q.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},q.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},q.MIXED={bit:-1},q.getCharCountIndicator=function(z,V){if(!z.ccBits)throw new Error("Invalid mode: "+z);if(!_.isValid(V))throw new Error("Invalid version: "+V);return V>=1&&V<10?z.ccBits[0]:V<27?z.ccBits[1]:z.ccBits[2]},q.getBestModeForData=function(z){return M.testNumeric(z)?q.NUMERIC:M.testAlphanumeric(z)?q.ALPHANUMERIC:M.testKanji(z)?q.KANJI:q.BYTE},q.toString=function(z){if(z&&z.id)return z.id;throw new Error("Invalid mode")},q.isValid=function(z){return z&&z.bit&&z.ccBits};function $(j){if(typeof j!="string")throw new Error("Param is not a string");switch(j.toLowerCase()){case"numeric":return q.NUMERIC;case"alphanumeric":return q.ALPHANUMERIC;case"kanji":return q.KANJI;case"byte":return q.BYTE;default:throw new Error("Unknown mode: "+j)}}q.from=function(z,V){if(q.isValid(z))return z;try{return $(z)}catch{return V}}})(mode);(function(q){const _=utils$1,M=errorCorrectionCode,$=errorCorrectionLevel,j=mode,z=versionCheck,V=7973,X=_.getBCHDigit(V);function G(te,ee,ne){for(let re=1;re<=40;re++)if(ee<=q.getCapacity(re,ne,te))return re}function Y(te,ee){return j.getCharCountIndicator(te,ee)+4}function Q(te,ee){let ne=0;return te.forEach(function(re){const se=Y(re.mode,ee);ne+=se+re.getBitsLength()}),ne}function Z(te,ee){for(let ne=1;ne<=40;ne++)if(Q(te,ne)<=q.getCapacity(ne,ee,j.MIXED))return ne}q.from=function(ee,ne){return z.isValid(ee)?parseInt(ee,10):ne},q.getCapacity=function(ee,ne,re){if(!z.isValid(ee))throw new Error("Invalid QR Code version");typeof re>"u"&&(re=j.BYTE);const se=_.getSymbolTotalCodewords(ee),ie=M.getTotalCodewordsCount(ee,ne),oe=(se-ie)*8;if(re===j.MIXED)return oe;const he=oe-Y(re,ee);switch(re){case j.NUMERIC:return Math.floor(he/10*3);case j.ALPHANUMERIC:return Math.floor(he/11*2);case j.KANJI:return Math.floor(he/13);case j.BYTE:default:return Math.floor(he/8)}},q.getBestVersionForData=function(ee,ne){let re;const se=$.from(ne,$.M);if(Array.isArray(ee)){if(ee.length>1)return Z(ee,se);if(ee.length===0)return 1;re=ee[0]}else re=ee;return G(re.mode,re.getLength(),se)},q.getEncodedBits=function(ee){if(!z.isValid(ee)||ee<7)throw new Error("Invalid QR Code version");let ne=ee<<12;for(;_.getBCHDigit(ne)-X>=0;)ne^=V<<_.getBCHDigit(ne)-X;return ee<<12|ne}})(version);var formatInfo={};const Utils$3=utils$1,G15=1335,G15_MASK=21522,G15_BCH=Utils$3.getBCHDigit(G15);formatInfo.getEncodedBits=function q(_,M){const $=_.bit<<3|M;let j=$<<10;for(;Utils$3.getBCHDigit(j)-G15_BCH>=0;)j^=G15<<Utils$3.getBCHDigit(j)-G15_BCH;return($<<10|j)^G15_MASK};var segments={};const Mode$4=mode;function NumericData(q){this.mode=Mode$4.NUMERIC,this.data=q.toString()}NumericData.getBitsLength=function q(_){return 10*Math.floor(_/3)+(_%3?_%3*3+1:0)};NumericData.prototype.getLength=function q(){return this.data.length};NumericData.prototype.getBitsLength=function q(){return NumericData.getBitsLength(this.data.length)};NumericData.prototype.write=function q(_){let M,$,j;for(M=0;M+3<=this.data.length;M+=3)$=this.data.substr(M,3),j=parseInt($,10),_.put(j,10);const z=this.data.length-M;z>0&&($=this.data.substr(M),j=parseInt($,10),_.put(j,z*3+1))};var numericData=NumericData;const Mode$3=mode,ALPHA_NUM_CHARS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function AlphanumericData(q){this.mode=Mode$3.ALPHANUMERIC,this.data=q}AlphanumericData.getBitsLength=function q(_){return 11*Math.floor(_/2)+6*(_%2)};AlphanumericData.prototype.getLength=function q(){return this.data.length};AlphanumericData.prototype.getBitsLength=function q(){return AlphanumericData.getBitsLength(this.data.length)};AlphanumericData.prototype.write=function q(_){let M;for(M=0;M+2<=this.data.length;M+=2){let $=ALPHA_NUM_CHARS.indexOf(this.data[M])*45;$+=ALPHA_NUM_CHARS.indexOf(this.data[M+1]),_.put($,11)}this.data.length%2&&_.put(ALPHA_NUM_CHARS.indexOf(this.data[M]),6)};var alphanumericData=AlphanumericData,encodeUtf8$1=function q(_){for(var M=[],$=_.length,j=0;j<$;j++){var z=_.charCodeAt(j);if(z>=55296&&z<=56319&&$>j+1){var V=_.charCodeAt(j+1);V>=56320&&V<=57343&&(z=(z-55296)*1024+V-56320+65536,j+=1)}if(z<128){M.push(z);continue}if(z<2048){M.push(z>>6|192),M.push(z&63|128);continue}if(z<55296||z>=57344&&z<65536){M.push(z>>12|224),M.push(z>>6&63|128),M.push(z&63|128);continue}if(z>=65536&&z<=1114111){M.push(z>>18|240),M.push(z>>12&63|128),M.push(z>>6&63|128),M.push(z&63|128);continue}M.push(239,191,189)}return new Uint8Array(M).buffer};const encodeUtf8=encodeUtf8$1,Mode$2=mode;function ByteData(q){this.mode=Mode$2.BYTE,typeof q=="string"&&(q=encodeUtf8(q)),this.data=new Uint8Array(q)}ByteData.getBitsLength=function q(_){return _*8};ByteData.prototype.getLength=function q(){return this.data.length};ByteData.prototype.getBitsLength=function q(){return ByteData.getBitsLength(this.data.length)};ByteData.prototype.write=function(q){for(let _=0,M=this.data.length;_<M;_++)q.put(this.data[_],8)};var byteData=ByteData;const Mode$1=mode,Utils$2=utils$1;function KanjiData(q){this.mode=Mode$1.KANJI,this.data=q}KanjiData.getBitsLength=function q(_){return _*13};KanjiData.prototype.getLength=function q(){return this.data.length};KanjiData.prototype.getBitsLength=function q(){return KanjiData.getBitsLength(this.data.length)};KanjiData.prototype.write=function(q){let _;for(_=0;_<this.data.length;_++){let M=Utils$2.toSJIS(this.data[_]);if(M>=33088&&M<=40956)M-=33088;else if(M>=57408&&M<=60351)M-=49472;else throw new Error("Invalid SJIS character: "+this.data[_]+`
Make sure your charset is UTF-8`);M=(M>>>8&255)*192+(M&255),q.put(M,13)}};var kanjiData=KanjiData,dijkstra={exports:{}};(function(q){var _={single_source_shortest_paths:function(M,$,j){var z={},V={};V[$]=0;var X=_.PriorityQueue.make();X.push($,0);for(var G,Y,Q,Z,te,ee,ne,re,se;!X.empty();){G=X.pop(),Y=G.value,Z=G.cost,te=M[Y]||{};for(Q in te)te.hasOwnProperty(Q)&&(ee=te[Q],ne=Z+ee,re=V[Q],se=typeof V[Q]>"u",(se||re>ne)&&(V[Q]=ne,X.push(Q,ne),z[Q]=Y))}if(typeof j<"u"&&typeof V[j]>"u"){var ie=["Could not find a path from ",$," to ",j,"."].join("");throw new Error(ie)}return z},extract_shortest_path_from_predecessor_list:function(M,$){for(var j=[],z=$;z;)j.push(z),M[z],z=M[z];return j.reverse(),j},find_path:function(M,$,j){var z=_.single_source_shortest_paths(M,$,j);return _.extract_shortest_path_from_predecessor_list(z,j)},PriorityQueue:{make:function(M){var $=_.PriorityQueue,j={},z;M=M||{};for(z in $)$.hasOwnProperty(z)&&(j[z]=$[z]);return j.queue=[],j.sorter=M.sorter||$.default_sorter,j},default_sorter:function(M,$){return M.cost-$.cost},push:function(M,$){var j={value:M,cost:$};this.queue.push(j),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};q.exports=_})(dijkstra);var dijkstraExports=dijkstra.exports;(function(q){const _=mode,M=numericData,$=alphanumericData,j=byteData,z=kanjiData,V=regex,X=utils$1,G=dijkstraExports;function Y(ie){return unescape(encodeURIComponent(ie)).length}function Q(ie,oe,he){const le=[];let ae;for(;(ae=ie.exec(he))!==null;)le.push({data:ae[0],index:ae.index,mode:oe,length:ae[0].length});return le}function Z(ie){const oe=Q(V.NUMERIC,_.NUMERIC,ie),he=Q(V.ALPHANUMERIC,_.ALPHANUMERIC,ie);let le,ae;return X.isKanjiModeEnabled()?(le=Q(V.BYTE,_.BYTE,ie),ae=Q(V.KANJI,_.KANJI,ie)):(le=Q(V.BYTE_KANJI,_.BYTE,ie),ae=[]),oe.concat(he,le,ae).sort(function(me,fe){return me.index-fe.index}).map(function(me){return{data:me.data,mode:me.mode,length:me.length}})}function te(ie,oe){switch(oe){case _.NUMERIC:return M.getBitsLength(ie);case _.ALPHANUMERIC:return $.getBitsLength(ie);case _.KANJI:return z.getBitsLength(ie);case _.BYTE:return j.getBitsLength(ie)}}function ee(ie){return ie.reduce(function(oe,he){const le=oe.length-1>=0?oe[oe.length-1]:null;return le&&le.mode===he.mode?(oe[oe.length-1].data+=he.data,oe):(oe.push(he),oe)},[])}function ne(ie){const oe=[];for(let he=0;he<ie.length;he++){const le=ie[he];switch(le.mode){case _.NUMERIC:oe.push([le,{data:le.data,mode:_.ALPHANUMERIC,length:le.length},{data:le.data,mode:_.BYTE,length:le.length}]);break;case _.ALPHANUMERIC:oe.push([le,{data:le.data,mode:_.BYTE,length:le.length}]);break;case _.KANJI:oe.push([le,{data:le.data,mode:_.BYTE,length:Y(le.data)}]);break;case _.BYTE:oe.push([{data:le.data,mode:_.BYTE,length:Y(le.data)}])}}return oe}function re(ie,oe){const he={},le={start:{}};let ae=["start"];for(let ue=0;ue<ie.length;ue++){const me=ie[ue],fe=[];for(let ce=0;ce<me.length;ce++){const _e=me[ce],we=""+ue+ce;fe.push(we),he[we]={node:_e,lastCount:0},le[we]={};for(let ge=0;ge<ae.length;ge++){const Ae=ae[ge];he[Ae]&&he[Ae].node.mode===_e.mode?(le[Ae][we]=te(he[Ae].lastCount+_e.length,_e.mode)-te(he[Ae].lastCount,_e.mode),he[Ae].lastCount+=_e.length):(he[Ae]&&(he[Ae].lastCount=_e.length),le[Ae][we]=te(_e.length,_e.mode)+4+_.getCharCountIndicator(_e.mode,oe))}}ae=fe}for(let ue=0;ue<ae.length;ue++)le[ae[ue]].end=0;return{map:le,table:he}}function se(ie,oe){let he;const le=_.getBestModeForData(ie);if(he=_.from(oe,le),he!==_.BYTE&&he.bit<le.bit)throw new Error('"'+ie+'" cannot be encoded with mode '+_.toString(he)+`.
 Suggested mode is: `+_.toString(le));switch(he===_.KANJI&&!X.isKanjiModeEnabled()&&(he=_.BYTE),he){case _.NUMERIC:return new M(ie);case _.ALPHANUMERIC:return new $(ie);case _.KANJI:return new z(ie);case _.BYTE:return new j(ie)}}q.fromArray=function(oe){return oe.reduce(function(he,le){return typeof le=="string"?he.push(se(le,null)):le.data&&he.push(se(le.data,le.mode)),he},[])},q.fromString=function(oe,he){const le=Z(oe,X.isKanjiModeEnabled()),ae=ne(le),ue=re(ae,he),me=G.find_path(ue.map,"start","end"),fe=[];for(let ce=1;ce<me.length-1;ce++)fe.push(ue.table[me[ce]].node);return q.fromArray(ee(fe))},q.rawSplit=function(oe){return q.fromArray(Z(oe,X.isKanjiModeEnabled()))}})(segments);const Utils$1=utils$1,ECLevel=errorCorrectionLevel,BitBuffer=bitBuffer,BitMatrix=bitMatrix,AlignmentPattern=alignmentPattern,FinderPattern=finderPattern,MaskPattern=maskPattern,ECCode=errorCorrectionCode,ReedSolomonEncoder=reedSolomonEncoder,Version=version,FormatInfo=formatInfo,Mode=mode,Segments=segments;function setupFinderPattern(q,_){const M=q.size,$=FinderPattern.getPositions(_);for(let j=0;j<$.length;j++){const z=$[j][0],V=$[j][1];for(let X=-1;X<=7;X++)if(!(z+X<=-1||M<=z+X))for(let G=-1;G<=7;G++)V+G<=-1||M<=V+G||(X>=0&&X<=6&&(G===0||G===6)||G>=0&&G<=6&&(X===0||X===6)||X>=2&&X<=4&&G>=2&&G<=4?q.set(z+X,V+G,!0,!0):q.set(z+X,V+G,!1,!0))}}function setupTimingPattern(q){const _=q.size;for(let M=8;M<_-8;M++){const $=M%2===0;q.set(M,6,$,!0),q.set(6,M,$,!0)}}function setupAlignmentPattern(q,_){const M=AlignmentPattern.getPositions(_);for(let $=0;$<M.length;$++){const j=M[$][0],z=M[$][1];for(let V=-2;V<=2;V++)for(let X=-2;X<=2;X++)V===-2||V===2||X===-2||X===2||V===0&&X===0?q.set(j+V,z+X,!0,!0):q.set(j+V,z+X,!1,!0)}}function setupVersionInfo(q,_){const M=q.size,$=Version.getEncodedBits(_);let j,z,V;for(let X=0;X<18;X++)j=Math.floor(X/3),z=X%3+M-8-3,V=($>>X&1)===1,q.set(j,z,V,!0),q.set(z,j,V,!0)}function setupFormatInfo(q,_,M){const $=q.size,j=FormatInfo.getEncodedBits(_,M);let z,V;for(z=0;z<15;z++)V=(j>>z&1)===1,z<6?q.set(z,8,V,!0):z<8?q.set(z+1,8,V,!0):q.set($-15+z,8,V,!0),z<8?q.set(8,$-z-1,V,!0):z<9?q.set(8,15-z-1+1,V,!0):q.set(8,15-z-1,V,!0);q.set($-8,8,1,!0)}function setupData(q,_){const M=q.size;let $=-1,j=M-1,z=7,V=0;for(let X=M-1;X>0;X-=2)for(X===6&&X--;;){for(let G=0;G<2;G++)if(!q.isReserved(j,X-G)){let Y=!1;V<_.length&&(Y=(_[V]>>>z&1)===1),q.set(j,X-G,Y),z--,z===-1&&(V++,z=7)}if(j+=$,j<0||M<=j){j-=$,$=-$;break}}}function createData(q,_,M){const $=new BitBuffer;M.forEach(function(G){$.put(G.mode.bit,4),$.put(G.getLength(),Mode.getCharCountIndicator(G.mode,q)),G.write($)});const j=Utils$1.getSymbolTotalCodewords(q),z=ECCode.getTotalCodewordsCount(q,_),V=(j-z)*8;for($.getLengthInBits()+4<=V&&$.put(0,4);$.getLengthInBits()%8!==0;)$.putBit(0);const X=(V-$.getLengthInBits())/8;for(let G=0;G<X;G++)$.put(G%2?17:236,8);return createCodewords($,q,_)}function createCodewords(q,_,M){const $=Utils$1.getSymbolTotalCodewords(_),j=ECCode.getTotalCodewordsCount(_,M),z=$-j,V=ECCode.getBlocksCount(_,M),X=$%V,G=V-X,Y=Math.floor($/V),Q=Math.floor(z/V),Z=Q+1,te=Y-Q,ee=new ReedSolomonEncoder(te);let ne=0;const re=new Array(V),se=new Array(V);let ie=0;const oe=new Uint8Array(q.buffer);for(let me=0;me<V;me++){const fe=me<G?Q:Z;re[me]=oe.slice(ne,ne+fe),se[me]=ee.encode(re[me]),ne+=fe,ie=Math.max(ie,fe)}const he=new Uint8Array($);let le=0,ae,ue;for(ae=0;ae<ie;ae++)for(ue=0;ue<V;ue++)ae<re[ue].length&&(he[le++]=re[ue][ae]);for(ae=0;ae<te;ae++)for(ue=0;ue<V;ue++)he[le++]=se[ue][ae];return he}function createSymbol(q,_,M,$){let j;if(Array.isArray(q))j=Segments.fromArray(q);else if(typeof q=="string"){let Y=_;if(!Y){const Q=Segments.rawSplit(q);Y=Version.getBestVersionForData(Q,M)}j=Segments.fromString(q,Y||40)}else throw new Error("Invalid data");const z=Version.getBestVersionForData(j,M);if(!z)throw new Error("The amount of data is too big to be stored in a QR Code");if(!_)_=z;else if(_<z)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+z+`.
`);const V=createData(_,M,j),X=Utils$1.getSymbolSize(_),G=new BitMatrix(X);return setupFinderPattern(G,_),setupTimingPattern(G),setupAlignmentPattern(G,_),setupFormatInfo(G,M,0),_>=7&&setupVersionInfo(G,_),setupData(G,V),isNaN($)&&($=MaskPattern.getBestMask(G,setupFormatInfo.bind(null,G,M))),MaskPattern.applyMask($,G),setupFormatInfo(G,M,$),{modules:G,version:_,errorCorrectionLevel:M,maskPattern:$,segments:j}}qrcode.create=function q(_,M){if(typeof _>"u"||_==="")throw new Error("No input text");let $=ECLevel.M,j,z;return typeof M<"u"&&($=ECLevel.from(M.errorCorrectionLevel,ECLevel.M),j=Version.from(M.version),z=MaskPattern.from(M.maskPattern),M.toSJISFunc&&Utils$1.setToSJISFunction(M.toSJISFunc)),createSymbol(_,j,$,z)};var canvas={},utils={};(function(q){function _(M){if(typeof M=="number"&&(M=M.toString()),typeof M!="string")throw new Error("Color should be defined as hex string");let $=M.slice().replace("#","").split("");if($.length<3||$.length===5||$.length>8)throw new Error("Invalid hex color: "+M);($.length===3||$.length===4)&&($=Array.prototype.concat.apply([],$.map(function(z){return[z,z]}))),$.length===6&&$.push("F","F");const j=parseInt($.join(""),16);return{r:j>>24&255,g:j>>16&255,b:j>>8&255,a:j&255,hex:"#"+$.slice(0,6).join("")}}q.getOptions=function($){$||($={}),$.color||($.color={});const j=typeof $.margin>"u"||$.margin===null||$.margin<0?4:$.margin,z=$.width&&$.width>=21?$.width:void 0,V=$.scale||4;return{width:z,scale:z?4:V,margin:j,color:{dark:_($.color.dark||"#000000ff"),light:_($.color.light||"#ffffffff")},type:$.type,rendererOpts:$.rendererOpts||{}}},q.getScale=function($,j){return j.width&&j.width>=$+j.margin*2?j.width/($+j.margin*2):j.scale},q.getImageWidth=function($,j){const z=q.getScale($,j);return Math.floor(($+j.margin*2)*z)},q.qrToImageData=function($,j,z){const V=j.modules.size,X=j.modules.data,G=q.getScale(V,z),Y=Math.floor((V+z.margin*2)*G),Q=z.margin*G,Z=[z.color.light,z.color.dark];for(let te=0;te<Y;te++)for(let ee=0;ee<Y;ee++){let ne=(te*Y+ee)*4,re=z.color.light;if(te>=Q&&ee>=Q&&te<Y-Q&&ee<Y-Q){const se=Math.floor((te-Q)/G),ie=Math.floor((ee-Q)/G);re=Z[X[se*V+ie]?1:0]}$[ne++]=re.r,$[ne++]=re.g,$[ne++]=re.b,$[ne]=re.a}}})(utils);(function(q){const _=utils;function M(j,z,V){j.clearRect(0,0,z.width,z.height),z.style||(z.style={}),z.height=V,z.width=V,z.style.height=V+"px",z.style.width=V+"px"}function $(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}q.render=function(z,V,X){let G=X,Y=V;typeof G>"u"&&(!V||!V.getContext)&&(G=V,V=void 0),V||(Y=$()),G=_.getOptions(G);const Q=_.getImageWidth(z.modules.size,G),Z=Y.getContext("2d"),te=Z.createImageData(Q,Q);return _.qrToImageData(te.data,z,G),M(Z,Y,Q),Z.putImageData(te,0,0),Y},q.renderToDataURL=function(z,V,X){let G=X;typeof G>"u"&&(!V||!V.getContext)&&(G=V,V=void 0),G||(G={});const Y=q.render(z,V,G),Q=G.type||"image/png",Z=G.rendererOpts||{};return Y.toDataURL(Q,Z.quality)}})(canvas);var svgTag={};const Utils=utils;function getColorAttrib(q,_){const M=q.a/255,$=_+'="'+q.hex+'"';return M<1?$+" "+_+'-opacity="'+M.toFixed(2).slice(1)+'"':$}function svgCmd(q,_,M){let $=q+_;return typeof M<"u"&&($+=" "+M),$}function qrToPath(q,_,M){let $="",j=0,z=!1,V=0;for(let X=0;X<q.length;X++){const G=Math.floor(X%_),Y=Math.floor(X/_);!G&&!z&&(z=!0),q[X]?(V++,X>0&&G>0&&q[X-1]||($+=z?svgCmd("M",G+M,.5+Y+M):svgCmd("m",j,0),j=0,z=!1),G+1<_&&q[X+1]||($+=svgCmd("h",V),V=0)):j++}return $}svgTag.render=function q(_,M,$){const j=Utils.getOptions(M),z=_.modules.size,V=_.modules.data,X=z+j.margin*2,G=j.color.light.a?"<path "+getColorAttrib(j.color.light,"fill")+' d="M0 0h'+X+"v"+X+'H0z"/>':"",Y="<path "+getColorAttrib(j.color.dark,"stroke")+' d="'+qrToPath(V,z,j.margin)+'"/>',Q='viewBox="0 0 '+X+" "+X+'"',te='<svg xmlns="http://www.w3.org/2000/svg" '+(j.width?'width="'+j.width+'" height="'+j.width+'" ':"")+Q+' shape-rendering="crispEdges">'+G+Y+`</svg>
`;return typeof $=="function"&&$(null,te),te};const canPromise=canPromise$1,QRCode=qrcode,CanvasRenderer=canvas,SvgRenderer=svgTag;function renderCanvas(q,_,M,$,j){const z=[].slice.call(arguments,1),V=z.length,X=typeof z[V-1]=="function";if(!X&&!canPromise())throw new Error("Callback required as last argument");if(X){if(V<2)throw new Error("Too few arguments provided");V===2?(j=M,M=_,_=$=void 0):V===3&&(_.getContext&&typeof j>"u"?(j=$,$=void 0):(j=$,$=M,M=_,_=void 0))}else{if(V<1)throw new Error("Too few arguments provided");return V===1?(M=_,_=$=void 0):V===2&&!_.getContext&&($=M,M=_,_=void 0),new Promise(function(G,Y){try{const Q=QRCode.create(M,$);G(q(Q,_,$))}catch(Q){Y(Q)}})}try{const G=QRCode.create(M,$);j(null,q(G,_,$))}catch(G){j(G)}}browser.create=QRCode.create;browser.toCanvas=renderCanvas.bind(null,CanvasRenderer.render);browser.toDataURL=renderCanvas.bind(null,CanvasRenderer.renderToDataURL);browser.toString=renderCanvas.bind(null,function(q,_,M){return SvgRenderer.render(q,M)});function create_fragment$5(q){let _,M;return{c(){_=element("div"),attr(_,"id","qrcode")},m($,j){insert($,_,j),q[3](_)},p:noop,i($){M||add_render_callback(()=>{M=create_in_transition(_,fade,{duration:300}),M.start()})},o:noop,d($){$&&detach(_),q[3](null)}}}function instance$4(q,_,M){let{codeValue:$}=_,{squareSize:j}=_,z,V;onMount(async()=>{V=await browser.toCanvas($,{width:j,small:!0,color:{dark:"#000000",light:"#ffffff"}}),z.appendChild(V)}),onDestroy(()=>{V&&V.remove()});function X(G){binding_callbacks[G?"unshift":"push"](()=>{z=G,M(0,z)})}return q.$$set=G=>{"codeValue"in G&&M(1,$=G.codeValue),"squareSize"in G&&M(2,j=G.squareSize)},[z,$,j,X]}class QRJS extends SvelteComponent{constructor(_){super(),init(this,_,instance$4,create_fragment$5,safe_not_equal,{codeValue:1,squareSize:2})}}const CreateInvitation_svelte_svelte_type_style_lang="";function create_if_block$2(q){let _,M,$,j,z,V,X,G,Y,Q,Z,te,ee,ne;function re(ue,me){return ue[2]?create_else_block_1:create_if_block_3$2}let se=re(q),ie=se(q);function oe(ue,me){return ue[3]?create_if_block_2$2:create_else_block}let he=oe(q),le=he(q),ae=q[3]&&create_if_block_1$2(q);return{c(){_=element("p"),M=element("strong"),M.textContent="Your invitation URL is:",$=space(),j=element("span"),z=text(q[1]),V=space(),ie.c(),X=space(),G=element("button"),le.c(),Y=text(`
        QR code`),Q=space(),ae&&ae.c(),Z=empty(),attr(j,"class","break-all text-xs"),attr(_,"class","py-2"),attr(G,"class","mt-2")},m(ue,me){insert(ue,_,me),append(_,M),append(_,$),append(_,j),append(j,z),insert(ue,V,me),ie.m(ue,me),insert(ue,X,me),insert(ue,G,me),le.m(G,null),append(G,Y),insert(ue,Q,me),ae&&ae.m(ue,me),insert(ue,Z,me),te=!0,ee||(ne=listen(G,"click",q[6]),ee=!0)},p(ue,me){(!te||me&2)&&set_data(z,ue[1]),se===(se=re(ue))&&ie?ie.p(ue,me):(ie.d(1),ie=se(ue),ie&&(ie.c(),ie.m(X.parentNode,X))),he!==(he=oe(ue))&&(le.d(1),le=he(ue),le&&(le.c(),le.m(G,Y))),ue[3]?ae?(ae.p(ue,me),me&8&&transition_in(ae,1)):(ae=create_if_block_1$2(ue),ae.c(),transition_in(ae,1),ae.m(Z.parentNode,Z)):ae&&(group_outros(),transition_out(ae,1,1,()=>{ae=null}),check_outros())},i(ue){te||(transition_in(ae),te=!0)},o(ue){transition_out(ae),te=!1},d(ue){ue&&detach(_),ue&&detach(V),ie.d(ue),ue&&detach(X),ue&&detach(G),le.d(),ue&&detach(Q),ae&&ae.d(ue),ue&&detach(Z),ee=!1,ne()}}}function create_else_block_1(q){let _,M,$;return{c(){_=element("button"),_.textContent="URL copied to clipboard!"},m(j,z){insert(j,_,z),M||($=listen(_,"click",q[5]),M=!0)},p:noop,d(j){j&&detach(_),M=!1,$()}}}function create_if_block_3$2(q){let _,M,$;return{c(){_=element("button"),_.textContent="Copy URL to clipboard"},m(j,z){insert(j,_,z),M||($=listen(_,"click",q[5]),M=!0)},p:noop,d(j){j&&detach(_),M=!1,$()}}}function create_else_block(q){let _;return{c(){_=text("Show")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_2$2(q){let _;return{c(){_=text("Hide")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_1$2(q){let _,M,$;return M=new QRJS({props:{codeValue:q[1],squareSize:q[0]}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"id","qrcodeContainer"),attr(_,"class","ml-1/5 mb-12 svelte-tchhkp")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&2&&(V.codeValue=j[1]),z&1&&(V.squareSize=j[0]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_fragment$4(q){let _,M,$,j,z,V,X=q[1]&&create_if_block$2(q);return{c(){_=element("div"),M=element("button"),M.textContent="Generate Invitation URL",$=space(),X&&X.c()},m(G,Y){insert(G,_,Y),append(_,M),append(_,$),X&&X.m(_,null),j=!0,z||(V=listen(M,"click",q[4]),z=!0)},p(G,[Y]){G[1]?X?(X.p(G,Y),Y&2&&transition_in(X,1)):(X=create_if_block$2(G),X.c(),transition_in(X,1),X.m(_,null)):X&&(group_outros(),transition_out(X,1,1,()=>{X=null}),check_outros())},i(G){j||(transition_in(X),j=!0)},o(G){transition_out(X),j=!1},d(G){G&&detach(_),X&&X.d(),z=!1,V()}}}function instance$3(q,_,M){let $;onMount(()=>{M(0,$=window.innerWidth*.4),window.addEventListener("resize",()=>{M(0,$=window.innerWidth*.4)})});let j="",z=!1,V=!1,X;shareKeypair.subscribe(Z=>{X=Z});async function G(){const Z=await createInvitationURL(X.shareAddress,settings.servers,X.secret);typeof Z=="string"?M(1,j=Z):console.error("Failed to create invitation URL:",Z)}async function Y(){try{await navigator.clipboard.writeText(j),M(2,z=!0)}catch(Z){console.error("Failed to copy text: ",Z)}}function Q(){M(3,V=!V)}return[$,j,z,V,G,Y,Q]}class CreateInvitation extends SvelteComponent{constructor(_){super(),init(this,_,instance$3,create_fragment$4,safe_not_equal,{})}}const InvitationUrl_svelte_svelte_type_style_lang="";function create_fragment$3(q){let _,M,$,j,z,V,X;return $=new RedeemInvitation({}),V=new CreateInvitation({}),{c(){_=element("div"),M=element("div"),create_component($.$$.fragment),j=space(),z=element("div"),create_component(V.$$.fragment),attr(M,"class","svelte-a2uzsp"),attr(z,"class","svelte-a2uzsp"),attr(_,"class","svelte-a2uzsp")},m(G,Y){insert(G,_,Y),append(_,M),mount_component($,M,null),append(_,j),append(_,z),mount_component(V,z,null),X=!0},p:noop,i(G){X||(transition_in($.$$.fragment,G),transition_in(V.$$.fragment,G),X=!0)},o(G){transition_out($.$$.fragment,G),transition_out(V.$$.fragment,G),X=!1},d(G){G&&detach(_),destroy_component($),destroy_component(V)}}}class InvitationUrl extends SvelteComponent{constructor(_){super(),init(this,_,null,create_fragment$3,safe_not_equal,{})}}function create_if_block_4(q){let _,M;return _=new ShareSettings({}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block_3$1(q){let _,M;return _=new Identity({}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block_2$1(q){let _,M;return _=new StatusPanel({props:{status:q[0]}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&1&&(z.status=$[0]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block_1$1(q){let _,M,$;return M=new ServerSettings({}),{c(){_=element("div"),create_component(M.$$.fragment)},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block$1(q){let _,M,$;return M=new InvitationUrl({}),{c(){_=element("div"),create_component(M.$$.fragment)},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_fragment$2(q){let _,M,$=q[2].address.slice(0,5)+"",j,z,V,X,G,Y,Q,Z,te,ee,ne,re,se,ie,oe,he,le,ae,ue,me,fe,ce,_e,we,ge=q[1]==="share"&&create_if_block_4(),Ae=q[1]==="identity"&&create_if_block_3$1(),de=q[1]==="status"&&create_if_block_2$1(q),De=q[1]==="server"&&create_if_block_1$1(),Me=q[1]==="invitation"&&create_if_block$1();return{c(){_=element("div"),M=element("button"),j=text($),z=space(),V=element("div"),X=element("div"),G=element("button"),G.textContent="Explore the commons",Y=space(),Q=element("button"),Q.textContent="Identity Info",Z=space(),te=element("button"),te.textContent="Status Panel",ee=space(),ne=element("button"),ne.textContent="Share Settings",re=space(),se=element("button"),se.textContent="Server Settings",ie=space(),oe=element("button"),oe.textContent="Invitation URL",he=space(),le=element("div"),ge&&ge.c(),ae=space(),Ae&&Ae.c(),ue=space(),de&&de.c(),me=space(),De&&De.c(),fe=space(),Me&&Me.c(),attr(M,"class","h-auto mr-6 phase2"),attr(_,"class","w-screen flex flex-row justify-end h-[10vh]"),attr(G,"class","my-1"),attr(Q,"class","my-1"),toggle_class(Q,"phase2",q[1]==="identity"),attr(te,"class","my-1"),toggle_class(te,"phase2",q[1]==="status"),attr(ne,"class","my-1"),toggle_class(ne,"phase2",q[1]==="share"),attr(se,"class","my-1"),toggle_class(se,"phase2",q[1]==="server"),attr(oe,"class","my-1"),toggle_class(oe,"phase2",q[1]==="invitation"),attr(X,"class","mx-1 mt-12 w-1/5 paper-yellow flex flex-col p-8 h-[80vh] sticky top-0"),attr(le,"class","py-12 px-2 flex flex-col xl:flex-row justify-center w-4/5 items-start"),attr(V,"class","flex min-h-screen overflow-y-auto")},m(Ee,Te){insert(Ee,_,Te),append(_,M),append(M,j),insert(Ee,z,Te),insert(Ee,V,Te),append(V,X),append(X,G),append(X,Y),append(X,Q),append(X,Z),append(X,te),append(X,ee),append(X,ne),append(X,re),append(X,se),append(X,ie),append(X,oe),append(V,he),append(V,le),ge&&ge.m(le,null),append(le,ae),Ae&&Ae.m(le,null),append(le,ue),de&&de.m(le,null),append(le,me),De&&De.m(le,null),append(le,fe),Me&&Me.m(le,null),ce=!0,_e||(we=[listen(M,"click",q[3]),listen(G,"click",q[3]),listen(Q,"click",q[4]),listen(te,"click",q[5]),listen(ne,"click",q[6]),listen(se,"click",q[7]),listen(oe,"click",q[8])],_e=!0)},p(Ee,[Te]){(!ce||Te&4)&&$!==($=Ee[2].address.slice(0,5)+"")&&set_data(j,$),(!ce||Te&2)&&toggle_class(Q,"phase2",Ee[1]==="identity"),(!ce||Te&2)&&toggle_class(te,"phase2",Ee[1]==="status"),(!ce||Te&2)&&toggle_class(ne,"phase2",Ee[1]==="share"),(!ce||Te&2)&&toggle_class(se,"phase2",Ee[1]==="server"),(!ce||Te&2)&&toggle_class(oe,"phase2",Ee[1]==="invitation"),Ee[1]==="share"?ge?Te&2&&transition_in(ge,1):(ge=create_if_block_4(),ge.c(),transition_in(ge,1),ge.m(le,ae)):ge&&(group_outros(),transition_out(ge,1,1,()=>{ge=null}),check_outros()),Ee[1]==="identity"?Ae?Te&2&&transition_in(Ae,1):(Ae=create_if_block_3$1(),Ae.c(),transition_in(Ae,1),Ae.m(le,ue)):Ae&&(group_outros(),transition_out(Ae,1,1,()=>{Ae=null}),check_outros()),Ee[1]==="status"?de?(de.p(Ee,Te),Te&2&&transition_in(de,1)):(de=create_if_block_2$1(Ee),de.c(),transition_in(de,1),de.m(le,me)):de&&(group_outros(),transition_out(de,1,1,()=>{de=null}),check_outros()),Ee[1]==="server"?De?Te&2&&transition_in(De,1):(De=create_if_block_1$1(),De.c(),transition_in(De,1),De.m(le,fe)):De&&(group_outros(),transition_out(De,1,1,()=>{De=null}),check_outros()),Ee[1]==="invitation"?Me?Te&2&&transition_in(Me,1):(Me=create_if_block$1(),Me.c(),transition_in(Me,1),Me.m(le,null)):Me&&(group_outros(),transition_out(Me,1,1,()=>{Me=null}),check_outros())},i(Ee){ce||(transition_in(ge),transition_in(Ae),transition_in(de),transition_in(De),transition_in(Me),ce=!0)},o(Ee){transition_out(ge),transition_out(Ae),transition_out(de),transition_out(De),transition_out(Me),ce=!1},d(Ee){Ee&&detach(_),Ee&&detach(z),Ee&&detach(V),ge&&ge.d(),Ae&&Ae.d(),de&&de.d(),De&&De.d(),Me&&Me.d(),_e=!1,run_all(we)}}}function instance$2(q,_,M){let $;component_subscribe(q,authorKeypair,ee=>M(2,$=ee));let{status:j}=_,z="identity";const V=createEventDispatcher();function X(){V("toggle")}const G=()=>M(1,z="identity"),Y=()=>M(1,z="status"),Q=()=>M(1,z="share"),Z=()=>M(1,z="server"),te=()=>M(1,z="invitation");return q.$$set=ee=>{"status"in ee&&M(0,j=ee.status)},[j,z,$,X,G,Y,Q,Z,te]}class UserSettings extends SvelteComponent{constructor(_){super(),init(this,_,instance$2,create_fragment$2,safe_not_equal,{status:0})}}const MouseBanner_svelte_svelte_type_style_lang="";function get_each_context(q,_,M){const $=q.slice();return $[1]=_[M],$[3]=M,$}function create_each_block(q){let _,M,$,j;return{c(){_=element("div"),M=element("div"),$=space(),j=element("div"),attr(M,"class","ml-12 bgimg svelte-1veluwv"),attr(M,"style",`background-image: url(${src});`),attr(_,"class","cell svelte-1veluwv"),attr(j,"class","cell svelte-1veluwv")},m(z,V){insert(z,_,V),append(_,M),insert(z,$,V),insert(z,j,V)},p:noop,d(z){z&&detach(_),z&&detach($),z&&detach(j)}}}function create_fragment$1(q){let _,M=q[0],$=[];for(let j=0;j<M.length;j+=1)$[j]=create_each_block(get_each_context(q,M,j));return{c(){_=element("div");for(let j=0;j<$.length;j+=1)$[j].c();attr(_,"class","banner svelte-1veluwv")},m(j,z){insert(j,_,z);for(let V=0;V<$.length;V+=1)$[V].m(_,null)},p(j,[z]){if(z&0){M=j[0];let V;for(V=0;V<M.length;V+=1){const X=get_each_context(j,M,V);$[V]?$[V].p(X,z):($[V]=create_each_block(),$[V].c(),$[V].m(_,null))}for(;V<$.length;V+=1)$[V].d(1);$.length=M.length}},i:noop,o:noop,d(j){j&&detach(_),destroy_each($,j)}}}const src="images/upload-img.png",repetitions=7;function instance$1(q){return[Array(repetitions).fill().map(()=>({}))]}class MouseBanner extends SvelteComponent{constructor(_){super(),init(this,_,instance$1,create_fragment$1,safe_not_equal,{})}}const App_svelte_svelte_type_style_lang="";function create_if_block_2(q){let _,M,$,j,z,V,X,G,Y,Q,Z,te,ee,ne,re,se,ie,oe,he,le;ee=new ValidateId({}),ee.$on("validated",q[5]),ee.$on("error",q[7]),ee.$on("generateNewIdentity",q[12]),ee.$on("alias",q[5]),re=new MouseBanner({});let ae=q[2]===!0&&create_if_block_3();return{c(){_=element("div"),M=element("h1"),M.textContent="Eccentric Networks",$=space(),j=element("h4"),j.textContent="Collaboration space for the unconnected",z=space(),V=element("div"),X=element("button"),X.textContent="Generate new Identity",G=space(),Y=element("button"),Y.textContent="Explore the commons",Q=space(),Z=element("div"),te=element("div"),create_component(ee.$$.fragment),ne=space(),create_component(re.$$.fragment),se=space(),ae&&ae.c(),ie=empty(),attr(M,"class","svelte-w61yp2"),attr(X,"class","phase1 mx-16 mt-12 text-2xl"),attr(Y,"class","phase1 mx-16 mt-12 text-2xl"),attr(V,"class","flex flex-col lg:flex-row items-center mx-16 justify-evenly my-12"),attr(te,"class","flex flex-row items-center mx-6 my-12"),attr(Z,"class","w-1/2 flex flex-col lg:flex-row items-center mx-2 justify-center my-12"),attr(_,"class","my-12")},m(ue,me){insert(ue,_,me),append(_,M),append(_,$),append(_,j),append(_,z),append(_,V),append(V,X),append(V,G),append(V,Y),append(_,Q),append(_,Z),append(Z,te),mount_component(ee,te,null),append(_,ne),mount_component(re,_,null),insert(ue,se,me),ae&&ae.m(ue,me),insert(ue,ie,me),oe=!0,he||(le=[listen(X,"click",q[6]),listen(Y,"click",q[11])],he=!0)},p(ue,me){ue[2]===!0?ae?me&4&&transition_in(ae,1):(ae=create_if_block_3(),ae.c(),transition_in(ae,1),ae.m(ie.parentNode,ie)):ae&&(group_outros(),transition_out(ae,1,1,()=>{ae=null}),check_outros())},i(ue){oe||(transition_in(ee.$$.fragment,ue),transition_in(re.$$.fragment,ue),transition_in(ae),oe=!0)},o(ue){transition_out(ee.$$.fragment,ue),transition_out(re.$$.fragment,ue),transition_out(ae),oe=!1},d(ue){ue&&detach(_),destroy_component(ee),destroy_component(re),ue&&detach(se),ae&&ae.d(ue),ue&&detach(ie),he=!1,run_all(le)}}}function create_if_block_3(q){let _,M,$;return{c(){_=element("blockquote"),_.textContent="There was an error with your identity file"},m(j,z){insert(j,_,z),$=!0},i(j){$||(add_render_callback(()=>{M||(M=create_bidirectional_transition(_,fly,{y:200,duration:2e3},!0)),M.run(1)}),$=!0)},o(j){M||(M=create_bidirectional_transition(_,fly,{y:200,duration:2e3},!1)),M.run(0),$=!1},d(j){j&&detach(_),j&&M&&M.end()}}}function create_if_block_1(q){let _,M,$;return M=new UserSettings({props:{status:q[4]}}),M.$on("toggle",q[9]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","w-full")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&16&&(V.status=j[4]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block(q){let _,M,$;return M=new GridView({props:{showDetails:q[1],IDcreated:q[0]}}),M.$on("toggle",q[9]),M.$on("view",q[8]),M.$on("details",q[13]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","w-full")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&2&&(V.showDetails=j[1]),z&1&&(V.IDcreated=j[0]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_fragment(q){let _,M,$,j,z,V=!q[0]&&!q[1]&&create_if_block_2(q);const X=[create_if_block,create_if_block_1],G=[];function Y(Q,Z){return Q[0]&&!Q[3]?0:Q[0]&&Q[3]?1:-1}return~($=Y(q))&&(j=G[$]=X[$](q)),{c(){_=element("main"),V&&V.c(),M=space(),j&&j.c(),attr(_,"class","svelte-w61yp2")},m(Q,Z){insert(Q,_,Z),V&&V.m(_,null),append(_,M),~$&&G[$].m(_,null),z=!0},p(Q,[Z]){!Q[0]&&!Q[1]?V?(V.p(Q,Z),Z&3&&transition_in(V,1)):(V=create_if_block_2(Q),V.c(),transition_in(V,1),V.m(_,M)):V&&(group_outros(),transition_out(V,1,1,()=>{V=null}),check_outros());let te=$;$=Y(Q),$===te?~$&&G[$].p(Q,Z):(j&&(group_outros(),transition_out(G[te],1,1,()=>{G[te]=null}),check_outros()),~$?(j=G[$],j?j.p(Q,Z):(j=G[$]=X[$](Q),j.c()),transition_in(j,1),j.m(_,null)):j=null)},i(Q){z||(transition_in(V),transition_in(j),z=!0)},o(Q){transition_out(V),transition_out(j),z=!1},d(Q){Q&&detach(_),V&&V.d(),~$&&G[$].d()}}}function instance(q,_,M){let $;component_subscribe(q,replicaDetails,ue=>M(14,$=ue));let j=!1,z=!1,V=!0,X=!1,G=!1,Y;onMount(async()=>{settings.author?(authorKeypair.set(settings.author),M(0,j=!0)):M(0,j=!1),settings.addShare("+studio.bywytquv2ypa7qqwtj3gbuel5fnqh6w5n5yecdqbwzsr4keativ3a"),settings.addSecret("+studio.bywytquv2ypa7qqwtj3gbuel5fnqh6w5n5yecdqbwzsr4keativ3a","bexvgelmf632ecsgvqhhbwgqgmny5vren673canlay2istswfzspq")});const Q=new Peer;Q.addReplica($.replica);const Z=Q.sync("https://earthstar-server.fly.dev/sync",!0),te=settings.addServer("https://earthstar-server.fly.dev/sync");console.log(te),Z.onStatusChange(ue=>{M(4,Y=ue),console.log(ue),M(4,Y)}),Z.isDone().then(()=>{console.log("Sync complete")}).catch(ue=>{console.error("Sync failed",ue)});function ee(ue){M(0,j=!0),M(1,z=!0)}function ne(){M(0,j=!0),M(3,G=!0)}function re(ue){M(2,X=!0)}const se=new URLSearchParams(window.location.search);se.has("studio"),se.has("oracle");function ie(){M(10,V=!V)}function oe(){M(3,G=!G)}const he=()=>M(0,j=!j&&z===!1),le=()=>M(0,j=!j),ae=()=>M(3,G=!0);return q.$$.update=()=>{q.$$.dirty&1027&&(console.log("IDcreated",j),console.log("showDetails",z),console.log("imageView",V))},[j,z,X,G,Y,ee,ne,re,ie,oe,V,he,le,ae]}class App extends SvelteComponent{constructor(_){super(),init(this,_,instance,create_fragment,safe_not_equal,{})}}new App({target:document.getElementById("app")});
