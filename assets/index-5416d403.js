var Kl=Object.defineProperty;var Zl=(s,e,t)=>e in s?Kl(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var Es=(s,e,t)=>(Zl(s,typeof e!="symbol"?e+"":e,t),t);import{c as hn,r as Ql,g as du,n as Gl,i as Yl,a as X,s as Jl,b as je,d as we,e as pu,S as ye,f as ve,h as A,j as z,k as E,l as S,m as w,o as tt,p as fe,q as B,t as bt,u as J,v as Ae,w as ze,x as vt,y as pi,z as P,A as me,B as M,C as ge,D as He,E as Ft,F as xn,G as Kn,H as xt,I as Pn,J as oe,K as ue,L as le,M as Fe,N as Vn,O as ct,P as Fs,Q as pn,R as Xl,T as on,U as ir,V as sr,W as Ve,X as ec,Y as Ge,Z as Ye,_ as Je,$ as Xe,a0 as mu,a1 as tc,a2 as Ss,a3 as nc,a4 as Ki,a5 as ar,a6 as Bs,a7 as rc,a8 as gu,a9 as Zn,aa as Zi,ab as as,ac as ic}from"./svelte-4cda8ba4.js";function sc(s,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in s)){const i=Object.getOwnPropertyDescriptor(r,n);i&&Object.defineProperty(s,n,i.get?i:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();class Ct extends Error{constructor(e){super(e||""),this.name="EarthstarError"}}class ie extends Ct{constructor(e){super(e||"Validation error"),this.name="ValidationError"}}class Qe extends Ct{constructor(e){super(e||"a Replica or ReplicaDriver was used after being closed"),this.name="ReplicaIsClosedError"}}class _n extends Ct{constructor(e){super(e||"a ReplicaCache was used after being closed"),this.name="ReplicaCacheIsClosedError"}}class Er extends Ct{constructor(e){super(e||"Not supported"),this.name="NotSupportedError"}}function se(s){return s instanceof Ct}function bu(s){return!(s instanceof Ct)}var Du={},_u={};Object.defineProperty(_u,"__esModule",{value:!0});(function(s){var e=hn&&hn.__createBinding||(Object.create?function(i,a,o,u){u===void 0&&(u=o);var l=Object.getOwnPropertyDescriptor(a,o);(!l||("get"in l?!a.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return a[o]}}),Object.defineProperty(i,u,l)}:function(i,a,o,u){u===void 0&&(u=o),i[u]=a[o]}),t=hn&&hn.__exportStar||function(i,a){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&e(a,i,o)};Object.defineProperty(s,"__esModule",{value:!0}),s.crypto=void 0;const n=Ql.webcrypto;s.crypto=n,t(_u,s)})(Du);var Tr={};Object.defineProperty(Tr,"__esModule",{value:!0});var mi=Tr.setInterval=In=Tr.setTimeout=void 0;const ac=globalThis.setTimeout;function oc(s,e,...t){const r=ac(s,e,...t);return typeof r=="number"?r:r[Symbol.toPrimitive]()}var In=Tr.setTimeout=oc;const uc=globalThis.setInterval;function lc(s,e,...t){const r=uc(s,e,...t);return typeof r=="number"?r:r[Symbol.toPrimitive]()}mi=Tr.setInterval=lc;var os={},Bi,Is;Object.defineProperty(os,"__esModule",{value:!0});var wu=os.WeakRef=void 0;wu=os.WeakRef=(Bi=globalThis.WeakRef)!==null&&Bi!==void 0?Bi:(Is=class{constructor(e){}deref(){throw new Error("WeakRef is not supported in Node 14 and below.")}},Is);const{Blob:yu}=window,{Request:cc,Response:fc,Headers:hc,fetch:Bb}=window,{ReadableStream:Tn,ReadableStreamDefaultReader:Ib,ReadableStreamBYOBReader:Tb,ReadableStreamBYOBRequest:Rb,ReadableByteStreamController:xb,ReadableStreamDefaultController:Pb,TransformStream:or,TransformStreamDefaultController:dc,WritableStream:Rt,WritableStreamDefaultWriter:pc,WritableStreamDefaultController:Ob,ByteLengthQueuingStrategy:Nb,CountQueuingStrategy:Mb,TextEncoderStream:Lb,TextDecoderStream:zb}=window;if(!Tn.prototype[Symbol.asyncIterator]){async function*s(){const e=this.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)return;yield r}}finally{e.releaseLock()}}Tn.prototype[Symbol.asyncIterator]=s}var Un=null;typeof WebSocket<"u"?Un=WebSocket:typeof MozWebSocket<"u"?Un=MozWebSocket:typeof global<"u"?Un=global.WebSocket||global.MozWebSocket:typeof window<"u"?Un=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(Un=self.WebSocket||self.MozWebSocket);const Qn=Un,{TextDecoder:vu,TextEncoder:us}=window;function Ts(s,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(s,r.key,r)}}function Cu(s,e,t){return e&&Ts(s.prototype,e),t&&Ts(s,t),s}function Rs(s,e){(e==null||e>s.length)&&(e=s.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=s[t];return r}function ii(s,e){var t=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(t)return(t=t.call(s)).next.bind(t);if(Array.isArray(s)||(t=function(n,i){if(n){if(typeof n=="string")return Rs(n,i);var a=Object.prototype.toString.call(n).slice(8,-1);return a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set"?Array.from(n):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Rs(n,i):void 0}}(s))||e&&s&&typeof s.length=="number"){t&&(s=t);var r=0;return function(){return r>=s.length?{done:!0}:{done:!1,value:s[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var mc=/(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDEC0-\uDEEB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/,gc=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/;function bc(s,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(s)}function Au(s,e){e===void 0&&(e=!1);for(var t=[],r=0;r<s.length;){var n=s[r],i=function(h){if(!e)throw new TypeError(h);t.push({type:"INVALID_CHAR",index:r,value:s[r++]})};if(n!=="*")if(n!=="+"&&n!=="?")if(n!=="\\")if(n!=="{")if(n!=="}")if(n!==":")if(n!=="(")t.push({type:"CHAR",index:r,value:s[r++]});else{var a=1,o="",u=r+1,l=!1;if(s[u]==="?"){i('Pattern cannot start with "?" at '+u);continue}for(;u<s.length;){if(!bc(s[u],!1)){i("Invalid character '"+s[u]+"' at "+u+"."),l=!0;break}if(s[u]!=="\\"){if(s[u]===")"){if(--a==0){u++;break}}else if(s[u]==="("&&(a++,s[u+1]!=="?")){i("Capturing groups are not allowed at "+u),l=!0;break}o+=s[u++]}else o+=s[u++]+s[u++]}if(l)continue;if(a){i("Unbalanced pattern at "+r);continue}if(!o){i("Missing pattern at "+r);continue}t.push({type:"PATTERN",index:r,value:o}),r=u}else{for(var c="",f=r+1;f<s.length;){var d=s.substr(f,1);if(!(f===r+1&&mc.test(d)||f!==r+1&&gc.test(d)))break;c+=s[f++]}if(!c){i("Missing parameter name at "+r);continue}t.push({type:"NAME",index:r,value:c}),r=f}else t.push({type:"CLOSE",index:r,value:s[r++]});else t.push({type:"OPEN",index:r,value:s[r++]});else t.push({type:"ESCAPED_CHAR",index:r++,value:s[r++]});else t.push({type:"MODIFIER",index:r,value:s[r++]});else t.push({type:"ASTERISK",index:r,value:s[r++]})}return t.push({type:"END",index:r,value:""}),t}function ku(s,e){e===void 0&&(e={});for(var t=Au(s),r=e.prefixes,n=r===void 0?"./":r,i="[^"+Hn(e.delimiter||"/#?")+"]+?",a=[],o=0,u=0,l="",c=new Set,f=function(G){if(u<t.length&&t[u].type===G)return t[u++].value},d=function(){return f("MODIFIER")||f("ASTERISK")},h=function(G){var R=f(G);if(R!==void 0)return R;var L=t[u];throw new TypeError("Unexpected "+L.type+" at "+L.index+", expected "+G)},p=function(){for(var G,R="";G=f("CHAR")||f("ESCAPED_CHAR");)R+=G;return R},m=e.encodePart||function(G){return G};u<t.length;){var b=f("CHAR"),g=f("NAME"),D=f("PATTERN");if(g||D||!f("ASTERISK")||(D=".*"),g||D){var v=b||"";n.indexOf(v)===-1&&(l+=v,v=""),l&&(a.push(m(l)),l="");var C=g||o++;if(c.has(C))throw new TypeError("Duplicate name '"+C+"'.");c.add(C),a.push({name:C,prefix:m(v),suffix:"",pattern:D||i,modifier:d()||""})}else{var k=b||f("ESCAPED_CHAR");if(k)l+=k;else if(f("OPEN")){var I=p(),F=f("NAME")||"",T=f("PATTERN")||"";F||T||!f("ASTERISK")||(T=".*");var N=p();h("CLOSE");var j=d()||"";if(!F&&!T&&!j){l+=I;continue}if(!F&&!T&&!I)continue;l&&(a.push(m(l)),l=""),a.push({name:F||(T?o++:""),pattern:F&&!T?i:T,prefix:m(I),suffix:m(N),modifier:j})}else l&&(a.push(m(l)),l=""),h("END")}}return a}function Hn(s){return s.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function Eu(s){return s&&s.sensitive?"u":"ui"}function Fu(s,e,t){t===void 0&&(t={});for(var r,n=t.strict,i=n!==void 0&&n,a=t.start,o=a===void 0||a,u=t.end,l=u===void 0||u,c=t.encode,f=c===void 0?function(k){return k}:c,d="["+Hn(t.endsWith||"")+"]|$",h="["+Hn(t.delimiter||"/#?")+"]",p=o?"^":"",m=ii(s);!(r=m()).done;){var b=r.value;if(typeof b=="string")p+=Hn(f(b));else{var g=Hn(f(b.prefix)),D=Hn(f(b.suffix));b.pattern?(e&&e.push(b),p+=g||D?b.modifier==="+"||b.modifier==="*"?"(?:"+g+"((?:"+b.pattern+")(?:"+D+g+"(?:"+b.pattern+"))*)"+D+")"+(b.modifier==="*"?"?":""):"(?:"+g+"("+b.pattern+")"+D+")"+b.modifier:b.modifier==="+"||b.modifier==="*"?"((?:"+b.pattern+")"+b.modifier+")":"("+b.pattern+")"+b.modifier):p+="(?:"+g+D+")"+b.modifier}}if(l)i||(p+=h+"?"),p+=t.endsWith?"(?="+d+")":"$";else{var v=s[s.length-1],C=typeof v=="string"?h.indexOf(v[v.length-1])>-1:v===void 0;i||(p+="(?:"+h+"(?="+d+"))?"),C||(p+="(?="+h+"|"+d+")")}return new RegExp(p,Eu(t))}function Su(s,e,t){return s instanceof RegExp?function(r,n){if(!n)return r;for(var i=/\((?:\?<(.*?)>)?(?!\?)/g,a=0,o=i.exec(r.source);o;)n.push({name:o[1]||a++,prefix:"",suffix:"",modifier:"",pattern:""}),o=i.exec(r.source);return r}(s,e):Array.isArray(s)?function(r,n,i){var a=r.map(function(o){return Su(o,n,i).source});return new RegExp("(?:"+a.join("|")+")",Eu(i))}(s,e,t):function(r,n,i){return Fu(ku(r,i),n,i)}(s,e,t)}var cn={delimiter:"",prefixes:"",sensitive:!0,strict:!0},Dc={delimiter:".",prefixes:"",sensitive:!0,strict:!0},_c={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function xs(s,e){return s.startsWith(e)?s.substring(e.length,s.length):s}function Bu(s){return!(!s||s.length<2||s[0]!=="["&&(s[0]!=="\\"&&s[0]!=="{"||s[1]!=="["))}var Be,Iu=["ftp","file","http","https","ws","wss"];function Tu(s){if(!s)return!0;for(var e,t=ii(Iu);!(e=t()).done;)if(s.test(e.value))return!0;return!1}function Ru(s){switch(s){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function ls(s){if(s==="")return s;if(/^[-+.A-Za-z0-9]*$/.test(s))return s.toLowerCase();throw new TypeError("Invalid protocol '"+s+"'.")}function wc(s){if(s==="")return s;var e=new URL("https://example.com");return e.username=s,e.username}function yc(s){if(s==="")return s;var e=new URL("https://example.com");return e.password=s,e.password}function xu(s){if(s==="")return s;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(s))throw new TypeError("Invalid hostname '"+s+"'");var e=new URL("https://example.com");return e.hostname=s,e.hostname}function Pu(s){if(s==="")return s;if(/[^0-9a-fA-F[\]:]/g.test(s))throw new TypeError("Invalid IPv6 hostname '"+s+"'");return s.toLowerCase()}function Ou(s){if(s===""||/^[0-9]*$/.test(s)&&parseInt(s)<=65535)return s;throw new TypeError("Invalid port '"+s+"'.")}function vc(s){if(s==="")return s;var e=new URL("https://example.com");return e.pathname=s[0]!=="/"?"/-"+s:s,s[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function Cc(s){return s===""?s:new URL("data:"+s).pathname}function Ac(s){if(s==="")return s;var e=new URL("https://example.com");return e.search=s,e.search.substring(1,e.search.length)}function kc(s){if(s==="")return s;var e=new URL("https://example.com");return e.hash=s,e.hash.substring(1,e.hash.length)}(function(s){s[s.INIT=0]="INIT",s[s.PROTOCOL=1]="PROTOCOL",s[s.AUTHORITY=2]="AUTHORITY",s[s.USERNAME=3]="USERNAME",s[s.PASSWORD=4]="PASSWORD",s[s.HOSTNAME=5]="HOSTNAME",s[s.PORT=6]="PORT",s[s.PATHNAME=7]="PATHNAME",s[s.SEARCH=8]="SEARCH",s[s.HASH=9]="HASH",s[s.DONE=10]="DONE"})(Be||(Be={}));var Ec=function(){function s(t){this.input=void 0,this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=Be.INIT,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=t}var e=s.prototype;return e.parse=function(){for(this.tokenList=Au(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===Be.INIT){this.rewind(),this.isHashPrefix()?this.changeState(Be.HASH,1):this.isSearchPrefix()?(this.changeState(Be.SEARCH,1),this.internalResult.hash=""):(this.changeState(Be.PATHNAME,0),this.internalResult.search="",this.internalResult.hash="");continue}if(this.state===Be.AUTHORITY){this.rewindAndSetState(Be.HOSTNAME);continue}this.changeState(Be.DONE,0);break}if(this.groupDepth>0){if(!this.isGroupClose())continue;this.groupDepth-=1}if(this.isGroupOpen())this.groupDepth+=1;else switch(this.state){case Be.INIT:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(Be.PROTOCOL));break;case Be.PROTOCOL:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();var t=Be.PATHNAME,r=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(t=Be.AUTHORITY,r=3):this.shouldTreatAsStandardURL&&(t=Be.AUTHORITY),this.changeState(t,r)}break;case Be.AUTHORITY:this.isIdentityTerminator()?this.rewindAndSetState(Be.USERNAME):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(Be.HOSTNAME);break;case Be.USERNAME:this.isPasswordPrefix()?this.changeState(Be.PASSWORD,1):this.isIdentityTerminator()&&this.changeState(Be.HOSTNAME,1);break;case Be.PASSWORD:this.isIdentityTerminator()&&this.changeState(Be.HOSTNAME,1);break;case Be.HOSTNAME:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(Be.PORT,1):this.isPathnameStart()?this.changeState(Be.PATHNAME,0):this.isSearchPrefix()?this.changeState(Be.SEARCH,1):this.isHashPrefix()&&this.changeState(Be.HASH,1);break;case Be.PORT:this.isPathnameStart()?this.changeState(Be.PATHNAME,0):this.isSearchPrefix()?this.changeState(Be.SEARCH,1):this.isHashPrefix()&&this.changeState(Be.HASH,1);break;case Be.PATHNAME:this.isSearchPrefix()?this.changeState(Be.SEARCH,1):this.isHashPrefix()&&this.changeState(Be.HASH,1);break;case Be.SEARCH:this.isHashPrefix()&&this.changeState(Be.HASH,1)}}},e.changeState=function(t,r){switch(this.state){case Be.INIT:break;case Be.PROTOCOL:this.internalResult.protocol=this.makeComponentString();break;case Be.AUTHORITY:break;case Be.USERNAME:this.internalResult.username=this.makeComponentString();break;case Be.PASSWORD:this.internalResult.password=this.makeComponentString();break;case Be.HOSTNAME:this.internalResult.hostname=this.makeComponentString();break;case Be.PORT:this.internalResult.port=this.makeComponentString();break;case Be.PATHNAME:this.internalResult.pathname=this.makeComponentString();break;case Be.SEARCH:this.internalResult.search=this.makeComponentString();break;case Be.HASH:this.internalResult.hash=this.makeComponentString()}this.changeStateWithoutSettingComponent(t,r)},e.changeStateWithoutSettingComponent=function(t,r){this.state=t,this.componentStart=this.tokenIndex+r,this.tokenIndex+=r,this.tokenIncrement=0},e.rewind=function(){this.tokenIndex=this.componentStart,this.tokenIncrement=0},e.rewindAndSetState=function(t){this.rewind(),this.state=t},e.safeToken=function(t){return t<0&&(t=this.tokenList.length-t),t<this.tokenList.length?this.tokenList[t]:this.tokenList[this.tokenList.length-1]},e.isNonSpecialPatternChar=function(t,r){var n=this.safeToken(t);return n.value===r&&(n.type==="CHAR"||n.type==="ESCAPED_CHAR"||n.type==="INVALID_CHAR")},e.isProtocolSuffix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.nextIsAuthoritySlashes=function(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")},e.isIdentityTerminator=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")},e.isPasswordPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.isPortPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.isPathnameStart=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")},e.isSearchPrefix=function(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;var t=this.safeToken(this.tokenIndex-1);return t.type!=="NAME"&&t.type!=="PATTERN"&&t.type!=="CLOSE"&&t.type!=="ASTERISK"},e.isHashPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")},e.isGroupOpen=function(){return this.tokenList[this.tokenIndex].type=="OPEN"},e.isGroupClose=function(){return this.tokenList[this.tokenIndex].type=="CLOSE"},e.isIPv6Open=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")},e.isIPv6Close=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")},e.makeComponentString=function(){var t=this.tokenList[this.tokenIndex],r=this.safeToken(this.componentStart).index;return this.input.substring(r,t.index)},e.computeShouldTreatAsStandardURL=function(){var t={};Object.assign(t,cn),t.encodePart=ls;var r=Su(this.makeComponentString(),void 0,t);this.shouldTreatAsStandardURL=Tu(r)},Cu(s,[{key:"result",get:function(){return this.internalResult}}]),s}(),Fc=["protocol","username","password","hostname","port","pathname","search","hash"];function Ps(s,e){if(typeof s!="string")throw new TypeError("parameter 1 is not of type 'string'.");var t=new URL(s,e);return{protocol:t.protocol.substring(0,t.protocol.length-1),username:t.username,password:t.password,hostname:t.hostname,port:t.port,pathname:t.pathname,search:t.search!=""?t.search.substring(1,t.search.length):void 0,hash:t.hash!=""?t.hash.substring(1,t.hash.length):void 0}}function Ii(s,e,t){var r;if(typeof e.baseURL=="string")try{r=new URL(e.baseURL),s.protocol=r.protocol?r.protocol.substring(0,r.protocol.length-1):"",s.username=r.username,s.password=r.password,s.hostname=r.hostname,s.port=r.port,s.pathname=r.pathname,s.search=r.search?r.search.substring(1,r.search.length):"",s.hash=r.hash?r.hash.substring(1,r.hash.length):""}catch{throw new TypeError("invalid baseURL '"+e.baseURL+"'.")}if(typeof e.protocol=="string"&&(s.protocol=function(i,a){var o;return i=(o=i).endsWith(":")?o.substr(0,o.length-1):o,a||i===""?i:ls(i)}(e.protocol,t)),typeof e.username=="string"&&(s.username=function(i,a){if(a||i==="")return i;var o=new URL("https://example.com");return o.username=i,o.username}(e.username,t)),typeof e.password=="string"&&(s.password=function(i,a){if(a||i==="")return i;var o=new URL("https://example.com");return o.password=i,o.password}(e.password,t)),typeof e.hostname=="string"&&(s.hostname=function(i,a){return a||i===""?i:Bu(i)?Pu(i):xu(i)}(e.hostname,t)),typeof e.port=="string"&&(s.port=function(i,a,o){return Ru(a)===i&&(i=""),o||i===""?i:Ou(i)}(e.port,s.protocol,t)),typeof e.pathname=="string"){if(s.pathname=e.pathname,r&&!function(i,a){return!(!i.length||i[0]!=="/"&&(!a||i.length<2||i[0]!="\\"&&i[0]!="{"||i[1]!="/"))}(s.pathname,t)){var n=r.pathname.lastIndexOf("/");n>=0&&(s.pathname=r.pathname.substring(0,n+1)+s.pathname)}s.pathname=function(i,a,o){if(o||i==="")return i;if(a&&!Iu.includes(a))return new URL(a+":"+i).pathname;var u=i[0]=="/";return i=new URL(u?i:"/-"+i,"https://example.com").pathname,u||(i=i.substring(2,i.length)),i}(s.pathname,s.protocol,t)}return typeof e.search=="string"&&(s.search=function(i,a){if(i=xs(i,"?"),a||i==="")return i;var o=new URL("https://example.com");return o.search=i,o.search?o.search.substring(1,o.search.length):""}(e.search,t)),typeof e.hash=="string"&&(s.hash=function(i,a){if(i=xs(i,"#"),a||i==="")return i;var o=new URL("https://example.com");return o.hash=i,o.hash?o.hash.substring(1,o.hash.length):""}(e.hash,t)),s}function br(s){return s.replace(/([+*?:{}()\\])/g,"\\$1")}function Sc(s,e){for(var t="[^"+(e.delimiter||"/#?").replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")+"]+?",r=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/,n="",i=0;i<s.length;++i){var a=s[i],o=i>0?s[i-1]:null,u=i<s.length-1?s[i+1]:null;if(typeof a!="string")if(a.pattern!==""){var l=typeof a.name!="number",c=e.prefixes!==void 0?e.prefixes:"./",f=a.suffix!==""||a.prefix!==""&&(a.prefix.length!==1||!c.includes(a.prefix));f||!l||a.pattern!==t||a.modifier!==""||!u||u.prefix||u.suffix||(f=typeof u=="string"?r.test(u.length>0?u[0]:""):typeof u.name=="number"),!f&&a.prefix===""&&o&&typeof o=="string"&&o.length>0&&(f=c.includes(o[o.length-1])),f&&(n+="{"),n+=br(a.prefix),l&&(n+=":"+a.name),a.pattern===".*"?n+=l||o&&typeof o!="string"&&!o.modifier&&!f&&a.prefix===""?"(.*)":"*":a.pattern===t?l||(n+="("+t+")"):n+="("+a.pattern+")",a.pattern===t&&l&&a.suffix!==""&&r.test(a.suffix[0])&&(n+="\\"),n+=br(a.suffix),f&&(n+="}"),n+=a.modifier}else{if(a.modifier===""){n+=br(a.prefix);continue}n+="{"+br(a.prefix)+"}"+a.modifier}else n+=br(a)}return n}var Bc=function(){function s(t,r){t===void 0&&(t={}),this.pattern=void 0,this.regexp={},this.keys={},this.component_pattern={};try{if(typeof t=="string"){var n=new Ec(t);if(n.parse(),t=n.result,r){if(typeof r!="string")throw new TypeError("'baseURL' parameter is not of type 'string'.");t.baseURL=r}else if(typeof t.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if(r)throw new TypeError("parameter 1 is not of type 'string'.");if(!t||typeof t!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");var i;this.pattern=Ii({pathname:"*",protocol:"*",username:"*",password:"*",hostname:"*",port:"*",search:"*",hash:"*"},t,!0),Ru(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");for(var a,o=ii(Fc);!(a=o()).done;)if((i=a.value)in this.pattern){var u={},l=this.pattern[i];switch(this.keys[i]=[],i){case"protocol":Object.assign(u,cn),u.encodePart=ls;break;case"username":Object.assign(u,cn),u.encodePart=wc;break;case"password":Object.assign(u,cn),u.encodePart=yc;break;case"hostname":Object.assign(u,Dc),u.encodePart=Bu(l)?Pu:xu;break;case"port":Object.assign(u,cn),u.encodePart=Ou;break;case"pathname":Tu(this.regexp.protocol)?(Object.assign(u,_c),u.encodePart=vc):(Object.assign(u,cn),u.encodePart=Cc);break;case"search":Object.assign(u,cn),u.encodePart=Ac;break;case"hash":Object.assign(u,cn),u.encodePart=kc}try{var c=ku(l,u);this.regexp[i]=Fu(c,this.keys[i],u),this.component_pattern[i]=Sc(c,u)}catch{throw new TypeError("invalid "+i+" pattern '"+this.pattern[i]+"'.")}}}catch(f){throw new TypeError("Failed to construct 'URLPattern': "+f.message)}}var e=s.prototype;return e.test=function(t,r){t===void 0&&(t={});var n,i={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&r)throw new TypeError("parameter 1 is not of type 'string'.");if(t===void 0)return!1;try{i=Ii(i,typeof t=="object"?t:Ps(t,r),!1)}catch{return!1}for(n in this.pattern)if(!this.regexp[n].exec(i[n]))return!1;return!0},e.exec=function(t,r){t===void 0&&(t={});var n={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&r)throw new TypeError("parameter 1 is not of type 'string'.");if(t!==void 0){try{n=Ii(n,typeof t=="object"?t:Ps(t,r),!1)}catch{return null}var i,a={};for(i in a.inputs=r?[t,r]:[t],this.pattern){var o=this.regexp[i].exec(n[i]);if(!o)return null;for(var u,l={},c=ii(this.keys[i].entries());!(u=c()).done;){var f=u.value,d=f[1];typeof d.name!="string"&&typeof d.name!="number"||(l[d.name]=o[f[0]+1]||"")}a[i]={input:n[i]||"",groups:l}}return a}},Cu(s,[{key:"protocol",get:function(){return this.component_pattern.protocol}},{key:"username",get:function(){return this.component_pattern.username}},{key:"password",get:function(){return this.component_pattern.password}},{key:"hostname",get:function(){return this.component_pattern.hostname}},{key:"port",get:function(){return this.component_pattern.port}},{key:"pathname",get:function(){return this.component_pattern.pathname}},{key:"search",get:function(){return this.component_pattern.search}},{key:"hash",get:function(){return this.component_pattern.hash}}]),s}();const Ic={crypto:Du.crypto,setInterval:mi,setTimeout:In,WeakRef:wu,Blob:yu,Request:cc,Response:fc,Headers:hc,WritableStream:Rt,TransformStream:or,ReadableStream:Tn,TransformStreamDefaultController:dc,WritableStreamDefaultWriter:pc,WebSocket:Qn,TextEncoder:us,TextDecoder:vu,URLPattern:Bc},Nu=Tc(globalThis,Ic);function Tc(s,e){return new Proxy(s,{get(t,r,n){return r in e?e[r]:s[r]},set(t,r,n){return r in e&&delete e[r],s[r]=n,!0},deleteProperty(t,r){let n=!1;return r in e&&(delete e[r],n=!0),r in s&&(delete s[r],n=!0),n},ownKeys(t){const r=Reflect.ownKeys(s),n=Reflect.ownKeys(e),i=new Set(n);return[...r.filter(a=>!i.has(a)),...n]},defineProperty(t,r,n){return r in e&&delete e[r],Reflect.defineProperty(s,r,n),!0},getOwnPropertyDescriptor(t,r){return r in e?Reflect.getOwnPropertyDescriptor(e,r):Reflect.getOwnPropertyDescriptor(s,r)},has(t,r){return r in e||r in s}})}function Mu(s,e){if(s===e)return!0;if(!s||!e)return!1;var t=s.length;if(e.length!==t)return!1;for(var r=0;r<t;r++)if(s[r]!==e[r])return!1;return!0}function si(s,e){if(s===e)return!0;if(!s||!e)return!1;var t=Object.keys(s),r=Object.keys(e),n=t.length;if(r.length!==n)return!1;for(var i=0;i<n;i++){var a=t[i];if(s[a]!==e[a]||!Object.prototype.hasOwnProperty.call(e,a))return!1}return!0}var Rc=function(s,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var t=typeof e.cycles=="boolean"?e.cycles:!1,r=e.cmp&&function(i){return function(a){return function(o,u){var l={key:o,value:a[o]},c={key:u,value:a[u]};return i(l,c)}}}(e.cmp),n=[];return function i(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a!==void 0){if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);var o,u;if(Array.isArray(a)){for(u="[",o=0;o<a.length;o++)o&&(u+=","),u+=i(a[o])||"null";return u+"]"}if(a===null)return"null";if(n.indexOf(a)!==-1){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=n.push(a)-1,c=Object.keys(a).sort(r&&r(a));for(u="",o=0;o<c.length;o++){var f=c[o],d=i(a[f]);d&&(u&&(u+=","),u+=JSON.stringify(f)+":"+d)}return n.splice(l,1),"{"+u+"}"}}(s)};const xc=du(Rc);var St={};Object.defineProperty(St,"__esModule",{value:!0});function ur(s,e,t){var r;if(t===void 0&&(t={}),!e.codes){e.codes={};for(var n=0;n<e.chars.length;++n)e.codes[e.chars[n]]=n}if(!t.loose&&s.length*e.bits&7)throw new SyntaxError("Invalid padding");for(var i=s.length;s[i-1]==="=";)if(--i,!t.loose&&!((s.length-i)*e.bits&7))throw new SyntaxError("Invalid padding");for(var a=new((r=t.out)!=null?r:Uint8Array)(i*e.bits/8|0),o=0,u=0,l=0,c=0;c<i;++c){var f=e.codes[s[c]];if(f===void 0)throw new SyntaxError("Invalid character "+s[c]);u=u<<e.bits|f,o+=e.bits,o>=8&&(o-=8,a[l++]=255&u>>o)}if(o>=e.bits||255&u<<8-o)throw new SyntaxError("Unexpected end of data");return a}function lr(s,e,t){t===void 0&&(t={});for(var r=t,n=r.pad,i=n===void 0?!0:n,a=(1<<e.bits)-1,o="",u=0,l=0,c=0;c<s.length;++c)for(l=l<<8|255&s[c],u+=8;u>e.bits;)u-=e.bits,o+=e.chars[a&l>>u];if(u&&(o+=e.chars[a&l<<e.bits-u]),i)for(;o.length*e.bits&7;)o+="=";return o}var Os={chars:"0123456789ABCDEF",bits:4},Ns={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},Ms={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},Ls={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},zs={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},Pc={parse:function(e,t){return ur(e.toUpperCase(),Os,t)},stringify:function(e,t){return lr(e,Os,t)}},Oc={parse:function(e,t){return t===void 0&&(t={}),ur(t.loose?e.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):e,Ns,t)},stringify:function(e,t){return lr(e,Ns,t)}},Nc={parse:function(e,t){return ur(e,Ms,t)},stringify:function(e,t){return lr(e,Ms,t)}},Mc={parse:function(e,t){return ur(e,Ls,t)},stringify:function(e,t){return lr(e,Ls,t)}},Lc={parse:function(e,t){return ur(e,zs,t)},stringify:function(e,t){return lr(e,zs,t)}},zc={parse:ur,stringify:lr};St.base16=Pc;St.base32=Oc;St.base32hex=Nc;St.base64=Mc;St.base64url=Lc;St.codec=zc;const $c=St.base16,jc=St.base32,Uc=St.base32hex,Hc=St.base64,qc=St.base64url,Wc=St.codec,Vc=Object.freeze(Object.defineProperty({__proto__:null,base16:$c,base32:jc,base32hex:Uc,base64:Hc,base64url:qc,codec:Wc,default:St},Symbol.toStringTag,{value:"Module"}));var Rn={};Object.defineProperty(Rn,"__esModule",{value:!0});var Lu=Rn.Hash=zu=Rn.createHash=void 0;const Kc=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],$s={sha256:1};function Zc(s){if(s&&!$s[s]&&!$s[s.toLowerCase()])throw new Error("Digest method not supported");return new $u}var zu=Rn.createHash=Zc;class $u{constructor(){this.A=1779033703,this.B=-1150833019,this.C=1013904242,this.D=-1521486534,this.E=1359893119,this.F=-1694144372,this.G=528734635,this.H=1541459225,this._size=0,this._sp=0,(!qr||Dr>=8e3)&&(qr=new ArrayBuffer(8e3),Dr=0),this._byte=new Uint8Array(qr,Dr,80),this._word=new Int32Array(qr,Dr,20),Dr+=80}update(e){if(typeof e=="string")return this._utf8(e);if(e==null)throw new TypeError("Invalid type: "+typeof e);const t=e.byteOffset,r=e.byteLength;let n=r/64|0,i=0;if(n&&!(t&3)&&!(this._size%64)){const o=new Int32Array(e.buffer,t,n*16);for(;n--;)this._int32(o,i>>2),i+=64;this._size+=i}if(e.BYTES_PER_ELEMENT!==1&&e.buffer){const o=new Uint8Array(e.buffer,t+i,r-i);return this._uint8(o)}return i===r?this:this._uint8(e,i)}_uint8(e,t){const{_byte:r,_word:n}=this,i=e.length;for(t=t|0;t<i;){const a=this._size%64;let o=a;for(;t<i&&o<64;)r[o++]=e[t++];o>=64&&this._int32(n),this._size+=o-a}return this}_utf8(e){const{_byte:t,_word:r}=this,n=e.length;let i=this._sp;for(let a=0;a<n;){const o=this._size%64;let u=o;for(;a<n&&u<64;){let l=e.charCodeAt(a++)|0;l<128?t[u++]=l:l<2048?(t[u++]=192|l>>>6,t[u++]=128|l&63):l<55296||l>57343?(t[u++]=224|l>>>12,t[u++]=128|l>>>6&63,t[u++]=128|l&63):i?(l=((i&1023)<<10)+(l&1023)+65536,t[u++]=240|l>>>18,t[u++]=128|l>>>12&63,t[u++]=128|l>>>6&63,t[u++]=128|l&63,i=0):i=l}u>=64&&(this._int32(r),r[0]=r[16]),this._size+=u-o}return this._sp=i,this}_int32(e,t){let{A:r,B:n,C:i,D:a,E:o,F:u,G:l,H:c}=this,f=0;for(t=t|0;f<16;)wn[f++]=Lt(e[t++]);for(f=16;f<64;f++)wn[f]=nf(wn[f-2])+wn[f-7]+tf(wn[f-15])+wn[f-16]|0;for(f=0;f<64;f++){const d=c+ef(o)+Yc(o,u,l)+Kc[f]+wn[f]|0,h=Xc(r)+Jc(r,n,i)|0;c=l,l=u,u=o,o=a+d|0,a=i,i=n,n=r,r=d+h|0}this.A=r+this.A|0,this.B=n+this.B|0,this.C=i+this.C|0,this.D=a+this.D|0,this.E=o+this.E|0,this.F=u+this.F|0,this.G=l+this.G|0,this.H=c+this.H|0}digest(e){const{_byte:t,_word:r}=this;let n=this._size%64|0;for(t[n++]=128;n&3;)t[n++]=0;if(n>>=2,n>14){for(;n<16;)r[n++]=0;n=0,this._int32(r)}for(;n<16;)r[n++]=0;const i=this._size*8,a=(i&4294967295)>>>0,o=(i-a)/4294967296;return o&&(r[14]=Lt(o)),a&&(r[15]=Lt(a)),this._int32(r),e==="hex"?this._hex():this._bin()}_hex(){const{A:e,B:t,C:r,D:n,E:i,F:a,G:o,H:u}=this;return un(e)+un(t)+un(r)+un(n)+un(i)+un(a)+un(o)+un(u)}_bin(){const{A:e,B:t,C:r,D:n,E:i,F:a,G:o,H:u,_byte:l,_word:c}=this;return c[0]=Lt(e),c[1]=Lt(t),c[2]=Lt(r),c[3]=Lt(n),c[4]=Lt(i),c[5]=Lt(a),c[6]=Lt(o),c[7]=Lt(u),l.slice(0,32)}}Lu=Rn.Hash=$u;const wn=new Int32Array(64);let qr,Dr=0;const un=s=>(s+4294967296).toString(16).substr(-8),Qc=s=>s<<24&4278190080|s<<8&16711680|s>>8&65280|s>>24&255,Gc=s=>s,Lt=rf()?Gc:Qc,Yc=(s,e,t)=>t^s&(e^t),Jc=(s,e,t)=>s&e|t&(s|e),Xc=s=>(s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10),ef=s=>(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7),tf=s=>(s>>>7|s<<25)^(s>>>18|s<<14)^s>>>3,nf=s=>(s>>>17|s<<15)^(s>>>19|s<<13)^s>>>10;function rf(){return new Uint8Array(new Uint16Array([65279]).buffer)[0]===254}const sf=sc({__proto__:null,get Hash(){return Lu},get createHash(){return zu},default:Rn},[Rn]);/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const ft=BigInt(0),Ne=BigInt(1),yt=BigInt(2),ju=BigInt(255),js=yt**BigInt(252)+BigInt("27742317777372353535851937790883648493"),We={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:yt**ju-BigInt(19),l:js,n:js,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},Uu=yt**BigInt(256),Fr=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");const af=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),of=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),uf=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),lf=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class Le{constructor(e,t,r,n){this.x=e,this.y=t,this.z=r,this.t=n}static fromAffine(e){if(!(e instanceof it))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(it.ZERO)?Le.ZERO:new Le(e.x,e.y,Ne,ne(e.x*e.y))}static toAffineBatch(e){const t=hf(e.map(r=>r.z));return e.map((r,n)=>r.toAffine(t[n]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){Us(e);const{x:t,y:r,z:n}=this,{x:i,y:a,z:o}=e,u=ne(t*o),l=ne(i*n),c=ne(r*o),f=ne(a*n);return u===l&&c===f}negate(){return new Le(ne(-this.x),this.y,this.z,ne(-this.t))}double(){const{x:e,y:t,z:r}=this,{a:n}=We,i=ne(e**yt),a=ne(t**yt),o=ne(yt*ne(r**yt)),u=ne(n*i),l=ne(ne((e+t)**yt)-i-a),c=u+a,f=c-o,d=u-a,h=ne(l*f),p=ne(c*d),m=ne(l*d),b=ne(f*c);return new Le(h,p,b,m)}add(e){Us(e);const{x:t,y:r,z:n,t:i}=this,{x:a,y:o,z:u,t:l}=e,c=ne((r-t)*(o+a)),f=ne((r+t)*(o-a)),d=ne(f-c);if(d===ft)return this.double();const h=ne(n*yt*l),p=ne(i*yt*u),m=p+h,b=f+c,g=p-h,D=ne(m*d),v=ne(b*g),C=ne(m*g),k=ne(d*b);return new Le(D,v,k,C)}subtract(e){return this.add(e.negate())}precomputeWindow(e){const t=1+256/e,r=[];let n=this,i=n;for(let a=0;a<t;a++){i=n,r.push(i);for(let o=1;o<2**(e-1);o++)i=i.add(n),r.push(i);n=i.double()}return r}wNAF(e,t){!t&&this.equals(Le.BASE)&&(t=it.BASE);const r=t&&t._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let n=t&&Qi.get(t);n||(n=this.precomputeWindow(r),t&&r!==1&&(n=Le.normalizeZ(n),Qi.set(t,n)));let i=Le.ZERO,a=Le.ZERO;const o=1+256/r,u=2**(r-1),l=BigInt(2**r-1),c=2**r,f=BigInt(r);for(let d=0;d<o;d++){const h=d*u;let p=Number(e&l);if(e>>=f,p>u&&(p-=c,e+=Ne),p===0){let m=n[h];d%2&&(m=m.negate()),a=a.add(m)}else{let m=n[h+Math.abs(p)-1];p<0&&(m=m.negate()),i=i.add(m)}}return Le.normalizeZ([i,a])[0]}multiply(e,t){return this.wNAF(ai(e,We.l),t)}multiplyUnsafe(e){let t=ai(e,We.l,!1);const r=Le.BASE,n=Le.ZERO;if(t===ft)return n;if(this.equals(n)||t===Ne)return this;if(this.equals(r))return this.wNAF(t);let i=n,a=this;for(;t>ft;)t&Ne&&(i=i.add(a)),a=a.double(),t>>=Ne;return i}isSmallOrder(){return this.multiplyUnsafe(We.h).equals(Le.ZERO)}isTorsionFree(){return this.multiplyUnsafe(We.l).equals(Le.ZERO)}toAffine(e=gi(this.z)){const{x:t,y:r,z:n}=this,i=ne(t*e),a=ne(r*e);if(ne(n*e)!==Ne)throw new Error("invZ was invalid");return new it(i,a)}fromRistrettoBytes(){Ri()}toRistrettoBytes(){Ri()}fromRistrettoHash(){Ri()}}Le.BASE=new Le(We.Gx,We.Gy,Ne,ne(We.Gx*We.Gy));Le.ZERO=new Le(ft,Ne,Ne,ft);function Us(s){if(!(s instanceof Le))throw new TypeError("ExtendedPoint expected")}function Ti(s){if(!(s instanceof Nt))throw new TypeError("RistrettoPoint expected")}function Ri(){throw new Error("Legacy method: switch to RistrettoPoint")}class Nt{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){const{d:t}=We,r=ne(Fr*e*e),n=ne((r+Ne)*uf);let i=BigInt(-1);const a=ne((i-t*r)*ne(r+t));let{isValid:o,value:u}=cs(n,a),l=ne(u*e);fn(l)||(l=ne(-l)),o||(u=l),o||(i=r);const c=ne(i*(r-Ne)*lf-a),f=u*u,d=ne((u+u)*a),h=ne(c*af),p=ne(Ne-f),m=ne(Ne+f);return new Le(ne(d*m),ne(p*h),ne(h*m),ne(d*p))}static hashToCurve(e){e=mn(e,64);const t=xi(e.slice(0,32)),r=this.calcElligatorRistrettoMap(t),n=xi(e.slice(32,64)),i=this.calcElligatorRistrettoMap(n);return new Nt(r.add(i))}static fromHex(e){e=mn(e,32);const{a:t,d:r}=We,n="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",i=xi(e);if(!pf(xr(i),e)||fn(i))throw new Error(n);const a=ne(i*i),o=ne(Ne+t*a),u=ne(Ne-t*a),l=ne(o*o),c=ne(u*u),f=ne(t*r*l-c),{isValid:d,value:h}=Hs(ne(f*c)),p=ne(h*u),m=ne(h*p*f);let b=ne((i+i)*p);fn(b)&&(b=ne(-b));const g=ne(o*m),D=ne(b*g);if(!d||fn(D)||g===ft)throw new Error(n);return new Nt(new Le(b,g,Ne,D))}toRawBytes(){let{x:e,y:t,z:r,t:n}=this.ep;const i=ne(ne(r+t)*ne(r-t)),a=ne(e*t),{value:o}=Hs(ne(i*a**yt)),u=ne(o*i),l=ne(o*a),c=ne(u*l*n);let f;if(fn(n*c)){let h=ne(t*Fr),p=ne(e*Fr);e=h,t=p,f=ne(u*of)}else f=l;fn(e*c)&&(t=ne(-t));let d=ne((r-t)*f);return fn(d)&&(d=ne(-d)),xr(d)}toHex(){return Nr(this.toRawBytes())}toString(){return this.toHex()}equals(e){Ti(e);const t=this.ep,r=e.ep,n=ne(t.x*r.y)===ne(t.y*r.x),i=ne(t.y*r.y)===ne(t.x*r.x);return n||i}add(e){return Ti(e),new Nt(this.ep.add(e.ep))}subtract(e){return Ti(e),new Nt(this.ep.subtract(e.ep))}multiply(e){return new Nt(this.ep.multiply(e))}multiplyUnsafe(e){return new Nt(this.ep.multiplyUnsafe(e))}}Nt.BASE=new Nt(Le.BASE);Nt.ZERO=new Nt(Le.ZERO);const Qi=new WeakMap;class it{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,Qi.delete(this)}static fromHex(e,t=!0){const{d:r,P:n}=We;e=mn(e,32);const i=e.slice();i[31]=e[31]&-129;const a=cr(i);if(t&&a>=n)throw new Error("Expected 0 < hex < P");if(!t&&a>=Uu)throw new Error("Expected 0 < hex < 2**256");const o=ne(a*a),u=ne(o-Ne),l=ne(r*o+Ne);let{isValid:c,value:f}=cs(u,l);if(!c)throw new Error("Point.fromHex: invalid y coordinate");const d=(f&Ne)===Ne;return(e[31]&128)!==0!==d&&(f=ne(-f)),new it(f,a)}static async fromPrivateKey(e){return(await bi(e)).point}toRawBytes(){const e=xr(this.y);return e[31]|=this.x&Ne?128:0,e}toHex(){return Nr(this.toRawBytes())}toX25519(){const{y:e}=this,t=ne((Ne+e)*gi(Ne-e));return xr(t)}isTorsionFree(){return Le.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new it(ne(-this.x),this.y)}add(e){return Le.fromAffine(this).add(Le.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return Le.fromAffine(this).multiply(e,this).toAffine()}}it.BASE=new it(We.Gx,We.Gy);it.ZERO=new it(ft,Ne);class Rr{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromHex(e){const t=mn(e,64),r=it.fromHex(t.slice(0,32),!1),n=cr(t.slice(32,64));return new Rr(r,n)}assertValidity(){const{r:e,s:t}=this;if(!(e instanceof it))throw new Error("Expected Point instance");return ai(t,We.l,!1),this}toRawBytes(){const e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(xr(this.s),32),e}toHex(){return Nr(this.toRawBytes())}}function cf(...s){if(!s.every(r=>r instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(s.length===1)return s[0];const e=s.reduce((r,n)=>r+n.length,0),t=new Uint8Array(e);for(let r=0,n=0;r<s.length;r++){const i=s[r];t.set(i,n),n+=i.length}return t}const ff=Array.from({length:256},(s,e)=>e.toString(16).padStart(2,"0"));function Nr(s){if(!(s instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let t=0;t<s.length;t++)e+=ff[s[t]];return e}function Hu(s){if(typeof s!="string")throw new TypeError("hexToBytes: expected string, got "+typeof s);if(s.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const e=new Uint8Array(s.length/2);for(let t=0;t<e.length;t++){const r=t*2,n=s.slice(r,r+2),i=Number.parseInt(n,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");e[t]=i}return e}function qu(s){const t=s.toString(16).padStart(64,"0");return Hu(t)}function xr(s){return qu(s).reverse()}function fn(s){return(ne(s)&Ne)===Ne}function cr(s){if(!(s instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+Nr(Uint8Array.from(s).reverse()))}function xi(s){return ne(cr(s)&yt**ju-Ne)}function ne(s,e=We.P){const t=s%e;return t>=ft?t:e+t}function gi(s,e=We.P){if(s===ft||e<=ft)throw new Error(`invert: expected positive integers, got n=${s} mod=${e}`);let t=ne(s,e),r=e,n=ft,i=Ne;for(;t!==ft;){const o=r/t,u=r%t,l=n-i*o;r=t,t=u,n=i,i=l}if(r!==Ne)throw new Error("invert: does not exist");return ne(n,e)}function hf(s,e=We.P){const t=new Array(s.length),r=s.reduce((i,a,o)=>a===ft?i:(t[o]=i,ne(i*a,e)),Ne),n=gi(r,e);return s.reduceRight((i,a,o)=>a===ft?i:(t[o]=ne(i*t[o],e),ne(i*a,e)),n),t}function Ht(s,e){const{P:t}=We;let r=s;for(;e-- >ft;)r*=r,r%=t;return r}function df(s){const{P:e}=We,t=BigInt(5),r=BigInt(10),n=BigInt(20),i=BigInt(40),a=BigInt(80),u=s*s%e*s%e,l=Ht(u,yt)*u%e,c=Ht(l,Ne)*s%e,f=Ht(c,t)*c%e,d=Ht(f,r)*f%e,h=Ht(d,n)*d%e,p=Ht(h,i)*h%e,m=Ht(p,a)*p%e,b=Ht(m,a)*p%e,g=Ht(b,r)*f%e;return{pow_p_5_8:Ht(g,yt)*s%e,b2:u}}function cs(s,e){const t=ne(e*e*e),r=ne(t*t*e),n=df(s*r).pow_p_5_8;let i=ne(s*t*n);const a=ne(e*i*i),o=i,u=ne(i*Fr),l=a===s,c=a===ne(-s),f=a===ne(-s*Fr);return l&&(i=o),(c||f)&&(i=u),fn(i)&&(i=ne(-i)),{isValid:l||c,value:i}}function Hs(s){return cs(Ne,s)}async function Gi(...s){const e=await Di.sha512(cf(...s)),t=cr(e);return ne(t,We.l)}function pf(s,e){if(s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(s[t]!==e[t])return!1;return!0}function mn(s,e){const t=s instanceof Uint8Array?Uint8Array.from(s):Hu(s);if(typeof e=="number"&&t.length!==e)throw new Error(`Expected ${e} bytes`);return t}function ai(s,e,t=!0){if(!e)throw new TypeError("Specify max value");if(typeof s=="number"&&Number.isSafeInteger(s)&&(s=BigInt(s)),typeof s=="bigint"&&s<e){if(t){if(ft<s)return s}else if(ft<=s)return s}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function mf(s){return s[0]&=248,s[31]&=127,s[31]|=64,s}async function bi(s){if(s=typeof s=="bigint"||typeof s=="number"?qu(ai(s,Uu)):mn(s),s.length!==32)throw new Error("Expected 32 bytes");const e=await Di.sha512(s),t=mf(e.slice(0,32)),r=e.slice(32,64),n=ne(cr(t),We.l),i=it.BASE.multiply(n),a=i.toRawBytes();return{head:t,prefix:r,scalar:n,point:i,pointBytes:a}}async function gf(s){return(await bi(s)).pointBytes}async function bf(s,e){s=mn(s);const{prefix:t,scalar:r,pointBytes:n}=await bi(e),i=await Gi(t,s),a=it.BASE.multiply(i),o=await Gi(a.toRawBytes(),n,s),u=ne(i+o*r,We.l);return new Rr(a,u).toRawBytes()}async function Df(s,e,t){e=mn(e),t instanceof it||(t=it.fromHex(t,!1));const{r,s:n}=s instanceof Rr?s.assertValidity():Rr.fromHex(s),i=Le.BASE.multiplyUnsafe(n),a=await Gi(r.toRawBytes(),t.toRawBytes(),e),o=Le.fromAffine(t).multiplyUnsafe(a);return Le.fromAffine(r).add(o).subtract(i).multiplyUnsafe(We.h).equals(Le.ZERO)}it.BASE._setWindowSize(8);const ln={node:Gl,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},Di={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:Nr,getExtendedPublicKey:bi,mod:ne,invert:gi,hashToPrivateScalar:s=>{if(s=mn(s),s.length<40||s.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const e=ne(cr(s),We.l);if(e===ft||e===Ne)throw new Error("Invalid private key");return e},randomBytes:(s=32)=>{if(ln.web)return ln.web.getRandomValues(new Uint8Array(s));if(ln.node){const{randomBytes:e}=ln.node;return new Uint8Array(e(s).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Di.randomBytes(32),sha512:async s=>{if(ln.web){const e=await ln.web.subtle.digest("SHA-512",s.buffer);return new Uint8Array(e)}else{if(ln.node)return Uint8Array.from(ln.node.createHash("sha512").update(s).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(s=8,e=it.BASE){const t=e.equals(it.BASE)?e:new it(e.x,e.y);return t._setWindowSize(s),t.multiply(yt),t}};var xe=globalThis&&globalThis.__classPrivateFieldGet||function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},rt=globalThis&&globalThis.__classPrivateFieldSet||function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},Gt,Yt,Jt,Xt,en,tn,Fn,mt;const et=11400714785074694791n,ht=14029467366897019727n,qs=1609587929392839161n,_r=9650029242287828579n,Ws=2870177450012600261n,Wu=64n,_f=2n**Wu-1n,wf=new us;function Vs(s,e,t,r){return BigInt(s)|BigInt(e)<<16n|BigInt(t)<<32n|BigInt(r)<<48n}function Zt(s,e){return BigInt(s[e])|BigInt(s[e+1])<<8n|BigInt(s[e+2])<<16n|BigInt(s[e+3])<<24n|BigInt(s[e+4])<<32n|BigInt(s[e+5])<<40n|BigInt(s[e+6])<<48n|BigInt(s[e+7])<<56n}function at(s,e){return s<<e&_f|s>>Wu-e}function Te(s){return BigInt.asUintN(64,s)}class fs{constructor(e=0){Gt.set(this,void 0),Yt.set(this,void 0),Jt.set(this,void 0),Xt.set(this,void 0),en.set(this,void 0),tn.set(this,void 0),Fn.set(this,void 0),mt.set(this,void 0),this.reset(e)}reset(e=xe(this,Gt,"f")){return rt(this,Gt,BigInt.asUintN(32,BigInt(e)),"f"),rt(this,Yt,Te(xe(this,Gt,"f")+et+ht),"f"),rt(this,Jt,Te(xe(this,Gt,"f")+ht),"f"),rt(this,Xt,xe(this,Gt,"f"),"f"),rt(this,en,Te(xe(this,Gt,"f")-et),"f"),rt(this,tn,null,"f"),rt(this,Fn,0,"f"),rt(this,mt,0,"f"),this}update(e){typeof e=="string"&&(e=wf.encode(e));let t=0,r=e.length,n=t+r;if(r===0)return this;if(rt(this,Fn,xe(this,Fn,"f")+r,"f"),xe(this,mt,"f")===0&&rt(this,tn,new Uint8Array(32),"f"),xe(this,mt,"f")+r<32)return xe(this,tn,"f").set(e.subarray(0,r),xe(this,mt,"f")),rt(this,mt,xe(this,mt,"f")+r,"f"),this;if(xe(this,mt,"f")>0){xe(this,tn,"f").set(e.subarray(0,32-xe(this,mt,"f")),xe(this,mt,"f"));let i=0,a;a=Zt(xe(this,tn,"f"),i),rt(this,Yt,Te(at(Te(xe(this,Yt,"f")+a*ht),31n)*et),"f"),i+=8,a=Zt(this.memory,i),rt(this,Jt,Te(at(Te(xe(this,Jt,"f")+a*ht),31n)*et),"f"),i+=8,a=Zt(this.memory,i),rt(this,Xt,Te(at(Te(xe(this,Xt,"f")+a*ht),31n)*et),"f"),i+=8,a=Zt(this.memory,i),rt(this,en,Te(at(Te(xe(this,en,"f")+a*ht),31n)*et),"f"),t+=32-xe(this,mt,"f"),rt(this,mt,0,"f")}if(t<=n-32){const i=n-32;do{let a;a=Zt(e,t),rt(this,Yt,Te(at(Te(xe(this,Yt,"f")+a*ht),31n)*et),"f"),t+=8,a=Zt(e,t),rt(this,Jt,Te(at(Te(xe(this,Jt,"f")+a*ht),31n)*et),"f"),t+=8,a=Zt(e,t),rt(this,Xt,Te(at(Te(xe(this,Xt,"f")+a*ht),31n)*et),"f"),t+=8,a=Zt(e,t),rt(this,en,Te(at(Te(xe(this,en,"f")+a*ht),31n)*et),"f"),t+=8}while(t<=i)}return t<n&&(xe(this,tn,"f").set(e.subarray(t,n),xe(this,mt,"f")),rt(this,mt,n-t,"f")),this}digest(){let e=xe(this,tn,"f"),t=xe(this,mt,"f"),r=0,n=0n,i=0n,a=0n;for(xe(this,Fn,"f")>=32?(n=at(xe(this,Yt,"f"),1n)+at(xe(this,Jt,"f"),7n)+at(xe(this,Xt,"f"),12n)+at(xe(this,en,"f"),18n),n=Te(n^at(Te(xe(this,Yt,"f")*ht),31n)*et),n=Te(n*et+_r),n=Te(n^at(Te(xe(this,Jt,"f")*ht),31n)*et),n=Te(n*et+_r),n=Te(n^at(Te(xe(this,Xt,"f")*ht),31n)*et),n=Te(n*et+_r),n=Te(n^at(Te(xe(this,en,"f")*ht),31n)*et),n=Te(n*et+_r)):n=Te(xe(this,Gt,"f")+Ws),n+=BigInt(xe(this,Fn,"f"));r<=t-8;)a=Zt(e,r),a=Te(at(Te(a*ht),31n)*et),n=Te(at(n^a,27n)*et+_r),r+=8;for(r+4<=t&&(a=Vs(e[r+1]<<8|e[r],e[r+3]<<8|e[r+2],0,0),n=Te(at(n^Te(a*et),23n)*ht+qs),r+=4);r<t;)a=Vs(e[r++],0,0,0),n=Te(at(n^Te(a*Ws),11n)*et);return i=Te(n>>33n),n=Te((n^i)*ht),i=Te(n>>29n),n=Te((n^i)*qs),i=Te(n>>32n),n=Te(n^i),n}}Gt=new WeakMap,Yt=new WeakMap,Jt=new WeakMap,Xt=new WeakMap,en=new WeakMap,tn=new WeakMap,Fn=new WeakMap,mt=new WeakMap;function yf(s,e=0){return new fs(e).update(s).digest()}function Vu(s,e){return s<e?-1:s>e?1:0}class Sn{constructor(e,t){Object.defineProperty(this,"parent",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"left",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"right",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.left=null,this.right=null}static from(e){const t=new Sn(e.parent,e.value);return t.left=e.left,t.right=e.right,t}directionFromParent(){return this.parent===null?null:this===this.parent.left?"left":this===this.parent.right?"right":null}findMinNode(){let e=this.left;for(;e!=null&&e.left;)e=e.left;return e??this}findMaxNode(){let e=this.right;for(;e!=null&&e.right;)e=e.right;return e??this}findSuccessorNode(){if(this.right!==null)return this.right.findMinNode();let e=this.parent,t=this.directionFromParent();for(;e&&t==="right";)t=e.directionFromParent(),e=e.parent;return e}}class qn{constructor(e=Vu){Object.defineProperty(this,"compare",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"root",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_size",{enumerable:!0,configurable:!0,writable:!0,value:0})}static from(e,t){let r,n=[];if(e instanceof qn)if(r=new qn((t==null?void 0:t.compare)??e.compare),t!=null&&t.compare||t!=null&&t.map)n=e;else{const a=[];for(e.root&&(r.root=Sn.from(e.root),a.push(r.root));a.length;){const o=a.pop(),u=o.left?Sn.from(o.left):null,l=o.right?Sn.from(o.right):null;u&&(u.parent=o,a.push(u)),l&&(l.parent=o,a.push(l))}}else r=t!=null&&t.compare?new qn(t.compare):new qn,n=e;const i=t!=null&&t.map?Array.from(n,t.map,t.thisArg):n;for(const a of i)r.insert(a);return r}get size(){return this._size}findNode(e){let t=this.root;for(;t;){const r=this.compare(e,t.value);if(r===0)break;const n=r<0?"left":"right";t=t[n]}return t}rotateNode(e,t){const r=t==="left"?"right":"left";if(!e[r])throw new TypeError(`cannot rotate ${t} without ${r} child`);const n=e[r];if(e[r]=n[t]??null,n[t]&&(n[t].parent=e),n.parent=e.parent,e.parent){const i=e===e.parent[t]?t:r;e.parent[i]=n}else this.root=n;n[t]=e,e.parent=n}insertNode(e,t){if(this.root){let r=this.root;for(;;){const n=this.compare(t,r.value);if(n===0)break;const i=n<0?"left":"right";if(r[i])r=r[i];else return r[i]=new e(r,t),this._size++,r[i]}}else return this.root=new e(null,t),this._size++,this.root;return null}removeNode(e){let t=this.findNode(e);if(t){const r=!t.left||!t.right?t:t.findSuccessorNode(),n=r.left??r.right;n&&(n.parent=r.parent),r.parent?r.parent[r.directionFromParent()]=n:this.root=n,r!==t&&(t.value=r.value,t=r),this._size--}return t}insert(e){return!!this.insertNode(Sn,e)}remove(e){return!!this.removeNode(e)}find(e){var t;return((t=this.findNode(e))==null?void 0:t.value)??null}min(){return this.root?this.root.findMinNode().value:null}max(){return this.root?this.root.findMaxNode().value:null}clear(){this.root=null,this._size=0}isEmpty(){return this.size===0}*lnrValues(){const e=[];let t=this.root;for(;e.length||t;)t?(e.push(t),t=t.left):(t=e.pop(),yield t.value,t=t.right)}*rnlValues(){const e=[];let t=this.root;for(;e.length||t;)t?(e.push(t),t=t.right):(t=e.pop(),yield t.value,t=t.left)}*nlrValues(){const e=[];for(this.root&&e.push(this.root);e.length;){const t=e.pop();yield t.value,t.right&&e.push(t.right),t.left&&e.push(t.left)}}*lrnValues(){const e=[];let t=this.root,r=null;for(;e.length||t;)if(t)e.push(t),t=t.left;else{const n=e[e.length-1];n.right&&n.right!==r?t=n.right:(yield n.value,r=e.pop())}}*lvlValues(){const e=[];let t=this.root;for(;t;)yield t.value,t.left&&e.push(t.left),t.right&&e.push(t.right),t=e.shift()??null}*[Symbol.iterator](){yield*this.lnrValues()}}class Bn extends Sn{constructor(e,t){super(e,t),Object.defineProperty(this,"red",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.red=!0}static from(e){const t=new Bn(e.parent,e.value);return t.left=e.left,t.right=e.right,t.red=e.red,t}}class Wn extends qn{constructor(e=Vu){super(e)}static from(e,t){let r,n=[];if(e instanceof Wn)if(r=new Wn((t==null?void 0:t.compare)??e.compare),t!=null&&t.compare||t!=null&&t.map)n=e;else{const a=[];for(e.root&&(r.root=Bn.from(e.root),a.push(r.root));a.length;){const o=a.pop(),u=o.left?Bn.from(o.left):null,l=o.right?Bn.from(o.right):null;u&&(u.parent=o,a.push(u)),l&&(l.parent=o,a.push(l))}}else r=t!=null&&t.compare?new Wn(t.compare):new Wn,n=e;const i=t!=null&&t.map?Array.from(n,t.map,t.thisArg):n;for(const a of i)r.insert(a);return r}removeFixup(e,t){var r,n,i;for(;e&&!(t!=null&&t.red);){const a=e.left===t?"left":"right",o=a==="right"?"left":"right";let u=e[o];u!=null&&u.red&&(u.red=!1,e.red=!0,this.rotateNode(e,a),u=e[o]),u&&(!((r=u.left)!=null&&r.red)&&!((n=u.right)!=null&&n.red)?(u.red=!0,t=e,e=t.parent):((i=u[o])!=null&&i.red||(u[a].red=!1,u.red=!0,this.rotateNode(u,o),u=e[o]),u.red=e.red,e.red=!1,u[o].red=!1,this.rotateNode(e,a),t=this.root,e=null))}t&&(t.red=!1)}insert(e){var r;let t=this.insertNode(Bn,e);if(t){for(;(r=t.parent)!=null&&r.red;){let n=t.parent;const i=n.directionFromParent(),a=i==="right"?"left":"right",o=n.parent[a]??null;o!=null&&o.red?(n.red=!1,o.red=!1,n.parent.red=!0,t=n.parent):(t===n[a]&&(t=n,this.rotateNode(t,i),n=t.parent),n.red=!1,n.parent.red=!0,this.rotateNode(n.parent,a))}this.root.red=!1}return!!t}remove(e){const t=this.removeNode(e);return t&&!t.red&&this.removeFixup(t.parent,t.left??t.right),!!t}}function Pi(s,e){return{lift:t=>[s.lift(t),e.lift(t)],combine:(t,r)=>{const n=s.combine(t[0],r[0]),i=e.combine(t[1],r[1]);return[n,i]},neutral:[s.neutral,e.neutral]}}const vf={lift:s=>1,combine:(s,e)=>s+e,neutral:0};class Ks extends Bn{constructor(e,t,r){super(e,t),Object.defineProperty(this,"label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"liftedValue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"monoid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.label=r.neutral,this.liftedValue=r.lift(t),this.monoid=r}updateLabel(e=!0,t){var r;this.left!==null&&this.right===null?this.label=this.monoid.combine(this.left.label,this.liftedValue):this.left===null&&this.right!==null?this.label=this.monoid.combine(this.liftedValue,this.right.label):this.left&&this.right?this.label=this.monoid.combine(this.left.label,this.monoid.combine(this.liftedValue,this.right.label)):this.label=this.liftedValue,e&&((r=this.parent)==null||r.updateLabel(!0,"Updated by child"))}}class Cf extends Wn{constructor(e,t){super(t),Object.defineProperty(this,"monoid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedMinNode",{enumerable:!0,configurable:!0,writable:!0,value:null});const i=Pi({lift:a=>[a],combine:(a,o)=>a.concat(o),neutral:[]},{lift:a=>a,combine:(a,o)=>{if(!(a===void 0&&o===void 0))return o===void 0?a:a===void 0?o:t(a,o)>0?a:o},neutral:void 0});this.monoid=Pi(e,Pi(vf,i))}getLowestValue(){if(!this.root)throw new Error("Can't get a range from a tree with no items");return this.cachedMinNode?this.cachedMinNode.value:this.root.findMinNode().value}rotateNode(e,t){var i;const r=t==="left"?"right":"left";if(!e[r])throw new TypeError(`cannot rotate ${t} without ${r} child`);const n=e[r];if(e[r]=n[t]??null,n[t]&&(n[t].parent=e),n.parent=e.parent,e.parent){const a=e===e.parent[t]?t:r;e.parent[a]=n}else this.root=n;n[t]=e,e.parent=n,(i=n[t])==null||i.updateLabel(!1,"Node rotated")}removeFixup(e,t){var r,n,i;for(;e&&!(t!=null&&t.red);){const a=e.left===t?"left":"right",o=a==="right"?"left":"right";let u=e[o];u!=null&&u.red&&(u.red=!1,e.red=!0,this.rotateNode(e,a),u=e[o]),u&&(!((r=u.left)!=null&&r.red)&&!((n=u.right)!=null&&n.red)?(u.red=!0,t=e,e=t.parent):((i=u[o])!=null&&i.red||(u[a].red=!1,u.red=!0,this.rotateNode(u,o),u=e[o]),u.red=e.red,e.red=!1,u[o].red=!1,this.rotateNode(e,a),t=this.root,e=null))}t&&(t.red=!1)}insertFingerprintNode(e){if(this.root){let t=this.root,r=!0;for(;;){const n=this.compare(e,t.value);if(n===0){r=!1;break}const i=n<0?"left":"right";if(r&&i==="right"&&(r=!1),t[i])t=t[i];else return t[i]=new Ks(t,e,this.monoid),this._size++,r&&(this.cachedMinNode=t[i]),t[i]}}else return this.root=new Ks(null,e,this.monoid),this._size++,this.cachedMinNode=this.root,this.root;return null}insert(e){var n;const t=this.insertFingerprintNode(e);let r=t;if(r){for(;(n=r.parent)!=null&&n.red;){let i=r.parent;const a=i.directionFromParent(),o=a==="right"?"left":"right",u=i.parent[o]??null;u!=null&&u.red?(i.red=!1,u.red=!1,i.parent.red=!0,r=i.parent):(r===i[o]&&(r=i,this.rotateNode(r,a),i=r.parent),i.red=!1,i.parent.red=!0,this.rotateNode(i.parent,o))}this.root.red=!1}return t==null||t.updateLabel(!0,"Node inserted"),!!r}remove(e){var r;const t=this.removeNode(e);return t&&!t.red&&this.removeFixup(t.parent,t.left??t.right),t&&((r=t.parent)==null||r.updateLabel(!0,"Child node removed")),!!t}getFingerprint(e,t,r){if(this.root===null)return{fingerprint:this.monoid.neutral[0],size:0,items:[],nextTree:null};const n=this.compare(e,t);if(n===0)return{fingerprint:this.root.label[0],size:this.root.label[1][0],items:this.root.label[1][1][0],nextTree:this.cachedMinNode};if(n<0){const i=this.compare(e,this.cachedMinNode.value)<=0?this.cachedMinNode:null,a=r||i||this.findGteNode(e),{label:o,nextTree:u}=this.aggregateUntil(a,e,t);return{fingerprint:o[0],size:o[1][0],items:o[1][1][0],nextTree:u}}else{const i=this.cachedMinNode,a=this.root.label[1][1][1],o=this.compare(t,i.value)>0,u=this.compare(e,a)<=0;if(o&&u){const{label:l,nextTree:c}=this.aggregateUntil(i,i.value,t),d=[this.monoid.lift(a)[0],[1,[[a],a]]],h=r||this.findGteNode(e),{label:p}=this.aggregateUntil(h,e,a),m=this.monoid.combine(p,d),b=this.monoid.combine(l,m);return{fingerprint:b[0],size:b[1][0],items:b[1][1][0],nextTree:c}}else if(o){const{label:l,nextTree:c}=this.aggregateUntil(i,i.value,t);return{fingerprint:l[0],size:l[1][0],items:l[1][1][0],nextTree:c}}else{const l=this.compare(e,this.cachedMinNode.value)<=0?this.cachedMinNode:null,c=r||l||this.findGteNode(e),{label:f}=this.aggregateUntil(c,e,a),h=[this.monoid.lift(a)[0],[1,[[a],a]]],p=this.monoid.combine(f,h);return{fingerprint:p[0],size:p[1][0],items:p[1][1][0],nextTree:l}}}}findGteNode(e){let t=this.root;for(;t;){const r=this.compare(e,t.value);if(r===0)break;const n=r<0?"left":"right";if(t[n])t=t[n];else break}return t}aggregateUntil(e,t,r){const{label:n,nextTree:i}=this.aggregateUp(e,t,r);return i===null||this.compare(i.value,r)>=0?{label:n,nextTree:i}:this.aggregateDown(i.right,r,this.monoid.combine(n,i.liftedValue))}aggregateUp(e,t,r){var a;let n=this.monoid.neutral,i=e;for(;this.compare(i.label[1][1][1],r)<0;){if(this.compare(i.value,t)>=0&&(n=this.monoid.combine(n,this.monoid.combine(i.liftedValue,((a=i.right)==null?void 0:a.label)||this.monoid.neutral))),i.parent===null)return{label:n,nextTree:null};i=i.parent}return{label:n,nextTree:i}}aggregateDown(e,t,r){var a,o;let n=e,i=r;for(;n!==null;)if(this.compare(n.value,t)<0)i=this.monoid.combine(i,this.monoid.combine(((a=n.left)==null?void 0:a.label)||this.monoid.neutral,n.liftedValue)),n=n.right;else{if(n.left===null||this.compare(n.label[1][1][1],t)<0)return{label:this.monoid.combine(i,((o=n.left)==null?void 0:o.label)||this.monoid.neutral),nextTree:n};n=n.left}return{label:i,nextTree:null}}isValueEqual(e,t){return this.compare(e,t)===0}}function Af(){let s,e="pending";const t=new Promise((r,n)=>{s={async resolve(i){await i,e="fulfilled",r(i)},reject(i){e="rejected",n(i)}}});return Object.defineProperty(t,"state",{get:()=>e}),Object.assign(t,s)}class kf{constructor(){Object.defineProperty(this,"deferreds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"pending"})}resolve(e){if(this.state==="pending"){this.state="fulfilled";for(const t of this.deferreds)t.resolve(e)}}reject(e){if(this.state==="pending"){this.state="rejected";for(const t of this.deferreds)t.reject(e)}}tee(){const e=Af();return this.state==="fulfilled"?e.resolve():this.state==="rejected"?e.reject():this.deferreds.add(e),e}}class Ef{constructor(e){Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDoneTee",{enumerable:!0,configurable:!0,writable:!0,value:new kf}),Object.defineProperty(this,"insertionCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"fingerprintEquals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowerBoundFromPrev",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"collatedPayload",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"collatePayloads",{enumerable:!0,configurable:!0,writable:!0,value:t=>{switch(t.type){case"payload":{let r=this.collatedPayload;if(r===null&&(r={type:"payload",lowerBound:t.lowerBound,payload:[],end:{canRespond:!1,upperBound:t.payload}}),r.payload.push(t.payload),this.collatedPayload=r,t.end)return t.end.upperBound?r.end=t.end:r.end={...t.end,upperBound:t.payload},this.collatedPayload=null,r;break}default:return this.collatedPayload&&(this.collatedPayload=null),t}}}),Object.defineProperty(this,"reusableTree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastAdjacentDoneUpperBound",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"isDoneSoFar",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.tree=e.tree,this.fingerprintEquals=e.fingerprintEquals,this.encoding=e.encoding,this.payloadThreshold=e.payloadThreshold,this.rangeDivision=e.rangeDivision}decode(e){const t=this.lowerBoundFromPrev;try{switch(this.encoding.decode.getType(e)){case"payload":{const n=this.encoding.decode.payload(e);return n.end&&(this.lowerBoundFromPrev=n.end.upperBound),{type:"payload",lowerBound:t,payload:n.value,...n.end?{end:n.end}:{}}}case"fingerprint":{const n=this.encoding.decode.fingerprint(e);return this.lowerBoundFromPrev=n.upperBound,{type:"fingerprint",lowerBound:t,fingerprint:n.fingerprint,upperBound:n.upperBound}}case"emptyPayload":{const n=this.encoding.decode.emptyPayload(e);return this.lowerBoundFromPrev=n,{lowerBound:t,type:"emptyPayload",upperBound:n}}case"done":{const n=this.encoding.decode.done(e);return this.lowerBoundFromPrev=n,{lowerBound:t,type:"done",upperBound:n}}case"emptySet":return{type:"emptySet",canRespond:this.encoding.decode.emptySet(e)};case"lowerBound":{const n=this.encoding.decode.lowerBound(e);return this.lowerBoundFromPrev=n,{type:"lowerBound",value:n}}case"terminal":return this.encoding.decode.terminal(e),{type:"terminal"}}}catch(r){console.group("range-reconcile: Could not decode message"),console.warn(e),console.warn(r)}return null}setReusableTree(e){this.reusableTree=e||void 0}process(e){const t=this.reusableTree;switch(e.type){case"lowerBound":case"terminal":case"done":return this.setReusableTree(null),[e];case"emptySet":{if(e.canRespond===!1&&this.isDoneTee.resolve(),this.tree.size===0)return[{type:"emptySet",canRespond:!1}];const r=this.tree.getLowestValue(),n=[{type:"lowerBound",value:r}],{items:i}=this.tree.getFingerprint(r,r);for(let a=0;a<i.length;a++){const o=i[a];a===i.length-1?n.push({type:"payload",payload:o,end:{upperBound:r,canRespond:!1}}):n.push({type:"payload",payload:o})}return n.push({type:"terminal"}),n}case"fingerprint":{const{fingerprint:r,size:n,items:i,nextTree:a}=this.tree.getFingerprint(e.lowerBound,e.upperBound,t);if(this.setReusableTree(a),this.fingerprintEquals(r,e.fingerprint))return[{type:"done",upperBound:e.upperBound}];if(n<=this.payloadThreshold){if(n===0)return[{type:"emptyPayload",upperBound:e.upperBound}];const o=[];for(let u=0;u<n;u++)o.push({type:"payload",payload:i[u],...u===i.length-1?{end:{upperBound:e.upperBound,canRespond:!0}}:{}});return o}else{const o=Math.ceil(n/this.rangeDivision),u=[];if(o<=this.payloadThreshold){for(let d=0;d<i.length;d++)u.push({type:"payload",payload:i[d],...d===i.length-1?{end:{upperBound:e.upperBound,canRespond:!0}}:{}});return u}let l;const c=i;let f=!1;if(e.lowerBound>=e.upperBound){let d=0;for(let h=0;h<=i.length;h++)if(i[h]>=e.lowerBound){d=h;break}if(d>0){const h=c.splice(0,d);c.push(...h),f=!0}}for(let d=0;d<n;d+=o){const h=c[d],p=c[d+o]||e.upperBound,{fingerprint:m,nextTree:b}=this.tree.getFingerprint(h,p,l);l=f?void 0:b||void 0,u.push({type:"fingerprint",fingerprint:m,upperBound:p})}return u}}case"payload":{for(const r of e.payload){this.tree.insert(r);for(const n of this.insertionCallbacks)n(r)}if(e.end.canRespond){const{items:r,size:n,nextTree:i}=this.tree.getFingerprint(e.lowerBound,e.end.upperBound,t);if(this.setReusableTree(i),n===0)return[{type:"emptyPayload",upperBound:e.end.upperBound}];const a=[];for(let u=0;u<n;u++){let l=!1;for(let c=0;c<e.payload.length;c++)this.tree.isValueEqual(r[u],e.payload[c])&&(l=!0);l||a.push({type:"payload",payload:r[u]})}const o=a[a.length-1];return a[a.length-1]={...o,end:{upperBound:e.end.upperBound,canRespond:!1}},a}else return this.setReusableTree(null),[{type:"done",upperBound:e.end.upperBound}]}case"emptyPayload":{this.setReusableTree(null);const{items:r,size:n,nextTree:i}=this.tree.getFingerprint(e.lowerBound,e.upperBound);if(this.setReusableTree(i),n===0)return this.setReusableTree(null),[];const a=[];for(let o=0;o<n;o++)a.push({type:"payload",payload:r[o],...o===r.length-1?{end:{upperBound:e.upperBound,canRespond:!1}}:{}});return a}}}consolidateAdjacentDones(e){switch(e.type){case"done":{this.lastAdjacentDoneUpperBound=e.upperBound;break}default:{const t=this.lastAdjacentDoneUpperBound;return t?(this.lastAdjacentDoneUpperBound=null,[{type:"done",upperBound:t},e]):[e]}}}checkIsDone(e){var t;if(this.isDoneTee.state==="pending")switch(e.type){case"emptySet":{e.canRespond&&(this.isDoneSoFar=!1);break}case"lowerBound":break;case"fingerprint":this.isDoneSoFar=!1;break;case"emptyPayload":this.isDoneSoFar=!1;break;case"payload":((t=e.end)==null?void 0:t.canRespond)===!0&&(this.isDoneSoFar=!1);break;case"terminal":this.isDoneSoFar?this.isDoneTee.resolve():this.isDoneSoFar=!0}}encode(e){let t;switch(e.type){case"emptySet":{t=this.encoding.encode.emptySet(e.canRespond);break}case"lowerBound":{t=this.encoding.encode.lowerBound(e.value);break}case"done":{t=this.encoding.encode.done(e.upperBound);break}case"fingerprint":{t=this.encoding.encode.fingerprint(e.fingerprint,e.upperBound);break}case"payload":{t=this.encoding.encode.payload(e.payload,e.end);break}case"emptyPayload":{t=this.encoding.encode.emptyPayload(e.upperBound);break}case"terminal":{t=this.encoding.encode.terminal();break}}return t}respond(e){if(this.isDone().state==="fulfilled")return[];const t=this.decode(e),r=this.collatePayloads(t);if(r===void 0)return[];const n=this.process(r),i=[];for(const o of n){const u=this.consolidateAdjacentDones(o);u&&i.push(...u)}for(const o of i)this.checkIsDone(o);const a=[];for(const o of i)a.push(this.encode(o));return a}isDone(){return this.isDoneTee.tee()}initialMessages(e){const{tree:t,encoding:r,payloadThreshold:n,rangeDivision:i}=this;function*a(){if(t.size===0){yield r.encode.emptySet(!0);return}const o=t.getLowestValue();yield r.encode.lowerBound(o);const{items:l}=t.getFingerprint(o,o),f=(e||(p=>{const m=Math.ceil(p.length/i),b=[];for(let g=0;g<p.length;g+=m){const D=p.slice(g,g+m);b.push(D)}return b}))(l);let d;for(let p=0;p<f.length;p++){const m=f[p+1]?f[p+1][0]:o,b=f[p];if(b.length<=n)for(let g=0;g<b.length;g++)yield r.encode.payload(b[g],g===b.length-1?{upperBound:m,canRespond:!0}:void 0);else{const g=b[0],{fingerprint:D,nextTree:v}=t.getFingerprint(g,m,d);d=v||void 0,yield r.encode.fingerprint(D,m)}}yield r.encode.terminal()}return a()}onInsertion(e){return this.insertionCallbacks.add(e),()=>{this.insertionCallbacks.delete(e)}}}var dt=globalThis&&globalThis.__classPrivateFieldGet||function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},Wr=globalThis&&globalThis.__classPrivateFieldSet||function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},yn,vn,wr,Qt,Oi,Vr;const Zs=Symbol("Stream ended."),Ni=Symbol("Stream errored.");class rn{constructor(e){var t,r,n;yn.add(this),vn.set(this,[]),wr.set(this,null),Qt.set(this,void 0),Object.defineProperty(this,"push",{enumerable:!0,configurable:!0,writable:!0,value:(...i)=>{i.length?dt(this,yn,"m",Vr).call(this,!1,i):(dt(this,yn,"m",Vr).call(this,!1,[Ni]),dt(this,yn,"m",Oi).call(this,new Error("AsyncQueueError: queue.push was called with no arguments")))}}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:({immediately:i=!1,withError:a}={})=>{a&&dt(this,yn,"m",Oi).call(this,a),dt(this,yn,"m",Vr).call(this,i,[a?Ni:Zs]),this.push=this.close=()=>{}}}),(n=(r=(t=e==null?void 0:e.catch)==null?void 0:t.call(e,i=>this.close({withError:i})))==null?void 0:r.finally)==null||n.call(r,()=>this.close())}get length(){return dt(this,vn,"f").length}async*[(vn=new WeakMap,wr=new WeakMap,Qt=new WeakMap,yn=new WeakSet,Oi=function(t){dt(this,Qt,"f")instanceof AggregateError?dt(this,Qt,"f").errors.push(t):dt(this,Qt,"f")?Wr(this,Qt,new AggregateError([dt(this,Qt,"f"),t]),"f"):Wr(this,Qt,t,"f")},Vr=function(t,r){var n;dt(this,vn,"f")[t?"unshift":"push"](...r),(n=dt(this,wr,"f"))==null||n.call(this,dt(this,vn,"f").shift()),Wr(this,wr,null,"f")},Symbol.asyncIterator)](){for(;;){const e=dt(this,vn,"f").length?dt(this,vn,"f").shift():await new Promise(t=>{Wr(this,wr,t,"f")});if(e===Ni)throw dt(this,Qt,"f");if(e===Zs)break;yield e}}}function Ie(){let s,e="pending";const t=new Promise((r,n)=>{s={async resolve(i){await i,e="fulfilled",r(i)},reject(i){e="rejected",n(i)}}});return Object.defineProperty(t,"state",{get:()=>e}),Object.assign(t,s)}new vu;const Ff=new us;function Yi(s){return Ff.encode(s)}function Sf(s){return Yi(s).length}function Ji(s,e){for(let t of s)if(e.indexOf(t)===-1)return!1;return!0}function Qs(s){return s===""?!1:_i.indexOf(s)!==-1}const Mr="abcdefghijklmnopqrstuvwxyz",Bf=Mr.toUpperCase(),_i="0123456789",qt=Mr+"234567",Ku=Mr+_i,If=qt,Zu=Ku+qt+"@.",Qu=Mr+_i,Tf=qt,Gu=Qu+qt+"+.",Rf="/'()-._~!$&+,:=@%",Yu=Mr+Bf+_i+Rf;function xf(s,e){return`@${s}.${e}`}function Pf(s,e){return`+${s}.${e}`}function wi(s){const e=Ju(s);return bu(e)?!0:e}function bn(s){const e=yi(s);return bu(e)?!0:e}function Xi(s){return s.startsWith("@")?Ju(s):s.startsWith("+")?yi(s):new ie("address must start with either @ or +")}function Ju(s){return Xu(s,{sigil:"@",separator:".",minNameLength:4,maxNameLength:4,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:Ku,allowedPubkeyCharacters:If,pubkeyMustStartWithB:!0})}function yi(s){return Xu(s,{sigil:"+",separator:".",minNameLength:1,maxNameLength:15,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:Qu,allowedPubkeyCharacters:Tf,pubkeyMustStartWithB:!0})}function Xu(s,e){const{sigil:t,separator:r,minNameLength:n,maxNameLength:i,minPubkeyLength:a,maxPubkeyLength:o,allowedNameCharacters:u,allowedPubkeyCharacters:l,pubkeyMustStartWithB:c}=e;if(typeof s!="string")return new ie("address must be a string");if(s.length<4)return new ie("address is too short");if(s[0]!==t)return new ie(`address must start with a sigil: "${t}"`);if(s.indexOf(r)===-1)return new ie(`address must contain a separator character: "${r}"`);const f=s.slice(1).split(r);if(f.length!==2)return new ie(`address must have exactly 2 parts separated by a "${r}" separator`);const[d,h]=f;return d.length<n||d.length>i?new ie(`name must be between ${n} and ${i} characters long, but is ${d.length}`):h.length<a||h.length>o?new ie(`pubkey must be between ${a} and ${o} characters long, but is ${h.length}`):Ji(d,u)?Ji(h,l)?Qs(d[0])?new ie(`name "${d}" must not start with a digit`):Qs(h[0])?new ie(`pubkey "${h}" must not start with a digit`):c&&h[0]!=="b"?new ie(`pubkey "${h}" must start with 'b'`):{address:s,name:d,pubkey:h}:new ie(`pubkey "${h}" must only have allowed characters`):new ie(`name "${d}" must only have allowed characters`)}function hs(s){return!(Object.prototype.toString.call(s)!=="[object Object]"||(""+s.constructor).startsWith("class"))}function el(s){return e=>e!==s?`expected literal value ${JSON.stringify(s)}`:null}function kt(s={}){return e=>{if(s.optional!==!0&&e===void 0)return"required";if(s.optional===!0&&e===void 0)return null;let t=Sf(e);return typeof e!="string"?"expected a string but got "+JSON.stringify(e):s.minLen!==void 0&&t<s.minLen?`string shorter than min length of ${s.minLen} chars`:s.maxLen!==void 0&&t>s.maxLen?`string shorter than max length of ${s.maxLen} chars`:s.len!==void 0&&t!==s.len?`string does not have required length of ${s.len} chars: ${e}`:s.allowedChars!==void 0&&!Ji(e,s.allowedChars)?"contains disallowed characters":null}}function Sr(s={}){return e=>s.optional!==!0&&e===void 0?"required":s.optional===!0&&e===void 0?null:s.nullable!==!0&&e===null?"not nullable":s.nullable===!0&&e===null?null:typeof e!="number"?"expected a number but got "+JSON.stringify(e):isNaN(e)?"is NaN":isFinite(e)?e!==Math.round(e)?"expected an integer":s.min!==void 0&&e<s.min?`integer too small (must be >= ${s.min})`:s.max!==void 0&&e>s.max?`integer too large (must be <= ${s.max})`:null:"is Infinity"}function tl(s={}){return s.allowLiteralUndefined=s.allowLiteralUndefined??!1,s.allowExtraKeys=s.allowExtraKeys??!1,e=>{if(!hs(e))return"expected an object";if(s.allowLiteralUndefined===!1){for(let[t,r]of Object.entries(e))if(r===void 0)return`${t} is explicitly set to undefined but should be missing instead`}if(s.objSchema!==void 0){if(s.allowExtraKeys===!1){let t=Object.keys(e),r=Object.keys(s.objSchema),n=t.filter(i=>r.indexOf(i)===-1);if(n.length>0)return`object has extra keys not in the schema: ${n.join(", ")}`}for(let[t,r]of Object.entries(s.objSchema)){let n=r(e[t]);if(n!==null)return`${t}: ${n}`}}return null}}const{codec:nl}=Vc,rl={chars:"abcdefghijklmnopqrstuvwxyz234567",bits:5};function zn(s){return"b"+nl.stringify(s,rl,{pad:!1})}function oi(s){if(!s.startsWith("b"))throw new ie("can't decode base32 string - it should start with a 'b'. "+s);if(s[s.length-1]==="=")throw new ie("can't decode base32 string - it contains padding characters ('=')");return nl.parse(s.slice(1),rl,{loose:!0})}var nn;(function(s){s[s.None=-1]="None",s[s.Error=0]="Error",s[s.Warn=1]="Warn",s[s.Log=2]="Log",s[s.Info=3]="Info",s[s.Debug=4]="Debug"})(nn||(nn={}));const Of=nn.Error;let Mi={_default:Of};function Nf(s){return s in Mi?Mi[s]:Mi._default}class Dt{constructor(e,t){Object.defineProperty(this,"source",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.source=e,this.color=t||"aqua"}_print(e,t,r,...n){if(e<=Nf(this.source))if(t){const i=`[${this.source}]`;if(this.color!==void 0){const a=[`%c ${i}`,`color: ${this.color}`];console.log(r,...a,...n)}else console.log(r,i,...n)}else console.log(r,...n)}error(...e){this._print(nn.Error,!0,"!!",...e)}warn(...e){this._print(nn.Warn,!0,"! ",...e)}log(...e){this._print(nn.Log,!0,"  ",...e)}info(...e){this._print(nn.Info,!0,"    ",...e)}debug(...e){this._print(nn.Debug,!0,"      ",...e)}blank(){this._print(nn.Info,!1,"")}}class Mf{constructor(e){Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalDigest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.hash=e.hash,this.internalUpdate=e.update,this.internalDigest=e.digest}update(e){return this.hash=this.internalUpdate(this.hash,e),this.hash}digest(){return this.internalDigest(this.hash)}}const{createHash:Li}=sf,zi=new Dt("crypto-driver-noble","cyan"),Lf=class{static sha256(s){return typeof s=="string"?Promise.resolve(Li("sha256").update(s,"utf-8").digest()):Promise.resolve(Li("sha256").update(s).digest())}static updatableSha256(){return new Mf({hash:Li("sha256"),update:(s,e)=>s.update(e),digest:s=>s.digest()})}static async generateKeypairBytes(){zi.debug("generateKeypairBytes");const s=Di.randomPrivateKey();return{pubkey:await gf(s),secret:s}}static sign(s,e){return zi.debug("sign"),typeof e=="string"&&(e=Yi(e)),bf(e,s.secret)}static async verify(s,e,t){zi.debug("verify");try{return typeof t=="string"&&(t=Yi(t)),await Df(e,t,s)}catch{return!1}}};function Gs(){return Date.now()*1e3}function il(s){return new Promise(e=>{In(e,s)})}function sn(){return""+Math.floor(Math.random()*1e3)+Math.floor(Math.random()*1e3)}function zf(s){try{const e=sl(s)?s.address:s.shareAddress,t=Xi(e);if(se(t))return t;const r={pubkey:oi(t.pubkey),secret:oi(s.secret)};return r.pubkey.length!==32?new ie(`pubkey bytes should be 32 bytes long, not ${r.pubkey.length} after base32 decoding.  ${e}`):r.secret.length!==32?new ie(`secret bytes should be 32 bytes long, not ${r.secret.length} after base32 decoding.  ${s.secret}`):r}catch(e){return new ie("crash while decoding author keypair: "+e.message)}}function sl(s){return"address"in s}new Dt("crypto","cyan");let $n=Lf,yr=new Dt("crypto","cyan");const qe=class{static async sha256base32(s){const e=await $n.sha256(s);return zn(e)}static updatableSha256(){return $n.updatableSha256()}static async generateAuthorKeypair(s){yr.debug(`generateAuthorKeypair("${s}")`);const e=await $n.generateKeypairBytes(),t={address:xf(s,zn(e.pubkey)),secret:zn(e.secret)},r=wi(t.address);return se(r)?r:t}static async generateShareKeypair(s){yr.debug(`generateAuthorKeypair("${s}")`);const e=await $n.generateKeypairBytes(),t={shareAddress:Pf(s,zn(e.pubkey)),secret:zn(e.secret)},r=bn(t.shareAddress);return se(r)?r:t}static async sign(s,e){yr.debug("sign");try{const t=zf(s);if(se(t))return t;const r=await $n.sign(t,e);return zn(r)}catch(t){return new ie("unexpected error while signing: "+t.message)}}static verify(s,e,t){yr.debug("verify");try{const r=Xi(s);return se(r)?Promise.resolve(!1):$n.verify(oi(r.pubkey),oi(e),t)}catch{return Promise.resolve(!1)}}static async checkKeypairIsValid(s){yr.debug("checkAuthorKeypairIsValid");const e=sl(s)?s.address:s.shareAddress;try{if(typeof e!="string"||typeof s.secret!="string")return new ie("address and secret must be strings");const t=Xi(e);if(se(t))return t;const r="a test message to sign. "+sn(),n=await this.sign(s,r);return se(n)?n:await this.verify(e,n,r)===!1?new ie("pubkey does not match secret"):!0}catch(t){return new ie("unexpected error in checkAuthorKeypairIsValid: "+t.message)}}};var $f=globalThis&&globalThis.__setFunctionName||function(s,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(s,"name",{configurable:!0,value:t?"".concat(t," ",e):e})},Kr;new Dt("validator es.4","red");const jf=10,Uf=jf*60*1e3*1e3,Ys=1e13,Js=9007199254740990,Hf=4e6,qf=53,Wf=104,Xs={objSchema:{format:el("es.4"),author:kt({allowedChars:Zu}),content:kt({maxLen:Hf}),contentHash:kt({allowedChars:qt,len:qf}),deleteAfter:Sr({min:Ys,max:Js,nullable:!0}),path:kt({allowedChars:Yu,minLen:2,maxLen:512}),signature:kt({allowedChars:qt,len:Wf}),timestamp:Sr({min:Ys,max:Js}),workspace:kt({allowedChars:Gu})},allowLiteralUndefined:!1,allowExtraKeys:!1};Kr=class{static hashDocument(s){const e={...s,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},t=this._checkBasicDocumentValidity(e);return se(t)?Promise.resolve(t):qe.sha256base32(`author	${s.author}
contentHash	${s.contentHash}
`+(s.deleteAfter===null?"":`deleteAfter	${s.deleteAfter}
`)+`format	${s.format}
path	${s.path}
timestamp	${s.timestamp}
workspace	${s.workspace}
`)}static async generateDocument({input:s,keypair:e,share:t,timestamp:r}){const n={format:"es.4",author:e.address,content:s.content,contentHash:await qe.sha256base32(s.content),deleteAfter:s.deleteAfter??null,path:s.path,timestamp:r,workspace:t,signature:"?"},i=await this.signDocument(e,n);return se(i)?i:{doc:i}}static async signDocument(s,e){const t=await this.hashDocument(e);if(se(t))return t;const r=await qe.sign(s,t);return se(r)?r:{...e,signature:r}}static async wipeDocument(s,e){if(e.content.length===0)return e;const t=this.removeExtraFields(e);if(se(t))return t;const n={...t.doc,content:"",contentHash:await qe.sha256base32(""),signature:"?"};return this.signDocument(s,n)}static removeExtraFields(s){if(!hs(s))return new ie("doc is not a plain javascript object");const e=new Set(Object.keys(Xs.objSchema||{})),t={},r={};for(const[n,i]of Object.entries(s))if(e.has(n))t[n]=i;else{if(!n.startsWith("_"))return new ie("extra document fields must have names starting with an underscore");r[n]=i}return{doc:t,extras:r}}static async checkDocumentIsValid(s,e){e===void 0&&(e=Date.now()*1e3);const t=this._checkBasicDocumentValidity(s);if(se(t))return t;const r=this._checkTimestampIsOk(s.timestamp,s.deleteAfter,e);if(se(r))return r;const n=this._checkAuthorCanWriteToPath(s.author,s.path);if(se(n))return n;const i=this._checkPathIsValid(s.path,s.deleteAfter);if(se(i))return i;const a=wi(s.author);if(se(a))return a;const o=bn(s.workspace);if(se(o))return o;const u=await this._checkAuthorSignatureIsValid(s);if(se(u))return u;const l=await this._checkContentMatchesHash(s.content,s.contentHash);return se(l)?l:!0}static _checkBasicDocumentValidity(s){const e=tl(Xs)(s);return e!==null?new ie(e):!0}static _checkAuthorCanWriteToPath(s,e){return e.indexOf("~")===-1||e.indexOf("~"+s)!==-1?!0:new ie(`author ${s} can't write to path ${e}`)}static _checkTimestampIsOk(s,e,t){if(s>t+Uf)return new ie("timestamp too far in the future");if(e!==null){if(t>e)return new ie("ephemeral doc has expired");if(e<=s)return new ie("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(s,e){if(!s.startsWith("/"))return new ie("invalid path: must start with /");if(s.endsWith("/"))return new ie("invalid path: must not end with /");if(s.startsWith("/@"))return new ie('invalid path: must not start with "/@"');if(s.indexOf("//")!==-1)return new ie("invalid path: must not contain two consecutive slashes");if(e!==void 0){if(s.indexOf("!")===-1&&e!==null)return new ie("when deleteAfter is set, path must contain '!'");if(s.indexOf("!")!==-1&&e===null)return new ie("when deleteAfter is null, path must not contain '!'")}return!0}static async _checkAuthorSignatureIsValid(s){try{const e=await this.hashDocument(s);return se(e)?e:await qe.verify(s.author,s.signature,e)!==!0?new ie("signature is invalid"):!0}catch{return new ie("signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(s,e){return await qe.sha256base32(s)!==e?new ie("content does not match contentHash"):!0}static getAttachmentInfo(s){return new ie("es.4 does not support attachments")}static updateAttachmentFields(s,e,t,r){return Promise.resolve(new ie("es.4 does not support attachments"))}static authorFromCredentials(s){return s.address}},$f(Kr,"FormatEs4"),Object.defineProperty(Kr,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.4"});var Vf=globalThis&&globalThis.__setFunctionName||function(s,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(s,"name",{configurable:!0,value:t?"".concat(t," ",e):e})},Zr;new Dt("validator es.5","red");const Kf=10,Zf=Kf*60*1e3*1e3,ea=1e13,ta=9007199254740990,Qf=8e3,na=53,ra=104,Gf=0,Yf=Number.MAX_SAFE_INTEGER,ia={objSchema:{format:el("es.5"),author:kt({allowedChars:Zu}),text:kt({maxLen:Qf}),textHash:kt({allowedChars:qt,len:na}),deleteAfter:Sr({min:ea,max:ta,optional:!0}),path:kt({allowedChars:Yu,minLen:2,maxLen:512}),signature:kt({allowedChars:qt,len:ra}),shareSignature:kt({allowedChars:qt,len:ra}),timestamp:Sr({min:ea,max:ta}),share:kt({allowedChars:Gu}),attachmentSize:Sr({min:Gf,max:Yf,optional:!0}),attachmentHash:kt({allowedChars:qt,len:na,optional:!0})},allowLiteralUndefined:!1,allowExtraKeys:!1},Jf=(Zr=class{static hashDocument(s){const e={...s,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",shareSignature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},t=this._checkBasicDocumentValidity(e);return se(t)?Promise.resolve(t):qe.sha256base32((s.attachmentHash===void 0?"":`attachmentHash	${s.attachmentHash}
`)+(s.attachmentSize===void 0?"":`attachmentSize	${s.attachmentSize}
`)+`author	${s.author}
`+(s.deleteAfter===void 0?"":`deleteAfter	${s.deleteAfter}
`)+`format	${s.format}
path	${s.path}
textHash	${s.textHash}
timestamp	${s.timestamp}
share	${s.share}
`)}static async generateDocument({input:s,keypair:e,share:t,timestamp:r,prevLatestDoc:n,config:i}){if(s.text===void 0&&(n==null?void 0:n.text)===void 0)return new ie("Couldn't determine document text from given input or previous version's text.");const a=s.text!==void 0?s.text:n==null?void 0:n.text,o={...n,format:"es.5",author:e.address,text:a,textHash:await qe.sha256base32(a),path:s.path,timestamp:r,share:t,signature:"?",shareSignature:"?"};s.deleteAfter&&(o.deleteAfter=s.deleteAfter);const u=await this.signDocument(e,o,i);return se(u)?u:s.attachment?{doc:u,attachment:s.attachment}:{doc:u}}static async signDocument(s,e,t){const r=await this.hashDocument(e);if(se(r))return r;const n=await qe.sign(s,r);if(t.shareSecret===void 0)return new Ct(`Tried to write a document to ${e.share} without the secret.`);const i=await qe.sign({shareAddress:e.share,secret:t.shareSecret},r);return se(n)?n:se(i)?i:{...e,signature:n,shareSignature:i}}static async wipeDocument(s,e,t){if(e.text.length===0)return e;const r=this.removeExtraFields(e);if(se(r))return r;const n=r.doc;if(n.attachmentHash){const a={...n,text:"",textHash:await qe.sha256base32(""),signature:"?",shareSignature:"?",attachmentHash:await qe.sha256base32(""),attachmentSize:0};return this.signDocument(s,a,t)}const i={...n,text:"",textHash:await qe.sha256base32(""),signature:"?",shareSignature:"?"};return this.signDocument(s,i,t)}static removeExtraFields(s){if(!hs(s))return new ie("doc is not a plain javascript object");const e=new Set(Object.keys(ia.objSchema||{})),t={},r={};for(const[n,i]of Object.entries(s))if(e.has(n))t[n]=i;else{if(!n.startsWith("_"))return new ie("extra document fields must have names starting with an underscore");r[n]=i}return{doc:t,extras:r}}static async checkDocumentIsValid(s,e){e===void 0&&(e=Date.now()*1e3);const t=this._checkBasicDocumentValidity(s);if(se(t))return t;const r=this._checkTimestampIsOk(s.timestamp,s.deleteAfter?s.deleteAfter:null,e);if(se(r))return r;const n=this._checkAuthorCanWriteToPath(s.author,s.path);if(se(n))return n;const i=this._checkAttachmentFieldsConsistent(s);if(se(i))return i;const a=this._checkPathIsValid(s.path,!!s.attachmentHash,s.deleteAfter);if(se(a))return a;const o=wi(s.author);if(se(o))return o;const u=bn(s.share);if(se(u))return u;const l=await this._checkAuthorSignatureIsValid(s);if(se(l))return l;const c=await this._checkShareSignatureIsValid(s);if(se(c))return c;const f=await this._checkContentMatchesHash(s.text,s.textHash);return se(f)?f:!0}static _checkBasicDocumentValidity(s){const e=tl(ia)(s);return e!==null?new ie(e):!0}static _checkAttachmentFieldsConsistent(s){return s.text.length===0&&s.attachmentSize&&s.attachmentSize>0?new ie("Documents with attachments must have text."):(s.text.length>0&&s.attachmentSize&&s.attachmentSize,s.attachmentHash&&s.attachmentSize===void 0?new ie("Attachment size is undefined while attachment hash is defined"):s.attachmentSize&&s.attachmentHash===void 0?new ie("Attachment hash is undefined while attachment size is defined"):!0)}static _checkAuthorCanWriteToPath(s,e){return e.indexOf("~")===-1||e.indexOf("~"+s)!==-1?!0:new ie(`author ${s} can't write to path ${e}`)}static _checkTimestampIsOk(s,e,t){if(s>t+Zf)return new ie("timestamp too far in the future");if(e!==null){if(t>e)return new ie("ephemeral doc has expired");if(e<=s)return new ie("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(s,e,t){if(!s.startsWith("/"))return new ie("invalid path: must start with /");if(s.endsWith("/"))return new ie("invalid path: must not end with /");if(s.startsWith("/@"))return new ie('invalid path: must not start with "/@"');if(s.indexOf("//")!==-1)return new ie("invalid path: must not contain two consecutive slashes");if(t!==void 0){if(s.indexOf("!")===-1&&t!==null)return new ie("when deleteAfter is set, path must contain '!'");if(s.indexOf("!")!==-1&&t===null)return new ie("when deleteAfter is null, path must not contain '!'")}return!sa(s)&&e?new ie("when a attachment is provided, the path must end with a file extension"):sa(s)&&e===!1?new ie("when no attachment is provided, the path cannot end with a file extension"):!0}static async _checkAuthorSignatureIsValid(s){try{const e=await this.hashDocument(s);return se(e)?e:await qe.verify(s.author,s.signature,e)!==!0?new ie("signature is invalid"):!0}catch{return new ie("signature is invalid (unexpected exception)")}}static async _checkShareSignatureIsValid(s){try{const e=await this.hashDocument(s);return se(e)?e:await qe.verify(s.share,s.shareSignature,e)!==!0?new ie("share signature is invalid"):!0}catch{return new ie("share signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(s,e){return await qe.sha256base32(s)!==e?new ie("content does not match contentHash"):!0}static getAttachmentInfo(s){return s.attachmentHash&&s.attachmentSize===0?new ie("This document has had its attachment wiped"):!s.attachmentHash||!s.attachmentSize?new ie("This document has no attachment."):{size:s.attachmentSize,hash:s.attachmentHash}}static updateAttachmentFields(s,e,t,r,n){const i={...e,attachmentHash:r,attachmentSize:t};return this.signDocument(s,i,n)}static authorFromCredentials(s){return s.address}},Vf(Zr,"FormatEs5"),Object.defineProperty(Zr,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.5"}),Zr),Xf=/^.*\.(\w+)$/,eh=/^.*~@\w{4}\.\w{53}$/;function sa(s){if(s.indexOf(".")===-1)return!1;const e=s.match(Xf);return!(e===null||e[1].length===53&&s.match(eh))}const Wt=Jf,vi=[Wt];function aa(s){return s||Wt}function Gn(s){return s||vi}function th(s,e){const t=[];for(const r of e)s.includes(r.id)&&t.push(r);return t}function Yn(s){const e=s||vi,t={};for(const r of e)t[r.id]=r;return t}class Ci{constructor(){Object.defineProperty(this,"deferreds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"pending"})}resolve(e){if(this.state==="pending"){this.state="fulfilled";for(const t of this.deferreds)t.resolve(e)}}reject(e){if(this.state==="pending"){this.state="rejected";for(const t of this.deferreds)t.reject(e)}}getPromise(){const e=Ie();return this.state==="fulfilled"?e.resolve():this.state==="rejected"?e.reject():this.deferreds.add(e),e}}class Pr{constructor(e=!1){Object.defineProperty(this,"promises",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"sealed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"multiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new Ci}),Object.defineProperty(this,"allowRejectedPromises",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.allowRejectedPromises=e}enrol(e){if(this.sealed)throw new Ct("Tried to enrol a promise when enrolment was already sealed.");this.promises.add(e),e.then(()=>{this.checkAllDone()}).catch(t=>{if(!this.allowRejectedPromises)throw t})}checkAllDone(){this.sealed&&(this.allowRejectedPromises?Promise.allSettled(this.promises).then(()=>{this.multiDeferred.resolve()}):Promise.all(this.promises).then(()=>{this.multiDeferred.resolve()}).catch(()=>{this.multiDeferred.reject()}))}seal(){this.sealed||(this.sealed=!0,this.checkAllDone())}isSealed(){return this.sealed}isDone(){return this.multiDeferred.getPromise()}}class nh{constructor(){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"transform",{enumerable:!0,configurable:!0,writable:!0,value:new or({transform(e,t){t.enqueue(e)}})}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:this.transform.writable.getWriter()}),Object.defineProperty(this,"readable",{enumerable:!0,configurable:!0,writable:!0,value:this.transform.readable}),Object.defineProperty(this,"writables",{enumerable:!0,configurable:!0,writable:!0,value:[]})}checkClosed(){if(this.closed)throw"Closed"}getWritableStream(){this.checkClosed();const e=this.writer,t=new Rt({async write(r){await e.ready,await e.write(r)}});return this.writables.push(t),t}async close(){this.checkClosed();for(const e of this.writables)await e.abort();this.transform.writable.abort(),this.closed=!0}isClosed(){return this.closed}}class rh{constructor(){Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:new or(new ah)}),Object.defineProperty(this,"sourceReadable",{enumerable:!0,configurable:!0,writable:!0,value:this.transformStream.readable}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:this.transformStream.writable})}getReadableStream(){const[e,t]=this.sourceReadable.tee();return this.sourceReadable=e,t}}class ih{checkClosed(){if(this.closed)throw"Closed"}constructor(){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"subscribers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"writables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=this.subscribers;this.writable=new Rt({write(t){const r=e.map(({writer:n})=>new Promise(i=>{n.ready.then(()=>{n.write(t).then(i)})}));Promise.all(r)}})}getReadableStream(){this.checkClosed();const e=new or({transform(t,r){r.enqueue(t)}});return this.subscribers.push({transform:e,writer:e.writable.getWriter()}),e.readable}async close(){this.checkClosed();for(const e of this.writables)await e.abort();for(const{transform:e}of this.subscribers)await e.writable.abort(),await e.readable.cancel();this.closed=!0}isClosed(){return this.closed}}class sh{checkClosed(){if(this.closed)throw"Closed"}constructor(e){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineStream",{enumerable:!0,configurable:!0,writable:!0,value:new nh}),Object.defineProperty(this,"cloneStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e?this.cloneStream=new ih:this.cloneStream=new rh,this.combineStream.readable.pipeTo(this.cloneStream.writable)}getWritableStream(){return this.combineStream.getWritableStream()}getReadableStream(){return this.cloneStream.getReadableStream()}close(){this.checkClosed(),this.combineStream.close(),this.closed=!0}isClosed(){return this.closed}}class al{constructor(){Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set})}onWrite(e){return this.callbacks.add(e),()=>{this.callbacks.delete(e)}}async write(e){for(const t of this.callbacks)await t(e)}close(){this.callbacks.clear()}}class On{constructor(){Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"lock",{enumerable:!0,configurable:!0,writable:!0,value:new ol})}on(e){return this.callbacks.add(e),()=>{this.callbacks.delete(e)}}async send(e){for(const t of this.callbacks)await this.lock.run(()=>t(e))}}class ah{transform(e,t){t.enqueue(e)}}class ol{constructor(){Object.defineProperty(this,"doneEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new Pr}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:new Rt({async write(e){await e()}})}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:this.writable.getWriter()}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1})}checkClosed(){if(this.closed)throw"Closed"}async run(e){this.checkClosed(),await this.writer.ready;const t=this.writer.write(e);return this.doneEnroller.enrol(t),t}async close(){this.checkClosed(),this.doneEnroller.seal(),await this.doneEnroller.isDone(),this.writer.releaseLock(),await this.writable.abort(),this.closed=!0}isClosed(){return this.closed}}class oh{constructor(e,t){Object.defineProperty(this,"channel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.channel=e,this.channelKey=t}transform(e,t){if(this.channel==="*"||this.channel===e[this.channelKey]){t.enqueue(e);return}}}class uh{constructor(e,t){Object.defineProperty(this,"multistream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.multistream=new sh(t),this.channelKey=e}getWritableStream(){return this.multistream.getWritableStream()}getReadableStream(e){const t=new or(new oh(e,this.channelKey));return this.multistream.getReadableStream().pipeThrough(t)}}function lh(s,e){const t=Ie(),r=Ie(),n=()=>{if(r.state==="pending"){let i;s instanceof Qn?i=s:i=new Qn(s),r.resolve(i),i.binaryType="arraybuffer",i.readyState===i.OPEN&&t.resolve(),i.onopen=()=>{t.resolve()}}};return new Rt({async write(i,a){n();const o=await r;await t;try{const u=e(i);o.send(u)}catch(u){a.error(u)}o.onclose=()=>{a.error("Socket closed before we were done")}},async close(){n();const i=await r;await t,i.close()},async abort(){n();const i=await r;await t,i.close()}})}function ch(s,e){const t=Ie();let r=!1;const n=()=>{if(t.state==="pending")if(s instanceof Qn)t.resolve(s);else try{const i=new Qn(s);t.resolve(i)}catch(i){t.reject(i)}};return new Tn({async start(i){n();const a=await t;a.binaryType="arraybuffer",a.onmessage=o=>{const u=e(o);try{i.enqueue(u)}catch{}},a.onclose=()=>{if(!r)try{i.close()}catch{}},a.onerror=o=>{r=!0,i.error(o)}},async cancel(){n(),(await t).close()}})}function fh(s){let t=s.toString(16);return t.length%2&&(t="0"+t),t}function hh(s){return BigInt("0x"+s)}const dh={EMPTY_SET:"emptySet",LOWER_BOUND:"lowerBound",PAYLOAD:"payload",EMPTY_PAYLOAD:"emptyPayload",DONE:"done",FINGERPRINT:"fingerprint",TERMINAL:"terminal"},ph={encode:{emptySet:s=>({type:"EMPTY_SET",canRespond:s}),lowerBound:s=>({type:"LOWER_BOUND",value:s}),payload:(s,e)=>({type:"PAYLOAD",payload:s,...e?{end:e}:{}}),emptyPayload:s=>({type:"EMPTY_PAYLOAD",upperBound:s}),done:s=>({type:"DONE",upperBound:s}),fingerprint:(s,e)=>({type:"FINGERPRINT",fingerprint:fh(s),upperBound:e}),terminal:()=>({type:"TERMINAL"})},decode:{getType:s=>dh[s.type],emptySet:s=>{if(s.type==="EMPTY_SET")return s.canRespond;throw"Can't decode"},lowerBound:s=>{if(s.type==="LOWER_BOUND")return s.value;throw"Can't decode"},payload:s=>{if(s.type==="PAYLOAD")return{value:s.payload,...s.end?{end:s.end}:{}};throw"Can't decode"},emptyPayload:s=>{if(s.type==="EMPTY_PAYLOAD")return s.upperBound;throw"Can't decode"},done:s=>{if(s.type==="DONE")return s.upperBound;throw"Can't decode"},fingerprint:s=>{if(s.type==="FINGERPRINT")return{fingerprint:hh(s.fingerprint),upperBound:s.upperBound};throw"Can't decode"},terminal:s=>{if(s.type==="TERMINAL")return!0;throw"Can't decode"}}};class mh extends Ef{constructor(e,t,r){super({tree:e,encoding:ph,fingerprintEquals:(n,i)=>n===i,payloadThreshold:t,rangeDivision:r})}}class gh{sendEvent(e){return this.inboundEventQueue.push(e)}events(){return this.outboundEventQueue}getStatus(){return{requestedCount:this.requestedCount,receivedCount:this.receivedDocsCount,sentCount:this.sentDocsCount,status:this.isDoneMultiDeferred.state==="rejected"?"aborted":this.hasPrepared.state==="pending"?"preparing":this.hasReconciled.state==="pending"?"reconciling":this.isDoneMultiDeferred.state==="fulfilled"?"done":"gossiping"}}constructor(e){Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new On}),Object.defineProperty(this,"isDoneMultiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new Ci}),Object.defineProperty(this,"inboundEventQueue",{enumerable:!0,configurable:!0,writable:!0,value:new rn}),Object.defineProperty(this,"outboundEventQueue",{enumerable:!0,configurable:!0,writable:!0,value:new rn}),Object.defineProperty(this,"gossiperInboundQueue",{enumerable:!0,configurable:!0,writable:!0,value:new rn}),Object.defineProperty(this,"reconcilerInboundQueue",{enumerable:!0,configurable:!0,writable:!0,value:new rn}),Object.defineProperty(this,"hasPrepared",{enumerable:!0,configurable:!0,writable:!0,value:Ie()}),Object.defineProperty(this,"hasReconciled",{enumerable:!0,configurable:!0,writable:!0,value:Ie()}),Object.defineProperty(this,"hasCheckedAllExistingDocsForAttachments",{enumerable:!0,configurable:!0,writable:!0,value:Ie()}),Object.defineProperty(this,"requestedCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sentDocsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"receivedDocsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"counterpartId",{enumerable:!0,configurable:!0,writable:!0,value:sn()}),Object.defineProperty(this,"replica",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.replica=e.replica,e.replica.onEvent(a=>{a.kind==="willClose"&&this.cancel()});const{treeIsReady:t}=e.syncerManager.getDocThumbnailTreeAndDocLookup(e.replica.share,Gn(e.formats));t.then(()=>{this.hasPrepared.resolve()}),(async()=>{for await(const a of this.inboundEventQueue)switch(a.kind){case"RANGE_MSG":{this.reconcilerInboundQueue.push(a.message);break}default:this.gossiperInboundQueue.push(a)}})(),new _h({outboundEventQueue:this.outboundEventQueue,formats:e.formats,replica:e.replica,counterpartId:this.counterpartId,transferManager:e.transferManager,hasCheckedAllExistingDocsForAttachments:this.hasCheckedAllExistingDocsForAttachments});const r=new wh,n=new Dh({inboundEventQueue:this.reconcilerInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:e.syncerManager,formats:e.formats,replica:e.replica,initiateMessaging:e.initiateMessaging,wantTracker:r,payloadThreshold:e.payloadThreshold,rangeDivision:e.rangeDivision,onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}});n.isDone.then(()=>{this.hasReconciled.resolve()}),new bh({inboundEventQueue:this.gossiperInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:e.syncerManager,formats:e.formats,replica:e.replica,counterpartId:this.counterpartId,transferManager:e.transferManager,cancel:this.cancel.bind(this),reconciliationIsDone:n.isDone,wantTracker:r,syncAppetite:e.syncAppetite,onDocReceived:async()=>{this.receivedDocsCount++,await this.statusBus.send(this.getStatus())},onDocSent:async()=>{this.sentDocsCount++,await this.statusBus.send(this.getStatus())},onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}}).isDone.then(async()=>{await this.hasCheckedAllExistingDocsForAttachments,this.isDoneMultiDeferred.resolve()}),this.statusBus.send(this.getStatus())}onStatusUpdate(e){return this.statusBus.on(e)}async cancel(e){this.isDoneMultiDeferred.state==="fulfilled"||this.isDoneMultiDeferred.state==="rejected"||(this.isDoneMultiDeferred.reject(e||"Cancelled"),await this.statusBus.send(this.getStatus()),this.outboundEventQueue.push({kind:"ABORT"}),this.outboundEventQueue.close(),this.inboundEventQueue.close({immediately:!0}),this.gossiperInboundQueue.close({immediately:!0}),this.reconcilerInboundQueue.close({immediately:!0}))}isDone(){return this.isDoneMultiDeferred.getPromise()}}class bh{constructor(e){Object.defineProperty(this,"isPartnerFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:Ie()}),Object.defineProperty(this,"isFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:Ie()});const t=Yn(e.formats),r=e.syncerManager.getPlumTree(e.replica.share);if(e.syncAppetite==="continuous"){const a=e.replica.getQueryStream(void 0,"new",e.formats),o=new fs;a.pipeTo(new Rt({async write(u){if(u.kind==="success"&&u.sourceId!==e.counterpartId){const l=r.getMode(u.sourceId);o.reset(),o.update(`${u.doc.path} ${u.doc.author}`);const c=o.digest().toString(16),f=`${u.doc.timestamp} ${c}`;if(l==="EAGER"){const d=t[u.doc.format],h=d.getAttachmentInfo(u.doc),p=!se(h);let m=!1;p&&await e.replica.getAttachment(u.doc,d)&&(m=!0),e.outboundEventQueue.push({kind:"DOC",thumbnail:f,doc:u.doc,attachmentHeld:m}),e.onDocSent()}else e.outboundEventQueue.push({kind:"HAVE",thumbnail:f})}}})).catch(()=>{})}const n=e.replica.onEvent(a=>{a.kind==="attachment_ingest"&&a.sourceId!==e.counterpartId&&e.outboundEventQueue.push({kind:"NEW_ATTACHMENT",path:a.doc.path,author:a.doc.author,format:a.doc.format,hash:a.hash})}),{lookup:i}=e.syncerManager.getDocThumbnailTreeAndDocLookup(e.replica.share,Gn(e.formats));(async()=>{for await(const a of e.inboundEventQueue)switch(a.kind){case"PRUNE":{r.onPrune(e.counterpartId);break}case"HAVE":{if(e.reconciliationIsDone.state==="fulfilled"&&e.syncAppetite==="once")break;e.wantTracker.addWantedThumbnail(a.thumbnail),r.onLazyMessage(a,o=>{e.outboundEventQueue.push({kind:"WANT",thumbnail:o})}),e.onDocRequested();break}case"WANT":{r.onGraftMessage(e.counterpartId);const[,o]=a.thumbnail.split(" "),u=i[o];if(!u)return;const[,l,c]=u,d=(await e.replica.getAllDocsAtPath(l,e.formats)).find(h=>h.author===c);if(d){const h=t[d.format],p=h.getAttachmentInfo(d),m=!se(p);let b=!1;m&&await e.replica.getAttachment(d,h)&&(b=!0),e.outboundEventQueue.push({kind:"DOC",thumbnail:a.thumbnail,doc:d,attachmentHeld:b}),await e.onDocSent()}else console.error("Got a WANT event for a document not on record.");break}case"DOC":{if(this.isFulfilled.state==="fulfilled"&&e.syncAppetite==="once"||(r.onEagerMessage(e.counterpartId,a)&&e.outboundEventQueue.push({kind:"PRUNE"}),e.wantTracker.isReceived(a.thumbnail)))break;const u=t[a.doc.format];if(!u){console.error(`Was sent a doc with a format we don't know about (${a.doc.format})`);break}if(a.attachmentHeld&&await e.replica.getAttachment(a.doc,t[a.doc.format])===void 0){const c=await e.transferManager.handleDownload(a.doc,e.replica,e.counterpartId);if(se(c)){const f=u.getAttachmentInfo(a.doc);e.transferManager.registerExpectedTransfer(e.replica.share,f.hash),e.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:f.hash,doc:a.doc,shareAddress:e.replica.share})}}await e.replica.ingest(u,a.doc,e.counterpartId),e.wantTracker.receivedWantedThumbnail(a.thumbnail),await e.onDocReceived();break}case"NEW_ATTACHMENT":{if(e.transferManager.isAlreadyQueued(a.hash,"download"))break;const o=t[a.format],l=(await e.replica.getAllDocsAtPath(a.path,[o])).find(f=>a.author===f.author);if(!l)break;if(await e.replica.getAttachment(l,t[l.format])===void 0){const f=await e.transferManager.handleDownload(l,e.replica,e.counterpartId);if(se(f)){const d=o.getAttachmentInfo(l);e.transferManager.registerExpectedTransfer(e.replica.share,d.hash),e.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:d.hash,doc:l,shareAddress:e.replica.share})}}break}case"FULFILLED":this.isPartnerFulfilled.resolve(!0);break;case"WANT_ATTACHMENT":e.transferManager.handleUpload(a,e.replica);break;case"ABORT":await e.cancel()}})(),e.reconciliationIsDone.then(async()=>{e.syncAppetite==="once"&&(n(),e.wantTracker.seal(),await e.wantTracker.isDone(),e.outboundEventQueue.push({kind:"FULFILLED"}),this.isFulfilled.resolve())})}get isDone(){return Promise.all([this.isPartnerFulfilled,this.isFulfilled])}}class Dh{constructor(e){Object.defineProperty(this,"communicationRoundsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isDone",{enumerable:!0,configurable:!0,writable:!0,value:Ie()});const{tree:t,lookup:r,treeIsReady:n}=e.syncerManager.getDocThumbnailTreeAndDocLookup(e.replica.share,Gn(e.formats));e.initiateMessaging&&n.then(()=>{for(const a of i.initialMessages())e.outboundEventQueue.push({kind:"RANGE_MSG",message:a})});const i=new mh(t,e.payloadThreshold,e.rangeDivision);i.onInsertion(a=>{const[o,u]=a.split(" "),l=r[u];l&&l[0]>=parseInt(o)||(e.wantTracker.addWantedThumbnail(a),e.outboundEventQueue.push({kind:"WANT",thumbnail:a}),e.onDocRequested())}),(async()=>{await n;for await(const a of e.inboundEventQueue){if(this.isDone.state==="fulfilled")return;a.type==="TERMINAL"&&this.communicationRoundsCount++;const o=i.respond(a);for(const u of o)e.outboundEventQueue.push({kind:"RANGE_MSG",message:u})}})(),i.isDone().then(()=>{this.isDone.resolve(this.communicationRoundsCount)})}}class _h{constructor(e){const t=e.replica.getQueryStream({orderBy:"localIndex ASC"},"existing",e.formats),r=Yn(e.formats),n=e.transferManager.handleDownload.bind(e.transferManager);t.pipeTo(new Rt({start(i){e.replica.onEvent(a=>{a.kind==="willClose"&&i.error()})},async write(i){if(i.kind==="existing"||i.kind==="success"){const a=r[i.doc.format],o=await e.replica.getAttachment(i.doc,a);if(se(o))return;if(o===void 0){const u=await n(i.doc,e.replica,e.counterpartId);if(se(u)){const l=a.getAttachmentInfo(i.doc);e.transferManager.registerExpectedTransfer(e.replica.share,l.hash),e.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:l.hash,doc:i.doc,shareAddress:e.replica.share})}}}}})).then(()=>{e.hasCheckedAllExistingDocsForAttachments.resolve()}).catch(()=>{e.hasCheckedAllExistingDocsForAttachments.resolve()})}}class wh{constructor(){Object.defineProperty(this,"isSealed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"wantedThumbnails",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"enroller",{enumerable:!0,configurable:!0,writable:!0,value:new Pr}),Object.defineProperty(this,"received",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:sn()})}addWantedThumbnail(e){if(!this.isSealed&&!this.wantedThumbnails.has(e)){const t=Ie();this.wantedThumbnails.set(e,t),this.enroller.enrol(t)}}receivedWantedThumbnail(e){const t=this.wantedThumbnails.get(e);t&&(t.resolve(),this.received++)}isRequested(e){return this.wantedThumbnails.has(e)}isReceived(e){const t=this.wantedThumbnails.get(e);return t?t.state==="fulfilled":!1}seal(){this.enroller.seal()}isDone(){return this.enroller.isDone()}get requestedCount(){return this.wantedThumbnails.size}get receivedCount(){return this.received}}class ul{constructor(e,t){Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.cb=e,this.ms=t,this.timeout=In(e,t)}bump(){this.closed||(clearTimeout(this.timeout),this.timeout=In(this.cb,this.ms))}close(){this.closed=!0,clearTimeout(this.timeout)}}const ll=1e4;class $i{constructor({stream:e,replica:t,doc:r,format:n,requester:i,counterpartId:a}){Object.defineProperty(this,"kind",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:"ready"}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"expectedSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sourceDoc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new On}),Object.defineProperty(this,"transferOp",{enumerable:!0,configurable:!0,writable:!0,value:Ie()}),Object.defineProperty(this,"abortCb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new Ci}),Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"requester",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.sourceDoc=r,this.share=t.share,this.requester=i;const o=n.getAttachmentInfo(r);if(se(o))throw new ie("AttachmentTransfer was given a doc which has no attachment!");this.hash=o.hash,this.expectedSize=o.size;const u=this.updateLoaded.bind(this);if(e instanceof Tn){this.kind="download";let l;this.abortCb=()=>{l?l.cancel():e.cancel()};const c=()=>this.loaded,f=()=>new Tn({async start(d){const h=e.getReader();l=h;const p=new ul(()=>{d.error("Attachment download timed out.")},ll);for(;;){const{done:m,value:b}=await h.read();if(p.bump(),m||(u(b.byteLength),d.enqueue(b),c()>=o.size))break}p.close(),d.close()}});this.transferOp.resolve(()=>{const d=Ie();return t.ingestAttachment(n,r,f(),a).then(h=>{if(se(h)&&this.loaded===0){this.changeStatus("missing_attachment");return}if(se(h)){console.warn(`Couldn't ingest the attachment for ${r.path} by ${r.author}: ${h.message}`),d.reject(h);return}d.resolve()}).catch(h=>{console.log(h),d.reject(h)}),d})}else this.kind="upload",this.abortCb=()=>{e.abort().catch(()=>{})},t.getAttachment(r,n).then(async l=>{if(!l){await this.changeStatus("missing_attachment"),await e.abort();return}if(se(l)){await this.changeStatus("failed"),await e.abort();return}const c=new or({transform(f,d){u(f.byteLength),d.enqueue(f)}});this.transferOp.resolve(()=>l.stream().then(f=>f.pipeThrough(c).pipeTo(e)).catch(f=>{console.log(f)}))})}async start(){if(this.status!=="ready")return;const e=await this.transferOp;await this.changeStatus("in_progress"),e().then(async()=>{await this.changeStatus("complete")}).catch(async()=>{await this.changeStatus("failed")})}updateLoaded(e){this.loaded+=e,this.statusBus.send({status:this.status,bytesLoaded:this.loaded,totalBytes:this.expectedSize})}async changeStatus(e){this.status==="complete"||this.status==="failed"||this.status==="missing_attachment"||(this.status=e,await this.statusBus.send({status:e,bytesLoaded:this.loaded,totalBytes:this.expectedSize}),e==="complete"&&this.multiDeferred.resolve(),e==="failed"&&this.multiDeferred.reject("Attachment transfer failed"),e==="missing_attachment"&&this.multiDeferred.reject("The other peer does not have this attachment"))}get doc(){return this.sourceDoc}onProgress(e){return this.statusBus.on(e)}abort(){this.abortCb()}isDone(){return this.multiDeferred.getPromise()}}class yh{constructor(e){Object.defineProperty(this,"waiting",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"active",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"failed",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"completed",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"activeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transfersRequestedByUsEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new Pr(!0)}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"reports",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"reportBus",{enumerable:!0,configurable:!0,writable:!0,value:new On}),this.activeLimit=e}async activate(e){this.active.add(e),e.isDone().then(()=>{this.completed.add(e)}).catch(()=>{this.failed.add(e)}).finally(()=>{this.active.delete(e),this.admitNext()}),await e.start()}queue(e){this.waiting.push(e)}admitNext(){if(this.waiting.length===0||this.active.size>=this.activeLimit)return;const e=this.waiting.shift();e&&this.activate(e)}async addTransfer(e){if(this.closed){e.abort();return}e.onProgress(()=>{this.updateTransferStatus(e)}),e.requester==="us"&&this.transfersRequestedByUsEnroller.enrol(e.isDone()),this.active.size<this.activeLimit?await this.activate(e):this.queue(e)}gotAllTransfersRequestedByUs(){this.transfersRequestedByUsEnroller.seal()}cancel(){this.closed=!0,this.transfersRequestedByUsEnroller.seal();for(const e of this.active)e.abort()}updateTransferStatus(e){this.reports[e.share]||(this.reports[e.share]={}),this.reports[e.share][e.hash+e.kind]={author:e.doc.author,path:e.doc.path,format:e.doc.format,hash:e.hash,kind:e.kind,status:e.status,bytesLoaded:e.loaded,totalBytes:e.expectedSize},this.reportBus.send(this.getReport())}getReport(){const e={};for(const t in this.reports){const r=[],n=this.reports[t];for(const i in n){const a=n[i];r.push(a)}e[t]=r}return e}hasQueuedTransfer(e,t){for(const r of this.waiting)if(r.hash===e&&r.kind===t)return!0;for(const r of this.active)if(r.hash===e&&r.kind===t)return!0;for(const r of this.completed)if(r.hash===e&&r.kind===t)return!0;return!1}onReportUpdate(e){return this.reportBus.on(e)}transfersRequestedByUsFinished(){return this.transfersRequestedByUsEnroller.isDone()}}class vh{constructor(e){Object.defineProperty(this,"partner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"otherSyncerId",{enumerable:!0,configurable:!0,writable:!0,value:Ie()}),Object.defineProperty(this,"receivedAllExpectedTransfersEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new Pr}),Object.defineProperty(this,"madeAllAttachmentRequestsEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new Pr(!0)}),Object.defineProperty(this,"formatsLookup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reportDidUpdateBus",{enumerable:!0,configurable:!0,writable:!0,value:new On}),Object.defineProperty(this,"expectedTransferPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.partner=e.partner,this.queue=new yh(this.partner.concurrentTransfers),this.formats=e.formats,this.formatsLookup=Yn(this.formats),this.queue.onReportUpdate(async t=>{await this.reportDidUpdateBus.send(t)}),this.madeAllAttachmentRequestsEnroller.isDone().then(()=>{this.receivedAllExpectedTransfersEnroller.seal()}),this.receivedAllExpectedTransfersEnroller.isDone().then(()=>{this.queue.gotAllTransfersRequestedByUs()})}registerSyncAgent(e){this.madeAllAttachmentRequestsEnroller.enrol(e.isDone())}allSyncAgentsKnown(){this.madeAllAttachmentRequestsEnroller.seal()}registerExpectedTransfer(e,t){const r=`${e}_${t}`;if(this.expectedTransferPromises.has(r))return;const n=Ie();this.expectedTransferPromises.set(r,n),this.receivedAllExpectedTransfersEnroller.enrol(n)}async queueTransfer(e){this.queue.hasQueuedTransfer(e.hash,e.kind)||await this.queue.addTransfer(e)}async handleDownload(e,t,r){const n=this.formatsLookup[e.format],i=n.getAttachmentInfo(e);if(se(i))throw new Ct("TransferManager: attempted to download doc with no attachment.");if(this.queue.hasQueuedTransfer(i.hash,"download"))return"queued";const a=await this.partner.getDownload({doc:e,shareAddress:t.share,syncerId:await this.otherSyncerId,attachmentHash:i.hash});if(a===void 0)return"no_attachment";if(se(a))return a;const o=new $i({replica:t,doc:e,format:n,stream:a,requester:"us",counterpartId:r});return await this.queueTransfer(o),"queued"}async handleUpload(e,t){if(this.queue.hasQueuedTransfer(e.attachmentHash,"upload"))return!1;const r=this.formatsLookup[e.doc.format];if(!await t.getAttachment(e.doc,r))return!1;const i=await this.partner.handleUploadRequest({shareAddress:e.shareAddress,syncerId:await this.otherSyncerId,doc:e.doc,attachmentHash:e.attachmentHash});if(se(i))return!1;try{const a=new $i({doc:e.doc,format:r,replica:t,stream:i,requester:"them",counterpartId:"unused"});await this.queueTransfer(a)}catch{return!1}return!0}async handleTransferRequest({replica:e,path:t,author:r,source:n,kind:i,formatName:a,counterpartId:o}){const u=await this.partner.handleTransferRequest(n,i);if(u===void 0||se(u))return;const l=Yn(this.formats)[a];if(!l)return;const f=(await e.getAllDocsAtPath(t,[l])).find(h=>h.author===r);if(!f)return;const d=new $i({doc:f,format:l,replica:e,stream:u,requester:i==="upload"?"us":"them",counterpartId:o});if(d.requester==="us"){const h=`${d.share}_${d.hash}`,p=this.expectedTransferPromises.get(h);p&&p.resolve()}await this.queueTransfer(d)}cancel(){this.queue.cancel()}getReport(){return this.queue.getReport()}onReportUpdate(e){return this.reportDidUpdateBus.on(e)}transfersRequestedByUsFinished(){return this.queue.transfersRequestedByUsFinished()}registerOtherSyncerId(e){this.otherSyncerId.resolve(e)}isAlreadyQueued(e,t){return this.queue.hasQueuedTransfer(e,t)}}class cl{constructor(e){Object.defineProperty(this,"peer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:sn()}),Object.defineProperty(this,"manager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"syncAgents",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"syncAgentQueues",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"appetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new On}),Object.defineProperty(this,"formats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transferManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partnerIsFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:Ie()}),Object.defineProperty(this,"isDoneMultiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new Ci}),Object.defineProperty(this,"heartbeatInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bumpingTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.manager=e.manager,this.peer=e.manager.peer,this.appetite=e.partner.syncAppetite,this.formats=Gn(e.formats),this.partner=e.partner,this.transferManager=new vh({partner:this.partner,formats:this.formats}),this.transferManager.onReportUpdate(async()=>{await this.statusBus.send(this.getStatus())}),this.heartbeatInterval=mi(()=>{this.partner.sendEvent({kind:"HEARTBEAT"})},1e3),(async()=>{try{for await(const r of e.partner.getEvents())this.handleIncomingEvent(r)}catch(r){this.cancel(r||"Partner disconnected")}})();const t=sn();Promise.all(this.peer.shares().map(r=>Qr(t,r))).then(r=>{this.partner.sendEvent({kind:"DISCLOSE",salt:t,syncerId:this.id,shares:r,formats:this.formats?this.formats.map(n=>n.id):[Wt.id],canRespond:!1})}),this.transferManager.transfersRequestedByUsFinished().then(async()=>{e.partner.syncAppetite!=="continuous"&&(await this.partner.sendEvent({kind:"SYNCER_FULFILLED"}),await this.partnerIsFulfilled,clearInterval(this.heartbeatInterval),await this.partner.closeConnection(),this.bumpingTimeout.close(),this.isDoneMultiDeferred.resolve())}),this.peer.onReplicasChange(async r=>{if(this.appetite==="once")return;const n=Array.from(r.keys());for(const[a,o]of this.syncAgents)n.includes(a)===!1&&(await o.cancel("Replica was removed from peer."),this.syncAgents.delete(a));const i=sn();Promise.all(n.map(a=>Qr(i,a))).then(a=>{this.partner.sendEvent({kind:"DISCLOSE",salt:i,syncerId:this.id,shares:a,formats:this.formats?this.formats.map(o=>o.id):[Wt.id],canRespond:!0})})}),this.bumpingTimeout=new ul(()=>{this.cancel("No communication from the other peer in the last three seconds.")},ll)}addShare(e,t,r){if(this.syncAgents.has(e))return;const n=this.peer.getReplica(e);if(!n){console.error("Couldn't get the replica for a share we had in common.");return}const i=new gh({replica:n,formats:t,syncerManager:this.manager,transferManager:this.transferManager,initiateMessaging:r,payloadThreshold:this.partner.payloadThreshold,rangeDivision:this.partner.rangeDivision,syncAppetite:this.appetite});i.onStatusUpdate(()=>{this.statusBus.send(this.getStatus())}),this.syncAgents.set(e,i),this.transferManager.registerSyncAgent(i);const a=this.syncAgentQueues.get(e);let o;if(a)o=a;else{const u=new rn;o=u,this.syncAgentQueues.set(e,u)}(async()=>{for await(const u of o)i.sendEvent(u)})(),(async()=>{for await(const u of i.events())await this.partner.sendEvent({to:e,...u})})()}async handleIncomingEvent(e){if(this.bumpingTimeout.bump(),this.isDoneMultiDeferred.state==="pending")switch(e.kind){case"DISCLOSE":{const t=th(e.formats,this.formats);if(t.length===0)break;const r=new Set(e.shares),n=new Set,i=new Set;for(const o of this.peer.shares()){const u=await Qr(e.salt,o);r.has(u)?n.add(o):i.add(o)}const a=this.id>e.syncerId;for(const o of n)this.addShare(o,t,a);for(const o of i){const u=this.syncAgents.get(o);u&&(u.cancel("No longer in common with the other peer."),this.syncAgents.delete(o))}if(this.transferManager.registerOtherSyncerId(e.syncerId),this.appetite==="once"&&this.transferManager.allSyncAgentsKnown(),e.canRespond){const o=sn();Promise.all(this.peer.shares().map(u=>Qr(o,u))).then(u=>{this.partner.sendEvent({kind:"DISCLOSE",salt:o,syncerId:this.id,shares:u,formats:this.formats?this.formats.map(l=>l.id):[Wt.id],canRespond:!1})})}n.size===0&&this.appetite==="once"&&this.partner.sendEvent({kind:"SYNCER_FULFILLED"});break}case"SYNCER_FULFILLED":{this.partnerIsFulfilled.resolve();break}case"HEARTBEAT":break;default:{const{to:t}=e,r=this.syncAgentQueues.get(t);if(!r){const n=new rn;n.push(e),this.syncAgentQueues.set(t,n);break}r.push(e)}}}getStatus(){const e={};for(const[t,r]of this.syncAgents)e[t]={docs:r.getStatus(),attachments:this.transferManager.getReport()[t]||[]};return e}onStatusChange(e){return this.statusBus.on(e)}async cancel(e){this.bumpingTimeout.close(),this.isDoneMultiDeferred.reject(e);for(const[t,r]of this.syncAgents)await r.cancel();clearInterval(this.heartbeatInterval),this.transferManager.cancel(),await this.partner.closeConnection()}handleTransferRequest({shareAddress:e,path:t,author:r,source:n,kind:i,formatName:a}){if(this.isDoneMultiDeferred.state!=="pending")return;const o=this.peer.getReplica(e);if(!o)return;let u="unused";if(i==="upload"){const l=this.syncAgents.get(e);l&&(u=l.counterpartId)}return this.transferManager.handleTransferRequest({replica:o,author:r,formatName:a,kind:i,path:t,source:n,counterpartId:u})}isDone(){return this.isDoneMultiDeferred.getPromise()}}function Qr(s,e){return qe.sha256base32(s+e+s)}class Ch{constructor(e,t,r,n){Object.defineProperty(this,"concurrentTransfers",{enumerable:!0,configurable:!0,writable:!0,value:1024}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"syncAppetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outgoingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new rn}),Object.defineProperty(this,"incomingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new rn}),Object.defineProperty(this,"partnerPeer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partnerSyncer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.syncAppetite=r,this.partnerPeer=e;const{incomingQueue:i,outgoingQueue:a}=this;this.partnerSyncer=new cl({manager:e.syncerManager,formats:n,partner:{syncAppetite:r,getEvents(){return i},sendEvent(o){return a.push(o),Promise.resolve()},concurrentTransfers:1024,payloadThreshold:32,rangeDivision:32,async getDownload(o){const u=t.getReplica(o.shareAddress);if(!u)throw new ie("Tried to get a receiving transfer for an unknown share.");const l=await u.replicaDriver.attachmentDriver.getAttachment(o.doc.format,o.attachmentHash);if(l&&!se(l))return await l.stream()},closeConnection(){return a.close(),Promise.resolve()},handleUploadRequest(o){return Promise.resolve(new Er("PartnerLocal does not support uploads."))},handleTransferRequest(o,u){return Promise.resolve(new Er("PartnerLocal does not support transfer requests."))}}})}getEvents(){return this.outgoingQueue}sendEvent(e){return this.incomingQueue.push(e),Promise.resolve()}closeConnection(){return this.incomingQueue.close(),Promise.resolve()}async getDownload(e){const t=this.partnerPeer.getReplica(e.shareAddress);if(!t)throw new ie("Tried to get a receiving transfer for an unknown share.");const r=await t.replicaDriver.attachmentDriver.getAttachment(e.doc.format,e.attachmentHash);if(r&&!se(r))return await r.stream()}handleUploadRequest(e){return Promise.resolve(new Er("PartnerLocal does not support uploads."))}handleTransferRequest(e,t){return Promise.resolve(new Er("PartnerLocal does not support transfer requests."))}}class Ah{constructor(e){Object.defineProperty(this,"syncAppetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"concurrentTransfers",{enumerable:!0,configurable:!0,writable:!0,value:24}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"isSecure",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wsUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"socket",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"incomingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new rn}),Object.defineProperty(this,"socketIsReady",{enumerable:!0,configurable:!0,writable:!0,value:Ie()}),this.syncAppetite=e.appetite;const t=new URL(e.url),r=`${t.host}${t.pathname==="/"?"":t.pathname}`;this.isSecure=t.protocol==="https:"||t.protocol==="wss:",this.wsUrl=`${this.isSecure?"wss://":"ws://"}${r}/'`;const n=new URL(e.appetite,this.wsUrl);this.socket=new Qn(n.toString()),this.socket.onopen=()=>{this.socketIsReady.resolve()},this.socket.binaryType="arraybuffer",this.socket.onmessage=i=>{this.incomingQueue.push(JSON.parse(i.data))},this.socket.onclose=()=>{this.incomingQueue.close()},this.socket.onerror=i=>{if("error"in i){this.incomingQueue.close({withError:i.error});return}this.incomingQueue.close({withError:new Ct("Websocket error.")})}}async sendEvent(e){if(await this.socketIsReady,!(this.socket.readyState===this.socket.CLOSED||this.socket.readyState===this.socket.CLOSING))return this.socket.send(JSON.stringify(e))}getEvents(){return this.incomingQueue}closeConnection(){return this.socket.close(),Promise.resolve()}getDownload(e){const t=new URL(`${e.syncerId}/download/${e.shareAddress}/${e.doc.format}/${e.doc.author}${e.doc.path}`,this.wsUrl),r=ch(t.toString(),n=>n.data instanceof ArrayBuffer?new Uint8Array(n.data):null);return Promise.resolve(r)}handleUploadRequest(e){const t=new URL(`${e.syncerId}/upload/${e.shareAddress}/${e.doc.format}/${e.doc.author}${e.doc.path}`,this.wsUrl),r=lh(t.toString(),n=>n);return Promise.resolve(r)}handleTransferRequest(e,t){return Promise.resolve(new Er("SyncDriverWebClient does not support external transfer requests."))}}function kh(s,e){const[t,r]=s.split(" "),[n,i]=e.split(" "),a=parseInt(t),o=parseInt(n);return a>o?1:a<o?-1:r>i?1:r<i?-1:0}const Eh={lift:s=>yf(s),combine:(s,e)=>s+e,neutral:BigInt(0)};class Fh extends Cf{constructor(){super(Eh,kh)}}class Sh{constructor(){Object.defineProperty(this,"messagingModes",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"eagerMessageThumbnails",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"haveTimeouts",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}getMode(e){const t=this.messagingModes.get(e);if(t)return t;const r=this.messagingModes.size===0?"EAGER":"LAZY";return this.messagingModes.set(e,r),"EAGER"}onEagerMessage(e,t){const r=this.haveTimeouts.get(t.thumbnail);return r?(clearTimeout(r),!1):this.eagerMessageThumbnails.has(t.thumbnail)?(this.messagingModes.set(e,"LAZY"),!0):(this.eagerMessageThumbnails.add(t.thumbnail),!1)}onLazyMessage(e,t){if(!this.haveTimeouts.has(e.thumbnail)){const r=In(()=>{t(e.thumbnail)},5);this.haveTimeouts.set(e.thumbnail,r)}}onGraftMessage(e){this.messagingModes.set(e,"EAGER")}onPrune(e){this.messagingModes.set(e,"LAZY")}}class Bh{constructor(e){Object.defineProperty(this,"syncers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"syncerEventBus",{enumerable:!0,configurable:!0,writable:!0,value:new On}),Object.defineProperty(this,"peer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docThumbnailTreeAndLookup",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"hasher",{enumerable:!0,configurable:!0,writable:!0,value:new fs}),Object.defineProperty(this,"plumTrees",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.peer=e}addPartner(e,t,r){const n=new cl({manager:this,partner:e,formats:r});return this.syncers.set(n.id,{syncer:n,description:t}),this.syncerEventBus.send(this.syncers),n}getSyncers(){return this.syncers}getDocThumbnailTreeAndDocLookup(e,t){const r=t.map(d=>d.id),n=`${e} ${r}`,i=this.docThumbnailTreeAndLookup.get(n);if(i){const[d,h]=i;return{tree:d,lookup:h,treeIsReady:Promise.resolve(!0)}}const a=this.peer.getReplica(e);if(!a)throw new Ct("A DocThumbnailTree was requested for a share the peer doesn't know about, big problem!");const o=this.hasher,u=a.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"everything",t),l=new Fh,c={},f=Ie();return u.pipeTo(new Rt({write(d){if(d.kind==="processed_all_existing"){f.resolve();return}o.reset(),o.update(`${d.doc.path} ${d.doc.author}`);const h=o.digest().toString(16),p=`${d.doc.timestamp} ${h}`;(d.kind==="existing"||d.kind==="success")&&(c[h]=[d.doc.timestamp,d.doc.path,d.doc.author],l.insert(p)),d.kind==="expire"&&(delete c[h],l.remove(p))}})),{tree:l,lookup:c,treeIsReady:f}}getPlumTree(e){const t=this.plumTrees.get(e);if(t)return t;const r=new Sh;return this.plumTrees.set(e,r),r}onSyncersChange(e){return this.syncerEventBus.on(e)}}const Cn=new Dt("peer","orangeRed"),vr=JSON.stringify;class Lr{constructor(){Object.defineProperty(this,"replicaEventBus",{enumerable:!0,configurable:!0,writable:!0,value:new On}),Object.defineProperty(this,"syncerManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicaMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Cn.debug("constructor"),this.syncerManager=new Bh(this)}hasShare(e){return this.replicaMap.has(e)}shares(){const e=[...this.replicaMap.keys()];return e.sort(),e}replicas(){const e=[...this.replicaMap.keys()];return e.sort(),e.map(t=>this.replicaMap.get(t))}size(){return this.replicaMap.size}getReplica(e){return this.replicaMap.get(e)}async addReplica(e){if(Cn.debug(`addReplica(${vr(e.share)})`),this.replicaMap.has(e.share))throw Cn.debug("already had a replica with that share"),new Error(`Peer.addReplica: already has a replica with share ${vr(e.share)}.  Don't add another one.`);this.replicaMap.set(e.share,e),await this.replicaEventBus.send(this.replicaMap),Cn.debug("    ...addReplica: done")}async removeReplicaByShare(e){Cn.debug(`removeReplicaByShare(${vr(e)})`),this.replicaMap.delete(e),await this.replicaEventBus.send(this.replicaMap)}async removeReplica(e){const t=this.replicaMap.get(e.share);e===t?(Cn.debug(`removeReplica(${vr(e.share)})`),await this.removeReplicaByShare(e.share)):Cn.debug(`removeReplica(${vr(e.share)}) -- same share but it's a different instance now; ignoring`)}sync(e,t=!1,r){try{const n=new Ah({url:e,appetite:t?"continuous":"once"});return this.syncerManager.addPartner(n,e,r)}catch{if(e instanceof Lr){const n=new Ch(e,this,t?"continuous":"once",r);return this.syncerManager.addPartner(n,"Local",r)}console.error("Provided an invalid target for syncing to a peer:",e);return}}addSyncPartner(e,t,r){return this.syncerManager.addPartner(e,t,r)}getSyncers(){return this.syncerManager.getSyncers()}onReplicasChange(e){return this.replicaEventBus.on(e)}onSyncersChange(e){return this.syncerManager.onSyncersChange(e)}discover(e){const t=this;return{async*[Symbol.asyncIterator](){for await(const r of e.events){if(r.kind==="SERVICE_STOPPED")break;if(r.kind==="PEER_EXITED"){yield r;continue}if(r.kind==="PEER_INITIATED_SYNC"){const n=await r.begin(t);yield{kind:"PEER_INITIATED_SYNC",description:r.description,syncer:n};continue}yield{kind:"PEER_DISCOVERED",description:r.description,sync:async n=>await r.begin(t,n!=null&&n.syncContinuously?"continuous":"once")}}}}}}const Ih={historyMode:"latest",orderBy:"path ASC",startAfter:void 0,limit:void 0,filter:void 0,formats:["es.5"]},An=new Dt("query","green");function fl(s){var n,i,a,o;const e={...Ih,...s},t={query:{limit:0},isValid:!1,willMatch:"nothing"};if(e.limit!==void 0&&e.limit<0)return An.debug("cleanUpQuery: unreasonable limit - returning empty invalid query",t),t;if((n=e.orderBy)!=null&&n.startsWith("path")&&((i=e.startAfter)==null?void 0:i.localIndex)!==void 0)return An.debug('cleanUpQuery: orderBy is "path" but startAfter is not compatible - returning empty invalid query',t),t;if((a=e.orderBy)!=null&&a.startsWith("localIndex")&&((o=e.startAfter)==null?void 0:o.path)!==void 0)return An.debug('cleanUpQuery: orderBy is "localIndex" but startAfter is not compatible - returning empty invalid query',t),t;if(e.historyMode!==void 0&&e.historyMode!=="all"&&e.historyMode!=="latest")return An.debug(`cleanUpQuery: unknown historyMode ${JSON.stringify(e.historyMode)} - returning empty invalid query`,t),t;if(e.orderBy!==void 0&&["path ASC","path DESC","localIndex ASC","localIndex DESC"].indexOf(e.orderBy)===-1)return An.debug(`cleanUpQuery: unrecognized orderBy value ${JSON.stringify(e.orderBy)} - returning empty invalid query`,t),t;let r=e.historyMode==="all"?"all":"all-latest";if(e.filter!==void 0&&!si(e.filter,{})&&(r="some"),e.startAfter!==void 0&&!si(e.startAfter,{})&&(r="some"),e.limit!==void 0&&(e.limit>0&&(r="some"),e.limit===0&&(r="nothing")),e.filter!==void 0){const u=e.filter;u.path&&u.pathStartsWith&&!u.path.startsWith(u.pathStartsWith)&&(r="nothing"),u.path&&u.pathEndsWith&&!u.path.endsWith(u.pathEndsWith)&&(r="nothing"),u.timestamp&&u.timestampGt&&!(u.timestamp>u.timestampGt)&&(r="nothing"),u.timestamp&&u.timestampLt&&!(u.timestamp<u.timestampLt)&&(r="nothing"),u.timestampGt&&u.timestampLt&&!(u.timestampLt+1<u.timestampGt)&&(r="nothing")}if(r==="nothing"){let u={query:{limit:0},isValid:!0,willMatch:"nothing"};return An.debug("cleanUpQuery - this query will match nothing, so returning a simpler query that also matches nothing",u),u}return An.debug(`cleanUpQuery - query is ok!  willMatch = ${r}`),{query:e,isValid:!0,willMatch:r}}function ds(s,e){return!(e.path!==void 0&&s.path!==e.path||e.pathStartsWith!==void 0&&!s.path.startsWith(e.pathStartsWith)||e.pathEndsWith!==void 0&&!s.path.endsWith(e.pathEndsWith)||e.author!==void 0&&s.author!==e.author||e.timestamp!==void 0&&s.timestamp!==e.timestamp||e.timestampGt!==void 0&&!(s.timestamp>e.timestampGt)||e.timestampLt!==void 0&&!(s.timestamp<e.timestampLt))}new Dt("query helpers","gold");var Tt;(function(s){s[s.LT=-1]="LT",s[s.EQ=0]="EQ",s[s.GT=1]="GT"})(Tt||(Tt={}));function es(s,e,t="ASC"){if(Array.isArray(s)&&Mu(s,e)||typeof s=="object"&&si(s,e)||s===e)return Tt.EQ;if(t==="ASC"||t===void 0)return s<e?Tt.LT:Tt.GT;if(t==="DESC")return s>e?Tt.LT:Tt.GT;throw new Error("unexpected sort order to compareBasic: "+JSON.stringify(t))}function ps(s,e,t){let r=Math.min(s.length,e.length);for(let a=0;a<r;a++){let o=(t==null?void 0:t[a])??"ASC",u=es(s[a],e[a],o);if(u!==Tt.EQ)return u}if(s.length===e.length)return Tt.EQ;let n=Math.min(s.length,e.length),i=(t==null?void 0:t[n])??"ASC";return es(s.length,e.length,i)}function oa(s,e="ASC"){return(t,r)=>es(t[s],r[s],e)}const Th=JSON.stringify,_t=new Dt("replica","gold"),wt=new Dt("replica set","gold"),pt=new Dt("replica ingest","gold");function ua(s,e){return ps([s.timestamp,s.signature],[e.timestamp,s.signature],["DESC","ASC"])}class Rh{constructor({driver:e,config:t}){var n;Object.defineProperty(this,"replicaId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicaDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formatsConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isClosed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ingestLockStream",{enumerable:!0,configurable:!0,writable:!0,value:new ol}),Object.defineProperty(this,"eventMultiStream",{enumerable:!0,configurable:!0,writable:!0,value:new uh("kind",!0)}),Object.defineProperty(this,"eventWriter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbackSink",{enumerable:!0,configurable:!0,writable:!0,value:new al}),Object.defineProperty(this,"eraseInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"expireEventTimeouts",{enumerable:!0,configurable:!0,writable:!0,value:new Map});const r=bn(e.docDriver.share);if(se(r))throw r;_t.debug(`constructor.  driver = ${(n=e==null?void 0:e.constructor)==null?void 0:n.name}`),this.replicaId="replica-"+sn(),this.share=e.docDriver.share,this.replicaDriver=e,this.formatsConfig=t||{},this.eventWriter=this.eventMultiStream.getWritableStream().getWriter(),this.eventMultiStream.getReadableStream("*").pipeTo(new Rt(this.callbackSink)),this.eraseInterval=mi(()=>{this.isClosed()?clearInterval(this.eraseInterval):this.pruneExpiredDocsAndAttachments()},1e3*60*60)}isClosed(){return this._isClosed}async close(e){if(_t.debug("closing..."),this._isClosed)throw new Qe;await this.ingestLockStream.close();for(const t of this.expireEventTimeouts.values())clearTimeout(t);return _t.debug("    sending willClose blockingly..."),await this.eventWriter.write({kind:"willClose"}),_t.debug("    marking self as closed..."),e===!1&&await this.pruneExpiredDocsAndAttachments(),await this.replicaDriver.attachmentDriver.clearStaging(),this._isClosed=!0,_t.debug(`    closing ReplicaDriver (erase = ${e})...`),await this.replicaDriver.docDriver.close(e),await this.replicaDriver.attachmentDriver.close(e),clearInterval(this.eraseInterval),_t.debug("    sending didClose nonblockingly..."),await this.eventWriter.write({kind:"didClose"}),_t.debug("...closing done"),Promise.resolve()}async getConfig(e){if(this._isClosed)throw new Qe;return await this.replicaDriver.docDriver.getConfig(e)}async setConfig(e,t){if(this._isClosed)throw new Qe;return await this.replicaDriver.docDriver.setConfig(e,t)}async listConfigKeys(){if(this._isClosed)throw new Qe;return await this.replicaDriver.docDriver.listConfigKeys()}async deleteConfig(e){if(this._isClosed)throw new Qe;return await this.replicaDriver.docDriver.deleteConfig(e)}getMaxLocalIndex(){if(this._isClosed)throw new Qe;return this.replicaDriver.docDriver.getMaxLocalIndex()}getAllDocs(e){return _t.debug("getAllDocs()"),this.queryDocs({historyMode:"all",orderBy:"path ASC"},e)}getLatestDocs(e){return _t.debug("getLatestDocs()"),this.queryDocs({historyMode:"latest",orderBy:"path ASC"},e)}getAllDocsAtPath(e,t){return _t.debug(`getAllDocsAtPath("${e}")`),this.queryDocs({historyMode:"all",orderBy:"path ASC",filter:{path:e}},t)}async getLatestDocAtPath(e,t){_t.debug(`getLatestDocsAtPath("${e}")`);const r=await this.queryDocs({historyMode:"latest",orderBy:"path ASC",filter:{path:e}},t?[t]:void 0);if(r.length!==0)return r[0]}async queryDocs(e={},t){if(_t.debug("queryDocs",e),this._isClosed)throw new Qe;const r=Gn(t);return await this.replicaDriver.docDriver.queryDocs({...e,formats:r.map(n=>n.id)})}async queryPaths(e={},t){const r=await this.queryDocs(e,t),n=new Set(r.map(({path:i})=>i));return Array.from(n).sort()}async queryAuthors(e={},t){const r=await this.queryDocs(e,t),n=new Set(r.map(({author:i})=>i));return Array.from(n).sort()}async set(e,t,r=Wt){if(wt.debug("set",t),this._isClosed)throw new Qe;wt.debug("...deciding timestamp: getting latest doc at the same path (from any author)");const n=await this.getLatestDocAtPath(t.path);let i;typeof t.timestamp=="number"?i=t.timestamp:n===void 0?i=Gs():i=Math.max(Gs(),n.timestamp+1),wt.debug("...generating doc");let a;if(n){const l=r.removeExtraFields(n);se(l)||(a=l.doc)}const o=await r.generateDocument({keypair:e,input:{...t,format:r.id},share:this.share,timestamp:i,prevLatestDoc:a,config:this.formatsConfig[r.id]});if(se(o))return{kind:"failure",reason:"invalid_document",err:o};if(wt.debug("...signature =",o.doc.signature),o.attachment){const l=await this.replicaDriver.attachmentDriver.stage(r.id,o.attachment);if(se(l))return{kind:"failure",reason:"invalid_document",err:l};const c=await r.updateAttachmentFields(e,o.doc,l.size,l.hash,this.formatsConfig[r.id]);if(se(c))return await l.reject(),{kind:"failure",reason:"invalid_document",err:c};wt.debug("...ingesting attachment"),wt.debug("-----------------------"),await l.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:c,hash:l.hash,size:l.size,sourceId:"local"}),wt.debug("...done ingesting attachment"),wt.debug("...ingesting"),wt.debug("-----------------------");const f=await this.ingest(r,c,"local");return wt.debug("...done ingesting"),wt.debug("...set is done."),f}wt.debug("...ingesting"),wt.debug("-----------------------");const u=await this.ingest(r,o.doc,"local");return wt.debug("...done ingesting"),wt.debug("...set is done."),u}async ingest(e,t,r){if(pt.debug("ingest",t),this._isClosed)throw new Qe;pt.debug("...removing extra fields");const n=e.removeExtraFields(t);if(se(n))return{kind:"failure",reason:"invalid_document",err:n};t=n.doc;const i=n.extras;Object.keys(i).length>0&&pt.debug(`...extra fields found: ${Th(i)}`);const a=await e.checkDocumentIsValid(t);if(se(a))return{kind:"failure",reason:"invalid_document",err:a};const o=Ie();return await this.ingestLockStream.run(async()=>{pt.debug(" >> ingest: start of protected region"),pt.debug("  > getting other history docs at the same path by any author");const u=await this.getAllDocsAtPath(t.path,[e]);pt.debug(`  > ...got ${u.length}`),pt.debug("  > getting prevLatest and prevSameAuthor");const l=u[0]??null,c=u.filter(m=>m.author===t.author)[0]??null;pt.debug("  > checking if new doc is latest at this path"),u.push(t),u.sort(ua);const f=u[0]===t;if(pt.debug(`  > ...isLatest: ${f}`),!f&&c!==null){pt.debug("  > new doc is not latest and there is another one from the same author...");const m=ua(t,c);if(m===Tt.GT){pt.debug("  > new doc is GT prevSameAuthor, so it is obsolete"),o.resolve({kind:"nothing_happened",reason:"obsolete_from_same_author",doc:t});return}if(m===Tt.EQ){pt.debug("  > new doc is EQ prevSameAuthor, so it is redundant (already_had_it)"),o.resolve({kind:"nothing_happened",reason:"already_had_it",doc:t});return}}pt.debug("  > upserting into ReplicaDriver...");const d=await this.replicaDriver.docDriver.upsert(t);pt.debug("  > ...done upserting into ReplicaDriver"),pt.debug("  > ...getting ReplicaDriver maxLocalIndex...");const h=await this.replicaDriver.docDriver.getMaxLocalIndex();pt.debug(" >> ingest: end of protected region, returning a WriteEvent from the lock");const p={kind:"success",maxLocalIndex:h,doc:d,docIsLatest:f,prevDocFromSameAuthor:c,prevLatestDoc:l,sourceId:r};if(o.resolve(p),await this.eventWriter.write(p),d.deleteAfter){const m=`${d.path}|${d.author}`,b=this.expireEventTimeouts.get(m);b&&clearTimeout(b);const g=d.deleteAfter/1e3-Date.now();this.expireEventTimeouts.set(m,In(()=>{this.eventWriter.write({kind:"expire",doc:d})},g))}}),o}async overwriteAllDocsByAuthor(e,t){const r=aa(t);if(_t.debug(`overwriteAllDocsByAuthor("${e.address}")`),this._isClosed)throw new Qe;const n=await this.queryDocs({filter:{author:e.address},historyMode:"all"},[r]);_t.debug(`    ...found ${n.length} docs to overwrite`);let i=0,a=0;for(const o of n){const u=await this.wipeDocument(e,o,aa(t));if(se(u))return u;i+=1}return _t.debug(`    ...done; ${i} overwritten to be empty; ${a} were already empty; out of total ${n.length} docs`),i}async wipeDocAtPath(e,t,r=Wt){const n=await this.getLatestDocAtPath(t,r);return n?this.wipeDocument(e,n,r):new ie("No document exists at that path")}async wipeDocument(e,t,r){const n={...t,timestamp:Math.max(t.timestamp+1,Date.now()*1e3),author:e.address},i=await r.wipeDocument(e,n,this.formatsConfig[r.id]);if(se(i))return{kind:"failure",err:i,reason:"invalid_document"};const a=await this.ingest(r,i,"local");if(a.kind==="success"){const o=r.getAttachmentInfo(t);if(!se(o)){const u=await this.replicaDriver.attachmentDriver.erase(r.id,o.hash);se(u)||await this.eventWriter.write({kind:"attachment_prune",format:r.id,hash:o.hash})}}return a}async pruneExpiredDocsAndAttachments(e=vi){const t=await this.replicaDriver.docDriver.eraseExpiredDocs();for(const a of t)await this.eventWriter.write({kind:"expire",doc:a});const r=Yn(e),n={};await this.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"existing",e).pipeTo(new Rt({write(a){if(a.kind==="existing"){const o=r[a.doc.format],u=o.getAttachmentInfo(a.doc);if(!se(u)){const l=n[o.id];l?l.add(u.hash):n[o.id]=new Set([u.hash])}}}}));const i=await this.replicaDriver.attachmentDriver.filter(n);for(const a of i)await this.eventWriter.write({kind:"attachment_prune",format:a.format,hash:a.hash})}getEventStream(e="*"){return this.eventMultiStream.getReadableStream(e)}getQueryStream(e={},t,r){const n=this.queryDocs.bind(this),i=this.getEventStream.bind(this);return new Tn({async start(a){if(t==="existing"||t==="everything"){const l=await n(e,r);for(const c of l)a.enqueue({kind:"existing",doc:c})}if(a.enqueue({kind:"processed_all_existing"}),t==="existing"){a.close();return}const u=i().getReader();for(;;){const{done:l,value:c}=await u.read();if(l)return;if(c.kind==="expire"||c.kind==="success"){if(e.filter&&ds(c.doc,e.filter)){a.enqueue(c);continue}a.enqueue(c);continue}c.kind==="didClose"&&a.close()}}})}onEvent(e){return this.callbackSink.onWrite(e)}async ingestAttachment(e,t,r,n){if(this._isClosed)throw new Qe;const i=e.removeExtraFields(t);if(se(i))return Promise.resolve(i);t=i.doc;const a=await e.checkDocumentIsValid(t);if(se(a))return Promise.resolve(a);const o=await this.getAttachment(t,e);if(o&&!se(o))return!1;const u=e.getAttachmentInfo(t);if(se(u))return Promise.resolve(u);const l=await this.replicaDriver.attachmentDriver.stage(t.format,r);return se(l)?l:l.hash!==u.hash?(await l.reject(),new ie("Attachment's hash did not match the document's")):l.size!==u.size?(await l.reject(),new ie("Attachment's size did not match the document's")):(await l.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:t,hash:l.hash,size:l.size,sourceId:n}),!0)}getAttachment(e,t=Wt){if(e.deleteAfter&&e.deleteAfter<Date.now()*1e3)return Promise.resolve(new ie("This document has expired"));const r=t.getAttachmentInfo(e);return se(r)?Promise.resolve(r):this.replicaDriver.attachmentDriver.getAttachment(e.format,r.hash)}addAttachments(e,t){const r=Gn(t),n={};for(const a of r)n[a.id]=a;const i=e.map(a=>new Promise(o=>{const l=n[a.format].getAttachmentInfo(a);if(!se(l))this.replicaDriver.attachmentDriver.getAttachment(a.format,l.hash).then(c=>{o({...a,attachment:c})});else return o({...a,attachment:l})}));return Promise.all(i)}}class xh extends Rh{constructor(e){super({driver:e.driver,config:{"es.5":{shareSecret:e.shareSecret}}})}}const kn=new Dt("replica-cache","green");function la({_localIndex:s}){return s}function ca(s,e){const t=[];for(const r of e)if(!(s.orderBy==="path ASC"&&s.startAfter!==void 0&&s.startAfter.path!==void 0&&r.path<=s.startAfter.path)&&!(s.orderBy==="path DESC"&&s.startAfter!==void 0&&s.startAfter.path!==void 0&&r.path>=s.startAfter.path)&&!(s.orderBy==="localIndex ASC"&&s.startAfter!==void 0&&s.startAfter.localIndex!==void 0&&(r._localIndex||0)<=s.startAfter.localIndex)&&!(s.orderBy==="localIndex DESC"&&s.startAfter!==void 0&&s.startAfter.localIndex!==void 0&&(r._localIndex||0)>=s.startAfter.localIndex)&&(t.push(r),s.limit!==void 0&&t.length>=s.limit))break;return t}class Ph{constructor(e,t,r){Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"replica",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"timeToLive",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onCacheUpdatedCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"onFireCacheUpdatedsWrapper",{enumerable:!0,configurable:!0,writable:!0,value:o=>o()}),Object.defineProperty(this,"attachmentCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.replica=e,this.timeToLive=t||1e3,r&&(this.onFireCacheUpdatedsWrapper=r);const n=this.onReplicaEvent.bind(this),i=this.close.bind(this),a=this.isClosed.bind(this);this.replica.getEventStream("*").pipeTo(new Rt({async write(o){o.kind==="attachment_ingest"||o.kind==="success"||o.kind==="expire"?await n(o):o.kind==="willClose"&&!a()&&await i()}})).catch(()=>{})}async close(){if(this.closed)throw new _n;this.closed=!0,await Promise.all(Array.from(this.docCache.values()).map(e=>e.close())),this.docCache.clear(),this.onCacheUpdatedCallbacks.clear()}isClosed(){return this.closed}getAllDocs(e){return this.queryDocs({historyMode:"all",orderBy:"path DESC"},e)}getLatestDocs(e){return this.queryDocs({historyMode:"latest",orderBy:"path DESC"},e)}getAllDocsAtPath(e,t){return this.queryDocs({historyMode:"all",orderBy:"path DESC",filter:{path:e}},t)}getLatestDocAtPath(e,t){const r=this.queryDocs({historyMode:"latest",orderBy:"path DESC",filter:{path:e}},t?[t]:void 0);if(r.length!==0)return r[0]}queryDocs(e={},t){if(this.closed)throw new _n;if(this.replica.isClosed())throw new Qe;const n={...e,formats:(t||vi).map(p=>p.id)},i=fl(n);if(i.willMatch==="nothing")return[];const a=xc(i.query),o=this.docCache.get(a);if(o)return Date.now()>o.expires&&this.replica.queryDocs(e,t).then(p=>{const m=p.map(la).sort(),b=o.docs.map(la).sort();Mu(m,b)||(this.docCache.set(a,{stream:o.stream,close:o.close,docs:p,expires:Date.now()+this.timeToLive}),kn.debug("Updated cache because result expired."),this.fireOnCacheUpdateds())}),o.docs;const u=this.replica.getQueryStream(e,"new",t),l=new al,c=l.onWrite(p=>{(p.kind==="existing"||p.kind==="success")&&(kn.debug({doc:p.doc.path,queryString:a}),this._updateCache(a,p.doc))}),f=new Rt(l),d=new AbortController;u.pipeTo(f,{signal:d.signal});const h=()=>{c()};return this.docCache.set(a,{stream:u,docs:[],expires:Date.now()+this.timeToLive,close:h}),this.replica.queryDocs(n).then(p=>{this.docCache.set(a,{stream:u,close:h,docs:p,expires:Date.now()+this.timeToLive}),kn.debug("Updated cache with a new entry."),this.fireOnCacheUpdateds()}),[]}queryPaths(e={},t){const r=this.queryDocs(e,t),n=new Set(r.map(({path:i})=>i));return Array.from(n).sort()}queryAuthors(e={},t){const r=this.queryDocs(e,t),n=new Set(r.map(({author:i})=>i));return Array.from(n).sort()}_updateCache(e,t){const r=this.docCache.get(e);if(!r)return;const n=JSON.parse(e),i=()=>{const h=[...r.docs,t];this.docCache.set(e,{...r,docs:ca(n,h)}),this.fireOnCacheUpdateds()},a=({exact:h})=>{const p=r.docs.map(m=>h&&m.path===t.path&&m.author===t.author||!h&&m.path===t.path?t:m);this.docCache.set(e,{...r,docs:ca(n,p)}),this.fireOnCacheUpdateds()},o=r.docs.filter(h=>h.path===t.path),u=r.docs.filter(h=>h.path===t.path&&h.author===t.author);if(o.length===0){(n.filter&&ds(t,n.filter)||!n.filter)&&(kn.debug("Updated cache after appending a doc to a entry with matching filter."),i());return}if((n.historyMode||"latest")==="all"){if(u.length===0){kn.debug("Updated cache after appending a version of a doc to a historyMode: all query."),i();return}kn.debug("Updated cache after replacing a version of a doc in a historyMode: all query."),a({exact:!0});return}const c=o[0],f=t.author!==(c==null?void 0:c.author)||!si(t,c),d=t.timestamp>c.timestamp;if(f&&d){kn.debug("Updated cache after replacing a doc with its latest version."),a({exact:!1});return}}fireOnCacheUpdateds(){this.version++,this.onFireCacheUpdatedsWrapper(()=>{this.onCacheUpdatedCallbacks.forEach(e=>{e()})})}onCacheUpdated(e){if(this.closed)throw new _n;if(this.replica.isClosed())throw new Qe;return this.onCacheUpdatedCallbacks.add(e),()=>{this.onCacheUpdatedCallbacks.delete(e)}}set(e,t,r){if(this.closed)throw new _n;return this.replica.set(e,t,r)}overwriteAllDocsByAuthor(e,t){if(this.closed)throw new _n;if(this.replica.isClosed())throw new Qe;return this.replica.overwriteAllDocsByAuthor(e,t)}wipeDocAtPath(e,t,r=Wt){if(this.closed)throw new _n;return this.replica.wipeDocAtPath(e,t,r)}async onReplicaEvent(e){const t=`${e.doc.path}|${e.doc.author}`,r=this.attachmentCache.get(t);if(!r)return;const n=await this.replica.getAttachment(e.doc,r.format);this.attachmentCache.set(t,{expires:Date.now()+this.timeToLive,attachment:n,format:r.format}),this.fireOnCacheUpdateds()}getAttachment(e,t=Wt){if(this.closed)throw new _n;if(this.replica.isClosed())throw new Qe;const r=t.getAttachmentInfo(e);if(se(r))return r;const n=`${e.path}|${e.author}`,i=this.attachmentCache.get(n);if(i)return Date.now()>i.expires&&this.replica.getAttachment(e,t).then(a=>{this.attachmentCache.set(n,{expires:Date.now()+this.timeToLive,attachment:a,format:t}),this.fireOnCacheUpdateds()}),e.deleteAfter&&Date.now()*1e3>e.deleteAfter?new ie("This document has expired"):i.attachment;this.attachmentCache.set(n,{attachment:void 0,expires:Date.now()+this.timeToLive,format:t}),this.replica.getAttachment(e,t).then(a=>{this.attachmentCache.set(n,{expires:Date.now()+this.timeToLive,attachment:a,format:t}),this.fireOnCacheUpdateds()})}addAttachments(e,t){const r=[],n=Yn(t);for(const i of e){const a=this.getAttachment(i,n[i.format]);r.push({...i,attachment:a})}return r}}new Dt("storage driver async memory","yellow");async function Oh(s){let e=new Uint8Array;return await s.pipeTo(new Rt({write(t){const r=new Uint8Array(e.length+t.length);r.set(e),r.set(t,e.length),e=r}})),e}async function Nh(s,e,t){const r=yi(s);if(se(r))return new ie("Invalid share address.");for(const o of e)try{new URL(o)}catch{return new ie(`Could not parse ${o} as a URL.`)}const n=e.map(o=>`&server=${o}`).join("&");let i="";if(t){const o=await qe.checkKeypairIsValid({shareAddress:s,secret:t});if(se(o))return new ie(`Supplied the wrong secret for ${s}`);i=`&secret=${t}`}return`earthstar://${s}/?invite${n}${i}&v=2`}async function Mh(s){try{const e=new URL(s),t=e.hostname.length>0?e.hostname:e.pathname.replaceAll("/",""),r=yi(t);if(se(r))return new ie("Invitation did not include a valid share address.");const n=new URLSearchParams(e.search),i=n.get("invite"),a=n.get("v");if(i===null)return new ie("Not an invitation URL");if(a===null)return new ie("Invitation version not specified.");if(a!=="2")return new ie(`Invitation version is ${a}, expected version 2.`);const o=n.getAll("server");for(const l of o)try{new URL(l)}catch{return new ie(`Invitation's servers included a malformed URL: ${l}`)}const u=n.get("secret");if(u){const l=await qe.checkKeypairIsValid({shareAddress:t,secret:u});if(se(l))return new ie(`Invitation contains the wrong secret for share ${t}.`)}return{shareAddress:t,secret:u||void 0,servers:o}}catch{return new ie("Could not parse the invitation URL.")}}const Lh="earthstar",Gr="current_author",Cr="shares",Ar="share_secrets",kr="servers";class zh{constructor(e){Object.defineProperty(this,"namespace",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:localStorage}),Object.defineProperty(this,"authorChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"sharesChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"shareSecretsChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"serversChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),this.namespace=e==null?void 0:e.namespace,e!=null&&e.sessionOnly&&(this.storage=sessionStorage),addEventListener("storage",t=>{switch(t.key){case ot(Gr,this.namespace):{this.fireAuthorEvent();break}case ot(Cr,this.namespace):{this.fireSharesEvent();break}case ot(Ar,this.namespace):{this.fireSecretsEvent();break}case ot(kr,this.namespace):{this.fireServersEvent();break}}})}get author(){const e=ot(Gr,this.namespace);return Yr(this.storage,e,$h)||null}set author(e){const t=ot(Gr,this.namespace);this.storage.setItem(t,JSON.stringify(e)),this.fireAuthorEvent()}get shares(){const e=ot(Cr,this.namespace);return Yr(this.storage,e,jh)||[]}addShare(e){if(se(bn(e)))return new ie("Not a valid share");const t=ot(Cr,this.namespace),r=new Set([...this.shares,e]),n=Array.from(r);return this.storage.setItem(t,JSON.stringify(n)),this.fireSharesEvent(),n}removeShare(e){const t=this.shares,r=t.findIndex(i=>i===e);if(r===-1)return new ie("That share is not known yet");t.splice(r,1);const n=ot(Cr,this.namespace);return this.storage.setItem(n,JSON.stringify(t)),this.fireSharesEvent(),t}get shareSecrets(){const e=ot(Ar,this.namespace);return Yr(this.storage,e,Uh)||{}}async addSecret(e,t){if(!this.shares.find(a=>e===a))return new ie("This share is not yet known.");if(se(await qe.checkKeypairIsValid({shareAddress:e,secret:t})))return new ie("Not the right secret for this share.");const n=ot(Ar,this.namespace),i={...this.shareSecrets,[e]:t};return this.storage.setItem(n,JSON.stringify(i)),this.fireSecretsEvent(),i}removeSecret(e){const t=this.shareSecrets;if(!t[e])return new ie("Unknown share");const n=ot(Ar,this.namespace),i={...t};return delete i[e],this.storage.setItem(n,JSON.stringify(i)),this.fireSecretsEvent(),i}get servers(){const e=ot(kr,this.namespace);return Yr(this.storage,e,Hh)||[]}addServer(e){try{const t=new URL(e),r=new Set([...this.servers,t.toString()]),n=Array.from(r),i=ot(kr,this.namespace);return this.storage.setItem(i,JSON.stringify(n)),this.fireServersEvent(),n}catch{return new ie("Not a valid URL.")}}removeServer(e){try{const t=new URL(e),r=this.servers,n=r.findIndex(a=>a===t.toString());if(n===-1)return new ie("That server is not known yet");r.splice(n,1);const i=ot(kr,this.namespace);return this.storage.setItem(i,JSON.stringify(r)),this.fireServersEvent(),r}catch{return new ie("Not a valid URL")}}clear(){const e=ot(Gr,this.namespace);this.storage.setItem(e,JSON.stringify(null));const t=ot(Cr,this.namespace);this.storage.setItem(t,JSON.stringify([]));const r=ot(Ar,this.namespace);this.storage.setItem(r,JSON.stringify({}));const n=ot(kr,this.namespace);this.storage.setItem(n,JSON.stringify([])),this.fireAuthorEvent(),this.fireSharesEvent(),this.fireSecretsEvent(),this.fireServersEvent()}onAuthorChanged(e){return this.authorChangedCbs.add(e),()=>{this.authorChangedCbs.delete(e)}}onSharesChanged(e){return this.sharesChangedCbs.add(e),()=>{this.sharesChangedCbs.delete(e)}}onShareSecretsChanged(e){return this.shareSecretsChangedCbs.add(e),()=>{this.shareSecretsChangedCbs.delete(e)}}onServersChanged(e){return this.serversChangedCbs.add(e),()=>{this.serversChangedCbs.delete(e)}}getPeer({sync:e,onCreateReplica:t}){const r=new Lr,n=this.shares;for(const l of n){const c=t(l,this.shareSecrets[l]);r.addReplica(c)}const i=this.onSharesChanged(async l=>{const c=r.replicas(),f=r.shares();for(const d of c)l.includes(d.share)||(r.removeReplica(d),await d.close(!1));for(const d of l)if(!f.includes(d)){const h=t(d,this.shareSecrets[d]);r.addReplica(h)}}),a=this.onShareSecretsChanged(async l=>{const c=r.shares(),f=Object.keys(l);for(const d of c)if(!f.includes(d)){const h=r.getReplica(d);h&&(r.removeReplica(h),h.close(!1));const p=t(d);r.addReplica(p)}for(const d of f){const h=r.getReplica(d);if(h!=null&&h.formatsConfig["es.5"]&&h.formatsConfig["es.5"].shareSecret)continue;await(h==null?void 0:h.close(!1)),r.removeReplicaByShare(d);const p=t(d,l[d]);r.addReplica(p)}});if(e)for(const l of this.servers)r.sync(l,e==="continuous");const o=this.onServersChanged(l=>{if(e){const c=r.getSyncers();for(const[f,{description:d,syncer:h}]of c)l.includes(d)||h.cancel();for(const f of l)r.sync(f,e==="continuous")}});return{peer:r,unsubscribeFromSettings:()=>{i(),a(),o()}}}fireAuthorEvent(){const e=this.author;for(const t of this.authorChangedCbs)t(e)}fireSharesEvent(){const e=this.shares;for(const t of this.sharesChangedCbs)t(e)}fireSecretsEvent(){const e=this.shareSecrets;for(const t of this.shareSecretsChangedCbs)t(e)}fireServersEvent(){const e=this.servers;for(const t of this.serversChangedCbs)t(e)}async redeemInvitationURL(e){const t=await Mh(e);if(se(t))return t;this.addShare(t.shareAddress);for(const r of t.servers)this.addServer(r);return t.secret&&this.addSecret(t.shareAddress,t.secret),!0}}function ot(s,e){return`${Lh}:${e?`${e}:`:""}${s}`}function Yr(s,e,t){const r=s.getItem(e);if(r!==null)try{const n=JSON.parse(r);return t(n)?n:void 0}catch{return}}function hl(s){return!(s==null||typeof s!="object")}function $h(s){return!(!hl(s)||Object.keys(s).length!==2||!("address"in s)||!("secret"in s))}function jh(s){return!(!Array.isArray(s)||s.some(e=>typeof e!="string")||s.some(e=>se(bn(e))))}function Uh(s){if(!hl(s))return!1;for(const e in s){const t=s[e];if(typeof t!="string"||se(qe.checkKeypairIsValid({shareAddress:e,secret:t})))return!1}return!0}function Hh(s){if(!Array.isArray(s)||s.some(e=>typeof e!="string"))return!1;for(const e of s)try{new URL(e)}catch{return!1}return!0}function qh(s){const e=s-1;return e*e*e+1}function Wh(s,{delay:e=0,duration:t=400,easing:r=Yl}={}){const n=+getComputedStyle(s).opacity;return{delay:e,duration:t,easing:r,css:i=>`opacity: ${i*n}`}}function Jn(s,{delay:e=0,duration:t=400,easing:r=qh,x:n=0,y:i=0,opacity:a=0}={}){const o=getComputedStyle(s),u=+o.opacity,l=o.transform==="none"?"":o.transform,c=u*(1-a);return{delay:e,duration:t,easing:r,css:(f,d)=>`
			transform: ${l} translate(${(1-f)*n}px, ${(1-f)*i}px);
			opacity: ${u-c*d}`}}const jn=[];function dl(s,e){return{subscribe:fr(s,e).subscribe}}function fr(s,e=X){let t;const r=new Set;function n(o){if(we(s,o)&&(s=o,t)){const u=!jn.length;for(const l of r)l[1](),jn.push(l,s);if(u){for(let l=0;l<jn.length;l+=2)jn[l][0](jn[l+1]);jn.length=0}}}function i(o){n(o(s))}function a(o,u=X){const l=[o,u];return r.add(l),r.size===1&&(t=e(n)||X),o(s),()=>{r.delete(l),r.size===0&&(t(),t=null)}}return{set:n,update:i,subscribe:a}}function Vh(s,e,t){const r=!Array.isArray(s),n=r?[s]:s,i=e.length<2;return dl(t,a=>{let o=!1;const u=[];let l=0,c=X;const f=()=>{if(l)return;c();const h=e(r?u[0]:u,a);i?a(h):c=pu(h)?h:X},d=n.map((h,p)=>Jl(h,m=>{u[p]=m,l&=~(1<<p),o&&f()},()=>{l|=1<<p}));return o=!0,f(),function(){je(d),c()}})}const Et=fr({address:"",secret:""});new Dt("storage driver localStorage","gold");const En=new Dt("replica driver indexeddb","gold");function Kh(s,e){return ps([s.path,s.timestamp,s.signature],[e.path,e.timestamp,s.signature],["ASC","DESC","ASC"])}function Zh(s,e){return ps([s.path,s.timestamp,s.signature],[e.path,e.timestamp,s.signature],["DESC","DESC","ASC"])}const Bt="docs",zt="config";class Qh{constructor(e,t){Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:Ie()}),Object.defineProperty(this,"gotInitialMaxLocalIndex",{enumerable:!0,configurable:!0,writable:!0,value:Ie()}),Object.defineProperty(this,"localMaxLocalIndex",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1});const r=bn(e);if(se(r))throw r;if(this.share=e,En.debug("constructor"),!window.indexedDB)throw new Ct("IndexedDB is not supported by this runtime.");const n=Nu.indexedDB.open(`earthstar:share_docs:${this.share}${t?`/${t}`:""}`,1);n.onerror=()=>{throw En.error(`Could not open IndexedDB for ${this.share}'s attachments.`),En.error(n.error),new Ct(`Could not open IndexedDB for ${this.share}'s attachments.`)},n.onupgradeneeded=function(){const i=n.result,a=i.createObjectStore(Bt,{keyPath:["path","author"]});a.createIndex("comboIndex",["_localIndex","timestamp","path","author"],{unique:!0}),a.createIndex("pathTimestampIndex",["path","timestamp"],{unique:!1}),a.createIndex("pathAuthorIndex",["path","author"],{unique:!0}),a.createIndex("deleteAfterIndex","deleteAfter",{unique:!1}),a.createIndex("localIndexIndex","_localIndex",{unique:!0}),i.createObjectStore(zt,{keyPath:"key"}).createIndex("keyIndex",["key"],{unique:!0})},n.onsuccess=()=>{this.db.resolve(n.result);const a=n.result.transaction([Bt],"readonly").objectStore(Bt).index("localIndexIndex").openCursor(null,"prev");a.onsuccess=()=>{a.result?this.gotInitialMaxLocalIndex.resolve(a.result.value._localIndex):this.gotInitialMaxLocalIndex.resolve(-1)}},this.gotInitialMaxLocalIndex.then(i=>{this.localMaxLocalIndex=i})}isClosed(){return this.closed}async close(e){if(this.closed)throw new Qe;this.closed=!0;const t=Ie();if(e){const n=(await this.db).transaction([Bt,zt],"readwrite"),i=Ie(),a=Ie(),o=n.objectStore(Bt).clear().onsuccess=()=>{i.resolve()},u=n.objectStore(zt).clear().onsuccess=()=>{a.resolve()};await Promise.all([o,u]),t.resolve()}else t.resolve();return(await this.db).close(),await il(20),t}async getMaxLocalIndex(){return await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex}async queryDocs(e){var c,f,d,h,p,m,b,g,D,v,C,k,I;const r=(await this.db).transaction([Bt],"readonly").objectStore(Bt),n=Ie(),{query:i,willMatch:a}=fl(e);if(En.debug(`    cleanUpQuery.  willMatch = ${a}`),a==="nothing")return[];if((c=i.filter)!=null&&c.path&&i.historyMode==="latest"){const F=IDBKeyRange.bound([i.filter.path,i.filter.timestampGt||0],[i.filter.path,i.filter.timestampLt||Number.MAX_SAFE_INTEGER]),N=r.index("pathTimestampIndex").openCursor(F,"prev");N.onsuccess=()=>{var j;(j=N.result)!=null&&j.value?n.resolve([N.result.value]):n.resolve([])}}else if((f=i.filter)!=null&&f.path&&i.historyMode==="all"){const F=r.index("pathAuthorIndex"),T=IDBKeyRange.bound([i.filter.path," "],[i.filter.path,"~"]),N=F.getAll(T);N.onsuccess=()=>{N.result?n.resolve(Array.from(N.result)):n.resolve([])}}else{const F=((d=i.startAfter)==null?void 0:d.path)||((h=i.filter)==null?void 0:h.path)||((p=i.filter)==null?void 0:p.pathStartsWith)||" ",T=((m=i.filter)==null?void 0:m.author)||" ",N=((b=i.filter)==null?void 0:b.timestamp)||((g=i.filter)==null?void 0:g.timestampGt)||0,j=((D=i.startAfter)==null?void 0:D.localIndex)||0,G=((v=i.filter)==null?void 0:v.path)||"~",R=((C=i.filter)==null?void 0:C.author)||"~",L=((k=i.filter)==null?void 0:k.timestamp)||((I=i.filter)==null?void 0:I.timestampLt)||Number.MAX_SAFE_INTEGER,y=Number.MAX_SAFE_INTEGER,q=IDBKeyRange.bound([j,N,F,T],[y,L,G,R]),U=r.index("comboIndex").getAll(q);U.onsuccess=()=>{U.result?n.resolve(U.result):n.resolve([])}}const o=await n;if(i.historyMode==="latest"){const F=o.splice(0,o.length),T=new Map;for(const N of F){const j=T.get(N.path);(!j||j.timestamp<N.timestamp)&&T.set(N.path,N)}o.push(...T.values())}const u=[];En.debug("    filtering docs");const l=Date.now()*1e3;for(const F of o)F.deleteAfter&&F.deleteAfter<l||i.filter&&!ds(F,i.filter)||u.push(F);if(En.debug(`    ordering docs: ${i.orderBy}`),i.orderBy==="path ASC")u.sort(Kh);else if(i.orderBy==="path DESC")u.sort(Zh);else if(i.orderBy==="localIndex ASC")u.sort(oa("_localIndex","ASC"));else if(i.orderBy==="localIndex DESC")u.sort(oa("_localIndex","DESC"));else if(i.orderBy)throw new ie("unrecognized query orderBy: "+JSON.stringify(i.orderBy));return i.limit!==void 0&&o.length>=i.limit?u.slice(0,i.limit):(En.debug(`    queryDocs is done: found ${u.length} docs.`),u)}async upsert(e){const t=await this.db,n=t.transaction([Bt],"readwrite").objectStore(Bt).index("pathAuthorIndex"),i=Ie(),a=n.openCursor([e.path,e.author]);if(await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex+=1,e._localIndex=this.localMaxLocalIndex,a.onsuccess=()=>{if(a.result){const f=a.result.update(e);f.onsuccess=()=>{i.resolve(!!f.result)}}else i.resolve(!1)},await i)return e;const l=t.transaction([Bt],"readwrite").objectStore(Bt).put(e),c=Ie();return l.onsuccess=()=>{c.resolve()},l.onerror=()=>{throw l.error},await c,e}async eraseExpiredDocs(){const e=[],n=(await this.db).transaction([Bt],"readwrite").objectStore(Bt).index("deleteAfterIndex"),i=Date.now()*1e3,a=IDBKeyRange.bound(0,i),o=n.openCursor(a),u=Ie();return o.onsuccess=()=>{var l;if((l=o.result)!=null&&l.value){const c=o.result.value;if(c.deleteAfter!==null&&c.deleteAfter!==void 0){e.push(c);const f=o.result.delete();f.onsuccess=()=>{var d;(d=o.result)==null||d.continue()}}}else u.resolve()},await u,e}async getConfig(e){const r=(await this.db).transaction([zt],"readonly").objectStore(zt),n=Ie(),i=r.get(e);return i.onsuccess=()=>{var a;n.resolve((a=i.result)==null?void 0:a.value)},n}async setConfig(e,t){const n=(await this.db).transaction([zt],"readwrite").objectStore(zt),i=Ie(),a=n.put({key:e,value:t});return a.onsuccess=()=>{i.resolve()},i}async listConfigKeys(){const t=(await this.db).transaction([zt],"readonly").objectStore(zt),r=Ie(),i=t.index("keyIndex").openKeyCursor(),a=[];return i.onsuccess=()=>{i.result?(a.push(i.result.primaryKey),i.result.continue()):r.resolve(a)},r}async deleteConfig(e){const r=(await this.db).transaction([zt],"readwrite").objectStore(zt),n=Ie(),i=r.index("keyIndex"),a=IDBKeyRange.bound([e],[e]),o=i.openCursor(a);return o.onsuccess=()=>{if(o.result){const u=o.result.delete();u.onsuccess=()=>{n.resolve(!0)}}else n.resolve(!1)},n}}const fa=new Dt("replica driver indexeddb","gold"),$t="attachment_staging_index",It="attachments_index",At="attachments_bytes";class Gh{constructor(e,t){if(Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:Ie()}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.share=e,!window.indexedDB)throw new Ct("IndexedDB is not supported by this runtime.");const r=Nu.indexedDB.open(`earthstar:share_attachments:${this.share}${t?`/${t}`:""}`,1);r.onerror=()=>{throw fa.error(`Could not open IndexedDB for ${this.share}'s attachments.`),fa.error(r.error),new Ct(`Could not open IndexedDB for ${this.share}'s attachments.`)},r.onupgradeneeded=function(){const n=r.result;n.createObjectStore(At),n.createObjectStore(It,{keyPath:"id"}),n.createObjectStore($t,{keyPath:"id"})},r.onsuccess=()=>{this.db.resolve(r.result)}}getIndexKey(e,t){return`${e}___${t}`}async getAttachment(e,t){if(this.closed)throw new Qe;const r=Ie(),n=this.getIndexKey(e,t),i=await this.db,o=i.transaction([It],"readonly").objectStore(It).get(n),u=Ie();return o.onerror=()=>{u.reject()},o.onsuccess=()=>{o.result===void 0?u.reject():u.resolve(o.result.blobKey)},u.then(l=>{const f=i.transaction([At],"readonly").objectStore(At).get(l);f.onsuccess=()=>{const d=new yu([f.result]);r.resolve({bytes:async()=>new Uint8Array(await d.arrayBuffer()),stream:()=>Promise.resolve(d.stream())})},f.onerror=()=>{r.resolve(void 0)}}).catch(()=>{r.resolve(void 0)}),r}async erase(e,t){if(this.closed)throw new Qe;const r=Ie(),n=this.getIndexKey(e,t),i=await this.db,o=i.transaction([It],"readonly").objectStore(It).get(n),u=Ie();return o.onerror=()=>{u.reject()},o.onsuccess=()=>{i.transaction([It],"readwrite").objectStore(It).delete(n),o.result===void 0?u.reject():u.resolve(o.result.blobKey)},u.then(l=>{const c=i.transaction([At],"readwrite").objectStore(At).delete(l);c.onsuccess=()=>{r.resolve(!0)},c.onerror=()=>{r.resolve(void 0)}}).catch(()=>{r.resolve(new ie("No attachment found"))}),r}async stage(e,t){if(this.closed)throw new Qe;const r=await this.db,n=t instanceof Uint8Array?t:await Oh(t),i=await qe.sha256base32(n),a=this.getIndexKey(e,i),o=`${a}___${sn()}`,u=r.transaction([At,$t],"readwrite"),l=u.objectStore(At).put(n,o),c=u.objectStore($t).put({id:a,blobKey:o}),f=Ie(),d=Ie();return l.onsuccess=()=>f.resolve(),c.onsuccess=()=>d.resolve(),await f,await d,{hash:i,size:n.byteLength,reject:async()=>{const h=r.transaction([At,$t],"readwrite"),p=h.objectStore(At).delete(o),m=h.objectStore($t).delete(a),b=Ie(),g=Ie();p.onsuccess=()=>{b.resolve()},m.onsuccess=()=>{g.resolve()},await Promise.all([b,g])},commit:async()=>{const h=r.transaction([It,$t],"readwrite"),p=h.objectStore($t).delete(a),m=h.objectStore(It).put({id:a,blobKey:o}),b=Ie(),g=Ie();p.onsuccess=()=>b.resolve(),m.onsuccess=()=>g.resolve(),await Promise.all([b,g])}}}async wipe(){if(this.closed)throw new Qe;const t=(await this.db).transaction([At,It,$t],"readwrite"),r=t.objectStore(At).clear(),n=t.objectStore(It).clear(),i=t.objectStore($t).clear(),a=Ie(),o=Ie(),u=Ie();r.onsuccess=()=>a.resolve(),n.onsuccess=()=>o.resolve(),i.onsuccess=()=>u.resolve(),await Promise.all([a,o,u])}async clearStaging(){if(this.closed)throw new Qe;const t=(await this.db).transaction([At,$t]),r=t.objectStore($t).openCursor(),n=Ie();return r.onsuccess=()=>{const i=r.result;if(!i){n.resolve();return}const a=i.value.blobKey,o=t.objectStore(At).delete(a);i.delete(),o.onsuccess=()=>{i.continue()},o.onerror=()=>{i.continue()}},n}async filter(e){if(this.closed)throw new Qe;const r=(await this.db).transaction([At,It],"readwrite"),n=50,i=[],a=[],o=Ie(),u=(l=null)=>{const c=r.objectStore(It).getAll(l,n);c.onsuccess=()=>{const f=c.result;for(const d of f){const[h,p]=d.id.split("___");e[h]&&!e[h].has(p)&&(i.push({format:h,hash:p}),a.push(this.erase(h,p)))}if(f.length===n){const d=f[f.length-1],h=IDBKeyRange.lowerBound(d.id,!0);u(h)}else o.resolve()}};return u(),await o,await Promise.all(a),i}isClosed(){return this.closed}async close(e){if(this.closed)throw new Qe;e&&await this.wipe(),this.closed=!0,(await this.db).close(),await il(20)}}class Yh{constructor(e,t){Object.defineProperty(this,"docDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachmentDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.docDriver=new Qh(e,t),this.attachmentDriver=new Gh(e,t)}}const Jh={shareAddress:"+commons.b7q4gt64yiefosdafnmhvtxz43akzk6gw54aesdahtf4kdgpbyeia",secret:"bigzorlvyjy5fy5a3kglfzcyfzramsic3cihj4rqphmd6x5wo5jcq"},Mt=fr(Jh),jt=fr(null);Mt.subscribe(s=>{console.log("shareKeypair store changed:",s);const e=s.shareAddress,t=s.secret,r=new xh({driver:new Yh(e),shareSecret:t});jt.set({replica:r})});const Re=new zh,zr=fr(Re.shares);Re.onSharesChanged(s=>{zr.set(s)});function Xh(s){const e=Re.removeShare(s);Array.isArray(e)?zr.set(e):console.error(e)}function ed(s){zr.set(s)}function ha(s){let e,t;return{c(){e=A("p"),t=J(s[1]),E(e,"class","text-2xl")},m(r,n){S(r,e,n),w(e,t)},p(r,n){n&2&&Ae(t,r[1])},d(r){r&&B(e)}}}function td(s){let e,t,r,n,i,a,o,u,l,c,f=s[1]&&ha(s);return{c(){e=A("div"),t=A("label"),t.textContent="Have an existing ID?",r=z(),n=A("div"),i=A("textarea"),a=z(),o=A("button"),o.textContent="Validate ID",u=z(),f&&f.c(),E(t,"for","keypair"),E(i,"class","px-5 my-2 svelte-5at67e"),E(i,"id","keypair"),E(i,"placeholder",`Paste it here:       
{
"address": "", 
"secret": ""
}`),E(o,"class","phase1 mx-4 my-2"),E(n,"class","flex md:flex-row items-end mx-0 flex-col svelte-5at67e"),E(e,"class","flex flex-col items-start mx-0 svelte-5at67e")},m(d,h){S(d,e,h),w(e,t),w(e,r),w(e,n),w(n,i),tt(i,s[0]),w(n,a),w(n,o),w(e,u),f&&f.m(e,null),l||(c=[fe(i,"input",s[3]),fe(o,"click",s[2])],l=!0)},p(d,[h]){h&1&&tt(i,d[0]),d[1]?f?f.p(d,h):(f=ha(d),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i:X,o:X,d(d){d&&B(e),f&&f.d(),l=!1,je(c)}}}function nd(s,e,t){const r=bt();let n="",i="";function a(){try{let u=JSON.parse(n);u.address&&u.secret?se(wi(u.address))?(t(1,i="Invalid address"),r("error")):(Et.set({address:u.address,secret:u.secret}),Re.author=u,r("validated")):(t(1,i="Invalid keypair"),r("error"))}catch{t(1,i="Invalid JSON"),r("error")}}function o(){n=this.value,t(0,n)}return[n,i,a,o]}class rd extends ye{constructor(e){super(),ve(this,e,nd,td,we,{})}}function id(s){let e,t,r,n,i,a,o,u,l,c,f,d,h,p;return{c(){e=A("input"),t=z(),r=A("button"),n=J(`Upload ID
    `),i=A("br"),a=z(),o=A("br"),u=z(),l=A("img"),f=z(),d=A("span"),d.textContent="It is a JSON file",ze(e,"display","none"),E(e,"type","file"),E(e,"accept",".json, .txt"),vt(l.src,c=sd)||E(l,"src",c),E(l,"alt","upload id is a mouse "),E(d,"class","tooltiptext svelte-zq0ldm"),E(r,"class","phase1 tooltip px-8 pb-8 svelte-zq0ldm")},m(m,b){S(m,e,b),s[4](e),S(m,t,b),S(m,r,b),w(r,n),w(r,i),w(r,a),w(r,o),w(r,u),w(r,l),w(r,f),w(r,d),h||(p=[fe(e,"change",s[3]),fe(r,"click",s[5])],h=!0)},p:X,i:X,o:X,d(m){m&&B(e),s[4](null),m&&B(t),m&&B(r),h=!1,je(p)}}}let sd="images/upload-img.png";function ad(s){return new Promise((e,t)=>{let r=new FileReader;r.onload=()=>{e(r.result)},r.onerror=t,r.readAsBinaryString(s)})}function od(s,e,t){const r=bt();let n,i,{identityPg:a=!1}=e;async function o(f){let d=f.target.files[0],h=await ad(d);try{let p=JSON.parse(h);console.log(typeof p),console.log("fileReady",h);let m=p.address;console.log("authorAddress",m);let b=p.secret;console.log("authorSecret",b),Et.set({address:m,secret:b}),i=m.slice(1,5),r("alias",i)}catch{r("error")}}const u=f=>o(f);function l(f){pi[f?"unshift":"push"](()=>{n=f,t(0,n)})}const c=()=>{n.click()};return s.$$set=f=>{"identityPg"in f&&t(2,a=f.identityPg)},[n,o,a,u,l,c]}class ud extends ye{constructor(e){super(),ve(this,e,od,id,we,{identityPg:2})}}function da(s){let e,t,r,n,i;return{c(){e=A("h4"),e.textContent="Your current Identity Keypair:",t=z(),r=A("h4"),n=A("b"),i=J(s[1]),E(r,"class","my-4")},m(a,o){S(a,e,o),S(a,t,o),S(a,r,o),w(r,n),w(n,i)},p(a,o){o&2&&Ae(i,a[1])},d(a){a&&B(e),a&&B(t),a&&B(r)}}}function pa(s){let e,t,r;function n(o,u){return o[5]==="ID must be 4 characters long"?hd:o[5]==="ID must start with a letter"?fd:o[5]==="ID must not contain special characters"?cd:ld}let i=n(s),a=i(s);return{c(){e=A("blockquote"),a.c()},m(o,u){S(o,e,u),a.m(e,null),r=!0},p(o,u){i!==(i=n(o))&&(a.d(1),a=i(o),a&&(a.c(),a.m(e,null)))},i(o){r||(xn(()=>{t||(t=Kn(e,Jn,{y:200,duration:2e3},!0)),t.run(1)}),r=!0)},o(o){t||(t=Kn(e,Jn,{y:200,duration:2e3},!1)),t.run(0),r=!1},d(o){o&&B(e),a.d(),o&&t&&t.end()}}}function ld(s){let e;return{c(){e=J("Press enter to generate a new keypair.")},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function cd(s){let e;return{c(){e=A("i"),e.innerHTML=`<strong>Special characters are not allowed.</strong> 
                    <br/>`},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function fd(s){let e;return{c(){e=A("i"),e.innerHTML="<strong>A valid alias must begin with a letter.</strong> It needs to be 4 characters long and can only contain letters and numbers."},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function hd(s){let e;return{c(){e=A("i"),e.innerHTML="A valid id <strong>needs to be 4 characters long</strong>."},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function ma(s){let e,t,r;return{c(){e=A("blockquote"),e.innerHTML="<strong>Please upload a valid identity file</strong>"},m(n,i){S(n,e,i),r=!0},i(n){r||(xn(()=>{t||(t=Kn(e,Jn,{y:200,duration:2e3},!0)),t.run(1)}),r=!0)},o(n){t||(t=Kn(e,Jn,{y:200,duration:2e3},!1)),t.run(0),r=!1},d(n){n&&B(e),n&&t&&t.end()}}}function dd(s){let e,t,r,n,i,a,o,u,l,c,f,d,h,p,m,b,g,D,v,C,k,I,F,T,N,j,G,R,L,y,q,ee,U,Z,Q,be=s[3].address.length!==0&&da(s),W=s[6]&&pa(s),H=s[7]===!0&&ma();return{c(){e=A("div"),be&&be.c(),t=z(),r=A("div"),r.textContent="Your identity is represented by the keypair seen below. It contains your address and secret.",n=z(),i=A("div"),a=A("div"),o=A("b"),o.textContent="Address:",u=z(),l=J(s[2]),c=z(),f=A("br"),d=z(),h=A("b"),h.textContent="Secret:",p=z(),m=J(s[8]),b=z(),g=A("div"),D=J(`You can

        `),v=A("button"),v.textContent="generate another identity",C=J(`

    or customize your alias in the box below.`),k=z(),I=A("div"),F=J(`Your alias is 
    `),T=A("input"),N=z(),j=A("div"),j.textContent="You can download it and reuse it later.",G=z(),R=A("div"),L=A("button"),L.textContent="Download your identity file",y=z(),q=A("div"),W&&W.c(),ee=z(),H&&H.c(),E(i,"class","my-6"),E(v,"class","phase1 svelte-3j8vy0"),E(T,"type","text"),E(T,"spellcheck","false"),E(T,"maxlength","4"),E(T,"class","svelte-3j8vy0"),E(I,"class","my-4"),E(j,"class","mt-6"),E(L,"class","phase1 w-auto svelte-3j8vy0"),E(R,"class","flex items-start align-left flex-col"),E(e,"class","p-4 w-full text-left")},m(pe,de){S(pe,e,de),be&&be.m(e,null),w(e,t),w(e,r),w(e,n),w(e,i),w(i,a),w(a,o),w(a,u),w(a,l),w(a,c),w(a,f),w(a,d),w(a,h),w(a,p),w(a,m),w(e,b),w(e,g),w(g,D),w(g,v),w(g,C),w(e,k),w(e,I),w(I,F),w(I,T),tt(T,s[4]),w(e,N),w(e,j),w(e,G),w(e,R),w(R,L),w(e,y),w(e,q),W&&W.m(q,null),w(q,ee),H&&H.m(q,null),U=!0,Z||(Q=[fe(v,"click",s[10]),fe(T,"input",s[11]),fe(T,"keypress",s[12]),fe(T,"focus",s[13]),fe(T,"keypress",s[14]),fe(L,"click",s[15])],Z=!0)},p(pe,[de]){pe[3].address.length!==0?be?be.p(pe,de):(be=da(pe),be.c(),be.m(e,t)):be&&(be.d(1),be=null),(!U||de&4)&&Ae(l,pe[2]),(!U||de&256)&&Ae(m,pe[8]),de&16&&T.value!==pe[4]&&tt(T,pe[4]),pe[6]?W?(W.p(pe,de),de&64&&P(W,1)):(W=pa(pe),W.c(),P(W,1),W.m(q,ee)):W&&(me(),M(W,1,1,()=>{W=null}),ge()),pe[7]===!0?H?de&128&&P(H,1):(H=ma(),H.c(),P(H,1),H.m(q,null)):H&&(me(),M(H,1,1,()=>{H=null}),ge())},i(pe){U||(P(W),P(H),U=!0)},o(pe){M(W),M(H),U=!1},d(pe){pe&&B(e),be&&be.d(),W&&W.d(),H&&H.d(),Z=!1,je(Q)}}}function pd(s){return/[0-9]/.test(s)}function md(s){return/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(s)}function gd(){let s="",e="abcdefghijklmnopqrstuvwxyz",t=e.length,r="abcdefghijklmnopqrstuvwxyz0123456789",n=r.length;s+=e.charAt(Math.floor(Math.random()*t));for(let i=0;i<3;i++)s+=r.charAt(Math.floor(Math.random()*n));return s}function bd(s,e,t){let r,n,i,a;He(s,Et,v=>t(3,a=v));let o,u,l=!1,c=!1;function f(){let v=document.createElement("a"),C=new Blob([JSON.stringify(a)],{type:"text/plain"}),k=a.address+".json";v.href=URL.createObjectURL(C),v.download=k,v.style.display="none",document.body.appendChild(v),v.click()}async function d(v){v=="r"&&t(4,o=gd());let C=o.slice(0,1);if(pd(C))console.log("firstChar",C),t(5,u="ID must start with a letter");else if(o.length!==4)t(5,u="ID must be 4 characters long");else if(md(o))t(5,u="ID must not contain special characters");else{let k=await qe.generateAuthorKeypair(o),I=k.address,F=k.secret;Et.set({address:I,secret:F}),t(5,u=null),t(6,l=!1),Re.author=k}}Ft(async()=>{Re.author?Et.set(Re.author):d("r")});const h=()=>d("r");function p(){o=this.value,t(4,o),t(1,i),t(2,r),t(3,a)}const m=()=>{t(6,l=!0)},b=()=>{t(6,l=!0)},g=()=>d(),D=()=>f();return s.$$.update=()=>{s.$$.dirty&8&&t(2,r=a.address),s.$$.dirty&8&&t(8,n=a.secret),s.$$.dirty&4&&t(1,i=r.slice(0,5)),s.$$.dirty&2&&t(4,o=i.slice(1,5))},[d,i,r,a,o,u,l,c,n,f,h,p,m,b,g,D]}class Dd extends ye{constructor(e){super(),ve(this,e,bd,dd,we,{generateID:0})}get generateID(){return this.$$.ctx[0]}}function _d(s){let e,t,r,n,i;return{c(){e=A("div"),t=A("div"),r=A("button"),r.textContent="file upload",E(r,"class","phase1"),E(t,"class","svelte-1483hci"),E(e,"class","svelte-1483hci")},m(a,o){S(a,e,o),w(e,t),w(t,r),n||(i=[fe(r,"click",s[0]),fe(r,"keypress",s[0])],n=!0)},p:X,i:X,o:X,d(a){a&&B(e),n=!1,je(i)}}}function wd(s,e,t){const r=bt();let{xy:n=void 0}=e;function i(){r("selected",{type:"file",location:n})}return s.$$set=a=>{"xy"in a&&t(1,n=a.xy)},[i,n]}class yd extends ye{constructor(e){super(),ve(this,e,wd,_d,we,{xy:1})}}const Xn=fr(null);jt.subscribe(s=>{if(!s||!s.replica){console.error("Replica is undefined or does not contain a valid replica property");return}try{const e=new Ph(s.replica);Xn.set(e)}catch(e){console.error("Failed to create new cache:",e)}});const pl=dl(new Date,function(e){const t=setInterval(()=>{e(new Date)},1e3);return function(){clearInterval(t)}}),vd=new Date,Cd=Vh(pl,s=>Math.round((Number(s)-Number(vd))/1e3));function Ad(s){let e,t,r,n;return{c(){e=A("div"),t=A("button"),t.textContent="record audio",E(t,"class","phase1"),E(e,"class","svelte-lllvde")},m(i,a){S(i,e,a),w(e,t),r||(n=fe(t,"click",s[0]),r=!0)},p:X,i:X,o:X,d(i){i&&B(e),r=!1,n()}}}function kd(s,e,t){const r=bt();let{xy:n=void 0}=e;function i(){r("selected",{type:"audio",location:n})}return s.$$set=a=>{"xy"in a&&t(1,n=a.xy)},[i,n]}let Ed=class extends ye{constructor(e){super(),ve(this,e,kd,Ad,we,{xy:1})}};function Fd(s){let e,t,r,n,i;return{c(){e=A("div"),t=A("div"),r=A("button"),r.textContent="written text",E(r,"class","phase1"),E(t,"class","svelte-j8m7xm"),E(e,"class","svelte-j8m7xm")},m(a,o){S(a,e,o),w(e,t),w(t,r),n||(i=fe(r,"click",s[0]),n=!0)},p:X,i:X,o:X,d(a){a&&B(e),n=!1,i()}}}function Sd(s,e,t){const r=bt();let{xy:n=[0,0]}=e;function i(){r("selected",{type:"text",location:n})}return s.$$set=a=>{"xy"in a&&t(1,n=a.xy)},[i,n]}class Bd extends ye{constructor(e){super(),ve(this,e,Sd,Fd,we,{xy:1})}}function ga(s,e,t){const r=s.slice();return r[19]=e[t],r[21]=t,r}function ba(s,e,t){const r=s.slice();return r[19]=e[t],r[23]=t,r}function Da(s){let e,t,r,n,i,a=ui(s[5][1])+"",o,u,l=s[5][0]+1+"",c,f,d,h,p,m,b,g,D,v,C,k,I;return h=new Bd({props:{xy:s[5]}}),h.$on("selected",s[11]),m=new yd({props:{xy:s[5]}}),m.$on("selected",s[12]),g=new Ed({props:{xy:s[5]}}),g.$on("selected",s[13]),{c(){e=A("div"),t=A("div"),r=J(`What artefact would you like to create? 
      `),n=A("br"),i=z(),o=J(a),u=J(", "),c=J(l),f=z(),d=A("div"),oe(h.$$.fragment),p=z(),oe(m.$$.fragment),b=z(),oe(g.$$.fragment),D=z(),v=A("button"),v.textContent="close",E(t,"class","mt-6 brown text-left px-6 svelte-beup2s"),E(v,"class","phase1"),E(d,"class","flex-col"),E(e,"class","modal pb-6  svelte-beup2s"),E(e,"style",s[6])},m(F,T){S(F,e,T),w(e,t),w(t,r),w(t,n),w(t,i),w(t,o),w(t,u),w(t,c),w(e,f),w(e,d),ue(h,d,null),w(d,p),ue(m,d,null),w(d,b),ue(g,d,null),w(d,D),w(d,v),C=!0,k||(I=fe(v,"click",s[8]),k=!0)},p(F,T){(!C||T&32)&&a!==(a=ui(F[5][1])+"")&&Ae(o,a),(!C||T&32)&&l!==(l=F[5][0]+1+"")&&Ae(c,l);const N={};T&32&&(N.xy=F[5]),h.$set(N);const j={};T&32&&(j.xy=F[5]),m.$set(j);const G={};T&32&&(G.xy=F[5]),g.$set(G),(!C||T&64)&&E(e,"style",F[6])},i(F){C||(P(h.$$.fragment,F),P(m.$$.fragment,F),P(g.$$.fragment,F),C=!0)},o(F){M(h.$$.fragment,F),M(m.$$.fragment,F),M(g.$$.fragment,F),C=!1},d(F){F&&B(e),le(h),le(m),le(g),k=!1,I()}}}function _a(s,e){let t,r=ui(e[23])+"",n,i,a=e[21]+1+"",o,u,l,c;function f(){return e[14](e[21],e[23])}function d(){return e[15](e[21],e[23])}return{key:s,first:null,c(){t=A("div"),n=J(r),i=J(", "),o=J(a),u=z(),ze(t,"display","flex"),ze(t,"justify-content","center"),ze(t,"align-items","center"),ze(t,"height","100%"),E(t,"class","svelte-beup2s"),ct(t,"active",e[4][e[21]][e[23]]),this.first=t},m(h,p){S(h,t,p),w(t,n),w(t,i),w(t,o),w(t,u),l||(c=[fe(t,"click",f),fe(t,"keypress",d)],l=!0)},p(h,p){e=h,p&1&&r!==(r=ui(e[23])+"")&&Ae(n,r),p&1&&a!==(a=e[21]+1+"")&&Ae(o,a),p&17&&ct(t,"active",e[4][e[21]][e[23]])},d(h){h&&B(t),l=!1,je(c)}}}function wa(s,e){let t,r=[],n=new Map,i,a={length:e[0][1]};const o=u=>u[23];for(let u=0;u<a.length;u+=1){let l=ba(e,a,u),c=o(l);n.set(c,r[u]=_a(c,l))}return{key:s,first:null,c(){t=Fe();for(let u=0;u<r.length;u+=1)r[u].c();i=Fe(),this.first=t},m(u,l){S(u,t,l);for(let c=0;c<r.length;c+=1)r[c].m(u,l);S(u,i,l)},p(u,l){e=u,l&145&&(a={length:e[0][1]},r=xt(r,l,o,1,e,a,n,i.parentNode,Pn,_a,i,ba))},d(u){u&&B(t);for(let l=0;l<r.length;l+=1)r[l].d(u);u&&B(i)}}}function Id(s){let e,t,r,n,i,a,o,u=[],l=new Map,c,f=s[1]&&Da(s),d={length:s[0][0]};const h=p=>p[21];for(let p=0;p<d.length;p+=1){let m=ga(s,d,p),b=h(m);l.set(b,u[p]=wa(b,m))}return{c(){e=A("div"),t=A("div"),f&&f.c(),r=z(),n=A("div"),i=A("h4"),i.textContent="Select location on map",a=z(),o=A("div");for(let p=0;p<u.length;p+=1)u[p].c();E(i,"class","svelte-beup2s"),E(o,"class","container svelte-beup2s"),ze(o,"grid-template-rows",s[3]),ze(o,"grid-template-columns",s[2]),E(n,"class","w-4/5"),ze(t,"position","relative"),ze(t,"z-index","52"),ze(e,"position","fixed")},m(p,m){S(p,e,m),w(e,t),f&&f.m(t,null),w(t,r),w(t,n),w(n,i),w(n,a),w(n,o);for(let b=0;b<u.length;b+=1)u[b].m(o,null);c=!0},p(p,[m]){p[1]?f?(f.p(p,m),m&2&&P(f,1)):(f=Da(p),f.c(),P(f,1),f.m(t,r)):f&&(me(),M(f,1,1,()=>{f=null}),ge()),m&145&&(d={length:p[0][0]},u=xt(u,m,h,1,p,d,l,o,Pn,wa,null,ga)),(!c||m&8)&&ze(o,"grid-template-rows",p[3]),(!c||m&4)&&ze(o,"grid-template-columns",p[2])},i(p){c||(P(f),c=!0)},o(p){M(f),c=!1},d(p){p&&B(e),f&&f.d();for(let m=0;m<u.length;m+=1)u[m].d()}}}function ui(s){return String.fromCharCode(65+s)}function Td(s,e,t){let r,{windowWidth:n}=e,i,a,o,u,l=[],c=!1,f=["0px","0px"];function d(k,I){t(5,l=[k,I]),p([k,I]),setTimeout(()=>{t(1,c=!0),t(10,f=[k*50+"px",I*50+50+"px"])},500)}function h([k,I],[F,T]){return(k-l[0])*(k-F)<=0&&(I-l[1])*(I-T)<=0}function p(k){t(4,u=u.map((I,F)=>I.map((T,N)=>h([F,N],k))))}function m(){t(1,c=!1),t(4,u=Array(i[0]).fill(0).map(k=>Array(i[1]).fill(!1)))}function b(k){Vn.call(this,s,k)}function g(k){Vn.call(this,s,k)}function D(k){Vn.call(this,s,k)}const v=(k,I)=>d(k,I),C=(k,I)=>d(k,I);return s.$$set=k=>{"windowWidth"in k&&t(9,n=k.windowWidth)},s.$$.update=()=>{s.$$.dirty&513&&(n<=768?t(0,i=[18,3]):t(0,i=[6,9]),t(2,a=`repeat(${i[1]}, 1fr)`),t(3,o=`repeat(${i[0]}, 1fr)`),t(4,u=Array(i[0]).fill(0).map(k=>Array(i[1]).fill(!1)))),s.$$.dirty&1026&&t(6,r=`top: ${f[0]}; left: ${f[1]}; visibility: ${c?"visible":"hidden"};`)},[i,c,a,o,u,l,r,d,m,n,f,b,g,D,v,C]}class Rd extends ye{constructor(e){super(),ve(this,e,Td,Id,we,{windowWidth:9})}}function xd(){const s=console.warn;console.warn=e=>{e.includes("unknown prop")||e.includes("unexpected slot")||s(e)},Ft(()=>{console.warn=s})}function ya(s,e,t){const r=s.slice();return r[18]=e[t],r}function va(s,e,t){const r=s.slice();return r[18]=e[t],r}function Ca(s,e,t){const r=s.slice();return r[10]=e[t],r}function Aa(s,e,t){const r=s.slice();return r[13]=e[t],r[15]=t,r}function ka(s,e,t){const r=s.slice();return r[16]=e[t],r[15]=t,r}function Ea(s,e,t){const r=s.slice();return r[7]=e[t],r}function Pd(s){let e,t,r,n;const i=[Ld,Md,Nd],a=[];function o(u,l){return u[0]==="table"?0:u[0]==="list"?1:2}return e=o(s),t=a[e]=i[e](s),{c(){t.c(),r=Fe()},m(u,l){a[e].m(u,l),S(u,r,l),n=!0},p(u,l){let c=e;e=o(u),e===c?a[e].p(u,l):(me(),M(a[c],1,1,()=>{a[c]=null}),ge(),t=a[e],t?t.p(u,l):(t=a[e]=i[e](u),t.c()),P(t,1),t.m(r.parentNode,r))},i(u){n||(P(t),n=!0)},o(u){M(t),n=!1},d(u){a[e].d(u),u&&B(r)}}}function Od(s){let e,t,r=s[1],n=[];for(let a=0;a<r.length;a+=1)n[a]=Ra(Ea(s,r,a));const i=a=>M(n[a],1,1,()=>{n[a]=null});return{c(){for(let a=0;a<n.length;a+=1)n[a].c();e=Fe()},m(a,o){for(let u=0;u<n.length;u+=1)n[u].m(a,o);S(a,e,o),t=!0},p(a,o){if(o&34){r=a[1];let u;for(u=0;u<r.length;u+=1){const l=Ea(a,r,u);n[u]?(n[u].p(l,o),P(n[u],1)):(n[u]=Ra(l),n[u].c(),P(n[u],1),n[u].m(e.parentNode,e))}for(me(),u=r.length;u<n.length;u+=1)i(u);ge()}},i(a){if(!t){for(let o=0;o<r.length;o+=1)P(n[o]);t=!0}},o(a){n=n.filter(Boolean);for(let o=0;o<n.length;o+=1)M(n[o]);t=!1},d(a){on(n,a),a&&B(e)}}}function Nd(s){let e,t,r;const n=[s[6]];var i=s[5][s[0]];function a(o){let u={$$slots:{default:[jd]},$$scope:{ctx:o}};for(let l=0;l<n.length;l+=1)u=pn(u,n[l]);return{props:u}}return i&&(e=Ve(i,a(s))),{c(){e&&oe(e.$$.fragment),t=Fe()},m(o,u){e&&ue(e,o,u),S(o,t,u),r=!0},p(o,u){const l=u&64?ir(n,[sr(o[6])]):{};if(u&8388706&&(l.$$scope={dirty:u,ctx:o}),i!==(i=o[5][o[0]])){if(e){me();const c=e;M(c.$$.fragment,1,0,()=>{le(c,1)}),ge()}i?(e=Ve(i,a(o)),oe(e.$$.fragment),P(e.$$.fragment,1),ue(e,t.parentNode,t)):e=null}else i&&e.$set(l)},i(o){r||(e&&P(e.$$.fragment,o),r=!0)},o(o){e&&M(e.$$.fragment,o),r=!1},d(o){o&&B(t),e&&le(e,o)}}}function Md(s){let e,t,r,n;const i=[Hd,Ud],a=[];function o(u,l){return u[4]?0:1}return e=o(s),t=a[e]=i[e](s),{c(){t.c(),r=Fe()},m(u,l){a[e].m(u,l),S(u,r,l),n=!0},p(u,l){let c=e;e=o(u),e===c?a[e].p(u,l):(me(),M(a[c],1,1,()=>{a[c]=null}),ge(),t=a[e],t?t.p(u,l):(t=a[e]=i[e](u),t.c()),P(t,1),t.m(r.parentNode,r))},i(u){n||(P(t),n=!0)},o(u){M(t),n=!1},d(u){a[e].d(u),u&&B(r)}}}function Ld(s){let e,t,r;var n=s[5].table;function i(a){return{props:{$$slots:{default:[e0]},$$scope:{ctx:a}}}}return n&&(e=Ve(n,i(s))),{c(){e&&oe(e.$$.fragment),t=Fe()},m(a,o){e&&ue(e,a,o),S(a,t,o),r=!0},p(a,o){const u={};if(o&8388716&&(u.$$scope={dirty:o,ctx:a}),n!==(n=a[5].table)){if(e){me();const l=e;M(l.$$.fragment,1,0,()=>{le(l,1)}),ge()}n?(e=Ve(n,i(a)),oe(e.$$.fragment),P(e.$$.fragment,1),ue(e,t.parentNode,t)):e=null}else n&&e.$set(u)},i(a){r||(e&&P(e.$$.fragment,a),r=!0)},o(a){e&&M(e.$$.fragment,a),r=!1},d(a){a&&B(t),e&&le(e,a)}}}function zd(s){let e=s[6].raw+"",t;return{c(){t=J(e)},m(r,n){S(r,t,n)},p(r,n){n&64&&e!==(e=r[6].raw+"")&&Ae(t,e)},i:X,o:X,d(r){r&&B(t)}}}function $d(s){let e,t;return e=new Nn({props:{tokens:s[1],renderers:s[5]}}),{c(){oe(e.$$.fragment)},m(r,n){ue(e,r,n),t=!0},p(r,n){const i={};n&2&&(i.tokens=r[1]),n&32&&(i.renderers=r[5]),e.$set(i)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){M(e.$$.fragment,r),t=!1},d(r){le(e,r)}}}function jd(s){let e,t,r,n;const i=[$d,zd],a=[];function o(u,l){return u[1]?0:1}return e=o(s),t=a[e]=i[e](s),{c(){t.c(),r=Fe()},m(u,l){a[e].m(u,l),S(u,r,l),n=!0},p(u,l){let c=e;e=o(u),e===c?a[e].p(u,l):(me(),M(a[c],1,1,()=>{a[c]=null}),ge(),t=a[e],t?t.p(u,l):(t=a[e]=i[e](u),t.c()),P(t,1),t.m(r.parentNode,r))},i(u){n||(P(t),n=!0)},o(u){M(t),n=!1},d(u){a[e].d(u),u&&B(r)}}}function Ud(s){let e,t,r;const n=[{ordered:s[4]},s[6]];var i=s[5].list;function a(o){let u={$$slots:{default:[Wd]},$$scope:{ctx:o}};for(let l=0;l<n.length;l+=1)u=pn(u,n[l]);return{props:u}}return i&&(e=Ve(i,a(s))),{c(){e&&oe(e.$$.fragment),t=Fe()},m(o,u){e&&ue(e,o,u),S(o,t,u),r=!0},p(o,u){const l=u&80?ir(n,[u&16&&{ordered:o[4]},u&64&&sr(o[6])]):{};if(u&8388704&&(l.$$scope={dirty:u,ctx:o}),i!==(i=o[5].list)){if(e){me();const c=e;M(c.$$.fragment,1,0,()=>{le(c,1)}),ge()}i?(e=Ve(i,a(o)),oe(e.$$.fragment),P(e.$$.fragment,1),ue(e,t.parentNode,t)):e=null}else i&&e.$set(l)},i(o){r||(e&&P(e.$$.fragment,o),r=!0)},o(o){e&&M(e.$$.fragment,o),r=!1},d(o){o&&B(t),e&&le(e,o)}}}function Hd(s){let e,t,r;const n=[{ordered:s[4]},s[6]];var i=s[5].list;function a(o){let u={$$slots:{default:[Kd]},$$scope:{ctx:o}};for(let l=0;l<n.length;l+=1)u=pn(u,n[l]);return{props:u}}return i&&(e=Ve(i,a(s))),{c(){e&&oe(e.$$.fragment),t=Fe()},m(o,u){e&&ue(e,o,u),S(o,t,u),r=!0},p(o,u){const l=u&80?ir(n,[u&16&&{ordered:o[4]},u&64&&sr(o[6])]):{};if(u&8388704&&(l.$$scope={dirty:u,ctx:o}),i!==(i=o[5].list)){if(e){me();const c=e;M(c.$$.fragment,1,0,()=>{le(c,1)}),ge()}i?(e=Ve(i,a(o)),oe(e.$$.fragment),P(e.$$.fragment,1),ue(e,t.parentNode,t)):e=null}else i&&e.$set(l)},i(o){r||(e&&P(e.$$.fragment,o),r=!0)},o(o){e&&M(e.$$.fragment,o),r=!1},d(o){o&&B(t),e&&le(e,o)}}}function qd(s){let e,t,r;return e=new Nn({props:{tokens:s[18].tokens,renderers:s[5]}}),{c(){oe(e.$$.fragment),t=z()},m(n,i){ue(e,n,i),S(n,t,i),r=!0},p(n,i){const a={};i&64&&(a.tokens=n[18].tokens),i&32&&(a.renderers=n[5]),e.$set(a)},i(n){r||(P(e.$$.fragment,n),r=!0)},o(n){M(e.$$.fragment,n),r=!1},d(n){le(e,n),n&&B(t)}}}function Fa(s){let e,t,r;const n=[s[18]];var i=s[5].unorderedlistitem||s[5].listitem;function a(o){let u={$$slots:{default:[qd]},$$scope:{ctx:o}};for(let l=0;l<n.length;l+=1)u=pn(u,n[l]);return{props:u}}return i&&(e=Ve(i,a(s))),{c(){e&&oe(e.$$.fragment),t=Fe()},m(o,u){e&&ue(e,o,u),S(o,t,u),r=!0},p(o,u){const l=u&64?ir(n,[sr(o[18])]):{};if(u&8388704&&(l.$$scope={dirty:u,ctx:o}),i!==(i=o[5].unorderedlistitem||o[5].listitem)){if(e){me();const c=e;M(c.$$.fragment,1,0,()=>{le(c,1)}),ge()}i?(e=Ve(i,a(o)),oe(e.$$.fragment),P(e.$$.fragment,1),ue(e,t.parentNode,t)):e=null}else i&&e.$set(l)},i(o){r||(e&&P(e.$$.fragment,o),r=!0)},o(o){e&&M(e.$$.fragment,o),r=!1},d(o){o&&B(t),e&&le(e,o)}}}function Wd(s){let e,t,r=s[6].items,n=[];for(let a=0;a<r.length;a+=1)n[a]=Fa(ya(s,r,a));const i=a=>M(n[a],1,1,()=>{n[a]=null});return{c(){for(let a=0;a<n.length;a+=1)n[a].c();e=Fe()},m(a,o){for(let u=0;u<n.length;u+=1)n[u].m(a,o);S(a,e,o),t=!0},p(a,o){if(o&96){r=a[6].items;let u;for(u=0;u<r.length;u+=1){const l=ya(a,r,u);n[u]?(n[u].p(l,o),P(n[u],1)):(n[u]=Fa(l),n[u].c(),P(n[u],1),n[u].m(e.parentNode,e))}for(me(),u=r.length;u<n.length;u+=1)i(u);ge()}},i(a){if(!t){for(let o=0;o<r.length;o+=1)P(n[o]);t=!0}},o(a){n=n.filter(Boolean);for(let o=0;o<n.length;o+=1)M(n[o]);t=!1},d(a){on(n,a),a&&B(e)}}}function Vd(s){let e,t,r;return e=new Nn({props:{tokens:s[18].tokens,renderers:s[5]}}),{c(){oe(e.$$.fragment),t=z()},m(n,i){ue(e,n,i),S(n,t,i),r=!0},p(n,i){const a={};i&64&&(a.tokens=n[18].tokens),i&32&&(a.renderers=n[5]),e.$set(a)},i(n){r||(P(e.$$.fragment,n),r=!0)},o(n){M(e.$$.fragment,n),r=!1},d(n){le(e,n),n&&B(t)}}}function Sa(s){let e,t,r;const n=[s[18]];var i=s[5].orderedlistitem||s[5].listitem;function a(o){let u={$$slots:{default:[Vd]},$$scope:{ctx:o}};for(let l=0;l<n.length;l+=1)u=pn(u,n[l]);return{props:u}}return i&&(e=Ve(i,a(s))),{c(){e&&oe(e.$$.fragment),t=Fe()},m(o,u){e&&ue(e,o,u),S(o,t,u),r=!0},p(o,u){const l=u&64?ir(n,[sr(o[18])]):{};if(u&8388704&&(l.$$scope={dirty:u,ctx:o}),i!==(i=o[5].orderedlistitem||o[5].listitem)){if(e){me();const c=e;M(c.$$.fragment,1,0,()=>{le(c,1)}),ge()}i?(e=Ve(i,a(o)),oe(e.$$.fragment),P(e.$$.fragment,1),ue(e,t.parentNode,t)):e=null}else i&&e.$set(l)},i(o){r||(e&&P(e.$$.fragment,o),r=!0)},o(o){e&&M(e.$$.fragment,o),r=!1},d(o){o&&B(t),e&&le(e,o)}}}function Kd(s){let e,t,r=s[6].items,n=[];for(let a=0;a<r.length;a+=1)n[a]=Sa(va(s,r,a));const i=a=>M(n[a],1,1,()=>{n[a]=null});return{c(){for(let a=0;a<n.length;a+=1)n[a].c();e=Fe()},m(a,o){for(let u=0;u<n.length;u+=1)n[u].m(a,o);S(a,e,o),t=!0},p(a,o){if(o&96){r=a[6].items;let u;for(u=0;u<r.length;u+=1){const l=va(a,r,u);n[u]?(n[u].p(l,o),P(n[u],1)):(n[u]=Sa(l),n[u].c(),P(n[u],1),n[u].m(e.parentNode,e))}for(me(),u=r.length;u<n.length;u+=1)i(u);ge()}},i(a){if(!t){for(let o=0;o<r.length;o+=1)P(n[o]);t=!0}},o(a){n=n.filter(Boolean);for(let o=0;o<n.length;o+=1)M(n[o]);t=!1},d(a){on(n,a),a&&B(e)}}}function Zd(s){let e,t,r;return e=new Nn({props:{tokens:s[16].tokens,renderers:s[5]}}),{c(){oe(e.$$.fragment),t=z()},m(n,i){ue(e,n,i),S(n,t,i),r=!0},p(n,i){const a={};i&4&&(a.tokens=n[16].tokens),i&32&&(a.renderers=n[5]),e.$set(a)},i(n){r||(P(e.$$.fragment,n),r=!0)},o(n){M(e.$$.fragment,n),r=!1},d(n){le(e,n),n&&B(t)}}}function Ba(s){let e,t,r;var n=s[5].tablecell;function i(a){return{props:{header:!0,align:a[6].align[a[15]]||"center",$$slots:{default:[Zd]},$$scope:{ctx:a}}}}return n&&(e=Ve(n,i(s))),{c(){e&&oe(e.$$.fragment),t=Fe()},m(a,o){e&&ue(e,a,o),S(a,t,o),r=!0},p(a,o){const u={};if(o&64&&(u.align=a[6].align[a[15]]||"center"),o&8388644&&(u.$$scope={dirty:o,ctx:a}),n!==(n=a[5].tablecell)){if(e){me();const l=e;M(l.$$.fragment,1,0,()=>{le(l,1)}),ge()}n?(e=Ve(n,i(a)),oe(e.$$.fragment),P(e.$$.fragment,1),ue(e,t.parentNode,t)):e=null}else n&&e.$set(u)},i(a){r||(e&&P(e.$$.fragment,a),r=!0)},o(a){e&&M(e.$$.fragment,a),r=!1},d(a){a&&B(t),e&&le(e,a)}}}function Qd(s){let e,t,r=s[2],n=[];for(let a=0;a<r.length;a+=1)n[a]=Ba(ka(s,r,a));const i=a=>M(n[a],1,1,()=>{n[a]=null});return{c(){for(let a=0;a<n.length;a+=1)n[a].c();e=Fe()},m(a,o){for(let u=0;u<n.length;u+=1)n[u].m(a,o);S(a,e,o),t=!0},p(a,o){if(o&100){r=a[2];let u;for(u=0;u<r.length;u+=1){const l=ka(a,r,u);n[u]?(n[u].p(l,o),P(n[u],1)):(n[u]=Ba(l),n[u].c(),P(n[u],1),n[u].m(e.parentNode,e))}for(me(),u=r.length;u<n.length;u+=1)i(u);ge()}},i(a){if(!t){for(let o=0;o<r.length;o+=1)P(n[o]);t=!0}},o(a){n=n.filter(Boolean);for(let o=0;o<n.length;o+=1)M(n[o]);t=!1},d(a){on(n,a),a&&B(e)}}}function Gd(s){let e,t,r;var n=s[5].tablerow;function i(a){return{props:{$$slots:{default:[Qd]},$$scope:{ctx:a}}}}return n&&(e=Ve(n,i(s))),{c(){e&&oe(e.$$.fragment),t=Fe()},m(a,o){e&&ue(e,a,o),S(a,t,o),r=!0},p(a,o){const u={};if(o&8388708&&(u.$$scope={dirty:o,ctx:a}),n!==(n=a[5].tablerow)){if(e){me();const l=e;M(l.$$.fragment,1,0,()=>{le(l,1)}),ge()}n?(e=Ve(n,i(a)),oe(e.$$.fragment),P(e.$$.fragment,1),ue(e,t.parentNode,t)):e=null}else n&&e.$set(u)},i(a){r||(e&&P(e.$$.fragment,a),r=!0)},o(a){e&&M(e.$$.fragment,a),r=!1},d(a){a&&B(t),e&&le(e,a)}}}function Yd(s){let e,t;return e=new Nn({props:{tokens:s[13].tokens,renderers:s[5]}}),{c(){oe(e.$$.fragment)},m(r,n){ue(e,r,n),t=!0},p(r,n){const i={};n&8&&(i.tokens=r[13].tokens),n&32&&(i.renderers=r[5]),e.$set(i)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){M(e.$$.fragment,r),t=!1},d(r){le(e,r)}}}function Ia(s){let e,t,r;var n=s[5].tablecell;function i(a){return{props:{header:!1,align:a[6].align[a[15]]||"center",$$slots:{default:[Yd]},$$scope:{ctx:a}}}}return n&&(e=Ve(n,i(s))),{c(){e&&oe(e.$$.fragment),t=Fe()},m(a,o){e&&ue(e,a,o),S(a,t,o),r=!0},p(a,o){const u={};if(o&64&&(u.align=a[6].align[a[15]]||"center"),o&8388648&&(u.$$scope={dirty:o,ctx:a}),n!==(n=a[5].tablecell)){if(e){me();const l=e;M(l.$$.fragment,1,0,()=>{le(l,1)}),ge()}n?(e=Ve(n,i(a)),oe(e.$$.fragment),P(e.$$.fragment,1),ue(e,t.parentNode,t)):e=null}else n&&e.$set(u)},i(a){r||(e&&P(e.$$.fragment,a),r=!0)},o(a){e&&M(e.$$.fragment,a),r=!1},d(a){a&&B(t),e&&le(e,a)}}}function Jd(s){let e,t,r=s[10],n=[];for(let a=0;a<r.length;a+=1)n[a]=Ia(Aa(s,r,a));const i=a=>M(n[a],1,1,()=>{n[a]=null});return{c(){for(let a=0;a<n.length;a+=1)n[a].c();e=z()},m(a,o){for(let u=0;u<n.length;u+=1)n[u].m(a,o);S(a,e,o),t=!0},p(a,o){if(o&104){r=a[10];let u;for(u=0;u<r.length;u+=1){const l=Aa(a,r,u);n[u]?(n[u].p(l,o),P(n[u],1)):(n[u]=Ia(l),n[u].c(),P(n[u],1),n[u].m(e.parentNode,e))}for(me(),u=r.length;u<n.length;u+=1)i(u);ge()}},i(a){if(!t){for(let o=0;o<r.length;o+=1)P(n[o]);t=!0}},o(a){n=n.filter(Boolean);for(let o=0;o<n.length;o+=1)M(n[o]);t=!1},d(a){on(n,a),a&&B(e)}}}function Ta(s){let e,t,r;var n=s[5].tablerow;function i(a){return{props:{$$slots:{default:[Jd]},$$scope:{ctx:a}}}}return n&&(e=Ve(n,i(s))),{c(){e&&oe(e.$$.fragment),t=Fe()},m(a,o){e&&ue(e,a,o),S(a,t,o),r=!0},p(a,o){const u={};if(o&8388712&&(u.$$scope={dirty:o,ctx:a}),n!==(n=a[5].tablerow)){if(e){me();const l=e;M(l.$$.fragment,1,0,()=>{le(l,1)}),ge()}n?(e=Ve(n,i(a)),oe(e.$$.fragment),P(e.$$.fragment,1),ue(e,t.parentNode,t)):e=null}else n&&e.$set(u)},i(a){r||(e&&P(e.$$.fragment,a),r=!0)},o(a){e&&M(e.$$.fragment,a),r=!1},d(a){a&&B(t),e&&le(e,a)}}}function Xd(s){let e,t,r=s[3],n=[];for(let a=0;a<r.length;a+=1)n[a]=Ta(Ca(s,r,a));const i=a=>M(n[a],1,1,()=>{n[a]=null});return{c(){for(let a=0;a<n.length;a+=1)n[a].c();e=Fe()},m(a,o){for(let u=0;u<n.length;u+=1)n[u].m(a,o);S(a,e,o),t=!0},p(a,o){if(o&104){r=a[3];let u;for(u=0;u<r.length;u+=1){const l=Ca(a,r,u);n[u]?(n[u].p(l,o),P(n[u],1)):(n[u]=Ta(l),n[u].c(),P(n[u],1),n[u].m(e.parentNode,e))}for(me(),u=r.length;u<n.length;u+=1)i(u);ge()}},i(a){if(!t){for(let o=0;o<r.length;o+=1)P(n[o]);t=!0}},o(a){n=n.filter(Boolean);for(let o=0;o<n.length;o+=1)M(n[o]);t=!1},d(a){on(n,a),a&&B(e)}}}function e0(s){let e,t,r,n,i;var a=s[5].tablehead;function o(c){return{props:{$$slots:{default:[Gd]},$$scope:{ctx:c}}}}a&&(e=Ve(a,o(s)));var u=s[5].tablebody;function l(c){return{props:{$$slots:{default:[Xd]},$$scope:{ctx:c}}}}return u&&(r=Ve(u,l(s))),{c(){e&&oe(e.$$.fragment),t=z(),r&&oe(r.$$.fragment),n=Fe()},m(c,f){e&&ue(e,c,f),S(c,t,f),r&&ue(r,c,f),S(c,n,f),i=!0},p(c,f){const d={};if(f&8388708&&(d.$$scope={dirty:f,ctx:c}),a!==(a=c[5].tablehead)){if(e){me();const p=e;M(p.$$.fragment,1,0,()=>{le(p,1)}),ge()}a?(e=Ve(a,o(c)),oe(e.$$.fragment),P(e.$$.fragment,1),ue(e,t.parentNode,t)):e=null}else a&&e.$set(d);const h={};if(f&8388712&&(h.$$scope={dirty:f,ctx:c}),u!==(u=c[5].tablebody)){if(r){me();const p=r;M(p.$$.fragment,1,0,()=>{le(p,1)}),ge()}u?(r=Ve(u,l(c)),oe(r.$$.fragment),P(r.$$.fragment,1),ue(r,n.parentNode,n)):r=null}else u&&r.$set(h)},i(c){i||(e&&P(e.$$.fragment,c),r&&P(r.$$.fragment,c),i=!0)},o(c){e&&M(e.$$.fragment,c),r&&M(r.$$.fragment,c),i=!1},d(c){e&&le(e,c),c&&B(t),c&&B(n),r&&le(r,c)}}}function Ra(s){let e,t;const r=[s[7],{renderers:s[5]}];let n={};for(let i=0;i<r.length;i+=1)n=pn(n,r[i]);return e=new Nn({props:n}),{c(){oe(e.$$.fragment)},m(i,a){ue(e,i,a),t=!0},p(i,a){const o=a&34?ir(r,[a&2&&sr(i[7]),a&32&&{renderers:i[5]}]):{};e.$set(o)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){M(e.$$.fragment,i),t=!1},d(i){le(e,i)}}}function t0(s){let e,t,r,n;const i=[Od,Pd],a=[];function o(u,l){return u[0]?u[5][u[0]]?1:-1:0}return~(e=o(s))&&(t=a[e]=i[e](s)),{c(){t&&t.c(),r=Fe()},m(u,l){~e&&a[e].m(u,l),S(u,r,l),n=!0},p(u,[l]){let c=e;e=o(u),e===c?~e&&a[e].p(u,l):(t&&(me(),M(a[c],1,1,()=>{a[c]=null}),ge()),~e?(t=a[e],t?t.p(u,l):(t=a[e]=i[e](u),t.c()),P(t,1),t.m(r.parentNode,r)):t=null)},i(u){n||(P(t),n=!0)},o(u){M(t),n=!1},d(u){~e&&a[e].d(u),u&&B(r)}}}function n0(s,e,t){const r=["type","tokens","header","rows","ordered","renderers"];let n=Fs(e,r),{type:i=void 0}=e,{tokens:a=void 0}=e,{header:o=void 0}=e,{rows:u=void 0}=e,{ordered:l=!1}=e,{renderers:c}=e;return xd(),s.$$set=f=>{e=pn(pn({},e),Xl(f)),t(6,n=Fs(e,r)),"type"in f&&t(0,i=f.type),"tokens"in f&&t(1,a=f.tokens),"header"in f&&t(2,o=f.header),"rows"in f&&t(3,u=f.rows),"ordered"in f&&t(4,l=f.ordered),"renderers"in f&&t(5,c=f.renderers)},[i,a,o,u,l,c,n]}let Nn=class extends ye{constructor(e){super(),ve(this,e,n0,t0,we,{type:0,tokens:1,header:2,rows:3,ordered:4,renderers:5})}};function ml(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let Mn=ml();function r0(s){Mn=s}const gl=/[&<>"']/,i0=new RegExp(gl.source,"g"),bl=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,s0=new RegExp(bl.source,"g"),a0={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},xa=s=>a0[s];function gt(s,e){if(e){if(gl.test(s))return s.replace(i0,xa)}else if(bl.test(s))return s.replace(s0,xa);return s}const o0=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function Dl(s){return s.replace(o0,(e,t)=>(t=t.toLowerCase(),t==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}const u0=/(^|[^\[])\^/g;function $e(s,e){s=typeof s=="string"?s:s.source,e=e||"";const t={replace:(r,n)=>(n=n.source||n,n=n.replace(u0,"$1"),s=s.replace(r,n),t),getRegex:()=>new RegExp(s,e)};return t}const l0=/[^\w:]/g,c0=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function Pa(s,e,t){if(s){let r;try{r=decodeURIComponent(Dl(t)).replace(l0,"").toLowerCase()}catch{return null}if(r.indexOf("javascript:")===0||r.indexOf("vbscript:")===0||r.indexOf("data:")===0)return null}e&&!c0.test(t)&&(t=p0(e,t));try{t=encodeURI(t).replace(/%25/g,"%")}catch{return null}return t}const Jr={},f0=/^[^:]+:\/*[^/]*$/,h0=/^([^:]+:)[\s\S]*$/,d0=/^([^:]+:\/*[^/]*)[\s\S]*$/;function p0(s,e){Jr[" "+s]||(f0.test(s)?Jr[" "+s]=s+"/":Jr[" "+s]=ri(s,"/",!0)),s=Jr[" "+s];const t=s.indexOf(":")===-1;return e.substring(0,2)==="//"?t?e:s.replace(h0,"$1")+e:e.charAt(0)==="/"?t?e:s.replace(d0,"$1")+e:s+e}const li={exec:function(){}};function Oa(s,e){const t=s.replace(/\|/g,(i,a,o)=>{let u=!1,l=a;for(;--l>=0&&o[l]==="\\";)u=!u;return u?"|":" |"}),r=t.split(/ \|/);let n=0;if(r[0].trim()||r.shift(),r.length>0&&!r[r.length-1].trim()&&r.pop(),r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;n<r.length;n++)r[n]=r[n].trim().replace(/\\\|/g,"|");return r}function ri(s,e,t){const r=s.length;if(r===0)return"";let n=0;for(;n<r;){const i=s.charAt(r-n-1);if(i===e&&!t)n++;else if(i!==e&&t)n++;else break}return s.slice(0,r-n)}function m0(s,e){if(s.indexOf(e[1])===-1)return-1;const t=s.length;let r=0,n=0;for(;n<t;n++)if(s[n]==="\\")n++;else if(s[n]===e[0])r++;else if(s[n]===e[1]&&(r--,r<0))return n;return-1}function g0(s){s&&s.sanitize&&!s.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function Na(s,e){if(e<1)return"";let t="";for(;e>1;)e&1&&(t+=s),e>>=1,s+=s;return t+s}function Ma(s,e,t,r){const n=e.href,i=e.title?gt(e.title):null,a=s[1].replace(/\\([\[\]])/g,"$1");if(s[0].charAt(0)!=="!"){r.state.inLink=!0;const o={type:"link",raw:t,href:n,title:i,text:a,tokens:r.inlineTokens(a)};return r.state.inLink=!1,o}return{type:"image",raw:t,href:n,title:i,text:gt(a)}}function b0(s,e){const t=s.match(/^(\s+)(?:```)/);if(t===null)return e;const r=t[1];return e.split(`
`).map(n=>{const i=n.match(/^\s+/);if(i===null)return n;const[a]=i;return a.length>=r.length?n.slice(r.length):n}).join(`
`)}class ms{constructor(e){this.options=e||Mn}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const r=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?r:ri(r,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const r=t[0],n=b0(r,t[3]||"");return{type:"code",raw:r,lang:t[2]?t[2].trim().replace(this.rules.inline._escapes,"$1"):t[2],text:n}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let r=t[2].trim();if(/#$/.test(r)){const n=ri(r,"#");(this.options.pedantic||!n||/ $/.test(n))&&(r=n.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){const r=t[0].replace(/^ *>[ \t]?/gm,""),n=this.lexer.state.top;this.lexer.state.top=!0;const i=this.lexer.blockTokens(r);return this.lexer.state.top=n,{type:"blockquote",raw:t[0],tokens:i,text:r}}}list(e){let t=this.rules.block.list.exec(e);if(t){let r,n,i,a,o,u,l,c,f,d,h,p,m=t[1].trim();const b=m.length>1,g={type:"list",raw:"",ordered:b,start:b?+m.slice(0,-1):"",loose:!1,items:[]};m=b?`\\d{1,9}\\${m.slice(-1)}`:`\\${m}`,this.options.pedantic&&(m=b?m:"[*+-]");const D=new RegExp(`^( {0,3}${m})((?:[	 ][^\\n]*)?(?:\\n|$))`);for(;e&&(p=!1,!(!(t=D.exec(e))||this.rules.block.hr.test(e)));){if(r=t[0],e=e.substring(r.length),c=t[2].split(`
`,1)[0].replace(/^\t+/,C=>" ".repeat(3*C.length)),f=e.split(`
`,1)[0],this.options.pedantic?(a=2,h=c.trimLeft()):(a=t[2].search(/[^ ]/),a=a>4?1:a,h=c.slice(a),a+=t[1].length),u=!1,!c&&/^ *$/.test(f)&&(r+=f+`
`,e=e.substring(f.length+1),p=!0),!p){const C=new RegExp(`^ {0,${Math.min(3,a-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),k=new RegExp(`^ {0,${Math.min(3,a-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),I=new RegExp(`^ {0,${Math.min(3,a-1)}}(?:\`\`\`|~~~)`),F=new RegExp(`^ {0,${Math.min(3,a-1)}}#`);for(;e&&(d=e.split(`
`,1)[0],f=d,this.options.pedantic&&(f=f.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(I.test(f)||F.test(f)||C.test(f)||k.test(e)));){if(f.search(/[^ ]/)>=a||!f.trim())h+=`
`+f.slice(a);else{if(u||c.search(/[^ ]/)>=4||I.test(c)||F.test(c)||k.test(c))break;h+=`
`+f}!u&&!f.trim()&&(u=!0),r+=d+`
`,e=e.substring(d.length+1),c=f.slice(a)}}g.loose||(l?g.loose=!0:/\n *\n *$/.test(r)&&(l=!0)),this.options.gfm&&(n=/^\[[ xX]\] /.exec(h),n&&(i=n[0]!=="[ ] ",h=h.replace(/^\[[ xX]\] +/,""))),g.items.push({type:"list_item",raw:r,task:!!n,checked:i,loose:!1,text:h}),g.raw+=r}g.items[g.items.length-1].raw=r.trimRight(),g.items[g.items.length-1].text=h.trimRight(),g.raw=g.raw.trimRight();const v=g.items.length;for(o=0;o<v;o++)if(this.lexer.state.top=!1,g.items[o].tokens=this.lexer.blockTokens(g.items[o].text,[]),!g.loose){const C=g.items[o].tokens.filter(I=>I.type==="space"),k=C.length>0&&C.some(I=>/\n.*\n/.test(I.raw));g.loose=k}if(g.loose)for(o=0;o<v;o++)g.items[o].loose=!0;return g}}html(e){const t=this.rules.block.html.exec(e);if(t){const r={type:"html",raw:t[0],pre:!this.options.sanitizer&&(t[1]==="pre"||t[1]==="script"||t[1]==="style"),text:t[0]};if(this.options.sanitize){const n=this.options.sanitizer?this.options.sanitizer(t[0]):gt(t[0]);r.type="paragraph",r.text=n,r.tokens=this.lexer.inline(n)}return r}}def(e){const t=this.rules.block.def.exec(e);if(t){const r=t[1].toLowerCase().replace(/\s+/g," "),n=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline._escapes,"$1"):t[3];return{type:"def",tag:r,raw:t[0],href:n,title:i}}}table(e){const t=this.rules.block.table.exec(e);if(t){const r={type:"table",header:Oa(t[1]).map(n=>({text:n})),align:t[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(r.header.length===r.align.length){r.raw=t[0];let n=r.align.length,i,a,o,u;for(i=0;i<n;i++)/^ *-+: *$/.test(r.align[i])?r.align[i]="right":/^ *:-+: *$/.test(r.align[i])?r.align[i]="center":/^ *:-+ *$/.test(r.align[i])?r.align[i]="left":r.align[i]=null;for(n=r.rows.length,i=0;i<n;i++)r.rows[i]=Oa(r.rows[i],r.header.length).map(l=>({text:l}));for(n=r.header.length,a=0;a<n;a++)r.header[a].tokens=this.lexer.inline(r.header[a].text);for(n=r.rows.length,a=0;a<n;a++)for(u=r.rows[a],o=0;o<u.length;o++)u[o].tokens=this.lexer.inline(u[o].text);return r}}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const r=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:r,tokens:this.lexer.inline(r)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:gt(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(t[0]):gt(t[0]):t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const r=t[2].trim();if(!this.options.pedantic&&/^</.test(r)){if(!/>$/.test(r))return;const a=ri(r.slice(0,-1),"\\");if((r.length-a.length)%2===0)return}else{const a=m0(t[2],"()");if(a>-1){const u=(t[0].indexOf("!")===0?5:4)+t[1].length+a;t[2]=t[2].substring(0,a),t[0]=t[0].substring(0,u).trim(),t[3]=""}}let n=t[2],i="";if(this.options.pedantic){const a=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(n);a&&(n=a[1],i=a[3])}else i=t[3]?t[3].slice(1,-1):"";return n=n.trim(),/^</.test(n)&&(this.options.pedantic&&!/>$/.test(r)?n=n.slice(1):n=n.slice(1,-1)),Ma(t,{href:n&&n.replace(this.rules.inline._escapes,"$1"),title:i&&i.replace(this.rules.inline._escapes,"$1")},t[0],this.lexer)}}reflink(e,t){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){let n=(r[2]||r[1]).replace(/\s+/g," ");if(n=t[n.toLowerCase()],!n){const i=r[0].charAt(0);return{type:"text",raw:i,text:i}}return Ma(r,n,r[0],this.lexer)}}emStrong(e,t,r=""){let n=this.rules.inline.emStrong.lDelim.exec(e);if(!n||n[3]&&r.match(/[\p{L}\p{N}]/u))return;const i=n[1]||n[2]||"";if(!i||i&&(r===""||this.rules.inline.punctuation.exec(r))){const a=n[0].length-1;let o,u,l=a,c=0;const f=n[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(f.lastIndex=0,t=t.slice(-1*e.length+a);(n=f.exec(t))!=null;){if(o=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!o)continue;if(u=o.length,n[3]||n[4]){l+=u;continue}else if((n[5]||n[6])&&a%3&&!((a+u)%3)){c+=u;continue}if(l-=u,l>0)continue;u=Math.min(u,u+l+c);const d=e.slice(0,a+n.index+(n[0].length-o.length)+u);if(Math.min(a,u)%2){const p=d.slice(1,-1);return{type:"em",raw:d,text:p,tokens:this.lexer.inlineTokens(p)}}const h=d.slice(2,-2);return{type:"strong",raw:d,text:h,tokens:this.lexer.inlineTokens(h)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let r=t[2].replace(/\n/g," ");const n=/[^ ]/.test(r),i=/^ /.test(r)&&/ $/.test(r);return n&&i&&(r=r.substring(1,r.length-1)),r=gt(r,!0),{type:"codespan",raw:t[0],text:r}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e,t){const r=this.rules.inline.autolink.exec(e);if(r){let n,i;return r[2]==="@"?(n=gt(this.options.mangle?t(r[1]):r[1]),i="mailto:"+n):(n=gt(r[1]),i=n),{type:"link",raw:r[0],text:n,href:i,tokens:[{type:"text",raw:n,text:n}]}}}url(e,t){let r;if(r=this.rules.inline.url.exec(e)){let n,i;if(r[2]==="@")n=gt(this.options.mangle?t(r[0]):r[0]),i="mailto:"+n;else{let a;do a=r[0],r[0]=this.rules.inline._backpedal.exec(r[0])[0];while(a!==r[0]);n=gt(r[0]),r[1]==="www."?i="http://"+r[0]:i=r[0]}return{type:"link",raw:r[0],text:n,href:i,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(e,t){const r=this.rules.inline.text.exec(e);if(r){let n;return this.lexer.state.inRawBlock?n=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):gt(r[0]):r[0]:n=gt(this.options.smartypants?t(r[0]):r[0]),{type:"text",raw:r[0],text:n}}}}const Ee={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:li,lheading:/^((?:.|\n(?!\n))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};Ee._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;Ee._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;Ee.def=$e(Ee.def).replace("label",Ee._label).replace("title",Ee._title).getRegex();Ee.bullet=/(?:[*+-]|\d{1,9}[.)])/;Ee.listItemStart=$e(/^( *)(bull) */).replace("bull",Ee.bullet).getRegex();Ee.list=$e(Ee.list).replace(/bull/g,Ee.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+Ee.def.source+")").getRegex();Ee._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";Ee._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;Ee.html=$e(Ee.html,"i").replace("comment",Ee._comment).replace("tag",Ee._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();Ee.paragraph=$e(Ee._paragraph).replace("hr",Ee.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ee._tag).getRegex();Ee.blockquote=$e(Ee.blockquote).replace("paragraph",Ee.paragraph).getRegex();Ee.normal={...Ee};Ee.gfm={...Ee.normal,table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"};Ee.gfm.table=$e(Ee.gfm.table).replace("hr",Ee.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ee._tag).getRegex();Ee.gfm.paragraph=$e(Ee._paragraph).replace("hr",Ee.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",Ee.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ee._tag).getRegex();Ee.pedantic={...Ee.normal,html:$e(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Ee._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:li,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:$e(Ee.normal._paragraph).replace("hr",Ee.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Ee.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()};const _e={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:li,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^(?:[^_*\\]|\\.)*?\_\_(?:[^_*\\]|\\.)*?\*(?:[^_*\\]|\\.)*?(?=\_\_)|(?:[^*\\]|\\.)+(?=[^*])|[punct_](\*+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|(?:[^punct*_\s\\]|\\.)(\*+)(?=[^punct*_\s])/,rDelimUnd:/^(?:[^_*\\]|\\.)*?\*\*(?:[^_*\\]|\\.)*?\_(?:[^_*\\]|\\.)*?(?=\*\*)|(?:[^_\\]|\\.)+(?=[^_])|[punct*](\_+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:li,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};_e._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~";_e.punctuation=$e(_e.punctuation).replace(/punctuation/g,_e._punctuation).getRegex();_e.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;_e.escapedEmSt=/(?:^|[^\\])(?:\\\\)*\\[*_]/g;_e._comment=$e(Ee._comment).replace("(?:-->|$)","-->").getRegex();_e.emStrong.lDelim=$e(_e.emStrong.lDelim).replace(/punct/g,_e._punctuation).getRegex();_e.emStrong.rDelimAst=$e(_e.emStrong.rDelimAst,"g").replace(/punct/g,_e._punctuation).getRegex();_e.emStrong.rDelimUnd=$e(_e.emStrong.rDelimUnd,"g").replace(/punct/g,_e._punctuation).getRegex();_e._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;_e._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;_e._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;_e.autolink=$e(_e.autolink).replace("scheme",_e._scheme).replace("email",_e._email).getRegex();_e._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;_e.tag=$e(_e.tag).replace("comment",_e._comment).replace("attribute",_e._attribute).getRegex();_e._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;_e._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;_e._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;_e.link=$e(_e.link).replace("label",_e._label).replace("href",_e._href).replace("title",_e._title).getRegex();_e.reflink=$e(_e.reflink).replace("label",_e._label).replace("ref",Ee._label).getRegex();_e.nolink=$e(_e.nolink).replace("ref",Ee._label).getRegex();_e.reflinkSearch=$e(_e.reflinkSearch,"g").replace("reflink",_e.reflink).replace("nolink",_e.nolink).getRegex();_e.normal={..._e};_e.pedantic={..._e.normal,strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:$e(/^!?\[(label)\]\((.*?)\)/).replace("label",_e._label).getRegex(),reflink:$e(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",_e._label).getRegex()};_e.gfm={..._e.normal,escape:$e(_e.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/};_e.gfm.url=$e(_e.gfm.url,"i").replace("email",_e.gfm._extended_email).getRegex();_e.breaks={..._e.gfm,br:$e(_e.br).replace("{2,}","*").getRegex(),text:$e(_e.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()};function D0(s){return s.replace(/---/g,"").replace(/--/g,"").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1").replace(/'/g,"").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1").replace(/"/g,"").replace(/\.{3}/g,"")}function La(s){let e="",t,r;const n=s.length;for(t=0;t<n;t++)r=s.charCodeAt(t),Math.random()>.5&&(r="x"+r.toString(16)),e+="&#"+r+";";return e}class an{constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Mn,this.options.tokenizer=this.options.tokenizer||new ms,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:Ee.normal,inline:_e.normal};this.options.pedantic?(t.block=Ee.pedantic,t.inline=_e.pedantic):this.options.gfm&&(t.block=Ee.gfm,this.options.breaks?t.inline=_e.breaks:t.inline=_e.gfm),this.tokenizer.rules=t}static get rules(){return{block:Ee,inline:_e}}static lex(e,t){return new an(t).lex(e)}static lexInline(e,t){return new an(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);let t;for(;t=this.inlineQueue.shift();)this.inlineTokens(t.src,t.tokens);return this.tokens}blockTokens(e,t=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(o,u,l)=>u+"    ".repeat(l.length));let r,n,i,a;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(o=>(r=o.call({lexer:this},e,t))?(e=e.substring(r.raw.length),t.push(r),!0):!1))){if(r=this.tokenizer.space(e)){e=e.substring(r.raw.length),r.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(r);continue}if(r=this.tokenizer.code(e)){e=e.substring(r.raw.length),n=t[t.length-1],n&&(n.type==="paragraph"||n.type==="text")?(n.raw+=`
`+r.raw,n.text+=`
`+r.text,this.inlineQueue[this.inlineQueue.length-1].src=n.text):t.push(r);continue}if(r=this.tokenizer.fences(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.heading(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.hr(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.blockquote(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.list(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.html(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.def(e)){e=e.substring(r.raw.length),n=t[t.length-1],n&&(n.type==="paragraph"||n.type==="text")?(n.raw+=`
`+r.raw,n.text+=`
`+r.raw,this.inlineQueue[this.inlineQueue.length-1].src=n.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title});continue}if(r=this.tokenizer.table(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.lheading(e)){e=e.substring(r.raw.length),t.push(r);continue}if(i=e,this.options.extensions&&this.options.extensions.startBlock){let o=1/0;const u=e.slice(1);let l;this.options.extensions.startBlock.forEach(function(c){l=c.call({lexer:this},u),typeof l=="number"&&l>=0&&(o=Math.min(o,l))}),o<1/0&&o>=0&&(i=e.substring(0,o+1))}if(this.state.top&&(r=this.tokenizer.paragraph(i))){n=t[t.length-1],a&&n.type==="paragraph"?(n.raw+=`
`+r.raw,n.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=n.text):t.push(r),a=i.length!==e.length,e=e.substring(r.raw.length);continue}if(r=this.tokenizer.text(e)){e=e.substring(r.raw.length),n=t[t.length-1],n&&n.type==="text"?(n.raw+=`
`+r.raw,n.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=n.text):t.push(r);continue}if(e){const o="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let r,n,i,a=e,o,u,l;if(this.tokens.links){const c=Object.keys(this.tokens.links);if(c.length>0)for(;(o=this.tokenizer.rules.inline.reflinkSearch.exec(a))!=null;)c.includes(o[0].slice(o[0].lastIndexOf("[")+1,-1))&&(a=a.slice(0,o.index)+"["+Na("a",o[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(o=this.tokenizer.rules.inline.blockSkip.exec(a))!=null;)a=a.slice(0,o.index)+"["+Na("a",o[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(o=this.tokenizer.rules.inline.escapedEmSt.exec(a))!=null;)a=a.slice(0,o.index+o[0].length-2)+"++"+a.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex),this.tokenizer.rules.inline.escapedEmSt.lastIndex--;for(;e;)if(u||(l=""),u=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(c=>(r=c.call({lexer:this},e,t))?(e=e.substring(r.raw.length),t.push(r),!0):!1))){if(r=this.tokenizer.escape(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.tag(e)){e=e.substring(r.raw.length),n=t[t.length-1],n&&r.type==="text"&&n.type==="text"?(n.raw+=r.raw,n.text+=r.text):t.push(r);continue}if(r=this.tokenizer.link(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(r.raw.length),n=t[t.length-1],n&&r.type==="text"&&n.type==="text"?(n.raw+=r.raw,n.text+=r.text):t.push(r);continue}if(r=this.tokenizer.emStrong(e,a,l)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.codespan(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.br(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.del(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.autolink(e,La)){e=e.substring(r.raw.length),t.push(r);continue}if(!this.state.inLink&&(r=this.tokenizer.url(e,La))){e=e.substring(r.raw.length),t.push(r);continue}if(i=e,this.options.extensions&&this.options.extensions.startInline){let c=1/0;const f=e.slice(1);let d;this.options.extensions.startInline.forEach(function(h){d=h.call({lexer:this},f),typeof d=="number"&&d>=0&&(c=Math.min(c,d))}),c<1/0&&c>=0&&(i=e.substring(0,c+1))}if(r=this.tokenizer.inlineText(i,D0)){e=e.substring(r.raw.length),r.raw.slice(-1)!=="_"&&(l=r.raw.slice(-1)),u=!0,n=t[t.length-1],n&&n.type==="text"?(n.raw+=r.raw,n.text+=r.text):t.push(r);continue}if(e){const c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return t}}class gs{constructor(e){this.options=e||Mn}code(e,t,r){const n=(t||"").match(/\S*/)[0];if(this.options.highlight){const i=this.options.highlight(e,n);i!=null&&i!==e&&(r=!0,e=i)}return e=e.replace(/\n$/,"")+`
`,n?'<pre><code class="'+this.options.langPrefix+gt(n)+'">'+(r?e:gt(e,!0))+`</code></pre>
`:"<pre><code>"+(r?e:gt(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e){return e}heading(e,t,r,n){if(this.options.headerIds){const i=this.options.headerPrefix+n.slug(r);return`<h${t} id="${i}">${e}</h${t}>
`}return`<h${t}>${e}</h${t}>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(e,t,r){const n=t?"ol":"ul",i=t&&r!==1?' start="'+r+'"':"";return"<"+n+i+`>
`+e+"</"+n+`>
`}listitem(e){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(e){return`<p>${e}</p>
`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+t+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,t){const r=t.header?"th":"td";return(t.align?`<${r} align="${t.align}">`:`<${r}>`)+e+`</${r}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(e){return`<del>${e}</del>`}link(e,t,r){if(e=Pa(this.options.sanitize,this.options.baseUrl,e),e===null)return r;let n='<a href="'+e+'"';return t&&(n+=' title="'+t+'"'),n+=">"+r+"</a>",n}image(e,t,r){if(e=Pa(this.options.sanitize,this.options.baseUrl,e),e===null)return r;let n=`<img src="${e}" alt="${r}"`;return t&&(n+=` title="${t}"`),n+=this.options.xhtml?"/>":">",n}text(e){return e}}class _l{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,r){return""+r}image(e,t,r){return""+r}br(){return""}}class bs{constructor(){this.seen={}}serialize(e){return e.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(e,t){let r=e,n=0;if(this.seen.hasOwnProperty(r)){n=this.seen[e];do n++,r=e+"-"+n;while(this.seen.hasOwnProperty(r))}return t||(this.seen[e]=n,this.seen[r]=0),r}slug(e,t={}){const r=this.serialize(e);return this.getNextSafeSlug(r,t.dryrun)}}class gn{constructor(e){this.options=e||Mn,this.options.renderer=this.options.renderer||new gs,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new _l,this.slugger=new bs}static parse(e,t){return new gn(t).parse(e)}static parseInline(e,t){return new gn(t).parseInline(e)}parse(e,t=!0){let r="",n,i,a,o,u,l,c,f,d,h,p,m,b,g,D,v,C,k,I;const F=e.length;for(n=0;n<F;n++){if(h=e[n],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[h.type]&&(I=this.options.extensions.renderers[h.type].call({parser:this},h),I!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(h.type))){r+=I||"";continue}switch(h.type){case"space":continue;case"hr":{r+=this.renderer.hr();continue}case"heading":{r+=this.renderer.heading(this.parseInline(h.tokens),h.depth,Dl(this.parseInline(h.tokens,this.textRenderer)),this.slugger);continue}case"code":{r+=this.renderer.code(h.text,h.lang,h.escaped);continue}case"table":{for(f="",c="",o=h.header.length,i=0;i<o;i++)c+=this.renderer.tablecell(this.parseInline(h.header[i].tokens),{header:!0,align:h.align[i]});for(f+=this.renderer.tablerow(c),d="",o=h.rows.length,i=0;i<o;i++){for(l=h.rows[i],c="",u=l.length,a=0;a<u;a++)c+=this.renderer.tablecell(this.parseInline(l[a].tokens),{header:!1,align:h.align[a]});d+=this.renderer.tablerow(c)}r+=this.renderer.table(f,d);continue}case"blockquote":{d=this.parse(h.tokens),r+=this.renderer.blockquote(d);continue}case"list":{for(p=h.ordered,m=h.start,b=h.loose,o=h.items.length,d="",i=0;i<o;i++)D=h.items[i],v=D.checked,C=D.task,g="",D.task&&(k=this.renderer.checkbox(v),b?D.tokens.length>0&&D.tokens[0].type==="paragraph"?(D.tokens[0].text=k+" "+D.tokens[0].text,D.tokens[0].tokens&&D.tokens[0].tokens.length>0&&D.tokens[0].tokens[0].type==="text"&&(D.tokens[0].tokens[0].text=k+" "+D.tokens[0].tokens[0].text)):D.tokens.unshift({type:"text",text:k}):g+=k),g+=this.parse(D.tokens,b),d+=this.renderer.listitem(g,C,v);r+=this.renderer.list(d,p,m);continue}case"html":{r+=this.renderer.html(h.text);continue}case"paragraph":{r+=this.renderer.paragraph(this.parseInline(h.tokens));continue}case"text":{for(d=h.tokens?this.parseInline(h.tokens):h.text;n+1<F&&e[n+1].type==="text";)h=e[++n],d+=`
`+(h.tokens?this.parseInline(h.tokens):h.text);r+=t?this.renderer.paragraph(d):d;continue}default:{const T='Token with "'+h.type+'" type was not found.';if(this.options.silent){console.error(T);return}else throw new Error(T)}}}return r}parseInline(e,t){t=t||this.renderer;let r="",n,i,a;const o=e.length;for(n=0;n<o;n++){if(i=e[n],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[i.type]&&(a=this.options.extensions.renderers[i.type].call({parser:this},i),a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type))){r+=a||"";continue}switch(i.type){case"escape":{r+=t.text(i.text);break}case"html":{r+=t.html(i.text);break}case"link":{r+=t.link(i.href,i.title,this.parseInline(i.tokens,t));break}case"image":{r+=t.image(i.href,i.title,i.text);break}case"strong":{r+=t.strong(this.parseInline(i.tokens,t));break}case"em":{r+=t.em(this.parseInline(i.tokens,t));break}case"codespan":{r+=t.codespan(i.text);break}case"br":{r+=t.br();break}case"del":{r+=t.del(this.parseInline(i.tokens,t));break}case"text":{r+=t.text(i.text);break}default:{const u='Token with "'+i.type+'" type was not found.';if(this.options.silent){console.error(u);return}else throw new Error(u)}}}return r}}class ci{constructor(e){this.options=e||Mn}preprocess(e){return e}postprocess(e){return e}}Es(ci,"passThroughHooks",new Set(["preprocess","postprocess"]));function _0(s,e,t){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,s){const n="<p>An error occurred:</p><pre>"+gt(r.message+"",!0)+"</pre>";if(e)return Promise.resolve(n);if(t){t(null,n);return}return n}if(e)return Promise.reject(r);if(t){t(r);return}throw r}}function wl(s,e){return(t,r,n)=>{typeof r=="function"&&(n=r,r=null);const i={...r};r={...Se.defaults,...i};const a=_0(r.silent,r.async,n);if(typeof t>"u"||t===null)return a(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(g0(r),r.hooks&&(r.hooks.options=r),n){const o=r.highlight;let u;try{r.hooks&&(t=r.hooks.preprocess(t)),u=s(t,r)}catch(f){return a(f)}const l=function(f){let d;if(!f)try{r.walkTokens&&Se.walkTokens(u,r.walkTokens),d=e(u,r),r.hooks&&(d=r.hooks.postprocess(d))}catch(h){f=h}return r.highlight=o,f?a(f):n(null,d)};if(!o||o.length<3||(delete r.highlight,!u.length))return l();let c=0;Se.walkTokens(u,function(f){f.type==="code"&&(c++,setTimeout(()=>{o(f.text,f.lang,function(d,h){if(d)return l(d);h!=null&&h!==f.text&&(f.text=h,f.escaped=!0),c--,c===0&&l()})},0))}),c===0&&l();return}if(r.async)return Promise.resolve(r.hooks?r.hooks.preprocess(t):t).then(o=>s(o,r)).then(o=>r.walkTokens?Promise.all(Se.walkTokens(o,r.walkTokens)).then(()=>o):o).then(o=>e(o,r)).then(o=>r.hooks?r.hooks.postprocess(o):o).catch(a);try{r.hooks&&(t=r.hooks.preprocess(t));const o=s(t,r);r.walkTokens&&Se.walkTokens(o,r.walkTokens);let u=e(o,r);return r.hooks&&(u=r.hooks.postprocess(u)),u}catch(o){return a(o)}}}function Se(s,e,t){return wl(an.lex,gn.parse)(s,e,t)}Se.options=Se.setOptions=function(s){return Se.defaults={...Se.defaults,...s},r0(Se.defaults),Se};Se.getDefaults=ml;Se.defaults=Mn;Se.use=function(...s){const e=Se.defaults.extensions||{renderers:{},childTokens:{}};s.forEach(t=>{const r={...t};if(r.async=Se.defaults.async||r.async||!1,t.extensions&&(t.extensions.forEach(n=>{if(!n.name)throw new Error("extension name required");if(n.renderer){const i=e.renderers[n.name];i?e.renderers[n.name]=function(...a){let o=n.renderer.apply(this,a);return o===!1&&(o=i.apply(this,a)),o}:e.renderers[n.name]=n.renderer}if(n.tokenizer){if(!n.level||n.level!=="block"&&n.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");e[n.level]?e[n.level].unshift(n.tokenizer):e[n.level]=[n.tokenizer],n.start&&(n.level==="block"?e.startBlock?e.startBlock.push(n.start):e.startBlock=[n.start]:n.level==="inline"&&(e.startInline?e.startInline.push(n.start):e.startInline=[n.start]))}n.childTokens&&(e.childTokens[n.name]=n.childTokens)}),r.extensions=e),t.renderer){const n=Se.defaults.renderer||new gs;for(const i in t.renderer){const a=n[i];n[i]=(...o)=>{let u=t.renderer[i].apply(n,o);return u===!1&&(u=a.apply(n,o)),u}}r.renderer=n}if(t.tokenizer){const n=Se.defaults.tokenizer||new ms;for(const i in t.tokenizer){const a=n[i];n[i]=(...o)=>{let u=t.tokenizer[i].apply(n,o);return u===!1&&(u=a.apply(n,o)),u}}r.tokenizer=n}if(t.hooks){const n=Se.defaults.hooks||new ci;for(const i in t.hooks){const a=n[i];ci.passThroughHooks.has(i)?n[i]=o=>{if(Se.defaults.async)return Promise.resolve(t.hooks[i].call(n,o)).then(l=>a.call(n,l));const u=t.hooks[i].call(n,o);return a.call(n,u)}:n[i]=(...o)=>{let u=t.hooks[i].apply(n,o);return u===!1&&(u=a.apply(n,o)),u}}r.hooks=n}if(t.walkTokens){const n=Se.defaults.walkTokens;r.walkTokens=function(i){let a=[];return a.push(t.walkTokens.call(this,i)),n&&(a=a.concat(n.call(this,i))),a}}Se.setOptions(r)})};Se.walkTokens=function(s,e){let t=[];for(const r of s)switch(t=t.concat(e.call(Se,r)),r.type){case"table":{for(const n of r.header)t=t.concat(Se.walkTokens(n.tokens,e));for(const n of r.rows)for(const i of n)t=t.concat(Se.walkTokens(i.tokens,e));break}case"list":{t=t.concat(Se.walkTokens(r.items,e));break}default:Se.defaults.extensions&&Se.defaults.extensions.childTokens&&Se.defaults.extensions.childTokens[r.type]?Se.defaults.extensions.childTokens[r.type].forEach(function(n){t=t.concat(Se.walkTokens(r[n],e))}):r.tokens&&(t=t.concat(Se.walkTokens(r.tokens,e)))}return t};Se.parseInline=wl(an.lexInline,gn.parseInline);Se.Parser=gn;Se.parser=gn.parse;Se.Renderer=gs;Se.TextRenderer=_l;Se.Lexer=an;Se.lexer=an.lex;Se.Tokenizer=ms;Se.Slugger=bs;Se.Hooks=ci;Se.parse=Se;Se.options;Se.setOptions;Se.use;Se.walkTokens;Se.parseInline;gn.parse;an.lex;const yl={};function w0(s){let e;return{c(){e=J(s[1])},m(t,r){S(t,e,r)},p(t,r){r&2&&Ae(e,t[1])},i:X,o:X,d(t){t&&B(e)}}}function y0(s){let e,t;const r=s[5].default,n=Ge(r,s,s[4],null);return{c(){e=A("h6"),n&&n.c(),E(e,"id",s[2])},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,a){n&&n.p&&(!t||a&16)&&Ye(n,r,i,i[4],t?Xe(r,i[4],a,null):Je(i[4]),null),(!t||a&4)&&E(e,"id",i[2])},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function v0(s){let e,t;const r=s[5].default,n=Ge(r,s,s[4],null);return{c(){e=A("h5"),n&&n.c(),E(e,"id",s[2])},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,a){n&&n.p&&(!t||a&16)&&Ye(n,r,i,i[4],t?Xe(r,i[4],a,null):Je(i[4]),null),(!t||a&4)&&E(e,"id",i[2])},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function C0(s){let e,t;const r=s[5].default,n=Ge(r,s,s[4],null);return{c(){e=A("h4"),n&&n.c(),E(e,"id",s[2])},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,a){n&&n.p&&(!t||a&16)&&Ye(n,r,i,i[4],t?Xe(r,i[4],a,null):Je(i[4]),null),(!t||a&4)&&E(e,"id",i[2])},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function A0(s){let e,t;const r=s[5].default,n=Ge(r,s,s[4],null);return{c(){e=A("h3"),n&&n.c(),E(e,"id",s[2])},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,a){n&&n.p&&(!t||a&16)&&Ye(n,r,i,i[4],t?Xe(r,i[4],a,null):Je(i[4]),null),(!t||a&4)&&E(e,"id",i[2])},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function k0(s){let e,t;const r=s[5].default,n=Ge(r,s,s[4],null);return{c(){e=A("h2"),n&&n.c(),E(e,"id",s[2])},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,a){n&&n.p&&(!t||a&16)&&Ye(n,r,i,i[4],t?Xe(r,i[4],a,null):Je(i[4]),null),(!t||a&4)&&E(e,"id",i[2])},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function E0(s){let e,t;const r=s[5].default,n=Ge(r,s,s[4],null);return{c(){e=A("h1"),n&&n.c(),E(e,"id",s[2])},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,a){n&&n.p&&(!t||a&16)&&Ye(n,r,i,i[4],t?Xe(r,i[4],a,null):Je(i[4]),null),(!t||a&4)&&E(e,"id",i[2])},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function F0(s){let e,t,r,n;const i=[E0,k0,A0,C0,v0,y0,w0],a=[];function o(u,l){return u[0]===1?0:u[0]===2?1:u[0]===3?2:u[0]===4?3:u[0]===5?4:u[0]===6?5:6}return e=o(s),t=a[e]=i[e](s),{c(){t.c(),r=Fe()},m(u,l){a[e].m(u,l),S(u,r,l),n=!0},p(u,[l]){let c=e;e=o(u),e===c?a[e].p(u,l):(me(),M(a[c],1,1,()=>{a[c]=null}),ge(),t=a[e],t?t.p(u,l):(t=a[e]=i[e](u),t.c()),P(t,1),t.m(r.parentNode,r))},i(u){n||(P(t),n=!0)},o(u){M(t),n=!1},d(u){a[e].d(u),u&&B(r)}}}function S0(s,e,t){let r,{$$slots:n={},$$scope:i}=e,{depth:a}=e,{raw:o}=e,{text:u}=e;const{slug:l,getOptions:c}=ec(yl),f=c();return s.$$set=d=>{"depth"in d&&t(0,a=d.depth),"raw"in d&&t(1,o=d.raw),"text"in d&&t(3,u=d.text),"$$scope"in d&&t(4,i=d.$$scope)},s.$$.update=()=>{s.$$.dirty&8&&t(2,r=f.headerIds?f.headerPrefix+l(u):void 0)},[a,o,r,u,i,n]}class B0 extends ye{constructor(e){super(),ve(this,e,S0,F0,we,{depth:0,raw:1,text:3})}}function I0(s){let e,t;const r=s[1].default,n=Ge(r,s,s[0],null);return{c(){e=A("p"),n&&n.c()},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,[a]){n&&n.p&&(!t||a&1)&&Ye(n,r,i,i[0],t?Xe(r,i[0],a,null):Je(i[0]),null)},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function T0(s,e,t){let{$$slots:r={},$$scope:n}=e;return s.$$set=i=>{"$$scope"in i&&t(0,n=i.$$scope)},[n,r]}class R0 extends ye{constructor(e){super(),ve(this,e,T0,I0,we,{})}}function x0(s){let e;const t=s[3].default,r=Ge(t,s,s[2],null);return{c(){r&&r.c()},m(n,i){r&&r.m(n,i),e=!0},p(n,[i]){r&&r.p&&(!e||i&4)&&Ye(r,t,n,n[2],e?Xe(t,n[2],i,null):Je(n[2]),null)},i(n){e||(P(r,n),e=!0)},o(n){M(r,n),e=!1},d(n){r&&r.d(n)}}}function P0(s,e,t){let{$$slots:r={},$$scope:n}=e,{text:i}=e,{raw:a}=e;return s.$$set=o=>{"text"in o&&t(0,i=o.text),"raw"in o&&t(1,a=o.raw),"$$scope"in o&&t(2,n=o.$$scope)},[i,a,n,r]}class O0 extends ye{constructor(e){super(),ve(this,e,P0,x0,we,{text:0,raw:1})}}function N0(s){let e,t;return{c(){e=A("img"),vt(e.src,t=s[0])||E(e,"src",t),E(e,"title",s[1]),E(e,"alt",s[2])},m(r,n){S(r,e,n)},p(r,[n]){n&1&&!vt(e.src,t=r[0])&&E(e,"src",t),n&2&&E(e,"title",r[1]),n&4&&E(e,"alt",r[2])},i:X,o:X,d(r){r&&B(e)}}}function M0(s,e,t){let{href:r=""}=e,{title:n=void 0}=e,{text:i=""}=e;return s.$$set=a=>{"href"in a&&t(0,r=a.href),"title"in a&&t(1,n=a.title),"text"in a&&t(2,i=a.text)},[r,n,i]}class L0 extends ye{constructor(e){super(),ve(this,e,M0,N0,we,{href:0,title:1,text:2})}}function z0(s){let e,t;const r=s[3].default,n=Ge(r,s,s[2],null);return{c(){e=A("a"),n&&n.c(),E(e,"href",s[0]),E(e,"title",s[1])},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,[a]){n&&n.p&&(!t||a&4)&&Ye(n,r,i,i[2],t?Xe(r,i[2],a,null):Je(i[2]),null),(!t||a&1)&&E(e,"href",i[0]),(!t||a&2)&&E(e,"title",i[1])},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function $0(s,e,t){let{$$slots:r={},$$scope:n}=e,{href:i=""}=e,{title:a=void 0}=e;return s.$$set=o=>{"href"in o&&t(0,i=o.href),"title"in o&&t(1,a=o.title),"$$scope"in o&&t(2,n=o.$$scope)},[i,a,n,r]}class j0 extends ye{constructor(e){super(),ve(this,e,$0,z0,we,{href:0,title:1})}}function U0(s){let e,t;const r=s[1].default,n=Ge(r,s,s[0],null);return{c(){e=A("em"),n&&n.c()},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,[a]){n&&n.p&&(!t||a&1)&&Ye(n,r,i,i[0],t?Xe(r,i[0],a,null):Je(i[0]),null)},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function H0(s,e,t){let{$$slots:r={},$$scope:n}=e;return s.$$set=i=>{"$$scope"in i&&t(0,n=i.$$scope)},[n,r]}class q0 extends ye{constructor(e){super(),ve(this,e,H0,U0,we,{})}}function W0(s){let e,t;const r=s[1].default,n=Ge(r,s,s[0],null);return{c(){e=A("del"),n&&n.c()},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,[a]){n&&n.p&&(!t||a&1)&&Ye(n,r,i,i[0],t?Xe(r,i[0],a,null):Je(i[0]),null)},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function V0(s,e,t){let{$$slots:r={},$$scope:n}=e;return s.$$set=i=>{"$$scope"in i&&t(0,n=i.$$scope)},[n,r]}class K0 extends ye{constructor(e){super(),ve(this,e,V0,W0,we,{})}}function Z0(s){let e,t=s[0].replace(/`/g,"")+"",r;return{c(){e=A("code"),r=J(t)},m(n,i){S(n,e,i),w(e,r)},p(n,[i]){i&1&&t!==(t=n[0].replace(/`/g,"")+"")&&Ae(r,t)},i:X,o:X,d(n){n&&B(e)}}}function Q0(s,e,t){let{raw:r}=e;return s.$$set=n=>{"raw"in n&&t(0,r=n.raw)},[r]}class G0 extends ye{constructor(e){super(),ve(this,e,Q0,Z0,we,{raw:0})}}function Y0(s){let e,t;const r=s[1].default,n=Ge(r,s,s[0],null);return{c(){e=A("strong"),n&&n.c()},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,[a]){n&&n.p&&(!t||a&1)&&Ye(n,r,i,i[0],t?Xe(r,i[0],a,null):Je(i[0]),null)},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function J0(s,e,t){let{$$slots:r={},$$scope:n}=e;return s.$$set=i=>{"$$scope"in i&&t(0,n=i.$$scope)},[n,r]}class X0 extends ye{constructor(e){super(),ve(this,e,J0,Y0,we,{})}}function ep(s){let e,t;const r=s[1].default,n=Ge(r,s,s[0],null);return{c(){e=A("table"),n&&n.c()},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,[a]){n&&n.p&&(!t||a&1)&&Ye(n,r,i,i[0],t?Xe(r,i[0],a,null):Je(i[0]),null)},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function tp(s,e,t){let{$$slots:r={},$$scope:n}=e;return s.$$set=i=>{"$$scope"in i&&t(0,n=i.$$scope)},[n,r]}class np extends ye{constructor(e){super(),ve(this,e,tp,ep,we,{})}}function rp(s){let e,t;const r=s[1].default,n=Ge(r,s,s[0],null);return{c(){e=A("thead"),n&&n.c()},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,[a]){n&&n.p&&(!t||a&1)&&Ye(n,r,i,i[0],t?Xe(r,i[0],a,null):Je(i[0]),null)},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function ip(s,e,t){let{$$slots:r={},$$scope:n}=e;return s.$$set=i=>{"$$scope"in i&&t(0,n=i.$$scope)},[n,r]}class sp extends ye{constructor(e){super(),ve(this,e,ip,rp,we,{})}}function ap(s){let e,t;const r=s[1].default,n=Ge(r,s,s[0],null);return{c(){e=A("tbody"),n&&n.c()},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,[a]){n&&n.p&&(!t||a&1)&&Ye(n,r,i,i[0],t?Xe(r,i[0],a,null):Je(i[0]),null)},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function op(s,e,t){let{$$slots:r={},$$scope:n}=e;return s.$$set=i=>{"$$scope"in i&&t(0,n=i.$$scope)},[n,r]}class up extends ye{constructor(e){super(),ve(this,e,op,ap,we,{})}}function lp(s){let e,t;const r=s[1].default,n=Ge(r,s,s[0],null);return{c(){e=A("tr"),n&&n.c()},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,[a]){n&&n.p&&(!t||a&1)&&Ye(n,r,i,i[0],t?Xe(r,i[0],a,null):Je(i[0]),null)},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function cp(s,e,t){let{$$slots:r={},$$scope:n}=e;return s.$$set=i=>{"$$scope"in i&&t(0,n=i.$$scope)},[n,r]}class fp extends ye{constructor(e){super(),ve(this,e,cp,lp,we,{})}}function hp(s){let e,t;const r=s[3].default,n=Ge(r,s,s[2],null);return{c(){e=A("td"),n&&n.c(),E(e,"align",s[1])},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,a){n&&n.p&&(!t||a&4)&&Ye(n,r,i,i[2],t?Xe(r,i[2],a,null):Je(i[2]),null),(!t||a&2)&&E(e,"align",i[1])},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function dp(s){let e,t;const r=s[3].default,n=Ge(r,s,s[2],null);return{c(){e=A("th"),n&&n.c(),E(e,"align",s[1])},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,a){n&&n.p&&(!t||a&4)&&Ye(n,r,i,i[2],t?Xe(r,i[2],a,null):Je(i[2]),null),(!t||a&2)&&E(e,"align",i[1])},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function pp(s){let e,t,r,n;const i=[dp,hp],a=[];function o(u,l){return u[0]?0:1}return e=o(s),t=a[e]=i[e](s),{c(){t.c(),r=Fe()},m(u,l){a[e].m(u,l),S(u,r,l),n=!0},p(u,[l]){let c=e;e=o(u),e===c?a[e].p(u,l):(me(),M(a[c],1,1,()=>{a[c]=null}),ge(),t=a[e],t?t.p(u,l):(t=a[e]=i[e](u),t.c()),P(t,1),t.m(r.parentNode,r))},i(u){n||(P(t),n=!0)},o(u){M(t),n=!1},d(u){a[e].d(u),u&&B(r)}}}function mp(s,e,t){let{$$slots:r={},$$scope:n}=e,{header:i}=e,{align:a}=e;return s.$$set=o=>{"header"in o&&t(0,i=o.header),"align"in o&&t(1,a=o.align),"$$scope"in o&&t(2,n=o.$$scope)},[i,a,n,r]}class gp extends ye{constructor(e){super(),ve(this,e,mp,pp,we,{header:0,align:1})}}function bp(s){let e,t;const r=s[3].default,n=Ge(r,s,s[2],null);return{c(){e=A("ul"),n&&n.c()},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,a){n&&n.p&&(!t||a&4)&&Ye(n,r,i,i[2],t?Xe(r,i[2],a,null):Je(i[2]),null)},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function Dp(s){let e,t;const r=s[3].default,n=Ge(r,s,s[2],null);return{c(){e=A("ol"),n&&n.c(),E(e,"start",s[1])},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,a){n&&n.p&&(!t||a&4)&&Ye(n,r,i,i[2],t?Xe(r,i[2],a,null):Je(i[2]),null),(!t||a&2)&&E(e,"start",i[1])},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function _p(s){let e,t,r,n;const i=[Dp,bp],a=[];function o(u,l){return u[0]?0:1}return e=o(s),t=a[e]=i[e](s),{c(){t.c(),r=Fe()},m(u,l){a[e].m(u,l),S(u,r,l),n=!0},p(u,[l]){let c=e;e=o(u),e===c?a[e].p(u,l):(me(),M(a[c],1,1,()=>{a[c]=null}),ge(),t=a[e],t?t.p(u,l):(t=a[e]=i[e](u),t.c()),P(t,1),t.m(r.parentNode,r))},i(u){n||(P(t),n=!0)},o(u){M(t),n=!1},d(u){a[e].d(u),u&&B(r)}}}function wp(s,e,t){let{$$slots:r={},$$scope:n}=e,{ordered:i}=e,{start:a}=e;return s.$$set=o=>{"ordered"in o&&t(0,i=o.ordered),"start"in o&&t(1,a=o.start),"$$scope"in o&&t(2,n=o.$$scope)},[i,a,n,r]}class yp extends ye{constructor(e){super(),ve(this,e,wp,_p,we,{ordered:0,start:1})}}function vp(s){let e,t;const r=s[1].default,n=Ge(r,s,s[0],null);return{c(){e=A("li"),n&&n.c()},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,[a]){n&&n.p&&(!t||a&1)&&Ye(n,r,i,i[0],t?Xe(r,i[0],a,null):Je(i[0]),null)},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function Cp(s,e,t){let{$$slots:r={},$$scope:n}=e;return s.$$set=i=>{"$$scope"in i&&t(0,n=i.$$scope)},[n,r]}class Ap extends ye{constructor(e){super(),ve(this,e,Cp,vp,we,{})}}function kp(s){let e;return{c(){e=A("hr")},m(t,r){S(t,e,r)},p:X,i:X,o:X,d(t){t&&B(e)}}}class Ep extends ye{constructor(e){super(),ve(this,e,null,kp,we,{})}}function Fp(s){let e,t;return{c(){e=new mu(!1),t=Fe(),e.a=t},m(r,n){e.m(s[0],r,n),S(r,t,n)},p(r,[n]){n&1&&e.p(r[0])},i:X,o:X,d(r){r&&B(t),r&&e.d()}}}function Sp(s,e,t){let{text:r}=e;return s.$$set=n=>{"text"in n&&t(0,r=n.text)},[r]}class Bp extends ye{constructor(e){super(),ve(this,e,Sp,Fp,we,{text:0})}}function Ip(s){let e,t;const r=s[1].default,n=Ge(r,s,s[0],null);return{c(){e=A("blockquote"),n&&n.c()},m(i,a){S(i,e,a),n&&n.m(e,null),t=!0},p(i,[a]){n&&n.p&&(!t||a&1)&&Ye(n,r,i,i[0],t?Xe(r,i[0],a,null):Je(i[0]),null)},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function Tp(s,e,t){let{$$slots:r={},$$scope:n}=e;return s.$$set=i=>{"$$scope"in i&&t(0,n=i.$$scope)},[n,r]}class Rp extends ye{constructor(e){super(),ve(this,e,Tp,Ip,we,{})}}function xp(s){let e,t,r;return{c(){e=A("pre"),t=A("code"),r=J(s[1]),E(e,"class",s[0])},m(n,i){S(n,e,i),w(e,t),w(t,r)},p(n,[i]){i&2&&Ae(r,n[1]),i&1&&E(e,"class",n[0])},i:X,o:X,d(n){n&&B(e)}}}function Pp(s,e,t){let{lang:r}=e,{text:n}=e;return s.$$set=i=>{"lang"in i&&t(0,r=i.lang),"text"in i&&t(1,n=i.text)},[r,n]}class Op extends ye{constructor(e){super(),ve(this,e,Pp,xp,we,{lang:0,text:1})}}function Np(s){let e,t;const r=s[1].default,n=Ge(r,s,s[0],null);return{c(){e=A("br"),n&&n.c()},m(i,a){S(i,e,a),n&&n.m(i,a),t=!0},p(i,[a]){n&&n.p&&(!t||a&1)&&Ye(n,r,i,i[0],t?Xe(r,i[0],a,null):Je(i[0]),null)},i(i){t||(P(n,i),t=!0)},o(i){M(n,i),t=!1},d(i){i&&B(e),n&&n.d(i)}}}function Mp(s,e,t){let{$$slots:r={},$$scope:n}=e;return s.$$set=i=>{"$$scope"in i&&t(0,n=i.$$scope)},[n,r]}class Lp extends ye{constructor(e){super(),ve(this,e,Mp,Np,we,{})}}const zp={heading:B0,paragraph:R0,text:O0,image:L0,link:j0,em:q0,strong:X0,codespan:G0,del:K0,table:np,tablehead:sp,tablebody:up,tablerow:fp,tablecell:gp,list:yp,orderedlistitem:null,unorderedlistitem:null,listitem:Ap,hr:Ep,html:Bp,blockquote:Rp,code:Op,br:Lp},$p={baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,xhtml:!1};function jp(s){let e,t;return e=new Nn({props:{tokens:s[0],renderers:s[1]}}),{c(){oe(e.$$.fragment)},m(r,n){ue(e,r,n),t=!0},p(r,[n]){const i={};n&1&&(i.tokens=r[0]),n&2&&(i.renderers=r[1]),e.$set(i)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){M(e.$$.fragment,r),t=!1},d(r){le(e,r)}}}function Up(s,e,t){let r,n,i,a,{source:o=[]}=e,{renderers:u={}}=e,{options:l={}}=e,{isInline:c=!1}=e;const f=bt();let d,h,p;return tc(yl,{slug:m=>n?n.slug(m):"",getOptions:()=>i}),Ft(()=>{t(7,p=!0)}),s.$$set=m=>{"source"in m&&t(2,o=m.source),"renderers"in m&&t(3,u=m.renderers),"options"in m&&t(4,l=m.options),"isInline"in m&&t(5,c=m.isInline)},s.$$.update=()=>{s.$$.dirty&4&&t(8,r=Array.isArray(o)),s.$$.dirty&4&&(n=o?new bs:void 0),s.$$.dirty&16&&t(9,i={...$p,...l}),s.$$.dirty&869&&(r?t(0,d=o):(t(6,h=new an(i)),t(0,d=c?h.inlineTokens(o):h.lex(o)),f("parsed",{tokens:d}))),s.$$.dirty&8&&t(1,a={...zp,...u}),s.$$.dirty&385&&p&&!r&&f("parsed",{tokens:d})},[d,a,o,u,l,c,h,p,r,i]}class Hp extends ye{constructor(e){super(),ve(this,e,Up,jp,we,{source:2,renderers:3,options:4,isInline:5})}}function qp(s){let e,t,r,n={ctx:s,current:null,token:null,hasCatch:!1,pending:Xp,then:Vp,catch:Wp,value:13,blocks:[,,,]};return Ss(t=s[4],n),{c(){e=Fe(),n.block.c()},m(i,a){S(i,e,a),n.block.m(i,n.anchor=a),n.mount=()=>e.parentNode,n.anchor=e,r=!0},p(i,a){s=i,n.ctx=s,a&16&&t!==(t=s[4])&&Ss(t,n)||nc(n,s,a)},i(i){r||(P(n.block),r=!0)},o(i){for(let a=0;a<3;a+=1){const o=n.blocks[a];M(o)}r=!1},d(i){i&&B(e),n.block.d(i),n.token=null,n=null}}}function Wp(s){return{c:X,m:X,p:X,i:X,o:X,d:X}}function Vp(s){let e,t,r,n=!s[2]&&za(s),i=s[3]!==void 0&&s[1]!=="true"&&$a(s);return{c(){e=A("div"),n&&n.c(),t=z(),i&&i.c(),E(e,"class","flex flex-row mb-4 flex-wrap")},m(a,o){S(a,e,o),n&&n.m(e,null),w(e,t),i&&i.m(e,null),r=!0},p(a,o){a[2]?n&&(me(),M(n,1,1,()=>{n=null}),ge()):n?(n.p(a,o),o&4&&P(n,1)):(n=za(a),n.c(),P(n,1),n.m(e,t)),a[3]!==void 0&&a[1]!=="true"?i?i.p(a,o):(i=$a(a),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i(a){r||(P(n),r=!0)},o(a){M(n),r=!1},d(a){a&&B(e),n&&n.d(),i&&i.d()}}}function za(s){let e,t,r,n,i;const a=[Jp,Yp,Gp,Qp,Zp,Kp],o=[];function u(l,c){return l[6]=="image"?0:l[6]=="text"?1:l[6]=="audio"?2:l[6]=="markdown"?3:l[6]=="pdf"?4:5}return r=u(s),n=o[r]=a[r](s),{c(){e=A("div"),t=A("div"),n.c(),E(t,"class","mt-2 w-full"),E(e,"class","flex flex-col justify-between h-auto")},m(l,c){S(l,e,c),w(e,t),o[r].m(t,null),i=!0},p(l,c){let f=r;r=u(l),r===f?o[r].p(l,c):(me(),M(o[f],1,1,()=>{o[f]=null}),ge(),n=o[r],n?n.p(l,c):(n=o[r]=a[r](l),n.c()),P(n,1),n.m(t,null))},i(l){i||(P(n),i=!0)},o(l){M(n),i=!1},d(l){l&&B(e),o[r].d()}}}function Kp(s){let e;return{c(){e=A("p"),e.textContent="Attachment type not supported"},m(t,r){S(t,e,r)},p:X,i:X,o:X,d(t){t&&B(e)}}}function Zp(s){let e;return{c(){e=A("p"),e.textContent="Pdf preview to come"},m(t,r){S(t,e,r)},p:X,i:X,o:X,d(t){t&&B(e)}}}function Qp(s){let e,t,r;return t=new Hp({props:{source:s[13]}}),{c(){e=A("div"),oe(t.$$.fragment),E(e,"class","markdown svelte-4mbj1g")},m(n,i){S(n,e,i),ue(t,e,null),r=!0},p(n,i){const a={};i&16&&(a.source=n[13]),t.$set(a)},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t)}}}function Gp(s){let e,t,r;return{c(){e=A("div"),t=A("audio"),E(t,"class","w-full svelte-4mbj1g"),vt(t.src,r=s[13])||E(t,"src",r),t.controls=!0},m(n,i){S(n,e,i),w(e,t)},p(n,i){i&16&&!vt(t.src,r=n[13])&&E(t,"src",r)},i:X,o:X,d(n){n&&B(e)}}}function Yp(s){let e,t=s[13]+"";return{c(){e=A("p"),E(e,"class","my-6 textbox svelte-4mbj1g")},m(r,n){S(r,e,n),e.innerHTML=t},p(r,n){n&16&&t!==(t=r[13]+"")&&(e.innerHTML=t)},i:X,o:X,d(r){r&&B(e)}}}function Jp(s){let e,t,r;return{c(){e=A("img"),vt(e.src,t=s[13])||E(e,"src",t),E(e,"alt",r=s[0].text),E(e,"class","svelte-4mbj1g")},m(n,i){S(n,e,i)},p(n,i){i&16&&!vt(e.src,t=n[13])&&E(e,"src",t),i&1&&r!==(r=n[0].text)&&E(e,"alt",r)},i:X,o:X,d(n){n&&B(e)}}}function $a(s){let e,t,r=!s[5]&&ja(s);return{c(){e=A("div"),t=A("p"),r&&r.c(),E(t,"class","mx-4"),E(e,"class","flex flex-row mb-4 items-end pb-8")},m(n,i){S(n,e,i),w(e,t),r&&r.m(t,null)},p(n,i){n[5]?r&&(r.d(1),r=null):r?r.p(n,i):(r=ja(n),r.c(),r.m(t,null))},d(n){n&&B(e),r&&r.d()}}}function ja(s){let e,t,r;return{c(){e=A("button"),e.textContent="Get attachment",E(e,"class","svelte-4mbj1g")},m(n,i){S(n,e,i),t||(r=fe(e,"click",function(){pu(s[7](s[0]))&&s[7](s[0]).apply(this,arguments)}),t=!0)},p(n,i){s=n},d(n){n&&B(e),t=!1,r()}}}function Xp(s){let e;return{c(){e=J("Loading attachment...")},m(t,r){S(t,e,r)},p:X,i:X,o:X,d(t){t&&B(e)}}}function em(s){let e,t,r=qp(s);return{c(){r&&r.c(),e=Fe()},m(n,i){r&&r.m(n,i),S(n,e,i),t=!0},p(n,[i]){r.p(n,i)},i(n){t||(P(r),t=!0)},o(n){M(r),t=!1},d(n){r&&r.d(n),n&&B(e)}}}function tm(s,e,t){let r;He(s,jt,p=>t(10,r=p));let{doc:n}=e,{replies:i}=e,a,o,u=!1,l=!0,c,f;async function d(p){const m=await r.replica.getAttachment(p);let b=p.path.split(".").pop();if(m!==void 0){const v=await m.bytes();console.log("docdata",v);let C=new Uint8Array(v.length);for(var g=0;g<v.length;g++)C[g]=v[g];if(b==="md")t(6,c="markdown"),t(6,c),t(3,a=String.fromCharCode(...C));else if(b=="mp3"||b=="ogg"||b=="webm")t(6,c="audio"),f="audio/"+b,t(6,c),f=f,console.log("this is audio"),console.log(c,f),t(3,a=URL.createObjectURL(new Blob([C],{type:f})));else if(b==="txt"){t(6,c="text"),t(6,c),console.log(c);var D=new TextDecoder("utf-8");t(3,a=D.decode(Uint8Array.from(C)))}else b=="png"||b=="gif"||b=="jpeg"?(t(6,c="image"),console.log("this is an image"),console.log("fileExtension "+b),f="image/"+b,t(6,c),f=f,t(3,a=URL.createObjectURL(new Blob([C],{type:f})))):(t(6,c="other"),t(6,c),console.log(c),t(3,a=URL.createObjectURL(new Blob([C],{type:"application/octet-stream"}))));return a}}function h(p){t(4,o=d(p)),t(5,u=!0),t(2,l=!1)}return s.$$set=p=>{"doc"in p&&t(0,n=p.doc),"replies"in p&&t(1,i=p.replies)},s.$$.update=()=>{s.$$.dirty&1&&n&&(t(4,o=d(n)),t(5,u=!0),t(2,l=!1)),s.$$.dirty&4,s.$$.dirty&1&&console.log("selectedDoc in GetAttachment",n)},[n,i,l,a,o,u,c,h]}class Ds extends ye{constructor(e){super(),ve(this,e,tm,em,we,{doc:0,replies:1})}}function Ua(s){let e,t,r,n,i,a,o,u=Math.trunc(s[2])+"",l,c,f=s[2]<=1?"minute":"minutes",d,h,p,m,b=Math.trunc((s[3]/1e3-(s[0]*1e3+s[4]))/6e4)+"",g,D,v,C,k,I;return{c(){e=A("div"),t=A("button"),t.textContent="Extend",r=z(),n=A("button"),n.textContent="Shorten",i=z(),a=A("p"),o=J("last interaction was "),l=J(u),c=z(),d=J(f),h=J(" ago"),p=z(),m=A("p"),g=J(b),D=J(" minutes left until deletion"),v=z(),C=A("button"),C.textContent="Delete",E(t,"class","svelte-mmxx8s"),E(n,"class","svelte-mmxx8s"),E(a,"class","svelte-mmxx8s"),E(m,"class","svelte-mmxx8s"),E(C,"class","svelte-mmxx8s"),E(e,"id","flexcontainer"),E(e,"class","svelte-mmxx8s")},m(F,T){S(F,e,T),w(e,t),w(e,r),w(e,n),w(e,i),w(e,a),w(a,o),w(a,l),w(a,c),w(a,d),w(a,h),w(e,p),w(e,m),w(m,g),w(m,D),w(e,v),w(e,C),k||(I=[fe(t,"click",s[5]),fe(n,"click",s[6]),fe(C,"click",s[10])],k=!0)},p(F,T){T&4&&u!==(u=Math.trunc(F[2])+"")&&Ae(l,u),T&4&&f!==(f=F[2]<=1?"minute":"minutes")&&Ae(d,f),T&9&&b!==(b=Math.trunc((F[3]/1e3-(F[0]*1e3+F[4]))/6e4)+"")&&Ae(g,b)},d(F){F&&B(e),k=!1,je(I)}}}function nm(s){let e,t=s[1]?"Ephemeral":"Ephemeral",r,n,i,a,o,u=s[1]&&Ua(s);return{c(){e=A("button"),r=J(t),n=z(),u&&u.c(),i=Fe(),E(e,"class","svelte-mmxx8s")},m(l,c){S(l,e,c),w(e,r),S(l,n,c),u&&u.m(l,c),S(l,i,c),a||(o=fe(e,"click",s[9]),a=!0)},p(l,[c]){c&2&&t!==(t=l[1]?"Ephemeral":"Ephemeral")&&Ae(r,t),l[1]?u?u.p(l,c):(u=Ua(l),u.c(),u.m(i.parentNode,i)):u&&(u.d(1),u=null)},i:X,o:X,d(l){l&&B(e),l&&B(n),u&&u.d(l),l&&B(i),a=!1,o()}}}function rm(s,e,t){let r,n,i;He(s,Cd,g=>t(0,r=g)),He(s,Et,g=>t(11,n=g)),He(s,jt,g=>t(12,i=g));const a=bt();let o=Date.now(),u=!1,l=0,{doc:c}=e,f=c.deleteAfter;async function d(){t(3,f+=36e8);let g=n.address.slice(1,5),D=c.path.split("!"),v=D[0].replace("/documents","/studio")+D[1];const C=await i.replica.set(n,{text:c.text+"<br> lifespan extended by "+g+" on "+new Date().toLocaleString(),path:c.path,deleteAfter:f}),k=await i.replica.set(n,{text:c.text+"<br> lifespan extended by "+g+" on "+new Date().toLocaleString(),path:v});console.log("studioPath",v),console.log("doc.path",c.path),console.log("result c",C),console.log("result s",k)}async function h(){let g=n.address.slice(1,5),D=c.path.split("!"),v=D[0].replace("/documents","/studio")+D[1];console.log("studioPath",v),t(3,f-=864e8);const C=await i.replica.set(n,{text:c.text+"<br> lifespan shortened by "+g+" on "+new Date().toLocaleString(),path:c.path,deleteAfter:f}),k=await i.replica.set(n,{text:c.text+"<br> lifespan shortened by "+g+" on "+new Date().toLocaleString(),path:v});console.log("result c",C),console.log("result s",k)}async function p(){a("update");let g=n.address.slice(1,5),D=c.path.split("!"),v=D[0].replace("/documents","/studio")+D[1];const C=await i.replica.set(n,{path:c.path,deleteAfter:(Date.now()+1e3)*1e3}),k=await i.replica.set(n,{text:c.text+"<br> deleted by "+g+" on "+new Date().toLocaleString(),path:v});console.log("studio 'delete'",k),console.log("result delete",C)}const m=()=>t(1,u=!u),b=()=>p();return s.$$set=g=>{"doc"in g&&t(8,c=g.doc)},s.$$.update=()=>{s.$$.dirty&257&&t(2,l=(r+o/1e3-c.timestamp/1e6)/60)},[r,u,l,f,o,d,h,p,c,m,b]}class im extends ye{constructor(e){super(),ve(this,e,rm,nm,we,{doc:8})}}function Ha(s,e,t){const r=s.slice();return r[8]=e[t],r}function sm(s){let e;return{c(){e=J("Show details")},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function am(s){let e;return{c(){e=J("Hide details")},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function qa(s){let e,t,r,n,i,a,o,u,l=s[0].path+"",c,f,d,h,p,m=s[0].author+"",b,g,D,v,C,k=s[0].share+"",I,F,T,N,j,G=s[0].timestamp/1e3+"",R,L=s[1]&&Wa(s);function y(U,Z){return U[2]!==void 0?um:om}let q=y(s),ee=q(s);return{c(){e=A("div"),L&&L.c(),t=z(),ee.c(),r=z(),n=A("div"),i=A("ul"),a=A("li"),o=A("b"),o.textContent="path:",u=z(),c=J(l),f=z(),d=A("li"),h=A("b"),h.textContent="author:",p=z(),b=J(m),g=z(),D=A("li"),v=A("b"),v.textContent="share:",C=z(),I=J(k),F=z(),T=A("li"),N=A("b"),N.textContent="timestamp:",j=z(),R=J(G),E(a,"class","svelte-1ob97v4"),E(d,"class","svelte-1ob97v4"),E(D,"class","svelte-1ob97v4"),E(T,"class","svelte-1ob97v4"),E(i,"class","svelte-1ob97v4"),E(n,"class","my-4 break-all svelte-1ob97v4"),E(e,"class","svelte-1ob97v4")},m(U,Z){S(U,e,Z),L&&L.m(e,null),w(e,t),ee.m(e,null),w(e,r),w(e,n),w(n,i),w(i,a),w(a,o),w(a,u),w(a,c),w(i,f),w(i,d),w(d,h),w(d,p),w(d,b),w(i,g),w(i,D),w(D,v),w(D,C),w(D,I),w(i,F),w(i,T),w(T,N),w(T,j),w(T,R)},p(U,Z){U[1]?L?L.p(U,Z):(L=Wa(U),L.c(),L.m(e,t)):L&&(L.d(1),L=null),q===(q=y(U))&&ee?ee.p(U,Z):(ee.d(1),ee=q(U),ee&&(ee.c(),ee.m(e,r))),Z&1&&l!==(l=U[0].path+"")&&Ae(c,l),Z&1&&m!==(m=U[0].author+"")&&Ae(b,m),Z&1&&k!==(k=U[0].share+"")&&Ae(I,k),Z&1&&G!==(G=U[0].timestamp/1e3+"")&&Ae(R,G)},d(U){U&&B(e),L&&L.d(),ee.d()}}}function Wa(s){let e,t,r,n,i,a,o=s[0].path.split(".")[s[0].path.split(".").length-1]+"",u,l,c,f,d,h,p=s[0].attachmentSize/1e3+"",m,b;return{c(){e=A("table"),t=A("tr"),r=A("td"),r.textContent="Attachment type:",n=z(),i=A("td"),a=A("strong"),u=J(o),l=z(),c=A("tr"),f=A("td"),f.textContent="Attachment size:",d=z(),h=A("td"),m=J(p),b=J(" kb"),E(e,"class","my-4 svelte-1ob97v4")},m(g,D){S(g,e,D),w(e,t),w(t,r),w(t,n),w(t,i),w(i,a),w(a,u),w(e,l),w(e,c),w(c,f),w(c,d),w(c,h),w(h,m),w(c,b)},p(g,D){D&1&&o!==(o=g[0].path.split(".")[g[0].path.split(".").length-1]+"")&&Ae(u,o),D&1&&p!==(p=g[0].attachmentSize/1e3+"")&&Ae(m,p)},d(g){g&&B(e)}}}function om(s){let e,t=Za(s[0].text)+"";return{c(){e=A("div"),E(e,"class","my-4 break-words")},m(r,n){S(r,e,n),e.innerHTML=t},p(r,n){n&1&&t!==(t=Za(r[0].text)+"")&&(e.innerHTML=t)},d(r){r&&B(e)}}}function um(s){let e,t,r,n=s[5]&&Va(s);return{c(){e=A("div"),t=z(),n&&n.c(),r=Fe()},m(i,a){S(i,e,a),e.innerHTML=s[2],S(i,t,a),n&&n.m(i,a),S(i,r,a)},p(i,a){a&4&&(e.innerHTML=i[2]),i[5]?n?n.p(i,a):(n=Va(i),n.c(),n.m(r.parentNode,r)):n&&(n.d(1),n=null)},d(i){i&&B(e),i&&B(t),n&&n.d(i),i&&B(r)}}}function Va(s){let e,t=s[3],r=[];for(let n=0;n<t.length;n+=1)r[n]=Ka(Ha(s,t,n));return{c(){e=A("ul");for(let n=0;n<r.length;n+=1)r[n].c();E(e,"class","svelte-1ob97v4")},m(n,i){S(n,e,i);for(let a=0;a<r.length;a+=1)r[a].m(e,null)},p(n,i){if(i&8){t=n[3];let a;for(a=0;a<t.length;a+=1){const o=Ha(n,t,a);r[a]?r[a].p(o,i):(r[a]=Ka(o),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(n){n&&B(e),on(r,n)}}}function Ka(s){let e,t,r=s[8]+"",n;return{c(){e=A("li"),t=new mu(!1),n=z(),t.a=n,E(e,"class","svelte-1ob97v4")},m(i,a){S(i,e,a),t.m(r,e),w(e,n)},p(i,a){a&8&&r!==(r=i[8]+"")&&t.p(r)},d(i){i&&B(e)}}}function lm(s){let e,t,r,n,i;function a(c,f){return c[4]?am:sm}let o=a(s),u=o(s),l=s[4]&&qa(s);return{c(){e=A("div"),t=A("button"),u.c(),r=z(),l&&l.c(),E(e,"class","my-4 text-left svelte-1ob97v4")},m(c,f){S(c,e,f),w(e,t),u.m(t,null),w(e,r),l&&l.m(e,null),n||(i=fe(t,"click",s[7]),n=!0)},p(c,[f]){o!==(o=a(c))&&(u.d(1),u=o(c),u&&(u.c(),u.m(t,null))),c[4]?l?l.p(c,f):(l=qa(c),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i:X,o:X,d(c){c&&B(e),u.d(),l&&l.d(),n=!1,i()}}}function Za(s){var e=s.indexOf("#Title:"),t=s.indexOf("#Notes:");if(e!==-1&&t!==-1&&e<t){var r=s.substring(0,e),n=s.substring(t);return r+" "+n}return s}function cm(s,e,t){let{doc:r}=e,{attachment:n=!0}=e,{isReply:i=!1}=e,a=!1,o,u,l=!1;Ft(()=>{t(4,a=!0)});const c=()=>t(4,a=!a);return s.$$set=f=>{"doc"in f&&t(0,r=f.doc),"attachment"in f&&t(1,n=f.attachment),"isReply"in f&&t(6,i=f.isReply)},s.$$.update=()=>{s.$$.dirty&13&&r.text!==void 0&&r.text.includes("<br>")&&(t(3,u=r.text.split("<br>")),t(2,o=u.shift()),t(2,o),t(0,r),t(3,u),t(5,l=!0))},[r,n,o,u,a,l,i,c]}class vl extends ye{constructor(e){super(),ve(this,e,cm,lm,we,{doc:0,attachment:1,isReply:6})}}function fm(s){let e,t,r,n,i,a=!s[9]&&Qa(s),o=s[9]&&Ja(s);return{c(){e=A("div"),a&&a.c(),t=z(),o&&o.c(),E(e,"class","main svelte-tithd8"),ct(e,"replies",s[5]===!0)},m(u,l){S(u,e,l),a&&a.m(e,null),w(e,t),o&&o.m(e,null),r=!0,n||(i=[fe(e,"click",Ki(s[18])),fe(e,"keypress",Ki(s[19]))],n=!0)},p(u,l){u[9]?a&&(me(),M(a,1,1,()=>{a=null}),ge()):a?(a.p(u,l),l&512&&P(a,1)):(a=Qa(u),a.c(),P(a,1),a.m(e,t)),u[9]?o?(o.p(u,l),l&512&&P(o,1)):(o=Ja(u),o.c(),P(o,1),o.m(e,null)):o&&(me(),M(o,1,1,()=>{o=null}),ge()),(!r||l&32)&&ct(e,"replies",u[5]===!0)},i(u){r||(P(a),P(o),r=!0)},o(u){M(a),M(o),r=!1},d(u){u&&B(e),a&&a.d(),o&&o.d(),n=!1,je(i)}}}function hm(s){let e;return{c(){e=A("div"),E(e,"class","main disabled svelte-tithd8"),ct(e,"replies",s[5]===!0)},m(t,r){S(t,e,r)},p(t,r){r&32&&ct(e,"replies",t[5]===!0)},i:X,o:X,d(t){t&&B(e)}}}function Qa(s){let e,t,r,n,i,a,o=s[0]!==void 0&&Ga(s);return{c(){e=A("div"),t=A("p"),r=z(),o&&o.c(),E(t,"class","svelte-tithd8"),E(e,"class","flex flex-col svelte-tithd8")},m(u,l){S(u,e,l),w(e,t),w(e,r),o&&o.m(e,null),n=!0,i||(a=[fe(t,"click",s[13]),fe(t,"keypress",s[14])],i=!0)},p(u,l){u[0]!==void 0?o?(o.p(u,l),l&1&&P(o,1)):(o=Ga(u),o.c(),P(o,1),o.m(e,null)):o&&(me(),M(o,1,1,()=>{o=null}),ge())},i(u){n||(P(o),n=!0)},o(u){M(o),n=!1},d(u){u&&B(e),o&&o.d(),i=!1,je(a)}}}function Ga(s){let e,t,r,n,i=s[3]&&Ya(s);return{c(){e=A("div"),t=z(),i&&i.c(),r=Fe(),E(e,"class","svelte-tithd8")},m(a,o){S(a,e,o),e.innerHTML=s[0],S(a,t,o),i&&i.m(a,o),S(a,r,o),n=!0},p(a,o){(!n||o&1)&&(e.innerHTML=a[0]),a[3]?i?(i.p(a,o),o&8&&P(i,1)):(i=Ya(a),i.c(),P(i,1),i.m(r.parentNode,r)):i&&(me(),M(i,1,1,()=>{i=null}),ge())},i(a){n||(P(i),n=!0)},o(a){M(i),n=!1},d(a){a&&B(e),a&&B(t),i&&i.d(a),a&&B(r)}}}function Ya(s){let e,t,r;return t=new Ds({props:{doc:s[1],replies:"true"}}),{c(){e=A("div"),oe(t.$$.fragment),E(e,"class","svelte-tithd8")},m(n,i){S(n,e,i),ue(t,e,null),r=!0},p(n,i){const a={};i&2&&(a.doc=n[1]),t.$set(a)},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t)}}}function Ja(s){let e,t,r,n,i,a,o,u,l,c,f,d,h,p,m=s[3]&&Xa(s);l=new vl({props:{doc:s[1],attachment:s[3],isReply:s[5]}});let b=s[4]&&eo(s),g=!s[2]&&to(s);return{c(){e=A("div"),t=A("button"),r=A("img"),i=J(`
            Artifact`),a=z(),m&&m.c(),o=z(),u=A("div"),oe(l.$$.fragment),c=z(),b&&b.c(),f=z(),g&&g.c(),ze(r,"margin-bottom","-3px"),vt(r.src,n=s[11][s[8]])||E(r,"src",n),E(r,"alt","document icon"),E(r,"width",s[7]),E(r,"height",s[7]),E(r,"class","svelte-tithd8"),E(t,"class","svelte-tithd8"),E(u,"class","svelte-tithd8"),E(e,"class","flex svelte-tithd8")},m(D,v){S(D,e,v),w(e,t),w(t,r),w(t,i),w(e,a),m&&m.m(e,null),w(e,o),w(e,u),ue(l,u,null),w(e,c),b&&b.m(e,null),w(e,f),g&&g.m(e,null),d=!0,h||(p=[fe(t,"click",s[15]),fe(t,"keypress",Ki(s[16]))],h=!0)},p(D,v){(!d||v&256&&!vt(r.src,n=D[11][D[8]]))&&E(r,"src",n),(!d||v&128)&&E(r,"width",D[7]),(!d||v&128)&&E(r,"height",D[7]),D[3]?m?(m.p(D,v),v&8&&P(m,1)):(m=Xa(D),m.c(),P(m,1),m.m(e,o)):m&&(me(),M(m,1,1,()=>{m=null}),ge());const C={};v&2&&(C.doc=D[1]),v&8&&(C.attachment=D[3]),v&32&&(C.isReply=D[5]),l.$set(C),D[4]?b?(b.p(D,v),v&16&&P(b,1)):(b=eo(D),b.c(),P(b,1),b.m(e,f)):b&&(me(),M(b,1,1,()=>{b=null}),ge()),D[2]?g&&(me(),M(g,1,1,()=>{g=null}),ge()):g?(g.p(D,v),v&4&&P(g,1)):(g=to(D),g.c(),P(g,1),g.m(e,null))},i(D){d||(P(m),P(l.$$.fragment,D),P(b),P(g),d=!0)},o(D){M(m),M(l.$$.fragment,D),M(b),M(g),d=!1},d(D){D&&B(e),m&&m.d(),le(l),b&&b.d(),g&&g.d(),h=!1,je(p)}}}function Xa(s){let e,t,r;return t=new Ds({props:{doc:s[1],replies:"true"}}),{c(){e=A("div"),oe(t.$$.fragment),E(e,"class","svelte-tithd8")},m(n,i){S(n,e,i),ue(t,e,null),r=!0},p(n,i){const a={};i&2&&(a.doc=n[1]),t.$set(a)},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t)}}}function eo(s){let e,t,r;return t=new kl({props:{doc:s[1]}}),{c(){e=A("div"),oe(t.$$.fragment),E(e,"class","svelte-tithd8")},m(n,i){S(n,e,i),ue(t,e,null),r=!0},p(n,i){const a={};i&2&&(a.doc=n[1]),t.$set(a)},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t)}}}function to(s){let e,t,r;return t=new im({props:{doc:s[1]}}),t.$on("update",s[17]),{c(){e=A("div"),oe(t.$$.fragment),E(e,"class","svelte-tithd8")},m(n,i){S(n,e,i),ue(t,e,null),r=!0},p(n,i){const a={};i&2&&(a.doc=n[1]),t.$set(a)},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t)}}}function dm(s){let e,t,r,n;const i=[hm,fm],a=[];function o(u,l){return u[6]?0:1}return e=o(s),t=a[e]=i[e](s),{c(){t.c(),r=Fe()},m(u,l){a[e].m(u,l),S(u,r,l),n=!0},p(u,[l]){let c=e;e=o(u),e===c?a[e].p(u,l):(me(),M(a[c],1,1,()=>{a[c]=null}),ge(),t=a[e],t?t.p(u,l):(t=a[e]=i[e](u),t.c()),P(t,1),t.m(r.parentNode,r))},i(u){n||(P(t),n=!0)},o(u){M(t),n=!1},d(u){a[e].d(u),u&&B(r)}}}function pm(s,e,t){const r=bt();let n=["icons/mountain-phase-0-02.png","icons/mountain-phase-1-02.png","icons/mountain-phase-2-02.png","icons/mountain-phase-3-02.png","icons/mountain-phase-4-02.png","icons/mountain-phase-5-02.png","icons/mountain-phase-6-02.png","icons/mountain-phase-7-02.png","icons/mountain-phase-8-02.png"],i=!1,{doc:a}=e,{studio:o=!1}=e,{attachment:u=!0}=e,{reply:l=!0}=e,{title:c=void 0}=e,{isReply:f=!1}=e,{disabled:d=!1}=e,h=a.deleteAfter,p,m=24,b;const g=()=>{t(9,i=!i),r("click",a)},D=()=>t(9,i=!i),v=()=>t(9,i=!i),C=()=>t(9,i=!i);function k(T){Vn.call(this,s,T)}const I=()=>{r("click",a)},F=()=>t(9,i=!i);return s.$$set=T=>{"doc"in T&&t(1,a=T.doc),"studio"in T&&t(2,o=T.studio),"attachment"in T&&t(3,u=T.attachment),"reply"in T&&t(4,l=T.reply),"title"in T&&t(0,c=T.title),"isReply"in T&&t(5,f=T.isReply),"disabled"in T&&t(6,d=T.disabled)},s.$$.update=()=>{s.$$.dirty&258&&console.log(a.path+"phase "+b),s.$$.dirty&4131&&(c!==void 0&&c.includes("<br>")?(t(12,p=c.split("<br>")),t(0,c=p.shift()),t(0,c),t(12,p),t(1,a),t(5,f),console.log("content",p),t(7,m=p.length*2+12)):a.text.includes("<br>")?(t(12,p=a.text.split("<br>")),t(7,m=p.length*3+8)):f&&t(7,m=10)),s.$$.dirty&128&&console.log("reaction",m)},console.log("deletionTime"+h),t(8,b=Math.floor((h-Date.now())/(25488e8/9))%9),[c,a,o,u,l,f,d,m,b,i,r,n,p,g,D,v,C,k,I,F]}class Cl extends ye{constructor(e){super(),ve(this,e,pm,dm,we,{doc:1,studio:2,attachment:3,reply:4,title:0,isReply:5,disabled:6})}}function no(s,e,t){const r=s.slice();return r[0]=e[t],r}function mm(s){let e,t=[],r=new Map,n,i=s[1];const a=o=>o[0].signature;for(let o=0;o<i.length;o+=1){let u=no(s,i,o),l=a(u);r.set(l,t[o]=ro(l,u))}return{c(){e=A("ul");for(let o=0;o<t.length;o+=1)t[o].c();E(e,"class","svelte-zu5h6d")},m(o,u){S(o,e,u);for(let l=0;l<t.length;l+=1)t[l].m(e,null);n=!0},p(o,u){u&34&&(i=o[1],me(),t=xt(t,u,a,1,o,i,r,e,ar,ro,null,no),ge())},i(o){if(!n){for(let u=0;u<i.length;u+=1)P(t[u]);n=!0}},o(o){for(let u=0;u<t.length;u+=1)M(t[u]);n=!1},d(o){o&&B(e);for(let u=0;u<t.length;u+=1)t[u].d()}}}function gm(s){let e=s[4]()+"",t;return{c(){t=J(e)},m(r,n){S(r,t,n)},p:X,i:X,o:X,d(r){r&&B(t)}}}function bm(s){let e,t;return e=new Cl({props:{isReply:!0,title:s[0].text,doc:s[0],attachment:!1,reply:!1}}),e.$on("click",s[5]),e.$on("update",s[5]),{c(){oe(e.$$.fragment)},m(r,n){ue(e,r,n),t=!0},p(r,n){const i={};n&2&&(i.title=r[0].text),n&2&&(i.doc=r[0]),e.$set(i)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){M(e.$$.fragment,r),t=!1},d(r){le(e,r)}}}function Dm(s){let e,t;return e=new Cl({props:{isReply:!0,title:s[0].text,doc:s[0],attachment:!0,reply:!1}}),e.$on("click",s[5]),e.$on("update",s[5]),{c(){oe(e.$$.fragment)},m(r,n){ue(e,r,n),t=!0},p(r,n){const i={};n&2&&(i.title=r[0].text),n&2&&(i.doc=r[0]),e.$set(i)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){M(e.$$.fragment,r),t=!1},d(r){le(e,r)}}}function ro(s,e){let t,r,n,i,a,o,u;const l=[Dm,bm],c=[];function f(d,h){return h&2&&(r=null),r==null&&(r=!!d[0].text.includes("replied with voice")),r?0:1}return n=f(e,-1),i=c[n]=l[n](e),{key:s,first:null,c(){t=A("li"),i.c(),a=z(),E(t,"id",o=e[0].textHash),E(t,"class","svelte-zu5h6d"),this.first=t},m(d,h){S(d,t,h),c[n].m(t,null),w(t,a),u=!0},p(d,h){e=d;let p=n;n=f(e,h),n===p?c[n].p(e,h):(me(),M(c[p],1,1,()=>{c[p]=null}),ge(),i=c[n],i?i.p(e,h):(i=c[n]=l[n](e),i.c()),P(i,1),i.m(t,a)),(!u||h&2&&o!==(o=e[0].textHash))&&E(t,"id",o)},i(d){u||(P(i),u=!0)},o(d){M(i),u=!1},d(d){d&&B(t),c[n].d()}}}function _m(s){return{c:X,m:X,d:X}}function wm(s){let e;return{c(){e=A("p"),e.textContent="There are no replies yet.",E(e,"class","max-content svelte-zu5h6d")},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function ym(s){let e,t,r,n,i,a;const o=[gm,mm],u=[];function l(h,p){return h[1]===void 0?0:h[2]?1:-1}~(t=l(s))&&(r=u[t]=o[t](s));function c(h,p){return h[3]?wm:_m}let f=c(s),d=f(s);return{c(){e=A("div"),r&&r.c(),n=z(),i=A("div"),d.c()},m(h,p){S(h,e,p),~t&&u[t].m(e,null),S(h,n,p),S(h,i,p),d.m(i,null),a=!0},p(h,[p]){let m=t;t=l(h),t===m?~t&&u[t].p(h,p):(r&&(me(),M(u[m],1,1,()=>{u[m]=null}),ge()),~t?(r=u[t],r?r.p(h,p):(r=u[t]=o[t](h),r.c()),P(r,1),r.m(e,null)):r=null),f!==(f=c(h))&&(d.d(1),d=f(h),d&&(d.c(),d.m(i,null)))},i(h){a||(P(r),a=!0)},o(h){M(r),a=!1},d(h){h&&B(e),~t&&u[t].d(),h&&B(n),h&&B(i),d.d()}}}function vm(s,e,t){let r;He(s,Xn,c=>t(6,r=c));let{doc:n}=e,i=[],a=!0,o=!1;const u=async()=>{let c=n.path.split("!");t(1,i=await r.queryDocs({filter:{pathStartsWith:c[0]}})),t(1,i=i.filter(f=>f.path.split("/").length>6)),t(2,a=!0)};r.onCacheUpdated(()=>{u(),t(1,i)});function l(){setTimeout(()=>{u()},1e3)}return Ft(()=>{u()}),s.$$set=c=>{"doc"in c&&t(0,n=c.doc)},s.$$.update=()=>{s.$$.dirty&2&&t(1,i),s.$$.dirty&2&&(i.length>=1?(t(2,a=!0),t(3,o=!1)):t(3,o=!0))},[n,i,a,o,u,l]}class Cm extends ye{constructor(e){super(),ve(this,e,vm,ym,we,{doc:0})}}function Am(s){let e,t,r,n,i,a,o,u=s[0]!=="reply"&&io();function l(d,h){return d[2]?Fm:Em}let c=l(s),f=c(s);return{c(){e=A("div"),t=A("div"),u&&u.c(),r=z(),n=A("div"),i=A("button"),f.c(),E(i,"class","phase1 mt-6 svelte-1n9oqk8"),E(n,"class","mt-6 svelte-1n9oqk8"),E(t,"class","svelte-1n9oqk8"),E(e,"class","text-left svelte-1n9oqk8")},m(d,h){S(d,e,h),w(e,t),u&&u.m(t,null),w(t,r),w(t,n),w(n,i),f.m(i,null),a||(o=[fe(i,"click",s[10]),fe(i,"keypress",s[11])],a=!0)},p(d,h){d[0]!=="reply"?u||(u=io(),u.c(),u.m(t,r)):u&&(u.d(1),u=null),c!==(c=l(d))&&(f.d(1),f=c(d),f&&(f.c(),f.m(i,null)))},d(d){d&&B(e),u&&u.d(),f.d(),a=!1,je(o)}}}function km(s){let e,t,r,n,i,a,o,u,l,c,f,d,h,p,m,b,g=!s[1]&&so();return{c(){e=A("div"),t=A("h5"),t.textContent="Review your recording",r=z(),n=A("audio"),i=A("source"),o=J(`
            Your browser does not support the audio element.`),u=z(),g&&g.c(),l=z(),c=A("button"),c.textContent="Record again",f=z(),d=A("button"),h=J("Upload"),E(t,"class","m-2 svelte-1n9oqk8"),vt(i.src,a=s[3])||E(i,"src",a),E(i,"type","audio/ogg"),n.controls=!0,E(n,"class","my-6 mx-2 svelte-1n9oqk8"),E(c,"class","svelte-1n9oqk8"),d.disabled=p=!s[1],E(d,"class","svelte-1n9oqk8"),E(e,"class","text-left m-2 svelte-1n9oqk8")},m(D,v){S(D,e,v),w(e,t),w(e,r),w(e,n),w(n,i),w(n,o),w(e,u),g&&g.m(e,null),w(e,l),w(e,c),w(e,f),w(e,d),w(d,h),m||(b=[fe(c,"click",s[6]),fe(d,"click",s[5])],m=!0)},p(D,v){v&8&&!vt(i.src,a=D[3])&&E(i,"src",a),D[1]?g&&(g.d(1),g=null):g||(g=so(),g.c(),g.m(e,l)),v&2&&p!==(p=!D[1])&&(d.disabled=p)},d(D){D&&B(e),g&&g.d(),m=!1,je(b)}}}function io(s){let e,t,r;return{c(){e=A("h5"),e.textContent="Record your voice note",t=z(),r=A("div"),r.textContent="Click the button below to start recording. Click again to stop.",E(e,"class","m-2 svelte-1n9oqk8"),E(r,"class","svelte-1n9oqk8")},m(n,i){S(n,e,i),S(n,t,i),S(n,r,i)},d(n){n&&B(e),n&&B(t),n&&B(r)}}}function Em(s){let e;return{c(){e=J("Record audio")},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function Fm(s){let e;return{c(){e=J("Stop recording")},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function so(s){let e;return{c(){e=A("div"),e.textContent="The upload button is disabled because a title is required.",E(e,"class","svelte-1n9oqk8")},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function Sm(s){let e;function t(i,a){return i[3]?km:Am}let r=t(s),n=r(s);return{c(){n.c(),e=Fe()},m(i,a){n.m(i,a),S(i,e,a)},p(i,[a]){r===(r=t(i))&&n?n.p(i,a):(n.d(1),n=r(i),n&&(n.c(),n.m(e.parentNode,e)))},i:X,o:X,d(i){n.d(i),i&&B(e)}}}function Bm(s){return new Promise((e,t)=>{const r=new FileReader;r.onloadend=()=>e(r.result),r.onerror=t,r.readAsArrayBuffer(s)})}function Im(s,e,t){let r,n;He(s,Et,F=>t(17,r=F)),He(s,jt,F=>t(18,n=F));const i=bt();let a,o=[],u=null,l=!1,c=null,f=null,d=null,{xy:h=void 0}=e,{doc:p=void 0}=e,{title:m=void 0}=e,{notes:b=void 0}=e,{isValid:g=!0}=e;async function D(){if(l){u.stop();let F=u.mimeType;F===""&&(F="audio/ogg; codecs=opus"),console.log("mediaRecorder",u),console.log("mediaRecorder mime",u.mimeType),t(2,l=!1),u.ondataavailable=T=>o.push(T.data),await new Promise(T=>{u.onstop=function(){f=new Blob(o,{type:F}),t(3,c=URL.createObjectURL(f)),console.log("blob",f),T()}})}else{const F=await navigator.mediaDevices.getUserMedia({audio:!0});u=new MediaRecorder(F),u.start(),console.log("mediaRecorder",u),console.log("mediaRecorder mime",u.mimeType),console.log("recording"),t(2,l=!0)}}async function v(){b&&m?d="#Title: "+m+"#Notes: "+b:m?d="#Title: "+m:d="";let F=Date.now(),T=new Date().toLocaleString(),N=(Date.now()+25488e5)*1e3,j=u.mimeType;j===""&&(j="audio/ogg; codecs=opus");let R=j.split(";")[0].split("/")[1];const L=await Bm(f),y=new Uint8Array(L);console.log("mime",j);let q=r.address.slice(1,5);if(h!==void 0&&h!=="reply")a=await n.replica.set(r,{path:`/documents/${h[0]}/${h[1]}/${F}/!voice-note-by-${q}.${R}`,text:"Voice note shared by "+q+" on "+T+d,attachment:y,deleteAfter:N}),i("upload"),console.log("Upload Result: ",a),o=[];else if(h=="reply"){let ee=p.path.split("!");const U=await n.replica.set(r,{text:q+" replied with voice<br>Shared on "+T,path:ee[0]+F+"/!reply-by-"+q+"."+R,deleteAfter:p.deleteAfter,attachment:y});return console.log("result ",U),i("success"),U}}async function C(){t(3,c=null),o=[],await D()}const k=async()=>{D()},I=async()=>{D()};return s.$$set=F=>{"xy"in F&&t(0,h=F.xy),"doc"in F&&t(7,p=F.doc),"title"in F&&t(8,m=F.title),"notes"in F&&t(9,b=F.notes),"isValid"in F&&t(1,g=F.isValid)},s.$$.update=()=>{s.$$.dirty&768&&m&&b&&console.log("title and note",m,b)},[h,g,l,c,D,v,C,p,m,b,k,I]}class Al extends ye{constructor(e){super(),ve(this,e,Im,Sm,we,{xy:0,doc:7,title:8,notes:9,isValid:1})}}function ao(s){let e,t,r,n,i,a,o,u,l;return{c(){e=A("p"),t=A("textarea"),r=z(),n=A("p"),i=A("button"),a=J("Send Reply"),E(t,"class","my-2"),E(t,"placeholder",s[4]),ze(t,"width","100%"),i.disabled=o=s[5](s[1])},m(c,f){S(c,e,f),w(e,t),tt(t,s[1]),S(c,r,f),S(c,n,f),w(n,i),w(i,a),u||(l=[fe(t,"input",s[10]),fe(i,"click",s[7])],u=!0)},p(c,f){f&16&&E(t,"placeholder",c[4]),f&2&&tt(t,c[1]),f&2&&o!==(o=c[5](c[1]))&&(i.disabled=o)},d(c){c&&B(e),c&&B(r),c&&B(n),u=!1,je(l)}}}function oo(s){let e,t;return e=new Al({props:{xy:"reply",doc:s[0]}}),{c(){oe(e.$$.fragment)},m(r,n){ue(e,r,n),t=!0},p(r,n){const i={};n&1&&(i.doc=r[0]),e.$set(i)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){M(e.$$.fragment,r),t=!1},d(r){le(e,r)}}}function Tm(s){let e;return{c(){e=A("span"),e.textContent=`${s[6].kind}`},m(t,r){S(t,e,r)},p:X,d(t){t&&B(e)}}}function Rm(s){let e,t,r,n,i,a,o,u,l,c,f,d,h=s[2]&&ao(s),p=s[3]&&oo(s),m=s[6]&&Tm(s);return{c(){e=A("div"),t=A("div"),r=A("button"),r.textContent="Text reply",n=z(),i=A("button"),i.textContent="Voice reply",a=z(),h&&h.c(),o=z(),p&&p.c(),u=z(),l=A("p"),m&&m.c(),E(r,"class","mb-2")},m(b,g){S(b,e,g),w(e,t),w(t,r),w(t,n),w(t,i),w(e,a),h&&h.m(e,null),w(e,o),p&&p.m(e,null),w(e,u),w(e,l),m&&m.m(l,null),c=!0,f||(d=[fe(r,"click",s[8]),fe(i,"click",s[9])],f=!0)},p(b,[g]){b[2]?h?h.p(b,g):(h=ao(b),h.c(),h.m(e,o)):h&&(h.d(1),h=null),b[3]?p?(p.p(b,g),g&8&&P(p,1)):(p=oo(b),p.c(),P(p,1),p.m(e,u)):p&&(me(),M(p,1,1,()=>{p=null}),ge()),b[6]&&m.p(b,g)},i(b){c||(P(p),c=!0)},o(b){M(p),c=!1},d(b){b&&B(e),h&&h.d(),p&&p.d(),m&&m.d(),f=!1,je(d)}}}function xm(s,e,t){let r,n;He(s,Et,g=>t(12,r=g)),He(s,jt,g=>t(13,n=g));const i=bt();function a(g){return g==f}let o,u=!1,l=!1,c="",f="Type your reply here";c.length;async function d(){let g=r.address.slice(1,5),D=h.path.split("!"),v=h.deleteAfter,C=Date.now();const k=await n.replica.set(r,{text:g+" replied: "+c,path:D[0]+C+"/!reply-by-"+g,deleteAfter:v});return console.log("result ",k),i("success"),t(1,c=""),k}let{doc:h}=e;function p(){t(2,u=!u),t(3,l=!1)}function m(){t(2,u=!1),t(3,l=!l)}function b(){c=this.value,t(1,c),t(6,o)}return s.$$set=g=>{"doc"in g&&t(0,h=g.doc)},s.$$.update=()=>{s.$$.dirty&2&&c!==void 0&&c.length},console.log("result",o),[h,c,u,l,f,a,o,d,p,m,b]}class Pm extends ye{constructor(e){super(),ve(this,e,xm,Rm,we,{doc:0})}}function Om(s){let e,t,r,n,i,a;return r=new Cm({props:{doc:s[0]}}),r.$on("success",s[1]),i=new Pm({props:{doc:s[0]}}),i.$on("success",s[2]),{c(){e=A("div"),t=A("div"),oe(r.$$.fragment),n=z(),oe(i.$$.fragment),E(t,"class","replies mb-2 svelte-1gwlcd9")},m(o,u){S(o,e,u),w(e,t),ue(r,t,null),w(e,n),ue(i,e,null),a=!0},p(o,u){const l={};u&1&&(l.doc=o[0]),r.$set(l);const c={};u&1&&(c.doc=o[0]),i.$set(c)},i(o){a||(P(r.$$.fragment,o),P(i.$$.fragment,o),a=!0)},o(o){M(r.$$.fragment,o),M(i.$$.fragment,o),a=!1},d(o){o&&B(e),le(r),le(i)}}}function Nm(s){let e,t,r=Om(s);return{c(){r&&r.c(),e=Fe()},m(n,i){r&&r.m(n,i),S(n,e,i),t=!0},p(n,[i]){r.p(n,i)},i(n){t||(P(r),t=!0)},o(n){M(r),t=!1},d(n){r&&r.d(n),n&&B(e)}}}function Mm(s,e,t){let{doc:r}=e;function n(a){Vn.call(this,s,a)}function i(a){Vn.call(this,s,a)}return s.$$set=a=>{"doc"in a&&t(0,r=a.doc)},[r,n,i]}class kl extends ye{constructor(e){super(),ve(this,e,Mm,Nm,we,{doc:0})}}function uo(s){let e,t;return{c(){e=A("h4"),t=J(s[3]),E(e,"class","mt-12 p-2")},m(r,n){S(r,e,n),w(e,t)},p(r,n){n&8&&Ae(t,r[3])},d(r){r&&B(e)}}}function lo(s){let e,t,r;return t=new Ds({props:{doc:s[0],replies:"false"}}),{c(){e=A("div"),oe(t.$$.fragment),E(e,"class","attachmentbox svelte-1vj0bce")},m(n,i){S(n,e,i),ue(t,e,null),r=!0},p(n,i){const a={};i&1&&(a.doc=n[0]),t.$set(a)},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t)}}}function co(s){let e,t,r;return t=new kl({props:{doc:s[0]}}),{c(){e=A("div"),oe(t.$$.fragment),E(e,"class","mr-6")},m(n,i){S(n,e,i),ue(t,e,null),r=!0},p(n,i){const a={};i&1&&(a.doc=n[0]),t.$set(a)},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t)}}}function Lm(s){let e,t,r,n,i,a,o,u,l=s[3]&&uo(s),c=s[1]&&lo(s),f=s[2]&&co(s);return{c(){l&&l.c(),e=z(),t=A("div"),c&&c.c(),r=z(),f&&f.c(),n=z(),i=A("button"),i.textContent="close",E(t,"class","flex flex-row justify-between w-full"),E(i,"class","top-right svelte-1vj0bce")},m(d,h){l&&l.m(d,h),S(d,e,h),S(d,t,h),c&&c.m(t,null),w(t,r),f&&f.m(t,null),S(d,n,h),S(d,i,h),a=!0,o||(u=fe(i,"click",s[4]),o=!0)},p(d,[h]){d[3]?l?l.p(d,h):(l=uo(d),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),d[1]?c?(c.p(d,h),h&2&&P(c,1)):(c=lo(d),c.c(),P(c,1),c.m(t,r)):c&&(me(),M(c,1,1,()=>{c=null}),ge()),d[2]?f?(f.p(d,h),h&4&&P(f,1)):(f=co(d),f.c(),P(f,1),f.m(t,null)):f&&(me(),M(f,1,1,()=>{f=null}),ge())},i(d){a||(P(c),P(f),a=!0)},o(d){M(c),M(f),a=!1},d(d){l&&l.d(d),d&&B(e),d&&B(t),c&&c.d(),f&&f.d(),d&&B(n),d&&B(i),o=!1,u()}}}function zm(s,e,t){const r=bt();let{selectedDocument:n}=e,{attachment:i=!0}=e,{reply:a=!0}=e,o;function u(){r("close")}return s.$$set=l=>{"selectedDocument"in l&&t(0,n=l.selectedDocument),"attachment"in l&&t(1,i=l.attachment),"reply"in l&&t(2,a=l.reply)},s.$$.update=()=>{s.$$.dirty&1&&n&&(n.text.includes("#Title:")&&n.text.includes("#Notes:")?t(3,o=n.text.split("#Title:")[1].split("#Notes:")[0].trim()):t(3,o="")),s.$$.dirty&1&&console.log("selectedDocument in ArtifactView",n)},[n,i,a,o,u]}class $m extends ye{constructor(e){super(),ve(this,e,zm,Lm,we,{selectedDocument:0,attachment:1,reply:2})}}function jm(s){let e,t,r,n,i,a,o;return{c(){e=A("div"),t=A("img"),vt(t.src,r=s[3][s[5]])||E(t,"src",r),E(t,"alt",n="document icon, phase #"+s[1]),E(t,"class",i=Bs(s[2]?"small-icon":"")+" svelte-1agx8j1"),E(e,"class","svelte-1agx8j1")},m(u,l){S(u,e,l),w(e,t),a||(o=[fe(e,"click",s[4]),fe(e,"keypress",s[4])],a=!0)},p(u,l){l&8&&!vt(t.src,r=u[3][u[5]])&&E(t,"src",r),l&2&&n!==(n="document icon, phase #"+u[1])&&E(t,"alt",n),l&4&&i!==(i=Bs(u[2]?"small-icon":"")+" svelte-1agx8j1")&&E(t,"class",i)},d(u){u&&B(e),a=!1,je(o)}}}function Um(s){let e,t,r;return{c(){e=A("div"),t=A("img"),vt(t.src,r=s[3][s[5]])||E(t,"src",r),E(t,"alt","document icon"),ze(t,"filter","blur(1px)"),E(t,"class","svelte-1agx8j1"),E(e,"class","svelte-1agx8j1")},m(n,i){S(n,e,i),w(e,t)},p(n,i){i&8&&!vt(t.src,r=n[3][n[5]])&&E(t,"src",r)},d(n){n&&B(e)}}}function Hm(s){let e;function t(i,a){return i[0]?Um:jm}let r=t(s),n=r(s);return{c(){n.c(),e=Fe()},m(i,a){n.m(i,a),S(i,e,a)},p(i,[a]){r===(r=t(i))&&n?n.p(i,a):(n.d(1),n=r(i),n&&(n.c(),n.m(e.parentNode,e)))},i:X,o:X,d(i){n.d(i),i&&B(e)}}}function qm(s,e,t){const r=bt();let n=["icons/mountain-phase-0-02.png","icons/mountain-phase-1-02.png","icons/mountain-phase-2-02.png","icons/mountain-phase-3-02.png","icons/mountain-phase-4-02.png","icons/mountain-phase-5-02.png","icons/mountain-phase-6-02.png","icons/mountain-phase-7-02.png","icons/mountain-phase-8-02.png"],i=["icons/flower-phase-0-02.png","icons/flower-phase-1-02.png","icons/flower-phase-2-02.png","icons/flower-phase-3-02.png","icons/flower-phase-4-02.png","icons/flower-phase-5-02.png","icons/flower-phase-6-02.png","icons/flower-phase-7-02.png","icons/flower-phase-8-02.png"],{doc:a}=e,{disabled:o=!1}=e,{phase:u}=e,{replies:l=!1}=e,c,f=a.deleteAfter;function d(p){console.log("clicked"),r("click",p)}a.path.endsWith(".md")?c=n:c=i;let h=Math.floor((f-Date.now())/(25488e8/c.length))%c.length;return s.$$set=p=>{"doc"in p&&t(6,a=p.doc),"disabled"in p&&t(0,o=p.disabled),"phase"in p&&t(1,u=p.phase),"replies"in p&&t(2,l=p.replies)},[o,u,l,c,d,h,a]}class Ln extends ye{constructor(e){super(),ve(this,e,qm,Hm,we,{doc:6,disabled:0,phase:1,replies:2})}}function fo(s){let e;return{c(){e=A("div"),e.textContent="The upload button is disabled because a title is required.",E(e,"class","svelte-902auw")},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function ho(s){let e,t,r=s[1].kind+"",n;return{c(){e=A("p"),t=A("strong"),n=J(r)},m(i,a){S(i,e,a),w(e,t),w(t,n)},p(i,a){a&2&&r!==(r=i[1].kind+"")&&Ae(n,r)},d(i){i&&B(e)}}}function Wm(s){let e,t,r,n,i,a,o,u,l,c,f,d,h,p,m,b,g,D=!s[0]&&fo(),v=s[1]&&ho(s);return{c(){e=A("div"),t=A("div"),r=A("h5"),r.textContent="Upload a file",n=z(),i=A("div"),i.textContent="Start by entering your title and the optional note.",a=z(),o=A("div"),o.textContent="Once the file is selected, it will be automatically uploaded.",u=z(),D&&D.c(),l=z(),c=A("button"),f=J("file upload"),h=z(),p=A("input"),m=z(),v&&v.c(),E(r,"class","m-2"),E(i,"class","svelte-902auw"),E(o,"class","svelte-902auw"),E(c,"class","phase1 m-2 svelte-902auw"),c.disabled=d=!s[0],ze(p,"display","none"),E(p,"type","file"),E(p,"accept",".jpg, .jpeg, .png, .gif, .txt, .pdf, .md, .webm, .mp3, .ogg, .wav"),E(t,"class","text-left svelte-902auw"),E(e,"class","svelte-902auw")},m(C,k){S(C,e,k),w(e,t),w(t,r),w(t,n),w(t,i),w(t,a),w(t,o),w(t,u),D&&D.m(t,null),w(t,l),w(t,c),w(c,f),w(t,h),w(t,p),s[10](p),w(e,m),v&&v.m(e,null),b||(g=[fe(c,"click",s[7]),fe(c,"keypress",s[8]),fe(p,"change",s[9])],b=!0)},p(C,[k]){C[0]?D&&(D.d(1),D=null):D||(D=fo(),D.c(),D.m(t,l)),k&1&&d!==(d=!C[0])&&(c.disabled=d),C[1]?v?v.p(C,k):(v=ho(C),v.c(),v.m(e,null)):v&&(v.d(1),v=null)},i:X,o:X,d(C){C&&B(e),D&&D.d(),s[10](null),v&&v.d(),b=!1,je(g)}}}function Vm(s){return new Promise((e,t)=>{let r=new FileReader;r.onload=()=>{e(r.result),console.log("typeof",r.result)},r.onerror=t,r.readAsArrayBuffer(s)})}function Km(s,e,t){let r,n;He(s,Et,D=>t(13,r=D)),He(s,jt,D=>t(14,n=D));const i=bt();let{xy:a=[0,0]}=e,o,u,l,{title:c=void 0}=e,{notes:f=void 0}=e,{isValid:d=!0}=e;async function h(D){f&&c?l="#Title: "+c+"#Notes: "+f:c?l="#Title: "+c:l="";let v=D.target.files[0],k=v.name.replace(/\s+/g,"_").replace(/[@,\/#!$%\^&\*;:{}=\-`~()]/g,""),I=k.split(".").pop(),F=k.split(".")[k.split(".").length-2],T;(I==="JPG"||I==="jpg")&&(I="jpeg"),T=F+"."+I;let N=Date.now(),j=await Vm(v),G=(Date.now()+25488e5)*1e3,R=new Uint8Array(j);return t(1,u=await n.replica.set(r,{path:`/documents/${a[0]}/${a[1]}/${N}/!${T}`,text:"Shared by "+r.address.slice(1,5)+" on "+new Date().toLocaleString()+" "+l,attachment:R,deleteAfter:G})),console.log("Result: ",u),se(u)?(console.error(u),u.message):(console.log("Success!"),i("upload")),u}const p=()=>{o.click()},m=()=>{o.click()},b=D=>h(D);function g(D){pi[D?"unshift":"push"](()=>{o=D,t(2,o)})}return s.$$set=D=>{"xy"in D&&t(4,a=D.xy),"title"in D&&t(5,c=D.title),"notes"in D&&t(6,f=D.notes),"isValid"in D&&t(0,d=D.isValid)},s.$$.update=()=>{s.$$.dirty&2&&t(1,u)},[d,u,o,h,a,c,f,p,m,b,g]}class Zm extends ye{constructor(e){super(),ve(this,e,Km,Wm,we,{xy:4,title:5,notes:6,isValid:0})}}function Qm(s){let e,t;return e=new Zm({props:{xy:s[1],title:s[2],notes:s[5],isValid:s[3]}}),e.$on("upload",s[8]),{c(){oe(e.$$.fragment)},m(r,n){ue(e,r,n),t=!0},p(r,n){const i={};n&2&&(i.xy=r[1]),n&4&&(i.title=r[2]),n&32&&(i.notes=r[5]),n&8&&(i.isValid=r[3]),e.$set(i)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){M(e.$$.fragment,r),t=!1},d(r){le(e,r)}}}function Gm(s){let e,t;return e=new Al({props:{xy:s[1],title:s[2],notes:s[5],isValid:s[3]}}),e.$on("upload",s[8]),{c(){oe(e.$$.fragment)},m(r,n){ue(e,r,n),t=!0},p(r,n){const i={};n&2&&(i.xy=r[1]),n&4&&(i.title=r[2]),n&32&&(i.notes=r[5]),n&8&&(i.isValid=r[3]),e.$set(i)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){M(e.$$.fragment,r),t=!1},d(r){le(e,r)}}}function Ym(s){let e,t,r;return{c(){e=A("textarea"),E(e,"id","mainInput"),E(e,"placeholder","Enter text"),E(e,"class","svelte-xye4z5")},m(n,i){S(n,e,i),tt(e,s[4]),t||(r=fe(e,"input",s[11]),t=!0)},p(n,i){i&16&&tt(e,n[4])},i:X,o:X,d(n){n&&B(e),t=!1,r()}}}function po(s){let e,t,r,n,i,a,o=!s[3]&&mo();return{c(){o&&o.c(),e=z(),t=A("button"),r=J("Submit"),E(t,"class","phase1 svelte-xye4z5"),t.disabled=n=!s[3]},m(u,l){o&&o.m(u,l),S(u,e,l),S(u,t,l),w(t,r),i||(a=fe(t,"click",s[7]),i=!0)},p(u,l){u[3]?o&&(o.d(1),o=null):o||(o=mo(),o.c(),o.m(e.parentNode,e)),l&8&&n!==(n=!u[3])&&(t.disabled=n)},d(u){o&&o.d(u),u&&B(e),u&&B(t),i=!1,a()}}}function mo(s){let e;return{c(){e=A("div"),e.textContent="Title is required."},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function Jm(s){let e,t,r,n,i,a,o,u,l,c,f,d,h,p,m,b,g,D,v,C,k,I,F,T;const N=[Ym,Gm,Qm],j=[];function G(L,y){return L[0]==="text"?0:L[0]==="audio"?1:L[0]==="file"?2:-1}~(d=G(s))&&(h=j[d]=N[d](s));let R=s[0]==="text"&&po(s);return{c(){e=A("div"),t=A("div"),r=A("div"),n=A("div"),i=A("button"),i.textContent="Close",a=z(),o=A("div"),u=A("input"),l=z(),c=A("div"),f=A("div"),h&&h.c(),p=z(),m=A("div"),b=A("h5"),b.textContent="Notes",g=z(),D=A("input"),v=z(),C=A("div"),k=A("div"),R&&R.c(),E(i,"class","close-button svelte-xye4z5"),E(u,"id","titleInput"),E(u,"class","align-left my-2 svelte-xye4z5"),E(u,"type","text"),E(u,"placeholder","Enter a title (required)"),E(o,"class","flex flex-row justify-start"),E(f,"class","flex flex-col w-[50vw] items-start"),E(b,"class","text-left"),E(D,"type","text"),E(D,"placeholder","Enter optional notes"),E(m,"class","pr-6"),E(c,"class","flex flex-row justify-between"),E(k,"class","flex flex-col"),E(C,"class","flex flex-row justify-end my-6"),E(n,"class","p-6 w-full h-full bg-white"),E(r,"class","h-[80vh] w-full"),ze(t,"position","relative"),ze(t,"z-index","52"),ze(e,"position","fixed"),ze(e,"width","79vw")},m(L,y){S(L,e,y),w(e,t),w(t,r),w(r,n),w(n,i),w(n,a),w(n,o),w(o,u),tt(u,s[2]),w(n,l),w(n,c),w(c,f),~d&&j[d].m(f,null),w(c,p),w(c,m),w(m,b),w(m,g),w(m,D),tt(D,s[5]),w(n,v),w(n,C),w(C,k),R&&R.m(k,null),I=!0,F||(T=[fe(i,"click",s[9]),fe(u,"input",s[10]),fe(D,"input",s[12])],F=!0)},p(L,[y]){y&4&&u.value!==L[2]&&tt(u,L[2]);let q=d;d=G(L),d===q?~d&&j[d].p(L,y):(h&&(me(),M(j[q],1,1,()=>{j[q]=null}),ge()),~d?(h=j[d],h?h.p(L,y):(h=j[d]=N[d](L),h.c()),P(h,1),h.m(f,null)):h=null),y&32&&D.value!==L[5]&&tt(D,L[5]),L[0]==="text"?R?R.p(L,y):(R=po(L),R.c(),R.m(k,null)):R&&(R.d(1),R=null)},i(L){I||(P(h),I=!0)},o(L){M(h),I=!1},d(L){L&&B(e),~d&&j[d].d(),R&&R.d(),F=!1,je(T)}}}function Xm(s,e,t){let r,n;He(s,Et,I=>t(15,r=I)),He(s,jt,I=>t(16,n=I));let{filetype:i}=e,{xy:a=[0,0]}=e,o,u="",l="",c,f,d=!0,h=Date.now(),p=(Date.now()+25488e5)*1e3;const m=bt();async function b(){let F=await new Blob([o],{type:"text/markdown"}).arrayBuffer(),T=new Uint8Array(F),N=r.address.slice(1,5);return l?c="#Title: "+u+"#Notes: "+l:c="#Title: "+u,f=await n.replica.set(r,{path:`/documents/${a[0]}/${a[1]}/${h}/!text-input-by-${N}.md`,text:"Text input by "+r.address.slice(1,5)+" on "+new Date().toLocaleString()+c,attachment:T,deleteAfter:p}),console.log("Result: ",f),se(f)&&console.error(f),m("success"),f}function g(I){console.log("event in Upload.svelte",I),m("success")}const D=()=>m("close");function v(){u=this.value,t(2,u)}function C(){o=this.value,t(4,o)}function k(){l=this.value,t(5,l)}return s.$$set=I=>{"filetype"in I&&t(0,i=I.filetype),"xy"in I&&t(1,a=I.xy)},s.$$.update=()=>{s.$$.dirty&4&&(u&&u.trim()!==""?t(3,d=!0):t(3,d=!1)),s.$$.dirty&8&&console.log("isValid",d),s.$$.dirty&1&&console.log("filetype in Upload.svelte",i),s.$$.dirty&1&&console.log("filetype in Upload.svelte",i)},[i,a,u,d,o,l,m,b,g,D,v,C,k]}class e1 extends ye{constructor(e){super(),ve(this,e,Xm,Jm,we,{filetype:0,xy:1})}}function t1(s){let e,t,r;return t=new Ln({props:{doc:s[0],phase:s[1]%9,replies:n1}}),{c(){e=A("div"),oe(t.$$.fragment),E(e,"class","icon-container svelte-1p6jdr4")},m(n,i){S(n,e,i),ue(t,e,null),s[4](e),r=!0},p(n,[i]){const a={};i&1&&(a.doc=n[0]),i&2&&(a.phase=n[1]%9),t.$set(a)},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t),s[4](null)}}}let n1=!0;function r1(s,e,t){let{doc:r}=e,{index:n}=e,{orbitDiameter:i}=e,a;Ft(()=>{let u=Math.random()*360;const l=1.2;function c(){if(a){u+=l;const f=u*Math.PI/180,d=i/4-n*19,h=Math.cos(f)*d,p=Math.sin(f)*d;t(2,a.style.transform=`translate(${h}px, ${p}px)`,a),requestAnimationFrame(c)}}c()});function o(u){pi[u?"unshift":"push"](()=>{a=u,t(2,a)})}return s.$$set=u=>{"doc"in u&&t(0,r=u.doc),"index"in u&&t(1,n=u.index),"orbitDiameter"in u&&t(3,i=u.orbitDiameter)},[r,n,a,i,o]}class i1 extends ye{constructor(e){super(),ve(this,e,r1,t1,we,{doc:0,index:1,orbitDiameter:3})}}function go(s,e,t){const r=s.slice();return r[5]=e[t],r[7]=t,r}function bo(s,e){let t,r,n;return r=new i1({props:{doc:e[0],index:e[7],orbitDiameter:ts}}),{key:s,first:null,c(){t=Fe(),oe(r.$$.fragment),this.first=t},m(i,a){S(i,t,a),ue(r,i,a),n=!0},p(i,a){e=i;const o={};a&1&&(o.doc=e[0]),a&4&&(o.index=e[7]),r.$set(o)},i(i){n||(P(r.$$.fragment,i),n=!0)},o(i){M(r.$$.fragment,i),n=!1},d(i){i&&B(t),le(r,i)}}}function s1(s){let e,t=[],r=new Map,n,i=s[2];const a=o=>o[5].textHash+o[5].timestamp;for(let o=0;o<i.length;o+=1){let u=go(s,i,o),l=a(u);r.set(l,t[o]=bo(l,u))}return{c(){e=A("div");for(let o=0;o<t.length;o+=1)t[o].c();E(e,"id","circle-orbit-container"),ze(e,"height",ts+"px"),ze(e,"width",ts+"px"),E(e,"class","svelte-1018vin"),ct(e,"disabled",s[1])},m(o,u){S(o,e,u);for(let l=0;l<t.length;l+=1)t[l].m(e,null);n=!0},p(o,[u]){u&5&&(i=o[2],me(),t=xt(t,u,a,1,o,i,r,e,ar,bo,null,go),ge()),(!n||u&2)&&ct(e,"disabled",o[1])},i(o){if(!n){for(let u=0;u<i.length;u+=1)P(t[u]);n=!0}},o(o){for(let u=0;u<t.length;u+=1)M(t[u]);n=!1},d(o){o&&B(e);for(let u=0;u<t.length;u+=1)t[u].d()}}}const ts=160;function a1(s,e,t){let r;He(s,Xn,u=>t(3,r=u));let{doc:n=null}=e,{disabled:i=!1}=e,a=[];const o=async()=>{const u=n.path.split("/");u.pop();const l=u.join("/");let c=await r.queryDocs({filter:{pathStartsWith:l}});t(2,a=c.slice(1))};return Ft(o),s.$$set=u=>{"doc"in u&&t(0,n=u.doc),"disabled"in u&&t(1,i=u.disabled)},s.$$.update=()=>{s.$$.dirty&1&&n&&o()},[n,i,a]}class hr extends ye{constructor(e){super(),ve(this,e,a1,s1,we,{doc:0,disabled:1})}}function Xr(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var El={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(s,e){(function(t){s.exports=t()})(function(){return function t(r,n,i){function a(l,c){if(!n[l]){if(!r[l]){var f=typeof Xr=="function"&&Xr;if(!c&&f)return f(l,!0);if(o)return o(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=n[l]={exports:{}};r[l][0].call(h.exports,function(p){var m=r[l][1][p];return a(m||p)},h,h.exports,t,r,n,i)}return n[l].exports}for(var o=typeof Xr=="function"&&Xr,u=0;u<i.length;u++)a(i[u]);return a}({1:[function(t,r,n){var i=t("./utils"),a=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(u){for(var l,c,f,d,h,p,m,b=[],g=0,D=u.length,v=D,C=i.getTypeOf(u)!=="string";g<u.length;)v=D-g,f=C?(l=u[g++],c=g<D?u[g++]:0,g<D?u[g++]:0):(l=u.charCodeAt(g++),c=g<D?u.charCodeAt(g++):0,g<D?u.charCodeAt(g++):0),d=l>>2,h=(3&l)<<4|c>>4,p=1<v?(15&c)<<2|f>>6:64,m=2<v?63&f:64,b.push(o.charAt(d)+o.charAt(h)+o.charAt(p)+o.charAt(m));return b.join("")},n.decode=function(u){var l,c,f,d,h,p,m=0,b=0,g="data:";if(u.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var D,v=3*(u=u.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(u.charAt(u.length-1)===o.charAt(64)&&v--,u.charAt(u.length-2)===o.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(D=a.uint8array?new Uint8Array(0|v):new Array(0|v);m<u.length;)l=o.indexOf(u.charAt(m++))<<2|(d=o.indexOf(u.charAt(m++)))>>4,c=(15&d)<<4|(h=o.indexOf(u.charAt(m++)))>>2,f=(3&h)<<6|(p=o.indexOf(u.charAt(m++))),D[b++]=l,h!==64&&(D[b++]=c),p!==64&&(D[b++]=f);return D}},{"./support":30,"./utils":32}],2:[function(t,r,n){var i=t("./external"),a=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),u=t("./stream/DataLengthProbe");function l(c,f,d,h,p){this.compressedSize=c,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=p}l.prototype={getContentWorker:function(){var c=new a(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new u("data_length")),f=this;return c.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new a(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(c,f,d){return c.pipe(new o).pipe(new u("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new u("compressedSize")).withStreamInfo("compression",f)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,r,n){var i=t("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,r,n){var i=t("./utils"),a=function(){for(var o,u=[],l=0;l<256;l++){o=l;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;u[l]=o}return u}();r.exports=function(o,u){return o!==void 0&&o.length?i.getTypeOf(o)!=="string"?function(l,c,f,d){var h=a,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^c[m])];return-1^l}(0|u,o,o.length,0):function(l,c,f,d){var h=a,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^c.charCodeAt(m))];return-1^l}(0|u,o,o.length,0):0}},{"./utils":32}],5:[function(t,r,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,r,n){var i=null;i=typeof Promise<"u"?Promise:t("lie"),r.exports={Promise:i}},{lie:37}],7:[function(t,r,n){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=t("pako"),o=t("./utils"),u=t("./stream/GenericWorker"),l=i?"uint8array":"array";function c(f,d){u.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}n.magic="\b\0",o.inherits(c,u),c.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(l,f.data),!1)},c.prototype.flush=function(){u.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){u.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},n.compressWorker=function(f){return new c("Deflate",f)},n.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,r,n){function i(h,p){var m,b="";for(m=0;m<p;m++)b+=String.fromCharCode(255&h),h>>>=8;return b}function a(h,p,m,b,g,D){var v,C,k=h.file,I=h.compression,F=D!==l.utf8encode,T=o.transformTo("string",D(k.name)),N=o.transformTo("string",l.utf8encode(k.name)),j=k.comment,G=o.transformTo("string",D(j)),R=o.transformTo("string",l.utf8encode(j)),L=N.length!==k.name.length,y=R.length!==j.length,q="",ee="",U="",Z=k.dir,Q=k.date,be={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(be.crc32=h.crc32,be.compressedSize=h.compressedSize,be.uncompressedSize=h.uncompressedSize);var W=0;p&&(W|=8),F||!L&&!y||(W|=2048);var H=0,pe=0;Z&&(H|=16),g==="UNIX"?(pe=798,H|=function(he,Ke){var ut=he;return he||(ut=Ke?16893:33204),(65535&ut)<<16}(k.unixPermissions,Z)):(pe=20,H|=function(he){return 63&(he||0)}(k.dosPermissions)),v=Q.getUTCHours(),v<<=6,v|=Q.getUTCMinutes(),v<<=5,v|=Q.getUTCSeconds()/2,C=Q.getUTCFullYear()-1980,C<<=4,C|=Q.getUTCMonth()+1,C<<=5,C|=Q.getUTCDate(),L&&(ee=i(1,1)+i(c(T),4)+N,q+="up"+i(ee.length,2)+ee),y&&(U=i(1,1)+i(c(G),4)+R,q+="uc"+i(U.length,2)+U);var de="";return de+=`
\0`,de+=i(W,2),de+=I.magic,de+=i(v,2),de+=i(C,2),de+=i(be.crc32,4),de+=i(be.compressedSize,4),de+=i(be.uncompressedSize,4),de+=i(T.length,2),de+=i(q.length,2),{fileRecord:f.LOCAL_FILE_HEADER+de+T+q,dirRecord:f.CENTRAL_FILE_HEADER+i(pe,2)+de+i(G.length,2)+"\0\0\0\0"+i(H,4)+i(b,4)+T+q+G}}var o=t("../utils"),u=t("../stream/GenericWorker"),l=t("../utf8"),c=t("../crc32"),f=t("../signature");function d(h,p,m,b){u.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=b,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(d,u),d.prototype.push=function(h){var p=h.meta.percent||0,m=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,u.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-b-1))/m:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var p=this.streamFiles&&!h.file.dir;if(p){var m=a(h,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var p=this.streamFiles&&!h.file.dir,m=a(h,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(b){return f.DATA_DESCRIPTOR+i(b.crc32,4)+i(b.compressedSize,4)+i(b.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-h,b=function(g,D,v,C,k){var I=o.transformTo("string",k(C));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(g,2)+i(g,2)+i(D,4)+i(v,4)+i(I.length,2)+I}(this.dirRecords.length,m,h,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var p=this;return h.on("data",function(m){p.processChunk(m)}),h.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),h.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var p=this._sources;if(!u.prototype.error.call(this,h))return!1;for(var m=0;m<p.length;m++)try{p[m].error(h)}catch{}return!0},d.prototype.lock=function(){u.prototype.lock.call(this);for(var h=this._sources,p=0;p<h.length;p++)h[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,r,n){var i=t("../compressions"),a=t("./ZipFileWorker");n.generateWorker=function(o,u,l){var c=new a(u.streamFiles,l,u.platform,u.encodeFileName),f=0;try{o.forEach(function(d,h){f++;var p=function(D,v){var C=D||v,k=i[C];if(!k)throw new Error(C+" is not a valid compression method !");return k}(h.options.compression,u.compression),m=h.options.compressionOptions||u.compressionOptions||{},b=h.dir,g=h.date;h._compressWorker(p,m).withStreamInfo("file",{name:d,dir:b,date:g,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(c)}),c.entriesCount=f}catch(d){c.error(d)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,r,n){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new i;for(var o in this)typeof this[o]!="function"&&(a[o]=this[o]);return a}}(i.prototype=t("./object")).loadAsync=t("./load"),i.support=t("./support"),i.defaults=t("./defaults"),i.version="3.10.1",i.loadAsync=function(a,o){return new i().loadAsync(a,o)},i.external=t("./external"),r.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,r,n){var i=t("./utils"),a=t("./external"),o=t("./utf8"),u=t("./zipEntries"),l=t("./stream/Crc32Probe"),c=t("./nodejsUtils");function f(d){return new a.Promise(function(h,p){var m=d.decompressed.getContentWorker().pipe(new l);m.on("error",function(b){p(b)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(d,h){var p=this;return h=i.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(d)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(m){var b=new u(h);return b.load(m),b}).then(function(m){var b=[a.Promise.resolve(m)],g=m.files;if(h.checkCRC32)for(var D=0;D<g.length;D++)b.push(f(g[D]));return a.Promise.all(b)}).then(function(m){for(var b=m.shift(),g=b.files,D=0;D<g.length;D++){var v=g[D],C=v.fileNameStr,k=i.resolve(v.fileNameStr);p.file(k,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:h.createFolders}),v.dir||(p.file(k).unsafeOriginalName=C)}return b.zipComment.length&&(p.comment=b.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,r,n){var i=t("../utils"),a=t("../stream/GenericWorker");function o(u,l){a.call(this,"Nodejs stream input adapter for "+u),this._upstreamEnded=!1,this._bindStream(l)}i.inherits(o,a),o.prototype._bindStream=function(u){var l=this;(this._stream=u).pause(),u.on("data",function(c){l.push({data:c,meta:{percent:0}})}).on("error",function(c){l.isPaused?this.generatedError=c:l.error(c)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},o.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,r,n){var i=t("readable-stream").Readable;function a(o,u,l){i.call(this,u),this._helper=o;var c=this;o.on("data",function(f,d){c.push(f)||c._helper.pause(),l&&l(d)}).on("error",function(f){c.emit("error",f)}).on("end",function(){c.push(null)})}t("../utils").inherits(a,i),a.prototype._read=function(){this._helper.resume()},r.exports=a},{"../utils":32,"readable-stream":16}],14:[function(t,r,n){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,a);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,a)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var a=new Buffer(i);return a.fill(0),a},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(t,r,n){function i(k,I,F){var T,N=o.getTypeOf(I),j=o.extend(F||{},c);j.date=j.date||new Date,j.compression!==null&&(j.compression=j.compression.toUpperCase()),typeof j.unixPermissions=="string"&&(j.unixPermissions=parseInt(j.unixPermissions,8)),j.unixPermissions&&16384&j.unixPermissions&&(j.dir=!0),j.dosPermissions&&16&j.dosPermissions&&(j.dir=!0),j.dir&&(k=g(k)),j.createFolders&&(T=b(k))&&D.call(this,T,!0);var G=N==="string"&&j.binary===!1&&j.base64===!1;F&&F.binary!==void 0||(j.binary=!G),(I instanceof f&&I.uncompressedSize===0||j.dir||!I||I.length===0)&&(j.base64=!1,j.binary=!0,I="",j.compression="STORE",N="string");var R=null;R=I instanceof f||I instanceof u?I:p.isNode&&p.isStream(I)?new m(k,I):o.prepareContent(k,I,j.binary,j.optimizedBinaryString,j.base64);var L=new d(k,R,j);this.files[k]=L}var a=t("./utf8"),o=t("./utils"),u=t("./stream/GenericWorker"),l=t("./stream/StreamHelper"),c=t("./defaults"),f=t("./compressedObject"),d=t("./zipObject"),h=t("./generate"),p=t("./nodejsUtils"),m=t("./nodejs/NodejsStreamInputAdapter"),b=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var I=k.lastIndexOf("/");return 0<I?k.substring(0,I):""},g=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},D=function(k,I){return I=I!==void 0?I:c.createFolders,k=g(k),this.files[k]||i.call(this,k,null,{dir:!0,createFolders:I}),this.files[k]};function v(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var C={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var I,F,T;for(I in this.files)T=this.files[I],(F=I.slice(this.root.length,I.length))&&I.slice(0,this.root.length)===this.root&&k(F,T)},filter:function(k){var I=[];return this.forEach(function(F,T){k(F,T)&&I.push(T)}),I},file:function(k,I,F){if(arguments.length!==1)return k=this.root+k,i.call(this,k,I,F),this;if(v(k)){var T=k;return this.filter(function(j,G){return!G.dir&&T.test(j)})}var N=this.files[this.root+k];return N&&!N.dir?N:null},folder:function(k){if(!k)return this;if(v(k))return this.filter(function(N,j){return j.dir&&k.test(N)});var I=this.root+k,F=D.call(this,I),T=this.clone();return T.root=F.name,T},remove:function(k){k=this.root+k;var I=this.files[k];if(I||(k.slice(-1)!=="/"&&(k+="/"),I=this.files[k]),I&&!I.dir)delete this.files[k];else for(var F=this.filter(function(N,j){return j.name.slice(0,k.length)===k}),T=0;T<F.length;T++)delete this.files[F[T].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var I,F={};try{if((F=o.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=F.type.toLowerCase(),F.compression=F.compression.toUpperCase(),F.type==="binarystring"&&(F.type="string"),!F.type)throw new Error("No output type specified.");o.checkSupport(F.type),F.platform!=="darwin"&&F.platform!=="freebsd"&&F.platform!=="linux"&&F.platform!=="sunos"||(F.platform="UNIX"),F.platform==="win32"&&(F.platform="DOS");var T=F.comment||this.comment||"";I=h.generateWorker(this,F,T)}catch(N){(I=new u("error")).error(N)}return new l(I,F.type||"string",F.mimeType)},generateAsync:function(k,I){return this.generateInternalStream(k).accumulate(I)},generateNodeStream:function(k,I){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(I)}};r.exports=C},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,r,n){r.exports=t("stream")},{stream:void 0}],17:[function(t,r,n){var i=t("./DataReader");function a(o){i.call(this,o);for(var u=0;u<this.data.length;u++)o[u]=255&o[u]}t("../utils").inherits(a,i),a.prototype.byteAt=function(o){return this.data[this.zero+o]},a.prototype.lastIndexOfSignature=function(o){for(var u=o.charCodeAt(0),l=o.charCodeAt(1),c=o.charCodeAt(2),f=o.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===u&&this.data[d+1]===l&&this.data[d+2]===c&&this.data[d+3]===f)return d-this.zero;return-1},a.prototype.readAndCheckSignature=function(o){var u=o.charCodeAt(0),l=o.charCodeAt(1),c=o.charCodeAt(2),f=o.charCodeAt(3),d=this.readData(4);return u===d[0]&&l===d[1]&&c===d[2]&&f===d[3]},a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var u=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,u},r.exports=a},{"../utils":32,"./DataReader":18}],18:[function(t,r,n){var i=t("../utils");function a(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var u,l=0;for(this.checkOffset(o),u=this.index+o-1;u>=this.index;u--)l=(l<<8)+this.byteAt(u);return this.index+=o,l},readString:function(o){return i.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},r.exports=a},{"../utils":32}],19:[function(t,r,n){var i=t("./Uint8ArrayReader");function a(o){i.call(this,o)}t("../utils").inherits(a,i),a.prototype.readData=function(o){this.checkOffset(o);var u=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,u},r.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,r,n){var i=t("./DataReader");function a(o){i.call(this,o)}t("../utils").inherits(a,i),a.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},a.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},a.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},a.prototype.readData=function(o){this.checkOffset(o);var u=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,u},r.exports=a},{"../utils":32,"./DataReader":18}],21:[function(t,r,n){var i=t("./ArrayReader");function a(o){i.call(this,o)}t("../utils").inherits(a,i),a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var u=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,u},r.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(t,r,n){var i=t("../utils"),a=t("../support"),o=t("./ArrayReader"),u=t("./StringReader"),l=t("./NodeBufferReader"),c=t("./Uint8ArrayReader");r.exports=function(f){var d=i.getTypeOf(f);return i.checkSupport(d),d!=="string"||a.uint8array?d==="nodebuffer"?new l(f):a.uint8array?new c(i.transformTo("uint8array",f)):new o(i.transformTo("array",f)):new u(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,r,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,r,n){var i=t("./GenericWorker"),a=t("../utils");function o(u){i.call(this,"ConvertWorker to "+u),this.destType=u}a.inherits(o,i),o.prototype.processChunk=function(u){this.push({data:a.transformTo(this.destType,u.data),meta:u.meta})},r.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,r,n){var i=t("./GenericWorker"),a=t("../crc32");function o(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,i),o.prototype.processChunk=function(u){this.streamInfo.crc32=a(u.data,this.streamInfo.crc32||0),this.push(u)},r.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,r,n){var i=t("../utils"),a=t("./GenericWorker");function o(u){a.call(this,"DataLengthProbe for "+u),this.propName=u,this.withStreamInfo(u,0)}i.inherits(o,a),o.prototype.processChunk=function(u){if(u){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+u.data.length}a.prototype.processChunk.call(this,u)},r.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,r,n){var i=t("../utils"),a=t("./GenericWorker");function o(u){a.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,u.then(function(c){l.dataIsReady=!0,l.data=c,l.max=c&&c.length||0,l.type=i.getTypeOf(c),l.isPaused||l._tickAndRepeat()},function(c){l.error(c)})}i.inherits(o,a),o.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var u=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":u=this.data.substring(this.index,l);break;case"uint8array":u=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":u=this.data.slice(this.index,l)}return this.index=l,this.push({data:u,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,r,n){function i(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,o){return this._listeners[a].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,o){if(this._listeners[a])for(var u=0;u<this._listeners[a].length;u++)this._listeners[a][u].call(this,o)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var o=this;return a.on("data",function(u){o.processChunk(u)}),a.on("end",function(){o.end()}),a.on("error",function(u){o.error(u)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,o){return this.extraStreamInfo[a]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},r.exports=i},{}],29:[function(t,r,n){var i=t("../utils"),a=t("./ConvertWorker"),o=t("./GenericWorker"),u=t("../base64"),l=t("../support"),c=t("../external"),f=null;if(l.nodestream)try{f=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new c.Promise(function(b,g){var D=[],v=p._internalType,C=p._outputType,k=p._mimeType;p.on("data",function(I,F){D.push(I),m&&m(F)}).on("error",function(I){D=[],g(I)}).on("end",function(){try{var I=function(F,T,N){switch(F){case"blob":return i.newBlob(i.transformTo("arraybuffer",T),N);case"base64":return u.encode(T);default:return i.transformTo(F,T)}}(C,function(F,T){var N,j=0,G=null,R=0;for(N=0;N<T.length;N++)R+=T[N].length;switch(F){case"string":return T.join("");case"array":return Array.prototype.concat.apply([],T);case"uint8array":for(G=new Uint8Array(R),N=0;N<T.length;N++)G.set(T[N],j),j+=T[N].length;return G;case"nodebuffer":return Buffer.concat(T);default:throw new Error("concat : unsupported type '"+F+"'")}}(v,D),k);b(I)}catch(F){g(F)}D=[]}).resume()})}function h(p,m,b){var g=m;switch(m){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=m,this._mimeType=b,i.checkSupport(g),this._worker=p.pipe(new a(g)),p.lock()}catch(D){this._worker=new o("error"),this._worker.error(D)}}h.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var b=this;return p==="data"?this._worker.on(p,function(g){m.call(b,g.data,g.meta)}):this._worker.on(p,function(){i.delay(m,arguments,b)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,r,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var i=new ArrayBuffer(0);try{n.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(i),n.blob=a.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(t,r,n){for(var i=t("./utils"),a=t("./support"),o=t("./nodejsUtils"),u=t("./stream/GenericWorker"),l=new Array(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;l[254]=l[254]=1;function f(){u.call(this,"utf-8 decode"),this.leftOver=null}function d(){u.call(this,"utf-8 encode")}n.utf8encode=function(h){return a.nodebuffer?o.newBufferFrom(h,"utf-8"):function(p){var m,b,g,D,v,C=p.length,k=0;for(D=0;D<C;D++)(64512&(b=p.charCodeAt(D)))==55296&&D+1<C&&(64512&(g=p.charCodeAt(D+1)))==56320&&(b=65536+(b-55296<<10)+(g-56320),D++),k+=b<128?1:b<2048?2:b<65536?3:4;for(m=a.uint8array?new Uint8Array(k):new Array(k),D=v=0;v<k;D++)(64512&(b=p.charCodeAt(D)))==55296&&D+1<C&&(64512&(g=p.charCodeAt(D+1)))==56320&&(b=65536+(b-55296<<10)+(g-56320),D++),b<128?m[v++]=b:(b<2048?m[v++]=192|b>>>6:(b<65536?m[v++]=224|b>>>12:(m[v++]=240|b>>>18,m[v++]=128|b>>>12&63),m[v++]=128|b>>>6&63),m[v++]=128|63&b);return m}(h)},n.utf8decode=function(h){return a.nodebuffer?i.transformTo("nodebuffer",h).toString("utf-8"):function(p){var m,b,g,D,v=p.length,C=new Array(2*v);for(m=b=0;m<v;)if((g=p[m++])<128)C[b++]=g;else if(4<(D=l[g]))C[b++]=65533,m+=D-1;else{for(g&=D===2?31:D===3?15:7;1<D&&m<v;)g=g<<6|63&p[m++],D--;1<D?C[b++]=65533:g<65536?C[b++]=g:(g-=65536,C[b++]=55296|g>>10&1023,C[b++]=56320|1023&g)}return C.length!==b&&(C.subarray?C=C.subarray(0,b):C.length=b),i.applyFromCharCode(C)}(h=i.transformTo(a.uint8array?"uint8array":"array",h))},i.inherits(f,u),f.prototype.processChunk=function(h){var p=i.transformTo(a.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var b=function(D,v){var C;for((v=v||D.length)>D.length&&(v=D.length),C=v-1;0<=C&&(192&D[C])==128;)C--;return C<0||C===0?v:C+l[D[C]]>v?C:v}(p),g=p;b!==p.length&&(a.uint8array?(g=p.subarray(0,b),this.leftOver=p.subarray(b,p.length)):(g=p.slice(0,b),this.leftOver=p.slice(b,p.length))),this.push({data:n.utf8decode(g),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=f,i.inherits(d,u),d.prototype.processChunk=function(h){this.push({data:n.utf8encode(h.data),meta:h.meta})},n.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,r,n){var i=t("./support"),a=t("./base64"),o=t("./nodejsUtils"),u=t("./external");function l(m){return m}function c(m,b){for(var g=0;g<m.length;++g)b[g]=255&m.charCodeAt(g);return b}t("setimmediate"),n.newBlob=function(m,b){n.checkSupport("blob");try{return new Blob([m],{type:b})}catch{try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(m),g.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(m,b,g){var D=[],v=0,C=m.length;if(C<=g)return String.fromCharCode.apply(null,m);for(;v<C;)b==="array"||b==="nodebuffer"?D.push(String.fromCharCode.apply(null,m.slice(v,Math.min(v+g,C)))):D.push(String.fromCharCode.apply(null,m.subarray(v,Math.min(v+g,C)))),v+=g;return D.join("")},stringifyByChar:function(m){for(var b="",g=0;g<m.length;g++)b+=String.fromCharCode(m[g]);return b},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var b=65536,g=n.getTypeOf(m),D=!0;if(g==="uint8array"?D=f.applyCanBeUsed.uint8array:g==="nodebuffer"&&(D=f.applyCanBeUsed.nodebuffer),D)for(;1<b;)try{return f.stringifyByChunk(m,g,b)}catch{b=Math.floor(b/2)}return f.stringifyByChar(m)}function h(m,b){for(var g=0;g<m.length;g++)b[g]=m[g];return b}n.applyFromCharCode=d;var p={};p.string={string:l,array:function(m){return c(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return c(m,new Uint8Array(m.length))},nodebuffer:function(m){return c(m,o.allocBuffer(m.length))}},p.array={string:d,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return o.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return h(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return o.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return o.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:l},n.transformTo=function(m,b){if(b=b||"",!m)return b;n.checkSupport(m);var g=n.getTypeOf(b);return p[g][m](b)},n.resolve=function(m){for(var b=m.split("/"),g=[],D=0;D<b.length;D++){var v=b[D];v==="."||v===""&&D!==0&&D!==b.length-1||(v===".."?g.pop():g.push(v))}return g.join("/")},n.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":i.nodebuffer&&o.isBuffer(m)?"nodebuffer":i.uint8array&&m instanceof Uint8Array?"uint8array":i.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(m){if(!i[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(m){var b,g,D="";for(g=0;g<(m||"").length;g++)D+="\\x"+((b=m.charCodeAt(g))<16?"0":"")+b.toString(16).toUpperCase();return D},n.delay=function(m,b,g){setImmediate(function(){m.apply(g||null,b||[])})},n.inherits=function(m,b){function g(){}g.prototype=b.prototype,m.prototype=new g},n.extend=function(){var m,b,g={};for(m=0;m<arguments.length;m++)for(b in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],b)&&g[b]===void 0&&(g[b]=arguments[m][b]);return g},n.prepareContent=function(m,b,g,D,v){return u.Promise.resolve(b).then(function(C){return i.blob&&(C instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(C))!==-1)&&typeof FileReader<"u"?new u.Promise(function(k,I){var F=new FileReader;F.onload=function(T){k(T.target.result)},F.onerror=function(T){I(T.target.error)},F.readAsArrayBuffer(C)}):C}).then(function(C){var k=n.getTypeOf(C);return k?(k==="arraybuffer"?C=n.transformTo("uint8array",C):k==="string"&&(v?C=a.decode(C):g&&D!==!0&&(C=function(I){return c(I,i.uint8array?new Uint8Array(I.length):new Array(I.length))}(C))),C):u.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,r,n){var i=t("./reader/readerFor"),a=t("./utils"),o=t("./signature"),u=t("./zipEntry"),l=t("./support");function c(f){this.files=[],this.loadOptions=f}c.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(d)+", expected "+a.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var p=this.reader.readString(4)===d;return this.reader.setIndex(h),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=a.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,p=this.zip64EndOfCentralSize-44;0<p;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(f=new u({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var p=d-h;if(0<p)this.isSignature(d,o.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(f){this.reader=i(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,r,n){var i=t("./reader/readerFor"),a=t("./utils"),o=t("./compressedObject"),u=t("./crc32"),l=t("./utf8"),c=t("./compressions"),f=t("./support");function d(h,p){this.options=h,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var p,m;if(h.skip(22),this.fileNameLength=h.readInt(2),m=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(b){for(var g in c)if(Object.prototype.hasOwnProperty.call(c,g)&&c[g].magic===b)return c[g];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,p,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var p=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(p),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=i(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var p,m,b,g=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<g;)p=h.readInt(2),m=h.readInt(2),b=h.readData(m),this.extraFields[p]={id:p,length:m,value:b};h.setIndex(g)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=a.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var g=a.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var p=i(h.value);return p.readInt(1)!==1||u(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var p=i(h.value);return p.readInt(1)!==1||u(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,r,n){function i(p,m,b){this.name=p,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=m,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var a=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),u=t("./utf8"),l=t("./compressedObject"),c=t("./stream/GenericWorker");i.prototype={internalStream:function(p){var m=null,b="string";try{if(!p)throw new Error("No output type specified.");var g=(b=p.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),m=this._decompressWorker();var D=!this._dataBinary;D&&!g&&(m=m.pipe(new u.Utf8EncodeWorker)),!D&&g&&(m=m.pipe(new u.Utf8DecodeWorker))}catch(v){(m=new c("error")).error(v)}return new a(m,b,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new u.Utf8EncodeWorker)),l.createWorkerFrom(b,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof c?this._data:new o(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)i.prototype[f[h]]=d;r.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,r,n){(function(i){var a,o,u=i.MutationObserver||i.WebKitMutationObserver;if(u){var l=0,c=new u(p),f=i.document.createTextNode("");c.observe(f,{characterData:!0}),a=function(){f.data=l=++l%2}}else if(i.setImmediate||i.MessageChannel===void 0)a="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var m=i.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},i.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new i.MessageChannel;d.port1.onmessage=p,a=function(){d.port2.postMessage(0)}}var h=[];function p(){var m,b;o=!0;for(var g=h.length;g;){for(b=h,h=[],m=-1;++m<g;)b[m]();g=h.length}o=!1}r.exports=function(m){h.push(m)!==1||o||a()}}).call(this,typeof hn<"u"?hn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,r,n){var i=t("immediate");function a(){}var o={},u=["REJECTED"],l=["FULFILLED"],c=["PENDING"];function f(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,g!==a&&m(this,g)}function d(g,D,v){this.promise=g,typeof D=="function"&&(this.onFulfilled=D,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function h(g,D,v){i(function(){var C;try{C=D(v)}catch(k){return o.reject(g,k)}C===g?o.reject(g,new TypeError("Cannot resolve promise with itself")):o.resolve(g,C)})}function p(g){var D=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof D=="function")return function(){D.apply(g,arguments)}}function m(g,D){var v=!1;function C(F){v||(v=!0,o.reject(g,F))}function k(F){v||(v=!0,o.resolve(g,F))}var I=b(function(){D(k,C)});I.status==="error"&&C(I.value)}function b(g,D){var v={};try{v.value=g(D),v.status="success"}catch(C){v.status="error",v.value=C}return v}(r.exports=f).prototype.finally=function(g){if(typeof g!="function")return this;var D=this.constructor;return this.then(function(v){return D.resolve(g()).then(function(){return v})},function(v){return D.resolve(g()).then(function(){throw v})})},f.prototype.catch=function(g){return this.then(null,g)},f.prototype.then=function(g,D){if(typeof g!="function"&&this.state===l||typeof D!="function"&&this.state===u)return this;var v=new this.constructor(a);return this.state!==c?h(v,this.state===l?g:D,this.outcome):this.queue.push(new d(v,g,D)),v},d.prototype.callFulfilled=function(g){o.resolve(this.promise,g)},d.prototype.otherCallFulfilled=function(g){h(this.promise,this.onFulfilled,g)},d.prototype.callRejected=function(g){o.reject(this.promise,g)},d.prototype.otherCallRejected=function(g){h(this.promise,this.onRejected,g)},o.resolve=function(g,D){var v=b(p,D);if(v.status==="error")return o.reject(g,v.value);var C=v.value;if(C)m(g,C);else{g.state=l,g.outcome=D;for(var k=-1,I=g.queue.length;++k<I;)g.queue[k].callFulfilled(D)}return g},o.reject=function(g,D){g.state=u,g.outcome=D;for(var v=-1,C=g.queue.length;++v<C;)g.queue[v].callRejected(D);return g},f.resolve=function(g){return g instanceof this?g:o.resolve(new this(a),g)},f.reject=function(g){var D=new this(a);return o.reject(D,g)},f.all=function(g){var D=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=g.length,C=!1;if(!v)return this.resolve([]);for(var k=new Array(v),I=0,F=-1,T=new this(a);++F<v;)N(g[F],F);return T;function N(j,G){D.resolve(j).then(function(R){k[G]=R,++I!==v||C||(C=!0,o.resolve(T,k))},function(R){C||(C=!0,o.reject(T,R))})}},f.race=function(g){var D=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=g.length,C=!1;if(!v)return this.resolve([]);for(var k=-1,I=new this(a);++k<v;)F=g[k],D.resolve(F).then(function(T){C||(C=!0,o.resolve(I,T))},function(T){C||(C=!0,o.reject(I,T))});var F;return I}},{immediate:36}],38:[function(t,r,n){var i={};(0,t("./lib/utils/common").assign)(i,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),r.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,r,n){var i=t("./zlib/deflate"),a=t("./utils/common"),o=t("./utils/strings"),u=t("./zlib/messages"),l=t("./zlib/zstream"),c=Object.prototype.toString,f=0,d=-1,h=0,p=8;function m(g){if(!(this instanceof m))return new m(g);this.options=a.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},g||{});var D=this.options;D.raw&&0<D.windowBits?D.windowBits=-D.windowBits:D.gzip&&0<D.windowBits&&D.windowBits<16&&(D.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var v=i.deflateInit2(this.strm,D.level,D.method,D.windowBits,D.memLevel,D.strategy);if(v!==f)throw new Error(u[v]);if(D.header&&i.deflateSetHeader(this.strm,D.header),D.dictionary){var C;if(C=typeof D.dictionary=="string"?o.string2buf(D.dictionary):c.call(D.dictionary)==="[object ArrayBuffer]"?new Uint8Array(D.dictionary):D.dictionary,(v=i.deflateSetDictionary(this.strm,C))!==f)throw new Error(u[v]);this._dict_set=!0}}function b(g,D){var v=new m(D);if(v.push(g,!0),v.err)throw v.msg||u[v.err];return v.result}m.prototype.push=function(g,D){var v,C,k=this.strm,I=this.options.chunkSize;if(this.ended)return!1;C=D===~~D?D:D===!0?4:0,typeof g=="string"?k.input=o.string2buf(g):c.call(g)==="[object ArrayBuffer]"?k.input=new Uint8Array(g):k.input=g,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new a.Buf8(I),k.next_out=0,k.avail_out=I),(v=i.deflate(k,C))!==1&&v!==f)return this.onEnd(v),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||C!==4&&C!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(a.shrinkBuf(k.output,k.next_out))):this.onData(a.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&v!==1);return C===4?(v=i.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===f):C!==2||(this.onEnd(f),!(k.avail_out=0))},m.prototype.onData=function(g){this.chunks.push(g)},m.prototype.onEnd=function(g){g===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},n.Deflate=m,n.deflate=b,n.deflateRaw=function(g,D){return(D=D||{}).raw=!0,b(g,D)},n.gzip=function(g,D){return(D=D||{}).gzip=!0,b(g,D)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,r,n){var i=t("./zlib/inflate"),a=t("./utils/common"),o=t("./utils/strings"),u=t("./zlib/constants"),l=t("./zlib/messages"),c=t("./zlib/zstream"),f=t("./zlib/gzheader"),d=Object.prototype.toString;function h(m){if(!(this instanceof h))return new h(m);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},m||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||m&&m.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var g=i.inflateInit2(this.strm,b.windowBits);if(g!==u.Z_OK)throw new Error(l[g]);this.header=new f,i.inflateGetHeader(this.strm,this.header)}function p(m,b){var g=new h(b);if(g.push(m,!0),g.err)throw g.msg||l[g.err];return g.result}h.prototype.push=function(m,b){var g,D,v,C,k,I,F=this.strm,T=this.options.chunkSize,N=this.options.dictionary,j=!1;if(this.ended)return!1;D=b===~~b?b:b===!0?u.Z_FINISH:u.Z_NO_FLUSH,typeof m=="string"?F.input=o.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?F.input=new Uint8Array(m):F.input=m,F.next_in=0,F.avail_in=F.input.length;do{if(F.avail_out===0&&(F.output=new a.Buf8(T),F.next_out=0,F.avail_out=T),(g=i.inflate(F,u.Z_NO_FLUSH))===u.Z_NEED_DICT&&N&&(I=typeof N=="string"?o.string2buf(N):d.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,g=i.inflateSetDictionary(this.strm,I)),g===u.Z_BUF_ERROR&&j===!0&&(g=u.Z_OK,j=!1),g!==u.Z_STREAM_END&&g!==u.Z_OK)return this.onEnd(g),!(this.ended=!0);F.next_out&&(F.avail_out!==0&&g!==u.Z_STREAM_END&&(F.avail_in!==0||D!==u.Z_FINISH&&D!==u.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=o.utf8border(F.output,F.next_out),C=F.next_out-v,k=o.buf2string(F.output,v),F.next_out=C,F.avail_out=T-C,C&&a.arraySet(F.output,F.output,v,C,0),this.onData(k)):this.onData(a.shrinkBuf(F.output,F.next_out)))),F.avail_in===0&&F.avail_out===0&&(j=!0)}while((0<F.avail_in||F.avail_out===0)&&g!==u.Z_STREAM_END);return g===u.Z_STREAM_END&&(D=u.Z_FINISH),D===u.Z_FINISH?(g=i.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===u.Z_OK):D!==u.Z_SYNC_FLUSH||(this.onEnd(u.Z_OK),!(F.avail_out=0))},h.prototype.onData=function(m){this.chunks.push(m)},h.prototype.onEnd=function(m){m===u.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},n.Inflate=h,n.inflate=p,n.inflateRaw=function(m,b){return(b=b||{}).raw=!0,p(m,b)},n.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,r,n){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(u){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var c=l.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var f in c)c.hasOwnProperty(f)&&(u[f]=c[f])}}return u},n.shrinkBuf=function(u,l){return u.length===l?u:u.subarray?u.subarray(0,l):(u.length=l,u)};var a={arraySet:function(u,l,c,f,d){if(l.subarray&&u.subarray)u.set(l.subarray(c,c+f),d);else for(var h=0;h<f;h++)u[d+h]=l[c+h]},flattenChunks:function(u){var l,c,f,d,h,p;for(l=f=0,c=u.length;l<c;l++)f+=u[l].length;for(p=new Uint8Array(f),l=d=0,c=u.length;l<c;l++)h=u[l],p.set(h,d),d+=h.length;return p}},o={arraySet:function(u,l,c,f,d){for(var h=0;h<f;h++)u[d+h]=l[c+h]},flattenChunks:function(u){return[].concat.apply([],u)}};n.setTyped=function(u){u?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,a)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(i)},{}],42:[function(t,r,n){var i=t("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var u=new i.Buf8(256),l=0;l<256;l++)u[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function c(f,d){if(d<65537&&(f.subarray&&o||!f.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(f,d));for(var h="",p=0;p<d;p++)h+=String.fromCharCode(f[p]);return h}u[254]=u[254]=1,n.string2buf=function(f){var d,h,p,m,b,g=f.length,D=0;for(m=0;m<g;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<g&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),D+=h<128?1:h<2048?2:h<65536?3:4;for(d=new i.Buf8(D),m=b=0;b<D;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<g&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),h<128?d[b++]=h:(h<2048?d[b++]=192|h>>>6:(h<65536?d[b++]=224|h>>>12:(d[b++]=240|h>>>18,d[b++]=128|h>>>12&63),d[b++]=128|h>>>6&63),d[b++]=128|63&h);return d},n.buf2binstring=function(f){return c(f,f.length)},n.binstring2buf=function(f){for(var d=new i.Buf8(f.length),h=0,p=d.length;h<p;h++)d[h]=f.charCodeAt(h);return d},n.buf2string=function(f,d){var h,p,m,b,g=d||f.length,D=new Array(2*g);for(h=p=0;h<g;)if((m=f[h++])<128)D[p++]=m;else if(4<(b=u[m]))D[p++]=65533,h+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&h<g;)m=m<<6|63&f[h++],b--;1<b?D[p++]=65533:m<65536?D[p++]=m:(m-=65536,D[p++]=55296|m>>10&1023,D[p++]=56320|1023&m)}return c(D,p)},n.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+u[f[h]]>d?h:d}},{"./common":41}],43:[function(t,r,n){r.exports=function(i,a,o,u){for(var l=65535&i|0,c=i>>>16&65535|0,f=0;o!==0;){for(o-=f=2e3<o?2e3:o;c=c+(l=l+a[u++]|0)|0,--f;);l%=65521,c%=65521}return l|c<<16|0}},{}],44:[function(t,r,n){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,r,n){var i=function(){for(var a,o=[],u=0;u<256;u++){a=u;for(var l=0;l<8;l++)a=1&a?3988292384^a>>>1:a>>>1;o[u]=a}return o}();r.exports=function(a,o,u,l){var c=i,f=l+u;a^=-1;for(var d=l;d<f;d++)a=a>>>8^c[255&(a^o[d])];return-1^a}},{}],46:[function(t,r,n){var i,a=t("../utils/common"),o=t("./trees"),u=t("./adler32"),l=t("./crc32"),c=t("./messages"),f=0,d=4,h=0,p=-2,m=-1,b=4,g=2,D=8,v=9,C=286,k=30,I=19,F=2*C+1,T=15,N=3,j=258,G=j+N+1,R=42,L=113,y=1,q=2,ee=3,U=4;function Z(_,Y){return _.msg=c[Y],Y}function Q(_){return(_<<1)-(4<_?9:0)}function be(_){for(var Y=_.length;0<=--Y;)_[Y]=0}function W(_){var Y=_.state,K=Y.pending;K>_.avail_out&&(K=_.avail_out),K!==0&&(a.arraySet(_.output,Y.pending_buf,Y.pending_out,K,_.next_out),_.next_out+=K,Y.pending_out+=K,_.total_out+=K,_.avail_out-=K,Y.pending-=K,Y.pending===0&&(Y.pending_out=0))}function H(_,Y){o._tr_flush_block(_,0<=_.block_start?_.block_start:-1,_.strstart-_.block_start,Y),_.block_start=_.strstart,W(_.strm)}function pe(_,Y){_.pending_buf[_.pending++]=Y}function de(_,Y){_.pending_buf[_.pending++]=Y>>>8&255,_.pending_buf[_.pending++]=255&Y}function he(_,Y){var K,O,x=_.max_chain_length,$=_.strstart,te=_.prev_length,re=_.nice_match,V=_.strstart>_.w_size-G?_.strstart-(_.w_size-G):0,ae=_.window,De=_.w_mask,ce=_.prev,ke=_.strstart+j,Ue=ae[$+te-1],Oe=ae[$+te];_.prev_length>=_.good_match&&(x>>=2),re>_.lookahead&&(re=_.lookahead);do if(ae[(K=Y)+te]===Oe&&ae[K+te-1]===Ue&&ae[K]===ae[$]&&ae[++K]===ae[$+1]){$+=2,K++;do;while(ae[++$]===ae[++K]&&ae[++$]===ae[++K]&&ae[++$]===ae[++K]&&ae[++$]===ae[++K]&&ae[++$]===ae[++K]&&ae[++$]===ae[++K]&&ae[++$]===ae[++K]&&ae[++$]===ae[++K]&&$<ke);if(O=j-(ke-$),$=ke-j,te<O){if(_.match_start=Y,re<=(te=O))break;Ue=ae[$+te-1],Oe=ae[$+te]}}while((Y=ce[Y&De])>V&&--x!=0);return te<=_.lookahead?te:_.lookahead}function Ke(_){var Y,K,O,x,$,te,re,V,ae,De,ce=_.w_size;do{if(x=_.window_size-_.lookahead-_.strstart,_.strstart>=ce+(ce-G)){for(a.arraySet(_.window,_.window,ce,ce,0),_.match_start-=ce,_.strstart-=ce,_.block_start-=ce,Y=K=_.hash_size;O=_.head[--Y],_.head[Y]=ce<=O?O-ce:0,--K;);for(Y=K=ce;O=_.prev[--Y],_.prev[Y]=ce<=O?O-ce:0,--K;);x+=ce}if(_.strm.avail_in===0)break;if(te=_.strm,re=_.window,V=_.strstart+_.lookahead,ae=x,De=void 0,De=te.avail_in,ae<De&&(De=ae),K=De===0?0:(te.avail_in-=De,a.arraySet(re,te.input,te.next_in,De,V),te.state.wrap===1?te.adler=u(te.adler,re,De,V):te.state.wrap===2&&(te.adler=l(te.adler,re,De,V)),te.next_in+=De,te.total_in+=De,De),_.lookahead+=K,_.lookahead+_.insert>=N)for($=_.strstart-_.insert,_.ins_h=_.window[$],_.ins_h=(_.ins_h<<_.hash_shift^_.window[$+1])&_.hash_mask;_.insert&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[$+N-1])&_.hash_mask,_.prev[$&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=$,$++,_.insert--,!(_.lookahead+_.insert<N)););}while(_.lookahead<G&&_.strm.avail_in!==0)}function ut(_,Y){for(var K,O;;){if(_.lookahead<G){if(Ke(_),_.lookahead<G&&Y===f)return y;if(_.lookahead===0)break}if(K=0,_.lookahead>=N&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+N-1])&_.hash_mask,K=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),K!==0&&_.strstart-K<=_.w_size-G&&(_.match_length=he(_,K)),_.match_length>=N)if(O=o._tr_tally(_,_.strstart-_.match_start,_.match_length-N),_.lookahead-=_.match_length,_.match_length<=_.max_lazy_match&&_.lookahead>=N){for(_.match_length--;_.strstart++,_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+N-1])&_.hash_mask,K=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart,--_.match_length!=0;);_.strstart++}else _.strstart+=_.match_length,_.match_length=0,_.ins_h=_.window[_.strstart],_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+1])&_.hash_mask;else O=o._tr_tally(_,0,_.window[_.strstart]),_.lookahead--,_.strstart++;if(O&&(H(_,!1),_.strm.avail_out===0))return y}return _.insert=_.strstart<N-1?_.strstart:N-1,Y===d?(H(_,!0),_.strm.avail_out===0?ee:U):_.last_lit&&(H(_,!1),_.strm.avail_out===0)?y:q}function Pe(_,Y){for(var K,O,x;;){if(_.lookahead<G){if(Ke(_),_.lookahead<G&&Y===f)return y;if(_.lookahead===0)break}if(K=0,_.lookahead>=N&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+N-1])&_.hash_mask,K=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),_.prev_length=_.match_length,_.prev_match=_.match_start,_.match_length=N-1,K!==0&&_.prev_length<_.max_lazy_match&&_.strstart-K<=_.w_size-G&&(_.match_length=he(_,K),_.match_length<=5&&(_.strategy===1||_.match_length===N&&4096<_.strstart-_.match_start)&&(_.match_length=N-1)),_.prev_length>=N&&_.match_length<=_.prev_length){for(x=_.strstart+_.lookahead-N,O=o._tr_tally(_,_.strstart-1-_.prev_match,_.prev_length-N),_.lookahead-=_.prev_length-1,_.prev_length-=2;++_.strstart<=x&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+N-1])&_.hash_mask,K=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),--_.prev_length!=0;);if(_.match_available=0,_.match_length=N-1,_.strstart++,O&&(H(_,!1),_.strm.avail_out===0))return y}else if(_.match_available){if((O=o._tr_tally(_,0,_.window[_.strstart-1]))&&H(_,!1),_.strstart++,_.lookahead--,_.strm.avail_out===0)return y}else _.match_available=1,_.strstart++,_.lookahead--}return _.match_available&&(O=o._tr_tally(_,0,_.window[_.strstart-1]),_.match_available=0),_.insert=_.strstart<N-1?_.strstart:N-1,Y===d?(H(_,!0),_.strm.avail_out===0?ee:U):_.last_lit&&(H(_,!1),_.strm.avail_out===0)?y:q}function Me(_,Y,K,O,x){this.good_length=_,this.max_lazy=Y,this.nice_length=K,this.max_chain=O,this.func=x}function st(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=D,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*F),this.dyn_dtree=new a.Buf16(2*(2*k+1)),this.bl_tree=new a.Buf16(2*(2*I+1)),be(this.dyn_ltree),be(this.dyn_dtree),be(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(T+1),this.heap=new a.Buf16(2*C+1),be(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*C+1),be(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ze(_){var Y;return _&&_.state?(_.total_in=_.total_out=0,_.data_type=g,(Y=_.state).pending=0,Y.pending_out=0,Y.wrap<0&&(Y.wrap=-Y.wrap),Y.status=Y.wrap?R:L,_.adler=Y.wrap===2?0:1,Y.last_flush=f,o._tr_init(Y),h):Z(_,p)}function Ce(_){var Y=Ze(_);return Y===h&&function(K){K.window_size=2*K.w_size,be(K.head),K.max_lazy_match=i[K.level].max_lazy,K.good_match=i[K.level].good_length,K.nice_match=i[K.level].nice_length,K.max_chain_length=i[K.level].max_chain,K.strstart=0,K.block_start=0,K.lookahead=0,K.insert=0,K.match_length=K.prev_length=N-1,K.match_available=0,K.ins_h=0}(_.state),Y}function lt(_,Y,K,O,x,$){if(!_)return p;var te=1;if(Y===m&&(Y=6),O<0?(te=0,O=-O):15<O&&(te=2,O-=16),x<1||v<x||K!==D||O<8||15<O||Y<0||9<Y||$<0||b<$)return Z(_,p);O===8&&(O=9);var re=new st;return(_.state=re).strm=_,re.wrap=te,re.gzhead=null,re.w_bits=O,re.w_size=1<<re.w_bits,re.w_mask=re.w_size-1,re.hash_bits=x+7,re.hash_size=1<<re.hash_bits,re.hash_mask=re.hash_size-1,re.hash_shift=~~((re.hash_bits+N-1)/N),re.window=new a.Buf8(2*re.w_size),re.head=new a.Buf16(re.hash_size),re.prev=new a.Buf16(re.w_size),re.lit_bufsize=1<<x+6,re.pending_buf_size=4*re.lit_bufsize,re.pending_buf=new a.Buf8(re.pending_buf_size),re.d_buf=1*re.lit_bufsize,re.l_buf=3*re.lit_bufsize,re.level=Y,re.strategy=$,re.method=K,Ce(_)}i=[new Me(0,0,0,0,function(_,Y){var K=65535;for(K>_.pending_buf_size-5&&(K=_.pending_buf_size-5);;){if(_.lookahead<=1){if(Ke(_),_.lookahead===0&&Y===f)return y;if(_.lookahead===0)break}_.strstart+=_.lookahead,_.lookahead=0;var O=_.block_start+K;if((_.strstart===0||_.strstart>=O)&&(_.lookahead=_.strstart-O,_.strstart=O,H(_,!1),_.strm.avail_out===0)||_.strstart-_.block_start>=_.w_size-G&&(H(_,!1),_.strm.avail_out===0))return y}return _.insert=0,Y===d?(H(_,!0),_.strm.avail_out===0?ee:U):(_.strstart>_.block_start&&(H(_,!1),_.strm.avail_out),y)}),new Me(4,4,8,4,ut),new Me(4,5,16,8,ut),new Me(4,6,32,32,ut),new Me(4,4,16,16,Pe),new Me(8,16,32,32,Pe),new Me(8,16,128,128,Pe),new Me(8,32,128,256,Pe),new Me(32,128,258,1024,Pe),new Me(32,258,258,4096,Pe)],n.deflateInit=function(_,Y){return lt(_,Y,D,15,8,0)},n.deflateInit2=lt,n.deflateReset=Ce,n.deflateResetKeep=Ze,n.deflateSetHeader=function(_,Y){return _&&_.state?_.state.wrap!==2?p:(_.state.gzhead=Y,h):p},n.deflate=function(_,Y){var K,O,x,$;if(!_||!_.state||5<Y||Y<0)return _?Z(_,p):p;if(O=_.state,!_.output||!_.input&&_.avail_in!==0||O.status===666&&Y!==d)return Z(_,_.avail_out===0?-5:p);if(O.strm=_,K=O.last_flush,O.last_flush=Y,O.status===R)if(O.wrap===2)_.adler=0,pe(O,31),pe(O,139),pe(O,8),O.gzhead?(pe(O,(O.gzhead.text?1:0)+(O.gzhead.hcrc?2:0)+(O.gzhead.extra?4:0)+(O.gzhead.name?8:0)+(O.gzhead.comment?16:0)),pe(O,255&O.gzhead.time),pe(O,O.gzhead.time>>8&255),pe(O,O.gzhead.time>>16&255),pe(O,O.gzhead.time>>24&255),pe(O,O.level===9?2:2<=O.strategy||O.level<2?4:0),pe(O,255&O.gzhead.os),O.gzhead.extra&&O.gzhead.extra.length&&(pe(O,255&O.gzhead.extra.length),pe(O,O.gzhead.extra.length>>8&255)),O.gzhead.hcrc&&(_.adler=l(_.adler,O.pending_buf,O.pending,0)),O.gzindex=0,O.status=69):(pe(O,0),pe(O,0),pe(O,0),pe(O,0),pe(O,0),pe(O,O.level===9?2:2<=O.strategy||O.level<2?4:0),pe(O,3),O.status=L);else{var te=D+(O.w_bits-8<<4)<<8;te|=(2<=O.strategy||O.level<2?0:O.level<6?1:O.level===6?2:3)<<6,O.strstart!==0&&(te|=32),te+=31-te%31,O.status=L,de(O,te),O.strstart!==0&&(de(O,_.adler>>>16),de(O,65535&_.adler)),_.adler=1}if(O.status===69)if(O.gzhead.extra){for(x=O.pending;O.gzindex<(65535&O.gzhead.extra.length)&&(O.pending!==O.pending_buf_size||(O.gzhead.hcrc&&O.pending>x&&(_.adler=l(_.adler,O.pending_buf,O.pending-x,x)),W(_),x=O.pending,O.pending!==O.pending_buf_size));)pe(O,255&O.gzhead.extra[O.gzindex]),O.gzindex++;O.gzhead.hcrc&&O.pending>x&&(_.adler=l(_.adler,O.pending_buf,O.pending-x,x)),O.gzindex===O.gzhead.extra.length&&(O.gzindex=0,O.status=73)}else O.status=73;if(O.status===73)if(O.gzhead.name){x=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>x&&(_.adler=l(_.adler,O.pending_buf,O.pending-x,x)),W(_),x=O.pending,O.pending===O.pending_buf_size)){$=1;break}$=O.gzindex<O.gzhead.name.length?255&O.gzhead.name.charCodeAt(O.gzindex++):0,pe(O,$)}while($!==0);O.gzhead.hcrc&&O.pending>x&&(_.adler=l(_.adler,O.pending_buf,O.pending-x,x)),$===0&&(O.gzindex=0,O.status=91)}else O.status=91;if(O.status===91)if(O.gzhead.comment){x=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>x&&(_.adler=l(_.adler,O.pending_buf,O.pending-x,x)),W(_),x=O.pending,O.pending===O.pending_buf_size)){$=1;break}$=O.gzindex<O.gzhead.comment.length?255&O.gzhead.comment.charCodeAt(O.gzindex++):0,pe(O,$)}while($!==0);O.gzhead.hcrc&&O.pending>x&&(_.adler=l(_.adler,O.pending_buf,O.pending-x,x)),$===0&&(O.status=103)}else O.status=103;if(O.status===103&&(O.gzhead.hcrc?(O.pending+2>O.pending_buf_size&&W(_),O.pending+2<=O.pending_buf_size&&(pe(O,255&_.adler),pe(O,_.adler>>8&255),_.adler=0,O.status=L)):O.status=L),O.pending!==0){if(W(_),_.avail_out===0)return O.last_flush=-1,h}else if(_.avail_in===0&&Q(Y)<=Q(K)&&Y!==d)return Z(_,-5);if(O.status===666&&_.avail_in!==0)return Z(_,-5);if(_.avail_in!==0||O.lookahead!==0||Y!==f&&O.status!==666){var re=O.strategy===2?function(V,ae){for(var De;;){if(V.lookahead===0&&(Ke(V),V.lookahead===0)){if(ae===f)return y;break}if(V.match_length=0,De=o._tr_tally(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++,De&&(H(V,!1),V.strm.avail_out===0))return y}return V.insert=0,ae===d?(H(V,!0),V.strm.avail_out===0?ee:U):V.last_lit&&(H(V,!1),V.strm.avail_out===0)?y:q}(O,Y):O.strategy===3?function(V,ae){for(var De,ce,ke,Ue,Oe=V.window;;){if(V.lookahead<=j){if(Ke(V),V.lookahead<=j&&ae===f)return y;if(V.lookahead===0)break}if(V.match_length=0,V.lookahead>=N&&0<V.strstart&&(ce=Oe[ke=V.strstart-1])===Oe[++ke]&&ce===Oe[++ke]&&ce===Oe[++ke]){Ue=V.strstart+j;do;while(ce===Oe[++ke]&&ce===Oe[++ke]&&ce===Oe[++ke]&&ce===Oe[++ke]&&ce===Oe[++ke]&&ce===Oe[++ke]&&ce===Oe[++ke]&&ce===Oe[++ke]&&ke<Ue);V.match_length=j-(Ue-ke),V.match_length>V.lookahead&&(V.match_length=V.lookahead)}if(V.match_length>=N?(De=o._tr_tally(V,1,V.match_length-N),V.lookahead-=V.match_length,V.strstart+=V.match_length,V.match_length=0):(De=o._tr_tally(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++),De&&(H(V,!1),V.strm.avail_out===0))return y}return V.insert=0,ae===d?(H(V,!0),V.strm.avail_out===0?ee:U):V.last_lit&&(H(V,!1),V.strm.avail_out===0)?y:q}(O,Y):i[O.level].func(O,Y);if(re!==ee&&re!==U||(O.status=666),re===y||re===ee)return _.avail_out===0&&(O.last_flush=-1),h;if(re===q&&(Y===1?o._tr_align(O):Y!==5&&(o._tr_stored_block(O,0,0,!1),Y===3&&(be(O.head),O.lookahead===0&&(O.strstart=0,O.block_start=0,O.insert=0))),W(_),_.avail_out===0))return O.last_flush=-1,h}return Y!==d?h:O.wrap<=0?1:(O.wrap===2?(pe(O,255&_.adler),pe(O,_.adler>>8&255),pe(O,_.adler>>16&255),pe(O,_.adler>>24&255),pe(O,255&_.total_in),pe(O,_.total_in>>8&255),pe(O,_.total_in>>16&255),pe(O,_.total_in>>24&255)):(de(O,_.adler>>>16),de(O,65535&_.adler)),W(_),0<O.wrap&&(O.wrap=-O.wrap),O.pending!==0?h:1)},n.deflateEnd=function(_){var Y;return _&&_.state?(Y=_.state.status)!==R&&Y!==69&&Y!==73&&Y!==91&&Y!==103&&Y!==L&&Y!==666?Z(_,p):(_.state=null,Y===L?Z(_,-3):h):p},n.deflateSetDictionary=function(_,Y){var K,O,x,$,te,re,V,ae,De=Y.length;if(!_||!_.state||($=(K=_.state).wrap)===2||$===1&&K.status!==R||K.lookahead)return p;for($===1&&(_.adler=u(_.adler,Y,De,0)),K.wrap=0,De>=K.w_size&&($===0&&(be(K.head),K.strstart=0,K.block_start=0,K.insert=0),ae=new a.Buf8(K.w_size),a.arraySet(ae,Y,De-K.w_size,K.w_size,0),Y=ae,De=K.w_size),te=_.avail_in,re=_.next_in,V=_.input,_.avail_in=De,_.next_in=0,_.input=Y,Ke(K);K.lookahead>=N;){for(O=K.strstart,x=K.lookahead-(N-1);K.ins_h=(K.ins_h<<K.hash_shift^K.window[O+N-1])&K.hash_mask,K.prev[O&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=O,O++,--x;);K.strstart=O,K.lookahead=N-1,Ke(K)}return K.strstart+=K.lookahead,K.block_start=K.strstart,K.insert=K.lookahead,K.lookahead=0,K.match_length=K.prev_length=N-1,K.match_available=0,_.next_in=re,_.input=V,_.avail_in=te,K.wrap=$,h},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,r,n){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,r,n){r.exports=function(i,a){var o,u,l,c,f,d,h,p,m,b,g,D,v,C,k,I,F,T,N,j,G,R,L,y,q;o=i.state,u=i.next_in,y=i.input,l=u+(i.avail_in-5),c=i.next_out,q=i.output,f=c-(a-i.avail_out),d=c+(i.avail_out-257),h=o.dmax,p=o.wsize,m=o.whave,b=o.wnext,g=o.window,D=o.hold,v=o.bits,C=o.lencode,k=o.distcode,I=(1<<o.lenbits)-1,F=(1<<o.distbits)-1;e:do{v<15&&(D+=y[u++]<<v,v+=8,D+=y[u++]<<v,v+=8),T=C[D&I];t:for(;;){if(D>>>=N=T>>>24,v-=N,(N=T>>>16&255)===0)q[c++]=65535&T;else{if(!(16&N)){if(!(64&N)){T=C[(65535&T)+(D&(1<<N)-1)];continue t}if(32&N){o.mode=12;break e}i.msg="invalid literal/length code",o.mode=30;break e}j=65535&T,(N&=15)&&(v<N&&(D+=y[u++]<<v,v+=8),j+=D&(1<<N)-1,D>>>=N,v-=N),v<15&&(D+=y[u++]<<v,v+=8,D+=y[u++]<<v,v+=8),T=k[D&F];n:for(;;){if(D>>>=N=T>>>24,v-=N,!(16&(N=T>>>16&255))){if(!(64&N)){T=k[(65535&T)+(D&(1<<N)-1)];continue n}i.msg="invalid distance code",o.mode=30;break e}if(G=65535&T,v<(N&=15)&&(D+=y[u++]<<v,(v+=8)<N&&(D+=y[u++]<<v,v+=8)),h<(G+=D&(1<<N)-1)){i.msg="invalid distance too far back",o.mode=30;break e}if(D>>>=N,v-=N,(N=c-f)<G){if(m<(N=G-N)&&o.sane){i.msg="invalid distance too far back",o.mode=30;break e}if(L=g,(R=0)===b){if(R+=p-N,N<j){for(j-=N;q[c++]=g[R++],--N;);R=c-G,L=q}}else if(b<N){if(R+=p+b-N,(N-=b)<j){for(j-=N;q[c++]=g[R++],--N;);if(R=0,b<j){for(j-=N=b;q[c++]=g[R++],--N;);R=c-G,L=q}}}else if(R+=b-N,N<j){for(j-=N;q[c++]=g[R++],--N;);R=c-G,L=q}for(;2<j;)q[c++]=L[R++],q[c++]=L[R++],q[c++]=L[R++],j-=3;j&&(q[c++]=L[R++],1<j&&(q[c++]=L[R++]))}else{for(R=c-G;q[c++]=q[R++],q[c++]=q[R++],q[c++]=q[R++],2<(j-=3););j&&(q[c++]=q[R++],1<j&&(q[c++]=q[R++]))}break}}break}}while(u<l&&c<d);u-=j=v>>3,D&=(1<<(v-=j<<3))-1,i.next_in=u,i.next_out=c,i.avail_in=u<l?l-u+5:5-(u-l),i.avail_out=c<d?d-c+257:257-(c-d),o.hold=D,o.bits=v}},{}],49:[function(t,r,n){var i=t("../utils/common"),a=t("./adler32"),o=t("./crc32"),u=t("./inffast"),l=t("./inftrees"),c=1,f=2,d=0,h=-2,p=1,m=852,b=592;function g(R){return(R>>>24&255)+(R>>>8&65280)+((65280&R)<<8)+((255&R)<<24)}function D(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(R){var L;return R&&R.state?(L=R.state,R.total_in=R.total_out=L.total=0,R.msg="",L.wrap&&(R.adler=1&L.wrap),L.mode=p,L.last=0,L.havedict=0,L.dmax=32768,L.head=null,L.hold=0,L.bits=0,L.lencode=L.lendyn=new i.Buf32(m),L.distcode=L.distdyn=new i.Buf32(b),L.sane=1,L.back=-1,d):h}function C(R){var L;return R&&R.state?((L=R.state).wsize=0,L.whave=0,L.wnext=0,v(R)):h}function k(R,L){var y,q;return R&&R.state?(q=R.state,L<0?(y=0,L=-L):(y=1+(L>>4),L<48&&(L&=15)),L&&(L<8||15<L)?h:(q.window!==null&&q.wbits!==L&&(q.window=null),q.wrap=y,q.wbits=L,C(R))):h}function I(R,L){var y,q;return R?(q=new D,(R.state=q).window=null,(y=k(R,L))!==d&&(R.state=null),y):h}var F,T,N=!0;function j(R){if(N){var L;for(F=new i.Buf32(512),T=new i.Buf32(32),L=0;L<144;)R.lens[L++]=8;for(;L<256;)R.lens[L++]=9;for(;L<280;)R.lens[L++]=7;for(;L<288;)R.lens[L++]=8;for(l(c,R.lens,0,288,F,0,R.work,{bits:9}),L=0;L<32;)R.lens[L++]=5;l(f,R.lens,0,32,T,0,R.work,{bits:5}),N=!1}R.lencode=F,R.lenbits=9,R.distcode=T,R.distbits=5}function G(R,L,y,q){var ee,U=R.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new i.Buf8(U.wsize)),q>=U.wsize?(i.arraySet(U.window,L,y-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(q<(ee=U.wsize-U.wnext)&&(ee=q),i.arraySet(U.window,L,y-q,ee,U.wnext),(q-=ee)?(i.arraySet(U.window,L,y-q,q,0),U.wnext=q,U.whave=U.wsize):(U.wnext+=ee,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=ee))),0}n.inflateReset=C,n.inflateReset2=k,n.inflateResetKeep=v,n.inflateInit=function(R){return I(R,15)},n.inflateInit2=I,n.inflate=function(R,L){var y,q,ee,U,Z,Q,be,W,H,pe,de,he,Ke,ut,Pe,Me,st,Ze,Ce,lt,_,Y,K,O,x=0,$=new i.Buf8(4),te=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!R||!R.state||!R.output||!R.input&&R.avail_in!==0)return h;(y=R.state).mode===12&&(y.mode=13),Z=R.next_out,ee=R.output,be=R.avail_out,U=R.next_in,q=R.input,Q=R.avail_in,W=y.hold,H=y.bits,pe=Q,de=be,Y=d;e:for(;;)switch(y.mode){case p:if(y.wrap===0){y.mode=13;break}for(;H<16;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}if(2&y.wrap&&W===35615){$[y.check=0]=255&W,$[1]=W>>>8&255,y.check=o(y.check,$,2,0),H=W=0,y.mode=2;break}if(y.flags=0,y.head&&(y.head.done=!1),!(1&y.wrap)||(((255&W)<<8)+(W>>8))%31){R.msg="incorrect header check",y.mode=30;break}if((15&W)!=8){R.msg="unknown compression method",y.mode=30;break}if(H-=4,_=8+(15&(W>>>=4)),y.wbits===0)y.wbits=_;else if(_>y.wbits){R.msg="invalid window size",y.mode=30;break}y.dmax=1<<_,R.adler=y.check=1,y.mode=512&W?10:12,H=W=0;break;case 2:for(;H<16;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}if(y.flags=W,(255&y.flags)!=8){R.msg="unknown compression method",y.mode=30;break}if(57344&y.flags){R.msg="unknown header flags set",y.mode=30;break}y.head&&(y.head.text=W>>8&1),512&y.flags&&($[0]=255&W,$[1]=W>>>8&255,y.check=o(y.check,$,2,0)),H=W=0,y.mode=3;case 3:for(;H<32;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}y.head&&(y.head.time=W),512&y.flags&&($[0]=255&W,$[1]=W>>>8&255,$[2]=W>>>16&255,$[3]=W>>>24&255,y.check=o(y.check,$,4,0)),H=W=0,y.mode=4;case 4:for(;H<16;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}y.head&&(y.head.xflags=255&W,y.head.os=W>>8),512&y.flags&&($[0]=255&W,$[1]=W>>>8&255,y.check=o(y.check,$,2,0)),H=W=0,y.mode=5;case 5:if(1024&y.flags){for(;H<16;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}y.length=W,y.head&&(y.head.extra_len=W),512&y.flags&&($[0]=255&W,$[1]=W>>>8&255,y.check=o(y.check,$,2,0)),H=W=0}else y.head&&(y.head.extra=null);y.mode=6;case 6:if(1024&y.flags&&(Q<(he=y.length)&&(he=Q),he&&(y.head&&(_=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Array(y.head.extra_len)),i.arraySet(y.head.extra,q,U,he,_)),512&y.flags&&(y.check=o(y.check,q,he,U)),Q-=he,U+=he,y.length-=he),y.length))break e;y.length=0,y.mode=7;case 7:if(2048&y.flags){if(Q===0)break e;for(he=0;_=q[U+he++],y.head&&_&&y.length<65536&&(y.head.name+=String.fromCharCode(_)),_&&he<Q;);if(512&y.flags&&(y.check=o(y.check,q,he,U)),Q-=he,U+=he,_)break e}else y.head&&(y.head.name=null);y.length=0,y.mode=8;case 8:if(4096&y.flags){if(Q===0)break e;for(he=0;_=q[U+he++],y.head&&_&&y.length<65536&&(y.head.comment+=String.fromCharCode(_)),_&&he<Q;);if(512&y.flags&&(y.check=o(y.check,q,he,U)),Q-=he,U+=he,_)break e}else y.head&&(y.head.comment=null);y.mode=9;case 9:if(512&y.flags){for(;H<16;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}if(W!==(65535&y.check)){R.msg="header crc mismatch",y.mode=30;break}H=W=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),R.adler=y.check=0,y.mode=12;break;case 10:for(;H<32;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}R.adler=y.check=g(W),H=W=0,y.mode=11;case 11:if(y.havedict===0)return R.next_out=Z,R.avail_out=be,R.next_in=U,R.avail_in=Q,y.hold=W,y.bits=H,2;R.adler=y.check=1,y.mode=12;case 12:if(L===5||L===6)break e;case 13:if(y.last){W>>>=7&H,H-=7&H,y.mode=27;break}for(;H<3;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}switch(y.last=1&W,H-=1,3&(W>>>=1)){case 0:y.mode=14;break;case 1:if(j(y),y.mode=20,L!==6)break;W>>>=2,H-=2;break e;case 2:y.mode=17;break;case 3:R.msg="invalid block type",y.mode=30}W>>>=2,H-=2;break;case 14:for(W>>>=7&H,H-=7&H;H<32;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}if((65535&W)!=(W>>>16^65535)){R.msg="invalid stored block lengths",y.mode=30;break}if(y.length=65535&W,H=W=0,y.mode=15,L===6)break e;case 15:y.mode=16;case 16:if(he=y.length){if(Q<he&&(he=Q),be<he&&(he=be),he===0)break e;i.arraySet(ee,q,U,he,Z),Q-=he,U+=he,be-=he,Z+=he,y.length-=he;break}y.mode=12;break;case 17:for(;H<14;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}if(y.nlen=257+(31&W),W>>>=5,H-=5,y.ndist=1+(31&W),W>>>=5,H-=5,y.ncode=4+(15&W),W>>>=4,H-=4,286<y.nlen||30<y.ndist){R.msg="too many length or distance symbols",y.mode=30;break}y.have=0,y.mode=18;case 18:for(;y.have<y.ncode;){for(;H<3;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}y.lens[te[y.have++]]=7&W,W>>>=3,H-=3}for(;y.have<19;)y.lens[te[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,K={bits:y.lenbits},Y=l(0,y.lens,0,19,y.lencode,0,y.work,K),y.lenbits=K.bits,Y){R.msg="invalid code lengths set",y.mode=30;break}y.have=0,y.mode=19;case 19:for(;y.have<y.nlen+y.ndist;){for(;Me=(x=y.lencode[W&(1<<y.lenbits)-1])>>>16&255,st=65535&x,!((Pe=x>>>24)<=H);){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}if(st<16)W>>>=Pe,H-=Pe,y.lens[y.have++]=st;else{if(st===16){for(O=Pe+2;H<O;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}if(W>>>=Pe,H-=Pe,y.have===0){R.msg="invalid bit length repeat",y.mode=30;break}_=y.lens[y.have-1],he=3+(3&W),W>>>=2,H-=2}else if(st===17){for(O=Pe+3;H<O;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}H-=Pe,_=0,he=3+(7&(W>>>=Pe)),W>>>=3,H-=3}else{for(O=Pe+7;H<O;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}H-=Pe,_=0,he=11+(127&(W>>>=Pe)),W>>>=7,H-=7}if(y.have+he>y.nlen+y.ndist){R.msg="invalid bit length repeat",y.mode=30;break}for(;he--;)y.lens[y.have++]=_}}if(y.mode===30)break;if(y.lens[256]===0){R.msg="invalid code -- missing end-of-block",y.mode=30;break}if(y.lenbits=9,K={bits:y.lenbits},Y=l(c,y.lens,0,y.nlen,y.lencode,0,y.work,K),y.lenbits=K.bits,Y){R.msg="invalid literal/lengths set",y.mode=30;break}if(y.distbits=6,y.distcode=y.distdyn,K={bits:y.distbits},Y=l(f,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,K),y.distbits=K.bits,Y){R.msg="invalid distances set",y.mode=30;break}if(y.mode=20,L===6)break e;case 20:y.mode=21;case 21:if(6<=Q&&258<=be){R.next_out=Z,R.avail_out=be,R.next_in=U,R.avail_in=Q,y.hold=W,y.bits=H,u(R,de),Z=R.next_out,ee=R.output,be=R.avail_out,U=R.next_in,q=R.input,Q=R.avail_in,W=y.hold,H=y.bits,y.mode===12&&(y.back=-1);break}for(y.back=0;Me=(x=y.lencode[W&(1<<y.lenbits)-1])>>>16&255,st=65535&x,!((Pe=x>>>24)<=H);){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}if(Me&&!(240&Me)){for(Ze=Pe,Ce=Me,lt=st;Me=(x=y.lencode[lt+((W&(1<<Ze+Ce)-1)>>Ze)])>>>16&255,st=65535&x,!(Ze+(Pe=x>>>24)<=H);){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}W>>>=Ze,H-=Ze,y.back+=Ze}if(W>>>=Pe,H-=Pe,y.back+=Pe,y.length=st,Me===0){y.mode=26;break}if(32&Me){y.back=-1,y.mode=12;break}if(64&Me){R.msg="invalid literal/length code",y.mode=30;break}y.extra=15&Me,y.mode=22;case 22:if(y.extra){for(O=y.extra;H<O;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}y.length+=W&(1<<y.extra)-1,W>>>=y.extra,H-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=23;case 23:for(;Me=(x=y.distcode[W&(1<<y.distbits)-1])>>>16&255,st=65535&x,!((Pe=x>>>24)<=H);){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}if(!(240&Me)){for(Ze=Pe,Ce=Me,lt=st;Me=(x=y.distcode[lt+((W&(1<<Ze+Ce)-1)>>Ze)])>>>16&255,st=65535&x,!(Ze+(Pe=x>>>24)<=H);){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}W>>>=Ze,H-=Ze,y.back+=Ze}if(W>>>=Pe,H-=Pe,y.back+=Pe,64&Me){R.msg="invalid distance code",y.mode=30;break}y.offset=st,y.extra=15&Me,y.mode=24;case 24:if(y.extra){for(O=y.extra;H<O;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}y.offset+=W&(1<<y.extra)-1,W>>>=y.extra,H-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){R.msg="invalid distance too far back",y.mode=30;break}y.mode=25;case 25:if(be===0)break e;if(he=de-be,y.offset>he){if((he=y.offset-he)>y.whave&&y.sane){R.msg="invalid distance too far back",y.mode=30;break}Ke=he>y.wnext?(he-=y.wnext,y.wsize-he):y.wnext-he,he>y.length&&(he=y.length),ut=y.window}else ut=ee,Ke=Z-y.offset,he=y.length;for(be<he&&(he=be),be-=he,y.length-=he;ee[Z++]=ut[Ke++],--he;);y.length===0&&(y.mode=21);break;case 26:if(be===0)break e;ee[Z++]=y.length,be--,y.mode=21;break;case 27:if(y.wrap){for(;H<32;){if(Q===0)break e;Q--,W|=q[U++]<<H,H+=8}if(de-=be,R.total_out+=de,y.total+=de,de&&(R.adler=y.check=y.flags?o(y.check,ee,de,Z-de):a(y.check,ee,de,Z-de)),de=be,(y.flags?W:g(W))!==y.check){R.msg="incorrect data check",y.mode=30;break}H=W=0}y.mode=28;case 28:if(y.wrap&&y.flags){for(;H<32;){if(Q===0)break e;Q--,W+=q[U++]<<H,H+=8}if(W!==(4294967295&y.total)){R.msg="incorrect length check",y.mode=30;break}H=W=0}y.mode=29;case 29:Y=1;break e;case 30:Y=-3;break e;case 31:return-4;case 32:default:return h}return R.next_out=Z,R.avail_out=be,R.next_in=U,R.avail_in=Q,y.hold=W,y.bits=H,(y.wsize||de!==R.avail_out&&y.mode<30&&(y.mode<27||L!==4))&&G(R,R.output,R.next_out,de-R.avail_out)?(y.mode=31,-4):(pe-=R.avail_in,de-=R.avail_out,R.total_in+=pe,R.total_out+=de,y.total+=de,y.wrap&&de&&(R.adler=y.check=y.flags?o(y.check,ee,de,R.next_out-de):a(y.check,ee,de,R.next_out-de)),R.data_type=y.bits+(y.last?64:0)+(y.mode===12?128:0)+(y.mode===20||y.mode===15?256:0),(pe==0&&de===0||L===4)&&Y===d&&(Y=-5),Y)},n.inflateEnd=function(R){if(!R||!R.state)return h;var L=R.state;return L.window&&(L.window=null),R.state=null,d},n.inflateGetHeader=function(R,L){var y;return R&&R.state&&2&(y=R.state).wrap?((y.head=L).done=!1,d):h},n.inflateSetDictionary=function(R,L){var y,q=L.length;return R&&R.state?(y=R.state).wrap!==0&&y.mode!==11?h:y.mode===11&&a(1,L,q,0)!==y.check?-3:G(R,L,q,q)?(y.mode=31,-4):(y.havedict=1,d):h},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,r,n){var i=t("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(c,f,d,h,p,m,b,g){var D,v,C,k,I,F,T,N,j,G=g.bits,R=0,L=0,y=0,q=0,ee=0,U=0,Z=0,Q=0,be=0,W=0,H=null,pe=0,de=new i.Buf16(16),he=new i.Buf16(16),Ke=null,ut=0;for(R=0;R<=15;R++)de[R]=0;for(L=0;L<h;L++)de[f[d+L]]++;for(ee=G,q=15;1<=q&&de[q]===0;q--);if(q<ee&&(ee=q),q===0)return p[m++]=20971520,p[m++]=20971520,g.bits=1,0;for(y=1;y<q&&de[y]===0;y++);for(ee<y&&(ee=y),R=Q=1;R<=15;R++)if(Q<<=1,(Q-=de[R])<0)return-1;if(0<Q&&(c===0||q!==1))return-1;for(he[1]=0,R=1;R<15;R++)he[R+1]=he[R]+de[R];for(L=0;L<h;L++)f[d+L]!==0&&(b[he[f[d+L]]++]=L);if(F=c===0?(H=Ke=b,19):c===1?(H=a,pe-=257,Ke=o,ut-=257,256):(H=u,Ke=l,-1),R=y,I=m,Z=L=W=0,C=-1,k=(be=1<<(U=ee))-1,c===1&&852<be||c===2&&592<be)return 1;for(;;){for(T=R-Z,j=b[L]<F?(N=0,b[L]):b[L]>F?(N=Ke[ut+b[L]],H[pe+b[L]]):(N=96,0),D=1<<R-Z,y=v=1<<U;p[I+(W>>Z)+(v-=D)]=T<<24|N<<16|j|0,v!==0;);for(D=1<<R-1;W&D;)D>>=1;if(D!==0?(W&=D-1,W+=D):W=0,L++,--de[R]==0){if(R===q)break;R=f[d+b[L]]}if(ee<R&&(W&k)!==C){for(Z===0&&(Z=ee),I+=y,Q=1<<(U=R-Z);U+Z<q&&!((Q-=de[U+Z])<=0);)U++,Q<<=1;if(be+=1<<U,c===1&&852<be||c===2&&592<be)return 1;p[C=W&k]=ee<<24|U<<16|I-m|0}}return W!==0&&(p[I+W]=R-Z<<24|64<<16|0),g.bits=ee,0}},{"../utils/common":41}],51:[function(t,r,n){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,r,n){var i=t("../utils/common"),a=0,o=1;function u(x){for(var $=x.length;0<=--$;)x[$]=0}var l=0,c=29,f=256,d=f+1+c,h=30,p=19,m=2*d+1,b=15,g=16,D=7,v=256,C=16,k=17,I=18,F=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],T=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G=new Array(2*(d+2));u(G);var R=new Array(2*h);u(R);var L=new Array(512);u(L);var y=new Array(256);u(y);var q=new Array(c);u(q);var ee,U,Z,Q=new Array(h);function be(x,$,te,re,V){this.static_tree=x,this.extra_bits=$,this.extra_base=te,this.elems=re,this.max_length=V,this.has_stree=x&&x.length}function W(x,$){this.dyn_tree=x,this.max_code=0,this.stat_desc=$}function H(x){return x<256?L[x]:L[256+(x>>>7)]}function pe(x,$){x.pending_buf[x.pending++]=255&$,x.pending_buf[x.pending++]=$>>>8&255}function de(x,$,te){x.bi_valid>g-te?(x.bi_buf|=$<<x.bi_valid&65535,pe(x,x.bi_buf),x.bi_buf=$>>g-x.bi_valid,x.bi_valid+=te-g):(x.bi_buf|=$<<x.bi_valid&65535,x.bi_valid+=te)}function he(x,$,te){de(x,te[2*$],te[2*$+1])}function Ke(x,$){for(var te=0;te|=1&x,x>>>=1,te<<=1,0<--$;);return te>>>1}function ut(x,$,te){var re,V,ae=new Array(b+1),De=0;for(re=1;re<=b;re++)ae[re]=De=De+te[re-1]<<1;for(V=0;V<=$;V++){var ce=x[2*V+1];ce!==0&&(x[2*V]=Ke(ae[ce]++,ce))}}function Pe(x){var $;for($=0;$<d;$++)x.dyn_ltree[2*$]=0;for($=0;$<h;$++)x.dyn_dtree[2*$]=0;for($=0;$<p;$++)x.bl_tree[2*$]=0;x.dyn_ltree[2*v]=1,x.opt_len=x.static_len=0,x.last_lit=x.matches=0}function Me(x){8<x.bi_valid?pe(x,x.bi_buf):0<x.bi_valid&&(x.pending_buf[x.pending++]=x.bi_buf),x.bi_buf=0,x.bi_valid=0}function st(x,$,te,re){var V=2*$,ae=2*te;return x[V]<x[ae]||x[V]===x[ae]&&re[$]<=re[te]}function Ze(x,$,te){for(var re=x.heap[te],V=te<<1;V<=x.heap_len&&(V<x.heap_len&&st($,x.heap[V+1],x.heap[V],x.depth)&&V++,!st($,re,x.heap[V],x.depth));)x.heap[te]=x.heap[V],te=V,V<<=1;x.heap[te]=re}function Ce(x,$,te){var re,V,ae,De,ce=0;if(x.last_lit!==0)for(;re=x.pending_buf[x.d_buf+2*ce]<<8|x.pending_buf[x.d_buf+2*ce+1],V=x.pending_buf[x.l_buf+ce],ce++,re===0?he(x,V,$):(he(x,(ae=y[V])+f+1,$),(De=F[ae])!==0&&de(x,V-=q[ae],De),he(x,ae=H(--re),te),(De=T[ae])!==0&&de(x,re-=Q[ae],De)),ce<x.last_lit;);he(x,v,$)}function lt(x,$){var te,re,V,ae=$.dyn_tree,De=$.stat_desc.static_tree,ce=$.stat_desc.has_stree,ke=$.stat_desc.elems,Ue=-1;for(x.heap_len=0,x.heap_max=m,te=0;te<ke;te++)ae[2*te]!==0?(x.heap[++x.heap_len]=Ue=te,x.depth[te]=0):ae[2*te+1]=0;for(;x.heap_len<2;)ae[2*(V=x.heap[++x.heap_len]=Ue<2?++Ue:0)]=1,x.depth[V]=0,x.opt_len--,ce&&(x.static_len-=De[2*V+1]);for($.max_code=Ue,te=x.heap_len>>1;1<=te;te--)Ze(x,ae,te);for(V=ke;te=x.heap[1],x.heap[1]=x.heap[x.heap_len--],Ze(x,ae,1),re=x.heap[1],x.heap[--x.heap_max]=te,x.heap[--x.heap_max]=re,ae[2*V]=ae[2*te]+ae[2*re],x.depth[V]=(x.depth[te]>=x.depth[re]?x.depth[te]:x.depth[re])+1,ae[2*te+1]=ae[2*re+1]=V,x.heap[1]=V++,Ze(x,ae,1),2<=x.heap_len;);x.heap[--x.heap_max]=x.heap[1],function(Oe,Ot){var pr,Ut,mr,nt,Ur,Si,Kt=Ot.dyn_tree,As=Ot.max_code,ql=Ot.stat_desc.static_tree,Wl=Ot.stat_desc.has_stree,Vl=Ot.stat_desc.extra_bits,ks=Ot.stat_desc.extra_base,gr=Ot.stat_desc.max_length,Hr=0;for(nt=0;nt<=b;nt++)Oe.bl_count[nt]=0;for(Kt[2*Oe.heap[Oe.heap_max]+1]=0,pr=Oe.heap_max+1;pr<m;pr++)gr<(nt=Kt[2*Kt[2*(Ut=Oe.heap[pr])+1]+1]+1)&&(nt=gr,Hr++),Kt[2*Ut+1]=nt,As<Ut||(Oe.bl_count[nt]++,Ur=0,ks<=Ut&&(Ur=Vl[Ut-ks]),Si=Kt[2*Ut],Oe.opt_len+=Si*(nt+Ur),Wl&&(Oe.static_len+=Si*(ql[2*Ut+1]+Ur)));if(Hr!==0){do{for(nt=gr-1;Oe.bl_count[nt]===0;)nt--;Oe.bl_count[nt]--,Oe.bl_count[nt+1]+=2,Oe.bl_count[gr]--,Hr-=2}while(0<Hr);for(nt=gr;nt!==0;nt--)for(Ut=Oe.bl_count[nt];Ut!==0;)As<(mr=Oe.heap[--pr])||(Kt[2*mr+1]!==nt&&(Oe.opt_len+=(nt-Kt[2*mr+1])*Kt[2*mr],Kt[2*mr+1]=nt),Ut--)}}(x,$),ut(ae,Ue,x.bl_count)}function _(x,$,te){var re,V,ae=-1,De=$[1],ce=0,ke=7,Ue=4;for(De===0&&(ke=138,Ue=3),$[2*(te+1)+1]=65535,re=0;re<=te;re++)V=De,De=$[2*(re+1)+1],++ce<ke&&V===De||(ce<Ue?x.bl_tree[2*V]+=ce:V!==0?(V!==ae&&x.bl_tree[2*V]++,x.bl_tree[2*C]++):ce<=10?x.bl_tree[2*k]++:x.bl_tree[2*I]++,ae=V,Ue=(ce=0)===De?(ke=138,3):V===De?(ke=6,3):(ke=7,4))}function Y(x,$,te){var re,V,ae=-1,De=$[1],ce=0,ke=7,Ue=4;for(De===0&&(ke=138,Ue=3),re=0;re<=te;re++)if(V=De,De=$[2*(re+1)+1],!(++ce<ke&&V===De)){if(ce<Ue)for(;he(x,V,x.bl_tree),--ce!=0;);else V!==0?(V!==ae&&(he(x,V,x.bl_tree),ce--),he(x,C,x.bl_tree),de(x,ce-3,2)):ce<=10?(he(x,k,x.bl_tree),de(x,ce-3,3)):(he(x,I,x.bl_tree),de(x,ce-11,7));ae=V,Ue=(ce=0)===De?(ke=138,3):V===De?(ke=6,3):(ke=7,4)}}u(Q);var K=!1;function O(x,$,te,re){de(x,(l<<1)+(re?1:0),3),function(V,ae,De,ce){Me(V),ce&&(pe(V,De),pe(V,~De)),i.arraySet(V.pending_buf,V.window,ae,De,V.pending),V.pending+=De}(x,$,te,!0)}n._tr_init=function(x){K||(function(){var $,te,re,V,ae,De=new Array(b+1);for(V=re=0;V<c-1;V++)for(q[V]=re,$=0;$<1<<F[V];$++)y[re++]=V;for(y[re-1]=V,V=ae=0;V<16;V++)for(Q[V]=ae,$=0;$<1<<T[V];$++)L[ae++]=V;for(ae>>=7;V<h;V++)for(Q[V]=ae<<7,$=0;$<1<<T[V]-7;$++)L[256+ae++]=V;for(te=0;te<=b;te++)De[te]=0;for($=0;$<=143;)G[2*$+1]=8,$++,De[8]++;for(;$<=255;)G[2*$+1]=9,$++,De[9]++;for(;$<=279;)G[2*$+1]=7,$++,De[7]++;for(;$<=287;)G[2*$+1]=8,$++,De[8]++;for(ut(G,d+1,De),$=0;$<h;$++)R[2*$+1]=5,R[2*$]=Ke($,5);ee=new be(G,F,f+1,d,b),U=new be(R,T,0,h,b),Z=new be(new Array(0),N,0,p,D)}(),K=!0),x.l_desc=new W(x.dyn_ltree,ee),x.d_desc=new W(x.dyn_dtree,U),x.bl_desc=new W(x.bl_tree,Z),x.bi_buf=0,x.bi_valid=0,Pe(x)},n._tr_stored_block=O,n._tr_flush_block=function(x,$,te,re){var V,ae,De=0;0<x.level?(x.strm.data_type===2&&(x.strm.data_type=function(ce){var ke,Ue=4093624447;for(ke=0;ke<=31;ke++,Ue>>>=1)if(1&Ue&&ce.dyn_ltree[2*ke]!==0)return a;if(ce.dyn_ltree[18]!==0||ce.dyn_ltree[20]!==0||ce.dyn_ltree[26]!==0)return o;for(ke=32;ke<f;ke++)if(ce.dyn_ltree[2*ke]!==0)return o;return a}(x)),lt(x,x.l_desc),lt(x,x.d_desc),De=function(ce){var ke;for(_(ce,ce.dyn_ltree,ce.l_desc.max_code),_(ce,ce.dyn_dtree,ce.d_desc.max_code),lt(ce,ce.bl_desc),ke=p-1;3<=ke&&ce.bl_tree[2*j[ke]+1]===0;ke--);return ce.opt_len+=3*(ke+1)+5+5+4,ke}(x),V=x.opt_len+3+7>>>3,(ae=x.static_len+3+7>>>3)<=V&&(V=ae)):V=ae=te+5,te+4<=V&&$!==-1?O(x,$,te,re):x.strategy===4||ae===V?(de(x,2+(re?1:0),3),Ce(x,G,R)):(de(x,4+(re?1:0),3),function(ce,ke,Ue,Oe){var Ot;for(de(ce,ke-257,5),de(ce,Ue-1,5),de(ce,Oe-4,4),Ot=0;Ot<Oe;Ot++)de(ce,ce.bl_tree[2*j[Ot]+1],3);Y(ce,ce.dyn_ltree,ke-1),Y(ce,ce.dyn_dtree,Ue-1)}(x,x.l_desc.max_code+1,x.d_desc.max_code+1,De+1),Ce(x,x.dyn_ltree,x.dyn_dtree)),Pe(x),re&&Me(x)},n._tr_tally=function(x,$,te){return x.pending_buf[x.d_buf+2*x.last_lit]=$>>>8&255,x.pending_buf[x.d_buf+2*x.last_lit+1]=255&$,x.pending_buf[x.l_buf+x.last_lit]=255&te,x.last_lit++,$===0?x.dyn_ltree[2*te]++:(x.matches++,$--,x.dyn_ltree[2*(y[te]+f+1)]++,x.dyn_dtree[2*H($)]++),x.last_lit===x.lit_bufsize-1},n._tr_align=function(x){de(x,2,3),he(x,v,G),function($){$.bi_valid===16?(pe($,$.bi_buf),$.bi_buf=0,$.bi_valid=0):8<=$.bi_valid&&($.pending_buf[$.pending++]=255&$.bi_buf,$.bi_buf>>=8,$.bi_valid-=8)}(x)}},{"../utils/common":41}],53:[function(t,r,n){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,r,n){(function(i){(function(a,o){if(!a.setImmediate){var u,l,c,f,d=1,h={},p=!1,m=a.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(a);b=b&&b.setTimeout?b:a,u={}.toString.call(a.process)==="[object process]"?function(C){process.nextTick(function(){D(C)})}:function(){if(a.postMessage&&!a.importScripts){var C=!0,k=a.onmessage;return a.onmessage=function(){C=!1},a.postMessage("","*"),a.onmessage=k,C}}()?(f="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",v,!1):a.attachEvent("onmessage",v),function(C){a.postMessage(f+C,"*")}):a.MessageChannel?((c=new MessageChannel).port1.onmessage=function(C){D(C.data)},function(C){c.port2.postMessage(C)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(C){var k=m.createElement("script");k.onreadystatechange=function(){D(C),k.onreadystatechange=null,l.removeChild(k),k=null},l.appendChild(k)}):function(C){setTimeout(D,0,C)},b.setImmediate=function(C){typeof C!="function"&&(C=new Function(""+C));for(var k=new Array(arguments.length-1),I=0;I<k.length;I++)k[I]=arguments[I+1];var F={callback:C,args:k};return h[d]=F,u(d),d++},b.clearImmediate=g}function g(C){delete h[C]}function D(C){if(p)setTimeout(D,0,C);else{var k=h[C];if(k){p=!0;try{(function(I){var F=I.callback,T=I.args;switch(T.length){case 0:F();break;case 1:F(T[0]);break;case 2:F(T[0],T[1]);break;case 3:F(T[0],T[1],T[2]);break;default:F.apply(o,T)}})(k)}finally{g(C),p=!1}}}}function v(C){C.source===a&&typeof C.data=="string"&&C.data.indexOf(f)===0&&D(+C.data.slice(f.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof hn<"u"?hn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(El);var o1=El.exports;const u1=du(o1);function Do(s){let e,t,r,n,i=s[0]>1?"times":"time",a;return{c(){e=A("p"),t=J("This button was used "),r=J(s[0]),n=z(),a=J(i),E(e,"class","text-left")},m(o,u){S(o,e,u),w(e,t),w(e,r),w(e,n),w(e,a)},p(o,u){u&1&&Ae(r,o[0]),u&1&&i!==(i=o[0]>1?"times":"time")&&Ae(a,i)},d(o){o&&B(e)}}}function l1(s){let e,t,r,n,i,a=s[0]&&Do(s);return{c(){e=A("button"),e.textContent="Create Archive",t=z(),a&&a.c(),r=Fe()},m(o,u){S(o,e,u),S(o,t,u),a&&a.m(o,u),S(o,r,u),n||(i=fe(e,"click",s[1]),n=!0)},p(o,[u]){o[0]?a?a.p(o,u):(a=Do(o),a.c(),a.m(r.parentNode,r)):a&&(a.d(1),a=null)},i:X,o:X,d(o){o&&B(e),o&&B(t),a&&a.d(o),o&&B(r),n=!1,i()}}}function c1(s,e,t){let r,n,i;He(s,jt,p=>t(4,r=p)),He(s,Xn,p=>t(5,n=p)),He(s,Et,p=>t(6,i=p));let a=[],o;const u=async()=>{let p=await n.queryDocs({filter:{pathStartsWith:"/counter"}});p.length>0?t(0,o=p[0].text):t(0,o="0")};Ft(async()=>{await u()});const l=async()=>{await u();let p=o,D=(parseInt(p||"0")+1).toString(),v=await r.replica.set(i,{path:"/counter/number",text:D});console.log("new count",v),t(0,o=D)},c=async()=>{a=n.queryDocs({filter:{pathStartsWith:"/documents"}}),a.map(p=>p.path)},f=async p=>{for(let m of a){let b=p.folder(m.path.replace("/","_"));if(b.file("document.txt",JSON.stringify(m)),m.attachmentSize){let g=await r.replica.getAttachment(m),D=g?await g.bytes():void 0,v=m.path.split("/").pop().replace("!","");b.file(v,D)}}},d=async p=>{let m=await p.generateAsync({type:"blob"}),b=document.createElement("a"),g=new Date().toISOString().slice(0,10);b.href=URL.createObjectURL(m),b.download="archive_"+g+".zip",b.style.display="none",document.body.appendChild(b),b.click()};return[o,async()=>{let p=new u1;await c(),await f(p),await d(p),await l()}]}class f1 extends ye{constructor(e){super(),ve(this,e,c1,l1,we,{})}}const ei=7*24*60*60*1e3*1e3,ji=[4*ei,3*ei,2*ei,ei];function h1(s){let e=0,t=0;s.forEach(n=>{const i=parseInt(n.path.split("/")[2]),a=parseInt(n.path.split("/")[3]);e=Math.max(e,i),t=Math.max(t,a)});let r=Array(t+1);for(let n=0;n<t+1;n++)r[n]=Array(e+1).fill().map(()=>[]);return s.forEach(n=>{const i=parseInt(n.path.split("/")[2]),a=parseInt(n.path.split("/")[3]),o=n.deleteAfter,u=Date.now()*1e3,l=o-u;let c;l>ji[1]?c=0:l>ji[2]?c=1:l>ji[3]?c=2:c=3,r[a][i].push({doc:n,lunarPhase:c})}),r}function d1(s,e){return new IntersectionObserver(s,{threshold:e})}function p1(s,e){e&&s&&s.observe(e)}function _o(s){s&&s.disconnect()}const fi=[191808e7,127872e7,63936e7,0],Br=["#fff5d9","#d3e3d9","#F9DFDD","#CCE9F0"];function wo(s,e,t){const r=s.slice();return r[45]=e[t],r[47]=t,r}function yo(s,e,t){const r=s.slice();return r[48]=e[t],r[50]=t,r}function vo(s,e,t){const r=s.slice();return r[48]=e[t],r[52]=t,r}function Co(s,e,t){const r=s.slice();return r[56]=e[t],r}function Ao(s,e,t){const r=s.slice();return r[53]=e[t],r}function ko(s){let e,t=s[17].address.slice(0,5)+"",r,n,i;return{c(){e=A("button"),r=J(t),E(e,"class","h-auto mr-6")},m(a,o){S(a,e,o),w(e,r),n||(i=fe(e,"click",s[22]),n=!0)},p(a,o){o[0]&131072&&t!==(t=a[17].address.slice(0,5)+"")&&Ae(r,t)},d(a){a&&B(e),n=!1,i()}}}function Eo(s){let e,t,r;return t=new vl({props:{doc:s[3],attachment:s[1],isReply:s[2]}}),{c(){e=A("div"),oe(t.$$.fragment)},m(n,i){S(n,e,i),ue(t,e,null),r=!0},p(n,i){const a={};i[0]&8&&(a.doc=n[3]),i[0]&2&&(a.attachment=n[1]),i[0]&4&&(a.isReply=n[2]),t.$set(a)},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t)}}}function m1(s){let e;return{c(){e=J("Back to viewing")},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function g1(s){let e;return{c(){e=J("Place an artefact")},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function b1(s){let e,t,r;return t=new e1({props:{filetype:s[13],xy:s[14]}}),t.$on("success",s[25]),t.$on("close",s[26]),{c(){e=A("div"),oe(t.$$.fragment),E(e,"class","relative"),ze(e,"z-index","51")},m(n,i){S(n,e,i),ue(t,e,null),r=!0},p(n,i){const a={};i[0]&8192&&(a.filetype=n[13]),i[0]&16384&&(a.xy=n[14]),t.$set(a)},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t)}}}function D1(s){let e,t,r;return t=new Rd({props:{windowWidth:s[4]}}),t.$on("success",s[33]),t.$on("upload",s[34]),t.$on("selected",s[24]),{c(){e=A("div"),oe(t.$$.fragment),E(e,"class","relative"),ze(e,"z-index","51")},m(n,i){S(n,e,i),ue(t,e,null),r=!0},p(n,i){const a={};i[0]&16&&(a.windowWidth=n[4]),t.$set(a)},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t)}}}function _1(s){let e,t,r;return t=new $m({props:{selectedDocument:s[3]}}),t.$on("close",s[32]),{c(){e=A("div"),oe(t.$$.fragment),E(e,"class","artifact-overlay mt-[14vh] h-[80vh] w-4/5 fixed svelte-h0jpqy")},m(n,i){S(n,e,i),ue(t,e,null),r=!0},p(n,i){const a={};i[0]&8&&(a.selectedDocument=n[3]),t.$set(a)},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t)}}}function w1(s){let e=[],t=new Map,r,n,i=fi;const a=o=>o[47];for(let o=0;o<i.length;o+=1){let u=wo(s,i,o),l=a(u);t.set(l,e[o]=xo(l,u))}return{c(){for(let o=0;o<e.length;o+=1)e[o].c();r=Fe()},m(o,u){for(let l=0;l<e.length;l+=1)e[l].m(o,u);S(o,r,u),n=!0},p(o,u){u[0]&1933536&&(i=fi,me(),e=xt(e,u,a,1,o,i,t,r.parentNode,ar,xo,r,wo),ge())},i(o){if(!n){for(let u=0;u<i.length;u+=1)P(e[u]);n=!0}},o(o){for(let u=0;u<e.length;u+=1)M(e[u]);n=!1},d(o){for(let u=0;u<e.length;u+=1)e[u].d(o);o&&B(r)}}}function y1(s){let e;return{c(){e=A("div"),e.innerHTML='<h3 class="p-6">No files yet</h3>',E(e,"class","flex flex-col items-center justify-center align-middle h-[60vh]")},m(t,r){S(t,e,r)},p:X,i:X,o:X,d(t){t&&B(e)}}}function v1(s){let e,t,r=s[6].find(i),n;function i(...c){return s[30](s[50],s[52],...c)}function a(c,f){if(c[50]===0)return k1;if(c[52]===0)return A1}let o=a(s),u=o&&o(s),l=r&&Fo(s);return{c(){e=A("div"),u&&u.c(),t=z(),l&&l.c(),E(e,"class","grid-cell svelte-h0jpqy")},m(c,f){S(c,e,f),u&&u.m(e,null),w(e,t),l&&l.m(e,null),n=!0},p(c,f){s=c,u&&u.p(s,f),f[0]&64&&(r=s[6].find(i)),r?l?(l.p(s,f),f[0]&64&&P(l,1)):(l=Fo(s),l.c(),P(l,1),l.m(e,null)):l&&(me(),M(l,1,1,()=>{l=null}),ge())},i(c){n||(P(l),n=!0)},o(c){M(l),n=!1},d(c){c&&B(e),u&&u.d(),l&&l.d()}}}function C1(s){let e,t,r=s[5][s[52]][s[50]]&&s[5][s[52]][s[50]].length>0&&Bo(s);return{c(){r&&r.c(),e=Fe()},m(n,i){r&&r.m(n,i),S(n,e,i),t=!0},p(n,i){n[5][n[52]][n[50]]&&n[5][n[52]][n[50]].length>0?r?(r.p(n,i),i[0]&32&&P(r,1)):(r=Bo(n),r.c(),P(r,1),r.m(e.parentNode,e)):r&&(me(),M(r,1,1,()=>{r=null}),ge())},i(n){t||(P(r),t=!0)},o(n){M(r),t=!1},d(n){r&&r.d(n),n&&B(e)}}}function A1(s){let e,t=s[50]+1+"",r;return{c(){e=A("p"),r=J(t),E(e,"class","text-left text-xl")},m(n,i){S(n,e,i),w(e,r)},p:X,d(n){n&&B(e)}}}function k1(s){let e,t=Fl(s[52])+"",r,n,i,a=s[52]===0&&E1(s);return{c(){e=A("p"),r=J(t),n=z(),a&&a.c(),i=Fe(),E(e,"class","text-xl")},m(o,u){S(o,e,u),w(e,r),S(o,n,u),a&&a.m(o,u),S(o,i,u)},p(o,u){o[52]===0&&a.p(o,u)},d(o){o&&B(e),o&&B(n),a&&a.d(o),o&&B(i)}}}function E1(s){let e,t=s[50]+1+"",r;return{c(){e=A("p"),r=J(t),E(e,"class","text-left text-xl")},m(n,i){S(n,e,i),w(e,r)},p:X,d(n){n&&B(e)}}}function Fo(s){let e=[],t=new Map,r,n;function i(...u){return s[36](s[50],s[52],...u)}let a=s[6].filter(i);const o=u=>u[56].textHash+u[56].timestamp;for(let u=0;u<a.length;u+=1){let l=Co(s,a,u),c=o(l);t.set(c,e[u]=So(c,l))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();r=Fe()},m(u,l){for(let c=0;c<e.length;c+=1)e[c].m(u,l);S(u,r,l),n=!0},p(u,l){s=u,l[0]&1835072&&(a=s[6].filter(i),me(),e=xt(e,l,o,1,s,a,t,r.parentNode,ar,So,r,Co),ge())},i(u){if(!n){for(let l=0;l<a.length;l+=1)P(e[l]);n=!0}},o(u){for(let l=0;l<e.length;l+=1)M(e[l]);n=!1},d(u){for(let l=0;l<e.length;l+=1)e[l].d(u);u&&B(r)}}}function F1(s){let e,t,r,n,i;e=new hr({props:{doc:s[56]}});function a(){return s[38](s[56])}return n=new Ln({props:{replies:dr,phase:s[45],doc:s[56]}}),n.$on("click",a),{c(){oe(e.$$.fragment),t=z(),r=A("div"),oe(n.$$.fragment),E(r,"class","orbit-icon svelte-h0jpqy")},m(o,u){ue(e,o,u),S(o,t,u),S(o,r,u),ue(n,r,null),i=!0},p(o,u){s=o;const l={};u[0]&64&&(l.doc=s[56]),e.$set(l);const c={};u[0]&64&&(c.doc=s[56]),n.$set(c)},i(o){i||(P(e.$$.fragment,o),P(n.$$.fragment,o),i=!0)},o(o){M(e.$$.fragment,o),M(n.$$.fragment,o),i=!1},d(o){le(e,o),o&&B(t),o&&B(r),le(n)}}}function S1(s){let e,t,r,n,i;return e=new hr({props:{doc:s[56],disabled:!0}}),n=new Ln({props:{replies:dr,phase:s[45],doc:s[56],disabled:!0}}),{c(){oe(e.$$.fragment),t=z(),r=A("div"),oe(n.$$.fragment),E(r,"class","orbit-icon svelte-h0jpqy")},m(a,o){ue(e,a,o),S(a,t,o),S(a,r,o),ue(n,r,null),i=!0},p(a,o){const u={};o[0]&64&&(u.doc=a[56]),e.$set(u);const l={};o[0]&64&&(l.doc=a[56]),n.$set(l)},i(a){i||(P(e.$$.fragment,a),P(n.$$.fragment,a),i=!0)},o(a){M(e.$$.fragment,a),M(n.$$.fragment,a),i=!1},d(a){le(e,a),a&&B(t),a&&B(r),le(n)}}}function B1(s){let e,t,r,n;const i=[T1,I1],a=[];function o(u,l){return u[19]<u[56].deleteAfter-u[45]?1:0}return e=o(s),t=a[e]=i[e](s),{c(){t.c(),r=Fe()},m(u,l){a[e].m(u,l),S(u,r,l),n=!0},p(u,l){let c=e;e=o(u),e===c?a[e].p(u,l):(me(),M(a[c],1,1,()=>{a[c]=null}),ge(),t=a[e],t?t.p(u,l):(t=a[e]=i[e](u),t.c()),P(t,1),t.m(r.parentNode,r))},i(u){n||(P(t),n=!0)},o(u){M(t),n=!1},d(u){a[e].d(u),u&&B(r)}}}function I1(s){let e,t,r,n,i;e=new hr({props:{doc:s[56]}});function a(){return s[37](s[56])}return n=new Ln({props:{replies:dr,phase:s[45],doc:s[56]}}),n.$on("click",a),{c(){oe(e.$$.fragment),t=z(),r=A("div"),oe(n.$$.fragment),E(r,"class","orbit-icon svelte-h0jpqy")},m(o,u){ue(e,o,u),S(o,t,u),S(o,r,u),ue(n,r,null),i=!0},p(o,u){s=o;const l={};u[0]&64&&(l.doc=s[56]),e.$set(l);const c={};u[0]&64&&(c.doc=s[56]),n.$set(c)},i(o){i||(P(e.$$.fragment,o),P(n.$$.fragment,o),i=!0)},o(o){M(e.$$.fragment,o),M(n.$$.fragment,o),i=!1},d(o){le(e,o),o&&B(t),o&&B(r),le(n)}}}function T1(s){let e,t,r,n,i;return e=new hr({props:{doc:s[56],disabled:!0}}),n=new Ln({props:{replies:dr,phase:s[45],doc:s[56],disabled:!0}}),{c(){oe(e.$$.fragment),t=z(),r=A("div"),oe(n.$$.fragment),E(r,"class","orbit-icon svelte-h0jpqy")},m(a,o){ue(e,a,o),S(a,t,o),S(a,r,o),ue(n,r,null),i=!0},p(a,o){const u={};o[0]&64&&(u.doc=a[56]),e.$set(u);const l={};o[0]&64&&(l.doc=a[56]),n.$set(l)},i(a){i||(P(e.$$.fragment,a),P(n.$$.fragment,a),i=!0)},o(a){M(e.$$.fragment,a),M(n.$$.fragment,a),i=!1},d(a){le(e,a),a&&B(t),a&&B(r),le(n)}}}function So(s,e){let t,r,n,i,a;const o=[B1,S1,F1],u=[];function l(c,f){return c[45]==fi[0]?0:c[19]<c[56].deleteAfter-c[45]&&c[19]>c[56].deleteAfter-(c[45]+63936e7)?2:1}return r=l(e),n=u[r]=o[r](e),{key:s,first:null,c(){t=A("div"),n.c(),E(t,"id",i=e[56].textHash+e[56].timestamp),E(t,"class","orbit-icon-container svelte-h0jpqy"),this.first=t},m(c,f){S(c,t,f),u[r].m(t,null),a=!0},p(c,f){e=c;let d=r;r=l(e),r===d?u[r].p(e,f):(me(),M(u[d],1,1,()=>{u[d]=null}),ge(),n=u[r],n?n.p(e,f):(n=u[r]=o[r](e),n.c()),P(n,1),n.m(t,null)),(!a||f[0]&64&&i!==(i=e[56].textHash+e[56].timestamp))&&E(t,"id",i)},i(c){a||(P(n),a=!0)},o(c){M(n),a=!1},d(c){c&&B(t),u[r].d()}}}function Bo(s){let e,t=s[50]+"",r,n,i=s[52]+"",a,o,u,l=s[5][s[52]][s[50]],c=[];for(let d=0;d<l.length;d+=1)c[d]=Io(Ao(s,l,d));const f=d=>M(c[d],1,1,()=>{c[d]=null});return{c(){e=A("div"),r=J(t),n=J(","),a=J(i),o=z();for(let d=0;d<c.length;d+=1)c[d].c();E(e,"id",`phase${s[47]}_cell_${s[50]}_${s[52]}`),E(e,"class","grid-cell svelte-h0jpqy")},m(d,h){S(d,e,h),w(e,r),w(e,n),w(e,a),w(e,o);for(let p=0;p<c.length;p+=1)c[p].m(e,null);u=!0},p(d,h){if(h[0]&1310752){l=d[5][d[52]][d[50]];let p;for(p=0;p<l.length;p+=1){const m=Ao(d,l,p);c[p]?(c[p].p(m,h),P(c[p],1)):(c[p]=Io(m),c[p].c(),P(c[p],1),c[p].m(e,null))}for(me(),p=l.length;p<c.length;p+=1)f(p);ge()}},i(d){if(!u){for(let h=0;h<l.length;h+=1)P(c[h]);u=!0}},o(d){c=c.filter(Boolean);for(let h=0;h<c.length;h+=1)M(c[h]);u=!1},d(d){d&&B(e),on(c,d)}}}function R1(s){let e,t,r,n,i;return e=new hr({props:{doc:s[53].doc,disabled:!0}}),n=new Ln({props:{replies:dr,phase:s[45],doc:s[53].doc,disabled:!0}}),{c(){oe(e.$$.fragment),t=z(),r=A("div"),oe(n.$$.fragment),E(r,"class","orbit-icon svelte-h0jpqy")},m(a,o){ue(e,a,o),S(a,t,o),S(a,r,o),ue(n,r,null),i=!0},p(a,o){const u={};o[0]&32&&(u.doc=a[53].doc),e.$set(u);const l={};o[0]&32&&(l.doc=a[53].doc),n.$set(l)},i(a){i||(P(e.$$.fragment,a),P(n.$$.fragment,a),i=!0)},o(a){M(e.$$.fragment,a),M(n.$$.fragment,a),i=!1},d(a){le(e,a),a&&B(t),a&&B(r),le(n)}}}function x1(s){let e,t,r,n,i;e=new hr({props:{doc:s[53].doc}});function a(){return s[35](s[53])}return n=new Ln({props:{replies:dr,phase:s[47],doc:s[53].doc}}),n.$on("click",a),{c(){oe(e.$$.fragment),t=z(),r=A("div"),oe(n.$$.fragment),E(r,"class","orbit-icon svelte-h0jpqy")},m(o,u){ue(e,o,u),S(o,t,u),S(o,r,u),ue(n,r,null),i=!0},p(o,u){s=o;const l={};u[0]&32&&(l.doc=s[53].doc),e.$set(l);const c={};u[0]&32&&(c.doc=s[53].doc),n.$set(c)},i(o){i||(P(e.$$.fragment,o),P(n.$$.fragment,o),i=!0)},o(o){M(e.$$.fragment,o),M(n.$$.fragment,o),i=!1},d(o){le(e,o),o&&B(t),o&&B(r),le(n)}}}function Io(s){let e,t,r,n,i;const a=[x1,R1],o=[];function u(l,c){return l[53].lunarPhase===l[47]?0:1}return t=u(s),r=o[t]=a[t](s),{c(){e=A("div"),r.c(),E(e,"id",n=s[50]+s[52]+s[53].doc.textHash+s[53].doc.timestamp),E(e,"class","orbit-icon-container svelte-h0jpqy")},m(l,c){S(l,e,c),o[t].m(e,null),i=!0},p(l,c){let f=t;t=u(l),t===f?o[t].p(l,c):(me(),M(o[f],1,1,()=>{o[f]=null}),ge(),r=o[t],r?r.p(l,c):(r=o[t]=a[t](l),r.c()),P(r,1),r.m(e,null)),(!i||c[0]&32&&n!==(n=l[50]+l[52]+l[53].doc.textHash+l[53].doc.timestamp))&&E(e,"id",n)},i(l){i||(P(r),i=!0)},o(l){M(r),i=!1},d(l){l&&B(e),o[t].d()}}}function To(s,e){let t,r,n,i,a;const o=[C1,v1],u=[];function l(c,f){return c[7]?0:1}return r=l(e),n=u[r]=o[r](e),{key:s,first:null,c(){t=Fe(),n.c(),i=Fe(),this.first=t},m(c,f){S(c,t,f),u[r].m(c,f),S(c,i,f),a=!0},p(c,f){e=c;let d=r;r=l(e),r===d?u[r].p(e,f):(me(),M(u[d],1,1,()=>{u[d]=null}),ge(),n=u[r],n?n.p(e,f):(n=u[r]=o[r](e),n.c()),P(n,1),n.m(i.parentNode,i))},i(c){a||(P(n),a=!0)},o(c){M(n),a=!1},d(c){c&&B(t),u[r].d(c),c&&B(i)}}}function Ro(s,e){let t,r=[],n=new Map,i,a,o={length:e[18][1]};const u=l=>l[52];for(let l=0;l<o.length;l+=1){let c=vo(e,o,l),f=u(c);n.set(f,r[l]=To(f,c))}return{key:s,first:null,c(){t=Fe();for(let l=0;l<r.length;l+=1)r[l].c();i=Fe(),this.first=t},m(l,c){S(l,t,c);for(let f=0;f<r.length;f+=1)r[f].m(l,c);S(l,i,c),a=!0},p(l,c){e=l,c[0]&1835232&&(o={length:e[18][1]},me(),r=xt(r,c,u,1,e,o,n,i.parentNode,ar,To,i,vo),ge())},i(l){if(!a){for(let c=0;c<o.length;c+=1)P(r[c]);a=!0}},o(l){for(let c=0;c<r.length;c+=1)M(r[c]);a=!1},d(l){l&&B(t);for(let c=0;c<r.length;c+=1)r[c].d(l);l&&B(i)}}}function xo(s,e){let t,r=[],n=new Map,i,a,o,u={length:e[18][0]};const l=c=>c[50];for(let c=0;c<u.length;c+=1){let f=yo(e,u,c),d=l(f);n.set(d,r[c]=Ro(d,f))}return{key:s,first:null,c(){t=A("div");for(let c=0;c<r.length;c+=1)r[c].c();i=z(),E(t,"id",`section${e[47]}`),E(t,"class","my-grid-container w-screen svelte-h0jpqy"),E(t,"style",a=`background-color: ${Br[e[47]]}; ${e[7]?"grid-template-columns: repeat(3, 1fr); grid-template-rows: auto;":`grid-template-columns: ${e[15]}; grid-template-rows: ${e[16]};`}`),this.first=t},m(c,f){S(c,t,f);for(let d=0;d<r.length;d+=1)r[d].m(t,null);w(t,i),o=!0},p(c,f){e=c,f[0]&1835232&&(u={length:e[18][0]},me(),r=xt(r,f,l,1,e,u,n,t,ar,Ro,i,yo),ge()),(!o||f[0]&98432&&a!==(a=`background-color: ${Br[e[47]]}; ${e[7]?"grid-template-columns: repeat(3, 1fr); grid-template-rows: auto;":`grid-template-columns: ${e[15]}; grid-template-rows: ${e[16]};`}`))&&E(t,"style",a)},i(c){if(!o){for(let f=0;f<u.length;f+=1)P(r[f]);o=!0}},o(c){for(let f=0;f<r.length;f+=1)M(r[f]);o=!1},d(c){c&&B(t);for(let f=0;f<r.length;f+=1)r[f].d()}}}function P1(s){let e,t,r,n,i,a=s[3]?`${s[11]}, ${s[10]} `:"No document selected",o,u,l,c,f,d,h,p,m,b,g,D,v,C,k,I,F=s[0]&&ko(s),T=s[3]&&Eo(s);function N(Z,Q){return Z[9]?g1:m1}let j=N(s),G=j(s);const R=[_1,D1,b1],L=[];function y(Z,Q){return Z[3]?0:Z[9]?Z[12]?2:-1:1}~(p=y(s))&&(m=L[p]=R[p](s));const q=[y1,w1],ee=[];function U(Z,Q){return Z[6].length===0?0:1}return D=U(s),v=ee[D]=q[D](s),{c(){e=A("div"),F&&F.c(),t=z(),r=A("div"),n=A("div"),i=A("p"),o=J(a),u=z(),T&&T.c(),l=z(),c=A("button"),G.c(),f=z(),d=A("div"),h=A("div"),m&&m.c(),b=z(),g=A("div"),v.c(),E(e,"class","w-screen flex flex-row justify-end h-[10vh]"),E(i,"class","text-left text-xl font-bold mb-2"),E(c,"class","my-6"),E(n,"class","mx-1 mt-10 w-1/5 side-bar flex flex-col p-8 h-[80vh] fixed z-50"),ze(n,"background-color",s[8]),ze(n,"transition","background-color 1s ease"),E(g,"class","flex flex-col w-auto"),E(h,"class","my-grid-container-wrapper svelte-h0jpqy"),E(d,"class","w-[80vw] mt-10 ml-[20vw]"),E(r,"class","the-scroll flex min-h-screen overflow-y-auto svelte-h0jpqy")},m(Z,Q){S(Z,e,Q),F&&F.m(e,null),S(Z,t,Q),S(Z,r,Q),w(r,n),w(n,i),w(i,o),w(n,u),T&&T.m(n,null),w(n,l),w(n,c),G.m(c,null),w(r,f),w(r,d),w(d,h),~p&&L[p].m(h,null),w(h,b),w(h,g),ee[D].m(g,null),C=!0,k||(I=[fe(e,"click",s[31]),fe(e,"keydown",s[23]),fe(c,"click",s[21])],k=!0)},p(Z,Q){Z[0]?F?F.p(Z,Q):(F=ko(Z),F.c(),F.m(e,null)):F&&(F.d(1),F=null),(!C||Q[0]&3080)&&a!==(a=Z[3]?`${Z[11]}, ${Z[10]} `:"No document selected")&&Ae(o,a),Z[3]?T?(T.p(Z,Q),Q[0]&8&&P(T,1)):(T=Eo(Z),T.c(),P(T,1),T.m(n,l)):T&&(me(),M(T,1,1,()=>{T=null}),ge()),j!==(j=N(Z))&&(G.d(1),G=j(Z),G&&(G.c(),G.m(c,null))),(!C||Q[0]&256)&&ze(n,"background-color",Z[8]);let be=p;p=y(Z),p===be?~p&&L[p].p(Z,Q):(m&&(me(),M(L[be],1,1,()=>{L[be]=null}),ge()),~p?(m=L[p],m?m.p(Z,Q):(m=L[p]=R[p](Z),m.c()),P(m,1),m.m(h,b)):m=null);let W=D;D=U(Z),D===W?ee[D].p(Z,Q):(me(),M(ee[W],1,1,()=>{ee[W]=null}),ge(),v=ee[D],v?v.p(Z,Q):(v=ee[D]=q[D](Z),v.c()),P(v,1),v.m(g,null))},i(Z){C||(P(T),P(m),P(v),C=!0)},o(Z){M(T),M(m),M(v),C=!1},d(Z){Z&&B(e),F&&F.d(),Z&&B(t),Z&&B(r),T&&T.d(),G.d(),~p&&L[p].d(),ee[D].d(),k=!1,je(I)}}}let dr=!1;function Fl(s){return String.fromCharCode(65+s)}function O1(s,e,t){let r,n,i;He(s,Xn,Ce=>t(40,r=Ce)),He(s,pl,Ce=>t(41,n=Ce)),He(s,Et,Ce=>t(17,i=Ce));const a=bt();let{showDetails:o=!0}=e,{IDcreated:u=!1}=e,{attachment:l=!0}=e,{isReply:c=!1}=e,f=[6,9],d=Array(f[0]).fill().map(()=>Array(f[1]).fill(!1)),h=[],p=n.getTime()*1e3,m=!1,b,g=Br[0];function D(){_o(b);let Ce;window.innerWidth<=768?Ce=.45:Ce=.5,b=d1(_=>{_.forEach(Y=>{if(Y.isIntersecting){let K=parseInt(Y.target.getAttribute("id").replace("section",""));t(8,g=Br[K%Br.length])}})},Ce)}rc(()=>{fi.forEach((Ce,lt)=>{const _=document.querySelector(`#section${lt}`);p1(b,_)})}),gu(()=>{_o(b)});let v=!0,C=null,k,I,F,T,N=!1,j=null,G=[0,0],R,L;Xn.subscribe(Ce=>{console.log("Cache details changed:",Ce)});function y(Ce){t(3,C=Ce),console.log("selecteddoc",Ce)}const q=async()=>{t(6,h=r.queryDocs({filter:{pathStartsWith:"/documents"}})),t(6,h=h.filter(Ce=>Ce.path.split("/").length<=6)),console.log("Docs",h),t(5,d=h1(h))};r.onCacheUpdated(()=>{q()}),Ft(()=>{q()});function ee(){t(9,v=!v),t(3,C=null)}function U(){a("toggle")}function Z(Ce){Ce.key==="Escape"&&t(3,C=null)}function Q(Ce){t(12,N=!0),t(9,v=!0),t(3,C=null),t(13,j=Ce.detail.type),t(14,G=Ce.detail.location),console.log("filetype",j),console.log("xy",G)}function be(){t(12,N=!1),t(9,v=!0),t(3,C=null),t(13,j=null),t(14,G=[0,0])}function W(){t(12,N=!1),t(9,v=!0),t(3,C=null),t(13,j=null),t(14,G=[0,0])}let H;Ft(()=>{t(4,H=window.innerWidth),window.addEventListener("resize",()=>{t(4,H=window.innerWidth)})});const pe=(Ce,lt,_)=>parseInt(_.path.split("/")[2])==Ce&&parseInt(_.path.split("/")[3])==lt,de=()=>t(3,C=null),he=()=>t(3,C=null),Ke=()=>t(9,v=!v),ut=()=>t(9,v=!v),Pe=Ce=>y(Ce.doc),Me=(Ce,lt,_)=>parseInt(_.path.split("/")[2])==Ce&&parseInt(_.path.split("/")[3])==lt,st=Ce=>y(Ce),Ze=Ce=>y(Ce);return s.$$set=Ce=>{"showDetails"in Ce&&t(27,o=Ce.showDetails),"IDcreated"in Ce&&t(0,u=Ce.IDcreated),"attachment"in Ce&&t(1,l=Ce.attachment),"isReply"in Ce&&t(2,c=Ce.isReply)},s.$$.update=()=>{if(s.$$.dirty[0]&805306376&&C){let Ce=C.path.split("/");t(28,k=Ce[2]),t(29,I=Ce[3]),t(10,F=Number(k)+1),t(11,T=Fl(Number(I)))}s.$$.dirty[0]&16&&(H<=768?(t(7,m=!0),t(15,R="repeat(3, minmax(min-content, 1fr))"),t(16,L="repeat(18, minmax(min-content, 1fr))")):(t(7,m=!1),t(15,R="repeat("+f[1]+", minmax(min-content, 1fr))"),t(16,L="repeat("+f[0]+", minmax(min-content, 1fr))")),D())},t(4,H=window.innerWidth),[u,l,c,C,H,d,h,m,g,v,F,T,N,j,G,R,L,i,f,p,y,ee,U,Z,Q,be,W,o,k,I,pe,de,he,Ke,ut,Pe,Me,st,Ze]}class N1 extends ye{constructor(e){super(),ve(this,e,O1,P1,we,{showDetails:27,IDcreated:0,attachment:1,isReply:2},null,[-1,-1])}}function Po(s,e,t){const r=s.slice();return r[10]=e[t],r}function Oo(s,e,t){const r=s.slice();return r[13]=e[t],r[15]=t,r}function M1(s){let e,t,r,n,i,a=[],o=new Map,u=Re.servers;const l=c=>c[15];for(let c=0;c<u.length;c+=1){let f=Oo(s,u,c),d=l(f);o.set(d,a[c]=No(d,f))}return{c(){e=A("div"),t=A("p"),r=A("b"),r.textContent=`${Re.servers.length===1?"Server:":`${Re.servers.length} Servers:`}`,n=z(),i=A("ul");for(let c=0;c<a.length;c+=1)a[c].c();E(t,"class","svelte-1vxr72o")},m(c,f){S(c,e,f),w(e,t),w(t,r),w(e,n),w(e,i);for(let d=0;d<a.length;d+=1)a[d].m(i,null)},p(c,f){f&0&&(u=Re.servers,a=xt(a,f,l,1,c,u,o,i,Pn,No,null,Oo))},d(c){c&&B(e);for(let f=0;f<a.length;f+=1)a[f].d()}}}function No(s,e){let t,r=e[13]+"",n;return{key:s,first:null,c(){t=A("li"),n=J(r),this.first=t},m(i,a){S(i,t,a),w(t,n)},p(i,a){e=i},d(i){i&&B(t)}}}function Mo(s){let e,t,r,n,i,a=s[1].status+"",o,u,l,c,f,d,h,p,m,b,g,D,v,C,k,I,F,T,N,j,G,R,L,y,q,ee,U=s[6]&&Lo(s);return{c(){e=A("div"),t=A("div"),r=A("h4"),n=J("Status: "),i=A("strong"),o=J(a),u=z(),l=A("h4"),c=J("Share "),f=A("strong"),d=J(s[7]),h=z(),p=A("div"),m=A("h4"),m.textContent="Documents",b=z(),g=A("p"),D=A("strong"),v=J(s[3]),C=J(" documents sent"),k=z(),I=A("p"),F=A("strong"),T=J(s[4]),N=J(" documents received"),j=z(),G=A("p"),R=A("strong"),L=J(s[5]),y=J(" documents requested"),q=z(),U&&U.c(),ee=Fe(),E(t,"class","flex-col py-4"),E(g,"class","svelte-1vxr72o"),E(I,"class","svelte-1vxr72o"),E(G,"class","svelte-1vxr72o"),E(p,"class","flex-col items-center py-4"),E(e,"class","flex flex-col")},m(Z,Q){S(Z,e,Q),w(e,t),w(t,r),w(r,n),w(r,i),w(i,o),w(t,u),w(t,l),w(l,c),w(l,f),w(f,d),w(e,h),w(e,p),w(p,m),w(p,b),w(p,g),w(g,D),w(D,v),w(g,C),w(p,k),w(p,I),w(I,F),w(F,T),w(I,N),w(p,j),w(p,G),w(G,R),w(R,L),w(G,y),S(Z,q,Q),U&&U.m(Z,Q),S(Z,ee,Q)},p(Z,Q){Q&2&&a!==(a=Z[1].status+"")&&Ae(o,a),Q&128&&Ae(d,Z[7]),Q&8&&Ae(v,Z[3]),Q&16&&Ae(T,Z[4]),Q&32&&Ae(L,Z[5]),Z[6]?U?U.p(Z,Q):(U=Lo(Z),U.c(),U.m(ee.parentNode,ee)):U&&(U.d(1),U=null)},d(Z){Z&&B(e),Z&&B(q),U&&U.d(Z),Z&&B(ee)}}}function Lo(s){let e,t=s[2].length+"",r,n,i=s[2]>1?"Attachments":"Attachment",a,o,u,l=[],c=new Map,f=s[2];const d=h=>h[10].hash;for(let h=0;h<f.length;h+=1){let p=Po(s,f,h),m=d(p);c.set(m,l[h]=zo(m,p))}return{c(){e=A("h4"),r=J(t),n=z(),a=J(i),o=z(),u=A("div");for(let h=0;h<l.length;h+=1)l[h].c();E(e,"class","py-4"),E(u,"class","flex flex-col py-4 h-50vh overflow-y-scroll svelte-1vxr72o")},m(h,p){S(h,e,p),w(e,r),w(e,n),w(e,a),S(h,o,p),S(h,u,p);for(let m=0;m<l.length;m+=1)l[m].m(u,null)},p(h,p){p&4&&t!==(t=h[2].length+"")&&Ae(r,t),p&4&&i!==(i=h[2]>1?"Attachments":"Attachment")&&Ae(a,i),p&4&&(f=h[2],l=xt(l,p,d,1,h,f,c,u,Pn,zo,null,Po))},d(h){h&&B(e),h&&B(o),h&&B(u);for(let p=0;p<l.length;p+=1)l[p].d()}}}function zo(s,e){let t,r,n,i=e[10].kind+"",a,o,u,l=e[10].status+"",c,f,d,h,p,m=e[10].bytesLoaded+"",b,g,D,v,C,k=e[10].totalBytes+"",I,F,T,N,j,G=e[10].author.slice(0,9)+"",R,L,y;return{key:s,first:null,c(){t=A("div"),r=A("h5"),n=A("span"),a=J(i),o=z(),u=A("strong"),c=J(l),f=z(),d=A("p"),h=J("Bytes loaded: "),p=A("strong"),b=J(m),g=z(),D=A("p"),v=J("Total bytes: "),C=A("strong"),I=J(k),F=z(),T=A("p"),N=J("Author: "),j=A("strong"),R=J(G),L=J("..."),y=z(),E(n,"class","kind svelte-1vxr72o"),E(d,"class","svelte-1vxr72o"),E(D,"class","svelte-1vxr72o"),E(T,"class","svelte-1vxr72o"),this.first=t},m(q,ee){S(q,t,ee),w(t,r),w(r,n),w(n,a),w(r,o),w(r,u),w(u,c),w(t,f),w(t,d),w(d,h),w(d,p),w(p,b),w(t,g),w(t,D),w(D,v),w(D,C),w(C,I),w(t,F),w(t,T),w(T,N),w(T,j),w(j,R),w(j,L),w(t,y)},p(q,ee){e=q,ee&4&&i!==(i=e[10].kind+"")&&Ae(a,i),ee&4&&l!==(l=e[10].status+"")&&Ae(c,l),ee&4&&m!==(m=e[10].bytesLoaded+"")&&Ae(b,m),ee&4&&k!==(k=e[10].totalBytes+"")&&Ae(I,k),ee&4&&G!==(G=e[10].author.slice(0,9)+"")&&Ae(R,G)},d(q){q&&B(t)}}}function L1(s){let e,t,r,n,i,a,o,u=s[8].shareAddress+"",l,c,f,d,h,p=s[8].secret+"",m,b,g,D,v,C,k,I=Re.servers.length>0&&M1(s),F=s[0]!==void 0&&Mo(s);return C=new f1({}),{c(){e=A("div"),t=A("div"),r=A("h4"),r.textContent="Status Panel & Current Share Details",n=z(),i=A("p"),a=A("b"),a.textContent="Address:",o=z(),l=J(u),c=z(),f=A("p"),d=A("b"),d.textContent="Secret:",h=z(),m=J(p),b=z(),I&&I.c(),g=z(),F&&F.c(),D=z(),v=A("div"),oe(C.$$.fragment),E(r,"class","mb-6"),E(i,"class","svelte-1vxr72o"),E(f,"class","svelte-1vxr72o"),E(t,"class","flex flex-col items-left"),E(v,"class","my-4"),E(e,"class","flex flex-col px-8 p-4 w-full text-left")},m(T,N){S(T,e,N),w(e,t),w(t,r),w(t,n),w(t,i),w(i,a),w(i,o),w(i,l),w(t,c),w(t,f),w(f,d),w(f,h),w(f,m),w(e,b),I&&I.m(e,null),w(e,g),F&&F.m(e,null),w(e,D),w(e,v),ue(C,v,null),k=!0},p(T,[N]){(!k||N&256)&&u!==(u=T[8].shareAddress+"")&&Ae(l,u),(!k||N&256)&&p!==(p=T[8].secret+"")&&Ae(m,p),Re.servers.length>0&&I.p(T,N),T[0]!==void 0?F?F.p(T,N):(F=Mo(T),F.c(),F.m(e,D)):F&&(F.d(1),F=null)},i(T){k||(P(C.$$.fragment,T),k=!0)},o(T){M(C.$$.fragment,T),k=!1},d(T){T&&B(e),I&&I.d(),F&&F.d(),le(C)}}}function z1(s,e,t){let r;He(s,Mt,h=>t(8,r=h));let{status:n=void 0}=e,i,a,o,u,l,c=!1,f,d;return Mt.subscribe(h=>{t(9,d=h.shareAddress),t(7,f=d.slice(0,8))}),s.$$set=h=>{"status"in h&&t(0,n=h.status)},s.$$.update=()=>{s.$$.dirty&519&&n&&n[d]&&(t(1,i=n[d].docs),t(2,a=n[d].attachments),t(3,o=i.sentCount),t(4,u=i.receivedCount),t(5,l=i.requestedCount),t(6,c=a&&a.length>0))},[n,i,a,o,u,l,c,f,r,d]}class $1 extends ye{constructor(e){super(),ve(this,e,z1,L1,we,{status:0})}}function $o(s){let e,t,r,n,i;return{c(){e=A("input"),t=z(),r=A("button"),r.textContent="Submit address",E(e,"type","text"),E(e,"spellcheck","false"),E(e,"placeholder","Add the secret for this share"),E(e,"class","svelte-1sh2tfc"),E(r,"class","svelte-1sh2tfc")},m(a,o){S(a,e,o),tt(e,s[1]),S(a,t,o),S(a,r,o),n||(i=[fe(e,"input",s[9]),fe(r,"click",s[10])],n=!0)},p(a,o){o&2&&e.value!==a[1]&&tt(e,a[1])},d(a){a&&B(e),a&&B(t),a&&B(r),n=!1,je(i)}}}function jo(s){let e,t,r;return{c(){e=A("p"),t=A("strong"),r=J(s[3])},m(n,i){S(n,e,i),w(e,t),w(t,r)},p(n,i){i&8&&Ae(r,n[3])},d(n){n&&B(e)}}}function j1(s){let e,t,r,n,i,a,o,u,l,c,f=s[4]&&$o(s),d=s[2]&&jo(s);return{c(){e=A("div"),t=A("label"),r=J(`Add an existing share address
    `),n=A("input"),i=z(),a=A("button"),a.textContent="Submit address",o=z(),f&&f.c(),u=z(),d&&d.c(),E(n,"id","shareAddress"),E(n,"type","text"),E(n,"spellcheck","false"),E(n,"placeholder","Add a new share address"),E(n,"class","svelte-1sh2tfc"),E(a,"class","svelte-1sh2tfc"),E(t,"for","shareAddress"),ze(t,"text-align","left"),E(e,"class","svelte-1sh2tfc")},m(h,p){S(h,e,p),w(e,t),w(t,r),w(t,n),tt(n,s[0]),w(t,i),w(t,a),w(t,o),f&&f.m(t,null),w(t,u),d&&d.m(t,null),l||(c=[fe(n,"input",s[7]),fe(a,"click",s[8])],l=!0)},p(h,[p]){p&1&&n.value!==h[0]&&tt(n,h[0]),h[4]?f?f.p(h,p):(f=$o(h),f.c(),f.m(t,u)):f&&(f.d(1),f=null),h[2]?d?d.p(h,p):(d=jo(h),d.c(),d.m(t,null)):d&&(d.d(1),d=null)},i:X,o:X,d(h){h&&B(e),f&&f.d(),d&&d.d(),l=!1,je(c)}}}function U1(s,e,t){let r;He(s,Mt,m=>t(11,r=m));let n,i,a=!1,o,u=!1;function l(m){if(se(bn(m))){t(2,a=!0),t(3,o="Not a valid share address");return}else t(2,a=!1),Re.addShare(m),t(4,u=!0),console.log("You are currently signed in as",Re.author||"no-one!"),console.log("You have",Re.shares.length,"shares"),console.log("Your shares are",Re.shares)}async function c(){let m={address:n,secret:i};const b=await qe.checkKeypairIsValid(m);if(console.log(n,typeof n),console.log(i,typeof i),console.log(b),se(b)){t(2,a=!0),t(3,o="Not the right secret for this share.");return}else t(2,a=!1),Re.addSecret(n,i),console.log("You are currently signed in as",Re.author||"no-one!"),console.log("You have",Re.shares.length,"shares"),console.log("Your shares are",Re.shares),console.log("You know the secret to these shares:",Re.shareSecrets)}Ft(()=>{r!==void 0&&(Re.addShare(r.shareAddress),Re.addSecret(r.shareAddress,r.secret))});function f(){n=this.value,t(0,n)}const d=()=>l(n);function h(){i=this.value,t(1,i)}return[n,i,a,o,u,l,c,f,d,h,()=>c()]}class H1 extends ye{constructor(e){super(),ve(this,e,U1,j1,we,{})}}function Uo(s,e,t){const r=s.slice();return r[4]=e[t],r}function Ho(s,e){let t,r=e[4]+"",n,i;return{key:s,first:null,c(){t=A("option"),n=J(r),t.__value=i=e[4],t.value=t.__value,this.first=t},m(a,o){S(a,t,o),w(t,n)},p(a,o){e=a,o&2&&r!==(r=e[4]+"")&&Ae(n,r),o&2&&i!==(i=e[4])&&(t.__value=i,t.value=t.__value)},d(a){a&&B(t)}}}function q1(s){let e,t,r,n,i=[],a=new Map,o,u,l=s[1];const c=f=>f[4];for(let f=0;f<l.length;f+=1){let d=Uo(s,l,f),h=c(d);a.set(h,i[f]=Ho(h,d))}return{c(){e=A("div"),t=A("label"),t.textContent="Select Workspace",r=z(),n=A("select");for(let f=0;f<i.length;f+=1)i[f].c();E(t,"for","share-switcher"),E(t,"class","svelte-1k22enp"),E(n,"id","share-switcher"),E(n,"class","form-control svelte-1k22enp"),s[0]===void 0&&xn(()=>s[3].call(n)),E(e,"class","svelte-1k22enp")},m(f,d){S(f,e,d),w(e,t),w(e,r),w(e,n);for(let h=0;h<i.length;h+=1)i[h].m(n,null);Zn(n,s[0]),o||(u=[fe(n,"change",s[3]),fe(n,"change",s[2])],o=!0)},p(f,[d]){d&2&&(l=f[1],i=xt(i,d,c,1,f,l,a,n,Pn,Ho,null,Uo)),d&3&&Zn(n,f[0])},i:X,o:X,d(f){f&&B(e);for(let d=0;d<i.length;d+=1)i[d].d();o=!1,je(u)}}}function W1(s,e,t){let r=Zi(Mt).shareAddress;Mt.subscribe(o=>{t(0,r=o.shareAddress)});function n(o){const u=o.target.value,l=Re.shareSecrets[u];Mt.set({shareAddress:u,secret:l})}let i=[];zr.subscribe(o=>{t(1,i=[...o])});function a(){r=as(this),t(0,r),t(1,i)}return[r,i,n,a]}class V1 extends ye{constructor(e){super(),ve(this,e,W1,q1,we,{})}}function qo(s,e,t){const r=s.slice();return r[5]=e[t],r}function Wo(s,e){let t,r=e[5]+"",n,i;return{key:s,first:null,c(){t=A("option"),n=J(r),t.__value=i=e[5],t.value=t.__value,this.first=t},m(a,o){S(a,t,o),w(t,n)},p(a,o){e=a,o&4&&r!==(r=e[5]+"")&&Ae(n,r),o&4&&i!==(i=e[5])&&(t.__value=i,t.value=t.__value)},d(a){a&&B(t)}}}function K1(s){let e,t,r,n,i=[],a=new Map,o,u,l,c,f,d,h,p=s[2];const m=b=>b[5];for(let b=0;b<p.length;b+=1){let g=qo(s,p,b),D=m(g);a.set(D,i[b]=Wo(D,g))}return{c(){e=A("div"),t=A("label"),t.textContent="Remove Share / Workspace",r=z(),n=A("select");for(let b=0;b<i.length;b+=1)i[b].c();o=z(),u=A("button"),u.textContent="Remove Share",l=z(),c=A("p"),f=J(s[1]),E(t,"for","share-switcher"),E(t,"class","svelte-1i5hrjc"),E(n,"id","share-selecter"),E(n,"class","form-control svelte-1i5hrjc"),s[0]===void 0&&xn(()=>s[4].call(n)),E(u,"class","svelte-1i5hrjc"),E(e,"class","svelte-1i5hrjc")},m(b,g){S(b,e,g),w(e,t),w(e,r),w(e,n);for(let D=0;D<i.length;D+=1)i[D].m(n,null);Zn(n,s[0]),w(e,o),w(e,u),w(e,l),w(e,c),w(c,f),d||(h=[fe(n,"change",s[4]),fe(u,"click",s[3])],d=!0)},p(b,[g]){g&4&&(p=b[2],i=xt(i,g,m,1,b,p,a,n,Pn,Wo,null,qo)),g&5&&Zn(n,b[0]),g&2&&Ae(f,b[1])},i:X,o:X,d(b){b&&B(e);for(let g=0;g<i.length;g+=1)i[g].d();d=!1,je(h)}}}function Z1(s,e,t){let r;He(s,zr,u=>t(2,r=u));let n=Zi(Mt).shareAddress,i="";Mt.subscribe(u=>{t(0,n=u.shareAddress)});async function a(){if(!n)return;const u=n;Xh(u),t(1,i=`Share ${u} has been removed.`),Zi(Mt).shareAddress===u&&Mt.set({shareAddress:null,secret:null})}function o(){n=as(this),t(0,n)}return[n,i,r,a,o]}class Q1 extends ye{constructor(e){super(),ve(this,e,Z1,K1,we,{})}}function G1(s){let e,t,r,n,i,a=s[3]&&Vo(s);return{c(){e=A("div"),t=A("p"),t.textContent="Successfully generated new share keypair!",r=z(),a&&a.c(),n=z(),i=A("p"),i.textContent="This new share has been added to your workspace.",E(e,"class","text-left svelte-1kdn0fs")},m(o,u){S(o,e,u),w(e,t),w(e,r),a&&a.m(e,null),w(e,n),w(e,i)},p(o,u){o[3]?a?a.p(o,u):(a=Vo(o),a.c(),a.m(e,n)):a&&(a.d(1),a=null)},d(o){o&&B(e),a&&a.d()}}}function Y1(s){let e,t,r=s[1].message+"",n;return{c(){e=A("p"),t=J("Error: "),n=J(r)},m(i,a){S(i,e,a),w(e,t),w(e,n)},p(i,a){a&2&&r!==(r=i[1].message+"")&&Ae(n,r)},d(i){i&&B(e)}}}function Vo(s){let e,t=s[3].shareAddress+"",r,n,i,a=s[3].secret+"",o;return{c(){e=A("p"),r=J(t),n=z(),i=A("p"),o=J(a)},m(u,l){S(u,e,l),w(e,r),S(u,n,l),S(u,i,l),w(i,o)},p(u,l){l&8&&t!==(t=u[3].shareAddress+"")&&Ae(r,t),l&8&&a!==(a=u[3].secret+"")&&Ae(o,a)},d(u){u&&B(e),u&&B(n),u&&B(i)}}}function J1(s){let e,t,r,n,i,a,o,u,l,c;function f(p,m){if(p[1])return Y1;if(p[2])return G1}let d=f(s),h=d&&d(s);return{c(){e=A("div"),t=A("label"),r=J(`Generate a new share keypair
    `),n=A("input"),i=z(),a=A("button"),a.textContent="Generate New Share Keypair",o=z(),h&&h.c(),u=Fe(),E(n,"id","dbName"),E(n,"type","text"),E(n,"placeholder","Enter share name"),E(n,"class","svelte-1kdn0fs"),E(t,"for","dbName"),E(a,"class","svelte-1kdn0fs"),E(e,"class","svelte-1kdn0fs")},m(p,m){S(p,e,m),w(e,t),w(t,r),w(t,n),tt(n,s[0]),w(e,i),w(e,a),S(p,o,m),h&&h.m(p,m),S(p,u,m),l||(c=[fe(n,"input",s[5]),fe(a,"click",s[4])],l=!0)},p(p,[m]){m&1&&n.value!==p[0]&&tt(n,p[0]),d===(d=f(p))&&h?h.p(p,m):(h&&h.d(1),h=d&&d(p),h&&(h.c(),h.m(u.parentNode,u)))},i:X,o:X,d(p){p&&B(e),p&&B(o),h&&h.d(p),p&&B(u),l=!1,je(c)}}}function X1(s,e,t){let r="",n,i=!1,a;const o=async()=>{try{if(t(3,a=await qe.generateShareKeypair(r)),console.log(a),Re){const l=Re.addShare(a.shareAddress),c=Re.addSecret(a.shareAddress,a.secret);if(typeof l!="string"&&typeof c!="string")t(2,i=!0),t(1,n=null),ed(Re.shares);else throw new Error("Error adding new share keypair")}}catch(l){t(1,n=l),t(2,i=!1)}};function u(){r=this.value,t(0,r)}return[r,n,i,a,o,u]}class eg extends ye{constructor(e){super(),ve(this,e,X1,J1,we,{})}}function tg(s){let e,t,r,n,i,a,o,u,l,c,f;return n=new V1({}),a=new eg({}),u=new H1({}),c=new Q1({}),{c(){e=A("div"),t=A("h4"),t.textContent="Share Settings",r=z(),oe(n.$$.fragment),i=z(),oe(a.$$.fragment),o=z(),oe(u.$$.fragment),l=z(),oe(c.$$.fragment),E(e,"class","svelte-wv4uud")},m(d,h){S(d,e,h),w(e,t),w(e,r),ue(n,e,null),w(e,i),ue(a,e,null),w(e,o),ue(u,e,null),w(e,l),ue(c,e,null),f=!0},p:X,i(d){f||(P(n.$$.fragment,d),P(a.$$.fragment,d),P(u.$$.fragment,d),P(c.$$.fragment,d),f=!0)},o(d){M(n.$$.fragment,d),M(a.$$.fragment,d),M(u.$$.fragment,d),M(c.$$.fragment,d),f=!1},d(d){d&&B(e),le(n),le(a),le(u),le(c)}}}class ng extends ye{constructor(e){super(),ve(this,e,null,tg,we,{})}}function Ko(s,e,t){const r=s.slice();return r[13]=e[t],r}function Zo(s){let e;return{c(){e=A("p"),e.innerHTML="<strong>Server was added successfully!</strong>"},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function Qo(s){let e;return{c(){e=A("p"),e.innerHTML="<strong>Sync is complete!</strong>"},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function Go(s){let e,t,r;return{c(){e=A("p"),t=A("strong"),r=J(s[4])},m(n,i){S(n,e,i),w(e,t),w(t,r)},p(n,i){i&16&&Ae(r,n[4])},d(n){n&&B(e)}}}function Yo(s,e){let t,r=e[13]+"",n;return{key:s,first:null,c(){t=A("option"),n=J(r),t.__value=e[13],t.value=t.__value,this.first=t},m(i,a){S(i,t,a),w(t,n)},p(i,a){e=i},d(i){i&&B(t)}}}function Jo(s){let e;return{c(){e=A("p"),e.innerHTML="<strong>Server was removed successfully!</strong>"},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function rg(s){let e,t,r,n,i,a,o,u,l,c,f,d=[],h=new Map,p,m,b,g,D,v=s[5]&&Zo(),C=s[6]&&Qo(),k=s[3]&&Go(s),I=Re.servers;const F=N=>N[13];for(let N=0;N<I.length;N+=1){let j=Ko(s,I,N),G=F(j);h.set(G,d[N]=Yo(G,j))}let T=s[2]&&Jo();return{c(){e=A("div"),t=A("input"),r=z(),n=A("button"),n.textContent="Add server",i=z(),v&&v.c(),a=z(),C&&C.c(),o=z(),k&&k.c(),u=z(),l=A("div"),c=A("select"),f=A("option"),f.textContent="Select a server to remove";for(let N=0;N<d.length;N+=1)d[N].c();p=z(),m=A("button"),m.textContent="Remove server",b=z(),T&&T.c(),E(t,"type","text"),E(t,"spellcheck","false"),E(t,"placeholder","Add a new server URL"),E(t,"class","svelte-s2f1tg"),E(n,"class","svelte-s2f1tg"),E(e,"class","svelte-s2f1tg"),f.__value="",f.value=f.__value,E(c,"class","svelte-s2f1tg"),s[1]===void 0&&xn(()=>s[11].call(c)),E(m,"class","svelte-s2f1tg"),E(l,"class","svelte-s2f1tg")},m(N,j){S(N,e,j),w(e,t),tt(t,s[0]),w(e,r),w(e,n),w(e,i),v&&v.m(e,null),w(e,a),C&&C.m(e,null),w(e,o),k&&k.m(e,null),S(N,u,j),S(N,l,j),w(l,c),w(c,f);for(let G=0;G<d.length;G+=1)d[G].m(c,null);Zn(c,s[1]),w(l,p),w(l,m),w(l,b),T&&T.m(l,null),g||(D=[fe(t,"input",s[9]),fe(n,"click",s[10]),fe(c,"change",s[11]),fe(m,"click",s[8])],g=!0)},p(N,[j]){j&1&&t.value!==N[0]&&tt(t,N[0]),N[5]?v||(v=Zo(),v.c(),v.m(e,a)):v&&(v.d(1),v=null),N[6]?C||(C=Qo(),C.c(),C.m(e,o)):C&&(C.d(1),C=null),N[3]?k?k.p(N,j):(k=Go(N),k.c(),k.m(e,null)):k&&(k.d(1),k=null),j&0&&(I=Re.servers,d=xt(d,j,F,1,N,I,h,c,Pn,Yo,null,Ko)),j&2&&Zn(c,N[1]),N[2]?T||(T=Jo(),T.c(),T.m(l,null)):T&&(T.d(1),T=null)},i:X,o:X,d(N){N&&B(e),v&&v.d(),C&&C.d(),k&&k.d(),N&&B(u),N&&B(l);for(let j=0;j<d.length;j+=1)d[j].d();T&&T.d(),g=!1,je(D)}}}function ig(s,e,t){let r,n,i=!1,a=!1,o,u=!1,l=!1,c;jt.subscribe(b=>{c=b.replica});async function f(b){let g=Re.addServer(b);if(se(g)){t(3,a=!0),t(4,o="Not a valid server URL");return}else{t(3,a=!1),t(5,u=!0),console.log("You have",Re.servers.length,"servers"),console.log("Your servers are",Re.servers);const D=new Lr;D.addReplica(c),await D.sync(b).isDone(),t(6,l=!0),console.log("Sync is done")}}function d(){let b=Re.removeServer(n);se(b)?(t(3,a=!0),t(4,o="Failed to remove server")):(t(3,a=!1),t(2,i=!0),console.log("You have",Re.servers.length,"servers"),console.log("Your servers are",Re.servers))}function h(){r=this.value,t(0,r)}const p=()=>f(r);function m(){n=as(this),t(1,n)}return[r,n,i,a,o,u,l,f,d,h,p,m]}class sg extends ye{constructor(e){super(),ve(this,e,ig,rg,we,{})}}function ag(s){let e,t,r,n=JSON.stringify(s[1],null,2)+"",i;return{c(){e=A("p"),e.textContent="Parsed Invitation:",t=z(),r=A("pre"),i=J(n)},m(a,o){S(a,e,o),S(a,t,o),S(a,r,o),w(r,i)},p(a,o){o&2&&n!==(n=JSON.stringify(a[1],null,2)+"")&&Ae(i,n)},d(a){a&&B(e),a&&B(t),a&&B(r)}}}function og(s){let e;return{c(){e=A("p"),e.textContent="Successfully redeemed invitation!"},m(t,r){S(t,e,r)},p:X,d(t){t&&B(e)}}}function ug(s){let e,t,r=s[2].message+"",n;return{c(){e=A("p"),t=J("Error: "),n=J(r)},m(i,a){S(i,e,a),w(e,t),w(e,n)},p(i,a){a&4&&r!==(r=i[2].message+"")&&Ae(n,r)},d(i){i&&B(e)}}}function lg(s){let e,t,r,n,i,a,o;function u(f,d){if(f[2])return ug;if(f[3])return og;if(f[1])return ag}let l=u(s),c=l&&l(s);return{c(){e=A("input"),t=z(),r=A("button"),r.textContent="Redeem Invitation URL",n=z(),c&&c.c(),i=Fe(),E(e,"class","my-2 svelte-1xrndge"),E(e,"type","text"),E(e,"placeholder","Enter invitation URL")},m(f,d){S(f,e,d),tt(e,s[0]),S(f,t,d),S(f,r,d),S(f,n,d),c&&c.m(f,d),S(f,i,d),a||(o=[fe(e,"input",s[5]),fe(r,"click",s[4])],a=!0)},p(f,[d]){d&1&&e.value!==f[0]&&tt(e,f[0]),l===(l=u(f))&&c?c.p(f,d):(c&&c.d(1),c=l&&l(f),c&&(c.c(),c.m(i.parentNode,i)))},i:X,o:X,d(f){f&&B(e),f&&B(t),f&&B(r),f&&B(n),c&&c.d(f),f&&B(i),a=!1,je(o)}}}function cg(s,e,t){let r="",n,i,a=!1;const o=async()=>{try{const c=await Re.redeemInvitationURL(r);c===!0?(t(3,a=!0),t(2,i=null)):(t(2,i=c),t(3,a=!1))}catch(c){t(2,i=c),t(3,a=!1)}},u=async()=>{await o()};function l(){r=this.value,t(0,r)}return[r,n,i,a,u,l]}class fg extends ye{constructor(e){super(),ve(this,e,cg,lg,we,{})}}var $r={},hg=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},Sl={},Pt={};let _s;const dg=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];Pt.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};Pt.getSymbolTotalCodewords=function(e){return dg[e]};Pt.getBCHDigit=function(s){let e=0;for(;s!==0;)e++,s>>>=1;return e};Pt.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');_s=e};Pt.isKanjiModeEnabled=function(){return typeof _s<"u"};Pt.toSJIS=function(e){return _s(e)};var Ai={};(function(s){s.L={bit:1},s.M={bit:0},s.Q={bit:3},s.H={bit:2};function e(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"l":case"low":return s.L;case"m":case"medium":return s.M;case"q":case"quartile":return s.Q;case"h":case"high":return s.H;default:throw new Error("Unknown EC Level: "+t)}}s.isValid=function(r){return r&&typeof r.bit<"u"&&r.bit>=0&&r.bit<4},s.from=function(r,n){if(s.isValid(r))return r;try{return e(r)}catch{return n}}})(Ai);function Bl(){this.buffer=[],this.length=0}Bl.prototype={get:function(s){const e=Math.floor(s/8);return(this.buffer[e]>>>7-s%8&1)===1},put:function(s,e){for(let t=0;t<e;t++)this.putBit((s>>>e-t-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(s){const e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),s&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var pg=Bl;function jr(s){if(!s||s<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=s,this.data=new Uint8Array(s*s),this.reservedBit=new Uint8Array(s*s)}jr.prototype.set=function(s,e,t,r){const n=s*this.size+e;this.data[n]=t,r&&(this.reservedBit[n]=!0)};jr.prototype.get=function(s,e){return this.data[s*this.size+e]};jr.prototype.xor=function(s,e,t){this.data[s*this.size+e]^=t};jr.prototype.isReserved=function(s,e){return this.reservedBit[s*this.size+e]};var mg=jr,Il={};(function(s){const e=Pt.getSymbolSize;s.getRowColCoords=function(r){if(r===1)return[];const n=Math.floor(r/7)+2,i=e(r),a=i===145?26:Math.ceil((i-13)/(2*n-2))*2,o=[i-7];for(let u=1;u<n-1;u++)o[u]=o[u-1]-a;return o.push(6),o.reverse()},s.getPositions=function(r){const n=[],i=s.getRowColCoords(r),a=i.length;for(let o=0;o<a;o++)for(let u=0;u<a;u++)o===0&&u===0||o===0&&u===a-1||o===a-1&&u===0||n.push([i[o],i[u]]);return n}})(Il);var Tl={};const gg=Pt.getSymbolSize,Xo=7;Tl.getPositions=function(e){const t=gg(e);return[[0,0],[t-Xo,0],[0,t-Xo]]};var Rl={};(function(s){s.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};s.isValid=function(n){return n!=null&&n!==""&&!isNaN(n)&&n>=0&&n<=7},s.from=function(n){return s.isValid(n)?parseInt(n,10):void 0},s.getPenaltyN1=function(n){const i=n.size;let a=0,o=0,u=0,l=null,c=null;for(let f=0;f<i;f++){o=u=0,l=c=null;for(let d=0;d<i;d++){let h=n.get(f,d);h===l?o++:(o>=5&&(a+=e.N1+(o-5)),l=h,o=1),h=n.get(d,f),h===c?u++:(u>=5&&(a+=e.N1+(u-5)),c=h,u=1)}o>=5&&(a+=e.N1+(o-5)),u>=5&&(a+=e.N1+(u-5))}return a},s.getPenaltyN2=function(n){const i=n.size;let a=0;for(let o=0;o<i-1;o++)for(let u=0;u<i-1;u++){const l=n.get(o,u)+n.get(o,u+1)+n.get(o+1,u)+n.get(o+1,u+1);(l===4||l===0)&&a++}return a*e.N2},s.getPenaltyN3=function(n){const i=n.size;let a=0,o=0,u=0;for(let l=0;l<i;l++){o=u=0;for(let c=0;c<i;c++)o=o<<1&2047|n.get(l,c),c>=10&&(o===1488||o===93)&&a++,u=u<<1&2047|n.get(c,l),c>=10&&(u===1488||u===93)&&a++}return a*e.N3},s.getPenaltyN4=function(n){let i=0;const a=n.data.length;for(let u=0;u<a;u++)i+=n.data[u];return Math.abs(Math.ceil(i*100/a/5)-10)*e.N4};function t(r,n,i){switch(r){case s.Patterns.PATTERN000:return(n+i)%2===0;case s.Patterns.PATTERN001:return n%2===0;case s.Patterns.PATTERN010:return i%3===0;case s.Patterns.PATTERN011:return(n+i)%3===0;case s.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(i/3))%2===0;case s.Patterns.PATTERN101:return n*i%2+n*i%3===0;case s.Patterns.PATTERN110:return(n*i%2+n*i%3)%2===0;case s.Patterns.PATTERN111:return(n*i%3+(n+i)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}s.applyMask=function(n,i){const a=i.size;for(let o=0;o<a;o++)for(let u=0;u<a;u++)i.isReserved(u,o)||i.xor(u,o,t(n,u,o))},s.getBestMask=function(n,i){const a=Object.keys(s.Patterns).length;let o=0,u=1/0;for(let l=0;l<a;l++){i(l),s.applyMask(l,n);const c=s.getPenaltyN1(n)+s.getPenaltyN2(n)+s.getPenaltyN3(n)+s.getPenaltyN4(n);s.applyMask(l,n),c<u&&(u=c,o=l)}return o}})(Rl);var ki={};const dn=Ai,ti=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],ni=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];ki.getBlocksCount=function(e,t){switch(t){case dn.L:return ti[(e-1)*4+0];case dn.M:return ti[(e-1)*4+1];case dn.Q:return ti[(e-1)*4+2];case dn.H:return ti[(e-1)*4+3];default:return}};ki.getTotalCodewordsCount=function(e,t){switch(t){case dn.L:return ni[(e-1)*4+0];case dn.M:return ni[(e-1)*4+1];case dn.Q:return ni[(e-1)*4+2];case dn.H:return ni[(e-1)*4+3];default:return}};var xl={},Ei={};const Ir=new Uint8Array(512),hi=new Uint8Array(256);(function(){let e=1;for(let t=0;t<255;t++)Ir[t]=e,hi[e]=t,e<<=1,e&256&&(e^=285);for(let t=255;t<512;t++)Ir[t]=Ir[t-255]})();Ei.log=function(e){if(e<1)throw new Error("log("+e+")");return hi[e]};Ei.exp=function(e){return Ir[e]};Ei.mul=function(e,t){return e===0||t===0?0:Ir[hi[e]+hi[t]]};(function(s){const e=Ei;s.mul=function(r,n){const i=new Uint8Array(r.length+n.length-1);for(let a=0;a<r.length;a++)for(let o=0;o<n.length;o++)i[a+o]^=e.mul(r[a],n[o]);return i},s.mod=function(r,n){let i=new Uint8Array(r);for(;i.length-n.length>=0;){const a=i[0];for(let u=0;u<n.length;u++)i[u]^=e.mul(n[u],a);let o=0;for(;o<i.length&&i[o]===0;)o++;i=i.slice(o)}return i},s.generateECPolynomial=function(r){let n=new Uint8Array([1]);for(let i=0;i<r;i++)n=s.mul(n,new Uint8Array([1,e.exp(i)]));return n}})(xl);const Pl=xl;function ws(s){this.genPoly=void 0,this.degree=s,this.degree&&this.initialize(this.degree)}ws.prototype.initialize=function(e){this.degree=e,this.genPoly=Pl.generateECPolynomial(this.degree)};ws.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(e.length+this.degree);t.set(e);const r=Pl.mod(t,this.genPoly),n=this.degree-r.length;if(n>0){const i=new Uint8Array(this.degree);return i.set(r,n),i}return r};var bg=ws,Ol={},Dn={},ys={};ys.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40};var Vt={};const Nl="[0-9]+",Dg="[A-Z $%*+\\-./:]+";let Or="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";Or=Or.replace(/u/g,"\\u");const _g="(?:(?![A-Z0-9 $%*+\\-./:]|"+Or+`)(?:.|[\r
]))+`;Vt.KANJI=new RegExp(Or,"g");Vt.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");Vt.BYTE=new RegExp(_g,"g");Vt.NUMERIC=new RegExp(Nl,"g");Vt.ALPHANUMERIC=new RegExp(Dg,"g");const wg=new RegExp("^"+Or+"$"),yg=new RegExp("^"+Nl+"$"),vg=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");Vt.testKanji=function(e){return wg.test(e)};Vt.testNumeric=function(e){return yg.test(e)};Vt.testAlphanumeric=function(e){return vg.test(e)};(function(s){const e=ys,t=Vt;s.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},s.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},s.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},s.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},s.MIXED={bit:-1},s.getCharCountIndicator=function(i,a){if(!i.ccBits)throw new Error("Invalid mode: "+i);if(!e.isValid(a))throw new Error("Invalid version: "+a);return a>=1&&a<10?i.ccBits[0]:a<27?i.ccBits[1]:i.ccBits[2]},s.getBestModeForData=function(i){return t.testNumeric(i)?s.NUMERIC:t.testAlphanumeric(i)?s.ALPHANUMERIC:t.testKanji(i)?s.KANJI:s.BYTE},s.toString=function(i){if(i&&i.id)return i.id;throw new Error("Invalid mode")},s.isValid=function(i){return i&&i.bit&&i.ccBits};function r(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"numeric":return s.NUMERIC;case"alphanumeric":return s.ALPHANUMERIC;case"kanji":return s.KANJI;case"byte":return s.BYTE;default:throw new Error("Unknown mode: "+n)}}s.from=function(i,a){if(s.isValid(i))return i;try{return r(i)}catch{return a}}})(Dn);(function(s){const e=Pt,t=ki,r=Ai,n=Dn,i=ys,a=7973,o=e.getBCHDigit(a);function u(d,h,p){for(let m=1;m<=40;m++)if(h<=s.getCapacity(m,p,d))return m}function l(d,h){return n.getCharCountIndicator(d,h)+4}function c(d,h){let p=0;return d.forEach(function(m){const b=l(m.mode,h);p+=b+m.getBitsLength()}),p}function f(d,h){for(let p=1;p<=40;p++)if(c(d,p)<=s.getCapacity(p,h,n.MIXED))return p}s.from=function(h,p){return i.isValid(h)?parseInt(h,10):p},s.getCapacity=function(h,p,m){if(!i.isValid(h))throw new Error("Invalid QR Code version");typeof m>"u"&&(m=n.BYTE);const b=e.getSymbolTotalCodewords(h),g=t.getTotalCodewordsCount(h,p),D=(b-g)*8;if(m===n.MIXED)return D;const v=D-l(m,h);switch(m){case n.NUMERIC:return Math.floor(v/10*3);case n.ALPHANUMERIC:return Math.floor(v/11*2);case n.KANJI:return Math.floor(v/13);case n.BYTE:default:return Math.floor(v/8)}},s.getBestVersionForData=function(h,p){let m;const b=r.from(p,r.M);if(Array.isArray(h)){if(h.length>1)return f(h,b);if(h.length===0)return 1;m=h[0]}else m=h;return u(m.mode,m.getLength(),b)},s.getEncodedBits=function(h){if(!i.isValid(h)||h<7)throw new Error("Invalid QR Code version");let p=h<<12;for(;e.getBCHDigit(p)-o>=0;)p^=a<<e.getBCHDigit(p)-o;return h<<12|p}})(Ol);var Ml={};const ns=Pt,Ll=1335,Cg=21522,eu=ns.getBCHDigit(Ll);Ml.getEncodedBits=function(e,t){const r=e.bit<<3|t;let n=r<<10;for(;ns.getBCHDigit(n)-eu>=0;)n^=Ll<<ns.getBCHDigit(n)-eu;return(r<<10|n)^Cg};var zl={};const Ag=Dn;function er(s){this.mode=Ag.NUMERIC,this.data=s.toString()}er.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};er.prototype.getLength=function(){return this.data.length};er.prototype.getBitsLength=function(){return er.getBitsLength(this.data.length)};er.prototype.write=function(e){let t,r,n;for(t=0;t+3<=this.data.length;t+=3)r=this.data.substr(t,3),n=parseInt(r,10),e.put(n,10);const i=this.data.length-t;i>0&&(r=this.data.substr(t),n=parseInt(r,10),e.put(n,i*3+1))};var kg=er;const Eg=Dn,Ui=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function tr(s){this.mode=Eg.ALPHANUMERIC,this.data=s}tr.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};tr.prototype.getLength=function(){return this.data.length};tr.prototype.getBitsLength=function(){return tr.getBitsLength(this.data.length)};tr.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let r=Ui.indexOf(this.data[t])*45;r+=Ui.indexOf(this.data[t+1]),e.put(r,11)}this.data.length%2&&e.put(Ui.indexOf(this.data[t]),6)};var Fg=tr,Sg=function(e){for(var t=[],r=e.length,n=0;n<r;n++){var i=e.charCodeAt(n);if(i>=55296&&i<=56319&&r>n+1){var a=e.charCodeAt(n+1);a>=56320&&a<=57343&&(i=(i-55296)*1024+a-56320+65536,n+=1)}if(i<128){t.push(i);continue}if(i<2048){t.push(i>>6|192),t.push(i&63|128);continue}if(i<55296||i>=57344&&i<65536){t.push(i>>12|224),t.push(i>>6&63|128),t.push(i&63|128);continue}if(i>=65536&&i<=1114111){t.push(i>>18|240),t.push(i>>12&63|128),t.push(i>>6&63|128),t.push(i&63|128);continue}t.push(239,191,189)}return new Uint8Array(t).buffer};const Bg=Sg,Ig=Dn;function nr(s){this.mode=Ig.BYTE,typeof s=="string"&&(s=Bg(s)),this.data=new Uint8Array(s)}nr.getBitsLength=function(e){return e*8};nr.prototype.getLength=function(){return this.data.length};nr.prototype.getBitsLength=function(){return nr.getBitsLength(this.data.length)};nr.prototype.write=function(s){for(let e=0,t=this.data.length;e<t;e++)s.put(this.data[e],8)};var Tg=nr;const Rg=Dn,xg=Pt;function rr(s){this.mode=Rg.KANJI,this.data=s}rr.getBitsLength=function(e){return e*13};rr.prototype.getLength=function(){return this.data.length};rr.prototype.getBitsLength=function(){return rr.getBitsLength(this.data.length)};rr.prototype.write=function(s){let e;for(e=0;e<this.data.length;e++){let t=xg.toSJIS(this.data[e]);if(t>=33088&&t<=40956)t-=33088;else if(t>=57408&&t<=60351)t-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);t=(t>>>8&255)*192+(t&255),s.put(t,13)}};var Pg=rr,$l={exports:{}};(function(s){var e={single_source_shortest_paths:function(t,r,n){var i={},a={};a[r]=0;var o=e.PriorityQueue.make();o.push(r,0);for(var u,l,c,f,d,h,p,m,b;!o.empty();){u=o.pop(),l=u.value,f=u.cost,d=t[l]||{};for(c in d)d.hasOwnProperty(c)&&(h=d[c],p=f+h,m=a[c],b=typeof a[c]>"u",(b||m>p)&&(a[c]=p,o.push(c,p),i[c]=l))}if(typeof n<"u"&&typeof a[n]>"u"){var g=["Could not find a path from ",r," to ",n,"."].join("");throw new Error(g)}return i},extract_shortest_path_from_predecessor_list:function(t,r){for(var n=[],i=r;i;)n.push(i),t[i],i=t[i];return n.reverse(),n},find_path:function(t,r,n){var i=e.single_source_shortest_paths(t,r,n);return e.extract_shortest_path_from_predecessor_list(i,n)},PriorityQueue:{make:function(t){var r=e.PriorityQueue,n={},i;t=t||{};for(i in r)r.hasOwnProperty(i)&&(n[i]=r[i]);return n.queue=[],n.sorter=t.sorter||r.default_sorter,n},default_sorter:function(t,r){return t.cost-r.cost},push:function(t,r){var n={value:t,cost:r};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};s.exports=e})($l);var Og=$l.exports;(function(s){const e=Dn,t=kg,r=Fg,n=Tg,i=Pg,a=Vt,o=Pt,u=Og;function l(g){return unescape(encodeURIComponent(g)).length}function c(g,D,v){const C=[];let k;for(;(k=g.exec(v))!==null;)C.push({data:k[0],index:k.index,mode:D,length:k[0].length});return C}function f(g){const D=c(a.NUMERIC,e.NUMERIC,g),v=c(a.ALPHANUMERIC,e.ALPHANUMERIC,g);let C,k;return o.isKanjiModeEnabled()?(C=c(a.BYTE,e.BYTE,g),k=c(a.KANJI,e.KANJI,g)):(C=c(a.BYTE_KANJI,e.BYTE,g),k=[]),D.concat(v,C,k).sort(function(F,T){return F.index-T.index}).map(function(F){return{data:F.data,mode:F.mode,length:F.length}})}function d(g,D){switch(D){case e.NUMERIC:return t.getBitsLength(g);case e.ALPHANUMERIC:return r.getBitsLength(g);case e.KANJI:return i.getBitsLength(g);case e.BYTE:return n.getBitsLength(g)}}function h(g){return g.reduce(function(D,v){const C=D.length-1>=0?D[D.length-1]:null;return C&&C.mode===v.mode?(D[D.length-1].data+=v.data,D):(D.push(v),D)},[])}function p(g){const D=[];for(let v=0;v<g.length;v++){const C=g[v];switch(C.mode){case e.NUMERIC:D.push([C,{data:C.data,mode:e.ALPHANUMERIC,length:C.length},{data:C.data,mode:e.BYTE,length:C.length}]);break;case e.ALPHANUMERIC:D.push([C,{data:C.data,mode:e.BYTE,length:C.length}]);break;case e.KANJI:D.push([C,{data:C.data,mode:e.BYTE,length:l(C.data)}]);break;case e.BYTE:D.push([{data:C.data,mode:e.BYTE,length:l(C.data)}])}}return D}function m(g,D){const v={},C={start:{}};let k=["start"];for(let I=0;I<g.length;I++){const F=g[I],T=[];for(let N=0;N<F.length;N++){const j=F[N],G=""+I+N;T.push(G),v[G]={node:j,lastCount:0},C[G]={};for(let R=0;R<k.length;R++){const L=k[R];v[L]&&v[L].node.mode===j.mode?(C[L][G]=d(v[L].lastCount+j.length,j.mode)-d(v[L].lastCount,j.mode),v[L].lastCount+=j.length):(v[L]&&(v[L].lastCount=j.length),C[L][G]=d(j.length,j.mode)+4+e.getCharCountIndicator(j.mode,D))}}k=T}for(let I=0;I<k.length;I++)C[k[I]].end=0;return{map:C,table:v}}function b(g,D){let v;const C=e.getBestModeForData(g);if(v=e.from(D,C),v!==e.BYTE&&v.bit<C.bit)throw new Error('"'+g+'" cannot be encoded with mode '+e.toString(v)+`.
 Suggested mode is: `+e.toString(C));switch(v===e.KANJI&&!o.isKanjiModeEnabled()&&(v=e.BYTE),v){case e.NUMERIC:return new t(g);case e.ALPHANUMERIC:return new r(g);case e.KANJI:return new i(g);case e.BYTE:return new n(g)}}s.fromArray=function(D){return D.reduce(function(v,C){return typeof C=="string"?v.push(b(C,null)):C.data&&v.push(b(C.data,C.mode)),v},[])},s.fromString=function(D,v){const C=f(D,o.isKanjiModeEnabled()),k=p(C),I=m(k,v),F=u.find_path(I.map,"start","end"),T=[];for(let N=1;N<F.length-1;N++)T.push(I.table[F[N]].node);return s.fromArray(h(T))},s.rawSplit=function(D){return s.fromArray(f(D,o.isKanjiModeEnabled()))}})(zl);const Fi=Pt,Hi=Ai,Ng=pg,Mg=mg,Lg=Il,zg=Tl,rs=Rl,is=ki,$g=bg,di=Ol,jg=Ml,Ug=Dn,qi=zl;function Hg(s,e){const t=s.size,r=zg.getPositions(e);for(let n=0;n<r.length;n++){const i=r[n][0],a=r[n][1];for(let o=-1;o<=7;o++)if(!(i+o<=-1||t<=i+o))for(let u=-1;u<=7;u++)a+u<=-1||t<=a+u||(o>=0&&o<=6&&(u===0||u===6)||u>=0&&u<=6&&(o===0||o===6)||o>=2&&o<=4&&u>=2&&u<=4?s.set(i+o,a+u,!0,!0):s.set(i+o,a+u,!1,!0))}}function qg(s){const e=s.size;for(let t=8;t<e-8;t++){const r=t%2===0;s.set(t,6,r,!0),s.set(6,t,r,!0)}}function Wg(s,e){const t=Lg.getPositions(e);for(let r=0;r<t.length;r++){const n=t[r][0],i=t[r][1];for(let a=-2;a<=2;a++)for(let o=-2;o<=2;o++)a===-2||a===2||o===-2||o===2||a===0&&o===0?s.set(n+a,i+o,!0,!0):s.set(n+a,i+o,!1,!0)}}function Vg(s,e){const t=s.size,r=di.getEncodedBits(e);let n,i,a;for(let o=0;o<18;o++)n=Math.floor(o/3),i=o%3+t-8-3,a=(r>>o&1)===1,s.set(n,i,a,!0),s.set(i,n,a,!0)}function Wi(s,e,t){const r=s.size,n=jg.getEncodedBits(e,t);let i,a;for(i=0;i<15;i++)a=(n>>i&1)===1,i<6?s.set(i,8,a,!0):i<8?s.set(i+1,8,a,!0):s.set(r-15+i,8,a,!0),i<8?s.set(8,r-i-1,a,!0):i<9?s.set(8,15-i-1+1,a,!0):s.set(8,15-i-1,a,!0);s.set(r-8,8,1,!0)}function Kg(s,e){const t=s.size;let r=-1,n=t-1,i=7,a=0;for(let o=t-1;o>0;o-=2)for(o===6&&o--;;){for(let u=0;u<2;u++)if(!s.isReserved(n,o-u)){let l=!1;a<e.length&&(l=(e[a]>>>i&1)===1),s.set(n,o-u,l),i--,i===-1&&(a++,i=7)}if(n+=r,n<0||t<=n){n-=r,r=-r;break}}}function Zg(s,e,t){const r=new Ng;t.forEach(function(u){r.put(u.mode.bit,4),r.put(u.getLength(),Ug.getCharCountIndicator(u.mode,s)),u.write(r)});const n=Fi.getSymbolTotalCodewords(s),i=is.getTotalCodewordsCount(s,e),a=(n-i)*8;for(r.getLengthInBits()+4<=a&&r.put(0,4);r.getLengthInBits()%8!==0;)r.putBit(0);const o=(a-r.getLengthInBits())/8;for(let u=0;u<o;u++)r.put(u%2?17:236,8);return Qg(r,s,e)}function Qg(s,e,t){const r=Fi.getSymbolTotalCodewords(e),n=is.getTotalCodewordsCount(e,t),i=r-n,a=is.getBlocksCount(e,t),o=r%a,u=a-o,l=Math.floor(r/a),c=Math.floor(i/a),f=c+1,d=l-c,h=new $g(d);let p=0;const m=new Array(a),b=new Array(a);let g=0;const D=new Uint8Array(s.buffer);for(let F=0;F<a;F++){const T=F<u?c:f;m[F]=D.slice(p,p+T),b[F]=h.encode(m[F]),p+=T,g=Math.max(g,T)}const v=new Uint8Array(r);let C=0,k,I;for(k=0;k<g;k++)for(I=0;I<a;I++)k<m[I].length&&(v[C++]=m[I][k]);for(k=0;k<d;k++)for(I=0;I<a;I++)v[C++]=b[I][k];return v}function Gg(s,e,t,r){let n;if(Array.isArray(s))n=qi.fromArray(s);else if(typeof s=="string"){let l=e;if(!l){const c=qi.rawSplit(s);l=di.getBestVersionForData(c,t)}n=qi.fromString(s,l||40)}else throw new Error("Invalid data");const i=di.getBestVersionForData(n,t);if(!i)throw new Error("The amount of data is too big to be stored in a QR Code");if(!e)e=i;else if(e<i)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+i+`.
`);const a=Zg(e,t,n),o=Fi.getSymbolSize(e),u=new Mg(o);return Hg(u,e),qg(u),Wg(u,e),Wi(u,t,0),e>=7&&Vg(u,e),Kg(u,a),isNaN(r)&&(r=rs.getBestMask(u,Wi.bind(null,u,t))),rs.applyMask(r,u),Wi(u,t,r),{modules:u,version:e,errorCorrectionLevel:t,maskPattern:r,segments:n}}Sl.create=function(e,t){if(typeof e>"u"||e==="")throw new Error("No input text");let r=Hi.M,n,i;return typeof t<"u"&&(r=Hi.from(t.errorCorrectionLevel,Hi.M),n=di.from(t.version),i=rs.from(t.maskPattern),t.toSJISFunc&&Fi.setToSJISFunction(t.toSJISFunc)),Gg(e,n,r,i)};var jl={},vs={};(function(s){function e(t){if(typeof t=="number"&&(t=t.toString()),typeof t!="string")throw new Error("Color should be defined as hex string");let r=t.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+t);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(i){return[i,i]}))),r.length===6&&r.push("F","F");const n=parseInt(r.join(""),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:n&255,hex:"#"+r.slice(0,6).join("")}}s.getOptions=function(r){r||(r={}),r.color||(r.color={});const n=typeof r.margin>"u"||r.margin===null||r.margin<0?4:r.margin,i=r.width&&r.width>=21?r.width:void 0,a=r.scale||4;return{width:i,scale:i?4:a,margin:n,color:{dark:e(r.color.dark||"#000000ff"),light:e(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},s.getScale=function(r,n){return n.width&&n.width>=r+n.margin*2?n.width/(r+n.margin*2):n.scale},s.getImageWidth=function(r,n){const i=s.getScale(r,n);return Math.floor((r+n.margin*2)*i)},s.qrToImageData=function(r,n,i){const a=n.modules.size,o=n.modules.data,u=s.getScale(a,i),l=Math.floor((a+i.margin*2)*u),c=i.margin*u,f=[i.color.light,i.color.dark];for(let d=0;d<l;d++)for(let h=0;h<l;h++){let p=(d*l+h)*4,m=i.color.light;if(d>=c&&h>=c&&d<l-c&&h<l-c){const b=Math.floor((d-c)/u),g=Math.floor((h-c)/u);m=f[o[b*a+g]?1:0]}r[p++]=m.r,r[p++]=m.g,r[p++]=m.b,r[p]=m.a}}})(vs);(function(s){const e=vs;function t(n,i,a){n.clearRect(0,0,i.width,i.height),i.style||(i.style={}),i.height=a,i.width=a,i.style.height=a+"px",i.style.width=a+"px"}function r(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}s.render=function(i,a,o){let u=o,l=a;typeof u>"u"&&(!a||!a.getContext)&&(u=a,a=void 0),a||(l=r()),u=e.getOptions(u);const c=e.getImageWidth(i.modules.size,u),f=l.getContext("2d"),d=f.createImageData(c,c);return e.qrToImageData(d.data,i,u),t(f,l,c),f.putImageData(d,0,0),l},s.renderToDataURL=function(i,a,o){let u=o;typeof u>"u"&&(!a||!a.getContext)&&(u=a,a=void 0),u||(u={});const l=s.render(i,a,u),c=u.type||"image/png",f=u.rendererOpts||{};return l.toDataURL(c,f.quality)}})(jl);var Ul={};const Yg=vs;function tu(s,e){const t=s.a/255,r=e+'="'+s.hex+'"';return t<1?r+" "+e+'-opacity="'+t.toFixed(2).slice(1)+'"':r}function Vi(s,e,t){let r=s+e;return typeof t<"u"&&(r+=" "+t),r}function Jg(s,e,t){let r="",n=0,i=!1,a=0;for(let o=0;o<s.length;o++){const u=Math.floor(o%e),l=Math.floor(o/e);!u&&!i&&(i=!0),s[o]?(a++,o>0&&u>0&&s[o-1]||(r+=i?Vi("M",u+t,.5+l+t):Vi("m",n,0),n=0,i=!1),u+1<e&&s[o+1]||(r+=Vi("h",a),a=0)):n++}return r}Ul.render=function(e,t,r){const n=Yg.getOptions(t),i=e.modules.size,a=e.modules.data,o=i+n.margin*2,u=n.color.light.a?"<path "+tu(n.color.light,"fill")+' d="M0 0h'+o+"v"+o+'H0z"/>':"",l="<path "+tu(n.color.dark,"stroke")+' d="'+Jg(a,i,n.margin)+'"/>',c='viewBox="0 0 '+o+" "+o+'"',d='<svg xmlns="http://www.w3.org/2000/svg" '+(n.width?'width="'+n.width+'" height="'+n.width+'" ':"")+c+' shape-rendering="crispEdges">'+u+l+`</svg>
`;return typeof r=="function"&&r(null,d),d};const Xg=hg,ss=Sl,Hl=jl,eb=Ul;function Cs(s,e,t,r,n){const i=[].slice.call(arguments,1),a=i.length,o=typeof i[a-1]=="function";if(!o&&!Xg())throw new Error("Callback required as last argument");if(o){if(a<2)throw new Error("Too few arguments provided");a===2?(n=t,t=e,e=r=void 0):a===3&&(e.getContext&&typeof n>"u"?(n=r,r=void 0):(n=r,r=t,t=e,e=void 0))}else{if(a<1)throw new Error("Too few arguments provided");return a===1?(t=e,e=r=void 0):a===2&&!e.getContext&&(r=t,t=e,e=void 0),new Promise(function(u,l){try{const c=ss.create(t,r);u(s(c,e,r))}catch(c){l(c)}})}try{const u=ss.create(t,r);n(null,s(u,e,r))}catch(u){n(u)}}$r.create=ss.create;$r.toCanvas=Cs.bind(null,Hl.render);$r.toDataURL=Cs.bind(null,Hl.renderToDataURL);$r.toString=Cs.bind(null,function(s,e,t){return eb.render(s,t)});function tb(s){let e,t;return{c(){e=A("div"),E(e,"id","qrcode")},m(r,n){S(r,e,n),s[3](e)},p:X,i(r){t||xn(()=>{t=ic(e,Wh,{duration:300}),t.start()})},o:X,d(r){r&&B(e),s[3](null)}}}function nb(s,e,t){let{codeValue:r}=e,{squareSize:n}=e,i,a;Ft(async()=>{a=await $r.toCanvas(r,{width:n,small:!0,color:{dark:"#000000",light:"#ffffff"}}),i.appendChild(a)}),gu(()=>{a&&a.remove()});function o(u){pi[u?"unshift":"push"](()=>{i=u,t(0,i)})}return s.$$set=u=>{"codeValue"in u&&t(1,r=u.codeValue),"squareSize"in u&&t(2,n=u.squareSize)},[i,r,n,o]}class rb extends ye{constructor(e){super(),ve(this,e,nb,tb,we,{codeValue:1,squareSize:2})}}function nu(s){let e,t,r,n,i,a,o,u,l,c,f,d,h,p;function m(I,F){return I[2]?ib:sb}let b=m(s),g=b(s);function D(I,F){return I[3]?ob:ab}let v=D(s),C=v(s),k=s[3]&&ru(s);return{c(){e=A("p"),t=A("strong"),t.textContent="Your invitation URL is:",r=z(),n=A("span"),i=J(s[1]),a=z(),g.c(),o=z(),u=A("button"),C.c(),l=J(`
        QR code`),c=z(),k&&k.c(),f=Fe(),E(n,"class","break-all text-xs"),E(e,"class","py-2"),E(u,"class","mt-2")},m(I,F){S(I,e,F),w(e,t),w(e,r),w(e,n),w(n,i),S(I,a,F),g.m(I,F),S(I,o,F),S(I,u,F),C.m(u,null),w(u,l),S(I,c,F),k&&k.m(I,F),S(I,f,F),d=!0,h||(p=fe(u,"click",s[6]),h=!0)},p(I,F){(!d||F&2)&&Ae(i,I[1]),b===(b=m(I))&&g?g.p(I,F):(g.d(1),g=b(I),g&&(g.c(),g.m(o.parentNode,o))),v!==(v=D(I))&&(C.d(1),C=v(I),C&&(C.c(),C.m(u,l))),I[3]?k?(k.p(I,F),F&8&&P(k,1)):(k=ru(I),k.c(),P(k,1),k.m(f.parentNode,f)):k&&(me(),M(k,1,1,()=>{k=null}),ge())},i(I){d||(P(k),d=!0)},o(I){M(k),d=!1},d(I){I&&B(e),I&&B(a),g.d(I),I&&B(o),I&&B(u),C.d(),I&&B(c),k&&k.d(I),I&&B(f),h=!1,p()}}}function ib(s){let e,t,r;return{c(){e=A("button"),e.textContent="URL copied to clipboard!"},m(n,i){S(n,e,i),t||(r=fe(e,"click",s[5]),t=!0)},p:X,d(n){n&&B(e),t=!1,r()}}}function sb(s){let e,t,r;return{c(){e=A("button"),e.textContent="Copy URL to clipboard"},m(n,i){S(n,e,i),t||(r=fe(e,"click",s[5]),t=!0)},p:X,d(n){n&&B(e),t=!1,r()}}}function ab(s){let e;return{c(){e=J("Show")},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function ob(s){let e;return{c(){e=J("Hide")},m(t,r){S(t,e,r)},d(t){t&&B(e)}}}function ru(s){let e,t,r;return t=new rb({props:{codeValue:s[1],squareSize:s[0]}}),{c(){e=A("div"),oe(t.$$.fragment),E(e,"id","qrcodeContainer"),E(e,"class","ml-1/5 mb-12 svelte-tchhkp")},m(n,i){S(n,e,i),ue(t,e,null),r=!0},p(n,i){const a={};i&2&&(a.codeValue=n[1]),i&1&&(a.squareSize=n[0]),t.$set(a)},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t)}}}function ub(s){let e,t,r,n,i,a,o=s[1]&&nu(s);return{c(){e=A("div"),t=A("button"),t.textContent="Generate Invitation URL",r=z(),o&&o.c()},m(u,l){S(u,e,l),w(e,t),w(e,r),o&&o.m(e,null),n=!0,i||(a=fe(t,"click",s[4]),i=!0)},p(u,[l]){u[1]?o?(o.p(u,l),l&2&&P(o,1)):(o=nu(u),o.c(),P(o,1),o.m(e,null)):o&&(me(),M(o,1,1,()=>{o=null}),ge())},i(u){n||(P(o),n=!0)},o(u){M(o),n=!1},d(u){u&&B(e),o&&o.d(),i=!1,a()}}}function lb(s,e,t){let r;Ft(()=>{t(0,r=window.innerWidth*.4),window.addEventListener("resize",()=>{t(0,r=window.innerWidth*.4)})});let n="",i=!1,a=!1,o;Mt.subscribe(f=>{o=f});async function u(){const f=await Nh(o.shareAddress,Re.servers,o.secret);typeof f=="string"?t(1,n=f):console.error("Failed to create invitation URL:",f)}async function l(){try{await navigator.clipboard.writeText(n),t(2,i=!0)}catch(f){console.error("Failed to copy text: ",f)}}function c(){t(3,a=!a)}return[r,n,i,a,u,l,c]}class cb extends ye{constructor(e){super(),ve(this,e,lb,ub,we,{})}}function fb(s){let e,t,r,n,i,a,o;return r=new fg({}),a=new cb({}),{c(){e=A("div"),t=A("div"),oe(r.$$.fragment),n=z(),i=A("div"),oe(a.$$.fragment),E(t,"class","svelte-a2uzsp"),E(i,"class","svelte-a2uzsp"),E(e,"class","svelte-a2uzsp")},m(u,l){S(u,e,l),w(e,t),ue(r,t,null),w(e,n),w(e,i),ue(a,i,null),o=!0},p:X,i(u){o||(P(r.$$.fragment,u),P(a.$$.fragment,u),o=!0)},o(u){M(r.$$.fragment,u),M(a.$$.fragment,u),o=!1},d(u){u&&B(e),le(r),le(a)}}}class hb extends ye{constructor(e){super(),ve(this,e,null,fb,we,{})}}function iu(s){let e,t;return e=new ng({}),{c(){oe(e.$$.fragment)},m(r,n){ue(e,r,n),t=!0},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){M(e.$$.fragment,r),t=!1},d(r){le(e,r)}}}function su(s){let e,t;return e=new Dd({}),{c(){oe(e.$$.fragment)},m(r,n){ue(e,r,n),t=!0},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){M(e.$$.fragment,r),t=!1},d(r){le(e,r)}}}function au(s){let e,t;return e=new $1({props:{status:s[0]}}),{c(){oe(e.$$.fragment)},m(r,n){ue(e,r,n),t=!0},p(r,n){const i={};n&1&&(i.status=r[0]),e.$set(i)},i(r){t||(P(e.$$.fragment,r),t=!0)},o(r){M(e.$$.fragment,r),t=!1},d(r){le(e,r)}}}function ou(s){let e,t,r;return t=new sg({}),{c(){e=A("div"),oe(t.$$.fragment)},m(n,i){S(n,e,i),ue(t,e,null),r=!0},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t)}}}function uu(s){let e,t,r;return t=new hb({}),{c(){e=A("div"),oe(t.$$.fragment)},m(n,i){S(n,e,i),ue(t,e,null),r=!0},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t)}}}function db(s){let e,t,r=s[2].address.slice(0,5)+"",n,i,a,o,u,l,c,f,d,h,p,m,b,g,D,v,C,k,I,F,T,N,j,G,R=s[1]==="share"&&iu(),L=s[1]==="identity"&&su(),y=s[1]==="status"&&au(s),q=s[1]==="server"&&ou(),ee=s[1]==="invitation"&&uu();return{c(){e=A("div"),t=A("button"),n=J(r),i=z(),a=A("div"),o=A("div"),u=A("button"),u.textContent="Explore the commons",l=z(),c=A("button"),c.textContent="Show Identity Info",f=z(),d=A("button"),d.textContent="Show Status Panel",h=z(),p=A("button"),p.textContent="Show Share Settings",m=z(),b=A("button"),b.textContent="Show Server Settings",g=z(),D=A("button"),D.textContent="Show Invitation URL",v=z(),C=A("div"),R&&R.c(),k=z(),L&&L.c(),I=z(),y&&y.c(),F=z(),q&&q.c(),T=z(),ee&&ee.c(),E(t,"class","h-auto mr-6 phase2"),E(e,"class","w-screen flex flex-row justify-end h-[10vh]"),E(u,"class","my-1"),E(c,"class","my-1"),ct(c,"phase2",s[1]==="identity"),E(d,"class","my-1"),ct(d,"phase2",s[1]==="status"),E(p,"class","my-1"),ct(p,"phase2",s[1]==="share"),E(b,"class","my-1"),ct(b,"phase2",s[1]==="server"),E(D,"class","my-1"),ct(D,"phase2",s[1]==="invitation"),E(o,"class","mx-1 mt-12 w-1/5 paper-yellow flex flex-col p-8 h-[80vh] sticky top-0"),E(C,"class","py-12 px-2 flex flex-col xl:flex-row justify-center w-4/5 items-start"),E(a,"class","flex min-h-screen overflow-y-auto")},m(U,Z){S(U,e,Z),w(e,t),w(t,n),S(U,i,Z),S(U,a,Z),w(a,o),w(o,u),w(o,l),w(o,c),w(o,f),w(o,d),w(o,h),w(o,p),w(o,m),w(o,b),w(o,g),w(o,D),w(a,v),w(a,C),R&&R.m(C,null),w(C,k),L&&L.m(C,null),w(C,I),y&&y.m(C,null),w(C,F),q&&q.m(C,null),w(C,T),ee&&ee.m(C,null),N=!0,j||(G=[fe(t,"click",s[3]),fe(u,"click",s[3]),fe(c,"click",s[4]),fe(d,"click",s[5]),fe(p,"click",s[6]),fe(b,"click",s[7]),fe(D,"click",s[8])],j=!0)},p(U,[Z]){(!N||Z&4)&&r!==(r=U[2].address.slice(0,5)+"")&&Ae(n,r),(!N||Z&2)&&ct(c,"phase2",U[1]==="identity"),(!N||Z&2)&&ct(d,"phase2",U[1]==="status"),(!N||Z&2)&&ct(p,"phase2",U[1]==="share"),(!N||Z&2)&&ct(b,"phase2",U[1]==="server"),(!N||Z&2)&&ct(D,"phase2",U[1]==="invitation"),U[1]==="share"?R?Z&2&&P(R,1):(R=iu(),R.c(),P(R,1),R.m(C,k)):R&&(me(),M(R,1,1,()=>{R=null}),ge()),U[1]==="identity"?L?Z&2&&P(L,1):(L=su(),L.c(),P(L,1),L.m(C,I)):L&&(me(),M(L,1,1,()=>{L=null}),ge()),U[1]==="status"?y?(y.p(U,Z),Z&2&&P(y,1)):(y=au(U),y.c(),P(y,1),y.m(C,F)):y&&(me(),M(y,1,1,()=>{y=null}),ge()),U[1]==="server"?q?Z&2&&P(q,1):(q=ou(),q.c(),P(q,1),q.m(C,T)):q&&(me(),M(q,1,1,()=>{q=null}),ge()),U[1]==="invitation"?ee?Z&2&&P(ee,1):(ee=uu(),ee.c(),P(ee,1),ee.m(C,null)):ee&&(me(),M(ee,1,1,()=>{ee=null}),ge())},i(U){N||(P(R),P(L),P(y),P(q),P(ee),N=!0)},o(U){M(R),M(L),M(y),M(q),M(ee),N=!1},d(U){U&&B(e),U&&B(i),U&&B(a),R&&R.d(),L&&L.d(),y&&y.d(),q&&q.d(),ee&&ee.d(),j=!1,je(G)}}}function pb(s,e,t){let r;He(s,Et,h=>t(2,r=h));let{status:n}=e,i="identity";const a=bt();function o(){a("toggle")}const u=()=>t(1,i="identity"),l=()=>t(1,i="status"),c=()=>t(1,i="share"),f=()=>t(1,i="server"),d=()=>t(1,i="invitation");return s.$$set=h=>{"status"in h&&t(0,n=h.status)},[n,i,r,o,u,l,c,f,d]}class mb extends ye{constructor(e){super(),ve(this,e,pb,db,we,{status:0})}}function lu(s,e,t){const r=s.slice();return r[1]=e[t],r[3]=t,r}function cu(s){let e,t,r,n;return{c(){e=A("div"),t=A("div"),r=z(),n=A("div"),E(t,"class","ml-12 bgimg svelte-1veluwv"),E(t,"style",`background-image: url(${bb});`),E(e,"class","cell svelte-1veluwv"),E(n,"class","cell svelte-1veluwv")},m(i,a){S(i,e,a),w(e,t),S(i,r,a),S(i,n,a)},p:X,d(i){i&&B(e),i&&B(r),i&&B(n)}}}function gb(s){let e,t=s[0],r=[];for(let n=0;n<t.length;n+=1)r[n]=cu(lu(s,t,n));return{c(){e=A("div");for(let n=0;n<r.length;n+=1)r[n].c();E(e,"class","banner svelte-1veluwv")},m(n,i){S(n,e,i);for(let a=0;a<r.length;a+=1)r[a].m(e,null)},p(n,[i]){if(i&0){t=n[0];let a;for(a=0;a<t.length;a+=1){const o=lu(n,t,a);r[a]?r[a].p(o,i):(r[a]=cu(),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},i:X,o:X,d(n){n&&B(e),on(r,n)}}}const bb="images/upload-img.png",Db=10;function _b(s){return[Array(Db).fill().map(()=>({}))]}class wb extends ye{constructor(e){super(),ve(this,e,_b,gb,we,{})}}function fu(s){let e,t,r,n,i,a,o,u,l,c,f,d,h,p,m,b,g,D,v,C,k,I;h=new rd({}),h.$on("validated",s[5]),h.$on("error",s[7]),h.$on("generateNewIdentity",s[12]),m=new ud({}),m.$on("alias",s[5]),m.$on("error",s[7]),g=new wb({});let F=s[2]===!0&&hu();return{c(){e=A("div"),t=A("h1"),t.textContent="Eccentric Networks",r=z(),n=A("h4"),n.textContent="Collaboration space for the unconnected",i=z(),a=A("div"),o=A("button"),o.textContent="Generate new Identity",u=z(),l=A("button"),l.textContent="Explore the commons",c=z(),f=A("div"),d=A("div"),oe(h.$$.fragment),p=z(),oe(m.$$.fragment),b=z(),oe(g.$$.fragment),D=z(),F&&F.c(),v=Fe(),E(t,"class","svelte-1dtypk6"),E(o,"class","phase1 mx-16 mt-12 text-2xl"),E(l,"class","phase1 mx-16 mt-12 text-2xl"),E(a,"class","flex flex-col lg:flex-row items-center mx-16 justify-evenly my-12"),E(d,"class","flex flex-row items-center mx-6 my-12"),E(f,"class","w-1/2 flex flex-col lg:flex-row items-center mx-2 justify-center my-12"),E(e,"class","my-12")},m(T,N){S(T,e,N),w(e,t),w(e,r),w(e,n),w(e,i),w(e,a),w(a,o),w(a,u),w(a,l),w(e,c),w(e,f),w(f,d),ue(h,d,null),w(d,p),ue(m,d,null),w(e,b),ue(g,e,null),S(T,D,N),F&&F.m(T,N),S(T,v,N),C=!0,k||(I=[fe(o,"click",s[6]),fe(l,"click",s[11])],k=!0)},p(T,N){T[2]===!0?F?N&4&&P(F,1):(F=hu(),F.c(),P(F,1),F.m(v.parentNode,v)):F&&(me(),M(F,1,1,()=>{F=null}),ge())},i(T){C||(P(h.$$.fragment,T),P(m.$$.fragment,T),P(g.$$.fragment,T),P(F),C=!0)},o(T){M(h.$$.fragment,T),M(m.$$.fragment,T),M(g.$$.fragment,T),M(F),C=!1},d(T){T&&B(e),le(h),le(m),le(g),T&&B(D),F&&F.d(T),T&&B(v),k=!1,je(I)}}}function hu(s){let e,t,r;return{c(){e=A("blockquote"),e.textContent="There was an error with your identity file"},m(n,i){S(n,e,i),r=!0},i(n){r||(xn(()=>{t||(t=Kn(e,Jn,{y:200,duration:2e3},!0)),t.run(1)}),r=!0)},o(n){t||(t=Kn(e,Jn,{y:200,duration:2e3},!1)),t.run(0),r=!1},d(n){n&&B(e),n&&t&&t.end()}}}function yb(s){let e,t,r;return t=new mb({props:{status:s[4]}}),t.$on("toggle",s[9]),{c(){e=A("div"),oe(t.$$.fragment),E(e,"class","w-full")},m(n,i){S(n,e,i),ue(t,e,null),r=!0},p(n,i){const a={};i&16&&(a.status=n[4]),t.$set(a)},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t)}}}function vb(s){let e,t,r;return t=new N1({props:{showDetails:s[1],IDcreated:s[0]}}),t.$on("toggle",s[9]),t.$on("view",s[8]),t.$on("details",s[13]),{c(){e=A("div"),oe(t.$$.fragment),E(e,"class","w-full")},m(n,i){S(n,e,i),ue(t,e,null),r=!0},p(n,i){const a={};i&2&&(a.showDetails=n[1]),i&1&&(a.IDcreated=n[0]),t.$set(a)},i(n){r||(P(t.$$.fragment,n),r=!0)},o(n){M(t.$$.fragment,n),r=!1},d(n){n&&B(e),le(t)}}}function Cb(s){let e,t,r,n,i,a=!s[0]&&!s[1]&&fu(s);const o=[vb,yb],u=[];function l(c,f){return c[0]&&!c[3]?0:1}return r=l(s),n=u[r]=o[r](s),{c(){e=A("main"),a&&a.c(),t=z(),n.c(),E(e,"class","svelte-1dtypk6")},m(c,f){S(c,e,f),a&&a.m(e,null),w(e,t),u[r].m(e,null),i=!0},p(c,[f]){!c[0]&&!c[1]?a?(a.p(c,f),f&3&&P(a,1)):(a=fu(c),a.c(),P(a,1),a.m(e,t)):a&&(me(),M(a,1,1,()=>{a=null}),ge());let d=r;r=l(c),r===d?u[r].p(c,f):(me(),M(u[d],1,1,()=>{u[d]=null}),ge(),n=u[r],n?n.p(c,f):(n=u[r]=o[r](c),n.c()),P(n,1),n.m(e,null))},i(c){i||(P(a),P(n),i=!0)},o(c){M(a),M(n),i=!1},d(c){c&&B(e),a&&a.d(),u[r].d()}}}function Ab(s,e,t){let r;He(s,jt,I=>t(14,r=I));let n=!1,i=!1,a=!0,o=!1,u=!1,l;Ft(async()=>{Re.author?(Et.set(Re.author),t(0,n=!0)):t(0,n=!1)});const c=new Lr;c.addReplica(r.replica);const f=c.sync("https://earthstar-server.fly.dev/sync",!0),d=Re.addServer("https://earthstar-server.fly.dev/sync");console.log(d),f.onStatusChange(I=>{t(4,l=I),console.log(I),t(4,l)}),f.isDone().then(()=>{console.log("Sync complete")}).catch(I=>{console.error("Sync failed",I)});function h(I){t(0,n=!0),t(1,i=!0)}function p(){t(0,n=!0),t(3,u=!0)}function m(I){t(2,o=!0)}const b=new URLSearchParams(window.location.search);b.has("studio"),b.has("oracle");function g(){t(10,a=!a)}function D(){t(3,u=!u)}const v=()=>t(0,n=!n&&i===!1),C=()=>t(0,n=!n),k=()=>t(3,u=!0);return s.$$.update=()=>{s.$$.dirty&1027&&(console.log("IDcreated",n),console.log("showDetails",i),console.log("imageView",a))},[n,i,o,u,l,h,p,m,g,D,a,v,C,k]}class kb extends ye{constructor(e){super(),ve(this,e,Ab,Cb,we,{})}}new kb({target:document.getElementById("app")});
