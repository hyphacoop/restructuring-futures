var Ma=Object.defineProperty;var Na=(i,e,t)=>e in i?Ma(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var Mi=(i,e,t)=>(Na(i,typeof e!="symbol"?e+"":e,t),t);import{c as ur,r as La,g as $a,n as ja,i as Ua,a as L,s as za,b as Ae,d as Y,e as so,S as J,f as Z,h as D,j as I,t as $,k as w,l as y,m,o as Ze,p as j,q as re,u as v,v as K,w as B,x as Q,y as _,z as Be,A as gt,B as vn,C as Nt,D as ie,E as Xe,F as Ni,G as Lt,H as Ha,I as on,J as U,K as z,L as kn,M as Fn,N as H,O as ye,P as qa,Q as Ce,R as Ee,T as ve,U as ke,V as $e,W as uo,X as Wa,Y as Li,Z as Va,_ as Dt,$ as Zn,a0 as Re,a1 as Xt,a2 as ot,a3 as ai,a4 as nn,a5 as Xn,a6 as $i,a7 as Ka,a8 as Qa,a9 as Ga}from"./svelte-b6874cd2.js";function Ya(i,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in i)){const s=Object.getOwnPropertyDescriptor(n,r);s&&Object.defineProperty(i,r,s.get?s:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();class Ge extends Error{constructor(e){super(e||""),this.name="EarthstarError"}}class O extends Ge{constructor(e){super(e||"Validation error"),this.name="ValidationError"}}class _e extends Ge{constructor(e){super(e||"a Replica or ReplicaDriver was used after being closed"),this.name="ReplicaIsClosedError"}}class qt extends Ge{constructor(e){super(e||"a ReplicaCache was used after being closed"),this.name="ReplicaCacheIsClosedError"}}class zn extends Ge{constructor(e){super(e||"Not supported"),this.name="NotSupportedError"}}function M(i){return i instanceof Ge}function oo(i){return!(i instanceof Ge)}var ao={},lo={};Object.defineProperty(lo,"__esModule",{value:!0});(function(i){var e=ur&&ur.__createBinding||(Object.create?function(s,u,a,o){o===void 0&&(o=a);var l=Object.getOwnPropertyDescriptor(u,a);(!l||("get"in l?!u.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return u[a]}}),Object.defineProperty(s,o,l)}:function(s,u,a,o){o===void 0&&(o=a),s[o]=u[a]}),t=ur&&ur.__exportStar||function(s,u){for(var a in s)a!=="default"&&!Object.prototype.hasOwnProperty.call(u,a)&&e(u,s,a)};Object.defineProperty(i,"__esModule",{value:!0}),i.crypto=void 0;const r=La.webcrypto;i.crypto=r,t(lo,i)})(ao);var Vn={};Object.defineProperty(Vn,"__esModule",{value:!0});var Tr=Vn.setInterval=rn=Vn.setTimeout=void 0;const Ja=globalThis.setTimeout;function Za(i,e,...t){const n=Ja(i,e,...t);return typeof n=="number"?n:n[Symbol.toPrimitive]()}var rn=Vn.setTimeout=Za;const Xa=globalThis.setInterval;function el(i,e,...t){const n=Xa(i,e,...t);return typeof n=="number"?n:n[Symbol.toPrimitive]()}Tr=Vn.setInterval=el;var yi={},Wr,ji;Object.defineProperty(yi,"__esModule",{value:!0});var co=yi.WeakRef=void 0;co=yi.WeakRef=(Wr=globalThis.WeakRef)!==null&&Wr!==void 0?Wr:(ji=class{constructor(e){}deref(){throw new Error("WeakRef is not supported in Node 14 and below.")}},ji);const{Blob:fo}=window,{Request:tl,Response:nl,Headers:rl,fetch:Rg}=window,{ReadableStream:sn,ReadableStreamDefaultReader:xg,ReadableStreamBYOBReader:Og,ReadableStreamBYOBRequest:Mg,ReadableByteStreamController:Ng,ReadableStreamDefaultController:Lg,TransformStream:Bn,TransformStreamDefaultController:il,WritableStream:st,WritableStreamDefaultWriter:sl,WritableStreamDefaultController:$g,ByteLengthQueuingStrategy:jg,CountQueuingStrategy:Ug,TextEncoderStream:zg,TextDecoderStream:Hg}=window;if(!sn.prototype[Symbol.asyncIterator]){async function*i(){const e=this.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)return;yield n}}finally{e.releaseLock()}}sn.prototype[Symbol.asyncIterator]=i}var pn=null;typeof WebSocket<"u"?pn=WebSocket:typeof MozWebSocket<"u"?pn=MozWebSocket:typeof global<"u"?pn=global.WebSocket||global.MozWebSocket:typeof window<"u"?pn=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(pn=self.WebSocket||self.MozWebSocket);const bn=pn,{TextDecoder:ho,TextEncoder:_i}=window;function Ui(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function po(i,e,t){return e&&Ui(i.prototype,e),t&&Ui(i,t),i}function zi(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=i[t];return n}function Ar(i,e){var t=typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t)return(t=t.call(i)).next.bind(t);if(Array.isArray(i)||(t=function(r,s){if(r){if(typeof r=="string")return zi(r,s);var u=Object.prototype.toString.call(r).slice(8,-1);return u==="Object"&&r.constructor&&(u=r.constructor.name),u==="Map"||u==="Set"?Array.from(r):u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?zi(r,s):void 0}}(i))||e&&i&&typeof i.length=="number"){t&&(i=t);var n=0;return function(){return n>=i.length?{done:!0}:{done:!1,value:i[n++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ul=/(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDEC0-\uDEEB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/,ol=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/;function al(i,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(i)}function mo(i,e){e===void 0&&(e=!1);for(var t=[],n=0;n<i.length;){var r=i[n],s=function(d){if(!e)throw new TypeError(d);t.push({type:"INVALID_CHAR",index:n,value:i[n++]})};if(r!=="*")if(r!=="+"&&r!=="?")if(r!=="\\")if(r!=="{")if(r!=="}")if(r!==":")if(r!=="(")t.push({type:"CHAR",index:n,value:i[n++]});else{var u=1,a="",o=n+1,l=!1;if(i[o]==="?"){s('Pattern cannot start with "?" at '+o);continue}for(;o<i.length;){if(!al(i[o],!1)){s("Invalid character '"+i[o]+"' at "+o+"."),l=!0;break}if(i[o]!=="\\"){if(i[o]===")"){if(--u==0){o++;break}}else if(i[o]==="("&&(u++,i[o+1]!=="?")){s("Capturing groups are not allowed at "+o),l=!0;break}a+=i[o++]}else a+=i[o++]+i[o++]}if(l)continue;if(u){s("Unbalanced pattern at "+n);continue}if(!a){s("Missing pattern at "+n);continue}t.push({type:"PATTERN",index:n,value:a}),n=o}else{for(var c="",f=n+1;f<i.length;){var h=i.substr(f,1);if(!(f===n+1&&ul.test(h)||f!==n+1&&ol.test(h)))break;c+=i[f++]}if(!c){s("Missing parameter name at "+n);continue}t.push({type:"NAME",index:n,value:c}),n=f}else t.push({type:"CLOSE",index:n,value:i[n++]});else t.push({type:"OPEN",index:n,value:i[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:i[n++]});else t.push({type:"MODIFIER",index:n,value:i[n++]});else t.push({type:"ASTERISK",index:n,value:i[n++]})}return t.push({type:"END",index:n,value:""}),t}function go(i,e){e===void 0&&(e={});for(var t=mo(i),n=e.prefixes,r=n===void 0?"./":n,s="[^"+mn(e.delimiter||"/#?")+"]+?",u=[],a=0,o=0,l="",c=new Set,f=function(q){if(o<t.length&&t[o].type===q)return t[o++].value},h=function(){return f("MODIFIER")||f("ASTERISK")},d=function(q){var ce=f(q);if(ce!==void 0)return ce;var se=t[o];throw new TypeError("Unexpected "+se.type+" at "+se.index+", expected "+q)},p=function(){for(var q,ce="";q=f("CHAR")||f("ESCAPED_CHAR");)ce+=q;return ce},g=e.encodePart||function(q){return q};o<t.length;){var C=f("CHAR"),b=f("NAME"),E=f("PATTERN");if(b||E||!f("ASTERISK")||(E=".*"),b||E){var A=C||"";r.indexOf(A)===-1&&(l+=A,A=""),l&&(u.push(g(l)),l="");var F=b||a++;if(c.has(F))throw new TypeError("Duplicate name '"+F+"'.");c.add(F),u.push({name:F,prefix:g(A),suffix:"",pattern:E||s,modifier:h()||""})}else{var T=C||f("ESCAPED_CHAR");if(T)l+=T;else if(f("OPEN")){var k=p(),S=f("NAME")||"",P=f("PATTERN")||"";S||P||!f("ASTERISK")||(P=".*");var R=p();d("CLOSE");var N=h()||"";if(!S&&!P&&!N){l+=k;continue}if(!S&&!P&&!k)continue;l&&(u.push(g(l)),l=""),u.push({name:S||(P?a++:""),pattern:S&&!P?s:P,prefix:g(k),suffix:g(R),modifier:N})}else l&&(u.push(g(l)),l=""),d("END")}}return u}function mn(i){return i.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function Do(i){return i&&i.sensitive?"u":"ui"}function bo(i,e,t){t===void 0&&(t={});for(var n,r=t.strict,s=r!==void 0&&r,u=t.start,a=u===void 0||u,o=t.end,l=o===void 0||o,c=t.encode,f=c===void 0?function(T){return T}:c,h="["+mn(t.endsWith||"")+"]|$",d="["+mn(t.delimiter||"/#?")+"]",p=a?"^":"",g=Ar(i);!(n=g()).done;){var C=n.value;if(typeof C=="string")p+=mn(f(C));else{var b=mn(f(C.prefix)),E=mn(f(C.suffix));C.pattern?(e&&e.push(C),p+=b||E?C.modifier==="+"||C.modifier==="*"?"(?:"+b+"((?:"+C.pattern+")(?:"+E+b+"(?:"+C.pattern+"))*)"+E+")"+(C.modifier==="*"?"?":""):"(?:"+b+"("+C.pattern+")"+E+")"+C.modifier:C.modifier==="+"||C.modifier==="*"?"((?:"+C.pattern+")"+C.modifier+")":"("+C.pattern+")"+C.modifier):p+="(?:"+b+E+")"+C.modifier}}if(l)s||(p+=d+"?"),p+=t.endsWith?"(?="+h+")":"$";else{var A=i[i.length-1],F=typeof A=="string"?d.indexOf(A[A.length-1])>-1:A===void 0;s||(p+="(?:"+d+"(?="+h+"))?"),F||(p+="(?="+d+"|"+h+")")}return new RegExp(p,Do(t))}function wo(i,e,t){return i instanceof RegExp?function(n,r){if(!r)return n;for(var s=/\((?:\?<(.*?)>)?(?!\?)/g,u=0,a=s.exec(n.source);a;)r.push({name:a[1]||u++,prefix:"",suffix:"",modifier:"",pattern:""}),a=s.exec(n.source);return n}(i,e):Array.isArray(i)?function(n,r,s){var u=n.map(function(a){return wo(a,r,s).source});return new RegExp("(?:"+u.join("|")+")",Do(s))}(i,e,t):function(n,r,s){return bo(go(n,s),r,s)}(i,e,t)}var xt={delimiter:"",prefixes:"",sensitive:!0,strict:!0},ll={delimiter:".",prefixes:"",sensitive:!0,strict:!0},cl={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function Hi(i,e){return i.startsWith(e)?i.substring(e.length,i.length):i}function yo(i){return!(!i||i.length<2||i[0]!=="["&&(i[0]!=="\\"&&i[0]!=="{"||i[1]!=="["))}var ee,_o=["ftp","file","http","https","ws","wss"];function Ao(i){if(!i)return!0;for(var e,t=Ar(_o);!(e=t()).done;)if(i.test(e.value))return!0;return!1}function Co(i){switch(i){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function Ai(i){if(i==="")return i;if(/^[-+.A-Za-z0-9]*$/.test(i))return i.toLowerCase();throw new TypeError("Invalid protocol '"+i+"'.")}function fl(i){if(i==="")return i;var e=new URL("https://example.com");return e.username=i,e.username}function hl(i){if(i==="")return i;var e=new URL("https://example.com");return e.password=i,e.password}function Eo(i){if(i==="")return i;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(i))throw new TypeError("Invalid hostname '"+i+"'");var e=new URL("https://example.com");return e.hostname=i,e.hostname}function vo(i){if(i==="")return i;if(/[^0-9a-fA-F[\]:]/g.test(i))throw new TypeError("Invalid IPv6 hostname '"+i+"'");return i.toLowerCase()}function ko(i){if(i===""||/^[0-9]*$/.test(i)&&parseInt(i)<=65535)return i;throw new TypeError("Invalid port '"+i+"'.")}function dl(i){if(i==="")return i;var e=new URL("https://example.com");return e.pathname=i[0]!=="/"?"/-"+i:i,i[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function pl(i){return i===""?i:new URL("data:"+i).pathname}function ml(i){if(i==="")return i;var e=new URL("https://example.com");return e.search=i,e.search.substring(1,e.search.length)}function gl(i){if(i==="")return i;var e=new URL("https://example.com");return e.hash=i,e.hash.substring(1,e.hash.length)}(function(i){i[i.INIT=0]="INIT",i[i.PROTOCOL=1]="PROTOCOL",i[i.AUTHORITY=2]="AUTHORITY",i[i.USERNAME=3]="USERNAME",i[i.PASSWORD=4]="PASSWORD",i[i.HOSTNAME=5]="HOSTNAME",i[i.PORT=6]="PORT",i[i.PATHNAME=7]="PATHNAME",i[i.SEARCH=8]="SEARCH",i[i.HASH=9]="HASH",i[i.DONE=10]="DONE"})(ee||(ee={}));var Dl=function(){function i(t){this.input=void 0,this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=ee.INIT,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=t}var e=i.prototype;return e.parse=function(){for(this.tokenList=mo(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===ee.INIT){this.rewind(),this.isHashPrefix()?this.changeState(ee.HASH,1):this.isSearchPrefix()?(this.changeState(ee.SEARCH,1),this.internalResult.hash=""):(this.changeState(ee.PATHNAME,0),this.internalResult.search="",this.internalResult.hash="");continue}if(this.state===ee.AUTHORITY){this.rewindAndSetState(ee.HOSTNAME);continue}this.changeState(ee.DONE,0);break}if(this.groupDepth>0){if(!this.isGroupClose())continue;this.groupDepth-=1}if(this.isGroupOpen())this.groupDepth+=1;else switch(this.state){case ee.INIT:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(ee.PROTOCOL));break;case ee.PROTOCOL:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();var t=ee.PATHNAME,n=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(t=ee.AUTHORITY,n=3):this.shouldTreatAsStandardURL&&(t=ee.AUTHORITY),this.changeState(t,n)}break;case ee.AUTHORITY:this.isIdentityTerminator()?this.rewindAndSetState(ee.USERNAME):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(ee.HOSTNAME);break;case ee.USERNAME:this.isPasswordPrefix()?this.changeState(ee.PASSWORD,1):this.isIdentityTerminator()&&this.changeState(ee.HOSTNAME,1);break;case ee.PASSWORD:this.isIdentityTerminator()&&this.changeState(ee.HOSTNAME,1);break;case ee.HOSTNAME:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(ee.PORT,1):this.isPathnameStart()?this.changeState(ee.PATHNAME,0):this.isSearchPrefix()?this.changeState(ee.SEARCH,1):this.isHashPrefix()&&this.changeState(ee.HASH,1);break;case ee.PORT:this.isPathnameStart()?this.changeState(ee.PATHNAME,0):this.isSearchPrefix()?this.changeState(ee.SEARCH,1):this.isHashPrefix()&&this.changeState(ee.HASH,1);break;case ee.PATHNAME:this.isSearchPrefix()?this.changeState(ee.SEARCH,1):this.isHashPrefix()&&this.changeState(ee.HASH,1);break;case ee.SEARCH:this.isHashPrefix()&&this.changeState(ee.HASH,1)}}},e.changeState=function(t,n){switch(this.state){case ee.INIT:break;case ee.PROTOCOL:this.internalResult.protocol=this.makeComponentString();break;case ee.AUTHORITY:break;case ee.USERNAME:this.internalResult.username=this.makeComponentString();break;case ee.PASSWORD:this.internalResult.password=this.makeComponentString();break;case ee.HOSTNAME:this.internalResult.hostname=this.makeComponentString();break;case ee.PORT:this.internalResult.port=this.makeComponentString();break;case ee.PATHNAME:this.internalResult.pathname=this.makeComponentString();break;case ee.SEARCH:this.internalResult.search=this.makeComponentString();break;case ee.HASH:this.internalResult.hash=this.makeComponentString()}this.changeStateWithoutSettingComponent(t,n)},e.changeStateWithoutSettingComponent=function(t,n){this.state=t,this.componentStart=this.tokenIndex+n,this.tokenIndex+=n,this.tokenIncrement=0},e.rewind=function(){this.tokenIndex=this.componentStart,this.tokenIncrement=0},e.rewindAndSetState=function(t){this.rewind(),this.state=t},e.safeToken=function(t){return t<0&&(t=this.tokenList.length-t),t<this.tokenList.length?this.tokenList[t]:this.tokenList[this.tokenList.length-1]},e.isNonSpecialPatternChar=function(t,n){var r=this.safeToken(t);return r.value===n&&(r.type==="CHAR"||r.type==="ESCAPED_CHAR"||r.type==="INVALID_CHAR")},e.isProtocolSuffix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.nextIsAuthoritySlashes=function(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")},e.isIdentityTerminator=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")},e.isPasswordPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.isPortPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.isPathnameStart=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")},e.isSearchPrefix=function(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;var t=this.safeToken(this.tokenIndex-1);return t.type!=="NAME"&&t.type!=="PATTERN"&&t.type!=="CLOSE"&&t.type!=="ASTERISK"},e.isHashPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")},e.isGroupOpen=function(){return this.tokenList[this.tokenIndex].type=="OPEN"},e.isGroupClose=function(){return this.tokenList[this.tokenIndex].type=="CLOSE"},e.isIPv6Open=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")},e.isIPv6Close=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")},e.makeComponentString=function(){var t=this.tokenList[this.tokenIndex],n=this.safeToken(this.componentStart).index;return this.input.substring(n,t.index)},e.computeShouldTreatAsStandardURL=function(){var t={};Object.assign(t,xt),t.encodePart=Ai;var n=wo(this.makeComponentString(),void 0,t);this.shouldTreatAsStandardURL=Ao(n)},po(i,[{key:"result",get:function(){return this.internalResult}}]),i}(),bl=["protocol","username","password","hostname","port","pathname","search","hash"];function qi(i,e){if(typeof i!="string")throw new TypeError("parameter 1 is not of type 'string'.");var t=new URL(i,e);return{protocol:t.protocol.substring(0,t.protocol.length-1),username:t.username,password:t.password,hostname:t.hostname,port:t.port,pathname:t.pathname,search:t.search!=""?t.search.substring(1,t.search.length):void 0,hash:t.hash!=""?t.hash.substring(1,t.hash.length):void 0}}function Vr(i,e,t){var n;if(typeof e.baseURL=="string")try{n=new URL(e.baseURL),i.protocol=n.protocol?n.protocol.substring(0,n.protocol.length-1):"",i.username=n.username,i.password=n.password,i.hostname=n.hostname,i.port=n.port,i.pathname=n.pathname,i.search=n.search?n.search.substring(1,n.search.length):"",i.hash=n.hash?n.hash.substring(1,n.hash.length):""}catch{throw new TypeError("invalid baseURL '"+e.baseURL+"'.")}if(typeof e.protocol=="string"&&(i.protocol=function(s,u){var a;return s=(a=s).endsWith(":")?a.substr(0,a.length-1):a,u||s===""?s:Ai(s)}(e.protocol,t)),typeof e.username=="string"&&(i.username=function(s,u){if(u||s==="")return s;var a=new URL("https://example.com");return a.username=s,a.username}(e.username,t)),typeof e.password=="string"&&(i.password=function(s,u){if(u||s==="")return s;var a=new URL("https://example.com");return a.password=s,a.password}(e.password,t)),typeof e.hostname=="string"&&(i.hostname=function(s,u){return u||s===""?s:yo(s)?vo(s):Eo(s)}(e.hostname,t)),typeof e.port=="string"&&(i.port=function(s,u,a){return Co(u)===s&&(s=""),a||s===""?s:ko(s)}(e.port,i.protocol,t)),typeof e.pathname=="string"){if(i.pathname=e.pathname,n&&!function(s,u){return!(!s.length||s[0]!=="/"&&(!u||s.length<2||s[0]!="\\"&&s[0]!="{"||s[1]!="/"))}(i.pathname,t)){var r=n.pathname.lastIndexOf("/");r>=0&&(i.pathname=n.pathname.substring(0,r+1)+i.pathname)}i.pathname=function(s,u,a){if(a||s==="")return s;if(u&&!_o.includes(u))return new URL(u+":"+s).pathname;var o=s[0]=="/";return s=new URL(o?s:"/-"+s,"https://example.com").pathname,o||(s=s.substring(2,s.length)),s}(i.pathname,i.protocol,t)}return typeof e.search=="string"&&(i.search=function(s,u){if(s=Hi(s,"?"),u||s==="")return s;var a=new URL("https://example.com");return a.search=s,a.search?a.search.substring(1,a.search.length):""}(e.search,t)),typeof e.hash=="string"&&(i.hash=function(s,u){if(s=Hi(s,"#"),u||s==="")return s;var a=new URL("https://example.com");return a.hash=s,a.hash?a.hash.substring(1,a.hash.length):""}(e.hash,t)),i}function Rn(i){return i.replace(/([+*?:{}()\\])/g,"\\$1")}function wl(i,e){for(var t="[^"+(e.delimiter||"/#?").replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")+"]+?",n=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/,r="",s=0;s<i.length;++s){var u=i[s],a=s>0?i[s-1]:null,o=s<i.length-1?i[s+1]:null;if(typeof u!="string")if(u.pattern!==""){var l=typeof u.name!="number",c=e.prefixes!==void 0?e.prefixes:"./",f=u.suffix!==""||u.prefix!==""&&(u.prefix.length!==1||!c.includes(u.prefix));f||!l||u.pattern!==t||u.modifier!==""||!o||o.prefix||o.suffix||(f=typeof o=="string"?n.test(o.length>0?o[0]:""):typeof o.name=="number"),!f&&u.prefix===""&&a&&typeof a=="string"&&a.length>0&&(f=c.includes(a[a.length-1])),f&&(r+="{"),r+=Rn(u.prefix),l&&(r+=":"+u.name),u.pattern===".*"?r+=l||a&&typeof a!="string"&&!a.modifier&&!f&&u.prefix===""?"(.*)":"*":u.pattern===t?l||(r+="("+t+")"):r+="("+u.pattern+")",u.pattern===t&&l&&u.suffix!==""&&n.test(u.suffix[0])&&(r+="\\"),r+=Rn(u.suffix),f&&(r+="}"),r+=u.modifier}else{if(u.modifier===""){r+=Rn(u.prefix);continue}r+="{"+Rn(u.prefix)+"}"+u.modifier}else r+=Rn(u)}return r}var yl=function(){function i(t,n){t===void 0&&(t={}),this.pattern=void 0,this.regexp={},this.keys={},this.component_pattern={};try{if(typeof t=="string"){var r=new Dl(t);if(r.parse(),t=r.result,n){if(typeof n!="string")throw new TypeError("'baseURL' parameter is not of type 'string'.");t.baseURL=n}else if(typeof t.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if(n)throw new TypeError("parameter 1 is not of type 'string'.");if(!t||typeof t!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");var s;this.pattern=Vr({pathname:"*",protocol:"*",username:"*",password:"*",hostname:"*",port:"*",search:"*",hash:"*"},t,!0),Co(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");for(var u,a=Ar(bl);!(u=a()).done;)if((s=u.value)in this.pattern){var o={},l=this.pattern[s];switch(this.keys[s]=[],s){case"protocol":Object.assign(o,xt),o.encodePart=Ai;break;case"username":Object.assign(o,xt),o.encodePart=fl;break;case"password":Object.assign(o,xt),o.encodePart=hl;break;case"hostname":Object.assign(o,ll),o.encodePart=yo(l)?vo:Eo;break;case"port":Object.assign(o,xt),o.encodePart=ko;break;case"pathname":Ao(this.regexp.protocol)?(Object.assign(o,cl),o.encodePart=dl):(Object.assign(o,xt),o.encodePart=pl);break;case"search":Object.assign(o,xt),o.encodePart=ml;break;case"hash":Object.assign(o,xt),o.encodePart=gl}try{var c=go(l,o);this.regexp[s]=bo(c,this.keys[s],o),this.component_pattern[s]=wl(c,o)}catch{throw new TypeError("invalid "+s+" pattern '"+this.pattern[s]+"'.")}}}catch(f){throw new TypeError("Failed to construct 'URLPattern': "+f.message)}}var e=i.prototype;return e.test=function(t,n){t===void 0&&(t={});var r,s={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&n)throw new TypeError("parameter 1 is not of type 'string'.");if(t===void 0)return!1;try{s=Vr(s,typeof t=="object"?t:qi(t,n),!1)}catch{return!1}for(r in this.pattern)if(!this.regexp[r].exec(s[r]))return!1;return!0},e.exec=function(t,n){t===void 0&&(t={});var r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&n)throw new TypeError("parameter 1 is not of type 'string'.");if(t!==void 0){try{r=Vr(r,typeof t=="object"?t:qi(t,n),!1)}catch{return null}var s,u={};for(s in u.inputs=n?[t,n]:[t],this.pattern){var a=this.regexp[s].exec(r[s]);if(!a)return null;for(var o,l={},c=Ar(this.keys[s].entries());!(o=c()).done;){var f=o.value,h=f[1];typeof h.name!="string"&&typeof h.name!="number"||(l[h.name]=a[f[0]+1]||"")}u[s]={input:r[s]||"",groups:l}}return u}},po(i,[{key:"protocol",get:function(){return this.component_pattern.protocol}},{key:"username",get:function(){return this.component_pattern.username}},{key:"password",get:function(){return this.component_pattern.password}},{key:"hostname",get:function(){return this.component_pattern.hostname}},{key:"port",get:function(){return this.component_pattern.port}},{key:"pathname",get:function(){return this.component_pattern.pathname}},{key:"search",get:function(){return this.component_pattern.search}},{key:"hash",get:function(){return this.component_pattern.hash}}]),i}();const _l={crypto:ao.crypto,setInterval:Tr,setTimeout:rn,WeakRef:co,Blob:fo,Request:tl,Response:nl,Headers:rl,WritableStream:st,TransformStream:Bn,ReadableStream:sn,TransformStreamDefaultController:il,WritableStreamDefaultWriter:sl,WebSocket:bn,TextEncoder:_i,TextDecoder:ho,URLPattern:yl},Fo=Al(globalThis,_l);function Al(i,e){return new Proxy(i,{get(t,n,r){return n in e?e[n]:i[n]},set(t,n,r){return n in e&&delete e[n],i[n]=r,!0},deleteProperty(t,n){let r=!1;return n in e&&(delete e[n],r=!0),n in i&&(delete i[n],r=!0),r},ownKeys(t){const n=Reflect.ownKeys(i),r=Reflect.ownKeys(e),s=new Set(r);return[...n.filter(u=>!s.has(u)),...r]},defineProperty(t,n,r){return n in e&&delete e[n],Reflect.defineProperty(i,n,r),!0},getOwnPropertyDescriptor(t,n){return n in e?Reflect.getOwnPropertyDescriptor(e,n):Reflect.getOwnPropertyDescriptor(i,n)},has(t,n){return n in e||n in i}})}function Bo(i,e){if(i===e)return!0;if(!i||!e)return!1;var t=i.length;if(e.length!==t)return!1;for(var n=0;n<t;n++)if(i[n]!==e[n])return!1;return!0}function Cr(i,e){if(i===e)return!0;if(!i||!e)return!1;var t=Object.keys(i),n=Object.keys(e),r=t.length;if(n.length!==r)return!1;for(var s=0;s<r;s++){var u=t[s];if(i[u]!==e[u]||!Object.prototype.hasOwnProperty.call(e,u))return!1}return!0}var Cl=function(i,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var t=typeof e.cycles=="boolean"?e.cycles:!1,n=e.cmp&&function(s){return function(u){return function(a,o){var l={key:a,value:u[a]},c={key:o,value:u[o]};return s(l,c)}}}(e.cmp),r=[];return function s(u){if(u&&u.toJSON&&typeof u.toJSON=="function"&&(u=u.toJSON()),u!==void 0){if(typeof u=="number")return isFinite(u)?""+u:"null";if(typeof u!="object")return JSON.stringify(u);var a,o;if(Array.isArray(u)){for(o="[",a=0;a<u.length;a++)a&&(o+=","),o+=s(u[a])||"null";return o+"]"}if(u===null)return"null";if(r.indexOf(u)!==-1){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=r.push(u)-1,c=Object.keys(u).sort(n&&n(u));for(o="",a=0;a<c.length;a++){var f=c[a],h=s(u[f]);h&&(o&&(o+=","),o+=JSON.stringify(f)+":"+h)}return r.splice(l,1),"{"+o+"}"}}(i)};const El=$a(Cl);var et={};Object.defineProperty(et,"__esModule",{value:!0});function Sn(i,e,t){var n;if(t===void 0&&(t={}),!e.codes){e.codes={};for(var r=0;r<e.chars.length;++r)e.codes[e.chars[r]]=r}if(!t.loose&&i.length*e.bits&7)throw new SyntaxError("Invalid padding");for(var s=i.length;i[s-1]==="=";)if(--s,!t.loose&&!((i.length-s)*e.bits&7))throw new SyntaxError("Invalid padding");for(var u=new((n=t.out)!=null?n:Uint8Array)(s*e.bits/8|0),a=0,o=0,l=0,c=0;c<s;++c){var f=e.codes[i[c]];if(f===void 0)throw new SyntaxError("Invalid character "+i[c]);o=o<<e.bits|f,a+=e.bits,a>=8&&(a-=8,u[l++]=255&o>>a)}if(a>=e.bits||255&o<<8-a)throw new SyntaxError("Unexpected end of data");return u}function Tn(i,e,t){t===void 0&&(t={});for(var n=t,r=n.pad,s=r===void 0?!0:r,u=(1<<e.bits)-1,a="",o=0,l=0,c=0;c<i.length;++c)for(l=l<<8|255&i[c],o+=8;o>e.bits;)o-=e.bits,a+=e.chars[u&l>>o];if(o&&(a+=e.chars[u&l<<e.bits-o]),s)for(;a.length*e.bits&7;)a+="=";return a}var Wi={chars:"0123456789ABCDEF",bits:4},Vi={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},Ki={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},Qi={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},Gi={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},vl={parse:function(e,t){return Sn(e.toUpperCase(),Wi,t)},stringify:function(e,t){return Tn(e,Wi,t)}},kl={parse:function(e,t){return t===void 0&&(t={}),Sn(t.loose?e.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):e,Vi,t)},stringify:function(e,t){return Tn(e,Vi,t)}},Fl={parse:function(e,t){return Sn(e,Ki,t)},stringify:function(e,t){return Tn(e,Ki,t)}},Bl={parse:function(e,t){return Sn(e,Qi,t)},stringify:function(e,t){return Tn(e,Qi,t)}},Sl={parse:function(e,t){return Sn(e,Gi,t)},stringify:function(e,t){return Tn(e,Gi,t)}},Tl={parse:Sn,stringify:Tn};et.base16=vl;et.base32=kl;et.base32hex=Fl;et.base64=Bl;et.base64url=Sl;et.codec=Tl;const Il=et.base16,Pl=et.base32,Rl=et.base32hex,xl=et.base64,Ol=et.base64url,Ml=et.codec,Nl=Object.freeze(Object.defineProperty({__proto__:null,base16:Il,base32:Pl,base32hex:Rl,base64:xl,base64url:Ol,codec:Ml,default:et},Symbol.toStringTag,{value:"Module"}));var un={};Object.defineProperty(un,"__esModule",{value:!0});var So=un.Hash=To=un.createHash=void 0;const Ll=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],Yi={sha256:1};function $l(i){if(i&&!Yi[i]&&!Yi[i.toLowerCase()])throw new Error("Digest method not supported");return new Io}var To=un.createHash=$l;class Io{constructor(){this.A=1779033703,this.B=-1150833019,this.C=1013904242,this.D=-1521486534,this.E=1359893119,this.F=-1694144372,this.G=528734635,this.H=1541459225,this._size=0,this._sp=0,(!or||xn>=8e3)&&(or=new ArrayBuffer(8e3),xn=0),this._byte=new Uint8Array(or,xn,80),this._word=new Int32Array(or,xn,20),xn+=80}update(e){if(typeof e=="string")return this._utf8(e);if(e==null)throw new TypeError("Invalid type: "+typeof e);const t=e.byteOffset,n=e.byteLength;let r=n/64|0,s=0;if(r&&!(t&3)&&!(this._size%64)){const a=new Int32Array(e.buffer,t,r*16);for(;r--;)this._int32(a,s>>2),s+=64;this._size+=s}if(e.BYTES_PER_ELEMENT!==1&&e.buffer){const a=new Uint8Array(e.buffer,t+s,n-s);return this._uint8(a)}return s===n?this:this._uint8(e,s)}_uint8(e,t){const{_byte:n,_word:r}=this,s=e.length;for(t=t|0;t<s;){const u=this._size%64;let a=u;for(;t<s&&a<64;)n[a++]=e[t++];a>=64&&this._int32(r),this._size+=a-u}return this}_utf8(e){const{_byte:t,_word:n}=this,r=e.length;let s=this._sp;for(let u=0;u<r;){const a=this._size%64;let o=a;for(;u<r&&o<64;){let l=e.charCodeAt(u++)|0;l<128?t[o++]=l:l<2048?(t[o++]=192|l>>>6,t[o++]=128|l&63):l<55296||l>57343?(t[o++]=224|l>>>12,t[o++]=128|l>>>6&63,t[o++]=128|l&63):s?(l=((s&1023)<<10)+(l&1023)+65536,t[o++]=240|l>>>18,t[o++]=128|l>>>12&63,t[o++]=128|l>>>6&63,t[o++]=128|l&63,s=0):s=l}o>=64&&(this._int32(n),n[0]=n[16]),this._size+=o-a}return this._sp=s,this}_int32(e,t){let{A:n,B:r,C:s,D:u,E:a,F:o,G:l,H:c}=this,f=0;for(t=t|0;f<16;)Wt[f++]=ct(e[t++]);for(f=16;f<64;f++)Wt[f]=Kl(Wt[f-2])+Wt[f-7]+Vl(Wt[f-15])+Wt[f-16]|0;for(f=0;f<64;f++){const h=c+Wl(a)+zl(a,o,l)+Ll[f]+Wt[f]|0,d=ql(n)+Hl(n,r,s)|0;c=l,l=o,o=a,a=u+h|0,u=s,s=r,r=n,n=h+d|0}this.A=n+this.A|0,this.B=r+this.B|0,this.C=s+this.C|0,this.D=u+this.D|0,this.E=a+this.E|0,this.F=o+this.F|0,this.G=l+this.G|0,this.H=c+this.H|0}digest(e){const{_byte:t,_word:n}=this;let r=this._size%64|0;for(t[r++]=128;r&3;)t[r++]=0;if(r>>=2,r>14){for(;r<16;)n[r++]=0;r=0,this._int32(n)}for(;r<16;)n[r++]=0;const s=this._size*8,u=(s&4294967295)>>>0,a=(s-u)/4294967296;return a&&(n[14]=ct(a)),u&&(n[15]=ct(u)),this._int32(n),e==="hex"?this._hex():this._bin()}_hex(){const{A:e,B:t,C:n,D:r,E:s,F:u,G:a,H:o}=this;return Pt(e)+Pt(t)+Pt(n)+Pt(r)+Pt(s)+Pt(u)+Pt(a)+Pt(o)}_bin(){const{A:e,B:t,C:n,D:r,E:s,F:u,G:a,H:o,_byte:l,_word:c}=this;return c[0]=ct(e),c[1]=ct(t),c[2]=ct(n),c[3]=ct(r),c[4]=ct(s),c[5]=ct(u),c[6]=ct(a),c[7]=ct(o),l.slice(0,32)}}So=un.Hash=Io;const Wt=new Int32Array(64);let or,xn=0;const Pt=i=>(i+4294967296).toString(16).substr(-8),jl=i=>i<<24&4278190080|i<<8&16711680|i>>8&65280|i>>24&255,Ul=i=>i,ct=Ql()?Ul:jl,zl=(i,e,t)=>t^i&(e^t),Hl=(i,e,t)=>i&e|t&(i|e),ql=i=>(i>>>2|i<<30)^(i>>>13|i<<19)^(i>>>22|i<<10),Wl=i=>(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),Vl=i=>(i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,Kl=i=>(i>>>17|i<<15)^(i>>>19|i<<13)^i>>>10;function Ql(){return new Uint8Array(new Uint16Array([65279]).buffer)[0]===254}const Gl=Ya({__proto__:null,get Hash(){return So},get createHash(){return To},default:un},[un]);/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const Ne=BigInt(0),le=BigInt(1),Qe=BigInt(2),Po=BigInt(255),Ji=Qe**BigInt(252)+BigInt("27742317777372353535851937790883648493"),ge={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:Qe**Po-BigInt(19),l:Ji,n:Ji,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},Ro=Qe**BigInt(256),Hn=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");const Yl=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Jl=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Zl=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Xl=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class he{constructor(e,t,n,r){this.x=e,this.y=t,this.z=n,this.t=r}static fromAffine(e){if(!(e instanceof Te))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(Te.ZERO)?he.ZERO:new he(e.x,e.y,le,x(e.x*e.y))}static toAffineBatch(e){const t=nc(e.map(n=>n.z));return e.map((n,r)=>n.toAffine(t[r]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){Zi(e);const{x:t,y:n,z:r}=this,{x:s,y:u,z:a}=e,o=x(t*a),l=x(s*r),c=x(n*a),f=x(u*r);return o===l&&c===f}negate(){return new he(x(-this.x),this.y,this.z,x(-this.t))}double(){const{x:e,y:t,z:n}=this,{a:r}=ge,s=x(e**Qe),u=x(t**Qe),a=x(Qe*x(n**Qe)),o=x(r*s),l=x(x((e+t)**Qe)-s-u),c=o+u,f=c-a,h=o-u,d=x(l*f),p=x(c*h),g=x(l*h),C=x(f*c);return new he(d,p,C,g)}add(e){Zi(e);const{x:t,y:n,z:r,t:s}=this,{x:u,y:a,z:o,t:l}=e,c=x((n-t)*(a+u)),f=x((n+t)*(a-u)),h=x(f-c);if(h===Ne)return this.double();const d=x(r*Qe*l),p=x(s*Qe*o),g=p+d,C=f+c,b=p-d,E=x(g*h),A=x(C*b),F=x(g*b),T=x(h*C);return new he(E,A,T,F)}subtract(e){return this.add(e.negate())}precomputeWindow(e){const t=1+256/e,n=[];let r=this,s=r;for(let u=0;u<t;u++){s=r,n.push(s);for(let a=1;a<2**(e-1);a++)s=s.add(r),n.push(s);r=s.double()}return n}wNAF(e,t){!t&&this.equals(he.BASE)&&(t=Te.BASE);const n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let r=t&&li.get(t);r||(r=this.precomputeWindow(n),t&&n!==1&&(r=he.normalizeZ(r),li.set(t,r)));let s=he.ZERO,u=he.ZERO;const a=1+256/n,o=2**(n-1),l=BigInt(2**n-1),c=2**n,f=BigInt(n);for(let h=0;h<a;h++){const d=h*o;let p=Number(e&l);if(e>>=f,p>o&&(p-=c,e+=le),p===0){let g=r[d];h%2&&(g=g.negate()),u=u.add(g)}else{let g=r[d+Math.abs(p)-1];p<0&&(g=g.negate()),s=s.add(g)}}return he.normalizeZ([s,u])[0]}multiply(e,t){return this.wNAF(Er(e,ge.l),t)}multiplyUnsafe(e){let t=Er(e,ge.l,!1);const n=he.BASE,r=he.ZERO;if(t===Ne)return r;if(this.equals(r)||t===le)return this;if(this.equals(n))return this.wNAF(t);let s=r,u=this;for(;t>Ne;)t&le&&(s=s.add(u)),u=u.double(),t>>=le;return s}isSmallOrder(){return this.multiplyUnsafe(ge.h).equals(he.ZERO)}isTorsionFree(){return this.multiplyUnsafe(ge.l).equals(he.ZERO)}toAffine(e=Ir(this.z)){const{x:t,y:n,z:r}=this,s=x(t*e),u=x(n*e);if(x(r*e)!==le)throw new Error("invZ was invalid");return new Te(s,u)}fromRistrettoBytes(){Qr()}toRistrettoBytes(){Qr()}fromRistrettoHash(){Qr()}}he.BASE=new he(ge.Gx,ge.Gy,le,x(ge.Gx*ge.Gy));he.ZERO=new he(Ne,le,le,Ne);function Zi(i){if(!(i instanceof he))throw new TypeError("ExtendedPoint expected")}function Kr(i){if(!(i instanceof at))throw new TypeError("RistrettoPoint expected")}function Qr(){throw new Error("Legacy method: switch to RistrettoPoint")}class at{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){const{d:t}=ge,n=x(Hn*e*e),r=x((n+le)*Zl);let s=BigInt(-1);const u=x((s-t*n)*x(n+t));let{isValid:a,value:o}=Ci(r,u),l=x(o*e);Ot(l)||(l=x(-l)),a||(o=l),a||(s=n);const c=x(s*(n-le)*Xl-u),f=o*o,h=x((o+o)*u),d=x(c*Yl),p=x(le-f),g=x(le+f);return new he(x(h*g),x(p*d),x(d*g),x(h*p))}static hashToCurve(e){e=$t(e,64);const t=Gr(e.slice(0,32)),n=this.calcElligatorRistrettoMap(t),r=Gr(e.slice(32,64)),s=this.calcElligatorRistrettoMap(r);return new at(n.add(s))}static fromHex(e){e=$t(e,32);const{a:t,d:n}=ge,r="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",s=Gr(e);if(!ic(Qn(s),e)||Ot(s))throw new Error(r);const u=x(s*s),a=x(le+t*u),o=x(le-t*u),l=x(a*a),c=x(o*o),f=x(t*n*l-c),{isValid:h,value:d}=Xi(x(f*c)),p=x(d*o),g=x(d*p*f);let C=x((s+s)*p);Ot(C)&&(C=x(-C));const b=x(a*g),E=x(C*b);if(!h||Ot(E)||b===Ne)throw new Error(r);return new at(new he(C,b,le,E))}toRawBytes(){let{x:e,y:t,z:n,t:r}=this.ep;const s=x(x(n+t)*x(n-t)),u=x(e*t),{value:a}=Xi(x(s*u**Qe)),o=x(a*s),l=x(a*u),c=x(o*l*r);let f;if(Ot(r*c)){let d=x(t*Hn),p=x(e*Hn);e=d,t=p,f=x(o*Jl)}else f=l;Ot(e*c)&&(t=x(-t));let h=x((n-t)*f);return Ot(h)&&(h=x(-h)),Qn(h)}toHex(){return er(this.toRawBytes())}toString(){return this.toHex()}equals(e){Kr(e);const t=this.ep,n=e.ep,r=x(t.x*n.y)===x(t.y*n.x),s=x(t.y*n.y)===x(t.x*n.x);return r||s}add(e){return Kr(e),new at(this.ep.add(e.ep))}subtract(e){return Kr(e),new at(this.ep.subtract(e.ep))}multiply(e){return new at(this.ep.multiply(e))}multiplyUnsafe(e){return new at(this.ep.multiplyUnsafe(e))}}at.BASE=new at(he.BASE);at.ZERO=new at(he.ZERO);const li=new WeakMap;class Te{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,li.delete(this)}static fromHex(e,t=!0){const{d:n,P:r}=ge;e=$t(e,32);const s=e.slice();s[31]=e[31]&-129;const u=In(s);if(t&&u>=r)throw new Error("Expected 0 < hex < P");if(!t&&u>=Ro)throw new Error("Expected 0 < hex < 2**256");const a=x(u*u),o=x(a-le),l=x(n*a+le);let{isValid:c,value:f}=Ci(o,l);if(!c)throw new Error("Point.fromHex: invalid y coordinate");const h=(f&le)===le;return(e[31]&128)!==0!==h&&(f=x(-f)),new Te(f,u)}static async fromPrivateKey(e){return(await Pr(e)).point}toRawBytes(){const e=Qn(this.y);return e[31]|=this.x&le?128:0,e}toHex(){return er(this.toRawBytes())}toX25519(){const{y:e}=this,t=x((le+e)*Ir(le-e));return Qn(t)}isTorsionFree(){return he.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new Te(x(-this.x),this.y)}add(e){return he.fromAffine(this).add(he.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return he.fromAffine(this).multiply(e,this).toAffine()}}Te.BASE=new Te(ge.Gx,ge.Gy);Te.ZERO=new Te(Ne,le);class Kn{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromHex(e){const t=$t(e,64),n=Te.fromHex(t.slice(0,32),!1),r=In(t.slice(32,64));return new Kn(n,r)}assertValidity(){const{r:e,s:t}=this;if(!(e instanceof Te))throw new Error("Expected Point instance");return Er(t,ge.l,!1),this}toRawBytes(){const e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(Qn(this.s),32),e}toHex(){return er(this.toRawBytes())}}function ec(...i){if(!i.every(n=>n instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(i.length===1)return i[0];const e=i.reduce((n,r)=>n+r.length,0),t=new Uint8Array(e);for(let n=0,r=0;n<i.length;n++){const s=i[n];t.set(s,r),r+=s.length}return t}const tc=Array.from({length:256},(i,e)=>e.toString(16).padStart(2,"0"));function er(i){if(!(i instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let t=0;t<i.length;t++)e+=tc[i[t]];return e}function xo(i){if(typeof i!="string")throw new TypeError("hexToBytes: expected string, got "+typeof i);if(i.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const e=new Uint8Array(i.length/2);for(let t=0;t<e.length;t++){const n=t*2,r=i.slice(n,n+2),s=Number.parseInt(r,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[t]=s}return e}function Oo(i){const t=i.toString(16).padStart(64,"0");return xo(t)}function Qn(i){return Oo(i).reverse()}function Ot(i){return(x(i)&le)===le}function In(i){if(!(i instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+er(Uint8Array.from(i).reverse()))}function Gr(i){return x(In(i)&Qe**Po-le)}function x(i,e=ge.P){const t=i%e;return t>=Ne?t:e+t}function Ir(i,e=ge.P){if(i===Ne||e<=Ne)throw new Error(`invert: expected positive integers, got n=${i} mod=${e}`);let t=x(i,e),n=e,r=Ne,s=le;for(;t!==Ne;){const a=n/t,o=n%t,l=r-s*a;n=t,t=o,r=s,s=l}if(n!==le)throw new Error("invert: does not exist");return x(r,e)}function nc(i,e=ge.P){const t=new Array(i.length),n=i.reduce((s,u,a)=>u===Ne?s:(t[a]=s,x(s*u,e)),le),r=Ir(n,e);return i.reduceRight((s,u,a)=>u===Ne?s:(t[a]=x(s*t[a],e),x(s*u,e)),r),t}function dt(i,e){const{P:t}=ge;let n=i;for(;e-- >Ne;)n*=n,n%=t;return n}function rc(i){const{P:e}=ge,t=BigInt(5),n=BigInt(10),r=BigInt(20),s=BigInt(40),u=BigInt(80),o=i*i%e*i%e,l=dt(o,Qe)*o%e,c=dt(l,le)*i%e,f=dt(c,t)*c%e,h=dt(f,n)*f%e,d=dt(h,r)*h%e,p=dt(d,s)*d%e,g=dt(p,u)*p%e,C=dt(g,u)*p%e,b=dt(C,n)*f%e;return{pow_p_5_8:dt(b,Qe)*i%e,b2:o}}function Ci(i,e){const t=x(e*e*e),n=x(t*t*e),r=rc(i*n).pow_p_5_8;let s=x(i*t*r);const u=x(e*s*s),a=s,o=x(s*Hn),l=u===i,c=u===x(-i),f=u===x(-i*Hn);return l&&(s=a),(c||f)&&(s=o),Ot(s)&&(s=x(-s)),{isValid:l||c,value:s}}function Xi(i){return Ci(le,i)}async function ci(...i){const e=await Rr.sha512(ec(...i)),t=In(e);return x(t,ge.l)}function ic(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}function $t(i,e){const t=i instanceof Uint8Array?Uint8Array.from(i):xo(i);if(typeof e=="number"&&t.length!==e)throw new Error(`Expected ${e} bytes`);return t}function Er(i,e,t=!0){if(!e)throw new TypeError("Specify max value");if(typeof i=="number"&&Number.isSafeInteger(i)&&(i=BigInt(i)),typeof i=="bigint"&&i<e){if(t){if(Ne<i)return i}else if(Ne<=i)return i}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function sc(i){return i[0]&=248,i[31]&=127,i[31]|=64,i}async function Pr(i){if(i=typeof i=="bigint"||typeof i=="number"?Oo(Er(i,Ro)):$t(i),i.length!==32)throw new Error("Expected 32 bytes");const e=await Rr.sha512(i),t=sc(e.slice(0,32)),n=e.slice(32,64),r=x(In(t),ge.l),s=Te.BASE.multiply(r),u=s.toRawBytes();return{head:t,prefix:n,scalar:r,point:s,pointBytes:u}}async function uc(i){return(await Pr(i)).pointBytes}async function oc(i,e){i=$t(i);const{prefix:t,scalar:n,pointBytes:r}=await Pr(e),s=await ci(t,i),u=Te.BASE.multiply(s),a=await ci(u.toRawBytes(),r,i),o=x(s+a*n,ge.l);return new Kn(u,o).toRawBytes()}async function ac(i,e,t){e=$t(e),t instanceof Te||(t=Te.fromHex(t,!1));const{r:n,s:r}=i instanceof Kn?i.assertValidity():Kn.fromHex(i),s=he.BASE.multiplyUnsafe(r),u=await ci(n.toRawBytes(),t.toRawBytes(),e),a=he.fromAffine(t).multiplyUnsafe(u);return he.fromAffine(n).add(a).subtract(s).multiplyUnsafe(ge.h).equals(he.ZERO)}Te.BASE._setWindowSize(8);const Rt={node:ja,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},Rr={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:er,getExtendedPublicKey:Pr,mod:x,invert:Ir,hashToPrivateScalar:i=>{if(i=$t(i),i.length<40||i.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const e=x(In(i),ge.l);if(e===Ne||e===le)throw new Error("Invalid private key");return e},randomBytes:(i=32)=>{if(Rt.web)return Rt.web.getRandomValues(new Uint8Array(i));if(Rt.node){const{randomBytes:e}=Rt.node;return new Uint8Array(e(i).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Rr.randomBytes(32),sha512:async i=>{if(Rt.web){const e=await Rt.web.subtle.digest("SHA-512",i.buffer);return new Uint8Array(e)}else{if(Rt.node)return Uint8Array.from(Rt.node.createHash("sha512").update(i).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(i=8,e=Te.BASE){const t=e.equals(Te.BASE)?e:new Te(e.x,e.y);return t._setWindowSize(i),t.multiply(Qe),t}};var ue=globalThis&&globalThis.__classPrivateFieldGet||function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},Se=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},At,Ct,Et,vt,kt,Ft,Zt,ze;const Fe=11400714785074694791n,Le=14029467366897019727n,es=1609587929392839161n,On=9650029242287828579n,ts=2870177450012600261n,Mo=64n,lc=2n**Mo-1n,cc=new _i;function ns(i,e,t,n){return BigInt(i)|BigInt(e)<<16n|BigInt(t)<<32n|BigInt(n)<<48n}function yt(i,e){return BigInt(i[e])|BigInt(i[e+1])<<8n|BigInt(i[e+2])<<16n|BigInt(i[e+3])<<24n|BigInt(i[e+4])<<32n|BigInt(i[e+5])<<40n|BigInt(i[e+6])<<48n|BigInt(i[e+7])<<56n}function Pe(i,e){return i<<e&lc|i>>Mo-e}function ne(i){return BigInt.asUintN(64,i)}class Ei{constructor(e=0){At.set(this,void 0),Ct.set(this,void 0),Et.set(this,void 0),vt.set(this,void 0),kt.set(this,void 0),Ft.set(this,void 0),Zt.set(this,void 0),ze.set(this,void 0),this.reset(e)}reset(e=ue(this,At,"f")){return Se(this,At,BigInt.asUintN(32,BigInt(e)),"f"),Se(this,Ct,ne(ue(this,At,"f")+Fe+Le),"f"),Se(this,Et,ne(ue(this,At,"f")+Le),"f"),Se(this,vt,ue(this,At,"f"),"f"),Se(this,kt,ne(ue(this,At,"f")-Fe),"f"),Se(this,Ft,null,"f"),Se(this,Zt,0,"f"),Se(this,ze,0,"f"),this}update(e){typeof e=="string"&&(e=cc.encode(e));let t=0,n=e.length,r=t+n;if(n===0)return this;if(Se(this,Zt,ue(this,Zt,"f")+n,"f"),ue(this,ze,"f")===0&&Se(this,Ft,new Uint8Array(32),"f"),ue(this,ze,"f")+n<32)return ue(this,Ft,"f").set(e.subarray(0,n),ue(this,ze,"f")),Se(this,ze,ue(this,ze,"f")+n,"f"),this;if(ue(this,ze,"f")>0){ue(this,Ft,"f").set(e.subarray(0,32-ue(this,ze,"f")),ue(this,ze,"f"));let s=0,u;u=yt(ue(this,Ft,"f"),s),Se(this,Ct,ne(Pe(ne(ue(this,Ct,"f")+u*Le),31n)*Fe),"f"),s+=8,u=yt(this.memory,s),Se(this,Et,ne(Pe(ne(ue(this,Et,"f")+u*Le),31n)*Fe),"f"),s+=8,u=yt(this.memory,s),Se(this,vt,ne(Pe(ne(ue(this,vt,"f")+u*Le),31n)*Fe),"f"),s+=8,u=yt(this.memory,s),Se(this,kt,ne(Pe(ne(ue(this,kt,"f")+u*Le),31n)*Fe),"f"),t+=32-ue(this,ze,"f"),Se(this,ze,0,"f")}if(t<=r-32){const s=r-32;do{let u;u=yt(e,t),Se(this,Ct,ne(Pe(ne(ue(this,Ct,"f")+u*Le),31n)*Fe),"f"),t+=8,u=yt(e,t),Se(this,Et,ne(Pe(ne(ue(this,Et,"f")+u*Le),31n)*Fe),"f"),t+=8,u=yt(e,t),Se(this,vt,ne(Pe(ne(ue(this,vt,"f")+u*Le),31n)*Fe),"f"),t+=8,u=yt(e,t),Se(this,kt,ne(Pe(ne(ue(this,kt,"f")+u*Le),31n)*Fe),"f"),t+=8}while(t<=s)}return t<r&&(ue(this,Ft,"f").set(e.subarray(t,r),ue(this,ze,"f")),Se(this,ze,r-t,"f")),this}digest(){let e=ue(this,Ft,"f"),t=ue(this,ze,"f"),n=0,r=0n,s=0n,u=0n;for(ue(this,Zt,"f")>=32?(r=Pe(ue(this,Ct,"f"),1n)+Pe(ue(this,Et,"f"),7n)+Pe(ue(this,vt,"f"),12n)+Pe(ue(this,kt,"f"),18n),r=ne(r^Pe(ne(ue(this,Ct,"f")*Le),31n)*Fe),r=ne(r*Fe+On),r=ne(r^Pe(ne(ue(this,Et,"f")*Le),31n)*Fe),r=ne(r*Fe+On),r=ne(r^Pe(ne(ue(this,vt,"f")*Le),31n)*Fe),r=ne(r*Fe+On),r=ne(r^Pe(ne(ue(this,kt,"f")*Le),31n)*Fe),r=ne(r*Fe+On)):r=ne(ue(this,At,"f")+ts),r+=BigInt(ue(this,Zt,"f"));n<=t-8;)u=yt(e,n),u=ne(Pe(ne(u*Le),31n)*Fe),r=ne(Pe(r^u,27n)*Fe+On),n+=8;for(n+4<=t&&(u=ns(e[n+1]<<8|e[n],e[n+3]<<8|e[n+2],0,0),r=ne(Pe(r^ne(u*Fe),23n)*Le+es),n+=4);n<t;)u=ns(e[n++],0,0,0),r=ne(Pe(r^ne(u*ts),11n)*Fe);return s=ne(r>>33n),r=ne((r^s)*Le),s=ne(r>>29n),r=ne((r^s)*es),s=ne(r>>32n),r=ne(r^s),r}}At=new WeakMap,Ct=new WeakMap,Et=new WeakMap,vt=new WeakMap,kt=new WeakMap,Ft=new WeakMap,Zt=new WeakMap,ze=new WeakMap;function fc(i,e=0){return new Ei(e).update(i).digest()}function No(i,e){return i<e?-1:i>e?1:0}class en{constructor(e,t){Object.defineProperty(this,"parent",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"left",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"right",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.left=null,this.right=null}static from(e){const t=new en(e.parent,e.value);return t.left=e.left,t.right=e.right,t}directionFromParent(){return this.parent===null?null:this===this.parent.left?"left":this===this.parent.right?"right":null}findMinNode(){let e=this.left;for(;e!=null&&e.left;)e=e.left;return e??this}findMaxNode(){let e=this.right;for(;e!=null&&e.right;)e=e.right;return e??this}findSuccessorNode(){if(this.right!==null)return this.right.findMinNode();let e=this.parent,t=this.directionFromParent();for(;e&&t==="right";)t=e.directionFromParent(),e=e.parent;return e}}class gn{constructor(e=No){Object.defineProperty(this,"compare",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"root",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_size",{enumerable:!0,configurable:!0,writable:!0,value:0})}static from(e,t){let n,r=[];if(e instanceof gn)if(n=new gn((t==null?void 0:t.compare)??e.compare),t!=null&&t.compare||t!=null&&t.map)r=e;else{const u=[];for(e.root&&(n.root=en.from(e.root),u.push(n.root));u.length;){const a=u.pop(),o=a.left?en.from(a.left):null,l=a.right?en.from(a.right):null;o&&(o.parent=a,u.push(o)),l&&(l.parent=a,u.push(l))}}else n=t!=null&&t.compare?new gn(t.compare):new gn,r=e;const s=t!=null&&t.map?Array.from(r,t.map,t.thisArg):r;for(const u of s)n.insert(u);return n}get size(){return this._size}findNode(e){let t=this.root;for(;t;){const n=this.compare(e,t.value);if(n===0)break;const r=n<0?"left":"right";t=t[r]}return t}rotateNode(e,t){const n=t==="left"?"right":"left";if(!e[n])throw new TypeError(`cannot rotate ${t} without ${n} child`);const r=e[n];if(e[n]=r[t]??null,r[t]&&(r[t].parent=e),r.parent=e.parent,e.parent){const s=e===e.parent[t]?t:n;e.parent[s]=r}else this.root=r;r[t]=e,e.parent=r}insertNode(e,t){if(this.root){let n=this.root;for(;;){const r=this.compare(t,n.value);if(r===0)break;const s=r<0?"left":"right";if(n[s])n=n[s];else return n[s]=new e(n,t),this._size++,n[s]}}else return this.root=new e(null,t),this._size++,this.root;return null}removeNode(e){let t=this.findNode(e);if(t){const n=!t.left||!t.right?t:t.findSuccessorNode(),r=n.left??n.right;r&&(r.parent=n.parent),n.parent?n.parent[n.directionFromParent()]=r:this.root=r,n!==t&&(t.value=n.value,t=n),this._size--}return t}insert(e){return!!this.insertNode(en,e)}remove(e){return!!this.removeNode(e)}find(e){var t;return((t=this.findNode(e))==null?void 0:t.value)??null}min(){return this.root?this.root.findMinNode().value:null}max(){return this.root?this.root.findMaxNode().value:null}clear(){this.root=null,this._size=0}isEmpty(){return this.size===0}*lnrValues(){const e=[];let t=this.root;for(;e.length||t;)t?(e.push(t),t=t.left):(t=e.pop(),yield t.value,t=t.right)}*rnlValues(){const e=[];let t=this.root;for(;e.length||t;)t?(e.push(t),t=t.right):(t=e.pop(),yield t.value,t=t.left)}*nlrValues(){const e=[];for(this.root&&e.push(this.root);e.length;){const t=e.pop();yield t.value,t.right&&e.push(t.right),t.left&&e.push(t.left)}}*lrnValues(){const e=[];let t=this.root,n=null;for(;e.length||t;)if(t)e.push(t),t=t.left;else{const r=e[e.length-1];r.right&&r.right!==n?t=r.right:(yield r.value,n=e.pop())}}*lvlValues(){const e=[];let t=this.root;for(;t;)yield t.value,t.left&&e.push(t.left),t.right&&e.push(t.right),t=e.shift()??null}*[Symbol.iterator](){yield*this.lnrValues()}}class tn extends en{constructor(e,t){super(e,t),Object.defineProperty(this,"red",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.red=!0}static from(e){const t=new tn(e.parent,e.value);return t.left=e.left,t.right=e.right,t.red=e.red,t}}class Dn extends gn{constructor(e=No){super(e)}static from(e,t){let n,r=[];if(e instanceof Dn)if(n=new Dn((t==null?void 0:t.compare)??e.compare),t!=null&&t.compare||t!=null&&t.map)r=e;else{const u=[];for(e.root&&(n.root=tn.from(e.root),u.push(n.root));u.length;){const a=u.pop(),o=a.left?tn.from(a.left):null,l=a.right?tn.from(a.right):null;o&&(o.parent=a,u.push(o)),l&&(l.parent=a,u.push(l))}}else n=t!=null&&t.compare?new Dn(t.compare):new Dn,r=e;const s=t!=null&&t.map?Array.from(r,t.map,t.thisArg):r;for(const u of s)n.insert(u);return n}removeFixup(e,t){var n,r,s;for(;e&&!(t!=null&&t.red);){const u=e.left===t?"left":"right",a=u==="right"?"left":"right";let o=e[a];o!=null&&o.red&&(o.red=!1,e.red=!0,this.rotateNode(e,u),o=e[a]),o&&(!((n=o.left)!=null&&n.red)&&!((r=o.right)!=null&&r.red)?(o.red=!0,t=e,e=t.parent):((s=o[a])!=null&&s.red||(o[u].red=!1,o.red=!0,this.rotateNode(o,a),o=e[a]),o.red=e.red,e.red=!1,o[a].red=!1,this.rotateNode(e,u),t=this.root,e=null))}t&&(t.red=!1)}insert(e){var n;let t=this.insertNode(tn,e);if(t){for(;(n=t.parent)!=null&&n.red;){let r=t.parent;const s=r.directionFromParent(),u=s==="right"?"left":"right",a=r.parent[u]??null;a!=null&&a.red?(r.red=!1,a.red=!1,r.parent.red=!0,t=r.parent):(t===r[u]&&(t=r,this.rotateNode(t,s),r=t.parent),r.red=!1,r.parent.red=!0,this.rotateNode(r.parent,u))}this.root.red=!1}return!!t}remove(e){const t=this.removeNode(e);return t&&!t.red&&this.removeFixup(t.parent,t.left??t.right),!!t}}function Yr(i,e){return{lift:t=>[i.lift(t),e.lift(t)],combine:(t,n)=>{const r=i.combine(t[0],n[0]),s=e.combine(t[1],n[1]);return[r,s]},neutral:[i.neutral,e.neutral]}}const hc={lift:i=>1,combine:(i,e)=>i+e,neutral:0};class rs extends tn{constructor(e,t,n){super(e,t),Object.defineProperty(this,"label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"liftedValue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"monoid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.label=n.neutral,this.liftedValue=n.lift(t),this.monoid=n}updateLabel(e=!0,t){var n;this.left!==null&&this.right===null?this.label=this.monoid.combine(this.left.label,this.liftedValue):this.left===null&&this.right!==null?this.label=this.monoid.combine(this.liftedValue,this.right.label):this.left&&this.right?this.label=this.monoid.combine(this.left.label,this.monoid.combine(this.liftedValue,this.right.label)):this.label=this.liftedValue,e&&((n=this.parent)==null||n.updateLabel(!0,"Updated by child"))}}class dc extends Dn{constructor(e,t){super(t),Object.defineProperty(this,"monoid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedMinNode",{enumerable:!0,configurable:!0,writable:!0,value:null});const s=Yr({lift:u=>[u],combine:(u,a)=>u.concat(a),neutral:[]},{lift:u=>u,combine:(u,a)=>{if(!(u===void 0&&a===void 0))return a===void 0?u:u===void 0?a:t(u,a)>0?u:a},neutral:void 0});this.monoid=Yr(e,Yr(hc,s))}getLowestValue(){if(!this.root)throw new Error("Can't get a range from a tree with no items");return this.cachedMinNode?this.cachedMinNode.value:this.root.findMinNode().value}rotateNode(e,t){var s;const n=t==="left"?"right":"left";if(!e[n])throw new TypeError(`cannot rotate ${t} without ${n} child`);const r=e[n];if(e[n]=r[t]??null,r[t]&&(r[t].parent=e),r.parent=e.parent,e.parent){const u=e===e.parent[t]?t:n;e.parent[u]=r}else this.root=r;r[t]=e,e.parent=r,(s=r[t])==null||s.updateLabel(!1,"Node rotated")}removeFixup(e,t){var n,r,s;for(;e&&!(t!=null&&t.red);){const u=e.left===t?"left":"right",a=u==="right"?"left":"right";let o=e[a];o!=null&&o.red&&(o.red=!1,e.red=!0,this.rotateNode(e,u),o=e[a]),o&&(!((n=o.left)!=null&&n.red)&&!((r=o.right)!=null&&r.red)?(o.red=!0,t=e,e=t.parent):((s=o[a])!=null&&s.red||(o[u].red=!1,o.red=!0,this.rotateNode(o,a),o=e[a]),o.red=e.red,e.red=!1,o[a].red=!1,this.rotateNode(e,u),t=this.root,e=null))}t&&(t.red=!1)}insertFingerprintNode(e){if(this.root){let t=this.root,n=!0;for(;;){const r=this.compare(e,t.value);if(r===0){n=!1;break}const s=r<0?"left":"right";if(n&&s==="right"&&(n=!1),t[s])t=t[s];else return t[s]=new rs(t,e,this.monoid),this._size++,n&&(this.cachedMinNode=t[s]),t[s]}}else return this.root=new rs(null,e,this.monoid),this._size++,this.cachedMinNode=this.root,this.root;return null}insert(e){var r;const t=this.insertFingerprintNode(e);let n=t;if(n){for(;(r=n.parent)!=null&&r.red;){let s=n.parent;const u=s.directionFromParent(),a=u==="right"?"left":"right",o=s.parent[a]??null;o!=null&&o.red?(s.red=!1,o.red=!1,s.parent.red=!0,n=s.parent):(n===s[a]&&(n=s,this.rotateNode(n,u),s=n.parent),s.red=!1,s.parent.red=!0,this.rotateNode(s.parent,a))}this.root.red=!1}return t==null||t.updateLabel(!0,"Node inserted"),!!n}remove(e){var n;const t=this.removeNode(e);return t&&!t.red&&this.removeFixup(t.parent,t.left??t.right),t&&((n=t.parent)==null||n.updateLabel(!0,"Child node removed")),!!t}getFingerprint(e,t,n){if(this.root===null)return{fingerprint:this.monoid.neutral[0],size:0,items:[],nextTree:null};const r=this.compare(e,t);if(r===0)return{fingerprint:this.root.label[0],size:this.root.label[1][0],items:this.root.label[1][1][0],nextTree:this.cachedMinNode};if(r<0){const s=this.compare(e,this.cachedMinNode.value)<=0?this.cachedMinNode:null,u=n||s||this.findGteNode(e),{label:a,nextTree:o}=this.aggregateUntil(u,e,t);return{fingerprint:a[0],size:a[1][0],items:a[1][1][0],nextTree:o}}else{const s=this.cachedMinNode,u=this.root.label[1][1][1],a=this.compare(t,s.value)>0,o=this.compare(e,u)<=0;if(a&&o){const{label:l,nextTree:c}=this.aggregateUntil(s,s.value,t),h=[this.monoid.lift(u)[0],[1,[[u],u]]],d=n||this.findGteNode(e),{label:p}=this.aggregateUntil(d,e,u),g=this.monoid.combine(p,h),C=this.monoid.combine(l,g);return{fingerprint:C[0],size:C[1][0],items:C[1][1][0],nextTree:c}}else if(a){const{label:l,nextTree:c}=this.aggregateUntil(s,s.value,t);return{fingerprint:l[0],size:l[1][0],items:l[1][1][0],nextTree:c}}else{const l=this.compare(e,this.cachedMinNode.value)<=0?this.cachedMinNode:null,c=n||l||this.findGteNode(e),{label:f}=this.aggregateUntil(c,e,u),d=[this.monoid.lift(u)[0],[1,[[u],u]]],p=this.monoid.combine(f,d);return{fingerprint:p[0],size:p[1][0],items:p[1][1][0],nextTree:l}}}}findGteNode(e){let t=this.root;for(;t;){const n=this.compare(e,t.value);if(n===0)break;const r=n<0?"left":"right";if(t[r])t=t[r];else break}return t}aggregateUntil(e,t,n){const{label:r,nextTree:s}=this.aggregateUp(e,t,n);return s===null||this.compare(s.value,n)>=0?{label:r,nextTree:s}:this.aggregateDown(s.right,n,this.monoid.combine(r,s.liftedValue))}aggregateUp(e,t,n){var u;let r=this.monoid.neutral,s=e;for(;this.compare(s.label[1][1][1],n)<0;){if(this.compare(s.value,t)>=0&&(r=this.monoid.combine(r,this.monoid.combine(s.liftedValue,((u=s.right)==null?void 0:u.label)||this.monoid.neutral))),s.parent===null)return{label:r,nextTree:null};s=s.parent}return{label:r,nextTree:s}}aggregateDown(e,t,n){var u,a;let r=e,s=n;for(;r!==null;)if(this.compare(r.value,t)<0)s=this.monoid.combine(s,this.monoid.combine(((u=r.left)==null?void 0:u.label)||this.monoid.neutral,r.liftedValue)),r=r.right;else{if(r.left===null||this.compare(r.label[1][1][1],t)<0)return{label:this.monoid.combine(s,((a=r.left)==null?void 0:a.label)||this.monoid.neutral),nextTree:r};r=r.left}return{label:s,nextTree:null}}isValueEqual(e,t){return this.compare(e,t)===0}}function pc(){let i,e="pending";const t=new Promise((n,r)=>{i={async resolve(s){await s,e="fulfilled",n(s)},reject(s){e="rejected",r(s)}}});return Object.defineProperty(t,"state",{get:()=>e}),Object.assign(t,i)}class mc{constructor(){Object.defineProperty(this,"deferreds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"pending"})}resolve(e){if(this.state==="pending"){this.state="fulfilled";for(const t of this.deferreds)t.resolve(e)}}reject(e){if(this.state==="pending"){this.state="rejected";for(const t of this.deferreds)t.reject(e)}}tee(){const e=pc();return this.state==="fulfilled"?e.resolve():this.state==="rejected"?e.reject():this.deferreds.add(e),e}}class gc{constructor(e){Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDoneTee",{enumerable:!0,configurable:!0,writable:!0,value:new mc}),Object.defineProperty(this,"insertionCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"fingerprintEquals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowerBoundFromPrev",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"collatedPayload",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"collatePayloads",{enumerable:!0,configurable:!0,writable:!0,value:t=>{switch(t.type){case"payload":{let n=this.collatedPayload;if(n===null&&(n={type:"payload",lowerBound:t.lowerBound,payload:[],end:{canRespond:!1,upperBound:t.payload}}),n.payload.push(t.payload),this.collatedPayload=n,t.end)return t.end.upperBound?n.end=t.end:n.end={...t.end,upperBound:t.payload},this.collatedPayload=null,n;break}default:return this.collatedPayload&&(this.collatedPayload=null),t}}}),Object.defineProperty(this,"reusableTree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastAdjacentDoneUpperBound",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"isDoneSoFar",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.tree=e.tree,this.fingerprintEquals=e.fingerprintEquals,this.encoding=e.encoding,this.payloadThreshold=e.payloadThreshold,this.rangeDivision=e.rangeDivision}decode(e){const t=this.lowerBoundFromPrev;try{switch(this.encoding.decode.getType(e)){case"payload":{const r=this.encoding.decode.payload(e);return r.end&&(this.lowerBoundFromPrev=r.end.upperBound),{type:"payload",lowerBound:t,payload:r.value,...r.end?{end:r.end}:{}}}case"fingerprint":{const r=this.encoding.decode.fingerprint(e);return this.lowerBoundFromPrev=r.upperBound,{type:"fingerprint",lowerBound:t,fingerprint:r.fingerprint,upperBound:r.upperBound}}case"emptyPayload":{const r=this.encoding.decode.emptyPayload(e);return this.lowerBoundFromPrev=r,{lowerBound:t,type:"emptyPayload",upperBound:r}}case"done":{const r=this.encoding.decode.done(e);return this.lowerBoundFromPrev=r,{lowerBound:t,type:"done",upperBound:r}}case"emptySet":return{type:"emptySet",canRespond:this.encoding.decode.emptySet(e)};case"lowerBound":{const r=this.encoding.decode.lowerBound(e);return this.lowerBoundFromPrev=r,{type:"lowerBound",value:r}}case"terminal":return this.encoding.decode.terminal(e),{type:"terminal"}}}catch(n){console.group("range-reconcile: Could not decode message"),console.warn(e),console.warn(n)}return null}setReusableTree(e){this.reusableTree=e||void 0}process(e){const t=this.reusableTree;switch(e.type){case"lowerBound":case"terminal":case"done":return this.setReusableTree(null),[e];case"emptySet":{if(e.canRespond===!1&&this.isDoneTee.resolve(),this.tree.size===0)return[{type:"emptySet",canRespond:!1}];const n=this.tree.getLowestValue(),r=[{type:"lowerBound",value:n}],{items:s}=this.tree.getFingerprint(n,n);for(let u=0;u<s.length;u++){const a=s[u];u===s.length-1?r.push({type:"payload",payload:a,end:{upperBound:n,canRespond:!1}}):r.push({type:"payload",payload:a})}return r.push({type:"terminal"}),r}case"fingerprint":{const{fingerprint:n,size:r,items:s,nextTree:u}=this.tree.getFingerprint(e.lowerBound,e.upperBound,t);if(this.setReusableTree(u),this.fingerprintEquals(n,e.fingerprint))return[{type:"done",upperBound:e.upperBound}];if(r<=this.payloadThreshold){if(r===0)return[{type:"emptyPayload",upperBound:e.upperBound}];const a=[];for(let o=0;o<r;o++)a.push({type:"payload",payload:s[o],...o===s.length-1?{end:{upperBound:e.upperBound,canRespond:!0}}:{}});return a}else{const a=Math.ceil(r/this.rangeDivision),o=[];if(a<=this.payloadThreshold){for(let h=0;h<s.length;h++)o.push({type:"payload",payload:s[h],...h===s.length-1?{end:{upperBound:e.upperBound,canRespond:!0}}:{}});return o}let l;const c=s;let f=!1;if(e.lowerBound>=e.upperBound){let h=0;for(let d=0;d<=s.length;d++)if(s[d]>=e.lowerBound){h=d;break}if(h>0){const d=c.splice(0,h);c.push(...d),f=!0}}for(let h=0;h<r;h+=a){const d=c[h],p=c[h+a]||e.upperBound,{fingerprint:g,nextTree:C}=this.tree.getFingerprint(d,p,l);l=f?void 0:C||void 0,o.push({type:"fingerprint",fingerprint:g,upperBound:p})}return o}}case"payload":{for(const n of e.payload){this.tree.insert(n);for(const r of this.insertionCallbacks)r(n)}if(e.end.canRespond){const{items:n,size:r,nextTree:s}=this.tree.getFingerprint(e.lowerBound,e.end.upperBound,t);if(this.setReusableTree(s),r===0)return[{type:"emptyPayload",upperBound:e.end.upperBound}];const u=[];for(let o=0;o<r;o++){let l=!1;for(let c=0;c<e.payload.length;c++)this.tree.isValueEqual(n[o],e.payload[c])&&(l=!0);l||u.push({type:"payload",payload:n[o]})}const a=u[u.length-1];return u[u.length-1]={...a,end:{upperBound:e.end.upperBound,canRespond:!1}},u}else return this.setReusableTree(null),[{type:"done",upperBound:e.end.upperBound}]}case"emptyPayload":{this.setReusableTree(null);const{items:n,size:r,nextTree:s}=this.tree.getFingerprint(e.lowerBound,e.upperBound);if(this.setReusableTree(s),r===0)return this.setReusableTree(null),[];const u=[];for(let a=0;a<r;a++)u.push({type:"payload",payload:n[a],...a===n.length-1?{end:{upperBound:e.upperBound,canRespond:!1}}:{}});return u}}}consolidateAdjacentDones(e){switch(e.type){case"done":{this.lastAdjacentDoneUpperBound=e.upperBound;break}default:{const t=this.lastAdjacentDoneUpperBound;return t?(this.lastAdjacentDoneUpperBound=null,[{type:"done",upperBound:t},e]):[e]}}}checkIsDone(e){var t;if(this.isDoneTee.state==="pending")switch(e.type){case"emptySet":{e.canRespond&&(this.isDoneSoFar=!1);break}case"lowerBound":break;case"fingerprint":this.isDoneSoFar=!1;break;case"emptyPayload":this.isDoneSoFar=!1;break;case"payload":((t=e.end)==null?void 0:t.canRespond)===!0&&(this.isDoneSoFar=!1);break;case"terminal":this.isDoneSoFar?this.isDoneTee.resolve():this.isDoneSoFar=!0}}encode(e){let t;switch(e.type){case"emptySet":{t=this.encoding.encode.emptySet(e.canRespond);break}case"lowerBound":{t=this.encoding.encode.lowerBound(e.value);break}case"done":{t=this.encoding.encode.done(e.upperBound);break}case"fingerprint":{t=this.encoding.encode.fingerprint(e.fingerprint,e.upperBound);break}case"payload":{t=this.encoding.encode.payload(e.payload,e.end);break}case"emptyPayload":{t=this.encoding.encode.emptyPayload(e.upperBound);break}case"terminal":{t=this.encoding.encode.terminal();break}}return t}respond(e){if(this.isDone().state==="fulfilled")return[];const t=this.decode(e),n=this.collatePayloads(t);if(n===void 0)return[];const r=this.process(n),s=[];for(const a of r){const o=this.consolidateAdjacentDones(a);o&&s.push(...o)}for(const a of s)this.checkIsDone(a);const u=[];for(const a of s)u.push(this.encode(a));return u}isDone(){return this.isDoneTee.tee()}initialMessages(e){const{tree:t,encoding:n,payloadThreshold:r,rangeDivision:s}=this;function*u(){if(t.size===0){yield n.encode.emptySet(!0);return}const a=t.getLowestValue();yield n.encode.lowerBound(a);const{items:l}=t.getFingerprint(a,a),f=(e||(p=>{const g=Math.ceil(p.length/s),C=[];for(let b=0;b<p.length;b+=g){const E=p.slice(b,b+g);C.push(E)}return C}))(l);let h;for(let p=0;p<f.length;p++){const g=f[p+1]?f[p+1][0]:a,C=f[p];if(C.length<=r)for(let b=0;b<C.length;b++)yield n.encode.payload(C[b],b===C.length-1?{upperBound:g,canRespond:!0}:void 0);else{const b=C[0],{fingerprint:E,nextTree:A}=t.getFingerprint(b,g,h);h=A||void 0,yield n.encode.fingerprint(E,g)}}yield n.encode.terminal()}return u()}onInsertion(e){return this.insertionCallbacks.add(e),()=>{this.insertionCallbacks.delete(e)}}}var je=globalThis&&globalThis.__classPrivateFieldGet||function(i,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(i):n?n.value:e.get(i)},ar=globalThis&&globalThis.__classPrivateFieldSet||function(i,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},Vt,Kt,Mn,_t,Jr,lr;const is=Symbol("Stream ended."),Zr=Symbol("Stream errored.");class St{constructor(e){var t,n,r;Vt.add(this),Kt.set(this,[]),Mn.set(this,null),_t.set(this,void 0),Object.defineProperty(this,"push",{enumerable:!0,configurable:!0,writable:!0,value:(...s)=>{s.length?je(this,Vt,"m",lr).call(this,!1,s):(je(this,Vt,"m",lr).call(this,!1,[Zr]),je(this,Vt,"m",Jr).call(this,new Error("AsyncQueueError: queue.push was called with no arguments")))}}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:({immediately:s=!1,withError:u}={})=>{u&&je(this,Vt,"m",Jr).call(this,u),je(this,Vt,"m",lr).call(this,s,[u?Zr:is]),this.push=this.close=()=>{}}}),(r=(n=(t=e==null?void 0:e.catch)==null?void 0:t.call(e,s=>this.close({withError:s})))==null?void 0:n.finally)==null||r.call(n,()=>this.close())}get length(){return je(this,Kt,"f").length}async*[(Kt=new WeakMap,Mn=new WeakMap,_t=new WeakMap,Vt=new WeakSet,Jr=function(t){je(this,_t,"f")instanceof AggregateError?je(this,_t,"f").errors.push(t):je(this,_t,"f")?ar(this,_t,new AggregateError([je(this,_t,"f"),t]),"f"):ar(this,_t,t,"f")},lr=function(t,n){var r;je(this,Kt,"f")[t?"unshift":"push"](...n),(r=je(this,Mn,"f"))==null||r.call(this,je(this,Kt,"f").shift()),ar(this,Mn,null,"f")},Symbol.asyncIterator)](){for(;;){const e=je(this,Kt,"f").length?je(this,Kt,"f").shift():await new Promise(t=>{ar(this,Mn,t,"f")});if(e===Zr)throw je(this,_t,"f");if(e===is)break;yield e}}}function te(){let i,e="pending";const t=new Promise((n,r)=>{i={async resolve(s){await s,e="fulfilled",n(s)},reject(s){e="rejected",r(s)}}});return Object.defineProperty(t,"state",{get:()=>e}),Object.assign(t,i)}new ho;const Dc=new _i;function fi(i){return Dc.encode(i)}function bc(i){return fi(i).length}function hi(i,e){for(let t of i)if(e.indexOf(t)===-1)return!1;return!0}function ss(i){return i===""?!1:xr.indexOf(i)!==-1}const tr="abcdefghijklmnopqrstuvwxyz",wc=tr.toUpperCase(),xr="0123456789",pt=tr+"234567",Lo=tr+xr,yc=pt,$o=Lo+pt+"@.",jo=tr+xr,_c=pt,Uo=jo+pt+"+.",Ac="/'()-._~!$&+,:=@%",zo=tr+wc+xr+Ac;function Cc(i,e){return`@${i}.${e}`}function Ec(i,e){return`+${i}.${e}`}function Or(i){const e=Ho(i);return oo(e)?!0:e}function zt(i){const e=Mr(i);return oo(e)?!0:e}function di(i){return i.startsWith("@")?Ho(i):i.startsWith("+")?Mr(i):new O("address must start with either @ or +")}function Ho(i){return qo(i,{sigil:"@",separator:".",minNameLength:4,maxNameLength:4,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:Lo,allowedPubkeyCharacters:yc,pubkeyMustStartWithB:!0})}function Mr(i){return qo(i,{sigil:"+",separator:".",minNameLength:1,maxNameLength:15,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:jo,allowedPubkeyCharacters:_c,pubkeyMustStartWithB:!1})}function qo(i,e){const{sigil:t,separator:n,minNameLength:r,maxNameLength:s,minPubkeyLength:u,maxPubkeyLength:a,allowedNameCharacters:o,allowedPubkeyCharacters:l,pubkeyMustStartWithB:c}=e;if(typeof i!="string")return new O("address must be a string");if(i.length<4)return new O("address is too short");if(i[0]!==t)return new O(`address must start with a sigil: "${t}"`);if(i.indexOf(n)===-1)return new O(`address must contain a separator character: "${n}"`);const f=i.slice(1).split(n);if(f.length!==2)return new O(`address must have exactly 2 parts separated by a "${n}" separator`);const[h,d]=f;return h.length<r||h.length>s?new O(`name must be between ${r} and ${s} characters long, but is ${h.length}`):d.length<u||d.length>a?new O(`pubkey must be between ${u} and ${a} characters long, but is ${d.length}`):hi(h,o)?hi(d,l)?ss(h[0])?new O(`name "${h}" must not start with a digit`):ss(d[0])?new O(`pubkey "${d}" must not start with a digit`):c&&d[0]!=="b"?new O(`pubkey "${d}" must start with 'b'`):{address:i,name:h,pubkey:d}:new O(`pubkey "${d}" must only have allowed characters`):new O(`name "${h}" must only have allowed characters`)}function vi(i){return!(Object.prototype.toString.call(i)!=="[object Object]"||(""+i.constructor).startsWith("class"))}function Wo(i){return e=>e!==i?`expected literal value ${JSON.stringify(i)}`:null}function Je(i={}){return e=>{if(i.optional!==!0&&e===void 0)return"required";if(i.optional===!0&&e===void 0)return null;let t=bc(e);return typeof e!="string"?"expected a string but got "+JSON.stringify(e):i.minLen!==void 0&&t<i.minLen?`string shorter than min length of ${i.minLen} chars`:i.maxLen!==void 0&&t>i.maxLen?`string shorter than max length of ${i.maxLen} chars`:i.len!==void 0&&t!==i.len?`string does not have required length of ${i.len} chars: ${e}`:i.allowedChars!==void 0&&!hi(e,i.allowedChars)?"contains disallowed characters":null}}function qn(i={}){return e=>i.optional!==!0&&e===void 0?"required":i.optional===!0&&e===void 0?null:i.nullable!==!0&&e===null?"not nullable":i.nullable===!0&&e===null?null:typeof e!="number"?"expected a number but got "+JSON.stringify(e):isNaN(e)?"is NaN":isFinite(e)?e!==Math.round(e)?"expected an integer":i.min!==void 0&&e<i.min?`integer too small (must be >= ${i.min})`:i.max!==void 0&&e>i.max?`integer too large (must be <= ${i.max})`:null:"is Infinity"}function Vo(i={}){return i.allowLiteralUndefined=i.allowLiteralUndefined??!1,i.allowExtraKeys=i.allowExtraKeys??!1,e=>{if(!vi(e))return"expected an object";if(i.allowLiteralUndefined===!1){for(let[t,n]of Object.entries(e))if(n===void 0)return`${t} is explicitly set to undefined but should be missing instead`}if(i.objSchema!==void 0){if(i.allowExtraKeys===!1){let t=Object.keys(e),n=Object.keys(i.objSchema),r=t.filter(s=>n.indexOf(s)===-1);if(r.length>0)return`object has extra keys not in the schema: ${r.join(", ")}`}for(let[t,n]of Object.entries(i.objSchema)){let r=n(e[t]);if(r!==null)return`${t}: ${r}`}}return null}}const{codec:Ko}=Nl,Qo={chars:"abcdefghijklmnopqrstuvwxyz234567",bits:5};function fn(i){return"b"+Ko.stringify(i,Qo,{pad:!1})}function vr(i){if(!i.startsWith("b"))throw new O("can't decode base32 string - it should start with a 'b'. "+i);if(i[i.length-1]==="=")throw new O("can't decode base32 string - it contains padding characters ('=')");return Ko.parse(i.slice(1),Qo,{loose:!0})}var Bt;(function(i){i[i.None=-1]="None",i[i.Error=0]="Error",i[i.Warn=1]="Warn",i[i.Log=2]="Log",i[i.Info=3]="Info",i[i.Debug=4]="Debug"})(Bt||(Bt={}));const vc=Bt.Error;let Xr={_default:vc};function kc(i){return i in Xr?Xr[i]:Xr._default}class qe{constructor(e,t){Object.defineProperty(this,"source",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.source=e,this.color=t||"aqua"}_print(e,t,n,...r){if(e<=kc(this.source))if(t){const s=`[${this.source}]`;if(this.color!==void 0){const u=[`%c ${s}`,`color: ${this.color}`];console.log(n,...u,...r)}else console.log(n,s,...r)}else console.log(n,...r)}error(...e){this._print(Bt.Error,!0,"!!",...e)}warn(...e){this._print(Bt.Warn,!0,"! ",...e)}log(...e){this._print(Bt.Log,!0,"  ",...e)}info(...e){this._print(Bt.Info,!0,"    ",...e)}debug(...e){this._print(Bt.Debug,!0,"      ",...e)}blank(){this._print(Bt.Info,!1,"")}}class Fc{constructor(e){Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalDigest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.hash=e.hash,this.internalUpdate=e.update,this.internalDigest=e.digest}update(e){return this.hash=this.internalUpdate(this.hash,e),this.hash}digest(){return this.internalDigest(this.hash)}}const{createHash:ei}=Gl,ti=new qe("crypto-driver-noble","cyan"),Bc=class{static sha256(i){return typeof i=="string"?Promise.resolve(ei("sha256").update(i,"utf-8").digest()):Promise.resolve(ei("sha256").update(i).digest())}static updatableSha256(){return new Fc({hash:ei("sha256"),update:(i,e)=>i.update(e),digest:i=>i.digest()})}static async generateKeypairBytes(){ti.debug("generateKeypairBytes");const i=Rr.randomPrivateKey();return{pubkey:await uc(i),secret:i}}static sign(i,e){return ti.debug("sign"),typeof e=="string"&&(e=fi(e)),oc(e,i.secret)}static async verify(i,e,t){ti.debug("verify");try{return typeof t=="string"&&(t=fi(t)),await ac(e,t,i)}catch{return!1}}};function us(){return Date.now()*1e3}function Go(i){return new Promise(e=>{rn(e,i)})}function Tt(){return""+Math.floor(Math.random()*1e3)+Math.floor(Math.random()*1e3)}function Sc(i){try{const e=Yo(i)?i.address:i.shareAddress,t=di(e);if(M(t))return t;const n={pubkey:vr(t.pubkey),secret:vr(i.secret)};return n.pubkey.length!==32?new O(`pubkey bytes should be 32 bytes long, not ${n.pubkey.length} after base32 decoding.  ${e}`):n.secret.length!==32?new O(`secret bytes should be 32 bytes long, not ${n.secret.length} after base32 decoding.  ${i.secret}`):n}catch(e){return new O("crash while decoding author keypair: "+e.message)}}function Yo(i){return"address"in i}new qe("crypto","cyan");let hn=Bc,Nn=new qe("crypto","cyan");const we=class{static async sha256base32(i){const e=await hn.sha256(i);return fn(e)}static updatableSha256(){return hn.updatableSha256()}static async generateAuthorKeypair(i){Nn.debug(`generateAuthorKeypair("${i}")`);const e=await hn.generateKeypairBytes(),t={address:Cc(i,fn(e.pubkey)),secret:fn(e.secret)},n=Or(t.address);return M(n)?n:t}static async generateShareKeypair(i){Nn.debug(`generateAuthorKeypair("${i}")`);const e=await hn.generateKeypairBytes(),t={shareAddress:Ec(i,fn(e.pubkey)),secret:fn(e.secret)},n=zt(t.shareAddress);return M(n)?n:t}static async sign(i,e){Nn.debug("sign");try{const t=Sc(i);if(M(t))return t;const n=await hn.sign(t,e);return fn(n)}catch(t){return new O("unexpected error while signing: "+t.message)}}static verify(i,e,t){Nn.debug("verify");try{const n=di(i);return M(n)?Promise.resolve(!1):hn.verify(vr(n.pubkey),vr(e),t)}catch{return Promise.resolve(!1)}}static async checkKeypairIsValid(i){Nn.debug("checkAuthorKeypairIsValid");const e=Yo(i)?i.address:i.shareAddress;try{if(typeof e!="string"||typeof i.secret!="string")return new O("address and secret must be strings");const t=di(e);if(M(t))return t;const n="a test message to sign. "+Tt(),r=await this.sign(i,n);return M(r)?r:await this.verify(e,r,n)===!1?new O("pubkey does not match secret"):!0}catch(t){return new O("unexpected error in checkAuthorKeypairIsValid: "+t.message)}}};var Tc=globalThis&&globalThis.__setFunctionName||function(i,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(i,"name",{configurable:!0,value:t?"".concat(t," ",e):e})},cr;new qe("validator es.4","red");const Ic=10,Pc=Ic*60*1e3*1e3,os=1e13,as=9007199254740990,Rc=4e6,xc=53,Oc=104,ls={objSchema:{format:Wo("es.4"),author:Je({allowedChars:$o}),content:Je({maxLen:Rc}),contentHash:Je({allowedChars:pt,len:xc}),deleteAfter:qn({min:os,max:as,nullable:!0}),path:Je({allowedChars:zo,minLen:2,maxLen:512}),signature:Je({allowedChars:pt,len:Oc}),timestamp:qn({min:os,max:as}),workspace:Je({allowedChars:Uo})},allowLiteralUndefined:!1,allowExtraKeys:!1};cr=class{static hashDocument(i){const e={...i,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},t=this._checkBasicDocumentValidity(e);return M(t)?Promise.resolve(t):we.sha256base32(`author	${i.author}
contentHash	${i.contentHash}
`+(i.deleteAfter===null?"":`deleteAfter	${i.deleteAfter}
`)+`format	${i.format}
path	${i.path}
timestamp	${i.timestamp}
workspace	${i.workspace}
`)}static async generateDocument({input:i,keypair:e,share:t,timestamp:n}){const r={format:"es.4",author:e.address,content:i.content,contentHash:await we.sha256base32(i.content),deleteAfter:i.deleteAfter??null,path:i.path,timestamp:n,workspace:t,signature:"?"},s=await this.signDocument(e,r);return M(s)?s:{doc:s}}static async signDocument(i,e){const t=await this.hashDocument(e);if(M(t))return t;const n=await we.sign(i,t);return M(n)?n:{...e,signature:n}}static async wipeDocument(i,e){if(e.content.length===0)return e;const t=this.removeExtraFields(e);if(M(t))return t;const r={...t.doc,content:"",contentHash:await we.sha256base32(""),signature:"?"};return this.signDocument(i,r)}static removeExtraFields(i){if(!vi(i))return new O("doc is not a plain javascript object");const e=new Set(Object.keys(ls.objSchema||{})),t={},n={};for(const[r,s]of Object.entries(i))if(e.has(r))t[r]=s;else{if(!r.startsWith("_"))return new O("extra document fields must have names starting with an underscore");n[r]=s}return{doc:t,extras:n}}static async checkDocumentIsValid(i,e){e===void 0&&(e=Date.now()*1e3);const t=this._checkBasicDocumentValidity(i);if(M(t))return t;const n=this._checkTimestampIsOk(i.timestamp,i.deleteAfter,e);if(M(n))return n;const r=this._checkAuthorCanWriteToPath(i.author,i.path);if(M(r))return r;const s=this._checkPathIsValid(i.path,i.deleteAfter);if(M(s))return s;const u=Or(i.author);if(M(u))return u;const a=zt(i.workspace);if(M(a))return a;const o=await this._checkAuthorSignatureIsValid(i);if(M(o))return o;const l=await this._checkContentMatchesHash(i.content,i.contentHash);return M(l)?l:!0}static _checkBasicDocumentValidity(i){const e=Vo(ls)(i);return e!==null?new O(e):!0}static _checkAuthorCanWriteToPath(i,e){return e.indexOf("~")===-1||e.indexOf("~"+i)!==-1?!0:new O(`author ${i} can't write to path ${e}`)}static _checkTimestampIsOk(i,e,t){if(i>t+Pc)return new O("timestamp too far in the future");if(e!==null){if(t>e)return new O("ephemeral doc has expired");if(e<=i)return new O("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(i,e){if(!i.startsWith("/"))return new O("invalid path: must start with /");if(i.endsWith("/"))return new O("invalid path: must not end with /");if(i.startsWith("/@"))return new O('invalid path: must not start with "/@"');if(i.indexOf("//")!==-1)return new O("invalid path: must not contain two consecutive slashes");if(e!==void 0){if(i.indexOf("!")===-1&&e!==null)return new O("when deleteAfter is set, path must contain '!'");if(i.indexOf("!")!==-1&&e===null)return new O("when deleteAfter is null, path must not contain '!'")}return!0}static async _checkAuthorSignatureIsValid(i){try{const e=await this.hashDocument(i);return M(e)?e:await we.verify(i.author,i.signature,e)!==!0?new O("signature is invalid"):!0}catch{return new O("signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(i,e){return await we.sha256base32(i)!==e?new O("content does not match contentHash"):!0}static getAttachmentInfo(i){return new O("es.4 does not support attachments")}static updateAttachmentFields(i,e,t,n){return Promise.resolve(new O("es.4 does not support attachments"))}static authorFromCredentials(i){return i.address}},Tc(cr,"FormatEs4"),Object.defineProperty(cr,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.4"});var Mc=globalThis&&globalThis.__setFunctionName||function(i,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(i,"name",{configurable:!0,value:t?"".concat(t," ",e):e})},fr;new qe("validator es.5","red");const Nc=10,Lc=Nc*60*1e3*1e3,cs=1e13,fs=9007199254740990,$c=8e3,hs=53,ds=104,jc=0,Uc=Number.MAX_SAFE_INTEGER,ps={objSchema:{format:Wo("es.5"),author:Je({allowedChars:$o}),text:Je({maxLen:$c}),textHash:Je({allowedChars:pt,len:hs}),deleteAfter:qn({min:cs,max:fs,optional:!0}),path:Je({allowedChars:zo,minLen:2,maxLen:512}),signature:Je({allowedChars:pt,len:ds}),shareSignature:Je({allowedChars:pt,len:ds}),timestamp:qn({min:cs,max:fs}),share:Je({allowedChars:Uo}),attachmentSize:qn({min:jc,max:Uc,optional:!0}),attachmentHash:Je({allowedChars:pt,len:hs,optional:!0})},allowLiteralUndefined:!1,allowExtraKeys:!1},zc=(fr=class{static hashDocument(i){const e={...i,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",shareSignature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},t=this._checkBasicDocumentValidity(e);return M(t)?Promise.resolve(t):we.sha256base32((i.attachmentHash===void 0?"":`attachmentHash	${i.attachmentHash}
`)+(i.attachmentSize===void 0?"":`attachmentSize	${i.attachmentSize}
`)+`author	${i.author}
`+(i.deleteAfter===void 0?"":`deleteAfter	${i.deleteAfter}
`)+`format	${i.format}
path	${i.path}
textHash	${i.textHash}
timestamp	${i.timestamp}
share	${i.share}
`)}static async generateDocument({input:i,keypair:e,share:t,timestamp:n,prevLatestDoc:r,config:s}){if(i.text===void 0&&(r==null?void 0:r.text)===void 0)return new O("Couldn't determine document text from given input or previous version's text.");const u=i.text!==void 0?i.text:r==null?void 0:r.text,a={...r,format:"es.5",author:e.address,text:u,textHash:await we.sha256base32(u),path:i.path,timestamp:n,share:t,signature:"?",shareSignature:"?"};i.deleteAfter&&(a.deleteAfter=i.deleteAfter);const o=await this.signDocument(e,a,s);return M(o)?o:i.attachment?{doc:o,attachment:i.attachment}:{doc:o}}static async signDocument(i,e,t){const n=await this.hashDocument(e);if(M(n))return n;const r=await we.sign(i,n);if(t.shareSecret===void 0)return new Ge(`Tried to write a document to ${e.share} without the secret.`);const s=await we.sign({shareAddress:e.share,secret:t.shareSecret},n);return M(r)?r:M(s)?s:{...e,signature:r,shareSignature:s}}static async wipeDocument(i,e,t){if(e.text.length===0)return e;const n=this.removeExtraFields(e);if(M(n))return n;const r=n.doc;if(r.attachmentHash){const u={...r,text:"",textHash:await we.sha256base32(""),signature:"?",shareSignature:"?",attachmentHash:await we.sha256base32(""),attachmentSize:0};return this.signDocument(i,u,t)}const s={...r,text:"",textHash:await we.sha256base32(""),signature:"?",shareSignature:"?"};return this.signDocument(i,s,t)}static removeExtraFields(i){if(!vi(i))return new O("doc is not a plain javascript object");const e=new Set(Object.keys(ps.objSchema||{})),t={},n={};for(const[r,s]of Object.entries(i))if(e.has(r))t[r]=s;else{if(!r.startsWith("_"))return new O("extra document fields must have names starting with an underscore");n[r]=s}return{doc:t,extras:n}}static async checkDocumentIsValid(i,e){e===void 0&&(e=Date.now()*1e3);const t=this._checkBasicDocumentValidity(i);if(M(t))return t;const n=this._checkTimestampIsOk(i.timestamp,i.deleteAfter?i.deleteAfter:null,e);if(M(n))return n;const r=this._checkAuthorCanWriteToPath(i.author,i.path);if(M(r))return r;const s=this._checkAttachmentFieldsConsistent(i);if(M(s))return s;const u=this._checkPathIsValid(i.path,!!i.attachmentHash,i.deleteAfter);if(M(u))return u;const a=Or(i.author);if(M(a))return a;const o=zt(i.share);if(M(o))return o;const l=await this._checkAuthorSignatureIsValid(i);if(M(l))return l;const c=await this._checkShareSignatureIsValid(i);if(M(c))return c;const f=await this._checkContentMatchesHash(i.text,i.textHash);return M(f)?f:!0}static _checkBasicDocumentValidity(i){const e=Vo(ps)(i);return e!==null?new O(e):!0}static _checkAttachmentFieldsConsistent(i){return i.text.length===0&&i.attachmentSize&&i.attachmentSize>0?new O("Documents with attachments must have text."):(i.text.length>0&&i.attachmentSize&&i.attachmentSize,i.attachmentHash&&i.attachmentSize===void 0?new O("Attachment size is undefined while attachment hash is defined"):i.attachmentSize&&i.attachmentHash===void 0?new O("Attachment hash is undefined while attachment size is defined"):!0)}static _checkAuthorCanWriteToPath(i,e){return e.indexOf("~")===-1||e.indexOf("~"+i)!==-1?!0:new O(`author ${i} can't write to path ${e}`)}static _checkTimestampIsOk(i,e,t){if(i>t+Lc)return new O("timestamp too far in the future");if(e!==null){if(t>e)return new O("ephemeral doc has expired");if(e<=i)return new O("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(i,e,t){if(!i.startsWith("/"))return new O("invalid path: must start with /");if(i.endsWith("/"))return new O("invalid path: must not end with /");if(i.startsWith("/@"))return new O('invalid path: must not start with "/@"');if(i.indexOf("//")!==-1)return new O("invalid path: must not contain two consecutive slashes");if(t!==void 0){if(i.indexOf("!")===-1&&t!==null)return new O("when deleteAfter is set, path must contain '!'");if(i.indexOf("!")!==-1&&t===null)return new O("when deleteAfter is null, path must not contain '!'")}return!ms(i)&&e?new O("when a attachment is provided, the path must end with a file extension"):ms(i)&&e===!1?new O("when no attachment is provided, the path cannot end with a file extension"):!0}static async _checkAuthorSignatureIsValid(i){try{const e=await this.hashDocument(i);return M(e)?e:await we.verify(i.author,i.signature,e)!==!0?new O("signature is invalid"):!0}catch{return new O("signature is invalid (unexpected exception)")}}static async _checkShareSignatureIsValid(i){try{const e=await this.hashDocument(i);return M(e)?e:await we.verify(i.share,i.shareSignature,e)!==!0?new O("share signature is invalid"):!0}catch{return new O("share signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(i,e){return await we.sha256base32(i)!==e?new O("content does not match contentHash"):!0}static getAttachmentInfo(i){return i.attachmentHash&&i.attachmentSize===0?new O("This document has had its attachment wiped"):!i.attachmentHash||!i.attachmentSize?new O("This document has no attachment."):{size:i.attachmentSize,hash:i.attachmentHash}}static updateAttachmentFields(i,e,t,n,r){const s={...e,attachmentHash:n,attachmentSize:t};return this.signDocument(i,s,r)}static authorFromCredentials(i){return i.address}},Mc(fr,"FormatEs5"),Object.defineProperty(fr,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.5"}),fr),Hc=/^.*\.(\w+)$/,qc=/^.*~@\w{4}\.\w{53}$/;function ms(i){if(i.indexOf(".")===-1)return!1;const e=i.match(Hc);return!(e===null||e[1].length===53&&i.match(qc))}const mt=zc,Nr=[mt];function gs(i){return i||mt}function wn(i){return i||Nr}function Wc(i,e){const t=[];for(const n of e)i.includes(n.id)&&t.push(n);return t}function yn(i){const e=i||Nr,t={};for(const n of e)t[n.id]=n;return t}class Lr{constructor(){Object.defineProperty(this,"deferreds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"pending"})}resolve(e){if(this.state==="pending"){this.state="fulfilled";for(const t of this.deferreds)t.resolve(e)}}reject(e){if(this.state==="pending"){this.state="rejected";for(const t of this.deferreds)t.reject(e)}}getPromise(){const e=te();return this.state==="fulfilled"?e.resolve():this.state==="rejected"?e.reject():this.deferreds.add(e),e}}class Gn{constructor(e=!1){Object.defineProperty(this,"promises",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"sealed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"multiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new Lr}),Object.defineProperty(this,"allowRejectedPromises",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.allowRejectedPromises=e}enrol(e){if(this.sealed)throw new Ge("Tried to enrol a promise when enrolment was already sealed.");this.promises.add(e),e.then(()=>{this.checkAllDone()}).catch(t=>{if(!this.allowRejectedPromises)throw t})}checkAllDone(){this.sealed&&(this.allowRejectedPromises?Promise.allSettled(this.promises).then(()=>{this.multiDeferred.resolve()}):Promise.all(this.promises).then(()=>{this.multiDeferred.resolve()}).catch(()=>{this.multiDeferred.reject()}))}seal(){this.sealed||(this.sealed=!0,this.checkAllDone())}isSealed(){return this.sealed}isDone(){return this.multiDeferred.getPromise()}}class Vc{constructor(){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"transform",{enumerable:!0,configurable:!0,writable:!0,value:new Bn({transform(e,t){t.enqueue(e)}})}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:this.transform.writable.getWriter()}),Object.defineProperty(this,"readable",{enumerable:!0,configurable:!0,writable:!0,value:this.transform.readable}),Object.defineProperty(this,"writables",{enumerable:!0,configurable:!0,writable:!0,value:[]})}checkClosed(){if(this.closed)throw"Closed"}getWritableStream(){this.checkClosed();const e=this.writer,t=new st({async write(n){await e.ready,await e.write(n)}});return this.writables.push(t),t}async close(){this.checkClosed();for(const e of this.writables)await e.abort();this.transform.writable.abort(),this.closed=!0}isClosed(){return this.closed}}class Kc{constructor(){Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:new Bn(new Yc)}),Object.defineProperty(this,"sourceReadable",{enumerable:!0,configurable:!0,writable:!0,value:this.transformStream.readable}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:this.transformStream.writable})}getReadableStream(){const[e,t]=this.sourceReadable.tee();return this.sourceReadable=e,t}}class Qc{checkClosed(){if(this.closed)throw"Closed"}constructor(){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"subscribers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"writables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=this.subscribers;this.writable=new st({write(t){const n=e.map(({writer:r})=>new Promise(s=>{r.ready.then(()=>{r.write(t).then(s)})}));Promise.all(n)}})}getReadableStream(){this.checkClosed();const e=new Bn({transform(t,n){n.enqueue(t)}});return this.subscribers.push({transform:e,writer:e.writable.getWriter()}),e.readable}async close(){this.checkClosed();for(const e of this.writables)await e.abort();for(const{transform:e}of this.subscribers)await e.writable.abort(),await e.readable.cancel();this.closed=!0}isClosed(){return this.closed}}class Gc{checkClosed(){if(this.closed)throw"Closed"}constructor(e){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineStream",{enumerable:!0,configurable:!0,writable:!0,value:new Vc}),Object.defineProperty(this,"cloneStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e?this.cloneStream=new Qc:this.cloneStream=new Kc,this.combineStream.readable.pipeTo(this.cloneStream.writable)}getWritableStream(){return this.combineStream.getWritableStream()}getReadableStream(){return this.cloneStream.getReadableStream()}close(){this.checkClosed(),this.combineStream.close(),this.closed=!0}isClosed(){return this.closed}}class Jo{constructor(){Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set})}onWrite(e){return this.callbacks.add(e),()=>{this.callbacks.delete(e)}}async write(e){for(const t of this.callbacks)await t(e)}close(){this.callbacks.clear()}}class an{constructor(){Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"lock",{enumerable:!0,configurable:!0,writable:!0,value:new Zo})}on(e){return this.callbacks.add(e),()=>{this.callbacks.delete(e)}}async send(e){for(const t of this.callbacks)await this.lock.run(()=>t(e))}}class Yc{transform(e,t){t.enqueue(e)}}class Zo{constructor(){Object.defineProperty(this,"doneEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new Gn}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:new st({async write(e){await e()}})}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:this.writable.getWriter()}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1})}checkClosed(){if(this.closed)throw"Closed"}async run(e){this.checkClosed(),await this.writer.ready;const t=this.writer.write(e);return this.doneEnroller.enrol(t),t}async close(){this.checkClosed(),this.doneEnroller.seal(),await this.doneEnroller.isDone(),this.writer.releaseLock(),await this.writable.abort(),this.closed=!0}isClosed(){return this.closed}}class Jc{constructor(e,t){Object.defineProperty(this,"channel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.channel=e,this.channelKey=t}transform(e,t){if(this.channel==="*"||this.channel===e[this.channelKey]){t.enqueue(e);return}}}class Zc{constructor(e,t){Object.defineProperty(this,"multistream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.multistream=new Gc(t),this.channelKey=e}getWritableStream(){return this.multistream.getWritableStream()}getReadableStream(e){const t=new Bn(new Jc(e,this.channelKey));return this.multistream.getReadableStream().pipeThrough(t)}}function Xc(i,e){const t=te(),n=te(),r=()=>{if(n.state==="pending"){let s;i instanceof bn?s=i:s=new bn(i),n.resolve(s),s.binaryType="arraybuffer",s.readyState===s.OPEN&&t.resolve(),s.onopen=()=>{t.resolve()}}};return new st({async write(s,u){r();const a=await n;await t;try{const o=e(s);a.send(o)}catch(o){u.error(o)}a.onclose=()=>{u.error("Socket closed before we were done")}},async close(){r();const s=await n;await t,s.close()},async abort(){r();const s=await n;await t,s.close()}})}function ef(i,e){const t=te();let n=!1;const r=()=>{if(t.state==="pending")if(i instanceof bn)t.resolve(i);else try{const s=new bn(i);t.resolve(s)}catch(s){t.reject(s)}};return new sn({async start(s){r();const u=await t;u.binaryType="arraybuffer",u.onmessage=a=>{const o=e(a);try{s.enqueue(o)}catch{}},u.onclose=()=>{if(!n)try{s.close()}catch{}},u.onerror=a=>{n=!0,s.error(a)}},async cancel(){r(),(await t).close()}})}function tf(i){let t=i.toString(16);return t.length%2&&(t="0"+t),t}function nf(i){return BigInt("0x"+i)}const rf={EMPTY_SET:"emptySet",LOWER_BOUND:"lowerBound",PAYLOAD:"payload",EMPTY_PAYLOAD:"emptyPayload",DONE:"done",FINGERPRINT:"fingerprint",TERMINAL:"terminal"},sf={encode:{emptySet:i=>({type:"EMPTY_SET",canRespond:i}),lowerBound:i=>({type:"LOWER_BOUND",value:i}),payload:(i,e)=>({type:"PAYLOAD",payload:i,...e?{end:e}:{}}),emptyPayload:i=>({type:"EMPTY_PAYLOAD",upperBound:i}),done:i=>({type:"DONE",upperBound:i}),fingerprint:(i,e)=>({type:"FINGERPRINT",fingerprint:tf(i),upperBound:e}),terminal:()=>({type:"TERMINAL"})},decode:{getType:i=>rf[i.type],emptySet:i=>{if(i.type==="EMPTY_SET")return i.canRespond;throw"Can't decode"},lowerBound:i=>{if(i.type==="LOWER_BOUND")return i.value;throw"Can't decode"},payload:i=>{if(i.type==="PAYLOAD")return{value:i.payload,...i.end?{end:i.end}:{}};throw"Can't decode"},emptyPayload:i=>{if(i.type==="EMPTY_PAYLOAD")return i.upperBound;throw"Can't decode"},done:i=>{if(i.type==="DONE")return i.upperBound;throw"Can't decode"},fingerprint:i=>{if(i.type==="FINGERPRINT")return{fingerprint:nf(i.fingerprint),upperBound:i.upperBound};throw"Can't decode"},terminal:i=>{if(i.type==="TERMINAL")return!0;throw"Can't decode"}}};class uf extends gc{constructor(e,t,n){super({tree:e,encoding:sf,fingerprintEquals:(r,s)=>r===s,payloadThreshold:t,rangeDivision:n})}}class of{sendEvent(e){return this.inboundEventQueue.push(e)}events(){return this.outboundEventQueue}getStatus(){return{requestedCount:this.requestedCount,receivedCount:this.receivedDocsCount,sentCount:this.sentDocsCount,status:this.isDoneMultiDeferred.state==="rejected"?"aborted":this.hasPrepared.state==="pending"?"preparing":this.hasReconciled.state==="pending"?"reconciling":this.isDoneMultiDeferred.state==="fulfilled"?"done":"gossiping"}}constructor(e){Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new an}),Object.defineProperty(this,"isDoneMultiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new Lr}),Object.defineProperty(this,"inboundEventQueue",{enumerable:!0,configurable:!0,writable:!0,value:new St}),Object.defineProperty(this,"outboundEventQueue",{enumerable:!0,configurable:!0,writable:!0,value:new St}),Object.defineProperty(this,"gossiperInboundQueue",{enumerable:!0,configurable:!0,writable:!0,value:new St}),Object.defineProperty(this,"reconcilerInboundQueue",{enumerable:!0,configurable:!0,writable:!0,value:new St}),Object.defineProperty(this,"hasPrepared",{enumerable:!0,configurable:!0,writable:!0,value:te()}),Object.defineProperty(this,"hasReconciled",{enumerable:!0,configurable:!0,writable:!0,value:te()}),Object.defineProperty(this,"hasCheckedAllExistingDocsForAttachments",{enumerable:!0,configurable:!0,writable:!0,value:te()}),Object.defineProperty(this,"requestedCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sentDocsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"receivedDocsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"counterpartId",{enumerable:!0,configurable:!0,writable:!0,value:Tt()}),Object.defineProperty(this,"replica",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.replica=e.replica,e.replica.onEvent(u=>{u.kind==="willClose"&&this.cancel()});const{treeIsReady:t}=e.syncerManager.getDocThumbnailTreeAndDocLookup(e.replica.share,wn(e.formats));t.then(()=>{this.hasPrepared.resolve()}),(async()=>{for await(const u of this.inboundEventQueue)switch(u.kind){case"RANGE_MSG":{this.reconcilerInboundQueue.push(u.message);break}default:this.gossiperInboundQueue.push(u)}})(),new cf({outboundEventQueue:this.outboundEventQueue,formats:e.formats,replica:e.replica,counterpartId:this.counterpartId,transferManager:e.transferManager,hasCheckedAllExistingDocsForAttachments:this.hasCheckedAllExistingDocsForAttachments});const n=new ff,r=new lf({inboundEventQueue:this.reconcilerInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:e.syncerManager,formats:e.formats,replica:e.replica,initiateMessaging:e.initiateMessaging,wantTracker:n,payloadThreshold:e.payloadThreshold,rangeDivision:e.rangeDivision,onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}});r.isDone.then(()=>{this.hasReconciled.resolve()}),new af({inboundEventQueue:this.gossiperInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:e.syncerManager,formats:e.formats,replica:e.replica,counterpartId:this.counterpartId,transferManager:e.transferManager,cancel:this.cancel.bind(this),reconciliationIsDone:r.isDone,wantTracker:n,syncAppetite:e.syncAppetite,onDocReceived:async()=>{this.receivedDocsCount++,await this.statusBus.send(this.getStatus())},onDocSent:async()=>{this.sentDocsCount++,await this.statusBus.send(this.getStatus())},onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}}).isDone.then(async()=>{await this.hasCheckedAllExistingDocsForAttachments,this.isDoneMultiDeferred.resolve()}),this.statusBus.send(this.getStatus())}onStatusUpdate(e){return this.statusBus.on(e)}async cancel(e){this.isDoneMultiDeferred.state==="fulfilled"||this.isDoneMultiDeferred.state==="rejected"||(this.isDoneMultiDeferred.reject(e||"Cancelled"),await this.statusBus.send(this.getStatus()),this.outboundEventQueue.push({kind:"ABORT"}),this.outboundEventQueue.close(),this.inboundEventQueue.close({immediately:!0}),this.gossiperInboundQueue.close({immediately:!0}),this.reconcilerInboundQueue.close({immediately:!0}))}isDone(){return this.isDoneMultiDeferred.getPromise()}}class af{constructor(e){Object.defineProperty(this,"isPartnerFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:te()}),Object.defineProperty(this,"isFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:te()});const t=yn(e.formats),n=e.syncerManager.getPlumTree(e.replica.share);if(e.syncAppetite==="continuous"){const u=e.replica.getQueryStream(void 0,"new",e.formats),a=new Ei;u.pipeTo(new st({async write(o){if(o.kind==="success"&&o.sourceId!==e.counterpartId){const l=n.getMode(o.sourceId);a.reset(),a.update(`${o.doc.path} ${o.doc.author}`);const c=a.digest().toString(16),f=`${o.doc.timestamp} ${c}`;if(l==="EAGER"){const h=t[o.doc.format],d=h.getAttachmentInfo(o.doc),p=!M(d);let g=!1;p&&await e.replica.getAttachment(o.doc,h)&&(g=!0),e.outboundEventQueue.push({kind:"DOC",thumbnail:f,doc:o.doc,attachmentHeld:g}),e.onDocSent()}else e.outboundEventQueue.push({kind:"HAVE",thumbnail:f})}}})).catch(()=>{})}const r=e.replica.onEvent(u=>{u.kind==="attachment_ingest"&&u.sourceId!==e.counterpartId&&e.outboundEventQueue.push({kind:"NEW_ATTACHMENT",path:u.doc.path,author:u.doc.author,format:u.doc.format,hash:u.hash})}),{lookup:s}=e.syncerManager.getDocThumbnailTreeAndDocLookup(e.replica.share,wn(e.formats));(async()=>{for await(const u of e.inboundEventQueue)switch(u.kind){case"PRUNE":{n.onPrune(e.counterpartId);break}case"HAVE":{if(e.reconciliationIsDone.state==="fulfilled"&&e.syncAppetite==="once")break;e.wantTracker.addWantedThumbnail(u.thumbnail),n.onLazyMessage(u,a=>{e.outboundEventQueue.push({kind:"WANT",thumbnail:a})}),e.onDocRequested();break}case"WANT":{n.onGraftMessage(e.counterpartId);const[,a]=u.thumbnail.split(" "),o=s[a];if(!o)return;const[,l,c]=o,h=(await e.replica.getAllDocsAtPath(l,e.formats)).find(d=>d.author===c);if(h){const d=t[h.format],p=d.getAttachmentInfo(h),g=!M(p);let C=!1;g&&await e.replica.getAttachment(h,d)&&(C=!0),e.outboundEventQueue.push({kind:"DOC",thumbnail:u.thumbnail,doc:h,attachmentHeld:C}),await e.onDocSent()}else console.error("Got a WANT event for a document not on record.");break}case"DOC":{if(this.isFulfilled.state==="fulfilled"&&e.syncAppetite==="once"||(n.onEagerMessage(e.counterpartId,u)&&e.outboundEventQueue.push({kind:"PRUNE"}),e.wantTracker.isReceived(u.thumbnail)))break;const o=t[u.doc.format];if(!o){console.error(`Was sent a doc with a format we don't know about (${u.doc.format})`);break}if(u.attachmentHeld&&await e.replica.getAttachment(u.doc,t[u.doc.format])===void 0){const c=await e.transferManager.handleDownload(u.doc,e.replica,e.counterpartId);if(M(c)){const f=o.getAttachmentInfo(u.doc);e.transferManager.registerExpectedTransfer(e.replica.share,f.hash),e.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:f.hash,doc:u.doc,shareAddress:e.replica.share})}}await e.replica.ingest(o,u.doc,e.counterpartId),e.wantTracker.receivedWantedThumbnail(u.thumbnail),await e.onDocReceived();break}case"NEW_ATTACHMENT":{if(e.transferManager.isAlreadyQueued(u.hash,"download"))break;const a=t[u.format],l=(await e.replica.getAllDocsAtPath(u.path,[a])).find(f=>u.author===f.author);if(!l)break;if(await e.replica.getAttachment(l,t[l.format])===void 0){const f=await e.transferManager.handleDownload(l,e.replica,e.counterpartId);if(M(f)){const h=a.getAttachmentInfo(l);e.transferManager.registerExpectedTransfer(e.replica.share,h.hash),e.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:h.hash,doc:l,shareAddress:e.replica.share})}}break}case"FULFILLED":this.isPartnerFulfilled.resolve(!0);break;case"WANT_ATTACHMENT":e.transferManager.handleUpload(u,e.replica);break;case"ABORT":await e.cancel()}})(),e.reconciliationIsDone.then(async()=>{e.syncAppetite==="once"&&(r(),e.wantTracker.seal(),await e.wantTracker.isDone(),e.outboundEventQueue.push({kind:"FULFILLED"}),this.isFulfilled.resolve())})}get isDone(){return Promise.all([this.isPartnerFulfilled,this.isFulfilled])}}class lf{constructor(e){Object.defineProperty(this,"communicationRoundsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isDone",{enumerable:!0,configurable:!0,writable:!0,value:te()});const{tree:t,lookup:n,treeIsReady:r}=e.syncerManager.getDocThumbnailTreeAndDocLookup(e.replica.share,wn(e.formats));e.initiateMessaging&&r.then(()=>{for(const u of s.initialMessages())e.outboundEventQueue.push({kind:"RANGE_MSG",message:u})});const s=new uf(t,e.payloadThreshold,e.rangeDivision);s.onInsertion(u=>{const[a,o]=u.split(" "),l=n[o];l&&l[0]>=parseInt(a)||(e.wantTracker.addWantedThumbnail(u),e.outboundEventQueue.push({kind:"WANT",thumbnail:u}),e.onDocRequested())}),(async()=>{await r;for await(const u of e.inboundEventQueue){if(this.isDone.state==="fulfilled")return;u.type==="TERMINAL"&&this.communicationRoundsCount++;const a=s.respond(u);for(const o of a)e.outboundEventQueue.push({kind:"RANGE_MSG",message:o})}})(),s.isDone().then(()=>{this.isDone.resolve(this.communicationRoundsCount)})}}class cf{constructor(e){const t=e.replica.getQueryStream({orderBy:"localIndex ASC"},"existing",e.formats),n=yn(e.formats),r=e.transferManager.handleDownload.bind(e.transferManager);t.pipeTo(new st({start(s){e.replica.onEvent(u=>{u.kind==="willClose"&&s.error()})},async write(s){if(s.kind==="existing"||s.kind==="success"){const u=n[s.doc.format],a=await e.replica.getAttachment(s.doc,u);if(M(a))return;if(a===void 0){const o=await r(s.doc,e.replica,e.counterpartId);if(M(o)){const l=u.getAttachmentInfo(s.doc);e.transferManager.registerExpectedTransfer(e.replica.share,l.hash),e.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:l.hash,doc:s.doc,shareAddress:e.replica.share})}}}}})).then(()=>{e.hasCheckedAllExistingDocsForAttachments.resolve()}).catch(()=>{e.hasCheckedAllExistingDocsForAttachments.resolve()})}}class ff{constructor(){Object.defineProperty(this,"isSealed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"wantedThumbnails",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"enroller",{enumerable:!0,configurable:!0,writable:!0,value:new Gn}),Object.defineProperty(this,"received",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:Tt()})}addWantedThumbnail(e){if(!this.isSealed&&!this.wantedThumbnails.has(e)){const t=te();this.wantedThumbnails.set(e,t),this.enroller.enrol(t)}}receivedWantedThumbnail(e){const t=this.wantedThumbnails.get(e);t&&(t.resolve(),this.received++)}isRequested(e){return this.wantedThumbnails.has(e)}isReceived(e){const t=this.wantedThumbnails.get(e);return t?t.state==="fulfilled":!1}seal(){this.enroller.seal()}isDone(){return this.enroller.isDone()}get requestedCount(){return this.wantedThumbnails.size}get receivedCount(){return this.received}}class Xo{constructor(e,t){Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.cb=e,this.ms=t,this.timeout=rn(e,t)}bump(){this.closed||(clearTimeout(this.timeout),this.timeout=rn(this.cb,this.ms))}close(){this.closed=!0,clearTimeout(this.timeout)}}const ea=1e4;class ni{constructor({stream:e,replica:t,doc:n,format:r,requester:s,counterpartId:u}){Object.defineProperty(this,"kind",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:"ready"}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"expectedSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sourceDoc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new an}),Object.defineProperty(this,"transferOp",{enumerable:!0,configurable:!0,writable:!0,value:te()}),Object.defineProperty(this,"abortCb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new Lr}),Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"requester",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.sourceDoc=n,this.share=t.share,this.requester=s;const a=r.getAttachmentInfo(n);if(M(a))throw new O("AttachmentTransfer was given a doc which has no attachment!");this.hash=a.hash,this.expectedSize=a.size;const o=this.updateLoaded.bind(this);if(e instanceof sn){this.kind="download";let l;this.abortCb=()=>{l?l.cancel():e.cancel()};const c=()=>this.loaded,f=()=>new sn({async start(h){const d=e.getReader();l=d;const p=new Xo(()=>{h.error("Attachment download timed out.")},ea);for(;;){const{done:g,value:C}=await d.read();if(p.bump(),g||(o(C.byteLength),h.enqueue(C),c()>=a.size))break}p.close(),h.close()}});this.transferOp.resolve(()=>{const h=te();return t.ingestAttachment(r,n,f(),u).then(d=>{if(M(d)&&this.loaded===0){this.changeStatus("missing_attachment");return}if(M(d)){console.warn(`Couldn't ingest the attachment for ${n.path} by ${n.author}: ${d.message}`),h.reject(d);return}h.resolve()}).catch(d=>{console.log(d),h.reject(d)}),h})}else this.kind="upload",this.abortCb=()=>{e.abort().catch(()=>{})},t.getAttachment(n,r).then(async l=>{if(!l){await this.changeStatus("missing_attachment"),await e.abort();return}if(M(l)){await this.changeStatus("failed"),await e.abort();return}const c=new Bn({transform(f,h){o(f.byteLength),h.enqueue(f)}});this.transferOp.resolve(()=>l.stream().then(f=>f.pipeThrough(c).pipeTo(e)).catch(f=>{console.log(f)}))})}async start(){if(this.status!=="ready")return;const e=await this.transferOp;await this.changeStatus("in_progress"),e().then(async()=>{await this.changeStatus("complete")}).catch(async()=>{await this.changeStatus("failed")})}updateLoaded(e){this.loaded+=e,this.statusBus.send({status:this.status,bytesLoaded:this.loaded,totalBytes:this.expectedSize})}async changeStatus(e){this.status==="complete"||this.status==="failed"||this.status==="missing_attachment"||(this.status=e,await this.statusBus.send({status:e,bytesLoaded:this.loaded,totalBytes:this.expectedSize}),e==="complete"&&this.multiDeferred.resolve(),e==="failed"&&this.multiDeferred.reject("Attachment transfer failed"),e==="missing_attachment"&&this.multiDeferred.reject("The other peer does not have this attachment"))}get doc(){return this.sourceDoc}onProgress(e){return this.statusBus.on(e)}abort(){this.abortCb()}isDone(){return this.multiDeferred.getPromise()}}class hf{constructor(e){Object.defineProperty(this,"waiting",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"active",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"failed",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"completed",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"activeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transfersRequestedByUsEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new Gn(!0)}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"reports",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"reportBus",{enumerable:!0,configurable:!0,writable:!0,value:new an}),this.activeLimit=e}async activate(e){this.active.add(e),e.isDone().then(()=>{this.completed.add(e)}).catch(()=>{this.failed.add(e)}).finally(()=>{this.active.delete(e),this.admitNext()}),await e.start()}queue(e){this.waiting.push(e)}admitNext(){if(this.waiting.length===0||this.active.size>=this.activeLimit)return;const e=this.waiting.shift();e&&this.activate(e)}async addTransfer(e){if(this.closed){e.abort();return}e.onProgress(()=>{this.updateTransferStatus(e)}),e.requester==="us"&&this.transfersRequestedByUsEnroller.enrol(e.isDone()),this.active.size<this.activeLimit?await this.activate(e):this.queue(e)}gotAllTransfersRequestedByUs(){this.transfersRequestedByUsEnroller.seal()}cancel(){this.closed=!0,this.transfersRequestedByUsEnroller.seal();for(const e of this.active)e.abort()}updateTransferStatus(e){this.reports[e.share]||(this.reports[e.share]={}),this.reports[e.share][e.hash+e.kind]={author:e.doc.author,path:e.doc.path,format:e.doc.format,hash:e.hash,kind:e.kind,status:e.status,bytesLoaded:e.loaded,totalBytes:e.expectedSize},this.reportBus.send(this.getReport())}getReport(){const e={};for(const t in this.reports){const n=[],r=this.reports[t];for(const s in r){const u=r[s];n.push(u)}e[t]=n}return e}hasQueuedTransfer(e,t){for(const n of this.waiting)if(n.hash===e&&n.kind===t)return!0;for(const n of this.active)if(n.hash===e&&n.kind===t)return!0;for(const n of this.completed)if(n.hash===e&&n.kind===t)return!0;return!1}onReportUpdate(e){return this.reportBus.on(e)}transfersRequestedByUsFinished(){return this.transfersRequestedByUsEnroller.isDone()}}class df{constructor(e){Object.defineProperty(this,"partner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"otherSyncerId",{enumerable:!0,configurable:!0,writable:!0,value:te()}),Object.defineProperty(this,"receivedAllExpectedTransfersEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new Gn}),Object.defineProperty(this,"madeAllAttachmentRequestsEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new Gn(!0)}),Object.defineProperty(this,"formatsLookup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reportDidUpdateBus",{enumerable:!0,configurable:!0,writable:!0,value:new an}),Object.defineProperty(this,"expectedTransferPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.partner=e.partner,this.queue=new hf(this.partner.concurrentTransfers),this.formats=e.formats,this.formatsLookup=yn(this.formats),this.queue.onReportUpdate(async t=>{await this.reportDidUpdateBus.send(t)}),this.madeAllAttachmentRequestsEnroller.isDone().then(()=>{this.receivedAllExpectedTransfersEnroller.seal()}),this.receivedAllExpectedTransfersEnroller.isDone().then(()=>{this.queue.gotAllTransfersRequestedByUs()})}registerSyncAgent(e){this.madeAllAttachmentRequestsEnroller.enrol(e.isDone())}allSyncAgentsKnown(){this.madeAllAttachmentRequestsEnroller.seal()}registerExpectedTransfer(e,t){const n=`${e}_${t}`;if(this.expectedTransferPromises.has(n))return;const r=te();this.expectedTransferPromises.set(n,r),this.receivedAllExpectedTransfersEnroller.enrol(r)}async queueTransfer(e){this.queue.hasQueuedTransfer(e.hash,e.kind)||await this.queue.addTransfer(e)}async handleDownload(e,t,n){const r=this.formatsLookup[e.format],s=r.getAttachmentInfo(e);if(M(s))throw new Ge("TransferManager: attempted to download doc with no attachment.");if(this.queue.hasQueuedTransfer(s.hash,"download"))return"queued";const u=await this.partner.getDownload({doc:e,shareAddress:t.share,syncerId:await this.otherSyncerId,attachmentHash:s.hash});if(u===void 0)return"no_attachment";if(M(u))return u;const a=new ni({replica:t,doc:e,format:r,stream:u,requester:"us",counterpartId:n});return await this.queueTransfer(a),"queued"}async handleUpload(e,t){if(this.queue.hasQueuedTransfer(e.attachmentHash,"upload"))return!1;const n=this.formatsLookup[e.doc.format];if(!await t.getAttachment(e.doc,n))return!1;const s=await this.partner.handleUploadRequest({shareAddress:e.shareAddress,syncerId:await this.otherSyncerId,doc:e.doc,attachmentHash:e.attachmentHash});if(M(s))return!1;try{const u=new ni({doc:e.doc,format:n,replica:t,stream:s,requester:"them",counterpartId:"unused"});await this.queueTransfer(u)}catch{return!1}return!0}async handleTransferRequest({replica:e,path:t,author:n,source:r,kind:s,formatName:u,counterpartId:a}){const o=await this.partner.handleTransferRequest(r,s);if(o===void 0||M(o))return;const l=yn(this.formats)[u];if(!l)return;const f=(await e.getAllDocsAtPath(t,[l])).find(d=>d.author===n);if(!f)return;const h=new ni({doc:f,format:l,replica:e,stream:o,requester:s==="upload"?"us":"them",counterpartId:a});if(h.requester==="us"){const d=`${h.share}_${h.hash}`,p=this.expectedTransferPromises.get(d);p&&p.resolve()}await this.queueTransfer(h)}cancel(){this.queue.cancel()}getReport(){return this.queue.getReport()}onReportUpdate(e){return this.reportDidUpdateBus.on(e)}transfersRequestedByUsFinished(){return this.queue.transfersRequestedByUsFinished()}registerOtherSyncerId(e){this.otherSyncerId.resolve(e)}isAlreadyQueued(e,t){return this.queue.hasQueuedTransfer(e,t)}}class ta{constructor(e){Object.defineProperty(this,"peer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:Tt()}),Object.defineProperty(this,"manager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"syncAgents",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"syncAgentQueues",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"appetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new an}),Object.defineProperty(this,"formats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transferManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partnerIsFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:te()}),Object.defineProperty(this,"isDoneMultiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new Lr}),Object.defineProperty(this,"heartbeatInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bumpingTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.manager=e.manager,this.peer=e.manager.peer,this.appetite=e.partner.syncAppetite,this.formats=wn(e.formats),this.partner=e.partner,this.transferManager=new df({partner:this.partner,formats:this.formats}),this.transferManager.onReportUpdate(async()=>{await this.statusBus.send(this.getStatus())}),this.heartbeatInterval=Tr(()=>{this.partner.sendEvent({kind:"HEARTBEAT"})},1e3),(async()=>{try{for await(const n of e.partner.getEvents())this.handleIncomingEvent(n)}catch(n){this.cancel(n||"Partner disconnected")}})();const t=Tt();Promise.all(this.peer.shares().map(n=>hr(t,n))).then(n=>{this.partner.sendEvent({kind:"DISCLOSE",salt:t,syncerId:this.id,shares:n,formats:this.formats?this.formats.map(r=>r.id):[mt.id],canRespond:!1})}),this.transferManager.transfersRequestedByUsFinished().then(async()=>{e.partner.syncAppetite!=="continuous"&&(await this.partner.sendEvent({kind:"SYNCER_FULFILLED"}),await this.partnerIsFulfilled,clearInterval(this.heartbeatInterval),await this.partner.closeConnection(),this.bumpingTimeout.close(),this.isDoneMultiDeferred.resolve())}),this.peer.onReplicasChange(async n=>{if(this.appetite==="once")return;const r=Array.from(n.keys());for(const[u,a]of this.syncAgents)r.includes(u)===!1&&(await a.cancel("Replica was removed from peer."),this.syncAgents.delete(u));const s=Tt();Promise.all(r.map(u=>hr(s,u))).then(u=>{this.partner.sendEvent({kind:"DISCLOSE",salt:s,syncerId:this.id,shares:u,formats:this.formats?this.formats.map(a=>a.id):[mt.id],canRespond:!0})})}),this.bumpingTimeout=new Xo(()=>{this.cancel("No communication from the other peer in the last three seconds.")},ea)}addShare(e,t,n){if(this.syncAgents.has(e))return;const r=this.peer.getReplica(e);if(!r){console.error("Couldn't get the replica for a share we had in common.");return}const s=new of({replica:r,formats:t,syncerManager:this.manager,transferManager:this.transferManager,initiateMessaging:n,payloadThreshold:this.partner.payloadThreshold,rangeDivision:this.partner.rangeDivision,syncAppetite:this.appetite});s.onStatusUpdate(()=>{this.statusBus.send(this.getStatus())}),this.syncAgents.set(e,s),this.transferManager.registerSyncAgent(s);const u=this.syncAgentQueues.get(e);let a;if(u)a=u;else{const o=new St;a=o,this.syncAgentQueues.set(e,o)}(async()=>{for await(const o of a)s.sendEvent(o)})(),(async()=>{for await(const o of s.events())await this.partner.sendEvent({to:e,...o})})()}async handleIncomingEvent(e){if(this.bumpingTimeout.bump(),this.isDoneMultiDeferred.state==="pending")switch(e.kind){case"DISCLOSE":{const t=Wc(e.formats,this.formats);if(t.length===0)break;const n=new Set(e.shares),r=new Set,s=new Set;for(const a of this.peer.shares()){const o=await hr(e.salt,a);n.has(o)?r.add(a):s.add(a)}const u=this.id>e.syncerId;for(const a of r)this.addShare(a,t,u);for(const a of s){const o=this.syncAgents.get(a);o&&(o.cancel("No longer in common with the other peer."),this.syncAgents.delete(a))}if(this.transferManager.registerOtherSyncerId(e.syncerId),this.appetite==="once"&&this.transferManager.allSyncAgentsKnown(),e.canRespond){const a=Tt();Promise.all(this.peer.shares().map(o=>hr(a,o))).then(o=>{this.partner.sendEvent({kind:"DISCLOSE",salt:a,syncerId:this.id,shares:o,formats:this.formats?this.formats.map(l=>l.id):[mt.id],canRespond:!1})})}r.size===0&&this.appetite==="once"&&this.partner.sendEvent({kind:"SYNCER_FULFILLED"});break}case"SYNCER_FULFILLED":{this.partnerIsFulfilled.resolve();break}case"HEARTBEAT":break;default:{const{to:t}=e,n=this.syncAgentQueues.get(t);if(!n){const r=new St;r.push(e),this.syncAgentQueues.set(t,r);break}n.push(e)}}}getStatus(){const e={};for(const[t,n]of this.syncAgents)e[t]={docs:n.getStatus(),attachments:this.transferManager.getReport()[t]||[]};return e}onStatusChange(e){return this.statusBus.on(e)}async cancel(e){this.bumpingTimeout.close(),this.isDoneMultiDeferred.reject(e);for(const[t,n]of this.syncAgents)await n.cancel();clearInterval(this.heartbeatInterval),this.transferManager.cancel(),await this.partner.closeConnection()}handleTransferRequest({shareAddress:e,path:t,author:n,source:r,kind:s,formatName:u}){if(this.isDoneMultiDeferred.state!=="pending")return;const a=this.peer.getReplica(e);if(!a)return;let o="unused";if(s==="upload"){const l=this.syncAgents.get(e);l&&(o=l.counterpartId)}return this.transferManager.handleTransferRequest({replica:a,author:n,formatName:u,kind:s,path:t,source:r,counterpartId:o})}isDone(){return this.isDoneMultiDeferred.getPromise()}}function hr(i,e){return we.sha256base32(i+e+i)}class pf{constructor(e,t,n,r){Object.defineProperty(this,"concurrentTransfers",{enumerable:!0,configurable:!0,writable:!0,value:1024}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"syncAppetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outgoingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new St}),Object.defineProperty(this,"incomingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new St}),Object.defineProperty(this,"partnerPeer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partnerSyncer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.syncAppetite=n,this.partnerPeer=e;const{incomingQueue:s,outgoingQueue:u}=this;this.partnerSyncer=new ta({manager:e.syncerManager,formats:r,partner:{syncAppetite:n,getEvents(){return s},sendEvent(a){return u.push(a),Promise.resolve()},concurrentTransfers:1024,payloadThreshold:32,rangeDivision:32,async getDownload(a){const o=t.getReplica(a.shareAddress);if(!o)throw new O("Tried to get a receiving transfer for an unknown share.");const l=await o.replicaDriver.attachmentDriver.getAttachment(a.doc.format,a.attachmentHash);if(l&&!M(l))return await l.stream()},closeConnection(){return u.close(),Promise.resolve()},handleUploadRequest(a){return Promise.resolve(new zn("PartnerLocal does not support uploads."))},handleTransferRequest(a,o){return Promise.resolve(new zn("PartnerLocal does not support transfer requests."))}}})}getEvents(){return this.outgoingQueue}sendEvent(e){return this.incomingQueue.push(e),Promise.resolve()}closeConnection(){return this.incomingQueue.close(),Promise.resolve()}async getDownload(e){const t=this.partnerPeer.getReplica(e.shareAddress);if(!t)throw new O("Tried to get a receiving transfer for an unknown share.");const n=await t.replicaDriver.attachmentDriver.getAttachment(e.doc.format,e.attachmentHash);if(n&&!M(n))return await n.stream()}handleUploadRequest(e){return Promise.resolve(new zn("PartnerLocal does not support uploads."))}handleTransferRequest(e,t){return Promise.resolve(new zn("PartnerLocal does not support transfer requests."))}}class mf{constructor(e){Object.defineProperty(this,"syncAppetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"concurrentTransfers",{enumerable:!0,configurable:!0,writable:!0,value:24}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"isSecure",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wsUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"socket",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"incomingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new St}),Object.defineProperty(this,"socketIsReady",{enumerable:!0,configurable:!0,writable:!0,value:te()}),this.syncAppetite=e.appetite;const t=new URL(e.url),n=`${t.host}${t.pathname==="/"?"":t.pathname}`;this.isSecure=t.protocol==="https:"||t.protocol==="wss:",this.wsUrl=`${this.isSecure?"wss://":"ws://"}${n}/'`;const r=new URL(e.appetite,this.wsUrl);this.socket=new bn(r.toString()),this.socket.onopen=()=>{this.socketIsReady.resolve()},this.socket.binaryType="arraybuffer",this.socket.onmessage=s=>{this.incomingQueue.push(JSON.parse(s.data))},this.socket.onclose=()=>{this.incomingQueue.close()},this.socket.onerror=s=>{if("error"in s){this.incomingQueue.close({withError:s.error});return}this.incomingQueue.close({withError:new Ge("Websocket error.")})}}async sendEvent(e){if(await this.socketIsReady,!(this.socket.readyState===this.socket.CLOSED||this.socket.readyState===this.socket.CLOSING))return this.socket.send(JSON.stringify(e))}getEvents(){return this.incomingQueue}closeConnection(){return this.socket.close(),Promise.resolve()}getDownload(e){const t=new URL(`${e.syncerId}/download/${e.shareAddress}/${e.doc.format}/${e.doc.author}${e.doc.path}`,this.wsUrl),n=ef(t.toString(),r=>r.data instanceof ArrayBuffer?new Uint8Array(r.data):null);return Promise.resolve(n)}handleUploadRequest(e){const t=new URL(`${e.syncerId}/upload/${e.shareAddress}/${e.doc.format}/${e.doc.author}${e.doc.path}`,this.wsUrl),n=Xc(t.toString(),r=>r);return Promise.resolve(n)}handleTransferRequest(e,t){return Promise.resolve(new zn("SyncDriverWebClient does not support external transfer requests."))}}function gf(i,e){const[t,n]=i.split(" "),[r,s]=e.split(" "),u=parseInt(t),a=parseInt(r);return u>a?1:u<a?-1:n>s?1:n<s?-1:0}const Df={lift:i=>fc(i),combine:(i,e)=>i+e,neutral:BigInt(0)};class bf extends dc{constructor(){super(Df,gf)}}class wf{constructor(){Object.defineProperty(this,"messagingModes",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"eagerMessageThumbnails",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"haveTimeouts",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}getMode(e){const t=this.messagingModes.get(e);if(t)return t;const n=this.messagingModes.size===0?"EAGER":"LAZY";return this.messagingModes.set(e,n),"EAGER"}onEagerMessage(e,t){const n=this.haveTimeouts.get(t.thumbnail);return n?(clearTimeout(n),!1):this.eagerMessageThumbnails.has(t.thumbnail)?(this.messagingModes.set(e,"LAZY"),!0):(this.eagerMessageThumbnails.add(t.thumbnail),!1)}onLazyMessage(e,t){if(!this.haveTimeouts.has(e.thumbnail)){const n=rn(()=>{t(e.thumbnail)},5);this.haveTimeouts.set(e.thumbnail,n)}}onGraftMessage(e){this.messagingModes.set(e,"EAGER")}onPrune(e){this.messagingModes.set(e,"LAZY")}}class yf{constructor(e){Object.defineProperty(this,"syncers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"syncerEventBus",{enumerable:!0,configurable:!0,writable:!0,value:new an}),Object.defineProperty(this,"peer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docThumbnailTreeAndLookup",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"hasher",{enumerable:!0,configurable:!0,writable:!0,value:new Ei}),Object.defineProperty(this,"plumTrees",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.peer=e}addPartner(e,t,n){const r=new ta({manager:this,partner:e,formats:n});return this.syncers.set(r.id,{syncer:r,description:t}),this.syncerEventBus.send(this.syncers),r}getSyncers(){return this.syncers}getDocThumbnailTreeAndDocLookup(e,t){const n=t.map(h=>h.id),r=`${e} ${n}`,s=this.docThumbnailTreeAndLookup.get(r);if(s){const[h,d]=s;return{tree:h,lookup:d,treeIsReady:Promise.resolve(!0)}}const u=this.peer.getReplica(e);if(!u)throw new Ge("A DocThumbnailTree was requested for a share the peer doesn't know about, big problem!");const a=this.hasher,o=u.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"everything",t),l=new bf,c={},f=te();return o.pipeTo(new st({write(h){if(h.kind==="processed_all_existing"){f.resolve();return}a.reset(),a.update(`${h.doc.path} ${h.doc.author}`);const d=a.digest().toString(16),p=`${h.doc.timestamp} ${d}`;(h.kind==="existing"||h.kind==="success")&&(c[d]=[h.doc.timestamp,h.doc.path,h.doc.author],l.insert(p)),h.kind==="expire"&&(delete c[d],l.remove(p))}})),{tree:l,lookup:c,treeIsReady:f}}getPlumTree(e){const t=this.plumTrees.get(e);if(t)return t;const n=new wf;return this.plumTrees.set(e,n),n}onSyncersChange(e){return this.syncerEventBus.on(e)}}const Qt=new qe("peer","orangeRed"),Ln=JSON.stringify;class nr{constructor(){Object.defineProperty(this,"replicaEventBus",{enumerable:!0,configurable:!0,writable:!0,value:new an}),Object.defineProperty(this,"syncerManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicaMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Qt.debug("constructor"),this.syncerManager=new yf(this)}hasShare(e){return this.replicaMap.has(e)}shares(){const e=[...this.replicaMap.keys()];return e.sort(),e}replicas(){const e=[...this.replicaMap.keys()];return e.sort(),e.map(t=>this.replicaMap.get(t))}size(){return this.replicaMap.size}getReplica(e){return this.replicaMap.get(e)}async addReplica(e){if(Qt.debug(`addReplica(${Ln(e.share)})`),this.replicaMap.has(e.share))throw Qt.debug("already had a replica with that share"),new Error(`Peer.addReplica: already has a replica with share ${Ln(e.share)}.  Don't add another one.`);this.replicaMap.set(e.share,e),await this.replicaEventBus.send(this.replicaMap),Qt.debug("    ...addReplica: done")}async removeReplicaByShare(e){Qt.debug(`removeReplicaByShare(${Ln(e)})`),this.replicaMap.delete(e),await this.replicaEventBus.send(this.replicaMap)}async removeReplica(e){const t=this.replicaMap.get(e.share);e===t?(Qt.debug(`removeReplica(${Ln(e.share)})`),await this.removeReplicaByShare(e.share)):Qt.debug(`removeReplica(${Ln(e.share)}) -- same share but it's a different instance now; ignoring`)}sync(e,t=!1,n){try{const r=new mf({url:e,appetite:t?"continuous":"once"});return this.syncerManager.addPartner(r,e,n)}catch{if(e instanceof nr){const r=new pf(e,this,t?"continuous":"once",n);return this.syncerManager.addPartner(r,"Local",n)}console.error("Provided an invalid target for syncing to a peer:",e);return}}addSyncPartner(e,t,n){return this.syncerManager.addPartner(e,t,n)}getSyncers(){return this.syncerManager.getSyncers()}onReplicasChange(e){return this.replicaEventBus.on(e)}onSyncersChange(e){return this.syncerManager.onSyncersChange(e)}discover(e){const t=this;return{async*[Symbol.asyncIterator](){for await(const n of e.events){if(n.kind==="SERVICE_STOPPED")break;if(n.kind==="PEER_EXITED"){yield n;continue}if(n.kind==="PEER_INITIATED_SYNC"){const r=await n.begin(t);yield{kind:"PEER_INITIATED_SYNC",description:n.description,syncer:r};continue}yield{kind:"PEER_DISCOVERED",description:n.description,sync:async r=>await n.begin(t,r!=null&&r.syncContinuously?"continuous":"once")}}}}}}const _f={historyMode:"latest",orderBy:"path ASC",startAfter:void 0,limit:void 0,filter:void 0,formats:["es.5"]},Gt=new qe("query","green");function na(i){var r,s,u,a;const e={..._f,...i},t={query:{limit:0},isValid:!1,willMatch:"nothing"};if(e.limit!==void 0&&e.limit<0)return Gt.debug("cleanUpQuery: unreasonable limit - returning empty invalid query",t),t;if((r=e.orderBy)!=null&&r.startsWith("path")&&((s=e.startAfter)==null?void 0:s.localIndex)!==void 0)return Gt.debug('cleanUpQuery: orderBy is "path" but startAfter is not compatible - returning empty invalid query',t),t;if((u=e.orderBy)!=null&&u.startsWith("localIndex")&&((a=e.startAfter)==null?void 0:a.path)!==void 0)return Gt.debug('cleanUpQuery: orderBy is "localIndex" but startAfter is not compatible - returning empty invalid query',t),t;if(e.historyMode!==void 0&&e.historyMode!=="all"&&e.historyMode!=="latest")return Gt.debug(`cleanUpQuery: unknown historyMode ${JSON.stringify(e.historyMode)} - returning empty invalid query`,t),t;if(e.orderBy!==void 0&&["path ASC","path DESC","localIndex ASC","localIndex DESC"].indexOf(e.orderBy)===-1)return Gt.debug(`cleanUpQuery: unrecognized orderBy value ${JSON.stringify(e.orderBy)} - returning empty invalid query`,t),t;let n=e.historyMode==="all"?"all":"all-latest";if(e.filter!==void 0&&!Cr(e.filter,{})&&(n="some"),e.startAfter!==void 0&&!Cr(e.startAfter,{})&&(n="some"),e.limit!==void 0&&(e.limit>0&&(n="some"),e.limit===0&&(n="nothing")),e.filter!==void 0){const o=e.filter;o.path&&o.pathStartsWith&&!o.path.startsWith(o.pathStartsWith)&&(n="nothing"),o.path&&o.pathEndsWith&&!o.path.endsWith(o.pathEndsWith)&&(n="nothing"),o.timestamp&&o.timestampGt&&!(o.timestamp>o.timestampGt)&&(n="nothing"),o.timestamp&&o.timestampLt&&!(o.timestamp<o.timestampLt)&&(n="nothing"),o.timestampGt&&o.timestampLt&&!(o.timestampLt+1<o.timestampGt)&&(n="nothing")}if(n==="nothing"){let o={query:{limit:0},isValid:!0,willMatch:"nothing"};return Gt.debug("cleanUpQuery - this query will match nothing, so returning a simpler query that also matches nothing",o),o}return Gt.debug(`cleanUpQuery - query is ok!  willMatch = ${n}`),{query:e,isValid:!0,willMatch:n}}function ki(i,e){return!(e.path!==void 0&&i.path!==e.path||e.pathStartsWith!==void 0&&!i.path.startsWith(e.pathStartsWith)||e.pathEndsWith!==void 0&&!i.path.endsWith(e.pathEndsWith)||e.author!==void 0&&i.author!==e.author||e.timestamp!==void 0&&i.timestamp!==e.timestamp||e.timestampGt!==void 0&&!(i.timestamp>e.timestampGt)||e.timestampLt!==void 0&&!(i.timestamp<e.timestampLt))}new qe("query helpers","gold");var rt;(function(i){i[i.LT=-1]="LT",i[i.EQ=0]="EQ",i[i.GT=1]="GT"})(rt||(rt={}));function pi(i,e,t="ASC"){if(Array.isArray(i)&&Bo(i,e)||typeof i=="object"&&Cr(i,e)||i===e)return rt.EQ;if(t==="ASC"||t===void 0)return i<e?rt.LT:rt.GT;if(t==="DESC")return i>e?rt.LT:rt.GT;throw new Error("unexpected sort order to compareBasic: "+JSON.stringify(t))}function Fi(i,e,t){let n=Math.min(i.length,e.length);for(let u=0;u<n;u++){let a=(t==null?void 0:t[u])??"ASC",o=pi(i[u],e[u],a);if(o!==rt.EQ)return o}if(i.length===e.length)return rt.EQ;let r=Math.min(i.length,e.length),s=(t==null?void 0:t[r])??"ASC";return pi(i.length,e.length,s)}function Ds(i,e="ASC"){return(t,n)=>pi(t[i],n[i],e)}const Af=JSON.stringify,Ve=new qe("replica","gold"),Ke=new qe("replica set","gold"),Ue=new qe("replica ingest","gold");function bs(i,e){return Fi([i.timestamp,i.signature],[e.timestamp,i.signature],["DESC","ASC"])}class Cf{constructor({driver:e,config:t}){var r;Object.defineProperty(this,"replicaId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicaDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formatsConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isClosed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ingestLockStream",{enumerable:!0,configurable:!0,writable:!0,value:new Zo}),Object.defineProperty(this,"eventMultiStream",{enumerable:!0,configurable:!0,writable:!0,value:new Zc("kind",!0)}),Object.defineProperty(this,"eventWriter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbackSink",{enumerable:!0,configurable:!0,writable:!0,value:new Jo}),Object.defineProperty(this,"eraseInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"expireEventTimeouts",{enumerable:!0,configurable:!0,writable:!0,value:new Map});const n=zt(e.docDriver.share);if(M(n))throw n;Ve.debug(`constructor.  driver = ${(r=e==null?void 0:e.constructor)==null?void 0:r.name}`),this.replicaId="replica-"+Tt(),this.share=e.docDriver.share,this.replicaDriver=e,this.formatsConfig=t||{},this.eventWriter=this.eventMultiStream.getWritableStream().getWriter(),this.eventMultiStream.getReadableStream("*").pipeTo(new st(this.callbackSink)),this.eraseInterval=Tr(()=>{this.isClosed()?clearInterval(this.eraseInterval):this.pruneExpiredDocsAndAttachments()},1e3*60*60)}isClosed(){return this._isClosed}async close(e){if(Ve.debug("closing..."),this._isClosed)throw new _e;await this.ingestLockStream.close();for(const t of this.expireEventTimeouts.values())clearTimeout(t);return Ve.debug("    sending willClose blockingly..."),await this.eventWriter.write({kind:"willClose"}),Ve.debug("    marking self as closed..."),e===!1&&await this.pruneExpiredDocsAndAttachments(),await this.replicaDriver.attachmentDriver.clearStaging(),this._isClosed=!0,Ve.debug(`    closing ReplicaDriver (erase = ${e})...`),await this.replicaDriver.docDriver.close(e),await this.replicaDriver.attachmentDriver.close(e),clearInterval(this.eraseInterval),Ve.debug("    sending didClose nonblockingly..."),await this.eventWriter.write({kind:"didClose"}),Ve.debug("...closing done"),Promise.resolve()}async getConfig(e){if(this._isClosed)throw new _e;return await this.replicaDriver.docDriver.getConfig(e)}async setConfig(e,t){if(this._isClosed)throw new _e;return await this.replicaDriver.docDriver.setConfig(e,t)}async listConfigKeys(){if(this._isClosed)throw new _e;return await this.replicaDriver.docDriver.listConfigKeys()}async deleteConfig(e){if(this._isClosed)throw new _e;return await this.replicaDriver.docDriver.deleteConfig(e)}getMaxLocalIndex(){if(this._isClosed)throw new _e;return this.replicaDriver.docDriver.getMaxLocalIndex()}getAllDocs(e){return Ve.debug("getAllDocs()"),this.queryDocs({historyMode:"all",orderBy:"path ASC"},e)}getLatestDocs(e){return Ve.debug("getLatestDocs()"),this.queryDocs({historyMode:"latest",orderBy:"path ASC"},e)}getAllDocsAtPath(e,t){return Ve.debug(`getAllDocsAtPath("${e}")`),this.queryDocs({historyMode:"all",orderBy:"path ASC",filter:{path:e}},t)}async getLatestDocAtPath(e,t){Ve.debug(`getLatestDocsAtPath("${e}")`);const n=await this.queryDocs({historyMode:"latest",orderBy:"path ASC",filter:{path:e}},t?[t]:void 0);if(n.length!==0)return n[0]}async queryDocs(e={},t){if(Ve.debug("queryDocs",e),this._isClosed)throw new _e;const n=wn(t);return await this.replicaDriver.docDriver.queryDocs({...e,formats:n.map(r=>r.id)})}async queryPaths(e={},t){const n=await this.queryDocs(e,t),r=new Set(n.map(({path:s})=>s));return Array.from(r).sort()}async queryAuthors(e={},t){const n=await this.queryDocs(e,t),r=new Set(n.map(({author:s})=>s));return Array.from(r).sort()}async set(e,t,n=mt){if(Ke.debug("set",t),this._isClosed)throw new _e;Ke.debug("...deciding timestamp: getting latest doc at the same path (from any author)");const r=await this.getLatestDocAtPath(t.path);let s;typeof t.timestamp=="number"?s=t.timestamp:r===void 0?s=us():s=Math.max(us(),r.timestamp+1),Ke.debug("...generating doc");let u;if(r){const l=n.removeExtraFields(r);M(l)||(u=l.doc)}const a=await n.generateDocument({keypair:e,input:{...t,format:n.id},share:this.share,timestamp:s,prevLatestDoc:u,config:this.formatsConfig[n.id]});if(M(a))return{kind:"failure",reason:"invalid_document",err:a};if(Ke.debug("...signature =",a.doc.signature),a.attachment){const l=await this.replicaDriver.attachmentDriver.stage(n.id,a.attachment);if(M(l))return{kind:"failure",reason:"invalid_document",err:l};const c=await n.updateAttachmentFields(e,a.doc,l.size,l.hash,this.formatsConfig[n.id]);if(M(c))return await l.reject(),{kind:"failure",reason:"invalid_document",err:c};Ke.debug("...ingesting attachment"),Ke.debug("-----------------------"),await l.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:c,hash:l.hash,size:l.size,sourceId:"local"}),Ke.debug("...done ingesting attachment"),Ke.debug("...ingesting"),Ke.debug("-----------------------");const f=await this.ingest(n,c,"local");return Ke.debug("...done ingesting"),Ke.debug("...set is done."),f}Ke.debug("...ingesting"),Ke.debug("-----------------------");const o=await this.ingest(n,a.doc,"local");return Ke.debug("...done ingesting"),Ke.debug("...set is done."),o}async ingest(e,t,n){if(Ue.debug("ingest",t),this._isClosed)throw new _e;Ue.debug("...removing extra fields");const r=e.removeExtraFields(t);if(M(r))return{kind:"failure",reason:"invalid_document",err:r};t=r.doc;const s=r.extras;Object.keys(s).length>0&&Ue.debug(`...extra fields found: ${Af(s)}`);const u=await e.checkDocumentIsValid(t);if(M(u))return{kind:"failure",reason:"invalid_document",err:u};const a=te();return await this.ingestLockStream.run(async()=>{Ue.debug(" >> ingest: start of protected region"),Ue.debug("  > getting other history docs at the same path by any author");const o=await this.getAllDocsAtPath(t.path,[e]);Ue.debug(`  > ...got ${o.length}`),Ue.debug("  > getting prevLatest and prevSameAuthor");const l=o[0]??null,c=o.filter(g=>g.author===t.author)[0]??null;Ue.debug("  > checking if new doc is latest at this path"),o.push(t),o.sort(bs);const f=o[0]===t;if(Ue.debug(`  > ...isLatest: ${f}`),!f&&c!==null){Ue.debug("  > new doc is not latest and there is another one from the same author...");const g=bs(t,c);if(g===rt.GT){Ue.debug("  > new doc is GT prevSameAuthor, so it is obsolete"),a.resolve({kind:"nothing_happened",reason:"obsolete_from_same_author",doc:t});return}if(g===rt.EQ){Ue.debug("  > new doc is EQ prevSameAuthor, so it is redundant (already_had_it)"),a.resolve({kind:"nothing_happened",reason:"already_had_it",doc:t});return}}Ue.debug("  > upserting into ReplicaDriver...");const h=await this.replicaDriver.docDriver.upsert(t);Ue.debug("  > ...done upserting into ReplicaDriver"),Ue.debug("  > ...getting ReplicaDriver maxLocalIndex...");const d=await this.replicaDriver.docDriver.getMaxLocalIndex();Ue.debug(" >> ingest: end of protected region, returning a WriteEvent from the lock");const p={kind:"success",maxLocalIndex:d,doc:h,docIsLatest:f,prevDocFromSameAuthor:c,prevLatestDoc:l,sourceId:n};if(a.resolve(p),await this.eventWriter.write(p),h.deleteAfter){const g=`${h.path}|${h.author}`,C=this.expireEventTimeouts.get(g);C&&clearTimeout(C);const b=h.deleteAfter/1e3-Date.now();this.expireEventTimeouts.set(g,rn(()=>{this.eventWriter.write({kind:"expire",doc:h})},b))}}),a}async overwriteAllDocsByAuthor(e,t){const n=gs(t);if(Ve.debug(`overwriteAllDocsByAuthor("${e.address}")`),this._isClosed)throw new _e;const r=await this.queryDocs({filter:{author:e.address},historyMode:"all"},[n]);Ve.debug(`    ...found ${r.length} docs to overwrite`);let s=0,u=0;for(const a of r){const o=await this.wipeDocument(e,a,gs(t));if(M(o))return o;s+=1}return Ve.debug(`    ...done; ${s} overwritten to be empty; ${u} were already empty; out of total ${r.length} docs`),s}async wipeDocAtPath(e,t,n=mt){const r=await this.getLatestDocAtPath(t,n);return r?this.wipeDocument(e,r,n):new O("No document exists at that path")}async wipeDocument(e,t,n){const r={...t,timestamp:Math.max(t.timestamp+1,Date.now()*1e3),author:e.address},s=await n.wipeDocument(e,r,this.formatsConfig[n.id]);if(M(s))return{kind:"failure",err:s,reason:"invalid_document"};const u=await this.ingest(n,s,"local");if(u.kind==="success"){const a=n.getAttachmentInfo(t);if(!M(a)){const o=await this.replicaDriver.attachmentDriver.erase(n.id,a.hash);M(o)||await this.eventWriter.write({kind:"attachment_prune",format:n.id,hash:a.hash})}}return u}async pruneExpiredDocsAndAttachments(e=Nr){const t=await this.replicaDriver.docDriver.eraseExpiredDocs();for(const u of t)await this.eventWriter.write({kind:"expire",doc:u});const n=yn(e),r={};await this.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"existing",e).pipeTo(new st({write(u){if(u.kind==="existing"){const a=n[u.doc.format],o=a.getAttachmentInfo(u.doc);if(!M(o)){const l=r[a.id];l?l.add(o.hash):r[a.id]=new Set([o.hash])}}}}));const s=await this.replicaDriver.attachmentDriver.filter(r);for(const u of s)await this.eventWriter.write({kind:"attachment_prune",format:u.format,hash:u.hash})}getEventStream(e="*"){return this.eventMultiStream.getReadableStream(e)}getQueryStream(e={},t,n){const r=this.queryDocs.bind(this),s=this.getEventStream.bind(this);return new sn({async start(u){if(t==="existing"||t==="everything"){const l=await r(e,n);for(const c of l)u.enqueue({kind:"existing",doc:c})}if(u.enqueue({kind:"processed_all_existing"}),t==="existing"){u.close();return}const o=s().getReader();for(;;){const{done:l,value:c}=await o.read();if(l)return;if(c.kind==="expire"||c.kind==="success"){if(e.filter&&ki(c.doc,e.filter)){u.enqueue(c);continue}u.enqueue(c);continue}c.kind==="didClose"&&u.close()}}})}onEvent(e){return this.callbackSink.onWrite(e)}async ingestAttachment(e,t,n,r){if(this._isClosed)throw new _e;const s=e.removeExtraFields(t);if(M(s))return Promise.resolve(s);t=s.doc;const u=await e.checkDocumentIsValid(t);if(M(u))return Promise.resolve(u);const a=await this.getAttachment(t,e);if(a&&!M(a))return!1;const o=e.getAttachmentInfo(t);if(M(o))return Promise.resolve(o);const l=await this.replicaDriver.attachmentDriver.stage(t.format,n);return M(l)?l:l.hash!==o.hash?(await l.reject(),new O("Attachment's hash did not match the document's")):l.size!==o.size?(await l.reject(),new O("Attachment's size did not match the document's")):(await l.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:t,hash:l.hash,size:l.size,sourceId:r}),!0)}getAttachment(e,t=mt){if(e.deleteAfter&&e.deleteAfter<Date.now()*1e3)return Promise.resolve(new O("This document has expired"));const n=t.getAttachmentInfo(e);return M(n)?Promise.resolve(n):this.replicaDriver.attachmentDriver.getAttachment(e.format,n.hash)}addAttachments(e,t){const n=wn(t),r={};for(const u of n)r[u.id]=u;const s=e.map(u=>new Promise(a=>{const l=r[u.format].getAttachmentInfo(u);if(!M(l))this.replicaDriver.attachmentDriver.getAttachment(u.format,l.hash).then(c=>{a({...u,attachment:c})});else return a({...u,attachment:l})}));return Promise.all(s)}}class Ef extends Cf{constructor(e){super({driver:e.driver,config:{"es.5":{shareSecret:e.shareSecret}}})}}const Yt=new qe("replica-cache","green");function ws({_localIndex:i}){return i}function ys(i,e){const t=[];for(const n of e)if(!(i.orderBy==="path ASC"&&i.startAfter!==void 0&&i.startAfter.path!==void 0&&n.path<=i.startAfter.path)&&!(i.orderBy==="path DESC"&&i.startAfter!==void 0&&i.startAfter.path!==void 0&&n.path>=i.startAfter.path)&&!(i.orderBy==="localIndex ASC"&&i.startAfter!==void 0&&i.startAfter.localIndex!==void 0&&(n._localIndex||0)<=i.startAfter.localIndex)&&!(i.orderBy==="localIndex DESC"&&i.startAfter!==void 0&&i.startAfter.localIndex!==void 0&&(n._localIndex||0)>=i.startAfter.localIndex)&&(t.push(n),i.limit!==void 0&&t.length>=i.limit))break;return t}class vf{constructor(e,t,n){Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"replica",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"timeToLive",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onCacheUpdatedCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"onFireCacheUpdatedsWrapper",{enumerable:!0,configurable:!0,writable:!0,value:a=>a()}),Object.defineProperty(this,"attachmentCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.replica=e,this.timeToLive=t||1e3,n&&(this.onFireCacheUpdatedsWrapper=n);const r=this.onReplicaEvent.bind(this),s=this.close.bind(this),u=this.isClosed.bind(this);this.replica.getEventStream("*").pipeTo(new st({async write(a){a.kind==="attachment_ingest"||a.kind==="success"||a.kind==="expire"?await r(a):a.kind==="willClose"&&!u()&&await s()}})).catch(()=>{})}async close(){if(this.closed)throw new qt;this.closed=!0,await Promise.all(Array.from(this.docCache.values()).map(e=>e.close())),this.docCache.clear(),this.onCacheUpdatedCallbacks.clear()}isClosed(){return this.closed}getAllDocs(e){return this.queryDocs({historyMode:"all",orderBy:"path DESC"},e)}getLatestDocs(e){return this.queryDocs({historyMode:"latest",orderBy:"path DESC"},e)}getAllDocsAtPath(e,t){return this.queryDocs({historyMode:"all",orderBy:"path DESC",filter:{path:e}},t)}getLatestDocAtPath(e,t){const n=this.queryDocs({historyMode:"latest",orderBy:"path DESC",filter:{path:e}},t?[t]:void 0);if(n.length!==0)return n[0]}queryDocs(e={},t){if(this.closed)throw new qt;if(this.replica.isClosed())throw new _e;const r={...e,formats:(t||Nr).map(p=>p.id)},s=na(r);if(s.willMatch==="nothing")return[];const u=El(s.query),a=this.docCache.get(u);if(a)return Date.now()>a.expires&&this.replica.queryDocs(e,t).then(p=>{const g=p.map(ws).sort(),C=a.docs.map(ws).sort();Bo(g,C)||(this.docCache.set(u,{stream:a.stream,close:a.close,docs:p,expires:Date.now()+this.timeToLive}),Yt.debug("Updated cache because result expired."),this.fireOnCacheUpdateds())}),a.docs;const o=this.replica.getQueryStream(e,"new",t),l=new Jo,c=l.onWrite(p=>{(p.kind==="existing"||p.kind==="success")&&(Yt.debug({doc:p.doc.path,queryString:u}),this._updateCache(u,p.doc))}),f=new st(l),h=new AbortController;o.pipeTo(f,{signal:h.signal});const d=()=>{c()};return this.docCache.set(u,{stream:o,docs:[],expires:Date.now()+this.timeToLive,close:d}),this.replica.queryDocs(r).then(p=>{this.docCache.set(u,{stream:o,close:d,docs:p,expires:Date.now()+this.timeToLive}),Yt.debug("Updated cache with a new entry."),this.fireOnCacheUpdateds()}),[]}queryPaths(e={},t){const n=this.queryDocs(e,t),r=new Set(n.map(({path:s})=>s));return Array.from(r).sort()}queryAuthors(e={},t){const n=this.queryDocs(e,t),r=new Set(n.map(({author:s})=>s));return Array.from(r).sort()}_updateCache(e,t){const n=this.docCache.get(e);if(!n)return;const r=JSON.parse(e),s=()=>{const d=[...n.docs,t];this.docCache.set(e,{...n,docs:ys(r,d)}),this.fireOnCacheUpdateds()},u=({exact:d})=>{const p=n.docs.map(g=>d&&g.path===t.path&&g.author===t.author||!d&&g.path===t.path?t:g);this.docCache.set(e,{...n,docs:ys(r,p)}),this.fireOnCacheUpdateds()},a=n.docs.filter(d=>d.path===t.path),o=n.docs.filter(d=>d.path===t.path&&d.author===t.author);if(a.length===0){(r.filter&&ki(t,r.filter)||!r.filter)&&(Yt.debug("Updated cache after appending a doc to a entry with matching filter."),s());return}if((r.historyMode||"latest")==="all"){if(o.length===0){Yt.debug("Updated cache after appending a version of a doc to a historyMode: all query."),s();return}Yt.debug("Updated cache after replacing a version of a doc in a historyMode: all query."),u({exact:!0});return}const c=a[0],f=t.author!==(c==null?void 0:c.author)||!Cr(t,c),h=t.timestamp>c.timestamp;if(f&&h){Yt.debug("Updated cache after replacing a doc with its latest version."),u({exact:!1});return}}fireOnCacheUpdateds(){this.version++,this.onFireCacheUpdatedsWrapper(()=>{this.onCacheUpdatedCallbacks.forEach(e=>{e()})})}onCacheUpdated(e){if(this.closed)throw new qt;if(this.replica.isClosed())throw new _e;return this.onCacheUpdatedCallbacks.add(e),()=>{this.onCacheUpdatedCallbacks.delete(e)}}set(e,t,n){if(this.closed)throw new qt;return this.replica.set(e,t,n)}overwriteAllDocsByAuthor(e,t){if(this.closed)throw new qt;if(this.replica.isClosed())throw new _e;return this.replica.overwriteAllDocsByAuthor(e,t)}wipeDocAtPath(e,t,n=mt){if(this.closed)throw new qt;return this.replica.wipeDocAtPath(e,t,n)}async onReplicaEvent(e){const t=`${e.doc.path}|${e.doc.author}`,n=this.attachmentCache.get(t);if(!n)return;const r=await this.replica.getAttachment(e.doc,n.format);this.attachmentCache.set(t,{expires:Date.now()+this.timeToLive,attachment:r,format:n.format}),this.fireOnCacheUpdateds()}getAttachment(e,t=mt){if(this.closed)throw new qt;if(this.replica.isClosed())throw new _e;const n=t.getAttachmentInfo(e);if(M(n))return n;const r=`${e.path}|${e.author}`,s=this.attachmentCache.get(r);if(s)return Date.now()>s.expires&&this.replica.getAttachment(e,t).then(u=>{this.attachmentCache.set(r,{expires:Date.now()+this.timeToLive,attachment:u,format:t}),this.fireOnCacheUpdateds()}),e.deleteAfter&&Date.now()*1e3>e.deleteAfter?new O("This document has expired"):s.attachment;this.attachmentCache.set(r,{attachment:void 0,expires:Date.now()+this.timeToLive,format:t}),this.replica.getAttachment(e,t).then(u=>{this.attachmentCache.set(r,{expires:Date.now()+this.timeToLive,attachment:u,format:t}),this.fireOnCacheUpdateds()})}addAttachments(e,t){const n=[],r=yn(t);for(const s of e){const u=this.getAttachment(s,r[s.format]);n.push({...s,attachment:u})}return n}}new qe("storage driver async memory","yellow");async function kf(i){let e=new Uint8Array;return await i.pipeTo(new st({write(t){const n=new Uint8Array(e.length+t.length);n.set(e),n.set(t,e.length),e=n}})),e}async function Ff(i,e,t){const n=Mr(i);if(M(n))return new O("Invalid share address.");for(const a of e)try{new URL(a)}catch{return new O(`Could not parse ${a} as a URL.`)}const r=e.map(a=>`&server=${a}`).join("&");let s="";if(t){const a=await we.checkKeypairIsValid({shareAddress:i,secret:t});if(M(a))return new O(`Supplied the wrong secret for ${i}`);s=`&secret=${t}`}return`earthstar://${i}/?invite${r}${s}&v=2`}async function Bf(i){try{const e=new URL(i),t=Mr(e.hostname);if(M(t))return new O("Invitation did not include a valid share address.");const n=new URLSearchParams(e.search),r=n.get("invite"),s=n.get("v");if(r===null)return new O("Not an invitation URL");if(s===null)return new O("Invitation version not specified.");if(s!=="2")return new O(`Invitation version is ${s}, expected version 2.`);const u=n.getAll("server");for(const o of u)try{new URL(o)}catch{return new O(`Invitation's servers included a malformed URL: ${o}`)}const a=n.get("secret");if(a){const o=await we.checkKeypairIsValid({shareAddress:e.hostname,secret:a});if(M(o))return new O(`Invitation contains the wrong secret for share ${e.hostname}.`)}return{shareAddress:e.hostname,secret:a||void 0,servers:u}}catch{return new O("Could not parse the invitation URL.")}}const Sf="earthstar",dr="current_author",$n="shares",jn="share_secrets",Un="servers";class Tf{constructor(e){Object.defineProperty(this,"namespace",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:localStorage}),Object.defineProperty(this,"authorChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"sharesChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"shareSecretsChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"serversChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),this.namespace=e==null?void 0:e.namespace,e!=null&&e.sessionOnly&&(this.storage=sessionStorage),addEventListener("storage",t=>{switch(t.key){case Me(dr,this.namespace):{this.fireAuthorEvent();break}case Me($n,this.namespace):{this.fireSharesEvent();break}case Me(jn,this.namespace):{this.fireSecretsEvent();break}case Me(Un,this.namespace):{this.fireServersEvent();break}}})}get author(){const e=Me(dr,this.namespace);return pr(this.storage,e,If)||null}set author(e){const t=Me(dr,this.namespace);this.storage.setItem(t,JSON.stringify(e)),this.fireAuthorEvent()}get shares(){const e=Me($n,this.namespace);return pr(this.storage,e,Pf)||[]}addShare(e){if(M(zt(e)))return new O("Not a valid share");const t=Me($n,this.namespace),n=new Set([...this.shares,e]),r=Array.from(n);return this.storage.setItem(t,JSON.stringify(r)),this.fireSharesEvent(),r}removeShare(e){const t=this.shares,n=t.findIndex(s=>s===e);if(n===-1)return new O("That share is not known yet");t.splice(n,1);const r=Me($n,this.namespace);return this.storage.setItem(r,JSON.stringify(t)),this.fireSharesEvent(),t}get shareSecrets(){const e=Me(jn,this.namespace);return pr(this.storage,e,Rf)||{}}async addSecret(e,t){if(!this.shares.find(u=>e===u))return new O("This share is not yet known.");if(M(await we.checkKeypairIsValid({shareAddress:e,secret:t})))return new O("Not the right secret for this share.");const r=Me(jn,this.namespace),s={...this.shareSecrets,[e]:t};return this.storage.setItem(r,JSON.stringify(s)),this.fireSecretsEvent(),s}removeSecret(e){const t=this.shareSecrets;if(!t[e])return new O("Unknown share");const r=Me(jn,this.namespace),s={...t};return delete s[e],this.storage.setItem(r,JSON.stringify(s)),this.fireSecretsEvent(),s}get servers(){const e=Me(Un,this.namespace);return pr(this.storage,e,xf)||[]}addServer(e){try{const t=new URL(e),n=new Set([...this.servers,t.toString()]),r=Array.from(n),s=Me(Un,this.namespace);return this.storage.setItem(s,JSON.stringify(r)),this.fireServersEvent(),r}catch{return new O("Not a valid URL.")}}removeServer(e){try{const t=new URL(e),n=this.servers,r=n.findIndex(u=>u===t.toString());if(r===-1)return new O("That server is not known yet");n.splice(r,1);const s=Me(Un,this.namespace);return this.storage.setItem(s,JSON.stringify(n)),this.fireServersEvent(),n}catch{return new O("Not a valid URL")}}clear(){const e=Me(dr,this.namespace);this.storage.setItem(e,JSON.stringify(null));const t=Me($n,this.namespace);this.storage.setItem(t,JSON.stringify([]));const n=Me(jn,this.namespace);this.storage.setItem(n,JSON.stringify({}));const r=Me(Un,this.namespace);this.storage.setItem(r,JSON.stringify([])),this.fireAuthorEvent(),this.fireSharesEvent(),this.fireSecretsEvent(),this.fireServersEvent()}onAuthorChanged(e){return this.authorChangedCbs.add(e),()=>{this.authorChangedCbs.delete(e)}}onSharesChanged(e){return this.sharesChangedCbs.add(e),()=>{this.sharesChangedCbs.delete(e)}}onShareSecretsChanged(e){return this.shareSecretsChangedCbs.add(e),()=>{this.shareSecretsChangedCbs.delete(e)}}onServersChanged(e){return this.serversChangedCbs.add(e),()=>{this.serversChangedCbs.delete(e)}}getPeer({sync:e,onCreateReplica:t}){const n=new nr,r=this.shares;for(const l of r){const c=t(l,this.shareSecrets[l]);n.addReplica(c)}const s=this.onSharesChanged(async l=>{const c=n.replicas(),f=n.shares();for(const h of c)l.includes(h.share)||(n.removeReplica(h),await h.close(!1));for(const h of l)if(!f.includes(h)){const d=t(h,this.shareSecrets[h]);n.addReplica(d)}}),u=this.onShareSecretsChanged(async l=>{const c=n.shares(),f=Object.keys(l);for(const h of c)if(!f.includes(h)){const d=n.getReplica(h);d&&(n.removeReplica(d),d.close(!1));const p=t(h);n.addReplica(p)}for(const h of f){const d=n.getReplica(h);if(d!=null&&d.formatsConfig["es.5"]&&d.formatsConfig["es.5"].shareSecret)continue;await(d==null?void 0:d.close(!1)),n.removeReplicaByShare(h);const p=t(h,l[h]);n.addReplica(p)}});if(e)for(const l of this.servers)n.sync(l,e==="continuous");const a=this.onServersChanged(l=>{if(e){const c=n.getSyncers();for(const[f,{description:h,syncer:d}]of c)l.includes(h)||d.cancel();for(const f of l)n.sync(f,e==="continuous")}});return{peer:n,unsubscribeFromSettings:()=>{s(),u(),a()}}}fireAuthorEvent(){const e=this.author;for(const t of this.authorChangedCbs)t(e)}fireSharesEvent(){const e=this.shares;for(const t of this.sharesChangedCbs)t(e)}fireSecretsEvent(){const e=this.shareSecrets;for(const t of this.shareSecretsChangedCbs)t(e)}fireServersEvent(){const e=this.servers;for(const t of this.serversChangedCbs)t(e)}async redeemInvitationURL(e){const t=await Bf(e);if(M(t))return t;this.addShare(t.shareAddress);for(const n of t.servers)this.addServer(n);return t.secret&&this.addSecret(t.shareAddress,t.secret),!0}}function Me(i,e){return`${Sf}:${e?`${e}:`:""}${i}`}function pr(i,e,t){const n=i.getItem(e);if(n!==null)try{const r=JSON.parse(n);return t(r)?r:void 0}catch{return}}function ra(i){return!(i==null||typeof i!="object")}function If(i){return!(!ra(i)||Object.keys(i).length!==2||!("address"in i)||!("secret"in i))}function Pf(i){return!(!Array.isArray(i)||i.some(e=>typeof e!="string")||i.some(e=>M(zt(e))))}function Rf(i){if(!ra(i))return!1;for(const e in i){const t=i[e];if(typeof t!="string"||M(we.checkKeypairIsValid({shareAddress:e,secret:t})))return!1}return!0}function xf(i){if(!Array.isArray(i)||i.some(e=>typeof e!="string"))return!1;for(const e of i)try{new URL(e)}catch{return!1}return!0}function Of(i){const e=i-1;return e*e*e+1}function Mf(i,{delay:e=0,duration:t=400,easing:n=Ua}={}){const r=+getComputedStyle(i).opacity;return{delay:e,duration:t,easing:n,css:s=>`opacity: ${s*r}`}}function jt(i,{delay:e=0,duration:t=400,easing:n=Of,x:r=0,y:s=0,opacity:u=0}={}){const a=getComputedStyle(i),o=+a.opacity,l=a.transform==="none"?"":a.transform,c=o*(1-u);return{delay:e,duration:t,easing:n,css:(f,h)=>`
			transform: ${l} translate(${(1-f)*r}px, ${(1-f)*s}px);
			opacity: ${o-c*h}`}}const dn=[];function rr(i,e){return{subscribe:ia(i,e).subscribe}}function ia(i,e=L){let t;const n=new Set;function r(a){if(Y(i,a)&&(i=a,t)){const o=!dn.length;for(const l of n)l[1](),dn.push(l,i);if(o){for(let l=0;l<dn.length;l+=2)dn[l][0](dn[l+1]);dn.length=0}}}function s(a){r(a(i))}function u(a,o=L){const l=[a,o];return n.add(l),n.size===1&&(t=e(r)||L),a(i),()=>{n.delete(l),n.size===0&&(t(),t=null)}}return{set:r,update:s,subscribe:u}}function Nf(i,e,t){const n=!Array.isArray(i),r=n?[i]:i,s=e.length<2;return rr(t,u=>{let a=!1;const o=[];let l=0,c=L;const f=()=>{if(l)return;c();const d=e(n?o[0]:o,u);s?u(d):c=so(d)?d:L},h=r.map((d,p)=>za(d,g=>{o[p]=g,l&=~(1<<p),a&&f()},()=>{l|=1<<p}));return a=!0,f(),function(){Ae(h),c()}})}const it=ia({address:"",secret:""});new qe("storage driver localStorage","gold");const Jt=new qe("replica driver indexeddb","gold");function Lf(i,e){return Fi([i.path,i.timestamp,i.signature],[e.path,e.timestamp,i.signature],["ASC","DESC","ASC"])}function $f(i,e){return Fi([i.path,i.timestamp,i.signature],[e.path,e.timestamp,i.signature],["DESC","DESC","ASC"])}const tt="docs",ft="config";class jf{constructor(e,t){Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:te()}),Object.defineProperty(this,"gotInitialMaxLocalIndex",{enumerable:!0,configurable:!0,writable:!0,value:te()}),Object.defineProperty(this,"localMaxLocalIndex",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1});const n=zt(e);if(M(n))throw n;if(this.share=e,Jt.debug("constructor"),!window.indexedDB)throw new Ge("IndexedDB is not supported by this runtime.");const r=Fo.indexedDB.open(`earthstar:share_docs:${this.share}${t?`/${t}`:""}`,1);r.onerror=()=>{throw Jt.error(`Could not open IndexedDB for ${this.share}'s attachments.`),Jt.error(r.error),new Ge(`Could not open IndexedDB for ${this.share}'s attachments.`)},r.onupgradeneeded=function(){const s=r.result,u=s.createObjectStore(tt,{keyPath:["path","author"]});u.createIndex("comboIndex",["_localIndex","timestamp","path","author"],{unique:!0}),u.createIndex("pathTimestampIndex",["path","timestamp"],{unique:!1}),u.createIndex("pathAuthorIndex",["path","author"],{unique:!0}),u.createIndex("deleteAfterIndex","deleteAfter",{unique:!1}),u.createIndex("localIndexIndex","_localIndex",{unique:!0}),s.createObjectStore(ft,{keyPath:"key"}).createIndex("keyIndex",["key"],{unique:!0})},r.onsuccess=()=>{this.db.resolve(r.result);const u=r.result.transaction([tt],"readonly").objectStore(tt).index("localIndexIndex").openCursor(null,"prev");u.onsuccess=()=>{u.result?this.gotInitialMaxLocalIndex.resolve(u.result.value._localIndex):this.gotInitialMaxLocalIndex.resolve(-1)}},this.gotInitialMaxLocalIndex.then(s=>{this.localMaxLocalIndex=s})}isClosed(){return this.closed}async close(e){if(this.closed)throw new _e;this.closed=!0;const t=te();if(e){const r=(await this.db).transaction([tt,ft],"readwrite"),s=te(),u=te(),a=r.objectStore(tt).clear().onsuccess=()=>{s.resolve()},o=r.objectStore(ft).clear().onsuccess=()=>{u.resolve()};await Promise.all([a,o]),t.resolve()}else t.resolve();return(await this.db).close(),await Go(20),t}async getMaxLocalIndex(){return await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex}async queryDocs(e){var c,f,h,d,p,g,C,b,E,A,F,T,k;const n=(await this.db).transaction([tt],"readonly").objectStore(tt),r=te(),{query:s,willMatch:u}=na(e);if(Jt.debug(`    cleanUpQuery.  willMatch = ${u}`),u==="nothing")return[];if((c=s.filter)!=null&&c.path&&s.historyMode==="latest"){const S=IDBKeyRange.bound([s.filter.path,s.filter.timestampGt||0],[s.filter.path,s.filter.timestampLt||Number.MAX_SAFE_INTEGER]),R=n.index("pathTimestampIndex").openCursor(S,"prev");R.onsuccess=()=>{var N;(N=R.result)!=null&&N.value?r.resolve([R.result.value]):r.resolve([])}}else if((f=s.filter)!=null&&f.path&&s.historyMode==="all"){const S=n.index("pathAuthorIndex"),P=IDBKeyRange.bound([s.filter.path," "],[s.filter.path,"~"]),R=S.getAll(P);R.onsuccess=()=>{R.result?r.resolve(Array.from(R.result)):r.resolve([])}}else{const S=((h=s.startAfter)==null?void 0:h.path)||((d=s.filter)==null?void 0:d.path)||((p=s.filter)==null?void 0:p.pathStartsWith)||" ",P=((g=s.filter)==null?void 0:g.author)||" ",R=((C=s.filter)==null?void 0:C.timestamp)||((b=s.filter)==null?void 0:b.timestampGt)||0,N=((E=s.startAfter)==null?void 0:E.localIndex)||0,q=((A=s.filter)==null?void 0:A.path)||"~",ce=((F=s.filter)==null?void 0:F.author)||"~",se=((T=s.filter)==null?void 0:T.timestamp)||((k=s.filter)==null?void 0:k.timestampLt)||Number.MAX_SAFE_INTEGER,We=Number.MAX_SAFE_INTEGER,De=IDBKeyRange.bound([N,R,S,P],[We,se,q,ce]),de=n.index("comboIndex").getAll(De);de.onsuccess=()=>{de.result?r.resolve(de.result):r.resolve([])}}const a=await r;if(s.historyMode==="latest"){const S=a.splice(0,a.length),P=new Map;for(const R of S){const N=P.get(R.path);(!N||N.timestamp<R.timestamp)&&P.set(R.path,R)}a.push(...P.values())}const o=[];Jt.debug("    filtering docs");const l=Date.now()*1e3;for(const S of a)S.deleteAfter&&S.deleteAfter<l||s.filter&&!ki(S,s.filter)||o.push(S);if(Jt.debug(`    ordering docs: ${s.orderBy}`),s.orderBy==="path ASC")o.sort(Lf);else if(s.orderBy==="path DESC")o.sort($f);else if(s.orderBy==="localIndex ASC")o.sort(Ds("_localIndex","ASC"));else if(s.orderBy==="localIndex DESC")o.sort(Ds("_localIndex","DESC"));else if(s.orderBy)throw new O("unrecognized query orderBy: "+JSON.stringify(s.orderBy));return s.limit!==void 0&&a.length>=s.limit?o.slice(0,s.limit):(Jt.debug(`    queryDocs is done: found ${o.length} docs.`),o)}async upsert(e){const t=await this.db,r=t.transaction([tt],"readwrite").objectStore(tt).index("pathAuthorIndex"),s=te(),u=r.openCursor([e.path,e.author]);if(await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex+=1,e._localIndex=this.localMaxLocalIndex,u.onsuccess=()=>{if(u.result){const f=u.result.update(e);f.onsuccess=()=>{s.resolve(!!f.result)}}else s.resolve(!1)},await s)return e;const l=t.transaction([tt],"readwrite").objectStore(tt).put(e),c=te();return l.onsuccess=()=>{c.resolve()},l.onerror=()=>{throw l.error},await c,e}async eraseExpiredDocs(){const e=[],r=(await this.db).transaction([tt],"readwrite").objectStore(tt).index("deleteAfterIndex"),s=Date.now()*1e3,u=IDBKeyRange.bound(0,s),a=r.openCursor(u),o=te();return a.onsuccess=()=>{var l;if((l=a.result)!=null&&l.value){const c=a.result.value;if(c.deleteAfter!==null&&c.deleteAfter!==void 0){e.push(c);const f=a.result.delete();f.onsuccess=()=>{var h;(h=a.result)==null||h.continue()}}}else o.resolve()},await o,e}async getConfig(e){const n=(await this.db).transaction([ft],"readonly").objectStore(ft),r=te(),s=n.get(e);return s.onsuccess=()=>{var u;r.resolve((u=s.result)==null?void 0:u.value)},r}async setConfig(e,t){const r=(await this.db).transaction([ft],"readwrite").objectStore(ft),s=te(),u=r.put({key:e,value:t});return u.onsuccess=()=>{s.resolve()},s}async listConfigKeys(){const t=(await this.db).transaction([ft],"readonly").objectStore(ft),n=te(),s=t.index("keyIndex").openKeyCursor(),u=[];return s.onsuccess=()=>{s.result?(u.push(s.result.primaryKey),s.result.continue()):n.resolve(u)},n}async deleteConfig(e){const n=(await this.db).transaction([ft],"readwrite").objectStore(ft),r=te(),s=n.index("keyIndex"),u=IDBKeyRange.bound([e],[e]),a=s.openCursor(u);return a.onsuccess=()=>{if(a.result){const o=a.result.delete();o.onsuccess=()=>{r.resolve(!0)}}else r.resolve(!1)},r}}const _s=new qe("replica driver indexeddb","gold"),ht="attachment_staging_index",nt="attachments_index",Ye="attachments_bytes";class Uf{constructor(e,t){if(Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:te()}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.share=e,!window.indexedDB)throw new Ge("IndexedDB is not supported by this runtime.");const n=Fo.indexedDB.open(`earthstar:share_attachments:${this.share}${t?`/${t}`:""}`,1);n.onerror=()=>{throw _s.error(`Could not open IndexedDB for ${this.share}'s attachments.`),_s.error(n.error),new Ge(`Could not open IndexedDB for ${this.share}'s attachments.`)},n.onupgradeneeded=function(){const r=n.result;r.createObjectStore(Ye),r.createObjectStore(nt,{keyPath:"id"}),r.createObjectStore(ht,{keyPath:"id"})},n.onsuccess=()=>{this.db.resolve(n.result)}}getIndexKey(e,t){return`${e}___${t}`}async getAttachment(e,t){if(this.closed)throw new _e;const n=te(),r=this.getIndexKey(e,t),s=await this.db,a=s.transaction([nt],"readonly").objectStore(nt).get(r),o=te();return a.onerror=()=>{o.reject()},a.onsuccess=()=>{a.result===void 0?o.reject():o.resolve(a.result.blobKey)},o.then(l=>{const f=s.transaction([Ye],"readonly").objectStore(Ye).get(l);f.onsuccess=()=>{const h=new fo([f.result]);n.resolve({bytes:async()=>new Uint8Array(await h.arrayBuffer()),stream:()=>Promise.resolve(h.stream())})},f.onerror=()=>{n.resolve(void 0)}}).catch(()=>{n.resolve(void 0)}),n}async erase(e,t){if(this.closed)throw new _e;const n=te(),r=this.getIndexKey(e,t),s=await this.db,a=s.transaction([nt],"readonly").objectStore(nt).get(r),o=te();return a.onerror=()=>{o.reject()},a.onsuccess=()=>{s.transaction([nt],"readwrite").objectStore(nt).delete(r),a.result===void 0?o.reject():o.resolve(a.result.blobKey)},o.then(l=>{const c=s.transaction([Ye],"readwrite").objectStore(Ye).delete(l);c.onsuccess=()=>{n.resolve(!0)},c.onerror=()=>{n.resolve(void 0)}}).catch(()=>{n.resolve(new O("No attachment found"))}),n}async stage(e,t){if(this.closed)throw new _e;const n=await this.db,r=t instanceof Uint8Array?t:await kf(t),s=await we.sha256base32(r),u=this.getIndexKey(e,s),a=`${u}___${Tt()}`,o=n.transaction([Ye,ht],"readwrite"),l=o.objectStore(Ye).put(r,a),c=o.objectStore(ht).put({id:u,blobKey:a}),f=te(),h=te();return l.onsuccess=()=>f.resolve(),c.onsuccess=()=>h.resolve(),await f,await h,{hash:s,size:r.byteLength,reject:async()=>{const d=n.transaction([Ye,ht],"readwrite"),p=d.objectStore(Ye).delete(a),g=d.objectStore(ht).delete(u),C=te(),b=te();p.onsuccess=()=>{C.resolve()},g.onsuccess=()=>{b.resolve()},await Promise.all([C,b])},commit:async()=>{const d=n.transaction([nt,ht],"readwrite"),p=d.objectStore(ht).delete(u),g=d.objectStore(nt).put({id:u,blobKey:a}),C=te(),b=te();p.onsuccess=()=>C.resolve(),g.onsuccess=()=>b.resolve(),await Promise.all([C,b])}}}async wipe(){if(this.closed)throw new _e;const t=(await this.db).transaction([Ye,nt,ht],"readwrite"),n=t.objectStore(Ye).clear(),r=t.objectStore(nt).clear(),s=t.objectStore(ht).clear(),u=te(),a=te(),o=te();n.onsuccess=()=>u.resolve(),r.onsuccess=()=>a.resolve(),s.onsuccess=()=>o.resolve(),await Promise.all([u,a,o])}async clearStaging(){if(this.closed)throw new _e;const t=(await this.db).transaction([Ye,ht]),n=t.objectStore(ht).openCursor(),r=te();return n.onsuccess=()=>{const s=n.result;if(!s){r.resolve();return}const u=s.value.blobKey,a=t.objectStore(Ye).delete(u);s.delete(),a.onsuccess=()=>{s.continue()},a.onerror=()=>{s.continue()}},r}async filter(e){if(this.closed)throw new _e;const n=(await this.db).transaction([Ye,nt],"readwrite"),r=50,s=[],u=[],a=te(),o=(l=null)=>{const c=n.objectStore(nt).getAll(l,r);c.onsuccess=()=>{const f=c.result;for(const h of f){const[d,p]=h.id.split("___");e[d]&&!e[d].has(p)&&(s.push({format:d,hash:p}),u.push(this.erase(d,p)))}if(f.length===r){const h=f[f.length-1],d=IDBKeyRange.lowerBound(h.id,!0);o(d)}else a.resolve()}};return o(),await a,await Promise.all(u),s}isClosed(){return this.closed}async close(e){if(this.closed)throw new _e;e&&await this.wipe(),this.closed=!0,(await this.db).close(),await Go(20)}}class zf{constructor(e,t){Object.defineProperty(this,"docDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachmentDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.docDriver=new jf(e,t),this.attachmentDriver=new Uf(e,t)}}const Yn=rr({shareAddress:"+commons.b7q4gt64yiefosdafnmhvtxz43akzk6gw54aesdahtf4kdgpbyeia",secret:"bigzorlvyjy5fy5a3kglfzcyfzramsic3cihj4rqphmd6x5wo5jcq"});let mi;Yn.subscribe(i=>{mi=i});const Hf=new Ef({driver:new zf(mi.shareAddress),shareSecret:mi.secret}),bt=rr({replica:Hf}),ae=new Tf;function As(i){let e,t,n,r,s;return{c(){e=D("h4"),e.textContent="Your current Identity Keypair:",t=I(),n=D("h4"),r=D("b"),s=$(i[1]),w(n,"class","my-4")},m(u,a){y(u,e,a),y(u,t,a),y(u,n,a),m(n,r),m(r,s)},p(u,a){a&2&&re(s,u[1])},d(u){u&&_(e),u&&_(t),u&&_(n)}}}function Cs(i){let e,t,n;function r(a,o){return a[5]==="ID must be 4 characters long"?Kf:a[5]==="ID must start with a letter"?Vf:a[5]==="ID must not contain special characters"?Wf:qf}let s=r(i),u=s(i);return{c(){e=D("blockquote"),u.c()},m(a,o){y(a,e,o),u.m(e,null),n=!0},p(a,o){s!==(s=r(a))&&(u.d(1),u=s(a),u&&(u.c(),u.m(e,null)))},i(a){n||(vn(()=>{t||(t=Nt(e,jt,{y:200,duration:2e3},!0)),t.run(1)}),n=!0)},o(a){t||(t=Nt(e,jt,{y:200,duration:2e3},!1)),t.run(0),n=!1},d(a){a&&_(e),u.d(),a&&t&&t.end()}}}function qf(i){let e;return{c(){e=$("Press enter to generate a new keypair.")},m(t,n){y(t,e,n)},d(t){t&&_(e)}}}function Wf(i){let e;return{c(){e=D("i"),e.innerHTML=`<strong>Special characters are not allowed.</strong> 
                    <br/>`},m(t,n){y(t,e,n)},d(t){t&&_(e)}}}function Vf(i){let e;return{c(){e=D("i"),e.innerHTML="<strong>A valid alias must begin with a letter.</strong> It needs to be 4 characters long and can only contain letters and numbers."},m(t,n){y(t,e,n)},d(t){t&&_(e)}}}function Kf(i){let e;return{c(){e=D("i"),e.innerHTML="A valid id <strong>needs to be 4 characters long</strong>."},m(t,n){y(t,e,n)},d(t){t&&_(e)}}}function Es(i){let e,t,n;return{c(){e=D("blockquote"),e.innerHTML="<strong>Please upload a valid identity file</strong>"},m(r,s){y(r,e,s),n=!0},i(r){n||(vn(()=>{t||(t=Nt(e,jt,{y:200,duration:2e3},!0)),t.run(1)}),n=!0)},o(r){t||(t=Nt(e,jt,{y:200,duration:2e3},!1)),t.run(0),n=!1},d(r){r&&_(e),r&&t&&t.end()}}}function Qf(i){let e,t,n,r,s,u,a,o,l,c,f,h,d,p,g,C,b,E,A,F,T,k,S,P,R,N,q,ce,se,We,De,pe,de,V,fe,Ie=i[3].address.length!==0&&As(i),be=i[6]&&Cs(i),xe=i[7]===!0&&Es();return{c(){e=D("div"),Ie&&Ie.c(),t=I(),n=D("div"),n.textContent="Your identity is represented by the keypair seen below. It contains your address and secret.",r=I(),s=D("div"),u=D("div"),a=D("b"),a.textContent="Address:",o=I(),l=$(i[2]),c=I(),f=D("br"),h=I(),d=D("b"),d.textContent="Secret:",p=I(),g=$(i[8]),C=I(),b=D("div"),E=$(`You can

        `),A=D("button"),A.textContent="generate another identity",F=$(`

    or customize your alias in the box below.`),T=I(),k=D("div"),S=$(`Your alias is 
    `),P=D("input"),R=I(),N=D("div"),N.textContent="You can download it and reuse it later.",q=I(),ce=D("div"),se=D("button"),se.textContent="Download your identity file",We=I(),De=D("div"),be&&be.c(),pe=I(),xe&&xe.c(),w(s,"class","my-6"),w(A,"class","phase1 svelte-13r1n88"),w(P,"type","text"),w(P,"spellcheck","false"),w(P,"maxlength","4"),w(P,"class","svelte-13r1n88"),w(k,"class","my-4"),w(N,"class","mt-6"),w(se,"class","phase1 svelte-13r1n88"),w(ce,"class","flex items-center align-center flex-col"),w(e,"class","id mt-8 border-2 p-4 svelte-13r1n88")},m(Oe,lt){y(Oe,e,lt),Ie&&Ie.m(e,null),m(e,t),m(e,n),m(e,r),m(e,s),m(s,u),m(u,a),m(u,o),m(u,l),m(u,c),m(u,f),m(u,h),m(u,d),m(u,p),m(u,g),m(e,C),m(e,b),m(b,E),m(b,A),m(b,F),m(e,T),m(e,k),m(k,S),m(k,P),Ze(P,i[4]),m(e,R),m(e,N),m(e,q),m(e,ce),m(ce,se),m(e,We),m(e,De),be&&be.m(De,null),m(De,pe),xe&&xe.m(De,null),de=!0,V||(fe=[j(A,"click",i[10]),j(P,"input",i[11]),j(P,"keypress",i[12]),j(P,"focus",i[13]),j(P,"keypress",i[14]),j(se,"click",i[15])],V=!0)},p(Oe,[lt]){Oe[3].address.length!==0?Ie?Ie.p(Oe,lt):(Ie=As(Oe),Ie.c(),Ie.m(e,t)):Ie&&(Ie.d(1),Ie=null),(!de||lt&4)&&re(l,Oe[2]),(!de||lt&256)&&re(g,Oe[8]),lt&16&&P.value!==Oe[4]&&Ze(P,Oe[4]),Oe[6]?be?(be.p(Oe,lt),lt&64&&v(be,1)):(be=Cs(Oe),be.c(),v(be,1),be.m(De,pe)):be&&(K(),B(be,1,1,()=>{be=null}),Q()),Oe[7]===!0?xe?lt&128&&v(xe,1):(xe=Es(),xe.c(),v(xe,1),xe.m(De,null)):xe&&(K(),B(xe,1,1,()=>{xe=null}),Q())},i(Oe){de||(v(be),v(xe),de=!0)},o(Oe){B(be),B(xe),de=!1},d(Oe){Oe&&_(e),Ie&&Ie.d(),be&&be.d(),xe&&xe.d(),V=!1,Ae(fe)}}}function Gf(i){return/[0-9]/.test(i)}function Yf(i){return/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(i)}function Jf(){let i="",e="abcdefghijklmnopqrstuvwxyz",t=e.length,n="abcdefghijklmnopqrstuvwxyz0123456789",r=n.length;i+=e.charAt(Math.floor(Math.random()*t));for(let s=0;s<3;s++)i+=n.charAt(Math.floor(Math.random()*r));return i}function Zf(i,e,t){let n,r,s,u;Be(i,it,A=>t(3,u=A));let a,o,l=!1,c=!1;function f(){let A=document.createElement("a"),F=new Blob([JSON.stringify(u)],{type:"text/plain"}),T=u.address+".json";A.href=URL.createObjectURL(F),A.download=T,A.style.display="none",document.body.appendChild(A),A.click()}async function h(A){A=="r"&&t(4,a=Jf());let F=a.slice(0,1);if(Gf(F))console.log("firstChar",F),t(5,o="ID must start with a letter");else if(a.length!==4)t(5,o="ID must be 4 characters long");else if(Yf(a))t(5,o="ID must not contain special characters");else{let T=await we.generateAuthorKeypair(a),k=T.address,S=T.secret;it.set({address:k,secret:S}),t(5,o=null),t(6,l=!1),ae.author=T}}gt(async()=>{ae.author?it.set(ae.author):h("r")});const d=()=>h("r");function p(){a=this.value,t(4,a),t(1,s),t(2,n),t(3,u)}const g=()=>{t(6,l=!0)},C=()=>{t(6,l=!0)},b=()=>h(),E=()=>f();return i.$$.update=()=>{i.$$.dirty&8&&t(2,n=u.address),i.$$.dirty&8&&t(8,r=u.secret),i.$$.dirty&4&&t(1,s=n.slice(0,5)),i.$$.dirty&2&&t(4,a=s.slice(1,5))},[h,s,n,u,a,o,l,c,r,f,d,p,g,C,b,E]}class Xf extends J{constructor(e){super(),Z(this,e,Zf,Qf,Y,{generateID:0})}get generateID(){return this.$$.ctx[0]}}let sa;bt.subscribe(i=>{sa=i});const eh=new vf(sa.replica),ua=rr({cache:eh}),oa=rr(new Date,function(e){const t=setInterval(()=>{e(new Date)},1e3);return function(){clearInterval(t)}}),th=new Date,nh=Nf(oa,i=>Math.round((Number(i)-Number(th))/1e3));function vs(i){let e,t,n,r,s,u,a,o=Math.trunc(i[2])+"",l,c,f=i[2]<=1?"minute":"minutes",h,d,p,g,C=Math.trunc((i[3]/1e3-(i[0]*1e3+i[4]))/6e4)+"",b,E,A,F,T,k;return{c(){e=D("div"),t=D("button"),t.textContent="➕Extend",n=I(),r=D("button"),r.textContent="➖Shorten",s=I(),u=D("p"),a=$("last interaction was "),l=$(o),c=I(),h=$(f),d=$(" ago"),p=I(),g=D("p"),b=$(C),E=$(" minutes left until deletion"),A=I(),F=D("button"),F.textContent="🗑️Delete",w(t,"class","svelte-mmxx8s"),w(r,"class","svelte-mmxx8s"),w(u,"class","svelte-mmxx8s"),w(g,"class","svelte-mmxx8s"),w(F,"class","svelte-mmxx8s"),w(e,"id","flexcontainer"),w(e,"class","svelte-mmxx8s")},m(S,P){y(S,e,P),m(e,t),m(e,n),m(e,r),m(e,s),m(e,u),m(u,a),m(u,l),m(u,c),m(u,h),m(u,d),m(e,p),m(e,g),m(g,b),m(g,E),m(e,A),m(e,F),T||(k=[j(t,"click",i[5]),j(r,"click",i[6]),j(F,"click",i[10])],T=!0)},p(S,P){P&4&&o!==(o=Math.trunc(S[2])+"")&&re(l,o),P&4&&f!==(f=S[2]<=1?"minute":"minutes")&&re(h,f),P&9&&C!==(C=Math.trunc((S[3]/1e3-(S[0]*1e3+S[4]))/6e4)+"")&&re(b,C)},d(S){S&&_(e),T=!1,Ae(k)}}}function rh(i){let e,t=i[1]?"⌛Ephemeral":"⏳Ephemeral",n,r,s,u,a,o=i[1]&&vs(i);return{c(){e=D("button"),n=$(t),r=I(),o&&o.c(),s=ie(),w(e,"class","svelte-mmxx8s")},m(l,c){y(l,e,c),m(e,n),y(l,r,c),o&&o.m(l,c),y(l,s,c),u||(a=j(e,"click",i[9]),u=!0)},p(l,[c]){c&2&&t!==(t=l[1]?"⌛Ephemeral":"⏳Ephemeral")&&re(n,t),l[1]?o?o.p(l,c):(o=vs(l),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null)},i:L,o:L,d(l){l&&_(e),l&&_(r),o&&o.d(l),l&&_(s),u=!1,a()}}}function ih(i,e,t){let n,r,s;Be(i,nh,b=>t(0,n=b)),Be(i,it,b=>t(11,r=b)),Be(i,bt,b=>t(12,s=b));const u=Xe();let a=Date.now(),o=!1,l=0,{doc:c}=e,f=c.deleteAfter;async function h(){t(3,f+=36e8);let b=r.address.slice(1,5),E=c.path.split("!"),A=E[0].replace("/documents","/studio")+E[1];const F=await s.replica.set(r,{text:c.text+"<br> lifespan extended by "+b+" on "+new Date().toLocaleString(),path:c.path,deleteAfter:f}),T=await s.replica.set(r,{text:c.text+"<br> lifespan extended by "+b+" on "+new Date().toLocaleString(),path:A});console.log("studioPath",A),console.log("doc.path",c.path),console.log("result c",F),console.log("result s",T)}async function d(){let b=r.address.slice(1,5),E=c.path.split("!"),A=E[0].replace("/documents","/studio")+E[1];console.log("studioPath",A),t(3,f-=864e8);const F=await s.replica.set(r,{text:c.text+"<br> lifespan shortened by "+b+" on "+new Date().toLocaleString(),path:c.path,deleteAfter:f}),T=await s.replica.set(r,{text:c.text+"<br> lifespan shortened by "+b+" on "+new Date().toLocaleString(),path:A});console.log("result c",F),console.log("result s",T)}async function p(){u("update");let b=r.address.slice(1,5),E=c.path.split("!"),A=E[0].replace("/documents","/studio")+E[1];const F=await s.replica.set(r,{path:c.path,deleteAfter:(Date.now()+1e3)*1e3}),T=await s.replica.set(r,{text:c.text+"<br> deleted by "+b+" on "+new Date().toLocaleString(),path:A});console.log("studio 'delete'",T),console.log("result delete",F)}const g=()=>t(1,o=!o),C=()=>p();return i.$$set=b=>{"doc"in b&&t(8,c=b.doc)},i.$$.update=()=>{i.$$.dirty&257&&t(2,l=(n+a/1e3-c.timestamp/1e6)/60)},[n,o,l,f,a,h,d,p,c,g,C]}class sh extends J{constructor(e){super(),Z(this,e,ih,rh,Y,{doc:8})}}function uh(){const i=console.warn;console.warn=e=>{e.includes("unknown prop")||e.includes("unexpected slot")||i(e)},gt(()=>{console.warn=i})}function ks(i,e,t){const n=i.slice();return n[18]=e[t],n}function Fs(i,e,t){const n=i.slice();return n[18]=e[t],n}function Bs(i,e,t){const n=i.slice();return n[10]=e[t],n}function Ss(i,e,t){const n=i.slice();return n[13]=e[t],n[15]=t,n}function Ts(i,e,t){const n=i.slice();return n[16]=e[t],n[15]=t,n}function Is(i,e,t){const n=i.slice();return n[7]=e[t],n}function oh(i){let e,t,n,r;const s=[fh,ch,lh],u=[];function a(o,l){return o[0]==="table"?0:o[0]==="list"?1:2}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),y(o,n,l),r=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(K(),B(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){B(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function ah(i){let e,t,n=i[1],r=[];for(let u=0;u<n.length;u+=1)r[u]=Ns(Is(i,n,u));const s=u=>B(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=ie()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);y(u,e,a),t=!0},p(u,a){if(a&34){n=u[1];let o;for(o=0;o<n.length;o+=1){const l=Is(u,n,o);r[o]?(r[o].p(l,a),v(r[o],1)):(r[o]=Ns(l),r[o].c(),v(r[o],1),r[o].m(e.parentNode,e))}for(K(),o=n.length;o<r.length;o+=1)s(o);Q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)v(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)B(r[a]);t=!1},d(u){on(r,u),u&&_(e)}}}function lh(i){let e,t,n;const r=[i[6]];var s=i[5][i[0]];function u(a){let o={$$slots:{default:[ph]},$$scope:{ctx:a}};for(let l=0;l<r.length;l+=1)o=Lt(o,r[l]);return{props:o}}return s&&(e=ye(s,u(i))),{c(){e&&U(e.$$.fragment),t=ie()},m(a,o){e&&z(e,a,o),y(a,t,o),n=!0},p(a,o){const l=o&64?kn(r,[Fn(a[6])]):{};if(o&8388706&&(l.$$scope={dirty:o,ctx:a}),s!==(s=a[5][a[0]])){if(e){K();const c=e;B(c.$$.fragment,1,0,()=>{H(c,1)}),Q()}s?(e=ye(s,u(a)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else s&&e.$set(l)},i(a){n||(e&&v(e.$$.fragment,a),n=!0)},o(a){e&&B(e.$$.fragment,a),n=!1},d(a){a&&_(t),e&&H(e,a)}}}function ch(i){let e,t,n,r;const s=[gh,mh],u=[];function a(o,l){return o[4]?0:1}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),y(o,n,l),r=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(K(),B(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){B(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function fh(i){let e,t,n;var r=i[5].table;function s(u){return{props:{$$slots:{default:[Fh]},$$scope:{ctx:u}}}}return r&&(e=ye(r,s(i))),{c(){e&&U(e.$$.fragment),t=ie()},m(u,a){e&&z(e,u,a),y(u,t,a),n=!0},p(u,a){const o={};if(a&8388716&&(o.$$scope={dirty:a,ctx:u}),r!==(r=u[5].table)){if(e){K();const l=e;B(l.$$.fragment,1,0,()=>{H(l,1)}),Q()}r?(e=ye(r,s(u)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else r&&e.$set(o)},i(u){n||(e&&v(e.$$.fragment,u),n=!0)},o(u){e&&B(e.$$.fragment,u),n=!1},d(u){u&&_(t),e&&H(e,u)}}}function hh(i){let e=i[6].raw+"",t;return{c(){t=$(e)},m(n,r){y(n,t,r)},p(n,r){r&64&&e!==(e=n[6].raw+"")&&re(t,e)},i:L,o:L,d(n){n&&_(t)}}}function dh(i){let e,t;return e=new ln({props:{tokens:i[1],renderers:i[5]}}),{c(){U(e.$$.fragment)},m(n,r){z(e,n,r),t=!0},p(n,r){const s={};r&2&&(s.tokens=n[1]),r&32&&(s.renderers=n[5]),e.$set(s)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function ph(i){let e,t,n,r;const s=[dh,hh],u=[];function a(o,l){return o[1]?0:1}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),y(o,n,l),r=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(K(),B(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){B(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function mh(i){let e,t,n;const r=[{ordered:i[4]},i[6]];var s=i[5].list;function u(a){let o={$$slots:{default:[bh]},$$scope:{ctx:a}};for(let l=0;l<r.length;l+=1)o=Lt(o,r[l]);return{props:o}}return s&&(e=ye(s,u(i))),{c(){e&&U(e.$$.fragment),t=ie()},m(a,o){e&&z(e,a,o),y(a,t,o),n=!0},p(a,o){const l=o&80?kn(r,[o&16&&{ordered:a[4]},o&64&&Fn(a[6])]):{};if(o&8388704&&(l.$$scope={dirty:o,ctx:a}),s!==(s=a[5].list)){if(e){K();const c=e;B(c.$$.fragment,1,0,()=>{H(c,1)}),Q()}s?(e=ye(s,u(a)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else s&&e.$set(l)},i(a){n||(e&&v(e.$$.fragment,a),n=!0)},o(a){e&&B(e.$$.fragment,a),n=!1},d(a){a&&_(t),e&&H(e,a)}}}function gh(i){let e,t,n;const r=[{ordered:i[4]},i[6]];var s=i[5].list;function u(a){let o={$$slots:{default:[yh]},$$scope:{ctx:a}};for(let l=0;l<r.length;l+=1)o=Lt(o,r[l]);return{props:o}}return s&&(e=ye(s,u(i))),{c(){e&&U(e.$$.fragment),t=ie()},m(a,o){e&&z(e,a,o),y(a,t,o),n=!0},p(a,o){const l=o&80?kn(r,[o&16&&{ordered:a[4]},o&64&&Fn(a[6])]):{};if(o&8388704&&(l.$$scope={dirty:o,ctx:a}),s!==(s=a[5].list)){if(e){K();const c=e;B(c.$$.fragment,1,0,()=>{H(c,1)}),Q()}s?(e=ye(s,u(a)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else s&&e.$set(l)},i(a){n||(e&&v(e.$$.fragment,a),n=!0)},o(a){e&&B(e.$$.fragment,a),n=!1},d(a){a&&_(t),e&&H(e,a)}}}function Dh(i){let e,t,n;return e=new ln({props:{tokens:i[18].tokens,renderers:i[5]}}),{c(){U(e.$$.fragment),t=I()},m(r,s){z(e,r,s),y(r,t,s),n=!0},p(r,s){const u={};s&64&&(u.tokens=r[18].tokens),s&32&&(u.renderers=r[5]),e.$set(u)},i(r){n||(v(e.$$.fragment,r),n=!0)},o(r){B(e.$$.fragment,r),n=!1},d(r){H(e,r),r&&_(t)}}}function Ps(i){let e,t,n;const r=[i[18]];var s=i[5].unorderedlistitem||i[5].listitem;function u(a){let o={$$slots:{default:[Dh]},$$scope:{ctx:a}};for(let l=0;l<r.length;l+=1)o=Lt(o,r[l]);return{props:o}}return s&&(e=ye(s,u(i))),{c(){e&&U(e.$$.fragment),t=ie()},m(a,o){e&&z(e,a,o),y(a,t,o),n=!0},p(a,o){const l=o&64?kn(r,[Fn(a[18])]):{};if(o&8388704&&(l.$$scope={dirty:o,ctx:a}),s!==(s=a[5].unorderedlistitem||a[5].listitem)){if(e){K();const c=e;B(c.$$.fragment,1,0,()=>{H(c,1)}),Q()}s?(e=ye(s,u(a)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else s&&e.$set(l)},i(a){n||(e&&v(e.$$.fragment,a),n=!0)},o(a){e&&B(e.$$.fragment,a),n=!1},d(a){a&&_(t),e&&H(e,a)}}}function bh(i){let e,t,n=i[6].items,r=[];for(let u=0;u<n.length;u+=1)r[u]=Ps(ks(i,n,u));const s=u=>B(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=ie()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);y(u,e,a),t=!0},p(u,a){if(a&96){n=u[6].items;let o;for(o=0;o<n.length;o+=1){const l=ks(u,n,o);r[o]?(r[o].p(l,a),v(r[o],1)):(r[o]=Ps(l),r[o].c(),v(r[o],1),r[o].m(e.parentNode,e))}for(K(),o=n.length;o<r.length;o+=1)s(o);Q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)v(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)B(r[a]);t=!1},d(u){on(r,u),u&&_(e)}}}function wh(i){let e,t,n;return e=new ln({props:{tokens:i[18].tokens,renderers:i[5]}}),{c(){U(e.$$.fragment),t=I()},m(r,s){z(e,r,s),y(r,t,s),n=!0},p(r,s){const u={};s&64&&(u.tokens=r[18].tokens),s&32&&(u.renderers=r[5]),e.$set(u)},i(r){n||(v(e.$$.fragment,r),n=!0)},o(r){B(e.$$.fragment,r),n=!1},d(r){H(e,r),r&&_(t)}}}function Rs(i){let e,t,n;const r=[i[18]];var s=i[5].orderedlistitem||i[5].listitem;function u(a){let o={$$slots:{default:[wh]},$$scope:{ctx:a}};for(let l=0;l<r.length;l+=1)o=Lt(o,r[l]);return{props:o}}return s&&(e=ye(s,u(i))),{c(){e&&U(e.$$.fragment),t=ie()},m(a,o){e&&z(e,a,o),y(a,t,o),n=!0},p(a,o){const l=o&64?kn(r,[Fn(a[18])]):{};if(o&8388704&&(l.$$scope={dirty:o,ctx:a}),s!==(s=a[5].orderedlistitem||a[5].listitem)){if(e){K();const c=e;B(c.$$.fragment,1,0,()=>{H(c,1)}),Q()}s?(e=ye(s,u(a)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else s&&e.$set(l)},i(a){n||(e&&v(e.$$.fragment,a),n=!0)},o(a){e&&B(e.$$.fragment,a),n=!1},d(a){a&&_(t),e&&H(e,a)}}}function yh(i){let e,t,n=i[6].items,r=[];for(let u=0;u<n.length;u+=1)r[u]=Rs(Fs(i,n,u));const s=u=>B(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=ie()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);y(u,e,a),t=!0},p(u,a){if(a&96){n=u[6].items;let o;for(o=0;o<n.length;o+=1){const l=Fs(u,n,o);r[o]?(r[o].p(l,a),v(r[o],1)):(r[o]=Rs(l),r[o].c(),v(r[o],1),r[o].m(e.parentNode,e))}for(K(),o=n.length;o<r.length;o+=1)s(o);Q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)v(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)B(r[a]);t=!1},d(u){on(r,u),u&&_(e)}}}function _h(i){let e,t,n;return e=new ln({props:{tokens:i[16].tokens,renderers:i[5]}}),{c(){U(e.$$.fragment),t=I()},m(r,s){z(e,r,s),y(r,t,s),n=!0},p(r,s){const u={};s&4&&(u.tokens=r[16].tokens),s&32&&(u.renderers=r[5]),e.$set(u)},i(r){n||(v(e.$$.fragment,r),n=!0)},o(r){B(e.$$.fragment,r),n=!1},d(r){H(e,r),r&&_(t)}}}function xs(i){let e,t,n;var r=i[5].tablecell;function s(u){return{props:{header:!0,align:u[6].align[u[15]]||"center",$$slots:{default:[_h]},$$scope:{ctx:u}}}}return r&&(e=ye(r,s(i))),{c(){e&&U(e.$$.fragment),t=ie()},m(u,a){e&&z(e,u,a),y(u,t,a),n=!0},p(u,a){const o={};if(a&64&&(o.align=u[6].align[u[15]]||"center"),a&8388644&&(o.$$scope={dirty:a,ctx:u}),r!==(r=u[5].tablecell)){if(e){K();const l=e;B(l.$$.fragment,1,0,()=>{H(l,1)}),Q()}r?(e=ye(r,s(u)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else r&&e.$set(o)},i(u){n||(e&&v(e.$$.fragment,u),n=!0)},o(u){e&&B(e.$$.fragment,u),n=!1},d(u){u&&_(t),e&&H(e,u)}}}function Ah(i){let e,t,n=i[2],r=[];for(let u=0;u<n.length;u+=1)r[u]=xs(Ts(i,n,u));const s=u=>B(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=ie()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);y(u,e,a),t=!0},p(u,a){if(a&100){n=u[2];let o;for(o=0;o<n.length;o+=1){const l=Ts(u,n,o);r[o]?(r[o].p(l,a),v(r[o],1)):(r[o]=xs(l),r[o].c(),v(r[o],1),r[o].m(e.parentNode,e))}for(K(),o=n.length;o<r.length;o+=1)s(o);Q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)v(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)B(r[a]);t=!1},d(u){on(r,u),u&&_(e)}}}function Ch(i){let e,t,n;var r=i[5].tablerow;function s(u){return{props:{$$slots:{default:[Ah]},$$scope:{ctx:u}}}}return r&&(e=ye(r,s(i))),{c(){e&&U(e.$$.fragment),t=ie()},m(u,a){e&&z(e,u,a),y(u,t,a),n=!0},p(u,a){const o={};if(a&8388708&&(o.$$scope={dirty:a,ctx:u}),r!==(r=u[5].tablerow)){if(e){K();const l=e;B(l.$$.fragment,1,0,()=>{H(l,1)}),Q()}r?(e=ye(r,s(u)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else r&&e.$set(o)},i(u){n||(e&&v(e.$$.fragment,u),n=!0)},o(u){e&&B(e.$$.fragment,u),n=!1},d(u){u&&_(t),e&&H(e,u)}}}function Eh(i){let e,t;return e=new ln({props:{tokens:i[13].tokens,renderers:i[5]}}),{c(){U(e.$$.fragment)},m(n,r){z(e,n,r),t=!0},p(n,r){const s={};r&8&&(s.tokens=n[13].tokens),r&32&&(s.renderers=n[5]),e.$set(s)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Os(i){let e,t,n;var r=i[5].tablecell;function s(u){return{props:{header:!1,align:u[6].align[u[15]]||"center",$$slots:{default:[Eh]},$$scope:{ctx:u}}}}return r&&(e=ye(r,s(i))),{c(){e&&U(e.$$.fragment),t=ie()},m(u,a){e&&z(e,u,a),y(u,t,a),n=!0},p(u,a){const o={};if(a&64&&(o.align=u[6].align[u[15]]||"center"),a&8388648&&(o.$$scope={dirty:a,ctx:u}),r!==(r=u[5].tablecell)){if(e){K();const l=e;B(l.$$.fragment,1,0,()=>{H(l,1)}),Q()}r?(e=ye(r,s(u)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else r&&e.$set(o)},i(u){n||(e&&v(e.$$.fragment,u),n=!0)},o(u){e&&B(e.$$.fragment,u),n=!1},d(u){u&&_(t),e&&H(e,u)}}}function vh(i){let e,t,n=i[10],r=[];for(let u=0;u<n.length;u+=1)r[u]=Os(Ss(i,n,u));const s=u=>B(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=I()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);y(u,e,a),t=!0},p(u,a){if(a&104){n=u[10];let o;for(o=0;o<n.length;o+=1){const l=Ss(u,n,o);r[o]?(r[o].p(l,a),v(r[o],1)):(r[o]=Os(l),r[o].c(),v(r[o],1),r[o].m(e.parentNode,e))}for(K(),o=n.length;o<r.length;o+=1)s(o);Q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)v(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)B(r[a]);t=!1},d(u){on(r,u),u&&_(e)}}}function Ms(i){let e,t,n;var r=i[5].tablerow;function s(u){return{props:{$$slots:{default:[vh]},$$scope:{ctx:u}}}}return r&&(e=ye(r,s(i))),{c(){e&&U(e.$$.fragment),t=ie()},m(u,a){e&&z(e,u,a),y(u,t,a),n=!0},p(u,a){const o={};if(a&8388712&&(o.$$scope={dirty:a,ctx:u}),r!==(r=u[5].tablerow)){if(e){K();const l=e;B(l.$$.fragment,1,0,()=>{H(l,1)}),Q()}r?(e=ye(r,s(u)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else r&&e.$set(o)},i(u){n||(e&&v(e.$$.fragment,u),n=!0)},o(u){e&&B(e.$$.fragment,u),n=!1},d(u){u&&_(t),e&&H(e,u)}}}function kh(i){let e,t,n=i[3],r=[];for(let u=0;u<n.length;u+=1)r[u]=Ms(Bs(i,n,u));const s=u=>B(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=ie()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);y(u,e,a),t=!0},p(u,a){if(a&104){n=u[3];let o;for(o=0;o<n.length;o+=1){const l=Bs(u,n,o);r[o]?(r[o].p(l,a),v(r[o],1)):(r[o]=Ms(l),r[o].c(),v(r[o],1),r[o].m(e.parentNode,e))}for(K(),o=n.length;o<r.length;o+=1)s(o);Q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)v(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)B(r[a]);t=!1},d(u){on(r,u),u&&_(e)}}}function Fh(i){let e,t,n,r,s;var u=i[5].tablehead;function a(c){return{props:{$$slots:{default:[Ch]},$$scope:{ctx:c}}}}u&&(e=ye(u,a(i)));var o=i[5].tablebody;function l(c){return{props:{$$slots:{default:[kh]},$$scope:{ctx:c}}}}return o&&(n=ye(o,l(i))),{c(){e&&U(e.$$.fragment),t=I(),n&&U(n.$$.fragment),r=ie()},m(c,f){e&&z(e,c,f),y(c,t,f),n&&z(n,c,f),y(c,r,f),s=!0},p(c,f){const h={};if(f&8388708&&(h.$$scope={dirty:f,ctx:c}),u!==(u=c[5].tablehead)){if(e){K();const p=e;B(p.$$.fragment,1,0,()=>{H(p,1)}),Q()}u?(e=ye(u,a(c)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else u&&e.$set(h);const d={};if(f&8388712&&(d.$$scope={dirty:f,ctx:c}),o!==(o=c[5].tablebody)){if(n){K();const p=n;B(p.$$.fragment,1,0,()=>{H(p,1)}),Q()}o?(n=ye(o,l(c)),U(n.$$.fragment),v(n.$$.fragment,1),z(n,r.parentNode,r)):n=null}else o&&n.$set(d)},i(c){s||(e&&v(e.$$.fragment,c),n&&v(n.$$.fragment,c),s=!0)},o(c){e&&B(e.$$.fragment,c),n&&B(n.$$.fragment,c),s=!1},d(c){e&&H(e,c),c&&_(t),c&&_(r),n&&H(n,c)}}}function Ns(i){let e,t;const n=[i[7],{renderers:i[5]}];let r={};for(let s=0;s<n.length;s+=1)r=Lt(r,n[s]);return e=new ln({props:r}),{c(){U(e.$$.fragment)},m(s,u){z(e,s,u),t=!0},p(s,u){const a=u&34?kn(n,[u&2&&Fn(s[7]),u&32&&{renderers:s[5]}]):{};e.$set(a)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){B(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Bh(i){let e,t,n,r;const s=[ah,oh],u=[];function a(o,l){return o[0]?o[5][o[0]]?1:-1:0}return~(e=a(i))&&(t=u[e]=s[e](i)),{c(){t&&t.c(),n=ie()},m(o,l){~e&&u[e].m(o,l),y(o,n,l),r=!0},p(o,[l]){let c=e;e=a(o),e===c?~e&&u[e].p(o,l):(t&&(K(),B(u[c],1,1,()=>{u[c]=null}),Q()),~e?(t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),v(t,1),t.m(n.parentNode,n)):t=null)},i(o){r||(v(t),r=!0)},o(o){B(t),r=!1},d(o){~e&&u[e].d(o),o&&_(n)}}}function Sh(i,e,t){const n=["type","tokens","header","rows","ordered","renderers"];let r=Ni(e,n),{type:s=void 0}=e,{tokens:u=void 0}=e,{header:a=void 0}=e,{rows:o=void 0}=e,{ordered:l=!1}=e,{renderers:c}=e;return uh(),i.$$set=f=>{e=Lt(Lt({},e),Ha(f)),t(6,r=Ni(e,n)),"type"in f&&t(0,s=f.type),"tokens"in f&&t(1,u=f.tokens),"header"in f&&t(2,a=f.header),"rows"in f&&t(3,o=f.rows),"ordered"in f&&t(4,l=f.ordered),"renderers"in f&&t(5,c=f.renderers)},[s,u,a,o,l,c,r]}let ln=class extends J{constructor(e){super(),Z(this,e,Sh,Bh,Y,{type:0,tokens:1,header:2,rows:3,ordered:4,renderers:5})}};function aa(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let cn=aa();function Th(i){cn=i}const la=/[&<>"']/,Ih=new RegExp(la.source,"g"),ca=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,Ph=new RegExp(ca.source,"g"),Rh={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ls=i=>Rh[i];function He(i,e){if(e){if(la.test(i))return i.replace(Ih,Ls)}else if(ca.test(i))return i.replace(Ph,Ls);return i}const xh=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function fa(i){return i.replace(xh,(e,t)=>(t=t.toLowerCase(),t==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}const Oh=/(^|[^\[])\^/g;function me(i,e){i=typeof i=="string"?i:i.source,e=e||"";const t={replace:(n,r)=>(r=r.source||r,r=r.replace(Oh,"$1"),i=i.replace(n,r),t),getRegex:()=>new RegExp(i,e)};return t}const Mh=/[^\w:]/g,Nh=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function $s(i,e,t){if(i){let n;try{n=decodeURIComponent(fa(t)).replace(Mh,"").toLowerCase()}catch{return null}if(n.indexOf("javascript:")===0||n.indexOf("vbscript:")===0||n.indexOf("data:")===0)return null}e&&!Nh.test(t)&&(t=Uh(e,t));try{t=encodeURI(t).replace(/%25/g,"%")}catch{return null}return t}const mr={},Lh=/^[^:]+:\/*[^/]*$/,$h=/^([^:]+:)[\s\S]*$/,jh=/^([^:]+:\/*[^/]*)[\s\S]*$/;function Uh(i,e){mr[" "+i]||(Lh.test(i)?mr[" "+i]=i+"/":mr[" "+i]=_r(i,"/",!0)),i=mr[" "+i];const t=i.indexOf(":")===-1;return e.substring(0,2)==="//"?t?e:i.replace($h,"$1")+e:e.charAt(0)==="/"?t?e:i.replace(jh,"$1")+e:i+e}const kr={exec:function(){}};function js(i,e){const t=i.replace(/\|/g,(s,u,a)=>{let o=!1,l=u;for(;--l>=0&&a[l]==="\\";)o=!o;return o?"|":" |"}),n=t.split(/ \|/);let r=0;if(n[0].trim()||n.shift(),n.length>0&&!n[n.length-1].trim()&&n.pop(),n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;r<n.length;r++)n[r]=n[r].trim().replace(/\\\|/g,"|");return n}function _r(i,e,t){const n=i.length;if(n===0)return"";let r=0;for(;r<n;){const s=i.charAt(n-r-1);if(s===e&&!t)r++;else if(s!==e&&t)r++;else break}return i.slice(0,n-r)}function zh(i,e){if(i.indexOf(e[1])===-1)return-1;const t=i.length;let n=0,r=0;for(;r<t;r++)if(i[r]==="\\")r++;else if(i[r]===e[0])n++;else if(i[r]===e[1]&&(n--,n<0))return r;return-1}function Hh(i){i&&i.sanitize&&!i.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function Us(i,e){if(e<1)return"";let t="";for(;e>1;)e&1&&(t+=i),e>>=1,i+=i;return t+i}function zs(i,e,t,n){const r=e.href,s=e.title?He(e.title):null,u=i[1].replace(/\\([\[\]])/g,"$1");if(i[0].charAt(0)!=="!"){n.state.inLink=!0;const a={type:"link",raw:t,href:r,title:s,text:u,tokens:n.inlineTokens(u)};return n.state.inLink=!1,a}return{type:"image",raw:t,href:r,title:s,text:He(u)}}function qh(i,e){const t=i.match(/^(\s+)(?:```)/);if(t===null)return e;const n=t[1];return e.split(`
`).map(r=>{const s=r.match(/^\s+/);if(s===null)return r;const[u]=s;return u.length>=n.length?r.slice(n.length):r}).join(`
`)}class Bi{constructor(e){this.options=e||cn}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const n=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:_r(n,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const n=t[0],r=qh(n,t[3]||"");return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline._escapes,"$1"):t[2],text:r}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(/#$/.test(n)){const r=_r(n,"#");(this.options.pedantic||!r||/ $/.test(r))&&(n=r.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){const n=t[0].replace(/^ *>[ \t]?/gm,""),r=this.lexer.state.top;this.lexer.state.top=!0;const s=this.lexer.blockTokens(n);return this.lexer.state.top=r,{type:"blockquote",raw:t[0],tokens:s,text:n}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n,r,s,u,a,o,l,c,f,h,d,p,g=t[1].trim();const C=g.length>1,b={type:"list",raw:"",ordered:C,start:C?+g.slice(0,-1):"",loose:!1,items:[]};g=C?`\\d{1,9}\\${g.slice(-1)}`:`\\${g}`,this.options.pedantic&&(g=C?g:"[*+-]");const E=new RegExp(`^( {0,3}${g})((?:[	 ][^\\n]*)?(?:\\n|$))`);for(;e&&(p=!1,!(!(t=E.exec(e))||this.rules.block.hr.test(e)));){if(n=t[0],e=e.substring(n.length),c=t[2].split(`
`,1)[0].replace(/^\t+/,F=>" ".repeat(3*F.length)),f=e.split(`
`,1)[0],this.options.pedantic?(u=2,d=c.trimLeft()):(u=t[2].search(/[^ ]/),u=u>4?1:u,d=c.slice(u),u+=t[1].length),o=!1,!c&&/^ *$/.test(f)&&(n+=f+`
`,e=e.substring(f.length+1),p=!0),!p){const F=new RegExp(`^ {0,${Math.min(3,u-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),T=new RegExp(`^ {0,${Math.min(3,u-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),k=new RegExp(`^ {0,${Math.min(3,u-1)}}(?:\`\`\`|~~~)`),S=new RegExp(`^ {0,${Math.min(3,u-1)}}#`);for(;e&&(h=e.split(`
`,1)[0],f=h,this.options.pedantic&&(f=f.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(k.test(f)||S.test(f)||F.test(f)||T.test(e)));){if(f.search(/[^ ]/)>=u||!f.trim())d+=`
`+f.slice(u);else{if(o||c.search(/[^ ]/)>=4||k.test(c)||S.test(c)||T.test(c))break;d+=`
`+f}!o&&!f.trim()&&(o=!0),n+=h+`
`,e=e.substring(h.length+1),c=f.slice(u)}}b.loose||(l?b.loose=!0:/\n *\n *$/.test(n)&&(l=!0)),this.options.gfm&&(r=/^\[[ xX]\] /.exec(d),r&&(s=r[0]!=="[ ] ",d=d.replace(/^\[[ xX]\] +/,""))),b.items.push({type:"list_item",raw:n,task:!!r,checked:s,loose:!1,text:d}),b.raw+=n}b.items[b.items.length-1].raw=n.trimRight(),b.items[b.items.length-1].text=d.trimRight(),b.raw=b.raw.trimRight();const A=b.items.length;for(a=0;a<A;a++)if(this.lexer.state.top=!1,b.items[a].tokens=this.lexer.blockTokens(b.items[a].text,[]),!b.loose){const F=b.items[a].tokens.filter(k=>k.type==="space"),T=F.length>0&&F.some(k=>/\n.*\n/.test(k.raw));b.loose=T}if(b.loose)for(a=0;a<A;a++)b.items[a].loose=!0;return b}}html(e){const t=this.rules.block.html.exec(e);if(t){const n={type:"html",raw:t[0],pre:!this.options.sanitizer&&(t[1]==="pre"||t[1]==="script"||t[1]==="style"),text:t[0]};if(this.options.sanitize){const r=this.options.sanitizer?this.options.sanitizer(t[0]):He(t[0]);n.type="paragraph",n.text=r,n.tokens=this.lexer.inline(r)}return n}}def(e){const t=this.rules.block.def.exec(e);if(t){const n=t[1].toLowerCase().replace(/\s+/g," "),r=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",s=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline._escapes,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:r,title:s}}}table(e){const t=this.rules.block.table.exec(e);if(t){const n={type:"table",header:js(t[1]).map(r=>({text:r})),align:t[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(n.header.length===n.align.length){n.raw=t[0];let r=n.align.length,s,u,a,o;for(s=0;s<r;s++)/^ *-+: *$/.test(n.align[s])?n.align[s]="right":/^ *:-+: *$/.test(n.align[s])?n.align[s]="center":/^ *:-+ *$/.test(n.align[s])?n.align[s]="left":n.align[s]=null;for(r=n.rows.length,s=0;s<r;s++)n.rows[s]=js(n.rows[s],n.header.length).map(l=>({text:l}));for(r=n.header.length,u=0;u<r;u++)n.header[u].tokens=this.lexer.inline(n.header[u].text);for(r=n.rows.length,u=0;u<r;u++)for(o=n.rows[u],a=0;a<o.length;a++)o[a].tokens=this.lexer.inline(o[a].text);return n}}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:He(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(t[0]):He(t[0]):t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const n=t[2].trim();if(!this.options.pedantic&&/^</.test(n)){if(!/>$/.test(n))return;const u=_r(n.slice(0,-1),"\\");if((n.length-u.length)%2===0)return}else{const u=zh(t[2],"()");if(u>-1){const o=(t[0].indexOf("!")===0?5:4)+t[1].length+u;t[2]=t[2].substring(0,u),t[0]=t[0].substring(0,o).trim(),t[3]=""}}let r=t[2],s="";if(this.options.pedantic){const u=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(r);u&&(r=u[1],s=u[3])}else s=t[3]?t[3].slice(1,-1):"";return r=r.trim(),/^</.test(r)&&(this.options.pedantic&&!/>$/.test(n)?r=r.slice(1):r=r.slice(1,-1)),zs(t,{href:r&&r.replace(this.rules.inline._escapes,"$1"),title:s&&s.replace(this.rules.inline._escapes,"$1")},t[0],this.lexer)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){let r=(n[2]||n[1]).replace(/\s+/g," ");if(r=t[r.toLowerCase()],!r){const s=n[0].charAt(0);return{type:"text",raw:s,text:s}}return zs(n,r,n[0],this.lexer)}}emStrong(e,t,n=""){let r=this.rules.inline.emStrong.lDelim.exec(e);if(!r||r[3]&&n.match(/[\p{L}\p{N}]/u))return;const s=r[1]||r[2]||"";if(!s||s&&(n===""||this.rules.inline.punctuation.exec(n))){const u=r[0].length-1;let a,o,l=u,c=0;const f=r[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(f.lastIndex=0,t=t.slice(-1*e.length+u);(r=f.exec(t))!=null;){if(a=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!a)continue;if(o=a.length,r[3]||r[4]){l+=o;continue}else if((r[5]||r[6])&&u%3&&!((u+o)%3)){c+=o;continue}if(l-=o,l>0)continue;o=Math.min(o,o+l+c);const h=e.slice(0,u+r.index+(r[0].length-a.length)+o);if(Math.min(u,o)%2){const p=h.slice(1,-1);return{type:"em",raw:h,text:p,tokens:this.lexer.inlineTokens(p)}}const d=h.slice(2,-2);return{type:"strong",raw:h,text:d,tokens:this.lexer.inlineTokens(d)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(/\n/g," ");const r=/[^ ]/.test(n),s=/^ /.test(n)&&/ $/.test(n);return r&&s&&(n=n.substring(1,n.length-1)),n=He(n,!0),{type:"codespan",raw:t[0],text:n}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e,t){const n=this.rules.inline.autolink.exec(e);if(n){let r,s;return n[2]==="@"?(r=He(this.options.mangle?t(n[1]):n[1]),s="mailto:"+r):(r=He(n[1]),s=r),{type:"link",raw:n[0],text:r,href:s,tokens:[{type:"text",raw:r,text:r}]}}}url(e,t){let n;if(n=this.rules.inline.url.exec(e)){let r,s;if(n[2]==="@")r=He(this.options.mangle?t(n[0]):n[0]),s="mailto:"+r;else{let u;do u=n[0],n[0]=this.rules.inline._backpedal.exec(n[0])[0];while(u!==n[0]);r=He(n[0]),n[1]==="www."?s="http://"+n[0]:s=n[0]}return{type:"link",raw:n[0],text:r,href:s,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(e,t){const n=this.rules.inline.text.exec(e);if(n){let r;return this.lexer.state.inRawBlock?r=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(n[0]):He(n[0]):n[0]:r=He(this.options.smartypants?t(n[0]):n[0]),{type:"text",raw:n[0],text:r}}}}const G={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:kr,lheading:/^((?:.|\n(?!\n))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};G._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;G._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;G.def=me(G.def).replace("label",G._label).replace("title",G._title).getRegex();G.bullet=/(?:[*+-]|\d{1,9}[.)])/;G.listItemStart=me(/^( *)(bull) */).replace("bull",G.bullet).getRegex();G.list=me(G.list).replace(/bull/g,G.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+G.def.source+")").getRegex();G._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";G._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;G.html=me(G.html,"i").replace("comment",G._comment).replace("tag",G._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();G.paragraph=me(G._paragraph).replace("hr",G.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",G._tag).getRegex();G.blockquote=me(G.blockquote).replace("paragraph",G.paragraph).getRegex();G.normal={...G};G.gfm={...G.normal,table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"};G.gfm.table=me(G.gfm.table).replace("hr",G.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",G._tag).getRegex();G.gfm.paragraph=me(G._paragraph).replace("hr",G.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",G.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",G._tag).getRegex();G.pedantic={...G.normal,html:me(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",G._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:kr,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:me(G.normal._paragraph).replace("hr",G.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",G.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()};const W={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:kr,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^(?:[^_*\\]|\\.)*?\_\_(?:[^_*\\]|\\.)*?\*(?:[^_*\\]|\\.)*?(?=\_\_)|(?:[^*\\]|\\.)+(?=[^*])|[punct_](\*+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|(?:[^punct*_\s\\]|\\.)(\*+)(?=[^punct*_\s])/,rDelimUnd:/^(?:[^_*\\]|\\.)*?\*\*(?:[^_*\\]|\\.)*?\_(?:[^_*\\]|\\.)*?(?=\*\*)|(?:[^_\\]|\\.)+(?=[^_])|[punct*](\_+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:kr,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};W._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~";W.punctuation=me(W.punctuation).replace(/punctuation/g,W._punctuation).getRegex();W.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;W.escapedEmSt=/(?:^|[^\\])(?:\\\\)*\\[*_]/g;W._comment=me(G._comment).replace("(?:-->|$)","-->").getRegex();W.emStrong.lDelim=me(W.emStrong.lDelim).replace(/punct/g,W._punctuation).getRegex();W.emStrong.rDelimAst=me(W.emStrong.rDelimAst,"g").replace(/punct/g,W._punctuation).getRegex();W.emStrong.rDelimUnd=me(W.emStrong.rDelimUnd,"g").replace(/punct/g,W._punctuation).getRegex();W._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;W._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;W._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;W.autolink=me(W.autolink).replace("scheme",W._scheme).replace("email",W._email).getRegex();W._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;W.tag=me(W.tag).replace("comment",W._comment).replace("attribute",W._attribute).getRegex();W._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;W._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;W._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;W.link=me(W.link).replace("label",W._label).replace("href",W._href).replace("title",W._title).getRegex();W.reflink=me(W.reflink).replace("label",W._label).replace("ref",G._label).getRegex();W.nolink=me(W.nolink).replace("ref",G._label).getRegex();W.reflinkSearch=me(W.reflinkSearch,"g").replace("reflink",W.reflink).replace("nolink",W.nolink).getRegex();W.normal={...W};W.pedantic={...W.normal,strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:me(/^!?\[(label)\]\((.*?)\)/).replace("label",W._label).getRegex(),reflink:me(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",W._label).getRegex()};W.gfm={...W.normal,escape:me(W.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/};W.gfm.url=me(W.gfm.url,"i").replace("email",W.gfm._extended_email).getRegex();W.breaks={...W.gfm,br:me(W.br).replace("{2,}","*").getRegex(),text:me(W.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()};function Wh(i){return i.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…")}function Hs(i){let e="",t,n;const r=i.length;for(t=0;t<r;t++)n=i.charCodeAt(t),Math.random()>.5&&(n="x"+n.toString(16)),e+="&#"+n+";";return e}class It{constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||cn,this.options.tokenizer=this.options.tokenizer||new Bi,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:G.normal,inline:W.normal};this.options.pedantic?(t.block=G.pedantic,t.inline=W.pedantic):this.options.gfm&&(t.block=G.gfm,this.options.breaks?t.inline=W.breaks:t.inline=W.gfm),this.tokenizer.rules=t}static get rules(){return{block:G,inline:W}}static lex(e,t){return new It(t).lex(e)}static lexInline(e,t){return new It(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);let t;for(;t=this.inlineQueue.shift();)this.inlineTokens(t.src,t.tokens);return this.tokens}blockTokens(e,t=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(a,o,l)=>o+"    ".repeat(l.length));let n,r,s,u;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(a=>(n=a.call({lexer:this},e,t))?(e=e.substring(n.raw.length),t.push(n),!0):!1))){if(n=this.tokenizer.space(e)){e=e.substring(n.raw.length),n.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(n);continue}if(n=this.tokenizer.code(e)){e=e.substring(n.raw.length),r=t[t.length-1],r&&(r.type==="paragraph"||r.type==="text")?(r.raw+=`
`+n.raw,r.text+=`
`+n.text,this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(n);continue}if(n=this.tokenizer.fences(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.heading(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.hr(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.blockquote(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.list(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.html(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.def(e)){e=e.substring(n.raw.length),r=t[t.length-1],r&&(r.type==="paragraph"||r.type==="text")?(r.raw+=`
`+n.raw,r.text+=`
`+n.raw,this.inlineQueue[this.inlineQueue.length-1].src=r.text):this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title});continue}if(n=this.tokenizer.table(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.lheading(e)){e=e.substring(n.raw.length),t.push(n);continue}if(s=e,this.options.extensions&&this.options.extensions.startBlock){let a=1/0;const o=e.slice(1);let l;this.options.extensions.startBlock.forEach(function(c){l=c.call({lexer:this},o),typeof l=="number"&&l>=0&&(a=Math.min(a,l))}),a<1/0&&a>=0&&(s=e.substring(0,a+1))}if(this.state.top&&(n=this.tokenizer.paragraph(s))){r=t[t.length-1],u&&r.type==="paragraph"?(r.raw+=`
`+n.raw,r.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(n),u=s.length!==e.length,e=e.substring(n.raw.length);continue}if(n=this.tokenizer.text(e)){e=e.substring(n.raw.length),r=t[t.length-1],r&&r.type==="text"?(r.raw+=`
`+n.raw,r.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(n);continue}if(e){const a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n,r,s,u=e,a,o,l;if(this.tokens.links){const c=Object.keys(this.tokens.links);if(c.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(u))!=null;)c.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(u=u.slice(0,a.index)+"["+Us("a",a[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.blockSkip.exec(u))!=null;)u=u.slice(0,a.index)+"["+Us("a",a[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(a=this.tokenizer.rules.inline.escapedEmSt.exec(u))!=null;)u=u.slice(0,a.index+a[0].length-2)+"++"+u.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex),this.tokenizer.rules.inline.escapedEmSt.lastIndex--;for(;e;)if(o||(l=""),o=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(c=>(n=c.call({lexer:this},e,t))?(e=e.substring(n.raw.length),t.push(n),!0):!1))){if(n=this.tokenizer.escape(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.tag(e)){e=e.substring(n.raw.length),r=t[t.length-1],r&&n.type==="text"&&r.type==="text"?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if(n=this.tokenizer.link(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(n.raw.length),r=t[t.length-1],r&&n.type==="text"&&r.type==="text"?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if(n=this.tokenizer.emStrong(e,u,l)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.codespan(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.br(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.del(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.autolink(e,Hs)){e=e.substring(n.raw.length),t.push(n);continue}if(!this.state.inLink&&(n=this.tokenizer.url(e,Hs))){e=e.substring(n.raw.length),t.push(n);continue}if(s=e,this.options.extensions&&this.options.extensions.startInline){let c=1/0;const f=e.slice(1);let h;this.options.extensions.startInline.forEach(function(d){h=d.call({lexer:this},f),typeof h=="number"&&h>=0&&(c=Math.min(c,h))}),c<1/0&&c>=0&&(s=e.substring(0,c+1))}if(n=this.tokenizer.inlineText(s,Wh)){e=e.substring(n.raw.length),n.raw.slice(-1)!=="_"&&(l=n.raw.slice(-1)),o=!0,r=t[t.length-1],r&&r.type==="text"?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if(e){const c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return t}}class Si{constructor(e){this.options=e||cn}code(e,t,n){const r=(t||"").match(/\S*/)[0];if(this.options.highlight){const s=this.options.highlight(e,r);s!=null&&s!==e&&(n=!0,e=s)}return e=e.replace(/\n$/,"")+`
`,r?'<pre><code class="'+this.options.langPrefix+He(r)+'">'+(n?e:He(e,!0))+`</code></pre>
`:"<pre><code>"+(n?e:He(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e){return e}heading(e,t,n,r){if(this.options.headerIds){const s=this.options.headerPrefix+r.slug(n);return`<h${t} id="${s}">${e}</h${t}>
`}return`<h${t}>${e}</h${t}>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(e,t,n){const r=t?"ol":"ul",s=t&&n!==1?' start="'+n+'"':"";return"<"+r+s+`>
`+e+"</"+r+`>
`}listitem(e){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(e){return`<p>${e}</p>
`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+t+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,t){const n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(e){return`<del>${e}</del>`}link(e,t,n){if(e=$s(this.options.sanitize,this.options.baseUrl,e),e===null)return n;let r='<a href="'+e+'"';return t&&(r+=' title="'+t+'"'),r+=">"+n+"</a>",r}image(e,t,n){if(e=$s(this.options.sanitize,this.options.baseUrl,e),e===null)return n;let r=`<img src="${e}" alt="${n}"`;return t&&(r+=` title="${t}"`),r+=this.options.xhtml?"/>":">",r}text(e){return e}}class ha{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,n){return""+n}image(e,t,n){return""+n}br(){return""}}class Ti{constructor(){this.seen={}}serialize(e){return e.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(e,t){let n=e,r=0;if(this.seen.hasOwnProperty(n)){r=this.seen[e];do r++,n=e+"-"+r;while(this.seen.hasOwnProperty(n))}return t||(this.seen[e]=r,this.seen[n]=0),n}slug(e,t={}){const n=this.serialize(e);return this.getNextSafeSlug(n,t.dryrun)}}class Ut{constructor(e){this.options=e||cn,this.options.renderer=this.options.renderer||new Si,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new ha,this.slugger=new Ti}static parse(e,t){return new Ut(t).parse(e)}static parseInline(e,t){return new Ut(t).parseInline(e)}parse(e,t=!0){let n="",r,s,u,a,o,l,c,f,h,d,p,g,C,b,E,A,F,T,k;const S=e.length;for(r=0;r<S;r++){if(d=e[r],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[d.type]&&(k=this.options.extensions.renderers[d.type].call({parser:this},d),k!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(d.type))){n+=k||"";continue}switch(d.type){case"space":continue;case"hr":{n+=this.renderer.hr();continue}case"heading":{n+=this.renderer.heading(this.parseInline(d.tokens),d.depth,fa(this.parseInline(d.tokens,this.textRenderer)),this.slugger);continue}case"code":{n+=this.renderer.code(d.text,d.lang,d.escaped);continue}case"table":{for(f="",c="",a=d.header.length,s=0;s<a;s++)c+=this.renderer.tablecell(this.parseInline(d.header[s].tokens),{header:!0,align:d.align[s]});for(f+=this.renderer.tablerow(c),h="",a=d.rows.length,s=0;s<a;s++){for(l=d.rows[s],c="",o=l.length,u=0;u<o;u++)c+=this.renderer.tablecell(this.parseInline(l[u].tokens),{header:!1,align:d.align[u]});h+=this.renderer.tablerow(c)}n+=this.renderer.table(f,h);continue}case"blockquote":{h=this.parse(d.tokens),n+=this.renderer.blockquote(h);continue}case"list":{for(p=d.ordered,g=d.start,C=d.loose,a=d.items.length,h="",s=0;s<a;s++)E=d.items[s],A=E.checked,F=E.task,b="",E.task&&(T=this.renderer.checkbox(A),C?E.tokens.length>0&&E.tokens[0].type==="paragraph"?(E.tokens[0].text=T+" "+E.tokens[0].text,E.tokens[0].tokens&&E.tokens[0].tokens.length>0&&E.tokens[0].tokens[0].type==="text"&&(E.tokens[0].tokens[0].text=T+" "+E.tokens[0].tokens[0].text)):E.tokens.unshift({type:"text",text:T}):b+=T),b+=this.parse(E.tokens,C),h+=this.renderer.listitem(b,F,A);n+=this.renderer.list(h,p,g);continue}case"html":{n+=this.renderer.html(d.text);continue}case"paragraph":{n+=this.renderer.paragraph(this.parseInline(d.tokens));continue}case"text":{for(h=d.tokens?this.parseInline(d.tokens):d.text;r+1<S&&e[r+1].type==="text";)d=e[++r],h+=`
`+(d.tokens?this.parseInline(d.tokens):d.text);n+=t?this.renderer.paragraph(h):h;continue}default:{const P='Token with "'+d.type+'" type was not found.';if(this.options.silent){console.error(P);return}else throw new Error(P)}}}return n}parseInline(e,t){t=t||this.renderer;let n="",r,s,u;const a=e.length;for(r=0;r<a;r++){if(s=e[r],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[s.type]&&(u=this.options.extensions.renderers[s.type].call({parser:this},s),u!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type))){n+=u||"";continue}switch(s.type){case"escape":{n+=t.text(s.text);break}case"html":{n+=t.html(s.text);break}case"link":{n+=t.link(s.href,s.title,this.parseInline(s.tokens,t));break}case"image":{n+=t.image(s.href,s.title,s.text);break}case"strong":{n+=t.strong(this.parseInline(s.tokens,t));break}case"em":{n+=t.em(this.parseInline(s.tokens,t));break}case"codespan":{n+=t.codespan(s.text);break}case"br":{n+=t.br();break}case"del":{n+=t.del(this.parseInline(s.tokens,t));break}case"text":{n+=t.text(s.text);break}default:{const o='Token with "'+s.type+'" type was not found.';if(this.options.silent){console.error(o);return}else throw new Error(o)}}}return n}}class Fr{constructor(e){this.options=e||cn}preprocess(e){return e}postprocess(e){return e}}Mi(Fr,"passThroughHooks",new Set(["preprocess","postprocess"]));function Vh(i,e,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,i){const r="<p>An error occurred:</p><pre>"+He(n.message+"",!0)+"</pre>";if(e)return Promise.resolve(r);if(t){t(null,r);return}return r}if(e)return Promise.reject(n);if(t){t(n);return}throw n}}function da(i,e){return(t,n,r)=>{typeof n=="function"&&(r=n,n=null);const s={...n};n={...X.defaults,...s};const u=Vh(n.silent,n.async,r);if(typeof t>"u"||t===null)return u(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return u(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(Hh(n),n.hooks&&(n.hooks.options=n),r){const a=n.highlight;let o;try{n.hooks&&(t=n.hooks.preprocess(t)),o=i(t,n)}catch(f){return u(f)}const l=function(f){let h;if(!f)try{n.walkTokens&&X.walkTokens(o,n.walkTokens),h=e(o,n),n.hooks&&(h=n.hooks.postprocess(h))}catch(d){f=d}return n.highlight=a,f?u(f):r(null,h)};if(!a||a.length<3||(delete n.highlight,!o.length))return l();let c=0;X.walkTokens(o,function(f){f.type==="code"&&(c++,setTimeout(()=>{a(f.text,f.lang,function(h,d){if(h)return l(h);d!=null&&d!==f.text&&(f.text=d,f.escaped=!0),c--,c===0&&l()})},0))}),c===0&&l();return}if(n.async)return Promise.resolve(n.hooks?n.hooks.preprocess(t):t).then(a=>i(a,n)).then(a=>n.walkTokens?Promise.all(X.walkTokens(a,n.walkTokens)).then(()=>a):a).then(a=>e(a,n)).then(a=>n.hooks?n.hooks.postprocess(a):a).catch(u);try{n.hooks&&(t=n.hooks.preprocess(t));const a=i(t,n);n.walkTokens&&X.walkTokens(a,n.walkTokens);let o=e(a,n);return n.hooks&&(o=n.hooks.postprocess(o)),o}catch(a){return u(a)}}}function X(i,e,t){return da(It.lex,Ut.parse)(i,e,t)}X.options=X.setOptions=function(i){return X.defaults={...X.defaults,...i},Th(X.defaults),X};X.getDefaults=aa;X.defaults=cn;X.use=function(...i){const e=X.defaults.extensions||{renderers:{},childTokens:{}};i.forEach(t=>{const n={...t};if(n.async=X.defaults.async||n.async||!1,t.extensions&&(t.extensions.forEach(r=>{if(!r.name)throw new Error("extension name required");if(r.renderer){const s=e.renderers[r.name];s?e.renderers[r.name]=function(...u){let a=r.renderer.apply(this,u);return a===!1&&(a=s.apply(this,u)),a}:e.renderers[r.name]=r.renderer}if(r.tokenizer){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");e[r.level]?e[r.level].unshift(r.tokenizer):e[r.level]=[r.tokenizer],r.start&&(r.level==="block"?e.startBlock?e.startBlock.push(r.start):e.startBlock=[r.start]:r.level==="inline"&&(e.startInline?e.startInline.push(r.start):e.startInline=[r.start]))}r.childTokens&&(e.childTokens[r.name]=r.childTokens)}),n.extensions=e),t.renderer){const r=X.defaults.renderer||new Si;for(const s in t.renderer){const u=r[s];r[s]=(...a)=>{let o=t.renderer[s].apply(r,a);return o===!1&&(o=u.apply(r,a)),o}}n.renderer=r}if(t.tokenizer){const r=X.defaults.tokenizer||new Bi;for(const s in t.tokenizer){const u=r[s];r[s]=(...a)=>{let o=t.tokenizer[s].apply(r,a);return o===!1&&(o=u.apply(r,a)),o}}n.tokenizer=r}if(t.hooks){const r=X.defaults.hooks||new Fr;for(const s in t.hooks){const u=r[s];Fr.passThroughHooks.has(s)?r[s]=a=>{if(X.defaults.async)return Promise.resolve(t.hooks[s].call(r,a)).then(l=>u.call(r,l));const o=t.hooks[s].call(r,a);return u.call(r,o)}:r[s]=(...a)=>{let o=t.hooks[s].apply(r,a);return o===!1&&(o=u.apply(r,a)),o}}n.hooks=r}if(t.walkTokens){const r=X.defaults.walkTokens;n.walkTokens=function(s){let u=[];return u.push(t.walkTokens.call(this,s)),r&&(u=u.concat(r.call(this,s))),u}}X.setOptions(n)})};X.walkTokens=function(i,e){let t=[];for(const n of i)switch(t=t.concat(e.call(X,n)),n.type){case"table":{for(const r of n.header)t=t.concat(X.walkTokens(r.tokens,e));for(const r of n.rows)for(const s of r)t=t.concat(X.walkTokens(s.tokens,e));break}case"list":{t=t.concat(X.walkTokens(n.items,e));break}default:X.defaults.extensions&&X.defaults.extensions.childTokens&&X.defaults.extensions.childTokens[n.type]?X.defaults.extensions.childTokens[n.type].forEach(function(r){t=t.concat(X.walkTokens(n[r],e))}):n.tokens&&(t=t.concat(X.walkTokens(n.tokens,e)))}return t};X.parseInline=da(It.lexInline,Ut.parseInline);X.Parser=Ut;X.parser=Ut.parse;X.Renderer=Si;X.TextRenderer=ha;X.Lexer=It;X.lexer=It.lex;X.Tokenizer=Bi;X.Slugger=Ti;X.Hooks=Fr;X.parse=X;X.options;X.setOptions;X.use;X.walkTokens;X.parseInline;Ut.parse;It.lex;const pa={};function Kh(i){let e;return{c(){e=$(i[1])},m(t,n){y(t,e,n)},p(t,n){n&2&&re(e,t[1])},i:L,o:L,d(t){t&&_(e)}}}function Qh(i){let e,t;const n=i[5].default,r=Ce(n,i,i[4],null);return{c(){e=D("h6"),r&&r.c(),w(e,"id",i[2])},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&16)&&Ee(r,n,s,s[4],t?ke(n,s[4],u,null):ve(s[4]),null),(!t||u&4)&&w(e,"id",s[2])},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Gh(i){let e,t;const n=i[5].default,r=Ce(n,i,i[4],null);return{c(){e=D("h5"),r&&r.c(),w(e,"id",i[2])},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&16)&&Ee(r,n,s,s[4],t?ke(n,s[4],u,null):ve(s[4]),null),(!t||u&4)&&w(e,"id",s[2])},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Yh(i){let e,t;const n=i[5].default,r=Ce(n,i,i[4],null);return{c(){e=D("h4"),r&&r.c(),w(e,"id",i[2])},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&16)&&Ee(r,n,s,s[4],t?ke(n,s[4],u,null):ve(s[4]),null),(!t||u&4)&&w(e,"id",s[2])},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Jh(i){let e,t;const n=i[5].default,r=Ce(n,i,i[4],null);return{c(){e=D("h3"),r&&r.c(),w(e,"id",i[2])},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&16)&&Ee(r,n,s,s[4],t?ke(n,s[4],u,null):ve(s[4]),null),(!t||u&4)&&w(e,"id",s[2])},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Zh(i){let e,t;const n=i[5].default,r=Ce(n,i,i[4],null);return{c(){e=D("h2"),r&&r.c(),w(e,"id",i[2])},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&16)&&Ee(r,n,s,s[4],t?ke(n,s[4],u,null):ve(s[4]),null),(!t||u&4)&&w(e,"id",s[2])},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Xh(i){let e,t;const n=i[5].default,r=Ce(n,i,i[4],null);return{c(){e=D("h1"),r&&r.c(),w(e,"id",i[2])},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&16)&&Ee(r,n,s,s[4],t?ke(n,s[4],u,null):ve(s[4]),null),(!t||u&4)&&w(e,"id",s[2])},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function ed(i){let e,t,n,r;const s=[Xh,Zh,Jh,Yh,Gh,Qh,Kh],u=[];function a(o,l){return o[0]===1?0:o[0]===2?1:o[0]===3?2:o[0]===4?3:o[0]===5?4:o[0]===6?5:6}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),y(o,n,l),r=!0},p(o,[l]){let c=e;e=a(o),e===c?u[e].p(o,l):(K(),B(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){B(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function td(i,e,t){let n,{$$slots:r={},$$scope:s}=e,{depth:u}=e,{raw:a}=e,{text:o}=e;const{slug:l,getOptions:c}=qa(pa),f=c();return i.$$set=h=>{"depth"in h&&t(0,u=h.depth),"raw"in h&&t(1,a=h.raw),"text"in h&&t(3,o=h.text),"$$scope"in h&&t(4,s=h.$$scope)},i.$$.update=()=>{i.$$.dirty&8&&t(2,n=f.headerIds?f.headerPrefix+l(o):void 0)},[u,a,n,o,s,r]}class nd extends J{constructor(e){super(),Z(this,e,td,ed,Y,{depth:0,raw:1,text:3})}}function rd(i){let e,t;const n=i[1].default,r=Ce(n,i,i[0],null);return{c(){e=D("p"),r&&r.c()},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,s,s[0],t?ke(n,s[0],u,null):ve(s[0]),null)},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function id(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class sd extends J{constructor(e){super(),Z(this,e,id,rd,Y,{})}}function ud(i){let e;const t=i[3].default,n=Ce(t,i,i[2],null);return{c(){n&&n.c()},m(r,s){n&&n.m(r,s),e=!0},p(r,[s]){n&&n.p&&(!e||s&4)&&Ee(n,t,r,r[2],e?ke(t,r[2],s,null):ve(r[2]),null)},i(r){e||(v(n,r),e=!0)},o(r){B(n,r),e=!1},d(r){n&&n.d(r)}}}function od(i,e,t){let{$$slots:n={},$$scope:r}=e,{text:s}=e,{raw:u}=e;return i.$$set=a=>{"text"in a&&t(0,s=a.text),"raw"in a&&t(1,u=a.raw),"$$scope"in a&&t(2,r=a.$$scope)},[s,u,r,n]}class ad extends J{constructor(e){super(),Z(this,e,od,ud,Y,{text:0,raw:1})}}function ld(i){let e,t;return{c(){e=D("img"),$e(e.src,t=i[0])||w(e,"src",t),w(e,"title",i[1]),w(e,"alt",i[2])},m(n,r){y(n,e,r)},p(n,[r]){r&1&&!$e(e.src,t=n[0])&&w(e,"src",t),r&2&&w(e,"title",n[1]),r&4&&w(e,"alt",n[2])},i:L,o:L,d(n){n&&_(e)}}}function cd(i,e,t){let{href:n=""}=e,{title:r=void 0}=e,{text:s=""}=e;return i.$$set=u=>{"href"in u&&t(0,n=u.href),"title"in u&&t(1,r=u.title),"text"in u&&t(2,s=u.text)},[n,r,s]}class fd extends J{constructor(e){super(),Z(this,e,cd,ld,Y,{href:0,title:1,text:2})}}function hd(i){let e,t;const n=i[3].default,r=Ce(n,i,i[2],null);return{c(){e=D("a"),r&&r.c(),w(e,"href",i[0]),w(e,"title",i[1])},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&4)&&Ee(r,n,s,s[2],t?ke(n,s[2],u,null):ve(s[2]),null),(!t||u&1)&&w(e,"href",s[0]),(!t||u&2)&&w(e,"title",s[1])},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function dd(i,e,t){let{$$slots:n={},$$scope:r}=e,{href:s=""}=e,{title:u=void 0}=e;return i.$$set=a=>{"href"in a&&t(0,s=a.href),"title"in a&&t(1,u=a.title),"$$scope"in a&&t(2,r=a.$$scope)},[s,u,r,n]}class pd extends J{constructor(e){super(),Z(this,e,dd,hd,Y,{href:0,title:1})}}function md(i){let e,t;const n=i[1].default,r=Ce(n,i,i[0],null);return{c(){e=D("em"),r&&r.c()},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,s,s[0],t?ke(n,s[0],u,null):ve(s[0]),null)},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function gd(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class Dd extends J{constructor(e){super(),Z(this,e,gd,md,Y,{})}}function bd(i){let e,t;const n=i[1].default,r=Ce(n,i,i[0],null);return{c(){e=D("del"),r&&r.c()},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,s,s[0],t?ke(n,s[0],u,null):ve(s[0]),null)},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function wd(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class yd extends J{constructor(e){super(),Z(this,e,wd,bd,Y,{})}}function _d(i){let e,t=i[0].replace(/`/g,"")+"",n;return{c(){e=D("code"),n=$(t)},m(r,s){y(r,e,s),m(e,n)},p(r,[s]){s&1&&t!==(t=r[0].replace(/`/g,"")+"")&&re(n,t)},i:L,o:L,d(r){r&&_(e)}}}function Ad(i,e,t){let{raw:n}=e;return i.$$set=r=>{"raw"in r&&t(0,n=r.raw)},[n]}class Cd extends J{constructor(e){super(),Z(this,e,Ad,_d,Y,{raw:0})}}function Ed(i){let e,t;const n=i[1].default,r=Ce(n,i,i[0],null);return{c(){e=D("strong"),r&&r.c()},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,s,s[0],t?ke(n,s[0],u,null):ve(s[0]),null)},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function vd(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class kd extends J{constructor(e){super(),Z(this,e,vd,Ed,Y,{})}}function Fd(i){let e,t;const n=i[1].default,r=Ce(n,i,i[0],null);return{c(){e=D("table"),r&&r.c()},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,s,s[0],t?ke(n,s[0],u,null):ve(s[0]),null)},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Bd(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class Sd extends J{constructor(e){super(),Z(this,e,Bd,Fd,Y,{})}}function Td(i){let e,t;const n=i[1].default,r=Ce(n,i,i[0],null);return{c(){e=D("thead"),r&&r.c()},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,s,s[0],t?ke(n,s[0],u,null):ve(s[0]),null)},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Id(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class Pd extends J{constructor(e){super(),Z(this,e,Id,Td,Y,{})}}function Rd(i){let e,t;const n=i[1].default,r=Ce(n,i,i[0],null);return{c(){e=D("tbody"),r&&r.c()},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,s,s[0],t?ke(n,s[0],u,null):ve(s[0]),null)},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function xd(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class Od extends J{constructor(e){super(),Z(this,e,xd,Rd,Y,{})}}function Md(i){let e,t;const n=i[1].default,r=Ce(n,i,i[0],null);return{c(){e=D("tr"),r&&r.c()},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,s,s[0],t?ke(n,s[0],u,null):ve(s[0]),null)},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Nd(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class Ld extends J{constructor(e){super(),Z(this,e,Nd,Md,Y,{})}}function $d(i){let e,t;const n=i[3].default,r=Ce(n,i,i[2],null);return{c(){e=D("td"),r&&r.c(),w(e,"align",i[1])},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&4)&&Ee(r,n,s,s[2],t?ke(n,s[2],u,null):ve(s[2]),null),(!t||u&2)&&w(e,"align",s[1])},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function jd(i){let e,t;const n=i[3].default,r=Ce(n,i,i[2],null);return{c(){e=D("th"),r&&r.c(),w(e,"align",i[1])},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&4)&&Ee(r,n,s,s[2],t?ke(n,s[2],u,null):ve(s[2]),null),(!t||u&2)&&w(e,"align",s[1])},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Ud(i){let e,t,n,r;const s=[jd,$d],u=[];function a(o,l){return o[0]?0:1}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),y(o,n,l),r=!0},p(o,[l]){let c=e;e=a(o),e===c?u[e].p(o,l):(K(),B(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){B(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function zd(i,e,t){let{$$slots:n={},$$scope:r}=e,{header:s}=e,{align:u}=e;return i.$$set=a=>{"header"in a&&t(0,s=a.header),"align"in a&&t(1,u=a.align),"$$scope"in a&&t(2,r=a.$$scope)},[s,u,r,n]}class Hd extends J{constructor(e){super(),Z(this,e,zd,Ud,Y,{header:0,align:1})}}function qd(i){let e,t;const n=i[3].default,r=Ce(n,i,i[2],null);return{c(){e=D("ul"),r&&r.c()},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&4)&&Ee(r,n,s,s[2],t?ke(n,s[2],u,null):ve(s[2]),null)},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Wd(i){let e,t;const n=i[3].default,r=Ce(n,i,i[2],null);return{c(){e=D("ol"),r&&r.c(),w(e,"start",i[1])},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,u){r&&r.p&&(!t||u&4)&&Ee(r,n,s,s[2],t?ke(n,s[2],u,null):ve(s[2]),null),(!t||u&2)&&w(e,"start",s[1])},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Vd(i){let e,t,n,r;const s=[Wd,qd],u=[];function a(o,l){return o[0]?0:1}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),y(o,n,l),r=!0},p(o,[l]){let c=e;e=a(o),e===c?u[e].p(o,l):(K(),B(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){B(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function Kd(i,e,t){let{$$slots:n={},$$scope:r}=e,{ordered:s}=e,{start:u}=e;return i.$$set=a=>{"ordered"in a&&t(0,s=a.ordered),"start"in a&&t(1,u=a.start),"$$scope"in a&&t(2,r=a.$$scope)},[s,u,r,n]}class Qd extends J{constructor(e){super(),Z(this,e,Kd,Vd,Y,{ordered:0,start:1})}}function Gd(i){let e,t;const n=i[1].default,r=Ce(n,i,i[0],null);return{c(){e=D("li"),r&&r.c()},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,s,s[0],t?ke(n,s[0],u,null):ve(s[0]),null)},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function Yd(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class Jd extends J{constructor(e){super(),Z(this,e,Yd,Gd,Y,{})}}function Zd(i){let e;return{c(){e=D("hr")},m(t,n){y(t,e,n)},p:L,i:L,o:L,d(t){t&&_(e)}}}class Xd extends J{constructor(e){super(),Z(this,e,null,Zd,Y,{})}}function e0(i){let e,t;return{c(){e=new uo(!1),t=ie(),e.a=t},m(n,r){e.m(i[0],n,r),y(n,t,r)},p(n,[r]){r&1&&e.p(n[0])},i:L,o:L,d(n){n&&_(t),n&&e.d()}}}function t0(i,e,t){let{text:n}=e;return i.$$set=r=>{"text"in r&&t(0,n=r.text)},[n]}class n0 extends J{constructor(e){super(),Z(this,e,t0,e0,Y,{text:0})}}function r0(i){let e,t;const n=i[1].default,r=Ce(n,i,i[0],null);return{c(){e=D("blockquote"),r&&r.c()},m(s,u){y(s,e,u),r&&r.m(e,null),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,s,s[0],t?ke(n,s[0],u,null):ve(s[0]),null)},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function i0(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class s0 extends J{constructor(e){super(),Z(this,e,i0,r0,Y,{})}}function u0(i){let e,t,n;return{c(){e=D("pre"),t=D("code"),n=$(i[1]),w(e,"class",i[0])},m(r,s){y(r,e,s),m(e,t),m(t,n)},p(r,[s]){s&2&&re(n,r[1]),s&1&&w(e,"class",r[0])},i:L,o:L,d(r){r&&_(e)}}}function o0(i,e,t){let{lang:n}=e,{text:r}=e;return i.$$set=s=>{"lang"in s&&t(0,n=s.lang),"text"in s&&t(1,r=s.text)},[n,r]}class a0 extends J{constructor(e){super(),Z(this,e,o0,u0,Y,{lang:0,text:1})}}function l0(i){let e,t;const n=i[1].default,r=Ce(n,i,i[0],null);return{c(){e=D("br"),r&&r.c()},m(s,u){y(s,e,u),r&&r.m(s,u),t=!0},p(s,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,s,s[0],t?ke(n,s[0],u,null):ve(s[0]),null)},i(s){t||(v(r,s),t=!0)},o(s){B(r,s),t=!1},d(s){s&&_(e),r&&r.d(s)}}}function c0(i,e,t){let{$$slots:n={},$$scope:r}=e;return i.$$set=s=>{"$$scope"in s&&t(0,r=s.$$scope)},[r,n]}class f0 extends J{constructor(e){super(),Z(this,e,c0,l0,Y,{})}}const h0={heading:nd,paragraph:sd,text:ad,image:fd,link:pd,em:Dd,strong:kd,codespan:Cd,del:yd,table:Sd,tablehead:Pd,tablebody:Od,tablerow:Ld,tablecell:Hd,list:Qd,orderedlistitem:null,unorderedlistitem:null,listitem:Jd,hr:Xd,html:n0,blockquote:s0,code:a0,br:f0},d0={baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,xhtml:!1};function p0(i){let e,t;return e=new ln({props:{tokens:i[0],renderers:i[1]}}),{c(){U(e.$$.fragment)},m(n,r){z(e,n,r),t=!0},p(n,[r]){const s={};r&1&&(s.tokens=n[0]),r&2&&(s.renderers=n[1]),e.$set(s)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function m0(i,e,t){let n,r,s,u,{source:a=[]}=e,{renderers:o={}}=e,{options:l={}}=e,{isInline:c=!1}=e;const f=Xe();let h,d,p;return Wa(pa,{slug:g=>r?r.slug(g):"",getOptions:()=>s}),gt(()=>{t(7,p=!0)}),i.$$set=g=>{"source"in g&&t(2,a=g.source),"renderers"in g&&t(3,o=g.renderers),"options"in g&&t(4,l=g.options),"isInline"in g&&t(5,c=g.isInline)},i.$$.update=()=>{i.$$.dirty&4&&t(8,n=Array.isArray(a)),i.$$.dirty&4&&(r=a?new Ti:void 0),i.$$.dirty&16&&t(9,s={...d0,...l}),i.$$.dirty&869&&(n?t(0,h=a):(t(6,d=new It(s)),t(0,h=c?d.inlineTokens(a):d.lex(a)),f("parsed",{tokens:h}))),i.$$.dirty&8&&t(1,u={...h0,...o}),i.$$.dirty&385&&p&&!n&&f("parsed",{tokens:h})},[h,u,a,o,l,c,d,p,n,s]}class g0 extends J{constructor(e){super(),Z(this,e,m0,p0,Y,{source:2,renderers:3,options:4,isInline:5})}}function D0(i){let e,t,n,r={ctx:i,current:null,token:null,hasCatch:!1,pending:B0,then:w0,catch:b0,value:14,blocks:[,,,]};return Li(t=i[3],r),{c(){e=ie(),r.block.c()},m(s,u){y(s,e,u),r.block.m(s,r.anchor=u),r.mount=()=>e.parentNode,r.anchor=e,n=!0},p(s,u){i=s,r.ctx=i,u&8&&t!==(t=i[3])&&Li(t,r)||Va(r,i,u)},i(s){n||(v(r.block),n=!0)},o(s){for(let u=0;u<3;u+=1){const a=r.blocks[u];B(a)}n=!1},d(s){s&&_(e),r.block.d(s),r.token=null,r=null}}}function b0(i){return{c:L,m:L,p:L,i:L,o:L,d:L}}function w0(i){let e,t,n,r=!i[1]&&qs(i),s=i[2]!==void 0&&Ws(i);return{c(){r&&r.c(),e=I(),s&&s.c(),t=ie()},m(u,a){r&&r.m(u,a),y(u,e,a),s&&s.m(u,a),y(u,t,a),n=!0},p(u,a){u[1]?r&&(K(),B(r,1,1,()=>{r=null}),Q()):r?(r.p(u,a),a&2&&v(r,1)):(r=qs(u),r.c(),v(r,1),r.m(e.parentNode,e)),u[2]!==void 0?s?s.p(u,a):(s=Ws(u),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},i(u){n||(v(r),n=!0)},o(u){B(r),n=!1},d(u){r&&r.d(u),u&&_(e),s&&s.d(u),u&&_(t)}}}function qs(i){let e,t,n,r,s;const u=[v0,E0,C0,A0,_0,y0],a=[];function o(l,c){return l[5]=="image"?0:l[5]=="text"?1:l[5]=="audio"?2:l[5]=="markdown"?3:l[5]=="pdf"?4:5}return n=o(i),r=a[n]=u[n](i),{c(){e=D("div"),t=D("div"),r.c(),w(t,"class","my-12 w-full"),w(e,"class","flex flex-col justify-between h-full")},m(l,c){y(l,e,c),m(e,t),a[n].m(t,null),s=!0},p(l,c){let f=n;n=o(l),n===f?a[n].p(l,c):(K(),B(a[f],1,1,()=>{a[f]=null}),Q(),r=a[n],r?r.p(l,c):(r=a[n]=u[n](l),r.c()),v(r,1),r.m(t,null))},i(l){s||(v(r),s=!0)},o(l){B(r),s=!1},d(l){l&&_(e),a[n].d()}}}function y0(i){let e;return{c(){e=D("p"),e.textContent="Attachment type not supported"},m(t,n){y(t,e,n)},p:L,i:L,o:L,d(t){t&&_(e)}}}function _0(i){let e;return{c(){e=D("p"),e.textContent="Pdf preview to come"},m(t,n){y(t,e,n)},p:L,i:L,o:L,d(t){t&&_(e)}}}function A0(i){let e,t,n;return t=new g0({props:{source:i[14]}}),{c(){e=D("div"),U(t.$$.fragment),w(e,"class","markdown svelte-16wmj4w")},m(r,s){y(r,e,s),z(t,e,null),n=!0},p(r,s){const u={};s&8&&(u.source=r[14]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function C0(i){let e,t;return{c(){e=D("audio"),w(e,"class","w-full svelte-16wmj4w"),$e(e.src,t=i[14])||w(e,"src",t),e.controls=!0},m(n,r){y(n,e,r)},p(n,r){r&8&&!$e(e.src,t=n[14])&&w(e,"src",t)},i:L,o:L,d(n){n&&_(e)}}}function E0(i){let e,t=i[14]+"";return{c(){e=D("p"),w(e,"class","my-6 textbox svelte-16wmj4w")},m(n,r){y(n,e,r),e.innerHTML=t},p(n,r){r&8&&t!==(t=n[14]+"")&&(e.innerHTML=t)},i:L,o:L,d(n){n&&_(e)}}}function v0(i){let e,t,n;return{c(){e=D("img"),$e(e.src,t=i[14])||w(e,"src",t),w(e,"alt",n=i[0].text),w(e,"class","svelte-16wmj4w")},m(r,s){y(r,e,s)},p(r,s){s&8&&!$e(e.src,t=r[14])&&w(e,"src",t),s&1&&n!==(n=r[0].text)&&w(e,"alt",n)},i:L,o:L,d(r){r&&_(e)}}}function Ws(i){let e,t,n,r,s,u,a;function o(f,h){return f[4]?k0:F0}let l=o(i),c=l(i);return{c(){e=D("div"),t=D("p"),c.c(),n=I(),r=D("p"),s=D("button"),s.textContent="Download attachment",w(t,"class","mx-4"),w(s,"class","svelte-16wmj4w"),w(r,"class","mx-4"),w(e,"class","flex flex-row mb-4")},m(f,h){y(f,e,h),m(e,t),c.m(t,null),m(e,n),m(e,r),m(r,s),u||(a=j(s,"click",i[10]),u=!0)},p(f,h){l===(l=o(f))&&c?c.p(f,h):(c.d(1),c=l(f),c&&(c.c(),c.m(t,null)))},d(f){f&&_(e),c.d(),u=!1,a()}}}function k0(i){let e,t,n,r;return{c(){e=D("button"),t=$(i[6]),w(e,"class","svelte-16wmj4w")},m(s,u){y(s,e,u),m(e,t),n||(r=j(e,"click",i[9]),n=!0)},p(s,u){u&64&&re(t,s[6])},d(s){s&&_(e),n=!1,r()}}}function F0(i){let e,t,n;return{c(){e=D("button"),e.textContent="Get attachment",w(e,"class","svelte-16wmj4w")},m(r,s){y(r,e,s),t||(n=j(e,"click",function(){so(i[7](i[0]))&&i[7](i[0]).apply(this,arguments)}),t=!0)},p(r,s){i=r},d(r){r&&_(e),t=!1,n()}}}function B0(i){let e;return{c(){e=$("Loading attachment...")},m(t,n){y(t,e,n)},p:L,i:L,o:L,d(t){t&&_(e)}}}function S0(i){let e,t,n=D0(i);return{c(){n&&n.c(),e=ie()},m(r,s){n&&n.m(r,s),y(r,e,s),t=!0},p(r,[s]){n.p(r,s)},i(r){t||(v(n),t=!0)},o(r){B(n),t=!1},d(r){n&&n.d(r),r&&_(e)}}}function T0(i,e,t){let n;Be(i,bt,b=>t(12,n=b));let{doc:r}=e,s,u,a=!1,o=!0,l,c,f="Hide attachment";async function h(b){const E=await n.replica.getAttachment(b);let A=b.path.split(".").pop();if(E!==void 0){const k=await E.bytes();console.log("docdata",k);let S=new Uint8Array(k.length);for(var F=0;F<k.length;F++)S[F]=k[F];if(A==="md")t(5,l="markdown"),t(5,l),t(2,s=String.fromCharCode(...S));else if(A=="mp3"||A=="ogg"||A=="webm")t(5,l="audio"),c="audio/"+A,t(5,l),c=c,console.log("this is audio"),console.log(l,c),t(2,s=URL.createObjectURL(new Blob([S],{type:c})));else if(A==="txt"){t(5,l="text"),t(5,l),console.log(l);var T=new TextDecoder("utf-8");t(2,s=T.decode(Uint8Array.from(S)))}else A=="png"||A=="gif"||A=="jpeg"?(t(5,l="image"),console.log("this is an image"),console.log("fileExtension "+A),c="image/"+A,t(5,l),c=c,t(2,s=URL.createObjectURL(new Blob([S],{type:c})))):(t(5,l="other"),t(5,l),console.log(l),t(2,s=URL.createObjectURL(new Blob([S],{type:"application/octet-stream"}))));return s}}function d(b){t(3,u=h(b)),t(4,a=!0),t(1,o=!1)}function p(){let b=document.createElement("a");console.log(s+"attachmentBytes"),s.split(":")[0]!=="blob"&&(console.log("attachmentBytes is a string"),t(2,s=URL.createObjectURL(new Blob([s]))),console.log("attachmentBytes is now a blob")),console.log("type of attachmentBytes ",typeof s);let E=s,A=r.path.split("/")[r.path.split("/").length-1];console.log("type of file",typeof E),b.href=E,b.download=A.slice(1),b.style.display="none",document.body.appendChild(b),b.click()}const g=()=>t(1,o=!o),C=()=>p();return i.$$set=b=>{"doc"in b&&t(0,r=b.doc)},i.$$.update=()=>{i.$$.dirty&1&&r&&(t(3,u=h(r)),t(4,a=!0),t(1,o=!1)),i.$$.dirty&2&&t(6,f=o?"Show attachment":"Hide attachment"),i.$$.dirty&1&&console.log("selectedDoc in GetAttachment",r)},[r,o,s,u,a,l,f,d,p,g,C]}class ma extends J{constructor(e){super(),Z(this,e,T0,S0,Y,{doc:0})}}function Vs(i,e,t){const n=i.slice();return n[8]=e[t],n}function I0(i){let e;return{c(){e=$("📄Show details")},m(t,n){y(t,e,n)},d(t){t&&_(e)}}}function P0(i){let e;return{c(){e=$("📄Hide details")},m(t,n){y(t,e,n)},d(t){t&&_(e)}}}function Ks(i){let e,t,n,r=i[1]&&Qs(i);function s(l,c){return l[3]!==void 0?x0:R0}let u=s(i),a=u(i),o=(i[2]||!i[1])&&Js(i);return{c(){e=D("div"),r&&r.c(),t=I(),a.c(),n=I(),o&&o.c(),w(e,"class","svelte-u8pn0b")},m(l,c){y(l,e,c),r&&r.m(e,null),m(e,t),a.m(e,null),m(e,n),o&&o.m(e,null)},p(l,c){l[1]?r?r.p(l,c):(r=Qs(l),r.c(),r.m(e,t)):r&&(r.d(1),r=null),u===(u=s(l))&&a?a.p(l,c):(a.d(1),a=u(l),a&&(a.c(),a.m(e,n))),l[2]||!l[1]?o?o.p(l,c):(o=Js(l),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(l){l&&_(e),r&&r.d(),a.d(),o&&o.d()}}}function Qs(i){let e,t,n,r,s,u,a=i[0].path.split(".")[i[0].path.split(".").length-1]+"",o,l,c,f,h,d,p=i[0].attachmentSize/1e3+"",g,C;return{c(){e=D("table"),t=D("tr"),n=D("td"),n.textContent="Attachment type:",r=I(),s=D("td"),u=D("strong"),o=$(a),l=I(),c=D("tr"),f=D("td"),f.textContent="Attachment size:",h=I(),d=D("td"),g=$(p),C=$(" kb"),w(e,"class","my-4 svelte-u8pn0b")},m(b,E){y(b,e,E),m(e,t),m(t,n),m(t,r),m(t,s),m(s,u),m(u,o),m(e,l),m(e,c),m(c,f),m(c,h),m(c,d),m(d,g),m(c,C)},p(b,E){E&1&&a!==(a=b[0].path.split(".")[b[0].path.split(".").length-1]+"")&&re(o,a),E&1&&p!==(p=b[0].attachmentSize/1e3+"")&&re(g,p)},d(b){b&&_(e)}}}function R0(i){let e,t=i[0].text+"";return{c(){e=D("div"),w(e,"class","my-4")},m(n,r){y(n,e,r),e.innerHTML=t},p(n,r){r&1&&t!==(t=n[0].text+"")&&(e.innerHTML=t)},d(n){n&&_(e)}}}function x0(i){let e,t,n,r=i[6]&&Gs(i);return{c(){e=D("div"),t=I(),r&&r.c(),n=ie()},m(s,u){y(s,e,u),e.innerHTML=i[3],y(s,t,u),r&&r.m(s,u),y(s,n,u)},p(s,u){u&8&&(e.innerHTML=s[3]),s[6]?r?r.p(s,u):(r=Gs(s),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},d(s){s&&_(e),s&&_(t),r&&r.d(s),s&&_(n)}}}function Gs(i){let e,t=i[4],n=[];for(let r=0;r<t.length;r+=1)n[r]=Ys(Vs(i,t,r));return{c(){e=D("ul");for(let r=0;r<n.length;r+=1)n[r].c();w(e,"class","svelte-u8pn0b")},m(r,s){y(r,e,s);for(let u=0;u<n.length;u+=1)n[u].m(e,null)},p(r,s){if(s&16){t=r[4];let u;for(u=0;u<t.length;u+=1){const a=Vs(r,t,u);n[u]?n[u].p(a,s):(n[u]=Ys(a),n[u].c(),n[u].m(e,null))}for(;u<n.length;u+=1)n[u].d(1);n.length=t.length}},d(r){r&&_(e),on(n,r)}}}function Ys(i){let e,t,n=i[8]+"",r;return{c(){e=D("li"),t=new uo(!1),r=I(),t.a=r,w(e,"class","svelte-u8pn0b")},m(s,u){y(s,e,u),t.m(n,e),m(e,r)},p(s,u){u&16&&n!==(n=s[8]+"")&&t.p(n)},d(s){s&&_(e)}}}function Js(i){let e,t,n,r,s,u=i[0].path+"",a,o,l,c,f,h=i[0].author+"",d,p,g,C,b,E=i[0].share+"",A,F,T,k,S,P=i[0].timestamp/1e3+"",R;return{c(){e=D("div"),t=D("ul"),n=D("li"),r=D("b"),r.textContent="path:",s=I(),a=$(u),o=I(),l=D("li"),c=D("b"),c.textContent="author:",f=I(),d=$(h),p=I(),g=D("li"),C=D("b"),C.textContent="share:",b=I(),A=$(E),F=I(),T=D("li"),k=D("b"),k.textContent="timestamp:",S=I(),R=$(P),w(n,"class","svelte-u8pn0b"),w(l,"class","svelte-u8pn0b"),w(g,"class","svelte-u8pn0b"),w(T,"class","svelte-u8pn0b"),w(t,"class","svelte-u8pn0b"),w(e,"class","svelte-u8pn0b")},m(N,q){y(N,e,q),m(e,t),m(t,n),m(n,r),m(n,s),m(n,a),m(t,o),m(t,l),m(l,c),m(l,f),m(l,d),m(t,p),m(t,g),m(g,C),m(g,b),m(g,A),m(t,F),m(t,T),m(T,k),m(T,S),m(T,R)},p(N,q){q&1&&u!==(u=N[0].path+"")&&re(a,u),q&1&&h!==(h=N[0].author+"")&&re(d,h),q&1&&E!==(E=N[0].share+"")&&re(A,E),q&1&&P!==(P=N[0].timestamp/1e3+"")&&re(R,P)},d(N){N&&_(e)}}}function O0(i){let e,t,n,r,s;function u(c,f){return c[5]?P0:I0}let a=u(i),o=a(i),l=i[5]&&Ks(i);return{c(){e=D("div"),t=D("button"),o.c(),n=I(),l&&l.c(),w(e,"class","my-4 svelte-u8pn0b")},m(c,f){y(c,e,f),m(e,t),o.m(t,null),m(e,n),l&&l.m(e,null),r||(s=j(t,"click",i[7]),r=!0)},p(c,[f]){a!==(a=u(c))&&(o.d(1),o=a(c),o&&(o.c(),o.m(t,null))),c[5]?l?l.p(c,f):(l=Ks(c),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i:L,o:L,d(c){c&&_(e),o.d(),l&&l.d(),r=!1,s()}}}function M0(i,e,t){let{doc:n}=e,{attachment:r=!0}=e,{isReply:s=!1}=e,u=!1,a,o,l=!1;gt(()=>{t(5,u=!0)});const c=()=>t(5,u=!u);return i.$$set=f=>{"doc"in f&&t(0,n=f.doc),"attachment"in f&&t(1,r=f.attachment),"isReply"in f&&t(2,s=f.isReply)},i.$$.update=()=>{i.$$.dirty&25&&n.text!==void 0&&n.text.includes("<br>")&&(t(4,o=n.text.split("<br>")),t(3,a=o.shift()),t(3,a),t(0,n),t(4,o),t(6,l=!0))},[n,r,s,a,o,u,l,c]}class ga extends J{constructor(e){super(),Z(this,e,M0,O0,Y,{doc:0,attachment:1,isReply:2})}}function Zs(i,e,t){const n=i.slice();return n[1]=e[t],n}function N0(i){let e,t=[],n=new Map,r,s=i[2];const u=a=>a[1].signature;for(let a=0;a<s.length;a+=1){let o=Zs(i,s,a),l=u(o);n.set(l,t[a]=Xs(l,o))}return{c(){e=D("ul");for(let a=0;a<t.length;a+=1)t[a].c();w(e,"class","svelte-197mouz")},m(a,o){y(a,e,o);for(let l=0;l<t.length;l+=1)t[l].m(e,null);r=!0},p(a,o){o&69&&(s=a[2],K(),t=Dt(t,o,u,1,a,s,n,e,Zn,Xs,null,Zs),Q())},i(a){if(!r){for(let o=0;o<s.length;o+=1)v(t[o]);r=!0}},o(a){for(let o=0;o<t.length;o+=1)B(t[o]);r=!1},d(a){a&&_(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function L0(i){let e=i[5]()+"",t;return{c(){t=$(e)},m(n,r){y(n,t,r)},p:L,i:L,o:L,d(n){n&&_(t)}}}function $0(i){let e,t;return e=new wa({props:{isReply:!0,title:i[1].text,doc:i[1],attachment:!1,inStudio:i[0],reply:!1}}),e.$on("click",i[6]),e.$on("update",i[6]),{c(){U(e.$$.fragment)},m(n,r){z(e,n,r),t=!0},p(n,r){const s={};r&4&&(s.title=n[1].text),r&4&&(s.doc=n[1]),r&1&&(s.inStudio=n[0]),e.$set(s)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function j0(i){let e,t;return e=new wa({props:{isReply:!0,title:i[1].text,doc:i[1],attachment:!0,inStudio:i[0],reply:!1}}),e.$on("click",i[6]),e.$on("update",i[6]),{c(){U(e.$$.fragment)},m(n,r){z(e,n,r),t=!0},p(n,r){const s={};r&4&&(s.title=n[1].text),r&4&&(s.doc=n[1]),r&1&&(s.inStudio=n[0]),e.$set(s)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Xs(i,e){let t,n,r,s,u,a,o;const l=[j0,$0],c=[];function f(h,d){return d&4&&(n=null),n==null&&(n=!!h[1].text.includes("replied with voice")),n?0:1}return r=f(e,-1),s=c[r]=l[r](e),{key:i,first:null,c(){t=D("li"),s.c(),u=I(),w(t,"id",a=e[1].textHash),w(t,"class","svelte-197mouz"),this.first=t},m(h,d){y(h,t,d),c[r].m(t,null),m(t,u),o=!0},p(h,d){e=h;let p=r;r=f(e,d),r===p?c[r].p(e,d):(K(),B(c[p],1,1,()=>{c[p]=null}),Q(),s=c[r],s?s.p(e,d):(s=c[r]=l[r](e),s.c()),v(s,1),s.m(t,u)),(!o||d&4&&a!==(a=e[1].textHash))&&w(t,"id",a)},i(h){o||(v(s),o=!0)},o(h){B(s),o=!1},d(h){h&&_(t),c[r].d()}}}function U0(i){return{c:L,m:L,d:L}}function z0(i){let e;return{c(){e=D("p"),e.textContent="There are no replies yet.",w(e,"class","max-content svelte-197mouz")},m(t,n){y(t,e,n)},d(t){t&&_(e)}}}function H0(i){let e,t,n,r,s,u;const a=[L0,N0],o=[];function l(d,p){return d[2]===void 0?0:d[3]?1:-1}~(t=l(i))&&(n=o[t]=a[t](i));function c(d,p){return d[4]?z0:U0}let f=c(i),h=f(i);return{c(){e=D("div"),n&&n.c(),r=I(),s=D("div"),h.c()},m(d,p){y(d,e,p),~t&&o[t].m(e,null),y(d,r,p),y(d,s,p),h.m(s,null),u=!0},p(d,[p]){let g=t;t=l(d),t===g?~t&&o[t].p(d,p):(n&&(K(),B(o[g],1,1,()=>{o[g]=null}),Q()),~t?(n=o[t],n?n.p(d,p):(n=o[t]=a[t](d),n.c()),v(n,1),n.m(e,null)):n=null),f!==(f=c(d))&&(h.d(1),h=f(d),h&&(h.c(),h.m(s,null)))},i(d){u||(v(n),u=!0)},o(d){B(n),u=!1},d(d){d&&_(e),~t&&o[t].d(),d&&_(r),d&&_(s),h.d()}}}function q0(i,e,t){let n;Be(i,ua,f=>t(7,n=f));let{doc:r}=e,{inStudio:s}=e,u=[],a=!0,o=!1;const l=async()=>{let f=r.path.split("!");t(2,u=await n.cache.queryDocs({filter:{pathStartsWith:f[0]}})),t(2,u=u.filter(h=>h.path.split("/").length>6)),t(3,a=!0)};n.cache.onCacheUpdated(()=>{l(),t(2,u)});function c(){setTimeout(()=>{l()},1e3)}return gt(()=>{l()}),i.$$set=f=>{"doc"in f&&t(1,r=f.doc),"inStudio"in f&&t(0,s=f.inStudio)},i.$$.update=()=>{i.$$.dirty&4&&t(2,u),i.$$.dirty&4&&(u.length>=1?(t(3,a=!0),t(4,o=!1)):t(4,o=!0))},[s,r,u,a,o,l,c]}class W0 extends J{constructor(e){super(),Z(this,e,q0,H0,Y,{doc:1,inStudio:0})}}function V0(i){let e,t,n,r,s;function u(l,c){return l[0]?G0:Q0}let a=u(i),o=a(i);return{c(){e=D("div"),t=D("div"),n=D("button"),o.c(),w(n,"class","phase1"),w(t,"class","svelte-iaxmoi"),w(e,"class","svelte-iaxmoi")},m(l,c){y(l,e,c),m(e,t),m(t,n),o.m(n,null),r||(s=[j(n,"click",i[8]),j(n,"keypress",i[9])],r=!0)},p(l,c){a!==(a=u(l))&&(o.d(1),o=a(l),o&&(o.c(),o.m(n,null)))},d(l){l&&_(e),o.d(),r=!1,Ae(s)}}}function K0(i){let e,t,n,r,s,u,a,o,l,c,f,h,d;return{c(){e=D("div"),t=D("h4"),t.textContent="Review your recording:",n=I(),r=D("audio"),s=D("source"),a=$(`
      Your browser does not support the audio element.`),o=I(),l=D("button"),l.textContent="Record again",c=I(),f=D("button"),f.textContent="Upload",$e(s.src,u=i[1])||w(s,"src",u),w(s,"type","audio/ogg"),r.controls=!0,w(e,"class","svelte-iaxmoi")},m(p,g){y(p,e,g),m(e,t),m(e,n),m(e,r),m(r,s),m(r,a),m(e,o),m(e,l),m(e,c),m(e,f),h||(d=[j(l,"click",i[4]),j(f,"click",i[3])],h=!0)},p(p,g){g&2&&!$e(s.src,u=p[1])&&w(s,"src",u)},d(p){p&&_(e),h=!1,Ae(d)}}}function Q0(i){let e;return{c(){e=$("Record audio")},m(t,n){y(t,e,n)},d(t){t&&_(e)}}}function G0(i){let e;return{c(){e=$("Stop recording")},m(t,n){y(t,e,n)},d(t){t&&_(e)}}}function Y0(i){let e;function t(s,u){return s[1]?K0:V0}let n=t(i),r=n(i);return{c(){r.c(),e=ie()},m(s,u){r.m(s,u),y(s,e,u)},p(s,[u]){n===(n=t(s))&&r?r.p(s,u):(r.d(1),r=n(s),r&&(r.c(),r.m(e.parentNode,e)))},i:L,o:L,d(s){r.d(s),s&&_(e)}}}let J0=null,gr=null,Dr=null,br=null,eu=null;function Z0(i){return new Promise((e,t)=>{let n=new FileReader;n.addEventListener("loadend",r=>e(r.target.result)),n.addEventListener("error",t),n.readAsDataURL(i)})}function X0(i,e,t){let n,r;Be(i,it,T=>t(15,n=T)),Be(i,bt,T=>t(16,r=T));const s=Xe();let u,a,o=[],l=null,c=!1,f=null,h=null,{xy:d=void 0}=e,{inStudio:p}=e,{doc:g=void 0}=e;async function C(){if(c)l.stop(),console.log("mediaRecorder",l),console.log("mediaRecorder mime",l.mimeType),t(0,c=!1),l.ondataavailable=T=>o.push(T.data),l.onstop=async function(T){new Date().toLocaleString();let k=l.mimeType;k===""&&(k="audio/ogg; codecs=opus"),k.split(";")[0].split("/")[1],h=new Blob(o,{type:k}),t(1,f=URL.createObjectURL(h)),console.log("blob",h)};else{const T=await navigator.mediaDevices.getUserMedia({audio:!0});l=new MediaRecorder(T),l.start(),console.log("mediaRecorder",l),console.log("mediaRecorder mime",l.mimeType),console.log("recording"),t(0,c=!0)}}async function b(){const T=new Uint8Array(await Z0(h));console.log("mime",J0);let k=n.address.slice(1,5);if(d!==void 0&&d!=="reply")p||(u=await r.replica.set(n,{path:`/documents/${d[0]}/${d[1]}/${Dr}/!voice-note-by-${k}.${gr}`,text:"Voice note shared by "+k+" on "+br,attachment:T,deleteAfter:eu})),a=await r.replica.set(n,{path:`/studio/${d[0]}/${d[1]}/${Dr}/voice-note-by-${k}.${gr}`,text:"Voice note shared by "+k+" on "+br,attachment:T}),s("upload"),console.log("Upload Result: ",u),console.log("Studio Result: ",a),o=[];else if(d=="reply"){let S=g.path.split("!"),P=S[0].replace("/documents","/studio");const R=await r.replica.set(n,{text:k+" replied with voice<br>Shared on "+br,path:S[0]+Dr+"/!reply-by-"+k+"."+gr,deleteAfter:eu,attachment:T}),N=await r.replica.set(n,{text:k+" replied with voice<br>Shared on "+br,path:P+Dr+"/reply-by-"+k+"."+gr,attachment:T});return console.log("result ",R),console.log("studio ",N),s("success"),R}}function E(){t(1,f=null),o=[]}const A=()=>{C()},F=()=>{C()};return i.$$set=T=>{"xy"in T&&t(5,d=T.xy),"inStudio"in T&&t(6,p=T.inStudio),"doc"in T&&t(7,g=T.doc)},[c,f,C,b,E,d,p,g,A,F]}class Da extends J{constructor(e){super(),Z(this,e,X0,Y0,Y,{xy:5,inStudio:6,doc:7})}}function tu(i){let e,t,n,r,s,u,a,o,l;return{c(){e=D("p"),t=D("input"),n=I(),r=D("p"),s=D("button"),u=$("Send Reply"),Re(t,"width",i[5]+"ch"),w(t,"class","svelte-19ki2og"),s.disabled=a=ru(i[2])},m(c,f){y(c,e,f),m(e,t),Ze(t,i[2]),y(c,n,f),y(c,r,f),m(r,s),m(s,u),o||(l=[j(t,"input",i[10]),j(s,"click",i[7])],o=!0)},p(c,f){f&32&&Re(t,"width",c[5]+"ch"),f&4&&t.value!==c[2]&&Ze(t,c[2]),f&4&&a!==(a=ru(c[2]))&&(s.disabled=a)},d(c){c&&_(e),c&&_(n),c&&_(r),o=!1,Ae(l)}}}function nu(i){let e,t,n;return t=new Da({props:{xy:"reply",doc:i[0],inStudio:i[1]}}),{c(){e=D("p"),U(t.$$.fragment)},m(r,s){y(r,e,s),z(t,e,null),n=!0},p(r,s){const u={};s&1&&(u.doc=r[0]),s&2&&(u.inStudio=r[1]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function ep(i){let e;return{c(){e=D("span"),e.textContent=`${i[6].kind}`},m(t,n){y(t,e,n)},p:L,d(t){t&&_(e)}}}function tp(i){let e,t,n,r,s,u,a,o,l,c,f,h=i[3]&&tu(i),d=i[4]&&nu(i),p=i[6]&&ep(i);return{c(){e=D("div"),t=D("button"),t.textContent="📝Text reply",n=I(),r=D("button"),r.textContent="🔊Voice reply",s=I(),h&&h.c(),u=I(),d&&d.c(),a=I(),o=D("p"),p&&p.c()},m(g,C){y(g,e,C),m(e,t),m(e,n),m(e,r),m(e,s),h&&h.m(e,null),m(e,u),d&&d.m(e,null),m(e,a),m(e,o),p&&p.m(o,null),l=!0,c||(f=[j(t,"click",i[8]),j(r,"click",i[9])],c=!0)},p(g,[C]){g[3]?h?h.p(g,C):(h=tu(g),h.c(),h.m(e,u)):h&&(h.d(1),h=null),g[4]?d?(d.p(g,C),C&16&&v(d,1)):(d=nu(g),d.c(),v(d,1),d.m(e,a)):d&&(K(),B(d,1,1,()=>{d=null}),Q()),g[6]&&p.p(g,C)},i(g){l||(v(d),l=!0)},o(g){B(d),l=!1},d(g){g&&_(e),h&&h.d(),d&&d.d(),p&&p.d(),c=!1,Ae(f)}}}function ru(i){return i=="Reply here"}function np(i,e,t){let n,r;Be(i,it,E=>t(11,n=E)),Be(i,bt,E=>t(12,r=E));const s=Xe();let u,a=!1,o=!1;async function l(){let E=n.address.slice(1,5),A=c.path.split("!"),F=c.path.split("/"),T=Date.now();const k=await r.replica.set(n,{text:E+" replied: "+h,path:A[0]+T+"/!reply-by-"+E,deleteAfter:p}),S=await r.replica.set(n,{text:E+" replied: "+h,path:"/studio/"+F[2]+"/"+T+"/reply-by-"+E});return console.log("result ",k),console.log("studio ",S),s("success"),k}let{doc:c}=e,{inStudio:f}=e,h="Reply here",d=h.length,p=(Date.now()+36e5)*1e3;function g(){t(3,a=!a),t(4,o=!1)}function C(){t(3,a=!1),t(4,o=!o)}function b(){h=this.value,t(2,h),t(6,u)}return i.$$set=E=>{"doc"in E&&t(0,c=E.doc),"inStudio"in E&&t(1,f=E.inStudio)},i.$$.update=()=>{i.$$.dirty&4,i.$$.dirty&4&&h!==void 0&&t(5,d=h.length)},console.log("result",u),[c,f,h,a,o,d,u,l,g,C,b]}class rp extends J{constructor(e){super(),Z(this,e,np,tp,Y,{doc:0,inStudio:1})}}function iu(i){let e,t,n,r;return e=new W0({props:{doc:i[0],inStudio:i[1]}}),e.$on("success",i[4]),n=new rp({props:{doc:i[0],inStudio:i[1]}}),n.$on("success",i[5]),{c(){U(e.$$.fragment),t=I(),U(n.$$.fragment)},m(s,u){z(e,s,u),y(s,t,u),z(n,s,u),r=!0},p(s,u){const a={};u&1&&(a.doc=s[0]),u&2&&(a.inStudio=s[1]),e.$set(a);const o={};u&1&&(o.doc=s[0]),u&2&&(o.inStudio=s[1]),n.$set(o)},i(s){r||(v(e.$$.fragment,s),v(n.$$.fragment,s),r=!0)},o(s){B(e.$$.fragment,s),B(n.$$.fragment,s),r=!1},d(s){H(e,s),s&&_(t),H(n,s)}}}function ip(i){let e,t,n,r,s,u,a=i[2]&&iu(i);return{c(){e=D("div"),t=D("button"),t.textContent="↩️Reply",n=I(),a&&a.c()},m(o,l){y(o,e,l),m(e,t),m(e,n),a&&a.m(e,null),r=!0,s||(u=j(t,"click",i[3]),s=!0)},p(o,[l]){o[2]?a?(a.p(o,l),l&4&&v(a,1)):(a=iu(o),a.c(),v(a,1),a.m(e,null)):a&&(K(),B(a,1,1,()=>{a=null}),Q())},i(o){r||(v(a),r=!0)},o(o){B(a),r=!1},d(o){o&&_(e),a&&a.d(),s=!1,u()}}}function sp(i,e,t){let{doc:n}=e,{inStudio:r}=e,s=!1;function u(){t(2,s=!s)}function a(l){Xt.call(this,i,l)}function o(l){Xt.call(this,i,l)}return i.$$set=l=>{"doc"in l&&t(0,n=l.doc),"inStudio"in l&&t(1,r=l.inStudio)},[n,r,s,u,a,o]}class ba extends J{constructor(e){super(),Z(this,e,sp,ip,Y,{doc:0,inStudio:1})}}function up(i){let e,t,n,r,s,u=!i[10]&&su(i),a=i[10]&&ou(i);return{c(){e=D("div"),u&&u.c(),t=I(),a&&a.c(),w(e,"class","main svelte-twi2yu"),ot(e,"replies",i[6]===!0)},m(o,l){y(o,e,l),u&&u.m(e,null),m(e,t),a&&a.m(e,null),n=!0,r||(s=[j(e,"click",ai(i[19])),j(e,"keypress",ai(i[20]))],r=!0)},p(o,l){o[10]?u&&(u.d(1),u=null):u?u.p(o,l):(u=su(o),u.c(),u.m(e,t)),o[10]?a?(a.p(o,l),l&1024&&v(a,1)):(a=ou(o),a.c(),v(a,1),a.m(e,null)):a&&(K(),B(a,1,1,()=>{a=null}),Q()),(!n||l&64)&&ot(e,"replies",o[6]===!0)},i(o){n||(v(a),n=!0)},o(o){B(a),n=!1},d(o){o&&_(e),u&&u.d(),a&&a.d(),r=!1,Ae(s)}}}function op(i){let e,t,n;return{c(){e=D("div"),t=D("img"),Re(t,"margin-bottom","-3px"),$e(t.src,n=i[12][i[9]])||w(t,"src",n),w(t,"alt","document icon"),w(t,"width",i[8]),w(t,"height",i[8]),w(e,"class","main disabled svelte-twi2yu"),ot(e,"replies",i[6]===!0)},m(r,s){y(r,e,s),m(e,t)},p(r,s){s&512&&!$e(t.src,n=r[12][r[9]])&&w(t,"src",n),s&256&&w(t,"width",r[8]),s&256&&w(t,"height",r[8]),s&64&&ot(e,"replies",r[6]===!0)},i:L,o:L,d(r){r&&_(e)}}}function su(i){let e,t,n,r,s,u,a,o=i[0]!==void 0&&uu(i);return{c(){e=D("div"),t=D("p"),n=D("img"),s=I(),o&&o.c(),Re(n,"margin-bottom","-3px"),$e(n.src,r=i[12][i[9]])||w(n,"src",r),w(n,"alt","document icon"),w(n,"width",i[8]),w(n,"height",i[8]),w(t,"class","svelte-twi2yu"),w(e,"class","flex row svelte-twi2yu")},m(l,c){y(l,e,c),m(e,t),m(t,n),m(e,s),o&&o.m(e,null),u||(a=[j(t,"click",i[14]),j(t,"keypress",i[15])],u=!0)},p(l,c){c&512&&!$e(n.src,r=l[12][l[9]])&&w(n,"src",r),c&256&&w(n,"width",l[8]),c&256&&w(n,"height",l[8]),l[0]!==void 0?o?o.p(l,c):(o=uu(l),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(l){l&&_(e),o&&o.d(),u=!1,Ae(a)}}}function uu(i){let e;return{c(){e=D("div")},m(t,n){y(t,e,n),e.innerHTML=i[0]},p(t,n){n&1&&(e.innerHTML=t[0])},d(t){t&&_(e)}}}function ou(i){let e,t,n,r,s,u,a,o,l,c,f,h,d,p,g=i[3]&&au(i);l=new ga({props:{doc:i[1],attachment:i[3],isReply:i[6]}});let C=i[4]&&lu(i),b=!i[2]&&cu(i);return{c(){e=D("div"),t=D("button"),n=D("img"),s=$(`
            Artifact`),u=I(),g&&g.c(),a=I(),o=D("div"),U(l.$$.fragment),c=I(),C&&C.c(),f=I(),b&&b.c(),Re(n,"margin-bottom","-3px"),$e(n.src,r=i[12][i[9]])||w(n,"src",r),w(n,"alt","document icon"),w(n,"width",i[8]),w(n,"height",i[8]),w(t,"class","svelte-twi2yu"),w(e,"class","flex svelte-twi2yu")},m(E,A){y(E,e,A),m(e,t),m(t,n),m(t,s),m(e,u),g&&g.m(e,null),m(e,a),m(e,o),z(l,o,null),m(e,c),C&&C.m(e,null),m(e,f),b&&b.m(e,null),h=!0,d||(p=[j(t,"click",i[16]),j(t,"keypress",ai(i[17]))],d=!0)},p(E,A){(!h||A&512&&!$e(n.src,r=E[12][E[9]]))&&w(n,"src",r),(!h||A&256)&&w(n,"width",E[8]),(!h||A&256)&&w(n,"height",E[8]),E[3]?g?(g.p(E,A),A&8&&v(g,1)):(g=au(E),g.c(),v(g,1),g.m(e,a)):g&&(K(),B(g,1,1,()=>{g=null}),Q());const F={};A&2&&(F.doc=E[1]),A&8&&(F.attachment=E[3]),A&64&&(F.isReply=E[6]),l.$set(F),E[4]?C?(C.p(E,A),A&16&&v(C,1)):(C=lu(E),C.c(),v(C,1),C.m(e,f)):C&&(K(),B(C,1,1,()=>{C=null}),Q()),E[2]?b&&(K(),B(b,1,1,()=>{b=null}),Q()):b?(b.p(E,A),A&4&&v(b,1)):(b=cu(E),b.c(),v(b,1),b.m(e,null))},i(E){h||(v(g),v(l.$$.fragment,E),v(C),v(b),h=!0)},o(E){B(g),B(l.$$.fragment,E),B(C),B(b),h=!1},d(E){E&&_(e),g&&g.d(),H(l),C&&C.d(),b&&b.d(),d=!1,Ae(p)}}}function au(i){let e,t,n;return t=new ma({props:{doc:i[1]}}),{c(){e=D("div"),U(t.$$.fragment)},m(r,s){y(r,e,s),z(t,e,null),n=!0},p(r,s){const u={};s&2&&(u.doc=r[1]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function lu(i){let e,t,n;return t=new ba({props:{doc:i[1],inStudio:i[5]}}),{c(){e=D("div"),U(t.$$.fragment)},m(r,s){y(r,e,s),z(t,e,null),n=!0},p(r,s){const u={};s&2&&(u.doc=r[1]),s&32&&(u.inStudio=r[5]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function cu(i){let e,t,n;return t=new sh({props:{doc:i[1]}}),t.$on("update",i[18]),{c(){e=D("div"),U(t.$$.fragment)},m(r,s){y(r,e,s),z(t,e,null),n=!0},p(r,s){const u={};s&2&&(u.doc=r[1]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function ap(i){let e,t,n,r;const s=[op,up],u=[];function a(o,l){return o[7]?0:1}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),y(o,n,l),r=!0},p(o,[l]){let c=e;e=a(o),e===c?u[e].p(o,l):(K(),B(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){B(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function lp(i,e,t){const n=Xe();let r=["icons/mountain-phase-0-02.png","icons/mountain-phase-1-02.png","icons/mountain-phase-2-02.png","icons/mountain-phase-3-02.png","icons/mountain-phase-4-02.png","icons/mountain-phase-5-02.png","icons/mountain-phase-6-02.png","icons/mountain-phase-7-02.png","icons/mountain-phase-8-02.png"],s=!1,{doc:u}=e,{studio:a=!1}=e,{attachment:o=!0}=e,{reply:l=!0}=e,{title:c=void 0}=e,{inStudio:f}=e,{isReply:h=!1}=e,{disabled:d=!1}=e,p=u.deleteAfter,g,C=24,b;const E=()=>{t(10,s=!s),n("click",u)},A=()=>t(10,s=!s),F=()=>t(10,s=!s),T=()=>t(10,s=!s);function k(R){Xt.call(this,i,R)}const S=()=>{t(10,s=!s),n("click",u)},P=()=>t(10,s=!s);return i.$$set=R=>{"doc"in R&&t(1,u=R.doc),"studio"in R&&t(2,a=R.studio),"attachment"in R&&t(3,o=R.attachment),"reply"in R&&t(4,l=R.reply),"title"in R&&t(0,c=R.title),"inStudio"in R&&t(5,f=R.inStudio),"isReply"in R&&t(6,h=R.isReply),"disabled"in R&&t(7,d=R.disabled)},i.$$.update=()=>{i.$$.dirty&514&&console.log(u.path+"phase "+b),i.$$.dirty&8259&&(c!==void 0&&c.includes("<br>")?(t(13,g=c.split("<br>")),t(0,c=g.shift()),t(0,c),t(13,g),t(1,u),t(6,h),console.log("content",g),t(8,C=g.length*2+12)):u.text.includes("<br>")?(t(13,g=u.text.split("<br>")),t(8,C=g.length*3+8)):h&&t(8,C=10)),i.$$.dirty&256&&console.log("reaction",C)},console.log("deletionTime"+p),t(9,b=Math.floor((p-Date.now())/(25488e8/9))%9),[c,u,a,o,l,f,h,d,C,b,s,n,r,g,E,A,F,T,k,S,P]}class wa extends J{constructor(e){super(),Z(this,e,lp,ap,Y,{doc:1,studio:2,attachment:3,reply:4,title:0,inStudio:5,isReply:6,disabled:7})}}function cp(i){let e,t,n,r,s,u,a,o,l,c,f,h,d,p;return{c(){e=D("input"),t=I(),n=D("button"),r=$(`Upload ID
    `),s=D("br"),u=I(),a=D("br"),o=I(),l=D("img"),f=I(),h=D("span"),h.textContent="It is a JSON file",Re(e,"display","none"),w(e,"type","file"),w(e,"accept",".json, .txt"),$e(l.src,c=fp)||w(l,"src",c),w(l,"alt","upload id is a mouse "),w(h,"class","tooltiptext svelte-zq0ldm"),w(n,"class","phase1 tooltip px-8 pb-8 svelte-zq0ldm")},m(g,C){y(g,e,C),i[4](e),y(g,t,C),y(g,n,C),m(n,r),m(n,s),m(n,u),m(n,a),m(n,o),m(n,l),m(n,f),m(n,h),d||(p=[j(e,"change",i[3]),j(n,"click",i[5])],d=!0)},p:L,i:L,o:L,d(g){g&&_(e),i[4](null),g&&_(t),g&&_(n),d=!1,Ae(p)}}}let fp="images/upload-img.png";function hp(i){return new Promise((e,t)=>{let n=new FileReader;n.onload=()=>{e(n.result)},n.onerror=t,n.readAsBinaryString(i)})}function dp(i,e,t){const n=Xe();let r,s,{identityPg:u=!1}=e;async function a(f){let h=f.target.files[0],d=await hp(h);try{let p=JSON.parse(d);console.log(typeof p),console.log("fileReady",d);let g=p.address;console.log("authorAddress",g);let C=p.secret;console.log("authorSecret",C),it.set({address:g,secret:C}),s=g.slice(1,5),n("alias",s)}catch{n("error")}}const o=f=>a(f);function l(f){nn[f?"unshift":"push"](()=>{r=f,t(0,r)})}const c=()=>{r.click()};return i.$$set=f=>{"identityPg"in f&&t(2,u=f.identityPg)},[r,a,u,o,l,c]}class pp extends J{constructor(e){super(),Z(this,e,dp,cp,Y,{identityPg:2})}}function fu(i){let e,t;return{c(){e=D("p"),t=$(i[1]),w(e,"class","text-2xl")},m(n,r){y(n,e,r),m(e,t)},p(n,r){r&2&&re(t,n[1])},d(n){n&&_(e)}}}function mp(i){let e,t,n,r,s,u,a,o,l,c,f,h,d=i[1]&&fu(i);return{c(){e=D("div"),t=D("label"),t.textContent="Have an existing ID?",n=I(),r=D("div"),s=D("textarea"),u=I(),a=D("button"),a.textContent="Validate ID",o=I(),l=D("button"),l.textContent="Generate new Identity",c=I(),d&&d.c(),w(t,"for","keypair"),w(s,"class","px-5 my-2 svelte-5at67e"),w(s,"id","keypair"),w(s,"placeholder",`Paste it here:       
{
"address": "", 
"secret": ""
}`),w(a,"class","phase1 mx-4 my-2"),w(l,"class","phase1 mx-4 my-2"),Re(l,"margin-left","10vw"),w(r,"class","flex md:flex-row items-end mx-0 flex-col svelte-5at67e"),w(e,"class","flex flex-col items-start mx-0 svelte-5at67e")},m(p,g){y(p,e,g),m(e,t),m(e,n),m(e,r),m(r,s),Ze(s,i[0]),m(r,u),m(r,a),m(r,o),m(r,l),m(e,c),d&&d.m(e,null),f||(h=[j(s,"input",i[4]),j(a,"click",i[3]),j(l,"click",i[2])],f=!0)},p(p,[g]){g&1&&Ze(s,p[0]),p[1]?d?d.p(p,g):(d=fu(p),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},i:L,o:L,d(p){p&&_(e),d&&d.d(),f=!1,Ae(h)}}}function gp(i,e,t){const n=Xe();let r="",s="";function u(){n("generateNewIdentity")}function a(){try{let l=JSON.parse(r);l.address&&l.secret?M(Or(l.address))?(t(1,s="Invalid address"),n("error")):(it.set({address:l.address,secret:l.secret}),ae.author=l,n("validated")):(t(1,s="Invalid keypair"),n("error"))}catch{t(1,s="Invalid JSON"),n("error")}}function o(){r=this.value,t(0,r)}return[r,s,u,a,o]}class Dp extends J{constructor(e){super(),Z(this,e,gp,mp,Y,{})}}function bp(i){let e,t,n;return{c(){e=D("button"),e.textContent="file",w(e,"class","phase1")},m(r,s){y(r,e,s),t||(n=[j(e,"click",i[8]),j(e,"keypress",i[9])],t=!0)},p:L,d(r){r&&_(e),t=!1,Ae(n)}}}function wp(i){let e,t,n;return{c(){e=D("button"),e.textContent="make an offering to the oracle"},m(r,s){y(r,e,s),t||(n=[j(e,"click",i[6]),j(e,"keypress",i[7])],t=!0)},p:L,d(r){r&&_(e),t=!1,Ae(n)}}}function hu(i){let e,t,n=i[1].kind+"",r;return{c(){e=D("p"),t=D("strong"),r=$(n)},m(s,u){y(s,e,u),m(e,t),m(t,r)},p(s,u){u&2&&n!==(n=s[1].kind+"")&&re(r,n)},d(s){s&&_(e)}}}function yp(i){let e,t,n,r,s,u,a;function o(h,d){return h[0]?wp:bp}let l=o(i),c=l(i),f=i[1]&&hu(i);return{c(){e=D("div"),t=D("div"),c.c(),n=I(),r=D("input"),s=I(),f&&f.c(),Re(r,"display","none"),w(r,"type","file"),w(r,"accept",".jpg, .jpeg, .png, .gif, .txt, .pdf, .md, .webm, .mp3, .ogg, .wav"),w(t,"class","svelte-l8b8bn"),w(e,"class","svelte-l8b8bn")},m(h,d){y(h,e,d),m(e,t),c.m(t,null),m(t,n),m(t,r),i[11](r),m(e,s),f&&f.m(e,null),u||(a=j(r,"change",i[10]),u=!0)},p(h,[d]){l===(l=o(h))&&c?c.p(h,d):(c.d(1),c=l(h),c&&(c.c(),c.m(t,n))),h[1]?f?f.p(h,d):(f=hu(h),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i:L,o:L,d(h){h&&_(e),c.d(),i[11](null),f&&f.d(),u=!1,a()}}}function _p(i){return new Promise((e,t)=>{let n=new FileReader;n.onload=()=>{e(n.result),console.log("typeof",n.result)},n.onerror=t,n.readAsArrayBuffer(i)})}function Ap(i,e,t){let n,r;Be(i,it,A=>t(14,n=A)),Be(i,bt,A=>t(15,r=A));const s=Xe();let{inStudio:u}=e,{xy:a=[0,0]}=e,{oracle:o=!1}=e,l,c,f;async function h(A){let F=A.target.files[0],k=F.name.replace(/\s+/g,"_").replace(/[@·,\/#!$%\^&\*;:{}=\-`~()]/g,""),S=k.split(".").pop(),P=k.split(".")[k.split(".").length-2],R;(S==="JPG"||S==="jpg")&&(S="jpeg"),R=P+"."+S;let N=Date.now(),q=await _p(F),ce=(Date.now()+25488e5)*1e3,se=new Uint8Array(q);return o?await r.replica.set(n,{path:`/oracle/${N}/!${R}`,text:"Offering by "+n.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:se,deleteAfter:ce}):(u||t(1,c=await r.replica.set(n,{path:`/documents/${a[0]}/${a[1]}/${N}/!${R}`,text:"Shared by "+n.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:se,deleteAfter:ce})),f=await r.replica.set(n,{path:`/studio/${a[0]}/${a[1]}/${N}/${R}`,text:"Shared by "+n.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:se})),console.log("Result: ",c),M(c)&&console.error(c),console.log("Studio: ",f),M(f)&&console.error(f),s("success"),c}const d=()=>{l.click()},p=()=>{l.click()},g=()=>{l.click()},C=()=>{l.click()},b=A=>h(A);function E(A){nn[A?"unshift":"push"](()=>{l=A,t(2,l)})}return i.$$set=A=>{"inStudio"in A&&t(4,u=A.inStudio),"xy"in A&&t(5,a=A.xy),"oracle"in A&&t(0,o=A.oracle)},i.$$.update=()=>{i.$$.dirty&2&&t(1,c)},[o,c,l,h,u,a,d,p,g,C,b,E]}class Cp extends J{constructor(e){super(),Z(this,e,Ap,yp,Y,{inStudio:4,xy:5,oracle:0})}}function du(i){let e,t,n,r,s,u,a,o,l,c,f;return{c(){e=D("div"),t=D("textarea"),n=I(),r=D("div"),s=D("button"),s.textContent="Submit",u=I(),a=D("button"),a.textContent="Close",w(r,"class","button-container svelte-846af8"),w(e,"class","modal svelte-846af8")},m(h,d){y(h,e,d),m(e,t),i[6](t),m(e,n),m(e,r),m(r,s),m(r,u),m(r,a),l=!0,c||(f=[j(s,"click",i[7]),j(s,"keypress",i[8]),j(a,"click",i[9]),j(a,"keypress",i[10])],c=!0)},p:L,i(h){l||(vn(()=>{o||(o=Nt(e,jt,{y:200,duration:200},!0)),o.run(1)}),l=!0)},o(h){o||(o=Nt(e,jt,{y:200,duration:200},!1)),o.run(0),l=!1},d(h){h&&_(e),i[6](null),h&&o&&o.end(),c=!1,Ae(f)}}}function pu(i){let e,t,n=i[0].kind+"",r;return{c(){e=D("p"),t=D("strong"),r=$(n)},m(s,u){y(s,e,u),m(e,t),m(t,r)},p(s,u){u&1&&n!==(n=s[0].kind+"")&&re(r,n)},d(s){s&&_(e)}}}function Ep(i){let e,t,n,r,s,u,a,o,l=i[1]&&du(i),c=i[0]&&pu(i);return{c(){e=D("div"),t=D("div"),n=D("button"),n.textContent="written text",r=I(),l&&l.c(),s=I(),c&&c.c(),w(n,"class","phase1"),w(t,"class","svelte-846af8"),w(e,"class","svelte-846af8")},m(f,h){y(f,e,h),m(e,t),m(t,n),m(e,r),l&&l.m(e,null),m(e,s),c&&c.m(e,null),u=!0,a||(o=j(n,"click",i[4]),a=!0)},p(f,[h]){f[1]?l?(l.p(f,h),h&2&&v(l,1)):(l=du(f),l.c(),v(l,1),l.m(e,s)):l&&(K(),B(l,1,1,()=>{l=null}),Q()),f[0]?c?c.p(f,h):(c=pu(f),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i(f){u||(v(l),u=!0)},o(f){B(l),u=!1},d(f){f&&_(e),l&&l.d(),c&&c.d(),a=!1,o()}}}function vp(i,e,t){let n,r;Be(i,it,b=>t(11,n=b)),Be(i,bt,b=>t(12,r=b));const s=Xe();let u=!1,a,o,{xy:l=[0,0]}=e;async function c(){let b=Date.now(),E=(Date.now()+25488e5)*1e3,F=await new Blob([a.value],{type:"text/markdown"}).arrayBuffer(),T=new Uint8Array(F);return t(0,o=await r.replica.set(n,{path:`/documents/${l[0]}/${l[1]}/${b}/!text.md`,text:"Text input by "+n.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:T,deleteAfter:E})),console.log("Result: ",o),M(o)&&console.error(o),s("success"),t(1,u=!1),o}function f(){s("selected",{type:"text",location:l})}function h(b){nn[b?"unshift":"push"](()=>{a=b,t(2,a)})}const d=()=>c(),p=()=>c(),g=()=>t(1,u=!1),C=()=>t(1,u=!1);return i.$$set=b=>{"xy"in b&&t(5,l=b.xy)},i.$$.update=()=>{i.$$.dirty&1&&t(0,o)},[o,u,a,c,f,l,h,d,p,g,C]}class kp extends J{constructor(e){super(),Z(this,e,vp,Ep,Y,{xy:5})}}function mu(i,e,t){const n=i.slice();return n[20]=e[t],n[22]=t,n}function gu(i,e,t){const n=i.slice();return n[20]=e[t],n[24]=t,n}function Du(i){let e,t,n,r,s,u=i[3][1]+"",a,o,l=i[3][0]+"",c,f,h,d,p,g,C,b,E,A,F,T,k;return d=new kp({props:{xy:i[3]}}),d.$on("success",i[11]),d.$on("selected",i[12]),g=new Cp({props:{xy:i[3],inStudio:i[1]}}),g.$on("success",i[13]),b=new Da({props:{xy:i[3],inStudio:i[1]}}),b.$on("upload",i[14]),{c(){e=D("div"),t=D("div"),n=$(`What artefact would you like to create? 
      `),r=D("br"),s=I(),a=$(u),o=$(", "),c=$(l),f=I(),h=D("div"),U(d.$$.fragment),p=I(),U(g.$$.fragment),C=I(),U(b.$$.fragment),E=I(),A=D("button"),A.textContent="Close",w(t,"class","mt-6 brown text-left px-6 svelte-z5nupk"),w(A,"class","phase1"),w(h,"class","flex-col"),w(e,"class","modal pb-6  svelte-z5nupk"),w(e,"style",i[5])},m(S,P){y(S,e,P),m(e,t),m(t,n),m(t,r),m(t,s),m(t,a),m(t,o),m(t,c),m(e,f),m(e,h),z(d,h,null),m(h,p),z(g,h,null),m(h,C),z(b,h,null),m(h,E),m(h,A),F=!0,T||(k=j(A,"click",i[9]),T=!0)},p(S,P){(!F||P&8)&&u!==(u=S[3][1]+"")&&re(a,u),(!F||P&8)&&l!==(l=S[3][0]+"")&&re(c,l);const R={};P&8&&(R.xy=S[3]),d.$set(R);const N={};P&8&&(N.xy=S[3]),P&2&&(N.inStudio=S[1]),g.$set(N);const q={};P&8&&(q.xy=S[3]),P&2&&(q.inStudio=S[1]),b.$set(q),(!F||P&32)&&w(e,"style",S[5])},i(S){F||(v(d.$$.fragment,S),v(g.$$.fragment,S),v(b.$$.fragment,S),F=!0)},o(S){B(d.$$.fragment,S),B(g.$$.fragment,S),B(b.$$.fragment,S),F=!1},d(S){S&&_(e),H(d),H(g),H(b),T=!1,k()}}}function bu(i,e){let t,n,r;function s(){return e[15](e[22],e[24])}function u(){return e[16](e[22],e[24])}return{key:i,first:null,c(){t=D("div"),w(t,"class","svelte-z5nupk"),ot(t,"active",e[4][e[22]][e[24]]),this.first=t},m(a,o){y(a,t,o),n||(r=[j(t,"click",s),j(t,"keypress",u)],n=!0)},p(a,o){e=a,o&17&&ot(t,"active",e[4][e[22]][e[24]])},d(a){a&&_(t),n=!1,Ae(r)}}}function wu(i,e){let t,n=[],r=new Map,s,u={length:e[0][1]};const a=o=>o[24];for(let o=0;o<u.length;o+=1){let l=gu(e,u,o),c=a(l);r.set(c,n[o]=bu(c,l))}return{key:i,first:null,c(){t=ie();for(let o=0;o<n.length;o+=1)n[o].c();s=ie(),this.first=t},m(o,l){y(o,t,l);for(let c=0;c<n.length;c+=1)n[c].m(o,l);y(o,s,l)},p(o,l){e=o,l&273&&(u={length:e[0][1]},n=Dt(n,l,a,1,e,u,r,s.parentNode,Xn,bu,s,gu))},d(o){o&&_(t);for(let l=0;l<n.length;l+=1)n[l].d(o);o&&_(s)}}}function Fp(i){let e,t,n,r,s,u,a,o=[],l=new Map,c,f=i[2]&&Du(i),h={length:i[0][0]};const d=p=>p[22];for(let p=0;p<h.length;p+=1){let g=mu(i,h,p),C=d(g);l.set(C,o[p]=wu(C,g))}return{c(){e=D("div"),t=D("div"),f&&f.c(),n=I(),r=D("div"),s=D("h4"),s.textContent="Select location on map",u=I(),a=D("div");for(let p=0;p<o.length;p+=1)o[p].c();w(s,"class","svelte-z5nupk"),w(a,"class","container svelte-z5nupk"),Re(a,"grid-template-rows",i[6]),Re(a,"grid-template-columns",i[7]),w(r,"class","w-4/5"),Re(t,"position","relative"),Re(e,"position","fixed")},m(p,g){y(p,e,g),m(e,t),f&&f.m(t,null),m(t,n),m(t,r),m(r,s),m(r,u),m(r,a);for(let C=0;C<o.length;C+=1)o[C].m(a,null);c=!0},p(p,[g]){p[2]?f?(f.p(p,g),g&4&&v(f,1)):(f=Du(p),f.c(),v(f,1),f.m(t,n)):f&&(K(),B(f,1,1,()=>{f=null}),Q()),g&273&&(h={length:p[0][0]},o=Dt(o,g,d,1,p,h,l,a,Xn,wu,null,mu)),(!c||g&64)&&Re(a,"grid-template-rows",p[6]),(!c||g&128)&&Re(a,"grid-template-columns",p[7])},i(p){c||(v(f),c=!0)},o(p){B(f),c=!1},d(p){p&&_(e),f&&f.d();for(let g=0;g<o.length;g+=1)o[g].d()}}}function Bp(i,e,t){let n,r,s,u,{grid:a=[9,16]}=e,o=[],l=!1,c=["0px","0px"],{inStudio:f}=e;function h(k,S){t(3,o=[k,S]),p([k,S]),setTimeout(()=>{t(2,l=!0),t(10,c=[k*50+"px",S*50+50+"px"])},500)}function d([k,S],[P,R]){return(k-o[0])*(k-P)<=0&&(S-o[1])*(S-R)<=0}function p(k){t(4,s=s.map((S,P)=>S.map((R,N)=>d([P,N],k))))}function g(){t(2,l=!1),t(4,s=Array(a[0]).fill(0).map(k=>Array(a[1]).fill(!1)))}function C(k){Xt.call(this,i,k)}function b(k){Xt.call(this,i,k)}function E(k){Xt.call(this,i,k)}function A(k){Xt.call(this,i,k)}const F=(k,S)=>h(k,S),T=(k,S)=>h(k,S);return i.$$set=k=>{"grid"in k&&t(0,a=k.grid),"inStudio"in k&&t(1,f=k.inStudio)},i.$$.update=()=>{i.$$.dirty&1&&t(7,n=`repeat(${a[1]}, 1fr)`),i.$$.dirty&1&&t(6,r=`repeat(${a[0]}, 1fr)`),i.$$.dirty&1&&t(4,s=Array(a[0]).fill(0).map(k=>Array(a[1]).fill(!1))),i.$$.dirty&1028&&t(5,u=`top: ${c[0]}; left: ${c[1]}; visibility: ${l?"visible":"hidden"};`)},[a,f,l,o,s,u,r,n,h,g,c,C,b,E,A,F,T]}class Sp extends J{constructor(e){super(),Z(this,e,Bp,Fp,Y,{grid:0,inStudio:1})}}function yu(i){let e,t;return{c(){e=D("h4"),t=$(i[4]),w(e,"class","mt-12")},m(n,r){y(n,e,r),m(e,t)},p(n,r){r&16&&re(t,n[4])},d(n){n&&_(e)}}}function _u(i){let e,t,n;return t=new ma({props:{doc:i[0]}}),{c(){e=D("div"),U(t.$$.fragment),w(e,"class","attachmentbox svelte-1vj0bce")},m(r,s){y(r,e,s),z(t,e,null),n=!0},p(r,s){const u={};s&1&&(u.doc=r[0]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function Au(i){let e,t,n;return t=new ba({props:{doc:i[0],inStudio:i[3]}}),{c(){e=D("div"),U(t.$$.fragment)},m(r,s){y(r,e,s),z(t,e,null),n=!0},p(r,s){const u={};s&1&&(u.doc=r[0]),s&8&&(u.inStudio=r[3]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function Tp(i){let e,t,n,r,s,u,a,o,l=i[4]&&yu(i),c=i[1]&&_u(i),f=i[2]&&Au(i);return{c(){l&&l.c(),e=I(),t=D("div"),c&&c.c(),n=I(),f&&f.c(),r=I(),s=D("button"),s.textContent="close",w(t,"class","flex flex-row justify-between w-full"),w(s,"class","top-right svelte-1vj0bce")},m(h,d){l&&l.m(h,d),y(h,e,d),y(h,t,d),c&&c.m(t,null),m(t,n),f&&f.m(t,null),y(h,r,d),y(h,s,d),u=!0,a||(o=j(s,"click",i[5]),a=!0)},p(h,[d]){h[4]?l?l.p(h,d):(l=yu(h),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),h[1]?c?(c.p(h,d),d&2&&v(c,1)):(c=_u(h),c.c(),v(c,1),c.m(t,n)):c&&(K(),B(c,1,1,()=>{c=null}),Q()),h[2]?f?(f.p(h,d),d&4&&v(f,1)):(f=Au(h),f.c(),v(f,1),f.m(t,null)):f&&(K(),B(f,1,1,()=>{f=null}),Q())},i(h){u||(v(c),v(f),u=!0)},o(h){B(c),B(f),u=!1},d(h){l&&l.d(h),h&&_(e),h&&_(t),c&&c.d(),f&&f.d(),h&&_(r),h&&_(s),a=!1,o()}}}function Ip(i,e,t){const n=Xe();let{selectedDocument:r}=e,{attachment:s=!0}=e,{reply:u=!0}=e,{inStudio:a=!1}=e,o;function l(){n("close")}return i.$$set=c=>{"selectedDocument"in c&&t(0,r=c.selectedDocument),"attachment"in c&&t(1,s=c.attachment),"reply"in c&&t(2,u=c.reply),"inStudio"in c&&t(3,a=c.inStudio)},i.$$.update=()=>{i.$$.dirty&1&&r&&t(4,o=r.text.split("#Title:")[1].split("#Notes:")[0].trim()),i.$$.dirty&1&&console.log("selectedDocument in ArtifactView",r)},[r,s,u,a,o,l]}class Pp extends J{constructor(e){super(),Z(this,e,Ip,Tp,Y,{selectedDocument:0,attachment:1,reply:2,inStudio:3})}}function Rp(i){let e,t,n,r,s;return{c(){e=D("div"),t=D("img"),$e(t.src,n=i[1][i[2]])||w(t,"src",n),w(t,"alt","document icon"),w(t,"class","svelte-cgxyx9")},m(u,a){y(u,e,a),m(e,t),r||(s=[j(e,"click",i[3]),j(e,"keypress",i[3])],r=!0)},p:L,d(u){u&&_(e),r=!1,Ae(s)}}}function xp(i){let e,t,n;return{c(){e=D("div"),t=D("img"),$e(t.src,n=i[1][i[2]])||w(t,"src",n),w(t,"alt","document icon"),Re(t,"filter","blur(1px)"),w(t,"class","svelte-cgxyx9")},m(r,s){y(r,e,s),m(e,t)},p:L,d(r){r&&_(e)}}}function Op(i){let e;function t(s,u){return s[0]?xp:Rp}let n=t(i),r=n(i);return{c(){r.c(),e=ie()},m(s,u){r.m(s,u),y(s,e,u)},p(s,[u]){n===(n=t(s))&&r?r.p(s,u):(r.d(1),r=n(s),r&&(r.c(),r.m(e.parentNode,e)))},i:L,o:L,d(s){r.d(s),s&&_(e)}}}function Mp(i,e,t){const n=Xe();let r=["icons/mountain-phase-0-02.png","icons/mountain-phase-1-02.png","icons/mountain-phase-2-02.png","icons/mountain-phase-3-02.png","icons/mountain-phase-4-02.png","icons/mountain-phase-5-02.png","icons/mountain-phase-6-02.png","icons/mountain-phase-7-02.png","icons/mountain-phase-8-02.png"],{doc:s}=e,{disabled:u=!1}=e,a=s.deleteAfter,o=Math.floor((a-Date.now())/(25488e8/9))%9;function l(c){console.log("clicked"),n("click",c)}return i.$$set=c=>{"doc"in c&&t(4,s=c.doc),"disabled"in c&&t(0,u=c.disabled)},[u,r,o,l,s]}class $r extends J{constructor(e){super(),Z(this,e,Mp,Op,Y,{doc:4,disabled:0})}}function Cu(i){let e,t,n;return{c(){e=D("button"),e.textContent="Submit",w(e,"class","phase1")},m(r,s){y(r,e,s),t||(n=j(e,"click",i[4]),t=!0)},p:L,d(r){r&&_(e),t=!1,n()}}}function Np(i){let e,t,n,r,s,u,a,o,l,c,f,h,d,p=i[0]==="text"&&Cu(i);return{c(){e=D("div"),t=D("div"),n=D("input"),r=I(),s=D("div"),u=D("textarea"),a=I(),o=D("div"),l=D("h5"),l.textContent="Notes",c=I(),f=D("input"),h=I(),d=D("div"),p&&p.c(),w(n,"id","titleInput"),w(n,"class","align-left svelte-ewfvax"),w(n,"type","text"),w(n,"placeholder","Enter a title"),w(t,"class","flex flex-row justify-start"),w(u,"id","mainInput"),w(u,"placeholder","Enter text"),w(u,"class","svelte-ewfvax"),w(l,"class","text-left"),w(f,"type","text"),w(f,"placeholder","Enter optional notes"),w(o,"class","pr-6"),w(s,"class","flex flex-row justify-between"),w(d,"class","flex flex-row justify-end my-6"),w(e,"class","p-6")},m(g,C){y(g,e,C),m(e,t),m(t,n),i[6](n),m(e,r),m(e,s),m(s,u),i[7](u),m(s,a),m(s,o),m(o,l),m(o,c),m(o,f),i[8](f),m(e,h),m(e,d),p&&p.m(d,null)},p(g,[C]){g[0]==="text"?p?p.p(g,C):(p=Cu(g),p.c(),p.m(d,null)):p&&(p.d(1),p=null)},i:L,o:L,d(g){g&&_(e),i[6](null),i[7](null),i[8](null),p&&p.d()}}}function Lp(i,e,t){let n,r;Be(i,it,b=>t(11,n=b)),Be(i,bt,b=>t(12,r=b));let{filetype:s}=e,{xy:u=[0,0]}=e,a,o,l,c,f;const h=Xe();async function d(){let b=Date.now(),E=(Date.now()+25488e5)*1e3,F=await new Blob([a.value],{type:"text/markdown"}).arrayBuffer(),T=new Uint8Array(F);return l?c="#Title: "+o.value+"#Notes: "+l.value:c="#Title: "+o.value,f=await r.replica.set(n,{path:`/documents/${u[0]}/${u[1]}/${b}/!text.md`,text:"Text input by "+n.address.slice(1,5)+" on "+new Date().toLocaleString()+c,attachment:T,deleteAfter:E}),console.log("Result: ",f),M(f)&&console.error(f),h("success"),f}function p(b){nn[b?"unshift":"push"](()=>{o=b,t(2,o)})}function g(b){nn[b?"unshift":"push"](()=>{a=b,t(1,a)})}function C(b){nn[b?"unshift":"push"](()=>{l=b,t(3,l)})}return i.$$set=b=>{"filetype"in b&&t(0,s=b.filetype),"xy"in b&&t(5,u=b.xy)},[s,a,o,l,d,u,p,g,C]}class $p extends J{constructor(e){super(),Z(this,e,Lp,Np,Y,{filetype:0,xy:5})}}function Eu(i,e,t){const n=i.slice();return n[41]=e[t],n[43]=t,n}function vu(i,e,t){const n=i.slice();return n[44]=e[t],n[46]=t,n}function ku(i,e,t){const n=i.slice();return n[44]=e[t],n[48]=t,n}function Fu(i,e,t){const n=i.slice();return n[49]=e[t],n}function Bu(i){let e,t,n;function r(a,o){return a[1]?jp:Up}let s=r(i),u=s(i);return{c(){e=D("button"),u.c(),w(e,"class","topleft m-6")},m(a,o){y(a,e,o),u.m(e,null),t||(n=j(e,"click",i[22]),t=!0)},p(a,o){s===(s=r(a))&&u?u.p(a,o):(u.d(1),u=s(a),u&&(u.c(),u.m(e,null)))},d(a){a&&_(e),u.d(),t=!1,n()}}}function jp(i){let e;return{c(){e=$("Hide details")},m(t,n){y(t,e,n)},p:L,d(t){t&&_(e)}}}function Up(i){let e=i[15].address.slice(0,5)+"",t;return{c(){t=$(e)},m(n,r){y(n,t,r)},p(n,r){r[0]&32768&&e!==(e=n[15].address.slice(0,5)+"")&&re(t,e)},d(n){n&&_(t)}}}function Su(i){let e,t,n;return t=new ga({props:{doc:i[5],attachment:i[3],isReply:i[4]}}),{c(){e=D("div"),U(t.$$.fragment)},m(r,s){y(r,e,s),z(t,e,null),n=!0},p(r,s){const u={};s[0]&32&&(u.doc=r[5]),s[0]&8&&(u.attachment=r[3]),s[0]&16&&(u.isReply=r[4]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function zp(i){let e;return{c(){e=$("Back to viewing")},m(t,n){y(t,e,n)},d(t){t&&_(e)}}}function Hp(i){let e;return{c(){e=$("Place an artefact")},m(t,n){y(t,e,n)},d(t){t&&_(e)}}}function qp(i){let e,t;return e=new $p({props:{filetype:i[11],xy:i[12]}}),e.$on("success",i[25]),{c(){U(e.$$.fragment)},m(n,r){z(e,n,r),t=!0},p(n,r){const s={};r[0]&2048&&(s.filetype=n[11]),r[0]&4096&&(s.xy=n[12]),e.$set(s)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Wp(i){let e,t,n;return t=new Sp({props:{inStudio:i[0]}}),t.$on("success",i[29]),t.$on("upload",i[30]),t.$on("selected",i[24]),{c(){e=D("div"),U(t.$$.fragment)},m(r,s){y(r,e,s),z(t,e,null),n=!0},p(r,s){const u={};s[0]&1&&(u.inStudio=r[0]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function Vp(i){let e,t,n;return t=new Pp({props:{selectedDocument:i[5]}}),t.$on("close",i[28]),{c(){e=D("div"),U(t.$$.fragment),w(e,"class","artifact-overlay mt-[15vh] h-[80vh] w-4/5 fixed svelte-917e9f")},m(r,s){y(r,e,s),z(t,e,null),n=!0},p(r,s){const u={};s[0]&32&&(u.selectedDocument=r[5]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function Kp(i){let e=[],t=new Map,n,r,s=i[17];const u=a=>a[43];for(let a=0;a<s.length;a+=1){let o=Eu(i,s,a),l=u(o);t.set(l,e[a]=xu(l,o))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=ie()},m(a,o){for(let l=0;l<e.length;l+=1)e[l].m(a,o);y(a,n,o),r=!0},p(a,o){o[0]&2056448&&(s=a[17],K(),e=Dt(e,o,u,1,a,s,t,n.parentNode,Zn,xu,n,Eu),Q())},i(a){if(!r){for(let o=0;o<s.length;o+=1)v(e[o]);r=!0}},o(a){for(let o=0;o<e.length;o+=1)B(e[o]);r=!1},d(a){for(let o=0;o<e.length;o+=1)e[o].d(a);a&&_(n)}}}function Qp(i){let e;return{c(){e=D("p"),e.textContent="No files yet"},m(t,n){y(t,e,n)},p:L,i:L,o:L,d(t){t&&_(e)}}}function Tu(i){let e=[],t=new Map,n,r;function s(...o){return i[31](i[46],i[48],...o)}let u=i[8].filter(s);const a=o=>o[49].textHash+o[49].timestamp;for(let o=0;o<u.length;o+=1){let l=Fu(i,u,o),c=a(l);t.set(c,e[o]=Iu(c,l))}return{c(){for(let o=0;o<e.length;o+=1)e[o].c();n=ie()},m(o,l){for(let c=0;c<e.length;c+=1)e[c].m(o,l);y(o,n,l),r=!0},p(o,l){i=o,l[0]&1507584&&(u=i[8].filter(s),K(),e=Dt(e,l,a,1,i,u,t,n.parentNode,Zn,Iu,n,Fu),Q())},i(o){if(!r){for(let l=0;l<u.length;l+=1)v(e[l]);r=!0}},o(o){for(let l=0;l<e.length;l+=1)B(e[l]);r=!1},d(o){for(let l=0;l<e.length;l+=1)e[l].d(o);o&&_(n)}}}function Gp(i){let e,t;function n(){return i[33](i[49])}return e=new $r({props:{doc:i[49]}}),e.$on("click",n),{c(){U(e.$$.fragment)},m(r,s){z(e,r,s),t=!0},p(r,s){i=r;const u={};s[0]&256&&(u.doc=i[49]),e.$set(u)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){B(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Yp(i){let e,t;return e=new $r({props:{doc:i[49],disabled:!0}}),{c(){U(e.$$.fragment)},m(n,r){z(e,n,r),t=!0},p(n,r){const s={};r[0]&256&&(s.doc=n[49]),e.$set(s)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Jp(i){let e,t,n,r;const s=[Xp,Zp],u=[];function a(o,l){return o[18]<o[49].deleteAfter-o[41]?1:0}return e=a(i),t=u[e]=s[e](i),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),y(o,n,l),r=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(K(),B(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=s[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){B(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function Zp(i){let e,t;function n(){return i[32](i[49])}return e=new $r({props:{doc:i[49]}}),e.$on("click",n),{c(){U(e.$$.fragment)},m(r,s){z(e,r,s),t=!0},p(r,s){i=r;const u={};s[0]&256&&(u.doc=i[49]),e.$set(u)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){B(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Xp(i){let e,t;return e=new $r({props:{doc:i[49],disabled:!0}}),{c(){U(e.$$.fragment)},m(n,r){z(e,n,r),t=!0},p(n,r){const s={};r[0]&256&&(s.doc=n[49]),e.$set(s)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Iu(i,e){let t,n,r,s,u;const a=[Jp,Yp,Gp],o=[];function l(c,f){return c[41]==c[17][0]?0:c[18]<c[49].deleteAfter-c[41]&&c[18]>c[49].deleteAfter-(c[41]+63936e7)?2:1}return n=l(e),r=o[n]=a[n](e),{key:i,first:null,c(){t=D("div"),r.c(),w(t,"id",s=e[49].textHash+e[49].timestamp),w(t,"class","svelte-917e9f"),this.first=t},m(c,f){y(c,t,f),o[n].m(t,null),u=!0},p(c,f){e=c;let h=n;n=l(e),n===h?o[n].p(e,f):(K(),B(o[h],1,1,()=>{o[h]=null}),Q(),r=o[n],r?r.p(e,f):(r=o[n]=a[n](e),r.c()),v(r,1),r.m(t,null)),(!u||f[0]&256&&s!==(s=e[49].textHash+e[49].timestamp))&&w(t,"id",s)},i(c){u||(v(r),u=!0)},o(c){B(r),u=!1},d(c){c&&_(t),o[n].d()}}}function Pu(i,e){let t,n=e[46]+"",r,s,u=e[48]+"",a,o,l=e[8].find(f),c;function f(...d){return e[26](e[46],e[48],...d)}let h=l&&Tu(e);return{key:i,first:null,c(){t=D("div"),r=$(n),s=$(","),a=$(u),o=I(),h&&h.c(),w(t,"class","grid-cell svelte-917e9f"),this.first=t},m(d,p){y(d,t,p),m(t,r),m(t,s),m(t,a),m(t,o),h&&h.m(t,null),c=!0},p(d,p){e=d,p[0]&256&&(l=e[8].find(f)),l?h?(h.p(e,p),p[0]&256&&v(h,1)):(h=Tu(e),h.c(),v(h,1),h.m(t,null)):h&&(K(),B(h,1,1,()=>{h=null}),Q())},i(d){c||(v(h),c=!0)},o(d){B(h),c=!1},d(d){d&&_(t),h&&h.d()}}}function Ru(i,e){let t,n=[],r=new Map,s,u,a={length:e[16][1]};const o=l=>l[48];for(let l=0;l<a.length;l+=1){let c=ku(e,a,l),f=o(c);r.set(f,n[l]=Pu(f,c))}return{key:i,first:null,c(){t=ie();for(let l=0;l<n.length;l+=1)n[l].c();s=ie(),this.first=t},m(l,c){y(l,t,c);for(let f=0;f<n.length;f+=1)n[f].m(l,c);y(l,s,c),u=!0},p(l,c){e=l,c[0]&1507584&&(a={length:e[16][1]},K(),n=Dt(n,c,o,1,e,a,r,s.parentNode,Zn,Pu,s,ku),Q())},i(l){if(!u){for(let c=0;c<a.length;c+=1)v(n[c]);u=!0}},o(l){for(let c=0;c<n.length;c+=1)B(n[c]);u=!1},d(l){l&&_(t);for(let c=0;c<n.length;c+=1)n[c].d(l);l&&_(s)}}}function xu(i,e){let t,n=[],r=new Map,s,u,a={length:e[16][0]};const o=l=>l[46];for(let l=0;l<a.length;l+=1){let c=vu(e,a,l),f=o(c);r.set(f,n[l]=Ru(f,c))}return{key:i,first:null,c(){t=D("div");for(let l=0;l<n.length;l+=1)n[l].c();s=I(),w(t,"class","my-grid-container w-screen svelte-917e9f"),Re(t,"grid-template-rows",e[13]),Re(t,"grid-template-columns",e[14]),Re(t,"background-color",e[19][e[43]]),this.first=t},m(l,c){y(l,t,c);for(let f=0;f<n.length;f+=1)n[f].m(t,null);m(t,s),u=!0},p(l,c){e=l,c[0]&1507584&&(a={length:e[16][0]},K(),n=Dt(n,c,o,1,e,a,r,t,Zn,Ru,s,vu),Q()),(!u||c[0]&8192)&&Re(t,"grid-template-rows",e[13]),(!u||c[0]&16384)&&Re(t,"grid-template-columns",e[14])},i(l){if(!u){for(let c=0;c<a.length;c+=1)v(n[c]);u=!0}},o(l){for(let c=0;c<n.length;c+=1)B(n[c]);u=!1},d(l){l&&_(t);for(let c=0;c<n.length;c+=1)n[c].d()}}}function em(i){let e,t,n,r,s,u=i[5]?`Grid [${i[6]}, ${i[7]}]`:"No document selected",a,o,l,c,f,h,d,p,g,C,b,E,A,F,T,k,S=i[2]&&Bu(i),P=i[5]&&Su(i);function R(V,fe){return V[9]?Hp:zp}let N=R(i),q=N(i);const ce=[Vp,Wp,qp],se=[];function We(V,fe){return V[5]?0:V[9]?V[10]?2:-1:1}~(p=We(i))&&(g=se[p]=ce[p](i));const De=[Qp,Kp],pe=[];function de(V,fe){return V[8].length===0?0:1}return E=de(i),A=pe[E]=De[E](i),{c(){e=D("div"),S&&S.c(),t=I(),n=D("div"),r=D("div"),s=D("p"),a=$(u),o=I(),P&&P.c(),l=I(),c=D("button"),q.c(),f=I(),h=D("div"),d=D("div"),g&&g.c(),C=I(),b=D("div"),A.c(),w(e,"class","w-screen flex flex-row justify-end h-[10vh]"),w(c,"class","mb-12"),w(r,"class","mx-1 mt-12 w-1/5 paper-yellow flex flex-col p-8 h-[80vh] fixed"),w(b,"class","flex flex-col w-screen"),w(d,"class","my-grid-container-wrapper svelte-917e9f"),w(h,"class","w-4/5 mt-12 ml-auto"),w(n,"class","the-scroll flex min-h-screen overflow-y-auto svelte-917e9f")},m(V,fe){y(V,e,fe),S&&S.m(e,null),y(V,t,fe),y(V,n,fe),m(n,r),m(r,s),m(s,a),m(r,o),P&&P.m(r,null),m(r,l),m(r,c),q.m(c,null),m(n,f),m(n,h),m(h,d),~p&&se[p].m(d,null),m(d,C),m(d,b),pe[E].m(b,null),F=!0,T||(k=[j(e,"click",i[27]),j(e,"keydown",i[23]),j(c,"click",i[21])],T=!0)},p(V,fe){V[2]?S?S.p(V,fe):(S=Bu(V),S.c(),S.m(e,null)):S&&(S.d(1),S=null),(!F||fe[0]&224)&&u!==(u=V[5]?`Grid [${V[6]}, ${V[7]}]`:"No document selected")&&re(a,u),V[5]?P?(P.p(V,fe),fe[0]&32&&v(P,1)):(P=Su(V),P.c(),v(P,1),P.m(r,l)):P&&(K(),B(P,1,1,()=>{P=null}),Q()),N!==(N=R(V))&&(q.d(1),q=N(V),q&&(q.c(),q.m(c,null)));let Ie=p;p=We(V),p===Ie?~p&&se[p].p(V,fe):(g&&(K(),B(se[Ie],1,1,()=>{se[Ie]=null}),Q()),~p?(g=se[p],g?g.p(V,fe):(g=se[p]=ce[p](V),g.c()),v(g,1),g.m(d,C)):g=null);let be=E;E=de(V),E===be?pe[E].p(V,fe):(K(),B(pe[be],1,1,()=>{pe[be]=null}),Q(),A=pe[E],A?A.p(V,fe):(A=pe[E]=De[E](V),A.c()),v(A,1),A.m(b,null))},i(V){F||(v(P),v(g),v(A),F=!0)},o(V){B(P),B(g),B(A),F=!1},d(V){V&&_(e),S&&S.d(),V&&_(t),V&&_(n),P&&P.d(),q.d(),~p&&se[p].d(),pe[E].d(),T=!1,Ae(k)}}}function tm(i,e,t){let n,r,s,u,a;Be(i,ua,oe=>t(34,s=oe)),Be(i,oa,oe=>t(35,u=oe)),Be(i,it,oe=>t(15,a=oe));const o=Xe();let l=[9,16],c=[],f=[191808e7,127872e7,63936e7,0],h=u.getTime()*1e3,d=["#fff5d9","#d3e3d9","#F9DFDD","#CCE9F0"],{inStudio:p}=e,{showDetails:g=!0}=e,{IDcreated:C=!1}=e,{attachment:b=!0}=e,{isReply:E=!1}=e,A=!0,F=null,T,k,S=!1,P=null,R=[0,0];function N(oe){t(5,F=oe),console.log("selecteddoc",oe)}const q=async()=>{t(8,c=s.cache.queryDocs({filter:{pathStartsWith:"/documents"}})),t(8,c=c.filter(oe=>oe.path.split("/").length<=6)),console.log("Docs",c)};s.cache.onCacheUpdated(()=>{q()}),gt(()=>{q()});function ce(){t(9,A=!A),t(5,F=null)}function se(){o("toggle")}function We(oe){oe.key==="Escape"&&t(5,F=null)}function De(oe){t(10,S=!0),t(9,A=!0),t(5,F=null),t(11,P=oe.detail.type),t(12,R=oe.detail.location),console.log("filetype",P),console.log("xy",R)}function pe(){t(10,S=!1),t(9,A=!0),t(5,F=null),t(11,P=null),t(12,R=[0,0])}const de=(oe,qr,Pn)=>parseInt(Pn.path.split("/")[2])==oe&&parseInt(Pn.path.split("/")[3])==qr,V=()=>t(5,F=null),fe=()=>t(5,F=null),Ie=()=>t(9,A=!A),be=()=>t(9,A=!A),xe=(oe,qr,Pn)=>parseInt(Pn.path.split("/")[2])==oe&&parseInt(Pn.path.split("/")[3])==qr,Oe=oe=>N(oe),lt=oe=>N(oe);return i.$$set=oe=>{"inStudio"in oe&&t(0,p=oe.inStudio),"showDetails"in oe&&t(1,g=oe.showDetails),"IDcreated"in oe&&t(2,C=oe.IDcreated),"attachment"in oe&&t(3,b=oe.attachment),"isReply"in oe&&t(4,E=oe.isReply)},i.$$.update=()=>{if(i.$$.dirty[0]&224&&F){let oe=F.path.split("/");t(6,T=oe[2]),t(7,k=oe[3]),console.log("selectedX",T),console.log("selectedY",k),console.log("selectedDocument in GridView",F)}},t(14,n="repeat("+l[1]+", minmax(min-content, 1fr))"),t(13,r="repeat("+l[0]+", minmax(min-content, 1fr))"),[p,g,C,b,E,F,T,k,c,A,S,P,R,r,n,a,l,f,h,d,N,ce,se,We,De,pe,de,V,fe,Ie,be,xe,Oe,lt]}class nm extends J{constructor(e){super(),Z(this,e,tm,em,Y,{inStudio:0,showDetails:1,IDcreated:2,attachment:3,isReply:4},null,[-1,-1])}}function Ou(i,e,t){const n=i.slice();return n[10]=e[t],n}function Mu(i,e,t){const n=i.slice();return n[13]=e[t],n[15]=t,n}function rm(i){let e,t,n,r,s,u=[],a=new Map,o=ae.servers;const l=c=>c[15];for(let c=0;c<o.length;c+=1){let f=Mu(i,o,c),h=l(f);a.set(h,u[c]=Nu(h,f))}return{c(){e=D("div"),t=D("p"),n=D("b"),n.textContent=`${ae.servers.length===1?"Server:":`${ae.servers.length} Servers:`}`,r=I(),s=D("ul");for(let c=0;c<u.length;c+=1)u[c].c();w(t,"class","svelte-1vxr72o")},m(c,f){y(c,e,f),m(e,t),m(t,n),m(e,r),m(e,s);for(let h=0;h<u.length;h+=1)u[h].m(s,null)},p(c,f){f&0&&(o=ae.servers,u=Dt(u,f,l,1,c,o,a,s,Xn,Nu,null,Mu))},d(c){c&&_(e);for(let f=0;f<u.length;f+=1)u[f].d()}}}function Nu(i,e){let t,n=e[13]+"",r;return{key:i,first:null,c(){t=D("li"),r=$(n),this.first=t},m(s,u){y(s,t,u),m(t,r)},p(s,u){e=s},d(s){s&&_(t)}}}function Lu(i){let e,t,n,r,s,u=i[1].status+"",a,o,l,c,f,h,d,p,g,C,b,E,A,F,T,k,S,P,R,N,q,ce,se,We,De,pe,de=i[6]&&$u(i);return{c(){e=D("div"),t=D("div"),n=D("h4"),r=$("Status: "),s=D("strong"),a=$(u),o=I(),l=D("h4"),c=$("Share "),f=D("strong"),h=$(i[7]),d=I(),p=D("div"),g=D("h4"),g.textContent="Documents",C=I(),b=D("p"),E=D("strong"),A=$(i[3]),F=$(" documents sent"),T=I(),k=D("p"),S=D("strong"),P=$(i[4]),R=$(" documents received"),N=I(),q=D("p"),ce=D("strong"),se=$(i[5]),We=$(" documents requested"),De=I(),de&&de.c(),pe=ie(),w(t,"class","flex-col py-4"),w(b,"class","svelte-1vxr72o"),w(k,"class","svelte-1vxr72o"),w(q,"class","svelte-1vxr72o"),w(p,"class","flex-col items-center py-4"),w(e,"class","flex flex-col")},m(V,fe){y(V,e,fe),m(e,t),m(t,n),m(n,r),m(n,s),m(s,a),m(t,o),m(t,l),m(l,c),m(l,f),m(f,h),m(e,d),m(e,p),m(p,g),m(p,C),m(p,b),m(b,E),m(E,A),m(b,F),m(p,T),m(p,k),m(k,S),m(S,P),m(k,R),m(p,N),m(p,q),m(q,ce),m(ce,se),m(q,We),y(V,De,fe),de&&de.m(V,fe),y(V,pe,fe)},p(V,fe){fe&2&&u!==(u=V[1].status+"")&&re(a,u),fe&128&&re(h,V[7]),fe&8&&re(A,V[3]),fe&16&&re(P,V[4]),fe&32&&re(se,V[5]),V[6]?de?de.p(V,fe):(de=$u(V),de.c(),de.m(pe.parentNode,pe)):de&&(de.d(1),de=null)},d(V){V&&_(e),V&&_(De),de&&de.d(V),V&&_(pe)}}}function $u(i){let e,t=i[2].length+"",n,r,s=i[2]>1?"Attachments":"Attachment",u,a,o,l=[],c=new Map,f=i[2];const h=d=>d[10].hash;for(let d=0;d<f.length;d+=1){let p=Ou(i,f,d),g=h(p);c.set(g,l[d]=ju(g,p))}return{c(){e=D("h4"),n=$(t),r=I(),u=$(s),a=I(),o=D("div");for(let d=0;d<l.length;d+=1)l[d].c();w(e,"class","py-4"),w(o,"class","flex flex-col py-4 h-50vh overflow-y-scroll svelte-1vxr72o")},m(d,p){y(d,e,p),m(e,n),m(e,r),m(e,u),y(d,a,p),y(d,o,p);for(let g=0;g<l.length;g+=1)l[g].m(o,null)},p(d,p){p&4&&t!==(t=d[2].length+"")&&re(n,t),p&4&&s!==(s=d[2]>1?"Attachments":"Attachment")&&re(u,s),p&4&&(f=d[2],l=Dt(l,p,h,1,d,f,c,o,Xn,ju,null,Ou))},d(d){d&&_(e),d&&_(a),d&&_(o);for(let p=0;p<l.length;p+=1)l[p].d()}}}function ju(i,e){let t,n,r,s=e[10].kind+"",u,a,o,l=e[10].status+"",c,f,h,d,p,g=e[10].bytesLoaded+"",C,b,E,A,F,T=e[10].totalBytes+"",k,S,P,R,N,q=e[10].author.slice(0,9)+"",ce,se,We;return{key:i,first:null,c(){t=D("div"),n=D("h5"),r=D("span"),u=$(s),a=I(),o=D("strong"),c=$(l),f=I(),h=D("p"),d=$("Bytes loaded: "),p=D("strong"),C=$(g),b=I(),E=D("p"),A=$("Total bytes: "),F=D("strong"),k=$(T),S=I(),P=D("p"),R=$("Author: "),N=D("strong"),ce=$(q),se=$("..."),We=I(),w(r,"class","kind svelte-1vxr72o"),w(h,"class","svelte-1vxr72o"),w(E,"class","svelte-1vxr72o"),w(P,"class","svelte-1vxr72o"),this.first=t},m(De,pe){y(De,t,pe),m(t,n),m(n,r),m(r,u),m(n,a),m(n,o),m(o,c),m(t,f),m(t,h),m(h,d),m(h,p),m(p,C),m(t,b),m(t,E),m(E,A),m(E,F),m(F,k),m(t,S),m(t,P),m(P,R),m(P,N),m(N,ce),m(N,se),m(t,We)},p(De,pe){e=De,pe&4&&s!==(s=e[10].kind+"")&&re(u,s),pe&4&&l!==(l=e[10].status+"")&&re(c,l),pe&4&&g!==(g=e[10].bytesLoaded+"")&&re(C,g),pe&4&&T!==(T=e[10].totalBytes+"")&&re(k,T),pe&4&&q!==(q=e[10].author.slice(0,9)+"")&&re(ce,q)},d(De){De&&_(t)}}}function im(i){let e,t,n,r,s,u,a,o=i[8].shareAddress+"",l,c,f,h,d,p=i[8].secret+"",g,C,b,E=ae.servers.length>0&&rm(i),A=i[0]!==void 0&&Lu(i);return{c(){e=D("div"),t=D("div"),n=D("h4"),n.textContent="Status Panel & Current Share Details",r=I(),s=D("p"),u=D("b"),u.textContent="Address:",a=I(),l=$(o),c=I(),f=D("p"),h=D("b"),h.textContent="Secret:",d=I(),g=$(p),C=I(),E&&E.c(),b=I(),A&&A.c(),w(n,"class","mb-6"),w(s,"class","svelte-1vxr72o"),w(f,"class","svelte-1vxr72o"),w(t,"class","flex flex-col items-left"),w(e,"class","flex flex-col mt-8 px-8 border-2 p-4")},m(F,T){y(F,e,T),m(e,t),m(t,n),m(t,r),m(t,s),m(s,u),m(s,a),m(s,l),m(t,c),m(t,f),m(f,h),m(f,d),m(f,g),m(e,C),E&&E.m(e,null),m(e,b),A&&A.m(e,null)},p(F,[T]){T&256&&o!==(o=F[8].shareAddress+"")&&re(l,o),T&256&&p!==(p=F[8].secret+"")&&re(g,p),ae.servers.length>0&&E.p(F,T),F[0]!==void 0?A?A.p(F,T):(A=Lu(F),A.c(),A.m(e,null)):A&&(A.d(1),A=null)},i:L,o:L,d(F){F&&_(e),E&&E.d(),A&&A.d()}}}function sm(i,e,t){let n;Be(i,Yn,d=>t(8,n=d));let{status:r=void 0}=e,s,u,a,o,l,c=!1,f,h;return Yn.subscribe(d=>{t(9,h=d.shareAddress),t(7,f=h.slice(0,8))}),i.$$set=d=>{"status"in d&&t(0,r=d.status)},i.$$.update=()=>{i.$$.dirty&519&&r&&r[h]&&(t(1,s=r[h].docs),t(2,u=r[h].attachments),t(3,a=s.sentCount),t(4,o=s.receivedCount),t(5,l=s.requestedCount),t(6,c=u&&u.length>0))},[r,s,u,a,o,l,c,f,n,h]}class um extends J{constructor(e){super(),Z(this,e,sm,im,Y,{status:0})}}function Uu(i){let e,t,n,r,s;return{c(){e=D("input"),t=I(),n=D("button"),n.textContent="Submit address",w(e,"type","text"),w(e,"spellcheck","false"),w(e,"placeholder","Add the secret for this share"),w(e,"class","svelte-16mc8a4"),w(n,"class","svelte-16mc8a4")},m(u,a){y(u,e,a),Ze(e,i[1]),y(u,t,a),y(u,n,a),r||(s=[j(e,"input",i[9]),j(n,"click",i[10])],r=!0)},p(u,a){a&2&&e.value!==u[1]&&Ze(e,u[1])},d(u){u&&_(e),u&&_(t),u&&_(n),r=!1,Ae(s)}}}function zu(i){let e,t,n;return{c(){e=D("p"),t=D("strong"),n=$(i[3])},m(r,s){y(r,e,s),m(e,t),m(t,n)},p(r,s){s&8&&re(n,r[3])},d(r){r&&_(e)}}}function om(i){let e,t,n,r,s,u,a,o,l=i[4]&&Uu(i),c=i[2]&&zu(i);return{c(){e=D("div"),t=D("input"),n=I(),r=D("button"),r.textContent="Submit address",s=I(),l&&l.c(),u=I(),c&&c.c(),w(t,"type","text"),w(t,"spellcheck","false"),w(t,"placeholder","Add a new share address"),w(t,"class","svelte-16mc8a4"),w(r,"class","svelte-16mc8a4"),w(e,"class","svelte-16mc8a4")},m(f,h){y(f,e,h),m(e,t),Ze(t,i[0]),m(e,n),m(e,r),m(e,s),l&&l.m(e,null),m(e,u),c&&c.m(e,null),a||(o=[j(t,"input",i[7]),j(r,"click",i[8])],a=!0)},p(f,[h]){h&1&&t.value!==f[0]&&Ze(t,f[0]),f[4]?l?l.p(f,h):(l=Uu(f),l.c(),l.m(e,u)):l&&(l.d(1),l=null),f[2]?c?c.p(f,h):(c=zu(f),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i:L,o:L,d(f){f&&_(e),l&&l.d(),c&&c.d(),a=!1,Ae(o)}}}function am(i,e,t){let n;Be(i,Yn,g=>t(11,n=g));let r,s,u=!1,a,o=!1;function l(g){if(M(zt(g))){t(2,u=!0),t(3,a="Not a valid share address");return}else t(2,u=!1),ae.addShare(g),t(4,o=!0),console.log("You are currently signed in as",ae.author||"no-one!"),console.log("You have",ae.shares.length,"shares"),console.log("Your shares are",ae.shares)}async function c(){let g={address:r,secret:s};const C=await we.checkKeypairIsValid(g);if(console.log(r,typeof r),console.log(s,typeof s),console.log(C),M(C)){t(2,u=!0),t(3,a="Not the right secret for this share.");return}else t(2,u=!1),ae.addSecret(r,s),console.log("You are currently signed in as",ae.author||"no-one!"),console.log("You have",ae.shares.length,"shares"),console.log("Your shares are",ae.shares),console.log("You know the secret to these shares:",ae.shareSecrets)}gt(()=>{n!==void 0&&(ae.addShare(n.shareAddress),ae.addSecret(n.shareAddress,n.secret))});function f(){r=this.value,t(0,r)}const h=()=>l(r);function d(){s=this.value,t(1,s)}return[r,s,u,a,o,l,c,f,h,d,()=>c()]}class lm extends J{constructor(e){super(),Z(this,e,am,om,Y,{})}}function cm(i){let e,t,n;return t=new lm({}),{c(){e=D("div"),U(t.$$.fragment)},m(r,s){y(r,e,s),z(t,e,null),n=!0},p:L,i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}class fm extends J{constructor(e){super(),Z(this,e,null,cm,Y,{})}}function Hu(i,e,t){const n=i.slice();return n[13]=e[t],n}function qu(i){let e;return{c(){e=D("p"),e.innerHTML="<strong>Server was added successfully!</strong>"},m(t,n){y(t,e,n)},d(t){t&&_(e)}}}function Wu(i){let e;return{c(){e=D("p"),e.innerHTML="<strong>Sync is complete!</strong>"},m(t,n){y(t,e,n)},d(t){t&&_(e)}}}function Vu(i){let e,t,n;return{c(){e=D("p"),t=D("strong"),n=$(i[4])},m(r,s){y(r,e,s),m(e,t),m(t,n)},p(r,s){s&16&&re(n,r[4])},d(r){r&&_(e)}}}function Ku(i,e){let t,n=e[13]+"",r;return{key:i,first:null,c(){t=D("option"),r=$(n),t.__value=e[13],t.value=t.__value,this.first=t},m(s,u){y(s,t,u),m(t,r)},p(s,u){e=s},d(s){s&&_(t)}}}function Qu(i){let e;return{c(){e=D("p"),e.innerHTML="<strong>Server was removed successfully!</strong>"},m(t,n){y(t,e,n)},d(t){t&&_(e)}}}function hm(i){let e,t,n,r,s,u,a,o,l,c,f,h=[],d=new Map,p,g,C,b,E,A=i[5]&&qu(),F=i[6]&&Wu(),T=i[3]&&Vu(i),k=ae.servers;const S=R=>R[13];for(let R=0;R<k.length;R+=1){let N=Hu(i,k,R),q=S(N);d.set(q,h[R]=Ku(q,N))}let P=i[2]&&Qu();return{c(){e=D("div"),t=D("input"),n=I(),r=D("button"),r.textContent="Add server",s=I(),A&&A.c(),u=I(),F&&F.c(),a=I(),T&&T.c(),o=I(),l=D("div"),c=D("select"),f=D("option"),f.textContent="Select a server to remove";for(let R=0;R<h.length;R+=1)h[R].c();p=I(),g=D("button"),g.textContent="Remove server",C=I(),P&&P.c(),w(t,"type","text"),w(t,"spellcheck","false"),w(t,"placeholder","Add a new server URL"),w(t,"class","svelte-s2f1tg"),w(r,"class","svelte-s2f1tg"),w(e,"class","svelte-s2f1tg"),f.__value="",f.value=f.__value,w(c,"class","svelte-s2f1tg"),i[1]===void 0&&vn(()=>i[11].call(c)),w(g,"class","svelte-s2f1tg"),w(l,"class","svelte-s2f1tg")},m(R,N){y(R,e,N),m(e,t),Ze(t,i[0]),m(e,n),m(e,r),m(e,s),A&&A.m(e,null),m(e,u),F&&F.m(e,null),m(e,a),T&&T.m(e,null),y(R,o,N),y(R,l,N),m(l,c),m(c,f);for(let q=0;q<h.length;q+=1)h[q].m(c,null);$i(c,i[1]),m(l,p),m(l,g),m(l,C),P&&P.m(l,null),b||(E=[j(t,"input",i[9]),j(r,"click",i[10]),j(c,"change",i[11]),j(g,"click",i[8])],b=!0)},p(R,[N]){N&1&&t.value!==R[0]&&Ze(t,R[0]),R[5]?A||(A=qu(),A.c(),A.m(e,u)):A&&(A.d(1),A=null),R[6]?F||(F=Wu(),F.c(),F.m(e,a)):F&&(F.d(1),F=null),R[3]?T?T.p(R,N):(T=Vu(R),T.c(),T.m(e,null)):T&&(T.d(1),T=null),N&0&&(k=ae.servers,h=Dt(h,N,S,1,R,k,d,c,Xn,Ku,null,Hu)),N&2&&$i(c,R[1]),R[2]?P||(P=Qu(),P.c(),P.m(l,null)):P&&(P.d(1),P=null)},i:L,o:L,d(R){R&&_(e),A&&A.d(),F&&F.d(),T&&T.d(),R&&_(o),R&&_(l);for(let N=0;N<h.length;N+=1)h[N].d();P&&P.d(),b=!1,Ae(E)}}}function dm(i,e,t){let n,r,s=!1,u=!1,a,o=!1,l=!1,c;bt.subscribe(C=>{c=C.replica});async function f(C){let b=ae.addServer(C);if(M(b)){t(3,u=!0),t(4,a="Not a valid server URL");return}else{t(3,u=!1),t(5,o=!0),console.log("You have",ae.servers.length,"servers"),console.log("Your servers are",ae.servers);const E=new nr;E.addReplica(c),await E.sync(C).isDone(),t(6,l=!0),console.log("Sync is done")}}function h(){let C=ae.removeServer(r);M(C)?(t(3,u=!0),t(4,a="Failed to remove server")):(t(3,u=!1),t(2,s=!0),console.log("You have",ae.servers.length,"servers"),console.log("Your servers are",ae.servers))}function d(){n=this.value,t(0,n)}const p=()=>f(n);function g(){r=Ka(this),t(1,r)}return[n,r,s,u,a,o,l,f,h,d,p,g]}class pm extends J{constructor(e){super(),Z(this,e,dm,hm,Y,{})}}function mm(i){let e,t,n,r=JSON.stringify(i[1],null,2)+"",s;return{c(){e=D("p"),e.textContent="Parsed Invitation:",t=I(),n=D("pre"),s=$(r)},m(u,a){y(u,e,a),y(u,t,a),y(u,n,a),m(n,s)},p(u,a){a&2&&r!==(r=JSON.stringify(u[1],null,2)+"")&&re(s,r)},d(u){u&&_(e),u&&_(t),u&&_(n)}}}function gm(i){let e;return{c(){e=D("p"),e.textContent="Successfully redeemed invitation!"},m(t,n){y(t,e,n)},p:L,d(t){t&&_(e)}}}function Dm(i){let e,t,n=i[2].message+"",r;return{c(){e=D("p"),t=$("Error: "),r=$(n)},m(s,u){y(s,e,u),m(e,t),m(e,r)},p(s,u){u&4&&n!==(n=s[2].message+"")&&re(r,n)},d(s){s&&_(e)}}}function bm(i){let e,t,n,r,s,u,a;function o(f,h){if(f[2])return Dm;if(f[3])return gm;if(f[1])return mm}let l=o(i),c=l&&l(i);return{c(){e=D("input"),t=I(),n=D("button"),n.textContent="Redeem Invitation URL",r=I(),c&&c.c(),s=ie(),w(e,"class","my-2 svelte-1xrndge"),w(e,"type","text"),w(e,"placeholder","Enter invitation URL")},m(f,h){y(f,e,h),Ze(e,i[0]),y(f,t,h),y(f,n,h),y(f,r,h),c&&c.m(f,h),y(f,s,h),u||(a=[j(e,"input",i[5]),j(n,"click",i[4])],u=!0)},p(f,[h]){h&1&&e.value!==f[0]&&Ze(e,f[0]),l===(l=o(f))&&c?c.p(f,h):(c&&c.d(1),c=l&&l(f),c&&(c.c(),c.m(s.parentNode,s)))},i:L,o:L,d(f){f&&_(e),f&&_(t),f&&_(n),f&&_(r),c&&c.d(f),f&&_(s),u=!1,Ae(a)}}}function wm(i,e,t){let n="",r,s,u=!1;const a=async()=>{try{const c=await ae.redeemInvitationURL(n);c===!0?(t(3,u=!0),t(2,s=null)):(t(2,s=c),t(3,u=!1))}catch(c){t(2,s=c),t(3,u=!1)}},o=async()=>{await a()};function l(){n=this.value,t(0,n)}return[n,r,s,u,o,l]}class ym extends J{constructor(e){super(),Z(this,e,wm,bm,Y,{})}}var ir={},_m=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},ya={},ut={};let Ii;const Am=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];ut.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};ut.getSymbolTotalCodewords=function(e){return Am[e]};ut.getBCHDigit=function(i){let e=0;for(;i!==0;)e++,i>>>=1;return e};ut.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');Ii=e};ut.isKanjiModeEnabled=function(){return typeof Ii<"u"};ut.toSJIS=function(e){return Ii(e)};var jr={};(function(i){i.L={bit:1},i.M={bit:0},i.Q={bit:3},i.H={bit:2};function e(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"l":case"low":return i.L;case"m":case"medium":return i.M;case"q":case"quartile":return i.Q;case"h":case"high":return i.H;default:throw new Error("Unknown EC Level: "+t)}}i.isValid=function(n){return n&&typeof n.bit<"u"&&n.bit>=0&&n.bit<4},i.from=function(n,r){if(i.isValid(n))return n;try{return e(n)}catch{return r}}})(jr);function _a(){this.buffer=[],this.length=0}_a.prototype={get:function(i){const e=Math.floor(i/8);return(this.buffer[e]>>>7-i%8&1)===1},put:function(i,e){for(let t=0;t<e;t++)this.putBit((i>>>e-t-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(i){const e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),i&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var Cm=_a;function sr(i){if(!i||i<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=i,this.data=new Uint8Array(i*i),this.reservedBit=new Uint8Array(i*i)}sr.prototype.set=function(i,e,t,n){const r=i*this.size+e;this.data[r]=t,n&&(this.reservedBit[r]=!0)};sr.prototype.get=function(i,e){return this.data[i*this.size+e]};sr.prototype.xor=function(i,e,t){this.data[i*this.size+e]^=t};sr.prototype.isReserved=function(i,e){return this.reservedBit[i*this.size+e]};var Em=sr,Aa={};(function(i){const e=ut.getSymbolSize;i.getRowColCoords=function(n){if(n===1)return[];const r=Math.floor(n/7)+2,s=e(n),u=s===145?26:Math.ceil((s-13)/(2*r-2))*2,a=[s-7];for(let o=1;o<r-1;o++)a[o]=a[o-1]-u;return a.push(6),a.reverse()},i.getPositions=function(n){const r=[],s=i.getRowColCoords(n),u=s.length;for(let a=0;a<u;a++)for(let o=0;o<u;o++)a===0&&o===0||a===0&&o===u-1||a===u-1&&o===0||r.push([s[a],s[o]]);return r}})(Aa);var Ca={};const vm=ut.getSymbolSize,Gu=7;Ca.getPositions=function(e){const t=vm(e);return[[0,0],[t-Gu,0],[0,t-Gu]]};var Ea={};(function(i){i.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};i.isValid=function(r){return r!=null&&r!==""&&!isNaN(r)&&r>=0&&r<=7},i.from=function(r){return i.isValid(r)?parseInt(r,10):void 0},i.getPenaltyN1=function(r){const s=r.size;let u=0,a=0,o=0,l=null,c=null;for(let f=0;f<s;f++){a=o=0,l=c=null;for(let h=0;h<s;h++){let d=r.get(f,h);d===l?a++:(a>=5&&(u+=e.N1+(a-5)),l=d,a=1),d=r.get(h,f),d===c?o++:(o>=5&&(u+=e.N1+(o-5)),c=d,o=1)}a>=5&&(u+=e.N1+(a-5)),o>=5&&(u+=e.N1+(o-5))}return u},i.getPenaltyN2=function(r){const s=r.size;let u=0;for(let a=0;a<s-1;a++)for(let o=0;o<s-1;o++){const l=r.get(a,o)+r.get(a,o+1)+r.get(a+1,o)+r.get(a+1,o+1);(l===4||l===0)&&u++}return u*e.N2},i.getPenaltyN3=function(r){const s=r.size;let u=0,a=0,o=0;for(let l=0;l<s;l++){a=o=0;for(let c=0;c<s;c++)a=a<<1&2047|r.get(l,c),c>=10&&(a===1488||a===93)&&u++,o=o<<1&2047|r.get(c,l),c>=10&&(o===1488||o===93)&&u++}return u*e.N3},i.getPenaltyN4=function(r){let s=0;const u=r.data.length;for(let o=0;o<u;o++)s+=r.data[o];return Math.abs(Math.ceil(s*100/u/5)-10)*e.N4};function t(n,r,s){switch(n){case i.Patterns.PATTERN000:return(r+s)%2===0;case i.Patterns.PATTERN001:return r%2===0;case i.Patterns.PATTERN010:return s%3===0;case i.Patterns.PATTERN011:return(r+s)%3===0;case i.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(s/3))%2===0;case i.Patterns.PATTERN101:return r*s%2+r*s%3===0;case i.Patterns.PATTERN110:return(r*s%2+r*s%3)%2===0;case i.Patterns.PATTERN111:return(r*s%3+(r+s)%2)%2===0;default:throw new Error("bad maskPattern:"+n)}}i.applyMask=function(r,s){const u=s.size;for(let a=0;a<u;a++)for(let o=0;o<u;o++)s.isReserved(o,a)||s.xor(o,a,t(r,o,a))},i.getBestMask=function(r,s){const u=Object.keys(i.Patterns).length;let a=0,o=1/0;for(let l=0;l<u;l++){s(l),i.applyMask(l,r);const c=i.getPenaltyN1(r)+i.getPenaltyN2(r)+i.getPenaltyN3(r)+i.getPenaltyN4(r);i.applyMask(l,r),c<o&&(o=c,a=l)}return a}})(Ea);var Ur={};const Mt=jr,wr=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],yr=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];Ur.getBlocksCount=function(e,t){switch(t){case Mt.L:return wr[(e-1)*4+0];case Mt.M:return wr[(e-1)*4+1];case Mt.Q:return wr[(e-1)*4+2];case Mt.H:return wr[(e-1)*4+3];default:return}};Ur.getTotalCodewordsCount=function(e,t){switch(t){case Mt.L:return yr[(e-1)*4+0];case Mt.M:return yr[(e-1)*4+1];case Mt.Q:return yr[(e-1)*4+2];case Mt.H:return yr[(e-1)*4+3];default:return}};var va={},zr={};const Wn=new Uint8Array(512),Br=new Uint8Array(256);(function(){let e=1;for(let t=0;t<255;t++)Wn[t]=e,Br[e]=t,e<<=1,e&256&&(e^=285);for(let t=255;t<512;t++)Wn[t]=Wn[t-255]})();zr.log=function(e){if(e<1)throw new Error("log("+e+")");return Br[e]};zr.exp=function(e){return Wn[e]};zr.mul=function(e,t){return e===0||t===0?0:Wn[Br[e]+Br[t]]};(function(i){const e=zr;i.mul=function(n,r){const s=new Uint8Array(n.length+r.length-1);for(let u=0;u<n.length;u++)for(let a=0;a<r.length;a++)s[u+a]^=e.mul(n[u],r[a]);return s},i.mod=function(n,r){let s=new Uint8Array(n);for(;s.length-r.length>=0;){const u=s[0];for(let o=0;o<r.length;o++)s[o]^=e.mul(r[o],u);let a=0;for(;a<s.length&&s[a]===0;)a++;s=s.slice(a)}return s},i.generateECPolynomial=function(n){let r=new Uint8Array([1]);for(let s=0;s<n;s++)r=i.mul(r,new Uint8Array([1,e.exp(s)]));return r}})(va);const ka=va;function Pi(i){this.genPoly=void 0,this.degree=i,this.degree&&this.initialize(this.degree)}Pi.prototype.initialize=function(e){this.degree=e,this.genPoly=ka.generateECPolynomial(this.degree)};Pi.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(e.length+this.degree);t.set(e);const n=ka.mod(t,this.genPoly),r=this.degree-n.length;if(r>0){const s=new Uint8Array(this.degree);return s.set(n,r),s}return n};var km=Pi,Fa={},Ht={},Ri={};Ri.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40};var wt={};const Ba="[0-9]+",Fm="[A-Z $%*+\\-./:]+";let Jn="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";Jn=Jn.replace(/u/g,"\\u");const Bm="(?:(?![A-Z0-9 $%*+\\-./:]|"+Jn+`)(?:.|[\r
]))+`;wt.KANJI=new RegExp(Jn,"g");wt.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");wt.BYTE=new RegExp(Bm,"g");wt.NUMERIC=new RegExp(Ba,"g");wt.ALPHANUMERIC=new RegExp(Fm,"g");const Sm=new RegExp("^"+Jn+"$"),Tm=new RegExp("^"+Ba+"$"),Im=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");wt.testKanji=function(e){return Sm.test(e)};wt.testNumeric=function(e){return Tm.test(e)};wt.testAlphanumeric=function(e){return Im.test(e)};(function(i){const e=Ri,t=wt;i.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},i.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},i.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},i.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},i.MIXED={bit:-1},i.getCharCountIndicator=function(s,u){if(!s.ccBits)throw new Error("Invalid mode: "+s);if(!e.isValid(u))throw new Error("Invalid version: "+u);return u>=1&&u<10?s.ccBits[0]:u<27?s.ccBits[1]:s.ccBits[2]},i.getBestModeForData=function(s){return t.testNumeric(s)?i.NUMERIC:t.testAlphanumeric(s)?i.ALPHANUMERIC:t.testKanji(s)?i.KANJI:i.BYTE},i.toString=function(s){if(s&&s.id)return s.id;throw new Error("Invalid mode")},i.isValid=function(s){return s&&s.bit&&s.ccBits};function n(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"numeric":return i.NUMERIC;case"alphanumeric":return i.ALPHANUMERIC;case"kanji":return i.KANJI;case"byte":return i.BYTE;default:throw new Error("Unknown mode: "+r)}}i.from=function(s,u){if(i.isValid(s))return s;try{return n(s)}catch{return u}}})(Ht);(function(i){const e=ut,t=Ur,n=jr,r=Ht,s=Ri,u=7973,a=e.getBCHDigit(u);function o(h,d,p){for(let g=1;g<=40;g++)if(d<=i.getCapacity(g,p,h))return g}function l(h,d){return r.getCharCountIndicator(h,d)+4}function c(h,d){let p=0;return h.forEach(function(g){const C=l(g.mode,d);p+=C+g.getBitsLength()}),p}function f(h,d){for(let p=1;p<=40;p++)if(c(h,p)<=i.getCapacity(p,d,r.MIXED))return p}i.from=function(d,p){return s.isValid(d)?parseInt(d,10):p},i.getCapacity=function(d,p,g){if(!s.isValid(d))throw new Error("Invalid QR Code version");typeof g>"u"&&(g=r.BYTE);const C=e.getSymbolTotalCodewords(d),b=t.getTotalCodewordsCount(d,p),E=(C-b)*8;if(g===r.MIXED)return E;const A=E-l(g,d);switch(g){case r.NUMERIC:return Math.floor(A/10*3);case r.ALPHANUMERIC:return Math.floor(A/11*2);case r.KANJI:return Math.floor(A/13);case r.BYTE:default:return Math.floor(A/8)}},i.getBestVersionForData=function(d,p){let g;const C=n.from(p,n.M);if(Array.isArray(d)){if(d.length>1)return f(d,C);if(d.length===0)return 1;g=d[0]}else g=d;return o(g.mode,g.getLength(),C)},i.getEncodedBits=function(d){if(!s.isValid(d)||d<7)throw new Error("Invalid QR Code version");let p=d<<12;for(;e.getBCHDigit(p)-a>=0;)p^=u<<e.getBCHDigit(p)-a;return d<<12|p}})(Fa);var Sa={};const gi=ut,Ta=1335,Pm=21522,Yu=gi.getBCHDigit(Ta);Sa.getEncodedBits=function(e,t){const n=e.bit<<3|t;let r=n<<10;for(;gi.getBCHDigit(r)-Yu>=0;)r^=Ta<<gi.getBCHDigit(r)-Yu;return(n<<10|r)^Pm};var Ia={};const Rm=Ht;function _n(i){this.mode=Rm.NUMERIC,this.data=i.toString()}_n.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};_n.prototype.getLength=function(){return this.data.length};_n.prototype.getBitsLength=function(){return _n.getBitsLength(this.data.length)};_n.prototype.write=function(e){let t,n,r;for(t=0;t+3<=this.data.length;t+=3)n=this.data.substr(t,3),r=parseInt(n,10),e.put(r,10);const s=this.data.length-t;s>0&&(n=this.data.substr(t),r=parseInt(n,10),e.put(r,s*3+1))};var xm=_n;const Om=Ht,ri=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function An(i){this.mode=Om.ALPHANUMERIC,this.data=i}An.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};An.prototype.getLength=function(){return this.data.length};An.prototype.getBitsLength=function(){return An.getBitsLength(this.data.length)};An.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let n=ri.indexOf(this.data[t])*45;n+=ri.indexOf(this.data[t+1]),e.put(n,11)}this.data.length%2&&e.put(ri.indexOf(this.data[t]),6)};var Mm=An,Nm=function(e){for(var t=[],n=e.length,r=0;r<n;r++){var s=e.charCodeAt(r);if(s>=55296&&s<=56319&&n>r+1){var u=e.charCodeAt(r+1);u>=56320&&u<=57343&&(s=(s-55296)*1024+u-56320+65536,r+=1)}if(s<128){t.push(s);continue}if(s<2048){t.push(s>>6|192),t.push(s&63|128);continue}if(s<55296||s>=57344&&s<65536){t.push(s>>12|224),t.push(s>>6&63|128),t.push(s&63|128);continue}if(s>=65536&&s<=1114111){t.push(s>>18|240),t.push(s>>12&63|128),t.push(s>>6&63|128),t.push(s&63|128);continue}t.push(239,191,189)}return new Uint8Array(t).buffer};const Lm=Nm,$m=Ht;function Cn(i){this.mode=$m.BYTE,typeof i=="string"&&(i=Lm(i)),this.data=new Uint8Array(i)}Cn.getBitsLength=function(e){return e*8};Cn.prototype.getLength=function(){return this.data.length};Cn.prototype.getBitsLength=function(){return Cn.getBitsLength(this.data.length)};Cn.prototype.write=function(i){for(let e=0,t=this.data.length;e<t;e++)i.put(this.data[e],8)};var jm=Cn;const Um=Ht,zm=ut;function En(i){this.mode=Um.KANJI,this.data=i}En.getBitsLength=function(e){return e*13};En.prototype.getLength=function(){return this.data.length};En.prototype.getBitsLength=function(){return En.getBitsLength(this.data.length)};En.prototype.write=function(i){let e;for(e=0;e<this.data.length;e++){let t=zm.toSJIS(this.data[e]);if(t>=33088&&t<=40956)t-=33088;else if(t>=57408&&t<=60351)t-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);t=(t>>>8&255)*192+(t&255),i.put(t,13)}};var Hm=En,Pa={exports:{}};(function(i){var e={single_source_shortest_paths:function(t,n,r){var s={},u={};u[n]=0;var a=e.PriorityQueue.make();a.push(n,0);for(var o,l,c,f,h,d,p,g,C;!a.empty();){o=a.pop(),l=o.value,f=o.cost,h=t[l]||{};for(c in h)h.hasOwnProperty(c)&&(d=h[c],p=f+d,g=u[c],C=typeof u[c]>"u",(C||g>p)&&(u[c]=p,a.push(c,p),s[c]=l))}if(typeof r<"u"&&typeof u[r]>"u"){var b=["Could not find a path from ",n," to ",r,"."].join("");throw new Error(b)}return s},extract_shortest_path_from_predecessor_list:function(t,n){for(var r=[],s=n;s;)r.push(s),t[s],s=t[s];return r.reverse(),r},find_path:function(t,n,r){var s=e.single_source_shortest_paths(t,n,r);return e.extract_shortest_path_from_predecessor_list(s,r)},PriorityQueue:{make:function(t){var n=e.PriorityQueue,r={},s;t=t||{};for(s in n)n.hasOwnProperty(s)&&(r[s]=n[s]);return r.queue=[],r.sorter=t.sorter||n.default_sorter,r},default_sorter:function(t,n){return t.cost-n.cost},push:function(t,n){var r={value:t,cost:n};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};i.exports=e})(Pa);var qm=Pa.exports;(function(i){const e=Ht,t=xm,n=Mm,r=jm,s=Hm,u=wt,a=ut,o=qm;function l(b){return unescape(encodeURIComponent(b)).length}function c(b,E,A){const F=[];let T;for(;(T=b.exec(A))!==null;)F.push({data:T[0],index:T.index,mode:E,length:T[0].length});return F}function f(b){const E=c(u.NUMERIC,e.NUMERIC,b),A=c(u.ALPHANUMERIC,e.ALPHANUMERIC,b);let F,T;return a.isKanjiModeEnabled()?(F=c(u.BYTE,e.BYTE,b),T=c(u.KANJI,e.KANJI,b)):(F=c(u.BYTE_KANJI,e.BYTE,b),T=[]),E.concat(A,F,T).sort(function(S,P){return S.index-P.index}).map(function(S){return{data:S.data,mode:S.mode,length:S.length}})}function h(b,E){switch(E){case e.NUMERIC:return t.getBitsLength(b);case e.ALPHANUMERIC:return n.getBitsLength(b);case e.KANJI:return s.getBitsLength(b);case e.BYTE:return r.getBitsLength(b)}}function d(b){return b.reduce(function(E,A){const F=E.length-1>=0?E[E.length-1]:null;return F&&F.mode===A.mode?(E[E.length-1].data+=A.data,E):(E.push(A),E)},[])}function p(b){const E=[];for(let A=0;A<b.length;A++){const F=b[A];switch(F.mode){case e.NUMERIC:E.push([F,{data:F.data,mode:e.ALPHANUMERIC,length:F.length},{data:F.data,mode:e.BYTE,length:F.length}]);break;case e.ALPHANUMERIC:E.push([F,{data:F.data,mode:e.BYTE,length:F.length}]);break;case e.KANJI:E.push([F,{data:F.data,mode:e.BYTE,length:l(F.data)}]);break;case e.BYTE:E.push([{data:F.data,mode:e.BYTE,length:l(F.data)}])}}return E}function g(b,E){const A={},F={start:{}};let T=["start"];for(let k=0;k<b.length;k++){const S=b[k],P=[];for(let R=0;R<S.length;R++){const N=S[R],q=""+k+R;P.push(q),A[q]={node:N,lastCount:0},F[q]={};for(let ce=0;ce<T.length;ce++){const se=T[ce];A[se]&&A[se].node.mode===N.mode?(F[se][q]=h(A[se].lastCount+N.length,N.mode)-h(A[se].lastCount,N.mode),A[se].lastCount+=N.length):(A[se]&&(A[se].lastCount=N.length),F[se][q]=h(N.length,N.mode)+4+e.getCharCountIndicator(N.mode,E))}}T=P}for(let k=0;k<T.length;k++)F[T[k]].end=0;return{map:F,table:A}}function C(b,E){let A;const F=e.getBestModeForData(b);if(A=e.from(E,F),A!==e.BYTE&&A.bit<F.bit)throw new Error('"'+b+'" cannot be encoded with mode '+e.toString(A)+`.
 Suggested mode is: `+e.toString(F));switch(A===e.KANJI&&!a.isKanjiModeEnabled()&&(A=e.BYTE),A){case e.NUMERIC:return new t(b);case e.ALPHANUMERIC:return new n(b);case e.KANJI:return new s(b);case e.BYTE:return new r(b)}}i.fromArray=function(E){return E.reduce(function(A,F){return typeof F=="string"?A.push(C(F,null)):F.data&&A.push(C(F.data,F.mode)),A},[])},i.fromString=function(E,A){const F=f(E,a.isKanjiModeEnabled()),T=p(F),k=g(T,A),S=o.find_path(k.map,"start","end"),P=[];for(let R=1;R<S.length-1;R++)P.push(k.table[S[R]].node);return i.fromArray(d(P))},i.rawSplit=function(E){return i.fromArray(f(E,a.isKanjiModeEnabled()))}})(Ia);const Hr=ut,ii=jr,Wm=Cm,Vm=Em,Km=Aa,Qm=Ca,Di=Ea,bi=Ur,Gm=km,Sr=Fa,Ym=Sa,Jm=Ht,si=Ia;function Zm(i,e){const t=i.size,n=Qm.getPositions(e);for(let r=0;r<n.length;r++){const s=n[r][0],u=n[r][1];for(let a=-1;a<=7;a++)if(!(s+a<=-1||t<=s+a))for(let o=-1;o<=7;o++)u+o<=-1||t<=u+o||(a>=0&&a<=6&&(o===0||o===6)||o>=0&&o<=6&&(a===0||a===6)||a>=2&&a<=4&&o>=2&&o<=4?i.set(s+a,u+o,!0,!0):i.set(s+a,u+o,!1,!0))}}function Xm(i){const e=i.size;for(let t=8;t<e-8;t++){const n=t%2===0;i.set(t,6,n,!0),i.set(6,t,n,!0)}}function eg(i,e){const t=Km.getPositions(e);for(let n=0;n<t.length;n++){const r=t[n][0],s=t[n][1];for(let u=-2;u<=2;u++)for(let a=-2;a<=2;a++)u===-2||u===2||a===-2||a===2||u===0&&a===0?i.set(r+u,s+a,!0,!0):i.set(r+u,s+a,!1,!0)}}function tg(i,e){const t=i.size,n=Sr.getEncodedBits(e);let r,s,u;for(let a=0;a<18;a++)r=Math.floor(a/3),s=a%3+t-8-3,u=(n>>a&1)===1,i.set(r,s,u,!0),i.set(s,r,u,!0)}function ui(i,e,t){const n=i.size,r=Ym.getEncodedBits(e,t);let s,u;for(s=0;s<15;s++)u=(r>>s&1)===1,s<6?i.set(s,8,u,!0):s<8?i.set(s+1,8,u,!0):i.set(n-15+s,8,u,!0),s<8?i.set(8,n-s-1,u,!0):s<9?i.set(8,15-s-1+1,u,!0):i.set(8,15-s-1,u,!0);i.set(n-8,8,1,!0)}function ng(i,e){const t=i.size;let n=-1,r=t-1,s=7,u=0;for(let a=t-1;a>0;a-=2)for(a===6&&a--;;){for(let o=0;o<2;o++)if(!i.isReserved(r,a-o)){let l=!1;u<e.length&&(l=(e[u]>>>s&1)===1),i.set(r,a-o,l),s--,s===-1&&(u++,s=7)}if(r+=n,r<0||t<=r){r-=n,n=-n;break}}}function rg(i,e,t){const n=new Wm;t.forEach(function(o){n.put(o.mode.bit,4),n.put(o.getLength(),Jm.getCharCountIndicator(o.mode,i)),o.write(n)});const r=Hr.getSymbolTotalCodewords(i),s=bi.getTotalCodewordsCount(i,e),u=(r-s)*8;for(n.getLengthInBits()+4<=u&&n.put(0,4);n.getLengthInBits()%8!==0;)n.putBit(0);const a=(u-n.getLengthInBits())/8;for(let o=0;o<a;o++)n.put(o%2?17:236,8);return ig(n,i,e)}function ig(i,e,t){const n=Hr.getSymbolTotalCodewords(e),r=bi.getTotalCodewordsCount(e,t),s=n-r,u=bi.getBlocksCount(e,t),a=n%u,o=u-a,l=Math.floor(n/u),c=Math.floor(s/u),f=c+1,h=l-c,d=new Gm(h);let p=0;const g=new Array(u),C=new Array(u);let b=0;const E=new Uint8Array(i.buffer);for(let S=0;S<u;S++){const P=S<o?c:f;g[S]=E.slice(p,p+P),C[S]=d.encode(g[S]),p+=P,b=Math.max(b,P)}const A=new Uint8Array(n);let F=0,T,k;for(T=0;T<b;T++)for(k=0;k<u;k++)T<g[k].length&&(A[F++]=g[k][T]);for(T=0;T<h;T++)for(k=0;k<u;k++)A[F++]=C[k][T];return A}function sg(i,e,t,n){let r;if(Array.isArray(i))r=si.fromArray(i);else if(typeof i=="string"){let l=e;if(!l){const c=si.rawSplit(i);l=Sr.getBestVersionForData(c,t)}r=si.fromString(i,l||40)}else throw new Error("Invalid data");const s=Sr.getBestVersionForData(r,t);if(!s)throw new Error("The amount of data is too big to be stored in a QR Code");if(!e)e=s;else if(e<s)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+s+`.
`);const u=rg(e,t,r),a=Hr.getSymbolSize(e),o=new Vm(a);return Zm(o,e),Xm(o),eg(o,e),ui(o,t,0),e>=7&&tg(o,e),ng(o,u),isNaN(n)&&(n=Di.getBestMask(o,ui.bind(null,o,t))),Di.applyMask(n,o),ui(o,t,n),{modules:o,version:e,errorCorrectionLevel:t,maskPattern:n,segments:r}}ya.create=function(e,t){if(typeof e>"u"||e==="")throw new Error("No input text");let n=ii.M,r,s;return typeof t<"u"&&(n=ii.from(t.errorCorrectionLevel,ii.M),r=Sr.from(t.version),s=Di.from(t.maskPattern),t.toSJISFunc&&Hr.setToSJISFunction(t.toSJISFunc)),sg(e,r,n,s)};var Ra={},xi={};(function(i){function e(t){if(typeof t=="number"&&(t=t.toString()),typeof t!="string")throw new Error("Color should be defined as hex string");let n=t.slice().replace("#","").split("");if(n.length<3||n.length===5||n.length>8)throw new Error("Invalid hex color: "+t);(n.length===3||n.length===4)&&(n=Array.prototype.concat.apply([],n.map(function(s){return[s,s]}))),n.length===6&&n.push("F","F");const r=parseInt(n.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:r&255,hex:"#"+n.slice(0,6).join("")}}i.getOptions=function(n){n||(n={}),n.color||(n.color={});const r=typeof n.margin>"u"||n.margin===null||n.margin<0?4:n.margin,s=n.width&&n.width>=21?n.width:void 0,u=n.scale||4;return{width:s,scale:s?4:u,margin:r,color:{dark:e(n.color.dark||"#000000ff"),light:e(n.color.light||"#ffffffff")},type:n.type,rendererOpts:n.rendererOpts||{}}},i.getScale=function(n,r){return r.width&&r.width>=n+r.margin*2?r.width/(n+r.margin*2):r.scale},i.getImageWidth=function(n,r){const s=i.getScale(n,r);return Math.floor((n+r.margin*2)*s)},i.qrToImageData=function(n,r,s){const u=r.modules.size,a=r.modules.data,o=i.getScale(u,s),l=Math.floor((u+s.margin*2)*o),c=s.margin*o,f=[s.color.light,s.color.dark];for(let h=0;h<l;h++)for(let d=0;d<l;d++){let p=(h*l+d)*4,g=s.color.light;if(h>=c&&d>=c&&h<l-c&&d<l-c){const C=Math.floor((h-c)/o),b=Math.floor((d-c)/o);g=f[a[C*u+b]?1:0]}n[p++]=g.r,n[p++]=g.g,n[p++]=g.b,n[p]=g.a}}})(xi);(function(i){const e=xi;function t(r,s,u){r.clearRect(0,0,s.width,s.height),s.style||(s.style={}),s.height=u,s.width=u,s.style.height=u+"px",s.style.width=u+"px"}function n(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}i.render=function(s,u,a){let o=a,l=u;typeof o>"u"&&(!u||!u.getContext)&&(o=u,u=void 0),u||(l=n()),o=e.getOptions(o);const c=e.getImageWidth(s.modules.size,o),f=l.getContext("2d"),h=f.createImageData(c,c);return e.qrToImageData(h.data,s,o),t(f,l,c),f.putImageData(h,0,0),l},i.renderToDataURL=function(s,u,a){let o=a;typeof o>"u"&&(!u||!u.getContext)&&(o=u,u=void 0),o||(o={});const l=i.render(s,u,o),c=o.type||"image/png",f=o.rendererOpts||{};return l.toDataURL(c,f.quality)}})(Ra);var xa={};const ug=xi;function Ju(i,e){const t=i.a/255,n=e+'="'+i.hex+'"';return t<1?n+" "+e+'-opacity="'+t.toFixed(2).slice(1)+'"':n}function oi(i,e,t){let n=i+e;return typeof t<"u"&&(n+=" "+t),n}function og(i,e,t){let n="",r=0,s=!1,u=0;for(let a=0;a<i.length;a++){const o=Math.floor(a%e),l=Math.floor(a/e);!o&&!s&&(s=!0),i[a]?(u++,a>0&&o>0&&i[a-1]||(n+=s?oi("M",o+t,.5+l+t):oi("m",r,0),r=0,s=!1),o+1<e&&i[a+1]||(n+=oi("h",u),u=0)):r++}return n}xa.render=function(e,t,n){const r=ug.getOptions(t),s=e.modules.size,u=e.modules.data,a=s+r.margin*2,o=r.color.light.a?"<path "+Ju(r.color.light,"fill")+' d="M0 0h'+a+"v"+a+'H0z"/>':"",l="<path "+Ju(r.color.dark,"stroke")+' d="'+og(u,s,r.margin)+'"/>',c='viewBox="0 0 '+a+" "+a+'"',h='<svg xmlns="http://www.w3.org/2000/svg" '+(r.width?'width="'+r.width+'" height="'+r.width+'" ':"")+c+' shape-rendering="crispEdges">'+o+l+`</svg>
`;return typeof n=="function"&&n(null,h),h};const ag=_m,wi=ya,Oa=Ra,lg=xa;function Oi(i,e,t,n,r){const s=[].slice.call(arguments,1),u=s.length,a=typeof s[u-1]=="function";if(!a&&!ag())throw new Error("Callback required as last argument");if(a){if(u<2)throw new Error("Too few arguments provided");u===2?(r=t,t=e,e=n=void 0):u===3&&(e.getContext&&typeof r>"u"?(r=n,n=void 0):(r=n,n=t,t=e,e=void 0))}else{if(u<1)throw new Error("Too few arguments provided");return u===1?(t=e,e=n=void 0):u===2&&!e.getContext&&(n=t,t=e,e=void 0),new Promise(function(o,l){try{const c=wi.create(t,n);o(i(c,e,n))}catch(c){l(c)}})}try{const o=wi.create(t,n);r(null,i(o,e,n))}catch(o){r(o)}}ir.create=wi.create;ir.toCanvas=Oi.bind(null,Oa.render);ir.toDataURL=Oi.bind(null,Oa.renderToDataURL);ir.toString=Oi.bind(null,function(i,e,t){return lg.render(i,t)});function cg(i){let e,t;return{c(){e=D("div"),w(e,"id","qrcode")},m(n,r){y(n,e,r),i[3](e)},p:L,i(n){t||vn(()=>{t=Qa(e,Mf,{duration:300}),t.start()})},o:L,d(n){n&&_(e),i[3](null)}}}function fg(i,e,t){let{codeValue:n}=e,{squareSize:r}=e,s,u;gt(async()=>{u=await ir.toCanvas(n,{width:r,small:!0,color:{dark:"#000000",light:"#ffffff"}}),s.appendChild(u)}),Ga(()=>{u&&u.remove()});function a(o){nn[o?"unshift":"push"](()=>{s=o,t(0,s)})}return i.$$set=o=>{"codeValue"in o&&t(1,n=o.codeValue),"squareSize"in o&&t(2,r=o.squareSize)},[s,n,r,a]}class hg extends J{constructor(e){super(),Z(this,e,fg,cg,Y,{codeValue:1,squareSize:2})}}function Zu(i){let e,t,n,r,s,u,a,o,l,c,f,h,d,p;function g(k,S){return k[2]?dg:pg}let C=g(i),b=C(i);function E(k,S){return k[3]?gg:mg}let A=E(i),F=A(i),T=i[3]&&Xu(i);return{c(){e=D("p"),t=D("strong"),t.textContent="Your invitation URL is:",n=I(),r=D("span"),s=$(i[1]),u=I(),b.c(),a=I(),o=D("button"),F.c(),l=$(`
        QR code`),c=I(),T&&T.c(),f=ie(),w(r,"class","break-all text-xs"),w(e,"class","py-2"),w(o,"class","mt-2")},m(k,S){y(k,e,S),m(e,t),m(e,n),m(e,r),m(r,s),y(k,u,S),b.m(k,S),y(k,a,S),y(k,o,S),F.m(o,null),m(o,l),y(k,c,S),T&&T.m(k,S),y(k,f,S),h=!0,d||(p=j(o,"click",i[6]),d=!0)},p(k,S){(!h||S&2)&&re(s,k[1]),C===(C=g(k))&&b?b.p(k,S):(b.d(1),b=C(k),b&&(b.c(),b.m(a.parentNode,a))),A!==(A=E(k))&&(F.d(1),F=A(k),F&&(F.c(),F.m(o,l))),k[3]?T?(T.p(k,S),S&8&&v(T,1)):(T=Xu(k),T.c(),v(T,1),T.m(f.parentNode,f)):T&&(K(),B(T,1,1,()=>{T=null}),Q())},i(k){h||(v(T),h=!0)},o(k){B(T),h=!1},d(k){k&&_(e),k&&_(u),b.d(k),k&&_(a),k&&_(o),F.d(),k&&_(c),T&&T.d(k),k&&_(f),d=!1,p()}}}function dg(i){let e,t,n;return{c(){e=D("button"),e.textContent="URL copied to clipboard!"},m(r,s){y(r,e,s),t||(n=j(e,"click",i[5]),t=!0)},p:L,d(r){r&&_(e),t=!1,n()}}}function pg(i){let e,t,n;return{c(){e=D("button"),e.textContent="Copy URL to clipboard"},m(r,s){y(r,e,s),t||(n=j(e,"click",i[5]),t=!0)},p:L,d(r){r&&_(e),t=!1,n()}}}function mg(i){let e;return{c(){e=$("Show")},m(t,n){y(t,e,n)},d(t){t&&_(e)}}}function gg(i){let e;return{c(){e=$("Hide")},m(t,n){y(t,e,n)},d(t){t&&_(e)}}}function Xu(i){let e,t,n;return t=new hg({props:{codeValue:i[1],squareSize:i[0]}}),{c(){e=D("div"),U(t.$$.fragment),w(e,"id","qrcodeContainer"),w(e,"class","ml-1/5 svelte-tchhkp")},m(r,s){y(r,e,s),z(t,e,null),n=!0},p(r,s){const u={};s&2&&(u.codeValue=r[1]),s&1&&(u.squareSize=r[0]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function Dg(i){let e,t,n,r,s,u,a=i[1]&&Zu(i);return{c(){e=D("div"),t=D("button"),t.textContent="Generate Invitation URL",n=I(),a&&a.c()},m(o,l){y(o,e,l),m(e,t),m(e,n),a&&a.m(e,null),r=!0,s||(u=j(t,"click",i[4]),s=!0)},p(o,[l]){o[1]?a?(a.p(o,l),l&2&&v(a,1)):(a=Zu(o),a.c(),v(a,1),a.m(e,null)):a&&(K(),B(a,1,1,()=>{a=null}),Q())},i(o){r||(v(a),r=!0)},o(o){B(a),r=!1},d(o){o&&_(e),a&&a.d(),s=!1,u()}}}function bg(i,e,t){let n;gt(()=>{t(0,n=window.innerWidth*.4),window.addEventListener("resize",()=>{t(0,n=window.innerWidth*.4)})});let r="",s=!1,u=!1,a;Yn.subscribe(f=>{a=f});async function o(){const f=await Ff(a.shareAddress,ae.servers,a.secret);typeof f=="string"?t(1,r=f):console.error("Failed to create invitation URL:",f)}async function l(){try{await navigator.clipboard.writeText(r),t(2,s=!0)}catch(f){console.error("Failed to copy text: ",f)}}function c(){t(3,u=!u)}return[n,r,s,u,o,l,c]}class wg extends J{constructor(e){super(),Z(this,e,bg,Dg,Y,{})}}function yg(i){let e,t,n,r,s,u,a;return n=new ym({}),u=new wg({}),{c(){e=D("div"),t=D("div"),U(n.$$.fragment),r=I(),s=D("div"),U(u.$$.fragment),w(t,"class","svelte-a2uzsp"),w(s,"class","svelte-a2uzsp"),w(e,"class","svelte-a2uzsp")},m(o,l){y(o,e,l),m(e,t),z(n,t,null),m(e,r),m(e,s),z(u,s,null),a=!0},p:L,i(o){a||(v(n.$$.fragment,o),v(u.$$.fragment,o),a=!0)},o(o){B(n.$$.fragment,o),B(u.$$.fragment,o),a=!1},d(o){o&&_(e),H(n),H(u)}}}class _g extends J{constructor(e){super(),Z(this,e,null,yg,Y,{})}}function eo(i){let e,t,n;return t=new fm({}),{c(){e=D("div"),U(t.$$.fragment)},m(r,s){y(r,e,s),z(t,e,null),n=!0},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function to(i){let e,t,n;return t=new pm({}),{c(){e=D("div"),U(t.$$.fragment)},m(r,s){y(r,e,s),z(t,e,null),n=!0},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function no(i){let e,t,n;return t=new _g({}),{c(){e=D("div"),U(t.$$.fragment)},m(r,s){y(r,e,s),z(t,e,null),n=!0},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function Ag(i){let e,t,n,r,s,u,a,o,l,c,f,h,d,p,g,C,b,E,A,F,T,k=i[1]==="share"&&eo(),S=i[1]==="server"&&to(),P=i[1]==="invitation"&&no();return C=new Xf({}),E=new um({props:{status:i[0]}}),{c(){e=D("div"),t=D("button"),t.textContent="Hide Details",n=I(),r=D("div"),s=D("div"),u=D("button"),u.textContent="Show Share Settings",a=I(),o=D("button"),o.textContent="Show Server Settings",l=I(),c=D("button"),c.textContent="Show Invitation URL",f=I(),k&&k.c(),h=I(),S&&S.c(),d=I(),P&&P.c(),p=I(),g=D("div"),U(C.$$.fragment),b=I(),U(E.$$.fragment),w(t,"class","h-auto m-6"),w(e,"class","w-screen flex flex-row justify-end"),w(u,"class","my-1"),ot(u,"phase2",i[1]==="share"),w(o,"class","my-1"),ot(o,"phase2",i[1]==="server"),w(c,"class","my-1"),ot(c,"phase2",i[1]==="invitation"),w(s,"class","mx-1 mt-12 w-1/5 paper-yellow flex flex-col p-8 h-[80vh] sticky top-0"),w(g,"class","py-12 px-2 flex flex-row justify-center w-4/5 items-start"),w(r,"class","flex min-h-screen overflow-y-auto")},m(R,N){y(R,e,N),m(e,t),y(R,n,N),y(R,r,N),m(r,s),m(s,u),m(s,a),m(s,o),m(s,l),m(s,c),m(s,f),k&&k.m(s,null),m(s,h),S&&S.m(s,null),m(s,d),P&&P.m(s,null),m(r,p),m(r,g),z(C,g,null),m(g,b),z(E,g,null),A=!0,F||(T=[j(t,"click",i[2]),j(u,"click",i[3]),j(o,"click",i[4]),j(c,"click",i[5])],F=!0)},p(R,[N]){(!A||N&2)&&ot(u,"phase2",R[1]==="share"),(!A||N&2)&&ot(o,"phase2",R[1]==="server"),(!A||N&2)&&ot(c,"phase2",R[1]==="invitation"),R[1]==="share"?k?N&2&&v(k,1):(k=eo(),k.c(),v(k,1),k.m(s,h)):k&&(K(),B(k,1,1,()=>{k=null}),Q()),R[1]==="server"?S?N&2&&v(S,1):(S=to(),S.c(),v(S,1),S.m(s,d)):S&&(K(),B(S,1,1,()=>{S=null}),Q()),R[1]==="invitation"?P?N&2&&v(P,1):(P=no(),P.c(),v(P,1),P.m(s,null)):P&&(K(),B(P,1,1,()=>{P=null}),Q());const q={};N&1&&(q.status=R[0]),E.$set(q)},i(R){A||(v(k),v(S),v(P),v(C.$$.fragment,R),v(E.$$.fragment,R),A=!0)},o(R){B(k),B(S),B(P),B(C.$$.fragment,R),B(E.$$.fragment,R),A=!1},d(R){R&&_(e),R&&_(n),R&&_(r),k&&k.d(),S&&S.d(),P&&P.d(),H(C),H(E),F=!1,Ae(T)}}}function Cg(i,e,t){let{status:n}=e,r=null;const s=Xe();function u(){s("toggle")}const a=()=>t(1,r="share"),o=()=>t(1,r="server"),l=()=>t(1,r="invitation");return i.$$set=c=>{"status"in c&&t(0,n=c.status)},[n,r,u,a,o,l]}class Eg extends J{constructor(e){super(),Z(this,e,Cg,Ag,Y,{status:0})}}function ro(i){let e,t,n,r,s,u,a,o,l,c;r=new Dp({}),r.$on("validated",i[5]),r.$on("error",i[6]),r.$on("generateNewIdentity",i[11]),a=new pp({}),a.$on("alias",i[5]),a.$on("error",i[6]);let f=i[2]===!0&&io();return{c(){e=D("div"),t=D("div"),n=D("div"),U(r.$$.fragment),s=I(),u=D("div"),U(a.$$.fragment),o=I(),f&&f.c(),l=ie(),w(u,"class","mb-8"),w(n,"class","flex flex-col items-start mx-6 my-12"),w(t,"class","flex flex-col lg:flex-row items-center mx-2 justify-between my-12"),w(e,"class","my-12")},m(h,d){y(h,e,d),m(e,t),m(t,n),z(r,n,null),m(n,s),m(n,u),z(a,u,null),y(h,o,d),f&&f.m(h,d),y(h,l,d),c=!0},p(h,d){h[2]===!0?f?d&4&&v(f,1):(f=io(),f.c(),v(f,1),f.m(l.parentNode,l)):f&&(K(),B(f,1,1,()=>{f=null}),Q())},i(h){c||(v(r.$$.fragment,h),v(a.$$.fragment,h),v(f),c=!0)},o(h){B(r.$$.fragment,h),B(a.$$.fragment,h),B(f),c=!1},d(h){h&&_(e),H(r),H(a),h&&_(o),f&&f.d(h),h&&_(l)}}}function io(i){let e,t,n;return{c(){e=D("blockquote"),e.textContent="There was an error with your identity file"},m(r,s){y(r,e,s),n=!0},i(r){n||(vn(()=>{t||(t=Nt(e,jt,{y:200,duration:2e3},!0)),t.run(1)}),n=!0)},o(r){t||(t=Nt(e,jt,{y:200,duration:2e3},!1)),t.run(0),n=!1},d(r){r&&_(e),r&&t&&t.end()}}}function vg(i){let e,t,n;return t=new Eg({props:{status:i[4]}}),t.$on("toggle",i[9]),{c(){e=D("div"),U(t.$$.fragment),w(e,"class","w-full")},m(r,s){y(r,e,s),z(t,e,null),n=!0},p(r,s){const u={};s&16&&(u.status=r[4]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function kg(i){let e,t,n;return t=new nm({props:{inStudio:i[7],showDetails:i[1],IDcreated:i[0]}}),t.$on("toggle",i[9]),t.$on("view",i[8]),t.$on("details",i[12]),{c(){e=D("div"),U(t.$$.fragment),w(e,"class","w-full")},m(r,s){y(r,e,s),z(t,e,null),n=!0},p(r,s){const u={};s&2&&(u.showDetails=r[1]),s&1&&(u.IDcreated=r[0]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){B(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function Fg(i){let e,t,n,r,s,u=!i[0]&&!i[1]&&ro(i);const a=[kg,vg],o=[];function l(c,f){return c[0]&&!c[3]?0:1}return n=l(i),r=o[n]=a[n](i),{c(){e=D("main"),u&&u.c(),t=I(),r.c(),w(e,"class","svelte-l2iqfv")},m(c,f){y(c,e,f),u&&u.m(e,null),m(e,t),o[n].m(e,null),s=!0},p(c,[f]){!c[0]&&!c[1]?u?(u.p(c,f),f&3&&v(u,1)):(u=ro(c),u.c(),v(u,1),u.m(e,t)):u&&(K(),B(u,1,1,()=>{u=null}),Q());let h=n;n=l(c),n===h?o[n].p(c,f):(K(),B(o[h],1,1,()=>{o[h]=null}),Q(),r=o[n],r?r.p(c,f):(r=o[n]=a[n](c),r.c()),v(r,1),r.m(e,null))},i(c){s||(v(u),v(r),s=!0)},o(c){B(u),B(r),s=!1},d(c){c&&_(e),u&&u.d(),o[n].d()}}}function Bg(i,e,t){let n;Be(i,bt,k=>t(13,n=k));let r=!1,s=!1,u=!0,a=!1,o=!1,l;gt(async()=>{ae.author?(it.set(ae.author),t(0,r=!0)):t(0,r=!1)});const c=new nr;c.addReplica(n.replica);const f=c.sync("https://earthstar-server.fly.dev/sync",!0),h=c.sync("https://languid-sand-parallelogram.glitch.me/",!0);f.onStatusChange(k=>{t(4,l=k),console.log(k),t(4,l)}),h.onStatusChange(k=>{t(4,l=k),console.log(k),t(4,l)}),f.isDone().then(()=>{console.log("Sync complete")}).catch(k=>{console.error("Sync failed",k)});function d(k){t(0,r=!0),t(1,s=!0)}function p(k){t(2,a=!0)}const g=new URLSearchParams(window.location.search),C=g.has("studio"),b=g.has("oracle");function E(){t(10,u=!u)}function A(){t(3,o=!o)}const F=()=>t(0,r=!r),T=()=>t(3,o=!0);return i.$$.update=()=>{i.$$.dirty&1&&console.log("IDcreated",r),i.$$.dirty&2&&console.log("showDetails",s),i.$$.dirty&1024&&console.log("imageView",u)},console.log("inStudio",C),console.log("oracle",b),[r,s,a,o,l,d,p,C,E,A,u,F,T]}class Sg extends J{constructor(e){super(),Z(this,e,Bg,Fg,Y,{})}}new Sg({target:document.getElementById("app")});
