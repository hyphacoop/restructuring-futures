var ha=Object.defineProperty;var da=(s,e,t)=>e in s?ha(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var Gr=(s,e,t)=>(da(s,typeof e!="symbol"?e+"":e,t),t);import{g as pa,n as Da,a as $,s as ma,r as ke,b as J,i as eu,S as te,c as ne,e as m,d as F,t as j,f as Se,h as b,j as $e,k as A,l as p,m as H,o as C,p as tt,q as Rr,u as rt,v as ce,w as E,x as Q,y as k,z as K,A as Te,B as xt,C as rr,D as Bt,E as ie,F as Zr,G as St,H as ga,I as Yt,J as L,K as U,L as pn,M as Dn,N as z,O as pe,P as ba,Q as ge,R as be,T as we,U as _e,V as tu,W as wa,X as Yr,Y as _a,Z as Rt,_ as jn,$ as on,a0 as cn,a1 as vr,a2 as Or}from"./svelte-7acdeef2.js";function ya(s,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in s)){const i=Object.getOwnPropertyDescriptor(n,r);i&&Object.defineProperty(s,r,i.get?i:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();class Qe extends Error{constructor(e){super(e||""),this.name="EarthstarError"}}class O extends Qe{constructor(e){super(e||"Validation error"),this.name="ValidationError"}}class me extends Qe{constructor(e){super(e||"a Replica or ReplicaDriver was used after being closed"),this.name="ReplicaIsClosedError"}}class Mt extends Qe{constructor(e){super(e||"a ReplicaCache was used after being closed"),this.name="ReplicaCacheIsClosedError"}}class Tn extends Qe{constructor(e){super(e||"Not supported"),this.name="NotSupportedError"}}function R(s){return s instanceof Qe}function nu(s){return!(s instanceof Qe)}var xn={};Object.defineProperty(xn,"__esModule",{value:!0});var sr=xn.setInterval=Vt=xn.setTimeout=void 0;const Aa=globalThis.setTimeout;function Ca(s,e,...t){const n=Aa(s,e,...t);return typeof n=="number"?n:n[Symbol.toPrimitive]()}var Vt=xn.setTimeout=Ca;const Ea=globalThis.setInterval;function ka(s,e,...t){const n=Ea(s,e,...t);return typeof n=="number"?n:n[Symbol.toPrimitive]()}sr=xn.setInterval=ka;var $r={},dr,Xr;Object.defineProperty($r,"__esModule",{value:!0});var ru=$r.WeakRef=void 0;ru=$r.WeakRef=(dr=globalThis.WeakRef)!==null&&dr!==void 0?dr:(Xr=class{constructor(e){}deref(){throw new Error("WeakRef is not supported in Node 14 and below.")}},Xr);const{Blob:su}=window,{Request:va,Response:Fa,Headers:Ba,fetch:j0}=window,{ReadableStream:Gt,ReadableStreamDefaultReader:N0,ReadableStreamBYOBReader:L0,ReadableStreamBYOBRequest:U0,ReadableByteStreamController:z0,ReadableStreamDefaultController:H0,TransformStream:mn,TransformStreamDefaultController:Sa,WritableStream:et,WritableStreamDefaultWriter:Ta,WritableStreamDefaultController:q0,ByteLengthQueuingStrategy:W0,CountQueuingStrategy:Q0,TextEncoderStream:K0,TextDecoderStream:V0}=window;if(!Gt.prototype[Symbol.asyncIterator]){async function*s(){const e=this.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)return;yield n}}finally{e.releaseLock()}}Gt.prototype[Symbol.asyncIterator]=s}var sn=null;typeof WebSocket<"u"?sn=WebSocket:typeof MozWebSocket<"u"?sn=MozWebSocket:typeof global<"u"?sn=global.WebSocket||global.MozWebSocket:typeof window<"u"?sn=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(sn=self.WebSocket||self.MozWebSocket);const fn=sn,{TextDecoder:iu,TextEncoder:Mr}=window;function Jr(s,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(s,n.key,n)}}function uu(s,e,t){return e&&Jr(s.prototype,e),t&&Jr(s,t),s}function es(s,e){(e==null||e>s.length)&&(e=s.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=s[t];return n}function Yn(s,e){var t=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(t)return(t=t.call(s)).next.bind(t);if(Array.isArray(s)||(t=function(r,i){if(r){if(typeof r=="string")return es(r,i);var u=Object.prototype.toString.call(r).slice(8,-1);return u==="Object"&&r.constructor&&(u=r.constructor.name),u==="Map"||u==="Set"?Array.from(r):u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?es(r,i):void 0}}(s))||e&&s&&typeof s.length=="number"){t&&(s=t);var n=0;return function(){return n>=s.length?{done:!0}:{done:!1,value:s[n++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ia=/(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDEC0-\uDEEB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/,Pa=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/;function xa(s,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(s)}function au(s,e){e===void 0&&(e=!1);for(var t=[],n=0;n<s.length;){var r=s[n],i=function(d){if(!e)throw new TypeError(d);t.push({type:"INVALID_CHAR",index:n,value:s[n++]})};if(r!=="*")if(r!=="+"&&r!=="?")if(r!=="\\")if(r!=="{")if(r!=="}")if(r!==":")if(r!=="(")t.push({type:"CHAR",index:n,value:s[n++]});else{var u=1,l="",a=n+1,o=!1;if(s[a]==="?"){i('Pattern cannot start with "?" at '+a);continue}for(;a<s.length;){if(!xa(s[a],!1)){i("Invalid character '"+s[a]+"' at "+a+"."),o=!0;break}if(s[a]!=="\\"){if(s[a]===")"){if(--u==0){a++;break}}else if(s[a]==="("&&(u++,s[a+1]!=="?")){i("Capturing groups are not allowed at "+a),o=!0;break}l+=s[a++]}else l+=s[a++]+s[a++]}if(o)continue;if(u){i("Unbalanced pattern at "+n);continue}if(!l){i("Missing pattern at "+n);continue}t.push({type:"PATTERN",index:n,value:l}),n=a}else{for(var c="",f=n+1;f<s.length;){var h=s.substr(f,1);if(!(f===n+1&&Ia.test(h)||f!==n+1&&Pa.test(h)))break;c+=s[f++]}if(!c){i("Missing parameter name at "+n);continue}t.push({type:"NAME",index:n,value:c}),n=f}else t.push({type:"CLOSE",index:n,value:s[n++]});else t.push({type:"OPEN",index:n,value:s[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:s[n++]});else t.push({type:"MODIFIER",index:n,value:s[n++]});else t.push({type:"ASTERISK",index:n,value:s[n++]})}return t.push({type:"END",index:n,value:""}),t}function lu(s,e){e===void 0&&(e={});for(var t=au(s),n=e.prefixes,r=n===void 0?"./":n,i="[^"+un(e.delimiter||"/#?")+"]+?",u=[],l=0,a=0,o="",c=new Set,f=function(W){if(a<t.length&&t[a].type===W)return t[a++].value},h=function(){return f("MODIFIER")||f("ASTERISK")},d=function(W){var ue=f(W);if(ue!==void 0)return ue;var ae=t[a];throw new TypeError("Unexpected "+ae.type+" at "+ae.index+", expected "+W)},D=function(){for(var W,ue="";W=f("CHAR")||f("ESCAPED_CHAR");)ue+=W;return ue},g=e.encodePart||function(W){return W};a<t.length;){var y=f("CHAR"),w=f("NAME"),_=f("PATTERN");if(w||_||!f("ASTERISK")||(_=".*"),w||_){var v=y||"";r.indexOf(v)===-1&&(o+=v,v=""),o&&(u.push(g(o)),o="");var B=w||l++;if(c.has(B))throw new TypeError("Duplicate name '"+B+"'.");c.add(B),u.push({name:B,prefix:g(v),suffix:"",pattern:_||i,modifier:h()||""})}else{var S=y||f("ESCAPED_CHAR");if(S)o+=S;else if(f("OPEN")){var P=D(),T=f("NAME")||"",x=f("PATTERN")||"";T||x||!f("ASTERISK")||(x=".*");var M=D();d("CLOSE");var q=h()||"";if(!T&&!x&&!q){o+=P;continue}if(!T&&!x&&!P)continue;o&&(u.push(g(o)),o=""),u.push({name:T||(x?l++:""),pattern:T&&!x?i:x,prefix:g(P),suffix:g(M),modifier:q})}else o&&(u.push(g(o)),o=""),d("END")}}return u}function un(s){return s.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function ou(s){return s&&s.sensitive?"u":"ui"}function cu(s,e,t){t===void 0&&(t={});for(var n,r=t.strict,i=r!==void 0&&r,u=t.start,l=u===void 0||u,a=t.end,o=a===void 0||a,c=t.encode,f=c===void 0?function(S){return S}:c,h="["+un(t.endsWith||"")+"]|$",d="["+un(t.delimiter||"/#?")+"]",D=l?"^":"",g=Yn(s);!(n=g()).done;){var y=n.value;if(typeof y=="string")D+=un(f(y));else{var w=un(f(y.prefix)),_=un(f(y.suffix));y.pattern?(e&&e.push(y),D+=w||_?y.modifier==="+"||y.modifier==="*"?"(?:"+w+"((?:"+y.pattern+")(?:"+_+w+"(?:"+y.pattern+"))*)"+_+")"+(y.modifier==="*"?"?":""):"(?:"+w+"("+y.pattern+")"+_+")"+y.modifier:y.modifier==="+"||y.modifier==="*"?"((?:"+y.pattern+")"+y.modifier+")":"("+y.pattern+")"+y.modifier):D+="(?:"+w+_+")"+y.modifier}}if(o)i||(D+=d+"?"),D+=t.endsWith?"(?="+h+")":"$";else{var v=s[s.length-1],B=typeof v=="string"?d.indexOf(v[v.length-1])>-1:v===void 0;i||(D+="(?:"+d+"(?="+h+"))?"),B||(D+="(?="+d+"|"+h+")")}return new RegExp(D,ou(t))}function fu(s,e,t){return s instanceof RegExp?function(n,r){if(!r)return n;for(var i=/\((?:\?<(.*?)>)?(?!\?)/g,u=0,l=i.exec(n.source);l;)r.push({name:l[1]||u++,prefix:"",suffix:"",modifier:"",pattern:""}),l=i.exec(n.source);return n}(s,e):Array.isArray(s)?function(n,r,i){var u=n.map(function(l){return fu(l,r,i).source});return new RegExp("(?:"+u.join("|")+")",ou(i))}(s,e,t):function(n,r,i){return cu(lu(n,i),r,i)}(s,e,t)}var vt={delimiter:"",prefixes:"",sensitive:!0,strict:!0},Ra={delimiter:".",prefixes:"",sensitive:!0,strict:!0},Oa={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function ts(s,e){return s.startsWith(e)?s.substring(e.length,s.length):s}function hu(s){return!(!s||s.length<2||s[0]!=="["&&(s[0]!=="\\"&&s[0]!=="{"||s[1]!=="["))}var Y,du=["ftp","file","http","https","ws","wss"];function pu(s){if(!s)return!0;for(var e,t=Yn(du);!(e=t()).done;)if(s.test(e.value))return!0;return!1}function Du(s){switch(s){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function jr(s){if(s==="")return s;if(/^[-+.A-Za-z0-9]*$/.test(s))return s.toLowerCase();throw new TypeError("Invalid protocol '"+s+"'.")}function $a(s){if(s==="")return s;var e=new URL("https://example.com");return e.username=s,e.username}function Ma(s){if(s==="")return s;var e=new URL("https://example.com");return e.password=s,e.password}function mu(s){if(s==="")return s;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(s))throw new TypeError("Invalid hostname '"+s+"'");var e=new URL("https://example.com");return e.hostname=s,e.hostname}function gu(s){if(s==="")return s;if(/[^0-9a-fA-F[\]:]/g.test(s))throw new TypeError("Invalid IPv6 hostname '"+s+"'");return s.toLowerCase()}function bu(s){if(s===""||/^[0-9]*$/.test(s)&&parseInt(s)<=65535)return s;throw new TypeError("Invalid port '"+s+"'.")}function ja(s){if(s==="")return s;var e=new URL("https://example.com");return e.pathname=s[0]!=="/"?"/-"+s:s,s[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function Na(s){return s===""?s:new URL("data:"+s).pathname}function La(s){if(s==="")return s;var e=new URL("https://example.com");return e.search=s,e.search.substring(1,e.search.length)}function Ua(s){if(s==="")return s;var e=new URL("https://example.com");return e.hash=s,e.hash.substring(1,e.hash.length)}(function(s){s[s.INIT=0]="INIT",s[s.PROTOCOL=1]="PROTOCOL",s[s.AUTHORITY=2]="AUTHORITY",s[s.USERNAME=3]="USERNAME",s[s.PASSWORD=4]="PASSWORD",s[s.HOSTNAME=5]="HOSTNAME",s[s.PORT=6]="PORT",s[s.PATHNAME=7]="PATHNAME",s[s.SEARCH=8]="SEARCH",s[s.HASH=9]="HASH",s[s.DONE=10]="DONE"})(Y||(Y={}));var za=function(){function s(t){this.input=void 0,this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=Y.INIT,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=t}var e=s.prototype;return e.parse=function(){for(this.tokenList=au(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===Y.INIT){this.rewind(),this.isHashPrefix()?this.changeState(Y.HASH,1):this.isSearchPrefix()?(this.changeState(Y.SEARCH,1),this.internalResult.hash=""):(this.changeState(Y.PATHNAME,0),this.internalResult.search="",this.internalResult.hash="");continue}if(this.state===Y.AUTHORITY){this.rewindAndSetState(Y.HOSTNAME);continue}this.changeState(Y.DONE,0);break}if(this.groupDepth>0){if(!this.isGroupClose())continue;this.groupDepth-=1}if(this.isGroupOpen())this.groupDepth+=1;else switch(this.state){case Y.INIT:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(Y.PROTOCOL));break;case Y.PROTOCOL:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();var t=Y.PATHNAME,n=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(t=Y.AUTHORITY,n=3):this.shouldTreatAsStandardURL&&(t=Y.AUTHORITY),this.changeState(t,n)}break;case Y.AUTHORITY:this.isIdentityTerminator()?this.rewindAndSetState(Y.USERNAME):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(Y.HOSTNAME);break;case Y.USERNAME:this.isPasswordPrefix()?this.changeState(Y.PASSWORD,1):this.isIdentityTerminator()&&this.changeState(Y.HOSTNAME,1);break;case Y.PASSWORD:this.isIdentityTerminator()&&this.changeState(Y.HOSTNAME,1);break;case Y.HOSTNAME:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(Y.PORT,1):this.isPathnameStart()?this.changeState(Y.PATHNAME,0):this.isSearchPrefix()?this.changeState(Y.SEARCH,1):this.isHashPrefix()&&this.changeState(Y.HASH,1);break;case Y.PORT:this.isPathnameStart()?this.changeState(Y.PATHNAME,0):this.isSearchPrefix()?this.changeState(Y.SEARCH,1):this.isHashPrefix()&&this.changeState(Y.HASH,1);break;case Y.PATHNAME:this.isSearchPrefix()?this.changeState(Y.SEARCH,1):this.isHashPrefix()&&this.changeState(Y.HASH,1);break;case Y.SEARCH:this.isHashPrefix()&&this.changeState(Y.HASH,1)}}},e.changeState=function(t,n){switch(this.state){case Y.INIT:break;case Y.PROTOCOL:this.internalResult.protocol=this.makeComponentString();break;case Y.AUTHORITY:break;case Y.USERNAME:this.internalResult.username=this.makeComponentString();break;case Y.PASSWORD:this.internalResult.password=this.makeComponentString();break;case Y.HOSTNAME:this.internalResult.hostname=this.makeComponentString();break;case Y.PORT:this.internalResult.port=this.makeComponentString();break;case Y.PATHNAME:this.internalResult.pathname=this.makeComponentString();break;case Y.SEARCH:this.internalResult.search=this.makeComponentString();break;case Y.HASH:this.internalResult.hash=this.makeComponentString()}this.changeStateWithoutSettingComponent(t,n)},e.changeStateWithoutSettingComponent=function(t,n){this.state=t,this.componentStart=this.tokenIndex+n,this.tokenIndex+=n,this.tokenIncrement=0},e.rewind=function(){this.tokenIndex=this.componentStart,this.tokenIncrement=0},e.rewindAndSetState=function(t){this.rewind(),this.state=t},e.safeToken=function(t){return t<0&&(t=this.tokenList.length-t),t<this.tokenList.length?this.tokenList[t]:this.tokenList[this.tokenList.length-1]},e.isNonSpecialPatternChar=function(t,n){var r=this.safeToken(t);return r.value===n&&(r.type==="CHAR"||r.type==="ESCAPED_CHAR"||r.type==="INVALID_CHAR")},e.isProtocolSuffix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.nextIsAuthoritySlashes=function(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")},e.isIdentityTerminator=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")},e.isPasswordPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.isPortPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.isPathnameStart=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")},e.isSearchPrefix=function(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;var t=this.safeToken(this.tokenIndex-1);return t.type!=="NAME"&&t.type!=="PATTERN"&&t.type!=="CLOSE"&&t.type!=="ASTERISK"},e.isHashPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")},e.isGroupOpen=function(){return this.tokenList[this.tokenIndex].type=="OPEN"},e.isGroupClose=function(){return this.tokenList[this.tokenIndex].type=="CLOSE"},e.isIPv6Open=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")},e.isIPv6Close=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")},e.makeComponentString=function(){var t=this.tokenList[this.tokenIndex],n=this.safeToken(this.componentStart).index;return this.input.substring(n,t.index)},e.computeShouldTreatAsStandardURL=function(){var t={};Object.assign(t,vt),t.encodePart=jr;var n=fu(this.makeComponentString(),void 0,t);this.shouldTreatAsStandardURL=pu(n)},uu(s,[{key:"result",get:function(){return this.internalResult}}]),s}(),Ha=["protocol","username","password","hostname","port","pathname","search","hash"];function ns(s,e){if(typeof s!="string")throw new TypeError("parameter 1 is not of type 'string'.");var t=new URL(s,e);return{protocol:t.protocol.substring(0,t.protocol.length-1),username:t.username,password:t.password,hostname:t.hostname,port:t.port,pathname:t.pathname,search:t.search!=""?t.search.substring(1,t.search.length):void 0,hash:t.hash!=""?t.hash.substring(1,t.hash.length):void 0}}function pr(s,e,t){var n;if(typeof e.baseURL=="string")try{n=new URL(e.baseURL),s.protocol=n.protocol?n.protocol.substring(0,n.protocol.length-1):"",s.username=n.username,s.password=n.password,s.hostname=n.hostname,s.port=n.port,s.pathname=n.pathname,s.search=n.search?n.search.substring(1,n.search.length):"",s.hash=n.hash?n.hash.substring(1,n.hash.length):""}catch{throw new TypeError("invalid baseURL '"+e.baseURL+"'.")}if(typeof e.protocol=="string"&&(s.protocol=function(i,u){var l;return i=(l=i).endsWith(":")?l.substr(0,l.length-1):l,u||i===""?i:jr(i)}(e.protocol,t)),typeof e.username=="string"&&(s.username=function(i,u){if(u||i==="")return i;var l=new URL("https://example.com");return l.username=i,l.username}(e.username,t)),typeof e.password=="string"&&(s.password=function(i,u){if(u||i==="")return i;var l=new URL("https://example.com");return l.password=i,l.password}(e.password,t)),typeof e.hostname=="string"&&(s.hostname=function(i,u){return u||i===""?i:hu(i)?gu(i):mu(i)}(e.hostname,t)),typeof e.port=="string"&&(s.port=function(i,u,l){return Du(u)===i&&(i=""),l||i===""?i:bu(i)}(e.port,s.protocol,t)),typeof e.pathname=="string"){if(s.pathname=e.pathname,n&&!function(i,u){return!(!i.length||i[0]!=="/"&&(!u||i.length<2||i[0]!="\\"&&i[0]!="{"||i[1]!="/"))}(s.pathname,t)){var r=n.pathname.lastIndexOf("/");r>=0&&(s.pathname=n.pathname.substring(0,r+1)+s.pathname)}s.pathname=function(i,u,l){if(l||i==="")return i;if(u&&!du.includes(u))return new URL(u+":"+i).pathname;var a=i[0]=="/";return i=new URL(a?i:"/-"+i,"https://example.com").pathname,a||(i=i.substring(2,i.length)),i}(s.pathname,s.protocol,t)}return typeof e.search=="string"&&(s.search=function(i,u){if(i=ts(i,"?"),u||i==="")return i;var l=new URL("https://example.com");return l.search=i,l.search?l.search.substring(1,l.search.length):""}(e.search,t)),typeof e.hash=="string"&&(s.hash=function(i,u){if(i=ts(i,"#"),u||i==="")return i;var l=new URL("https://example.com");return l.hash=i,l.hash?l.hash.substring(1,l.hash.length):""}(e.hash,t)),s}function yn(s){return s.replace(/([+*?:{}()\\])/g,"\\$1")}function qa(s,e){for(var t="[^"+(e.delimiter||"/#?").replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")+"]+?",n=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/,r="",i=0;i<s.length;++i){var u=s[i],l=i>0?s[i-1]:null,a=i<s.length-1?s[i+1]:null;if(typeof u!="string")if(u.pattern!==""){var o=typeof u.name!="number",c=e.prefixes!==void 0?e.prefixes:"./",f=u.suffix!==""||u.prefix!==""&&(u.prefix.length!==1||!c.includes(u.prefix));f||!o||u.pattern!==t||u.modifier!==""||!a||a.prefix||a.suffix||(f=typeof a=="string"?n.test(a.length>0?a[0]:""):typeof a.name=="number"),!f&&u.prefix===""&&l&&typeof l=="string"&&l.length>0&&(f=c.includes(l[l.length-1])),f&&(r+="{"),r+=yn(u.prefix),o&&(r+=":"+u.name),u.pattern===".*"?r+=o||l&&typeof l!="string"&&!l.modifier&&!f&&u.prefix===""?"(.*)":"*":u.pattern===t?o||(r+="("+t+")"):r+="("+u.pattern+")",u.pattern===t&&o&&u.suffix!==""&&n.test(u.suffix[0])&&(r+="\\"),r+=yn(u.suffix),f&&(r+="}"),r+=u.modifier}else{if(u.modifier===""){r+=yn(u.prefix);continue}r+="{"+yn(u.prefix)+"}"+u.modifier}else r+=yn(u)}return r}var Wa=function(){function s(t,n){t===void 0&&(t={}),this.pattern=void 0,this.regexp={},this.keys={},this.component_pattern={};try{if(typeof t=="string"){var r=new za(t);if(r.parse(),t=r.result,n){if(typeof n!="string")throw new TypeError("'baseURL' parameter is not of type 'string'.");t.baseURL=n}else if(typeof t.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if(n)throw new TypeError("parameter 1 is not of type 'string'.");if(!t||typeof t!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");var i;this.pattern=pr({pathname:"*",protocol:"*",username:"*",password:"*",hostname:"*",port:"*",search:"*",hash:"*"},t,!0),Du(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");for(var u,l=Yn(Ha);!(u=l()).done;)if((i=u.value)in this.pattern){var a={},o=this.pattern[i];switch(this.keys[i]=[],i){case"protocol":Object.assign(a,vt),a.encodePart=jr;break;case"username":Object.assign(a,vt),a.encodePart=$a;break;case"password":Object.assign(a,vt),a.encodePart=Ma;break;case"hostname":Object.assign(a,Ra),a.encodePart=hu(o)?gu:mu;break;case"port":Object.assign(a,vt),a.encodePart=bu;break;case"pathname":pu(this.regexp.protocol)?(Object.assign(a,Oa),a.encodePart=ja):(Object.assign(a,vt),a.encodePart=Na);break;case"search":Object.assign(a,vt),a.encodePart=La;break;case"hash":Object.assign(a,vt),a.encodePart=Ua}try{var c=lu(o,a);this.regexp[i]=cu(c,this.keys[i],a),this.component_pattern[i]=qa(c,a)}catch{throw new TypeError("invalid "+i+" pattern '"+this.pattern[i]+"'.")}}}catch(f){throw new TypeError("Failed to construct 'URLPattern': "+f.message)}}var e=s.prototype;return e.test=function(t,n){t===void 0&&(t={});var r,i={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&n)throw new TypeError("parameter 1 is not of type 'string'.");if(t===void 0)return!1;try{i=pr(i,typeof t=="object"?t:ns(t,n),!1)}catch{return!1}for(r in this.pattern)if(!this.regexp[r].exec(i[r]))return!1;return!0},e.exec=function(t,n){t===void 0&&(t={});var r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&n)throw new TypeError("parameter 1 is not of type 'string'.");if(t!==void 0){try{r=pr(r,typeof t=="object"?t:ns(t,n),!1)}catch{return null}var i,u={};for(i in u.inputs=n?[t,n]:[t],this.pattern){var l=this.regexp[i].exec(r[i]);if(!l)return null;for(var a,o={},c=Yn(this.keys[i].entries());!(a=c()).done;){var f=a.value,h=f[1];typeof h.name!="string"&&typeof h.name!="number"||(o[h.name]=l[f[0]+1]||"")}u[i]={input:r[i]||"",groups:o}}return u}},uu(s,[{key:"protocol",get:function(){return this.component_pattern.protocol}},{key:"username",get:function(){return this.component_pattern.username}},{key:"password",get:function(){return this.component_pattern.password}},{key:"hostname",get:function(){return this.component_pattern.hostname}},{key:"port",get:function(){return this.component_pattern.port}},{key:"pathname",get:function(){return this.component_pattern.pathname}},{key:"search",get:function(){return this.component_pattern.search}},{key:"hash",get:function(){return this.component_pattern.hash}}]),s}();const Qa={setInterval:sr,setTimeout:Vt,WeakRef:ru,Blob:su,Request:va,Response:Fa,Headers:Ba,WritableStream:et,TransformStream:mn,ReadableStream:Gt,TransformStreamDefaultController:Sa,WritableStreamDefaultWriter:Ta,WebSocket:fn,TextEncoder:Mr,TextDecoder:iu,URLPattern:Wa},wu=Ka(globalThis,Qa);function Ka(s,e){return new Proxy(s,{get(t,n,r){return n in e?e[n]:s[n]},set(t,n,r){return n in e&&delete e[n],s[n]=r,!0},deleteProperty(t,n){let r=!1;return n in e&&(delete e[n],r=!0),n in s&&(delete s[n],r=!0),r},ownKeys(t){const n=Reflect.ownKeys(s),r=Reflect.ownKeys(e),i=new Set(r);return[...n.filter(u=>!i.has(u)),...r]},defineProperty(t,n,r){return n in e&&delete e[n],Reflect.defineProperty(s,n,r),!0},getOwnPropertyDescriptor(t,n){return n in e?Reflect.getOwnPropertyDescriptor(e,n):Reflect.getOwnPropertyDescriptor(s,n)},has(t,n){return n in e||n in s}})}function _u(s,e){if(s===e)return!0;if(!s||!e)return!1;var t=s.length;if(e.length!==t)return!1;for(var n=0;n<t;n++)if(s[n]!==e[n])return!1;return!0}function Xn(s,e){if(s===e)return!0;if(!s||!e)return!1;var t=Object.keys(s),n=Object.keys(e),r=t.length;if(n.length!==r)return!1;for(var i=0;i<r;i++){var u=t[i];if(s[u]!==e[u]||!Object.prototype.hasOwnProperty.call(e,u))return!1}return!0}var Va=function(s,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var t=typeof e.cycles=="boolean"?e.cycles:!1,n=e.cmp&&function(i){return function(u){return function(l,a){var o={key:l,value:u[l]},c={key:a,value:u[a]};return i(o,c)}}}(e.cmp),r=[];return function i(u){if(u&&u.toJSON&&typeof u.toJSON=="function"&&(u=u.toJSON()),u!==void 0){if(typeof u=="number")return isFinite(u)?""+u:"null";if(typeof u!="object")return JSON.stringify(u);var l,a;if(Array.isArray(u)){for(a="[",l=0;l<u.length;l++)l&&(a+=","),a+=i(u[l])||"null";return a+"]"}if(u===null)return"null";if(r.indexOf(u)!==-1){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var o=r.push(u)-1,c=Object.keys(u).sort(n&&n(u));for(a="",l=0;l<c.length;l++){var f=c[l],h=i(u[f]);h&&(a&&(a+=","),a+=JSON.stringify(f)+":"+h)}return r.splice(o,1),"{"+a+"}"}}(s)};const Ga=pa(Va);var Ze={};Object.defineProperty(Ze,"__esModule",{value:!0});function gn(s,e,t){var n;if(t===void 0&&(t={}),!e.codes){e.codes={};for(var r=0;r<e.chars.length;++r)e.codes[e.chars[r]]=r}if(!t.loose&&s.length*e.bits&7)throw new SyntaxError("Invalid padding");for(var i=s.length;s[i-1]==="=";)if(--i,!t.loose&&!((s.length-i)*e.bits&7))throw new SyntaxError("Invalid padding");for(var u=new((n=t.out)!=null?n:Uint8Array)(i*e.bits/8|0),l=0,a=0,o=0,c=0;c<i;++c){var f=e.codes[s[c]];if(f===void 0)throw new SyntaxError("Invalid character "+s[c]);a=a<<e.bits|f,l+=e.bits,l>=8&&(l-=8,u[o++]=255&a>>l)}if(l>=e.bits||255&a<<8-l)throw new SyntaxError("Unexpected end of data");return u}function bn(s,e,t){t===void 0&&(t={});for(var n=t,r=n.pad,i=r===void 0?!0:r,u=(1<<e.bits)-1,l="",a=0,o=0,c=0;c<s.length;++c)for(o=o<<8|255&s[c],a+=8;a>e.bits;)a-=e.bits,l+=e.chars[u&o>>a];if(a&&(l+=e.chars[u&o<<e.bits-a]),i)for(;l.length*e.bits&7;)l+="=";return l}var rs={chars:"0123456789ABCDEF",bits:4},ss={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},is={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},us={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},as={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},Za={parse:function(e,t){return gn(e.toUpperCase(),rs,t)},stringify:function(e,t){return bn(e,rs,t)}},Ya={parse:function(e,t){return t===void 0&&(t={}),gn(t.loose?e.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):e,ss,t)},stringify:function(e,t){return bn(e,ss,t)}},Xa={parse:function(e,t){return gn(e,is,t)},stringify:function(e,t){return bn(e,is,t)}},Ja={parse:function(e,t){return gn(e,us,t)},stringify:function(e,t){return bn(e,us,t)}},el={parse:function(e,t){return gn(e,as,t)},stringify:function(e,t){return bn(e,as,t)}},tl={parse:gn,stringify:bn};Ze.base16=Za;Ze.base32=Ya;Ze.base32hex=Xa;Ze.base64=Ja;Ze.base64url=el;Ze.codec=tl;const nl=Ze.base16,rl=Ze.base32,sl=Ze.base32hex,il=Ze.base64,ul=Ze.base64url,al=Ze.codec,ll=Object.freeze(Object.defineProperty({__proto__:null,base16:nl,base32:rl,base32hex:sl,base64:il,base64url:ul,codec:al,default:Ze},Symbol.toStringTag,{value:"Module"}));var Zt={};Object.defineProperty(Zt,"__esModule",{value:!0});var yu=Zt.Hash=Au=Zt.createHash=void 0;const ol=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],ls={sha256:1};function cl(s){if(s&&!ls[s]&&!ls[s.toLowerCase()])throw new Error("Digest method not supported");return new Cu}var Au=Zt.createHash=cl;class Cu{constructor(){this.A=1779033703,this.B=-1150833019,this.C=1013904242,this.D=-1521486534,this.E=1359893119,this.F=-1694144372,this.G=528734635,this.H=1541459225,this._size=0,this._sp=0,(!Hn||An>=8e3)&&(Hn=new ArrayBuffer(8e3),An=0),this._byte=new Uint8Array(Hn,An,80),this._word=new Int32Array(Hn,An,20),An+=80}update(e){if(typeof e=="string")return this._utf8(e);if(e==null)throw new TypeError("Invalid type: "+typeof e);const t=e.byteOffset,n=e.byteLength;let r=n/64|0,i=0;if(r&&!(t&3)&&!(this._size%64)){const l=new Int32Array(e.buffer,t,r*16);for(;r--;)this._int32(l,i>>2),i+=64;this._size+=i}if(e.BYTES_PER_ELEMENT!==1&&e.buffer){const l=new Uint8Array(e.buffer,t+i,n-i);return this._uint8(l)}return i===n?this:this._uint8(e,i)}_uint8(e,t){const{_byte:n,_word:r}=this,i=e.length;for(t=t|0;t<i;){const u=this._size%64;let l=u;for(;t<i&&l<64;)n[l++]=e[t++];l>=64&&this._int32(r),this._size+=l-u}return this}_utf8(e){const{_byte:t,_word:n}=this,r=e.length;let i=this._sp;for(let u=0;u<r;){const l=this._size%64;let a=l;for(;u<r&&a<64;){let o=e.charCodeAt(u++)|0;o<128?t[a++]=o:o<2048?(t[a++]=192|o>>>6,t[a++]=128|o&63):o<55296||o>57343?(t[a++]=224|o>>>12,t[a++]=128|o>>>6&63,t[a++]=128|o&63):i?(o=((i&1023)<<10)+(o&1023)+65536,t[a++]=240|o>>>18,t[a++]=128|o>>>12&63,t[a++]=128|o>>>6&63,t[a++]=128|o&63,i=0):i=o}a>=64&&(this._int32(n),n[0]=n[16]),this._size+=a-l}return this._sp=i,this}_int32(e,t){let{A:n,B:r,C:i,D:u,E:l,F:a,G:o,H:c}=this,f=0;for(t=t|0;f<16;)jt[f++]=st(e[t++]);for(f=16;f<64;f++)jt[f]=bl(jt[f-2])+jt[f-7]+gl(jt[f-15])+jt[f-16]|0;for(f=0;f<64;f++){const h=c+ml(l)+dl(l,a,o)+ol[f]+jt[f]|0,d=Dl(n)+pl(n,r,i)|0;c=o,o=a,a=l,l=u+h|0,u=i,i=r,r=n,n=h+d|0}this.A=n+this.A|0,this.B=r+this.B|0,this.C=i+this.C|0,this.D=u+this.D|0,this.E=l+this.E|0,this.F=a+this.F|0,this.G=o+this.G|0,this.H=c+this.H|0}digest(e){const{_byte:t,_word:n}=this;let r=this._size%64|0;for(t[r++]=128;r&3;)t[r++]=0;if(r>>=2,r>14){for(;r<16;)n[r++]=0;r=0,this._int32(n)}for(;r<16;)n[r++]=0;const i=this._size*8,u=(i&4294967295)>>>0,l=(i-u)/4294967296;return l&&(n[14]=st(l)),u&&(n[15]=st(u)),this._int32(n),e==="hex"?this._hex():this._bin()}_hex(){const{A:e,B:t,C:n,D:r,E:i,F:u,G:l,H:a}=this;return Et(e)+Et(t)+Et(n)+Et(r)+Et(i)+Et(u)+Et(l)+Et(a)}_bin(){const{A:e,B:t,C:n,D:r,E:i,F:u,G:l,H:a,_byte:o,_word:c}=this;return c[0]=st(e),c[1]=st(t),c[2]=st(n),c[3]=st(r),c[4]=st(i),c[5]=st(u),c[6]=st(l),c[7]=st(a),o.slice(0,32)}}yu=Zt.Hash=Cu;const jt=new Int32Array(64);let Hn,An=0;const Et=s=>(s+4294967296).toString(16).substr(-8),fl=s=>s<<24&4278190080|s<<8&16711680|s>>8&65280|s>>24&255,hl=s=>s,st=wl()?hl:fl,dl=(s,e,t)=>t^s&(e^t),pl=(s,e,t)=>s&e|t&(s|e),Dl=s=>(s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10),ml=s=>(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7),gl=s=>(s>>>7|s<<25)^(s>>>18|s<<14)^s>>>3,bl=s=>(s>>>17|s<<15)^(s>>>19|s<<13)^s>>>10;function wl(){return new Uint8Array(new Uint16Array([65279]).buffer)[0]===254}const _l=ya({__proto__:null,get Hash(){return yu},get createHash(){return Au},default:Zt},[Zt]);/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const xe=BigInt(0),le=BigInt(1),We=BigInt(2),Eu=BigInt(255),os=We**BigInt(252)+BigInt("27742317777372353535851937790883648493"),de={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:We**Eu-BigInt(19),l:os,n:os,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},ku=We**BigInt(256),In=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");const yl=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Al=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Cl=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),El=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class oe{constructor(e,t,n,r){this.x=e,this.y=t,this.z=n,this.t=r}static fromAffine(e){if(!(e instanceof Ee))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(Ee.ZERO)?oe.ZERO:new oe(e.x,e.y,le,I(e.x*e.y))}static toAffineBatch(e){const t=Fl(e.map(n=>n.z));return e.map((n,r)=>n.toAffine(t[r]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){cs(e);const{x:t,y:n,z:r}=this,{x:i,y:u,z:l}=e,a=I(t*l),o=I(i*r),c=I(n*l),f=I(u*r);return a===o&&c===f}negate(){return new oe(I(-this.x),this.y,this.z,I(-this.t))}double(){const{x:e,y:t,z:n}=this,{a:r}=de,i=I(e**We),u=I(t**We),l=I(We*I(n**We)),a=I(r*i),o=I(I((e+t)**We)-i-u),c=a+u,f=c-l,h=a-u,d=I(o*f),D=I(c*h),g=I(o*h),y=I(f*c);return new oe(d,D,y,g)}add(e){cs(e);const{x:t,y:n,z:r,t:i}=this,{x:u,y:l,z:a,t:o}=e,c=I((n-t)*(l+u)),f=I((n+t)*(l-u)),h=I(f-c);if(h===xe)return this.double();const d=I(r*We*o),D=I(i*We*a),g=D+d,y=f+c,w=D-d,_=I(g*h),v=I(y*w),B=I(g*w),S=I(h*y);return new oe(_,v,S,B)}subtract(e){return this.add(e.negate())}precomputeWindow(e){const t=1+256/e,n=[];let r=this,i=r;for(let u=0;u<t;u++){i=r,n.push(i);for(let l=1;l<2**(e-1);l++)i=i.add(r),n.push(i);r=i.double()}return n}wNAF(e,t){!t&&this.equals(oe.BASE)&&(t=Ee.BASE);const n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let r=t&&Fr.get(t);r||(r=this.precomputeWindow(n),t&&n!==1&&(r=oe.normalizeZ(r),Fr.set(t,r)));let i=oe.ZERO,u=oe.ZERO;const l=1+256/n,a=2**(n-1),o=BigInt(2**n-1),c=2**n,f=BigInt(n);for(let h=0;h<l;h++){const d=h*a;let D=Number(e&o);if(e>>=f,D>a&&(D-=c,e+=le),D===0){let g=r[d];h%2&&(g=g.negate()),u=u.add(g)}else{let g=r[d+Math.abs(D)-1];D<0&&(g=g.negate()),i=i.add(g)}}return oe.normalizeZ([i,u])[0]}multiply(e,t){return this.wNAF(Jn(e,de.l),t)}multiplyUnsafe(e){let t=Jn(e,de.l,!1);const n=oe.BASE,r=oe.ZERO;if(t===xe)return r;if(this.equals(r)||t===le)return this;if(this.equals(n))return this.wNAF(t);let i=r,u=this;for(;t>xe;)t&le&&(i=i.add(u)),u=u.double(),t>>=le;return i}isSmallOrder(){return this.multiplyUnsafe(de.h).equals(oe.ZERO)}isTorsionFree(){return this.multiplyUnsafe(de.l).equals(oe.ZERO)}toAffine(e=ir(this.z)){const{x:t,y:n,z:r}=this,i=I(t*e),u=I(n*e);if(I(r*e)!==le)throw new Error("invZ was invalid");return new Ee(i,u)}fromRistrettoBytes(){mr()}toRistrettoBytes(){mr()}fromRistrettoHash(){mr()}}oe.BASE=new oe(de.Gx,de.Gy,le,I(de.Gx*de.Gy));oe.ZERO=new oe(xe,le,le,xe);function cs(s){if(!(s instanceof oe))throw new TypeError("ExtendedPoint expected")}function Dr(s){if(!(s instanceof nt))throw new TypeError("RistrettoPoint expected")}function mr(){throw new Error("Legacy method: switch to RistrettoPoint")}class nt{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){const{d:t}=de,n=I(In*e*e),r=I((n+le)*Cl);let i=BigInt(-1);const u=I((i-t*n)*I(n+t));let{isValid:l,value:a}=Nr(r,u),o=I(a*e);Ft(o)||(o=I(-o)),l||(a=o),l||(i=n);const c=I(i*(n-le)*El-u),f=a*a,h=I((a+a)*u),d=I(c*yl),D=I(le-f),g=I(le+f);return new oe(I(h*g),I(D*d),I(d*g),I(h*D))}static hashToCurve(e){e=Tt(e,64);const t=gr(e.slice(0,32)),n=this.calcElligatorRistrettoMap(t),r=gr(e.slice(32,64)),i=this.calcElligatorRistrettoMap(r);return new nt(n.add(i))}static fromHex(e){e=Tt(e,32);const{a:t,d:n}=de,r="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",i=gr(e);if(!Sl(On(i),e)||Ft(i))throw new Error(r);const u=I(i*i),l=I(le+t*u),a=I(le-t*u),o=I(l*l),c=I(a*a),f=I(t*n*o-c),{isValid:h,value:d}=fs(I(f*c)),D=I(d*a),g=I(d*D*f);let y=I((i+i)*D);Ft(y)&&(y=I(-y));const w=I(l*g),_=I(y*w);if(!h||Ft(_)||w===xe)throw new Error(r);return new nt(new oe(y,w,le,_))}toRawBytes(){let{x:e,y:t,z:n,t:r}=this.ep;const i=I(I(n+t)*I(n-t)),u=I(e*t),{value:l}=fs(I(i*u**We)),a=I(l*i),o=I(l*u),c=I(a*o*r);let f;if(Ft(r*c)){let d=I(t*In),D=I(e*In);e=d,t=D,f=I(a*Al)}else f=o;Ft(e*c)&&(t=I(-t));let h=I((n-t)*f);return Ft(h)&&(h=I(-h)),On(h)}toHex(){return Nn(this.toRawBytes())}toString(){return this.toHex()}equals(e){Dr(e);const t=this.ep,n=e.ep,r=I(t.x*n.y)===I(t.y*n.x),i=I(t.y*n.y)===I(t.x*n.x);return r||i}add(e){return Dr(e),new nt(this.ep.add(e.ep))}subtract(e){return Dr(e),new nt(this.ep.subtract(e.ep))}multiply(e){return new nt(this.ep.multiply(e))}multiplyUnsafe(e){return new nt(this.ep.multiplyUnsafe(e))}}nt.BASE=new nt(oe.BASE);nt.ZERO=new nt(oe.ZERO);const Fr=new WeakMap;class Ee{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,Fr.delete(this)}static fromHex(e,t=!0){const{d:n,P:r}=de;e=Tt(e,32);const i=e.slice();i[31]=e[31]&-129;const u=wn(i);if(t&&u>=r)throw new Error("Expected 0 < hex < P");if(!t&&u>=ku)throw new Error("Expected 0 < hex < 2**256");const l=I(u*u),a=I(l-le),o=I(n*l+le);let{isValid:c,value:f}=Nr(a,o);if(!c)throw new Error("Point.fromHex: invalid y coordinate");const h=(f&le)===le;return(e[31]&128)!==0!==h&&(f=I(-f)),new Ee(f,u)}static async fromPrivateKey(e){return(await ur(e)).point}toRawBytes(){const e=On(this.y);return e[31]|=this.x&le?128:0,e}toHex(){return Nn(this.toRawBytes())}toX25519(){const{y:e}=this,t=I((le+e)*ir(le-e));return On(t)}isTorsionFree(){return oe.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new Ee(I(-this.x),this.y)}add(e){return oe.fromAffine(this).add(oe.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return oe.fromAffine(this).multiply(e,this).toAffine()}}Ee.BASE=new Ee(de.Gx,de.Gy);Ee.ZERO=new Ee(xe,le);class Rn{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromHex(e){const t=Tt(e,64),n=Ee.fromHex(t.slice(0,32),!1),r=wn(t.slice(32,64));return new Rn(n,r)}assertValidity(){const{r:e,s:t}=this;if(!(e instanceof Ee))throw new Error("Expected Point instance");return Jn(t,de.l,!1),this}toRawBytes(){const e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(On(this.s),32),e}toHex(){return Nn(this.toRawBytes())}}function kl(...s){if(!s.every(n=>n instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(s.length===1)return s[0];const e=s.reduce((n,r)=>n+r.length,0),t=new Uint8Array(e);for(let n=0,r=0;n<s.length;n++){const i=s[n];t.set(i,r),r+=i.length}return t}const vl=Array.from({length:256},(s,e)=>e.toString(16).padStart(2,"0"));function Nn(s){if(!(s instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let t=0;t<s.length;t++)e+=vl[s[t]];return e}function vu(s){if(typeof s!="string")throw new TypeError("hexToBytes: expected string, got "+typeof s);if(s.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const e=new Uint8Array(s.length/2);for(let t=0;t<e.length;t++){const n=t*2,r=s.slice(n,n+2),i=Number.parseInt(r,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");e[t]=i}return e}function Fu(s){const t=s.toString(16).padStart(64,"0");return vu(t)}function On(s){return Fu(s).reverse()}function Ft(s){return(I(s)&le)===le}function wn(s){if(!(s instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+Nn(Uint8Array.from(s).reverse()))}function gr(s){return I(wn(s)&We**Eu-le)}function I(s,e=de.P){const t=s%e;return t>=xe?t:e+t}function ir(s,e=de.P){if(s===xe||e<=xe)throw new Error(`invert: expected positive integers, got n=${s} mod=${e}`);let t=I(s,e),n=e,r=xe,i=le;for(;t!==xe;){const l=n/t,a=n%t,o=r-i*l;n=t,t=a,r=i,i=o}if(n!==le)throw new Error("invert: does not exist");return I(r,e)}function Fl(s,e=de.P){const t=new Array(s.length),n=s.reduce((i,u,l)=>u===xe?i:(t[l]=i,I(i*u,e)),le),r=ir(n,e);return s.reduceRight((i,u,l)=>u===xe?i:(t[l]=I(i*t[l],e),I(i*u,e)),r),t}function at(s,e){const{P:t}=de;let n=s;for(;e-- >xe;)n*=n,n%=t;return n}function Bl(s){const{P:e}=de,t=BigInt(5),n=BigInt(10),r=BigInt(20),i=BigInt(40),u=BigInt(80),a=s*s%e*s%e,o=at(a,We)*a%e,c=at(o,le)*s%e,f=at(c,t)*c%e,h=at(f,n)*f%e,d=at(h,r)*h%e,D=at(d,i)*d%e,g=at(D,u)*D%e,y=at(g,u)*D%e,w=at(y,n)*f%e;return{pow_p_5_8:at(w,We)*s%e,b2:a}}function Nr(s,e){const t=I(e*e*e),n=I(t*t*e),r=Bl(s*n).pow_p_5_8;let i=I(s*t*r);const u=I(e*i*i),l=i,a=I(i*In),o=u===s,c=u===I(-s),f=u===I(-s*In);return o&&(i=l),(c||f)&&(i=a),Ft(i)&&(i=I(-i)),{isValid:o||c,value:i}}function fs(s){return Nr(le,s)}async function Br(...s){const e=await ar.sha512(kl(...s)),t=wn(e);return I(t,de.l)}function Sl(s,e){if(s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(s[t]!==e[t])return!1;return!0}function Tt(s,e){const t=s instanceof Uint8Array?Uint8Array.from(s):vu(s);if(typeof e=="number"&&t.length!==e)throw new Error(`Expected ${e} bytes`);return t}function Jn(s,e,t=!0){if(!e)throw new TypeError("Specify max value");if(typeof s=="number"&&Number.isSafeInteger(s)&&(s=BigInt(s)),typeof s=="bigint"&&s<e){if(t){if(xe<s)return s}else if(xe<=s)return s}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function Tl(s){return s[0]&=248,s[31]&=127,s[31]|=64,s}async function ur(s){if(s=typeof s=="bigint"||typeof s=="number"?Fu(Jn(s,ku)):Tt(s),s.length!==32)throw new Error("Expected 32 bytes");const e=await ar.sha512(s),t=Tl(e.slice(0,32)),n=e.slice(32,64),r=I(wn(t),de.l),i=Ee.BASE.multiply(r),u=i.toRawBytes();return{head:t,prefix:n,scalar:r,point:i,pointBytes:u}}async function Il(s){return(await ur(s)).pointBytes}async function Pl(s,e){s=Tt(s);const{prefix:t,scalar:n,pointBytes:r}=await ur(e),i=await Br(t,s),u=Ee.BASE.multiply(i),l=await Br(u.toRawBytes(),r,s),a=I(i+l*n,de.l);return new Rn(u,a).toRawBytes()}async function xl(s,e,t){e=Tt(e),t instanceof Ee||(t=Ee.fromHex(t,!1));const{r:n,s:r}=s instanceof Rn?s.assertValidity():Rn.fromHex(s),i=oe.BASE.multiplyUnsafe(r),u=await Br(n.toRawBytes(),t.toRawBytes(),e),l=oe.fromAffine(t).multiplyUnsafe(u);return oe.fromAffine(n).add(l).subtract(i).multiplyUnsafe(de.h).equals(oe.ZERO)}Ee.BASE._setWindowSize(8);const kt={node:Da,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},ar={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:Nn,getExtendedPublicKey:ur,mod:I,invert:ir,hashToPrivateScalar:s=>{if(s=Tt(s),s.length<40||s.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const e=I(wn(s),de.l);if(e===xe||e===le)throw new Error("Invalid private key");return e},randomBytes:(s=32)=>{if(kt.web)return kt.web.getRandomValues(new Uint8Array(s));if(kt.node){const{randomBytes:e}=kt.node;return new Uint8Array(e(s).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>ar.randomBytes(32),sha512:async s=>{if(kt.web){const e=await kt.web.subtle.digest("SHA-512",s.buffer);return new Uint8Array(e)}else{if(kt.node)return Uint8Array.from(kt.node.createHash("sha512").update(s).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(s=8,e=Ee.BASE){const t=e.equals(Ee.BASE)?e:new Ee(e.x,e.y);return t._setWindowSize(s),t.multiply(We),t}};var se=globalThis&&globalThis.__classPrivateFieldGet||function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},Ce=globalThis&&globalThis.__classPrivateFieldSet||function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},dt,pt,Dt,mt,gt,bt,Wt,Ne;const ye=11400714785074694791n,Oe=14029467366897019727n,hs=1609587929392839161n,Cn=9650029242287828579n,ds=2870177450012600261n,Bu=64n,Rl=2n**Bu-1n,Ol=new Mr;function ps(s,e,t,n){return BigInt(s)|BigInt(e)<<16n|BigInt(t)<<32n|BigInt(n)<<48n}function ft(s,e){return BigInt(s[e])|BigInt(s[e+1])<<8n|BigInt(s[e+2])<<16n|BigInt(s[e+3])<<24n|BigInt(s[e+4])<<32n|BigInt(s[e+5])<<40n|BigInt(s[e+6])<<48n|BigInt(s[e+7])<<56n}function Be(s,e){return s<<e&Rl|s>>Bu-e}function ee(s){return BigInt.asUintN(64,s)}class Lr{constructor(e=0){dt.set(this,void 0),pt.set(this,void 0),Dt.set(this,void 0),mt.set(this,void 0),gt.set(this,void 0),bt.set(this,void 0),Wt.set(this,void 0),Ne.set(this,void 0),this.reset(e)}reset(e=se(this,dt,"f")){return Ce(this,dt,BigInt.asUintN(32,BigInt(e)),"f"),Ce(this,pt,ee(se(this,dt,"f")+ye+Oe),"f"),Ce(this,Dt,ee(se(this,dt,"f")+Oe),"f"),Ce(this,mt,se(this,dt,"f"),"f"),Ce(this,gt,ee(se(this,dt,"f")-ye),"f"),Ce(this,bt,null,"f"),Ce(this,Wt,0,"f"),Ce(this,Ne,0,"f"),this}update(e){typeof e=="string"&&(e=Ol.encode(e));let t=0,n=e.length,r=t+n;if(n===0)return this;if(Ce(this,Wt,se(this,Wt,"f")+n,"f"),se(this,Ne,"f")===0&&Ce(this,bt,new Uint8Array(32),"f"),se(this,Ne,"f")+n<32)return se(this,bt,"f").set(e.subarray(0,n),se(this,Ne,"f")),Ce(this,Ne,se(this,Ne,"f")+n,"f"),this;if(se(this,Ne,"f")>0){se(this,bt,"f").set(e.subarray(0,32-se(this,Ne,"f")),se(this,Ne,"f"));let i=0,u;u=ft(se(this,bt,"f"),i),Ce(this,pt,ee(Be(ee(se(this,pt,"f")+u*Oe),31n)*ye),"f"),i+=8,u=ft(this.memory,i),Ce(this,Dt,ee(Be(ee(se(this,Dt,"f")+u*Oe),31n)*ye),"f"),i+=8,u=ft(this.memory,i),Ce(this,mt,ee(Be(ee(se(this,mt,"f")+u*Oe),31n)*ye),"f"),i+=8,u=ft(this.memory,i),Ce(this,gt,ee(Be(ee(se(this,gt,"f")+u*Oe),31n)*ye),"f"),t+=32-se(this,Ne,"f"),Ce(this,Ne,0,"f")}if(t<=r-32){const i=r-32;do{let u;u=ft(e,t),Ce(this,pt,ee(Be(ee(se(this,pt,"f")+u*Oe),31n)*ye),"f"),t+=8,u=ft(e,t),Ce(this,Dt,ee(Be(ee(se(this,Dt,"f")+u*Oe),31n)*ye),"f"),t+=8,u=ft(e,t),Ce(this,mt,ee(Be(ee(se(this,mt,"f")+u*Oe),31n)*ye),"f"),t+=8,u=ft(e,t),Ce(this,gt,ee(Be(ee(se(this,gt,"f")+u*Oe),31n)*ye),"f"),t+=8}while(t<=i)}return t<r&&(se(this,bt,"f").set(e.subarray(t,r),se(this,Ne,"f")),Ce(this,Ne,r-t,"f")),this}digest(){let e=se(this,bt,"f"),t=se(this,Ne,"f"),n=0,r=0n,i=0n,u=0n;for(se(this,Wt,"f")>=32?(r=Be(se(this,pt,"f"),1n)+Be(se(this,Dt,"f"),7n)+Be(se(this,mt,"f"),12n)+Be(se(this,gt,"f"),18n),r=ee(r^Be(ee(se(this,pt,"f")*Oe),31n)*ye),r=ee(r*ye+Cn),r=ee(r^Be(ee(se(this,Dt,"f")*Oe),31n)*ye),r=ee(r*ye+Cn),r=ee(r^Be(ee(se(this,mt,"f")*Oe),31n)*ye),r=ee(r*ye+Cn),r=ee(r^Be(ee(se(this,gt,"f")*Oe),31n)*ye),r=ee(r*ye+Cn)):r=ee(se(this,dt,"f")+ds),r+=BigInt(se(this,Wt,"f"));n<=t-8;)u=ft(e,n),u=ee(Be(ee(u*Oe),31n)*ye),r=ee(Be(r^u,27n)*ye+Cn),n+=8;for(n+4<=t&&(u=ps(e[n+1]<<8|e[n],e[n+3]<<8|e[n+2],0,0),r=ee(Be(r^ee(u*ye),23n)*Oe+hs),n+=4);n<t;)u=ps(e[n++],0,0,0),r=ee(Be(r^ee(u*ds),11n)*ye);return i=ee(r>>33n),r=ee((r^i)*Oe),i=ee(r>>29n),r=ee((r^i)*hs),i=ee(r>>32n),r=ee(r^i),r}}dt=new WeakMap,pt=new WeakMap,Dt=new WeakMap,mt=new WeakMap,gt=new WeakMap,bt=new WeakMap,Wt=new WeakMap,Ne=new WeakMap;function $l(s,e=0){return new Lr(e).update(s).digest()}function Su(s,e){return s<e?-1:s>e?1:0}class Qt{constructor(e,t){Object.defineProperty(this,"parent",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"left",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"right",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.left=null,this.right=null}static from(e){const t=new Qt(e.parent,e.value);return t.left=e.left,t.right=e.right,t}directionFromParent(){return this.parent===null?null:this===this.parent.left?"left":this===this.parent.right?"right":null}findMinNode(){let e=this.left;for(;e!=null&&e.left;)e=e.left;return e??this}findMaxNode(){let e=this.right;for(;e!=null&&e.right;)e=e.right;return e??this}findSuccessorNode(){if(this.right!==null)return this.right.findMinNode();let e=this.parent,t=this.directionFromParent();for(;e&&t==="right";)t=e.directionFromParent(),e=e.parent;return e}}class an{constructor(e=Su){Object.defineProperty(this,"compare",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"root",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_size",{enumerable:!0,configurable:!0,writable:!0,value:0})}static from(e,t){let n,r=[];if(e instanceof an)if(n=new an((t==null?void 0:t.compare)??e.compare),t!=null&&t.compare||t!=null&&t.map)r=e;else{const u=[];for(e.root&&(n.root=Qt.from(e.root),u.push(n.root));u.length;){const l=u.pop(),a=l.left?Qt.from(l.left):null,o=l.right?Qt.from(l.right):null;a&&(a.parent=l,u.push(a)),o&&(o.parent=l,u.push(o))}}else n=t!=null&&t.compare?new an(t.compare):new an,r=e;const i=t!=null&&t.map?Array.from(r,t.map,t.thisArg):r;for(const u of i)n.insert(u);return n}get size(){return this._size}findNode(e){let t=this.root;for(;t;){const n=this.compare(e,t.value);if(n===0)break;const r=n<0?"left":"right";t=t[r]}return t}rotateNode(e,t){const n=t==="left"?"right":"left";if(!e[n])throw new TypeError(`cannot rotate ${t} without ${n} child`);const r=e[n];if(e[n]=r[t]??null,r[t]&&(r[t].parent=e),r.parent=e.parent,e.parent){const i=e===e.parent[t]?t:n;e.parent[i]=r}else this.root=r;r[t]=e,e.parent=r}insertNode(e,t){if(this.root){let n=this.root;for(;;){const r=this.compare(t,n.value);if(r===0)break;const i=r<0?"left":"right";if(n[i])n=n[i];else return n[i]=new e(n,t),this._size++,n[i]}}else return this.root=new e(null,t),this._size++,this.root;return null}removeNode(e){let t=this.findNode(e);if(t){const n=!t.left||!t.right?t:t.findSuccessorNode(),r=n.left??n.right;r&&(r.parent=n.parent),n.parent?n.parent[n.directionFromParent()]=r:this.root=r,n!==t&&(t.value=n.value,t=n),this._size--}return t}insert(e){return!!this.insertNode(Qt,e)}remove(e){return!!this.removeNode(e)}find(e){var t;return((t=this.findNode(e))==null?void 0:t.value)??null}min(){return this.root?this.root.findMinNode().value:null}max(){return this.root?this.root.findMaxNode().value:null}clear(){this.root=null,this._size=0}isEmpty(){return this.size===0}*lnrValues(){const e=[];let t=this.root;for(;e.length||t;)t?(e.push(t),t=t.left):(t=e.pop(),yield t.value,t=t.right)}*rnlValues(){const e=[];let t=this.root;for(;e.length||t;)t?(e.push(t),t=t.right):(t=e.pop(),yield t.value,t=t.left)}*nlrValues(){const e=[];for(this.root&&e.push(this.root);e.length;){const t=e.pop();yield t.value,t.right&&e.push(t.right),t.left&&e.push(t.left)}}*lrnValues(){const e=[];let t=this.root,n=null;for(;e.length||t;)if(t)e.push(t),t=t.left;else{const r=e[e.length-1];r.right&&r.right!==n?t=r.right:(yield r.value,n=e.pop())}}*lvlValues(){const e=[];let t=this.root;for(;t;)yield t.value,t.left&&e.push(t.left),t.right&&e.push(t.right),t=e.shift()??null}*[Symbol.iterator](){yield*this.lnrValues()}}class Kt extends Qt{constructor(e,t){super(e,t),Object.defineProperty(this,"red",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.red=!0}static from(e){const t=new Kt(e.parent,e.value);return t.left=e.left,t.right=e.right,t.red=e.red,t}}class ln extends an{constructor(e=Su){super(e)}static from(e,t){let n,r=[];if(e instanceof ln)if(n=new ln((t==null?void 0:t.compare)??e.compare),t!=null&&t.compare||t!=null&&t.map)r=e;else{const u=[];for(e.root&&(n.root=Kt.from(e.root),u.push(n.root));u.length;){const l=u.pop(),a=l.left?Kt.from(l.left):null,o=l.right?Kt.from(l.right):null;a&&(a.parent=l,u.push(a)),o&&(o.parent=l,u.push(o))}}else n=t!=null&&t.compare?new ln(t.compare):new ln,r=e;const i=t!=null&&t.map?Array.from(r,t.map,t.thisArg):r;for(const u of i)n.insert(u);return n}removeFixup(e,t){var n,r,i;for(;e&&!(t!=null&&t.red);){const u=e.left===t?"left":"right",l=u==="right"?"left":"right";let a=e[l];a!=null&&a.red&&(a.red=!1,e.red=!0,this.rotateNode(e,u),a=e[l]),a&&(!((n=a.left)!=null&&n.red)&&!((r=a.right)!=null&&r.red)?(a.red=!0,t=e,e=t.parent):((i=a[l])!=null&&i.red||(a[u].red=!1,a.red=!0,this.rotateNode(a,l),a=e[l]),a.red=e.red,e.red=!1,a[l].red=!1,this.rotateNode(e,u),t=this.root,e=null))}t&&(t.red=!1)}insert(e){var n;let t=this.insertNode(Kt,e);if(t){for(;(n=t.parent)!=null&&n.red;){let r=t.parent;const i=r.directionFromParent(),u=i==="right"?"left":"right",l=r.parent[u]??null;l!=null&&l.red?(r.red=!1,l.red=!1,r.parent.red=!0,t=r.parent):(t===r[u]&&(t=r,this.rotateNode(t,i),r=t.parent),r.red=!1,r.parent.red=!0,this.rotateNode(r.parent,u))}this.root.red=!1}return!!t}remove(e){const t=this.removeNode(e);return t&&!t.red&&this.removeFixup(t.parent,t.left??t.right),!!t}}function Ds(s,e){return{lift:t=>[s.lift(t),e.lift(t)],combine:(t,n)=>{const r=s.combine(t[0],n[0]),i=e.combine(t[1],n[1]);return[r,i]},neutral:[s.neutral,e.neutral]}}const Ml={lift:s=>1,combine:(s,e)=>s+e,neutral:0};class ms extends Kt{constructor(e,t,n){super(e,t),Object.defineProperty(this,"label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"liftedValue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"monoid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.label=n.neutral,this.liftedValue=n.lift(t),this.monoid=n}updateLabel(e=!0,t){var n,r,i;this.left!==null&&this.right===null?this.label=this.monoid.combine(this.left.label,this.liftedValue):this.left===null&&this.right!==null?this.label=this.monoid.combine(this.liftedValue,this.right.label):this.left&&this.right?this.label=this.monoid.combine(((n=this.left)==null?void 0:n.label)||this.monoid.neutral,this.monoid.combine(this.liftedValue,((r=this.right)==null?void 0:r.label)||this.monoid.neutral)):this.label=this.liftedValue,e&&((i=this.parent)==null||i.updateLabel(!0,"Updated by child"))}}class jl extends ln{constructor(e,t){super(t),Object.defineProperty(this,"monoid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.monoid=Ds(e,Ds(Ml,{lift:n=>[n],combine:(n,r)=>n.concat(r),neutral:[]}))}getLowestValue(){if(!this.root)throw new Error("Can't get a range from a tree with no items");return this.root.findMinNode().value}rotateNode(e,t){var i;const n=t==="left"?"right":"left";if(!e[n])throw new TypeError(`cannot rotate ${t} without ${n} child`);const r=e[n];if(e[n]=r[t]??null,r[t]&&(r[t].parent=e),r.parent=e.parent,e.parent){const u=e===e.parent[t]?t:n;e.parent[u]=r}else this.root=r;r[t]=e,e.parent=r,(i=r[t])==null||i.updateLabel(!1,"Node rotated"),console.groupEnd()}removeFixup(e,t){var n,r,i;for(;e&&!(t!=null&&t.red);){const u=e.left===t?"left":"right",l=u==="right"?"left":"right";let a=e[l];a!=null&&a.red&&(a.red=!1,e.red=!0,this.rotateNode(e,u),a=e[l]),a&&(!((n=a.left)!=null&&n.red)&&!((r=a.right)!=null&&r.red)?(a.red=!0,t=e,e=t.parent):((i=a[l])!=null&&i.red||(a[u].red=!1,a.red=!0,this.rotateNode(a,l),a=e[l]),a.red=e.red,e.red=!1,a[l].red=!1,this.rotateNode(e,u),t=this.root,e=null))}t&&(t.red=!1)}insertFingerprintNode(e){if(this.root){let t=this.root;for(;;){const n=this.compare(e,t.value);if(n===0)break;const r=n<0?"left":"right";if(t[r])t=t[r];else return t[r]=new ms(t,e,this.monoid),this._size++,t[r]}}else return this.root=new ms(null,e,this.monoid),this._size++,this.root;return null}insert(e){var r;const t=this.insertFingerprintNode(e);let n=t;if(n){for(;(r=n.parent)!=null&&r.red;){let i=n.parent;const u=i.directionFromParent(),l=u==="right"?"left":"right",a=i.parent[l]??null;a!=null&&a.red?(i.red=!1,a.red=!1,i.parent.red=!0,n=i.parent):(n===i[l]&&(n=i,this.rotateNode(n,u),i=n.parent),i.red=!1,i.parent.red=!0,this.rotateNode(i.parent,l))}this.root.red=!1}return t==null||t.updateLabel(!0,"Node inserted"),!!n}remove(e){var n;const t=this.removeNode(e);return t&&!t.red&&this.removeFixup(t.parent,t.left??t.right),t&&((n=t.parent)==null||n.updateLabel(!0,"Child node removed")),!!t}getFingerprint(e,t,n){if(this.root===null)return{fingerprint:this.monoid.neutral[0],size:0,items:[],nextTree:null};const r=n||this.findGteNode(e),i=this.compare(e,t);if(i===0)return{fingerprint:this.root.label[0],size:this.root.label[1][0],items:this.root.label[1][1],nextTree:null};if(i<0){const{label:u,nextTree:l}=this.aggregateUntil(r,e,t);return{fingerprint:u[0],size:u[1][0],items:u[1][1],nextTree:l}}else{const u=this.root.findMinNode(),l=this.root.findMaxNode(),{label:a,nextTree:o}=this.aggregateUntil(r,e,l.value),c=this.monoid.combine(a,this.compare(l.value,e)>=0?this.monoid.lift(l.value):this.monoid.neutral);if(u.value===t)return{fingerprint:c[0],size:c[1][0],items:c[1][1],nextTree:o};const{label:f,nextTree:h}=this.aggregateUntil(u,u.value,t),d=this.monoid.combine(f,c);return{fingerprint:d[0],size:d[1][0],items:d[1][1],nextTree:h}}}findGteNode(e){let t=this.root;for(;t;){const n=this.compare(e,t.value);if(n===0)break;const r=n<0?"left":"right";if(t[r])t=t[r];else break}return t}aggregateUntil(e,t,n){const{label:r,nextTree:i}=this.aggregateUp(e,t,n);return i===null||this.compare(i.value,n)>=0?{label:r,nextTree:i}:this.aggregateDown(i.right,n,this.monoid.combine(r,i.liftedValue))}aggregateUp(e,t,n){var u;let r=this.monoid.neutral,i=e;for(;this.compare(i.findMaxNode().value,n)<0;){if(this.compare(i.value,t)>=0&&(r=this.monoid.combine(r,this.monoid.combine(i.liftedValue,((u=i.right)==null?void 0:u.label)||this.monoid.neutral))),i.parent===null)return{label:r,nextTree:null};i=i.parent}return{label:r,nextTree:i}}aggregateDown(e,t,n){var u,l;let r=e,i=n;for(;r!==null;)if(this.compare(r.value,t)<0)i=this.monoid.combine(i,this.monoid.combine(((u=r.left)==null?void 0:u.label)||this.monoid.neutral,r.liftedValue)),r=r.right;else{if(r.left===null||this.compare(r.left.findMaxNode().value,t)<0)return{label:this.monoid.combine(i,((l=r.left)==null?void 0:l.label)||this.monoid.neutral),nextTree:r};r=r.left}return{label:i,nextTree:null}}}function Nl(){let s,e="pending";const t=new Promise((n,r)=>{s={async resolve(i){await i,e="fulfilled",n(i)},reject(i){e="rejected",r(i)}}});return Object.defineProperty(t,"state",{get:()=>e}),Object.assign(t,s)}class Ll{constructor(){Object.defineProperty(this,"deferreds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"pending"})}resolve(e){if(this.state==="pending"){this.state="fulfilled";for(const t of this.deferreds)t.resolve(e)}}reject(e){if(this.state==="pending"){this.state="rejected";for(const t of this.deferreds)t.reject(e)}}tee(){const e=Nl();return this.state==="fulfilled"?e.resolve():this.state==="rejected"?e.reject():this.deferreds.add(e),e}}class Ul{constructor(e){Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDoneTee",{enumerable:!0,configurable:!0,writable:!0,value:new Ll}),Object.defineProperty(this,"insertionCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"fingerprintEquals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowerBoundFromPrev",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"collatedPayload",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"collatePayloads",{enumerable:!0,configurable:!0,writable:!0,value:t=>{switch(t.type){case"payload":{let n=this.collatedPayload;if(n===null&&(n={type:"payload",lowerBound:t.lowerBound,payload:[],end:{canRespond:!1,upperBound:t.payload}}),n.payload.push(t.payload),this.collatedPayload=n,t.end)return t.end.upperBound?n.end=t.end:n.end={...t.end,upperBound:t.payload},this.collatedPayload=null,n;break}default:return this.collatedPayload&&(this.collatedPayload=null),t}}}),Object.defineProperty(this,"reusableTree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastAdjacentDoneUpperBound",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"isDoneSoFar",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.tree=e.tree,this.fingerprintEquals=e.fingerprintEquals,this.encoding=e.encoding,this.payloadThreshold=e.payloadThreshold,this.rangeDivision=e.rangeDivision}decode(e){const t=this.lowerBoundFromPrev;try{return{type:"emptySet",canRespond:this.encoding.decode.emptySet(e)}}catch{}try{const n=this.encoding.decode.lowerBound(e);return this.lowerBoundFromPrev=n,{type:"lowerBound",value:n}}catch{}try{return this.encoding.decode.terminal(e),{type:"terminal"}}catch{}try{const n=this.encoding.decode.done(e);return this.lowerBoundFromPrev=n,{lowerBound:t,type:"done",upperBound:n}}catch{}try{const n=this.encoding.decode.fingerprint(e);return this.lowerBoundFromPrev=n.upperBound,{type:"fingerprint",lowerBound:t,fingerprint:n.fingerprint,upperBound:n.upperBound}}catch{}try{const n=this.encoding.decode.payload(e);return n.end&&(this.lowerBoundFromPrev=n.end.upperBound),{type:"payload",lowerBound:t,payload:n.value,...n.end?{end:n.end}:{}}}catch{}try{const n=this.encoding.decode.emptyPayload(e);return this.lowerBoundFromPrev=n,{lowerBound:t,type:"emptyPayload",upperBound:n}}catch{}return null}setReusableTree(e){this.reusableTree=e||void 0}process(e){const t=this.reusableTree;switch(e.type){case"lowerBound":case"terminal":case"done":return this.setReusableTree(null),[e];case"emptySet":{if(e.canRespond===!1&&this.isDoneTee.resolve(),this.tree.size===0)return[{type:"emptySet",canRespond:!1}];const n=this.tree.getLowestValue(),r=[{type:"lowerBound",value:n}],i=Array.from(this.tree.lnrValues());for(let u=0;u<i.length;u++){const l=i[u];u===i.length-1?r.push({type:"payload",payload:l,end:{upperBound:n,canRespond:!1}}):r.push({type:"payload",payload:l})}return r.push({type:"terminal"}),r}case"fingerprint":{const{fingerprint:n,size:r,items:i,nextTree:u}=this.tree.getFingerprint(e.lowerBound,e.upperBound,t);if(this.setReusableTree(u),this.fingerprintEquals(n,e.fingerprint))return[{type:"done",upperBound:e.upperBound}];if(r<=this.payloadThreshold){if(r===0)return[{type:"emptyPayload",upperBound:e.upperBound}];const l=[];for(let a=0;a<r;a++)l.push({type:"payload",payload:i[a],...a===i.length-1?{end:{upperBound:e.upperBound,canRespond:!0}}:{}});return l}else{const l=Math.ceil(r/this.rangeDivision),a=[];if(l<=this.payloadThreshold){for(let h=0;h<i.length;h++)a.push({type:"payload",payload:i[h],...h===i.length-1?{end:{upperBound:e.upperBound,canRespond:!0}}:{}});return a}let o;const c=i;let f=!1;if(e.lowerBound>=e.upperBound){const h=i.findIndex(d=>d>=e.lowerBound);if(h>0){const d=c.splice(0,h);c.push(...d),f=!0}}for(let h=0;h<r;h+=l){const d=c[h],D=c[h+l]||e.upperBound,{fingerprint:g,nextTree:y}=this.tree.getFingerprint(d,D,o);o=f?void 0:y||void 0,a.push({type:"fingerprint",fingerprint:g,upperBound:D})}return a}}case"payload":{for(const n of e.payload){this.tree.insert(n);for(const r of this.insertionCallbacks)r(n)}if(e.end.canRespond){const{items:n,size:r,nextTree:i}=this.tree.getFingerprint(e.lowerBound,e.end.upperBound,t);if(this.setReusableTree(i),r===0)return[{type:"emptyPayload",upperBound:e.end.upperBound}];const u=[];for(let l=0;l<r;l++)u.push({type:"payload",payload:n[l],...l===n.length-1?{end:{upperBound:e.end.upperBound,canRespond:!1}}:{}});return u}else return this.setReusableTree(null),[{type:"done",upperBound:e.end.upperBound}]}case"emptyPayload":{this.setReusableTree(null);const{items:n,size:r,nextTree:i}=this.tree.getFingerprint(e.lowerBound,e.upperBound);if(this.setReusableTree(i),r===0)return this.setReusableTree(null),[];const u=[];for(let l=0;l<r;l++)u.push({type:"payload",payload:n[l],...l===n.length-1?{end:{upperBound:e.upperBound,canRespond:!1}}:{}});return u}}}consolidateAdjacentDones(e){switch(e.type){case"done":{this.lastAdjacentDoneUpperBound=e.upperBound;break}default:{const t=this.lastAdjacentDoneUpperBound;return t?(this.lastAdjacentDoneUpperBound=null,[{type:"done",upperBound:t},e]):[e]}}}checkIsDone(e){var t;switch(e.type){case"emptySet":{e.canRespond&&(this.isDoneSoFar=!1);break}case"lowerBound":break;case"fingerprint":this.isDoneSoFar=!1;break;case"emptyPayload":this.isDoneSoFar=!1;break;case"payload":((t=e.end)==null?void 0:t.canRespond)===!0&&(this.isDoneSoFar=!1);break;case"terminal":this.isDoneSoFar?this.isDoneTee.resolve():this.isDoneSoFar=!0}}encode(e){let t;switch(e.type){case"emptySet":{t=this.encoding.encode.emptySet(e.canRespond);break}case"lowerBound":{t=this.encoding.encode.lowerBound(e.value);break}case"done":{t=this.encoding.encode.done(e.upperBound);break}case"fingerprint":{t=this.encoding.encode.fingerprint(e.fingerprint,e.upperBound);break}case"payload":{t=this.encoding.encode.payload(e.payload,e.end);break}case"emptyPayload":{t=this.encoding.encode.emptyPayload(e.upperBound);break}case"terminal":{t=this.encoding.encode.terminal();break}}return t}respond(e){if(this.isDone().state==="fulfilled")return[];const t=this.decode(e),n=this.collatePayloads(t);if(n===void 0)return[];const r=this.process(n||[]),i=[];for(const l of r){const a=this.consolidateAdjacentDones(l);a&&i.push(...a)}for(const l of i)this.checkIsDone(l);const u=[];for(const l of i)u.push(this.encode(l));return u}isDone(){return this.isDoneTee.tee()}initialMessages(e){const{tree:t,encoding:n,payloadThreshold:r,rangeDivision:i}=this;function*u(){if(t.size===0){yield n.encode.emptySet(!0);return}const l=t.getLowestValue();yield n.encode.lowerBound(l);const{items:o}=t.getFingerprint(l,l),f=(e||(D=>{const g=Math.ceil(D.length/i),y=[];for(let w=0;w<D.length;w+=g){const _=D.slice(w,w+g);y.push(_)}return y}))(o);let h;for(let D=0;D<f.length;D++){const g=f[D+1]?f[D+1][0]:l,y=f[D];if(y.length<=r)for(let w=0;w<y.length;w++)yield n.encode.payload(y[w],w===y.length-1?{upperBound:g,canRespond:!0}:void 0);else{const w=y[0],{fingerprint:_,nextTree:v}=t.getFingerprint(w,g,h);h=v||void 0,yield n.encode.fingerprint(_,g)}}yield n.encode.terminal()}return u()}onInsertion(e){return this.insertionCallbacks.add(e),()=>{this.insertionCallbacks.delete(e)}}}var Me=globalThis&&globalThis.__classPrivateFieldGet||function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},qn=globalThis&&globalThis.__classPrivateFieldSet||function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},Nt,Lt,En,ht,br,Wn;const gs=Symbol("Stream ended."),wr=Symbol("Stream errored.");class _t{constructor(e){var t,n,r;Nt.add(this),Lt.set(this,[]),En.set(this,null),ht.set(this,void 0),Object.defineProperty(this,"push",{enumerable:!0,configurable:!0,writable:!0,value:(...i)=>{i.length?Me(this,Nt,"m",Wn).call(this,!1,i):(Me(this,Nt,"m",Wn).call(this,!1,[wr]),Me(this,Nt,"m",br).call(this,new Error("AsyncQueueError: queue.push was called with no arguments")))}}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:({immediately:i=!1,withError:u}={})=>{u&&Me(this,Nt,"m",br).call(this,u),Me(this,Nt,"m",Wn).call(this,i,[u?wr:gs]),this.push=this.close=()=>{}}}),(r=(n=(t=e==null?void 0:e.catch)==null?void 0:t.call(e,i=>this.close({withError:i})))==null?void 0:n.finally)==null||r.call(n,()=>this.close())}get length(){return Me(this,Lt,"f").length}async*[(Lt=new WeakMap,En=new WeakMap,ht=new WeakMap,Nt=new WeakSet,br=function(t){Me(this,ht,"f")instanceof AggregateError?Me(this,ht,"f").errors.push(t):Me(this,ht,"f")?qn(this,ht,new AggregateError([Me(this,ht,"f"),t]),"f"):qn(this,ht,t,"f")},Wn=function(t,n){var r;Me(this,Lt,"f")[t?"unshift":"push"](...n),(r=Me(this,En,"f"))==null||r.call(this,Me(this,Lt,"f").shift()),qn(this,En,null,"f")},Symbol.asyncIterator)](){for(;;){const e=Me(this,Lt,"f").length?Me(this,Lt,"f").shift():await new Promise(t=>{qn(this,En,t,"f")});if(e===wr)throw Me(this,ht,"f");if(e===gs)break;yield e}}}function X(){let s,e="pending";const t=new Promise((n,r)=>{s={async resolve(i){await i,e="fulfilled",n(i)},reject(i){e="rejected",r(i)}}});return Object.defineProperty(t,"state",{get:()=>e}),Object.assign(t,s)}new iu;const zl=new Mr;function Sr(s){return zl.encode(s)}function Hl(s){return Sr(s).length}function Tr(s,e){for(let t of s)if(e.indexOf(t)===-1)return!1;return!0}function bs(s){return s===""?!1:Ln.indexOf(s)!==-1}const _n="abcdefghijklmnopqrstuvwxyz",ql=_n.toUpperCase(),Ln="0123456789",yt=_n+"234567",Tu=_n+Ln,Wl=yt,Iu=Tu+yt+"@.",Pu=_n+Ln,Ql=_n+Ln,xu=Pu+yt+"+.",Kl="/'()-._~!$&+,:=@%",Ru=_n+ql+Ln+Kl;function Vl(s,e){return`@${s}.${e}`}function Gl(s,e){return`+${s}.${e}`}function lr(s){const e=Ou(s);return nu(e)?!0:e}function Ot(s){const e=$u(s);return nu(e)?!0:e}function Ir(s){return s.startsWith("@")?Ou(s):s.startsWith("+")?$u(s):new O("address must start with either @ or +")}function Ou(s){return Mu(s,{sigil:"@",separator:".",minNameLength:4,maxNameLength:4,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:Tu,allowedPubkeyCharacters:Wl,pubkeyMustStartWithB:!0})}function $u(s){return Mu(s,{sigil:"+",separator:".",minNameLength:1,maxNameLength:15,minPubkeyLength:1,maxPubkeyLength:53,allowedNameCharacters:Pu,allowedPubkeyCharacters:Ql,pubkeyMustStartWithB:!1})}function Mu(s,e){const{sigil:t,separator:n,minNameLength:r,maxNameLength:i,minPubkeyLength:u,maxPubkeyLength:l,allowedNameCharacters:a,allowedPubkeyCharacters:o,pubkeyMustStartWithB:c}=e;if(typeof s!="string")return new O("address must be a string");if(s.length<4)return new O("address is too short");if(s[0]!==t)return new O(`address must start with a sigil: "${t}"`);if(s.indexOf(n)===-1)return new O(`address must contain a separator character: "${n}"`);const f=s.slice(1).split(n);if(f.length!==2)return new O(`address must have exactly 2 parts separated by a "${n}" separator`);const[h,d]=f;return h.length<r||h.length>i?new O(`name must be between ${r} and ${i} characters long, but is ${h.length}`):d.length<u||d.length>l?new O(`pubkey must be between ${u} and ${l} characters long, but is ${d.length}`):Tr(h,a)?Tr(d,o)?bs(h[0])?new O(`name "${h}" must not start with a digit`):bs(d[0])?new O(`pubkey "${d}" must not start with a digit`):c&&d[0]!=="b"?new O(`pubkey "${d}" must start with 'b'`):{address:s,name:h,pubkey:d}:new O(`pubkey "${d}" must only have allowed characters`):new O(`name "${h}" must only have allowed characters`)}function Ur(s){return!(Object.prototype.toString.call(s)!=="[object Object]"||(""+s.constructor).startsWith("class"))}function ju(s){return e=>e!==s?`expected literal value ${JSON.stringify(s)}`:null}function Ge(s={}){return e=>{if(s.optional!==!0&&e===void 0)return"required";if(s.optional===!0&&e===void 0)return null;let t=Hl(e);return typeof e!="string"?"expected a string but got "+JSON.stringify(e):s.minLen!==void 0&&t<s.minLen?`string shorter than min length of ${s.minLen} chars`:s.maxLen!==void 0&&t>s.maxLen?`string shorter than max length of ${s.maxLen} chars`:s.len!==void 0&&t!==s.len?`string does not have required length of ${s.len} chars: ${e}`:s.allowedChars!==void 0&&!Tr(e,s.allowedChars)?"contains disallowed characters":null}}function Pn(s={}){return e=>s.optional!==!0&&e===void 0?"required":s.optional===!0&&e===void 0?null:s.nullable!==!0&&e===null?"not nullable":s.nullable===!0&&e===null?null:typeof e!="number"?"expected a number but got "+JSON.stringify(e):isNaN(e)?"is NaN":isFinite(e)?e!==Math.round(e)?"expected an integer":s.min!==void 0&&e<s.min?`integer too small (must be >= ${s.min})`:s.max!==void 0&&e>s.max?`integer too large (must be <= ${s.max})`:null:"is Infinity"}function Nu(s={}){return s.allowLiteralUndefined=s.allowLiteralUndefined??!1,s.allowExtraKeys=s.allowExtraKeys??!1,e=>{if(!Ur(e))return"expected an object";if(s.allowLiteralUndefined===!1){for(let[t,n]of Object.entries(e))if(n===void 0)return`${t} is explicitly set to undefined but should be missing instead`}if(s.objSchema!==void 0){if(s.allowExtraKeys===!1){let t=Object.keys(e),n=Object.keys(s.objSchema),r=t.filter(i=>n.indexOf(i)===-1);if(r.length>0)return`object has extra keys not in the schema: ${r.join(", ")}`}for(let[t,n]of Object.entries(s.objSchema)){let r=n(e[t]);if(r!==null)return`${t}: ${r}`}}return null}}const{codec:Lu}=ll,Uu={chars:"abcdefghijklmnopqrstuvwxyz234567",bits:5};function tn(s){return"b"+Lu.stringify(s,Uu,{pad:!1})}function er(s){if(!s.startsWith("b"))throw new O("can't decode base32 string - it should start with a 'b'. "+s);if(s[s.length-1]==="=")throw new O("can't decode base32 string - it contains padding characters ('=')");return Lu.parse(s.slice(1),Uu,{loose:!0})}var wt;(function(s){s[s.None=-1]="None",s[s.Error=0]="Error",s[s.Warn=1]="Warn",s[s.Log=2]="Log",s[s.Info=3]="Info",s[s.Debug=4]="Debug"})(wt||(wt={}));const Zl=wt.Error;let _r={_default:Zl};function Yl(s){return s in _r?_r[s]:_r._default}class Ue{constructor(e,t){Object.defineProperty(this,"source",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.source=e,this.color=t||"aqua"}_print(e,t,n,...r){if(e<=Yl(this.source))if(t){const i=`[${this.source}]`;if(this.color!==void 0){const u=[`%c ${i}`,`color: ${this.color}`];console.log(n,...u,...r)}else console.log(n,i,...r)}else console.log(n,...r)}error(...e){this._print(wt.Error,!0,"!!",...e)}warn(...e){this._print(wt.Warn,!0,"! ",...e)}log(...e){this._print(wt.Log,!0,"  ",...e)}info(...e){this._print(wt.Info,!0,"    ",...e)}debug(...e){this._print(wt.Debug,!0,"      ",...e)}blank(){this._print(wt.Info,!1,"")}}class Xl{constructor(e){Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalDigest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.hash=e.hash,this.internalUpdate=e.update,this.internalDigest=e.digest}update(e){return this.hash=this.internalUpdate(this.hash,e),this.hash}digest(){return this.internalDigest(this.hash)}}const{createHash:yr}=_l,Ar=new Ue("crypto-driver-noble","cyan"),Jl=class{static sha256(s){return typeof s=="string"?Promise.resolve(yr("sha256").update(s,"utf-8").digest()):Promise.resolve(yr("sha256").update(s).digest())}static updatableSha256(){return new Xl({hash:yr("sha256"),update:(s,e)=>s.update(e),digest:s=>s.digest()})}static async generateKeypairBytes(){Ar.debug("generateKeypairBytes");const s=ar.randomPrivateKey();return{pubkey:await Il(s),secret:s}}static sign(s,e){return Ar.debug("sign"),typeof e=="string"&&(e=Sr(e)),Pl(e,s.secret)}static async verify(s,e,t){Ar.debug("verify");try{return typeof t=="string"&&(t=Sr(t)),await xl(e,t,s)}catch{return!1}}};function ws(){return Date.now()*1e3}function zu(s){return new Promise(e=>{Vt(e,s)})}function At(){return""+Math.floor(Math.random()*1e3)+Math.floor(Math.random()*1e3)}function eo(s){try{const e=Hu(s)?s.address:s.shareAddress,t=Ir(e);if(R(t))return t;const n={pubkey:er(t.pubkey),secret:er(s.secret)};return n.pubkey.length!==32?new O(`pubkey bytes should be 32 bytes long, not ${n.pubkey.length} after base32 decoding.  ${e}`):n.secret.length!==32?new O(`secret bytes should be 32 bytes long, not ${n.secret.length} after base32 decoding.  ${s.secret}`):n}catch(e){return new O("crash while decoding author keypair: "+e.message)}}function Hu(s){return"address"in s}new Ue("crypto","cyan");let nn=Jl,kn=new Ue("crypto","cyan");const Ae=class{static async sha256base32(s){const e=await nn.sha256(s);return tn(e)}static updatableSha256(){return nn.updatableSha256()}static async generateAuthorKeypair(s){kn.debug(`generateAuthorKeypair("${s}")`);const e=await nn.generateKeypairBytes(),t={address:Vl(s,tn(e.pubkey)),secret:tn(e.secret)},n=lr(t.address);return R(n)?n:t}static async generateShareKeypair(s){kn.debug(`generateAuthorKeypair("${s}")`);const e=await nn.generateKeypairBytes(),t={shareAddress:Gl(s,tn(e.pubkey)),secret:tn(e.secret)},n=Ot(t.shareAddress);return R(n)?n:t}static async sign(s,e){kn.debug("sign");try{const t=eo(s);if(R(t))return t;const n=await nn.sign(t,e);return tn(n)}catch(t){return new O("unexpected error while signing: "+t.message)}}static verify(s,e,t){kn.debug("verify");try{const n=Ir(s);return R(n)?Promise.resolve(!1):nn.verify(er(n.pubkey),er(e),t)}catch{return Promise.resolve(!1)}}static async checkKeypairIsValid(s){kn.debug("checkAuthorKeypairIsValid");const e=Hu(s)?s.address:s.shareAddress;try{if(typeof e!="string"||typeof s.secret!="string")return new O("address and secret must be strings");const t=Ir(e);if(R(t))return t;const n="a test message to sign. "+At(),r=await this.sign(s,n);return R(r)?r:await this.verify(e,r,n)===!1?new O("pubkey does not match secret"):!0}catch(t){return new O("unexpected error in checkAuthorKeypairIsValid: "+t.message)}}};var Cr;new Ue("validator es.4","red");const to=10,no=to*60*1e3*1e3,_s=1e13,ys=9007199254740990,ro=4e6,so=53,io=104,As={objSchema:{format:ju("es.4"),author:Ge({allowedChars:Iu}),content:Ge({maxLen:ro}),contentHash:Ge({allowedChars:yt,len:so}),deleteAfter:Pn({min:_s,max:ys,nullable:!0}),path:Ge({allowedChars:Ru,minLen:2,maxLen:512}),signature:Ge({allowedChars:yt,len:io}),timestamp:Pn({min:_s,max:ys}),workspace:Ge({allowedChars:xu})},allowLiteralUndefined:!1,allowExtraKeys:!1};Cr=class{static hashDocument(s){const e={...s,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},t=this._checkBasicDocumentValidity(e);return R(t)?Promise.resolve(t):Ae.sha256base32(`author	${s.author}
contentHash	${s.contentHash}
`+(s.deleteAfter===null?"":`deleteAfter	${s.deleteAfter}
`)+`format	${s.format}
path	${s.path}
timestamp	${s.timestamp}
workspace	${s.workspace}
`)}static async generateDocument({input:s,keypair:e,share:t,timestamp:n}){const r={format:"es.4",author:e.address,content:s.content,contentHash:await Ae.sha256base32(s.content),deleteAfter:s.deleteAfter??null,path:s.path,timestamp:n,workspace:t,signature:"?"},i=await this.signDocument(e,r);return R(i)?i:{doc:i}}static async signDocument(s,e){const t=await this.hashDocument(e);if(R(t))return t;const n=await Ae.sign(s,t);return R(n)?n:{...e,signature:n}}static async wipeDocument(s,e){if(e.content.length===0)return e;const t=this.removeExtraFields(e);if(R(t))return t;const r={...t.doc,content:"",contentHash:await Ae.sha256base32(""),signature:"?"};return this.signDocument(s,r)}static removeExtraFields(s){if(!Ur(s))return new O("doc is not a plain javascript object");const e=new Set(Object.keys(As.objSchema||{})),t={},n={};for(const[r,i]of Object.entries(s))if(e.has(r))t[r]=i;else{if(!r.startsWith("_"))return new O("extra document fields must have names starting with an underscore");n[r]=i}return{doc:t,extras:n}}static async checkDocumentIsValid(s,e){e===void 0&&(e=Date.now()*1e3);const t=this._checkBasicDocumentValidity(s);if(R(t))return t;const n=this._checkTimestampIsOk(s.timestamp,s.deleteAfter,e);if(R(n))return n;const r=this._checkAuthorCanWriteToPath(s.author,s.path);if(R(r))return r;const i=this._checkPathIsValid(s.path,s.deleteAfter);if(R(i))return i;const u=lr(s.author);if(R(u))return u;const l=Ot(s.workspace);if(R(l))return l;const a=await this._checkAuthorSignatureIsValid(s);if(R(a))return a;const o=await this._checkContentMatchesHash(s.content,s.contentHash);return R(o)?o:!0}static _checkBasicDocumentValidity(s){const e=Nu(As)(s);return e!==null?new O(e):!0}static _checkAuthorCanWriteToPath(s,e){return e.indexOf("~")===-1||e.indexOf("~"+s)!==-1?!0:new O(`author ${s} can't write to path ${e}`)}static _checkTimestampIsOk(s,e,t){if(s>t+no)return new O("timestamp too far in the future");if(e!==null){if(t>e)return new O("ephemeral doc has expired");if(e<=s)return new O("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(s,e){if(!s.startsWith("/"))return new O("invalid path: must start with /");if(s.endsWith("/"))return new O("invalid path: must not end with /");if(s.startsWith("/@"))return new O('invalid path: must not start with "/@"');if(s.indexOf("//")!==-1)return new O("invalid path: must not contain two consecutive slashes");if(e!==void 0){if(s.indexOf("!")===-1&&e!==null)return new O("when deleteAfter is set, path must contain '!'");if(s.indexOf("!")!==-1&&e===null)return new O("when deleteAfter is null, path must not contain '!'")}return!0}static async _checkAuthorSignatureIsValid(s){try{const e=await this.hashDocument(s);return R(e)?e:await Ae.verify(s.author,s.signature,e)!==!0?new O("signature is invalid"):!0}catch{return new O("signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(s,e){return await Ae.sha256base32(s)!==e?new O("content does not match contentHash"):!0}static getAttachmentInfo(s){return new O("es.4 does not support attachments")}static updateAttachmentFields(s,e,t,n){return Promise.resolve(new O("es.4 does not support attachments"))}static authorFromCredentials(s){return s.address}},Object.defineProperty(Cr,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.4"});var Er;new Ue("validator es.5","red");const uo=10,ao=uo*60*1e3*1e3,Cs=1e13,Es=9007199254740990,lo=8e3,ks=53,vs=104,oo=0,co=Number.MAX_SAFE_INTEGER,Fs={objSchema:{format:ju("es.5"),author:Ge({allowedChars:Iu}),text:Ge({maxLen:lo}),textHash:Ge({allowedChars:yt,len:ks}),deleteAfter:Pn({min:Cs,max:Es,optional:!0}),path:Ge({allowedChars:Ru,minLen:2,maxLen:512}),signature:Ge({allowedChars:yt,len:vs}),shareSignature:Ge({allowedChars:yt,len:vs}),timestamp:Pn({min:Cs,max:Es}),share:Ge({allowedChars:xu}),attachmentSize:Pn({min:oo,max:co,optional:!0}),attachmentHash:Ge({allowedChars:yt,len:ks,optional:!0})},allowLiteralUndefined:!1,allowExtraKeys:!1},fo=(Er=class{static hashDocument(s){const e={...s,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",shareSignature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},t=this._checkBasicDocumentValidity(e);return R(t)?Promise.resolve(t):Ae.sha256base32((s.attachmentHash===void 0?"":`attachmentHash	${s.attachmentHash}
`)+(s.attachmentSize===void 0?"":`attachmentSize	${s.attachmentSize}
`)+`author	${s.author}
`+(s.deleteAfter===void 0?"":`deleteAfter	${s.deleteAfter}
`)+`format	${s.format}
path	${s.path}
textHash	${s.textHash}
timestamp	${s.timestamp}
share	${s.share}
`)}static async generateDocument({input:s,keypair:e,share:t,timestamp:n,prevLatestDoc:r,config:i}){if(s.text===void 0&&(r==null?void 0:r.text)===void 0)return new O("Couldn't determine document text from given input or previous version's text.");const u=s.text!==void 0?s.text:r==null?void 0:r.text,l={...r,format:"es.5",author:e.address,text:u,textHash:await Ae.sha256base32(u),path:s.path,timestamp:n,share:t,signature:"?",shareSignature:"?"};s.deleteAfter&&(l.deleteAfter=s.deleteAfter);const a=await this.signDocument(e,l,i);return R(a)?a:s.attachment?{doc:a,attachment:s.attachment}:{doc:a}}static async signDocument(s,e,t){const n=await this.hashDocument(e);if(R(n))return n;const r=await Ae.sign(s,n);if(t.shareSecret===void 0)return new Qe(`Tried to write a document to ${e.share} without the secret.`);const i=await Ae.sign({shareAddress:e.share,secret:t.shareSecret},n);return R(r)?r:R(i)?i:{...e,signature:r,shareSignature:i}}static async wipeDocument(s,e,t){if(e.text.length===0)return e;const n=this.removeExtraFields(e);if(R(n))return n;const r=n.doc;if(r.attachmentHash){const u={...r,text:"",textHash:await Ae.sha256base32(""),signature:"?",shareSignature:"?",attachmentHash:await Ae.sha256base32(""),attachmentSize:0};return this.signDocument(s,u,t)}const i={...r,text:"",textHash:await Ae.sha256base32(""),signature:"?",shareSignature:"?"};return this.signDocument(s,i,t)}static removeExtraFields(s){if(!Ur(s))return new O("doc is not a plain javascript object");const e=new Set(Object.keys(Fs.objSchema||{})),t={},n={};for(const[r,i]of Object.entries(s))if(e.has(r))t[r]=i;else{if(!r.startsWith("_"))return new O("extra document fields must have names starting with an underscore");n[r]=i}return{doc:t,extras:n}}static async checkDocumentIsValid(s,e){e===void 0&&(e=Date.now()*1e3);const t=this._checkBasicDocumentValidity(s);if(R(t))return t;const n=this._checkTimestampIsOk(s.timestamp,s.deleteAfter?s.deleteAfter:null,e);if(R(n))return n;const r=this._checkAuthorCanWriteToPath(s.author,s.path);if(R(r))return r;const i=this._checkAttachmentFieldsConsistent(s);if(R(i))return i;const u=this._checkPathIsValid(s.path,!!s.attachmentHash,s.deleteAfter);if(R(u))return u;const l=lr(s.author);if(R(l))return l;const a=Ot(s.share);if(R(a))return a;const o=await this._checkAuthorSignatureIsValid(s);if(R(o))return o;const c=await this._checkShareSignatureIsValid(s);if(R(c))return c;const f=await this._checkContentMatchesHash(s.text,s.textHash);return R(f)?f:!0}static _checkBasicDocumentValidity(s){const e=Nu(Fs)(s);return e!==null?new O(e):!0}static _checkAttachmentFieldsConsistent(s){return s.text.length===0&&s.attachmentSize&&s.attachmentSize>0?new O("Documents with attachments must have text."):(s.text.length>0&&s.attachmentSize&&s.attachmentSize,s.attachmentHash&&s.attachmentSize===void 0?new O("Attachment size is undefined while attachment hash is defined"):s.attachmentSize&&s.attachmentHash===void 0?new O("Attachment hash is undefined while attachment size is defined"):!0)}static _checkAuthorCanWriteToPath(s,e){return e.indexOf("~")===-1||e.indexOf("~"+s)!==-1?!0:new O(`author ${s} can't write to path ${e}`)}static _checkTimestampIsOk(s,e,t){if(s>t+ao)return new O("timestamp too far in the future");if(e!==null){if(t>e)return new O("ephemeral doc has expired");if(e<=s)return new O("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(s,e,t){if(!s.startsWith("/"))return new O("invalid path: must start with /");if(s.endsWith("/"))return new O("invalid path: must not end with /");if(s.startsWith("/@"))return new O('invalid path: must not start with "/@"');if(s.indexOf("//")!==-1)return new O("invalid path: must not contain two consecutive slashes");if(t!==void 0){if(s.indexOf("!")===-1&&t!==null)return new O("when deleteAfter is set, path must contain '!'");if(s.indexOf("!")!==-1&&t===null)return new O("when deleteAfter is null, path must not contain '!'")}return!Bs(s)&&e?new O("when a attachment is provided, the path must end with a file extension"):Bs(s)&&e===!1?new O("when no attachment is provided, the path cannot end with a file extension"):!0}static async _checkAuthorSignatureIsValid(s){try{const e=await this.hashDocument(s);return R(e)?e:await Ae.verify(s.author,s.signature,e)!==!0?new O("signature is invalid"):!0}catch{return new O("signature is invalid (unexpected exception)")}}static async _checkShareSignatureIsValid(s){try{const e=await this.hashDocument(s);return R(e)?e:await Ae.verify(s.share,s.shareSignature,e)!==!0?new O("share signature is invalid"):!0}catch{return new O("share signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(s,e){return await Ae.sha256base32(s)!==e?new O("content does not match contentHash"):!0}static getAttachmentInfo(s){return s.attachmentHash&&s.attachmentSize===0?new O("This document has had its attachment wiped"):!s.attachmentHash||!s.attachmentSize?new O("This document has no attachment."):{size:s.attachmentSize,hash:s.attachmentHash}}static updateAttachmentFields(s,e,t,n,r){const i={...e,attachmentHash:n,attachmentSize:t};return this.signDocument(s,i,r)}static authorFromCredentials(s){return s.address}},Object.defineProperty(Er,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.5"}),Er),ho=/^.*\.(\w+)$/,po=/^.*~@\w{4}\.\w{53}$/;function Bs(s){if(s.indexOf(".")===-1)return!1;const e=s.match(ho);return!(e===null||e[1].length===53&&s.match(po))}const lt=fo,or=[lt];function Ss(s){return s||lt}function hn(s){return s||or}function Do(s,e){const t=[];for(const n of e)s.includes(n.id)&&t.push(n);return t}function dn(s){const e=s||or,t={};for(const n of e)t[n.id]=n;return t}class cr{constructor(){Object.defineProperty(this,"deferreds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"pending"})}resolve(e){if(this.state==="pending"){this.state="fulfilled";for(const t of this.deferreds)t.resolve(e)}}reject(e){if(this.state==="pending"){this.state="rejected";for(const t of this.deferreds)t.reject(e)}}getPromise(){const e=X();return this.state==="fulfilled"?e.resolve():this.state==="rejected"?e.reject():this.deferreds.add(e),e}}class $n{constructor(e=!1){Object.defineProperty(this,"promises",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"sealed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"multiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new cr}),Object.defineProperty(this,"allowRejectedPromises",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.allowRejectedPromises=e}enrol(e){if(this.sealed)throw new Qe("Tried to enrol a promise when enrolment was already sealed.");this.promises.add(e),e.then(()=>{this.checkAllDone()}).catch(t=>{if(!this.allowRejectedPromises)throw t})}checkAllDone(){this.sealed&&(this.allowRejectedPromises?Promise.allSettled(this.promises).then(()=>{this.multiDeferred.resolve()}):Promise.all(this.promises).then(()=>{this.multiDeferred.resolve()}).catch(()=>{this.multiDeferred.reject()}))}seal(){this.sealed||(this.sealed=!0,this.checkAllDone())}isSealed(){return this.sealed}isDone(){return this.multiDeferred.getPromise()}}class mo{constructor(){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"transform",{enumerable:!0,configurable:!0,writable:!0,value:new mn({transform(e,t){t.enqueue(e)}})}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:this.transform.writable.getWriter()}),Object.defineProperty(this,"readable",{enumerable:!0,configurable:!0,writable:!0,value:this.transform.readable}),Object.defineProperty(this,"writables",{enumerable:!0,configurable:!0,writable:!0,value:[]})}checkClosed(){if(this.closed)throw"Closed"}getWritableStream(){this.checkClosed();const e=this.writer,t=new et({async write(n){await e.ready,await e.write(n)}});return this.writables.push(t),t}async close(){this.checkClosed();for(const e of this.writables)await e.abort();this.transform.writable.abort(),this.closed=!0}isClosed(){return this.closed}}class go{constructor(){Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:new mn(new _o)}),Object.defineProperty(this,"sourceReadable",{enumerable:!0,configurable:!0,writable:!0,value:this.transformStream.readable}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:this.transformStream.writable})}getReadableStream(){const[e,t]=this.sourceReadable.tee();return this.sourceReadable=e,t}}class bo{checkClosed(){if(this.closed)throw"Closed"}constructor(){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"subscribers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"writables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=this.subscribers;this.writable=new et({write(t){const n=e.map(({writer:r})=>new Promise(i=>{r.ready.then(()=>{r.write(t).then(i)})}));Promise.all(n)}})}getReadableStream(){this.checkClosed();const e=new mn({transform(t,n){n.enqueue(t)}});return this.subscribers.push({transform:e,writer:e.writable.getWriter()}),e.readable}async close(){this.checkClosed();for(const e of this.writables)await e.abort();for(const{transform:e}of this.subscribers)await e.writable.abort(),await e.readable.cancel();this.closed=!0}isClosed(){return this.closed}}class wo{checkClosed(){if(this.closed)throw"Closed"}constructor(e){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineStream",{enumerable:!0,configurable:!0,writable:!0,value:new mo}),Object.defineProperty(this,"cloneStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e?this.cloneStream=new bo:this.cloneStream=new go,this.combineStream.readable.pipeTo(this.cloneStream.writable)}getWritableStream(){return this.combineStream.getWritableStream()}getReadableStream(){return this.cloneStream.getReadableStream()}close(){this.checkClosed(),this.combineStream.close(),this.closed=!0}isClosed(){return this.closed}}class qu{constructor(){Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set})}onWrite(e){return this.callbacks.add(e),()=>{this.callbacks.delete(e)}}async write(e){for(const t of this.callbacks)await t(e)}close(){this.callbacks.clear()}}class Xt{constructor(){Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"lock",{enumerable:!0,configurable:!0,writable:!0,value:new Wu})}on(e){return this.callbacks.add(e),()=>{this.callbacks.delete(e)}}async send(e){for(const t of this.callbacks)await this.lock.run(()=>t(e))}}class _o{transform(e,t){t.enqueue(e)}}class Wu{constructor(){Object.defineProperty(this,"doneEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new $n}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:new et({async write(e){await e()}})}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:this.writable.getWriter()}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1})}checkClosed(){if(this.closed)throw"Closed"}async run(e){this.checkClosed(),await this.writer.ready;const t=this.writer.write(e);return this.doneEnroller.enrol(t),t}async close(){this.checkClosed(),this.doneEnroller.seal(),await this.doneEnroller.isDone(),this.writer.releaseLock(),await this.writable.abort(),this.closed=!0}isClosed(){return this.closed}}class yo{constructor(e,t){Object.defineProperty(this,"channel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.channel=e,this.channelKey=t}transform(e,t){if(this.channel==="*"||this.channel===e[this.channelKey]){t.enqueue(e);return}}}class Ao{constructor(e,t){Object.defineProperty(this,"multistream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.multistream=new wo(t),this.channelKey=e}getWritableStream(){return this.multistream.getWritableStream()}getReadableStream(e){const t=new mn(new yo(e,this.channelKey));return this.multistream.getReadableStream().pipeThrough(t)}}function Co(s,e){const t=X(),n=X(),r=()=>{if(n.state==="pending"){let i;s instanceof fn?i=s:i=new fn(s),n.resolve(i),i.binaryType="arraybuffer",i.readyState===i.OPEN&&t.resolve(),i.onopen=()=>{t.resolve()}}};return new et({async write(i,u){r();const l=await n;await t;try{const a=e(i);l.send(a)}catch(a){u.error(a)}l.onclose=()=>{u.error("Socket closed before we were done")}},async close(){r();const i=await n;await t,i.close()},async abort(){r();const i=await n;await t,i.close()}})}function Eo(s,e){const t=X();let n=!1;const r=()=>{if(t.state==="pending")if(s instanceof fn)t.resolve(s);else try{const i=new fn(s);t.resolve(i)}catch(i){t.reject(i)}};return new Gt({async start(i){r();const u=await t;u.binaryType="arraybuffer",u.onmessage=l=>{const a=e(l);try{i.enqueue(a)}catch{}},u.onclose=()=>{if(!n)try{i.close()}catch{}},u.onerror=l=>{n=!0,i.error(l)}},async cancel(){r(),(await t).close()}})}function ko(s){let t=s.toString(16);return t.length%2&&(t="0"+t),t}function vo(s){return BigInt("0x"+s)}const Fo={encode:{emptySet:s=>({type:"EMPTY_SET",canRespond:s}),lowerBound:s=>({type:"LOWER_BOUND",value:s}),payload:(s,e)=>({type:"PAYLOAD",payload:s,...e?{end:e}:{}}),emptyPayload:s=>({type:"EMPTY_PAYLOAD",upperBound:s}),done:s=>({type:"DONE",upperBound:s}),fingerprint:(s,e)=>({type:"FINGERPRINT",fingerprint:ko(s),upperBound:e}),terminal:()=>({type:"TERMINAL"})},decode:{emptySet:s=>{if(s.type==="EMPTY_SET")return s.canRespond;throw"Can't decode"},lowerBound:s=>{if(s.type==="LOWER_BOUND")return s.value;throw"Can't decode"},payload:s=>{if(s.type==="PAYLOAD")return{value:s.payload,...s.end?{end:s.end}:{}};throw"Can't decode"},emptyPayload:s=>{if(s.type==="EMPTY_PAYLOAD")return s.upperBound;throw"Can't decode"},done:s=>{if(s.type==="DONE")return s.upperBound;throw"Can't decode"},fingerprint:s=>{if(s.type==="FINGERPRINT")return{fingerprint:vo(s.fingerprint),upperBound:s.upperBound};throw"Can't decode"},terminal:s=>{if(s.type==="TERMINAL")return!0;throw"Can't decode"}}};class Bo extends Ul{constructor(e,t,n){super({tree:e,encoding:Fo,fingerprintEquals:(r,i)=>r===i,payloadThreshold:t,rangeDivision:n})}}class So{sendEvent(e){return this.inboundEventQueue.push(e)}events(){return this.outboundEventQueue}getStatus(){return{requestedCount:this.requestedCount,receivedCount:this.receivedDocsCount,sentCount:this.sentDocsCount,status:this.isDoneMultiDeferred.state==="rejected"?"aborted":this.hasPrepared.state==="pending"?"preparing":this.hasReconciled.state==="pending"?"reconciling":this.isDoneMultiDeferred.state==="fulfilled"?"done":"gossiping"}}constructor(e){Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new Xt}),Object.defineProperty(this,"isDoneMultiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new cr}),Object.defineProperty(this,"inboundEventQueue",{enumerable:!0,configurable:!0,writable:!0,value:new _t}),Object.defineProperty(this,"outboundEventQueue",{enumerable:!0,configurable:!0,writable:!0,value:new _t}),Object.defineProperty(this,"gossiperInboundQueue",{enumerable:!0,configurable:!0,writable:!0,value:new _t}),Object.defineProperty(this,"reconcilerInboundQueue",{enumerable:!0,configurable:!0,writable:!0,value:new _t}),Object.defineProperty(this,"hasPrepared",{enumerable:!0,configurable:!0,writable:!0,value:X()}),Object.defineProperty(this,"hasReconciled",{enumerable:!0,configurable:!0,writable:!0,value:X()}),Object.defineProperty(this,"hasCheckedAllExistingDocsForAttachments",{enumerable:!0,configurable:!0,writable:!0,value:X()}),Object.defineProperty(this,"requestedCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sentDocsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"receivedDocsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"counterpartId",{enumerable:!0,configurable:!0,writable:!0,value:At()}),Object.defineProperty(this,"replica",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.replica=e.replica,e.replica.onEvent(u=>{u.kind==="willClose"&&this.cancel()});const{treeIsReady:t}=e.syncerManager.getDocThumbnailTreeAndDocLookup(e.replica.share,hn(e.formats));t.then(()=>{this.hasPrepared.resolve()}),(async()=>{for await(const u of this.inboundEventQueue)switch(u.kind){case"RANGE_MSG":{this.reconcilerInboundQueue.push(u.message);break}default:this.gossiperInboundQueue.push(u)}})(),new Po({outboundEventQueue:this.outboundEventQueue,formats:e.formats,replica:e.replica,counterpartId:this.counterpartId,transferManager:e.transferManager,hasCheckedAllExistingDocsForAttachments:this.hasCheckedAllExistingDocsForAttachments});const n=new xo,r=new Io({inboundEventQueue:this.reconcilerInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:e.syncerManager,formats:e.formats,replica:e.replica,initiateMessaging:e.initiateMessaging,wantTracker:n,payloadThreshold:e.payloadThreshold,rangeDivision:e.rangeDivision,onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}});r.isDone.then(()=>{this.hasReconciled.resolve()}),new To({inboundEventQueue:this.gossiperInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:e.syncerManager,formats:e.formats,replica:e.replica,counterpartId:this.counterpartId,transferManager:e.transferManager,cancel:this.cancel.bind(this),reconciliationIsDone:r.isDone,wantTracker:n,syncAppetite:e.syncAppetite,onDocReceived:async()=>{this.receivedDocsCount++,await this.statusBus.send(this.getStatus())},onDocSent:async()=>{this.sentDocsCount++,await this.statusBus.send(this.getStatus())},onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}}).isDone.then(async()=>{await this.hasCheckedAllExistingDocsForAttachments,this.isDoneMultiDeferred.resolve()}),this.statusBus.send(this.getStatus())}onStatusUpdate(e){return this.statusBus.on(e)}async cancel(e){this.isDoneMultiDeferred.state==="fulfilled"||this.isDoneMultiDeferred.state==="rejected"||(this.isDoneMultiDeferred.reject(),await this.statusBus.send(this.getStatus()),this.outboundEventQueue.push({kind:"ABORT"}),this.outboundEventQueue.close(),this.inboundEventQueue.close({immediately:!0}),this.gossiperInboundQueue.close({immediately:!0}),this.reconcilerInboundQueue.close({immediately:!0}))}isDone(){return this.isDoneMultiDeferred.getPromise()}}class To{constructor(e){Object.defineProperty(this,"isPartnerFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:X()}),Object.defineProperty(this,"isFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:X()});const t=dn(e.formats),n=e.syncerManager.getPlumTree(e.replica.share);if(e.syncAppetite==="continuous"){const u=e.replica.getQueryStream(void 0,"new",e.formats),l=new Lr;u.pipeTo(new et({async write(a){if(a.kind==="success"&&a.sourceId!==e.counterpartId){const o=n.getMode(a.sourceId);l.reset(),l.update(`${a.doc.path} ${a.doc.author}`);const c=l.digest().toString(16),f=`${a.doc.timestamp} ${c}`;if(o==="EAGER"){const h=t[a.doc.format],d=h.getAttachmentInfo(a.doc),D=!R(d);let g=!1;D&&await e.replica.getAttachment(a.doc,h)&&(g=!0),e.outboundEventQueue.push({kind:"DOC",thumbnail:f,doc:a.doc,attachmentHeld:g}),e.onDocSent()}else e.outboundEventQueue.push({kind:"HAVE",thumbnail:f})}}})).catch(()=>{})}const r=e.replica.onEvent(u=>{u.kind==="attachment_ingest"&&u.sourceId!==e.counterpartId&&e.outboundEventQueue.push({kind:"NEW_ATTACHMENT",path:u.doc.path,author:u.doc.author,format:u.doc.format,hash:u.hash})}),{lookup:i}=e.syncerManager.getDocThumbnailTreeAndDocLookup(e.replica.share,hn(e.formats));(async()=>{for await(const u of e.inboundEventQueue)switch(u.kind){case"PRUNE":{n.onPrune(e.counterpartId);break}case"HAVE":{if(e.reconciliationIsDone.state==="fulfilled"&&e.syncAppetite==="once")break;e.wantTracker.addWantedThumbnail(u.thumbnail),n.onLazyMessage(u,l=>{e.outboundEventQueue.push({kind:"WANT",thumbnail:l})}),e.onDocRequested();break}case"WANT":{n.onGraftMessage(e.counterpartId);const[,l]=u.thumbnail.split(" "),a=i[l];if(!a)return;const[,o,c]=a,h=(await e.replica.getAllDocsAtPath(o,e.formats)).find(d=>d.author===c);if(h){const d=t[h.format],D=d.getAttachmentInfo(h),g=!R(D);let y=!1;g&&await e.replica.getAttachment(h,d)&&(y=!0),e.outboundEventQueue.push({kind:"DOC",thumbnail:u.thumbnail,doc:h,attachmentHeld:y}),await e.onDocSent()}else console.error("Got a WANT event for a document not on record.");break}case"DOC":{if(this.isFulfilled.state==="fulfilled"&&e.syncAppetite==="once"||(n.onEagerMessage(e.counterpartId,u)&&e.outboundEventQueue.push({kind:"PRUNE"}),e.wantTracker.isReceived(u.thumbnail)))break;const a=t[u.doc.format];if(!a){console.error(`Was sent a doc with a format we don't know about (${u.doc.format})`);break}if(u.attachmentHeld&&await e.replica.getAttachment(u.doc,t[u.doc.format])===void 0){const c=await e.transferManager.handleDownload(u.doc,e.replica,e.counterpartId);if(R(c)){const f=a.getAttachmentInfo(u.doc);e.transferManager.registerExpectedTransfer(e.replica.share,f.hash),e.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:f.hash,doc:u.doc,shareAddress:e.replica.share})}}await e.replica.ingest(a,u.doc,e.counterpartId),e.wantTracker.receivedWantedThumbnail(u.thumbnail),await e.onDocReceived();break}case"NEW_ATTACHMENT":{if(e.transferManager.isAlreadyQueued(u.hash,"download"))break;const l=t[u.format],o=(await e.replica.getAllDocsAtPath(u.path,[l])).find(f=>u.author===f.author);if(!o)break;if(await e.replica.getAttachment(o,t[o.format])===void 0){const f=await e.transferManager.handleDownload(o,e.replica,e.counterpartId);if(R(f)){const h=l.getAttachmentInfo(o);e.transferManager.registerExpectedTransfer(e.replica.share,h.hash),e.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:h.hash,doc:o,shareAddress:e.replica.share})}}break}case"FULFILLED":this.isPartnerFulfilled.resolve(!0);break;case"WANT_ATTACHMENT":e.transferManager.handleUpload(u,e.replica);break;case"ABORT":await e.cancel()}})(),e.reconciliationIsDone.then(async()=>{e.syncAppetite==="once"&&(r(),e.wantTracker.seal(),await e.wantTracker.isDone(),e.outboundEventQueue.push({kind:"FULFILLED"}),this.isFulfilled.resolve())})}get isDone(){return Promise.all([this.isPartnerFulfilled,this.isFulfilled])}}class Io{constructor(e){Object.defineProperty(this,"communicationRoundsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isDone",{enumerable:!0,configurable:!0,writable:!0,value:X()});const{tree:t,lookup:n,treeIsReady:r}=e.syncerManager.getDocThumbnailTreeAndDocLookup(e.replica.share,hn(e.formats));e.initiateMessaging&&r.then(()=>{for(const u of i.initialMessages(l=>{const a=Date.now()-6048e5,o=l.findIndex(f=>{const[h]=f.split(" ");return parseInt(h)/1e3>a});if(o>0&&o>l.length/2)return[l.slice(0,o),l.slice(o)];const c=Math.round(l.length/2);return[l.slice(0,c),l.slice(c)]}))e.outboundEventQueue.push({kind:"RANGE_MSG",message:u})});const i=new Bo(t,e.payloadThreshold,e.rangeDivision);i.onInsertion(u=>{const[l,a]=u.split(" "),o=n[a];o&&o[0]>=parseInt(l)||(e.wantTracker.addWantedThumbnail(u),e.outboundEventQueue.push({kind:"WANT",thumbnail:u}),e.onDocRequested())}),(async()=>{await r;for await(const u of e.inboundEventQueue){if(this.isDone.state==="fulfilled")return;u.type==="TERMINAL"&&this.communicationRoundsCount++;const l=i.respond(u);for(const a of l)e.outboundEventQueue.push({kind:"RANGE_MSG",message:a})}})(),i.isDone().then(()=>{this.isDone.resolve(this.communicationRoundsCount)})}}class Po{constructor(e){const t=e.replica.getQueryStream({orderBy:"localIndex ASC"},"existing",e.formats),n=dn(e.formats),r=e.transferManager.handleDownload.bind(e.transferManager);t.pipeTo(new et({start(i){e.replica.onEvent(u=>{u.kind==="willClose"&&i.error()})},async write(i){if(i.kind==="existing"||i.kind==="success"){const u=n[i.doc.format],l=await e.replica.getAttachment(i.doc,u);if(R(l))return;if(l===void 0){const a=await r(i.doc,e.replica,e.counterpartId);if(R(a)){const o=u.getAttachmentInfo(i.doc);e.transferManager.registerExpectedTransfer(e.replica.share,o.hash),e.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:o.hash,doc:i.doc,shareAddress:e.replica.share})}}}}})).then(()=>{e.hasCheckedAllExistingDocsForAttachments.resolve()}).catch(()=>{e.hasCheckedAllExistingDocsForAttachments.resolve()})}}class xo{constructor(){Object.defineProperty(this,"isSealed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"wantedThumbnails",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"enroller",{enumerable:!0,configurable:!0,writable:!0,value:new $n}),Object.defineProperty(this,"received",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:At()})}addWantedThumbnail(e){if(!this.isSealed&&!this.wantedThumbnails.has(e)){const t=X();this.wantedThumbnails.set(e,t),this.enroller.enrol(t)}}receivedWantedThumbnail(e){const t=this.wantedThumbnails.get(e);t&&(t.resolve(),this.received++)}isRequested(e){return this.wantedThumbnails.has(e)}isReceived(e){const t=this.wantedThumbnails.get(e);return t?t.state==="fulfilled":!1}seal(){this.enroller.seal()}isDone(){return this.enroller.isDone()}get requestedCount(){return this.wantedThumbnails.size}get receivedCount(){return this.received}}class Qu{constructor(e,t){Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.cb=e,this.ms=t,this.timeout=Vt(e,t)}bump(){this.closed||(clearTimeout(this.timeout),this.timeout=Vt(this.cb,this.ms))}close(){this.closed=!0,clearTimeout(this.timeout)}}const Ku=1e4;class kr{constructor({stream:e,replica:t,doc:n,format:r,requester:i,counterpartId:u}){Object.defineProperty(this,"kind",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:"ready"}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"expectedSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sourceDoc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new Xt}),Object.defineProperty(this,"transferOp",{enumerable:!0,configurable:!0,writable:!0,value:X()}),Object.defineProperty(this,"abortCb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new cr}),Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"requester",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.sourceDoc=n,this.share=t.share,this.requester=i;const l=r.getAttachmentInfo(n);if(R(l))throw new O("AttachmentTransfer was given a doc which has no attachment!");this.hash=l.hash,this.expectedSize=l.size;const a=this.updateLoaded.bind(this);if(e instanceof Gt){this.kind="download";let o;this.abortCb=()=>{o?o.cancel():e.cancel()};let c=null;const f=new Gt({async start(h){const d=e.getReader();for(o=d,c=new Qu(()=>{h.error("Attachment download timed out.")},Ku);;){const{done:D,value:g}=await d.read();if(c.bump(),D)break;a(g.byteLength),h.enqueue(g)}c.close(),h.close()}});this.transferOp.resolve(()=>{const h=X();return t.ingestAttachment(r,n,f,u).then(d=>{if(R(d)&&this.loaded===0){this.changeStatus("missing_attachment");return}if(R(d)){console.warn(`Couldn't ingest the attachment for ${n.path} by ${n.author}: ${d.message}`),h.reject(d);return}h.resolve()}).catch(d=>{h.reject(d)}),h})}else this.kind="upload",this.abortCb=()=>{e.abort().catch(()=>{})},t.getAttachment(n,r).then(async o=>{if(!o){await this.changeStatus("missing_attachment"),await e.abort();return}if(R(o)){await this.changeStatus("failed"),await e.abort();return}const c=new mn({transform(f,h){a(f.byteLength),h.enqueue(f)}});this.transferOp.resolve(()=>o.stream().then(f=>f.pipeThrough(c).pipeTo(e)))})}async start(){if(this.status!=="ready")return;const e=await this.transferOp;await this.changeStatus("in_progress"),e().then(async()=>{await this.changeStatus("complete")}).catch(async()=>{await this.changeStatus("failed")})}updateLoaded(e){this.loaded+=e,this.statusBus.send({status:this.status,bytesLoaded:this.loaded,totalBytes:this.expectedSize})}async changeStatus(e){this.status==="complete"||this.status==="failed"||this.status==="missing_attachment"||(this.status=e,await this.statusBus.send({status:e,bytesLoaded:this.loaded,totalBytes:this.expectedSize}),e==="complete"&&this.multiDeferred.resolve(),e==="failed"&&this.multiDeferred.reject("Attachment transfer failed"),e==="missing_attachment"&&this.multiDeferred.reject("The other peer does not have this attachment"))}get doc(){return this.sourceDoc}onProgress(e){return this.statusBus.on(e)}abort(){this.abortCb()}isDone(){return this.multiDeferred.getPromise()}}class Ro{constructor(e){Object.defineProperty(this,"waiting",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"active",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"failed",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"completed",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"activeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transfersRequestedByUsEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new $n(!0)}),Object.defineProperty(this,"reports",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"reportBus",{enumerable:!0,configurable:!0,writable:!0,value:new Xt}),this.activeLimit=e}async activate(e){this.active.add(e),e.isDone().then(()=>{this.completed.add(e)}).catch(()=>{this.failed.add(e)}).finally(()=>{this.active.delete(e),this.admitNext()}),await e.start()}queue(e){this.waiting.push(e)}admitNext(){if(this.waiting.length===0||this.active.size>=this.activeLimit)return;const e=this.waiting.shift();e&&this.activate(e)}async addTransfer(e){e.onProgress(()=>{this.updateTransferStatus(e)}),e.requester==="us"&&this.transfersRequestedByUsEnroller.enrol(e.isDone()),this.active.size<this.activeLimit?await this.activate(e):this.queue(e)}gotAllTransfersRequestedByUs(){this.transfersRequestedByUsEnroller.seal()}cancel(){this.transfersRequestedByUsEnroller.seal();for(const e of this.active)e.abort()}updateTransferStatus(e){this.reports[e.share]||(this.reports[e.share]={}),this.reports[e.share][e.hash+e.kind]={author:e.doc.author,path:e.doc.path,format:e.doc.format,hash:e.hash,kind:e.kind,status:e.status,bytesLoaded:e.loaded,totalBytes:e.expectedSize},this.reportBus.send(this.getReport())}getReport(){const e={};for(const t in this.reports){const n=[],r=this.reports[t];for(const i in r){const u=r[i];n.push(u)}e[t]=n}return e}hasQueuedTransfer(e,t){for(const n of this.waiting)if(n.hash===e&&n.kind===t)return!0;for(const n of this.active)if(n.hash===e&&n.kind===t)return!0;for(const n of this.completed)if(n.hash===e&&n.kind===t)return!0;return!1}onReportUpdate(e){return this.reportBus.on(e)}transfersRequestedByUsFinished(){return this.transfersRequestedByUsEnroller.isDone()}}class Oo{constructor(e){Object.defineProperty(this,"partner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"otherSyncerId",{enumerable:!0,configurable:!0,writable:!0,value:X()}),Object.defineProperty(this,"receivedAllExpectedTransfersEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new $n}),Object.defineProperty(this,"madeAllAttachmentRequestsEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new $n(!0)}),Object.defineProperty(this,"formatsLookup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reportDidUpdateBus",{enumerable:!0,configurable:!0,writable:!0,value:new Xt}),Object.defineProperty(this,"expectedTransferPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.partner=e.partner,this.queue=new Ro(this.partner.concurrentTransfers),this.formats=e.formats,this.formatsLookup=dn(this.formats),this.queue.onReportUpdate(async t=>{await this.reportDidUpdateBus.send(t)}),this.madeAllAttachmentRequestsEnroller.isDone().then(()=>{this.receivedAllExpectedTransfersEnroller.seal()}),this.receivedAllExpectedTransfersEnroller.isDone().then(()=>{this.queue.gotAllTransfersRequestedByUs()})}registerSyncAgent(e){this.madeAllAttachmentRequestsEnroller.enrol(e.isDone())}allSyncAgentsKnown(){this.madeAllAttachmentRequestsEnroller.seal()}registerExpectedTransfer(e,t){const n=`${e}_${t}`;if(this.expectedTransferPromises.has(n))return;const r=X();this.expectedTransferPromises.set(n,r),this.receivedAllExpectedTransfersEnroller.enrol(r)}async queueTransfer(e){this.queue.hasQueuedTransfer(e.hash,e.kind)||await this.queue.addTransfer(e)}async handleDownload(e,t,n){const r=this.formatsLookup[e.format],i=r.getAttachmentInfo(e);if(R(i))throw new Qe("TransferManager: attempted to download doc with no attachment.");const u=await this.partner.getDownload({doc:e,shareAddress:t.share,syncerId:await this.otherSyncerId,attachmentHash:i.hash});if(u===void 0)return"no_attachment";if(R(u))return u;const l=new kr({replica:t,doc:e,format:r,stream:u,requester:"us",counterpartId:n});return await this.queueTransfer(l),"queued"}async handleUpload(e,t){const n=this.formatsLookup[e.doc.format];if(!await t.getAttachment(e.doc,n))return!1;const i=await this.partner.handleUploadRequest({shareAddress:e.shareAddress,syncerId:await this.otherSyncerId,doc:e.doc,attachmentHash:e.attachmentHash});if(R(i))return!1;try{const u=new kr({doc:e.doc,format:n,replica:t,stream:i,requester:"them",counterpartId:"unused"});await this.queueTransfer(u)}catch{return!1}return!0}async handleTransferRequest({replica:e,path:t,author:n,source:r,kind:i,formatName:u,counterpartId:l}){const a=await this.partner.handleTransferRequest(r,i);if(a===void 0||R(a))return;const o=dn(this.formats)[u];if(!o)return;const f=(await e.getAllDocsAtPath(t,[o])).find(d=>d.author===n);if(!f)return;const h=new kr({doc:f,format:o,replica:e,stream:a,requester:i==="upload"?"us":"them",counterpartId:l});if(h.requester==="us"){const d=`${h.share}_${h.hash}`,D=this.expectedTransferPromises.get(d);D&&D.resolve()}await this.queueTransfer(h)}cancel(){this.queue.cancel()}getReport(){return this.queue.getReport()}onReportUpdate(e){return this.reportDidUpdateBus.on(e)}transfersRequestedByUsFinished(){return this.queue.transfersRequestedByUsFinished()}registerOtherSyncerId(e){this.otherSyncerId.resolve(e)}isAlreadyQueued(e,t){return this.queue.hasQueuedTransfer(e,t)}}class Vu{constructor(e){Object.defineProperty(this,"peer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:At()}),Object.defineProperty(this,"manager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"syncAgents",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"syncAgentQueues",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"appetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new Xt}),Object.defineProperty(this,"formats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transferManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partnerIsFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:X()}),Object.defineProperty(this,"isDoneMultiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new cr}),Object.defineProperty(this,"heartbeatInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bumpingTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.manager=e.manager,this.peer=e.manager.peer,this.appetite=e.partner.syncAppetite,this.formats=hn(e.formats),this.partner=e.partner,this.transferManager=new Oo({partner:this.partner,formats:this.formats}),this.transferManager.onReportUpdate(async()=>{await this.statusBus.send(this.getStatus())}),this.heartbeatInterval=sr(()=>{this.partner.sendEvent({kind:"HEARTBEAT"})},1e3),(async()=>{try{for await(const n of e.partner.getEvents())this.handleIncomingEvent(n)}catch(n){this.cancel(n||"Partner disconnected")}})();const t=At();Promise.all(this.peer.shares().map(n=>Qn(t,n))).then(n=>{this.partner.sendEvent({kind:"DISCLOSE",salt:t,syncerId:this.id,shares:n,formats:this.formats?this.formats.map(r=>r.id):[lt.id],canRespond:!1})}),this.transferManager.transfersRequestedByUsFinished().then(async()=>{e.partner.syncAppetite!=="continuous"&&(await this.partner.sendEvent({kind:"SYNCER_FULFILLED"}),await this.partnerIsFulfilled,clearInterval(this.heartbeatInterval),await this.partner.closeConnection(),this.bumpingTimeout.close(),this.isDoneMultiDeferred.resolve())}),this.peer.onReplicasChange(async n=>{if(this.appetite==="once")return;const r=Array.from(n.keys());for(const[u,l]of this.syncAgents)r.includes(u)===!1&&(await l.cancel("Replica was removed from peer."),this.syncAgents.delete(u));const i=At();Promise.all(r.map(u=>Qn(i,u))).then(u=>{this.partner.sendEvent({kind:"DISCLOSE",salt:i,syncerId:this.id,shares:u,formats:this.formats?this.formats.map(l=>l.id):[lt.id],canRespond:!0})})}),this.bumpingTimeout=new Qu(()=>{this.cancel("No communication from the other peer in the last three seconds.")},Ku)}addShare(e,t,n){if(this.syncAgents.has(e))return;const r=this.peer.getReplica(e);if(!r){console.error("Couldn't get the replica for a share we had in common.");return}const i=new So({replica:r,formats:t,syncerManager:this.manager,transferManager:this.transferManager,initiateMessaging:n,payloadThreshold:this.partner.payloadThreshold,rangeDivision:this.partner.rangeDivision,syncAppetite:this.appetite});i.onStatusUpdate(()=>{this.statusBus.send(this.getStatus())}),this.syncAgents.set(e,i),this.transferManager.registerSyncAgent(i);const u=this.syncAgentQueues.get(e);let l;if(u)l=u;else{const a=new _t;l=a,this.syncAgentQueues.set(e,a)}(async()=>{for await(const a of l)i.sendEvent(a)})(),(async()=>{for await(const a of i.events())this.partner.sendEvent({to:e,...a})})()}async handleIncomingEvent(e){switch(this.bumpingTimeout.bump(),e.kind){case"DISCLOSE":{const t=Do(e.formats,this.formats);if(t.length===0)break;const n=new Set(e.shares),r=new Set,i=new Set;for(const l of this.peer.shares()){const a=await Qn(e.salt,l);n.has(a)?r.add(l):i.add(l)}const u=this.id>e.syncerId;for(const l of r)this.addShare(l,t,u);for(const l of i){const a=this.syncAgents.get(l);a&&(a.cancel("No longer in common with the other peer."),this.syncAgents.delete(l))}if(this.transferManager.registerOtherSyncerId(e.syncerId),this.appetite==="once"&&this.transferManager.allSyncAgentsKnown(),e.canRespond){const l=At();Promise.all(this.peer.shares().map(a=>Qn(l,a))).then(a=>{this.partner.sendEvent({kind:"DISCLOSE",salt:l,syncerId:this.id,shares:a,formats:this.formats?this.formats.map(o=>o.id):[lt.id],canRespond:!1})})}r.size===0&&this.appetite==="once"&&this.partner.sendEvent({kind:"SYNCER_FULFILLED"});break}case"SYNCER_FULFILLED":{this.partnerIsFulfilled.resolve();break}case"HEARTBEAT":break;default:{const{to:t}=e,n=this.syncAgentQueues.get(t);if(!n){const r=new _t;r.push(e),this.syncAgentQueues.set(t,r);break}n.push(e)}}}getStatus(){const e={};for(const[t,n]of this.syncAgents)e[t]={docs:n.getStatus(),attachments:this.transferManager.getReport()[t]||[]};return e}onStatusChange(e){return this.statusBus.on(e)}async cancel(e){this.bumpingTimeout.close(),this.isDoneMultiDeferred.reject(e);for(const[t,n]of this.syncAgents)await n.cancel();clearInterval(this.heartbeatInterval),this.transferManager.cancel(),await this.partner.closeConnection()}handleTransferRequest({shareAddress:e,path:t,author:n,source:r,kind:i,formatName:u}){if(this.isDoneMultiDeferred.state==="rejected")return;const l=this.peer.getReplica(e);if(!l)return;let a="unused";if(i==="upload"){const o=this.syncAgents.get(e);o&&(a=o.counterpartId)}return this.transferManager.handleTransferRequest({replica:l,author:n,formatName:u,kind:i,path:t,source:r,counterpartId:a})}isDone(){return this.isDoneMultiDeferred.getPromise()}}function Qn(s,e){return Ae.sha256base32(s+e+s)}class $o{constructor(e,t,n,r){Object.defineProperty(this,"concurrentTransfers",{enumerable:!0,configurable:!0,writable:!0,value:1024}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"syncAppetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outgoingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new _t}),Object.defineProperty(this,"incomingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new _t}),Object.defineProperty(this,"partnerPeer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partnerSyncer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.syncAppetite=n,this.partnerPeer=e;const{incomingQueue:i,outgoingQueue:u}=this;this.partnerSyncer=new Vu({manager:e.syncerManager,formats:r,partner:{syncAppetite:n,getEvents(){return i},sendEvent(l){return u.push(l),Promise.resolve()},concurrentTransfers:1024,payloadThreshold:32,rangeDivision:32,async getDownload(l){const a=t.getReplica(l.shareAddress);if(!a)throw new O("Tried to get a receiving transfer for an unknown share.");const o=await a.replicaDriver.attachmentDriver.getAttachment(l.doc.format,l.attachmentHash);if(o&&!R(o))return await o.stream()},closeConnection(){return u.close(),Promise.resolve()},handleUploadRequest(l){return Promise.resolve(new Tn("PartnerLocal does not support uploads."))},handleTransferRequest(l,a){return Promise.resolve(new Tn("PartnerLocal does not support transfer requests."))}}})}getEvents(){return this.outgoingQueue}sendEvent(e){return this.incomingQueue.push(e),Promise.resolve()}closeConnection(){return this.incomingQueue.close(),Promise.resolve()}async getDownload(e){const t=this.partnerPeer.getReplica(e.shareAddress);if(!t)throw new O("Tried to get a receiving transfer for an unknown share.");const n=await t.replicaDriver.attachmentDriver.getAttachment(e.doc.format,e.attachmentHash);if(n&&!R(n))return await n.stream()}handleUploadRequest(e){return Promise.resolve(new Tn("PartnerLocal does not support uploads."))}handleTransferRequest(e,t){return Promise.resolve(new Tn("PartnerLocal does not support transfer requests."))}}class Mo{constructor(e){Object.defineProperty(this,"syncAppetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"concurrentTransfers",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"isSecure",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wsUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"socket",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"incomingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new _t}),Object.defineProperty(this,"socketIsReady",{enumerable:!0,configurable:!0,writable:!0,value:X()}),this.syncAppetite=e.appetite;const t=new URL(e.url),n=`${t.host}${t.pathname==="/"?"":t.pathname}`;this.isSecure=t.protocol==="https:"||t.protocol==="wss:",this.wsUrl=`${this.isSecure?"wss://":"ws://"}${n}/'`;const r=new URL(e.appetite,this.wsUrl);this.socket=new fn(r.toString()),this.socket.onopen=()=>{this.socketIsReady.resolve()},this.socket.binaryType="arraybuffer",this.socket.onmessage=i=>{this.incomingQueue.push(JSON.parse(i.data))},this.socket.onclose=()=>{this.incomingQueue.close()},this.socket.onerror=i=>{if("error"in i){this.incomingQueue.close({withError:i.error});return}this.incomingQueue.close({withError:new Qe("Websocket error.")})}}async sendEvent(e){if(await this.socketIsReady,!(this.socket.readyState===this.socket.CLOSED||this.socket.readyState===this.socket.CLOSING))return this.socket.send(JSON.stringify(e))}getEvents(){return this.incomingQueue}closeConnection(){return this.socket.close(),Promise.resolve()}getDownload(e){const t=new URL(`${e.syncerId}/download/${e.shareAddress}/${e.doc.format}/${e.doc.author}${e.doc.path}`,this.wsUrl),n=Eo(t.toString(),r=>r.data instanceof ArrayBuffer?new Uint8Array(r.data):null);return Promise.resolve(n)}handleUploadRequest(e){const t=new URL(`${e.syncerId}/upload/${e.shareAddress}/${e.doc.format}/${e.doc.author}${e.doc.path}`,this.wsUrl),n=Co(t.toString(),r=>r);return Promise.resolve(n)}handleTransferRequest(e,t){return Promise.resolve(new Tn("SyncDriverWebClient does not support external transfer requests."))}}function jo(s,e){const[t,n]=s.split(" "),[r,i]=e.split(" "),u=parseInt(t),l=parseInt(r);return u>l?1:u<l?-1:n>i?1:n<i?-1:0}const No={lift:s=>$l(s),combine:(s,e)=>s+e,neutral:BigInt(0)};class Lo extends jl{constructor(){super(No,jo)}}class Uo{constructor(){Object.defineProperty(this,"messagingModes",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"eagerMessageThumbnails",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"haveTimeouts",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}getMode(e){const t=this.messagingModes.get(e);if(t)return t;const n=this.messagingModes.size===0?"EAGER":"LAZY";return this.messagingModes.set(e,n),"EAGER"}onEagerMessage(e,t){const n=this.haveTimeouts.get(t.thumbnail);return n?(clearTimeout(n),!1):this.eagerMessageThumbnails.has(t.thumbnail)?(this.messagingModes.set(e,"LAZY"),!0):(this.eagerMessageThumbnails.add(t.thumbnail),!1)}onLazyMessage(e,t){if(!this.haveTimeouts.has(e.thumbnail)){const n=Vt(()=>{t(e.thumbnail)},5);this.haveTimeouts.set(e.thumbnail,n)}}onGraftMessage(e){this.messagingModes.set(e,"EAGER")}onPrune(e){this.messagingModes.set(e,"LAZY")}}class zo{constructor(e){Object.defineProperty(this,"syncers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"syncerEventBus",{enumerable:!0,configurable:!0,writable:!0,value:new Xt}),Object.defineProperty(this,"peer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docThumbnailTreeAndLookup",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"hasher",{enumerable:!0,configurable:!0,writable:!0,value:new Lr}),Object.defineProperty(this,"plumTrees",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.peer=e}addPartner(e,t,n){const r=new Vu({manager:this,partner:e,formats:n});return this.syncers.set(r.id,{syncer:r,description:t}),this.syncerEventBus.send(this.syncers),r}getSyncers(){return this.syncers}getDocThumbnailTreeAndDocLookup(e,t){const n=t.map(h=>h.id),r=`${e} ${n}`,i=this.docThumbnailTreeAndLookup.get(r);if(i){const[h,d]=i;return{tree:h,lookup:d,treeIsReady:Promise.resolve(!0)}}const u=this.peer.getReplica(e);if(!u)throw new Qe("A DocThumbnailTree was requested for a share the peer doesn't know about, big problem!");const l=this.hasher,a=u.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"everything",t),o=new Lo,c={},f=X();return a.pipeTo(new et({write(h){if(h.kind==="processed_all_existing"){f.resolve();return}l.reset(),l.update(`${h.doc.path} ${h.doc.author}`);const d=l.digest().toString(16),D=`${h.doc.timestamp} ${d}`;(h.kind==="existing"||h.kind==="success")&&(c[d]=[h.doc.timestamp,h.doc.path,h.doc.author],o.insert(D)),h.kind==="expire"&&(delete c[d],o.remove(D))}})),{tree:o,lookup:c,treeIsReady:f}}getPlumTree(e){const t=this.plumTrees.get(e);if(t)return t;const n=new Uo;return this.plumTrees.set(e,n),n}onSyncersChange(e){return this.syncerEventBus.on(e)}}const Ut=new Ue("peer","orangeRed"),vn=JSON.stringify;class fr{constructor(){Object.defineProperty(this,"replicaEventBus",{enumerable:!0,configurable:!0,writable:!0,value:new Xt}),Object.defineProperty(this,"syncerManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicaMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Ut.debug("constructor"),this.syncerManager=new zo(this)}hasShare(e){return this.replicaMap.has(e)}shares(){const e=[...this.replicaMap.keys()];return e.sort(),e}replicas(){const e=[...this.replicaMap.keys()];return e.sort(),e.map(t=>this.replicaMap.get(t))}size(){return this.replicaMap.size}getReplica(e){return this.replicaMap.get(e)}async addReplica(e){if(Ut.debug(`addReplica(${vn(e.share)})`),this.replicaMap.has(e.share))throw Ut.debug("already had a replica with that share"),new Error(`Peer.addReplica: already has a replica with share ${vn(e.share)}.  Don't add another one.`);this.replicaMap.set(e.share,e),await this.replicaEventBus.send(this.replicaMap),Ut.debug("    ...addReplica: done")}async removeReplicaByShare(e){Ut.debug(`removeReplicaByShare(${vn(e)})`),this.replicaMap.delete(e),await this.replicaEventBus.send(this.replicaMap)}async removeReplica(e){const t=this.replicaMap.get(e.share);e===t?(Ut.debug(`removeReplica(${vn(e.share)})`),await this.removeReplicaByShare(e.share)):Ut.debug(`removeReplica(${vn(e.share)}) -- same share but it's a different instance now; ignoring`)}sync(e,t=!1,n){try{const r=new Mo({url:e,appetite:t?"continuous":"once"});return this.syncerManager.addPartner(r,e,n)}catch{if(e instanceof fr){const r=new $o(e,this,t?"continuous":"once",n);return this.syncerManager.addPartner(r,"Local",n)}console.error("Provided an invalid target for syncing to a peer:",e);return}}addSyncPartner(e,t,n){return this.syncerManager.addPartner(e,t,n)}getSyncers(){return this.syncerManager.getSyncers()}onReplicasChange(e){return this.replicaEventBus.on(e)}onSyncersChange(e){return this.syncerManager.onSyncersChange(e)}}const Ho={historyMode:"latest",orderBy:"path ASC",startAfter:void 0,limit:void 0,filter:void 0,formats:["es.5"]},zt=new Ue("query","green");function Gu(s){var r,i,u,l;const e={...Ho,...s},t={query:{limit:0},isValid:!1,willMatch:"nothing"};if(e.limit!==void 0&&e.limit<0)return zt.debug("cleanUpQuery: unreasonable limit - returning empty invalid query",t),t;if((r=e.orderBy)!=null&&r.startsWith("path")&&((i=e.startAfter)==null?void 0:i.localIndex)!==void 0)return zt.debug('cleanUpQuery: orderBy is "path" but startAfter is not compatible - returning empty invalid query',t),t;if((u=e.orderBy)!=null&&u.startsWith("localIndex")&&((l=e.startAfter)==null?void 0:l.path)!==void 0)return zt.debug('cleanUpQuery: orderBy is "localIndex" but startAfter is not compatible - returning empty invalid query',t),t;if(e.historyMode!==void 0&&e.historyMode!=="all"&&e.historyMode!=="latest")return zt.debug(`cleanUpQuery: unknown historyMode ${JSON.stringify(e.historyMode)} - returning empty invalid query`,t),t;if(e.orderBy!==void 0&&["path ASC","path DESC","localIndex ASC","localIndex DESC"].indexOf(e.orderBy)===-1)return zt.debug(`cleanUpQuery: unrecognized orderBy value ${JSON.stringify(e.orderBy)} - returning empty invalid query`,t),t;let n=e.historyMode==="all"?"all":"all-latest";if(e.filter!==void 0&&!Xn(e.filter,{})&&(n="some"),e.startAfter!==void 0&&!Xn(e.startAfter,{})&&(n="some"),e.limit!==void 0&&(e.limit>0&&(n="some"),e.limit===0&&(n="nothing")),e.filter!==void 0){const a=e.filter;a.path&&a.pathStartsWith&&!a.path.startsWith(a.pathStartsWith)&&(n="nothing"),a.path&&a.pathEndsWith&&!a.path.endsWith(a.pathEndsWith)&&(n="nothing"),a.timestamp&&a.timestampGt&&!(a.timestamp>a.timestampGt)&&(n="nothing"),a.timestamp&&a.timestampLt&&!(a.timestamp<a.timestampLt)&&(n="nothing"),a.timestampGt&&a.timestampLt&&!(a.timestampLt+1<a.timestampGt)&&(n="nothing")}if(n==="nothing"){let a={query:{limit:0},isValid:!0,willMatch:"nothing"};return zt.debug("cleanUpQuery - this query will match nothing, so returning a simpler query that also matches nothing",a),a}return zt.debug(`cleanUpQuery - query is ok!  willMatch = ${n}`),{query:e,isValid:!0,willMatch:n}}function zr(s,e){return!(e.path!==void 0&&s.path!==e.path||e.pathStartsWith!==void 0&&!s.path.startsWith(e.pathStartsWith)||e.pathEndsWith!==void 0&&!s.path.endsWith(e.pathEndsWith)||e.author!==void 0&&s.author!==e.author||e.timestamp!==void 0&&s.timestamp!==e.timestamp||e.timestampGt!==void 0&&!(s.timestamp>e.timestampGt)||e.timestampLt!==void 0&&!(s.timestamp<e.timestampLt))}new Ue("query helpers","gold");var Je;(function(s){s[s.LT=-1]="LT",s[s.EQ=0]="EQ",s[s.GT=1]="GT"})(Je||(Je={}));function Pr(s,e,t="ASC"){if(Array.isArray(s)&&_u(s,e)||typeof s=="object"&&Xn(s,e)||s===e)return Je.EQ;if(t==="ASC"||t===void 0)return s<e?Je.LT:Je.GT;if(t==="DESC")return s>e?Je.LT:Je.GT;throw new Error("unexpected sort order to compareBasic: "+JSON.stringify(t))}function Hr(s,e,t){let n=Math.min(s.length,e.length);for(let u=0;u<n;u++){let l=(t==null?void 0:t[u])??"ASC",a=Pr(s[u],e[u],l);if(a!==Je.EQ)return a}if(s.length===e.length)return Je.EQ;let r=Math.min(s.length,e.length),i=(t==null?void 0:t[r])??"ASC";return Pr(s.length,e.length,i)}function Ts(s,e="ASC"){return(t,n)=>Pr(t[s],n[s],e)}const qo=JSON.stringify,He=new Ue("replica","gold"),qe=new Ue("replica set","gold"),je=new Ue("replica ingest","gold");function Is(s,e){return Hr([s.timestamp,s.signature],[e.timestamp,s.signature],["DESC","ASC"])}class Wo{constructor({driver:e,config:t}){var r;Object.defineProperty(this,"replicaId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicaDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formatsConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isClosed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ingestLockStream",{enumerable:!0,configurable:!0,writable:!0,value:new Wu}),Object.defineProperty(this,"eventMultiStream",{enumerable:!0,configurable:!0,writable:!0,value:new Ao("kind",!0)}),Object.defineProperty(this,"eventWriter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbackSink",{enumerable:!0,configurable:!0,writable:!0,value:new qu}),Object.defineProperty(this,"eraseInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"expireEventTimeouts",{enumerable:!0,configurable:!0,writable:!0,value:new Map});const n=Ot(e.docDriver.share);if(R(n))throw n;He.debug(`constructor.  driver = ${(r=e==null?void 0:e.constructor)==null?void 0:r.name}`),this.replicaId="replica-"+At(),this.share=e.docDriver.share,this.replicaDriver=e,this.formatsConfig=t||{},this.eventWriter=this.eventMultiStream.getWritableStream().getWriter(),this.eventMultiStream.getReadableStream("*").pipeTo(new et(this.callbackSink)),this.eraseInterval=sr(()=>{this.isClosed()?clearInterval(this.eraseInterval):this.pruneExpiredDocsAndAttachments()},1e3*60*60)}isClosed(){return this._isClosed}async close(e){if(He.debug("closing..."),this._isClosed)throw new me;await this.ingestLockStream.close();for(const t of this.expireEventTimeouts.values())clearTimeout(t);return He.debug("    sending willClose blockingly..."),await this.eventWriter.write({kind:"willClose"}),He.debug("    marking self as closed..."),e===!1&&await this.pruneExpiredDocsAndAttachments(),await this.replicaDriver.attachmentDriver.clearStaging(),this._isClosed=!0,He.debug(`    closing ReplicaDriver (erase = ${e})...`),await this.replicaDriver.docDriver.close(e),await this.replicaDriver.attachmentDriver.close(e),clearInterval(this.eraseInterval),He.debug("    sending didClose nonblockingly..."),await this.eventWriter.write({kind:"didClose"}),He.debug("...closing done"),Promise.resolve()}async getConfig(e){if(this._isClosed)throw new me;return await this.replicaDriver.docDriver.getConfig(e)}async setConfig(e,t){if(this._isClosed)throw new me;return await this.replicaDriver.docDriver.setConfig(e,t)}async listConfigKeys(){if(this._isClosed)throw new me;return await this.replicaDriver.docDriver.listConfigKeys()}async deleteConfig(e){if(this._isClosed)throw new me;return await this.replicaDriver.docDriver.deleteConfig(e)}getMaxLocalIndex(){if(this._isClosed)throw new me;return this.replicaDriver.docDriver.getMaxLocalIndex()}getAllDocs(e){return He.debug("getAllDocs()"),this.queryDocs({historyMode:"all",orderBy:"path ASC"},e)}getLatestDocs(e){return He.debug("getLatestDocs()"),this.queryDocs({historyMode:"latest",orderBy:"path ASC"},e)}getAllDocsAtPath(e,t){return He.debug(`getAllDocsAtPath("${e}")`),this.queryDocs({historyMode:"all",orderBy:"path ASC",filter:{path:e}},t)}async getLatestDocAtPath(e,t){He.debug(`getLatestDocsAtPath("${e}")`);const n=await this.queryDocs({historyMode:"latest",orderBy:"path ASC",filter:{path:e}},t?[t]:void 0);if(n.length!==0)return n[0]}async queryDocs(e={},t){if(He.debug("queryDocs",e),this._isClosed)throw new me;const n=hn(t);return await this.replicaDriver.docDriver.queryDocs({...e,formats:n.map(r=>r.id)})}async queryPaths(e={},t){const n=await this.queryDocs(e,t),r=new Set(n.map(({path:i})=>i));return Array.from(r).sort()}async queryAuthors(e={},t){const n=await this.queryDocs(e,t),r=new Set(n.map(({author:i})=>i));return Array.from(r).sort()}async set(e,t,n=lt){if(qe.debug("set",t),this._isClosed)throw new me;qe.debug("...deciding timestamp: getting latest doc at the same path (from any author)");const r=await this.getLatestDocAtPath(t.path);let i;typeof t.timestamp=="number"?i=t.timestamp:r===void 0?i=ws():i=Math.max(ws(),r.timestamp+1),qe.debug("...generating doc");let u;if(r){const o=n.removeExtraFields(r);R(o)||(u=o.doc)}const l=await n.generateDocument({keypair:e,input:{...t,format:n.id},share:this.share,timestamp:i,prevLatestDoc:u,config:this.formatsConfig[n.id]});if(R(l))return{kind:"failure",reason:"invalid_document",err:l};if(qe.debug("...signature =",l.doc.signature),l.attachment){const o=await this.replicaDriver.attachmentDriver.stage(n.id,l.attachment);if(R(o))return{kind:"failure",reason:"invalid_document",err:o};const c=await n.updateAttachmentFields(e,l.doc,o.size,o.hash,this.formatsConfig[n.id]);if(R(c))return await o.reject(),{kind:"failure",reason:"invalid_document",err:c};qe.debug("...ingesting attachment"),qe.debug("-----------------------"),await o.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:c,hash:o.hash,size:o.size,sourceId:"local"}),qe.debug("...done ingesting attachment"),qe.debug("...ingesting"),qe.debug("-----------------------");const f=await this.ingest(n,c,"local");return qe.debug("...done ingesting"),qe.debug("...set is done."),f}qe.debug("...ingesting"),qe.debug("-----------------------");const a=await this.ingest(n,l.doc,"local");return qe.debug("...done ingesting"),qe.debug("...set is done."),a}async ingest(e,t,n){if(je.debug("ingest",t),this._isClosed)throw new me;je.debug("...removing extra fields");const r=e.removeExtraFields(t);if(R(r))return{kind:"failure",reason:"invalid_document",err:r};t=r.doc;const i=r.extras;Object.keys(i).length>0&&je.debug(`...extra fields found: ${qo(i)}`);const u=await e.checkDocumentIsValid(t);if(R(u))return{kind:"failure",reason:"invalid_document",err:u};const l=X();return await this.ingestLockStream.run(async()=>{je.debug(" >> ingest: start of protected region"),je.debug("  > getting other history docs at the same path by any author");const a=await this.getAllDocsAtPath(t.path,[e]);je.debug(`  > ...got ${a.length}`),je.debug("  > getting prevLatest and prevSameAuthor");const o=a[0]??null,c=a.filter(g=>g.author===t.author)[0]??null;je.debug("  > checking if new doc is latest at this path"),a.push(t),a.sort(Is);const f=a[0]===t;if(je.debug(`  > ...isLatest: ${f}`),!f&&c!==null){je.debug("  > new doc is not latest and there is another one from the same author...");const g=Is(t,c);if(g===Je.GT){je.debug("  > new doc is GT prevSameAuthor, so it is obsolete"),l.resolve({kind:"nothing_happened",reason:"obsolete_from_same_author",doc:t});return}if(g===Je.EQ){je.debug("  > new doc is EQ prevSameAuthor, so it is redundant (already_had_it)"),l.resolve({kind:"nothing_happened",reason:"already_had_it",doc:t});return}}je.debug("  > upserting into ReplicaDriver...");const h=await this.replicaDriver.docDriver.upsert(t);je.debug("  > ...done upserting into ReplicaDriver"),je.debug("  > ...getting ReplicaDriver maxLocalIndex...");const d=await this.replicaDriver.docDriver.getMaxLocalIndex();je.debug(" >> ingest: end of protected region, returning a WriteEvent from the lock");const D={kind:"success",maxLocalIndex:d,doc:h,docIsLatest:f,prevDocFromSameAuthor:c,prevLatestDoc:o,sourceId:n};if(l.resolve(D),await this.eventWriter.write(D),h.deleteAfter){const g=`${h.path}|${h.author}`,y=this.expireEventTimeouts.get(g);y&&clearTimeout(y);const w=h.deleteAfter/1e3-Date.now();this.expireEventTimeouts.set(g,Vt(()=>{this.eventWriter.write({kind:"expire",doc:h})},w))}}),l}async overwriteAllDocsByAuthor(e,t){const n=Ss(t);if(He.debug(`overwriteAllDocsByAuthor("${e.address}")`),this._isClosed)throw new me;const r=await this.queryDocs({filter:{author:e.address},historyMode:"all"},[n]);He.debug(`    ...found ${r.length} docs to overwrite`);let i=0,u=0;for(const l of r){const a=await this.wipeDocument(e,l,Ss(t));if(R(a))return a;i+=1}return He.debug(`    ...done; ${i} overwritten to be empty; ${u} were already empty; out of total ${r.length} docs`),i}async wipeDocAtPath(e,t,n=lt){const r=await this.getLatestDocAtPath(t,n);return r?this.wipeDocument(e,r,n):new O("No document exists at that path")}async wipeDocument(e,t,n){const r={...t,timestamp:Math.max(t.timestamp+1,Date.now()*1e3),author:e.address},i=await n.wipeDocument(e,r,this.formatsConfig[n.id]);if(R(i))return{kind:"failure",err:i,reason:"invalid_document"};const u=await this.ingest(n,i,"local");if(u.kind==="success"){const l=n.getAttachmentInfo(t);if(!R(l)){const a=await this.replicaDriver.attachmentDriver.erase(n.id,l.hash);R(a)||await this.eventWriter.write({kind:"attachment_prune",format:n.id,hash:l.hash})}}return u}async pruneExpiredDocsAndAttachments(e=or){const t=await this.replicaDriver.docDriver.eraseExpiredDocs();for(const u of t)await this.eventWriter.write({kind:"expire",doc:u});const n=dn(e),r={};await this.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"existing",e).pipeTo(new et({write(u){if(u.kind==="existing"){const l=n[u.doc.format],a=l.getAttachmentInfo(u.doc);if(!R(a)){const o=r[l.id];o?o.add(a.hash):r[l.id]=new Set([a.hash])}}}}));const i=await this.replicaDriver.attachmentDriver.filter(r);for(const u of i)await this.eventWriter.write({kind:"attachment_prune",format:u.format,hash:u.hash})}getEventStream(e="*"){return this.eventMultiStream.getReadableStream(e)}getQueryStream(e={},t,n){const r=this.queryDocs.bind(this),i=this.getEventStream.bind(this);return new Gt({async start(u){if(t==="existing"||t==="everything"){const o=await r(e,n);for(const c of o)u.enqueue({kind:"existing",doc:c})}if(u.enqueue({kind:"processed_all_existing"}),t==="existing"){u.close();return}const a=i().getReader();for(;;){const{done:o,value:c}=await a.read();if(o)return;if(c.kind==="expire"||c.kind==="success"){if(e.filter&&zr(c.doc,e.filter)){u.enqueue(c);continue}u.enqueue(c);continue}c.kind==="didClose"&&u.close()}}})}onEvent(e){return this.callbackSink.onWrite(e)}async ingestAttachment(e,t,n,r){if(this._isClosed)throw new me;const i=e.removeExtraFields(t);if(R(i))return Promise.resolve(i);t=i.doc;const u=await e.checkDocumentIsValid(t);if(R(u))return Promise.resolve(u);const l=await this.getAttachment(t,e);if(l&&!R(l))return!1;const a=e.getAttachmentInfo(t);if(R(a))return Promise.resolve(a);const o=await this.replicaDriver.attachmentDriver.stage(t.format,n);return R(o)?o:o.hash!==a.hash?(await o.reject(),new O("Attachment's hash did not match the document's")):o.size!==a.size?(await o.reject(),new O("Attachment's size did not match the document's")):(await o.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:t,hash:o.hash,size:o.size,sourceId:r}),!0)}getAttachment(e,t=lt){if(e.deleteAfter&&e.deleteAfter<Date.now()*1e3)return Promise.resolve(new O("This document has expired"));const n=t.getAttachmentInfo(e);return R(n)?Promise.resolve(n):this.replicaDriver.attachmentDriver.getAttachment(e.format,n.hash)}addAttachments(e,t){const n=hn(t),r={};for(const u of n)r[u.id]=u;const i=e.map(u=>new Promise(l=>{const o=r[u.format].getAttachmentInfo(u);if(!R(o))this.replicaDriver.attachmentDriver.getAttachment(u.format,o.hash).then(c=>{l({...u,attachment:c})});else return l({...u,attachment:o})}));return Promise.all(i)}}class Qo extends Wo{constructor(e){super({driver:e.driver,config:{"es.5":{shareSecret:e.shareSecret}}})}}const Ht=new Ue("replica-cache","green");function Ps({_localIndex:s}){return s}function xs(s,e){const t=[];for(const n of e)if(!(s.orderBy==="path ASC"&&s.startAfter!==void 0&&s.startAfter.path!==void 0&&n.path<=s.startAfter.path)&&!(s.orderBy==="path DESC"&&s.startAfter!==void 0&&s.startAfter.path!==void 0&&n.path>=s.startAfter.path)&&!(s.orderBy==="localIndex ASC"&&s.startAfter!==void 0&&s.startAfter.localIndex!==void 0&&(n._localIndex||0)<=s.startAfter.localIndex)&&!(s.orderBy==="localIndex DESC"&&s.startAfter!==void 0&&s.startAfter.localIndex!==void 0&&(n._localIndex||0)>=s.startAfter.localIndex)&&(t.push(n),s.limit!==void 0&&t.length>=s.limit))break;return t}class Ko{constructor(e,t,n){Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"replica",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"timeToLive",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onCacheUpdatedCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"onFireCacheUpdatedsWrapper",{enumerable:!0,configurable:!0,writable:!0,value:l=>l()}),Object.defineProperty(this,"attachmentCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.replica=e,this.timeToLive=t||1e3,n&&(this.onFireCacheUpdatedsWrapper=n);const r=this.onReplicaEvent.bind(this),i=this.close.bind(this),u=this.isClosed.bind(this);this.replica.getEventStream("*").pipeTo(new et({async write(l){l.kind==="attachment_ingest"||l.kind==="success"||l.kind==="expire"?await r(l):l.kind==="willClose"&&!u()&&await i()}})).catch(()=>{})}async close(){if(this.closed)throw new Mt;this.closed=!0,await Promise.all(Array.from(this.docCache.values()).map(e=>e.close())),this.docCache.clear(),this.onCacheUpdatedCallbacks.clear()}isClosed(){return this.closed}getAllDocs(e){return this.queryDocs({historyMode:"all",orderBy:"path DESC"},e)}getLatestDocs(e){return this.queryDocs({historyMode:"latest",orderBy:"path DESC"},e)}getAllDocsAtPath(e,t){return this.queryDocs({historyMode:"all",orderBy:"path DESC",filter:{path:e}},t)}getLatestDocAtPath(e,t){const n=this.queryDocs({historyMode:"latest",orderBy:"path DESC",filter:{path:e}},t?[t]:void 0);if(n.length!==0)return n[0]}queryDocs(e={},t){if(this.closed)throw new Mt;if(this.replica.isClosed())throw new me;const r={...e,formats:(t||or).map(D=>D.id)},i=Gu(r);if(i.willMatch==="nothing")return[];const u=Ga(i.query),l=this.docCache.get(u);if(l)return Date.now()>l.expires&&this.replica.queryDocs(e,t).then(D=>{const g=D.map(Ps).sort(),y=l.docs.map(Ps).sort();_u(g,y)||(this.docCache.set(u,{stream:l.stream,close:l.close,docs:D,expires:Date.now()+this.timeToLive}),Ht.debug("Updated cache because result expired."),this.fireOnCacheUpdateds())}),l.docs;const a=this.replica.getQueryStream(e,"new",t),o=new qu,c=o.onWrite(D=>{(D.kind==="existing"||D.kind==="success")&&(Ht.debug({doc:D.doc.path,queryString:u}),this._updateCache(u,D.doc))}),f=new et(o),h=new AbortController;a.pipeTo(f,{signal:h.signal});const d=()=>{c()};return this.docCache.set(u,{stream:a,docs:[],expires:Date.now()+this.timeToLive,close:d}),this.replica.queryDocs(r).then(D=>{this.docCache.set(u,{stream:a,close:d,docs:D,expires:Date.now()+this.timeToLive}),Ht.debug("Updated cache with a new entry."),this.fireOnCacheUpdateds()}),[]}queryPaths(e={},t){const n=this.queryDocs(e,t),r=new Set(n.map(({path:i})=>i));return Array.from(r).sort()}queryAuthors(e={},t){const n=this.queryDocs(e,t),r=new Set(n.map(({author:i})=>i));return Array.from(r).sort()}_updateCache(e,t){const n=this.docCache.get(e);if(!n)return;const r=JSON.parse(e),i=()=>{const d=[...n.docs,t];this.docCache.set(e,{...n,docs:xs(r,d)}),this.fireOnCacheUpdateds()},u=({exact:d})=>{const D=n.docs.map(g=>d&&g.path===t.path&&g.author===t.author||!d&&g.path===t.path?t:g);this.docCache.set(e,{...n,docs:xs(r,D)}),this.fireOnCacheUpdateds()},l=n.docs.filter(d=>d.path===t.path),a=n.docs.filter(d=>d.path===t.path&&d.author===t.author);if(l.length===0){(r.filter&&zr(t,r.filter)||!r.filter)&&(Ht.debug("Updated cache after appending a doc to a entry with matching filter."),i());return}if((r.historyMode||"latest")==="all"){if(a.length===0){Ht.debug("Updated cache after appending a version of a doc to a historyMode: all query."),i();return}Ht.debug("Updated cache after replacing a version of a doc in a historyMode: all query."),u({exact:!0});return}const c=l[0],f=t.author!==(c==null?void 0:c.author)||!Xn(t,c),h=t.timestamp>c.timestamp;if(f&&h){Ht.debug("Updated cache after replacing a doc with its latest version."),u({exact:!1});return}}fireOnCacheUpdateds(){this.version++,this.onFireCacheUpdatedsWrapper(()=>{this.onCacheUpdatedCallbacks.forEach(e=>{e()})})}onCacheUpdated(e){if(this.closed)throw new Mt;if(this.replica.isClosed())throw new me;return this.onCacheUpdatedCallbacks.add(e),()=>{this.onCacheUpdatedCallbacks.delete(e)}}set(e,t,n){if(this.closed)throw new Mt;return this.replica.set(e,t,n)}overwriteAllDocsByAuthor(e,t){if(this.closed)throw new Mt;if(this.replica.isClosed())throw new me;return this.replica.overwriteAllDocsByAuthor(e,t)}wipeDocAtPath(e,t,n=lt){if(this.closed)throw new Mt;return this.replica.wipeDocAtPath(e,t,n)}async onReplicaEvent(e){const t=`${e.doc.path}|${e.doc.author}`,n=this.attachmentCache.get(t);if(!n)return;const r=await this.replica.getAttachment(e.doc,n.format);this.attachmentCache.set(t,{expires:Date.now()+this.timeToLive,attachment:r,format:n.format}),this.fireOnCacheUpdateds()}getAttachment(e,t=lt){if(this.closed)throw new Mt;if(this.replica.isClosed())throw new me;const n=t.getAttachmentInfo(e);if(R(n))return n;const r=`${e.path}|${e.author}`,i=this.attachmentCache.get(r);if(i)return Date.now()>i.expires&&this.replica.getAttachment(e,t).then(u=>{this.attachmentCache.set(r,{expires:Date.now()+this.timeToLive,attachment:u,format:t}),this.fireOnCacheUpdateds()}),e.deleteAfter&&Date.now()*1e3>e.deleteAfter?new O("This document has expired"):i.attachment;this.attachmentCache.set(r,{attachment:void 0,expires:Date.now()+this.timeToLive,format:t}),this.replica.getAttachment(e,t).then(u=>{this.attachmentCache.set(r,{expires:Date.now()+this.timeToLive,attachment:u,format:t}),this.fireOnCacheUpdateds()})}addAttachments(e,t){const n=[],r=dn(t);for(const i of e){const u=this.getAttachment(i,r[i.format]);n.push({...i,attachment:u})}return n}}new Ue("storage driver async memory","yellow");async function Vo(s){let e=new Uint8Array;return await s.pipeTo(new et({write(t){const n=new Uint8Array(e.length+t.length);n.set(e),n.set(t,e.length),e=n}})),e}const Go="earthstar",Kn="current_author",Fn="shares",Bn="share_secrets",Sn="servers";class Un{constructor(e){Object.defineProperty(this,"namespace",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:localStorage}),Object.defineProperty(this,"authorChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"sharesChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"shareSecretsChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"serversChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),this.namespace=e==null?void 0:e.namespace,e!=null&&e.sessionOnly&&(this.storage=sessionStorage),addEventListener("storage",t=>{switch(t.key){case Ie(Kn,this.namespace):{this.fireAuthorEvent();break}case Ie(Fn,this.namespace):{this.fireSharesEvent();break}case Ie(Bn,this.namespace):{this.fireSecretsEvent();break}case Ie(Sn,this.namespace):{this.fireServersEvent();break}}})}get author(){const e=Ie(Kn,this.namespace);return Vn(this.storage,e,Zo)||null}set author(e){const t=Ie(Kn,this.namespace);this.storage.setItem(t,JSON.stringify(e)),this.fireAuthorEvent()}get shares(){const e=Ie(Fn,this.namespace);return Vn(this.storage,e,Yo)||[]}addShare(e){if(R(Ot(e)))return new O("Not a valid share");const t=Ie(Fn,this.namespace),n=new Set([...this.shares,e]),r=Array.from(n);return this.storage.setItem(t,JSON.stringify(r)),this.fireSharesEvent(),r}removeShare(e){const t=this.shares,n=t.findIndex(i=>i===e);if(n===-1)return new O("That share is not known yet");t.splice(n,1);const r=Ie(Fn,this.namespace);return this.storage.setItem(r,JSON.stringify(t)),this.fireSharesEvent(),t}get shareSecrets(){const e=Ie(Bn,this.namespace);return Vn(this.storage,e,Xo)||{}}async addSecret(e,t){if(!this.shares.find(u=>e===u))return new O("This share is not yet known.");if(R(await Ae.checkKeypairIsValid({shareAddress:e,secret:t})))return new O("Not the right secret for this share.");const r=Ie(Bn,this.namespace),i={...this.shareSecrets,[e]:t};return this.storage.setItem(r,JSON.stringify(i)),this.fireSecretsEvent(),i}removeSecret(e){const t=this.shareSecrets;if(!t[e])return new O("Unknown share");const r=Ie(Bn,this.namespace),i={...t};return delete i[e],this.storage.setItem(r,JSON.stringify(i)),this.fireSecretsEvent(),i}get servers(){const e=Ie(Sn,this.namespace);return Vn(this.storage,e,Jo)||[]}addServer(e){try{const t=new URL(e),n=new Set([...this.servers,t.toString()]),r=Array.from(n),i=Ie(Sn,this.namespace);return this.storage.setItem(i,JSON.stringify(r)),this.fireServersEvent(),r}catch{return new O("Not a valid URL.")}}removeServer(e){try{const t=new URL(e),n=this.servers,r=n.findIndex(u=>u===t.toString());if(r===-1)return new O("That server is not known yet");n.splice(r,1);const i=Ie(Sn,this.namespace);return this.storage.setItem(i,JSON.stringify(n)),this.fireServersEvent(),n}catch{return new O("Not a valid URL")}}clear(){const e=Ie(Kn,this.namespace);this.storage.setItem(e,JSON.stringify(null));const t=Ie(Fn,this.namespace);this.storage.setItem(t,JSON.stringify([]));const n=Ie(Bn,this.namespace);this.storage.setItem(n,JSON.stringify({}));const r=Ie(Sn,this.namespace);this.storage.setItem(r,JSON.stringify([])),this.fireAuthorEvent(),this.fireSharesEvent(),this.fireSecretsEvent(),this.fireServersEvent()}onAuthorChanged(e){return this.authorChangedCbs.add(e),()=>{this.authorChangedCbs.delete(e)}}onSharesChanged(e){return this.sharesChangedCbs.add(e),()=>{this.sharesChangedCbs.delete(e)}}onShareSecretsChanged(e){return this.shareSecretsChangedCbs.add(e),()=>{this.shareSecretsChangedCbs.delete(e)}}onServersChanged(e){return this.serversChangedCbs.add(e),()=>{this.serversChangedCbs.delete(e)}}getPeer({sync:e,onCreateReplica:t}){const n=new fr,r=this.shares;for(const o of r){const c=t(o,this.shareSecrets[o]);n.addReplica(c)}const i=this.onSharesChanged(async o=>{const c=n.replicas(),f=n.shares();for(const h of c)o.includes(h.share)||(n.removeReplica(h),await h.close(!1));for(const h of o)if(!f.includes(h)){const d=t(h,this.shareSecrets[h]);n.addReplica(d)}}),u=this.onShareSecretsChanged(async o=>{const c=n.shares(),f=Object.keys(o);for(const h of c)if(!f.includes(h)){const d=n.getReplica(h);d&&(n.removeReplica(d),d.close(!1));const D=t(h);n.addReplica(D)}for(const h of f){const d=n.getReplica(h);if(d!=null&&d.formatsConfig["es.5"]&&d.formatsConfig["es.5"].shareSecret)continue;await(d==null?void 0:d.close(!1)),n.removeReplicaByShare(h);const D=t(h,o[h]);n.addReplica(D)}});if(e)for(const o of this.servers)n.sync(o,e==="continuous");const l=this.onServersChanged(o=>{if(e){const c=n.getSyncers();for(const[f,{description:h,syncer:d}]of c)o.includes(h)||d.cancel();for(const f of o)n.sync(f,e==="continuous")}});return{peer:n,unsubscribeFromSettings:()=>{i(),u(),l()}}}fireAuthorEvent(){const e=this.author;for(const t of this.authorChangedCbs)t(e)}fireSharesEvent(){const e=this.shares;for(const t of this.sharesChangedCbs)t(e)}fireSecretsEvent(){const e=this.shareSecrets;for(const t of this.shareSecretsChangedCbs)t(e)}fireServersEvent(){const e=this.servers;for(const t of this.serversChangedCbs)t(e)}}function Ie(s,e){return`${Go}:${e?`${e}:`:""}${s}`}function Vn(s,e,t){const n=s.getItem(e);if(n!==null)try{const r=JSON.parse(n);return t(r)?r:void 0}catch{return}}function Zu(s){return!(s==null||typeof s!="object")}function Zo(s){return!(!Zu(s)||Object.keys(s).length!==2||!("address"in s)||!("secret"in s))}function Yo(s){return!(!Array.isArray(s)||s.some(e=>typeof e!="string")||s.some(e=>R(Ot(e))))}function Xo(s){if(!Zu(s))return!1;for(const e in s){const t=s[e];if(typeof t!="string"||R(Ae.checkKeypairIsValid({shareAddress:e,secret:t})))return!1}return!0}function Jo(s){if(!Array.isArray(s)||s.some(e=>typeof e!="string"))return!1;for(const e of s)try{new URL(e)}catch{return!1}return!0}function ec(s){const e=s-1;return e*e*e+1}function It(s,{delay:e=0,duration:t=400,easing:n=ec,x:r=0,y:i=0,opacity:u=0}={}){const l=getComputedStyle(s),a=+l.opacity,o=l.transform==="none"?"":l.transform,c=a*(1-u);return{delay:e,duration:t,easing:n,css:(f,h)=>`
			transform: ${o} translate(${(1-f)*r}px, ${(1-f)*i}px);
			opacity: ${a-c*h}`}}const rn=[];function zn(s,e){return{subscribe:qr(s,e).subscribe}}function qr(s,e=$){let t;const n=new Set;function r(l){if(J(s,l)&&(s=l,t)){const a=!rn.length;for(const o of n)o[1](),rn.push(o,s);if(a){for(let o=0;o<rn.length;o+=2)rn[o][0](rn[o+1]);rn.length=0}}}function i(l){r(l(s))}function u(l,a=$){const o=[l,a];return n.add(o),n.size===1&&(t=e(r)||$),l(s),()=>{n.delete(o),n.size===0&&(t(),t=null)}}return{set:r,update:i,subscribe:u}}function tc(s,e,t){const n=!Array.isArray(s),r=n?[s]:s,i=e.length<2;return zn(t,u=>{let l=!1;const a=[];let o=0,c=$;const f=()=>{if(o)return;c();const d=e(n?a[0]:a,u);i?u(d):c=eu(d)?d:$},h=r.map((d,D)=>ma(d,g=>{a[D]=g,o&=~(1<<D),l&&f()},()=>{o|=1<<D}));return l=!0,f(),function(){ke(h),c()}})}const ot=qr({address:"",secret:""});new Ue("storage driver localStorage","gold");const qt=new Ue("replica driver indexeddb","gold");function nc(s,e){return Hr([s.path,s.timestamp,s.signature],[e.path,e.timestamp,s.signature],["ASC","DESC","ASC"])}function rc(s,e){return Hr([s.path,s.timestamp,s.signature],[e.path,e.timestamp,s.signature],["DESC","DESC","ASC"])}const Ye="docs",it="config";class sc{constructor(e,t){Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:X()}),Object.defineProperty(this,"gotInitialMaxLocalIndex",{enumerable:!0,configurable:!0,writable:!0,value:X()}),Object.defineProperty(this,"localMaxLocalIndex",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1});const n=Ot(e);if(R(n))throw n;if(this.share=e,qt.debug("constructor"),!window.indexedDB)throw new Qe("IndexedDB is not supported by this runtime.");const r=wu.indexedDB.open(`earthstar:share_docs:${this.share}${t?`/${t}`:""}`,1);r.onerror=()=>{throw qt.error(`Could not open IndexedDB for ${this.share}'s attachments.`),qt.error(r.error),new Qe(`Could not open IndexedDB for ${this.share}'s attachments.`)},r.onupgradeneeded=function(){const i=r.result,u=i.createObjectStore(Ye,{keyPath:["path","author"]});u.createIndex("comboIndex",["_localIndex","timestamp","path","author"],{unique:!0}),u.createIndex("pathTimestampIndex",["path","timestamp"],{unique:!1}),u.createIndex("pathAuthorIndex",["path","author"],{unique:!0}),u.createIndex("deleteAfterIndex","deleteAfter",{unique:!1}),u.createIndex("localIndexIndex","_localIndex",{unique:!0}),i.createObjectStore(it,{keyPath:"key"}).createIndex("keyIndex",["key"],{unique:!0})},r.onsuccess=()=>{this.db.resolve(r.result);const u=r.result.transaction([Ye],"readonly").objectStore(Ye).index("localIndexIndex").openCursor(null,"prev");u.onsuccess=()=>{u.result?this.gotInitialMaxLocalIndex.resolve(u.result.value._localIndex):this.gotInitialMaxLocalIndex.resolve(-1)}},this.gotInitialMaxLocalIndex.then(i=>{this.localMaxLocalIndex=i})}isClosed(){return this.closed}async close(e){if(this.closed)throw new me;this.closed=!0;const t=X();if(e){const r=(await this.db).transaction([Ye,it],"readwrite"),i=X(),u=X(),l=r.objectStore(Ye).clear().onsuccess=()=>{i.resolve()},a=r.objectStore(it).clear().onsuccess=()=>{u.resolve()};await Promise.all([l,a]),t.resolve()}else t.resolve();return(await this.db).close(),await zu(20),t}async getMaxLocalIndex(){return await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex}async queryDocs(e){var c,f,h,d,D,g,y,w,_,v,B,S,P;const n=(await this.db).transaction([Ye],"readonly").objectStore(Ye),r=X(),{query:i,willMatch:u}=Gu(e);if(qt.debug(`    cleanUpQuery.  willMatch = ${u}`),u==="nothing")return[];if((c=i.filter)!=null&&c.path&&i.historyMode==="latest"){const T=IDBKeyRange.bound([i.filter.path,i.filter.timestampGt||0],[i.filter.path,i.filter.timestampLt||Number.MAX_SAFE_INTEGER]),M=n.index("pathTimestampIndex").openCursor(T,"prev");M.onsuccess=()=>{var q;(q=M.result)!=null&&q.value?r.resolve([M.result.value]):r.resolve([])}}else if((f=i.filter)!=null&&f.path&&i.historyMode==="all"){const T=n.index("pathAuthorIndex"),x=IDBKeyRange.bound([i.filter.path," "],[i.filter.path,"~"]),M=T.getAll(x);M.onsuccess=()=>{M.result?r.resolve(Array.from(M.result)):r.resolve([])}}else{const T=((h=i.startAfter)==null?void 0:h.path)||((d=i.filter)==null?void 0:d.path)||((D=i.filter)==null?void 0:D.pathStartsWith)||" ",x=((g=i.filter)==null?void 0:g.author)||" ",M=((y=i.filter)==null?void 0:y.timestamp)||((w=i.filter)==null?void 0:w.timestampGt)||0,q=((_=i.startAfter)==null?void 0:_.localIndex)||0,W=((v=i.filter)==null?void 0:v.path)||"~",ue=((B=i.filter)==null?void 0:B.author)||"~",ae=((S=i.filter)==null?void 0:S.timestamp)||((P=i.filter)==null?void 0:P.timestampLt)||Number.MAX_SAFE_INTEGER,Ke=Number.MAX_SAFE_INTEGER,ve=IDBKeyRange.bound([q,M,T,x],[Ke,ae,W,ue]),ze=n.index("comboIndex").getAll(ve);ze.onsuccess=()=>{ze.result?r.resolve(ze.result):r.resolve([])}}const l=await r;if(i.historyMode==="latest"){const T=l.splice(0,l.length),x=new Map;for(const M of T){const q=x.get(M.path);(!q||q.timestamp<M.timestamp)&&x.set(M.path,M)}l.push(...x.values())}const a=[];qt.debug("    filtering docs");const o=Date.now()*1e3;for(const T of l)T.deleteAfter&&T.deleteAfter<o||i.filter&&!zr(T,i.filter)||a.push(T);if(qt.debug(`    ordering docs: ${i.orderBy}`),i.orderBy==="path ASC")a.sort(nc);else if(i.orderBy==="path DESC")a.sort(rc);else if(i.orderBy==="localIndex ASC")a.sort(Ts("_localIndex","ASC"));else if(i.orderBy==="localIndex DESC")a.sort(Ts("_localIndex","DESC"));else if(i.orderBy)throw new O("unrecognized query orderBy: "+JSON.stringify(i.orderBy));return i.limit!==void 0&&l.length>=i.limit?a.slice(0,i.limit):(qt.debug(`    queryDocs is done: found ${a.length} docs.`),a)}async upsert(e){const t=await this.db,r=t.transaction([Ye],"readwrite").objectStore(Ye).index("pathAuthorIndex"),i=X(),u=r.openCursor([e.path,e.author]);if(await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex+=1,e._localIndex=this.localMaxLocalIndex,u.onsuccess=()=>{if(u.result){const f=u.result.update(e);f.onsuccess=()=>{i.resolve(!!f.result)}}else i.resolve(!1)},await i)return e;const o=t.transaction([Ye],"readwrite").objectStore(Ye).put(e),c=X();return o.onsuccess=()=>{c.resolve()},o.onerror=()=>{throw o.error},await c,e}async eraseExpiredDocs(){const e=[],r=(await this.db).transaction([Ye],"readwrite").objectStore(Ye).index("deleteAfterIndex"),i=Date.now()*1e3,u=IDBKeyRange.bound(0,i),l=r.openCursor(u),a=X();return l.onsuccess=()=>{var o;if((o=l.result)!=null&&o.value){const c=l.result.value;if(c.deleteAfter!==null&&c.deleteAfter!==void 0){e.push(c);const f=l.result.delete();f.onsuccess=()=>{var h;(h=l.result)==null||h.continue()}}}else a.resolve()},await a,e}async getConfig(e){const n=(await this.db).transaction([it],"readonly").objectStore(it),r=X(),i=n.get(e);return i.onsuccess=()=>{var u;r.resolve((u=i.result)==null?void 0:u.value)},r}async setConfig(e,t){const r=(await this.db).transaction([it],"readwrite").objectStore(it),i=X(),u=r.put({key:e,value:t});return u.onsuccess=()=>{i.resolve()},i}async listConfigKeys(){const t=(await this.db).transaction([it],"readonly").objectStore(it),n=X(),i=t.index("keyIndex").openKeyCursor(),u=[];return i.onsuccess=()=>{i.result?(u.push(i.result.primaryKey),i.result.continue()):n.resolve(u)},n}async deleteConfig(e){const n=(await this.db).transaction([it],"readwrite").objectStore(it),r=X(),i=n.index("keyIndex"),u=IDBKeyRange.bound([e],[e]),l=i.openCursor(u);return l.onsuccess=()=>{if(l.result){const a=l.result.delete();a.onsuccess=()=>{r.resolve(!0)}}else r.resolve(!1)},r}}const Rs=new Ue("replica driver indexeddb","gold"),ut="attachment_staging_index",Xe="attachments_index",Ve="attachments_bytes";class ic{constructor(e,t){if(Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:X()}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.share=e,!window.indexedDB)throw new Qe("IndexedDB is not supported by this runtime.");const n=wu.indexedDB.open(`earthstar:share_attachments:${this.share}${t?`/${t}`:""}`,1);n.onerror=()=>{throw Rs.error(`Could not open IndexedDB for ${this.share}'s attachments.`),Rs.error(n.error),new Qe(`Could not open IndexedDB for ${this.share}'s attachments.`)},n.onupgradeneeded=function(){const r=n.result;r.createObjectStore(Ve),r.createObjectStore(Xe,{keyPath:"id"}),r.createObjectStore(ut,{keyPath:"id"})},n.onsuccess=()=>{this.db.resolve(n.result)}}getIndexKey(e,t){return`${e}___${t}`}async getAttachment(e,t){if(this.closed)throw new me;const n=X(),r=this.getIndexKey(e,t),i=await this.db,l=i.transaction([Xe],"readonly").objectStore(Xe).get(r),a=X();return l.onerror=()=>{a.reject()},l.onsuccess=()=>{l.result===void 0?a.reject():a.resolve(l.result.blobKey)},a.then(o=>{const f=i.transaction([Ve],"readonly").objectStore(Ve).get(o);f.onsuccess=()=>{const h=new su([f.result]);n.resolve({bytes:async()=>new Uint8Array(await h.arrayBuffer()),stream:()=>Promise.resolve(h.stream())})},f.onerror=()=>{n.resolve(void 0)}}).catch(()=>{n.resolve(void 0)}),n}async erase(e,t){if(this.closed)throw new me;const n=X(),r=this.getIndexKey(e,t),i=await this.db,l=i.transaction([Xe],"readonly").objectStore(Xe).get(r),a=X();return l.onerror=()=>{a.reject()},l.onsuccess=()=>{i.transaction([Xe],"readwrite").objectStore(Xe).delete(r),l.result===void 0?a.reject():a.resolve(l.result.blobKey)},a.then(o=>{const c=i.transaction([Ve],"readwrite").objectStore(Ve).delete(o);c.onsuccess=()=>{n.resolve(!0)},c.onerror=()=>{n.resolve(void 0)}}).catch(()=>{n.resolve(new O("No attachment found"))}),n}async stage(e,t){if(this.closed)throw new me;const n=await this.db,r=t instanceof Uint8Array?t:await Vo(t),i=await Ae.sha256base32(r),u=this.getIndexKey(e,i),l=`${u}___${At()}`,a=n.transaction([Ve,ut],"readwrite"),o=a.objectStore(Ve).put(r,l),c=a.objectStore(ut).put({id:u,blobKey:l}),f=X(),h=X();return o.onsuccess=()=>f.resolve(),c.onsuccess=()=>h.resolve(),await f,await h,{hash:i,size:r.byteLength,reject:async()=>{const d=n.transaction([Ve,ut],"readwrite"),D=d.objectStore(Ve).delete(l),g=d.objectStore(ut).delete(u),y=X(),w=X();D.onsuccess=()=>{y.resolve()},g.onsuccess=()=>{w.resolve()},await Promise.all([y,w])},commit:async()=>{const d=n.transaction([Xe,ut],"readwrite"),D=d.objectStore(ut).delete(u),g=d.objectStore(Xe).put({id:u,blobKey:l}),y=X(),w=X();D.onsuccess=()=>y.resolve(),g.onsuccess=()=>w.resolve(),await Promise.all([y,w])}}}async wipe(){if(this.closed)throw new me;const t=(await this.db).transaction([Ve,Xe,ut],"readwrite"),n=t.objectStore(Ve).clear(),r=t.objectStore(Xe).clear(),i=t.objectStore(ut).clear(),u=X(),l=X(),a=X();n.onsuccess=()=>u.resolve(),r.onsuccess=()=>l.resolve(),i.onsuccess=()=>a.resolve(),await Promise.all([u,l,a])}async clearStaging(){if(this.closed)throw new me;const t=(await this.db).transaction([Ve,ut]),n=t.objectStore(ut).openCursor(),r=X();return n.onsuccess=()=>{const i=n.result;if(!i){r.resolve();return}const u=i.value.blobKey,l=t.objectStore(Ve).delete(u);i.delete(),l.onsuccess=()=>{i.continue()},l.onerror=()=>{i.continue()}},r}async filter(e){if(this.closed)throw new me;const n=(await this.db).transaction([Ve,Xe],"readwrite"),r=50,i=[],u=[],l=X(),a=(o=null)=>{const c=n.objectStore(Xe).getAll(o,r);c.onsuccess=()=>{const f=c.result;for(const h of f){const[d,D]=h.id.split("___");e[d]&&!e[d].has(D)&&(i.push({format:d,hash:D}),u.push(this.erase(d,D)))}if(f.length===r){const h=f[f.length-1],d=IDBKeyRange.lowerBound(h.id,!0);a(d)}else l.resolve()}};return a(),await l,await Promise.all(u),i}isClosed(){return this.closed}async close(e){if(this.closed)throw new me;e&&await this.wipe(),this.closed=!0,(await this.db).close(),await zu(20)}}class uc{constructor(e,t){Object.defineProperty(this,"docDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachmentDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.docDriver=new sc(e,t),this.attachmentDriver=new ic(e,t)}}const Wr=zn({shareAddress:"+commons.b27bosxdl43cwmugqh2gg2ulaucikjxteaxkagkxhbmzcbvveb52a",secret:"b434ttewvnr63tiebyb3t3lqwen6wxajj7zh5w52jivgdnin5okga"});let xr;Wr.subscribe(s=>{xr=s});const ac=new Qo({driver:new uc(xr.shareAddress),shareSecret:xr.secret}),$t=zn({replica:ac}),lc=new Un,Mn=qr({settings:lc});function oc(s){let e,t,n,r,i,u,l,a,o,c,f,h,d,D;return{c(){e=m("input"),t=F(),n=m("button"),r=j(`Upload ID
    `),i=m("br"),u=F(),l=m("br"),a=F(),o=m("img"),f=F(),h=m("span"),h.textContent="It is a JSON file",Se(e,"display","none"),b(e,"type","file"),b(e,"accept",".json, .txt"),$e(o.src,c=cc)||b(o,"src",c),b(o,"alt","upload id is a mouse "),b(h,"class","tooltiptext svelte-zq0ldm"),b(n,"class","phase1 tooltip px-8 pb-8 svelte-zq0ldm")},m(g,y){A(g,e,y),s[4](e),A(g,t,y),A(g,n,y),p(n,r),p(n,i),p(n,u),p(n,l),p(n,a),p(n,o),p(n,f),p(n,h),d||(D=[H(e,"change",s[3]),H(n,"click",s[5])],d=!0)},p:$,i:$,o:$,d(g){g&&C(e),s[4](null),g&&C(t),g&&C(n),d=!1,ke(D)}}}let cc="images/upload-img.png";function fc(s){return new Promise((e,t)=>{let n=new FileReader;n.onload=()=>{e(n.result)},n.onerror=t,n.readAsBinaryString(s)})}function hc(s,e,t){const n=tt();let r,i,{identityPg:u=!1}=e;async function l(f){let h=f.target.files[0],d=await fc(h);try{let D=JSON.parse(d);console.log(typeof D),console.log("fileReady",d);let g=D.address;console.log("authorAddress",g);let y=D.secret;console.log("authorSecret",y),ot.set({address:g,secret:y}),i=g.slice(1,5),n("alias",i)}catch{n("error")}}const a=f=>l(f);function o(f){Rr[f?"unshift":"push"](()=>{r=f,t(0,r)})}const c=()=>{r.click()};return s.$$set=f=>{"identityPg"in f&&t(2,u=f.identityPg)},[r,l,u,a,o,c]}class dc extends te{constructor(e){super(),ne(this,e,hc,oc,J,{identityPg:2})}}function Os(s){let e,t,n,r,i;return{c(){e=m("h4"),e.textContent="Your current Identity Keypair:",t=F(),n=m("h4"),r=m("b"),i=j(s[2]),b(n,"class","my-4")},m(u,l){A(u,e,l),A(u,t,l),A(u,n,l),p(n,r),p(r,i)},p(u,l){l&4&&ce(i,u[2])},d(u){u&&C(e),u&&C(t),u&&C(n)}}}function $s(s){let e,t,n;function r(l,a){return l[5]==="ID must be 4 characters long"?gc:l[5]==="ID must start with a letter"?mc:l[5]==="ID must not contain special characters"?Dc:pc}let i=r(s),u=i(s);return{c(){e=m("blockquote"),u.c()},m(l,a){A(l,e,a),u.m(e,null),n=!0},p(l,a){i!==(i=r(l))&&(u.d(1),u=i(l),u&&(u.c(),u.m(e,null)))},i(l){n||(rr(()=>{t||(t=Bt(e,It,{y:200,duration:2e3},!0)),t.run(1)}),n=!0)},o(l){t||(t=Bt(e,It,{y:200,duration:2e3},!1)),t.run(0),n=!1},d(l){l&&C(e),u.d(),l&&t&&t.end()}}}function pc(s){let e;return{c(){e=j("Press enter to generate a new keypair.")},m(t,n){A(t,e,n)},d(t){t&&C(e)}}}function Dc(s){let e;return{c(){e=m("i"),e.innerHTML=`<strong>Special characters are not allowed.</strong> 
                    <br/>`},m(t,n){A(t,e,n)},d(t){t&&C(e)}}}function mc(s){let e;return{c(){e=m("i"),e.innerHTML="<strong>A valid alias must begin with a letter.</strong> It needs to be 4 characters long and can only contain letters and numbers."},m(t,n){A(t,e,n)},d(t){t&&C(e)}}}function gc(s){let e;return{c(){e=m("i"),e.innerHTML="A valid id <strong>needs to be 4 characters long</strong>."},m(t,n){A(t,e,n)},d(t){t&&C(e)}}}function Ms(s){let e,t,n;return{c(){e=m("blockquote"),e.innerHTML="<strong>Please upload a valid identity file</strong>"},m(r,i){A(r,e,i),n=!0},i(r){n||(rr(()=>{t||(t=Bt(e,It,{y:200,duration:2e3},!0)),t.run(1)}),n=!0)},o(r){t||(t=Bt(e,It,{y:200,duration:2e3},!1)),t.run(0),n=!1},d(r){r&&C(e),r&&t&&t.end()}}}function bc(s){let e,t,n,r,i,u,l,a,o,c,f,h,d,D,g,y,w,_,v,B,S,P,T,x,M,q,W,ue,ae,Ke,ve,Pe,ze,re,Fe,V=s[3].address.length!==0&&Os(s),he=s[6]&&$s(s),De=s[7]===!0&&Ms();return{c(){e=m("div"),V&&V.c(),t=F(),n=m("div"),n.textContent="Your identity is represented by the keypair seen below. It contains your address and secret.",r=F(),i=m("div"),u=m("div"),l=m("b"),l.textContent="Address:",a=F(),o=j(s[1]),c=F(),f=m("br"),h=F(),d=m("b"),d.textContent="Secret:",D=F(),g=j(s[8]),y=F(),w=m("div"),_=j(`You can

        `),v=m("button"),v.textContent="generate another identity",B=j(`

    or customize your alias in the box below.`),S=F(),P=m("div"),T=j(`Your alias is 
    `),x=m("input"),M=F(),q=m("div"),q.textContent="You can download it and reuse it later.",W=F(),ue=m("div"),ae=m("button"),ae.textContent="Download your identity file",Ke=F(),ve=m("div"),he&&he.c(),Pe=F(),De&&De.c(),b(i,"class","my-6"),b(v,"class","phase1 svelte-13r1n88"),b(x,"type","text"),b(x,"spellcheck","false"),b(x,"maxlength","4"),b(x,"class","svelte-13r1n88"),b(P,"class","my-4"),b(q,"class","mt-6"),b(ae,"class","phase1 svelte-13r1n88"),b(ue,"class","flex items-center align-center flex-col"),b(e,"class","id mt-8 svelte-13r1n88")},m(Re,ct){A(Re,e,ct),V&&V.m(e,null),p(e,t),p(e,n),p(e,r),p(e,i),p(i,u),p(u,l),p(u,a),p(u,o),p(u,c),p(u,f),p(u,h),p(u,d),p(u,D),p(u,g),p(e,y),p(e,w),p(w,_),p(w,v),p(w,B),p(e,S),p(e,P),p(P,T),p(P,x),rt(x,s[4]),p(e,M),p(e,q),p(e,W),p(e,ue),p(ue,ae),p(e,Ke),p(e,ve),he&&he.m(ve,null),p(ve,Pe),De&&De.m(ve,null),ze=!0,re||(Fe=[H(v,"click",s[10]),H(x,"input",s[11]),H(x,"keypress",s[12]),H(x,"focus",s[13]),H(x,"keypress",s[14]),H(ae,"click",s[15])],re=!0)},p(Re,[ct]){Re[3].address.length!==0?V?V.p(Re,ct):(V=Os(Re),V.c(),V.m(e,t)):V&&(V.d(1),V=null),(!ze||ct&2)&&ce(o,Re[1]),(!ze||ct&256)&&ce(g,Re[8]),ct&16&&x.value!==Re[4]&&rt(x,Re[4]),Re[6]?he?(he.p(Re,ct),ct&64&&E(he,1)):(he=$s(Re),he.c(),E(he,1),he.m(ve,Pe)):he&&(Q(),k(he,1,1,()=>{he=null}),K()),Re[7]===!0?De?ct&128&&E(De,1):(De=Ms(),De.c(),E(De,1),De.m(ve,null)):De&&(Q(),k(De,1,1,()=>{De=null}),K())},i(Re){ze||(E(he),E(De),ze=!0)},o(Re){k(he),k(De),ze=!1},d(Re){Re&&C(e),V&&V.d(),he&&he.d(),De&&De.d(),re=!1,ke(Fe)}}}function wc(s){return/[0-9]/.test(s)}function _c(s){return/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(s)}function yc(){let s="",e="abcdefghijklmnopqrstuvwxyz",t=e.length,n="abcdefghijklmnopqrstuvwxyz0123456789",r=n.length;s+=e.charAt(Math.floor(Math.random()*t));for(let i=0;i<3;i++)s+=n.charAt(Math.floor(Math.random()*r));return s}function Ac(s,e,t){let n,r,i,u;Te(s,ot,B=>t(3,u=B));let l,a,o=!1,c=!1;const f=new Un;function h(){let B=document.createElement("a"),S=new Blob([JSON.stringify(u)],{type:"text/plain"}),P=u.address+".json";B.href=URL.createObjectURL(S),B.download=P,B.style.display="none",document.body.appendChild(B),B.click()}async function d(B){B=="r"&&t(4,l=yc());let S=l.slice(0,1);if(wc(S))console.log("firstChar",S),t(5,a="ID must start with a letter");else if(l.length!==4)t(5,a="ID must be 4 characters long");else if(_c(l))t(5,a="ID must not contain special characters");else{let P=await Ae.generateAuthorKeypair(l),T=P.address,x=P.secret;ot.set({address:T,secret:x}),t(5,a=null),t(6,o=!1),f.author=P,Mn.set({settings:f})}}xt(()=>{u.address.length===0?d("r"):(t(1,n=u.address),t(8,r=u.secret))});const D=()=>d("r");function g(){l=this.value,t(4,l),t(2,i),t(1,n),t(3,u)}const y=()=>{t(6,o=!0)},w=()=>{t(6,o=!0)},_=()=>d(),v=()=>h();return s.$$.update=()=>{s.$$.dirty&8&&t(1,n=u.address),s.$$.dirty&8&&t(8,r=u.secret),s.$$.dirty&2&&t(2,i=n.slice(0,5)),s.$$.dirty&4&&t(4,l=i.slice(1,5))},[d,n,i,u,l,a,o,c,r,h,D,g,y,w,_,v]}class Cc extends te{constructor(e){super(),ne(this,e,Ac,bc,J,{generateID:0})}get generateID(){return this.$$.ctx[0]}}let Yu;$t.subscribe(s=>{Yu=s});const Ec=new Ko(Yu.replica),Xu=zn({cache:Ec}),Ju=zn(new Date,function(e){const t=setInterval(()=>{e(new Date)},1e3);return function(){clearInterval(t)}}),kc=new Date,vc=tc(Ju,s=>Math.round((Number(s)-Number(kc))/1e3));function js(s){let e,t,n,r,i,u,l,a=Math.trunc(s[2])+"",o,c,f=s[2]<=1?"minute":"minutes",h,d,D,g,y=Math.trunc((s[3]/1e3-(s[0]*1e3+s[4]))/6e4)+"",w,_,v,B,S,P;return{c(){e=m("div"),t=m("button"),t.textContent="Extend",n=F(),r=m("button"),r.textContent="Shorten",i=F(),u=m("p"),l=j("last interaction was "),o=j(a),c=F(),h=j(f),d=j(" ago"),D=F(),g=m("p"),w=j(y),_=j(" minutes left until deletion"),v=F(),B=m("button"),B.textContent="Delete",b(t,"class","svelte-mmxx8s"),b(r,"class","svelte-mmxx8s"),b(u,"class","svelte-mmxx8s"),b(g,"class","svelte-mmxx8s"),b(B,"class","svelte-mmxx8s"),b(e,"id","flexcontainer"),b(e,"class","svelte-mmxx8s")},m(T,x){A(T,e,x),p(e,t),p(e,n),p(e,r),p(e,i),p(e,u),p(u,l),p(u,o),p(u,c),p(u,h),p(u,d),p(e,D),p(e,g),p(g,w),p(g,_),p(e,v),p(e,B),S||(P=[H(t,"click",s[5]),H(r,"click",s[6]),H(B,"click",s[10])],S=!0)},p(T,x){x&4&&a!==(a=Math.trunc(T[2])+"")&&ce(o,a),x&4&&f!==(f=T[2]<=1?"minute":"minutes")&&ce(h,f),x&9&&y!==(y=Math.trunc((T[3]/1e3-(T[0]*1e3+T[4]))/6e4)+"")&&ce(w,y)},d(T){T&&C(e),S=!1,ke(P)}}}function Fc(s){let e,t=s[1]?"Ephemeral":"Ephemeral",n,r,i,u,l,a=s[1]&&js(s);return{c(){e=m("button"),n=j(t),r=F(),a&&a.c(),i=ie(),b(e,"class","svelte-mmxx8s")},m(o,c){A(o,e,c),p(e,n),A(o,r,c),a&&a.m(o,c),A(o,i,c),u||(l=H(e,"click",s[9]),u=!0)},p(o,[c]){c&2&&t!==(t=o[1]?"Ephemeral":"Ephemeral")&&ce(n,t),o[1]?a?a.p(o,c):(a=js(o),a.c(),a.m(i.parentNode,i)):a&&(a.d(1),a=null)},i:$,o:$,d(o){o&&C(e),o&&C(r),a&&a.d(o),o&&C(i),u=!1,l()}}}function Bc(s,e,t){let n,r,i;Te(s,vc,w=>t(0,n=w)),Te(s,ot,w=>t(11,r=w)),Te(s,$t,w=>t(12,i=w));const u=tt();let l=Date.now(),a=!1,o=0,{doc:c}=e,f=c.deleteAfter;async function h(){t(3,f+=36e8);let w=r.address.slice(1,5),_=c.path.split("!"),v=_[0].replace("/documents","/studio")+_[1];const B=await i.replica.set(r,{text:c.text+"<br> lifespan extended by "+w+" on "+new Date().toLocaleString(),path:c.path,deleteAfter:f}),S=await i.replica.set(r,{text:c.text+"<br> lifespan extended by "+w+" on "+new Date().toLocaleString(),path:v});console.log("studioPath",v),console.log("doc.path",c.path),console.log("result c",B),console.log("result s",S)}async function d(){let w=r.address.slice(1,5),_=c.path.split("!"),v=_[0].replace("/documents","/studio")+_[1];console.log("studioPath",v),t(3,f-=864e8);const B=await i.replica.set(r,{text:c.text+"<br> lifespan shortened by "+w+" on "+new Date().toLocaleString(),path:c.path,deleteAfter:f}),S=await i.replica.set(r,{text:c.text+"<br> lifespan shortened by "+w+" on "+new Date().toLocaleString(),path:v});console.log("result c",B),console.log("result s",S)}async function D(){u("update");let w=r.address.slice(1,5),_=c.path.split("!"),v=_[0].replace("/documents","/studio")+_[1];const B=await i.replica.set(r,{path:c.path,deleteAfter:(Date.now()+1e3)*1e3}),S=await i.replica.set(r,{text:c.text+"<br> deleted by "+w+" on "+new Date().toLocaleString(),path:v});console.log("studio 'delete'",S),console.log("result delete",B)}const g=()=>t(1,a=!a),y=()=>D();return s.$$set=w=>{"doc"in w&&t(8,c=w.doc)},s.$$.update=()=>{s.$$.dirty&257&&t(2,o=(n+l/1e3-c.timestamp/1e6)/60)},[n,a,o,f,l,h,d,D,c,g,y]}class Sc extends te{constructor(e){super(),ne(this,e,Bc,Fc,J,{doc:8})}}function Tc(){const s=console.warn;console.warn=e=>{e.includes("unknown prop")||e.includes("unexpected slot")||s(e)},xt(()=>{console.warn=s})}function Ns(s,e,t){const n=s.slice();return n[18]=e[t],n}function Ls(s,e,t){const n=s.slice();return n[18]=e[t],n}function Us(s,e,t){const n=s.slice();return n[10]=e[t],n}function zs(s,e,t){const n=s.slice();return n[13]=e[t],n[15]=t,n}function Hs(s,e,t){const n=s.slice();return n[16]=e[t],n[15]=t,n}function qs(s,e,t){const n=s.slice();return n[7]=e[t],n}function Ic(s){let e,t,n,r;const i=[Oc,Rc,xc],u=[];function l(a,o){return a[0]==="table"?0:a[0]==="list"?1:2}return e=l(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(a,o){u[e].m(a,o),A(a,n,o),r=!0},p(a,o){let c=e;e=l(a),e===c?u[e].p(a,o):(Q(),k(u[c],1,1,()=>{u[c]=null}),K(),t=u[e],t?t.p(a,o):(t=u[e]=i[e](a),t.c()),E(t,1),t.m(n.parentNode,n))},i(a){r||(E(t),r=!0)},o(a){k(t),r=!1},d(a){u[e].d(a),a&&C(n)}}}function Pc(s){let e,t,n=s[1],r=[];for(let u=0;u<n.length;u+=1)r[u]=Zs(qs(s,n,u));const i=u=>k(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=ie()},m(u,l){for(let a=0;a<r.length;a+=1)r[a].m(u,l);A(u,e,l),t=!0},p(u,l){if(l&34){n=u[1];let a;for(a=0;a<n.length;a+=1){const o=qs(u,n,a);r[a]?(r[a].p(o,l),E(r[a],1)):(r[a]=Zs(o),r[a].c(),E(r[a],1),r[a].m(e.parentNode,e))}for(Q(),a=n.length;a<r.length;a+=1)i(a);K()}},i(u){if(!t){for(let l=0;l<n.length;l+=1)E(r[l]);t=!0}},o(u){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)k(r[l]);t=!1},d(u){Yt(r,u),u&&C(e)}}}function xc(s){let e,t,n;const r=[s[6]];var i=s[5][s[0]];function u(l){let a={$$slots:{default:[jc]},$$scope:{ctx:l}};for(let o=0;o<r.length;o+=1)a=St(a,r[o]);return{props:a}}return i&&(e=pe(i,u(s))),{c(){e&&L(e.$$.fragment),t=ie()},m(l,a){e&&U(e,l,a),A(l,t,a),n=!0},p(l,a){const o=a&64?pn(r,[Dn(l[6])]):{};if(a&8388706&&(o.$$scope={dirty:a,ctx:l}),i!==(i=l[5][l[0]])){if(e){Q();const c=e;k(c.$$.fragment,1,0,()=>{z(c,1)}),K()}i?(e=pe(i,u(l)),L(e.$$.fragment),E(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else i&&e.$set(o)},i(l){n||(e&&E(e.$$.fragment,l),n=!0)},o(l){e&&k(e.$$.fragment,l),n=!1},d(l){l&&C(t),e&&z(e,l)}}}function Rc(s){let e,t,n,r;const i=[Lc,Nc],u=[];function l(a,o){return a[4]?0:1}return e=l(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(a,o){u[e].m(a,o),A(a,n,o),r=!0},p(a,o){let c=e;e=l(a),e===c?u[e].p(a,o):(Q(),k(u[c],1,1,()=>{u[c]=null}),K(),t=u[e],t?t.p(a,o):(t=u[e]=i[e](a),t.c()),E(t,1),t.m(n.parentNode,n))},i(a){r||(E(t),r=!0)},o(a){k(t),r=!1},d(a){u[e].d(a),a&&C(n)}}}function Oc(s){let e,t,n;var r=s[5].table;function i(u){return{props:{$$slots:{default:[Yc]},$$scope:{ctx:u}}}}return r&&(e=pe(r,i(s))),{c(){e&&L(e.$$.fragment),t=ie()},m(u,l){e&&U(e,u,l),A(u,t,l),n=!0},p(u,l){const a={};if(l&8388716&&(a.$$scope={dirty:l,ctx:u}),r!==(r=u[5].table)){if(e){Q();const o=e;k(o.$$.fragment,1,0,()=>{z(o,1)}),K()}r?(e=pe(r,i(u)),L(e.$$.fragment),E(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else r&&e.$set(a)},i(u){n||(e&&E(e.$$.fragment,u),n=!0)},o(u){e&&k(e.$$.fragment,u),n=!1},d(u){u&&C(t),e&&z(e,u)}}}function $c(s){let e=s[6].raw+"",t;return{c(){t=j(e)},m(n,r){A(n,t,r)},p(n,r){r&64&&e!==(e=n[6].raw+"")&&ce(t,e)},i:$,o:$,d(n){n&&C(t)}}}function Mc(s){let e,t;return e=new Jt({props:{tokens:s[1],renderers:s[5]}}),{c(){L(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,r){const i={};r&2&&(i.tokens=n[1]),r&32&&(i.renderers=n[5]),e.$set(i)},i(n){t||(E(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function jc(s){let e,t,n,r;const i=[Mc,$c],u=[];function l(a,o){return a[1]?0:1}return e=l(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(a,o){u[e].m(a,o),A(a,n,o),r=!0},p(a,o){let c=e;e=l(a),e===c?u[e].p(a,o):(Q(),k(u[c],1,1,()=>{u[c]=null}),K(),t=u[e],t?t.p(a,o):(t=u[e]=i[e](a),t.c()),E(t,1),t.m(n.parentNode,n))},i(a){r||(E(t),r=!0)},o(a){k(t),r=!1},d(a){u[e].d(a),a&&C(n)}}}function Nc(s){let e,t,n;const r=[{ordered:s[4]},s[6]];var i=s[5].list;function u(l){let a={$$slots:{default:[zc]},$$scope:{ctx:l}};for(let o=0;o<r.length;o+=1)a=St(a,r[o]);return{props:a}}return i&&(e=pe(i,u(s))),{c(){e&&L(e.$$.fragment),t=ie()},m(l,a){e&&U(e,l,a),A(l,t,a),n=!0},p(l,a){const o=a&80?pn(r,[a&16&&{ordered:l[4]},a&64&&Dn(l[6])]):{};if(a&8388704&&(o.$$scope={dirty:a,ctx:l}),i!==(i=l[5].list)){if(e){Q();const c=e;k(c.$$.fragment,1,0,()=>{z(c,1)}),K()}i?(e=pe(i,u(l)),L(e.$$.fragment),E(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else i&&e.$set(o)},i(l){n||(e&&E(e.$$.fragment,l),n=!0)},o(l){e&&k(e.$$.fragment,l),n=!1},d(l){l&&C(t),e&&z(e,l)}}}function Lc(s){let e,t,n;const r=[{ordered:s[4]},s[6]];var i=s[5].list;function u(l){let a={$$slots:{default:[qc]},$$scope:{ctx:l}};for(let o=0;o<r.length;o+=1)a=St(a,r[o]);return{props:a}}return i&&(e=pe(i,u(s))),{c(){e&&L(e.$$.fragment),t=ie()},m(l,a){e&&U(e,l,a),A(l,t,a),n=!0},p(l,a){const o=a&80?pn(r,[a&16&&{ordered:l[4]},a&64&&Dn(l[6])]):{};if(a&8388704&&(o.$$scope={dirty:a,ctx:l}),i!==(i=l[5].list)){if(e){Q();const c=e;k(c.$$.fragment,1,0,()=>{z(c,1)}),K()}i?(e=pe(i,u(l)),L(e.$$.fragment),E(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else i&&e.$set(o)},i(l){n||(e&&E(e.$$.fragment,l),n=!0)},o(l){e&&k(e.$$.fragment,l),n=!1},d(l){l&&C(t),e&&z(e,l)}}}function Uc(s){let e,t,n;return e=new Jt({props:{tokens:s[18].tokens,renderers:s[5]}}),{c(){L(e.$$.fragment),t=F()},m(r,i){U(e,r,i),A(r,t,i),n=!0},p(r,i){const u={};i&64&&(u.tokens=r[18].tokens),i&32&&(u.renderers=r[5]),e.$set(u)},i(r){n||(E(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){z(e,r),r&&C(t)}}}function Ws(s){let e,t,n;const r=[s[18]];var i=s[5].unorderedlistitem||s[5].listitem;function u(l){let a={$$slots:{default:[Uc]},$$scope:{ctx:l}};for(let o=0;o<r.length;o+=1)a=St(a,r[o]);return{props:a}}return i&&(e=pe(i,u(s))),{c(){e&&L(e.$$.fragment),t=ie()},m(l,a){e&&U(e,l,a),A(l,t,a),n=!0},p(l,a){const o=a&64?pn(r,[Dn(l[18])]):{};if(a&8388704&&(o.$$scope={dirty:a,ctx:l}),i!==(i=l[5].unorderedlistitem||l[5].listitem)){if(e){Q();const c=e;k(c.$$.fragment,1,0,()=>{z(c,1)}),K()}i?(e=pe(i,u(l)),L(e.$$.fragment),E(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else i&&e.$set(o)},i(l){n||(e&&E(e.$$.fragment,l),n=!0)},o(l){e&&k(e.$$.fragment,l),n=!1},d(l){l&&C(t),e&&z(e,l)}}}function zc(s){let e,t,n=s[6].items,r=[];for(let u=0;u<n.length;u+=1)r[u]=Ws(Ns(s,n,u));const i=u=>k(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=ie()},m(u,l){for(let a=0;a<r.length;a+=1)r[a].m(u,l);A(u,e,l),t=!0},p(u,l){if(l&96){n=u[6].items;let a;for(a=0;a<n.length;a+=1){const o=Ns(u,n,a);r[a]?(r[a].p(o,l),E(r[a],1)):(r[a]=Ws(o),r[a].c(),E(r[a],1),r[a].m(e.parentNode,e))}for(Q(),a=n.length;a<r.length;a+=1)i(a);K()}},i(u){if(!t){for(let l=0;l<n.length;l+=1)E(r[l]);t=!0}},o(u){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)k(r[l]);t=!1},d(u){Yt(r,u),u&&C(e)}}}function Hc(s){let e,t,n;return e=new Jt({props:{tokens:s[18].tokens,renderers:s[5]}}),{c(){L(e.$$.fragment),t=F()},m(r,i){U(e,r,i),A(r,t,i),n=!0},p(r,i){const u={};i&64&&(u.tokens=r[18].tokens),i&32&&(u.renderers=r[5]),e.$set(u)},i(r){n||(E(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){z(e,r),r&&C(t)}}}function Qs(s){let e,t,n;const r=[s[18]];var i=s[5].orderedlistitem||s[5].listitem;function u(l){let a={$$slots:{default:[Hc]},$$scope:{ctx:l}};for(let o=0;o<r.length;o+=1)a=St(a,r[o]);return{props:a}}return i&&(e=pe(i,u(s))),{c(){e&&L(e.$$.fragment),t=ie()},m(l,a){e&&U(e,l,a),A(l,t,a),n=!0},p(l,a){const o=a&64?pn(r,[Dn(l[18])]):{};if(a&8388704&&(o.$$scope={dirty:a,ctx:l}),i!==(i=l[5].orderedlistitem||l[5].listitem)){if(e){Q();const c=e;k(c.$$.fragment,1,0,()=>{z(c,1)}),K()}i?(e=pe(i,u(l)),L(e.$$.fragment),E(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else i&&e.$set(o)},i(l){n||(e&&E(e.$$.fragment,l),n=!0)},o(l){e&&k(e.$$.fragment,l),n=!1},d(l){l&&C(t),e&&z(e,l)}}}function qc(s){let e,t,n=s[6].items,r=[];for(let u=0;u<n.length;u+=1)r[u]=Qs(Ls(s,n,u));const i=u=>k(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=ie()},m(u,l){for(let a=0;a<r.length;a+=1)r[a].m(u,l);A(u,e,l),t=!0},p(u,l){if(l&96){n=u[6].items;let a;for(a=0;a<n.length;a+=1){const o=Ls(u,n,a);r[a]?(r[a].p(o,l),E(r[a],1)):(r[a]=Qs(o),r[a].c(),E(r[a],1),r[a].m(e.parentNode,e))}for(Q(),a=n.length;a<r.length;a+=1)i(a);K()}},i(u){if(!t){for(let l=0;l<n.length;l+=1)E(r[l]);t=!0}},o(u){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)k(r[l]);t=!1},d(u){Yt(r,u),u&&C(e)}}}function Wc(s){let e,t,n;return e=new Jt({props:{tokens:s[16].tokens,renderers:s[5]}}),{c(){L(e.$$.fragment),t=F()},m(r,i){U(e,r,i),A(r,t,i),n=!0},p(r,i){const u={};i&4&&(u.tokens=r[16].tokens),i&32&&(u.renderers=r[5]),e.$set(u)},i(r){n||(E(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){z(e,r),r&&C(t)}}}function Ks(s){let e,t,n;var r=s[5].tablecell;function i(u){return{props:{header:!0,align:u[6].align[u[15]]||"center",$$slots:{default:[Wc]},$$scope:{ctx:u}}}}return r&&(e=pe(r,i(s))),{c(){e&&L(e.$$.fragment),t=ie()},m(u,l){e&&U(e,u,l),A(u,t,l),n=!0},p(u,l){const a={};if(l&64&&(a.align=u[6].align[u[15]]||"center"),l&8388644&&(a.$$scope={dirty:l,ctx:u}),r!==(r=u[5].tablecell)){if(e){Q();const o=e;k(o.$$.fragment,1,0,()=>{z(o,1)}),K()}r?(e=pe(r,i(u)),L(e.$$.fragment),E(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else r&&e.$set(a)},i(u){n||(e&&E(e.$$.fragment,u),n=!0)},o(u){e&&k(e.$$.fragment,u),n=!1},d(u){u&&C(t),e&&z(e,u)}}}function Qc(s){let e,t,n=s[2],r=[];for(let u=0;u<n.length;u+=1)r[u]=Ks(Hs(s,n,u));const i=u=>k(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=ie()},m(u,l){for(let a=0;a<r.length;a+=1)r[a].m(u,l);A(u,e,l),t=!0},p(u,l){if(l&100){n=u[2];let a;for(a=0;a<n.length;a+=1){const o=Hs(u,n,a);r[a]?(r[a].p(o,l),E(r[a],1)):(r[a]=Ks(o),r[a].c(),E(r[a],1),r[a].m(e.parentNode,e))}for(Q(),a=n.length;a<r.length;a+=1)i(a);K()}},i(u){if(!t){for(let l=0;l<n.length;l+=1)E(r[l]);t=!0}},o(u){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)k(r[l]);t=!1},d(u){Yt(r,u),u&&C(e)}}}function Kc(s){let e,t,n;var r=s[5].tablerow;function i(u){return{props:{$$slots:{default:[Qc]},$$scope:{ctx:u}}}}return r&&(e=pe(r,i(s))),{c(){e&&L(e.$$.fragment),t=ie()},m(u,l){e&&U(e,u,l),A(u,t,l),n=!0},p(u,l){const a={};if(l&8388708&&(a.$$scope={dirty:l,ctx:u}),r!==(r=u[5].tablerow)){if(e){Q();const o=e;k(o.$$.fragment,1,0,()=>{z(o,1)}),K()}r?(e=pe(r,i(u)),L(e.$$.fragment),E(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else r&&e.$set(a)},i(u){n||(e&&E(e.$$.fragment,u),n=!0)},o(u){e&&k(e.$$.fragment,u),n=!1},d(u){u&&C(t),e&&z(e,u)}}}function Vc(s){let e,t;return e=new Jt({props:{tokens:s[13].tokens,renderers:s[5]}}),{c(){L(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,r){const i={};r&8&&(i.tokens=n[13].tokens),r&32&&(i.renderers=n[5]),e.$set(i)},i(n){t||(E(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function Vs(s){let e,t,n;var r=s[5].tablecell;function i(u){return{props:{header:!1,align:u[6].align[u[15]]||"center",$$slots:{default:[Vc]},$$scope:{ctx:u}}}}return r&&(e=pe(r,i(s))),{c(){e&&L(e.$$.fragment),t=ie()},m(u,l){e&&U(e,u,l),A(u,t,l),n=!0},p(u,l){const a={};if(l&64&&(a.align=u[6].align[u[15]]||"center"),l&8388648&&(a.$$scope={dirty:l,ctx:u}),r!==(r=u[5].tablecell)){if(e){Q();const o=e;k(o.$$.fragment,1,0,()=>{z(o,1)}),K()}r?(e=pe(r,i(u)),L(e.$$.fragment),E(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else r&&e.$set(a)},i(u){n||(e&&E(e.$$.fragment,u),n=!0)},o(u){e&&k(e.$$.fragment,u),n=!1},d(u){u&&C(t),e&&z(e,u)}}}function Gc(s){let e,t,n=s[10],r=[];for(let u=0;u<n.length;u+=1)r[u]=Vs(zs(s,n,u));const i=u=>k(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=F()},m(u,l){for(let a=0;a<r.length;a+=1)r[a].m(u,l);A(u,e,l),t=!0},p(u,l){if(l&104){n=u[10];let a;for(a=0;a<n.length;a+=1){const o=zs(u,n,a);r[a]?(r[a].p(o,l),E(r[a],1)):(r[a]=Vs(o),r[a].c(),E(r[a],1),r[a].m(e.parentNode,e))}for(Q(),a=n.length;a<r.length;a+=1)i(a);K()}},i(u){if(!t){for(let l=0;l<n.length;l+=1)E(r[l]);t=!0}},o(u){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)k(r[l]);t=!1},d(u){Yt(r,u),u&&C(e)}}}function Gs(s){let e,t,n;var r=s[5].tablerow;function i(u){return{props:{$$slots:{default:[Gc]},$$scope:{ctx:u}}}}return r&&(e=pe(r,i(s))),{c(){e&&L(e.$$.fragment),t=ie()},m(u,l){e&&U(e,u,l),A(u,t,l),n=!0},p(u,l){const a={};if(l&8388712&&(a.$$scope={dirty:l,ctx:u}),r!==(r=u[5].tablerow)){if(e){Q();const o=e;k(o.$$.fragment,1,0,()=>{z(o,1)}),K()}r?(e=pe(r,i(u)),L(e.$$.fragment),E(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else r&&e.$set(a)},i(u){n||(e&&E(e.$$.fragment,u),n=!0)},o(u){e&&k(e.$$.fragment,u),n=!1},d(u){u&&C(t),e&&z(e,u)}}}function Zc(s){let e,t,n=s[3],r=[];for(let u=0;u<n.length;u+=1)r[u]=Gs(Us(s,n,u));const i=u=>k(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=ie()},m(u,l){for(let a=0;a<r.length;a+=1)r[a].m(u,l);A(u,e,l),t=!0},p(u,l){if(l&104){n=u[3];let a;for(a=0;a<n.length;a+=1){const o=Us(u,n,a);r[a]?(r[a].p(o,l),E(r[a],1)):(r[a]=Gs(o),r[a].c(),E(r[a],1),r[a].m(e.parentNode,e))}for(Q(),a=n.length;a<r.length;a+=1)i(a);K()}},i(u){if(!t){for(let l=0;l<n.length;l+=1)E(r[l]);t=!0}},o(u){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)k(r[l]);t=!1},d(u){Yt(r,u),u&&C(e)}}}function Yc(s){let e,t,n,r,i;var u=s[5].tablehead;function l(c){return{props:{$$slots:{default:[Kc]},$$scope:{ctx:c}}}}u&&(e=pe(u,l(s)));var a=s[5].tablebody;function o(c){return{props:{$$slots:{default:[Zc]},$$scope:{ctx:c}}}}return a&&(n=pe(a,o(s))),{c(){e&&L(e.$$.fragment),t=F(),n&&L(n.$$.fragment),r=ie()},m(c,f){e&&U(e,c,f),A(c,t,f),n&&U(n,c,f),A(c,r,f),i=!0},p(c,f){const h={};if(f&8388708&&(h.$$scope={dirty:f,ctx:c}),u!==(u=c[5].tablehead)){if(e){Q();const D=e;k(D.$$.fragment,1,0,()=>{z(D,1)}),K()}u?(e=pe(u,l(c)),L(e.$$.fragment),E(e.$$.fragment,1),U(e,t.parentNode,t)):e=null}else u&&e.$set(h);const d={};if(f&8388712&&(d.$$scope={dirty:f,ctx:c}),a!==(a=c[5].tablebody)){if(n){Q();const D=n;k(D.$$.fragment,1,0,()=>{z(D,1)}),K()}a?(n=pe(a,o(c)),L(n.$$.fragment),E(n.$$.fragment,1),U(n,r.parentNode,r)):n=null}else a&&n.$set(d)},i(c){i||(e&&E(e.$$.fragment,c),n&&E(n.$$.fragment,c),i=!0)},o(c){e&&k(e.$$.fragment,c),n&&k(n.$$.fragment,c),i=!1},d(c){e&&z(e,c),c&&C(t),c&&C(r),n&&z(n,c)}}}function Zs(s){let e,t;const n=[s[7],{renderers:s[5]}];let r={};for(let i=0;i<n.length;i+=1)r=St(r,n[i]);return e=new Jt({props:r}),{c(){L(e.$$.fragment)},m(i,u){U(e,i,u),t=!0},p(i,u){const l=u&34?pn(n,[u&2&&Dn(i[7]),u&32&&{renderers:i[5]}]):{};e.$set(l)},i(i){t||(E(e.$$.fragment,i),t=!0)},o(i){k(e.$$.fragment,i),t=!1},d(i){z(e,i)}}}function Xc(s){let e,t,n,r;const i=[Pc,Ic],u=[];function l(a,o){return a[0]?a[5][a[0]]?1:-1:0}return~(e=l(s))&&(t=u[e]=i[e](s)),{c(){t&&t.c(),n=ie()},m(a,o){~e&&u[e].m(a,o),A(a,n,o),r=!0},p(a,[o]){let c=e;e=l(a),e===c?~e&&u[e].p(a,o):(t&&(Q(),k(u[c],1,1,()=>{u[c]=null}),K()),~e?(t=u[e],t?t.p(a,o):(t=u[e]=i[e](a),t.c()),E(t,1),t.m(n.parentNode,n)):t=null)},i(a){r||(E(t),r=!0)},o(a){k(t),r=!1},d(a){~e&&u[e].d(a),a&&C(n)}}}function Jc(s,e,t){const n=["type","tokens","header","rows","ordered","renderers"];let r=Zr(e,n),{type:i=void 0}=e,{tokens:u=void 0}=e,{header:l=void 0}=e,{rows:a=void 0}=e,{ordered:o=!1}=e,{renderers:c}=e;return Tc(),s.$$set=f=>{e=St(St({},e),ga(f)),t(6,r=Zr(e,n)),"type"in f&&t(0,i=f.type),"tokens"in f&&t(1,u=f.tokens),"header"in f&&t(2,l=f.header),"rows"in f&&t(3,a=f.rows),"ordered"in f&&t(4,o=f.ordered),"renderers"in f&&t(5,c=f.renderers)},[i,u,l,a,o,c,r]}let Jt=class extends te{constructor(e){super(),ne(this,e,Jc,Xc,J,{type:0,tokens:1,header:2,rows:3,ordered:4,renderers:5})}};function ea(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let en=ea();function ef(s){en=s}const ta=/[&<>"']/,tf=new RegExp(ta.source,"g"),na=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,nf=new RegExp(na.source,"g"),rf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ys=s=>rf[s];function Le(s,e){if(e){if(ta.test(s))return s.replace(tf,Ys)}else if(na.test(s))return s.replace(nf,Ys);return s}const sf=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function ra(s){return s.replace(sf,(e,t)=>(t=t.toLowerCase(),t==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}const uf=/(^|[^\[])\^/g;function fe(s,e){s=typeof s=="string"?s:s.source,e=e||"";const t={replace:(n,r)=>(r=r.source||r,r=r.replace(uf,"$1"),s=s.replace(n,r),t),getRegex:()=>new RegExp(s,e)};return t}const af=/[^\w:]/g,lf=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function Xs(s,e,t){if(s){let n;try{n=decodeURIComponent(ra(t)).replace(af,"").toLowerCase()}catch{return null}if(n.indexOf("javascript:")===0||n.indexOf("vbscript:")===0||n.indexOf("data:")===0)return null}e&&!lf.test(t)&&(t=hf(e,t));try{t=encodeURI(t).replace(/%25/g,"%")}catch{return null}return t}const Gn={},of=/^[^:]+:\/*[^/]*$/,cf=/^([^:]+:)[\s\S]*$/,ff=/^([^:]+:\/*[^/]*)[\s\S]*$/;function hf(s,e){Gn[" "+s]||(of.test(s)?Gn[" "+s]=s+"/":Gn[" "+s]=Zn(s,"/",!0)),s=Gn[" "+s];const t=s.indexOf(":")===-1;return e.substring(0,2)==="//"?t?e:s.replace(cf,"$1")+e:e.charAt(0)==="/"?t?e:s.replace(ff,"$1")+e:s+e}const tr={exec:function(){}};function Js(s,e){const t=s.replace(/\|/g,(i,u,l)=>{let a=!1,o=u;for(;--o>=0&&l[o]==="\\";)a=!a;return a?"|":" |"}),n=t.split(/ \|/);let r=0;if(n[0].trim()||n.shift(),n.length>0&&!n[n.length-1].trim()&&n.pop(),n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;r<n.length;r++)n[r]=n[r].trim().replace(/\\\|/g,"|");return n}function Zn(s,e,t){const n=s.length;if(n===0)return"";let r=0;for(;r<n;){const i=s.charAt(n-r-1);if(i===e&&!t)r++;else if(i!==e&&t)r++;else break}return s.slice(0,n-r)}function df(s,e){if(s.indexOf(e[1])===-1)return-1;const t=s.length;let n=0,r=0;for(;r<t;r++)if(s[r]==="\\")r++;else if(s[r]===e[0])n++;else if(s[r]===e[1]&&(n--,n<0))return r;return-1}function pf(s){s&&s.sanitize&&!s.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function ei(s,e){if(e<1)return"";let t="";for(;e>1;)e&1&&(t+=s),e>>=1,s+=s;return t+s}function ti(s,e,t,n){const r=e.href,i=e.title?Le(e.title):null,u=s[1].replace(/\\([\[\]])/g,"$1");if(s[0].charAt(0)!=="!"){n.state.inLink=!0;const l={type:"link",raw:t,href:r,title:i,text:u,tokens:n.inlineTokens(u)};return n.state.inLink=!1,l}return{type:"image",raw:t,href:r,title:i,text:Le(u)}}function Df(s,e){const t=s.match(/^(\s+)(?:```)/);if(t===null)return e;const n=t[1];return e.split(`
`).map(r=>{const i=r.match(/^\s+/);if(i===null)return r;const[u]=i;return u.length>=n.length?r.slice(n.length):r}).join(`
`)}class Qr{constructor(e){this.options=e||en}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const n=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Zn(n,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const n=t[0],r=Df(n,t[3]||"");return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline._escapes,"$1"):t[2],text:r}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(/#$/.test(n)){const r=Zn(n,"#");(this.options.pedantic||!r||/ $/.test(r))&&(n=r.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){const n=t[0].replace(/^ *>[ \t]?/gm,""),r=this.lexer.state.top;this.lexer.state.top=!0;const i=this.lexer.blockTokens(n);return this.lexer.state.top=r,{type:"blockquote",raw:t[0],tokens:i,text:n}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n,r,i,u,l,a,o,c,f,h,d,D,g=t[1].trim();const y=g.length>1,w={type:"list",raw:"",ordered:y,start:y?+g.slice(0,-1):"",loose:!1,items:[]};g=y?`\\d{1,9}\\${g.slice(-1)}`:`\\${g}`,this.options.pedantic&&(g=y?g:"[*+-]");const _=new RegExp(`^( {0,3}${g})((?:[	 ][^\\n]*)?(?:\\n|$))`);for(;e&&(D=!1,!(!(t=_.exec(e))||this.rules.block.hr.test(e)));){if(n=t[0],e=e.substring(n.length),c=t[2].split(`
`,1)[0].replace(/^\t+/,B=>" ".repeat(3*B.length)),f=e.split(`
`,1)[0],this.options.pedantic?(u=2,d=c.trimLeft()):(u=t[2].search(/[^ ]/),u=u>4?1:u,d=c.slice(u),u+=t[1].length),a=!1,!c&&/^ *$/.test(f)&&(n+=f+`
`,e=e.substring(f.length+1),D=!0),!D){const B=new RegExp(`^ {0,${Math.min(3,u-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),S=new RegExp(`^ {0,${Math.min(3,u-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),P=new RegExp(`^ {0,${Math.min(3,u-1)}}(?:\`\`\`|~~~)`),T=new RegExp(`^ {0,${Math.min(3,u-1)}}#`);for(;e&&(h=e.split(`
`,1)[0],f=h,this.options.pedantic&&(f=f.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(P.test(f)||T.test(f)||B.test(f)||S.test(e)));){if(f.search(/[^ ]/)>=u||!f.trim())d+=`
`+f.slice(u);else{if(a||c.search(/[^ ]/)>=4||P.test(c)||T.test(c)||S.test(c))break;d+=`
`+f}!a&&!f.trim()&&(a=!0),n+=h+`
`,e=e.substring(h.length+1),c=f.slice(u)}}w.loose||(o?w.loose=!0:/\n *\n *$/.test(n)&&(o=!0)),this.options.gfm&&(r=/^\[[ xX]\] /.exec(d),r&&(i=r[0]!=="[ ] ",d=d.replace(/^\[[ xX]\] +/,""))),w.items.push({type:"list_item",raw:n,task:!!r,checked:i,loose:!1,text:d}),w.raw+=n}w.items[w.items.length-1].raw=n.trimRight(),w.items[w.items.length-1].text=d.trimRight(),w.raw=w.raw.trimRight();const v=w.items.length;for(l=0;l<v;l++)if(this.lexer.state.top=!1,w.items[l].tokens=this.lexer.blockTokens(w.items[l].text,[]),!w.loose){const B=w.items[l].tokens.filter(P=>P.type==="space"),S=B.length>0&&B.some(P=>/\n.*\n/.test(P.raw));w.loose=S}if(w.loose)for(l=0;l<v;l++)w.items[l].loose=!0;return w}}html(e){const t=this.rules.block.html.exec(e);if(t){const n={type:"html",raw:t[0],pre:!this.options.sanitizer&&(t[1]==="pre"||t[1]==="script"||t[1]==="style"),text:t[0]};if(this.options.sanitize){const r=this.options.sanitizer?this.options.sanitizer(t[0]):Le(t[0]);n.type="paragraph",n.text=r,n.tokens=this.lexer.inline(r)}return n}}def(e){const t=this.rules.block.def.exec(e);if(t){const n=t[1].toLowerCase().replace(/\s+/g," "),r=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline._escapes,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:r,title:i}}}table(e){const t=this.rules.block.table.exec(e);if(t){const n={type:"table",header:Js(t[1]).map(r=>({text:r})),align:t[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(n.header.length===n.align.length){n.raw=t[0];let r=n.align.length,i,u,l,a;for(i=0;i<r;i++)/^ *-+: *$/.test(n.align[i])?n.align[i]="right":/^ *:-+: *$/.test(n.align[i])?n.align[i]="center":/^ *:-+ *$/.test(n.align[i])?n.align[i]="left":n.align[i]=null;for(r=n.rows.length,i=0;i<r;i++)n.rows[i]=Js(n.rows[i],n.header.length).map(o=>({text:o}));for(r=n.header.length,u=0;u<r;u++)n.header[u].tokens=this.lexer.inline(n.header[u].text);for(r=n.rows.length,u=0;u<r;u++)for(a=n.rows[u],l=0;l<a.length;l++)a[l].tokens=this.lexer.inline(a[l].text);return n}}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:Le(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(t[0]):Le(t[0]):t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const n=t[2].trim();if(!this.options.pedantic&&/^</.test(n)){if(!/>$/.test(n))return;const u=Zn(n.slice(0,-1),"\\");if((n.length-u.length)%2===0)return}else{const u=df(t[2],"()");if(u>-1){const a=(t[0].indexOf("!")===0?5:4)+t[1].length+u;t[2]=t[2].substring(0,u),t[0]=t[0].substring(0,a).trim(),t[3]=""}}let r=t[2],i="";if(this.options.pedantic){const u=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(r);u&&(r=u[1],i=u[3])}else i=t[3]?t[3].slice(1,-1):"";return r=r.trim(),/^</.test(r)&&(this.options.pedantic&&!/>$/.test(n)?r=r.slice(1):r=r.slice(1,-1)),ti(t,{href:r&&r.replace(this.rules.inline._escapes,"$1"),title:i&&i.replace(this.rules.inline._escapes,"$1")},t[0],this.lexer)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){let r=(n[2]||n[1]).replace(/\s+/g," ");if(r=t[r.toLowerCase()],!r){const i=n[0].charAt(0);return{type:"text",raw:i,text:i}}return ti(n,r,n[0],this.lexer)}}emStrong(e,t,n=""){let r=this.rules.inline.emStrong.lDelim.exec(e);if(!r||r[3]&&n.match(/[\p{L}\p{N}]/u))return;const i=r[1]||r[2]||"";if(!i||i&&(n===""||this.rules.inline.punctuation.exec(n))){const u=r[0].length-1;let l,a,o=u,c=0;const f=r[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(f.lastIndex=0,t=t.slice(-1*e.length+u);(r=f.exec(t))!=null;){if(l=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!l)continue;if(a=l.length,r[3]||r[4]){o+=a;continue}else if((r[5]||r[6])&&u%3&&!((u+a)%3)){c+=a;continue}if(o-=a,o>0)continue;a=Math.min(a,a+o+c);const h=e.slice(0,u+r.index+(r[0].length-l.length)+a);if(Math.min(u,a)%2){const D=h.slice(1,-1);return{type:"em",raw:h,text:D,tokens:this.lexer.inlineTokens(D)}}const d=h.slice(2,-2);return{type:"strong",raw:h,text:d,tokens:this.lexer.inlineTokens(d)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(/\n/g," ");const r=/[^ ]/.test(n),i=/^ /.test(n)&&/ $/.test(n);return r&&i&&(n=n.substring(1,n.length-1)),n=Le(n,!0),{type:"codespan",raw:t[0],text:n}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e,t){const n=this.rules.inline.autolink.exec(e);if(n){let r,i;return n[2]==="@"?(r=Le(this.options.mangle?t(n[1]):n[1]),i="mailto:"+r):(r=Le(n[1]),i=r),{type:"link",raw:n[0],text:r,href:i,tokens:[{type:"text",raw:r,text:r}]}}}url(e,t){let n;if(n=this.rules.inline.url.exec(e)){let r,i;if(n[2]==="@")r=Le(this.options.mangle?t(n[0]):n[0]),i="mailto:"+r;else{let u;do u=n[0],n[0]=this.rules.inline._backpedal.exec(n[0])[0];while(u!==n[0]);r=Le(n[0]),n[1]==="www."?i="http://"+n[0]:i=n[0]}return{type:"link",raw:n[0],text:r,href:i,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(e,t){const n=this.rules.inline.text.exec(e);if(n){let r;return this.lexer.state.inRawBlock?r=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(n[0]):Le(n[0]):n[0]:r=Le(this.options.smartypants?t(n[0]):n[0]),{type:"text",raw:n[0],text:r}}}}const G={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:tr,lheading:/^((?:.|\n(?!\n))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};G._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;G._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;G.def=fe(G.def).replace("label",G._label).replace("title",G._title).getRegex();G.bullet=/(?:[*+-]|\d{1,9}[.)])/;G.listItemStart=fe(/^( *)(bull) */).replace("bull",G.bullet).getRegex();G.list=fe(G.list).replace(/bull/g,G.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+G.def.source+")").getRegex();G._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";G._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;G.html=fe(G.html,"i").replace("comment",G._comment).replace("tag",G._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();G.paragraph=fe(G._paragraph).replace("hr",G.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",G._tag).getRegex();G.blockquote=fe(G.blockquote).replace("paragraph",G.paragraph).getRegex();G.normal={...G};G.gfm={...G.normal,table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"};G.gfm.table=fe(G.gfm.table).replace("hr",G.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",G._tag).getRegex();G.gfm.paragraph=fe(G._paragraph).replace("hr",G.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",G.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",G._tag).getRegex();G.pedantic={...G.normal,html:fe(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",G._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:tr,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:fe(G.normal._paragraph).replace("hr",G.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",G.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()};const N={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:tr,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^(?:[^_*\\]|\\.)*?\_\_(?:[^_*\\]|\\.)*?\*(?:[^_*\\]|\\.)*?(?=\_\_)|(?:[^*\\]|\\.)+(?=[^*])|[punct_](\*+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|(?:[^punct*_\s\\]|\\.)(\*+)(?=[^punct*_\s])/,rDelimUnd:/^(?:[^_*\\]|\\.)*?\*\*(?:[^_*\\]|\\.)*?\_(?:[^_*\\]|\\.)*?(?=\*\*)|(?:[^_\\]|\\.)+(?=[^_])|[punct*](\_+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:tr,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};N._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~";N.punctuation=fe(N.punctuation).replace(/punctuation/g,N._punctuation).getRegex();N.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;N.escapedEmSt=/(?:^|[^\\])(?:\\\\)*\\[*_]/g;N._comment=fe(G._comment).replace("(?:-->|$)","-->").getRegex();N.emStrong.lDelim=fe(N.emStrong.lDelim).replace(/punct/g,N._punctuation).getRegex();N.emStrong.rDelimAst=fe(N.emStrong.rDelimAst,"g").replace(/punct/g,N._punctuation).getRegex();N.emStrong.rDelimUnd=fe(N.emStrong.rDelimUnd,"g").replace(/punct/g,N._punctuation).getRegex();N._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;N._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;N._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;N.autolink=fe(N.autolink).replace("scheme",N._scheme).replace("email",N._email).getRegex();N._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;N.tag=fe(N.tag).replace("comment",N._comment).replace("attribute",N._attribute).getRegex();N._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;N._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;N._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;N.link=fe(N.link).replace("label",N._label).replace("href",N._href).replace("title",N._title).getRegex();N.reflink=fe(N.reflink).replace("label",N._label).replace("ref",G._label).getRegex();N.nolink=fe(N.nolink).replace("ref",G._label).getRegex();N.reflinkSearch=fe(N.reflinkSearch,"g").replace("reflink",N.reflink).replace("nolink",N.nolink).getRegex();N.normal={...N};N.pedantic={...N.normal,strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:fe(/^!?\[(label)\]\((.*?)\)/).replace("label",N._label).getRegex(),reflink:fe(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",N._label).getRegex()};N.gfm={...N.normal,escape:fe(N.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/};N.gfm.url=fe(N.gfm.url,"i").replace("email",N.gfm._extended_email).getRegex();N.breaks={...N.gfm,br:fe(N.br).replace("{2,}","*").getRegex(),text:fe(N.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()};function mf(s){return s.replace(/---/g,"").replace(/--/g,"").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1").replace(/'/g,"").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1").replace(/"/g,"").replace(/\.{3}/g,"")}function ni(s){let e="",t,n;const r=s.length;for(t=0;t<r;t++)n=s.charCodeAt(t),Math.random()>.5&&(n="x"+n.toString(16)),e+="&#"+n+";";return e}class Ct{constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||en,this.options.tokenizer=this.options.tokenizer||new Qr,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:G.normal,inline:N.normal};this.options.pedantic?(t.block=G.pedantic,t.inline=N.pedantic):this.options.gfm&&(t.block=G.gfm,this.options.breaks?t.inline=N.breaks:t.inline=N.gfm),this.tokenizer.rules=t}static get rules(){return{block:G,inline:N}}static lex(e,t){return new Ct(t).lex(e)}static lexInline(e,t){return new Ct(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);let t;for(;t=this.inlineQueue.shift();)this.inlineTokens(t.src,t.tokens);return this.tokens}blockTokens(e,t=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(l,a,o)=>a+"    ".repeat(o.length));let n,r,i,u;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(l=>(n=l.call({lexer:this},e,t))?(e=e.substring(n.raw.length),t.push(n),!0):!1))){if(n=this.tokenizer.space(e)){e=e.substring(n.raw.length),n.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(n);continue}if(n=this.tokenizer.code(e)){e=e.substring(n.raw.length),r=t[t.length-1],r&&(r.type==="paragraph"||r.type==="text")?(r.raw+=`
`+n.raw,r.text+=`
`+n.text,this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(n);continue}if(n=this.tokenizer.fences(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.heading(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.hr(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.blockquote(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.list(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.html(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.def(e)){e=e.substring(n.raw.length),r=t[t.length-1],r&&(r.type==="paragraph"||r.type==="text")?(r.raw+=`
`+n.raw,r.text+=`
`+n.raw,this.inlineQueue[this.inlineQueue.length-1].src=r.text):this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title});continue}if(n=this.tokenizer.table(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.lheading(e)){e=e.substring(n.raw.length),t.push(n);continue}if(i=e,this.options.extensions&&this.options.extensions.startBlock){let l=1/0;const a=e.slice(1);let o;this.options.extensions.startBlock.forEach(function(c){o=c.call({lexer:this},a),typeof o=="number"&&o>=0&&(l=Math.min(l,o))}),l<1/0&&l>=0&&(i=e.substring(0,l+1))}if(this.state.top&&(n=this.tokenizer.paragraph(i))){r=t[t.length-1],u&&r.type==="paragraph"?(r.raw+=`
`+n.raw,r.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(n),u=i.length!==e.length,e=e.substring(n.raw.length);continue}if(n=this.tokenizer.text(e)){e=e.substring(n.raw.length),r=t[t.length-1],r&&r.type==="text"?(r.raw+=`
`+n.raw,r.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(n);continue}if(e){const l="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(l);break}else throw new Error(l)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n,r,i,u=e,l,a,o;if(this.tokens.links){const c=Object.keys(this.tokens.links);if(c.length>0)for(;(l=this.tokenizer.rules.inline.reflinkSearch.exec(u))!=null;)c.includes(l[0].slice(l[0].lastIndexOf("[")+1,-1))&&(u=u.slice(0,l.index)+"["+ei("a",l[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(l=this.tokenizer.rules.inline.blockSkip.exec(u))!=null;)u=u.slice(0,l.index)+"["+ei("a",l[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(l=this.tokenizer.rules.inline.escapedEmSt.exec(u))!=null;)u=u.slice(0,l.index+l[0].length-2)+"++"+u.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex),this.tokenizer.rules.inline.escapedEmSt.lastIndex--;for(;e;)if(a||(o=""),a=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(c=>(n=c.call({lexer:this},e,t))?(e=e.substring(n.raw.length),t.push(n),!0):!1))){if(n=this.tokenizer.escape(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.tag(e)){e=e.substring(n.raw.length),r=t[t.length-1],r&&n.type==="text"&&r.type==="text"?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if(n=this.tokenizer.link(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(n.raw.length),r=t[t.length-1],r&&n.type==="text"&&r.type==="text"?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if(n=this.tokenizer.emStrong(e,u,o)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.codespan(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.br(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.del(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.autolink(e,ni)){e=e.substring(n.raw.length),t.push(n);continue}if(!this.state.inLink&&(n=this.tokenizer.url(e,ni))){e=e.substring(n.raw.length),t.push(n);continue}if(i=e,this.options.extensions&&this.options.extensions.startInline){let c=1/0;const f=e.slice(1);let h;this.options.extensions.startInline.forEach(function(d){h=d.call({lexer:this},f),typeof h=="number"&&h>=0&&(c=Math.min(c,h))}),c<1/0&&c>=0&&(i=e.substring(0,c+1))}if(n=this.tokenizer.inlineText(i,mf)){e=e.substring(n.raw.length),n.raw.slice(-1)!=="_"&&(o=n.raw.slice(-1)),a=!0,r=t[t.length-1],r&&r.type==="text"?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if(e){const c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return t}}class Kr{constructor(e){this.options=e||en}code(e,t,n){const r=(t||"").match(/\S*/)[0];if(this.options.highlight){const i=this.options.highlight(e,r);i!=null&&i!==e&&(n=!0,e=i)}return e=e.replace(/\n$/,"")+`
`,r?'<pre><code class="'+this.options.langPrefix+Le(r)+'">'+(n?e:Le(e,!0))+`</code></pre>
`:"<pre><code>"+(n?e:Le(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e){return e}heading(e,t,n,r){if(this.options.headerIds){const i=this.options.headerPrefix+r.slug(n);return`<h${t} id="${i}">${e}</h${t}>
`}return`<h${t}>${e}</h${t}>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(e,t,n){const r=t?"ol":"ul",i=t&&n!==1?' start="'+n+'"':"";return"<"+r+i+`>
`+e+"</"+r+`>
`}listitem(e){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(e){return`<p>${e}</p>
`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+t+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,t){const n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(e){return`<del>${e}</del>`}link(e,t,n){if(e=Xs(this.options.sanitize,this.options.baseUrl,e),e===null)return n;let r='<a href="'+e+'"';return t&&(r+=' title="'+t+'"'),r+=">"+n+"</a>",r}image(e,t,n){if(e=Xs(this.options.sanitize,this.options.baseUrl,e),e===null)return n;let r=`<img src="${e}" alt="${n}"`;return t&&(r+=` title="${t}"`),r+=this.options.xhtml?"/>":">",r}text(e){return e}}class sa{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,n){return""+n}image(e,t,n){return""+n}br(){return""}}class Vr{constructor(){this.seen={}}serialize(e){return e.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(e,t){let n=e,r=0;if(this.seen.hasOwnProperty(n)){r=this.seen[e];do r++,n=e+"-"+r;while(this.seen.hasOwnProperty(n))}return t||(this.seen[e]=r,this.seen[n]=0),n}slug(e,t={}){const n=this.serialize(e);return this.getNextSafeSlug(n,t.dryrun)}}class Pt{constructor(e){this.options=e||en,this.options.renderer=this.options.renderer||new Kr,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new sa,this.slugger=new Vr}static parse(e,t){return new Pt(t).parse(e)}static parseInline(e,t){return new Pt(t).parseInline(e)}parse(e,t=!0){let n="",r,i,u,l,a,o,c,f,h,d,D,g,y,w,_,v,B,S,P;const T=e.length;for(r=0;r<T;r++){if(d=e[r],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[d.type]&&(P=this.options.extensions.renderers[d.type].call({parser:this},d),P!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(d.type))){n+=P||"";continue}switch(d.type){case"space":continue;case"hr":{n+=this.renderer.hr();continue}case"heading":{n+=this.renderer.heading(this.parseInline(d.tokens),d.depth,ra(this.parseInline(d.tokens,this.textRenderer)),this.slugger);continue}case"code":{n+=this.renderer.code(d.text,d.lang,d.escaped);continue}case"table":{for(f="",c="",l=d.header.length,i=0;i<l;i++)c+=this.renderer.tablecell(this.parseInline(d.header[i].tokens),{header:!0,align:d.align[i]});for(f+=this.renderer.tablerow(c),h="",l=d.rows.length,i=0;i<l;i++){for(o=d.rows[i],c="",a=o.length,u=0;u<a;u++)c+=this.renderer.tablecell(this.parseInline(o[u].tokens),{header:!1,align:d.align[u]});h+=this.renderer.tablerow(c)}n+=this.renderer.table(f,h);continue}case"blockquote":{h=this.parse(d.tokens),n+=this.renderer.blockquote(h);continue}case"list":{for(D=d.ordered,g=d.start,y=d.loose,l=d.items.length,h="",i=0;i<l;i++)_=d.items[i],v=_.checked,B=_.task,w="",_.task&&(S=this.renderer.checkbox(v),y?_.tokens.length>0&&_.tokens[0].type==="paragraph"?(_.tokens[0].text=S+" "+_.tokens[0].text,_.tokens[0].tokens&&_.tokens[0].tokens.length>0&&_.tokens[0].tokens[0].type==="text"&&(_.tokens[0].tokens[0].text=S+" "+_.tokens[0].tokens[0].text)):_.tokens.unshift({type:"text",text:S}):w+=S),w+=this.parse(_.tokens,y),h+=this.renderer.listitem(w,B,v);n+=this.renderer.list(h,D,g);continue}case"html":{n+=this.renderer.html(d.text);continue}case"paragraph":{n+=this.renderer.paragraph(this.parseInline(d.tokens));continue}case"text":{for(h=d.tokens?this.parseInline(d.tokens):d.text;r+1<T&&e[r+1].type==="text";)d=e[++r],h+=`
`+(d.tokens?this.parseInline(d.tokens):d.text);n+=t?this.renderer.paragraph(h):h;continue}default:{const x='Token with "'+d.type+'" type was not found.';if(this.options.silent){console.error(x);return}else throw new Error(x)}}}return n}parseInline(e,t){t=t||this.renderer;let n="",r,i,u;const l=e.length;for(r=0;r<l;r++){if(i=e[r],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[i.type]&&(u=this.options.extensions.renderers[i.type].call({parser:this},i),u!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type))){n+=u||"";continue}switch(i.type){case"escape":{n+=t.text(i.text);break}case"html":{n+=t.html(i.text);break}case"link":{n+=t.link(i.href,i.title,this.parseInline(i.tokens,t));break}case"image":{n+=t.image(i.href,i.title,i.text);break}case"strong":{n+=t.strong(this.parseInline(i.tokens,t));break}case"em":{n+=t.em(this.parseInline(i.tokens,t));break}case"codespan":{n+=t.codespan(i.text);break}case"br":{n+=t.br();break}case"del":{n+=t.del(this.parseInline(i.tokens,t));break}case"text":{n+=t.text(i.text);break}default:{const a='Token with "'+i.type+'" type was not found.';if(this.options.silent){console.error(a);return}else throw new Error(a)}}}return n}}class nr{constructor(e){this.options=e||en}preprocess(e){return e}postprocess(e){return e}}Gr(nr,"passThroughHooks",new Set(["preprocess","postprocess"]));function gf(s,e,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,s){const r="<p>An error occurred:</p><pre>"+Le(n.message+"",!0)+"</pre>";if(e)return Promise.resolve(r);if(t){t(null,r);return}return r}if(e)return Promise.reject(n);if(t){t(n);return}throw n}}function ia(s,e){return(t,n,r)=>{typeof n=="function"&&(r=n,n=null);const i={...n};n={...Z.defaults,...i};const u=gf(n.silent,n.async,r);if(typeof t>"u"||t===null)return u(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return u(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(pf(n),n.hooks&&(n.hooks.options=n),r){const l=n.highlight;let a;try{n.hooks&&(t=n.hooks.preprocess(t)),a=s(t,n)}catch(f){return u(f)}const o=function(f){let h;if(!f)try{n.walkTokens&&Z.walkTokens(a,n.walkTokens),h=e(a,n),n.hooks&&(h=n.hooks.postprocess(h))}catch(d){f=d}return n.highlight=l,f?u(f):r(null,h)};if(!l||l.length<3||(delete n.highlight,!a.length))return o();let c=0;Z.walkTokens(a,function(f){f.type==="code"&&(c++,setTimeout(()=>{l(f.text,f.lang,function(h,d){if(h)return o(h);d!=null&&d!==f.text&&(f.text=d,f.escaped=!0),c--,c===0&&o()})},0))}),c===0&&o();return}if(n.async)return Promise.resolve(n.hooks?n.hooks.preprocess(t):t).then(l=>s(l,n)).then(l=>n.walkTokens?Promise.all(Z.walkTokens(l,n.walkTokens)).then(()=>l):l).then(l=>e(l,n)).then(l=>n.hooks?n.hooks.postprocess(l):l).catch(u);try{n.hooks&&(t=n.hooks.preprocess(t));const l=s(t,n);n.walkTokens&&Z.walkTokens(l,n.walkTokens);let a=e(l,n);return n.hooks&&(a=n.hooks.postprocess(a)),a}catch(l){return u(l)}}}function Z(s,e,t){return ia(Ct.lex,Pt.parse)(s,e,t)}Z.options=Z.setOptions=function(s){return Z.defaults={...Z.defaults,...s},ef(Z.defaults),Z};Z.getDefaults=ea;Z.defaults=en;Z.use=function(...s){const e=Z.defaults.extensions||{renderers:{},childTokens:{}};s.forEach(t=>{const n={...t};if(n.async=Z.defaults.async||n.async||!1,t.extensions&&(t.extensions.forEach(r=>{if(!r.name)throw new Error("extension name required");if(r.renderer){const i=e.renderers[r.name];i?e.renderers[r.name]=function(...u){let l=r.renderer.apply(this,u);return l===!1&&(l=i.apply(this,u)),l}:e.renderers[r.name]=r.renderer}if(r.tokenizer){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");e[r.level]?e[r.level].unshift(r.tokenizer):e[r.level]=[r.tokenizer],r.start&&(r.level==="block"?e.startBlock?e.startBlock.push(r.start):e.startBlock=[r.start]:r.level==="inline"&&(e.startInline?e.startInline.push(r.start):e.startInline=[r.start]))}r.childTokens&&(e.childTokens[r.name]=r.childTokens)}),n.extensions=e),t.renderer){const r=Z.defaults.renderer||new Kr;for(const i in t.renderer){const u=r[i];r[i]=(...l)=>{let a=t.renderer[i].apply(r,l);return a===!1&&(a=u.apply(r,l)),a}}n.renderer=r}if(t.tokenizer){const r=Z.defaults.tokenizer||new Qr;for(const i in t.tokenizer){const u=r[i];r[i]=(...l)=>{let a=t.tokenizer[i].apply(r,l);return a===!1&&(a=u.apply(r,l)),a}}n.tokenizer=r}if(t.hooks){const r=Z.defaults.hooks||new nr;for(const i in t.hooks){const u=r[i];nr.passThroughHooks.has(i)?r[i]=l=>{if(Z.defaults.async)return Promise.resolve(t.hooks[i].call(r,l)).then(o=>u.call(r,o));const a=t.hooks[i].call(r,l);return u.call(r,a)}:r[i]=(...l)=>{let a=t.hooks[i].apply(r,l);return a===!1&&(a=u.apply(r,l)),a}}n.hooks=r}if(t.walkTokens){const r=Z.defaults.walkTokens;n.walkTokens=function(i){let u=[];return u.push(t.walkTokens.call(this,i)),r&&(u=u.concat(r.call(this,i))),u}}Z.setOptions(n)})};Z.walkTokens=function(s,e){let t=[];for(const n of s)switch(t=t.concat(e.call(Z,n)),n.type){case"table":{for(const r of n.header)t=t.concat(Z.walkTokens(r.tokens,e));for(const r of n.rows)for(const i of r)t=t.concat(Z.walkTokens(i.tokens,e));break}case"list":{t=t.concat(Z.walkTokens(n.items,e));break}default:Z.defaults.extensions&&Z.defaults.extensions.childTokens&&Z.defaults.extensions.childTokens[n.type]?Z.defaults.extensions.childTokens[n.type].forEach(function(r){t=t.concat(Z.walkTokens(n[r],e))}):n.tokens&&(t=t.concat(Z.walkTokens(n.tokens,e)))}return t};Z.parseInline=ia(Ct.lexInline,Pt.parseInline);Z.Parser=Pt;Z.parser=Pt.parse;Z.Renderer=Kr;Z.TextRenderer=sa;Z.Lexer=Ct;Z.lexer=Ct.lex;Z.Tokenizer=Qr;Z.Slugger=Vr;Z.Hooks=nr;Z.parse=Z;Z.options;Z.setOptions;Z.use;Z.walkTokens;Z.parseInline;Pt.parse;Ct.lex;const ua={};function bf(s){let e;return{c(){e=j(s[1])},m(t,n){A(t,e,n)},p(t,n){n&2&&ce(e,t[1])},i:$,o:$,d(t){t&&C(e)}}}function wf(s){let e,t;const n=s[5].default,r=ge(n,s,s[4],null);return{c(){e=m("h6"),r&&r.c(),b(e,"id",s[2])},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&16)&&be(r,n,i,i[4],t?_e(n,i[4],u,null):we(i[4]),null),(!t||u&4)&&b(e,"id",i[2])},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function _f(s){let e,t;const n=s[5].default,r=ge(n,s,s[4],null);return{c(){e=m("h5"),r&&r.c(),b(e,"id",s[2])},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&16)&&be(r,n,i,i[4],t?_e(n,i[4],u,null):we(i[4]),null),(!t||u&4)&&b(e,"id",i[2])},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function yf(s){let e,t;const n=s[5].default,r=ge(n,s,s[4],null);return{c(){e=m("h4"),r&&r.c(),b(e,"id",s[2])},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&16)&&be(r,n,i,i[4],t?_e(n,i[4],u,null):we(i[4]),null),(!t||u&4)&&b(e,"id",i[2])},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function Af(s){let e,t;const n=s[5].default,r=ge(n,s,s[4],null);return{c(){e=m("h3"),r&&r.c(),b(e,"id",s[2])},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&16)&&be(r,n,i,i[4],t?_e(n,i[4],u,null):we(i[4]),null),(!t||u&4)&&b(e,"id",i[2])},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function Cf(s){let e,t;const n=s[5].default,r=ge(n,s,s[4],null);return{c(){e=m("h2"),r&&r.c(),b(e,"id",s[2])},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&16)&&be(r,n,i,i[4],t?_e(n,i[4],u,null):we(i[4]),null),(!t||u&4)&&b(e,"id",i[2])},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function Ef(s){let e,t;const n=s[5].default,r=ge(n,s,s[4],null);return{c(){e=m("h1"),r&&r.c(),b(e,"id",s[2])},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&16)&&be(r,n,i,i[4],t?_e(n,i[4],u,null):we(i[4]),null),(!t||u&4)&&b(e,"id",i[2])},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function kf(s){let e,t,n,r;const i=[Ef,Cf,Af,yf,_f,wf,bf],u=[];function l(a,o){return a[0]===1?0:a[0]===2?1:a[0]===3?2:a[0]===4?3:a[0]===5?4:a[0]===6?5:6}return e=l(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(a,o){u[e].m(a,o),A(a,n,o),r=!0},p(a,[o]){let c=e;e=l(a),e===c?u[e].p(a,o):(Q(),k(u[c],1,1,()=>{u[c]=null}),K(),t=u[e],t?t.p(a,o):(t=u[e]=i[e](a),t.c()),E(t,1),t.m(n.parentNode,n))},i(a){r||(E(t),r=!0)},o(a){k(t),r=!1},d(a){u[e].d(a),a&&C(n)}}}function vf(s,e,t){let n,{$$slots:r={},$$scope:i}=e,{depth:u}=e,{raw:l}=e,{text:a}=e;const{slug:o,getOptions:c}=ba(ua),f=c();return s.$$set=h=>{"depth"in h&&t(0,u=h.depth),"raw"in h&&t(1,l=h.raw),"text"in h&&t(3,a=h.text),"$$scope"in h&&t(4,i=h.$$scope)},s.$$.update=()=>{s.$$.dirty&8&&t(2,n=f.headerIds?f.headerPrefix+o(a):void 0)},[u,l,n,a,i,r]}class Ff extends te{constructor(e){super(),ne(this,e,vf,kf,J,{depth:0,raw:1,text:3})}}function Bf(s){let e,t;const n=s[1].default,r=ge(n,s,s[0],null);return{c(){e=m("p"),r&&r.c()},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&be(r,n,i,i[0],t?_e(n,i[0],u,null):we(i[0]),null)},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function Sf(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class Tf extends te{constructor(e){super(),ne(this,e,Sf,Bf,J,{})}}function If(s){let e;const t=s[3].default,n=ge(t,s,s[2],null);return{c(){n&&n.c()},m(r,i){n&&n.m(r,i),e=!0},p(r,[i]){n&&n.p&&(!e||i&4)&&be(n,t,r,r[2],e?_e(t,r[2],i,null):we(r[2]),null)},i(r){e||(E(n,r),e=!0)},o(r){k(n,r),e=!1},d(r){n&&n.d(r)}}}function Pf(s,e,t){let{$$slots:n={},$$scope:r}=e,{text:i}=e,{raw:u}=e;return s.$$set=l=>{"text"in l&&t(0,i=l.text),"raw"in l&&t(1,u=l.raw),"$$scope"in l&&t(2,r=l.$$scope)},[i,u,r,n]}class xf extends te{constructor(e){super(),ne(this,e,Pf,If,J,{text:0,raw:1})}}function Rf(s){let e,t;return{c(){e=m("img"),$e(e.src,t=s[0])||b(e,"src",t),b(e,"title",s[1]),b(e,"alt",s[2])},m(n,r){A(n,e,r)},p(n,[r]){r&1&&!$e(e.src,t=n[0])&&b(e,"src",t),r&2&&b(e,"title",n[1]),r&4&&b(e,"alt",n[2])},i:$,o:$,d(n){n&&C(e)}}}function Of(s,e,t){let{href:n=""}=e,{title:r=void 0}=e,{text:i=""}=e;return s.$$set=u=>{"href"in u&&t(0,n=u.href),"title"in u&&t(1,r=u.title),"text"in u&&t(2,i=u.text)},[n,r,i]}class $f extends te{constructor(e){super(),ne(this,e,Of,Rf,J,{href:0,title:1,text:2})}}function Mf(s){let e,t;const n=s[3].default,r=ge(n,s,s[2],null);return{c(){e=m("a"),r&&r.c(),b(e,"href",s[0]),b(e,"title",s[1])},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&4)&&be(r,n,i,i[2],t?_e(n,i[2],u,null):we(i[2]),null),(!t||u&1)&&b(e,"href",i[0]),(!t||u&2)&&b(e,"title",i[1])},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function jf(s,e,t){let{$$slots:n={},$$scope:r}=e,{href:i=""}=e,{title:u=void 0}=e;return s.$$set=l=>{"href"in l&&t(0,i=l.href),"title"in l&&t(1,u=l.title),"$$scope"in l&&t(2,r=l.$$scope)},[i,u,r,n]}class Nf extends te{constructor(e){super(),ne(this,e,jf,Mf,J,{href:0,title:1})}}function Lf(s){let e,t;const n=s[1].default,r=ge(n,s,s[0],null);return{c(){e=m("em"),r&&r.c()},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&be(r,n,i,i[0],t?_e(n,i[0],u,null):we(i[0]),null)},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function Uf(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class zf extends te{constructor(e){super(),ne(this,e,Uf,Lf,J,{})}}function Hf(s){let e,t;const n=s[1].default,r=ge(n,s,s[0],null);return{c(){e=m("del"),r&&r.c()},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&be(r,n,i,i[0],t?_e(n,i[0],u,null):we(i[0]),null)},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function qf(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class Wf extends te{constructor(e){super(),ne(this,e,qf,Hf,J,{})}}function Qf(s){let e,t=s[0].replace(/`/g,"")+"",n;return{c(){e=m("code"),n=j(t)},m(r,i){A(r,e,i),p(e,n)},p(r,[i]){i&1&&t!==(t=r[0].replace(/`/g,"")+"")&&ce(n,t)},i:$,o:$,d(r){r&&C(e)}}}function Kf(s,e,t){let{raw:n}=e;return s.$$set=r=>{"raw"in r&&t(0,n=r.raw)},[n]}class Vf extends te{constructor(e){super(),ne(this,e,Kf,Qf,J,{raw:0})}}function Gf(s){let e,t;const n=s[1].default,r=ge(n,s,s[0],null);return{c(){e=m("strong"),r&&r.c()},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&be(r,n,i,i[0],t?_e(n,i[0],u,null):we(i[0]),null)},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function Zf(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class Yf extends te{constructor(e){super(),ne(this,e,Zf,Gf,J,{})}}function Xf(s){let e,t;const n=s[1].default,r=ge(n,s,s[0],null);return{c(){e=m("table"),r&&r.c()},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&be(r,n,i,i[0],t?_e(n,i[0],u,null):we(i[0]),null)},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function Jf(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class eh extends te{constructor(e){super(),ne(this,e,Jf,Xf,J,{})}}function th(s){let e,t;const n=s[1].default,r=ge(n,s,s[0],null);return{c(){e=m("thead"),r&&r.c()},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&be(r,n,i,i[0],t?_e(n,i[0],u,null):we(i[0]),null)},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function nh(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class rh extends te{constructor(e){super(),ne(this,e,nh,th,J,{})}}function sh(s){let e,t;const n=s[1].default,r=ge(n,s,s[0],null);return{c(){e=m("tbody"),r&&r.c()},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&be(r,n,i,i[0],t?_e(n,i[0],u,null):we(i[0]),null)},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function ih(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class uh extends te{constructor(e){super(),ne(this,e,ih,sh,J,{})}}function ah(s){let e,t;const n=s[1].default,r=ge(n,s,s[0],null);return{c(){e=m("tr"),r&&r.c()},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&be(r,n,i,i[0],t?_e(n,i[0],u,null):we(i[0]),null)},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function lh(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class oh extends te{constructor(e){super(),ne(this,e,lh,ah,J,{})}}function ch(s){let e,t;const n=s[3].default,r=ge(n,s,s[2],null);return{c(){e=m("td"),r&&r.c(),b(e,"align",s[1])},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&4)&&be(r,n,i,i[2],t?_e(n,i[2],u,null):we(i[2]),null),(!t||u&2)&&b(e,"align",i[1])},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function fh(s){let e,t;const n=s[3].default,r=ge(n,s,s[2],null);return{c(){e=m("th"),r&&r.c(),b(e,"align",s[1])},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&4)&&be(r,n,i,i[2],t?_e(n,i[2],u,null):we(i[2]),null),(!t||u&2)&&b(e,"align",i[1])},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function hh(s){let e,t,n,r;const i=[fh,ch],u=[];function l(a,o){return a[0]?0:1}return e=l(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(a,o){u[e].m(a,o),A(a,n,o),r=!0},p(a,[o]){let c=e;e=l(a),e===c?u[e].p(a,o):(Q(),k(u[c],1,1,()=>{u[c]=null}),K(),t=u[e],t?t.p(a,o):(t=u[e]=i[e](a),t.c()),E(t,1),t.m(n.parentNode,n))},i(a){r||(E(t),r=!0)},o(a){k(t),r=!1},d(a){u[e].d(a),a&&C(n)}}}function dh(s,e,t){let{$$slots:n={},$$scope:r}=e,{header:i}=e,{align:u}=e;return s.$$set=l=>{"header"in l&&t(0,i=l.header),"align"in l&&t(1,u=l.align),"$$scope"in l&&t(2,r=l.$$scope)},[i,u,r,n]}class ph extends te{constructor(e){super(),ne(this,e,dh,hh,J,{header:0,align:1})}}function Dh(s){let e,t;const n=s[3].default,r=ge(n,s,s[2],null);return{c(){e=m("ul"),r&&r.c()},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&4)&&be(r,n,i,i[2],t?_e(n,i[2],u,null):we(i[2]),null)},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function mh(s){let e,t;const n=s[3].default,r=ge(n,s,s[2],null);return{c(){e=m("ol"),r&&r.c(),b(e,"start",s[1])},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&4)&&be(r,n,i,i[2],t?_e(n,i[2],u,null):we(i[2]),null),(!t||u&2)&&b(e,"start",i[1])},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function gh(s){let e,t,n,r;const i=[mh,Dh],u=[];function l(a,o){return a[0]?0:1}return e=l(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(a,o){u[e].m(a,o),A(a,n,o),r=!0},p(a,[o]){let c=e;e=l(a),e===c?u[e].p(a,o):(Q(),k(u[c],1,1,()=>{u[c]=null}),K(),t=u[e],t?t.p(a,o):(t=u[e]=i[e](a),t.c()),E(t,1),t.m(n.parentNode,n))},i(a){r||(E(t),r=!0)},o(a){k(t),r=!1},d(a){u[e].d(a),a&&C(n)}}}function bh(s,e,t){let{$$slots:n={},$$scope:r}=e,{ordered:i}=e,{start:u}=e;return s.$$set=l=>{"ordered"in l&&t(0,i=l.ordered),"start"in l&&t(1,u=l.start),"$$scope"in l&&t(2,r=l.$$scope)},[i,u,r,n]}class wh extends te{constructor(e){super(),ne(this,e,bh,gh,J,{ordered:0,start:1})}}function _h(s){let e,t;const n=s[1].default,r=ge(n,s,s[0],null);return{c(){e=m("li"),r&&r.c()},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&be(r,n,i,i[0],t?_e(n,i[0],u,null):we(i[0]),null)},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function yh(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class Ah extends te{constructor(e){super(),ne(this,e,yh,_h,J,{})}}function Ch(s){let e;return{c(){e=m("hr")},m(t,n){A(t,e,n)},p:$,i:$,o:$,d(t){t&&C(e)}}}class Eh extends te{constructor(e){super(),ne(this,e,null,Ch,J,{})}}function kh(s){let e,t;return{c(){e=new tu(!1),t=ie(),e.a=t},m(n,r){e.m(s[0],n,r),A(n,t,r)},p(n,[r]){r&1&&e.p(n[0])},i:$,o:$,d(n){n&&C(t),n&&e.d()}}}function vh(s,e,t){let{text:n}=e;return s.$$set=r=>{"text"in r&&t(0,n=r.text)},[n]}class Fh extends te{constructor(e){super(),ne(this,e,vh,kh,J,{text:0})}}function Bh(s){let e,t;const n=s[1].default,r=ge(n,s,s[0],null);return{c(){e=m("blockquote"),r&&r.c()},m(i,u){A(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&be(r,n,i,i[0],t?_e(n,i[0],u,null):we(i[0]),null)},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function Sh(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class Th extends te{constructor(e){super(),ne(this,e,Sh,Bh,J,{})}}function Ih(s){let e,t,n;return{c(){e=m("pre"),t=m("code"),n=j(s[1]),b(e,"class",s[0])},m(r,i){A(r,e,i),p(e,t),p(t,n)},p(r,[i]){i&2&&ce(n,r[1]),i&1&&b(e,"class",r[0])},i:$,o:$,d(r){r&&C(e)}}}function Ph(s,e,t){let{lang:n}=e,{text:r}=e;return s.$$set=i=>{"lang"in i&&t(0,n=i.lang),"text"in i&&t(1,r=i.text)},[n,r]}class xh extends te{constructor(e){super(),ne(this,e,Ph,Ih,J,{lang:0,text:1})}}function Rh(s){let e,t;const n=s[1].default,r=ge(n,s,s[0],null);return{c(){e=m("br"),r&&r.c()},m(i,u){A(i,e,u),r&&r.m(i,u),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&be(r,n,i,i[0],t?_e(n,i[0],u,null):we(i[0]),null)},i(i){t||(E(r,i),t=!0)},o(i){k(r,i),t=!1},d(i){i&&C(e),r&&r.d(i)}}}function Oh(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class $h extends te{constructor(e){super(),ne(this,e,Oh,Rh,J,{})}}const Mh={heading:Ff,paragraph:Tf,text:xf,image:$f,link:Nf,em:zf,strong:Yf,codespan:Vf,del:Wf,table:eh,tablehead:rh,tablebody:uh,tablerow:oh,tablecell:ph,list:wh,orderedlistitem:null,unorderedlistitem:null,listitem:Ah,hr:Eh,html:Fh,blockquote:Th,code:xh,br:$h},jh={baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,xhtml:!1};function Nh(s){let e,t;return e=new Jt({props:{tokens:s[0],renderers:s[1]}}),{c(){L(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,[r]){const i={};r&1&&(i.tokens=n[0]),r&2&&(i.renderers=n[1]),e.$set(i)},i(n){t||(E(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function Lh(s,e,t){let n,r,i,u,{source:l=[]}=e,{renderers:a={}}=e,{options:o={}}=e,{isInline:c=!1}=e;const f=tt();let h,d,D;return wa(ua,{slug:g=>r?r.slug(g):"",getOptions:()=>i}),xt(()=>{t(7,D=!0)}),s.$$set=g=>{"source"in g&&t(2,l=g.source),"renderers"in g&&t(3,a=g.renderers),"options"in g&&t(4,o=g.options),"isInline"in g&&t(5,c=g.isInline)},s.$$.update=()=>{s.$$.dirty&4&&t(8,n=Array.isArray(l)),s.$$.dirty&4&&(r=l?new Vr:void 0),s.$$.dirty&16&&t(9,i={...jh,...o}),s.$$.dirty&869&&(n?t(0,h=l):(t(6,d=new Ct(i)),t(0,h=c?d.inlineTokens(l):d.lex(l)),f("parsed",{tokens:h}))),s.$$.dirty&8&&t(1,u={...Mh,...a}),s.$$.dirty&385&&D&&!n&&f("parsed",{tokens:h})},[h,u,l,a,o,c,d,D,n,i]}class Uh extends te{constructor(e){super(),ne(this,e,Lh,Nh,J,{source:2,renderers:3,options:4,isInline:5})}}function zh(s){let e,t,n,r={ctx:s,current:null,token:null,hasCatch:!1,pending:rd,then:qh,catch:Hh,value:13,blocks:[,,,]};return Yr(t=s[2],r),{c(){e=ie(),r.block.c()},m(i,u){A(i,e,u),r.block.m(i,r.anchor=u),r.mount=()=>e.parentNode,r.anchor=e,n=!0},p(i,u){s=i,r.ctx=s,u&4&&t!==(t=s[2])&&Yr(t,r)||_a(r,s,u)},i(i){n||(E(r.block),n=!0)},o(i){for(let u=0;u<3;u+=1){const l=r.blocks[u];k(l)}n=!1},d(i){i&&C(e),r.block.d(i),r.token=null,r=null}}}function Hh(s){return{c:$,m:$,p:$,i:$,o:$,d:$}}function qh(s){let e,t,n,r;const i=[Qh,Wh],u=[];function l(a,o){return a[4]?1:0}return e=l(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(a,o){u[e].m(a,o),A(a,n,o),r=!0},p(a,o){let c=e;e=l(a),e===c?u[e].p(a,o):(Q(),k(u[c],1,1,()=>{u[c]=null}),K(),t=u[e],t?t.p(a,o):(t=u[e]=i[e](a),t.c()),E(t,1),t.m(n.parentNode,n))},i(a){r||(E(t),r=!0)},o(a){k(t),r=!1},d(a){u[e].d(a),a&&C(n)}}}function Wh(s){let e,t,n;return{c(){e=m("img"),b(e,"class","dnone svelte-16wmj4w"),$e(e.src,t=s[13])||b(e,"src",t),b(e,"alt",n=s[0].text)},m(r,i){A(r,e,i)},p(r,i){i&4&&!$e(e.src,t=r[13])&&b(e,"src",t),i&1&&n!==(n=r[0].text)&&b(e,"alt",n)},i:$,o:$,d(r){r&&C(e)}}}function Qh(s){let e,t,n,r,i,u;const l=[Xh,Yh,Zh,Gh,Vh,Kh],a=[];function o(f,h){return f[5]=="image"?0:f[5]=="text"?1:f[5]=="audio"?2:f[5]=="markdown"?3:f[5]=="pdf"?4:5}n=o(s),r=a[n]=l[n](s);let c=s[1]!==void 0&&ri(s);return{c(){e=m("div"),t=m("div"),r.c(),i=F(),c&&c.c(),b(t,"class","my-12 w-full"),b(e,"class","flex flex-col justify-between h-full")},m(f,h){A(f,e,h),p(e,t),a[n].m(t,null),p(e,i),c&&c.m(e,null),u=!0},p(f,h){let d=n;n=o(f),n===d?a[n].p(f,h):(Q(),k(a[d],1,1,()=>{a[d]=null}),K(),r=a[n],r?r.p(f,h):(r=a[n]=l[n](f),r.c()),E(r,1),r.m(t,null)),f[1]!==void 0?c?c.p(f,h):(c=ri(f),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i(f){u||(E(r),u=!0)},o(f){k(r),u=!1},d(f){f&&C(e),a[n].d(),c&&c.d()}}}function Kh(s){let e;return{c(){e=m("p"),e.textContent="Attachment type not supported"},m(t,n){A(t,e,n)},p:$,i:$,o:$,d(t){t&&C(e)}}}function Vh(s){let e;return{c(){e=m("p"),e.textContent="Pdf preview to come"},m(t,n){A(t,e,n)},p:$,i:$,o:$,d(t){t&&C(e)}}}function Gh(s){let e,t,n;return t=new Uh({props:{source:s[13]}}),{c(){e=m("div"),L(t.$$.fragment),b(e,"class","markdown svelte-16wmj4w")},m(r,i){A(r,e,i),U(t,e,null),n=!0},p(r,i){const u={};i&4&&(u.source=r[13]),t.$set(u)},i(r){n||(E(t.$$.fragment,r),n=!0)},o(r){k(t.$$.fragment,r),n=!1},d(r){r&&C(e),z(t)}}}function Zh(s){let e,t;return{c(){e=m("audio"),b(e,"class","w-full svelte-16wmj4w"),$e(e.src,t=s[13])||b(e,"src",t),e.controls=!0},m(n,r){A(n,e,r)},p(n,r){r&4&&!$e(e.src,t=n[13])&&b(e,"src",t)},i:$,o:$,d(n){n&&C(e)}}}function Yh(s){let e,t=s[13]+"";return{c(){e=m("p"),b(e,"class","my-6 textbox svelte-16wmj4w")},m(n,r){A(n,e,r),e.innerHTML=t},p(n,r){r&4&&t!==(t=n[13]+"")&&(e.innerHTML=t)},i:$,o:$,d(n){n&&C(e)}}}function Xh(s){let e,t,n;return{c(){e=m("img"),$e(e.src,t=s[13])||b(e,"src",t),b(e,"alt",n=s[0].text),b(e,"class","svelte-16wmj4w")},m(r,i){A(r,e,i)},p(r,i){i&4&&!$e(e.src,t=r[13])&&b(e,"src",t),i&1&&n!==(n=r[0].text)&&b(e,"alt",n)},i:$,o:$,d(r){r&&C(e)}}}function ri(s){let e,t,n,r,i,u,l;function a(f,h){return f[3]?Jh:ed}let o=a(s),c=o(s);return{c(){e=m("div"),t=m("p"),c.c(),n=F(),r=m("p"),i=m("button"),i.textContent="Download attachment",b(t,"class","mx-4"),b(i,"class","svelte-16wmj4w"),b(r,"class","mx-4"),b(e,"class","flex flex-row mb-4")},m(f,h){A(f,e,h),p(e,t),c.m(t,null),p(e,n),p(e,r),p(r,i),u||(l=H(i,"click",s[9]),u=!0)},p(f,h){o===(o=a(f))&&c?c.p(f,h):(c.d(1),c=o(f),c&&(c.c(),c.m(t,null)))},d(f){f&&C(e),c.d(),u=!1,l()}}}function Jh(s){let e,t,n;function r(l,a){return l[4]?td:nd}let i=r(s),u=i(s);return{c(){e=m("button"),u.c(),b(e,"class","svelte-16wmj4w")},m(l,a){A(l,e,a),u.m(e,null),t||(n=H(e,"click",s[8]),t=!0)},p(l,a){i!==(i=r(l))&&(u.d(1),u=i(l),u&&(u.c(),u.m(e,null)))},d(l){l&&C(e),u.d(),t=!1,n()}}}function ed(s){let e,t,n;return{c(){e=m("button"),e.textContent="Get attachment",b(e,"class","svelte-16wmj4w")},m(r,i){A(r,e,i),t||(n=H(e,"click",function(){eu(s[6](s[0]))&&s[6](s[0]).apply(this,arguments)}),t=!0)},p(r,i){s=r},d(r){r&&C(e),t=!1,n()}}}function td(s){let e;return{c(){e=j("Show attachment")},m(t,n){A(t,e,n)},d(t){t&&C(e)}}}function nd(s){let e;return{c(){e=j("Hide attachment")},m(t,n){A(t,e,n)},d(t){t&&C(e)}}}function rd(s){let e;return{c(){e=j("Loading attachment...")},m(t,n){A(t,e,n)},p:$,i:$,o:$,d(t){t&&C(e)}}}function sd(s){let e,t,n=zh(s);return{c(){n&&n.c(),e=ie()},m(r,i){n&&n.m(r,i),A(r,e,i),t=!0},p(r,[i]){n.p(r,i)},i(r){t||(E(n),t=!0)},o(r){k(n),t=!1},d(r){n&&n.d(r),r&&C(e)}}}function id(s,e,t){let n;Te(s,$t,y=>t(11,n=y));let{doc:r}=e,i,u,l=!1,a=!0,o,c;async function f(y){const w=await n.replica.getAttachment(y);let _=y.path.split(".").pop();if(w!==void 0){const S=await w.bytes();console.log("docdata",S);let P=new Uint8Array(S.length);for(var v=0;v<S.length;v++)P[v]=S[v];if(_==="md")t(5,o="markdown"),t(5,o),t(1,i=String.fromCharCode(...P));else if(_=="mp3"||_=="ogg"||_=="webm")t(5,o="audio"),c="audio/"+_,t(5,o),c=c,console.log("this is audio"),console.log(o,c),t(1,i=URL.createObjectURL(new Blob([P],{type:c})));else if(_==="txt"){t(5,o="text"),t(5,o),console.log(o);var B=new TextDecoder("utf-8");t(1,i=B.decode(Uint8Array.from(P)))}else _=="png"||_=="gif"||_=="jpeg"?(t(5,o="image"),console.log("this is an image"),console.log("fileExtension "+_),c="image/"+_,t(5,o),c=c,t(1,i=URL.createObjectURL(new Blob([P],{type:c})))):(t(5,o="other"),t(5,o),console.log(o),t(1,i=URL.createObjectURL(new Blob([P],{type:"application/octet-stream"}))));return i}}function h(y){t(2,u=f(y)),t(3,l=!0),t(4,a=!1)}function d(){let y=document.createElement("a");console.log(i+"attachmentBytes"),i.split(":")[0]!=="blob"&&(console.log("attachmentBytes is a string"),t(1,i=URL.createObjectURL(new Blob([i]))),console.log("attachmentBytes is now a blob")),console.log("type of attachmentBytes ",typeof i);let w=i,_=r.path.split("/")[r.path.split("/").length-1];console.log("type of file",typeof w),y.href=w,y.download=_.slice(1),y.style.display="none",document.body.appendChild(y),y.click()}xt(()=>{t(2,u=f(r)),t(3,l=!0),t(4,a=!1)});const D=()=>t(4,a=!a),g=()=>d();return s.$$set=y=>{"doc"in y&&t(0,r=y.doc)},[r,i,u,l,a,o,h,d,D,g]}class aa extends te{constructor(e){super(),ne(this,e,id,sd,J,{doc:0})}}function si(s,e,t){const n=s.slice();return n[8]=e[t],n}function ii(s){let e,t,n,r=s[1]&&ui(s);function i(o,c){return o[3]!==void 0?ad:ud}let u=i(s),l=u(s),a=(s[2]||!s[1])&&oi(s);return{c(){e=m("div"),r&&r.c(),t=F(),l.c(),n=F(),a&&a.c(),b(e,"class","svelte-fqd2l")},m(o,c){A(o,e,c),r&&r.m(e,null),p(e,t),l.m(e,null),p(e,n),a&&a.m(e,null)},p(o,c){o[1]?r?r.p(o,c):(r=ui(o),r.c(),r.m(e,t)):r&&(r.d(1),r=null),u===(u=i(o))&&l?l.p(o,c):(l.d(1),l=u(o),l&&(l.c(),l.m(e,n))),o[2]||!o[1]?a?a.p(o,c):(a=oi(o),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},d(o){o&&C(e),r&&r.d(),l.d(),a&&a.d()}}}function ui(s){let e,t,n,r,i,u,l=s[0].path.split(".")[s[0].path.split(".").length-1]+"",a,o,c,f,h,d,D=s[0].attachmentSize/1e3+"",g,y;return{c(){e=m("table"),t=m("tr"),n=m("td"),n.textContent="Attachment type:",r=F(),i=m("td"),u=m("strong"),a=j(l),o=F(),c=m("tr"),f=m("td"),f.textContent="Attachment size:",h=F(),d=m("td"),g=j(D),y=j(" kb"),b(e,"class","my-4 svelte-fqd2l")},m(w,_){A(w,e,_),p(e,t),p(t,n),p(t,r),p(t,i),p(i,u),p(u,a),p(t,o),p(e,c),p(c,f),p(c,h),p(c,d),p(d,g),p(c,y)},p(w,_){_&1&&l!==(l=w[0].path.split(".")[w[0].path.split(".").length-1]+"")&&ce(a,l),_&1&&D!==(D=w[0].attachmentSize/1e3+"")&&ce(g,D)},d(w){w&&C(e)}}}function ud(s){let e,t=s[0].text+"";return{c(){e=m("div"),b(e,"class","my-4")},m(n,r){A(n,e,r),e.innerHTML=t},p(n,r){r&1&&t!==(t=n[0].text+"")&&(e.innerHTML=t)},d(n){n&&C(e)}}}function ad(s){let e,t,n,r=s[6]&&ai(s);return{c(){e=m("div"),t=F(),r&&r.c(),n=ie()},m(i,u){A(i,e,u),e.innerHTML=s[3],A(i,t,u),r&&r.m(i,u),A(i,n,u)},p(i,u){u&8&&(e.innerHTML=i[3]),i[6]?r?r.p(i,u):(r=ai(i),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},d(i){i&&C(e),i&&C(t),r&&r.d(i),i&&C(n)}}}function ai(s){let e,t=s[4],n=[];for(let r=0;r<t.length;r+=1)n[r]=li(si(s,t,r));return{c(){e=m("ul");for(let r=0;r<n.length;r+=1)n[r].c();b(e,"class","svelte-fqd2l")},m(r,i){A(r,e,i);for(let u=0;u<n.length;u+=1)n[u].m(e,null)},p(r,i){if(i&16){t=r[4];let u;for(u=0;u<t.length;u+=1){const l=si(r,t,u);n[u]?n[u].p(l,i):(n[u]=li(l),n[u].c(),n[u].m(e,null))}for(;u<n.length;u+=1)n[u].d(1);n.length=t.length}},d(r){r&&C(e),Yt(n,r)}}}function li(s){let e,t,n=s[8]+"",r;return{c(){e=m("li"),t=new tu(!1),r=F(),t.a=r,b(e,"class","svelte-fqd2l")},m(i,u){A(i,e,u),t.m(n,e),p(e,r)},p(i,u){u&16&&n!==(n=i[8]+"")&&t.p(n)},d(i){i&&C(e)}}}function oi(s){let e,t,n,r,i,u=s[0].path+"",l,a,o,c,f,h=s[0].author+"",d,D,g,y,w,_=s[0].share+"",v,B,S,P,T,x=s[0].timestamp/1e3+"",M;return{c(){e=m("div"),t=m("ul"),n=m("li"),r=m("b"),r.textContent="path:",i=F(),l=j(u),a=F(),o=m("li"),c=m("b"),c.textContent="author:",f=F(),d=j(h),D=F(),g=m("li"),y=m("b"),y.textContent="share:",w=F(),v=j(_),B=F(),S=m("li"),P=m("b"),P.textContent="timestamp:",T=F(),M=j(x),b(n,"class","svelte-fqd2l"),b(o,"class","svelte-fqd2l"),b(g,"class","svelte-fqd2l"),b(S,"class","svelte-fqd2l"),b(t,"class","svelte-fqd2l"),b(e,"class","svelte-fqd2l")},m(q,W){A(q,e,W),p(e,t),p(t,n),p(n,r),p(n,i),p(n,l),p(t,a),p(t,o),p(o,c),p(o,f),p(o,d),p(t,D),p(t,g),p(g,y),p(g,w),p(g,v),p(t,B),p(t,S),p(S,P),p(S,T),p(S,M)},p(q,W){W&1&&u!==(u=q[0].path+"")&&ce(l,u),W&1&&h!==(h=q[0].author+"")&&ce(d,h),W&1&&_!==(_=q[0].share+"")&&ce(v,_),W&1&&x!==(x=q[0].timestamp/1e3+"")&&ce(M,x)},d(q){q&&C(e)}}}function ld(s){let e,t,n,r,i,u=s[5]&&ii(s);return{c(){e=m("div"),t=m("button"),t.textContent="Details",n=F(),u&&u.c(),b(e,"class","my-4 svelte-fqd2l")},m(l,a){A(l,e,a),p(e,t),p(e,n),u&&u.m(e,null),r||(i=H(t,"click",s[7]),r=!0)},p(l,[a]){l[5]?u?u.p(l,a):(u=ii(l),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},i:$,o:$,d(l){l&&C(e),u&&u.d(),r=!1,i()}}}function od(s,e,t){let{doc:n}=e,{attachment:r=!0}=e,{isReply:i=!1}=e,u=!1,l,a,o=!1;xt(()=>{t(5,u=!0)});const c=()=>t(5,u=!u);return s.$$set=f=>{"doc"in f&&t(0,n=f.doc),"attachment"in f&&t(1,r=f.attachment),"isReply"in f&&t(2,i=f.isReply)},s.$$.update=()=>{s.$$.dirty&25&&n.text!==void 0&&n.text.includes("<br>")&&(t(4,a=n.text.split("<br>")),t(3,l=a.shift()),t(3,l),t(0,n),t(4,a),t(6,o=!0))},[n,r,i,l,a,u,o,c]}class la extends te{constructor(e){super(),ne(this,e,od,ld,J,{doc:0,attachment:1,isReply:2})}}function ci(s,e,t){const n=s.slice();return n[1]=e[t],n}function cd(s){let e,t=[],n=new Map,r,i=s[2];const u=l=>l[1].signature;for(let l=0;l<i.length;l+=1){let a=ci(s,i,l),o=u(a);n.set(o,t[l]=fi(o,a))}return{c(){e=m("ul");for(let l=0;l<t.length;l+=1)t[l].c();b(e,"class","svelte-197mouz")},m(l,a){A(l,e,a);for(let o=0;o<t.length;o+=1)t[o].m(e,null);r=!0},p(l,a){a&69&&(i=l[2],Q(),t=Rt(t,a,u,1,l,i,n,e,jn,fi,null,ci),K())},i(l){if(!r){for(let a=0;a<i.length;a+=1)E(t[a]);r=!0}},o(l){for(let a=0;a<t.length;a+=1)k(t[a]);r=!1},d(l){l&&C(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}function fd(s){let e=s[5]()+"",t;return{c(){t=j(e)},m(n,r){A(n,t,r)},p:$,i:$,o:$,d(n){n&&C(t)}}}function hd(s){let e,t;return e=new fa({props:{isReply:!0,title:s[1].text,doc:s[1],attachment:!1,inStudio:s[0],reply:!1}}),e.$on("click",s[6]),e.$on("update",s[6]),{c(){L(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,r){const i={};r&4&&(i.title=n[1].text),r&4&&(i.doc=n[1]),r&1&&(i.inStudio=n[0]),e.$set(i)},i(n){t||(E(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function dd(s){let e,t;return e=new fa({props:{isReply:!0,title:s[1].text,doc:s[1],attachment:!0,inStudio:s[0],reply:!1}}),e.$on("click",s[6]),e.$on("update",s[6]),{c(){L(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,r){const i={};r&4&&(i.title=n[1].text),r&4&&(i.doc=n[1]),r&1&&(i.inStudio=n[0]),e.$set(i)},i(n){t||(E(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function fi(s,e){let t,n,r,i,u,l,a;const o=[dd,hd],c=[];function f(h,d){return d&4&&(n=null),n==null&&(n=!!h[1].text.includes("replied with voice")),n?0:1}return r=f(e,-1),i=c[r]=o[r](e),{key:s,first:null,c(){t=m("li"),i.c(),u=F(),b(t,"id",l=e[1].textHash),b(t,"class","svelte-197mouz"),this.first=t},m(h,d){A(h,t,d),c[r].m(t,null),p(t,u),a=!0},p(h,d){e=h;let D=r;r=f(e,d),r===D?c[r].p(e,d):(Q(),k(c[D],1,1,()=>{c[D]=null}),K(),i=c[r],i?i.p(e,d):(i=c[r]=o[r](e),i.c()),E(i,1),i.m(t,u)),(!a||d&4&&l!==(l=e[1].textHash))&&b(t,"id",l)},i(h){a||(E(i),a=!0)},o(h){k(i),a=!1},d(h){h&&C(t),c[r].d()}}}function pd(s){return{c:$,m:$,d:$}}function Dd(s){let e;return{c(){e=m("p"),e.textContent="There are no replies yet.",b(e,"class","max-content svelte-197mouz")},m(t,n){A(t,e,n)},d(t){t&&C(e)}}}function md(s){let e,t,n,r,i,u;const l=[fd,cd],a=[];function o(d,D){return d[2]===void 0?0:d[3]?1:-1}~(t=o(s))&&(n=a[t]=l[t](s));function c(d,D){return d[4]?Dd:pd}let f=c(s),h=f(s);return{c(){e=m("div"),n&&n.c(),r=F(),i=m("div"),h.c()},m(d,D){A(d,e,D),~t&&a[t].m(e,null),A(d,r,D),A(d,i,D),h.m(i,null),u=!0},p(d,[D]){let g=t;t=o(d),t===g?~t&&a[t].p(d,D):(n&&(Q(),k(a[g],1,1,()=>{a[g]=null}),K()),~t?(n=a[t],n?n.p(d,D):(n=a[t]=l[t](d),n.c()),E(n,1),n.m(e,null)):n=null),f!==(f=c(d))&&(h.d(1),h=f(d),h&&(h.c(),h.m(i,null)))},i(d){u||(E(n),u=!0)},o(d){k(n),u=!1},d(d){d&&C(e),~t&&a[t].d(),d&&C(r),d&&C(i),h.d()}}}function gd(s,e,t){let n;Te(s,Xu,f=>t(7,n=f));let{doc:r}=e,{inStudio:i}=e,u=[],l=!0,a=!1;const o=async()=>{let f=r.path.split("!");t(2,u=await n.cache.queryDocs({filter:{pathStartsWith:f[0]}})),t(2,u=u.filter(h=>h.path.split("/").length>6)),t(3,l=!0)};n.cache.onCacheUpdated(()=>{o(),t(2,u)});function c(){setTimeout(()=>{o()},1e3)}return xt(()=>{o()}),s.$$set=f=>{"doc"in f&&t(1,r=f.doc),"inStudio"in f&&t(0,i=f.inStudio)},s.$$.update=()=>{s.$$.dirty&4&&t(2,u),s.$$.dirty&4&&(u.length>=1?(t(3,l=!0),t(4,a=!1)):t(4,a=!0))},[i,r,u,l,a,o,c]}class bd extends te{constructor(e){super(),ne(this,e,gd,md,J,{doc:1,inStudio:0})}}function wd(s){let e;return{c(){e=j("Record audio")},m(t,n){A(t,e,n)},d(t){t&&C(e)}}}function _d(s){let e;return{c(){e=j("Stop recording")},m(t,n){A(t,e,n)},d(t){t&&C(e)}}}function yd(s){let e,t,n,r,i;function u(o,c){return o[0]?_d:wd}let l=u(s),a=l(s);return{c(){e=m("div"),t=m("div"),n=m("button"),a.c(),b(n,"class","phase1"),b(t,"class","svelte-153yvdv"),b(e,"class","svelte-153yvdv")},m(o,c){A(o,e,c),p(e,t),p(t,n),a.m(n,null),r||(i=[H(n,"click",s[5]),H(n,"keypress",s[6])],r=!0)},p(o,[c]){l!==(l=u(o))&&(a.d(1),a=l(o),a&&(a.c(),a.m(n,null)))},i:$,o:$,d(o){o&&C(e),a.d(),r=!1,ke(i)}}}function Ad(s){return new Promise((e,t)=>{let n=new FileReader;n.addEventListener("loadend",r=>e(r.target.result)),n.addEventListener("error",t),n.readAsArrayBuffer(s)})}function Cd(s,e,t){let n,r;Te(s,ot,w=>t(11,n=w)),Te(s,$t,w=>t(12,r=w));const i=tt();let u,l,a=[],o=null,c=!1,{xy:f=void 0}=e,{inStudio:h}=e,{doc:d=void 0}=e;async function D(){if(c)o.stop(),console.log("mediaRecorder",o),console.log("mediaRecorder mime",o.mimeType),t(0,c=!1),o.ondataavailable=w=>a.push(w.data),o.onstop=async function(w){let _=Date.now(),v=new Date().toLocaleString(),B=(_+144e5)*1e3,S=o.mimeType;S===""&&(S="audio/ogg; codecs=opus");let T=S.split(";")[0].split("/")[1];const x=new Blob(a,{type:S});console.log("blob",x);const M=new Uint8Array(await Ad(x));console.log("mime",S);let q=n.address.slice(1,5);if(f!==void 0&&f!=="reply")h||(u=await r.replica.set(n,{path:`/documents/${f[0]}/${f[1]}/${_}/!voice-note-by-${q}.${T}`,text:"Voice note shared by "+q+" on "+v,attachment:M,deleteAfter:B})),l=await r.replica.set(n,{path:`/studio/${f[0]}/${f[1]}/${_}/voice-note-by-${q}.${T}`,text:"Voice note shared by "+q+" on "+v,attachment:M}),i("upload"),console.log("Upload Result: ",u),console.log("Studio Result: ",l),a=[];else if(f=="reply"){let W=d.path.split("!"),ue=W[0].replace("/documents","/studio");const ae=await r.replica.set(n,{text:q+" replied with voice<br>Shared on "+v,path:W[0]+_+"/!reply-by-"+q+"."+T,deleteAfter:B,attachment:M}),Ke=await r.replica.set(n,{text:q+" replied with voice<br>Shared on "+v,path:ue+_+"/reply-by-"+q+"."+T,attachment:M});return console.log("result ",ae),console.log("studio ",Ke),i("success"),ae}};else{const w=await navigator.mediaDevices.getUserMedia({audio:!0});o=new MediaRecorder(w),o.start(),console.log("mediaRecorder",o),console.log("mediaRecorder mime",o.mimeType),console.log("recording"),t(0,c=!0)}}const g=()=>{D()},y=()=>{D()};return s.$$set=w=>{"xy"in w&&t(2,f=w.xy),"inStudio"in w&&t(3,h=w.inStudio),"doc"in w&&t(4,d=w.doc)},[c,D,f,h,d,g,y]}class oa extends te{constructor(e){super(),ne(this,e,Cd,yd,J,{xy:2,inStudio:3,doc:4})}}function hi(s){let e,t,n,r,i,u,l,a,o;return{c(){e=m("p"),t=m("input"),n=F(),r=m("p"),i=m("button"),u=j("Send Reply"),Se(t,"width",s[5]+"ch"),b(t,"class","svelte-19ki2og"),i.disabled=l=pi(s[2])},m(c,f){A(c,e,f),p(e,t),rt(t,s[2]),A(c,n,f),A(c,r,f),p(r,i),p(i,u),a||(o=[H(t,"input",s[10]),H(i,"click",s[7])],a=!0)},p(c,f){f&32&&Se(t,"width",c[5]+"ch"),f&4&&t.value!==c[2]&&rt(t,c[2]),f&4&&l!==(l=pi(c[2]))&&(i.disabled=l)},d(c){c&&C(e),c&&C(n),c&&C(r),a=!1,ke(o)}}}function di(s){let e,t,n;return t=new oa({props:{xy:"reply",doc:s[0],inStudio:s[1]}}),{c(){e=m("p"),L(t.$$.fragment)},m(r,i){A(r,e,i),U(t,e,null),n=!0},p(r,i){const u={};i&1&&(u.doc=r[0]),i&2&&(u.inStudio=r[1]),t.$set(u)},i(r){n||(E(t.$$.fragment,r),n=!0)},o(r){k(t.$$.fragment,r),n=!1},d(r){r&&C(e),z(t)}}}function Ed(s){let e;return{c(){e=m("span"),e.textContent=`${s[6].kind}`},m(t,n){A(t,e,n)},p:$,d(t){t&&C(e)}}}function kd(s){let e,t,n,r,i,u,l,a,o,c,f,h=s[3]&&hi(s),d=s[4]&&di(s),D=s[6]&&Ed(s);return{c(){e=m("div"),t=m("button"),t.textContent="Text reply",n=F(),r=m("button"),r.textContent="Voice reply",i=F(),h&&h.c(),u=F(),d&&d.c(),l=F(),a=m("p"),D&&D.c()},m(g,y){A(g,e,y),p(e,t),p(e,n),p(e,r),p(e,i),h&&h.m(e,null),p(e,u),d&&d.m(e,null),p(e,l),p(e,a),D&&D.m(a,null),o=!0,c||(f=[H(t,"click",s[8]),H(r,"click",s[9])],c=!0)},p(g,[y]){g[3]?h?h.p(g,y):(h=hi(g),h.c(),h.m(e,u)):h&&(h.d(1),h=null),g[4]?d?(d.p(g,y),y&16&&E(d,1)):(d=di(g),d.c(),E(d,1),d.m(e,l)):d&&(Q(),k(d,1,1,()=>{d=null}),K()),g[6]&&D.p(g,y)},i(g){o||(E(d),o=!0)},o(g){k(d),o=!1},d(g){g&&C(e),h&&h.d(),d&&d.d(),D&&D.d(),c=!1,ke(f)}}}function pi(s){return s=="Reply here"}function vd(s,e,t){let n,r;Te(s,ot,_=>t(11,n=_)),Te(s,$t,_=>t(12,r=_));const i=tt();let u,l=!1,a=!1;async function o(){let _=n.address.slice(1,5),v=c.path.split("!"),B=c.path.split("/"),S=Date.now();const P=await r.replica.set(n,{text:_+" replied: "+h,path:v[0]+S+"/!reply-by-"+_,deleteAfter:D}),T=await r.replica.set(n,{text:_+" replied: "+h,path:"/studio/"+B[2]+"/"+S+"/reply-by-"+_});return console.log("result ",P),console.log("studio ",T),i("success"),P}let{doc:c}=e,{inStudio:f}=e,h="Reply here",d=h.length,D=(Date.now()+36e5)*1e3;function g(){t(3,l=!l),t(4,a=!1)}function y(){t(3,l=!1),t(4,a=!a)}function w(){h=this.value,t(2,h),t(6,u)}return s.$$set=_=>{"doc"in _&&t(0,c=_.doc),"inStudio"in _&&t(1,f=_.inStudio)},s.$$.update=()=>{s.$$.dirty&4,s.$$.dirty&4&&h!==void 0&&t(5,d=h.length)},console.log("result",u),[c,f,h,l,a,d,u,o,g,y,w]}class Fd extends te{constructor(e){super(),ne(this,e,vd,kd,J,{doc:0,inStudio:1})}}function Di(s){let e,t,n,r;return e=new bd({props:{doc:s[0],inStudio:s[1]}}),e.$on("success",s[4]),n=new Fd({props:{doc:s[0],inStudio:s[1]}}),n.$on("success",s[5]),{c(){L(e.$$.fragment),t=F(),L(n.$$.fragment)},m(i,u){U(e,i,u),A(i,t,u),U(n,i,u),r=!0},p(i,u){const l={};u&1&&(l.doc=i[0]),u&2&&(l.inStudio=i[1]),e.$set(l);const a={};u&1&&(a.doc=i[0]),u&2&&(a.inStudio=i[1]),n.$set(a)},i(i){r||(E(e.$$.fragment,i),E(n.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),k(n.$$.fragment,i),r=!1},d(i){z(e,i),i&&C(t),z(n,i)}}}function Bd(s){let e,t,n,r,i,u,l=s[2]&&Di(s);return{c(){e=m("div"),t=m("button"),t.textContent="Reply",n=F(),l&&l.c()},m(a,o){A(a,e,o),p(e,t),p(e,n),l&&l.m(e,null),r=!0,i||(u=H(t,"click",s[3]),i=!0)},p(a,[o]){a[2]?l?(l.p(a,o),o&4&&E(l,1)):(l=Di(a),l.c(),E(l,1),l.m(e,null)):l&&(Q(),k(l,1,1,()=>{l=null}),K())},i(a){r||(E(l),r=!0)},o(a){k(l),r=!1},d(a){a&&C(e),l&&l.d(),i=!1,u()}}}function Sd(s,e,t){let{doc:n}=e,{inStudio:r}=e,i=!1;function u(){t(2,i=!i)}function l(o){on.call(this,s,o)}function a(o){on.call(this,s,o)}return s.$$set=o=>{"doc"in o&&t(0,n=o.doc),"inStudio"in o&&t(1,r=o.inStudio)},[n,r,i,u,l,a]}class ca extends te{constructor(e){super(),ne(this,e,Sd,Bd,J,{doc:0,inStudio:1})}}function Td(s){let e,t,n,r,i,u=!s[10]&&mi(s),l=s[10]&&bi(s);return{c(){e=m("div"),u&&u.c(),t=F(),l&&l.c(),b(e,"class","main svelte-twi2yu"),cn(e,"replies",s[6]===!0)},m(a,o){A(a,e,o),u&&u.m(e,null),p(e,t),l&&l.m(e,null),n=!0,r||(i=[H(e,"click",vr(s[19])),H(e,"keypress",vr(s[20]))],r=!0)},p(a,o){a[10]?u&&(u.d(1),u=null):u?u.p(a,o):(u=mi(a),u.c(),u.m(e,t)),a[10]?l?(l.p(a,o),o&1024&&E(l,1)):(l=bi(a),l.c(),E(l,1),l.m(e,null)):l&&(Q(),k(l,1,1,()=>{l=null}),K()),(!n||o&64)&&cn(e,"replies",a[6]===!0)},i(a){n||(E(l),n=!0)},o(a){k(l),n=!1},d(a){a&&C(e),u&&u.d(),l&&l.d(),r=!1,ke(i)}}}function Id(s){let e,t,n;return{c(){e=m("div"),t=m("img"),Se(t,"margin-bottom","-3px"),$e(t.src,n=s[12][s[9]])||b(t,"src",n),b(t,"alt","document icon"),b(t,"width",s[8]),b(t,"height",s[8]),b(e,"class","main disabled svelte-twi2yu"),cn(e,"replies",s[6]===!0)},m(r,i){A(r,e,i),p(e,t)},p(r,i){i&512&&!$e(t.src,n=r[12][r[9]])&&b(t,"src",n),i&256&&b(t,"width",r[8]),i&256&&b(t,"height",r[8]),i&64&&cn(e,"replies",r[6]===!0)},i:$,o:$,d(r){r&&C(e)}}}function mi(s){let e,t,n,r,i,u,l,a=s[0]!==void 0&&gi(s);return{c(){e=m("div"),t=m("p"),n=m("img"),i=F(),a&&a.c(),Se(n,"margin-bottom","-3px"),$e(n.src,r=s[12][s[9]])||b(n,"src",r),b(n,"alt","document icon"),b(n,"width",s[8]),b(n,"height",s[8]),b(t,"class","svelte-twi2yu"),b(e,"class","flex row svelte-twi2yu")},m(o,c){A(o,e,c),p(e,t),p(t,n),p(e,i),a&&a.m(e,null),u||(l=[H(t,"click",s[14]),H(t,"keypress",s[15])],u=!0)},p(o,c){c&512&&!$e(n.src,r=o[12][o[9]])&&b(n,"src",r),c&256&&b(n,"width",o[8]),c&256&&b(n,"height",o[8]),o[0]!==void 0?a?a.p(o,c):(a=gi(o),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},d(o){o&&C(e),a&&a.d(),u=!1,ke(l)}}}function gi(s){let e;return{c(){e=m("div")},m(t,n){A(t,e,n),e.innerHTML=s[0]},p(t,n){n&1&&(e.innerHTML=t[0])},d(t){t&&C(e)}}}function bi(s){let e,t,n,r,i,u,l,a,o,c,f,h,d,D,g=s[3]&&wi(s);o=new la({props:{doc:s[1],attachment:s[3],isReply:s[6]}});let y=s[4]&&_i(s),w=!s[2]&&yi(s);return{c(){e=m("div"),t=m("button"),n=m("img"),i=j(`
            Artifact`),u=F(),g&&g.c(),l=F(),a=m("div"),L(o.$$.fragment),c=F(),y&&y.c(),f=F(),w&&w.c(),Se(n,"margin-bottom","-3px"),$e(n.src,r=s[12][s[9]])||b(n,"src",r),b(n,"alt","document icon"),b(n,"width",s[8]),b(n,"height",s[8]),b(t,"class","svelte-twi2yu"),b(e,"class","flex svelte-twi2yu")},m(_,v){A(_,e,v),p(e,t),p(t,n),p(t,i),p(e,u),g&&g.m(e,null),p(e,l),p(e,a),U(o,a,null),p(e,c),y&&y.m(e,null),p(e,f),w&&w.m(e,null),h=!0,d||(D=[H(t,"click",s[16]),H(t,"keypress",vr(s[17]))],d=!0)},p(_,v){(!h||v&512&&!$e(n.src,r=_[12][_[9]]))&&b(n,"src",r),(!h||v&256)&&b(n,"width",_[8]),(!h||v&256)&&b(n,"height",_[8]),_[3]?g?(g.p(_,v),v&8&&E(g,1)):(g=wi(_),g.c(),E(g,1),g.m(e,l)):g&&(Q(),k(g,1,1,()=>{g=null}),K());const B={};v&2&&(B.doc=_[1]),v&8&&(B.attachment=_[3]),v&64&&(B.isReply=_[6]),o.$set(B),_[4]?y?(y.p(_,v),v&16&&E(y,1)):(y=_i(_),y.c(),E(y,1),y.m(e,f)):y&&(Q(),k(y,1,1,()=>{y=null}),K()),_[2]?w&&(Q(),k(w,1,1,()=>{w=null}),K()):w?(w.p(_,v),v&4&&E(w,1)):(w=yi(_),w.c(),E(w,1),w.m(e,null))},i(_){h||(E(g),E(o.$$.fragment,_),E(y),E(w),h=!0)},o(_){k(g),k(o.$$.fragment,_),k(y),k(w),h=!1},d(_){_&&C(e),g&&g.d(),z(o),y&&y.d(),w&&w.d(),d=!1,ke(D)}}}function wi(s){let e,t,n;return t=new aa({props:{doc:s[1]}}),{c(){e=m("div"),L(t.$$.fragment)},m(r,i){A(r,e,i),U(t,e,null),n=!0},p(r,i){const u={};i&2&&(u.doc=r[1]),t.$set(u)},i(r){n||(E(t.$$.fragment,r),n=!0)},o(r){k(t.$$.fragment,r),n=!1},d(r){r&&C(e),z(t)}}}function _i(s){let e,t,n;return t=new ca({props:{doc:s[1],inStudio:s[5]}}),{c(){e=m("div"),L(t.$$.fragment)},m(r,i){A(r,e,i),U(t,e,null),n=!0},p(r,i){const u={};i&2&&(u.doc=r[1]),i&32&&(u.inStudio=r[5]),t.$set(u)},i(r){n||(E(t.$$.fragment,r),n=!0)},o(r){k(t.$$.fragment,r),n=!1},d(r){r&&C(e),z(t)}}}function yi(s){let e,t,n;return t=new Sc({props:{doc:s[1]}}),t.$on("update",s[18]),{c(){e=m("div"),L(t.$$.fragment)},m(r,i){A(r,e,i),U(t,e,null),n=!0},p(r,i){const u={};i&2&&(u.doc=r[1]),t.$set(u)},i(r){n||(E(t.$$.fragment,r),n=!0)},o(r){k(t.$$.fragment,r),n=!1},d(r){r&&C(e),z(t)}}}function Pd(s){let e,t,n,r;const i=[Id,Td],u=[];function l(a,o){return a[7]?0:1}return e=l(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(a,o){u[e].m(a,o),A(a,n,o),r=!0},p(a,[o]){let c=e;e=l(a),e===c?u[e].p(a,o):(Q(),k(u[c],1,1,()=>{u[c]=null}),K(),t=u[e],t?t.p(a,o):(t=u[e]=i[e](a),t.c()),E(t,1),t.m(n.parentNode,n))},i(a){r||(E(t),r=!0)},o(a){k(t),r=!1},d(a){u[e].d(a),a&&C(n)}}}function xd(s,e,t){const n=tt();let r=["icons/mountain-phase-0-02.png","icons/mountain-phase-1-02.png","icons/mountain-phase-2-02.png","icons/mountain-phase-3-02.png","icons/mountain-phase-4-02.png","icons/mountain-phase-5-02.png","icons/mountain-phase-6-02.png","icons/mountain-phase-7-02.png","icons/mountain-phase-8-02.png"],i=!1,{doc:u}=e,{studio:l=!1}=e,{attachment:a=!0}=e,{reply:o=!0}=e,{title:c=void 0}=e,{inStudio:f}=e,{isReply:h=!1}=e,{disabled:d=!1}=e,D=u.deleteAfter,g,y=24,w;const _=()=>{t(10,i=!i),n("click",u)},v=()=>t(10,i=!i),B=()=>t(10,i=!i),S=()=>t(10,i=!i);function P(M){on.call(this,s,M)}const T=()=>{t(10,i=!i),n("click",u)},x=()=>t(10,i=!i);return s.$$set=M=>{"doc"in M&&t(1,u=M.doc),"studio"in M&&t(2,l=M.studio),"attachment"in M&&t(3,a=M.attachment),"reply"in M&&t(4,o=M.reply),"title"in M&&t(0,c=M.title),"inStudio"in M&&t(5,f=M.inStudio),"isReply"in M&&t(6,h=M.isReply),"disabled"in M&&t(7,d=M.disabled)},s.$$.update=()=>{s.$$.dirty&514&&console.log(u.path+"phase "+w),s.$$.dirty&8259&&(c!==void 0&&c.includes("<br>")?(t(13,g=c.split("<br>")),t(0,c=g.shift()),t(0,c),t(13,g),t(1,u),t(6,h),console.log("content",g),t(8,y=g.length*2+12)):u.text.includes("<br>")?(t(13,g=u.text.split("<br>")),t(8,y=g.length*3+8)):h&&t(8,y=10)),s.$$.dirty&256&&console.log("reaction",y)},console.log("deletionTime"+D),t(9,w=Math.floor((D-Date.now())/(25488e8/9))%9),[c,u,l,a,o,f,h,d,y,w,i,n,r,g,_,v,B,S,P,T,x]}class fa extends te{constructor(e){super(),ne(this,e,xd,Pd,J,{doc:1,studio:2,attachment:3,reply:4,title:0,inStudio:5,isReply:6,disabled:7})}}function Ai(s){let e,t;return{c(){e=m("p"),t=j(s[1]),b(e,"class","text-2xl")},m(n,r){A(n,e,r),p(e,t)},p(n,r){r&2&&ce(t,n[1])},d(n){n&&C(e)}}}function Rd(s){let e,t,n,r,i,u,l,a,o,c,f,h,d=s[1]&&Ai(s);return{c(){e=m("div"),t=m("label"),t.textContent="Have an existing ID?",n=F(),r=m("div"),i=m("textarea"),u=F(),l=m("button"),l.textContent="Validate ID",a=F(),o=m("button"),o.textContent="Generate new Identity",c=F(),d&&d.c(),b(t,"for","keypair"),b(i,"class","px-5 my-2 svelte-5at67e"),b(i,"id","keypair"),b(i,"placeholder",`Paste it here:       
{
"address": "", 
"secret": ""
}`),b(l,"class","phase1 mx-4 my-2"),b(o,"class","phase1 mx-4 my-2"),Se(o,"margin-left","10vw"),b(r,"class","flex md:flex-row items-end mx-0 flex-col svelte-5at67e"),b(e,"class","flex flex-col items-start mx-0 svelte-5at67e")},m(D,g){A(D,e,g),p(e,t),p(e,n),p(e,r),p(r,i),rt(i,s[0]),p(r,u),p(r,l),p(r,a),p(r,o),p(e,c),d&&d.m(e,null),f||(h=[H(i,"input",s[4]),H(l,"click",s[3]),H(o,"click",s[2])],f=!0)},p(D,[g]){g&1&&rt(i,D[0]),D[1]?d?d.p(D,g):(d=Ai(D),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},i:$,o:$,d(D){D&&C(e),d&&d.d(),f=!1,ke(h)}}}function Od(s,e,t){const n=new Un,r=tt();let i="",u="";function l(){r("generateNewIdentity")}function a(){try{let c=JSON.parse(i);c.address&&c.secret?R(lr(c.address))?(t(1,u="Invalid address"),r("error")):(ot.set({address:c.address,secret:c.secret}),n.author=c,Mn.set({settings:n}),r("validated")):(t(1,u="Invalid keypair"),r("error"))}catch{t(1,u="Invalid JSON"),r("error")}}function o(){i=this.value,t(0,i)}return[i,u,l,a,o]}class $d extends te{constructor(e){super(),ne(this,e,Od,Rd,J,{})}}function Md(s){let e,t,n;return{c(){e=m("button"),e.textContent="file",b(e,"class","phase1")},m(r,i){A(r,e,i),t||(n=[H(e,"click",s[8]),H(e,"keypress",s[9])],t=!0)},p:$,d(r){r&&C(e),t=!1,ke(n)}}}function jd(s){let e,t,n;return{c(){e=m("button"),e.textContent="make an offering to the oracle"},m(r,i){A(r,e,i),t||(n=[H(e,"click",s[6]),H(e,"keypress",s[7])],t=!0)},p:$,d(r){r&&C(e),t=!1,ke(n)}}}function Ci(s){let e,t,n=s[1].kind+"",r;return{c(){e=m("p"),t=m("strong"),r=j(n)},m(i,u){A(i,e,u),p(e,t),p(t,r)},p(i,u){u&2&&n!==(n=i[1].kind+"")&&ce(r,n)},d(i){i&&C(e)}}}function Nd(s){let e,t,n,r,i,u,l;function a(h,d){return h[0]?jd:Md}let o=a(s),c=o(s),f=s[1]&&Ci(s);return{c(){e=m("div"),t=m("div"),c.c(),n=F(),r=m("input"),i=F(),f&&f.c(),Se(r,"display","none"),b(r,"type","file"),b(r,"accept",".jpg, .jpeg, .png, .gif, .txt, .pdf, .md, .webm, .mp3, .ogg, .wav"),b(t,"class","svelte-l8b8bn"),b(e,"class","svelte-l8b8bn")},m(h,d){A(h,e,d),p(e,t),c.m(t,null),p(t,n),p(t,r),s[11](r),p(e,i),f&&f.m(e,null),u||(l=H(r,"change",s[10]),u=!0)},p(h,[d]){o===(o=a(h))&&c?c.p(h,d):(c.d(1),c=o(h),c&&(c.c(),c.m(t,n))),h[1]?f?f.p(h,d):(f=Ci(h),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i:$,o:$,d(h){h&&C(e),c.d(),s[11](null),f&&f.d(),u=!1,l()}}}function Ld(s){return new Promise((e,t)=>{let n=new FileReader;n.onload=()=>{e(n.result),console.log("typeof",n.result)},n.onerror=t,n.readAsArrayBuffer(s)})}function Ud(s,e,t){let n,r;Te(s,ot,v=>t(14,n=v)),Te(s,$t,v=>t(15,r=v));const i=tt();let{inStudio:u}=e,{xy:l=[0,0]}=e,{oracle:a=!1}=e,o,c,f;async function h(v){let B=v.target.files[0],P=B.name.replace(/\s+/g,"_").replace(/[@,\/#!$%\^&\*;:{}=\-`~()]/g,""),T=P.split(".").pop(),x=P.split(".")[P.split(".").length-2],M;(T==="JPG"||T==="jpg")&&(T="jpeg"),M=x+"."+T;let q=Date.now(),W=await Ld(B),ue=(Date.now()+25488e5)*1e3,ae=new Uint8Array(W);return a?await r.replica.set(n,{path:`/oracle/${q}/!${M}`,text:"Offering by "+n.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:ae,deleteAfter:ue}):(u||t(1,c=await r.replica.set(n,{path:`/documents/${l[0]}/${l[1]}/${q}/!${M}`,text:"Shared by "+n.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:ae,deleteAfter:ue})),f=await r.replica.set(n,{path:`/studio/${l[0]}/${l[1]}/${q}/${M}`,text:"Shared by "+n.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:ae})),console.log("Result: ",c),R(c)&&console.error(c),console.log("Studio: ",f),R(f)&&console.error(f),i("success"),c}const d=()=>{o.click()},D=()=>{o.click()},g=()=>{o.click()},y=()=>{o.click()},w=v=>h(v);function _(v){Rr[v?"unshift":"push"](()=>{o=v,t(2,o)})}return s.$$set=v=>{"inStudio"in v&&t(4,u=v.inStudio),"xy"in v&&t(5,l=v.xy),"oracle"in v&&t(0,a=v.oracle)},s.$$.update=()=>{s.$$.dirty&2&&t(1,c)},[a,c,o,h,u,l,d,D,g,y,w,_]}class zd extends te{constructor(e){super(),ne(this,e,Ud,Nd,J,{inStudio:4,xy:5,oracle:0})}}function Ei(s){let e,t,n,r,i,u,l,a,o,c,f;return{c(){e=m("div"),t=m("textarea"),n=F(),r=m("div"),i=m("button"),i.textContent="Submit",u=F(),l=m("button"),l.textContent="Close",b(r,"class","button-container svelte-d57wxz"),b(e,"class","modal svelte-d57wxz")},m(h,d){A(h,e,d),p(e,t),s[7](t),p(e,n),p(e,r),p(r,i),p(r,u),p(r,l),o=!0,c||(f=[H(i,"click",s[8]),H(i,"keypress",s[9]),H(l,"click",s[10]),H(l,"keypress",s[11])],c=!0)},p:$,i(h){o||(rr(()=>{a||(a=Bt(e,It,{y:200,duration:200},!0)),a.run(1)}),o=!0)},o(h){a||(a=Bt(e,It,{y:200,duration:200},!1)),a.run(0),o=!1},d(h){h&&C(e),s[7](null),h&&a&&a.end(),c=!1,ke(f)}}}function ki(s){let e,t,n=s[0].kind+"",r;return{c(){e=m("p"),t=m("strong"),r=j(n)},m(i,u){A(i,e,u),p(e,t),p(t,r)},p(i,u){u&1&&n!==(n=i[0].kind+"")&&ce(r,n)},d(i){i&&C(e)}}}function Hd(s){let e,t,n,r,i,u,l,a,o=s[1]&&Ei(s),c=s[0]&&ki(s);return{c(){e=m("div"),t=m("div"),n=m("button"),n.textContent="written text",r=F(),o&&o.c(),i=F(),c&&c.c(),b(n,"class","phase1"),b(t,"class","svelte-d57wxz"),b(e,"class","svelte-d57wxz")},m(f,h){A(f,e,h),p(e,t),p(t,n),p(e,r),o&&o.m(e,null),p(e,i),c&&c.m(e,null),u=!0,l||(a=[H(n,"click",s[5]),H(n,"keypress",s[6])],l=!0)},p(f,[h]){f[1]?o?(o.p(f,h),h&2&&E(o,1)):(o=Ei(f),o.c(),E(o,1),o.m(e,i)):o&&(Q(),k(o,1,1,()=>{o=null}),K()),f[0]?c?c.p(f,h):(c=ki(f),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i(f){u||(E(o),u=!0)},o(f){k(o),u=!1},d(f){f&&C(e),o&&o.d(),c&&c.d(),l=!1,ke(a)}}}function qd(s,e,t){let n,r;Te(s,ot,_=>t(12,n=_)),Te(s,$t,_=>t(13,r=_));const i=tt();let u=!1,l,a,{xy:o=[0,0]}=e;async function c(){let _=Date.now(),v=(Date.now()+25488e5)*1e3,S=await new Blob([l.value],{type:"text/markdown"}).arrayBuffer(),P=new Uint8Array(S);return t(0,a=await r.replica.set(n,{path:`/documents/${o[0]}/${o[1]}/${_}/!text.md`,text:"Text input by "+n.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:P,deleteAfter:v})),console.log("Result: ",a),R(a)&&console.error(a),i("success"),t(1,u=!1),a}const f=()=>t(1,u=!u),h=()=>t(1,u=!u);function d(_){Rr[_?"unshift":"push"](()=>{l=_,t(2,l)})}const D=()=>c(),g=()=>c(),y=()=>t(1,u=!1),w=()=>t(1,u=!1);return s.$$set=_=>{"xy"in _&&t(4,o=_.xy)},s.$$.update=()=>{s.$$.dirty&1&&t(0,a)},[a,u,l,c,o,f,h,d,D,g,y,w]}class Wd extends te{constructor(e){super(),ne(this,e,qd,Hd,J,{xy:4})}}function vi(s,e,t){const n=s.slice();return n[19]=e[t],n[21]=t,n}function Fi(s,e,t){const n=s.slice();return n[19]=e[t],n[23]=t,n}function Bi(s){let e,t,n,r,i,u=s[3][1]+"",l,a,o=s[3][0]+"",c,f,h,d,D,g,y,w,_,v,B,S,P;return d=new Wd({props:{xy:s[3]}}),d.$on("success",s[11]),g=new zd({props:{xy:s[3],inStudio:s[1]}}),g.$on("success",s[12]),w=new oa({props:{xy:s[3],inStudio:s[1]}}),w.$on("upload",s[13]),{c(){e=m("div"),t=m("div"),n=j(`What artefact would you like to create? 
      `),r=m("br"),i=F(),l=j(u),a=j(", "),c=j(o),f=F(),h=m("div"),L(d.$$.fragment),D=F(),L(g.$$.fragment),y=F(),L(w.$$.fragment),_=F(),v=m("button"),v.textContent="Close",b(t,"class","mt-6 brown text-left px-6 svelte-z5nupk"),b(v,"class","phase1"),b(h,"class","flex-col"),b(e,"class","modal pb-6  svelte-z5nupk"),b(e,"style",s[5])},m(T,x){A(T,e,x),p(e,t),p(t,n),p(t,r),p(t,i),p(t,l),p(t,a),p(t,c),p(e,f),p(e,h),U(d,h,null),p(h,D),U(g,h,null),p(h,y),U(w,h,null),p(h,_),p(h,v),B=!0,S||(P=H(v,"click",s[9]),S=!0)},p(T,x){(!B||x&8)&&u!==(u=T[3][1]+"")&&ce(l,u),(!B||x&8)&&o!==(o=T[3][0]+"")&&ce(c,o);const M={};x&8&&(M.xy=T[3]),d.$set(M);const q={};x&8&&(q.xy=T[3]),x&2&&(q.inStudio=T[1]),g.$set(q);const W={};x&8&&(W.xy=T[3]),x&2&&(W.inStudio=T[1]),w.$set(W),(!B||x&32)&&b(e,"style",T[5])},i(T){B||(E(d.$$.fragment,T),E(g.$$.fragment,T),E(w.$$.fragment,T),B=!0)},o(T){k(d.$$.fragment,T),k(g.$$.fragment,T),k(w.$$.fragment,T),B=!1},d(T){T&&C(e),z(d),z(g),z(w),S=!1,P()}}}function Si(s,e){let t,n,r;function i(){return e[14](e[21],e[23])}function u(){return e[15](e[21],e[23])}return{key:s,first:null,c(){t=m("div"),b(t,"class","svelte-z5nupk"),cn(t,"active",e[4][e[21]][e[23]]),this.first=t},m(l,a){A(l,t,a),n||(r=[H(t,"click",i),H(t,"keypress",u)],n=!0)},p(l,a){e=l,a&17&&cn(t,"active",e[4][e[21]][e[23]])},d(l){l&&C(t),n=!1,ke(r)}}}function Ti(s,e){let t,n=[],r=new Map,i,u={length:e[0][1]};const l=a=>a[23];for(let a=0;a<u.length;a+=1){let o=Fi(e,u,a),c=l(o);r.set(c,n[a]=Si(c,o))}return{key:s,first:null,c(){t=ie();for(let a=0;a<n.length;a+=1)n[a].c();i=ie(),this.first=t},m(a,o){A(a,t,o);for(let c=0;c<n.length;c+=1)n[c].m(a,o);A(a,i,o)},p(a,o){e=a,o&273&&(u={length:e[0][1]},n=Rt(n,o,l,1,e,u,r,i.parentNode,Or,Si,i,Fi))},d(a){a&&C(t);for(let o=0;o<n.length;o+=1)n[o].d(a);a&&C(i)}}}function Qd(s){let e,t,n,r,i,u,l,a=[],o=new Map,c,f=s[2]&&Bi(s),h={length:s[0][0]};const d=D=>D[21];for(let D=0;D<h.length;D+=1){let g=vi(s,h,D),y=d(g);o.set(y,a[D]=Ti(y,g))}return{c(){e=m("div"),t=m("div"),f&&f.c(),n=F(),r=m("div"),i=m("h4"),i.textContent="Select location on map",u=F(),l=m("div");for(let D=0;D<a.length;D+=1)a[D].c();b(i,"class","svelte-z5nupk"),b(l,"class","container svelte-z5nupk"),Se(l,"grid-template-rows",s[6]),Se(l,"grid-template-columns",s[7]),b(r,"class","w-4/5"),Se(t,"position","relative"),Se(e,"position","fixed")},m(D,g){A(D,e,g),p(e,t),f&&f.m(t,null),p(t,n),p(t,r),p(r,i),p(r,u),p(r,l);for(let y=0;y<a.length;y+=1)a[y].m(l,null);c=!0},p(D,[g]){D[2]?f?(f.p(D,g),g&4&&E(f,1)):(f=Bi(D),f.c(),E(f,1),f.m(t,n)):f&&(Q(),k(f,1,1,()=>{f=null}),K()),g&273&&(h={length:D[0][0]},a=Rt(a,g,d,1,D,h,o,l,Or,Ti,null,vi)),(!c||g&64)&&Se(l,"grid-template-rows",D[6]),(!c||g&128)&&Se(l,"grid-template-columns",D[7])},i(D){c||(E(f),c=!0)},o(D){k(f),c=!1},d(D){D&&C(e),f&&f.d();for(let g=0;g<a.length;g+=1)a[g].d()}}}function Kd(s,e,t){let n,r,i,u,{grid:l=[9,16]}=e,a=[],o=!1,c=["0px","0px"],{inStudio:f}=e;function h(S,P){t(3,a=[S,P]),D([S,P]),setTimeout(()=>{t(2,o=!0),t(10,c=[S*50+"px",P*50+50+"px"])},500)}function d([S,P],[T,x]){return(S-a[0])*(S-T)<=0&&(P-a[1])*(P-x)<=0}function D(S){t(4,i=i.map((P,T)=>P.map((x,M)=>d([T,M],S))))}function g(){t(2,o=!1),t(4,i=Array(l[0]).fill(0).map(S=>Array(l[1]).fill(!1)))}function y(S){on.call(this,s,S)}function w(S){on.call(this,s,S)}function _(S){on.call(this,s,S)}const v=(S,P)=>h(S,P),B=(S,P)=>h(S,P);return s.$$set=S=>{"grid"in S&&t(0,l=S.grid),"inStudio"in S&&t(1,f=S.inStudio)},s.$$.update=()=>{s.$$.dirty&1&&t(7,n=`repeat(${l[1]}, 1fr)`),s.$$.dirty&1&&t(6,r=`repeat(${l[0]}, 1fr)`),s.$$.dirty&1&&t(4,i=Array(l[0]).fill(0).map(S=>Array(l[1]).fill(!1))),s.$$.dirty&1028&&t(5,u=`top: ${c[0]}; left: ${c[1]}; visibility: ${o?"visible":"hidden"};`)},[l,f,o,a,i,u,r,n,h,g,c,y,w,_,v,B]}class Vd extends te{constructor(e){super(),ne(this,e,Kd,Qd,J,{grid:0,inStudio:1})}}function Ii(s){let e,t,n;return t=new aa({props:{doc:s[0]}}),{c(){e=m("div"),L(t.$$.fragment),b(e,"class","attachmentbox svelte-1uwh7a0")},m(r,i){A(r,e,i),U(t,e,null),n=!0},p(r,i){const u={};i&1&&(u.doc=r[0]),t.$set(u)},i(r){n||(E(t.$$.fragment,r),n=!0)},o(r){k(t.$$.fragment,r),n=!1},d(r){r&&C(e),z(t)}}}function Pi(s){let e,t,n;return t=new ca({props:{doc:s[0],inStudio:s[3]}}),{c(){e=m("div"),L(t.$$.fragment)},m(r,i){A(r,e,i),U(t,e,null),n=!0},p(r,i){const u={};i&1&&(u.doc=r[0]),i&8&&(u.inStudio=r[3]),t.$set(u)},i(r){n||(E(t.$$.fragment,r),n=!0)},o(r){k(t.$$.fragment,r),n=!1},d(r){r&&C(e),z(t)}}}function Gd(s){let e,t,n,r,i,u,l,a,o,c=s[1]&&Ii(s),f=s[2]&&Pi(s);return{c(){e=m("h4"),e.textContent="Title placeholder",t=F(),n=m("div"),c&&c.c(),r=F(),f&&f.c(),i=F(),u=m("button"),u.textContent="close",b(e,"class","mt-12"),b(n,"class","flex flex-row justify-between w-full"),b(u,"class","top-right svelte-1uwh7a0")},m(h,d){A(h,e,d),A(h,t,d),A(h,n,d),c&&c.m(n,null),p(n,r),f&&f.m(n,null),A(h,i,d),A(h,u,d),l=!0,a||(o=H(u,"click",s[4]),a=!0)},p(h,[d]){h[1]?c?(c.p(h,d),d&2&&E(c,1)):(c=Ii(h),c.c(),E(c,1),c.m(n,r)):c&&(Q(),k(c,1,1,()=>{c=null}),K()),h[2]?f?(f.p(h,d),d&4&&E(f,1)):(f=Pi(h),f.c(),E(f,1),f.m(n,null)):f&&(Q(),k(f,1,1,()=>{f=null}),K())},i(h){l||(E(c),E(f),l=!0)},o(h){k(c),k(f),l=!1},d(h){h&&C(e),h&&C(t),h&&C(n),c&&c.d(),f&&f.d(),h&&C(i),h&&C(u),a=!1,o()}}}function Zd(s,e,t){const n=tt();let{selectedDocument:r}=e,{attachment:i=!0}=e,{reply:u=!0}=e,{inStudio:l=!1}=e;function a(){n("close")}return s.$$set=o=>{"selectedDocument"in o&&t(0,r=o.selectedDocument),"attachment"in o&&t(1,i=o.attachment),"reply"in o&&t(2,u=o.reply),"inStudio"in o&&t(3,l=o.inStudio)},[r,i,u,l,a]}class Yd extends te{constructor(e){super(),ne(this,e,Zd,Gd,J,{selectedDocument:0,attachment:1,reply:2,inStudio:3})}}function Xd(s){let e,t,n,r,i;return{c(){e=m("div"),t=m("img"),$e(t.src,n=s[1][s[2]])||b(t,"src",n),b(t,"alt","document icon"),b(t,"class","svelte-cgxyx9")},m(u,l){A(u,e,l),p(e,t),r||(i=[H(e,"click",s[3]),H(e,"keypress",s[3])],r=!0)},p:$,d(u){u&&C(e),r=!1,ke(i)}}}function Jd(s){let e,t,n;return{c(){e=m("div"),t=m("img"),$e(t.src,n=s[1][s[2]])||b(t,"src",n),b(t,"alt","document icon"),Se(t,"filter","blur(1px)"),b(t,"class","svelte-cgxyx9")},m(r,i){A(r,e,i),p(e,t)},p:$,d(r){r&&C(e)}}}function e0(s){let e;function t(i,u){return i[0]?Jd:Xd}let n=t(s),r=n(s);return{c(){r.c(),e=ie()},m(i,u){r.m(i,u),A(i,e,u)},p(i,[u]){n===(n=t(i))&&r?r.p(i,u):(r.d(1),r=n(i),r&&(r.c(),r.m(e.parentNode,e)))},i:$,o:$,d(i){r.d(i),i&&C(e)}}}function t0(s,e,t){const n=tt();let r=["icons/mountain-phase-0-02.png","icons/mountain-phase-1-02.png","icons/mountain-phase-2-02.png","icons/mountain-phase-3-02.png","icons/mountain-phase-4-02.png","icons/mountain-phase-5-02.png","icons/mountain-phase-6-02.png","icons/mountain-phase-7-02.png","icons/mountain-phase-8-02.png"],{doc:i}=e,{disabled:u=!1}=e,l=i.deleteAfter,a=Math.floor((l-Date.now())/(25488e8/9))%9;function o(c){console.log("clicked"),n("click",c)}return s.$$set=c=>{"doc"in c&&t(4,i=c.doc),"disabled"in c&&t(0,u=c.disabled)},[u,r,a,o,i]}class hr extends te{constructor(e){super(),ne(this,e,t0,e0,J,{doc:4,disabled:0})}}function xi(s,e,t){const n=s.slice();return n[36]=e[t],n[38]=t,n}function Ri(s,e,t){const n=s.slice();return n[39]=e[t],n[41]=t,n}function Oi(s,e,t){const n=s.slice();return n[39]=e[t],n[43]=t,n}function $i(s,e,t){const n=s.slice();return n[44]=e[t],n}function Mi(s){let e,t,n;function r(l,a){return l[1]?n0:r0}let i=r(s),u=i(s);return{c(){e=m("button"),u.c(),b(e,"class","topleft m-6")},m(l,a){A(l,e,a),u.m(e,null),t||(n=H(e,"click",s[19]),t=!0)},p(l,a){i===(i=r(l))&&u?u.p(l,a):(u.d(1),u=i(l),u&&(u.c(),u.m(e,null)))},d(l){l&&C(e),u.d(),t=!1,n()}}}function n0(s){let e;return{c(){e=j("Hide details")},m(t,n){A(t,e,n)},p:$,d(t){t&&C(e)}}}function r0(s){let e=s[12].address.slice(0,5)+"",t;return{c(){t=j(e)},m(n,r){A(n,t,r)},p(n,r){r[0]&4096&&e!==(e=n[12].address.slice(0,5)+"")&&ce(t,e)},d(n){n&&C(t)}}}function ji(s){let e,t,n;return t=new la({props:{doc:s[6],attachment:s[3],isReply:s[4]}}),{c(){e=m("div"),L(t.$$.fragment)},m(r,i){A(r,e,i),U(t,e,null),n=!0},p(r,i){const u={};i[0]&64&&(u.doc=r[6]),i[0]&8&&(u.attachment=r[3]),i[0]&16&&(u.isReply=r[4]),t.$set(u)},i(r){n||(E(t.$$.fragment,r),n=!0)},o(r){k(t.$$.fragment,r),n=!1},d(r){r&&C(e),z(t)}}}function s0(s){let e;return{c(){e=j("Back to viewing")},m(t,n){A(t,e,n)},d(t){t&&C(e)}}}function i0(s){let e;return{c(){e=j("Place an artefact")},m(t,n){A(t,e,n)},d(t){t&&C(e)}}}function u0(s){let e,t,n;return t=new Vd({props:{inStudio:s[0]}}),t.$on("success",s[24]),t.$on("upload",s[25]),{c(){e=m("div"),L(t.$$.fragment)},m(r,i){A(r,e,i),U(t,e,null),n=!0},p(r,i){const u={};i[0]&1&&(u.inStudio=r[0]),t.$set(u)},i(r){n||(E(t.$$.fragment,r),n=!0)},o(r){k(t.$$.fragment,r),n=!1},d(r){r&&C(e),z(t)}}}function a0(s){let e,t,n;return t=new Yd({props:{selectedDocument:s[6]}}),t.$on("close",s[23]),{c(){e=m("div"),L(t.$$.fragment),b(e,"class","artifact-overlay mt-[15vh] h-[80vh] w-4/5 fixed svelte-917e9f")},m(r,i){A(r,e,i),U(t,e,null),n=!0},p(r,i){const u={};i[0]&64&&(u.selectedDocument=r[6]),t.$set(u)},i(r){n||(E(t.$$.fragment,r),n=!0)},o(r){k(t.$$.fragment,r),n=!1},d(r){r&&C(e),z(t)}}}function l0(s){let e=[],t=new Map,n,r,i=s[14];const u=l=>l[38];for(let l=0;l<i.length;l+=1){let a=xi(s,i,l),o=u(a);t.set(o,e[l]=Hi(o,a))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();n=ie()},m(l,a){for(let o=0;o<e.length;o+=1)e[o].m(l,a);A(l,n,a),r=!0},p(l,a){a[0]&257056&&(i=l[14],Q(),e=Rt(e,a,u,1,l,i,t,n.parentNode,jn,Hi,n,xi),K())},i(l){if(!r){for(let a=0;a<i.length;a+=1)E(e[a]);r=!0}},o(l){for(let a=0;a<e.length;a+=1)k(e[a]);r=!1},d(l){for(let a=0;a<e.length;a+=1)e[a].d(l);l&&C(n)}}}function o0(s){let e;return{c(){e=m("p"),e.textContent="No files yet"},m(t,n){A(t,e,n)},p:$,i:$,o:$,d(t){t&&C(e)}}}function Ni(s){let e=[],t=new Map,n,r;function i(...a){return s[26](s[41],s[43],...a)}let u=s[5].filter(i);const l=a=>a[44].textHash+a[44].timestamp;for(let a=0;a<u.length;a+=1){let o=$i(s,u,a),c=l(o);t.set(c,e[a]=Li(c,o))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=ie()},m(a,o){for(let c=0;c<e.length;c+=1)e[c].m(a,o);A(a,n,o),r=!0},p(a,o){s=a,o[0]&188448&&(u=s[5].filter(i),Q(),e=Rt(e,o,l,1,s,u,t,n.parentNode,jn,Li,n,$i),K())},i(a){if(!r){for(let o=0;o<u.length;o+=1)E(e[o]);r=!0}},o(a){for(let o=0;o<e.length;o+=1)k(e[o]);r=!1},d(a){for(let o=0;o<e.length;o+=1)e[o].d(a);a&&C(n)}}}function c0(s){let e,t;function n(){return s[28](s[44])}return e=new hr({props:{doc:s[44]}}),e.$on("click",n),{c(){L(e.$$.fragment)},m(r,i){U(e,r,i),t=!0},p(r,i){s=r;const u={};i[0]&32&&(u.doc=s[44]),e.$set(u)},i(r){t||(E(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){z(e,r)}}}function f0(s){let e,t;return e=new hr({props:{doc:s[44],disabled:!0}}),{c(){L(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,r){const i={};r[0]&32&&(i.doc=n[44]),e.$set(i)},i(n){t||(E(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function h0(s){let e,t,n,r;const i=[p0,d0],u=[];function l(a,o){return a[15]<a[44].deleteAfter-a[36]?1:0}return e=l(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(a,o){u[e].m(a,o),A(a,n,o),r=!0},p(a,o){let c=e;e=l(a),e===c?u[e].p(a,o):(Q(),k(u[c],1,1,()=>{u[c]=null}),K(),t=u[e],t?t.p(a,o):(t=u[e]=i[e](a),t.c()),E(t,1),t.m(n.parentNode,n))},i(a){r||(E(t),r=!0)},o(a){k(t),r=!1},d(a){u[e].d(a),a&&C(n)}}}function d0(s){let e,t;function n(){return s[27](s[44])}return e=new hr({props:{doc:s[44]}}),e.$on("click",n),{c(){L(e.$$.fragment)},m(r,i){U(e,r,i),t=!0},p(r,i){s=r;const u={};i[0]&32&&(u.doc=s[44]),e.$set(u)},i(r){t||(E(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){z(e,r)}}}function p0(s){let e,t;return e=new hr({props:{doc:s[44],disabled:!0}}),{c(){L(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,r){const i={};r[0]&32&&(i.doc=n[44]),e.$set(i)},i(n){t||(E(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function Li(s,e){let t,n,r,i,u;const l=[h0,f0,c0],a=[];function o(c,f){return c[36]==c[14][0]?0:c[15]<c[44].deleteAfter-c[36]&&c[15]>c[44].deleteAfter-(c[36]+63936e7)?2:1}return n=o(e),r=a[n]=l[n](e),{key:s,first:null,c(){t=m("div"),r.c(),b(t,"id",i=e[44].textHash+e[44].timestamp),b(t,"class","svelte-917e9f"),this.first=t},m(c,f){A(c,t,f),a[n].m(t,null),u=!0},p(c,f){e=c;let h=n;n=o(e),n===h?a[n].p(e,f):(Q(),k(a[h],1,1,()=>{a[h]=null}),K(),r=a[n],r?r.p(e,f):(r=a[n]=l[n](e),r.c()),E(r,1),r.m(t,null)),(!u||f[0]&32&&i!==(i=e[44].textHash+e[44].timestamp))&&b(t,"id",i)},i(c){u||(E(r),u=!0)},o(c){k(r),u=!1},d(c){c&&C(t),a[n].d()}}}function Ui(s,e){let t,n=e[41]+"",r,i,u=e[43]+"",l,a,o=e[5].find(f),c;function f(...d){return e[21](e[41],e[43],...d)}let h=o&&Ni(e);return{key:s,first:null,c(){t=m("div"),r=j(n),i=j(","),l=j(u),a=F(),h&&h.c(),b(t,"class","grid-cell svelte-917e9f"),this.first=t},m(d,D){A(d,t,D),p(t,r),p(t,i),p(t,l),p(t,a),h&&h.m(t,null),c=!0},p(d,D){e=d,D[0]&32&&(o=e[5].find(f)),o?h?(h.p(e,D),D[0]&32&&E(h,1)):(h=Ni(e),h.c(),E(h,1),h.m(t,null)):h&&(Q(),k(h,1,1,()=>{h=null}),K())},i(d){c||(E(h),c=!0)},o(d){k(h),c=!1},d(d){d&&C(t),h&&h.d()}}}function zi(s,e){let t,n=[],r=new Map,i,u,l={length:e[13][1]};const a=o=>o[43];for(let o=0;o<l.length;o+=1){let c=Oi(e,l,o),f=a(c);r.set(f,n[o]=Ui(f,c))}return{key:s,first:null,c(){t=ie();for(let o=0;o<n.length;o+=1)n[o].c();i=ie(),this.first=t},m(o,c){A(o,t,c);for(let f=0;f<n.length;f+=1)n[f].m(o,c);A(o,i,c),u=!0},p(o,c){e=o,c[0]&188448&&(l={length:e[13][1]},Q(),n=Rt(n,c,a,1,e,l,r,i.parentNode,jn,Ui,i,Oi),K())},i(o){if(!u){for(let c=0;c<l.length;c+=1)E(n[c]);u=!0}},o(o){for(let c=0;c<n.length;c+=1)k(n[c]);u=!1},d(o){o&&C(t);for(let c=0;c<n.length;c+=1)n[c].d(o);o&&C(i)}}}function Hi(s,e){let t,n=[],r=new Map,i,u,l={length:e[13][0]};const a=o=>o[41];for(let o=0;o<l.length;o+=1){let c=Ri(e,l,o),f=a(c);r.set(f,n[o]=zi(f,c))}return{key:s,first:null,c(){t=m("div");for(let o=0;o<n.length;o+=1)n[o].c();i=F(),b(t,"class","my-grid-container w-screen svelte-917e9f"),Se(t,"grid-template-rows",e[10]),Se(t,"grid-template-columns",e[11]),Se(t,"background-color",e[16][e[38]]),this.first=t},m(o,c){A(o,t,c);for(let f=0;f<n.length;f+=1)n[f].m(t,null);p(t,i),u=!0},p(o,c){e=o,c[0]&188448&&(l={length:e[13][0]},Q(),n=Rt(n,c,a,1,e,l,r,t,jn,zi,i,Ri),K()),(!u||c[0]&1024)&&Se(t,"grid-template-rows",e[10]),(!u||c[0]&2048)&&Se(t,"grid-template-columns",e[11])},i(o){if(!u){for(let c=0;c<l.length;c+=1)E(n[c]);u=!0}},o(o){for(let c=0;c<n.length;c+=1)k(n[c]);u=!1},d(o){o&&C(t);for(let c=0;c<n.length;c+=1)n[c].d()}}}function D0(s){let e,t,n,r,i,u=s[6]?`Grid [${s[7]}, ${s[8]}]`:"No document selected",l,a,o,c,f,h,d,D,g,y,w,_,v,B,S,P,T=s[2]&&Mi(s),x=s[6]&&ji(s);function M(re,Fe){return re[9]?i0:s0}let q=M(s),W=q(s);const ue=[a0,u0],ae=[];function Ke(re,Fe){return re[6]?0:re[9]?-1:1}~(D=Ke(s))&&(g=ae[D]=ue[D](s));const ve=[o0,l0],Pe=[];function ze(re,Fe){return re[5].length===0?0:1}return _=ze(s),v=Pe[_]=ve[_](s),{c(){e=m("div"),T&&T.c(),t=F(),n=m("div"),r=m("div"),i=m("p"),l=j(u),a=F(),x&&x.c(),o=F(),c=m("button"),W.c(),f=F(),h=m("div"),d=m("div"),g&&g.c(),y=F(),w=m("div"),v.c(),b(e,"class","w-screen flex flex-row justify-end h-[10vh]"),b(c,"class","mb-12"),b(r,"class","mx-1 mt-12 w-1/5 paper-yellow flex flex-col p-8 h-[80vh] fixed"),b(w,"class","flex flex-col w-screen"),b(d,"class","my-grid-container-wrapper svelte-917e9f"),b(h,"class","w-4/5 mt-12 ml-auto"),b(n,"class","the-scroll flex min-h-screen overflow-y-auto svelte-917e9f")},m(re,Fe){A(re,e,Fe),T&&T.m(e,null),A(re,t,Fe),A(re,n,Fe),p(n,r),p(r,i),p(i,l),p(r,a),x&&x.m(r,null),p(r,o),p(r,c),W.m(c,null),p(n,f),p(n,h),p(h,d),~D&&ae[D].m(d,null),p(d,y),p(d,w),Pe[_].m(w,null),B=!0,S||(P=[H(e,"click",s[22]),H(e,"keydown",s[20]),H(c,"click",s[18])],S=!0)},p(re,Fe){re[2]?T?T.p(re,Fe):(T=Mi(re),T.c(),T.m(e,null)):T&&(T.d(1),T=null),(!B||Fe[0]&448)&&u!==(u=re[6]?`Grid [${re[7]}, ${re[8]}]`:"No document selected")&&ce(l,u),re[6]?x?(x.p(re,Fe),Fe[0]&64&&E(x,1)):(x=ji(re),x.c(),E(x,1),x.m(r,o)):x&&(Q(),k(x,1,1,()=>{x=null}),K()),q!==(q=M(re))&&(W.d(1),W=q(re),W&&(W.c(),W.m(c,null)));let V=D;D=Ke(re),D===V?~D&&ae[D].p(re,Fe):(g&&(Q(),k(ae[V],1,1,()=>{ae[V]=null}),K()),~D?(g=ae[D],g?g.p(re,Fe):(g=ae[D]=ue[D](re),g.c()),E(g,1),g.m(d,y)):g=null);let he=_;_=ze(re),_===he?Pe[_].p(re,Fe):(Q(),k(Pe[he],1,1,()=>{Pe[he]=null}),K(),v=Pe[_],v?v.p(re,Fe):(v=Pe[_]=ve[_](re),v.c()),E(v,1),v.m(w,null))},i(re){B||(E(x),E(g),E(v),B=!0)},o(re){k(x),k(g),k(v),B=!1},d(re){re&&C(e),T&&T.d(),re&&C(t),re&&C(n),x&&x.d(),W.d(),~D&&ae[D].d(),Pe[_].d(),S=!1,ke(P)}}}function m0(s,e,t){let n,r,i,u,l;Te(s,Xu,V=>t(29,i=V)),Te(s,Ju,V=>t(30,u=V)),Te(s,ot,V=>t(12,l=V));const a=tt();let o=[9,16],c=[],f=[191808e7,127872e7,63936e7,0],h=u.getTime()*1e3,d=["#fff5d9","#d3e3d9","#F9DFDD","#CCE9F0"],{inStudio:D}=e,{showDetails:g=!0}=e,{IDcreated:y=!1}=e,{attachment:w=!0}=e,{isReply:_=!1}=e,v=!0,B=null,S,P;function T(V){t(6,B=V),console.log("selecteddoc",V)}const x=async()=>{t(5,c=i.cache.queryDocs({filter:{pathStartsWith:"/documents"}})),t(5,c=c.filter(V=>V.path.split("/").length<=6)),console.log("Docs",c)};i.cache.onCacheUpdated(()=>{x()}),xt(()=>{x()});function M(){t(9,v=!v),t(6,B=null)}function q(){a("toggle")}function W(V){V.key==="Escape"&&t(6,B=null)}const ue=(V,he,De)=>parseInt(De.path.split("/")[2])==V&&parseInt(De.path.split("/")[3])==he,ae=()=>t(6,B=null),Ke=()=>t(6,B=null),ve=()=>t(9,v=!v),Pe=()=>t(9,v=!v),ze=(V,he,De)=>parseInt(De.path.split("/")[2])==V&&parseInt(De.path.split("/")[3])==he,re=V=>T(V),Fe=V=>T(V);return s.$$set=V=>{"inStudio"in V&&t(0,D=V.inStudio),"showDetails"in V&&t(1,g=V.showDetails),"IDcreated"in V&&t(2,y=V.IDcreated),"attachment"in V&&t(3,w=V.attachment),"isReply"in V&&t(4,_=V.isReply)},s.$$.update=()=>{if(s.$$.dirty[0]&448&&B){let V=B.path.split("/");t(7,S=V[2]),t(8,P=V[3]),console.log("selectedX",S),console.log("selectedY",P),console.log("selectedDocument",B)}s.$$.dirty[0]&32&&t(5,c)},t(11,n="repeat("+o[1]+", minmax(min-content, 1fr))"),t(10,r="repeat("+o[0]+", minmax(min-content, 1fr))"),[D,g,y,w,_,c,B,S,P,v,r,n,l,o,f,h,d,T,M,q,W,ue,ae,Ke,ve,Pe,ze,re,Fe]}class g0 extends te{constructor(e){super(),ne(this,e,m0,D0,J,{inStudio:0,showDetails:1,IDcreated:2,attachment:3,isReply:4},null,[-1,-1])}}function qi(s,e,t){const n=s.slice();return n[10]=e[t],n}function Wi(s){let e,t,n,r,i,u,l,a,o,c,f,h,d,D,g,y,w,_,v,B,S,P,T,x,M,q,W=s[1]&&Qi(s);return{c(){e=m("div"),t=m("div"),n=m("h4"),r=j("Status: "),i=m("strong"),i.textContent=`${s[3].status}`,u=F(),l=m("h4"),a=j("Share "),o=m("strong"),o.textContent=`${s[8]}`,c=F(),f=m("div"),h=m("h4"),h.textContent="Documents",d=F(),D=m("p"),g=m("strong"),g.textContent=`${s[5]}`,y=j(" documents sent"),w=F(),_=m("p"),v=m("strong"),v.textContent=`${s[6]}`,B=j(" documents received"),S=F(),P=m("p"),T=m("strong"),T.textContent=`${s[7]}`,x=j(" documents requested"),M=F(),W&&W.c(),q=ie(),b(t,"class","flex-col py-4"),b(D,"class","svelte-1vxr72o"),b(_,"class","svelte-1vxr72o"),b(P,"class","svelte-1vxr72o"),b(f,"class","flex-col items-center py-4"),b(e,"class","flex flex-col")},m(ue,ae){A(ue,e,ae),p(e,t),p(t,n),p(n,r),p(n,i),p(t,u),p(t,l),p(l,a),p(l,o),p(e,c),p(e,f),p(f,h),p(f,d),p(f,D),p(D,g),p(D,y),p(f,w),p(f,_),p(_,v),p(_,B),p(f,S),p(f,P),p(P,T),p(P,x),A(ue,M,ae),W&&W.m(ue,ae),A(ue,q,ae)},p(ue,ae){ue[1]?W?W.p(ue,ae):(W=Qi(ue),W.c(),W.m(q.parentNode,q)):W&&(W.d(1),W=null)},d(ue){ue&&C(e),ue&&C(M),W&&W.d(ue),ue&&C(q)}}}function Qi(s){let e,t,n,r=[],i=new Map,u=s[4];const l=a=>a[10].hash;for(let a=0;a<u.length;a+=1){let o=qi(s,u,a),c=l(o);i.set(c,r[a]=Ki(c,o))}return{c(){e=m("h4"),e.textContent=`${s[4].length}  ${s[4]>1?"Attachments":"Attachment"}`,t=F(),n=m("div");for(let a=0;a<r.length;a+=1)r[a].c();b(e,"class","py-4"),b(n,"class","flex flex-col py-4 h-50vh overflow-y-scroll svelte-1vxr72o")},m(a,o){A(a,e,o),A(a,t,o),A(a,n,o);for(let c=0;c<r.length;c+=1)r[c].m(n,null)},p(a,o){o&16&&(u=a[4],r=Rt(r,o,l,1,a,u,i,n,Or,Ki,null,qi))},d(a){a&&C(e),a&&C(t),a&&C(n);for(let o=0;o<r.length;o+=1)r[o].d()}}}function Ki(s,e){let t,n,r,i=e[10].kind+"",u,l,a,o=e[10].status+"",c,f,h,d,D,g=e[10].bytesLoaded+"",y,w,_,v,B,S=e[10].totalBytes+"",P,T,x,M,q,W=e[10].author.slice(0,9)+"",ue,ae,Ke;return{key:s,first:null,c(){t=m("div"),n=m("h5"),r=m("span"),u=j(i),l=F(),a=m("strong"),c=j(o),f=F(),h=m("p"),d=j("Bytes loaded: "),D=m("strong"),y=j(g),w=F(),_=m("p"),v=j("Total bytes: "),B=m("strong"),P=j(S),T=F(),x=m("p"),M=j("Author: "),q=m("strong"),ue=j(W),ae=j("..."),Ke=F(),b(r,"class","kind svelte-1vxr72o"),b(h,"class","svelte-1vxr72o"),b(_,"class","svelte-1vxr72o"),b(x,"class","svelte-1vxr72o"),this.first=t},m(ve,Pe){A(ve,t,Pe),p(t,n),p(n,r),p(r,u),p(n,l),p(n,a),p(a,c),p(t,f),p(t,h),p(h,d),p(h,D),p(D,y),p(t,w),p(t,_),p(_,v),p(_,B),p(B,P),p(t,T),p(t,x),p(x,M),p(x,q),p(q,ue),p(q,ae),p(t,Ke)},p(ve,Pe){e=ve},d(ve){ve&&C(t)}}}function b0(s){let e,t,n,r,i,u,l,a=s[2].shareAddress+"",o,c,f,h,d,D=s[2].secret+"",g,y,w=s[0]!==void 0&&Wi(s);return{c(){e=m("div"),t=m("div"),n=m("h4"),n.textContent="Status Panel & Current Share Details",r=F(),i=m("p"),u=m("b"),u.textContent="Address:",l=F(),o=j(a),c=F(),f=m("p"),h=m("b"),h.textContent="Secret:",d=F(),g=j(D),y=F(),w&&w.c(),b(n,"class","mb-6"),b(i,"class","svelte-1vxr72o"),b(f,"class","svelte-1vxr72o"),b(t,"class","flex flex-col items-center"),b(e,"class","flex flex-col mt-8 px-8")},m(_,v){A(_,e,v),p(e,t),p(t,n),p(t,r),p(t,i),p(i,u),p(i,l),p(i,o),p(t,c),p(t,f),p(f,h),p(f,d),p(f,g),p(e,y),w&&w.m(e,null)},p(_,[v]){v&4&&a!==(a=_[2].shareAddress+"")&&ce(o,a),v&4&&D!==(D=_[2].secret+"")&&ce(g,D),_[0]!==void 0?w?w.p(_,v):(w=Wi(_),w.c(),w.m(e,null)):w&&(w.d(1),w=null)},i:$,o:$,d(_){_&&C(e),w&&w.d()}}}function w0(s,e,t){let n;Te(s,Wr,d=>t(2,n=d));let{status:r=void 0}=e,i=n.shareAddress,u=r[i].docs,l=r[i].attachments,a=!1,o=u.sentCount,c=u.receivedCount,f=u.requestedCount,h=i.slice(0,8);return s.$$set=d=>{"status"in d&&t(0,r=d.status)},s.$$.update=()=>{s.$$.dirty&1&&t(0,r)},l.length>0&&t(1,a=!0),[r,a,n,u,l,o,c,f,h]}class _0 extends te{constructor(e){super(),ne(this,e,w0,b0,J,{status:0})}}function Vi(s){let e,t,n,r,i;return{c(){e=m("input"),t=F(),n=m("button"),n.textContent="Submit address",b(e,"type","text"),b(e,"spellcheck","false"),b(e,"class","svelte-197sl4z"),b(n,"class","svelte-197sl4z")},m(u,l){A(u,e,l),rt(e,s[1]),A(u,t,l),A(u,n,l),r||(i=[H(e,"input",s[9]),H(n,"click",s[10])],r=!0)},p(u,l){l&2&&e.value!==u[1]&&rt(e,u[1])},d(u){u&&C(e),u&&C(t),u&&C(n),r=!1,ke(i)}}}function Gi(s){let e,t,n;return{c(){e=m("p"),t=m("strong"),n=j(s[3])},m(r,i){A(r,e,i),p(e,t),p(t,n)},p(r,i){i&8&&ce(n,r[3])},d(r){r&&C(e)}}}function y0(s){let e,t,n,r,i,u,l,a,o=s[4]&&Vi(s),c=s[2]&&Gi(s);return{c(){e=m("div"),t=m("input"),n=F(),r=m("button"),r.textContent="Submit address",i=F(),o&&o.c(),u=F(),c&&c.c(),b(t,"type","text"),b(t,"spellcheck","false"),b(t,"class","svelte-197sl4z"),b(r,"class","svelte-197sl4z"),b(e,"class","svelte-197sl4z")},m(f,h){A(f,e,h),p(e,t),rt(t,s[0]),p(e,n),p(e,r),p(e,i),o&&o.m(e,null),p(e,u),c&&c.m(e,null),l||(a=[H(t,"input",s[7]),H(r,"click",s[8])],l=!0)},p(f,[h]){h&1&&t.value!==f[0]&&rt(t,f[0]),f[4]?o?o.p(f,h):(o=Vi(f),o.c(),o.m(e,u)):o&&(o.d(1),o=null),f[2]?c?c.p(f,h):(c=Gi(f),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i:$,o:$,d(f){f&&C(e),o&&o.d(),c&&c.d(),l=!1,ke(a)}}}function A0(s,e,t){let n;Te(s,Wr,y=>t(11,n=y));let r="Add a new share address",i="Add the share's secret",u=!1,l,a=!1;const o=new Un;function c(y){if(R(Ot(y))){t(2,u=!0),t(3,l="Not a valid share address");return}else t(2,u=!1),o.addShare(y),Mn.set({settings:o}),t(4,a=!0),console.log("You are currently signed in as",o.author||"no-one!"),console.log("You have",o.shares.length,"shares"),console.log("Your shares are",o.shares)}async function f(){let y={address:r,secret:i};const w=await Ae.checkKeypairIsValid(y);if(console.log(r,typeof r),console.log(i,typeof i),console.log(w),R(w)){t(2,u=!0),t(3,l="Not the right secret for this share.");return}else t(2,u=!1),o.addSecret(r,i),Mn.set({settings:o}),console.log("You are currently signed in as",o.author||"no-one!"),console.log("You have",o.shares.length,"shares"),console.log("Your shares are",o.shares),console.log("You know the secret to these shares:",o.shareSecrets)}xt(()=>{n!==void 0&&(o.addShare(n.shareAddress),o.addSecret(n.shareAddress,n.secret))});function h(){r=this.value,t(0,r)}const d=()=>c(r);function D(){i=this.value,t(1,i)}return[r,i,u,l,a,c,f,h,d,D,()=>f()]}class C0 extends te{constructor(e){super(),ne(this,e,A0,y0,J,{})}}function Zi(s){let e,t,n;return{c(){e=m("p"),t=m("strong"),n=j(s[2])},m(r,i){A(r,e,i),p(e,t),p(t,n)},p(r,i){i&4&&ce(n,r[2])},d(r){r&&C(e)}}}function E0(s){let e,t,n,r,i,u,l,a=s[1]&&Zi(s);return{c(){e=m("div"),t=m("input"),n=F(),r=m("button"),r.textContent="Add server",i=F(),a&&a.c(),b(t,"type","text"),b(t,"spellcheck","false"),b(t,"class","svelte-1s47e2l"),b(r,"class","svelte-1s47e2l"),b(e,"class","svelte-1s47e2l")},m(o,c){A(o,e,c),p(e,t),rt(t,s[0]),p(e,n),p(e,r),p(e,i),a&&a.m(e,null),u||(l=[H(t,"input",s[4]),H(r,"click",s[5])],u=!0)},p(o,[c]){c&1&&t.value!==o[0]&&rt(t,o[0]),o[1]?a?a.p(o,c):(a=Zi(o),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i:$,o:$,d(o){o&&C(e),a&&a.d(),u=!1,ke(l)}}}function k0(s,e,t){let n="Add a new server URL",r=!1,i;const u=new Un;function l(c){let f=u.addServer(c);if(R(f)){t(1,r=!0),t(2,i="Not a valid server URL");return}else t(1,r=!1),Mn.set({settings:u}),console.log("You have",u.servers.length,"servers"),console.log("Your servers are",u.servers)}function a(){n=this.value,t(0,n)}return[n,r,i,l,a,()=>l(n)]}class v0 extends te{constructor(e){super(),ne(this,e,k0,E0,J,{})}}function Yi(s){let e,t;return e=new _0({props:{status:s[0]}}),{c(){L(e.$$.fragment)},m(n,r){U(e,n,r),t=!0},p(n,r){const i={};r&1&&(i.status=n[0]),e.$set(i)},i(n){t||(E(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function F0(s){let e,t,n,r,i,u,l,a,o,c,f,h,d,D,g,y,w;l=new v0({}),c=new C0({}),d=new Cc({});let _=s[0]!==void 0&&Yi(s);return{c(){e=m("div"),t=m("button"),t.textContent="Hide Details",n=F(),r=m("div"),i=m("div"),u=m("div"),L(l.$$.fragment),a=F(),o=m("div"),L(c.$$.fragment),f=F(),h=m("div"),L(d.$$.fragment),D=F(),_&&_.c(),b(t,"class","h-auto m-6"),b(e,"class","w-screen flex flex-row justify-end"),b(i,"class","mx-1 mt-12 w-1/5 paper-yellow flex flex-col p-8 h-[80vh] sticky top-0"),b(h,"class","py-12 px-2 flex flex-row justify-center w-4/5 items-start"),b(r,"class","flex min-h-screen overflow-y-auto")},m(v,B){A(v,e,B),p(e,t),A(v,n,B),A(v,r,B),p(r,i),p(i,u),U(l,u,null),p(i,a),p(i,o),U(c,o,null),p(r,f),p(r,h),U(d,h,null),p(h,D),_&&_.m(h,null),g=!0,y||(w=H(t,"click",s[1]),y=!0)},p(v,[B]){v[0]!==void 0?_?(_.p(v,B),B&1&&E(_,1)):(_=Yi(v),_.c(),E(_,1),_.m(h,null)):_&&(Q(),k(_,1,1,()=>{_=null}),K())},i(v){g||(E(l.$$.fragment,v),E(c.$$.fragment,v),E(d.$$.fragment,v),E(_),g=!0)},o(v){k(l.$$.fragment,v),k(c.$$.fragment,v),k(d.$$.fragment,v),k(_),g=!1},d(v){v&&C(e),v&&C(n),v&&C(r),z(l),z(c),z(d),_&&_.d(),y=!1,w()}}}function B0(s,e,t){let{status:n}=e;const r=tt();function i(){r("toggle")}return s.$$set=u=>{"status"in u&&t(0,n=u.status)},[n,i]}class S0 extends te{constructor(e){super(),ne(this,e,B0,F0,J,{status:0})}}function Xi(s){let e,t,n,r,i,u,l,a,o,c;r=new $d({}),r.$on("validated",s[5]),r.$on("error",s[6]),r.$on("generateNewIdentity",s[11]),l=new dc({}),l.$on("alias",s[5]),l.$on("error",s[6]);let f=s[2]===!0&&Ji();return{c(){e=m("div"),t=m("div"),n=m("div"),L(r.$$.fragment),i=F(),u=m("div"),L(l.$$.fragment),a=F(),f&&f.c(),o=ie(),b(u,"class","mb-8"),b(n,"class","flex flex-col items-start mx-6 my-12"),b(t,"class","flex flex-col lg:flex-row items-center mx-2 justify-between my-12"),b(e,"class","my-12")},m(h,d){A(h,e,d),p(e,t),p(t,n),U(r,n,null),p(n,i),p(n,u),U(l,u,null),A(h,a,d),f&&f.m(h,d),A(h,o,d),c=!0},p(h,d){h[2]===!0?f?d&4&&E(f,1):(f=Ji(),f.c(),E(f,1),f.m(o.parentNode,o)):f&&(Q(),k(f,1,1,()=>{f=null}),K())},i(h){c||(E(r.$$.fragment,h),E(l.$$.fragment,h),E(f),c=!0)},o(h){k(r.$$.fragment,h),k(l.$$.fragment,h),k(f),c=!1},d(h){h&&C(e),z(r),z(l),h&&C(a),f&&f.d(h),h&&C(o)}}}function Ji(s){let e,t,n;return{c(){e=m("blockquote"),e.textContent="There was an error with your identity file"},m(r,i){A(r,e,i),n=!0},i(r){n||(rr(()=>{t||(t=Bt(e,It,{y:200,duration:2e3},!0)),t.run(1)}),n=!0)},o(r){t||(t=Bt(e,It,{y:200,duration:2e3},!1)),t.run(0),n=!1},d(r){r&&C(e),r&&t&&t.end()}}}function T0(s){let e,t,n;return t=new S0({props:{status:s[4]}}),t.$on("toggle",s[9]),{c(){e=m("div"),L(t.$$.fragment),b(e,"class","w-full")},m(r,i){A(r,e,i),U(t,e,null),n=!0},p(r,i){const u={};i&16&&(u.status=r[4]),t.$set(u)},i(r){n||(E(t.$$.fragment,r),n=!0)},o(r){k(t.$$.fragment,r),n=!1},d(r){r&&C(e),z(t)}}}function I0(s){let e,t,n;return t=new g0({props:{inStudio:s[7],showDetails:s[1],IDcreated:s[0]}}),t.$on("toggle",s[9]),t.$on("view",s[8]),t.$on("details",s[12]),{c(){e=m("div"),L(t.$$.fragment),b(e,"class","w-full")},m(r,i){A(r,e,i),U(t,e,null),n=!0},p(r,i){const u={};i&2&&(u.showDetails=r[1]),i&1&&(u.IDcreated=r[0]),t.$set(u)},i(r){n||(E(t.$$.fragment,r),n=!0)},o(r){k(t.$$.fragment,r),n=!1},d(r){r&&C(e),z(t)}}}function P0(s){let e,t,n,r,i,u=!s[0]&&!s[1]&&Xi(s);const l=[I0,T0],a=[];function o(c,f){return c[0]&&!c[3]?0:1}return n=o(s),r=a[n]=l[n](s),{c(){e=m("main"),u&&u.c(),t=F(),r.c(),b(e,"class","svelte-l2iqfv")},m(c,f){A(c,e,f),u&&u.m(e,null),p(e,t),a[n].m(e,null),i=!0},p(c,[f]){!c[0]&&!c[1]?u?(u.p(c,f),f&3&&E(u,1)):(u=Xi(c),u.c(),E(u,1),u.m(e,t)):u&&(Q(),k(u,1,1,()=>{u=null}),K());let h=n;n=o(c),n===h?a[n].p(c,f):(Q(),k(a[h],1,1,()=>{a[h]=null}),K(),r=a[n],r?r.p(c,f):(r=a[n]=l[n](c),r.c()),E(r,1),r.m(e,null))},i(c){i||(E(u),E(r),i=!0)},o(c){k(u),k(r),i=!1},d(c){c&&C(e),u&&u.d(),a[n].d()}}}function x0(s,e,t){let n;Te(s,$t,P=>t(13,n=P));let r=!1,i=!1,u=!0,l=!1,a=!1,o;const c=new fr;c.addReplica(n.replica);const f=c.sync("https://earthstar-server.fly.dev/sync",!0),h=c.sync("https://languid-sand-parallelogram.glitch.me/",!0);f.onStatusChange(P=>{t(4,o=P),console.log(P),t(4,o)}),h.onStatusChange(P=>{t(4,o=P),console.log(P),t(4,o)}),f.isDone().then(()=>{console.log("Sync complete")}).catch(P=>{console.error("Sync failed",P)});function d(P){t(0,r=!0),t(1,i=!0)}function D(P){t(2,l=!0)}const g=new URLSearchParams(window.location.search),y=g.has("studio"),w=g.has("oracle");function _(){t(10,u=!u)}function v(){t(3,a=!a)}const B=()=>t(0,r=!r),S=()=>t(3,a=!0);return s.$$.update=()=>{s.$$.dirty&1&&console.log("IDcreated",r),s.$$.dirty&2&&console.log("showDetails",i),s.$$.dirty&1024&&console.log("imageView",u)},console.log("inStudio",y),console.log("oracle",w),[r,i,l,a,o,d,D,y,_,v,u,B,S]}class R0 extends te{constructor(e){super(),ne(this,e,x0,P0,J,{})}}new R0({target:document.getElementById("app")});
