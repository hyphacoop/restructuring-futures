var Oa=Object.defineProperty;var xa=(s,e,t)=>e in s?Oa(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var xs=(s,e,t)=>(xa(s,typeof e!="symbol"?e+"":e,t),t);import{c as rr,r as Ma,g as Na,n as $a,i as La,a as N,s as ja,b as ge,d as J,e as ro,S as Z,f as X,h as D,j as I,t as L,k as Pe,l as y,m as Oe,o as w,p as m,q as j,u as _,v as rt,w as Fr,x as ze,y as re,z as v,A as V,B as S,C as Q,D as Be,E as pt,F as An,G as Mt,H as ie,I as Ms,J as Nt,K as Ua,L as rn,M as U,N as z,O as En,P as vn,Q as H,R as _e,T as za,U as Ae,V as Ee,W as ve,X as ke,Y as so,Z as Ha,_ as Ns,$ as qa,a0 as mt,a1 as Gn,a2 as mn,a3 as it,a4 as is,a5 as Yn,a6 as $s,a7 as Wa,a8 as Ka,a9 as Va}from"./svelte-dd96ce93.js";function Qa(s,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in s)){const i=Object.getOwnPropertyDescriptor(n,r);i&&Object.defineProperty(s,r,i.get?i:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();class Qe extends Error{constructor(e){super(e||""),this.name="EarthstarError"}}class x extends Qe{constructor(e){super(e||"Validation error"),this.name="ValidationError"}}class Ce extends Qe{constructor(e){super(e||"a Replica or ReplicaDriver was used after being closed"),this.name="ReplicaIsClosedError"}}class Ht extends Qe{constructor(e){super(e||"a ReplicaCache was used after being closed"),this.name="ReplicaCacheIsClosedError"}}class Ln extends Qe{constructor(e){super(e||"Not supported"),this.name="NotSupportedError"}}function M(s){return s instanceof Qe}function io(s){return!(s instanceof Qe)}var uo={},oo={};Object.defineProperty(oo,"__esModule",{value:!0});(function(s){var e=rr&&rr.__createBinding||(Object.create?function(i,u,a,o){o===void 0&&(o=a);var l=Object.getOwnPropertyDescriptor(u,a);(!l||("get"in l?!u.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return u[a]}}),Object.defineProperty(i,o,l)}:function(i,u,a,o){o===void 0&&(o=a),i[o]=u[a]}),t=rr&&rr.__exportStar||function(i,u){for(var a in i)a!=="default"&&!Object.prototype.hasOwnProperty.call(u,a)&&e(u,i,a)};Object.defineProperty(s,"__esModule",{value:!0}),s.crypto=void 0;const r=Ma.webcrypto;s.crypto=r,t(oo,s)})(uo);var Hn={};Object.defineProperty(Hn,"__esModule",{value:!0});var Br=Hn.setInterval=en=Hn.setTimeout=void 0;const Ga=globalThis.setTimeout;function Ya(s,e,...t){const n=Ga(s,e,...t);return typeof n=="number"?n:n[Symbol.toPrimitive]()}var en=Hn.setTimeout=Ya;const Ja=globalThis.setInterval;function Za(s,e,...t){const n=Ja(s,e,...t);return typeof n=="number"?n:n[Symbol.toPrimitive]()}Br=Hn.setInterval=Za;var Ds={},zr,Ls;Object.defineProperty(Ds,"__esModule",{value:!0});var ao=Ds.WeakRef=void 0;ao=Ds.WeakRef=(zr=globalThis.WeakRef)!==null&&zr!==void 0?zr:(Ls=class{constructor(e){}deref(){throw new Error("WeakRef is not supported in Node 14 and below.")}},Ls);const{Blob:lo}=window,{Request:Xa,Response:el,Headers:tl,fetch:Rg}=window,{ReadableStream:tn,ReadableStreamDefaultReader:Og,ReadableStreamBYOBReader:xg,ReadableStreamBYOBRequest:Mg,ReadableByteStreamController:Ng,ReadableStreamDefaultController:$g,TransformStream:kn,TransformStreamDefaultController:nl,WritableStream:nt,WritableStreamDefaultWriter:rl,WritableStreamDefaultController:Lg,ByteLengthQueuingStrategy:jg,CountQueuingStrategy:Ug,TextEncoderStream:zg,TextDecoderStream:Hg}=window;if(!tn.prototype[Symbol.asyncIterator]){async function*s(){const e=this.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)return;yield n}}finally{e.releaseLock()}}tn.prototype[Symbol.asyncIterator]=s}var fn=null;typeof WebSocket<"u"?fn=WebSocket:typeof MozWebSocket<"u"?fn=MozWebSocket:typeof global<"u"?fn=global.WebSocket||global.MozWebSocket:typeof window<"u"?fn=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(fn=self.WebSocket||self.MozWebSocket);const gn=fn,{TextDecoder:co,TextEncoder:bs}=window;function js(s,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(s,n.key,n)}}function fo(s,e,t){return e&&js(s.prototype,e),t&&js(s,t),s}function Us(s,e){(e==null||e>s.length)&&(e=s.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=s[t];return n}function wr(s,e){var t=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(t)return(t=t.call(s)).next.bind(t);if(Array.isArray(s)||(t=function(r,i){if(r){if(typeof r=="string")return Us(r,i);var u=Object.prototype.toString.call(r).slice(8,-1);return u==="Object"&&r.constructor&&(u=r.constructor.name),u==="Map"||u==="Set"?Array.from(r):u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?Us(r,i):void 0}}(s))||e&&s&&typeof s.length=="number"){t&&(s=t);var n=0;return function(){return n>=s.length?{done:!0}:{done:!1,value:s[n++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var sl=/(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDEC0-\uDEEB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/,il=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/;function ul(s,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(s)}function ho(s,e){e===void 0&&(e=!1);for(var t=[],n=0;n<s.length;){var r=s[n],i=function(d){if(!e)throw new TypeError(d);t.push({type:"INVALID_CHAR",index:n,value:s[n++]})};if(r!=="*")if(r!=="+"&&r!=="?")if(r!=="\\")if(r!=="{")if(r!=="}")if(r!==":")if(r!=="(")t.push({type:"CHAR",index:n,value:s[n++]});else{var u=1,a="",o=n+1,l=!1;if(s[o]==="?"){i('Pattern cannot start with "?" at '+o);continue}for(;o<s.length;){if(!ul(s[o],!1)){i("Invalid character '"+s[o]+"' at "+o+"."),l=!0;break}if(s[o]!=="\\"){if(s[o]===")"){if(--u==0){o++;break}}else if(s[o]==="("&&(u++,s[o+1]!=="?")){i("Capturing groups are not allowed at "+o),l=!0;break}a+=s[o++]}else a+=s[o++]+s[o++]}if(l)continue;if(u){i("Unbalanced pattern at "+n);continue}if(!a){i("Missing pattern at "+n);continue}t.push({type:"PATTERN",index:n,value:a}),n=o}else{for(var c="",f=n+1;f<s.length;){var h=s.substr(f,1);if(!(f===n+1&&sl.test(h)||f!==n+1&&il.test(h)))break;c+=s[f++]}if(!c){i("Missing parameter name at "+n);continue}t.push({type:"NAME",index:n,value:c}),n=f}else t.push({type:"CLOSE",index:n,value:s[n++]});else t.push({type:"OPEN",index:n,value:s[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:s[n++]});else t.push({type:"MODIFIER",index:n,value:s[n++]});else t.push({type:"ASTERISK",index:n,value:s[n++]})}return t.push({type:"END",index:n,value:""}),t}function po(s,e){e===void 0&&(e={});for(var t=ho(s),n=e.prefixes,r=n===void 0?"./":n,i="[^"+hn(e.delimiter||"/#?")+"]+?",u=[],a=0,o=0,l="",c=new Set,f=function(W){if(o<t.length&&t[o].type===W)return t[o++].value},h=function(){return f("MODIFIER")||f("ASTERISK")},d=function(W){var le=f(W);if(le!==void 0)return le;var ue=t[o];throw new TypeError("Unexpected "+ue.type+" at "+ue.index+", expected "+W)},p=function(){for(var W,le="";W=f("CHAR")||f("ESCAPED_CHAR");)le+=W;return le},g=e.encodePart||function(W){return W};o<t.length;){var C=f("CHAR"),b=f("NAME"),A=f("PATTERN");if(b||A||!f("ASTERISK")||(A=".*"),b||A){var E=C||"";r.indexOf(E)===-1&&(l+=E,E=""),l&&(u.push(g(l)),l="");var B=b||a++;if(c.has(B))throw new TypeError("Duplicate name '"+B+"'.");c.add(B),u.push({name:B,prefix:g(E),suffix:"",pattern:A||i,modifier:h()||""})}else{var k=C||f("ESCAPED_CHAR");if(k)l+=k;else if(f("OPEN")){var F=p(),T=f("NAME")||"",P=f("PATTERN")||"";T||P||!f("ASTERISK")||(P=".*");var R=p();d("CLOSE");var $=h()||"";if(!T&&!P&&!$){l+=F;continue}if(!T&&!P&&!F)continue;l&&(u.push(g(l)),l=""),u.push({name:T||(P?a++:""),pattern:T&&!P?i:P,prefix:g(F),suffix:g(R),modifier:$})}else l&&(u.push(g(l)),l=""),d("END")}}return u}function hn(s){return s.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function mo(s){return s&&s.sensitive?"u":"ui"}function go(s,e,t){t===void 0&&(t={});for(var n,r=t.strict,i=r!==void 0&&r,u=t.start,a=u===void 0||u,o=t.end,l=o===void 0||o,c=t.encode,f=c===void 0?function(k){return k}:c,h="["+hn(t.endsWith||"")+"]|$",d="["+hn(t.delimiter||"/#?")+"]",p=a?"^":"",g=wr(s);!(n=g()).done;){var C=n.value;if(typeof C=="string")p+=hn(f(C));else{var b=hn(f(C.prefix)),A=hn(f(C.suffix));C.pattern?(e&&e.push(C),p+=b||A?C.modifier==="+"||C.modifier==="*"?"(?:"+b+"((?:"+C.pattern+")(?:"+A+b+"(?:"+C.pattern+"))*)"+A+")"+(C.modifier==="*"?"?":""):"(?:"+b+"("+C.pattern+")"+A+")"+C.modifier:C.modifier==="+"||C.modifier==="*"?"((?:"+C.pattern+")"+C.modifier+")":"("+C.pattern+")"+C.modifier):p+="(?:"+b+A+")"+C.modifier}}if(l)i||(p+=d+"?"),p+=t.endsWith?"(?="+h+")":"$";else{var E=s[s.length-1],B=typeof E=="string"?d.indexOf(E[E.length-1])>-1:E===void 0;i||(p+="(?:"+d+"(?="+h+"))?"),B||(p+="(?="+d+"|"+h+")")}return new RegExp(p,mo(t))}function Do(s,e,t){return s instanceof RegExp?function(n,r){if(!r)return n;for(var i=/\((?:\?<(.*?)>)?(?!\?)/g,u=0,a=i.exec(n.source);a;)r.push({name:a[1]||u++,prefix:"",suffix:"",modifier:"",pattern:""}),a=i.exec(n.source);return n}(s,e):Array.isArray(s)?function(n,r,i){var u=n.map(function(a){return Do(a,r,i).source});return new RegExp("(?:"+u.join("|")+")",mo(i))}(s,e,t):function(n,r,i){return go(po(n,i),r,i)}(s,e,t)}var Rt={delimiter:"",prefixes:"",sensitive:!0,strict:!0},ol={delimiter:".",prefixes:"",sensitive:!0,strict:!0},al={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function zs(s,e){return s.startsWith(e)?s.substring(e.length,s.length):s}function bo(s){return!(!s||s.length<2||s[0]!=="["&&(s[0]!=="\\"&&s[0]!=="{"||s[1]!=="["))}var te,wo=["ftp","file","http","https","ws","wss"];function _o(s){if(!s)return!0;for(var e,t=wr(wo);!(e=t()).done;)if(s.test(e.value))return!0;return!1}function yo(s){switch(s){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function ws(s){if(s==="")return s;if(/^[-+.A-Za-z0-9]*$/.test(s))return s.toLowerCase();throw new TypeError("Invalid protocol '"+s+"'.")}function ll(s){if(s==="")return s;var e=new URL("https://example.com");return e.username=s,e.username}function cl(s){if(s==="")return s;var e=new URL("https://example.com");return e.password=s,e.password}function Co(s){if(s==="")return s;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(s))throw new TypeError("Invalid hostname '"+s+"'");var e=new URL("https://example.com");return e.hostname=s,e.hostname}function Ao(s){if(s==="")return s;if(/[^0-9a-fA-F[\]:]/g.test(s))throw new TypeError("Invalid IPv6 hostname '"+s+"'");return s.toLowerCase()}function Eo(s){if(s===""||/^[0-9]*$/.test(s)&&parseInt(s)<=65535)return s;throw new TypeError("Invalid port '"+s+"'.")}function fl(s){if(s==="")return s;var e=new URL("https://example.com");return e.pathname=s[0]!=="/"?"/-"+s:s,s[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function hl(s){return s===""?s:new URL("data:"+s).pathname}function dl(s){if(s==="")return s;var e=new URL("https://example.com");return e.search=s,e.search.substring(1,e.search.length)}function pl(s){if(s==="")return s;var e=new URL("https://example.com");return e.hash=s,e.hash.substring(1,e.hash.length)}(function(s){s[s.INIT=0]="INIT",s[s.PROTOCOL=1]="PROTOCOL",s[s.AUTHORITY=2]="AUTHORITY",s[s.USERNAME=3]="USERNAME",s[s.PASSWORD=4]="PASSWORD",s[s.HOSTNAME=5]="HOSTNAME",s[s.PORT=6]="PORT",s[s.PATHNAME=7]="PATHNAME",s[s.SEARCH=8]="SEARCH",s[s.HASH=9]="HASH",s[s.DONE=10]="DONE"})(te||(te={}));var ml=function(){function s(t){this.input=void 0,this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=te.INIT,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=t}var e=s.prototype;return e.parse=function(){for(this.tokenList=ho(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===te.INIT){this.rewind(),this.isHashPrefix()?this.changeState(te.HASH,1):this.isSearchPrefix()?(this.changeState(te.SEARCH,1),this.internalResult.hash=""):(this.changeState(te.PATHNAME,0),this.internalResult.search="",this.internalResult.hash="");continue}if(this.state===te.AUTHORITY){this.rewindAndSetState(te.HOSTNAME);continue}this.changeState(te.DONE,0);break}if(this.groupDepth>0){if(!this.isGroupClose())continue;this.groupDepth-=1}if(this.isGroupOpen())this.groupDepth+=1;else switch(this.state){case te.INIT:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(te.PROTOCOL));break;case te.PROTOCOL:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();var t=te.PATHNAME,n=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(t=te.AUTHORITY,n=3):this.shouldTreatAsStandardURL&&(t=te.AUTHORITY),this.changeState(t,n)}break;case te.AUTHORITY:this.isIdentityTerminator()?this.rewindAndSetState(te.USERNAME):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(te.HOSTNAME);break;case te.USERNAME:this.isPasswordPrefix()?this.changeState(te.PASSWORD,1):this.isIdentityTerminator()&&this.changeState(te.HOSTNAME,1);break;case te.PASSWORD:this.isIdentityTerminator()&&this.changeState(te.HOSTNAME,1);break;case te.HOSTNAME:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(te.PORT,1):this.isPathnameStart()?this.changeState(te.PATHNAME,0):this.isSearchPrefix()?this.changeState(te.SEARCH,1):this.isHashPrefix()&&this.changeState(te.HASH,1);break;case te.PORT:this.isPathnameStart()?this.changeState(te.PATHNAME,0):this.isSearchPrefix()?this.changeState(te.SEARCH,1):this.isHashPrefix()&&this.changeState(te.HASH,1);break;case te.PATHNAME:this.isSearchPrefix()?this.changeState(te.SEARCH,1):this.isHashPrefix()&&this.changeState(te.HASH,1);break;case te.SEARCH:this.isHashPrefix()&&this.changeState(te.HASH,1)}}},e.changeState=function(t,n){switch(this.state){case te.INIT:break;case te.PROTOCOL:this.internalResult.protocol=this.makeComponentString();break;case te.AUTHORITY:break;case te.USERNAME:this.internalResult.username=this.makeComponentString();break;case te.PASSWORD:this.internalResult.password=this.makeComponentString();break;case te.HOSTNAME:this.internalResult.hostname=this.makeComponentString();break;case te.PORT:this.internalResult.port=this.makeComponentString();break;case te.PATHNAME:this.internalResult.pathname=this.makeComponentString();break;case te.SEARCH:this.internalResult.search=this.makeComponentString();break;case te.HASH:this.internalResult.hash=this.makeComponentString()}this.changeStateWithoutSettingComponent(t,n)},e.changeStateWithoutSettingComponent=function(t,n){this.state=t,this.componentStart=this.tokenIndex+n,this.tokenIndex+=n,this.tokenIncrement=0},e.rewind=function(){this.tokenIndex=this.componentStart,this.tokenIncrement=0},e.rewindAndSetState=function(t){this.rewind(),this.state=t},e.safeToken=function(t){return t<0&&(t=this.tokenList.length-t),t<this.tokenList.length?this.tokenList[t]:this.tokenList[this.tokenList.length-1]},e.isNonSpecialPatternChar=function(t,n){var r=this.safeToken(t);return r.value===n&&(r.type==="CHAR"||r.type==="ESCAPED_CHAR"||r.type==="INVALID_CHAR")},e.isProtocolSuffix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.nextIsAuthoritySlashes=function(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")},e.isIdentityTerminator=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")},e.isPasswordPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.isPortPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.isPathnameStart=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")},e.isSearchPrefix=function(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;var t=this.safeToken(this.tokenIndex-1);return t.type!=="NAME"&&t.type!=="PATTERN"&&t.type!=="CLOSE"&&t.type!=="ASTERISK"},e.isHashPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")},e.isGroupOpen=function(){return this.tokenList[this.tokenIndex].type=="OPEN"},e.isGroupClose=function(){return this.tokenList[this.tokenIndex].type=="CLOSE"},e.isIPv6Open=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")},e.isIPv6Close=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")},e.makeComponentString=function(){var t=this.tokenList[this.tokenIndex],n=this.safeToken(this.componentStart).index;return this.input.substring(n,t.index)},e.computeShouldTreatAsStandardURL=function(){var t={};Object.assign(t,Rt),t.encodePart=ws;var n=Do(this.makeComponentString(),void 0,t);this.shouldTreatAsStandardURL=_o(n)},fo(s,[{key:"result",get:function(){return this.internalResult}}]),s}(),gl=["protocol","username","password","hostname","port","pathname","search","hash"];function Hs(s,e){if(typeof s!="string")throw new TypeError("parameter 1 is not of type 'string'.");var t=new URL(s,e);return{protocol:t.protocol.substring(0,t.protocol.length-1),username:t.username,password:t.password,hostname:t.hostname,port:t.port,pathname:t.pathname,search:t.search!=""?t.search.substring(1,t.search.length):void 0,hash:t.hash!=""?t.hash.substring(1,t.hash.length):void 0}}function Hr(s,e,t){var n;if(typeof e.baseURL=="string")try{n=new URL(e.baseURL),s.protocol=n.protocol?n.protocol.substring(0,n.protocol.length-1):"",s.username=n.username,s.password=n.password,s.hostname=n.hostname,s.port=n.port,s.pathname=n.pathname,s.search=n.search?n.search.substring(1,n.search.length):"",s.hash=n.hash?n.hash.substring(1,n.hash.length):""}catch{throw new TypeError("invalid baseURL '"+e.baseURL+"'.")}if(typeof e.protocol=="string"&&(s.protocol=function(i,u){var a;return i=(a=i).endsWith(":")?a.substr(0,a.length-1):a,u||i===""?i:ws(i)}(e.protocol,t)),typeof e.username=="string"&&(s.username=function(i,u){if(u||i==="")return i;var a=new URL("https://example.com");return a.username=i,a.username}(e.username,t)),typeof e.password=="string"&&(s.password=function(i,u){if(u||i==="")return i;var a=new URL("https://example.com");return a.password=i,a.password}(e.password,t)),typeof e.hostname=="string"&&(s.hostname=function(i,u){return u||i===""?i:bo(i)?Ao(i):Co(i)}(e.hostname,t)),typeof e.port=="string"&&(s.port=function(i,u,a){return yo(u)===i&&(i=""),a||i===""?i:Eo(i)}(e.port,s.protocol,t)),typeof e.pathname=="string"){if(s.pathname=e.pathname,n&&!function(i,u){return!(!i.length||i[0]!=="/"&&(!u||i.length<2||i[0]!="\\"&&i[0]!="{"||i[1]!="/"))}(s.pathname,t)){var r=n.pathname.lastIndexOf("/");r>=0&&(s.pathname=n.pathname.substring(0,r+1)+s.pathname)}s.pathname=function(i,u,a){if(a||i==="")return i;if(u&&!wo.includes(u))return new URL(u+":"+i).pathname;var o=i[0]=="/";return i=new URL(o?i:"/-"+i,"https://example.com").pathname,o||(i=i.substring(2,i.length)),i}(s.pathname,s.protocol,t)}return typeof e.search=="string"&&(s.search=function(i,u){if(i=zs(i,"?"),u||i==="")return i;var a=new URL("https://example.com");return a.search=i,a.search?a.search.substring(1,a.search.length):""}(e.search,t)),typeof e.hash=="string"&&(s.hash=function(i,u){if(i=zs(i,"#"),u||i==="")return i;var a=new URL("https://example.com");return a.hash=i,a.hash?a.hash.substring(1,a.hash.length):""}(e.hash,t)),s}function Tn(s){return s.replace(/([+*?:{}()\\])/g,"\\$1")}function Dl(s,e){for(var t="[^"+(e.delimiter||"/#?").replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")+"]+?",n=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/,r="",i=0;i<s.length;++i){var u=s[i],a=i>0?s[i-1]:null,o=i<s.length-1?s[i+1]:null;if(typeof u!="string")if(u.pattern!==""){var l=typeof u.name!="number",c=e.prefixes!==void 0?e.prefixes:"./",f=u.suffix!==""||u.prefix!==""&&(u.prefix.length!==1||!c.includes(u.prefix));f||!l||u.pattern!==t||u.modifier!==""||!o||o.prefix||o.suffix||(f=typeof o=="string"?n.test(o.length>0?o[0]:""):typeof o.name=="number"),!f&&u.prefix===""&&a&&typeof a=="string"&&a.length>0&&(f=c.includes(a[a.length-1])),f&&(r+="{"),r+=Tn(u.prefix),l&&(r+=":"+u.name),u.pattern===".*"?r+=l||a&&typeof a!="string"&&!a.modifier&&!f&&u.prefix===""?"(.*)":"*":u.pattern===t?l||(r+="("+t+")"):r+="("+u.pattern+")",u.pattern===t&&l&&u.suffix!==""&&n.test(u.suffix[0])&&(r+="\\"),r+=Tn(u.suffix),f&&(r+="}"),r+=u.modifier}else{if(u.modifier===""){r+=Tn(u.prefix);continue}r+="{"+Tn(u.prefix)+"}"+u.modifier}else r+=Tn(u)}return r}var bl=function(){function s(t,n){t===void 0&&(t={}),this.pattern=void 0,this.regexp={},this.keys={},this.component_pattern={};try{if(typeof t=="string"){var r=new ml(t);if(r.parse(),t=r.result,n){if(typeof n!="string")throw new TypeError("'baseURL' parameter is not of type 'string'.");t.baseURL=n}else if(typeof t.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if(n)throw new TypeError("parameter 1 is not of type 'string'.");if(!t||typeof t!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");var i;this.pattern=Hr({pathname:"*",protocol:"*",username:"*",password:"*",hostname:"*",port:"*",search:"*",hash:"*"},t,!0),yo(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");for(var u,a=wr(gl);!(u=a()).done;)if((i=u.value)in this.pattern){var o={},l=this.pattern[i];switch(this.keys[i]=[],i){case"protocol":Object.assign(o,Rt),o.encodePart=ws;break;case"username":Object.assign(o,Rt),o.encodePart=ll;break;case"password":Object.assign(o,Rt),o.encodePart=cl;break;case"hostname":Object.assign(o,ol),o.encodePart=bo(l)?Ao:Co;break;case"port":Object.assign(o,Rt),o.encodePart=Eo;break;case"pathname":_o(this.regexp.protocol)?(Object.assign(o,al),o.encodePart=fl):(Object.assign(o,Rt),o.encodePart=hl);break;case"search":Object.assign(o,Rt),o.encodePart=dl;break;case"hash":Object.assign(o,Rt),o.encodePart=pl}try{var c=po(l,o);this.regexp[i]=go(c,this.keys[i],o),this.component_pattern[i]=Dl(c,o)}catch{throw new TypeError("invalid "+i+" pattern '"+this.pattern[i]+"'.")}}}catch(f){throw new TypeError("Failed to construct 'URLPattern': "+f.message)}}var e=s.prototype;return e.test=function(t,n){t===void 0&&(t={});var r,i={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&n)throw new TypeError("parameter 1 is not of type 'string'.");if(t===void 0)return!1;try{i=Hr(i,typeof t=="object"?t:Hs(t,n),!1)}catch{return!1}for(r in this.pattern)if(!this.regexp[r].exec(i[r]))return!1;return!0},e.exec=function(t,n){t===void 0&&(t={});var r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&n)throw new TypeError("parameter 1 is not of type 'string'.");if(t!==void 0){try{r=Hr(r,typeof t=="object"?t:Hs(t,n),!1)}catch{return null}var i,u={};for(i in u.inputs=n?[t,n]:[t],this.pattern){var a=this.regexp[i].exec(r[i]);if(!a)return null;for(var o,l={},c=wr(this.keys[i].entries());!(o=c()).done;){var f=o.value,h=f[1];typeof h.name!="string"&&typeof h.name!="number"||(l[h.name]=a[f[0]+1]||"")}u[i]={input:r[i]||"",groups:l}}return u}},fo(s,[{key:"protocol",get:function(){return this.component_pattern.protocol}},{key:"username",get:function(){return this.component_pattern.username}},{key:"password",get:function(){return this.component_pattern.password}},{key:"hostname",get:function(){return this.component_pattern.hostname}},{key:"port",get:function(){return this.component_pattern.port}},{key:"pathname",get:function(){return this.component_pattern.pathname}},{key:"search",get:function(){return this.component_pattern.search}},{key:"hash",get:function(){return this.component_pattern.hash}}]),s}();const wl={crypto:uo.crypto,setInterval:Br,setTimeout:en,WeakRef:ao,Blob:lo,Request:Xa,Response:el,Headers:tl,WritableStream:nt,TransformStream:kn,ReadableStream:tn,TransformStreamDefaultController:nl,WritableStreamDefaultWriter:rl,WebSocket:gn,TextEncoder:bs,TextDecoder:co,URLPattern:bl},vo=_l(globalThis,wl);function _l(s,e){return new Proxy(s,{get(t,n,r){return n in e?e[n]:s[n]},set(t,n,r){return n in e&&delete e[n],s[n]=r,!0},deleteProperty(t,n){let r=!1;return n in e&&(delete e[n],r=!0),n in s&&(delete s[n],r=!0),r},ownKeys(t){const n=Reflect.ownKeys(s),r=Reflect.ownKeys(e),i=new Set(r);return[...n.filter(u=>!i.has(u)),...r]},defineProperty(t,n,r){return n in e&&delete e[n],Reflect.defineProperty(s,n,r),!0},getOwnPropertyDescriptor(t,n){return n in e?Reflect.getOwnPropertyDescriptor(e,n):Reflect.getOwnPropertyDescriptor(s,n)},has(t,n){return n in e||n in s}})}function ko(s,e){if(s===e)return!0;if(!s||!e)return!1;var t=s.length;if(e.length!==t)return!1;for(var n=0;n<t;n++)if(s[n]!==e[n])return!1;return!0}function _r(s,e){if(s===e)return!0;if(!s||!e)return!1;var t=Object.keys(s),n=Object.keys(e),r=t.length;if(n.length!==r)return!1;for(var i=0;i<r;i++){var u=t[i];if(s[u]!==e[u]||!Object.prototype.hasOwnProperty.call(e,u))return!1}return!0}var yl=function(s,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var t=typeof e.cycles=="boolean"?e.cycles:!1,n=e.cmp&&function(i){return function(u){return function(a,o){var l={key:a,value:u[a]},c={key:o,value:u[o]};return i(l,c)}}}(e.cmp),r=[];return function i(u){if(u&&u.toJSON&&typeof u.toJSON=="function"&&(u=u.toJSON()),u!==void 0){if(typeof u=="number")return isFinite(u)?""+u:"null";if(typeof u!="object")return JSON.stringify(u);var a,o;if(Array.isArray(u)){for(o="[",a=0;a<u.length;a++)a&&(o+=","),o+=i(u[a])||"null";return o+"]"}if(u===null)return"null";if(r.indexOf(u)!==-1){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=r.push(u)-1,c=Object.keys(u).sort(n&&n(u));for(o="",a=0;a<c.length;a++){var f=c[a],h=i(u[f]);h&&(o&&(o+=","),o+=JSON.stringify(f)+":"+h)}return r.splice(l,1),"{"+o+"}"}}(s)};const Cl=Na(yl);var Je={};Object.defineProperty(Je,"__esModule",{value:!0});function Fn(s,e,t){var n;if(t===void 0&&(t={}),!e.codes){e.codes={};for(var r=0;r<e.chars.length;++r)e.codes[e.chars[r]]=r}if(!t.loose&&s.length*e.bits&7)throw new SyntaxError("Invalid padding");for(var i=s.length;s[i-1]==="=";)if(--i,!t.loose&&!((s.length-i)*e.bits&7))throw new SyntaxError("Invalid padding");for(var u=new((n=t.out)!=null?n:Uint8Array)(i*e.bits/8|0),a=0,o=0,l=0,c=0;c<i;++c){var f=e.codes[s[c]];if(f===void 0)throw new SyntaxError("Invalid character "+s[c]);o=o<<e.bits|f,a+=e.bits,a>=8&&(a-=8,u[l++]=255&o>>a)}if(a>=e.bits||255&o<<8-a)throw new SyntaxError("Unexpected end of data");return u}function Bn(s,e,t){t===void 0&&(t={});for(var n=t,r=n.pad,i=r===void 0?!0:r,u=(1<<e.bits)-1,a="",o=0,l=0,c=0;c<s.length;++c)for(l=l<<8|255&s[c],o+=8;o>e.bits;)o-=e.bits,a+=e.chars[u&l>>o];if(o&&(a+=e.chars[u&l<<e.bits-o]),i)for(;a.length*e.bits&7;)a+="=";return a}var qs={chars:"0123456789ABCDEF",bits:4},Ws={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},Ks={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},Vs={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},Qs={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},Al={parse:function(e,t){return Fn(e.toUpperCase(),qs,t)},stringify:function(e,t){return Bn(e,qs,t)}},El={parse:function(e,t){return t===void 0&&(t={}),Fn(t.loose?e.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):e,Ws,t)},stringify:function(e,t){return Bn(e,Ws,t)}},vl={parse:function(e,t){return Fn(e,Ks,t)},stringify:function(e,t){return Bn(e,Ks,t)}},kl={parse:function(e,t){return Fn(e,Vs,t)},stringify:function(e,t){return Bn(e,Vs,t)}},Fl={parse:function(e,t){return Fn(e,Qs,t)},stringify:function(e,t){return Bn(e,Qs,t)}},Bl={parse:Fn,stringify:Bn};Je.base16=Al;Je.base32=El;Je.base32hex=vl;Je.base64=kl;Je.base64url=Fl;Je.codec=Bl;const Sl=Je.base16,Tl=Je.base32,Il=Je.base32hex,Pl=Je.base64,Rl=Je.base64url,Ol=Je.codec,xl=Object.freeze(Object.defineProperty({__proto__:null,base16:Sl,base32:Tl,base32hex:Il,base64:Pl,base64url:Rl,codec:Ol,default:Je},Symbol.toStringTag,{value:"Module"}));var nn={};Object.defineProperty(nn,"__esModule",{value:!0});var Fo=nn.Hash=Bo=nn.createHash=void 0;const Ml=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],Gs={sha256:1};function Nl(s){if(s&&!Gs[s]&&!Gs[s.toLowerCase()])throw new Error("Digest method not supported");return new So}var Bo=nn.createHash=Nl;class So{constructor(){this.A=1779033703,this.B=-1150833019,this.C=1013904242,this.D=-1521486534,this.E=1359893119,this.F=-1694144372,this.G=528734635,this.H=1541459225,this._size=0,this._sp=0,(!sr||In>=8e3)&&(sr=new ArrayBuffer(8e3),In=0),this._byte=new Uint8Array(sr,In,80),this._word=new Int32Array(sr,In,20),In+=80}update(e){if(typeof e=="string")return this._utf8(e);if(e==null)throw new TypeError("Invalid type: "+typeof e);const t=e.byteOffset,n=e.byteLength;let r=n/64|0,i=0;if(r&&!(t&3)&&!(this._size%64)){const a=new Int32Array(e.buffer,t,r*16);for(;r--;)this._int32(a,i>>2),i+=64;this._size+=i}if(e.BYTES_PER_ELEMENT!==1&&e.buffer){const a=new Uint8Array(e.buffer,t+i,n-i);return this._uint8(a)}return i===n?this:this._uint8(e,i)}_uint8(e,t){const{_byte:n,_word:r}=this,i=e.length;for(t=t|0;t<i;){const u=this._size%64;let a=u;for(;t<i&&a<64;)n[a++]=e[t++];a>=64&&this._int32(r),this._size+=a-u}return this}_utf8(e){const{_byte:t,_word:n}=this,r=e.length;let i=this._sp;for(let u=0;u<r;){const a=this._size%64;let o=a;for(;u<r&&o<64;){let l=e.charCodeAt(u++)|0;l<128?t[o++]=l:l<2048?(t[o++]=192|l>>>6,t[o++]=128|l&63):l<55296||l>57343?(t[o++]=224|l>>>12,t[o++]=128|l>>>6&63,t[o++]=128|l&63):i?(l=((i&1023)<<10)+(l&1023)+65536,t[o++]=240|l>>>18,t[o++]=128|l>>>12&63,t[o++]=128|l>>>6&63,t[o++]=128|l&63,i=0):i=l}o>=64&&(this._int32(n),n[0]=n[16]),this._size+=o-a}return this._sp=i,this}_int32(e,t){let{A:n,B:r,C:i,D:u,E:a,F:o,G:l,H:c}=this,f=0;for(t=t|0;f<16;)qt[f++]=ot(e[t++]);for(f=16;f<64;f++)qt[f]=Wl(qt[f-2])+qt[f-7]+ql(qt[f-15])+qt[f-16]|0;for(f=0;f<64;f++){const h=c+Hl(a)+jl(a,o,l)+Ml[f]+qt[f]|0,d=zl(n)+Ul(n,r,i)|0;c=l,l=o,o=a,a=u+h|0,u=i,i=r,r=n,n=h+d|0}this.A=n+this.A|0,this.B=r+this.B|0,this.C=i+this.C|0,this.D=u+this.D|0,this.E=a+this.E|0,this.F=o+this.F|0,this.G=l+this.G|0,this.H=c+this.H|0}digest(e){const{_byte:t,_word:n}=this;let r=this._size%64|0;for(t[r++]=128;r&3;)t[r++]=0;if(r>>=2,r>14){for(;r<16;)n[r++]=0;r=0,this._int32(n)}for(;r<16;)n[r++]=0;const i=this._size*8,u=(i&4294967295)>>>0,a=(i-u)/4294967296;return a&&(n[14]=ot(a)),u&&(n[15]=ot(u)),this._int32(n),e==="hex"?this._hex():this._bin()}_hex(){const{A:e,B:t,C:n,D:r,E:i,F:u,G:a,H:o}=this;return It(e)+It(t)+It(n)+It(r)+It(i)+It(u)+It(a)+It(o)}_bin(){const{A:e,B:t,C:n,D:r,E:i,F:u,G:a,H:o,_byte:l,_word:c}=this;return c[0]=ot(e),c[1]=ot(t),c[2]=ot(n),c[3]=ot(r),c[4]=ot(i),c[5]=ot(u),c[6]=ot(a),c[7]=ot(o),l.slice(0,32)}}Fo=nn.Hash=So;const qt=new Int32Array(64);let sr,In=0;const It=s=>(s+4294967296).toString(16).substr(-8),$l=s=>s<<24&4278190080|s<<8&16711680|s>>8&65280|s>>24&255,Ll=s=>s,ot=Kl()?Ll:$l,jl=(s,e,t)=>t^s&(e^t),Ul=(s,e,t)=>s&e|t&(s|e),zl=s=>(s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10),Hl=s=>(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7),ql=s=>(s>>>7|s<<25)^(s>>>18|s<<14)^s>>>3,Wl=s=>(s>>>17|s<<15)^(s>>>19|s<<13)^s>>>10;function Kl(){return new Uint8Array(new Uint16Array([65279]).buffer)[0]===254}const Vl=Qa({__proto__:null,get Hash(){return Fo},get createHash(){return Bo},default:nn},[nn]);/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const xe=BigInt(0),ae=BigInt(1),Ve=BigInt(2),To=BigInt(255),Ys=Ve**BigInt(252)+BigInt("27742317777372353535851937790883648493"),be={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:Ve**To-BigInt(19),l:Ys,n:Ys,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},Io=Ve**BigInt(256),jn=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");const Ql=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Gl=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Yl=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Jl=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class fe{constructor(e,t,n,r){this.x=e,this.y=t,this.z=n,this.t=r}static fromAffine(e){if(!(e instanceof Te))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(Te.ZERO)?fe.ZERO:new fe(e.x,e.y,ae,O(e.x*e.y))}static toAffineBatch(e){const t=ec(e.map(n=>n.z));return e.map((n,r)=>n.toAffine(t[r]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){Js(e);const{x:t,y:n,z:r}=this,{x:i,y:u,z:a}=e,o=O(t*a),l=O(i*r),c=O(n*a),f=O(u*r);return o===l&&c===f}negate(){return new fe(O(-this.x),this.y,this.z,O(-this.t))}double(){const{x:e,y:t,z:n}=this,{a:r}=be,i=O(e**Ve),u=O(t**Ve),a=O(Ve*O(n**Ve)),o=O(r*i),l=O(O((e+t)**Ve)-i-u),c=o+u,f=c-a,h=o-u,d=O(l*f),p=O(c*h),g=O(l*h),C=O(f*c);return new fe(d,p,C,g)}add(e){Js(e);const{x:t,y:n,z:r,t:i}=this,{x:u,y:a,z:o,t:l}=e,c=O((n-t)*(a+u)),f=O((n+t)*(a-u)),h=O(f-c);if(h===xe)return this.double();const d=O(r*Ve*l),p=O(i*Ve*o),g=p+d,C=f+c,b=p-d,A=O(g*h),E=O(C*b),B=O(g*b),k=O(h*C);return new fe(A,E,k,B)}subtract(e){return this.add(e.negate())}precomputeWindow(e){const t=1+256/e,n=[];let r=this,i=r;for(let u=0;u<t;u++){i=r,n.push(i);for(let a=1;a<2**(e-1);a++)i=i.add(r),n.push(i);r=i.double()}return n}wNAF(e,t){!t&&this.equals(fe.BASE)&&(t=Te.BASE);const n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let r=t&&us.get(t);r||(r=this.precomputeWindow(n),t&&n!==1&&(r=fe.normalizeZ(r),us.set(t,r)));let i=fe.ZERO,u=fe.ZERO;const a=1+256/n,o=2**(n-1),l=BigInt(2**n-1),c=2**n,f=BigInt(n);for(let h=0;h<a;h++){const d=h*o;let p=Number(e&l);if(e>>=f,p>o&&(p-=c,e+=ae),p===0){let g=r[d];h%2&&(g=g.negate()),u=u.add(g)}else{let g=r[d+Math.abs(p)-1];p<0&&(g=g.negate()),i=i.add(g)}}return fe.normalizeZ([i,u])[0]}multiply(e,t){return this.wNAF(yr(e,be.l),t)}multiplyUnsafe(e){let t=yr(e,be.l,!1);const n=fe.BASE,r=fe.ZERO;if(t===xe)return r;if(this.equals(r)||t===ae)return this;if(this.equals(n))return this.wNAF(t);let i=r,u=this;for(;t>xe;)t&ae&&(i=i.add(u)),u=u.double(),t>>=ae;return i}isSmallOrder(){return this.multiplyUnsafe(be.h).equals(fe.ZERO)}isTorsionFree(){return this.multiplyUnsafe(be.l).equals(fe.ZERO)}toAffine(e=Sr(this.z)){const{x:t,y:n,z:r}=this,i=O(t*e),u=O(n*e);if(O(r*e)!==ae)throw new Error("invZ was invalid");return new Te(i,u)}fromRistrettoBytes(){Wr()}toRistrettoBytes(){Wr()}fromRistrettoHash(){Wr()}}fe.BASE=new fe(be.Gx,be.Gy,ae,O(be.Gx*be.Gy));fe.ZERO=new fe(xe,ae,ae,xe);function Js(s){if(!(s instanceof fe))throw new TypeError("ExtendedPoint expected")}function qr(s){if(!(s instanceof ut))throw new TypeError("RistrettoPoint expected")}function Wr(){throw new Error("Legacy method: switch to RistrettoPoint")}class ut{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){const{d:t}=be,n=O(jn*e*e),r=O((n+ae)*Yl);let i=BigInt(-1);const u=O((i-t*n)*O(n+t));let{isValid:a,value:o}=_s(r,u),l=O(o*e);Ot(l)||(l=O(-l)),a||(o=l),a||(i=n);const c=O(i*(n-ae)*Jl-u),f=o*o,h=O((o+o)*u),d=O(c*Ql),p=O(ae-f),g=O(ae+f);return new fe(O(h*g),O(p*d),O(d*g),O(h*p))}static hashToCurve(e){e=$t(e,64);const t=Kr(e.slice(0,32)),n=this.calcElligatorRistrettoMap(t),r=Kr(e.slice(32,64)),i=this.calcElligatorRistrettoMap(r);return new ut(n.add(i))}static fromHex(e){e=$t(e,32);const{a:t,d:n}=be,r="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",i=Kr(e);if(!nc(Wn(i),e)||Ot(i))throw new Error(r);const u=O(i*i),a=O(ae+t*u),o=O(ae-t*u),l=O(a*a),c=O(o*o),f=O(t*n*l-c),{isValid:h,value:d}=Zs(O(f*c)),p=O(d*o),g=O(d*p*f);let C=O((i+i)*p);Ot(C)&&(C=O(-C));const b=O(a*g),A=O(C*b);if(!h||Ot(A)||b===xe)throw new Error(r);return new ut(new fe(C,b,ae,A))}toRawBytes(){let{x:e,y:t,z:n,t:r}=this.ep;const i=O(O(n+t)*O(n-t)),u=O(e*t),{value:a}=Zs(O(i*u**Ve)),o=O(a*i),l=O(a*u),c=O(o*l*r);let f;if(Ot(r*c)){let d=O(t*jn),p=O(e*jn);e=d,t=p,f=O(o*Gl)}else f=l;Ot(e*c)&&(t=O(-t));let h=O((n-t)*f);return Ot(h)&&(h=O(-h)),Wn(h)}toHex(){return Jn(this.toRawBytes())}toString(){return this.toHex()}equals(e){qr(e);const t=this.ep,n=e.ep,r=O(t.x*n.y)===O(t.y*n.x),i=O(t.y*n.y)===O(t.x*n.x);return r||i}add(e){return qr(e),new ut(this.ep.add(e.ep))}subtract(e){return qr(e),new ut(this.ep.subtract(e.ep))}multiply(e){return new ut(this.ep.multiply(e))}multiplyUnsafe(e){return new ut(this.ep.multiplyUnsafe(e))}}ut.BASE=new ut(fe.BASE);ut.ZERO=new ut(fe.ZERO);const us=new WeakMap;class Te{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,us.delete(this)}static fromHex(e,t=!0){const{d:n,P:r}=be;e=$t(e,32);const i=e.slice();i[31]=e[31]&-129;const u=Sn(i);if(t&&u>=r)throw new Error("Expected 0 < hex < P");if(!t&&u>=Io)throw new Error("Expected 0 < hex < 2**256");const a=O(u*u),o=O(a-ae),l=O(n*a+ae);let{isValid:c,value:f}=_s(o,l);if(!c)throw new Error("Point.fromHex: invalid y coordinate");const h=(f&ae)===ae;return(e[31]&128)!==0!==h&&(f=O(-f)),new Te(f,u)}static async fromPrivateKey(e){return(await Tr(e)).point}toRawBytes(){const e=Wn(this.y);return e[31]|=this.x&ae?128:0,e}toHex(){return Jn(this.toRawBytes())}toX25519(){const{y:e}=this,t=O((ae+e)*Sr(ae-e));return Wn(t)}isTorsionFree(){return fe.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new Te(O(-this.x),this.y)}add(e){return fe.fromAffine(this).add(fe.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return fe.fromAffine(this).multiply(e,this).toAffine()}}Te.BASE=new Te(be.Gx,be.Gy);Te.ZERO=new Te(xe,ae);class qn{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromHex(e){const t=$t(e,64),n=Te.fromHex(t.slice(0,32),!1),r=Sn(t.slice(32,64));return new qn(n,r)}assertValidity(){const{r:e,s:t}=this;if(!(e instanceof Te))throw new Error("Expected Point instance");return yr(t,be.l,!1),this}toRawBytes(){const e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(Wn(this.s),32),e}toHex(){return Jn(this.toRawBytes())}}function Zl(...s){if(!s.every(n=>n instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(s.length===1)return s[0];const e=s.reduce((n,r)=>n+r.length,0),t=new Uint8Array(e);for(let n=0,r=0;n<s.length;n++){const i=s[n];t.set(i,r),r+=i.length}return t}const Xl=Array.from({length:256},(s,e)=>e.toString(16).padStart(2,"0"));function Jn(s){if(!(s instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let t=0;t<s.length;t++)e+=Xl[s[t]];return e}function Po(s){if(typeof s!="string")throw new TypeError("hexToBytes: expected string, got "+typeof s);if(s.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const e=new Uint8Array(s.length/2);for(let t=0;t<e.length;t++){const n=t*2,r=s.slice(n,n+2),i=Number.parseInt(r,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");e[t]=i}return e}function Ro(s){const t=s.toString(16).padStart(64,"0");return Po(t)}function Wn(s){return Ro(s).reverse()}function Ot(s){return(O(s)&ae)===ae}function Sn(s){if(!(s instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+Jn(Uint8Array.from(s).reverse()))}function Kr(s){return O(Sn(s)&Ve**To-ae)}function O(s,e=be.P){const t=s%e;return t>=xe?t:e+t}function Sr(s,e=be.P){if(s===xe||e<=xe)throw new Error(`invert: expected positive integers, got n=${s} mod=${e}`);let t=O(s,e),n=e,r=xe,i=ae;for(;t!==xe;){const a=n/t,o=n%t,l=r-i*a;n=t,t=o,r=i,i=l}if(n!==ae)throw new Error("invert: does not exist");return O(r,e)}function ec(s,e=be.P){const t=new Array(s.length),n=s.reduce((i,u,a)=>u===xe?i:(t[a]=i,O(i*u,e)),ae),r=Sr(n,e);return s.reduceRight((i,u,a)=>u===xe?i:(t[a]=O(i*t[a],e),O(i*u,e)),r),t}function ct(s,e){const{P:t}=be;let n=s;for(;e-- >xe;)n*=n,n%=t;return n}function tc(s){const{P:e}=be,t=BigInt(5),n=BigInt(10),r=BigInt(20),i=BigInt(40),u=BigInt(80),o=s*s%e*s%e,l=ct(o,Ve)*o%e,c=ct(l,ae)*s%e,f=ct(c,t)*c%e,h=ct(f,n)*f%e,d=ct(h,r)*h%e,p=ct(d,i)*d%e,g=ct(p,u)*p%e,C=ct(g,u)*p%e,b=ct(C,n)*f%e;return{pow_p_5_8:ct(b,Ve)*s%e,b2:o}}function _s(s,e){const t=O(e*e*e),n=O(t*t*e),r=tc(s*n).pow_p_5_8;let i=O(s*t*r);const u=O(e*i*i),a=i,o=O(i*jn),l=u===s,c=u===O(-s),f=u===O(-s*jn);return l&&(i=a),(c||f)&&(i=o),Ot(i)&&(i=O(-i)),{isValid:l||c,value:i}}function Zs(s){return _s(ae,s)}async function os(...s){const e=await Ir.sha512(Zl(...s)),t=Sn(e);return O(t,be.l)}function nc(s,e){if(s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(s[t]!==e[t])return!1;return!0}function $t(s,e){const t=s instanceof Uint8Array?Uint8Array.from(s):Po(s);if(typeof e=="number"&&t.length!==e)throw new Error(`Expected ${e} bytes`);return t}function yr(s,e,t=!0){if(!e)throw new TypeError("Specify max value");if(typeof s=="number"&&Number.isSafeInteger(s)&&(s=BigInt(s)),typeof s=="bigint"&&s<e){if(t){if(xe<s)return s}else if(xe<=s)return s}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function rc(s){return s[0]&=248,s[31]&=127,s[31]|=64,s}async function Tr(s){if(s=typeof s=="bigint"||typeof s=="number"?Ro(yr(s,Io)):$t(s),s.length!==32)throw new Error("Expected 32 bytes");const e=await Ir.sha512(s),t=rc(e.slice(0,32)),n=e.slice(32,64),r=O(Sn(t),be.l),i=Te.BASE.multiply(r),u=i.toRawBytes();return{head:t,prefix:n,scalar:r,point:i,pointBytes:u}}async function sc(s){return(await Tr(s)).pointBytes}async function ic(s,e){s=$t(s);const{prefix:t,scalar:n,pointBytes:r}=await Tr(e),i=await os(t,s),u=Te.BASE.multiply(i),a=await os(u.toRawBytes(),r,s),o=O(i+a*n,be.l);return new qn(u,o).toRawBytes()}async function uc(s,e,t){e=$t(e),t instanceof Te||(t=Te.fromHex(t,!1));const{r:n,s:r}=s instanceof qn?s.assertValidity():qn.fromHex(s),i=fe.BASE.multiplyUnsafe(r),u=await os(n.toRawBytes(),t.toRawBytes(),e),a=fe.fromAffine(t).multiplyUnsafe(u);return fe.fromAffine(n).add(a).subtract(i).multiplyUnsafe(be.h).equals(fe.ZERO)}Te.BASE._setWindowSize(8);const Pt={node:$a,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},Ir={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:Jn,getExtendedPublicKey:Tr,mod:O,invert:Sr,hashToPrivateScalar:s=>{if(s=$t(s),s.length<40||s.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const e=O(Sn(s),be.l);if(e===xe||e===ae)throw new Error("Invalid private key");return e},randomBytes:(s=32)=>{if(Pt.web)return Pt.web.getRandomValues(new Uint8Array(s));if(Pt.node){const{randomBytes:e}=Pt.node;return new Uint8Array(e(s).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Ir.randomBytes(32),sha512:async s=>{if(Pt.web){const e=await Pt.web.subtle.digest("SHA-512",s.buffer);return new Uint8Array(e)}else{if(Pt.node)return Uint8Array.from(Pt.node.createHash("sha512").update(s).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(s=8,e=Te.BASE){const t=e.equals(Te.BASE)?e:new Te(e.x,e.y);return t._setWindowSize(s),t.multiply(Ve),t}};var oe=globalThis&&globalThis.__classPrivateFieldGet||function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},Se=globalThis&&globalThis.__classPrivateFieldSet||function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},_t,yt,Ct,At,Et,vt,Jt,je;const Fe=11400714785074694791n,Ne=14029467366897019727n,Xs=1609587929392839161n,Pn=9650029242287828579n,ei=2870177450012600261n,Oo=64n,oc=2n**Oo-1n,ac=new bs;function ti(s,e,t,n){return BigInt(s)|BigInt(e)<<16n|BigInt(t)<<32n|BigInt(n)<<48n}function bt(s,e){return BigInt(s[e])|BigInt(s[e+1])<<8n|BigInt(s[e+2])<<16n|BigInt(s[e+3])<<24n|BigInt(s[e+4])<<32n|BigInt(s[e+5])<<40n|BigInt(s[e+6])<<48n|BigInt(s[e+7])<<56n}function Ie(s,e){return s<<e&oc|s>>Oo-e}function se(s){return BigInt.asUintN(64,s)}class ys{constructor(e=0){_t.set(this,void 0),yt.set(this,void 0),Ct.set(this,void 0),At.set(this,void 0),Et.set(this,void 0),vt.set(this,void 0),Jt.set(this,void 0),je.set(this,void 0),this.reset(e)}reset(e=oe(this,_t,"f")){return Se(this,_t,BigInt.asUintN(32,BigInt(e)),"f"),Se(this,yt,se(oe(this,_t,"f")+Fe+Ne),"f"),Se(this,Ct,se(oe(this,_t,"f")+Ne),"f"),Se(this,At,oe(this,_t,"f"),"f"),Se(this,Et,se(oe(this,_t,"f")-Fe),"f"),Se(this,vt,null,"f"),Se(this,Jt,0,"f"),Se(this,je,0,"f"),this}update(e){typeof e=="string"&&(e=ac.encode(e));let t=0,n=e.length,r=t+n;if(n===0)return this;if(Se(this,Jt,oe(this,Jt,"f")+n,"f"),oe(this,je,"f")===0&&Se(this,vt,new Uint8Array(32),"f"),oe(this,je,"f")+n<32)return oe(this,vt,"f").set(e.subarray(0,n),oe(this,je,"f")),Se(this,je,oe(this,je,"f")+n,"f"),this;if(oe(this,je,"f")>0){oe(this,vt,"f").set(e.subarray(0,32-oe(this,je,"f")),oe(this,je,"f"));let i=0,u;u=bt(oe(this,vt,"f"),i),Se(this,yt,se(Ie(se(oe(this,yt,"f")+u*Ne),31n)*Fe),"f"),i+=8,u=bt(this.memory,i),Se(this,Ct,se(Ie(se(oe(this,Ct,"f")+u*Ne),31n)*Fe),"f"),i+=8,u=bt(this.memory,i),Se(this,At,se(Ie(se(oe(this,At,"f")+u*Ne),31n)*Fe),"f"),i+=8,u=bt(this.memory,i),Se(this,Et,se(Ie(se(oe(this,Et,"f")+u*Ne),31n)*Fe),"f"),t+=32-oe(this,je,"f"),Se(this,je,0,"f")}if(t<=r-32){const i=r-32;do{let u;u=bt(e,t),Se(this,yt,se(Ie(se(oe(this,yt,"f")+u*Ne),31n)*Fe),"f"),t+=8,u=bt(e,t),Se(this,Ct,se(Ie(se(oe(this,Ct,"f")+u*Ne),31n)*Fe),"f"),t+=8,u=bt(e,t),Se(this,At,se(Ie(se(oe(this,At,"f")+u*Ne),31n)*Fe),"f"),t+=8,u=bt(e,t),Se(this,Et,se(Ie(se(oe(this,Et,"f")+u*Ne),31n)*Fe),"f"),t+=8}while(t<=i)}return t<r&&(oe(this,vt,"f").set(e.subarray(t,r),oe(this,je,"f")),Se(this,je,r-t,"f")),this}digest(){let e=oe(this,vt,"f"),t=oe(this,je,"f"),n=0,r=0n,i=0n,u=0n;for(oe(this,Jt,"f")>=32?(r=Ie(oe(this,yt,"f"),1n)+Ie(oe(this,Ct,"f"),7n)+Ie(oe(this,At,"f"),12n)+Ie(oe(this,Et,"f"),18n),r=se(r^Ie(se(oe(this,yt,"f")*Ne),31n)*Fe),r=se(r*Fe+Pn),r=se(r^Ie(se(oe(this,Ct,"f")*Ne),31n)*Fe),r=se(r*Fe+Pn),r=se(r^Ie(se(oe(this,At,"f")*Ne),31n)*Fe),r=se(r*Fe+Pn),r=se(r^Ie(se(oe(this,Et,"f")*Ne),31n)*Fe),r=se(r*Fe+Pn)):r=se(oe(this,_t,"f")+ei),r+=BigInt(oe(this,Jt,"f"));n<=t-8;)u=bt(e,n),u=se(Ie(se(u*Ne),31n)*Fe),r=se(Ie(r^u,27n)*Fe+Pn),n+=8;for(n+4<=t&&(u=ti(e[n+1]<<8|e[n],e[n+3]<<8|e[n+2],0,0),r=se(Ie(r^se(u*Fe),23n)*Ne+Xs),n+=4);n<t;)u=ti(e[n++],0,0,0),r=se(Ie(r^se(u*ei),11n)*Fe);return i=se(r>>33n),r=se((r^i)*Ne),i=se(r>>29n),r=se((r^i)*Xs),i=se(r>>32n),r=se(r^i),r}}_t=new WeakMap,yt=new WeakMap,Ct=new WeakMap,At=new WeakMap,Et=new WeakMap,vt=new WeakMap,Jt=new WeakMap,je=new WeakMap;function lc(s,e=0){return new ys(e).update(s).digest()}function xo(s,e){return s<e?-1:s>e?1:0}class Zt{constructor(e,t){Object.defineProperty(this,"parent",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"left",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"right",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.left=null,this.right=null}static from(e){const t=new Zt(e.parent,e.value);return t.left=e.left,t.right=e.right,t}directionFromParent(){return this.parent===null?null:this===this.parent.left?"left":this===this.parent.right?"right":null}findMinNode(){let e=this.left;for(;e!=null&&e.left;)e=e.left;return e??this}findMaxNode(){let e=this.right;for(;e!=null&&e.right;)e=e.right;return e??this}findSuccessorNode(){if(this.right!==null)return this.right.findMinNode();let e=this.parent,t=this.directionFromParent();for(;e&&t==="right";)t=e.directionFromParent(),e=e.parent;return e}}class dn{constructor(e=xo){Object.defineProperty(this,"compare",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"root",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_size",{enumerable:!0,configurable:!0,writable:!0,value:0})}static from(e,t){let n,r=[];if(e instanceof dn)if(n=new dn((t==null?void 0:t.compare)??e.compare),t!=null&&t.compare||t!=null&&t.map)r=e;else{const u=[];for(e.root&&(n.root=Zt.from(e.root),u.push(n.root));u.length;){const a=u.pop(),o=a.left?Zt.from(a.left):null,l=a.right?Zt.from(a.right):null;o&&(o.parent=a,u.push(o)),l&&(l.parent=a,u.push(l))}}else n=t!=null&&t.compare?new dn(t.compare):new dn,r=e;const i=t!=null&&t.map?Array.from(r,t.map,t.thisArg):r;for(const u of i)n.insert(u);return n}get size(){return this._size}findNode(e){let t=this.root;for(;t;){const n=this.compare(e,t.value);if(n===0)break;const r=n<0?"left":"right";t=t[r]}return t}rotateNode(e,t){const n=t==="left"?"right":"left";if(!e[n])throw new TypeError(`cannot rotate ${t} without ${n} child`);const r=e[n];if(e[n]=r[t]??null,r[t]&&(r[t].parent=e),r.parent=e.parent,e.parent){const i=e===e.parent[t]?t:n;e.parent[i]=r}else this.root=r;r[t]=e,e.parent=r}insertNode(e,t){if(this.root){let n=this.root;for(;;){const r=this.compare(t,n.value);if(r===0)break;const i=r<0?"left":"right";if(n[i])n=n[i];else return n[i]=new e(n,t),this._size++,n[i]}}else return this.root=new e(null,t),this._size++,this.root;return null}removeNode(e){let t=this.findNode(e);if(t){const n=!t.left||!t.right?t:t.findSuccessorNode(),r=n.left??n.right;r&&(r.parent=n.parent),n.parent?n.parent[n.directionFromParent()]=r:this.root=r,n!==t&&(t.value=n.value,t=n),this._size--}return t}insert(e){return!!this.insertNode(Zt,e)}remove(e){return!!this.removeNode(e)}find(e){var t;return((t=this.findNode(e))==null?void 0:t.value)??null}min(){return this.root?this.root.findMinNode().value:null}max(){return this.root?this.root.findMaxNode().value:null}clear(){this.root=null,this._size=0}isEmpty(){return this.size===0}*lnrValues(){const e=[];let t=this.root;for(;e.length||t;)t?(e.push(t),t=t.left):(t=e.pop(),yield t.value,t=t.right)}*rnlValues(){const e=[];let t=this.root;for(;e.length||t;)t?(e.push(t),t=t.right):(t=e.pop(),yield t.value,t=t.left)}*nlrValues(){const e=[];for(this.root&&e.push(this.root);e.length;){const t=e.pop();yield t.value,t.right&&e.push(t.right),t.left&&e.push(t.left)}}*lrnValues(){const e=[];let t=this.root,n=null;for(;e.length||t;)if(t)e.push(t),t=t.left;else{const r=e[e.length-1];r.right&&r.right!==n?t=r.right:(yield r.value,n=e.pop())}}*lvlValues(){const e=[];let t=this.root;for(;t;)yield t.value,t.left&&e.push(t.left),t.right&&e.push(t.right),t=e.shift()??null}*[Symbol.iterator](){yield*this.lnrValues()}}class Xt extends Zt{constructor(e,t){super(e,t),Object.defineProperty(this,"red",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.red=!0}static from(e){const t=new Xt(e.parent,e.value);return t.left=e.left,t.right=e.right,t.red=e.red,t}}class pn extends dn{constructor(e=xo){super(e)}static from(e,t){let n,r=[];if(e instanceof pn)if(n=new pn((t==null?void 0:t.compare)??e.compare),t!=null&&t.compare||t!=null&&t.map)r=e;else{const u=[];for(e.root&&(n.root=Xt.from(e.root),u.push(n.root));u.length;){const a=u.pop(),o=a.left?Xt.from(a.left):null,l=a.right?Xt.from(a.right):null;o&&(o.parent=a,u.push(o)),l&&(l.parent=a,u.push(l))}}else n=t!=null&&t.compare?new pn(t.compare):new pn,r=e;const i=t!=null&&t.map?Array.from(r,t.map,t.thisArg):r;for(const u of i)n.insert(u);return n}removeFixup(e,t){var n,r,i;for(;e&&!(t!=null&&t.red);){const u=e.left===t?"left":"right",a=u==="right"?"left":"right";let o=e[a];o!=null&&o.red&&(o.red=!1,e.red=!0,this.rotateNode(e,u),o=e[a]),o&&(!((n=o.left)!=null&&n.red)&&!((r=o.right)!=null&&r.red)?(o.red=!0,t=e,e=t.parent):((i=o[a])!=null&&i.red||(o[u].red=!1,o.red=!0,this.rotateNode(o,a),o=e[a]),o.red=e.red,e.red=!1,o[a].red=!1,this.rotateNode(e,u),t=this.root,e=null))}t&&(t.red=!1)}insert(e){var n;let t=this.insertNode(Xt,e);if(t){for(;(n=t.parent)!=null&&n.red;){let r=t.parent;const i=r.directionFromParent(),u=i==="right"?"left":"right",a=r.parent[u]??null;a!=null&&a.red?(r.red=!1,a.red=!1,r.parent.red=!0,t=r.parent):(t===r[u]&&(t=r,this.rotateNode(t,i),r=t.parent),r.red=!1,r.parent.red=!0,this.rotateNode(r.parent,u))}this.root.red=!1}return!!t}remove(e){const t=this.removeNode(e);return t&&!t.red&&this.removeFixup(t.parent,t.left??t.right),!!t}}function Vr(s,e){return{lift:t=>[s.lift(t),e.lift(t)],combine:(t,n)=>{const r=s.combine(t[0],n[0]),i=e.combine(t[1],n[1]);return[r,i]},neutral:[s.neutral,e.neutral]}}const cc={lift:s=>1,combine:(s,e)=>s+e,neutral:0};class ni extends Xt{constructor(e,t,n){super(e,t),Object.defineProperty(this,"label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"liftedValue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"monoid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.label=n.neutral,this.liftedValue=n.lift(t),this.monoid=n}updateLabel(e=!0,t){var n;this.left!==null&&this.right===null?this.label=this.monoid.combine(this.left.label,this.liftedValue):this.left===null&&this.right!==null?this.label=this.monoid.combine(this.liftedValue,this.right.label):this.left&&this.right?this.label=this.monoid.combine(this.left.label,this.monoid.combine(this.liftedValue,this.right.label)):this.label=this.liftedValue,e&&((n=this.parent)==null||n.updateLabel(!0,"Updated by child"))}}class fc extends pn{constructor(e,t){super(t),Object.defineProperty(this,"monoid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedMinNode",{enumerable:!0,configurable:!0,writable:!0,value:null});const i=Vr({lift:u=>[u],combine:(u,a)=>u.concat(a),neutral:[]},{lift:u=>u,combine:(u,a)=>{if(!(u===void 0&&a===void 0))return a===void 0?u:u===void 0?a:t(u,a)>0?u:a},neutral:void 0});this.monoid=Vr(e,Vr(cc,i))}getLowestValue(){if(!this.root)throw new Error("Can't get a range from a tree with no items");return this.cachedMinNode?this.cachedMinNode.value:this.root.findMinNode().value}rotateNode(e,t){var i;const n=t==="left"?"right":"left";if(!e[n])throw new TypeError(`cannot rotate ${t} without ${n} child`);const r=e[n];if(e[n]=r[t]??null,r[t]&&(r[t].parent=e),r.parent=e.parent,e.parent){const u=e===e.parent[t]?t:n;e.parent[u]=r}else this.root=r;r[t]=e,e.parent=r,(i=r[t])==null||i.updateLabel(!1,"Node rotated")}removeFixup(e,t){var n,r,i;for(;e&&!(t!=null&&t.red);){const u=e.left===t?"left":"right",a=u==="right"?"left":"right";let o=e[a];o!=null&&o.red&&(o.red=!1,e.red=!0,this.rotateNode(e,u),o=e[a]),o&&(!((n=o.left)!=null&&n.red)&&!((r=o.right)!=null&&r.red)?(o.red=!0,t=e,e=t.parent):((i=o[a])!=null&&i.red||(o[u].red=!1,o.red=!0,this.rotateNode(o,a),o=e[a]),o.red=e.red,e.red=!1,o[a].red=!1,this.rotateNode(e,u),t=this.root,e=null))}t&&(t.red=!1)}insertFingerprintNode(e){if(this.root){let t=this.root,n=!0;for(;;){const r=this.compare(e,t.value);if(r===0){n=!1;break}const i=r<0?"left":"right";if(n&&i==="right"&&(n=!1),t[i])t=t[i];else return t[i]=new ni(t,e,this.monoid),this._size++,n&&(this.cachedMinNode=t[i]),t[i]}}else return this.root=new ni(null,e,this.monoid),this._size++,this.cachedMinNode=this.root,this.root;return null}insert(e){var r;const t=this.insertFingerprintNode(e);let n=t;if(n){for(;(r=n.parent)!=null&&r.red;){let i=n.parent;const u=i.directionFromParent(),a=u==="right"?"left":"right",o=i.parent[a]??null;o!=null&&o.red?(i.red=!1,o.red=!1,i.parent.red=!0,n=i.parent):(n===i[a]&&(n=i,this.rotateNode(n,u),i=n.parent),i.red=!1,i.parent.red=!0,this.rotateNode(i.parent,a))}this.root.red=!1}return t==null||t.updateLabel(!0,"Node inserted"),!!n}remove(e){var n;const t=this.removeNode(e);return t&&!t.red&&this.removeFixup(t.parent,t.left??t.right),t&&((n=t.parent)==null||n.updateLabel(!0,"Child node removed")),!!t}getFingerprint(e,t,n){if(this.root===null)return{fingerprint:this.monoid.neutral[0],size:0,items:[],nextTree:null};const r=this.compare(e,t);if(r===0)return{fingerprint:this.root.label[0],size:this.root.label[1][0],items:this.root.label[1][1][0],nextTree:this.cachedMinNode};if(r<0){const i=this.compare(e,this.cachedMinNode.value)<=0?this.cachedMinNode:null,u=n||i||this.findGteNode(e),{label:a,nextTree:o}=this.aggregateUntil(u,e,t);return{fingerprint:a[0],size:a[1][0],items:a[1][1][0],nextTree:o}}else{const i=this.cachedMinNode,u=this.root.label[1][1][1],a=this.compare(t,i.value)>0,o=this.compare(e,u)<=0;if(a&&o){const{label:l,nextTree:c}=this.aggregateUntil(i,i.value,t),h=[this.monoid.lift(u)[0],[1,[[u],u]]],d=n||this.findGteNode(e),{label:p}=this.aggregateUntil(d,e,u),g=this.monoid.combine(p,h),C=this.monoid.combine(l,g);return{fingerprint:C[0],size:C[1][0],items:C[1][1][0],nextTree:c}}else if(a){const{label:l,nextTree:c}=this.aggregateUntil(i,i.value,t);return{fingerprint:l[0],size:l[1][0],items:l[1][1][0],nextTree:c}}else{const l=this.compare(e,this.cachedMinNode.value)<=0?this.cachedMinNode:null,c=n||l||this.findGteNode(e),{label:f}=this.aggregateUntil(c,e,u),d=[this.monoid.lift(u)[0],[1,[[u],u]]],p=this.monoid.combine(f,d);return{fingerprint:p[0],size:p[1][0],items:p[1][1][0],nextTree:l}}}}findGteNode(e){let t=this.root;for(;t;){const n=this.compare(e,t.value);if(n===0)break;const r=n<0?"left":"right";if(t[r])t=t[r];else break}return t}aggregateUntil(e,t,n){const{label:r,nextTree:i}=this.aggregateUp(e,t,n);return i===null||this.compare(i.value,n)>=0?{label:r,nextTree:i}:this.aggregateDown(i.right,n,this.monoid.combine(r,i.liftedValue))}aggregateUp(e,t,n){var u;let r=this.monoid.neutral,i=e;for(;this.compare(i.label[1][1][1],n)<0;){if(this.compare(i.value,t)>=0&&(r=this.monoid.combine(r,this.monoid.combine(i.liftedValue,((u=i.right)==null?void 0:u.label)||this.monoid.neutral))),i.parent===null)return{label:r,nextTree:null};i=i.parent}return{label:r,nextTree:i}}aggregateDown(e,t,n){var u,a;let r=e,i=n;for(;r!==null;)if(this.compare(r.value,t)<0)i=this.monoid.combine(i,this.monoid.combine(((u=r.left)==null?void 0:u.label)||this.monoid.neutral,r.liftedValue)),r=r.right;else{if(r.left===null||this.compare(r.label[1][1][1],t)<0)return{label:this.monoid.combine(i,((a=r.left)==null?void 0:a.label)||this.monoid.neutral),nextTree:r};r=r.left}return{label:i,nextTree:null}}isValueEqual(e,t){return this.compare(e,t)===0}}function hc(){let s,e="pending";const t=new Promise((n,r)=>{s={async resolve(i){await i,e="fulfilled",n(i)},reject(i){e="rejected",r(i)}}});return Object.defineProperty(t,"state",{get:()=>e}),Object.assign(t,s)}class dc{constructor(){Object.defineProperty(this,"deferreds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"pending"})}resolve(e){if(this.state==="pending"){this.state="fulfilled";for(const t of this.deferreds)t.resolve(e)}}reject(e){if(this.state==="pending"){this.state="rejected";for(const t of this.deferreds)t.reject(e)}}tee(){const e=hc();return this.state==="fulfilled"?e.resolve():this.state==="rejected"?e.reject():this.deferreds.add(e),e}}class pc{constructor(e){Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDoneTee",{enumerable:!0,configurable:!0,writable:!0,value:new dc}),Object.defineProperty(this,"insertionCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"fingerprintEquals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowerBoundFromPrev",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"collatedPayload",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"collatePayloads",{enumerable:!0,configurable:!0,writable:!0,value:t=>{switch(t.type){case"payload":{let n=this.collatedPayload;if(n===null&&(n={type:"payload",lowerBound:t.lowerBound,payload:[],end:{canRespond:!1,upperBound:t.payload}}),n.payload.push(t.payload),this.collatedPayload=n,t.end)return t.end.upperBound?n.end=t.end:n.end={...t.end,upperBound:t.payload},this.collatedPayload=null,n;break}default:return this.collatedPayload&&(this.collatedPayload=null),t}}}),Object.defineProperty(this,"reusableTree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastAdjacentDoneUpperBound",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"isDoneSoFar",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.tree=e.tree,this.fingerprintEquals=e.fingerprintEquals,this.encoding=e.encoding,this.payloadThreshold=e.payloadThreshold,this.rangeDivision=e.rangeDivision}decode(e){const t=this.lowerBoundFromPrev;try{switch(this.encoding.decode.getType(e)){case"payload":{const r=this.encoding.decode.payload(e);return r.end&&(this.lowerBoundFromPrev=r.end.upperBound),{type:"payload",lowerBound:t,payload:r.value,...r.end?{end:r.end}:{}}}case"fingerprint":{const r=this.encoding.decode.fingerprint(e);return this.lowerBoundFromPrev=r.upperBound,{type:"fingerprint",lowerBound:t,fingerprint:r.fingerprint,upperBound:r.upperBound}}case"emptyPayload":{const r=this.encoding.decode.emptyPayload(e);return this.lowerBoundFromPrev=r,{lowerBound:t,type:"emptyPayload",upperBound:r}}case"done":{const r=this.encoding.decode.done(e);return this.lowerBoundFromPrev=r,{lowerBound:t,type:"done",upperBound:r}}case"emptySet":return{type:"emptySet",canRespond:this.encoding.decode.emptySet(e)};case"lowerBound":{const r=this.encoding.decode.lowerBound(e);return this.lowerBoundFromPrev=r,{type:"lowerBound",value:r}}case"terminal":return this.encoding.decode.terminal(e),{type:"terminal"}}}catch(n){console.group("range-reconcile: Could not decode message"),console.warn(e),console.warn(n)}return null}setReusableTree(e){this.reusableTree=e||void 0}process(e){const t=this.reusableTree;switch(e.type){case"lowerBound":case"terminal":case"done":return this.setReusableTree(null),[e];case"emptySet":{if(e.canRespond===!1&&this.isDoneTee.resolve(),this.tree.size===0)return[{type:"emptySet",canRespond:!1}];const n=this.tree.getLowestValue(),r=[{type:"lowerBound",value:n}],{items:i}=this.tree.getFingerprint(n,n);for(let u=0;u<i.length;u++){const a=i[u];u===i.length-1?r.push({type:"payload",payload:a,end:{upperBound:n,canRespond:!1}}):r.push({type:"payload",payload:a})}return r.push({type:"terminal"}),r}case"fingerprint":{const{fingerprint:n,size:r,items:i,nextTree:u}=this.tree.getFingerprint(e.lowerBound,e.upperBound,t);if(this.setReusableTree(u),this.fingerprintEquals(n,e.fingerprint))return[{type:"done",upperBound:e.upperBound}];if(r<=this.payloadThreshold){if(r===0)return[{type:"emptyPayload",upperBound:e.upperBound}];const a=[];for(let o=0;o<r;o++)a.push({type:"payload",payload:i[o],...o===i.length-1?{end:{upperBound:e.upperBound,canRespond:!0}}:{}});return a}else{const a=Math.ceil(r/this.rangeDivision),o=[];if(a<=this.payloadThreshold){for(let h=0;h<i.length;h++)o.push({type:"payload",payload:i[h],...h===i.length-1?{end:{upperBound:e.upperBound,canRespond:!0}}:{}});return o}let l;const c=i;let f=!1;if(e.lowerBound>=e.upperBound){let h=0;for(let d=0;d<=i.length;d++)if(i[d]>=e.lowerBound){h=d;break}if(h>0){const d=c.splice(0,h);c.push(...d),f=!0}}for(let h=0;h<r;h+=a){const d=c[h],p=c[h+a]||e.upperBound,{fingerprint:g,nextTree:C}=this.tree.getFingerprint(d,p,l);l=f?void 0:C||void 0,o.push({type:"fingerprint",fingerprint:g,upperBound:p})}return o}}case"payload":{for(const n of e.payload){this.tree.insert(n);for(const r of this.insertionCallbacks)r(n)}if(e.end.canRespond){const{items:n,size:r,nextTree:i}=this.tree.getFingerprint(e.lowerBound,e.end.upperBound,t);if(this.setReusableTree(i),r===0)return[{type:"emptyPayload",upperBound:e.end.upperBound}];const u=[];for(let o=0;o<r;o++){let l=!1;for(let c=0;c<e.payload.length;c++)this.tree.isValueEqual(n[o],e.payload[c])&&(l=!0);l||u.push({type:"payload",payload:n[o]})}const a=u[u.length-1];return u[u.length-1]={...a,end:{upperBound:e.end.upperBound,canRespond:!1}},u}else return this.setReusableTree(null),[{type:"done",upperBound:e.end.upperBound}]}case"emptyPayload":{this.setReusableTree(null);const{items:n,size:r,nextTree:i}=this.tree.getFingerprint(e.lowerBound,e.upperBound);if(this.setReusableTree(i),r===0)return this.setReusableTree(null),[];const u=[];for(let a=0;a<r;a++)u.push({type:"payload",payload:n[a],...a===n.length-1?{end:{upperBound:e.upperBound,canRespond:!1}}:{}});return u}}}consolidateAdjacentDones(e){switch(e.type){case"done":{this.lastAdjacentDoneUpperBound=e.upperBound;break}default:{const t=this.lastAdjacentDoneUpperBound;return t?(this.lastAdjacentDoneUpperBound=null,[{type:"done",upperBound:t},e]):[e]}}}checkIsDone(e){var t;if(this.isDoneTee.state==="pending")switch(e.type){case"emptySet":{e.canRespond&&(this.isDoneSoFar=!1);break}case"lowerBound":break;case"fingerprint":this.isDoneSoFar=!1;break;case"emptyPayload":this.isDoneSoFar=!1;break;case"payload":((t=e.end)==null?void 0:t.canRespond)===!0&&(this.isDoneSoFar=!1);break;case"terminal":this.isDoneSoFar?this.isDoneTee.resolve():this.isDoneSoFar=!0}}encode(e){let t;switch(e.type){case"emptySet":{t=this.encoding.encode.emptySet(e.canRespond);break}case"lowerBound":{t=this.encoding.encode.lowerBound(e.value);break}case"done":{t=this.encoding.encode.done(e.upperBound);break}case"fingerprint":{t=this.encoding.encode.fingerprint(e.fingerprint,e.upperBound);break}case"payload":{t=this.encoding.encode.payload(e.payload,e.end);break}case"emptyPayload":{t=this.encoding.encode.emptyPayload(e.upperBound);break}case"terminal":{t=this.encoding.encode.terminal();break}}return t}respond(e){if(this.isDone().state==="fulfilled")return[];const t=this.decode(e),n=this.collatePayloads(t);if(n===void 0)return[];const r=this.process(n),i=[];for(const a of r){const o=this.consolidateAdjacentDones(a);o&&i.push(...o)}for(const a of i)this.checkIsDone(a);const u=[];for(const a of i)u.push(this.encode(a));return u}isDone(){return this.isDoneTee.tee()}initialMessages(e){const{tree:t,encoding:n,payloadThreshold:r,rangeDivision:i}=this;function*u(){if(t.size===0){yield n.encode.emptySet(!0);return}const a=t.getLowestValue();yield n.encode.lowerBound(a);const{items:l}=t.getFingerprint(a,a),f=(e||(p=>{const g=Math.ceil(p.length/i),C=[];for(let b=0;b<p.length;b+=g){const A=p.slice(b,b+g);C.push(A)}return C}))(l);let h;for(let p=0;p<f.length;p++){const g=f[p+1]?f[p+1][0]:a,C=f[p];if(C.length<=r)for(let b=0;b<C.length;b++)yield n.encode.payload(C[b],b===C.length-1?{upperBound:g,canRespond:!0}:void 0);else{const b=C[0],{fingerprint:A,nextTree:E}=t.getFingerprint(b,g,h);h=E||void 0,yield n.encode.fingerprint(A,g)}}yield n.encode.terminal()}return u()}onInsertion(e){return this.insertionCallbacks.add(e),()=>{this.insertionCallbacks.delete(e)}}}var $e=globalThis&&globalThis.__classPrivateFieldGet||function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},ir=globalThis&&globalThis.__classPrivateFieldSet||function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},Wt,Kt,Rn,wt,Qr,ur;const ri=Symbol("Stream ended."),Gr=Symbol("Stream errored.");class Ft{constructor(e){var t,n,r;Wt.add(this),Kt.set(this,[]),Rn.set(this,null),wt.set(this,void 0),Object.defineProperty(this,"push",{enumerable:!0,configurable:!0,writable:!0,value:(...i)=>{i.length?$e(this,Wt,"m",ur).call(this,!1,i):($e(this,Wt,"m",ur).call(this,!1,[Gr]),$e(this,Wt,"m",Qr).call(this,new Error("AsyncQueueError: queue.push was called with no arguments")))}}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:({immediately:i=!1,withError:u}={})=>{u&&$e(this,Wt,"m",Qr).call(this,u),$e(this,Wt,"m",ur).call(this,i,[u?Gr:ri]),this.push=this.close=()=>{}}}),(r=(n=(t=e==null?void 0:e.catch)==null?void 0:t.call(e,i=>this.close({withError:i})))==null?void 0:n.finally)==null||r.call(n,()=>this.close())}get length(){return $e(this,Kt,"f").length}async*[(Kt=new WeakMap,Rn=new WeakMap,wt=new WeakMap,Wt=new WeakSet,Qr=function(t){$e(this,wt,"f")instanceof AggregateError?$e(this,wt,"f").errors.push(t):$e(this,wt,"f")?ir(this,wt,new AggregateError([$e(this,wt,"f"),t]),"f"):ir(this,wt,t,"f")},ur=function(t,n){var r;$e(this,Kt,"f")[t?"unshift":"push"](...n),(r=$e(this,Rn,"f"))==null||r.call(this,$e(this,Kt,"f").shift()),ir(this,Rn,null,"f")},Symbol.asyncIterator)](){for(;;){const e=$e(this,Kt,"f").length?$e(this,Kt,"f").shift():await new Promise(t=>{ir(this,Rn,t,"f")});if(e===Gr)throw $e(this,wt,"f");if(e===ri)break;yield e}}}function ne(){let s,e="pending";const t=new Promise((n,r)=>{s={async resolve(i){await i,e="fulfilled",n(i)},reject(i){e="rejected",r(i)}}});return Object.defineProperty(t,"state",{get:()=>e}),Object.assign(t,s)}new co;const mc=new bs;function as(s){return mc.encode(s)}function gc(s){return as(s).length}function ls(s,e){for(let t of s)if(e.indexOf(t)===-1)return!1;return!0}function si(s){return s===""?!1:Pr.indexOf(s)!==-1}const Zn="abcdefghijklmnopqrstuvwxyz",Dc=Zn.toUpperCase(),Pr="0123456789",ft=Zn+"234567",Mo=Zn+Pr,bc=ft,No=Mo+ft+"@.",$o=Zn+Pr,wc=ft,Lo=$o+ft+"+.",_c="/'()-._~!$&+,:=@%",jo=Zn+Dc+Pr+_c;function yc(s,e){return`@${s}.${e}`}function Cc(s,e){return`+${s}.${e}`}function Rr(s){const e=Uo(s);return io(e)?!0:e}function Ut(s){const e=Or(s);return io(e)?!0:e}function cs(s){return s.startsWith("@")?Uo(s):s.startsWith("+")?Or(s):new x("address must start with either @ or +")}function Uo(s){return zo(s,{sigil:"@",separator:".",minNameLength:4,maxNameLength:4,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:Mo,allowedPubkeyCharacters:bc,pubkeyMustStartWithB:!0})}function Or(s){return zo(s,{sigil:"+",separator:".",minNameLength:1,maxNameLength:15,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:$o,allowedPubkeyCharacters:wc,pubkeyMustStartWithB:!1})}function zo(s,e){const{sigil:t,separator:n,minNameLength:r,maxNameLength:i,minPubkeyLength:u,maxPubkeyLength:a,allowedNameCharacters:o,allowedPubkeyCharacters:l,pubkeyMustStartWithB:c}=e;if(typeof s!="string")return new x("address must be a string");if(s.length<4)return new x("address is too short");if(s[0]!==t)return new x(`address must start with a sigil: "${t}"`);if(s.indexOf(n)===-1)return new x(`address must contain a separator character: "${n}"`);const f=s.slice(1).split(n);if(f.length!==2)return new x(`address must have exactly 2 parts separated by a "${n}" separator`);const[h,d]=f;return h.length<r||h.length>i?new x(`name must be between ${r} and ${i} characters long, but is ${h.length}`):d.length<u||d.length>a?new x(`pubkey must be between ${u} and ${a} characters long, but is ${d.length}`):ls(h,o)?ls(d,l)?si(h[0])?new x(`name "${h}" must not start with a digit`):si(d[0])?new x(`pubkey "${d}" must not start with a digit`):c&&d[0]!=="b"?new x(`pubkey "${d}" must start with 'b'`):{address:s,name:h,pubkey:d}:new x(`pubkey "${d}" must only have allowed characters`):new x(`name "${h}" must only have allowed characters`)}function Cs(s){return!(Object.prototype.toString.call(s)!=="[object Object]"||(""+s.constructor).startsWith("class"))}function Ho(s){return e=>e!==s?`expected literal value ${JSON.stringify(s)}`:null}function Ye(s={}){return e=>{if(s.optional!==!0&&e===void 0)return"required";if(s.optional===!0&&e===void 0)return null;let t=gc(e);return typeof e!="string"?"expected a string but got "+JSON.stringify(e):s.minLen!==void 0&&t<s.minLen?`string shorter than min length of ${s.minLen} chars`:s.maxLen!==void 0&&t>s.maxLen?`string shorter than max length of ${s.maxLen} chars`:s.len!==void 0&&t!==s.len?`string does not have required length of ${s.len} chars: ${e}`:s.allowedChars!==void 0&&!ls(e,s.allowedChars)?"contains disallowed characters":null}}function Un(s={}){return e=>s.optional!==!0&&e===void 0?"required":s.optional===!0&&e===void 0?null:s.nullable!==!0&&e===null?"not nullable":s.nullable===!0&&e===null?null:typeof e!="number"?"expected a number but got "+JSON.stringify(e):isNaN(e)?"is NaN":isFinite(e)?e!==Math.round(e)?"expected an integer":s.min!==void 0&&e<s.min?`integer too small (must be >= ${s.min})`:s.max!==void 0&&e>s.max?`integer too large (must be <= ${s.max})`:null:"is Infinity"}function qo(s={}){return s.allowLiteralUndefined=s.allowLiteralUndefined??!1,s.allowExtraKeys=s.allowExtraKeys??!1,e=>{if(!Cs(e))return"expected an object";if(s.allowLiteralUndefined===!1){for(let[t,n]of Object.entries(e))if(n===void 0)return`${t} is explicitly set to undefined but should be missing instead`}if(s.objSchema!==void 0){if(s.allowExtraKeys===!1){let t=Object.keys(e),n=Object.keys(s.objSchema),r=t.filter(i=>n.indexOf(i)===-1);if(r.length>0)return`object has extra keys not in the schema: ${r.join(", ")}`}for(let[t,n]of Object.entries(s.objSchema)){let r=n(e[t]);if(r!==null)return`${t}: ${r}`}}return null}}const{codec:Wo}=xl,Ko={chars:"abcdefghijklmnopqrstuvwxyz234567",bits:5};function an(s){return"b"+Wo.stringify(s,Ko,{pad:!1})}function Cr(s){if(!s.startsWith("b"))throw new x("can't decode base32 string - it should start with a 'b'. "+s);if(s[s.length-1]==="=")throw new x("can't decode base32 string - it contains padding characters ('=')");return Wo.parse(s.slice(1),Ko,{loose:!0})}var kt;(function(s){s[s.None=-1]="None",s[s.Error=0]="Error",s[s.Warn=1]="Warn",s[s.Log=2]="Log",s[s.Info=3]="Info",s[s.Debug=4]="Debug"})(kt||(kt={}));const Ac=kt.Error;let Yr={_default:Ac};function Ec(s){return s in Yr?Yr[s]:Yr._default}class He{constructor(e,t){Object.defineProperty(this,"source",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.source=e,this.color=t||"aqua"}_print(e,t,n,...r){if(e<=Ec(this.source))if(t){const i=`[${this.source}]`;if(this.color!==void 0){const u=[`%c ${i}`,`color: ${this.color}`];console.log(n,...u,...r)}else console.log(n,i,...r)}else console.log(n,...r)}error(...e){this._print(kt.Error,!0,"!!",...e)}warn(...e){this._print(kt.Warn,!0,"! ",...e)}log(...e){this._print(kt.Log,!0,"  ",...e)}info(...e){this._print(kt.Info,!0,"    ",...e)}debug(...e){this._print(kt.Debug,!0,"      ",...e)}blank(){this._print(kt.Info,!1,"")}}class vc{constructor(e){Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalDigest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.hash=e.hash,this.internalUpdate=e.update,this.internalDigest=e.digest}update(e){return this.hash=this.internalUpdate(this.hash,e),this.hash}digest(){return this.internalDigest(this.hash)}}const{createHash:Jr}=Vl,Zr=new He("crypto-driver-noble","cyan"),kc=class{static sha256(s){return typeof s=="string"?Promise.resolve(Jr("sha256").update(s,"utf-8").digest()):Promise.resolve(Jr("sha256").update(s).digest())}static updatableSha256(){return new vc({hash:Jr("sha256"),update:(s,e)=>s.update(e),digest:s=>s.digest()})}static async generateKeypairBytes(){Zr.debug("generateKeypairBytes");const s=Ir.randomPrivateKey();return{pubkey:await sc(s),secret:s}}static sign(s,e){return Zr.debug("sign"),typeof e=="string"&&(e=as(e)),ic(e,s.secret)}static async verify(s,e,t){Zr.debug("verify");try{return typeof t=="string"&&(t=as(t)),await uc(e,t,s)}catch{return!1}}};function ii(){return Date.now()*1e3}function Vo(s){return new Promise(e=>{en(e,s)})}function Bt(){return""+Math.floor(Math.random()*1e3)+Math.floor(Math.random()*1e3)}function Fc(s){try{const e=Qo(s)?s.address:s.shareAddress,t=cs(e);if(M(t))return t;const n={pubkey:Cr(t.pubkey),secret:Cr(s.secret)};return n.pubkey.length!==32?new x(`pubkey bytes should be 32 bytes long, not ${n.pubkey.length} after base32 decoding.  ${e}`):n.secret.length!==32?new x(`secret bytes should be 32 bytes long, not ${n.secret.length} after base32 decoding.  ${s.secret}`):n}catch(e){return new x("crash while decoding author keypair: "+e.message)}}function Qo(s){return"address"in s}new He("crypto","cyan");let ln=kc,On=new He("crypto","cyan");const De=class{static async sha256base32(s){const e=await ln.sha256(s);return an(e)}static updatableSha256(){return ln.updatableSha256()}static async generateAuthorKeypair(s){On.debug(`generateAuthorKeypair("${s}")`);const e=await ln.generateKeypairBytes(),t={address:yc(s,an(e.pubkey)),secret:an(e.secret)},n=Rr(t.address);return M(n)?n:t}static async generateShareKeypair(s){On.debug(`generateAuthorKeypair("${s}")`);const e=await ln.generateKeypairBytes(),t={shareAddress:Cc(s,an(e.pubkey)),secret:an(e.secret)},n=Ut(t.shareAddress);return M(n)?n:t}static async sign(s,e){On.debug("sign");try{const t=Fc(s);if(M(t))return t;const n=await ln.sign(t,e);return an(n)}catch(t){return new x("unexpected error while signing: "+t.message)}}static verify(s,e,t){On.debug("verify");try{const n=cs(s);return M(n)?Promise.resolve(!1):ln.verify(Cr(n.pubkey),Cr(e),t)}catch{return Promise.resolve(!1)}}static async checkKeypairIsValid(s){On.debug("checkAuthorKeypairIsValid");const e=Qo(s)?s.address:s.shareAddress;try{if(typeof e!="string"||typeof s.secret!="string")return new x("address and secret must be strings");const t=cs(e);if(M(t))return t;const n="a test message to sign. "+Bt(),r=await this.sign(s,n);return M(r)?r:await this.verify(e,r,n)===!1?new x("pubkey does not match secret"):!0}catch(t){return new x("unexpected error in checkAuthorKeypairIsValid: "+t.message)}}};var Bc=globalThis&&globalThis.__setFunctionName||function(s,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(s,"name",{configurable:!0,value:t?"".concat(t," ",e):e})},or;new He("validator es.4","red");const Sc=10,Tc=Sc*60*1e3*1e3,ui=1e13,oi=9007199254740990,Ic=4e6,Pc=53,Rc=104,ai={objSchema:{format:Ho("es.4"),author:Ye({allowedChars:No}),content:Ye({maxLen:Ic}),contentHash:Ye({allowedChars:ft,len:Pc}),deleteAfter:Un({min:ui,max:oi,nullable:!0}),path:Ye({allowedChars:jo,minLen:2,maxLen:512}),signature:Ye({allowedChars:ft,len:Rc}),timestamp:Un({min:ui,max:oi}),workspace:Ye({allowedChars:Lo})},allowLiteralUndefined:!1,allowExtraKeys:!1};or=class{static hashDocument(s){const e={...s,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},t=this._checkBasicDocumentValidity(e);return M(t)?Promise.resolve(t):De.sha256base32(`author	${s.author}
contentHash	${s.contentHash}
`+(s.deleteAfter===null?"":`deleteAfter	${s.deleteAfter}
`)+`format	${s.format}
path	${s.path}
timestamp	${s.timestamp}
workspace	${s.workspace}
`)}static async generateDocument({input:s,keypair:e,share:t,timestamp:n}){const r={format:"es.4",author:e.address,content:s.content,contentHash:await De.sha256base32(s.content),deleteAfter:s.deleteAfter??null,path:s.path,timestamp:n,workspace:t,signature:"?"},i=await this.signDocument(e,r);return M(i)?i:{doc:i}}static async signDocument(s,e){const t=await this.hashDocument(e);if(M(t))return t;const n=await De.sign(s,t);return M(n)?n:{...e,signature:n}}static async wipeDocument(s,e){if(e.content.length===0)return e;const t=this.removeExtraFields(e);if(M(t))return t;const r={...t.doc,content:"",contentHash:await De.sha256base32(""),signature:"?"};return this.signDocument(s,r)}static removeExtraFields(s){if(!Cs(s))return new x("doc is not a plain javascript object");const e=new Set(Object.keys(ai.objSchema||{})),t={},n={};for(const[r,i]of Object.entries(s))if(e.has(r))t[r]=i;else{if(!r.startsWith("_"))return new x("extra document fields must have names starting with an underscore");n[r]=i}return{doc:t,extras:n}}static async checkDocumentIsValid(s,e){e===void 0&&(e=Date.now()*1e3);const t=this._checkBasicDocumentValidity(s);if(M(t))return t;const n=this._checkTimestampIsOk(s.timestamp,s.deleteAfter,e);if(M(n))return n;const r=this._checkAuthorCanWriteToPath(s.author,s.path);if(M(r))return r;const i=this._checkPathIsValid(s.path,s.deleteAfter);if(M(i))return i;const u=Rr(s.author);if(M(u))return u;const a=Ut(s.workspace);if(M(a))return a;const o=await this._checkAuthorSignatureIsValid(s);if(M(o))return o;const l=await this._checkContentMatchesHash(s.content,s.contentHash);return M(l)?l:!0}static _checkBasicDocumentValidity(s){const e=qo(ai)(s);return e!==null?new x(e):!0}static _checkAuthorCanWriteToPath(s,e){return e.indexOf("~")===-1||e.indexOf("~"+s)!==-1?!0:new x(`author ${s} can't write to path ${e}`)}static _checkTimestampIsOk(s,e,t){if(s>t+Tc)return new x("timestamp too far in the future");if(e!==null){if(t>e)return new x("ephemeral doc has expired");if(e<=s)return new x("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(s,e){if(!s.startsWith("/"))return new x("invalid path: must start with /");if(s.endsWith("/"))return new x("invalid path: must not end with /");if(s.startsWith("/@"))return new x('invalid path: must not start with "/@"');if(s.indexOf("//")!==-1)return new x("invalid path: must not contain two consecutive slashes");if(e!==void 0){if(s.indexOf("!")===-1&&e!==null)return new x("when deleteAfter is set, path must contain '!'");if(s.indexOf("!")!==-1&&e===null)return new x("when deleteAfter is null, path must not contain '!'")}return!0}static async _checkAuthorSignatureIsValid(s){try{const e=await this.hashDocument(s);return M(e)?e:await De.verify(s.author,s.signature,e)!==!0?new x("signature is invalid"):!0}catch{return new x("signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(s,e){return await De.sha256base32(s)!==e?new x("content does not match contentHash"):!0}static getAttachmentInfo(s){return new x("es.4 does not support attachments")}static updateAttachmentFields(s,e,t,n){return Promise.resolve(new x("es.4 does not support attachments"))}static authorFromCredentials(s){return s.address}},Bc(or,"FormatEs4"),Object.defineProperty(or,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.4"});var Oc=globalThis&&globalThis.__setFunctionName||function(s,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(s,"name",{configurable:!0,value:t?"".concat(t," ",e):e})},ar;new He("validator es.5","red");const xc=10,Mc=xc*60*1e3*1e3,li=1e13,ci=9007199254740990,Nc=8e3,fi=53,hi=104,$c=0,Lc=Number.MAX_SAFE_INTEGER,di={objSchema:{format:Ho("es.5"),author:Ye({allowedChars:No}),text:Ye({maxLen:Nc}),textHash:Ye({allowedChars:ft,len:fi}),deleteAfter:Un({min:li,max:ci,optional:!0}),path:Ye({allowedChars:jo,minLen:2,maxLen:512}),signature:Ye({allowedChars:ft,len:hi}),shareSignature:Ye({allowedChars:ft,len:hi}),timestamp:Un({min:li,max:ci}),share:Ye({allowedChars:Lo}),attachmentSize:Un({min:$c,max:Lc,optional:!0}),attachmentHash:Ye({allowedChars:ft,len:fi,optional:!0})},allowLiteralUndefined:!1,allowExtraKeys:!1},jc=(ar=class{static hashDocument(s){const e={...s,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",shareSignature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},t=this._checkBasicDocumentValidity(e);return M(t)?Promise.resolve(t):De.sha256base32((s.attachmentHash===void 0?"":`attachmentHash	${s.attachmentHash}
`)+(s.attachmentSize===void 0?"":`attachmentSize	${s.attachmentSize}
`)+`author	${s.author}
`+(s.deleteAfter===void 0?"":`deleteAfter	${s.deleteAfter}
`)+`format	${s.format}
path	${s.path}
textHash	${s.textHash}
timestamp	${s.timestamp}
share	${s.share}
`)}static async generateDocument({input:s,keypair:e,share:t,timestamp:n,prevLatestDoc:r,config:i}){if(s.text===void 0&&(r==null?void 0:r.text)===void 0)return new x("Couldn't determine document text from given input or previous version's text.");const u=s.text!==void 0?s.text:r==null?void 0:r.text,a={...r,format:"es.5",author:e.address,text:u,textHash:await De.sha256base32(u),path:s.path,timestamp:n,share:t,signature:"?",shareSignature:"?"};s.deleteAfter&&(a.deleteAfter=s.deleteAfter);const o=await this.signDocument(e,a,i);return M(o)?o:s.attachment?{doc:o,attachment:s.attachment}:{doc:o}}static async signDocument(s,e,t){const n=await this.hashDocument(e);if(M(n))return n;const r=await De.sign(s,n);if(t.shareSecret===void 0)return new Qe(`Tried to write a document to ${e.share} without the secret.`);const i=await De.sign({shareAddress:e.share,secret:t.shareSecret},n);return M(r)?r:M(i)?i:{...e,signature:r,shareSignature:i}}static async wipeDocument(s,e,t){if(e.text.length===0)return e;const n=this.removeExtraFields(e);if(M(n))return n;const r=n.doc;if(r.attachmentHash){const u={...r,text:"",textHash:await De.sha256base32(""),signature:"?",shareSignature:"?",attachmentHash:await De.sha256base32(""),attachmentSize:0};return this.signDocument(s,u,t)}const i={...r,text:"",textHash:await De.sha256base32(""),signature:"?",shareSignature:"?"};return this.signDocument(s,i,t)}static removeExtraFields(s){if(!Cs(s))return new x("doc is not a plain javascript object");const e=new Set(Object.keys(di.objSchema||{})),t={},n={};for(const[r,i]of Object.entries(s))if(e.has(r))t[r]=i;else{if(!r.startsWith("_"))return new x("extra document fields must have names starting with an underscore");n[r]=i}return{doc:t,extras:n}}static async checkDocumentIsValid(s,e){e===void 0&&(e=Date.now()*1e3);const t=this._checkBasicDocumentValidity(s);if(M(t))return t;const n=this._checkTimestampIsOk(s.timestamp,s.deleteAfter?s.deleteAfter:null,e);if(M(n))return n;const r=this._checkAuthorCanWriteToPath(s.author,s.path);if(M(r))return r;const i=this._checkAttachmentFieldsConsistent(s);if(M(i))return i;const u=this._checkPathIsValid(s.path,!!s.attachmentHash,s.deleteAfter);if(M(u))return u;const a=Rr(s.author);if(M(a))return a;const o=Ut(s.share);if(M(o))return o;const l=await this._checkAuthorSignatureIsValid(s);if(M(l))return l;const c=await this._checkShareSignatureIsValid(s);if(M(c))return c;const f=await this._checkContentMatchesHash(s.text,s.textHash);return M(f)?f:!0}static _checkBasicDocumentValidity(s){const e=qo(di)(s);return e!==null?new x(e):!0}static _checkAttachmentFieldsConsistent(s){return s.text.length===0&&s.attachmentSize&&s.attachmentSize>0?new x("Documents with attachments must have text."):(s.text.length>0&&s.attachmentSize&&s.attachmentSize,s.attachmentHash&&s.attachmentSize===void 0?new x("Attachment size is undefined while attachment hash is defined"):s.attachmentSize&&s.attachmentHash===void 0?new x("Attachment hash is undefined while attachment size is defined"):!0)}static _checkAuthorCanWriteToPath(s,e){return e.indexOf("~")===-1||e.indexOf("~"+s)!==-1?!0:new x(`author ${s} can't write to path ${e}`)}static _checkTimestampIsOk(s,e,t){if(s>t+Mc)return new x("timestamp too far in the future");if(e!==null){if(t>e)return new x("ephemeral doc has expired");if(e<=s)return new x("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(s,e,t){if(!s.startsWith("/"))return new x("invalid path: must start with /");if(s.endsWith("/"))return new x("invalid path: must not end with /");if(s.startsWith("/@"))return new x('invalid path: must not start with "/@"');if(s.indexOf("//")!==-1)return new x("invalid path: must not contain two consecutive slashes");if(t!==void 0){if(s.indexOf("!")===-1&&t!==null)return new x("when deleteAfter is set, path must contain '!'");if(s.indexOf("!")!==-1&&t===null)return new x("when deleteAfter is null, path must not contain '!'")}return!pi(s)&&e?new x("when a attachment is provided, the path must end with a file extension"):pi(s)&&e===!1?new x("when no attachment is provided, the path cannot end with a file extension"):!0}static async _checkAuthorSignatureIsValid(s){try{const e=await this.hashDocument(s);return M(e)?e:await De.verify(s.author,s.signature,e)!==!0?new x("signature is invalid"):!0}catch{return new x("signature is invalid (unexpected exception)")}}static async _checkShareSignatureIsValid(s){try{const e=await this.hashDocument(s);return M(e)?e:await De.verify(s.share,s.shareSignature,e)!==!0?new x("share signature is invalid"):!0}catch{return new x("share signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(s,e){return await De.sha256base32(s)!==e?new x("content does not match contentHash"):!0}static getAttachmentInfo(s){return s.attachmentHash&&s.attachmentSize===0?new x("This document has had its attachment wiped"):!s.attachmentHash||!s.attachmentSize?new x("This document has no attachment."):{size:s.attachmentSize,hash:s.attachmentHash}}static updateAttachmentFields(s,e,t,n,r){const i={...e,attachmentHash:n,attachmentSize:t};return this.signDocument(s,i,r)}static authorFromCredentials(s){return s.address}},Oc(ar,"FormatEs5"),Object.defineProperty(ar,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.5"}),ar),Uc=/^.*\.(\w+)$/,zc=/^.*~@\w{4}\.\w{53}$/;function pi(s){if(s.indexOf(".")===-1)return!1;const e=s.match(Uc);return!(e===null||e[1].length===53&&s.match(zc))}const ht=jc,xr=[ht];function mi(s){return s||ht}function Dn(s){return s||xr}function Hc(s,e){const t=[];for(const n of e)s.includes(n.id)&&t.push(n);return t}function bn(s){const e=s||xr,t={};for(const n of e)t[n.id]=n;return t}class Mr{constructor(){Object.defineProperty(this,"deferreds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"pending"})}resolve(e){if(this.state==="pending"){this.state="fulfilled";for(const t of this.deferreds)t.resolve(e)}}reject(e){if(this.state==="pending"){this.state="rejected";for(const t of this.deferreds)t.reject(e)}}getPromise(){const e=ne();return this.state==="fulfilled"?e.resolve():this.state==="rejected"?e.reject():this.deferreds.add(e),e}}class Kn{constructor(e=!1){Object.defineProperty(this,"promises",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"sealed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"multiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new Mr}),Object.defineProperty(this,"allowRejectedPromises",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.allowRejectedPromises=e}enrol(e){if(this.sealed)throw new Qe("Tried to enrol a promise when enrolment was already sealed.");this.promises.add(e),e.then(()=>{this.checkAllDone()}).catch(t=>{if(!this.allowRejectedPromises)throw t})}checkAllDone(){this.sealed&&(this.allowRejectedPromises?Promise.allSettled(this.promises).then(()=>{this.multiDeferred.resolve()}):Promise.all(this.promises).then(()=>{this.multiDeferred.resolve()}).catch(()=>{this.multiDeferred.reject()}))}seal(){this.sealed||(this.sealed=!0,this.checkAllDone())}isSealed(){return this.sealed}isDone(){return this.multiDeferred.getPromise()}}class qc{constructor(){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"transform",{enumerable:!0,configurable:!0,writable:!0,value:new kn({transform(e,t){t.enqueue(e)}})}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:this.transform.writable.getWriter()}),Object.defineProperty(this,"readable",{enumerable:!0,configurable:!0,writable:!0,value:this.transform.readable}),Object.defineProperty(this,"writables",{enumerable:!0,configurable:!0,writable:!0,value:[]})}checkClosed(){if(this.closed)throw"Closed"}getWritableStream(){this.checkClosed();const e=this.writer,t=new nt({async write(n){await e.ready,await e.write(n)}});return this.writables.push(t),t}async close(){this.checkClosed();for(const e of this.writables)await e.abort();this.transform.writable.abort(),this.closed=!0}isClosed(){return this.closed}}class Wc{constructor(){Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:new kn(new Qc)}),Object.defineProperty(this,"sourceReadable",{enumerable:!0,configurable:!0,writable:!0,value:this.transformStream.readable}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:this.transformStream.writable})}getReadableStream(){const[e,t]=this.sourceReadable.tee();return this.sourceReadable=e,t}}class Kc{checkClosed(){if(this.closed)throw"Closed"}constructor(){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"subscribers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"writables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=this.subscribers;this.writable=new nt({write(t){const n=e.map(({writer:r})=>new Promise(i=>{r.ready.then(()=>{r.write(t).then(i)})}));Promise.all(n)}})}getReadableStream(){this.checkClosed();const e=new kn({transform(t,n){n.enqueue(t)}});return this.subscribers.push({transform:e,writer:e.writable.getWriter()}),e.readable}async close(){this.checkClosed();for(const e of this.writables)await e.abort();for(const{transform:e}of this.subscribers)await e.writable.abort(),await e.readable.cancel();this.closed=!0}isClosed(){return this.closed}}class Vc{checkClosed(){if(this.closed)throw"Closed"}constructor(e){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineStream",{enumerable:!0,configurable:!0,writable:!0,value:new qc}),Object.defineProperty(this,"cloneStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e?this.cloneStream=new Kc:this.cloneStream=new Wc,this.combineStream.readable.pipeTo(this.cloneStream.writable)}getWritableStream(){return this.combineStream.getWritableStream()}getReadableStream(){return this.cloneStream.getReadableStream()}close(){this.checkClosed(),this.combineStream.close(),this.closed=!0}isClosed(){return this.closed}}class Go{constructor(){Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set})}onWrite(e){return this.callbacks.add(e),()=>{this.callbacks.delete(e)}}async write(e){for(const t of this.callbacks)await t(e)}close(){this.callbacks.clear()}}class sn{constructor(){Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"lock",{enumerable:!0,configurable:!0,writable:!0,value:new Yo})}on(e){return this.callbacks.add(e),()=>{this.callbacks.delete(e)}}async send(e){for(const t of this.callbacks)await this.lock.run(()=>t(e))}}class Qc{transform(e,t){t.enqueue(e)}}class Yo{constructor(){Object.defineProperty(this,"doneEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new Kn}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:new nt({async write(e){await e()}})}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:this.writable.getWriter()}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1})}checkClosed(){if(this.closed)throw"Closed"}async run(e){this.checkClosed(),await this.writer.ready;const t=this.writer.write(e);return this.doneEnroller.enrol(t),t}async close(){this.checkClosed(),this.doneEnroller.seal(),await this.doneEnroller.isDone(),this.writer.releaseLock(),await this.writable.abort(),this.closed=!0}isClosed(){return this.closed}}class Gc{constructor(e,t){Object.defineProperty(this,"channel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.channel=e,this.channelKey=t}transform(e,t){if(this.channel==="*"||this.channel===e[this.channelKey]){t.enqueue(e);return}}}class Yc{constructor(e,t){Object.defineProperty(this,"multistream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.multistream=new Vc(t),this.channelKey=e}getWritableStream(){return this.multistream.getWritableStream()}getReadableStream(e){const t=new kn(new Gc(e,this.channelKey));return this.multistream.getReadableStream().pipeThrough(t)}}function Jc(s,e){const t=ne(),n=ne(),r=()=>{if(n.state==="pending"){let i;s instanceof gn?i=s:i=new gn(s),n.resolve(i),i.binaryType="arraybuffer",i.readyState===i.OPEN&&t.resolve(),i.onopen=()=>{t.resolve()}}};return new nt({async write(i,u){r();const a=await n;await t;try{const o=e(i);a.send(o)}catch(o){u.error(o)}a.onclose=()=>{u.error("Socket closed before we were done")}},async close(){r();const i=await n;await t,i.close()},async abort(){r();const i=await n;await t,i.close()}})}function Zc(s,e){const t=ne();let n=!1;const r=()=>{if(t.state==="pending")if(s instanceof gn)t.resolve(s);else try{const i=new gn(s);t.resolve(i)}catch(i){t.reject(i)}};return new tn({async start(i){r();const u=await t;u.binaryType="arraybuffer",u.onmessage=a=>{const o=e(a);try{i.enqueue(o)}catch{}},u.onclose=()=>{if(!n)try{i.close()}catch{}},u.onerror=a=>{n=!0,i.error(a)}},async cancel(){r(),(await t).close()}})}function Xc(s){let t=s.toString(16);return t.length%2&&(t="0"+t),t}function ef(s){return BigInt("0x"+s)}const tf={EMPTY_SET:"emptySet",LOWER_BOUND:"lowerBound",PAYLOAD:"payload",EMPTY_PAYLOAD:"emptyPayload",DONE:"done",FINGERPRINT:"fingerprint",TERMINAL:"terminal"},nf={encode:{emptySet:s=>({type:"EMPTY_SET",canRespond:s}),lowerBound:s=>({type:"LOWER_BOUND",value:s}),payload:(s,e)=>({type:"PAYLOAD",payload:s,...e?{end:e}:{}}),emptyPayload:s=>({type:"EMPTY_PAYLOAD",upperBound:s}),done:s=>({type:"DONE",upperBound:s}),fingerprint:(s,e)=>({type:"FINGERPRINT",fingerprint:Xc(s),upperBound:e}),terminal:()=>({type:"TERMINAL"})},decode:{getType:s=>tf[s.type],emptySet:s=>{if(s.type==="EMPTY_SET")return s.canRespond;throw"Can't decode"},lowerBound:s=>{if(s.type==="LOWER_BOUND")return s.value;throw"Can't decode"},payload:s=>{if(s.type==="PAYLOAD")return{value:s.payload,...s.end?{end:s.end}:{}};throw"Can't decode"},emptyPayload:s=>{if(s.type==="EMPTY_PAYLOAD")return s.upperBound;throw"Can't decode"},done:s=>{if(s.type==="DONE")return s.upperBound;throw"Can't decode"},fingerprint:s=>{if(s.type==="FINGERPRINT")return{fingerprint:ef(s.fingerprint),upperBound:s.upperBound};throw"Can't decode"},terminal:s=>{if(s.type==="TERMINAL")return!0;throw"Can't decode"}}};class rf extends pc{constructor(e,t,n){super({tree:e,encoding:nf,fingerprintEquals:(r,i)=>r===i,payloadThreshold:t,rangeDivision:n})}}class sf{sendEvent(e){return this.inboundEventQueue.push(e)}events(){return this.outboundEventQueue}getStatus(){return{requestedCount:this.requestedCount,receivedCount:this.receivedDocsCount,sentCount:this.sentDocsCount,status:this.isDoneMultiDeferred.state==="rejected"?"aborted":this.hasPrepared.state==="pending"?"preparing":this.hasReconciled.state==="pending"?"reconciling":this.isDoneMultiDeferred.state==="fulfilled"?"done":"gossiping"}}constructor(e){Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new sn}),Object.defineProperty(this,"isDoneMultiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new Mr}),Object.defineProperty(this,"inboundEventQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Ft}),Object.defineProperty(this,"outboundEventQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Ft}),Object.defineProperty(this,"gossiperInboundQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Ft}),Object.defineProperty(this,"reconcilerInboundQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Ft}),Object.defineProperty(this,"hasPrepared",{enumerable:!0,configurable:!0,writable:!0,value:ne()}),Object.defineProperty(this,"hasReconciled",{enumerable:!0,configurable:!0,writable:!0,value:ne()}),Object.defineProperty(this,"hasCheckedAllExistingDocsForAttachments",{enumerable:!0,configurable:!0,writable:!0,value:ne()}),Object.defineProperty(this,"requestedCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sentDocsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"receivedDocsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"counterpartId",{enumerable:!0,configurable:!0,writable:!0,value:Bt()}),Object.defineProperty(this,"replica",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.replica=e.replica,e.replica.onEvent(u=>{u.kind==="willClose"&&this.cancel()});const{treeIsReady:t}=e.syncerManager.getDocThumbnailTreeAndDocLookup(e.replica.share,Dn(e.formats));t.then(()=>{this.hasPrepared.resolve()}),(async()=>{for await(const u of this.inboundEventQueue)switch(u.kind){case"RANGE_MSG":{this.reconcilerInboundQueue.push(u.message);break}default:this.gossiperInboundQueue.push(u)}})(),new af({outboundEventQueue:this.outboundEventQueue,formats:e.formats,replica:e.replica,counterpartId:this.counterpartId,transferManager:e.transferManager,hasCheckedAllExistingDocsForAttachments:this.hasCheckedAllExistingDocsForAttachments});const n=new lf,r=new of({inboundEventQueue:this.reconcilerInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:e.syncerManager,formats:e.formats,replica:e.replica,initiateMessaging:e.initiateMessaging,wantTracker:n,payloadThreshold:e.payloadThreshold,rangeDivision:e.rangeDivision,onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}});r.isDone.then(()=>{this.hasReconciled.resolve()}),new uf({inboundEventQueue:this.gossiperInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:e.syncerManager,formats:e.formats,replica:e.replica,counterpartId:this.counterpartId,transferManager:e.transferManager,cancel:this.cancel.bind(this),reconciliationIsDone:r.isDone,wantTracker:n,syncAppetite:e.syncAppetite,onDocReceived:async()=>{this.receivedDocsCount++,await this.statusBus.send(this.getStatus())},onDocSent:async()=>{this.sentDocsCount++,await this.statusBus.send(this.getStatus())},onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}}).isDone.then(async()=>{await this.hasCheckedAllExistingDocsForAttachments,this.isDoneMultiDeferred.resolve()}),this.statusBus.send(this.getStatus())}onStatusUpdate(e){return this.statusBus.on(e)}async cancel(e){this.isDoneMultiDeferred.state==="fulfilled"||this.isDoneMultiDeferred.state==="rejected"||(this.isDoneMultiDeferred.reject(e||"Cancelled"),await this.statusBus.send(this.getStatus()),this.outboundEventQueue.push({kind:"ABORT"}),this.outboundEventQueue.close(),this.inboundEventQueue.close({immediately:!0}),this.gossiperInboundQueue.close({immediately:!0}),this.reconcilerInboundQueue.close({immediately:!0}))}isDone(){return this.isDoneMultiDeferred.getPromise()}}class uf{constructor(e){Object.defineProperty(this,"isPartnerFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:ne()}),Object.defineProperty(this,"isFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:ne()});const t=bn(e.formats),n=e.syncerManager.getPlumTree(e.replica.share);if(e.syncAppetite==="continuous"){const u=e.replica.getQueryStream(void 0,"new",e.formats),a=new ys;u.pipeTo(new nt({async write(o){if(o.kind==="success"&&o.sourceId!==e.counterpartId){const l=n.getMode(o.sourceId);a.reset(),a.update(`${o.doc.path} ${o.doc.author}`);const c=a.digest().toString(16),f=`${o.doc.timestamp} ${c}`;if(l==="EAGER"){const h=t[o.doc.format],d=h.getAttachmentInfo(o.doc),p=!M(d);let g=!1;p&&await e.replica.getAttachment(o.doc,h)&&(g=!0),e.outboundEventQueue.push({kind:"DOC",thumbnail:f,doc:o.doc,attachmentHeld:g}),e.onDocSent()}else e.outboundEventQueue.push({kind:"HAVE",thumbnail:f})}}})).catch(()=>{})}const r=e.replica.onEvent(u=>{u.kind==="attachment_ingest"&&u.sourceId!==e.counterpartId&&e.outboundEventQueue.push({kind:"NEW_ATTACHMENT",path:u.doc.path,author:u.doc.author,format:u.doc.format,hash:u.hash})}),{lookup:i}=e.syncerManager.getDocThumbnailTreeAndDocLookup(e.replica.share,Dn(e.formats));(async()=>{for await(const u of e.inboundEventQueue)switch(u.kind){case"PRUNE":{n.onPrune(e.counterpartId);break}case"HAVE":{if(e.reconciliationIsDone.state==="fulfilled"&&e.syncAppetite==="once")break;e.wantTracker.addWantedThumbnail(u.thumbnail),n.onLazyMessage(u,a=>{e.outboundEventQueue.push({kind:"WANT",thumbnail:a})}),e.onDocRequested();break}case"WANT":{n.onGraftMessage(e.counterpartId);const[,a]=u.thumbnail.split(" "),o=i[a];if(!o)return;const[,l,c]=o,h=(await e.replica.getAllDocsAtPath(l,e.formats)).find(d=>d.author===c);if(h){const d=t[h.format],p=d.getAttachmentInfo(h),g=!M(p);let C=!1;g&&await e.replica.getAttachment(h,d)&&(C=!0),e.outboundEventQueue.push({kind:"DOC",thumbnail:u.thumbnail,doc:h,attachmentHeld:C}),await e.onDocSent()}else console.error("Got a WANT event for a document not on record.");break}case"DOC":{if(this.isFulfilled.state==="fulfilled"&&e.syncAppetite==="once"||(n.onEagerMessage(e.counterpartId,u)&&e.outboundEventQueue.push({kind:"PRUNE"}),e.wantTracker.isReceived(u.thumbnail)))break;const o=t[u.doc.format];if(!o){console.error(`Was sent a doc with a format we don't know about (${u.doc.format})`);break}if(u.attachmentHeld&&await e.replica.getAttachment(u.doc,t[u.doc.format])===void 0){const c=await e.transferManager.handleDownload(u.doc,e.replica,e.counterpartId);if(M(c)){const f=o.getAttachmentInfo(u.doc);e.transferManager.registerExpectedTransfer(e.replica.share,f.hash),e.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:f.hash,doc:u.doc,shareAddress:e.replica.share})}}await e.replica.ingest(o,u.doc,e.counterpartId),e.wantTracker.receivedWantedThumbnail(u.thumbnail),await e.onDocReceived();break}case"NEW_ATTACHMENT":{if(e.transferManager.isAlreadyQueued(u.hash,"download"))break;const a=t[u.format],l=(await e.replica.getAllDocsAtPath(u.path,[a])).find(f=>u.author===f.author);if(!l)break;if(await e.replica.getAttachment(l,t[l.format])===void 0){const f=await e.transferManager.handleDownload(l,e.replica,e.counterpartId);if(M(f)){const h=a.getAttachmentInfo(l);e.transferManager.registerExpectedTransfer(e.replica.share,h.hash),e.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:h.hash,doc:l,shareAddress:e.replica.share})}}break}case"FULFILLED":this.isPartnerFulfilled.resolve(!0);break;case"WANT_ATTACHMENT":e.transferManager.handleUpload(u,e.replica);break;case"ABORT":await e.cancel()}})(),e.reconciliationIsDone.then(async()=>{e.syncAppetite==="once"&&(r(),e.wantTracker.seal(),await e.wantTracker.isDone(),e.outboundEventQueue.push({kind:"FULFILLED"}),this.isFulfilled.resolve())})}get isDone(){return Promise.all([this.isPartnerFulfilled,this.isFulfilled])}}class of{constructor(e){Object.defineProperty(this,"communicationRoundsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isDone",{enumerable:!0,configurable:!0,writable:!0,value:ne()});const{tree:t,lookup:n,treeIsReady:r}=e.syncerManager.getDocThumbnailTreeAndDocLookup(e.replica.share,Dn(e.formats));e.initiateMessaging&&r.then(()=>{for(const u of i.initialMessages())e.outboundEventQueue.push({kind:"RANGE_MSG",message:u})});const i=new rf(t,e.payloadThreshold,e.rangeDivision);i.onInsertion(u=>{const[a,o]=u.split(" "),l=n[o];l&&l[0]>=parseInt(a)||(e.wantTracker.addWantedThumbnail(u),e.outboundEventQueue.push({kind:"WANT",thumbnail:u}),e.onDocRequested())}),(async()=>{await r;for await(const u of e.inboundEventQueue){if(this.isDone.state==="fulfilled")return;u.type==="TERMINAL"&&this.communicationRoundsCount++;const a=i.respond(u);for(const o of a)e.outboundEventQueue.push({kind:"RANGE_MSG",message:o})}})(),i.isDone().then(()=>{this.isDone.resolve(this.communicationRoundsCount)})}}class af{constructor(e){const t=e.replica.getQueryStream({orderBy:"localIndex ASC"},"existing",e.formats),n=bn(e.formats),r=e.transferManager.handleDownload.bind(e.transferManager);t.pipeTo(new nt({start(i){e.replica.onEvent(u=>{u.kind==="willClose"&&i.error()})},async write(i){if(i.kind==="existing"||i.kind==="success"){const u=n[i.doc.format],a=await e.replica.getAttachment(i.doc,u);if(M(a))return;if(a===void 0){const o=await r(i.doc,e.replica,e.counterpartId);if(M(o)){const l=u.getAttachmentInfo(i.doc);e.transferManager.registerExpectedTransfer(e.replica.share,l.hash),e.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:l.hash,doc:i.doc,shareAddress:e.replica.share})}}}}})).then(()=>{e.hasCheckedAllExistingDocsForAttachments.resolve()}).catch(()=>{e.hasCheckedAllExistingDocsForAttachments.resolve()})}}class lf{constructor(){Object.defineProperty(this,"isSealed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"wantedThumbnails",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"enroller",{enumerable:!0,configurable:!0,writable:!0,value:new Kn}),Object.defineProperty(this,"received",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:Bt()})}addWantedThumbnail(e){if(!this.isSealed&&!this.wantedThumbnails.has(e)){const t=ne();this.wantedThumbnails.set(e,t),this.enroller.enrol(t)}}receivedWantedThumbnail(e){const t=this.wantedThumbnails.get(e);t&&(t.resolve(),this.received++)}isRequested(e){return this.wantedThumbnails.has(e)}isReceived(e){const t=this.wantedThumbnails.get(e);return t?t.state==="fulfilled":!1}seal(){this.enroller.seal()}isDone(){return this.enroller.isDone()}get requestedCount(){return this.wantedThumbnails.size}get receivedCount(){return this.received}}class Jo{constructor(e,t){Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.cb=e,this.ms=t,this.timeout=en(e,t)}bump(){this.closed||(clearTimeout(this.timeout),this.timeout=en(this.cb,this.ms))}close(){this.closed=!0,clearTimeout(this.timeout)}}const Zo=1e4;class Xr{constructor({stream:e,replica:t,doc:n,format:r,requester:i,counterpartId:u}){Object.defineProperty(this,"kind",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:"ready"}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"expectedSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sourceDoc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new sn}),Object.defineProperty(this,"transferOp",{enumerable:!0,configurable:!0,writable:!0,value:ne()}),Object.defineProperty(this,"abortCb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new Mr}),Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"requester",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.sourceDoc=n,this.share=t.share,this.requester=i;const a=r.getAttachmentInfo(n);if(M(a))throw new x("AttachmentTransfer was given a doc which has no attachment!");this.hash=a.hash,this.expectedSize=a.size;const o=this.updateLoaded.bind(this);if(e instanceof tn){this.kind="download";let l;this.abortCb=()=>{l?l.cancel():e.cancel()};const c=()=>this.loaded,f=()=>new tn({async start(h){const d=e.getReader();l=d;const p=new Jo(()=>{h.error("Attachment download timed out.")},Zo);for(;;){const{done:g,value:C}=await d.read();if(p.bump(),g||(o(C.byteLength),h.enqueue(C),c()>=a.size))break}p.close(),h.close()}});this.transferOp.resolve(()=>{const h=ne();return t.ingestAttachment(r,n,f(),u).then(d=>{if(M(d)&&this.loaded===0){this.changeStatus("missing_attachment");return}if(M(d)){console.warn(`Couldn't ingest the attachment for ${n.path} by ${n.author}: ${d.message}`),h.reject(d);return}h.resolve()}).catch(d=>{console.log(d),h.reject(d)}),h})}else this.kind="upload",this.abortCb=()=>{e.abort().catch(()=>{})},t.getAttachment(n,r).then(async l=>{if(!l){await this.changeStatus("missing_attachment"),await e.abort();return}if(M(l)){await this.changeStatus("failed"),await e.abort();return}const c=new kn({transform(f,h){o(f.byteLength),h.enqueue(f)}});this.transferOp.resolve(()=>l.stream().then(f=>f.pipeThrough(c).pipeTo(e)).catch(f=>{console.log(f)}))})}async start(){if(this.status!=="ready")return;const e=await this.transferOp;await this.changeStatus("in_progress"),e().then(async()=>{await this.changeStatus("complete")}).catch(async()=>{await this.changeStatus("failed")})}updateLoaded(e){this.loaded+=e,this.statusBus.send({status:this.status,bytesLoaded:this.loaded,totalBytes:this.expectedSize})}async changeStatus(e){this.status==="complete"||this.status==="failed"||this.status==="missing_attachment"||(this.status=e,await this.statusBus.send({status:e,bytesLoaded:this.loaded,totalBytes:this.expectedSize}),e==="complete"&&this.multiDeferred.resolve(),e==="failed"&&this.multiDeferred.reject("Attachment transfer failed"),e==="missing_attachment"&&this.multiDeferred.reject("The other peer does not have this attachment"))}get doc(){return this.sourceDoc}onProgress(e){return this.statusBus.on(e)}abort(){this.abortCb()}isDone(){return this.multiDeferred.getPromise()}}class cf{constructor(e){Object.defineProperty(this,"waiting",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"active",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"failed",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"completed",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"activeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transfersRequestedByUsEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new Kn(!0)}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"reports",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"reportBus",{enumerable:!0,configurable:!0,writable:!0,value:new sn}),this.activeLimit=e}async activate(e){this.active.add(e),e.isDone().then(()=>{this.completed.add(e)}).catch(()=>{this.failed.add(e)}).finally(()=>{this.active.delete(e),this.admitNext()}),await e.start()}queue(e){this.waiting.push(e)}admitNext(){if(this.waiting.length===0||this.active.size>=this.activeLimit)return;const e=this.waiting.shift();e&&this.activate(e)}async addTransfer(e){if(this.closed){e.abort();return}e.onProgress(()=>{this.updateTransferStatus(e)}),e.requester==="us"&&this.transfersRequestedByUsEnroller.enrol(e.isDone()),this.active.size<this.activeLimit?await this.activate(e):this.queue(e)}gotAllTransfersRequestedByUs(){this.transfersRequestedByUsEnroller.seal()}cancel(){this.closed=!0,this.transfersRequestedByUsEnroller.seal();for(const e of this.active)e.abort()}updateTransferStatus(e){this.reports[e.share]||(this.reports[e.share]={}),this.reports[e.share][e.hash+e.kind]={author:e.doc.author,path:e.doc.path,format:e.doc.format,hash:e.hash,kind:e.kind,status:e.status,bytesLoaded:e.loaded,totalBytes:e.expectedSize},this.reportBus.send(this.getReport())}getReport(){const e={};for(const t in this.reports){const n=[],r=this.reports[t];for(const i in r){const u=r[i];n.push(u)}e[t]=n}return e}hasQueuedTransfer(e,t){for(const n of this.waiting)if(n.hash===e&&n.kind===t)return!0;for(const n of this.active)if(n.hash===e&&n.kind===t)return!0;for(const n of this.completed)if(n.hash===e&&n.kind===t)return!0;return!1}onReportUpdate(e){return this.reportBus.on(e)}transfersRequestedByUsFinished(){return this.transfersRequestedByUsEnroller.isDone()}}class ff{constructor(e){Object.defineProperty(this,"partner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"otherSyncerId",{enumerable:!0,configurable:!0,writable:!0,value:ne()}),Object.defineProperty(this,"receivedAllExpectedTransfersEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new Kn}),Object.defineProperty(this,"madeAllAttachmentRequestsEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new Kn(!0)}),Object.defineProperty(this,"formatsLookup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reportDidUpdateBus",{enumerable:!0,configurable:!0,writable:!0,value:new sn}),Object.defineProperty(this,"expectedTransferPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.partner=e.partner,this.queue=new cf(this.partner.concurrentTransfers),this.formats=e.formats,this.formatsLookup=bn(this.formats),this.queue.onReportUpdate(async t=>{await this.reportDidUpdateBus.send(t)}),this.madeAllAttachmentRequestsEnroller.isDone().then(()=>{this.receivedAllExpectedTransfersEnroller.seal()}),this.receivedAllExpectedTransfersEnroller.isDone().then(()=>{this.queue.gotAllTransfersRequestedByUs()})}registerSyncAgent(e){this.madeAllAttachmentRequestsEnroller.enrol(e.isDone())}allSyncAgentsKnown(){this.madeAllAttachmentRequestsEnroller.seal()}registerExpectedTransfer(e,t){const n=`${e}_${t}`;if(this.expectedTransferPromises.has(n))return;const r=ne();this.expectedTransferPromises.set(n,r),this.receivedAllExpectedTransfersEnroller.enrol(r)}async queueTransfer(e){this.queue.hasQueuedTransfer(e.hash,e.kind)||await this.queue.addTransfer(e)}async handleDownload(e,t,n){const r=this.formatsLookup[e.format],i=r.getAttachmentInfo(e);if(M(i))throw new Qe("TransferManager: attempted to download doc with no attachment.");if(this.queue.hasQueuedTransfer(i.hash,"download"))return"queued";const u=await this.partner.getDownload({doc:e,shareAddress:t.share,syncerId:await this.otherSyncerId,attachmentHash:i.hash});if(u===void 0)return"no_attachment";if(M(u))return u;const a=new Xr({replica:t,doc:e,format:r,stream:u,requester:"us",counterpartId:n});return await this.queueTransfer(a),"queued"}async handleUpload(e,t){if(this.queue.hasQueuedTransfer(e.attachmentHash,"upload"))return!1;const n=this.formatsLookup[e.doc.format];if(!await t.getAttachment(e.doc,n))return!1;const i=await this.partner.handleUploadRequest({shareAddress:e.shareAddress,syncerId:await this.otherSyncerId,doc:e.doc,attachmentHash:e.attachmentHash});if(M(i))return!1;try{const u=new Xr({doc:e.doc,format:n,replica:t,stream:i,requester:"them",counterpartId:"unused"});await this.queueTransfer(u)}catch{return!1}return!0}async handleTransferRequest({replica:e,path:t,author:n,source:r,kind:i,formatName:u,counterpartId:a}){const o=await this.partner.handleTransferRequest(r,i);if(o===void 0||M(o))return;const l=bn(this.formats)[u];if(!l)return;const f=(await e.getAllDocsAtPath(t,[l])).find(d=>d.author===n);if(!f)return;const h=new Xr({doc:f,format:l,replica:e,stream:o,requester:i==="upload"?"us":"them",counterpartId:a});if(h.requester==="us"){const d=`${h.share}_${h.hash}`,p=this.expectedTransferPromises.get(d);p&&p.resolve()}await this.queueTransfer(h)}cancel(){this.queue.cancel()}getReport(){return this.queue.getReport()}onReportUpdate(e){return this.reportDidUpdateBus.on(e)}transfersRequestedByUsFinished(){return this.queue.transfersRequestedByUsFinished()}registerOtherSyncerId(e){this.otherSyncerId.resolve(e)}isAlreadyQueued(e,t){return this.queue.hasQueuedTransfer(e,t)}}class Xo{constructor(e){Object.defineProperty(this,"peer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:Bt()}),Object.defineProperty(this,"manager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"syncAgents",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"syncAgentQueues",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"appetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new sn}),Object.defineProperty(this,"formats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transferManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partnerIsFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:ne()}),Object.defineProperty(this,"isDoneMultiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new Mr}),Object.defineProperty(this,"heartbeatInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bumpingTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.manager=e.manager,this.peer=e.manager.peer,this.appetite=e.partner.syncAppetite,this.formats=Dn(e.formats),this.partner=e.partner,this.transferManager=new ff({partner:this.partner,formats:this.formats}),this.transferManager.onReportUpdate(async()=>{await this.statusBus.send(this.getStatus())}),this.heartbeatInterval=Br(()=>{this.partner.sendEvent({kind:"HEARTBEAT"})},1e3),(async()=>{try{for await(const n of e.partner.getEvents())this.handleIncomingEvent(n)}catch(n){this.cancel(n||"Partner disconnected")}})();const t=Bt();Promise.all(this.peer.shares().map(n=>lr(t,n))).then(n=>{this.partner.sendEvent({kind:"DISCLOSE",salt:t,syncerId:this.id,shares:n,formats:this.formats?this.formats.map(r=>r.id):[ht.id],canRespond:!1})}),this.transferManager.transfersRequestedByUsFinished().then(async()=>{e.partner.syncAppetite!=="continuous"&&(await this.partner.sendEvent({kind:"SYNCER_FULFILLED"}),await this.partnerIsFulfilled,clearInterval(this.heartbeatInterval),await this.partner.closeConnection(),this.bumpingTimeout.close(),this.isDoneMultiDeferred.resolve())}),this.peer.onReplicasChange(async n=>{if(this.appetite==="once")return;const r=Array.from(n.keys());for(const[u,a]of this.syncAgents)r.includes(u)===!1&&(await a.cancel("Replica was removed from peer."),this.syncAgents.delete(u));const i=Bt();Promise.all(r.map(u=>lr(i,u))).then(u=>{this.partner.sendEvent({kind:"DISCLOSE",salt:i,syncerId:this.id,shares:u,formats:this.formats?this.formats.map(a=>a.id):[ht.id],canRespond:!0})})}),this.bumpingTimeout=new Jo(()=>{this.cancel("No communication from the other peer in the last three seconds.")},Zo)}addShare(e,t,n){if(this.syncAgents.has(e))return;const r=this.peer.getReplica(e);if(!r){console.error("Couldn't get the replica for a share we had in common.");return}const i=new sf({replica:r,formats:t,syncerManager:this.manager,transferManager:this.transferManager,initiateMessaging:n,payloadThreshold:this.partner.payloadThreshold,rangeDivision:this.partner.rangeDivision,syncAppetite:this.appetite});i.onStatusUpdate(()=>{this.statusBus.send(this.getStatus())}),this.syncAgents.set(e,i),this.transferManager.registerSyncAgent(i);const u=this.syncAgentQueues.get(e);let a;if(u)a=u;else{const o=new Ft;a=o,this.syncAgentQueues.set(e,o)}(async()=>{for await(const o of a)i.sendEvent(o)})(),(async()=>{for await(const o of i.events())await this.partner.sendEvent({to:e,...o})})()}async handleIncomingEvent(e){if(this.bumpingTimeout.bump(),this.isDoneMultiDeferred.state==="pending")switch(e.kind){case"DISCLOSE":{const t=Hc(e.formats,this.formats);if(t.length===0)break;const n=new Set(e.shares),r=new Set,i=new Set;for(const a of this.peer.shares()){const o=await lr(e.salt,a);n.has(o)?r.add(a):i.add(a)}const u=this.id>e.syncerId;for(const a of r)this.addShare(a,t,u);for(const a of i){const o=this.syncAgents.get(a);o&&(o.cancel("No longer in common with the other peer."),this.syncAgents.delete(a))}if(this.transferManager.registerOtherSyncerId(e.syncerId),this.appetite==="once"&&this.transferManager.allSyncAgentsKnown(),e.canRespond){const a=Bt();Promise.all(this.peer.shares().map(o=>lr(a,o))).then(o=>{this.partner.sendEvent({kind:"DISCLOSE",salt:a,syncerId:this.id,shares:o,formats:this.formats?this.formats.map(l=>l.id):[ht.id],canRespond:!1})})}r.size===0&&this.appetite==="once"&&this.partner.sendEvent({kind:"SYNCER_FULFILLED"});break}case"SYNCER_FULFILLED":{this.partnerIsFulfilled.resolve();break}case"HEARTBEAT":break;default:{const{to:t}=e,n=this.syncAgentQueues.get(t);if(!n){const r=new Ft;r.push(e),this.syncAgentQueues.set(t,r);break}n.push(e)}}}getStatus(){const e={};for(const[t,n]of this.syncAgents)e[t]={docs:n.getStatus(),attachments:this.transferManager.getReport()[t]||[]};return e}onStatusChange(e){return this.statusBus.on(e)}async cancel(e){this.bumpingTimeout.close(),this.isDoneMultiDeferred.reject(e);for(const[t,n]of this.syncAgents)await n.cancel();clearInterval(this.heartbeatInterval),this.transferManager.cancel(),await this.partner.closeConnection()}handleTransferRequest({shareAddress:e,path:t,author:n,source:r,kind:i,formatName:u}){if(this.isDoneMultiDeferred.state!=="pending")return;const a=this.peer.getReplica(e);if(!a)return;let o="unused";if(i==="upload"){const l=this.syncAgents.get(e);l&&(o=l.counterpartId)}return this.transferManager.handleTransferRequest({replica:a,author:n,formatName:u,kind:i,path:t,source:r,counterpartId:o})}isDone(){return this.isDoneMultiDeferred.getPromise()}}function lr(s,e){return De.sha256base32(s+e+s)}class hf{constructor(e,t,n,r){Object.defineProperty(this,"concurrentTransfers",{enumerable:!0,configurable:!0,writable:!0,value:1024}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"syncAppetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outgoingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Ft}),Object.defineProperty(this,"incomingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Ft}),Object.defineProperty(this,"partnerPeer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partnerSyncer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.syncAppetite=n,this.partnerPeer=e;const{incomingQueue:i,outgoingQueue:u}=this;this.partnerSyncer=new Xo({manager:e.syncerManager,formats:r,partner:{syncAppetite:n,getEvents(){return i},sendEvent(a){return u.push(a),Promise.resolve()},concurrentTransfers:1024,payloadThreshold:32,rangeDivision:32,async getDownload(a){const o=t.getReplica(a.shareAddress);if(!o)throw new x("Tried to get a receiving transfer for an unknown share.");const l=await o.replicaDriver.attachmentDriver.getAttachment(a.doc.format,a.attachmentHash);if(l&&!M(l))return await l.stream()},closeConnection(){return u.close(),Promise.resolve()},handleUploadRequest(a){return Promise.resolve(new Ln("PartnerLocal does not support uploads."))},handleTransferRequest(a,o){return Promise.resolve(new Ln("PartnerLocal does not support transfer requests."))}}})}getEvents(){return this.outgoingQueue}sendEvent(e){return this.incomingQueue.push(e),Promise.resolve()}closeConnection(){return this.incomingQueue.close(),Promise.resolve()}async getDownload(e){const t=this.partnerPeer.getReplica(e.shareAddress);if(!t)throw new x("Tried to get a receiving transfer for an unknown share.");const n=await t.replicaDriver.attachmentDriver.getAttachment(e.doc.format,e.attachmentHash);if(n&&!M(n))return await n.stream()}handleUploadRequest(e){return Promise.resolve(new Ln("PartnerLocal does not support uploads."))}handleTransferRequest(e,t){return Promise.resolve(new Ln("PartnerLocal does not support transfer requests."))}}class df{constructor(e){Object.defineProperty(this,"syncAppetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"concurrentTransfers",{enumerable:!0,configurable:!0,writable:!0,value:24}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"isSecure",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wsUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"socket",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"incomingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Ft}),Object.defineProperty(this,"socketIsReady",{enumerable:!0,configurable:!0,writable:!0,value:ne()}),this.syncAppetite=e.appetite;const t=new URL(e.url),n=`${t.host}${t.pathname==="/"?"":t.pathname}`;this.isSecure=t.protocol==="https:"||t.protocol==="wss:",this.wsUrl=`${this.isSecure?"wss://":"ws://"}${n}/'`;const r=new URL(e.appetite,this.wsUrl);this.socket=new gn(r.toString()),this.socket.onopen=()=>{this.socketIsReady.resolve()},this.socket.binaryType="arraybuffer",this.socket.onmessage=i=>{this.incomingQueue.push(JSON.parse(i.data))},this.socket.onclose=()=>{this.incomingQueue.close()},this.socket.onerror=i=>{if("error"in i){this.incomingQueue.close({withError:i.error});return}this.incomingQueue.close({withError:new Qe("Websocket error.")})}}async sendEvent(e){if(await this.socketIsReady,!(this.socket.readyState===this.socket.CLOSED||this.socket.readyState===this.socket.CLOSING))return this.socket.send(JSON.stringify(e))}getEvents(){return this.incomingQueue}closeConnection(){return this.socket.close(),Promise.resolve()}getDownload(e){const t=new URL(`${e.syncerId}/download/${e.shareAddress}/${e.doc.format}/${e.doc.author}${e.doc.path}`,this.wsUrl),n=Zc(t.toString(),r=>r.data instanceof ArrayBuffer?new Uint8Array(r.data):null);return Promise.resolve(n)}handleUploadRequest(e){const t=new URL(`${e.syncerId}/upload/${e.shareAddress}/${e.doc.format}/${e.doc.author}${e.doc.path}`,this.wsUrl),n=Jc(t.toString(),r=>r);return Promise.resolve(n)}handleTransferRequest(e,t){return Promise.resolve(new Ln("SyncDriverWebClient does not support external transfer requests."))}}function pf(s,e){const[t,n]=s.split(" "),[r,i]=e.split(" "),u=parseInt(t),a=parseInt(r);return u>a?1:u<a?-1:n>i?1:n<i?-1:0}const mf={lift:s=>lc(s),combine:(s,e)=>s+e,neutral:BigInt(0)};class gf extends fc{constructor(){super(mf,pf)}}class Df{constructor(){Object.defineProperty(this,"messagingModes",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"eagerMessageThumbnails",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"haveTimeouts",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}getMode(e){const t=this.messagingModes.get(e);if(t)return t;const n=this.messagingModes.size===0?"EAGER":"LAZY";return this.messagingModes.set(e,n),"EAGER"}onEagerMessage(e,t){const n=this.haveTimeouts.get(t.thumbnail);return n?(clearTimeout(n),!1):this.eagerMessageThumbnails.has(t.thumbnail)?(this.messagingModes.set(e,"LAZY"),!0):(this.eagerMessageThumbnails.add(t.thumbnail),!1)}onLazyMessage(e,t){if(!this.haveTimeouts.has(e.thumbnail)){const n=en(()=>{t(e.thumbnail)},5);this.haveTimeouts.set(e.thumbnail,n)}}onGraftMessage(e){this.messagingModes.set(e,"EAGER")}onPrune(e){this.messagingModes.set(e,"LAZY")}}class bf{constructor(e){Object.defineProperty(this,"syncers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"syncerEventBus",{enumerable:!0,configurable:!0,writable:!0,value:new sn}),Object.defineProperty(this,"peer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docThumbnailTreeAndLookup",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"hasher",{enumerable:!0,configurable:!0,writable:!0,value:new ys}),Object.defineProperty(this,"plumTrees",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.peer=e}addPartner(e,t,n){const r=new Xo({manager:this,partner:e,formats:n});return this.syncers.set(r.id,{syncer:r,description:t}),this.syncerEventBus.send(this.syncers),r}getSyncers(){return this.syncers}getDocThumbnailTreeAndDocLookup(e,t){const n=t.map(h=>h.id),r=`${e} ${n}`,i=this.docThumbnailTreeAndLookup.get(r);if(i){const[h,d]=i;return{tree:h,lookup:d,treeIsReady:Promise.resolve(!0)}}const u=this.peer.getReplica(e);if(!u)throw new Qe("A DocThumbnailTree was requested for a share the peer doesn't know about, big problem!");const a=this.hasher,o=u.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"everything",t),l=new gf,c={},f=ne();return o.pipeTo(new nt({write(h){if(h.kind==="processed_all_existing"){f.resolve();return}a.reset(),a.update(`${h.doc.path} ${h.doc.author}`);const d=a.digest().toString(16),p=`${h.doc.timestamp} ${d}`;(h.kind==="existing"||h.kind==="success")&&(c[d]=[h.doc.timestamp,h.doc.path,h.doc.author],l.insert(p)),h.kind==="expire"&&(delete c[d],l.remove(p))}})),{tree:l,lookup:c,treeIsReady:f}}getPlumTree(e){const t=this.plumTrees.get(e);if(t)return t;const n=new Df;return this.plumTrees.set(e,n),n}onSyncersChange(e){return this.syncerEventBus.on(e)}}const Vt=new He("peer","orangeRed"),xn=JSON.stringify;class Xn{constructor(){Object.defineProperty(this,"replicaEventBus",{enumerable:!0,configurable:!0,writable:!0,value:new sn}),Object.defineProperty(this,"syncerManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicaMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Vt.debug("constructor"),this.syncerManager=new bf(this)}hasShare(e){return this.replicaMap.has(e)}shares(){const e=[...this.replicaMap.keys()];return e.sort(),e}replicas(){const e=[...this.replicaMap.keys()];return e.sort(),e.map(t=>this.replicaMap.get(t))}size(){return this.replicaMap.size}getReplica(e){return this.replicaMap.get(e)}async addReplica(e){if(Vt.debug(`addReplica(${xn(e.share)})`),this.replicaMap.has(e.share))throw Vt.debug("already had a replica with that share"),new Error(`Peer.addReplica: already has a replica with share ${xn(e.share)}.  Don't add another one.`);this.replicaMap.set(e.share,e),await this.replicaEventBus.send(this.replicaMap),Vt.debug("    ...addReplica: done")}async removeReplicaByShare(e){Vt.debug(`removeReplicaByShare(${xn(e)})`),this.replicaMap.delete(e),await this.replicaEventBus.send(this.replicaMap)}async removeReplica(e){const t=this.replicaMap.get(e.share);e===t?(Vt.debug(`removeReplica(${xn(e.share)})`),await this.removeReplicaByShare(e.share)):Vt.debug(`removeReplica(${xn(e.share)}) -- same share but it's a different instance now; ignoring`)}sync(e,t=!1,n){try{const r=new df({url:e,appetite:t?"continuous":"once"});return this.syncerManager.addPartner(r,e,n)}catch{if(e instanceof Xn){const r=new hf(e,this,t?"continuous":"once",n);return this.syncerManager.addPartner(r,"Local",n)}console.error("Provided an invalid target for syncing to a peer:",e);return}}addSyncPartner(e,t,n){return this.syncerManager.addPartner(e,t,n)}getSyncers(){return this.syncerManager.getSyncers()}onReplicasChange(e){return this.replicaEventBus.on(e)}onSyncersChange(e){return this.syncerManager.onSyncersChange(e)}discover(e){const t=this;return{async*[Symbol.asyncIterator](){for await(const n of e.events){if(n.kind==="SERVICE_STOPPED")break;if(n.kind==="PEER_EXITED"){yield n;continue}if(n.kind==="PEER_INITIATED_SYNC"){const r=await n.begin(t);yield{kind:"PEER_INITIATED_SYNC",description:n.description,syncer:r};continue}yield{kind:"PEER_DISCOVERED",description:n.description,sync:async r=>await n.begin(t,r!=null&&r.syncContinuously?"continuous":"once")}}}}}}const wf={historyMode:"latest",orderBy:"path ASC",startAfter:void 0,limit:void 0,filter:void 0,formats:["es.5"]},Qt=new He("query","green");function ea(s){var r,i,u,a;const e={...wf,...s},t={query:{limit:0},isValid:!1,willMatch:"nothing"};if(e.limit!==void 0&&e.limit<0)return Qt.debug("cleanUpQuery: unreasonable limit - returning empty invalid query",t),t;if((r=e.orderBy)!=null&&r.startsWith("path")&&((i=e.startAfter)==null?void 0:i.localIndex)!==void 0)return Qt.debug('cleanUpQuery: orderBy is "path" but startAfter is not compatible - returning empty invalid query',t),t;if((u=e.orderBy)!=null&&u.startsWith("localIndex")&&((a=e.startAfter)==null?void 0:a.path)!==void 0)return Qt.debug('cleanUpQuery: orderBy is "localIndex" but startAfter is not compatible - returning empty invalid query',t),t;if(e.historyMode!==void 0&&e.historyMode!=="all"&&e.historyMode!=="latest")return Qt.debug(`cleanUpQuery: unknown historyMode ${JSON.stringify(e.historyMode)} - returning empty invalid query`,t),t;if(e.orderBy!==void 0&&["path ASC","path DESC","localIndex ASC","localIndex DESC"].indexOf(e.orderBy)===-1)return Qt.debug(`cleanUpQuery: unrecognized orderBy value ${JSON.stringify(e.orderBy)} - returning empty invalid query`,t),t;let n=e.historyMode==="all"?"all":"all-latest";if(e.filter!==void 0&&!_r(e.filter,{})&&(n="some"),e.startAfter!==void 0&&!_r(e.startAfter,{})&&(n="some"),e.limit!==void 0&&(e.limit>0&&(n="some"),e.limit===0&&(n="nothing")),e.filter!==void 0){const o=e.filter;o.path&&o.pathStartsWith&&!o.path.startsWith(o.pathStartsWith)&&(n="nothing"),o.path&&o.pathEndsWith&&!o.path.endsWith(o.pathEndsWith)&&(n="nothing"),o.timestamp&&o.timestampGt&&!(o.timestamp>o.timestampGt)&&(n="nothing"),o.timestamp&&o.timestampLt&&!(o.timestamp<o.timestampLt)&&(n="nothing"),o.timestampGt&&o.timestampLt&&!(o.timestampLt+1<o.timestampGt)&&(n="nothing")}if(n==="nothing"){let o={query:{limit:0},isValid:!0,willMatch:"nothing"};return Qt.debug("cleanUpQuery - this query will match nothing, so returning a simpler query that also matches nothing",o),o}return Qt.debug(`cleanUpQuery - query is ok!  willMatch = ${n}`),{query:e,isValid:!0,willMatch:n}}function As(s,e){return!(e.path!==void 0&&s.path!==e.path||e.pathStartsWith!==void 0&&!s.path.startsWith(e.pathStartsWith)||e.pathEndsWith!==void 0&&!s.path.endsWith(e.pathEndsWith)||e.author!==void 0&&s.author!==e.author||e.timestamp!==void 0&&s.timestamp!==e.timestamp||e.timestampGt!==void 0&&!(s.timestamp>e.timestampGt)||e.timestampLt!==void 0&&!(s.timestamp<e.timestampLt))}new He("query helpers","gold");var et;(function(s){s[s.LT=-1]="LT",s[s.EQ=0]="EQ",s[s.GT=1]="GT"})(et||(et={}));function fs(s,e,t="ASC"){if(Array.isArray(s)&&ko(s,e)||typeof s=="object"&&_r(s,e)||s===e)return et.EQ;if(t==="ASC"||t===void 0)return s<e?et.LT:et.GT;if(t==="DESC")return s>e?et.LT:et.GT;throw new Error("unexpected sort order to compareBasic: "+JSON.stringify(t))}function Es(s,e,t){let n=Math.min(s.length,e.length);for(let u=0;u<n;u++){let a=(t==null?void 0:t[u])??"ASC",o=fs(s[u],e[u],a);if(o!==et.EQ)return o}if(s.length===e.length)return et.EQ;let r=Math.min(s.length,e.length),i=(t==null?void 0:t[r])??"ASC";return fs(s.length,e.length,i)}function gi(s,e="ASC"){return(t,n)=>fs(t[s],n[s],e)}const _f=JSON.stringify,We=new He("replica","gold"),Ke=new He("replica set","gold"),Le=new He("replica ingest","gold");function Di(s,e){return Es([s.timestamp,s.signature],[e.timestamp,s.signature],["DESC","ASC"])}class yf{constructor({driver:e,config:t}){var r;Object.defineProperty(this,"replicaId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicaDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formatsConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isClosed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ingestLockStream",{enumerable:!0,configurable:!0,writable:!0,value:new Yo}),Object.defineProperty(this,"eventMultiStream",{enumerable:!0,configurable:!0,writable:!0,value:new Yc("kind",!0)}),Object.defineProperty(this,"eventWriter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbackSink",{enumerable:!0,configurable:!0,writable:!0,value:new Go}),Object.defineProperty(this,"eraseInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"expireEventTimeouts",{enumerable:!0,configurable:!0,writable:!0,value:new Map});const n=Ut(e.docDriver.share);if(M(n))throw n;We.debug(`constructor.  driver = ${(r=e==null?void 0:e.constructor)==null?void 0:r.name}`),this.replicaId="replica-"+Bt(),this.share=e.docDriver.share,this.replicaDriver=e,this.formatsConfig=t||{},this.eventWriter=this.eventMultiStream.getWritableStream().getWriter(),this.eventMultiStream.getReadableStream("*").pipeTo(new nt(this.callbackSink)),this.eraseInterval=Br(()=>{this.isClosed()?clearInterval(this.eraseInterval):this.pruneExpiredDocsAndAttachments()},1e3*60*60)}isClosed(){return this._isClosed}async close(e){if(We.debug("closing..."),this._isClosed)throw new Ce;await this.ingestLockStream.close();for(const t of this.expireEventTimeouts.values())clearTimeout(t);return We.debug("    sending willClose blockingly..."),await this.eventWriter.write({kind:"willClose"}),We.debug("    marking self as closed..."),e===!1&&await this.pruneExpiredDocsAndAttachments(),await this.replicaDriver.attachmentDriver.clearStaging(),this._isClosed=!0,We.debug(`    closing ReplicaDriver (erase = ${e})...`),await this.replicaDriver.docDriver.close(e),await this.replicaDriver.attachmentDriver.close(e),clearInterval(this.eraseInterval),We.debug("    sending didClose nonblockingly..."),await this.eventWriter.write({kind:"didClose"}),We.debug("...closing done"),Promise.resolve()}async getConfig(e){if(this._isClosed)throw new Ce;return await this.replicaDriver.docDriver.getConfig(e)}async setConfig(e,t){if(this._isClosed)throw new Ce;return await this.replicaDriver.docDriver.setConfig(e,t)}async listConfigKeys(){if(this._isClosed)throw new Ce;return await this.replicaDriver.docDriver.listConfigKeys()}async deleteConfig(e){if(this._isClosed)throw new Ce;return await this.replicaDriver.docDriver.deleteConfig(e)}getMaxLocalIndex(){if(this._isClosed)throw new Ce;return this.replicaDriver.docDriver.getMaxLocalIndex()}getAllDocs(e){return We.debug("getAllDocs()"),this.queryDocs({historyMode:"all",orderBy:"path ASC"},e)}getLatestDocs(e){return We.debug("getLatestDocs()"),this.queryDocs({historyMode:"latest",orderBy:"path ASC"},e)}getAllDocsAtPath(e,t){return We.debug(`getAllDocsAtPath("${e}")`),this.queryDocs({historyMode:"all",orderBy:"path ASC",filter:{path:e}},t)}async getLatestDocAtPath(e,t){We.debug(`getLatestDocsAtPath("${e}")`);const n=await this.queryDocs({historyMode:"latest",orderBy:"path ASC",filter:{path:e}},t?[t]:void 0);if(n.length!==0)return n[0]}async queryDocs(e={},t){if(We.debug("queryDocs",e),this._isClosed)throw new Ce;const n=Dn(t);return await this.replicaDriver.docDriver.queryDocs({...e,formats:n.map(r=>r.id)})}async queryPaths(e={},t){const n=await this.queryDocs(e,t),r=new Set(n.map(({path:i})=>i));return Array.from(r).sort()}async queryAuthors(e={},t){const n=await this.queryDocs(e,t),r=new Set(n.map(({author:i})=>i));return Array.from(r).sort()}async set(e,t,n=ht){if(Ke.debug("set",t),this._isClosed)throw new Ce;Ke.debug("...deciding timestamp: getting latest doc at the same path (from any author)");const r=await this.getLatestDocAtPath(t.path);let i;typeof t.timestamp=="number"?i=t.timestamp:r===void 0?i=ii():i=Math.max(ii(),r.timestamp+1),Ke.debug("...generating doc");let u;if(r){const l=n.removeExtraFields(r);M(l)||(u=l.doc)}const a=await n.generateDocument({keypair:e,input:{...t,format:n.id},share:this.share,timestamp:i,prevLatestDoc:u,config:this.formatsConfig[n.id]});if(M(a))return{kind:"failure",reason:"invalid_document",err:a};if(Ke.debug("...signature =",a.doc.signature),a.attachment){const l=await this.replicaDriver.attachmentDriver.stage(n.id,a.attachment);if(M(l))return{kind:"failure",reason:"invalid_document",err:l};const c=await n.updateAttachmentFields(e,a.doc,l.size,l.hash,this.formatsConfig[n.id]);if(M(c))return await l.reject(),{kind:"failure",reason:"invalid_document",err:c};Ke.debug("...ingesting attachment"),Ke.debug("-----------------------"),await l.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:c,hash:l.hash,size:l.size,sourceId:"local"}),Ke.debug("...done ingesting attachment"),Ke.debug("...ingesting"),Ke.debug("-----------------------");const f=await this.ingest(n,c,"local");return Ke.debug("...done ingesting"),Ke.debug("...set is done."),f}Ke.debug("...ingesting"),Ke.debug("-----------------------");const o=await this.ingest(n,a.doc,"local");return Ke.debug("...done ingesting"),Ke.debug("...set is done."),o}async ingest(e,t,n){if(Le.debug("ingest",t),this._isClosed)throw new Ce;Le.debug("...removing extra fields");const r=e.removeExtraFields(t);if(M(r))return{kind:"failure",reason:"invalid_document",err:r};t=r.doc;const i=r.extras;Object.keys(i).length>0&&Le.debug(`...extra fields found: ${_f(i)}`);const u=await e.checkDocumentIsValid(t);if(M(u))return{kind:"failure",reason:"invalid_document",err:u};const a=ne();return await this.ingestLockStream.run(async()=>{Le.debug(" >> ingest: start of protected region"),Le.debug("  > getting other history docs at the same path by any author");const o=await this.getAllDocsAtPath(t.path,[e]);Le.debug(`  > ...got ${o.length}`),Le.debug("  > getting prevLatest and prevSameAuthor");const l=o[0]??null,c=o.filter(g=>g.author===t.author)[0]??null;Le.debug("  > checking if new doc is latest at this path"),o.push(t),o.sort(Di);const f=o[0]===t;if(Le.debug(`  > ...isLatest: ${f}`),!f&&c!==null){Le.debug("  > new doc is not latest and there is another one from the same author...");const g=Di(t,c);if(g===et.GT){Le.debug("  > new doc is GT prevSameAuthor, so it is obsolete"),a.resolve({kind:"nothing_happened",reason:"obsolete_from_same_author",doc:t});return}if(g===et.EQ){Le.debug("  > new doc is EQ prevSameAuthor, so it is redundant (already_had_it)"),a.resolve({kind:"nothing_happened",reason:"already_had_it",doc:t});return}}Le.debug("  > upserting into ReplicaDriver...");const h=await this.replicaDriver.docDriver.upsert(t);Le.debug("  > ...done upserting into ReplicaDriver"),Le.debug("  > ...getting ReplicaDriver maxLocalIndex...");const d=await this.replicaDriver.docDriver.getMaxLocalIndex();Le.debug(" >> ingest: end of protected region, returning a WriteEvent from the lock");const p={kind:"success",maxLocalIndex:d,doc:h,docIsLatest:f,prevDocFromSameAuthor:c,prevLatestDoc:l,sourceId:n};if(a.resolve(p),await this.eventWriter.write(p),h.deleteAfter){const g=`${h.path}|${h.author}`,C=this.expireEventTimeouts.get(g);C&&clearTimeout(C);const b=h.deleteAfter/1e3-Date.now();this.expireEventTimeouts.set(g,en(()=>{this.eventWriter.write({kind:"expire",doc:h})},b))}}),a}async overwriteAllDocsByAuthor(e,t){const n=mi(t);if(We.debug(`overwriteAllDocsByAuthor("${e.address}")`),this._isClosed)throw new Ce;const r=await this.queryDocs({filter:{author:e.address},historyMode:"all"},[n]);We.debug(`    ...found ${r.length} docs to overwrite`);let i=0,u=0;for(const a of r){const o=await this.wipeDocument(e,a,mi(t));if(M(o))return o;i+=1}return We.debug(`    ...done; ${i} overwritten to be empty; ${u} were already empty; out of total ${r.length} docs`),i}async wipeDocAtPath(e,t,n=ht){const r=await this.getLatestDocAtPath(t,n);return r?this.wipeDocument(e,r,n):new x("No document exists at that path")}async wipeDocument(e,t,n){const r={...t,timestamp:Math.max(t.timestamp+1,Date.now()*1e3),author:e.address},i=await n.wipeDocument(e,r,this.formatsConfig[n.id]);if(M(i))return{kind:"failure",err:i,reason:"invalid_document"};const u=await this.ingest(n,i,"local");if(u.kind==="success"){const a=n.getAttachmentInfo(t);if(!M(a)){const o=await this.replicaDriver.attachmentDriver.erase(n.id,a.hash);M(o)||await this.eventWriter.write({kind:"attachment_prune",format:n.id,hash:a.hash})}}return u}async pruneExpiredDocsAndAttachments(e=xr){const t=await this.replicaDriver.docDriver.eraseExpiredDocs();for(const u of t)await this.eventWriter.write({kind:"expire",doc:u});const n=bn(e),r={};await this.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"existing",e).pipeTo(new nt({write(u){if(u.kind==="existing"){const a=n[u.doc.format],o=a.getAttachmentInfo(u.doc);if(!M(o)){const l=r[a.id];l?l.add(o.hash):r[a.id]=new Set([o.hash])}}}}));const i=await this.replicaDriver.attachmentDriver.filter(r);for(const u of i)await this.eventWriter.write({kind:"attachment_prune",format:u.format,hash:u.hash})}getEventStream(e="*"){return this.eventMultiStream.getReadableStream(e)}getQueryStream(e={},t,n){const r=this.queryDocs.bind(this),i=this.getEventStream.bind(this);return new tn({async start(u){if(t==="existing"||t==="everything"){const l=await r(e,n);for(const c of l)u.enqueue({kind:"existing",doc:c})}if(u.enqueue({kind:"processed_all_existing"}),t==="existing"){u.close();return}const o=i().getReader();for(;;){const{done:l,value:c}=await o.read();if(l)return;if(c.kind==="expire"||c.kind==="success"){if(e.filter&&As(c.doc,e.filter)){u.enqueue(c);continue}u.enqueue(c);continue}c.kind==="didClose"&&u.close()}}})}onEvent(e){return this.callbackSink.onWrite(e)}async ingestAttachment(e,t,n,r){if(this._isClosed)throw new Ce;const i=e.removeExtraFields(t);if(M(i))return Promise.resolve(i);t=i.doc;const u=await e.checkDocumentIsValid(t);if(M(u))return Promise.resolve(u);const a=await this.getAttachment(t,e);if(a&&!M(a))return!1;const o=e.getAttachmentInfo(t);if(M(o))return Promise.resolve(o);const l=await this.replicaDriver.attachmentDriver.stage(t.format,n);return M(l)?l:l.hash!==o.hash?(await l.reject(),new x("Attachment's hash did not match the document's")):l.size!==o.size?(await l.reject(),new x("Attachment's size did not match the document's")):(await l.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:t,hash:l.hash,size:l.size,sourceId:r}),!0)}getAttachment(e,t=ht){if(e.deleteAfter&&e.deleteAfter<Date.now()*1e3)return Promise.resolve(new x("This document has expired"));const n=t.getAttachmentInfo(e);return M(n)?Promise.resolve(n):this.replicaDriver.attachmentDriver.getAttachment(e.format,n.hash)}addAttachments(e,t){const n=Dn(t),r={};for(const u of n)r[u.id]=u;const i=e.map(u=>new Promise(a=>{const l=r[u.format].getAttachmentInfo(u);if(!M(l))this.replicaDriver.attachmentDriver.getAttachment(u.format,l.hash).then(c=>{a({...u,attachment:c})});else return a({...u,attachment:l})}));return Promise.all(i)}}class Cf extends yf{constructor(e){super({driver:e.driver,config:{"es.5":{shareSecret:e.shareSecret}}})}}const Gt=new He("replica-cache","green");function bi({_localIndex:s}){return s}function wi(s,e){const t=[];for(const n of e)if(!(s.orderBy==="path ASC"&&s.startAfter!==void 0&&s.startAfter.path!==void 0&&n.path<=s.startAfter.path)&&!(s.orderBy==="path DESC"&&s.startAfter!==void 0&&s.startAfter.path!==void 0&&n.path>=s.startAfter.path)&&!(s.orderBy==="localIndex ASC"&&s.startAfter!==void 0&&s.startAfter.localIndex!==void 0&&(n._localIndex||0)<=s.startAfter.localIndex)&&!(s.orderBy==="localIndex DESC"&&s.startAfter!==void 0&&s.startAfter.localIndex!==void 0&&(n._localIndex||0)>=s.startAfter.localIndex)&&(t.push(n),s.limit!==void 0&&t.length>=s.limit))break;return t}class Af{constructor(e,t,n){Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"replica",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"timeToLive",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onCacheUpdatedCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"onFireCacheUpdatedsWrapper",{enumerable:!0,configurable:!0,writable:!0,value:a=>a()}),Object.defineProperty(this,"attachmentCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.replica=e,this.timeToLive=t||1e3,n&&(this.onFireCacheUpdatedsWrapper=n);const r=this.onReplicaEvent.bind(this),i=this.close.bind(this),u=this.isClosed.bind(this);this.replica.getEventStream("*").pipeTo(new nt({async write(a){a.kind==="attachment_ingest"||a.kind==="success"||a.kind==="expire"?await r(a):a.kind==="willClose"&&!u()&&await i()}})).catch(()=>{})}async close(){if(this.closed)throw new Ht;this.closed=!0,await Promise.all(Array.from(this.docCache.values()).map(e=>e.close())),this.docCache.clear(),this.onCacheUpdatedCallbacks.clear()}isClosed(){return this.closed}getAllDocs(e){return this.queryDocs({historyMode:"all",orderBy:"path DESC"},e)}getLatestDocs(e){return this.queryDocs({historyMode:"latest",orderBy:"path DESC"},e)}getAllDocsAtPath(e,t){return this.queryDocs({historyMode:"all",orderBy:"path DESC",filter:{path:e}},t)}getLatestDocAtPath(e,t){const n=this.queryDocs({historyMode:"latest",orderBy:"path DESC",filter:{path:e}},t?[t]:void 0);if(n.length!==0)return n[0]}queryDocs(e={},t){if(this.closed)throw new Ht;if(this.replica.isClosed())throw new Ce;const r={...e,formats:(t||xr).map(p=>p.id)},i=ea(r);if(i.willMatch==="nothing")return[];const u=Cl(i.query),a=this.docCache.get(u);if(a)return Date.now()>a.expires&&this.replica.queryDocs(e,t).then(p=>{const g=p.map(bi).sort(),C=a.docs.map(bi).sort();ko(g,C)||(this.docCache.set(u,{stream:a.stream,close:a.close,docs:p,expires:Date.now()+this.timeToLive}),Gt.debug("Updated cache because result expired."),this.fireOnCacheUpdateds())}),a.docs;const o=this.replica.getQueryStream(e,"new",t),l=new Go,c=l.onWrite(p=>{(p.kind==="existing"||p.kind==="success")&&(Gt.debug({doc:p.doc.path,queryString:u}),this._updateCache(u,p.doc))}),f=new nt(l),h=new AbortController;o.pipeTo(f,{signal:h.signal});const d=()=>{c()};return this.docCache.set(u,{stream:o,docs:[],expires:Date.now()+this.timeToLive,close:d}),this.replica.queryDocs(r).then(p=>{this.docCache.set(u,{stream:o,close:d,docs:p,expires:Date.now()+this.timeToLive}),Gt.debug("Updated cache with a new entry."),this.fireOnCacheUpdateds()}),[]}queryPaths(e={},t){const n=this.queryDocs(e,t),r=new Set(n.map(({path:i})=>i));return Array.from(r).sort()}queryAuthors(e={},t){const n=this.queryDocs(e,t),r=new Set(n.map(({author:i})=>i));return Array.from(r).sort()}_updateCache(e,t){const n=this.docCache.get(e);if(!n)return;const r=JSON.parse(e),i=()=>{const d=[...n.docs,t];this.docCache.set(e,{...n,docs:wi(r,d)}),this.fireOnCacheUpdateds()},u=({exact:d})=>{const p=n.docs.map(g=>d&&g.path===t.path&&g.author===t.author||!d&&g.path===t.path?t:g);this.docCache.set(e,{...n,docs:wi(r,p)}),this.fireOnCacheUpdateds()},a=n.docs.filter(d=>d.path===t.path),o=n.docs.filter(d=>d.path===t.path&&d.author===t.author);if(a.length===0){(r.filter&&As(t,r.filter)||!r.filter)&&(Gt.debug("Updated cache after appending a doc to a entry with matching filter."),i());return}if((r.historyMode||"latest")==="all"){if(o.length===0){Gt.debug("Updated cache after appending a version of a doc to a historyMode: all query."),i();return}Gt.debug("Updated cache after replacing a version of a doc in a historyMode: all query."),u({exact:!0});return}const c=a[0],f=t.author!==(c==null?void 0:c.author)||!_r(t,c),h=t.timestamp>c.timestamp;if(f&&h){Gt.debug("Updated cache after replacing a doc with its latest version."),u({exact:!1});return}}fireOnCacheUpdateds(){this.version++,this.onFireCacheUpdatedsWrapper(()=>{this.onCacheUpdatedCallbacks.forEach(e=>{e()})})}onCacheUpdated(e){if(this.closed)throw new Ht;if(this.replica.isClosed())throw new Ce;return this.onCacheUpdatedCallbacks.add(e),()=>{this.onCacheUpdatedCallbacks.delete(e)}}set(e,t,n){if(this.closed)throw new Ht;return this.replica.set(e,t,n)}overwriteAllDocsByAuthor(e,t){if(this.closed)throw new Ht;if(this.replica.isClosed())throw new Ce;return this.replica.overwriteAllDocsByAuthor(e,t)}wipeDocAtPath(e,t,n=ht){if(this.closed)throw new Ht;return this.replica.wipeDocAtPath(e,t,n)}async onReplicaEvent(e){const t=`${e.doc.path}|${e.doc.author}`,n=this.attachmentCache.get(t);if(!n)return;const r=await this.replica.getAttachment(e.doc,n.format);this.attachmentCache.set(t,{expires:Date.now()+this.timeToLive,attachment:r,format:n.format}),this.fireOnCacheUpdateds()}getAttachment(e,t=ht){if(this.closed)throw new Ht;if(this.replica.isClosed())throw new Ce;const n=t.getAttachmentInfo(e);if(M(n))return n;const r=`${e.path}|${e.author}`,i=this.attachmentCache.get(r);if(i)return Date.now()>i.expires&&this.replica.getAttachment(e,t).then(u=>{this.attachmentCache.set(r,{expires:Date.now()+this.timeToLive,attachment:u,format:t}),this.fireOnCacheUpdateds()}),e.deleteAfter&&Date.now()*1e3>e.deleteAfter?new x("This document has expired"):i.attachment;this.attachmentCache.set(r,{attachment:void 0,expires:Date.now()+this.timeToLive,format:t}),this.replica.getAttachment(e,t).then(u=>{this.attachmentCache.set(r,{expires:Date.now()+this.timeToLive,attachment:u,format:t}),this.fireOnCacheUpdateds()})}addAttachments(e,t){const n=[],r=bn(t);for(const i of e){const u=this.getAttachment(i,r[i.format]);n.push({...i,attachment:u})}return n}}new He("storage driver async memory","yellow");async function Ef(s){let e=new Uint8Array;return await s.pipeTo(new nt({write(t){const n=new Uint8Array(e.length+t.length);n.set(e),n.set(t,e.length),e=n}})),e}async function vf(s,e,t){const n=Or(s);if(M(n))return new x("Invalid share address.");for(const a of e)try{new URL(a)}catch{return new x(`Could not parse ${a} as a URL.`)}const r=e.map(a=>`&server=${a}`).join("&");let i="";if(t){const a=await De.checkKeypairIsValid({shareAddress:s,secret:t});if(M(a))return new x(`Supplied the wrong secret for ${s}`);i=`&secret=${t}`}return`earthstar://${s}/?invite${r}${i}&v=2`}async function ta(s){try{const e=new URL(s),t=Or(e.hostname);if(M(t))return new x("Invitation did not include a valid share address.");const n=new URLSearchParams(e.search),r=n.get("invite"),i=n.get("v");if(r===null)return new x("Not an invitation URL");if(i===null)return new x("Invitation version not specified.");if(i!=="2")return new x(`Invitation version is ${i}, expected version 2.`);const u=n.getAll("server");for(const o of u)try{new URL(o)}catch{return new x(`Invitation's servers included a malformed URL: ${o}`)}const a=n.get("secret");if(a){const o=await De.checkKeypairIsValid({shareAddress:e.hostname,secret:a});if(M(o))return new x(`Invitation contains the wrong secret for share ${e.hostname}.`)}return{shareAddress:e.hostname,secret:a||void 0,servers:u}}catch{return new x("Could not parse the invitation URL.")}}const kf="earthstar",cr="current_author",Mn="shares",Nn="share_secrets",$n="servers";class vs{constructor(e){Object.defineProperty(this,"namespace",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:localStorage}),Object.defineProperty(this,"authorChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"sharesChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"shareSecretsChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"serversChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),this.namespace=e==null?void 0:e.namespace,e!=null&&e.sessionOnly&&(this.storage=sessionStorage),addEventListener("storage",t=>{switch(t.key){case Re(cr,this.namespace):{this.fireAuthorEvent();break}case Re(Mn,this.namespace):{this.fireSharesEvent();break}case Re(Nn,this.namespace):{this.fireSecretsEvent();break}case Re($n,this.namespace):{this.fireServersEvent();break}}})}get author(){const e=Re(cr,this.namespace);return fr(this.storage,e,Ff)||null}set author(e){const t=Re(cr,this.namespace);this.storage.setItem(t,JSON.stringify(e)),this.fireAuthorEvent()}get shares(){const e=Re(Mn,this.namespace);return fr(this.storage,e,Bf)||[]}addShare(e){if(M(Ut(e)))return new x("Not a valid share");const t=Re(Mn,this.namespace),n=new Set([...this.shares,e]),r=Array.from(n);return this.storage.setItem(t,JSON.stringify(r)),this.fireSharesEvent(),r}removeShare(e){const t=this.shares,n=t.findIndex(i=>i===e);if(n===-1)return new x("That share is not known yet");t.splice(n,1);const r=Re(Mn,this.namespace);return this.storage.setItem(r,JSON.stringify(t)),this.fireSharesEvent(),t}get shareSecrets(){const e=Re(Nn,this.namespace);return fr(this.storage,e,Sf)||{}}async addSecret(e,t){if(!this.shares.find(u=>e===u))return new x("This share is not yet known.");if(M(await De.checkKeypairIsValid({shareAddress:e,secret:t})))return new x("Not the right secret for this share.");const r=Re(Nn,this.namespace),i={...this.shareSecrets,[e]:t};return this.storage.setItem(r,JSON.stringify(i)),this.fireSecretsEvent(),i}removeSecret(e){const t=this.shareSecrets;if(!t[e])return new x("Unknown share");const r=Re(Nn,this.namespace),i={...t};return delete i[e],this.storage.setItem(r,JSON.stringify(i)),this.fireSecretsEvent(),i}get servers(){const e=Re($n,this.namespace);return fr(this.storage,e,Tf)||[]}addServer(e){try{const t=new URL(e),n=new Set([...this.servers,t.toString()]),r=Array.from(n),i=Re($n,this.namespace);return this.storage.setItem(i,JSON.stringify(r)),this.fireServersEvent(),r}catch{return new x("Not a valid URL.")}}removeServer(e){try{const t=new URL(e),n=this.servers,r=n.findIndex(u=>u===t.toString());if(r===-1)return new x("That server is not known yet");n.splice(r,1);const i=Re($n,this.namespace);return this.storage.setItem(i,JSON.stringify(n)),this.fireServersEvent(),n}catch{return new x("Not a valid URL")}}clear(){const e=Re(cr,this.namespace);this.storage.setItem(e,JSON.stringify(null));const t=Re(Mn,this.namespace);this.storage.setItem(t,JSON.stringify([]));const n=Re(Nn,this.namespace);this.storage.setItem(n,JSON.stringify({}));const r=Re($n,this.namespace);this.storage.setItem(r,JSON.stringify([])),this.fireAuthorEvent(),this.fireSharesEvent(),this.fireSecretsEvent(),this.fireServersEvent()}onAuthorChanged(e){return this.authorChangedCbs.add(e),()=>{this.authorChangedCbs.delete(e)}}onSharesChanged(e){return this.sharesChangedCbs.add(e),()=>{this.sharesChangedCbs.delete(e)}}onShareSecretsChanged(e){return this.shareSecretsChangedCbs.add(e),()=>{this.shareSecretsChangedCbs.delete(e)}}onServersChanged(e){return this.serversChangedCbs.add(e),()=>{this.serversChangedCbs.delete(e)}}getPeer({sync:e,onCreateReplica:t}){const n=new Xn,r=this.shares;for(const l of r){const c=t(l,this.shareSecrets[l]);n.addReplica(c)}const i=this.onSharesChanged(async l=>{const c=n.replicas(),f=n.shares();for(const h of c)l.includes(h.share)||(n.removeReplica(h),await h.close(!1));for(const h of l)if(!f.includes(h)){const d=t(h,this.shareSecrets[h]);n.addReplica(d)}}),u=this.onShareSecretsChanged(async l=>{const c=n.shares(),f=Object.keys(l);for(const h of c)if(!f.includes(h)){const d=n.getReplica(h);d&&(n.removeReplica(d),d.close(!1));const p=t(h);n.addReplica(p)}for(const h of f){const d=n.getReplica(h);if(d!=null&&d.formatsConfig["es.5"]&&d.formatsConfig["es.5"].shareSecret)continue;await(d==null?void 0:d.close(!1)),n.removeReplicaByShare(h);const p=t(h,l[h]);n.addReplica(p)}});if(e)for(const l of this.servers)n.sync(l,e==="continuous");const a=this.onServersChanged(l=>{if(e){const c=n.getSyncers();for(const[f,{description:h,syncer:d}]of c)l.includes(h)||d.cancel();for(const f of l)n.sync(f,e==="continuous")}});return{peer:n,unsubscribeFromSettings:()=>{i(),u(),a()}}}fireAuthorEvent(){const e=this.author;for(const t of this.authorChangedCbs)t(e)}fireSharesEvent(){const e=this.shares;for(const t of this.sharesChangedCbs)t(e)}fireSecretsEvent(){const e=this.shareSecrets;for(const t of this.shareSecretsChangedCbs)t(e)}fireServersEvent(){const e=this.servers;for(const t of this.serversChangedCbs)t(e)}async redeemInvitationURL(e){const t=await ta(e);if(M(t))return t;this.addShare(t.shareAddress);for(const n of t.servers)this.addServer(n);return t.secret&&this.addSecret(t.shareAddress,t.secret),!0}}function Re(s,e){return`${kf}:${e?`${e}:`:""}${s}`}function fr(s,e,t){const n=s.getItem(e);if(n!==null)try{const r=JSON.parse(n);return t(r)?r:void 0}catch{return}}function na(s){return!(s==null||typeof s!="object")}function Ff(s){return!(!na(s)||Object.keys(s).length!==2||!("address"in s)||!("secret"in s))}function Bf(s){return!(!Array.isArray(s)||s.some(e=>typeof e!="string")||s.some(e=>M(Ut(e))))}function Sf(s){if(!na(s))return!1;for(const e in s){const t=s[e];if(typeof t!="string"||M(De.checkKeypairIsValid({shareAddress:e,secret:t})))return!1}return!0}function Tf(s){if(!Array.isArray(s)||s.some(e=>typeof e!="string"))return!1;for(const e of s)try{new URL(e)}catch{return!1}return!0}function If(s){const e=s-1;return e*e*e+1}function Pf(s,{delay:e=0,duration:t=400,easing:n=La}={}){const r=+getComputedStyle(s).opacity;return{delay:e,duration:t,easing:n,css:i=>`opacity: ${i*r}`}}function Lt(s,{delay:e=0,duration:t=400,easing:n=If,x:r=0,y:i=0,opacity:u=0}={}){const a=getComputedStyle(s),o=+a.opacity,l=a.transform==="none"?"":a.transform,c=o*(1-u);return{delay:e,duration:t,easing:n,css:(f,h)=>`
			transform: ${l} translate(${(1-f)*r}px, ${(1-f)*i}px);
			opacity: ${o-c*h}`}}const cn=[];function er(s,e){return{subscribe:ks(s,e).subscribe}}function ks(s,e=N){let t;const n=new Set;function r(a){if(J(s,a)&&(s=a,t)){const o=!cn.length;for(const l of n)l[1](),cn.push(l,s);if(o){for(let l=0;l<cn.length;l+=2)cn[l][0](cn[l+1]);cn.length=0}}}function i(a){r(a(s))}function u(a,o=N){const l=[a,o];return n.add(l),n.size===1&&(t=e(r)||N),a(s),()=>{n.delete(l),n.size===0&&(t(),t=null)}}return{set:r,update:i,subscribe:u}}function Rf(s,e,t){const n=!Array.isArray(s),r=n?[s]:s,i=e.length<2;return er(t,u=>{let a=!1;const o=[];let l=0,c=N;const f=()=>{if(l)return;c();const d=e(n?o[0]:o,u);i?u(d):c=ro(d)?d:N},h=r.map((d,p)=>ja(d,g=>{o[p]=g,l&=~(1<<p),a&&f()},()=>{l|=1<<p}));return a=!0,f(),function(){ge(h),c()}})}const dt=ks({address:"",secret:""});new He("storage driver localStorage","gold");const Yt=new He("replica driver indexeddb","gold");function Of(s,e){return Es([s.path,s.timestamp,s.signature],[e.path,e.timestamp,s.signature],["ASC","DESC","ASC"])}function xf(s,e){return Es([s.path,s.timestamp,s.signature],[e.path,e.timestamp,s.signature],["DESC","DESC","ASC"])}const Ze="docs",at="config";class Mf{constructor(e,t){Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:ne()}),Object.defineProperty(this,"gotInitialMaxLocalIndex",{enumerable:!0,configurable:!0,writable:!0,value:ne()}),Object.defineProperty(this,"localMaxLocalIndex",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1});const n=Ut(e);if(M(n))throw n;if(this.share=e,Yt.debug("constructor"),!window.indexedDB)throw new Qe("IndexedDB is not supported by this runtime.");const r=vo.indexedDB.open(`earthstar:share_docs:${this.share}${t?`/${t}`:""}`,1);r.onerror=()=>{throw Yt.error(`Could not open IndexedDB for ${this.share}'s attachments.`),Yt.error(r.error),new Qe(`Could not open IndexedDB for ${this.share}'s attachments.`)},r.onupgradeneeded=function(){const i=r.result,u=i.createObjectStore(Ze,{keyPath:["path","author"]});u.createIndex("comboIndex",["_localIndex","timestamp","path","author"],{unique:!0}),u.createIndex("pathTimestampIndex",["path","timestamp"],{unique:!1}),u.createIndex("pathAuthorIndex",["path","author"],{unique:!0}),u.createIndex("deleteAfterIndex","deleteAfter",{unique:!1}),u.createIndex("localIndexIndex","_localIndex",{unique:!0}),i.createObjectStore(at,{keyPath:"key"}).createIndex("keyIndex",["key"],{unique:!0})},r.onsuccess=()=>{this.db.resolve(r.result);const u=r.result.transaction([Ze],"readonly").objectStore(Ze).index("localIndexIndex").openCursor(null,"prev");u.onsuccess=()=>{u.result?this.gotInitialMaxLocalIndex.resolve(u.result.value._localIndex):this.gotInitialMaxLocalIndex.resolve(-1)}},this.gotInitialMaxLocalIndex.then(i=>{this.localMaxLocalIndex=i})}isClosed(){return this.closed}async close(e){if(this.closed)throw new Ce;this.closed=!0;const t=ne();if(e){const r=(await this.db).transaction([Ze,at],"readwrite"),i=ne(),u=ne(),a=r.objectStore(Ze).clear().onsuccess=()=>{i.resolve()},o=r.objectStore(at).clear().onsuccess=()=>{u.resolve()};await Promise.all([a,o]),t.resolve()}else t.resolve();return(await this.db).close(),await Vo(20),t}async getMaxLocalIndex(){return await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex}async queryDocs(e){var c,f,h,d,p,g,C,b,A,E,B,k,F;const n=(await this.db).transaction([Ze],"readonly").objectStore(Ze),r=ne(),{query:i,willMatch:u}=ea(e);if(Yt.debug(`    cleanUpQuery.  willMatch = ${u}`),u==="nothing")return[];if((c=i.filter)!=null&&c.path&&i.historyMode==="latest"){const T=IDBKeyRange.bound([i.filter.path,i.filter.timestampGt||0],[i.filter.path,i.filter.timestampLt||Number.MAX_SAFE_INTEGER]),R=n.index("pathTimestampIndex").openCursor(T,"prev");R.onsuccess=()=>{var $;($=R.result)!=null&&$.value?r.resolve([R.result.value]):r.resolve([])}}else if((f=i.filter)!=null&&f.path&&i.historyMode==="all"){const T=n.index("pathAuthorIndex"),P=IDBKeyRange.bound([i.filter.path," "],[i.filter.path,"~"]),R=T.getAll(P);R.onsuccess=()=>{R.result?r.resolve(Array.from(R.result)):r.resolve([])}}else{const T=((h=i.startAfter)==null?void 0:h.path)||((d=i.filter)==null?void 0:d.path)||((p=i.filter)==null?void 0:p.pathStartsWith)||" ",P=((g=i.filter)==null?void 0:g.author)||" ",R=((C=i.filter)==null?void 0:C.timestamp)||((b=i.filter)==null?void 0:b.timestampGt)||0,$=((A=i.startAfter)==null?void 0:A.localIndex)||0,W=((E=i.filter)==null?void 0:E.path)||"~",le=((B=i.filter)==null?void 0:B.author)||"~",ue=((k=i.filter)==null?void 0:k.timestamp)||((F=i.filter)==null?void 0:F.timestampLt)||Number.MAX_SAFE_INTEGER,qe=Number.MAX_SAFE_INTEGER,we=IDBKeyRange.bound([$,R,T,P],[qe,ue,W,le]),he=n.index("comboIndex").getAll(we);he.onsuccess=()=>{he.result?r.resolve(he.result):r.resolve([])}}const a=await r;if(i.historyMode==="latest"){const T=a.splice(0,a.length),P=new Map;for(const R of T){const $=P.get(R.path);(!$||$.timestamp<R.timestamp)&&P.set(R.path,R)}a.push(...P.values())}const o=[];Yt.debug("    filtering docs");const l=Date.now()*1e3;for(const T of a)T.deleteAfter&&T.deleteAfter<l||i.filter&&!As(T,i.filter)||o.push(T);if(Yt.debug(`    ordering docs: ${i.orderBy}`),i.orderBy==="path ASC")o.sort(Of);else if(i.orderBy==="path DESC")o.sort(xf);else if(i.orderBy==="localIndex ASC")o.sort(gi("_localIndex","ASC"));else if(i.orderBy==="localIndex DESC")o.sort(gi("_localIndex","DESC"));else if(i.orderBy)throw new x("unrecognized query orderBy: "+JSON.stringify(i.orderBy));return i.limit!==void 0&&a.length>=i.limit?o.slice(0,i.limit):(Yt.debug(`    queryDocs is done: found ${o.length} docs.`),o)}async upsert(e){const t=await this.db,r=t.transaction([Ze],"readwrite").objectStore(Ze).index("pathAuthorIndex"),i=ne(),u=r.openCursor([e.path,e.author]);if(await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex+=1,e._localIndex=this.localMaxLocalIndex,u.onsuccess=()=>{if(u.result){const f=u.result.update(e);f.onsuccess=()=>{i.resolve(!!f.result)}}else i.resolve(!1)},await i)return e;const l=t.transaction([Ze],"readwrite").objectStore(Ze).put(e),c=ne();return l.onsuccess=()=>{c.resolve()},l.onerror=()=>{throw l.error},await c,e}async eraseExpiredDocs(){const e=[],r=(await this.db).transaction([Ze],"readwrite").objectStore(Ze).index("deleteAfterIndex"),i=Date.now()*1e3,u=IDBKeyRange.bound(0,i),a=r.openCursor(u),o=ne();return a.onsuccess=()=>{var l;if((l=a.result)!=null&&l.value){const c=a.result.value;if(c.deleteAfter!==null&&c.deleteAfter!==void 0){e.push(c);const f=a.result.delete();f.onsuccess=()=>{var h;(h=a.result)==null||h.continue()}}}else o.resolve()},await o,e}async getConfig(e){const n=(await this.db).transaction([at],"readonly").objectStore(at),r=ne(),i=n.get(e);return i.onsuccess=()=>{var u;r.resolve((u=i.result)==null?void 0:u.value)},r}async setConfig(e,t){const r=(await this.db).transaction([at],"readwrite").objectStore(at),i=ne(),u=r.put({key:e,value:t});return u.onsuccess=()=>{i.resolve()},i}async listConfigKeys(){const t=(await this.db).transaction([at],"readonly").objectStore(at),n=ne(),i=t.index("keyIndex").openKeyCursor(),u=[];return i.onsuccess=()=>{i.result?(u.push(i.result.primaryKey),i.result.continue()):n.resolve(u)},n}async deleteConfig(e){const n=(await this.db).transaction([at],"readwrite").objectStore(at),r=ne(),i=n.index("keyIndex"),u=IDBKeyRange.bound([e],[e]),a=i.openCursor(u);return a.onsuccess=()=>{if(a.result){const o=a.result.delete();o.onsuccess=()=>{r.resolve(!0)}}else r.resolve(!1)},r}}const _i=new He("replica driver indexeddb","gold"),lt="attachment_staging_index",Xe="attachments_index",Ge="attachments_bytes";class Nf{constructor(e,t){if(Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:ne()}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.share=e,!window.indexedDB)throw new Qe("IndexedDB is not supported by this runtime.");const n=vo.indexedDB.open(`earthstar:share_attachments:${this.share}${t?`/${t}`:""}`,1);n.onerror=()=>{throw _i.error(`Could not open IndexedDB for ${this.share}'s attachments.`),_i.error(n.error),new Qe(`Could not open IndexedDB for ${this.share}'s attachments.`)},n.onupgradeneeded=function(){const r=n.result;r.createObjectStore(Ge),r.createObjectStore(Xe,{keyPath:"id"}),r.createObjectStore(lt,{keyPath:"id"})},n.onsuccess=()=>{this.db.resolve(n.result)}}getIndexKey(e,t){return`${e}___${t}`}async getAttachment(e,t){if(this.closed)throw new Ce;const n=ne(),r=this.getIndexKey(e,t),i=await this.db,a=i.transaction([Xe],"readonly").objectStore(Xe).get(r),o=ne();return a.onerror=()=>{o.reject()},a.onsuccess=()=>{a.result===void 0?o.reject():o.resolve(a.result.blobKey)},o.then(l=>{const f=i.transaction([Ge],"readonly").objectStore(Ge).get(l);f.onsuccess=()=>{const h=new lo([f.result]);n.resolve({bytes:async()=>new Uint8Array(await h.arrayBuffer()),stream:()=>Promise.resolve(h.stream())})},f.onerror=()=>{n.resolve(void 0)}}).catch(()=>{n.resolve(void 0)}),n}async erase(e,t){if(this.closed)throw new Ce;const n=ne(),r=this.getIndexKey(e,t),i=await this.db,a=i.transaction([Xe],"readonly").objectStore(Xe).get(r),o=ne();return a.onerror=()=>{o.reject()},a.onsuccess=()=>{i.transaction([Xe],"readwrite").objectStore(Xe).delete(r),a.result===void 0?o.reject():o.resolve(a.result.blobKey)},o.then(l=>{const c=i.transaction([Ge],"readwrite").objectStore(Ge).delete(l);c.onsuccess=()=>{n.resolve(!0)},c.onerror=()=>{n.resolve(void 0)}}).catch(()=>{n.resolve(new x("No attachment found"))}),n}async stage(e,t){if(this.closed)throw new Ce;const n=await this.db,r=t instanceof Uint8Array?t:await Ef(t),i=await De.sha256base32(r),u=this.getIndexKey(e,i),a=`${u}___${Bt()}`,o=n.transaction([Ge,lt],"readwrite"),l=o.objectStore(Ge).put(r,a),c=o.objectStore(lt).put({id:u,blobKey:a}),f=ne(),h=ne();return l.onsuccess=()=>f.resolve(),c.onsuccess=()=>h.resolve(),await f,await h,{hash:i,size:r.byteLength,reject:async()=>{const d=n.transaction([Ge,lt],"readwrite"),p=d.objectStore(Ge).delete(a),g=d.objectStore(lt).delete(u),C=ne(),b=ne();p.onsuccess=()=>{C.resolve()},g.onsuccess=()=>{b.resolve()},await Promise.all([C,b])},commit:async()=>{const d=n.transaction([Xe,lt],"readwrite"),p=d.objectStore(lt).delete(u),g=d.objectStore(Xe).put({id:u,blobKey:a}),C=ne(),b=ne();p.onsuccess=()=>C.resolve(),g.onsuccess=()=>b.resolve(),await Promise.all([C,b])}}}async wipe(){if(this.closed)throw new Ce;const t=(await this.db).transaction([Ge,Xe,lt],"readwrite"),n=t.objectStore(Ge).clear(),r=t.objectStore(Xe).clear(),i=t.objectStore(lt).clear(),u=ne(),a=ne(),o=ne();n.onsuccess=()=>u.resolve(),r.onsuccess=()=>a.resolve(),i.onsuccess=()=>o.resolve(),await Promise.all([u,a,o])}async clearStaging(){if(this.closed)throw new Ce;const t=(await this.db).transaction([Ge,lt]),n=t.objectStore(lt).openCursor(),r=ne();return n.onsuccess=()=>{const i=n.result;if(!i){r.resolve();return}const u=i.value.blobKey,a=t.objectStore(Ge).delete(u);i.delete(),a.onsuccess=()=>{i.continue()},a.onerror=()=>{i.continue()}},r}async filter(e){if(this.closed)throw new Ce;const n=(await this.db).transaction([Ge,Xe],"readwrite"),r=50,i=[],u=[],a=ne(),o=(l=null)=>{const c=n.objectStore(Xe).getAll(l,r);c.onsuccess=()=>{const f=c.result;for(const h of f){const[d,p]=h.id.split("___");e[d]&&!e[d].has(p)&&(i.push({format:d,hash:p}),u.push(this.erase(d,p)))}if(f.length===r){const h=f[f.length-1],d=IDBKeyRange.lowerBound(h.id,!0);o(d)}else a.resolve()}};return o(),await a,await Promise.all(u),i}isClosed(){return this.closed}async close(e){if(this.closed)throw new Ce;e&&await this.wipe(),this.closed=!0,(await this.db).close(),await Vo(20)}}class $f{constructor(e,t){Object.defineProperty(this,"docDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachmentDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.docDriver=new Mf(e,t),this.attachmentDriver=new Nf(e,t)}}const Vn=er({shareAddress:"+commons.b27bosxdl43cwmugqh2gg2ulaucikjxteaxkagkxhbmzcbvveb52a",secret:"b434ttewvnr63tiebyb3t3lqwen6wxajj7zh5w52jivgdnin5okga"});let hs;Vn.subscribe(s=>{hs=s});const Lf=new Cf({driver:new $f(hs.shareAddress),shareSecret:hs.secret}),Tt=er({replica:Lf}),jf=new vs,tt=ks({settings:jf});function Uf(s){let e,t,n,r,i,u,a,o,l,c,f,h,d,p;return{c(){e=D("input"),t=I(),n=D("button"),r=L(`Upload ID
    `),i=D("br"),u=I(),a=D("br"),o=I(),l=D("img"),f=I(),h=D("span"),h.textContent="It is a JSON file",Pe(e,"display","none"),y(e,"type","file"),y(e,"accept",".json, .txt"),Oe(l.src,c=zf)||y(l,"src",c),y(l,"alt","upload id is a mouse "),y(h,"class","tooltiptext svelte-zq0ldm"),y(n,"class","phase1 tooltip px-8 pb-8 svelte-zq0ldm")},m(g,C){w(g,e,C),s[4](e),w(g,t,C),w(g,n,C),m(n,r),m(n,i),m(n,u),m(n,a),m(n,o),m(n,l),m(n,f),m(n,h),d||(p=[j(e,"change",s[3]),j(n,"click",s[5])],d=!0)},p:N,i:N,o:N,d(g){g&&_(e),s[4](null),g&&_(t),g&&_(n),d=!1,ge(p)}}}let zf="images/upload-img.png";function Hf(s){return new Promise((e,t)=>{let n=new FileReader;n.onload=()=>{e(n.result)},n.onerror=t,n.readAsBinaryString(s)})}function qf(s,e,t){const n=rt();let r,i,{identityPg:u=!1}=e;async function a(f){let h=f.target.files[0],d=await Hf(h);try{let p=JSON.parse(d);console.log(typeof p),console.log("fileReady",d);let g=p.address;console.log("authorAddress",g);let C=p.secret;console.log("authorSecret",C),dt.set({address:g,secret:C}),i=g.slice(1,5),n("alias",i)}catch{n("error")}}const o=f=>a(f);function l(f){Fr[f?"unshift":"push"](()=>{r=f,t(0,r)})}const c=()=>{r.click()};return s.$$set=f=>{"identityPg"in f&&t(2,u=f.identityPg)},[r,a,u,o,l,c]}class Wf extends Z{constructor(e){super(),X(this,e,qf,Uf,J,{identityPg:2})}}function yi(s){let e,t,n,r,i;return{c(){e=D("h4"),e.textContent="Your current Identity Keypair:",t=I(),n=D("h4"),r=D("b"),i=L(s[2]),y(n,"class","my-4")},m(u,a){w(u,e,a),w(u,t,a),w(u,n,a),m(n,r),m(r,i)},p(u,a){a&4&&re(i,u[2])},d(u){u&&_(e),u&&_(t),u&&_(n)}}}function Ci(s){let e,t,n;function r(a,o){return a[5]==="ID must be 4 characters long"?Gf:a[5]==="ID must start with a letter"?Qf:a[5]==="ID must not contain special characters"?Vf:Kf}let i=r(s),u=i(s);return{c(){e=D("blockquote"),u.c()},m(a,o){w(a,e,o),u.m(e,null),n=!0},p(a,o){i!==(i=r(a))&&(u.d(1),u=i(a),u&&(u.c(),u.m(e,null)))},i(a){n||(An(()=>{t||(t=Mt(e,Lt,{y:200,duration:2e3},!0)),t.run(1)}),n=!0)},o(a){t||(t=Mt(e,Lt,{y:200,duration:2e3},!1)),t.run(0),n=!1},d(a){a&&_(e),u.d(),a&&t&&t.end()}}}function Kf(s){let e;return{c(){e=L("Press enter to generate a new keypair.")},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function Vf(s){let e;return{c(){e=D("i"),e.innerHTML=`<strong>Special characters are not allowed.</strong> 
                    <br/>`},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function Qf(s){let e;return{c(){e=D("i"),e.innerHTML="<strong>A valid alias must begin with a letter.</strong> It needs to be 4 characters long and can only contain letters and numbers."},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function Gf(s){let e;return{c(){e=D("i"),e.innerHTML="A valid id <strong>needs to be 4 characters long</strong>."},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function Ai(s){let e,t,n;return{c(){e=D("blockquote"),e.innerHTML="<strong>Please upload a valid identity file</strong>"},m(r,i){w(r,e,i),n=!0},i(r){n||(An(()=>{t||(t=Mt(e,Lt,{y:200,duration:2e3},!0)),t.run(1)}),n=!0)},o(r){t||(t=Mt(e,Lt,{y:200,duration:2e3},!1)),t.run(0),n=!1},d(r){r&&_(e),r&&t&&t.end()}}}function Yf(s){let e,t,n,r,i,u,a,o,l,c,f,h,d,p,g,C,b,A,E,B,k,F,T,P,R,$,W,le,ue,qe,we,de,he,K,ce,G=s[3].address.length!==0&&yi(s),me=s[6]&&Ci(s),ye=s[7]===!0&&Ai();return{c(){e=D("div"),G&&G.c(),t=I(),n=D("div"),n.textContent="Your identity is represented by the keypair seen below. It contains your address and secret.",r=I(),i=D("div"),u=D("div"),a=D("b"),a.textContent="Address:",o=I(),l=L(s[1]),c=I(),f=D("br"),h=I(),d=D("b"),d.textContent="Secret:",p=I(),g=L(s[8]),C=I(),b=D("div"),A=L(`You can

        `),E=D("button"),E.textContent="generate another identity",B=L(`

    or customize your alias in the box below.`),k=I(),F=D("div"),T=L(`Your alias is 
    `),P=D("input"),R=I(),$=D("div"),$.textContent="You can download it and reuse it later.",W=I(),le=D("div"),ue=D("button"),ue.textContent="Download your identity file",qe=I(),we=D("div"),me&&me.c(),de=I(),ye&&ye.c(),y(i,"class","my-6"),y(E,"class","phase1 svelte-13r1n88"),y(P,"type","text"),y(P,"spellcheck","false"),y(P,"maxlength","4"),y(P,"class","svelte-13r1n88"),y(F,"class","my-4"),y($,"class","mt-6"),y(ue,"class","phase1 svelte-13r1n88"),y(le,"class","flex items-center align-center flex-col"),y(e,"class","id mt-8 border-2 p-4 svelte-13r1n88")},m(Me,Dt){w(Me,e,Dt),G&&G.m(e,null),m(e,t),m(e,n),m(e,r),m(e,i),m(i,u),m(u,a),m(u,o),m(u,l),m(u,c),m(u,f),m(u,h),m(u,d),m(u,p),m(u,g),m(e,C),m(e,b),m(b,A),m(b,E),m(b,B),m(e,k),m(e,F),m(F,T),m(F,P),ze(P,s[4]),m(e,R),m(e,$),m(e,W),m(e,le),m(le,ue),m(e,qe),m(e,we),me&&me.m(we,null),m(we,de),ye&&ye.m(we,null),he=!0,K||(ce=[j(E,"click",s[10]),j(P,"input",s[11]),j(P,"keypress",s[12]),j(P,"focus",s[13]),j(P,"keypress",s[14]),j(ue,"click",s[15])],K=!0)},p(Me,[Dt]){Me[3].address.length!==0?G?G.p(Me,Dt):(G=yi(Me),G.c(),G.m(e,t)):G&&(G.d(1),G=null),(!he||Dt&2)&&re(l,Me[1]),(!he||Dt&256)&&re(g,Me[8]),Dt&16&&P.value!==Me[4]&&ze(P,Me[4]),Me[6]?me?(me.p(Me,Dt),Dt&64&&v(me,1)):(me=Ci(Me),me.c(),v(me,1),me.m(we,de)):me&&(V(),S(me,1,1,()=>{me=null}),Q()),Me[7]===!0?ye?Dt&128&&v(ye,1):(ye=Ai(),ye.c(),v(ye,1),ye.m(we,null)):ye&&(V(),S(ye,1,1,()=>{ye=null}),Q())},i(Me){he||(v(me),v(ye),he=!0)},o(Me){S(me),S(ye),he=!1},d(Me){Me&&_(e),G&&G.d(),me&&me.d(),ye&&ye.d(),K=!1,ge(ce)}}}function Jf(s){return/[0-9]/.test(s)}function Zf(s){return/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(s)}function Xf(){let s="",e="abcdefghijklmnopqrstuvwxyz",t=e.length,n="abcdefghijklmnopqrstuvwxyz0123456789",r=n.length;s+=e.charAt(Math.floor(Math.random()*t));for(let i=0;i<3;i++)s+=n.charAt(Math.floor(Math.random()*r));return s}function eh(s,e,t){let n,r,i,u;Be(s,dt,B=>t(3,u=B));let a,o,l=!1,c=!1;const f=new vs;function h(){let B=document.createElement("a"),k=new Blob([JSON.stringify(u)],{type:"text/plain"}),F=u.address+".json";B.href=URL.createObjectURL(k),B.download=F,B.style.display="none",document.body.appendChild(B),B.click()}async function d(B){B=="r"&&t(4,a=Xf());let k=a.slice(0,1);if(Jf(k))console.log("firstChar",k),t(5,o="ID must start with a letter");else if(a.length!==4)t(5,o="ID must be 4 characters long");else if(Zf(a))t(5,o="ID must not contain special characters");else{let F=await De.generateAuthorKeypair(a),T=F.address,P=F.secret;dt.set({address:T,secret:P}),t(5,o=null),t(6,l=!1),f.author=F,tt.set({settings:f})}}pt(()=>{u.address.length===0?d("r"):(t(1,n=u.address),t(8,r=u.secret))});const p=()=>d("r");function g(){a=this.value,t(4,a),t(2,i),t(1,n),t(3,u)}const C=()=>{t(6,l=!0)},b=()=>{t(6,l=!0)},A=()=>d(),E=()=>h();return s.$$.update=()=>{s.$$.dirty&8&&t(1,n=u.address),s.$$.dirty&8&&t(8,r=u.secret),s.$$.dirty&2&&t(2,i=n.slice(0,5)),s.$$.dirty&4&&t(4,a=i.slice(1,5))},[d,n,i,u,a,o,l,c,r,h,p,g,C,b,A,E]}class th extends Z{constructor(e){super(),X(this,e,eh,Yf,J,{generateID:0})}get generateID(){return this.$$.ctx[0]}}let ra;Tt.subscribe(s=>{ra=s});const nh=new Af(ra.replica),sa=er({cache:nh}),ia=er(new Date,function(e){const t=setInterval(()=>{e(new Date)},1e3);return function(){clearInterval(t)}}),rh=new Date,sh=Rf(ia,s=>Math.round((Number(s)-Number(rh))/1e3));function Ei(s){let e,t,n,r,i,u,a,o=Math.trunc(s[2])+"",l,c,f=s[2]<=1?"minute":"minutes",h,d,p,g,C=Math.trunc((s[3]/1e3-(s[0]*1e3+s[4]))/6e4)+"",b,A,E,B,k,F;return{c(){e=D("div"),t=D("button"),t.textContent="➕Extend",n=I(),r=D("button"),r.textContent="➖Shorten",i=I(),u=D("p"),a=L("last interaction was "),l=L(o),c=I(),h=L(f),d=L(" ago"),p=I(),g=D("p"),b=L(C),A=L(" minutes left until deletion"),E=I(),B=D("button"),B.textContent="🗑️Delete",y(t,"class","svelte-mmxx8s"),y(r,"class","svelte-mmxx8s"),y(u,"class","svelte-mmxx8s"),y(g,"class","svelte-mmxx8s"),y(B,"class","svelte-mmxx8s"),y(e,"id","flexcontainer"),y(e,"class","svelte-mmxx8s")},m(T,P){w(T,e,P),m(e,t),m(e,n),m(e,r),m(e,i),m(e,u),m(u,a),m(u,l),m(u,c),m(u,h),m(u,d),m(e,p),m(e,g),m(g,b),m(g,A),m(e,E),m(e,B),k||(F=[j(t,"click",s[5]),j(r,"click",s[6]),j(B,"click",s[10])],k=!0)},p(T,P){P&4&&o!==(o=Math.trunc(T[2])+"")&&re(l,o),P&4&&f!==(f=T[2]<=1?"minute":"minutes")&&re(h,f),P&9&&C!==(C=Math.trunc((T[3]/1e3-(T[0]*1e3+T[4]))/6e4)+"")&&re(b,C)},d(T){T&&_(e),k=!1,ge(F)}}}function ih(s){let e,t=s[1]?"⌛Ephemeral":"⏳Ephemeral",n,r,i,u,a,o=s[1]&&Ei(s);return{c(){e=D("button"),n=L(t),r=I(),o&&o.c(),i=ie(),y(e,"class","svelte-mmxx8s")},m(l,c){w(l,e,c),m(e,n),w(l,r,c),o&&o.m(l,c),w(l,i,c),u||(a=j(e,"click",s[9]),u=!0)},p(l,[c]){c&2&&t!==(t=l[1]?"⌛Ephemeral":"⏳Ephemeral")&&re(n,t),l[1]?o?o.p(l,c):(o=Ei(l),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},i:N,o:N,d(l){l&&_(e),l&&_(r),o&&o.d(l),l&&_(i),u=!1,a()}}}function uh(s,e,t){let n,r,i;Be(s,sh,b=>t(0,n=b)),Be(s,dt,b=>t(11,r=b)),Be(s,Tt,b=>t(12,i=b));const u=rt();let a=Date.now(),o=!1,l=0,{doc:c}=e,f=c.deleteAfter;async function h(){t(3,f+=36e8);let b=r.address.slice(1,5),A=c.path.split("!"),E=A[0].replace("/documents","/studio")+A[1];const B=await i.replica.set(r,{text:c.text+"<br> lifespan extended by "+b+" on "+new Date().toLocaleString(),path:c.path,deleteAfter:f}),k=await i.replica.set(r,{text:c.text+"<br> lifespan extended by "+b+" on "+new Date().toLocaleString(),path:E});console.log("studioPath",E),console.log("doc.path",c.path),console.log("result c",B),console.log("result s",k)}async function d(){let b=r.address.slice(1,5),A=c.path.split("!"),E=A[0].replace("/documents","/studio")+A[1];console.log("studioPath",E),t(3,f-=864e8);const B=await i.replica.set(r,{text:c.text+"<br> lifespan shortened by "+b+" on "+new Date().toLocaleString(),path:c.path,deleteAfter:f}),k=await i.replica.set(r,{text:c.text+"<br> lifespan shortened by "+b+" on "+new Date().toLocaleString(),path:E});console.log("result c",B),console.log("result s",k)}async function p(){u("update");let b=r.address.slice(1,5),A=c.path.split("!"),E=A[0].replace("/documents","/studio")+A[1];const B=await i.replica.set(r,{path:c.path,deleteAfter:(Date.now()+1e3)*1e3}),k=await i.replica.set(r,{text:c.text+"<br> deleted by "+b+" on "+new Date().toLocaleString(),path:E});console.log("studio 'delete'",k),console.log("result delete",B)}const g=()=>t(1,o=!o),C=()=>p();return s.$$set=b=>{"doc"in b&&t(8,c=b.doc)},s.$$.update=()=>{s.$$.dirty&257&&t(2,l=(n+a/1e3-c.timestamp/1e6)/60)},[n,o,l,f,a,h,d,p,c,g,C]}class oh extends Z{constructor(e){super(),X(this,e,uh,ih,J,{doc:8})}}function ah(){const s=console.warn;console.warn=e=>{e.includes("unknown prop")||e.includes("unexpected slot")||s(e)},pt(()=>{console.warn=s})}function vi(s,e,t){const n=s.slice();return n[18]=e[t],n}function ki(s,e,t){const n=s.slice();return n[18]=e[t],n}function Fi(s,e,t){const n=s.slice();return n[10]=e[t],n}function Bi(s,e,t){const n=s.slice();return n[13]=e[t],n[15]=t,n}function Si(s,e,t){const n=s.slice();return n[16]=e[t],n[15]=t,n}function Ti(s,e,t){const n=s.slice();return n[7]=e[t],n}function lh(s){let e,t,n,r;const i=[dh,hh,fh],u=[];function a(o,l){return o[0]==="table"?0:o[0]==="list"?1:2}return e=a(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),w(o,n,l),r=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(V(),S(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=i[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){S(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function ch(s){let e,t,n=s[1],r=[];for(let u=0;u<n.length;u+=1)r[u]=Mi(Ti(s,n,u));const i=u=>S(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=ie()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);w(u,e,a),t=!0},p(u,a){if(a&34){n=u[1];let o;for(o=0;o<n.length;o+=1){const l=Ti(u,n,o);r[o]?(r[o].p(l,a),v(r[o],1)):(r[o]=Mi(l),r[o].c(),v(r[o],1),r[o].m(e.parentNode,e))}for(V(),o=n.length;o<r.length;o+=1)i(o);Q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)v(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)S(r[a]);t=!1},d(u){rn(r,u),u&&_(e)}}}function fh(s){let e,t,n;const r=[s[6]];var i=s[5][s[0]];function u(a){let o={$$slots:{default:[gh]},$$scope:{ctx:a}};for(let l=0;l<r.length;l+=1)o=Nt(o,r[l]);return{props:o}}return i&&(e=_e(i,u(s))),{c(){e&&U(e.$$.fragment),t=ie()},m(a,o){e&&z(e,a,o),w(a,t,o),n=!0},p(a,o){const l=o&64?En(r,[vn(a[6])]):{};if(o&8388706&&(l.$$scope={dirty:o,ctx:a}),i!==(i=a[5][a[0]])){if(e){V();const c=e;S(c.$$.fragment,1,0,()=>{H(c,1)}),Q()}i?(e=_e(i,u(a)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else i&&e.$set(l)},i(a){n||(e&&v(e.$$.fragment,a),n=!0)},o(a){e&&S(e.$$.fragment,a),n=!1},d(a){a&&_(t),e&&H(e,a)}}}function hh(s){let e,t,n,r;const i=[bh,Dh],u=[];function a(o,l){return o[4]?0:1}return e=a(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),w(o,n,l),r=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(V(),S(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=i[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){S(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function dh(s){let e,t,n;var r=s[5].table;function i(u){return{props:{$$slots:{default:[Sh]},$$scope:{ctx:u}}}}return r&&(e=_e(r,i(s))),{c(){e&&U(e.$$.fragment),t=ie()},m(u,a){e&&z(e,u,a),w(u,t,a),n=!0},p(u,a){const o={};if(a&8388716&&(o.$$scope={dirty:a,ctx:u}),r!==(r=u[5].table)){if(e){V();const l=e;S(l.$$.fragment,1,0,()=>{H(l,1)}),Q()}r?(e=_e(r,i(u)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else r&&e.$set(o)},i(u){n||(e&&v(e.$$.fragment,u),n=!0)},o(u){e&&S(e.$$.fragment,u),n=!1},d(u){u&&_(t),e&&H(e,u)}}}function ph(s){let e=s[6].raw+"",t;return{c(){t=L(e)},m(n,r){w(n,t,r)},p(n,r){r&64&&e!==(e=n[6].raw+"")&&re(t,e)},i:N,o:N,d(n){n&&_(t)}}}function mh(s){let e,t;return e=new un({props:{tokens:s[1],renderers:s[5]}}),{c(){U(e.$$.fragment)},m(n,r){z(e,n,r),t=!0},p(n,r){const i={};r&2&&(i.tokens=n[1]),r&32&&(i.renderers=n[5]),e.$set(i)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function gh(s){let e,t,n,r;const i=[mh,ph],u=[];function a(o,l){return o[1]?0:1}return e=a(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),w(o,n,l),r=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(V(),S(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=i[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){S(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function Dh(s){let e,t,n;const r=[{ordered:s[4]},s[6]];var i=s[5].list;function u(a){let o={$$slots:{default:[_h]},$$scope:{ctx:a}};for(let l=0;l<r.length;l+=1)o=Nt(o,r[l]);return{props:o}}return i&&(e=_e(i,u(s))),{c(){e&&U(e.$$.fragment),t=ie()},m(a,o){e&&z(e,a,o),w(a,t,o),n=!0},p(a,o){const l=o&80?En(r,[o&16&&{ordered:a[4]},o&64&&vn(a[6])]):{};if(o&8388704&&(l.$$scope={dirty:o,ctx:a}),i!==(i=a[5].list)){if(e){V();const c=e;S(c.$$.fragment,1,0,()=>{H(c,1)}),Q()}i?(e=_e(i,u(a)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else i&&e.$set(l)},i(a){n||(e&&v(e.$$.fragment,a),n=!0)},o(a){e&&S(e.$$.fragment,a),n=!1},d(a){a&&_(t),e&&H(e,a)}}}function bh(s){let e,t,n;const r=[{ordered:s[4]},s[6]];var i=s[5].list;function u(a){let o={$$slots:{default:[Ch]},$$scope:{ctx:a}};for(let l=0;l<r.length;l+=1)o=Nt(o,r[l]);return{props:o}}return i&&(e=_e(i,u(s))),{c(){e&&U(e.$$.fragment),t=ie()},m(a,o){e&&z(e,a,o),w(a,t,o),n=!0},p(a,o){const l=o&80?En(r,[o&16&&{ordered:a[4]},o&64&&vn(a[6])]):{};if(o&8388704&&(l.$$scope={dirty:o,ctx:a}),i!==(i=a[5].list)){if(e){V();const c=e;S(c.$$.fragment,1,0,()=>{H(c,1)}),Q()}i?(e=_e(i,u(a)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else i&&e.$set(l)},i(a){n||(e&&v(e.$$.fragment,a),n=!0)},o(a){e&&S(e.$$.fragment,a),n=!1},d(a){a&&_(t),e&&H(e,a)}}}function wh(s){let e,t,n;return e=new un({props:{tokens:s[18].tokens,renderers:s[5]}}),{c(){U(e.$$.fragment),t=I()},m(r,i){z(e,r,i),w(r,t,i),n=!0},p(r,i){const u={};i&64&&(u.tokens=r[18].tokens),i&32&&(u.renderers=r[5]),e.$set(u)},i(r){n||(v(e.$$.fragment,r),n=!0)},o(r){S(e.$$.fragment,r),n=!1},d(r){H(e,r),r&&_(t)}}}function Ii(s){let e,t,n;const r=[s[18]];var i=s[5].unorderedlistitem||s[5].listitem;function u(a){let o={$$slots:{default:[wh]},$$scope:{ctx:a}};for(let l=0;l<r.length;l+=1)o=Nt(o,r[l]);return{props:o}}return i&&(e=_e(i,u(s))),{c(){e&&U(e.$$.fragment),t=ie()},m(a,o){e&&z(e,a,o),w(a,t,o),n=!0},p(a,o){const l=o&64?En(r,[vn(a[18])]):{};if(o&8388704&&(l.$$scope={dirty:o,ctx:a}),i!==(i=a[5].unorderedlistitem||a[5].listitem)){if(e){V();const c=e;S(c.$$.fragment,1,0,()=>{H(c,1)}),Q()}i?(e=_e(i,u(a)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else i&&e.$set(l)},i(a){n||(e&&v(e.$$.fragment,a),n=!0)},o(a){e&&S(e.$$.fragment,a),n=!1},d(a){a&&_(t),e&&H(e,a)}}}function _h(s){let e,t,n=s[6].items,r=[];for(let u=0;u<n.length;u+=1)r[u]=Ii(vi(s,n,u));const i=u=>S(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=ie()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);w(u,e,a),t=!0},p(u,a){if(a&96){n=u[6].items;let o;for(o=0;o<n.length;o+=1){const l=vi(u,n,o);r[o]?(r[o].p(l,a),v(r[o],1)):(r[o]=Ii(l),r[o].c(),v(r[o],1),r[o].m(e.parentNode,e))}for(V(),o=n.length;o<r.length;o+=1)i(o);Q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)v(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)S(r[a]);t=!1},d(u){rn(r,u),u&&_(e)}}}function yh(s){let e,t,n;return e=new un({props:{tokens:s[18].tokens,renderers:s[5]}}),{c(){U(e.$$.fragment),t=I()},m(r,i){z(e,r,i),w(r,t,i),n=!0},p(r,i){const u={};i&64&&(u.tokens=r[18].tokens),i&32&&(u.renderers=r[5]),e.$set(u)},i(r){n||(v(e.$$.fragment,r),n=!0)},o(r){S(e.$$.fragment,r),n=!1},d(r){H(e,r),r&&_(t)}}}function Pi(s){let e,t,n;const r=[s[18]];var i=s[5].orderedlistitem||s[5].listitem;function u(a){let o={$$slots:{default:[yh]},$$scope:{ctx:a}};for(let l=0;l<r.length;l+=1)o=Nt(o,r[l]);return{props:o}}return i&&(e=_e(i,u(s))),{c(){e&&U(e.$$.fragment),t=ie()},m(a,o){e&&z(e,a,o),w(a,t,o),n=!0},p(a,o){const l=o&64?En(r,[vn(a[18])]):{};if(o&8388704&&(l.$$scope={dirty:o,ctx:a}),i!==(i=a[5].orderedlistitem||a[5].listitem)){if(e){V();const c=e;S(c.$$.fragment,1,0,()=>{H(c,1)}),Q()}i?(e=_e(i,u(a)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else i&&e.$set(l)},i(a){n||(e&&v(e.$$.fragment,a),n=!0)},o(a){e&&S(e.$$.fragment,a),n=!1},d(a){a&&_(t),e&&H(e,a)}}}function Ch(s){let e,t,n=s[6].items,r=[];for(let u=0;u<n.length;u+=1)r[u]=Pi(ki(s,n,u));const i=u=>S(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=ie()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);w(u,e,a),t=!0},p(u,a){if(a&96){n=u[6].items;let o;for(o=0;o<n.length;o+=1){const l=ki(u,n,o);r[o]?(r[o].p(l,a),v(r[o],1)):(r[o]=Pi(l),r[o].c(),v(r[o],1),r[o].m(e.parentNode,e))}for(V(),o=n.length;o<r.length;o+=1)i(o);Q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)v(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)S(r[a]);t=!1},d(u){rn(r,u),u&&_(e)}}}function Ah(s){let e,t,n;return e=new un({props:{tokens:s[16].tokens,renderers:s[5]}}),{c(){U(e.$$.fragment),t=I()},m(r,i){z(e,r,i),w(r,t,i),n=!0},p(r,i){const u={};i&4&&(u.tokens=r[16].tokens),i&32&&(u.renderers=r[5]),e.$set(u)},i(r){n||(v(e.$$.fragment,r),n=!0)},o(r){S(e.$$.fragment,r),n=!1},d(r){H(e,r),r&&_(t)}}}function Ri(s){let e,t,n;var r=s[5].tablecell;function i(u){return{props:{header:!0,align:u[6].align[u[15]]||"center",$$slots:{default:[Ah]},$$scope:{ctx:u}}}}return r&&(e=_e(r,i(s))),{c(){e&&U(e.$$.fragment),t=ie()},m(u,a){e&&z(e,u,a),w(u,t,a),n=!0},p(u,a){const o={};if(a&64&&(o.align=u[6].align[u[15]]||"center"),a&8388644&&(o.$$scope={dirty:a,ctx:u}),r!==(r=u[5].tablecell)){if(e){V();const l=e;S(l.$$.fragment,1,0,()=>{H(l,1)}),Q()}r?(e=_e(r,i(u)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else r&&e.$set(o)},i(u){n||(e&&v(e.$$.fragment,u),n=!0)},o(u){e&&S(e.$$.fragment,u),n=!1},d(u){u&&_(t),e&&H(e,u)}}}function Eh(s){let e,t,n=s[2],r=[];for(let u=0;u<n.length;u+=1)r[u]=Ri(Si(s,n,u));const i=u=>S(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=ie()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);w(u,e,a),t=!0},p(u,a){if(a&100){n=u[2];let o;for(o=0;o<n.length;o+=1){const l=Si(u,n,o);r[o]?(r[o].p(l,a),v(r[o],1)):(r[o]=Ri(l),r[o].c(),v(r[o],1),r[o].m(e.parentNode,e))}for(V(),o=n.length;o<r.length;o+=1)i(o);Q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)v(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)S(r[a]);t=!1},d(u){rn(r,u),u&&_(e)}}}function vh(s){let e,t,n;var r=s[5].tablerow;function i(u){return{props:{$$slots:{default:[Eh]},$$scope:{ctx:u}}}}return r&&(e=_e(r,i(s))),{c(){e&&U(e.$$.fragment),t=ie()},m(u,a){e&&z(e,u,a),w(u,t,a),n=!0},p(u,a){const o={};if(a&8388708&&(o.$$scope={dirty:a,ctx:u}),r!==(r=u[5].tablerow)){if(e){V();const l=e;S(l.$$.fragment,1,0,()=>{H(l,1)}),Q()}r?(e=_e(r,i(u)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else r&&e.$set(o)},i(u){n||(e&&v(e.$$.fragment,u),n=!0)},o(u){e&&S(e.$$.fragment,u),n=!1},d(u){u&&_(t),e&&H(e,u)}}}function kh(s){let e,t;return e=new un({props:{tokens:s[13].tokens,renderers:s[5]}}),{c(){U(e.$$.fragment)},m(n,r){z(e,n,r),t=!0},p(n,r){const i={};r&8&&(i.tokens=n[13].tokens),r&32&&(i.renderers=n[5]),e.$set(i)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Oi(s){let e,t,n;var r=s[5].tablecell;function i(u){return{props:{header:!1,align:u[6].align[u[15]]||"center",$$slots:{default:[kh]},$$scope:{ctx:u}}}}return r&&(e=_e(r,i(s))),{c(){e&&U(e.$$.fragment),t=ie()},m(u,a){e&&z(e,u,a),w(u,t,a),n=!0},p(u,a){const o={};if(a&64&&(o.align=u[6].align[u[15]]||"center"),a&8388648&&(o.$$scope={dirty:a,ctx:u}),r!==(r=u[5].tablecell)){if(e){V();const l=e;S(l.$$.fragment,1,0,()=>{H(l,1)}),Q()}r?(e=_e(r,i(u)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else r&&e.$set(o)},i(u){n||(e&&v(e.$$.fragment,u),n=!0)},o(u){e&&S(e.$$.fragment,u),n=!1},d(u){u&&_(t),e&&H(e,u)}}}function Fh(s){let e,t,n=s[10],r=[];for(let u=0;u<n.length;u+=1)r[u]=Oi(Bi(s,n,u));const i=u=>S(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=I()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);w(u,e,a),t=!0},p(u,a){if(a&104){n=u[10];let o;for(o=0;o<n.length;o+=1){const l=Bi(u,n,o);r[o]?(r[o].p(l,a),v(r[o],1)):(r[o]=Oi(l),r[o].c(),v(r[o],1),r[o].m(e.parentNode,e))}for(V(),o=n.length;o<r.length;o+=1)i(o);Q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)v(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)S(r[a]);t=!1},d(u){rn(r,u),u&&_(e)}}}function xi(s){let e,t,n;var r=s[5].tablerow;function i(u){return{props:{$$slots:{default:[Fh]},$$scope:{ctx:u}}}}return r&&(e=_e(r,i(s))),{c(){e&&U(e.$$.fragment),t=ie()},m(u,a){e&&z(e,u,a),w(u,t,a),n=!0},p(u,a){const o={};if(a&8388712&&(o.$$scope={dirty:a,ctx:u}),r!==(r=u[5].tablerow)){if(e){V();const l=e;S(l.$$.fragment,1,0,()=>{H(l,1)}),Q()}r?(e=_e(r,i(u)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else r&&e.$set(o)},i(u){n||(e&&v(e.$$.fragment,u),n=!0)},o(u){e&&S(e.$$.fragment,u),n=!1},d(u){u&&_(t),e&&H(e,u)}}}function Bh(s){let e,t,n=s[3],r=[];for(let u=0;u<n.length;u+=1)r[u]=xi(Fi(s,n,u));const i=u=>S(r[u],1,1,()=>{r[u]=null});return{c(){for(let u=0;u<r.length;u+=1)r[u].c();e=ie()},m(u,a){for(let o=0;o<r.length;o+=1)r[o].m(u,a);w(u,e,a),t=!0},p(u,a){if(a&104){n=u[3];let o;for(o=0;o<n.length;o+=1){const l=Fi(u,n,o);r[o]?(r[o].p(l,a),v(r[o],1)):(r[o]=xi(l),r[o].c(),v(r[o],1),r[o].m(e.parentNode,e))}for(V(),o=n.length;o<r.length;o+=1)i(o);Q()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)v(r[a]);t=!0}},o(u){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)S(r[a]);t=!1},d(u){rn(r,u),u&&_(e)}}}function Sh(s){let e,t,n,r,i;var u=s[5].tablehead;function a(c){return{props:{$$slots:{default:[vh]},$$scope:{ctx:c}}}}u&&(e=_e(u,a(s)));var o=s[5].tablebody;function l(c){return{props:{$$slots:{default:[Bh]},$$scope:{ctx:c}}}}return o&&(n=_e(o,l(s))),{c(){e&&U(e.$$.fragment),t=I(),n&&U(n.$$.fragment),r=ie()},m(c,f){e&&z(e,c,f),w(c,t,f),n&&z(n,c,f),w(c,r,f),i=!0},p(c,f){const h={};if(f&8388708&&(h.$$scope={dirty:f,ctx:c}),u!==(u=c[5].tablehead)){if(e){V();const p=e;S(p.$$.fragment,1,0,()=>{H(p,1)}),Q()}u?(e=_e(u,a(c)),U(e.$$.fragment),v(e.$$.fragment,1),z(e,t.parentNode,t)):e=null}else u&&e.$set(h);const d={};if(f&8388712&&(d.$$scope={dirty:f,ctx:c}),o!==(o=c[5].tablebody)){if(n){V();const p=n;S(p.$$.fragment,1,0,()=>{H(p,1)}),Q()}o?(n=_e(o,l(c)),U(n.$$.fragment),v(n.$$.fragment,1),z(n,r.parentNode,r)):n=null}else o&&n.$set(d)},i(c){i||(e&&v(e.$$.fragment,c),n&&v(n.$$.fragment,c),i=!0)},o(c){e&&S(e.$$.fragment,c),n&&S(n.$$.fragment,c),i=!1},d(c){e&&H(e,c),c&&_(t),c&&_(r),n&&H(n,c)}}}function Mi(s){let e,t;const n=[s[7],{renderers:s[5]}];let r={};for(let i=0;i<n.length;i+=1)r=Nt(r,n[i]);return e=new un({props:r}),{c(){U(e.$$.fragment)},m(i,u){z(e,i,u),t=!0},p(i,u){const a=u&34?En(n,[u&2&&vn(i[7]),u&32&&{renderers:i[5]}]):{};e.$set(a)},i(i){t||(v(e.$$.fragment,i),t=!0)},o(i){S(e.$$.fragment,i),t=!1},d(i){H(e,i)}}}function Th(s){let e,t,n,r;const i=[ch,lh],u=[];function a(o,l){return o[0]?o[5][o[0]]?1:-1:0}return~(e=a(s))&&(t=u[e]=i[e](s)),{c(){t&&t.c(),n=ie()},m(o,l){~e&&u[e].m(o,l),w(o,n,l),r=!0},p(o,[l]){let c=e;e=a(o),e===c?~e&&u[e].p(o,l):(t&&(V(),S(u[c],1,1,()=>{u[c]=null}),Q()),~e?(t=u[e],t?t.p(o,l):(t=u[e]=i[e](o),t.c()),v(t,1),t.m(n.parentNode,n)):t=null)},i(o){r||(v(t),r=!0)},o(o){S(t),r=!1},d(o){~e&&u[e].d(o),o&&_(n)}}}function Ih(s,e,t){const n=["type","tokens","header","rows","ordered","renderers"];let r=Ms(e,n),{type:i=void 0}=e,{tokens:u=void 0}=e,{header:a=void 0}=e,{rows:o=void 0}=e,{ordered:l=!1}=e,{renderers:c}=e;return ah(),s.$$set=f=>{e=Nt(Nt({},e),Ua(f)),t(6,r=Ms(e,n)),"type"in f&&t(0,i=f.type),"tokens"in f&&t(1,u=f.tokens),"header"in f&&t(2,a=f.header),"rows"in f&&t(3,o=f.rows),"ordered"in f&&t(4,l=f.ordered),"renderers"in f&&t(5,c=f.renderers)},[i,u,a,o,l,c,r]}let un=class extends Z{constructor(e){super(),X(this,e,Ih,Th,J,{type:0,tokens:1,header:2,rows:3,ordered:4,renderers:5})}};function ua(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let on=ua();function Ph(s){on=s}const oa=/[&<>"']/,Rh=new RegExp(oa.source,"g"),aa=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,Oh=new RegExp(aa.source,"g"),xh={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ni=s=>xh[s];function Ue(s,e){if(e){if(oa.test(s))return s.replace(Rh,Ni)}else if(aa.test(s))return s.replace(Oh,Ni);return s}const Mh=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function la(s){return s.replace(Mh,(e,t)=>(t=t.toLowerCase(),t==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}const Nh=/(^|[^\[])\^/g;function pe(s,e){s=typeof s=="string"?s:s.source,e=e||"";const t={replace:(n,r)=>(r=r.source||r,r=r.replace(Nh,"$1"),s=s.replace(n,r),t),getRegex:()=>new RegExp(s,e)};return t}const $h=/[^\w:]/g,Lh=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function $i(s,e,t){if(s){let n;try{n=decodeURIComponent(la(t)).replace($h,"").toLowerCase()}catch{return null}if(n.indexOf("javascript:")===0||n.indexOf("vbscript:")===0||n.indexOf("data:")===0)return null}e&&!Lh.test(t)&&(t=Hh(e,t));try{t=encodeURI(t).replace(/%25/g,"%")}catch{return null}return t}const hr={},jh=/^[^:]+:\/*[^/]*$/,Uh=/^([^:]+:)[\s\S]*$/,zh=/^([^:]+:\/*[^/]*)[\s\S]*$/;function Hh(s,e){hr[" "+s]||(jh.test(s)?hr[" "+s]=s+"/":hr[" "+s]=br(s,"/",!0)),s=hr[" "+s];const t=s.indexOf(":")===-1;return e.substring(0,2)==="//"?t?e:s.replace(Uh,"$1")+e:e.charAt(0)==="/"?t?e:s.replace(zh,"$1")+e:s+e}const Ar={exec:function(){}};function Li(s,e){const t=s.replace(/\|/g,(i,u,a)=>{let o=!1,l=u;for(;--l>=0&&a[l]==="\\";)o=!o;return o?"|":" |"}),n=t.split(/ \|/);let r=0;if(n[0].trim()||n.shift(),n.length>0&&!n[n.length-1].trim()&&n.pop(),n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;r<n.length;r++)n[r]=n[r].trim().replace(/\\\|/g,"|");return n}function br(s,e,t){const n=s.length;if(n===0)return"";let r=0;for(;r<n;){const i=s.charAt(n-r-1);if(i===e&&!t)r++;else if(i!==e&&t)r++;else break}return s.slice(0,n-r)}function qh(s,e){if(s.indexOf(e[1])===-1)return-1;const t=s.length;let n=0,r=0;for(;r<t;r++)if(s[r]==="\\")r++;else if(s[r]===e[0])n++;else if(s[r]===e[1]&&(n--,n<0))return r;return-1}function Wh(s){s&&s.sanitize&&!s.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function ji(s,e){if(e<1)return"";let t="";for(;e>1;)e&1&&(t+=s),e>>=1,s+=s;return t+s}function Ui(s,e,t,n){const r=e.href,i=e.title?Ue(e.title):null,u=s[1].replace(/\\([\[\]])/g,"$1");if(s[0].charAt(0)!=="!"){n.state.inLink=!0;const a={type:"link",raw:t,href:r,title:i,text:u,tokens:n.inlineTokens(u)};return n.state.inLink=!1,a}return{type:"image",raw:t,href:r,title:i,text:Ue(u)}}function Kh(s,e){const t=s.match(/^(\s+)(?:```)/);if(t===null)return e;const n=t[1];return e.split(`
`).map(r=>{const i=r.match(/^\s+/);if(i===null)return r;const[u]=i;return u.length>=n.length?r.slice(n.length):r}).join(`
`)}class Fs{constructor(e){this.options=e||on}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const n=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:br(n,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const n=t[0],r=Kh(n,t[3]||"");return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline._escapes,"$1"):t[2],text:r}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(/#$/.test(n)){const r=br(n,"#");(this.options.pedantic||!r||/ $/.test(r))&&(n=r.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){const n=t[0].replace(/^ *>[ \t]?/gm,""),r=this.lexer.state.top;this.lexer.state.top=!0;const i=this.lexer.blockTokens(n);return this.lexer.state.top=r,{type:"blockquote",raw:t[0],tokens:i,text:n}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n,r,i,u,a,o,l,c,f,h,d,p,g=t[1].trim();const C=g.length>1,b={type:"list",raw:"",ordered:C,start:C?+g.slice(0,-1):"",loose:!1,items:[]};g=C?`\\d{1,9}\\${g.slice(-1)}`:`\\${g}`,this.options.pedantic&&(g=C?g:"[*+-]");const A=new RegExp(`^( {0,3}${g})((?:[	 ][^\\n]*)?(?:\\n|$))`);for(;e&&(p=!1,!(!(t=A.exec(e))||this.rules.block.hr.test(e)));){if(n=t[0],e=e.substring(n.length),c=t[2].split(`
`,1)[0].replace(/^\t+/,B=>" ".repeat(3*B.length)),f=e.split(`
`,1)[0],this.options.pedantic?(u=2,d=c.trimLeft()):(u=t[2].search(/[^ ]/),u=u>4?1:u,d=c.slice(u),u+=t[1].length),o=!1,!c&&/^ *$/.test(f)&&(n+=f+`
`,e=e.substring(f.length+1),p=!0),!p){const B=new RegExp(`^ {0,${Math.min(3,u-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),k=new RegExp(`^ {0,${Math.min(3,u-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),F=new RegExp(`^ {0,${Math.min(3,u-1)}}(?:\`\`\`|~~~)`),T=new RegExp(`^ {0,${Math.min(3,u-1)}}#`);for(;e&&(h=e.split(`
`,1)[0],f=h,this.options.pedantic&&(f=f.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(F.test(f)||T.test(f)||B.test(f)||k.test(e)));){if(f.search(/[^ ]/)>=u||!f.trim())d+=`
`+f.slice(u);else{if(o||c.search(/[^ ]/)>=4||F.test(c)||T.test(c)||k.test(c))break;d+=`
`+f}!o&&!f.trim()&&(o=!0),n+=h+`
`,e=e.substring(h.length+1),c=f.slice(u)}}b.loose||(l?b.loose=!0:/\n *\n *$/.test(n)&&(l=!0)),this.options.gfm&&(r=/^\[[ xX]\] /.exec(d),r&&(i=r[0]!=="[ ] ",d=d.replace(/^\[[ xX]\] +/,""))),b.items.push({type:"list_item",raw:n,task:!!r,checked:i,loose:!1,text:d}),b.raw+=n}b.items[b.items.length-1].raw=n.trimRight(),b.items[b.items.length-1].text=d.trimRight(),b.raw=b.raw.trimRight();const E=b.items.length;for(a=0;a<E;a++)if(this.lexer.state.top=!1,b.items[a].tokens=this.lexer.blockTokens(b.items[a].text,[]),!b.loose){const B=b.items[a].tokens.filter(F=>F.type==="space"),k=B.length>0&&B.some(F=>/\n.*\n/.test(F.raw));b.loose=k}if(b.loose)for(a=0;a<E;a++)b.items[a].loose=!0;return b}}html(e){const t=this.rules.block.html.exec(e);if(t){const n={type:"html",raw:t[0],pre:!this.options.sanitizer&&(t[1]==="pre"||t[1]==="script"||t[1]==="style"),text:t[0]};if(this.options.sanitize){const r=this.options.sanitizer?this.options.sanitizer(t[0]):Ue(t[0]);n.type="paragraph",n.text=r,n.tokens=this.lexer.inline(r)}return n}}def(e){const t=this.rules.block.def.exec(e);if(t){const n=t[1].toLowerCase().replace(/\s+/g," "),r=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline._escapes,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:r,title:i}}}table(e){const t=this.rules.block.table.exec(e);if(t){const n={type:"table",header:Li(t[1]).map(r=>({text:r})),align:t[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(n.header.length===n.align.length){n.raw=t[0];let r=n.align.length,i,u,a,o;for(i=0;i<r;i++)/^ *-+: *$/.test(n.align[i])?n.align[i]="right":/^ *:-+: *$/.test(n.align[i])?n.align[i]="center":/^ *:-+ *$/.test(n.align[i])?n.align[i]="left":n.align[i]=null;for(r=n.rows.length,i=0;i<r;i++)n.rows[i]=Li(n.rows[i],n.header.length).map(l=>({text:l}));for(r=n.header.length,u=0;u<r;u++)n.header[u].tokens=this.lexer.inline(n.header[u].text);for(r=n.rows.length,u=0;u<r;u++)for(o=n.rows[u],a=0;a<o.length;a++)o[a].tokens=this.lexer.inline(o[a].text);return n}}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:Ue(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(t[0]):Ue(t[0]):t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const n=t[2].trim();if(!this.options.pedantic&&/^</.test(n)){if(!/>$/.test(n))return;const u=br(n.slice(0,-1),"\\");if((n.length-u.length)%2===0)return}else{const u=qh(t[2],"()");if(u>-1){const o=(t[0].indexOf("!")===0?5:4)+t[1].length+u;t[2]=t[2].substring(0,u),t[0]=t[0].substring(0,o).trim(),t[3]=""}}let r=t[2],i="";if(this.options.pedantic){const u=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(r);u&&(r=u[1],i=u[3])}else i=t[3]?t[3].slice(1,-1):"";return r=r.trim(),/^</.test(r)&&(this.options.pedantic&&!/>$/.test(n)?r=r.slice(1):r=r.slice(1,-1)),Ui(t,{href:r&&r.replace(this.rules.inline._escapes,"$1"),title:i&&i.replace(this.rules.inline._escapes,"$1")},t[0],this.lexer)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){let r=(n[2]||n[1]).replace(/\s+/g," ");if(r=t[r.toLowerCase()],!r){const i=n[0].charAt(0);return{type:"text",raw:i,text:i}}return Ui(n,r,n[0],this.lexer)}}emStrong(e,t,n=""){let r=this.rules.inline.emStrong.lDelim.exec(e);if(!r||r[3]&&n.match(/[\p{L}\p{N}]/u))return;const i=r[1]||r[2]||"";if(!i||i&&(n===""||this.rules.inline.punctuation.exec(n))){const u=r[0].length-1;let a,o,l=u,c=0;const f=r[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(f.lastIndex=0,t=t.slice(-1*e.length+u);(r=f.exec(t))!=null;){if(a=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!a)continue;if(o=a.length,r[3]||r[4]){l+=o;continue}else if((r[5]||r[6])&&u%3&&!((u+o)%3)){c+=o;continue}if(l-=o,l>0)continue;o=Math.min(o,o+l+c);const h=e.slice(0,u+r.index+(r[0].length-a.length)+o);if(Math.min(u,o)%2){const p=h.slice(1,-1);return{type:"em",raw:h,text:p,tokens:this.lexer.inlineTokens(p)}}const d=h.slice(2,-2);return{type:"strong",raw:h,text:d,tokens:this.lexer.inlineTokens(d)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(/\n/g," ");const r=/[^ ]/.test(n),i=/^ /.test(n)&&/ $/.test(n);return r&&i&&(n=n.substring(1,n.length-1)),n=Ue(n,!0),{type:"codespan",raw:t[0],text:n}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e,t){const n=this.rules.inline.autolink.exec(e);if(n){let r,i;return n[2]==="@"?(r=Ue(this.options.mangle?t(n[1]):n[1]),i="mailto:"+r):(r=Ue(n[1]),i=r),{type:"link",raw:n[0],text:r,href:i,tokens:[{type:"text",raw:r,text:r}]}}}url(e,t){let n;if(n=this.rules.inline.url.exec(e)){let r,i;if(n[2]==="@")r=Ue(this.options.mangle?t(n[0]):n[0]),i="mailto:"+r;else{let u;do u=n[0],n[0]=this.rules.inline._backpedal.exec(n[0])[0];while(u!==n[0]);r=Ue(n[0]),n[1]==="www."?i="http://"+n[0]:i=n[0]}return{type:"link",raw:n[0],text:r,href:i,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(e,t){const n=this.rules.inline.text.exec(e);if(n){let r;return this.lexer.state.inRawBlock?r=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(n[0]):Ue(n[0]):n[0]:r=Ue(this.options.smartypants?t(n[0]):n[0]),{type:"text",raw:n[0],text:r}}}}const Y={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:Ar,lheading:/^((?:.|\n(?!\n))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};Y._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;Y._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;Y.def=pe(Y.def).replace("label",Y._label).replace("title",Y._title).getRegex();Y.bullet=/(?:[*+-]|\d{1,9}[.)])/;Y.listItemStart=pe(/^( *)(bull) */).replace("bull",Y.bullet).getRegex();Y.list=pe(Y.list).replace(/bull/g,Y.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+Y.def.source+")").getRegex();Y._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";Y._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;Y.html=pe(Y.html,"i").replace("comment",Y._comment).replace("tag",Y._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();Y.paragraph=pe(Y._paragraph).replace("hr",Y.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Y._tag).getRegex();Y.blockquote=pe(Y.blockquote).replace("paragraph",Y.paragraph).getRegex();Y.normal={...Y};Y.gfm={...Y.normal,table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"};Y.gfm.table=pe(Y.gfm.table).replace("hr",Y.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Y._tag).getRegex();Y.gfm.paragraph=pe(Y._paragraph).replace("hr",Y.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",Y.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Y._tag).getRegex();Y.pedantic={...Y.normal,html:pe(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Y._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Ar,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:pe(Y.normal._paragraph).replace("hr",Y.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Y.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()};const q={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:Ar,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^(?:[^_*\\]|\\.)*?\_\_(?:[^_*\\]|\\.)*?\*(?:[^_*\\]|\\.)*?(?=\_\_)|(?:[^*\\]|\\.)+(?=[^*])|[punct_](\*+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|(?:[^punct*_\s\\]|\\.)(\*+)(?=[^punct*_\s])/,rDelimUnd:/^(?:[^_*\\]|\\.)*?\*\*(?:[^_*\\]|\\.)*?\_(?:[^_*\\]|\\.)*?(?=\*\*)|(?:[^_\\]|\\.)+(?=[^_])|[punct*](\_+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:Ar,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};q._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~";q.punctuation=pe(q.punctuation).replace(/punctuation/g,q._punctuation).getRegex();q.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;q.escapedEmSt=/(?:^|[^\\])(?:\\\\)*\\[*_]/g;q._comment=pe(Y._comment).replace("(?:-->|$)","-->").getRegex();q.emStrong.lDelim=pe(q.emStrong.lDelim).replace(/punct/g,q._punctuation).getRegex();q.emStrong.rDelimAst=pe(q.emStrong.rDelimAst,"g").replace(/punct/g,q._punctuation).getRegex();q.emStrong.rDelimUnd=pe(q.emStrong.rDelimUnd,"g").replace(/punct/g,q._punctuation).getRegex();q._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;q._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;q._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;q.autolink=pe(q.autolink).replace("scheme",q._scheme).replace("email",q._email).getRegex();q._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;q.tag=pe(q.tag).replace("comment",q._comment).replace("attribute",q._attribute).getRegex();q._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;q._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;q._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;q.link=pe(q.link).replace("label",q._label).replace("href",q._href).replace("title",q._title).getRegex();q.reflink=pe(q.reflink).replace("label",q._label).replace("ref",Y._label).getRegex();q.nolink=pe(q.nolink).replace("ref",Y._label).getRegex();q.reflinkSearch=pe(q.reflinkSearch,"g").replace("reflink",q.reflink).replace("nolink",q.nolink).getRegex();q.normal={...q};q.pedantic={...q.normal,strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:pe(/^!?\[(label)\]\((.*?)\)/).replace("label",q._label).getRegex(),reflink:pe(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",q._label).getRegex()};q.gfm={...q.normal,escape:pe(q.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/};q.gfm.url=pe(q.gfm.url,"i").replace("email",q.gfm._extended_email).getRegex();q.breaks={...q.gfm,br:pe(q.br).replace("{2,}","*").getRegex(),text:pe(q.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()};function Vh(s){return s.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…")}function zi(s){let e="",t,n;const r=s.length;for(t=0;t<r;t++)n=s.charCodeAt(t),Math.random()>.5&&(n="x"+n.toString(16)),e+="&#"+n+";";return e}class St{constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||on,this.options.tokenizer=this.options.tokenizer||new Fs,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:Y.normal,inline:q.normal};this.options.pedantic?(t.block=Y.pedantic,t.inline=q.pedantic):this.options.gfm&&(t.block=Y.gfm,this.options.breaks?t.inline=q.breaks:t.inline=q.gfm),this.tokenizer.rules=t}static get rules(){return{block:Y,inline:q}}static lex(e,t){return new St(t).lex(e)}static lexInline(e,t){return new St(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);let t;for(;t=this.inlineQueue.shift();)this.inlineTokens(t.src,t.tokens);return this.tokens}blockTokens(e,t=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(a,o,l)=>o+"    ".repeat(l.length));let n,r,i,u;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(a=>(n=a.call({lexer:this},e,t))?(e=e.substring(n.raw.length),t.push(n),!0):!1))){if(n=this.tokenizer.space(e)){e=e.substring(n.raw.length),n.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(n);continue}if(n=this.tokenizer.code(e)){e=e.substring(n.raw.length),r=t[t.length-1],r&&(r.type==="paragraph"||r.type==="text")?(r.raw+=`
`+n.raw,r.text+=`
`+n.text,this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(n);continue}if(n=this.tokenizer.fences(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.heading(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.hr(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.blockquote(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.list(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.html(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.def(e)){e=e.substring(n.raw.length),r=t[t.length-1],r&&(r.type==="paragraph"||r.type==="text")?(r.raw+=`
`+n.raw,r.text+=`
`+n.raw,this.inlineQueue[this.inlineQueue.length-1].src=r.text):this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title});continue}if(n=this.tokenizer.table(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.lheading(e)){e=e.substring(n.raw.length),t.push(n);continue}if(i=e,this.options.extensions&&this.options.extensions.startBlock){let a=1/0;const o=e.slice(1);let l;this.options.extensions.startBlock.forEach(function(c){l=c.call({lexer:this},o),typeof l=="number"&&l>=0&&(a=Math.min(a,l))}),a<1/0&&a>=0&&(i=e.substring(0,a+1))}if(this.state.top&&(n=this.tokenizer.paragraph(i))){r=t[t.length-1],u&&r.type==="paragraph"?(r.raw+=`
`+n.raw,r.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(n),u=i.length!==e.length,e=e.substring(n.raw.length);continue}if(n=this.tokenizer.text(e)){e=e.substring(n.raw.length),r=t[t.length-1],r&&r.type==="text"?(r.raw+=`
`+n.raw,r.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(n);continue}if(e){const a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n,r,i,u=e,a,o,l;if(this.tokens.links){const c=Object.keys(this.tokens.links);if(c.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(u))!=null;)c.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(u=u.slice(0,a.index)+"["+ji("a",a[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.blockSkip.exec(u))!=null;)u=u.slice(0,a.index)+"["+ji("a",a[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(a=this.tokenizer.rules.inline.escapedEmSt.exec(u))!=null;)u=u.slice(0,a.index+a[0].length-2)+"++"+u.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex),this.tokenizer.rules.inline.escapedEmSt.lastIndex--;for(;e;)if(o||(l=""),o=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(c=>(n=c.call({lexer:this},e,t))?(e=e.substring(n.raw.length),t.push(n),!0):!1))){if(n=this.tokenizer.escape(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.tag(e)){e=e.substring(n.raw.length),r=t[t.length-1],r&&n.type==="text"&&r.type==="text"?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if(n=this.tokenizer.link(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(n.raw.length),r=t[t.length-1],r&&n.type==="text"&&r.type==="text"?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if(n=this.tokenizer.emStrong(e,u,l)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.codespan(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.br(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.del(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.autolink(e,zi)){e=e.substring(n.raw.length),t.push(n);continue}if(!this.state.inLink&&(n=this.tokenizer.url(e,zi))){e=e.substring(n.raw.length),t.push(n);continue}if(i=e,this.options.extensions&&this.options.extensions.startInline){let c=1/0;const f=e.slice(1);let h;this.options.extensions.startInline.forEach(function(d){h=d.call({lexer:this},f),typeof h=="number"&&h>=0&&(c=Math.min(c,h))}),c<1/0&&c>=0&&(i=e.substring(0,c+1))}if(n=this.tokenizer.inlineText(i,Vh)){e=e.substring(n.raw.length),n.raw.slice(-1)!=="_"&&(l=n.raw.slice(-1)),o=!0,r=t[t.length-1],r&&r.type==="text"?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if(e){const c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return t}}class Bs{constructor(e){this.options=e||on}code(e,t,n){const r=(t||"").match(/\S*/)[0];if(this.options.highlight){const i=this.options.highlight(e,r);i!=null&&i!==e&&(n=!0,e=i)}return e=e.replace(/\n$/,"")+`
`,r?'<pre><code class="'+this.options.langPrefix+Ue(r)+'">'+(n?e:Ue(e,!0))+`</code></pre>
`:"<pre><code>"+(n?e:Ue(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e){return e}heading(e,t,n,r){if(this.options.headerIds){const i=this.options.headerPrefix+r.slug(n);return`<h${t} id="${i}">${e}</h${t}>
`}return`<h${t}>${e}</h${t}>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(e,t,n){const r=t?"ol":"ul",i=t&&n!==1?' start="'+n+'"':"";return"<"+r+i+`>
`+e+"</"+r+`>
`}listitem(e){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(e){return`<p>${e}</p>
`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+t+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,t){const n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(e){return`<del>${e}</del>`}link(e,t,n){if(e=$i(this.options.sanitize,this.options.baseUrl,e),e===null)return n;let r='<a href="'+e+'"';return t&&(r+=' title="'+t+'"'),r+=">"+n+"</a>",r}image(e,t,n){if(e=$i(this.options.sanitize,this.options.baseUrl,e),e===null)return n;let r=`<img src="${e}" alt="${n}"`;return t&&(r+=` title="${t}"`),r+=this.options.xhtml?"/>":">",r}text(e){return e}}class ca{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,n){return""+n}image(e,t,n){return""+n}br(){return""}}class Ss{constructor(){this.seen={}}serialize(e){return e.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(e,t){let n=e,r=0;if(this.seen.hasOwnProperty(n)){r=this.seen[e];do r++,n=e+"-"+r;while(this.seen.hasOwnProperty(n))}return t||(this.seen[e]=r,this.seen[n]=0),n}slug(e,t={}){const n=this.serialize(e);return this.getNextSafeSlug(n,t.dryrun)}}class jt{constructor(e){this.options=e||on,this.options.renderer=this.options.renderer||new Bs,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new ca,this.slugger=new Ss}static parse(e,t){return new jt(t).parse(e)}static parseInline(e,t){return new jt(t).parseInline(e)}parse(e,t=!0){let n="",r,i,u,a,o,l,c,f,h,d,p,g,C,b,A,E,B,k,F;const T=e.length;for(r=0;r<T;r++){if(d=e[r],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[d.type]&&(F=this.options.extensions.renderers[d.type].call({parser:this},d),F!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(d.type))){n+=F||"";continue}switch(d.type){case"space":continue;case"hr":{n+=this.renderer.hr();continue}case"heading":{n+=this.renderer.heading(this.parseInline(d.tokens),d.depth,la(this.parseInline(d.tokens,this.textRenderer)),this.slugger);continue}case"code":{n+=this.renderer.code(d.text,d.lang,d.escaped);continue}case"table":{for(f="",c="",a=d.header.length,i=0;i<a;i++)c+=this.renderer.tablecell(this.parseInline(d.header[i].tokens),{header:!0,align:d.align[i]});for(f+=this.renderer.tablerow(c),h="",a=d.rows.length,i=0;i<a;i++){for(l=d.rows[i],c="",o=l.length,u=0;u<o;u++)c+=this.renderer.tablecell(this.parseInline(l[u].tokens),{header:!1,align:d.align[u]});h+=this.renderer.tablerow(c)}n+=this.renderer.table(f,h);continue}case"blockquote":{h=this.parse(d.tokens),n+=this.renderer.blockquote(h);continue}case"list":{for(p=d.ordered,g=d.start,C=d.loose,a=d.items.length,h="",i=0;i<a;i++)A=d.items[i],E=A.checked,B=A.task,b="",A.task&&(k=this.renderer.checkbox(E),C?A.tokens.length>0&&A.tokens[0].type==="paragraph"?(A.tokens[0].text=k+" "+A.tokens[0].text,A.tokens[0].tokens&&A.tokens[0].tokens.length>0&&A.tokens[0].tokens[0].type==="text"&&(A.tokens[0].tokens[0].text=k+" "+A.tokens[0].tokens[0].text)):A.tokens.unshift({type:"text",text:k}):b+=k),b+=this.parse(A.tokens,C),h+=this.renderer.listitem(b,B,E);n+=this.renderer.list(h,p,g);continue}case"html":{n+=this.renderer.html(d.text);continue}case"paragraph":{n+=this.renderer.paragraph(this.parseInline(d.tokens));continue}case"text":{for(h=d.tokens?this.parseInline(d.tokens):d.text;r+1<T&&e[r+1].type==="text";)d=e[++r],h+=`
`+(d.tokens?this.parseInline(d.tokens):d.text);n+=t?this.renderer.paragraph(h):h;continue}default:{const P='Token with "'+d.type+'" type was not found.';if(this.options.silent){console.error(P);return}else throw new Error(P)}}}return n}parseInline(e,t){t=t||this.renderer;let n="",r,i,u;const a=e.length;for(r=0;r<a;r++){if(i=e[r],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[i.type]&&(u=this.options.extensions.renderers[i.type].call({parser:this},i),u!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type))){n+=u||"";continue}switch(i.type){case"escape":{n+=t.text(i.text);break}case"html":{n+=t.html(i.text);break}case"link":{n+=t.link(i.href,i.title,this.parseInline(i.tokens,t));break}case"image":{n+=t.image(i.href,i.title,i.text);break}case"strong":{n+=t.strong(this.parseInline(i.tokens,t));break}case"em":{n+=t.em(this.parseInline(i.tokens,t));break}case"codespan":{n+=t.codespan(i.text);break}case"br":{n+=t.br();break}case"del":{n+=t.del(this.parseInline(i.tokens,t));break}case"text":{n+=t.text(i.text);break}default:{const o='Token with "'+i.type+'" type was not found.';if(this.options.silent){console.error(o);return}else throw new Error(o)}}}return n}}class Er{constructor(e){this.options=e||on}preprocess(e){return e}postprocess(e){return e}}xs(Er,"passThroughHooks",new Set(["preprocess","postprocess"]));function Qh(s,e,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,s){const r="<p>An error occurred:</p><pre>"+Ue(n.message+"",!0)+"</pre>";if(e)return Promise.resolve(r);if(t){t(null,r);return}return r}if(e)return Promise.reject(n);if(t){t(n);return}throw n}}function fa(s,e){return(t,n,r)=>{typeof n=="function"&&(r=n,n=null);const i={...n};n={...ee.defaults,...i};const u=Qh(n.silent,n.async,r);if(typeof t>"u"||t===null)return u(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return u(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(Wh(n),n.hooks&&(n.hooks.options=n),r){const a=n.highlight;let o;try{n.hooks&&(t=n.hooks.preprocess(t)),o=s(t,n)}catch(f){return u(f)}const l=function(f){let h;if(!f)try{n.walkTokens&&ee.walkTokens(o,n.walkTokens),h=e(o,n),n.hooks&&(h=n.hooks.postprocess(h))}catch(d){f=d}return n.highlight=a,f?u(f):r(null,h)};if(!a||a.length<3||(delete n.highlight,!o.length))return l();let c=0;ee.walkTokens(o,function(f){f.type==="code"&&(c++,setTimeout(()=>{a(f.text,f.lang,function(h,d){if(h)return l(h);d!=null&&d!==f.text&&(f.text=d,f.escaped=!0),c--,c===0&&l()})},0))}),c===0&&l();return}if(n.async)return Promise.resolve(n.hooks?n.hooks.preprocess(t):t).then(a=>s(a,n)).then(a=>n.walkTokens?Promise.all(ee.walkTokens(a,n.walkTokens)).then(()=>a):a).then(a=>e(a,n)).then(a=>n.hooks?n.hooks.postprocess(a):a).catch(u);try{n.hooks&&(t=n.hooks.preprocess(t));const a=s(t,n);n.walkTokens&&ee.walkTokens(a,n.walkTokens);let o=e(a,n);return n.hooks&&(o=n.hooks.postprocess(o)),o}catch(a){return u(a)}}}function ee(s,e,t){return fa(St.lex,jt.parse)(s,e,t)}ee.options=ee.setOptions=function(s){return ee.defaults={...ee.defaults,...s},Ph(ee.defaults),ee};ee.getDefaults=ua;ee.defaults=on;ee.use=function(...s){const e=ee.defaults.extensions||{renderers:{},childTokens:{}};s.forEach(t=>{const n={...t};if(n.async=ee.defaults.async||n.async||!1,t.extensions&&(t.extensions.forEach(r=>{if(!r.name)throw new Error("extension name required");if(r.renderer){const i=e.renderers[r.name];i?e.renderers[r.name]=function(...u){let a=r.renderer.apply(this,u);return a===!1&&(a=i.apply(this,u)),a}:e.renderers[r.name]=r.renderer}if(r.tokenizer){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");e[r.level]?e[r.level].unshift(r.tokenizer):e[r.level]=[r.tokenizer],r.start&&(r.level==="block"?e.startBlock?e.startBlock.push(r.start):e.startBlock=[r.start]:r.level==="inline"&&(e.startInline?e.startInline.push(r.start):e.startInline=[r.start]))}r.childTokens&&(e.childTokens[r.name]=r.childTokens)}),n.extensions=e),t.renderer){const r=ee.defaults.renderer||new Bs;for(const i in t.renderer){const u=r[i];r[i]=(...a)=>{let o=t.renderer[i].apply(r,a);return o===!1&&(o=u.apply(r,a)),o}}n.renderer=r}if(t.tokenizer){const r=ee.defaults.tokenizer||new Fs;for(const i in t.tokenizer){const u=r[i];r[i]=(...a)=>{let o=t.tokenizer[i].apply(r,a);return o===!1&&(o=u.apply(r,a)),o}}n.tokenizer=r}if(t.hooks){const r=ee.defaults.hooks||new Er;for(const i in t.hooks){const u=r[i];Er.passThroughHooks.has(i)?r[i]=a=>{if(ee.defaults.async)return Promise.resolve(t.hooks[i].call(r,a)).then(l=>u.call(r,l));const o=t.hooks[i].call(r,a);return u.call(r,o)}:r[i]=(...a)=>{let o=t.hooks[i].apply(r,a);return o===!1&&(o=u.apply(r,a)),o}}n.hooks=r}if(t.walkTokens){const r=ee.defaults.walkTokens;n.walkTokens=function(i){let u=[];return u.push(t.walkTokens.call(this,i)),r&&(u=u.concat(r.call(this,i))),u}}ee.setOptions(n)})};ee.walkTokens=function(s,e){let t=[];for(const n of s)switch(t=t.concat(e.call(ee,n)),n.type){case"table":{for(const r of n.header)t=t.concat(ee.walkTokens(r.tokens,e));for(const r of n.rows)for(const i of r)t=t.concat(ee.walkTokens(i.tokens,e));break}case"list":{t=t.concat(ee.walkTokens(n.items,e));break}default:ee.defaults.extensions&&ee.defaults.extensions.childTokens&&ee.defaults.extensions.childTokens[n.type]?ee.defaults.extensions.childTokens[n.type].forEach(function(r){t=t.concat(ee.walkTokens(n[r],e))}):n.tokens&&(t=t.concat(ee.walkTokens(n.tokens,e)))}return t};ee.parseInline=fa(St.lexInline,jt.parseInline);ee.Parser=jt;ee.parser=jt.parse;ee.Renderer=Bs;ee.TextRenderer=ca;ee.Lexer=St;ee.lexer=St.lex;ee.Tokenizer=Fs;ee.Slugger=Ss;ee.Hooks=Er;ee.parse=ee;ee.options;ee.setOptions;ee.use;ee.walkTokens;ee.parseInline;jt.parse;St.lex;const ha={};function Gh(s){let e;return{c(){e=L(s[1])},m(t,n){w(t,e,n)},p(t,n){n&2&&re(e,t[1])},i:N,o:N,d(t){t&&_(e)}}}function Yh(s){let e,t;const n=s[5].default,r=Ae(n,s,s[4],null);return{c(){e=D("h6"),r&&r.c(),y(e,"id",s[2])},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&16)&&Ee(r,n,i,i[4],t?ke(n,i[4],u,null):ve(i[4]),null),(!t||u&4)&&y(e,"id",i[2])},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function Jh(s){let e,t;const n=s[5].default,r=Ae(n,s,s[4],null);return{c(){e=D("h5"),r&&r.c(),y(e,"id",s[2])},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&16)&&Ee(r,n,i,i[4],t?ke(n,i[4],u,null):ve(i[4]),null),(!t||u&4)&&y(e,"id",i[2])},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function Zh(s){let e,t;const n=s[5].default,r=Ae(n,s,s[4],null);return{c(){e=D("h4"),r&&r.c(),y(e,"id",s[2])},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&16)&&Ee(r,n,i,i[4],t?ke(n,i[4],u,null):ve(i[4]),null),(!t||u&4)&&y(e,"id",i[2])},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function Xh(s){let e,t;const n=s[5].default,r=Ae(n,s,s[4],null);return{c(){e=D("h3"),r&&r.c(),y(e,"id",s[2])},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&16)&&Ee(r,n,i,i[4],t?ke(n,i[4],u,null):ve(i[4]),null),(!t||u&4)&&y(e,"id",i[2])},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function ed(s){let e,t;const n=s[5].default,r=Ae(n,s,s[4],null);return{c(){e=D("h2"),r&&r.c(),y(e,"id",s[2])},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&16)&&Ee(r,n,i,i[4],t?ke(n,i[4],u,null):ve(i[4]),null),(!t||u&4)&&y(e,"id",i[2])},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function td(s){let e,t;const n=s[5].default,r=Ae(n,s,s[4],null);return{c(){e=D("h1"),r&&r.c(),y(e,"id",s[2])},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&16)&&Ee(r,n,i,i[4],t?ke(n,i[4],u,null):ve(i[4]),null),(!t||u&4)&&y(e,"id",i[2])},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function nd(s){let e,t,n,r;const i=[td,ed,Xh,Zh,Jh,Yh,Gh],u=[];function a(o,l){return o[0]===1?0:o[0]===2?1:o[0]===3?2:o[0]===4?3:o[0]===5?4:o[0]===6?5:6}return e=a(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),w(o,n,l),r=!0},p(o,[l]){let c=e;e=a(o),e===c?u[e].p(o,l):(V(),S(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=i[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){S(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function rd(s,e,t){let n,{$$slots:r={},$$scope:i}=e,{depth:u}=e,{raw:a}=e,{text:o}=e;const{slug:l,getOptions:c}=za(ha),f=c();return s.$$set=h=>{"depth"in h&&t(0,u=h.depth),"raw"in h&&t(1,a=h.raw),"text"in h&&t(3,o=h.text),"$$scope"in h&&t(4,i=h.$$scope)},s.$$.update=()=>{s.$$.dirty&8&&t(2,n=f.headerIds?f.headerPrefix+l(o):void 0)},[u,a,n,o,i,r]}class sd extends Z{constructor(e){super(),X(this,e,rd,nd,J,{depth:0,raw:1,text:3})}}function id(s){let e,t;const n=s[1].default,r=Ae(n,s,s[0],null);return{c(){e=D("p"),r&&r.c()},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,i,i[0],t?ke(n,i[0],u,null):ve(i[0]),null)},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function ud(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class od extends Z{constructor(e){super(),X(this,e,ud,id,J,{})}}function ad(s){let e;const t=s[3].default,n=Ae(t,s,s[2],null);return{c(){n&&n.c()},m(r,i){n&&n.m(r,i),e=!0},p(r,[i]){n&&n.p&&(!e||i&4)&&Ee(n,t,r,r[2],e?ke(t,r[2],i,null):ve(r[2]),null)},i(r){e||(v(n,r),e=!0)},o(r){S(n,r),e=!1},d(r){n&&n.d(r)}}}function ld(s,e,t){let{$$slots:n={},$$scope:r}=e,{text:i}=e,{raw:u}=e;return s.$$set=a=>{"text"in a&&t(0,i=a.text),"raw"in a&&t(1,u=a.raw),"$$scope"in a&&t(2,r=a.$$scope)},[i,u,r,n]}class cd extends Z{constructor(e){super(),X(this,e,ld,ad,J,{text:0,raw:1})}}function fd(s){let e,t;return{c(){e=D("img"),Oe(e.src,t=s[0])||y(e,"src",t),y(e,"title",s[1]),y(e,"alt",s[2])},m(n,r){w(n,e,r)},p(n,[r]){r&1&&!Oe(e.src,t=n[0])&&y(e,"src",t),r&2&&y(e,"title",n[1]),r&4&&y(e,"alt",n[2])},i:N,o:N,d(n){n&&_(e)}}}function hd(s,e,t){let{href:n=""}=e,{title:r=void 0}=e,{text:i=""}=e;return s.$$set=u=>{"href"in u&&t(0,n=u.href),"title"in u&&t(1,r=u.title),"text"in u&&t(2,i=u.text)},[n,r,i]}class dd extends Z{constructor(e){super(),X(this,e,hd,fd,J,{href:0,title:1,text:2})}}function pd(s){let e,t;const n=s[3].default,r=Ae(n,s,s[2],null);return{c(){e=D("a"),r&&r.c(),y(e,"href",s[0]),y(e,"title",s[1])},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&4)&&Ee(r,n,i,i[2],t?ke(n,i[2],u,null):ve(i[2]),null),(!t||u&1)&&y(e,"href",i[0]),(!t||u&2)&&y(e,"title",i[1])},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function md(s,e,t){let{$$slots:n={},$$scope:r}=e,{href:i=""}=e,{title:u=void 0}=e;return s.$$set=a=>{"href"in a&&t(0,i=a.href),"title"in a&&t(1,u=a.title),"$$scope"in a&&t(2,r=a.$$scope)},[i,u,r,n]}class gd extends Z{constructor(e){super(),X(this,e,md,pd,J,{href:0,title:1})}}function Dd(s){let e,t;const n=s[1].default,r=Ae(n,s,s[0],null);return{c(){e=D("em"),r&&r.c()},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,i,i[0],t?ke(n,i[0],u,null):ve(i[0]),null)},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function bd(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class wd extends Z{constructor(e){super(),X(this,e,bd,Dd,J,{})}}function _d(s){let e,t;const n=s[1].default,r=Ae(n,s,s[0],null);return{c(){e=D("del"),r&&r.c()},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,i,i[0],t?ke(n,i[0],u,null):ve(i[0]),null)},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function yd(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class Cd extends Z{constructor(e){super(),X(this,e,yd,_d,J,{})}}function Ad(s){let e,t=s[0].replace(/`/g,"")+"",n;return{c(){e=D("code"),n=L(t)},m(r,i){w(r,e,i),m(e,n)},p(r,[i]){i&1&&t!==(t=r[0].replace(/`/g,"")+"")&&re(n,t)},i:N,o:N,d(r){r&&_(e)}}}function Ed(s,e,t){let{raw:n}=e;return s.$$set=r=>{"raw"in r&&t(0,n=r.raw)},[n]}class vd extends Z{constructor(e){super(),X(this,e,Ed,Ad,J,{raw:0})}}function kd(s){let e,t;const n=s[1].default,r=Ae(n,s,s[0],null);return{c(){e=D("strong"),r&&r.c()},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,i,i[0],t?ke(n,i[0],u,null):ve(i[0]),null)},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function Fd(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class Bd extends Z{constructor(e){super(),X(this,e,Fd,kd,J,{})}}function Sd(s){let e,t;const n=s[1].default,r=Ae(n,s,s[0],null);return{c(){e=D("table"),r&&r.c()},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,i,i[0],t?ke(n,i[0],u,null):ve(i[0]),null)},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function Td(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class Id extends Z{constructor(e){super(),X(this,e,Td,Sd,J,{})}}function Pd(s){let e,t;const n=s[1].default,r=Ae(n,s,s[0],null);return{c(){e=D("thead"),r&&r.c()},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,i,i[0],t?ke(n,i[0],u,null):ve(i[0]),null)},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function Rd(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class Od extends Z{constructor(e){super(),X(this,e,Rd,Pd,J,{})}}function xd(s){let e,t;const n=s[1].default,r=Ae(n,s,s[0],null);return{c(){e=D("tbody"),r&&r.c()},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,i,i[0],t?ke(n,i[0],u,null):ve(i[0]),null)},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function Md(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class Nd extends Z{constructor(e){super(),X(this,e,Md,xd,J,{})}}function $d(s){let e,t;const n=s[1].default,r=Ae(n,s,s[0],null);return{c(){e=D("tr"),r&&r.c()},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,i,i[0],t?ke(n,i[0],u,null):ve(i[0]),null)},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function Ld(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class jd extends Z{constructor(e){super(),X(this,e,Ld,$d,J,{})}}function Ud(s){let e,t;const n=s[3].default,r=Ae(n,s,s[2],null);return{c(){e=D("td"),r&&r.c(),y(e,"align",s[1])},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&4)&&Ee(r,n,i,i[2],t?ke(n,i[2],u,null):ve(i[2]),null),(!t||u&2)&&y(e,"align",i[1])},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function zd(s){let e,t;const n=s[3].default,r=Ae(n,s,s[2],null);return{c(){e=D("th"),r&&r.c(),y(e,"align",s[1])},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&4)&&Ee(r,n,i,i[2],t?ke(n,i[2],u,null):ve(i[2]),null),(!t||u&2)&&y(e,"align",i[1])},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function Hd(s){let e,t,n,r;const i=[zd,Ud],u=[];function a(o,l){return o[0]?0:1}return e=a(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),w(o,n,l),r=!0},p(o,[l]){let c=e;e=a(o),e===c?u[e].p(o,l):(V(),S(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=i[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){S(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function qd(s,e,t){let{$$slots:n={},$$scope:r}=e,{header:i}=e,{align:u}=e;return s.$$set=a=>{"header"in a&&t(0,i=a.header),"align"in a&&t(1,u=a.align),"$$scope"in a&&t(2,r=a.$$scope)},[i,u,r,n]}class Wd extends Z{constructor(e){super(),X(this,e,qd,Hd,J,{header:0,align:1})}}function Kd(s){let e,t;const n=s[3].default,r=Ae(n,s,s[2],null);return{c(){e=D("ul"),r&&r.c()},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&4)&&Ee(r,n,i,i[2],t?ke(n,i[2],u,null):ve(i[2]),null)},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function Vd(s){let e,t;const n=s[3].default,r=Ae(n,s,s[2],null);return{c(){e=D("ol"),r&&r.c(),y(e,"start",s[1])},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,u){r&&r.p&&(!t||u&4)&&Ee(r,n,i,i[2],t?ke(n,i[2],u,null):ve(i[2]),null),(!t||u&2)&&y(e,"start",i[1])},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function Qd(s){let e,t,n,r;const i=[Vd,Kd],u=[];function a(o,l){return o[0]?0:1}return e=a(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),w(o,n,l),r=!0},p(o,[l]){let c=e;e=a(o),e===c?u[e].p(o,l):(V(),S(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=i[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){S(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function Gd(s,e,t){let{$$slots:n={},$$scope:r}=e,{ordered:i}=e,{start:u}=e;return s.$$set=a=>{"ordered"in a&&t(0,i=a.ordered),"start"in a&&t(1,u=a.start),"$$scope"in a&&t(2,r=a.$$scope)},[i,u,r,n]}class Yd extends Z{constructor(e){super(),X(this,e,Gd,Qd,J,{ordered:0,start:1})}}function Jd(s){let e,t;const n=s[1].default,r=Ae(n,s,s[0],null);return{c(){e=D("li"),r&&r.c()},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,i,i[0],t?ke(n,i[0],u,null):ve(i[0]),null)},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function Zd(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class Xd extends Z{constructor(e){super(),X(this,e,Zd,Jd,J,{})}}function e0(s){let e;return{c(){e=D("hr")},m(t,n){w(t,e,n)},p:N,i:N,o:N,d(t){t&&_(e)}}}class t0 extends Z{constructor(e){super(),X(this,e,null,e0,J,{})}}function n0(s){let e,t;return{c(){e=new so(!1),t=ie(),e.a=t},m(n,r){e.m(s[0],n,r),w(n,t,r)},p(n,[r]){r&1&&e.p(n[0])},i:N,o:N,d(n){n&&_(t),n&&e.d()}}}function r0(s,e,t){let{text:n}=e;return s.$$set=r=>{"text"in r&&t(0,n=r.text)},[n]}class s0 extends Z{constructor(e){super(),X(this,e,r0,n0,J,{text:0})}}function i0(s){let e,t;const n=s[1].default,r=Ae(n,s,s[0],null);return{c(){e=D("blockquote"),r&&r.c()},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,i,i[0],t?ke(n,i[0],u,null):ve(i[0]),null)},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function u0(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class o0 extends Z{constructor(e){super(),X(this,e,u0,i0,J,{})}}function a0(s){let e,t,n;return{c(){e=D("pre"),t=D("code"),n=L(s[1]),y(e,"class",s[0])},m(r,i){w(r,e,i),m(e,t),m(t,n)},p(r,[i]){i&2&&re(n,r[1]),i&1&&y(e,"class",r[0])},i:N,o:N,d(r){r&&_(e)}}}function l0(s,e,t){let{lang:n}=e,{text:r}=e;return s.$$set=i=>{"lang"in i&&t(0,n=i.lang),"text"in i&&t(1,r=i.text)},[n,r]}class c0 extends Z{constructor(e){super(),X(this,e,l0,a0,J,{lang:0,text:1})}}function f0(s){let e,t;const n=s[1].default,r=Ae(n,s,s[0],null);return{c(){e=D("br"),r&&r.c()},m(i,u){w(i,e,u),r&&r.m(i,u),t=!0},p(i,[u]){r&&r.p&&(!t||u&1)&&Ee(r,n,i,i[0],t?ke(n,i[0],u,null):ve(i[0]),null)},i(i){t||(v(r,i),t=!0)},o(i){S(r,i),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function h0(s,e,t){let{$$slots:n={},$$scope:r}=e;return s.$$set=i=>{"$$scope"in i&&t(0,r=i.$$scope)},[r,n]}class d0 extends Z{constructor(e){super(),X(this,e,h0,f0,J,{})}}const p0={heading:sd,paragraph:od,text:cd,image:dd,link:gd,em:wd,strong:Bd,codespan:vd,del:Cd,table:Id,tablehead:Od,tablebody:Nd,tablerow:jd,tablecell:Wd,list:Yd,orderedlistitem:null,unorderedlistitem:null,listitem:Xd,hr:t0,html:s0,blockquote:o0,code:c0,br:d0},m0={baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,xhtml:!1};function g0(s){let e,t;return e=new un({props:{tokens:s[0],renderers:s[1]}}),{c(){U(e.$$.fragment)},m(n,r){z(e,n,r),t=!0},p(n,[r]){const i={};r&1&&(i.tokens=n[0]),r&2&&(i.renderers=n[1]),e.$set(i)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function D0(s,e,t){let n,r,i,u,{source:a=[]}=e,{renderers:o={}}=e,{options:l={}}=e,{isInline:c=!1}=e;const f=rt();let h,d,p;return Ha(ha,{slug:g=>r?r.slug(g):"",getOptions:()=>i}),pt(()=>{t(7,p=!0)}),s.$$set=g=>{"source"in g&&t(2,a=g.source),"renderers"in g&&t(3,o=g.renderers),"options"in g&&t(4,l=g.options),"isInline"in g&&t(5,c=g.isInline)},s.$$.update=()=>{s.$$.dirty&4&&t(8,n=Array.isArray(a)),s.$$.dirty&4&&(r=a?new Ss:void 0),s.$$.dirty&16&&t(9,i={...m0,...l}),s.$$.dirty&869&&(n?t(0,h=a):(t(6,d=new St(i)),t(0,h=c?d.inlineTokens(a):d.lex(a)),f("parsed",{tokens:h}))),s.$$.dirty&8&&t(1,u={...p0,...o}),s.$$.dirty&385&&p&&!n&&f("parsed",{tokens:h})},[h,u,a,o,l,c,d,p,n,i]}class b0 extends Z{constructor(e){super(),X(this,e,D0,g0,J,{source:2,renderers:3,options:4,isInline:5})}}function w0(s){let e,t,n,r={ctx:s,current:null,token:null,hasCatch:!1,pending:O0,then:y0,catch:_0,value:13,blocks:[,,,]};return Ns(t=s[2],r),{c(){e=ie(),r.block.c()},m(i,u){w(i,e,u),r.block.m(i,r.anchor=u),r.mount=()=>e.parentNode,r.anchor=e,n=!0},p(i,u){s=i,r.ctx=s,u&4&&t!==(t=s[2])&&Ns(t,r)||qa(r,s,u)},i(i){n||(v(r.block),n=!0)},o(i){for(let u=0;u<3;u+=1){const a=r.blocks[u];S(a)}n=!1},d(i){i&&_(e),r.block.d(i),r.token=null,r=null}}}function _0(s){return{c:N,m:N,p:N,i:N,o:N,d:N}}function y0(s){let e,t,n,r;const i=[A0,C0],u=[];function a(o,l){return o[4]?1:0}return e=a(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),w(o,n,l),r=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(V(),S(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=i[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){S(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function C0(s){let e,t,n;return{c(){e=D("img"),y(e,"class","dnone svelte-16wmj4w"),Oe(e.src,t=s[13])||y(e,"src",t),y(e,"alt",n=s[0].text)},m(r,i){w(r,e,i)},p(r,i){i&4&&!Oe(e.src,t=r[13])&&y(e,"src",t),i&1&&n!==(n=r[0].text)&&y(e,"alt",n)},i:N,o:N,d(r){r&&_(e)}}}function A0(s){let e,t,n,r,i,u;const a=[S0,B0,F0,k0,v0,E0],o=[];function l(f,h){return f[5]=="image"?0:f[5]=="text"?1:f[5]=="audio"?2:f[5]=="markdown"?3:f[5]=="pdf"?4:5}n=l(s),r=o[n]=a[n](s);let c=s[1]!==void 0&&Hi(s);return{c(){e=D("div"),t=D("div"),r.c(),i=I(),c&&c.c(),y(t,"class","my-12 w-full"),y(e,"class","flex flex-col justify-between h-full")},m(f,h){w(f,e,h),m(e,t),o[n].m(t,null),m(e,i),c&&c.m(e,null),u=!0},p(f,h){let d=n;n=l(f),n===d?o[n].p(f,h):(V(),S(o[d],1,1,()=>{o[d]=null}),Q(),r=o[n],r?r.p(f,h):(r=o[n]=a[n](f),r.c()),v(r,1),r.m(t,null)),f[1]!==void 0?c?c.p(f,h):(c=Hi(f),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i(f){u||(v(r),u=!0)},o(f){S(r),u=!1},d(f){f&&_(e),o[n].d(),c&&c.d()}}}function E0(s){let e;return{c(){e=D("p"),e.textContent="Attachment type not supported"},m(t,n){w(t,e,n)},p:N,i:N,o:N,d(t){t&&_(e)}}}function v0(s){let e;return{c(){e=D("p"),e.textContent="Pdf preview to come"},m(t,n){w(t,e,n)},p:N,i:N,o:N,d(t){t&&_(e)}}}function k0(s){let e,t,n;return t=new b0({props:{source:s[13]}}),{c(){e=D("div"),U(t.$$.fragment),y(e,"class","markdown svelte-16wmj4w")},m(r,i){w(r,e,i),z(t,e,null),n=!0},p(r,i){const u={};i&4&&(u.source=r[13]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function F0(s){let e,t;return{c(){e=D("audio"),y(e,"class","w-full svelte-16wmj4w"),Oe(e.src,t=s[13])||y(e,"src",t),e.controls=!0},m(n,r){w(n,e,r)},p(n,r){r&4&&!Oe(e.src,t=n[13])&&y(e,"src",t)},i:N,o:N,d(n){n&&_(e)}}}function B0(s){let e,t=s[13]+"";return{c(){e=D("p"),y(e,"class","my-6 textbox svelte-16wmj4w")},m(n,r){w(n,e,r),e.innerHTML=t},p(n,r){r&4&&t!==(t=n[13]+"")&&(e.innerHTML=t)},i:N,o:N,d(n){n&&_(e)}}}function S0(s){let e,t,n;return{c(){e=D("img"),Oe(e.src,t=s[13])||y(e,"src",t),y(e,"alt",n=s[0].text),y(e,"class","svelte-16wmj4w")},m(r,i){w(r,e,i)},p(r,i){i&4&&!Oe(e.src,t=r[13])&&y(e,"src",t),i&1&&n!==(n=r[0].text)&&y(e,"alt",n)},i:N,o:N,d(r){r&&_(e)}}}function Hi(s){let e,t,n,r,i,u,a;function o(f,h){return f[3]?T0:I0}let l=o(s),c=l(s);return{c(){e=D("div"),t=D("p"),c.c(),n=I(),r=D("p"),i=D("button"),i.textContent="Download attachment",y(t,"class","mx-4"),y(i,"class","svelte-16wmj4w"),y(r,"class","mx-4"),y(e,"class","flex flex-row mb-4")},m(f,h){w(f,e,h),m(e,t),c.m(t,null),m(e,n),m(e,r),m(r,i),u||(a=j(i,"click",s[9]),u=!0)},p(f,h){l===(l=o(f))&&c?c.p(f,h):(c.d(1),c=l(f),c&&(c.c(),c.m(t,null)))},d(f){f&&_(e),c.d(),u=!1,a()}}}function T0(s){let e,t,n;function r(a,o){return a[4]?P0:R0}let i=r(s),u=i(s);return{c(){e=D("button"),u.c(),y(e,"class","svelte-16wmj4w")},m(a,o){w(a,e,o),u.m(e,null),t||(n=j(e,"click",s[8]),t=!0)},p(a,o){i!==(i=r(a))&&(u.d(1),u=i(a),u&&(u.c(),u.m(e,null)))},d(a){a&&_(e),u.d(),t=!1,n()}}}function I0(s){let e,t,n;return{c(){e=D("button"),e.textContent="Get attachment",y(e,"class","svelte-16wmj4w")},m(r,i){w(r,e,i),t||(n=j(e,"click",function(){ro(s[6](s[0]))&&s[6](s[0]).apply(this,arguments)}),t=!0)},p(r,i){s=r},d(r){r&&_(e),t=!1,n()}}}function P0(s){let e;return{c(){e=L("Show attachment")},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function R0(s){let e;return{c(){e=L("Hide attachment")},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function O0(s){let e;return{c(){e=L("Loading attachment...")},m(t,n){w(t,e,n)},p:N,i:N,o:N,d(t){t&&_(e)}}}function x0(s){let e,t,n=w0(s);return{c(){n&&n.c(),e=ie()},m(r,i){n&&n.m(r,i),w(r,e,i),t=!0},p(r,[i]){n.p(r,i)},i(r){t||(v(n),t=!0)},o(r){S(n),t=!1},d(r){n&&n.d(r),r&&_(e)}}}function M0(s,e,t){let n;Be(s,Tt,C=>t(11,n=C));let{doc:r}=e,i,u,a=!1,o=!0,l,c;async function f(C){const b=await n.replica.getAttachment(C);let A=C.path.split(".").pop();if(b!==void 0){const k=await b.bytes();console.log("docdata",k);let F=new Uint8Array(k.length);for(var E=0;E<k.length;E++)F[E]=k[E];if(A==="md")t(5,l="markdown"),t(5,l),t(1,i=String.fromCharCode(...F));else if(A=="mp3"||A=="ogg"||A=="webm")t(5,l="audio"),c="audio/"+A,t(5,l),c=c,console.log("this is audio"),console.log(l,c),t(1,i=URL.createObjectURL(new Blob([F],{type:c})));else if(A==="txt"){t(5,l="text"),t(5,l),console.log(l);var B=new TextDecoder("utf-8");t(1,i=B.decode(Uint8Array.from(F)))}else A=="png"||A=="gif"||A=="jpeg"?(t(5,l="image"),console.log("this is an image"),console.log("fileExtension "+A),c="image/"+A,t(5,l),c=c,t(1,i=URL.createObjectURL(new Blob([F],{type:c})))):(t(5,l="other"),t(5,l),console.log(l),t(1,i=URL.createObjectURL(new Blob([F],{type:"application/octet-stream"}))));return i}}function h(C){t(2,u=f(C)),t(3,a=!0),t(4,o=!1)}function d(){let C=document.createElement("a");console.log(i+"attachmentBytes"),i.split(":")[0]!=="blob"&&(console.log("attachmentBytes is a string"),t(1,i=URL.createObjectURL(new Blob([i]))),console.log("attachmentBytes is now a blob")),console.log("type of attachmentBytes ",typeof i);let b=i,A=r.path.split("/")[r.path.split("/").length-1];console.log("type of file",typeof b),C.href=b,C.download=A.slice(1),C.style.display="none",document.body.appendChild(C),C.click()}pt(()=>{t(2,u=f(r)),t(3,a=!0),t(4,o=!1)});const p=()=>t(4,o=!o),g=()=>d();return s.$$set=C=>{"doc"in C&&t(0,r=C.doc)},[r,i,u,a,o,l,h,d,p,g]}class da extends Z{constructor(e){super(),X(this,e,M0,x0,J,{doc:0})}}function qi(s,e,t){const n=s.slice();return n[8]=e[t],n}function N0(s){let e;return{c(){e=L("📄Show details")},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function $0(s){let e;return{c(){e=L("📄Hide details")},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function Wi(s){let e,t,n,r=s[1]&&Ki(s);function i(l,c){return l[3]!==void 0?j0:L0}let u=i(s),a=u(s),o=(s[2]||!s[1])&&Gi(s);return{c(){e=D("div"),r&&r.c(),t=I(),a.c(),n=I(),o&&o.c(),y(e,"class","svelte-u8pn0b")},m(l,c){w(l,e,c),r&&r.m(e,null),m(e,t),a.m(e,null),m(e,n),o&&o.m(e,null)},p(l,c){l[1]?r?r.p(l,c):(r=Ki(l),r.c(),r.m(e,t)):r&&(r.d(1),r=null),u===(u=i(l))&&a?a.p(l,c):(a.d(1),a=u(l),a&&(a.c(),a.m(e,n))),l[2]||!l[1]?o?o.p(l,c):(o=Gi(l),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(l){l&&_(e),r&&r.d(),a.d(),o&&o.d()}}}function Ki(s){let e,t,n,r,i,u,a=s[0].path.split(".")[s[0].path.split(".").length-1]+"",o,l,c,f,h,d,p=s[0].attachmentSize/1e3+"",g,C;return{c(){e=D("table"),t=D("tr"),n=D("td"),n.textContent="Attachment type:",r=I(),i=D("td"),u=D("strong"),o=L(a),l=I(),c=D("tr"),f=D("td"),f.textContent="Attachment size:",h=I(),d=D("td"),g=L(p),C=L(" kb"),y(e,"class","my-4 svelte-u8pn0b")},m(b,A){w(b,e,A),m(e,t),m(t,n),m(t,r),m(t,i),m(i,u),m(u,o),m(e,l),m(e,c),m(c,f),m(c,h),m(c,d),m(d,g),m(c,C)},p(b,A){A&1&&a!==(a=b[0].path.split(".")[b[0].path.split(".").length-1]+"")&&re(o,a),A&1&&p!==(p=b[0].attachmentSize/1e3+"")&&re(g,p)},d(b){b&&_(e)}}}function L0(s){let e,t=s[0].text+"";return{c(){e=D("div"),y(e,"class","my-4")},m(n,r){w(n,e,r),e.innerHTML=t},p(n,r){r&1&&t!==(t=n[0].text+"")&&(e.innerHTML=t)},d(n){n&&_(e)}}}function j0(s){let e,t,n,r=s[6]&&Vi(s);return{c(){e=D("div"),t=I(),r&&r.c(),n=ie()},m(i,u){w(i,e,u),e.innerHTML=s[3],w(i,t,u),r&&r.m(i,u),w(i,n,u)},p(i,u){u&8&&(e.innerHTML=i[3]),i[6]?r?r.p(i,u):(r=Vi(i),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},d(i){i&&_(e),i&&_(t),r&&r.d(i),i&&_(n)}}}function Vi(s){let e,t=s[4],n=[];for(let r=0;r<t.length;r+=1)n[r]=Qi(qi(s,t,r));return{c(){e=D("ul");for(let r=0;r<n.length;r+=1)n[r].c();y(e,"class","svelte-u8pn0b")},m(r,i){w(r,e,i);for(let u=0;u<n.length;u+=1)n[u].m(e,null)},p(r,i){if(i&16){t=r[4];let u;for(u=0;u<t.length;u+=1){const a=qi(r,t,u);n[u]?n[u].p(a,i):(n[u]=Qi(a),n[u].c(),n[u].m(e,null))}for(;u<n.length;u+=1)n[u].d(1);n.length=t.length}},d(r){r&&_(e),rn(n,r)}}}function Qi(s){let e,t,n=s[8]+"",r;return{c(){e=D("li"),t=new so(!1),r=I(),t.a=r,y(e,"class","svelte-u8pn0b")},m(i,u){w(i,e,u),t.m(n,e),m(e,r)},p(i,u){u&16&&n!==(n=i[8]+"")&&t.p(n)},d(i){i&&_(e)}}}function Gi(s){let e,t,n,r,i,u=s[0].path+"",a,o,l,c,f,h=s[0].author+"",d,p,g,C,b,A=s[0].share+"",E,B,k,F,T,P=s[0].timestamp/1e3+"",R;return{c(){e=D("div"),t=D("ul"),n=D("li"),r=D("b"),r.textContent="path:",i=I(),a=L(u),o=I(),l=D("li"),c=D("b"),c.textContent="author:",f=I(),d=L(h),p=I(),g=D("li"),C=D("b"),C.textContent="share:",b=I(),E=L(A),B=I(),k=D("li"),F=D("b"),F.textContent="timestamp:",T=I(),R=L(P),y(n,"class","svelte-u8pn0b"),y(l,"class","svelte-u8pn0b"),y(g,"class","svelte-u8pn0b"),y(k,"class","svelte-u8pn0b"),y(t,"class","svelte-u8pn0b"),y(e,"class","svelte-u8pn0b")},m($,W){w($,e,W),m(e,t),m(t,n),m(n,r),m(n,i),m(n,a),m(t,o),m(t,l),m(l,c),m(l,f),m(l,d),m(t,p),m(t,g),m(g,C),m(g,b),m(g,E),m(t,B),m(t,k),m(k,F),m(k,T),m(k,R)},p($,W){W&1&&u!==(u=$[0].path+"")&&re(a,u),W&1&&h!==(h=$[0].author+"")&&re(d,h),W&1&&A!==(A=$[0].share+"")&&re(E,A),W&1&&P!==(P=$[0].timestamp/1e3+"")&&re(R,P)},d($){$&&_(e)}}}function U0(s){let e,t,n,r,i;function u(c,f){return c[5]?$0:N0}let a=u(s),o=a(s),l=s[5]&&Wi(s);return{c(){e=D("div"),t=D("button"),o.c(),n=I(),l&&l.c(),y(e,"class","my-4 svelte-u8pn0b")},m(c,f){w(c,e,f),m(e,t),o.m(t,null),m(e,n),l&&l.m(e,null),r||(i=j(t,"click",s[7]),r=!0)},p(c,[f]){a!==(a=u(c))&&(o.d(1),o=a(c),o&&(o.c(),o.m(t,null))),c[5]?l?l.p(c,f):(l=Wi(c),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i:N,o:N,d(c){c&&_(e),o.d(),l&&l.d(),r=!1,i()}}}function z0(s,e,t){let{doc:n}=e,{attachment:r=!0}=e,{isReply:i=!1}=e,u=!1,a,o,l=!1;pt(()=>{t(5,u=!0)});const c=()=>t(5,u=!u);return s.$$set=f=>{"doc"in f&&t(0,n=f.doc),"attachment"in f&&t(1,r=f.attachment),"isReply"in f&&t(2,i=f.isReply)},s.$$.update=()=>{s.$$.dirty&25&&n.text!==void 0&&n.text.includes("<br>")&&(t(4,o=n.text.split("<br>")),t(3,a=o.shift()),t(3,a),t(0,n),t(4,o),t(6,l=!0))},[n,r,i,a,o,u,l,c]}class pa extends Z{constructor(e){super(),X(this,e,z0,U0,J,{doc:0,attachment:1,isReply:2})}}function Yi(s,e,t){const n=s.slice();return n[1]=e[t],n}function H0(s){let e,t=[],n=new Map,r,i=s[2];const u=a=>a[1].signature;for(let a=0;a<i.length;a+=1){let o=Yi(s,i,a),l=u(o);n.set(l,t[a]=Ji(l,o))}return{c(){e=D("ul");for(let a=0;a<t.length;a+=1)t[a].c();y(e,"class","svelte-197mouz")},m(a,o){w(a,e,o);for(let l=0;l<t.length;l+=1)t[l].m(e,null);r=!0},p(a,o){o&69&&(i=a[2],V(),t=mt(t,o,u,1,a,i,n,e,Gn,Ji,null,Yi),Q())},i(a){if(!r){for(let o=0;o<i.length;o+=1)v(t[o]);r=!0}},o(a){for(let o=0;o<t.length;o+=1)S(t[o]);r=!1},d(a){a&&_(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function q0(s){let e=s[5]()+"",t;return{c(){t=L(e)},m(n,r){w(n,t,r)},p:N,i:N,o:N,d(n){n&&_(t)}}}function W0(s){let e,t;return e=new Da({props:{isReply:!0,title:s[1].text,doc:s[1],attachment:!1,inStudio:s[0],reply:!1}}),e.$on("click",s[6]),e.$on("update",s[6]),{c(){U(e.$$.fragment)},m(n,r){z(e,n,r),t=!0},p(n,r){const i={};r&4&&(i.title=n[1].text),r&4&&(i.doc=n[1]),r&1&&(i.inStudio=n[0]),e.$set(i)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function K0(s){let e,t;return e=new Da({props:{isReply:!0,title:s[1].text,doc:s[1],attachment:!0,inStudio:s[0],reply:!1}}),e.$on("click",s[6]),e.$on("update",s[6]),{c(){U(e.$$.fragment)},m(n,r){z(e,n,r),t=!0},p(n,r){const i={};r&4&&(i.title=n[1].text),r&4&&(i.doc=n[1]),r&1&&(i.inStudio=n[0]),e.$set(i)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Ji(s,e){let t,n,r,i,u,a,o;const l=[K0,W0],c=[];function f(h,d){return d&4&&(n=null),n==null&&(n=!!h[1].text.includes("replied with voice")),n?0:1}return r=f(e,-1),i=c[r]=l[r](e),{key:s,first:null,c(){t=D("li"),i.c(),u=I(),y(t,"id",a=e[1].textHash),y(t,"class","svelte-197mouz"),this.first=t},m(h,d){w(h,t,d),c[r].m(t,null),m(t,u),o=!0},p(h,d){e=h;let p=r;r=f(e,d),r===p?c[r].p(e,d):(V(),S(c[p],1,1,()=>{c[p]=null}),Q(),i=c[r],i?i.p(e,d):(i=c[r]=l[r](e),i.c()),v(i,1),i.m(t,u)),(!o||d&4&&a!==(a=e[1].textHash))&&y(t,"id",a)},i(h){o||(v(i),o=!0)},o(h){S(i),o=!1},d(h){h&&_(t),c[r].d()}}}function V0(s){return{c:N,m:N,d:N}}function Q0(s){let e;return{c(){e=D("p"),e.textContent="There are no replies yet.",y(e,"class","max-content svelte-197mouz")},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function G0(s){let e,t,n,r,i,u;const a=[q0,H0],o=[];function l(d,p){return d[2]===void 0?0:d[3]?1:-1}~(t=l(s))&&(n=o[t]=a[t](s));function c(d,p){return d[4]?Q0:V0}let f=c(s),h=f(s);return{c(){e=D("div"),n&&n.c(),r=I(),i=D("div"),h.c()},m(d,p){w(d,e,p),~t&&o[t].m(e,null),w(d,r,p),w(d,i,p),h.m(i,null),u=!0},p(d,[p]){let g=t;t=l(d),t===g?~t&&o[t].p(d,p):(n&&(V(),S(o[g],1,1,()=>{o[g]=null}),Q()),~t?(n=o[t],n?n.p(d,p):(n=o[t]=a[t](d),n.c()),v(n,1),n.m(e,null)):n=null),f!==(f=c(d))&&(h.d(1),h=f(d),h&&(h.c(),h.m(i,null)))},i(d){u||(v(n),u=!0)},o(d){S(n),u=!1},d(d){d&&_(e),~t&&o[t].d(),d&&_(r),d&&_(i),h.d()}}}function Y0(s,e,t){let n;Be(s,sa,f=>t(7,n=f));let{doc:r}=e,{inStudio:i}=e,u=[],a=!0,o=!1;const l=async()=>{let f=r.path.split("!");t(2,u=await n.cache.queryDocs({filter:{pathStartsWith:f[0]}})),t(2,u=u.filter(h=>h.path.split("/").length>6)),t(3,a=!0)};n.cache.onCacheUpdated(()=>{l(),t(2,u)});function c(){setTimeout(()=>{l()},1e3)}return pt(()=>{l()}),s.$$set=f=>{"doc"in f&&t(1,r=f.doc),"inStudio"in f&&t(0,i=f.inStudio)},s.$$.update=()=>{s.$$.dirty&4&&t(2,u),s.$$.dirty&4&&(u.length>=1?(t(3,a=!0),t(4,o=!1)):t(4,o=!0))},[i,r,u,a,o,l,c]}class J0 extends Z{constructor(e){super(),X(this,e,Y0,G0,J,{doc:1,inStudio:0})}}function Z0(s){let e,t,n,r,i;function u(l,c){return l[0]?tp:ep}let a=u(s),o=a(s);return{c(){e=D("div"),t=D("div"),n=D("button"),o.c(),y(n,"class","phase1"),y(t,"class","svelte-iaxmoi"),y(e,"class","svelte-iaxmoi")},m(l,c){w(l,e,c),m(e,t),m(t,n),o.m(n,null),r||(i=[j(n,"click",s[8]),j(n,"keypress",s[9])],r=!0)},p(l,c){a!==(a=u(l))&&(o.d(1),o=a(l),o&&(o.c(),o.m(n,null)))},d(l){l&&_(e),o.d(),r=!1,ge(i)}}}function X0(s){let e,t,n,r,i,u,a,o,l,c,f,h,d;return{c(){e=D("div"),t=D("h4"),t.textContent="Review your recording:",n=I(),r=D("audio"),i=D("source"),a=L(`
      Your browser does not support the audio element.`),o=I(),l=D("button"),l.textContent="Record again",c=I(),f=D("button"),f.textContent="Upload",Oe(i.src,u=s[1])||y(i,"src",u),y(i,"type","audio/ogg"),r.controls=!0,y(e,"class","svelte-iaxmoi")},m(p,g){w(p,e,g),m(e,t),m(e,n),m(e,r),m(r,i),m(r,a),m(e,o),m(e,l),m(e,c),m(e,f),h||(d=[j(l,"click",s[4]),j(f,"click",s[3])],h=!0)},p(p,g){g&2&&!Oe(i.src,u=p[1])&&y(i,"src",u)},d(p){p&&_(e),h=!1,ge(d)}}}function ep(s){let e;return{c(){e=L("Record audio")},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function tp(s){let e;return{c(){e=L("Stop recording")},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function np(s){let e;function t(i,u){return i[1]?X0:Z0}let n=t(s),r=n(s);return{c(){r.c(),e=ie()},m(i,u){r.m(i,u),w(i,e,u)},p(i,[u]){n===(n=t(i))&&r?r.p(i,u):(r.d(1),r=n(i),r&&(r.c(),r.m(e.parentNode,e)))},i:N,o:N,d(i){r.d(i),i&&_(e)}}}let rp=null,dr=null,pr=null,mr=null,Zi=null;function sp(s){return new Promise((e,t)=>{let n=new FileReader;n.addEventListener("loadend",r=>e(r.target.result)),n.addEventListener("error",t),n.readAsDataURL(s)})}function ip(s,e,t){let n,r;Be(s,dt,k=>t(15,n=k)),Be(s,Tt,k=>t(16,r=k));const i=rt();let u,a,o=[],l=null,c=!1,f=null,h=null,{xy:d=void 0}=e,{inStudio:p}=e,{doc:g=void 0}=e;async function C(){if(c)l.stop(),console.log("mediaRecorder",l),console.log("mediaRecorder mime",l.mimeType),t(0,c=!1),l.ondataavailable=k=>o.push(k.data),l.onstop=async function(k){new Date().toLocaleString();let F=l.mimeType;F===""&&(F="audio/ogg; codecs=opus"),F.split(";")[0].split("/")[1],h=new Blob(o,{type:F}),t(1,f=URL.createObjectURL(h)),console.log("blob",h)};else{const k=await navigator.mediaDevices.getUserMedia({audio:!0});l=new MediaRecorder(k),l.start(),console.log("mediaRecorder",l),console.log("mediaRecorder mime",l.mimeType),console.log("recording"),t(0,c=!0)}}async function b(){const k=new Uint8Array(await sp(h));console.log("mime",rp);let F=n.address.slice(1,5);if(d!==void 0&&d!=="reply")p||(u=await r.replica.set(n,{path:`/documents/${d[0]}/${d[1]}/${pr}/!voice-note-by-${F}.${dr}`,text:"Voice note shared by "+F+" on "+mr,attachment:k,deleteAfter:Zi})),a=await r.replica.set(n,{path:`/studio/${d[0]}/${d[1]}/${pr}/voice-note-by-${F}.${dr}`,text:"Voice note shared by "+F+" on "+mr,attachment:k}),i("upload"),console.log("Upload Result: ",u),console.log("Studio Result: ",a),o=[];else if(d=="reply"){let T=g.path.split("!"),P=T[0].replace("/documents","/studio");const R=await r.replica.set(n,{text:F+" replied with voice<br>Shared on "+mr,path:T[0]+pr+"/!reply-by-"+F+"."+dr,deleteAfter:Zi,attachment:k}),$=await r.replica.set(n,{text:F+" replied with voice<br>Shared on "+mr,path:P+pr+"/reply-by-"+F+"."+dr,attachment:k});return console.log("result ",R),console.log("studio ",$),i("success"),R}}function A(){t(1,f=null),o=[]}const E=()=>{C()},B=()=>{C()};return s.$$set=k=>{"xy"in k&&t(5,d=k.xy),"inStudio"in k&&t(6,p=k.inStudio),"doc"in k&&t(7,g=k.doc)},[c,f,C,b,A,d,p,g,E,B]}class ma extends Z{constructor(e){super(),X(this,e,ip,np,J,{xy:5,inStudio:6,doc:7})}}function Xi(s){let e,t,n,r,i,u,a,o,l;return{c(){e=D("p"),t=D("input"),n=I(),r=D("p"),i=D("button"),u=L("Send Reply"),Pe(t,"width",s[5]+"ch"),y(t,"class","svelte-19ki2og"),i.disabled=a=tu(s[2])},m(c,f){w(c,e,f),m(e,t),ze(t,s[2]),w(c,n,f),w(c,r,f),m(r,i),m(i,u),o||(l=[j(t,"input",s[10]),j(i,"click",s[7])],o=!0)},p(c,f){f&32&&Pe(t,"width",c[5]+"ch"),f&4&&t.value!==c[2]&&ze(t,c[2]),f&4&&a!==(a=tu(c[2]))&&(i.disabled=a)},d(c){c&&_(e),c&&_(n),c&&_(r),o=!1,ge(l)}}}function eu(s){let e,t,n;return t=new ma({props:{xy:"reply",doc:s[0],inStudio:s[1]}}),{c(){e=D("p"),U(t.$$.fragment)},m(r,i){w(r,e,i),z(t,e,null),n=!0},p(r,i){const u={};i&1&&(u.doc=r[0]),i&2&&(u.inStudio=r[1]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function up(s){let e;return{c(){e=D("span"),e.textContent=`${s[6].kind}`},m(t,n){w(t,e,n)},p:N,d(t){t&&_(e)}}}function op(s){let e,t,n,r,i,u,a,o,l,c,f,h=s[3]&&Xi(s),d=s[4]&&eu(s),p=s[6]&&up(s);return{c(){e=D("div"),t=D("button"),t.textContent="📝Text reply",n=I(),r=D("button"),r.textContent="🔊Voice reply",i=I(),h&&h.c(),u=I(),d&&d.c(),a=I(),o=D("p"),p&&p.c()},m(g,C){w(g,e,C),m(e,t),m(e,n),m(e,r),m(e,i),h&&h.m(e,null),m(e,u),d&&d.m(e,null),m(e,a),m(e,o),p&&p.m(o,null),l=!0,c||(f=[j(t,"click",s[8]),j(r,"click",s[9])],c=!0)},p(g,[C]){g[3]?h?h.p(g,C):(h=Xi(g),h.c(),h.m(e,u)):h&&(h.d(1),h=null),g[4]?d?(d.p(g,C),C&16&&v(d,1)):(d=eu(g),d.c(),v(d,1),d.m(e,a)):d&&(V(),S(d,1,1,()=>{d=null}),Q()),g[6]&&p.p(g,C)},i(g){l||(v(d),l=!0)},o(g){S(d),l=!1},d(g){g&&_(e),h&&h.d(),d&&d.d(),p&&p.d(),c=!1,ge(f)}}}function tu(s){return s=="Reply here"}function ap(s,e,t){let n,r;Be(s,dt,A=>t(11,n=A)),Be(s,Tt,A=>t(12,r=A));const i=rt();let u,a=!1,o=!1;async function l(){let A=n.address.slice(1,5),E=c.path.split("!"),B=c.path.split("/"),k=Date.now();const F=await r.replica.set(n,{text:A+" replied: "+h,path:E[0]+k+"/!reply-by-"+A,deleteAfter:p}),T=await r.replica.set(n,{text:A+" replied: "+h,path:"/studio/"+B[2]+"/"+k+"/reply-by-"+A});return console.log("result ",F),console.log("studio ",T),i("success"),F}let{doc:c}=e,{inStudio:f}=e,h="Reply here",d=h.length,p=(Date.now()+36e5)*1e3;function g(){t(3,a=!a),t(4,o=!1)}function C(){t(3,a=!1),t(4,o=!o)}function b(){h=this.value,t(2,h),t(6,u)}return s.$$set=A=>{"doc"in A&&t(0,c=A.doc),"inStudio"in A&&t(1,f=A.inStudio)},s.$$.update=()=>{s.$$.dirty&4,s.$$.dirty&4&&h!==void 0&&t(5,d=h.length)},console.log("result",u),[c,f,h,a,o,d,u,l,g,C,b]}class lp extends Z{constructor(e){super(),X(this,e,ap,op,J,{doc:0,inStudio:1})}}function nu(s){let e,t,n,r;return e=new J0({props:{doc:s[0],inStudio:s[1]}}),e.$on("success",s[4]),n=new lp({props:{doc:s[0],inStudio:s[1]}}),n.$on("success",s[5]),{c(){U(e.$$.fragment),t=I(),U(n.$$.fragment)},m(i,u){z(e,i,u),w(i,t,u),z(n,i,u),r=!0},p(i,u){const a={};u&1&&(a.doc=i[0]),u&2&&(a.inStudio=i[1]),e.$set(a);const o={};u&1&&(o.doc=i[0]),u&2&&(o.inStudio=i[1]),n.$set(o)},i(i){r||(v(e.$$.fragment,i),v(n.$$.fragment,i),r=!0)},o(i){S(e.$$.fragment,i),S(n.$$.fragment,i),r=!1},d(i){H(e,i),i&&_(t),H(n,i)}}}function cp(s){let e,t,n,r,i,u,a=s[2]&&nu(s);return{c(){e=D("div"),t=D("button"),t.textContent="↩️Reply",n=I(),a&&a.c()},m(o,l){w(o,e,l),m(e,t),m(e,n),a&&a.m(e,null),r=!0,i||(u=j(t,"click",s[3]),i=!0)},p(o,[l]){o[2]?a?(a.p(o,l),l&4&&v(a,1)):(a=nu(o),a.c(),v(a,1),a.m(e,null)):a&&(V(),S(a,1,1,()=>{a=null}),Q())},i(o){r||(v(a),r=!0)},o(o){S(a),r=!1},d(o){o&&_(e),a&&a.d(),i=!1,u()}}}function fp(s,e,t){let{doc:n}=e,{inStudio:r}=e,i=!1;function u(){t(2,i=!i)}function a(l){mn.call(this,s,l)}function o(l){mn.call(this,s,l)}return s.$$set=l=>{"doc"in l&&t(0,n=l.doc),"inStudio"in l&&t(1,r=l.inStudio)},[n,r,i,u,a,o]}class ga extends Z{constructor(e){super(),X(this,e,fp,cp,J,{doc:0,inStudio:1})}}function hp(s){let e,t,n,r,i,u=!s[10]&&ru(s),a=s[10]&&iu(s);return{c(){e=D("div"),u&&u.c(),t=I(),a&&a.c(),y(e,"class","main svelte-twi2yu"),it(e,"replies",s[6]===!0)},m(o,l){w(o,e,l),u&&u.m(e,null),m(e,t),a&&a.m(e,null),n=!0,r||(i=[j(e,"click",is(s[19])),j(e,"keypress",is(s[20]))],r=!0)},p(o,l){o[10]?u&&(u.d(1),u=null):u?u.p(o,l):(u=ru(o),u.c(),u.m(e,t)),o[10]?a?(a.p(o,l),l&1024&&v(a,1)):(a=iu(o),a.c(),v(a,1),a.m(e,null)):a&&(V(),S(a,1,1,()=>{a=null}),Q()),(!n||l&64)&&it(e,"replies",o[6]===!0)},i(o){n||(v(a),n=!0)},o(o){S(a),n=!1},d(o){o&&_(e),u&&u.d(),a&&a.d(),r=!1,ge(i)}}}function dp(s){let e,t,n;return{c(){e=D("div"),t=D("img"),Pe(t,"margin-bottom","-3px"),Oe(t.src,n=s[12][s[9]])||y(t,"src",n),y(t,"alt","document icon"),y(t,"width",s[8]),y(t,"height",s[8]),y(e,"class","main disabled svelte-twi2yu"),it(e,"replies",s[6]===!0)},m(r,i){w(r,e,i),m(e,t)},p(r,i){i&512&&!Oe(t.src,n=r[12][r[9]])&&y(t,"src",n),i&256&&y(t,"width",r[8]),i&256&&y(t,"height",r[8]),i&64&&it(e,"replies",r[6]===!0)},i:N,o:N,d(r){r&&_(e)}}}function ru(s){let e,t,n,r,i,u,a,o=s[0]!==void 0&&su(s);return{c(){e=D("div"),t=D("p"),n=D("img"),i=I(),o&&o.c(),Pe(n,"margin-bottom","-3px"),Oe(n.src,r=s[12][s[9]])||y(n,"src",r),y(n,"alt","document icon"),y(n,"width",s[8]),y(n,"height",s[8]),y(t,"class","svelte-twi2yu"),y(e,"class","flex row svelte-twi2yu")},m(l,c){w(l,e,c),m(e,t),m(t,n),m(e,i),o&&o.m(e,null),u||(a=[j(t,"click",s[14]),j(t,"keypress",s[15])],u=!0)},p(l,c){c&512&&!Oe(n.src,r=l[12][l[9]])&&y(n,"src",r),c&256&&y(n,"width",l[8]),c&256&&y(n,"height",l[8]),l[0]!==void 0?o?o.p(l,c):(o=su(l),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(l){l&&_(e),o&&o.d(),u=!1,ge(a)}}}function su(s){let e;return{c(){e=D("div")},m(t,n){w(t,e,n),e.innerHTML=s[0]},p(t,n){n&1&&(e.innerHTML=t[0])},d(t){t&&_(e)}}}function iu(s){let e,t,n,r,i,u,a,o,l,c,f,h,d,p,g=s[3]&&uu(s);l=new pa({props:{doc:s[1],attachment:s[3],isReply:s[6]}});let C=s[4]&&ou(s),b=!s[2]&&au(s);return{c(){e=D("div"),t=D("button"),n=D("img"),i=L(`
            Artifact`),u=I(),g&&g.c(),a=I(),o=D("div"),U(l.$$.fragment),c=I(),C&&C.c(),f=I(),b&&b.c(),Pe(n,"margin-bottom","-3px"),Oe(n.src,r=s[12][s[9]])||y(n,"src",r),y(n,"alt","document icon"),y(n,"width",s[8]),y(n,"height",s[8]),y(t,"class","svelte-twi2yu"),y(e,"class","flex svelte-twi2yu")},m(A,E){w(A,e,E),m(e,t),m(t,n),m(t,i),m(e,u),g&&g.m(e,null),m(e,a),m(e,o),z(l,o,null),m(e,c),C&&C.m(e,null),m(e,f),b&&b.m(e,null),h=!0,d||(p=[j(t,"click",s[16]),j(t,"keypress",is(s[17]))],d=!0)},p(A,E){(!h||E&512&&!Oe(n.src,r=A[12][A[9]]))&&y(n,"src",r),(!h||E&256)&&y(n,"width",A[8]),(!h||E&256)&&y(n,"height",A[8]),A[3]?g?(g.p(A,E),E&8&&v(g,1)):(g=uu(A),g.c(),v(g,1),g.m(e,a)):g&&(V(),S(g,1,1,()=>{g=null}),Q());const B={};E&2&&(B.doc=A[1]),E&8&&(B.attachment=A[3]),E&64&&(B.isReply=A[6]),l.$set(B),A[4]?C?(C.p(A,E),E&16&&v(C,1)):(C=ou(A),C.c(),v(C,1),C.m(e,f)):C&&(V(),S(C,1,1,()=>{C=null}),Q()),A[2]?b&&(V(),S(b,1,1,()=>{b=null}),Q()):b?(b.p(A,E),E&4&&v(b,1)):(b=au(A),b.c(),v(b,1),b.m(e,null))},i(A){h||(v(g),v(l.$$.fragment,A),v(C),v(b),h=!0)},o(A){S(g),S(l.$$.fragment,A),S(C),S(b),h=!1},d(A){A&&_(e),g&&g.d(),H(l),C&&C.d(),b&&b.d(),d=!1,ge(p)}}}function uu(s){let e,t,n;return t=new da({props:{doc:s[1]}}),{c(){e=D("div"),U(t.$$.fragment)},m(r,i){w(r,e,i),z(t,e,null),n=!0},p(r,i){const u={};i&2&&(u.doc=r[1]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function ou(s){let e,t,n;return t=new ga({props:{doc:s[1],inStudio:s[5]}}),{c(){e=D("div"),U(t.$$.fragment)},m(r,i){w(r,e,i),z(t,e,null),n=!0},p(r,i){const u={};i&2&&(u.doc=r[1]),i&32&&(u.inStudio=r[5]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function au(s){let e,t,n;return t=new oh({props:{doc:s[1]}}),t.$on("update",s[18]),{c(){e=D("div"),U(t.$$.fragment)},m(r,i){w(r,e,i),z(t,e,null),n=!0},p(r,i){const u={};i&2&&(u.doc=r[1]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function pp(s){let e,t,n,r;const i=[dp,hp],u=[];function a(o,l){return o[7]?0:1}return e=a(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),w(o,n,l),r=!0},p(o,[l]){let c=e;e=a(o),e===c?u[e].p(o,l):(V(),S(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=i[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){S(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function mp(s,e,t){const n=rt();let r=["icons/mountain-phase-0-02.png","icons/mountain-phase-1-02.png","icons/mountain-phase-2-02.png","icons/mountain-phase-3-02.png","icons/mountain-phase-4-02.png","icons/mountain-phase-5-02.png","icons/mountain-phase-6-02.png","icons/mountain-phase-7-02.png","icons/mountain-phase-8-02.png"],i=!1,{doc:u}=e,{studio:a=!1}=e,{attachment:o=!0}=e,{reply:l=!0}=e,{title:c=void 0}=e,{inStudio:f}=e,{isReply:h=!1}=e,{disabled:d=!1}=e,p=u.deleteAfter,g,C=24,b;const A=()=>{t(10,i=!i),n("click",u)},E=()=>t(10,i=!i),B=()=>t(10,i=!i),k=()=>t(10,i=!i);function F(R){mn.call(this,s,R)}const T=()=>{t(10,i=!i),n("click",u)},P=()=>t(10,i=!i);return s.$$set=R=>{"doc"in R&&t(1,u=R.doc),"studio"in R&&t(2,a=R.studio),"attachment"in R&&t(3,o=R.attachment),"reply"in R&&t(4,l=R.reply),"title"in R&&t(0,c=R.title),"inStudio"in R&&t(5,f=R.inStudio),"isReply"in R&&t(6,h=R.isReply),"disabled"in R&&t(7,d=R.disabled)},s.$$.update=()=>{s.$$.dirty&514&&console.log(u.path+"phase "+b),s.$$.dirty&8259&&(c!==void 0&&c.includes("<br>")?(t(13,g=c.split("<br>")),t(0,c=g.shift()),t(0,c),t(13,g),t(1,u),t(6,h),console.log("content",g),t(8,C=g.length*2+12)):u.text.includes("<br>")?(t(13,g=u.text.split("<br>")),t(8,C=g.length*3+8)):h&&t(8,C=10)),s.$$.dirty&256&&console.log("reaction",C)},console.log("deletionTime"+p),t(9,b=Math.floor((p-Date.now())/(25488e8/9))%9),[c,u,a,o,l,f,h,d,C,b,i,n,r,g,A,E,B,k,F,T,P]}class Da extends Z{constructor(e){super(),X(this,e,mp,pp,J,{doc:1,studio:2,attachment:3,reply:4,title:0,inStudio:5,isReply:6,disabled:7})}}function lu(s){let e,t;return{c(){e=D("p"),t=L(s[1]),y(e,"class","text-2xl")},m(n,r){w(n,e,r),m(e,t)},p(n,r){r&2&&re(t,n[1])},d(n){n&&_(e)}}}function gp(s){let e,t,n,r,i,u,a,o,l,c,f,h,d=s[1]&&lu(s);return{c(){e=D("div"),t=D("label"),t.textContent="Have an existing ID?",n=I(),r=D("div"),i=D("textarea"),u=I(),a=D("button"),a.textContent="Validate ID",o=I(),l=D("button"),l.textContent="Generate new Identity",c=I(),d&&d.c(),y(t,"for","keypair"),y(i,"class","px-5 my-2 svelte-5at67e"),y(i,"id","keypair"),y(i,"placeholder",`Paste it here:       
{
"address": "", 
"secret": ""
}`),y(a,"class","phase1 mx-4 my-2"),y(l,"class","phase1 mx-4 my-2"),Pe(l,"margin-left","10vw"),y(r,"class","flex md:flex-row items-end mx-0 flex-col svelte-5at67e"),y(e,"class","flex flex-col items-start mx-0 svelte-5at67e")},m(p,g){w(p,e,g),m(e,t),m(e,n),m(e,r),m(r,i),ze(i,s[0]),m(r,u),m(r,a),m(r,o),m(r,l),m(e,c),d&&d.m(e,null),f||(h=[j(i,"input",s[4]),j(a,"click",s[3]),j(l,"click",s[2])],f=!0)},p(p,[g]){g&1&&ze(i,p[0]),p[1]?d?d.p(p,g):(d=lu(p),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},i:N,o:N,d(p){p&&_(e),d&&d.d(),f=!1,ge(h)}}}function Dp(s,e,t){const n=new vs,r=rt();let i="",u="";function a(){r("generateNewIdentity")}function o(){try{let c=JSON.parse(i);c.address&&c.secret?M(Rr(c.address))?(t(1,u="Invalid address"),r("error")):(dt.set({address:c.address,secret:c.secret}),n.author=c,tt.set({settings:n}),r("validated")):(t(1,u="Invalid keypair"),r("error"))}catch{t(1,u="Invalid JSON"),r("error")}}function l(){i=this.value,t(0,i)}return[i,u,a,o,l]}class bp extends Z{constructor(e){super(),X(this,e,Dp,gp,J,{})}}function wp(s){let e,t,n;return{c(){e=D("button"),e.textContent="file",y(e,"class","phase1")},m(r,i){w(r,e,i),t||(n=[j(e,"click",s[8]),j(e,"keypress",s[9])],t=!0)},p:N,d(r){r&&_(e),t=!1,ge(n)}}}function _p(s){let e,t,n;return{c(){e=D("button"),e.textContent="make an offering to the oracle"},m(r,i){w(r,e,i),t||(n=[j(e,"click",s[6]),j(e,"keypress",s[7])],t=!0)},p:N,d(r){r&&_(e),t=!1,ge(n)}}}function cu(s){let e,t,n=s[1].kind+"",r;return{c(){e=D("p"),t=D("strong"),r=L(n)},m(i,u){w(i,e,u),m(e,t),m(t,r)},p(i,u){u&2&&n!==(n=i[1].kind+"")&&re(r,n)},d(i){i&&_(e)}}}function yp(s){let e,t,n,r,i,u,a;function o(h,d){return h[0]?_p:wp}let l=o(s),c=l(s),f=s[1]&&cu(s);return{c(){e=D("div"),t=D("div"),c.c(),n=I(),r=D("input"),i=I(),f&&f.c(),Pe(r,"display","none"),y(r,"type","file"),y(r,"accept",".jpg, .jpeg, .png, .gif, .txt, .pdf, .md, .webm, .mp3, .ogg, .wav"),y(t,"class","svelte-l8b8bn"),y(e,"class","svelte-l8b8bn")},m(h,d){w(h,e,d),m(e,t),c.m(t,null),m(t,n),m(t,r),s[11](r),m(e,i),f&&f.m(e,null),u||(a=j(r,"change",s[10]),u=!0)},p(h,[d]){l===(l=o(h))&&c?c.p(h,d):(c.d(1),c=l(h),c&&(c.c(),c.m(t,n))),h[1]?f?f.p(h,d):(f=cu(h),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i:N,o:N,d(h){h&&_(e),c.d(),s[11](null),f&&f.d(),u=!1,a()}}}function Cp(s){return new Promise((e,t)=>{let n=new FileReader;n.onload=()=>{e(n.result),console.log("typeof",n.result)},n.onerror=t,n.readAsArrayBuffer(s)})}function Ap(s,e,t){let n,r;Be(s,dt,E=>t(14,n=E)),Be(s,Tt,E=>t(15,r=E));const i=rt();let{inStudio:u}=e,{xy:a=[0,0]}=e,{oracle:o=!1}=e,l,c,f;async function h(E){let B=E.target.files[0],F=B.name.replace(/\s+/g,"_").replace(/[@·,\/#!$%\^&\*;:{}=\-`~()]/g,""),T=F.split(".").pop(),P=F.split(".")[F.split(".").length-2],R;(T==="JPG"||T==="jpg")&&(T="jpeg"),R=P+"."+T;let $=Date.now(),W=await Cp(B),le=(Date.now()+25488e5)*1e3,ue=new Uint8Array(W);return o?await r.replica.set(n,{path:`/oracle/${$}/!${R}`,text:"Offering by "+n.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:ue,deleteAfter:le}):(u||t(1,c=await r.replica.set(n,{path:`/documents/${a[0]}/${a[1]}/${$}/!${R}`,text:"Shared by "+n.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:ue,deleteAfter:le})),f=await r.replica.set(n,{path:`/studio/${a[0]}/${a[1]}/${$}/${R}`,text:"Shared by "+n.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:ue})),console.log("Result: ",c),M(c)&&console.error(c),console.log("Studio: ",f),M(f)&&console.error(f),i("success"),c}const d=()=>{l.click()},p=()=>{l.click()},g=()=>{l.click()},C=()=>{l.click()},b=E=>h(E);function A(E){Fr[E?"unshift":"push"](()=>{l=E,t(2,l)})}return s.$$set=E=>{"inStudio"in E&&t(4,u=E.inStudio),"xy"in E&&t(5,a=E.xy),"oracle"in E&&t(0,o=E.oracle)},s.$$.update=()=>{s.$$.dirty&2&&t(1,c)},[o,c,l,h,u,a,d,p,g,C,b,A]}class Ep extends Z{constructor(e){super(),X(this,e,Ap,yp,J,{inStudio:4,xy:5,oracle:0})}}function fu(s){let e,t,n,r,i,u,a,o,l,c,f;return{c(){e=D("div"),t=D("textarea"),n=I(),r=D("div"),i=D("button"),i.textContent="Submit",u=I(),a=D("button"),a.textContent="Close",y(r,"class","button-container svelte-d57wxz"),y(e,"class","modal svelte-d57wxz")},m(h,d){w(h,e,d),m(e,t),s[7](t),m(e,n),m(e,r),m(r,i),m(r,u),m(r,a),l=!0,c||(f=[j(i,"click",s[8]),j(i,"keypress",s[9]),j(a,"click",s[10]),j(a,"keypress",s[11])],c=!0)},p:N,i(h){l||(An(()=>{o||(o=Mt(e,Lt,{y:200,duration:200},!0)),o.run(1)}),l=!0)},o(h){o||(o=Mt(e,Lt,{y:200,duration:200},!1)),o.run(0),l=!1},d(h){h&&_(e),s[7](null),h&&o&&o.end(),c=!1,ge(f)}}}function hu(s){let e,t,n=s[0].kind+"",r;return{c(){e=D("p"),t=D("strong"),r=L(n)},m(i,u){w(i,e,u),m(e,t),m(t,r)},p(i,u){u&1&&n!==(n=i[0].kind+"")&&re(r,n)},d(i){i&&_(e)}}}function vp(s){let e,t,n,r,i,u,a,o,l=s[1]&&fu(s),c=s[0]&&hu(s);return{c(){e=D("div"),t=D("div"),n=D("button"),n.textContent="written text",r=I(),l&&l.c(),i=I(),c&&c.c(),y(n,"class","phase1"),y(t,"class","svelte-d57wxz"),y(e,"class","svelte-d57wxz")},m(f,h){w(f,e,h),m(e,t),m(t,n),m(e,r),l&&l.m(e,null),m(e,i),c&&c.m(e,null),u=!0,a||(o=[j(n,"click",s[5]),j(n,"keypress",s[6])],a=!0)},p(f,[h]){f[1]?l?(l.p(f,h),h&2&&v(l,1)):(l=fu(f),l.c(),v(l,1),l.m(e,i)):l&&(V(),S(l,1,1,()=>{l=null}),Q()),f[0]?c?c.p(f,h):(c=hu(f),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i(f){u||(v(l),u=!0)},o(f){S(l),u=!1},d(f){f&&_(e),l&&l.d(),c&&c.d(),a=!1,ge(o)}}}function kp(s,e,t){let n,r;Be(s,dt,A=>t(12,n=A)),Be(s,Tt,A=>t(13,r=A));const i=rt();let u=!1,a,o,{xy:l=[0,0]}=e;async function c(){let A=Date.now(),E=(Date.now()+25488e5)*1e3,k=await new Blob([a.value],{type:"text/markdown"}).arrayBuffer(),F=new Uint8Array(k);return t(0,o=await r.replica.set(n,{path:`/documents/${l[0]}/${l[1]}/${A}/!text.md`,text:"Text input by "+n.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:F,deleteAfter:E})),console.log("Result: ",o),M(o)&&console.error(o),i("success"),t(1,u=!1),o}const f=()=>t(1,u=!u),h=()=>t(1,u=!u);function d(A){Fr[A?"unshift":"push"](()=>{a=A,t(2,a)})}const p=()=>c(),g=()=>c(),C=()=>t(1,u=!1),b=()=>t(1,u=!1);return s.$$set=A=>{"xy"in A&&t(4,l=A.xy)},s.$$.update=()=>{s.$$.dirty&1&&t(0,o)},[o,u,a,c,l,f,h,d,p,g,C,b]}class Fp extends Z{constructor(e){super(),X(this,e,kp,vp,J,{xy:4})}}function du(s,e,t){const n=s.slice();return n[19]=e[t],n[21]=t,n}function pu(s,e,t){const n=s.slice();return n[19]=e[t],n[23]=t,n}function mu(s){let e,t,n,r,i,u=s[3][1]+"",a,o,l=s[3][0]+"",c,f,h,d,p,g,C,b,A,E,B,k,F;return d=new Fp({props:{xy:s[3]}}),d.$on("success",s[11]),g=new Ep({props:{xy:s[3],inStudio:s[1]}}),g.$on("success",s[12]),b=new ma({props:{xy:s[3],inStudio:s[1]}}),b.$on("upload",s[13]),{c(){e=D("div"),t=D("div"),n=L(`What artefact would you like to create? 
      `),r=D("br"),i=I(),a=L(u),o=L(", "),c=L(l),f=I(),h=D("div"),U(d.$$.fragment),p=I(),U(g.$$.fragment),C=I(),U(b.$$.fragment),A=I(),E=D("button"),E.textContent="Close",y(t,"class","mt-6 brown text-left px-6 svelte-z5nupk"),y(E,"class","phase1"),y(h,"class","flex-col"),y(e,"class","modal pb-6  svelte-z5nupk"),y(e,"style",s[5])},m(T,P){w(T,e,P),m(e,t),m(t,n),m(t,r),m(t,i),m(t,a),m(t,o),m(t,c),m(e,f),m(e,h),z(d,h,null),m(h,p),z(g,h,null),m(h,C),z(b,h,null),m(h,A),m(h,E),B=!0,k||(F=j(E,"click",s[9]),k=!0)},p(T,P){(!B||P&8)&&u!==(u=T[3][1]+"")&&re(a,u),(!B||P&8)&&l!==(l=T[3][0]+"")&&re(c,l);const R={};P&8&&(R.xy=T[3]),d.$set(R);const $={};P&8&&($.xy=T[3]),P&2&&($.inStudio=T[1]),g.$set($);const W={};P&8&&(W.xy=T[3]),P&2&&(W.inStudio=T[1]),b.$set(W),(!B||P&32)&&y(e,"style",T[5])},i(T){B||(v(d.$$.fragment,T),v(g.$$.fragment,T),v(b.$$.fragment,T),B=!0)},o(T){S(d.$$.fragment,T),S(g.$$.fragment,T),S(b.$$.fragment,T),B=!1},d(T){T&&_(e),H(d),H(g),H(b),k=!1,F()}}}function gu(s,e){let t,n,r;function i(){return e[14](e[21],e[23])}function u(){return e[15](e[21],e[23])}return{key:s,first:null,c(){t=D("div"),y(t,"class","svelte-z5nupk"),it(t,"active",e[4][e[21]][e[23]]),this.first=t},m(a,o){w(a,t,o),n||(r=[j(t,"click",i),j(t,"keypress",u)],n=!0)},p(a,o){e=a,o&17&&it(t,"active",e[4][e[21]][e[23]])},d(a){a&&_(t),n=!1,ge(r)}}}function Du(s,e){let t,n=[],r=new Map,i,u={length:e[0][1]};const a=o=>o[23];for(let o=0;o<u.length;o+=1){let l=pu(e,u,o),c=a(l);r.set(c,n[o]=gu(c,l))}return{key:s,first:null,c(){t=ie();for(let o=0;o<n.length;o+=1)n[o].c();i=ie(),this.first=t},m(o,l){w(o,t,l);for(let c=0;c<n.length;c+=1)n[c].m(o,l);w(o,i,l)},p(o,l){e=o,l&273&&(u={length:e[0][1]},n=mt(n,l,a,1,e,u,r,i.parentNode,Yn,gu,i,pu))},d(o){o&&_(t);for(let l=0;l<n.length;l+=1)n[l].d(o);o&&_(i)}}}function Bp(s){let e,t,n,r,i,u,a,o=[],l=new Map,c,f=s[2]&&mu(s),h={length:s[0][0]};const d=p=>p[21];for(let p=0;p<h.length;p+=1){let g=du(s,h,p),C=d(g);l.set(C,o[p]=Du(C,g))}return{c(){e=D("div"),t=D("div"),f&&f.c(),n=I(),r=D("div"),i=D("h4"),i.textContent="Select location on map",u=I(),a=D("div");for(let p=0;p<o.length;p+=1)o[p].c();y(i,"class","svelte-z5nupk"),y(a,"class","container svelte-z5nupk"),Pe(a,"grid-template-rows",s[6]),Pe(a,"grid-template-columns",s[7]),y(r,"class","w-4/5"),Pe(t,"position","relative"),Pe(e,"position","fixed")},m(p,g){w(p,e,g),m(e,t),f&&f.m(t,null),m(t,n),m(t,r),m(r,i),m(r,u),m(r,a);for(let C=0;C<o.length;C+=1)o[C].m(a,null);c=!0},p(p,[g]){p[2]?f?(f.p(p,g),g&4&&v(f,1)):(f=mu(p),f.c(),v(f,1),f.m(t,n)):f&&(V(),S(f,1,1,()=>{f=null}),Q()),g&273&&(h={length:p[0][0]},o=mt(o,g,d,1,p,h,l,a,Yn,Du,null,du)),(!c||g&64)&&Pe(a,"grid-template-rows",p[6]),(!c||g&128)&&Pe(a,"grid-template-columns",p[7])},i(p){c||(v(f),c=!0)},o(p){S(f),c=!1},d(p){p&&_(e),f&&f.d();for(let g=0;g<o.length;g+=1)o[g].d()}}}function Sp(s,e,t){let n,r,i,u,{grid:a=[9,16]}=e,o=[],l=!1,c=["0px","0px"],{inStudio:f}=e;function h(k,F){t(3,o=[k,F]),p([k,F]),setTimeout(()=>{t(2,l=!0),t(10,c=[k*50+"px",F*50+50+"px"])},500)}function d([k,F],[T,P]){return(k-o[0])*(k-T)<=0&&(F-o[1])*(F-P)<=0}function p(k){t(4,i=i.map((F,T)=>F.map((P,R)=>d([T,R],k))))}function g(){t(2,l=!1),t(4,i=Array(a[0]).fill(0).map(k=>Array(a[1]).fill(!1)))}function C(k){mn.call(this,s,k)}function b(k){mn.call(this,s,k)}function A(k){mn.call(this,s,k)}const E=(k,F)=>h(k,F),B=(k,F)=>h(k,F);return s.$$set=k=>{"grid"in k&&t(0,a=k.grid),"inStudio"in k&&t(1,f=k.inStudio)},s.$$.update=()=>{s.$$.dirty&1&&t(7,n=`repeat(${a[1]}, 1fr)`),s.$$.dirty&1&&t(6,r=`repeat(${a[0]}, 1fr)`),s.$$.dirty&1&&t(4,i=Array(a[0]).fill(0).map(k=>Array(a[1]).fill(!1))),s.$$.dirty&1028&&t(5,u=`top: ${c[0]}; left: ${c[1]}; visibility: ${l?"visible":"hidden"};`)},[a,f,l,o,i,u,r,n,h,g,c,C,b,A,E,B]}class Tp extends Z{constructor(e){super(),X(this,e,Sp,Bp,J,{grid:0,inStudio:1})}}function bu(s){let e,t,n;return t=new da({props:{doc:s[0]}}),{c(){e=D("div"),U(t.$$.fragment),y(e,"class","attachmentbox svelte-1uwh7a0")},m(r,i){w(r,e,i),z(t,e,null),n=!0},p(r,i){const u={};i&1&&(u.doc=r[0]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function wu(s){let e,t,n;return t=new ga({props:{doc:s[0],inStudio:s[3]}}),{c(){e=D("div"),U(t.$$.fragment)},m(r,i){w(r,e,i),z(t,e,null),n=!0},p(r,i){const u={};i&1&&(u.doc=r[0]),i&8&&(u.inStudio=r[3]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function Ip(s){let e,t,n,r,i,u,a,o,l,c=s[1]&&bu(s),f=s[2]&&wu(s);return{c(){e=D("h4"),e.textContent="Title placeholder",t=I(),n=D("div"),c&&c.c(),r=I(),f&&f.c(),i=I(),u=D("button"),u.textContent="close",y(e,"class","mt-12"),y(n,"class","flex flex-row justify-between w-full"),y(u,"class","top-right svelte-1uwh7a0")},m(h,d){w(h,e,d),w(h,t,d),w(h,n,d),c&&c.m(n,null),m(n,r),f&&f.m(n,null),w(h,i,d),w(h,u,d),a=!0,o||(l=j(u,"click",s[4]),o=!0)},p(h,[d]){h[1]?c?(c.p(h,d),d&2&&v(c,1)):(c=bu(h),c.c(),v(c,1),c.m(n,r)):c&&(V(),S(c,1,1,()=>{c=null}),Q()),h[2]?f?(f.p(h,d),d&4&&v(f,1)):(f=wu(h),f.c(),v(f,1),f.m(n,null)):f&&(V(),S(f,1,1,()=>{f=null}),Q())},i(h){a||(v(c),v(f),a=!0)},o(h){S(c),S(f),a=!1},d(h){h&&_(e),h&&_(t),h&&_(n),c&&c.d(),f&&f.d(),h&&_(i),h&&_(u),o=!1,l()}}}function Pp(s,e,t){const n=rt();let{selectedDocument:r}=e,{attachment:i=!0}=e,{reply:u=!0}=e,{inStudio:a=!1}=e;function o(){n("close")}return s.$$set=l=>{"selectedDocument"in l&&t(0,r=l.selectedDocument),"attachment"in l&&t(1,i=l.attachment),"reply"in l&&t(2,u=l.reply),"inStudio"in l&&t(3,a=l.inStudio)},[r,i,u,a,o]}class Rp extends Z{constructor(e){super(),X(this,e,Pp,Ip,J,{selectedDocument:0,attachment:1,reply:2,inStudio:3})}}function Op(s){let e,t,n,r,i;return{c(){e=D("div"),t=D("img"),Oe(t.src,n=s[1][s[2]])||y(t,"src",n),y(t,"alt","document icon"),y(t,"class","svelte-cgxyx9")},m(u,a){w(u,e,a),m(e,t),r||(i=[j(e,"click",s[3]),j(e,"keypress",s[3])],r=!0)},p:N,d(u){u&&_(e),r=!1,ge(i)}}}function xp(s){let e,t,n;return{c(){e=D("div"),t=D("img"),Oe(t.src,n=s[1][s[2]])||y(t,"src",n),y(t,"alt","document icon"),Pe(t,"filter","blur(1px)"),y(t,"class","svelte-cgxyx9")},m(r,i){w(r,e,i),m(e,t)},p:N,d(r){r&&_(e)}}}function Mp(s){let e;function t(i,u){return i[0]?xp:Op}let n=t(s),r=n(s);return{c(){r.c(),e=ie()},m(i,u){r.m(i,u),w(i,e,u)},p(i,[u]){n===(n=t(i))&&r?r.p(i,u):(r.d(1),r=n(i),r&&(r.c(),r.m(e.parentNode,e)))},i:N,o:N,d(i){r.d(i),i&&_(e)}}}function Np(s,e,t){const n=rt();let r=["icons/mountain-phase-0-02.png","icons/mountain-phase-1-02.png","icons/mountain-phase-2-02.png","icons/mountain-phase-3-02.png","icons/mountain-phase-4-02.png","icons/mountain-phase-5-02.png","icons/mountain-phase-6-02.png","icons/mountain-phase-7-02.png","icons/mountain-phase-8-02.png"],{doc:i}=e,{disabled:u=!1}=e,a=i.deleteAfter,o=Math.floor((a-Date.now())/(25488e8/9))%9;function l(c){console.log("clicked"),n("click",c)}return s.$$set=c=>{"doc"in c&&t(4,i=c.doc),"disabled"in c&&t(0,u=c.disabled)},[u,r,o,l,i]}class Nr extends Z{constructor(e){super(),X(this,e,Np,Mp,J,{doc:4,disabled:0})}}function _u(s,e,t){const n=s.slice();return n[36]=e[t],n[38]=t,n}function yu(s,e,t){const n=s.slice();return n[39]=e[t],n[41]=t,n}function Cu(s,e,t){const n=s.slice();return n[39]=e[t],n[43]=t,n}function Au(s,e,t){const n=s.slice();return n[44]=e[t],n}function Eu(s){let e,t,n;function r(a,o){return a[1]?$p:Lp}let i=r(s),u=i(s);return{c(){e=D("button"),u.c(),y(e,"class","topleft m-6")},m(a,o){w(a,e,o),u.m(e,null),t||(n=j(e,"click",s[19]),t=!0)},p(a,o){i===(i=r(a))&&u?u.p(a,o):(u.d(1),u=i(a),u&&(u.c(),u.m(e,null)))},d(a){a&&_(e),u.d(),t=!1,n()}}}function $p(s){let e;return{c(){e=L("Hide details")},m(t,n){w(t,e,n)},p:N,d(t){t&&_(e)}}}function Lp(s){let e=s[12].address.slice(0,5)+"",t;return{c(){t=L(e)},m(n,r){w(n,t,r)},p(n,r){r[0]&4096&&e!==(e=n[12].address.slice(0,5)+"")&&re(t,e)},d(n){n&&_(t)}}}function vu(s){let e,t,n;return t=new pa({props:{doc:s[6],attachment:s[3],isReply:s[4]}}),{c(){e=D("div"),U(t.$$.fragment)},m(r,i){w(r,e,i),z(t,e,null),n=!0},p(r,i){const u={};i[0]&64&&(u.doc=r[6]),i[0]&8&&(u.attachment=r[3]),i[0]&16&&(u.isReply=r[4]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function jp(s){let e;return{c(){e=L("Back to viewing")},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function Up(s){let e;return{c(){e=L("Place an artefact")},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function zp(s){let e,t,n;return t=new Tp({props:{inStudio:s[0]}}),t.$on("success",s[24]),t.$on("upload",s[25]),{c(){e=D("div"),U(t.$$.fragment)},m(r,i){w(r,e,i),z(t,e,null),n=!0},p(r,i){const u={};i[0]&1&&(u.inStudio=r[0]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function Hp(s){let e,t,n;return t=new Rp({props:{selectedDocument:s[6]}}),t.$on("close",s[23]),{c(){e=D("div"),U(t.$$.fragment),y(e,"class","artifact-overlay mt-[15vh] h-[80vh] w-4/5 fixed svelte-917e9f")},m(r,i){w(r,e,i),z(t,e,null),n=!0},p(r,i){const u={};i[0]&64&&(u.selectedDocument=r[6]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function qp(s){let e=[],t=new Map,n,r,i=s[14];const u=a=>a[38];for(let a=0;a<i.length;a+=1){let o=_u(s,i,a),l=u(o);t.set(l,e[a]=Tu(l,o))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=ie()},m(a,o){for(let l=0;l<e.length;l+=1)e[l].m(a,o);w(a,n,o),r=!0},p(a,o){o[0]&257056&&(i=a[14],V(),e=mt(e,o,u,1,a,i,t,n.parentNode,Gn,Tu,n,_u),Q())},i(a){if(!r){for(let o=0;o<i.length;o+=1)v(e[o]);r=!0}},o(a){for(let o=0;o<e.length;o+=1)S(e[o]);r=!1},d(a){for(let o=0;o<e.length;o+=1)e[o].d(a);a&&_(n)}}}function Wp(s){let e;return{c(){e=D("p"),e.textContent="No files yet"},m(t,n){w(t,e,n)},p:N,i:N,o:N,d(t){t&&_(e)}}}function ku(s){let e=[],t=new Map,n,r;function i(...o){return s[26](s[41],s[43],...o)}let u=s[5].filter(i);const a=o=>o[44].textHash+o[44].timestamp;for(let o=0;o<u.length;o+=1){let l=Au(s,u,o),c=a(l);t.set(c,e[o]=Fu(c,l))}return{c(){for(let o=0;o<e.length;o+=1)e[o].c();n=ie()},m(o,l){for(let c=0;c<e.length;c+=1)e[c].m(o,l);w(o,n,l),r=!0},p(o,l){s=o,l[0]&188448&&(u=s[5].filter(i),V(),e=mt(e,l,a,1,s,u,t,n.parentNode,Gn,Fu,n,Au),Q())},i(o){if(!r){for(let l=0;l<u.length;l+=1)v(e[l]);r=!0}},o(o){for(let l=0;l<e.length;l+=1)S(e[l]);r=!1},d(o){for(let l=0;l<e.length;l+=1)e[l].d(o);o&&_(n)}}}function Kp(s){let e,t;function n(){return s[28](s[44])}return e=new Nr({props:{doc:s[44]}}),e.$on("click",n),{c(){U(e.$$.fragment)},m(r,i){z(e,r,i),t=!0},p(r,i){s=r;const u={};i[0]&32&&(u.doc=s[44]),e.$set(u)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Vp(s){let e,t;return e=new Nr({props:{doc:s[44],disabled:!0}}),{c(){U(e.$$.fragment)},m(n,r){z(e,n,r),t=!0},p(n,r){const i={};r[0]&32&&(i.doc=n[44]),e.$set(i)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Qp(s){let e,t,n,r;const i=[Yp,Gp],u=[];function a(o,l){return o[15]<o[44].deleteAfter-o[36]?1:0}return e=a(s),t=u[e]=i[e](s),{c(){t.c(),n=ie()},m(o,l){u[e].m(o,l),w(o,n,l),r=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(V(),S(u[c],1,1,()=>{u[c]=null}),Q(),t=u[e],t?t.p(o,l):(t=u[e]=i[e](o),t.c()),v(t,1),t.m(n.parentNode,n))},i(o){r||(v(t),r=!0)},o(o){S(t),r=!1},d(o){u[e].d(o),o&&_(n)}}}function Gp(s){let e,t;function n(){return s[27](s[44])}return e=new Nr({props:{doc:s[44]}}),e.$on("click",n),{c(){U(e.$$.fragment)},m(r,i){z(e,r,i),t=!0},p(r,i){s=r;const u={};i[0]&32&&(u.doc=s[44]),e.$set(u)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Yp(s){let e,t;return e=new Nr({props:{doc:s[44],disabled:!0}}),{c(){U(e.$$.fragment)},m(n,r){z(e,n,r),t=!0},p(n,r){const i={};r[0]&32&&(i.doc=n[44]),e.$set(i)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Fu(s,e){let t,n,r,i,u;const a=[Qp,Vp,Kp],o=[];function l(c,f){return c[36]==c[14][0]?0:c[15]<c[44].deleteAfter-c[36]&&c[15]>c[44].deleteAfter-(c[36]+63936e7)?2:1}return n=l(e),r=o[n]=a[n](e),{key:s,first:null,c(){t=D("div"),r.c(),y(t,"id",i=e[44].textHash+e[44].timestamp),y(t,"class","svelte-917e9f"),this.first=t},m(c,f){w(c,t,f),o[n].m(t,null),u=!0},p(c,f){e=c;let h=n;n=l(e),n===h?o[n].p(e,f):(V(),S(o[h],1,1,()=>{o[h]=null}),Q(),r=o[n],r?r.p(e,f):(r=o[n]=a[n](e),r.c()),v(r,1),r.m(t,null)),(!u||f[0]&32&&i!==(i=e[44].textHash+e[44].timestamp))&&y(t,"id",i)},i(c){u||(v(r),u=!0)},o(c){S(r),u=!1},d(c){c&&_(t),o[n].d()}}}function Bu(s,e){let t,n=e[41]+"",r,i,u=e[43]+"",a,o,l=e[5].find(f),c;function f(...d){return e[21](e[41],e[43],...d)}let h=l&&ku(e);return{key:s,first:null,c(){t=D("div"),r=L(n),i=L(","),a=L(u),o=I(),h&&h.c(),y(t,"class","grid-cell svelte-917e9f"),this.first=t},m(d,p){w(d,t,p),m(t,r),m(t,i),m(t,a),m(t,o),h&&h.m(t,null),c=!0},p(d,p){e=d,p[0]&32&&(l=e[5].find(f)),l?h?(h.p(e,p),p[0]&32&&v(h,1)):(h=ku(e),h.c(),v(h,1),h.m(t,null)):h&&(V(),S(h,1,1,()=>{h=null}),Q())},i(d){c||(v(h),c=!0)},o(d){S(h),c=!1},d(d){d&&_(t),h&&h.d()}}}function Su(s,e){let t,n=[],r=new Map,i,u,a={length:e[13][1]};const o=l=>l[43];for(let l=0;l<a.length;l+=1){let c=Cu(e,a,l),f=o(c);r.set(f,n[l]=Bu(f,c))}return{key:s,first:null,c(){t=ie();for(let l=0;l<n.length;l+=1)n[l].c();i=ie(),this.first=t},m(l,c){w(l,t,c);for(let f=0;f<n.length;f+=1)n[f].m(l,c);w(l,i,c),u=!0},p(l,c){e=l,c[0]&188448&&(a={length:e[13][1]},V(),n=mt(n,c,o,1,e,a,r,i.parentNode,Gn,Bu,i,Cu),Q())},i(l){if(!u){for(let c=0;c<a.length;c+=1)v(n[c]);u=!0}},o(l){for(let c=0;c<n.length;c+=1)S(n[c]);u=!1},d(l){l&&_(t);for(let c=0;c<n.length;c+=1)n[c].d(l);l&&_(i)}}}function Tu(s,e){let t,n=[],r=new Map,i,u,a={length:e[13][0]};const o=l=>l[41];for(let l=0;l<a.length;l+=1){let c=yu(e,a,l),f=o(c);r.set(f,n[l]=Su(f,c))}return{key:s,first:null,c(){t=D("div");for(let l=0;l<n.length;l+=1)n[l].c();i=I(),y(t,"class","my-grid-container w-screen svelte-917e9f"),Pe(t,"grid-template-rows",e[10]),Pe(t,"grid-template-columns",e[11]),Pe(t,"background-color",e[16][e[38]]),this.first=t},m(l,c){w(l,t,c);for(let f=0;f<n.length;f+=1)n[f].m(t,null);m(t,i),u=!0},p(l,c){e=l,c[0]&188448&&(a={length:e[13][0]},V(),n=mt(n,c,o,1,e,a,r,t,Gn,Su,i,yu),Q()),(!u||c[0]&1024)&&Pe(t,"grid-template-rows",e[10]),(!u||c[0]&2048)&&Pe(t,"grid-template-columns",e[11])},i(l){if(!u){for(let c=0;c<a.length;c+=1)v(n[c]);u=!0}},o(l){for(let c=0;c<n.length;c+=1)S(n[c]);u=!1},d(l){l&&_(t);for(let c=0;c<n.length;c+=1)n[c].d()}}}function Jp(s){let e,t,n,r,i,u=s[6]?`Grid [${s[7]}, ${s[8]}]`:"No document selected",a,o,l,c,f,h,d,p,g,C,b,A,E,B,k,F,T=s[2]&&Eu(s),P=s[6]&&vu(s);function R(K,ce){return K[9]?Up:jp}let $=R(s),W=$(s);const le=[Hp,zp],ue=[];function qe(K,ce){return K[6]?0:K[9]?-1:1}~(p=qe(s))&&(g=ue[p]=le[p](s));const we=[Wp,qp],de=[];function he(K,ce){return K[5].length===0?0:1}return A=he(s),E=de[A]=we[A](s),{c(){e=D("div"),T&&T.c(),t=I(),n=D("div"),r=D("div"),i=D("p"),a=L(u),o=I(),P&&P.c(),l=I(),c=D("button"),W.c(),f=I(),h=D("div"),d=D("div"),g&&g.c(),C=I(),b=D("div"),E.c(),y(e,"class","w-screen flex flex-row justify-end h-[10vh]"),y(c,"class","mb-12"),y(r,"class","mx-1 mt-12 w-1/5 paper-yellow flex flex-col p-8 h-[80vh] fixed"),y(b,"class","flex flex-col w-screen"),y(d,"class","my-grid-container-wrapper svelte-917e9f"),y(h,"class","w-4/5 mt-12 ml-auto"),y(n,"class","the-scroll flex min-h-screen overflow-y-auto svelte-917e9f")},m(K,ce){w(K,e,ce),T&&T.m(e,null),w(K,t,ce),w(K,n,ce),m(n,r),m(r,i),m(i,a),m(r,o),P&&P.m(r,null),m(r,l),m(r,c),W.m(c,null),m(n,f),m(n,h),m(h,d),~p&&ue[p].m(d,null),m(d,C),m(d,b),de[A].m(b,null),B=!0,k||(F=[j(e,"click",s[22]),j(e,"keydown",s[20]),j(c,"click",s[18])],k=!0)},p(K,ce){K[2]?T?T.p(K,ce):(T=Eu(K),T.c(),T.m(e,null)):T&&(T.d(1),T=null),(!B||ce[0]&448)&&u!==(u=K[6]?`Grid [${K[7]}, ${K[8]}]`:"No document selected")&&re(a,u),K[6]?P?(P.p(K,ce),ce[0]&64&&v(P,1)):(P=vu(K),P.c(),v(P,1),P.m(r,l)):P&&(V(),S(P,1,1,()=>{P=null}),Q()),$!==($=R(K))&&(W.d(1),W=$(K),W&&(W.c(),W.m(c,null)));let G=p;p=qe(K),p===G?~p&&ue[p].p(K,ce):(g&&(V(),S(ue[G],1,1,()=>{ue[G]=null}),Q()),~p?(g=ue[p],g?g.p(K,ce):(g=ue[p]=le[p](K),g.c()),v(g,1),g.m(d,C)):g=null);let me=A;A=he(K),A===me?de[A].p(K,ce):(V(),S(de[me],1,1,()=>{de[me]=null}),Q(),E=de[A],E?E.p(K,ce):(E=de[A]=we[A](K),E.c()),v(E,1),E.m(b,null))},i(K){B||(v(P),v(g),v(E),B=!0)},o(K){S(P),S(g),S(E),B=!1},d(K){K&&_(e),T&&T.d(),K&&_(t),K&&_(n),P&&P.d(),W.d(),~p&&ue[p].d(),de[A].d(),k=!1,ge(F)}}}function Zp(s,e,t){let n,r,i,u,a;Be(s,sa,G=>t(29,i=G)),Be(s,ia,G=>t(30,u=G)),Be(s,dt,G=>t(12,a=G));const o=rt();let l=[9,16],c=[],f=[191808e7,127872e7,63936e7,0],h=u.getTime()*1e3,d=["#fff5d9","#d3e3d9","#F9DFDD","#CCE9F0"],{inStudio:p}=e,{showDetails:g=!0}=e,{IDcreated:C=!1}=e,{attachment:b=!0}=e,{isReply:A=!1}=e,E=!0,B=null,k,F;function T(G){t(6,B=G),console.log("selecteddoc",G)}const P=async()=>{t(5,c=i.cache.queryDocs({filter:{pathStartsWith:"/documents"}})),t(5,c=c.filter(G=>G.path.split("/").length<=6)),console.log("Docs",c)};i.cache.onCacheUpdated(()=>{P()}),pt(()=>{P()});function R(){t(9,E=!E),t(6,B=null)}function $(){o("toggle")}function W(G){G.key==="Escape"&&t(6,B=null)}const le=(G,me,ye)=>parseInt(ye.path.split("/")[2])==G&&parseInt(ye.path.split("/")[3])==me,ue=()=>t(6,B=null),qe=()=>t(6,B=null),we=()=>t(9,E=!E),de=()=>t(9,E=!E),he=(G,me,ye)=>parseInt(ye.path.split("/")[2])==G&&parseInt(ye.path.split("/")[3])==me,K=G=>T(G),ce=G=>T(G);return s.$$set=G=>{"inStudio"in G&&t(0,p=G.inStudio),"showDetails"in G&&t(1,g=G.showDetails),"IDcreated"in G&&t(2,C=G.IDcreated),"attachment"in G&&t(3,b=G.attachment),"isReply"in G&&t(4,A=G.isReply)},s.$$.update=()=>{if(s.$$.dirty[0]&448&&B){let G=B.path.split("/");t(7,k=G[2]),t(8,F=G[3]),console.log("selectedX",k),console.log("selectedY",F),console.log("selectedDocument",B)}s.$$.dirty[0]&32&&t(5,c)},t(11,n="repeat("+l[1]+", minmax(min-content, 1fr))"),t(10,r="repeat("+l[0]+", minmax(min-content, 1fr))"),[p,g,C,b,A,c,B,k,F,E,r,n,a,l,f,h,d,T,R,$,W,le,ue,qe,we,de,he,K,ce]}class Xp extends Z{constructor(e){super(),X(this,e,Zp,Jp,J,{inStudio:0,showDetails:1,IDcreated:2,attachment:3,isReply:4},null,[-1,-1])}}function Iu(s,e,t){const n=s.slice();return n[11]=e[t],n}function Pu(s,e,t){const n=s.slice();return n[14]=e[t],n[16]=t,n}function Ru(s){let e,t,n,r=s[9].settings.servers.length===1?"Server:":`${s[9].settings.servers.length} Servers:`,i,u,a,o=[],l=new Map,c=s[9].settings.servers;const f=h=>h[16];for(let h=0;h<c.length;h+=1){let d=Pu(s,c,h),p=f(d);l.set(p,o[h]=Ou(p,d))}return{c(){e=D("div"),t=D("p"),n=D("b"),i=L(r),u=I(),a=D("ul");for(let h=0;h<o.length;h+=1)o[h].c();y(t,"class","svelte-1vxr72o")},m(h,d){w(h,e,d),m(e,t),m(t,n),m(n,i),m(e,u),m(e,a);for(let p=0;p<o.length;p+=1)o[p].m(a,null)},p(h,d){d&512&&r!==(r=h[9].settings.servers.length===1?"Server:":`${h[9].settings.servers.length} Servers:`)&&re(i,r),d&512&&(c=h[9].settings.servers,o=mt(o,d,f,1,h,c,l,a,Yn,Ou,null,Pu))},d(h){h&&_(e);for(let d=0;d<o.length;d+=1)o[d].d()}}}function Ou(s,e){let t,n=e[14]+"",r;return{key:s,first:null,c(){t=D("li"),r=L(n),this.first=t},m(i,u){w(i,t,u),m(t,r)},p(i,u){e=i,u&512&&n!==(n=e[14]+"")&&re(r,n)},d(i){i&&_(t)}}}function xu(s){let e,t,n,r,i,u=s[1].status+"",a,o,l,c,f,h,d,p,g,C,b,A,E,B,k,F,T,P,R,$,W,le,ue,qe,we,de,he=s[6]&&Mu(s);return{c(){e=D("div"),t=D("div"),n=D("h4"),r=L("Status: "),i=D("strong"),a=L(u),o=I(),l=D("h4"),c=L("Share "),f=D("strong"),h=L(s[7]),d=I(),p=D("div"),g=D("h4"),g.textContent="Documents",C=I(),b=D("p"),A=D("strong"),E=L(s[3]),B=L(" documents sent"),k=I(),F=D("p"),T=D("strong"),P=L(s[4]),R=L(" documents received"),$=I(),W=D("p"),le=D("strong"),ue=L(s[5]),qe=L(" documents requested"),we=I(),he&&he.c(),de=ie(),y(t,"class","flex-col py-4"),y(b,"class","svelte-1vxr72o"),y(F,"class","svelte-1vxr72o"),y(W,"class","svelte-1vxr72o"),y(p,"class","flex-col items-center py-4"),y(e,"class","flex flex-col")},m(K,ce){w(K,e,ce),m(e,t),m(t,n),m(n,r),m(n,i),m(i,a),m(t,o),m(t,l),m(l,c),m(l,f),m(f,h),m(e,d),m(e,p),m(p,g),m(p,C),m(p,b),m(b,A),m(A,E),m(b,B),m(p,k),m(p,F),m(F,T),m(T,P),m(F,R),m(p,$),m(p,W),m(W,le),m(le,ue),m(W,qe),w(K,we,ce),he&&he.m(K,ce),w(K,de,ce)},p(K,ce){ce&2&&u!==(u=K[1].status+"")&&re(a,u),ce&128&&re(h,K[7]),ce&8&&re(E,K[3]),ce&16&&re(P,K[4]),ce&32&&re(ue,K[5]),K[6]?he?he.p(K,ce):(he=Mu(K),he.c(),he.m(de.parentNode,de)):he&&(he.d(1),he=null)},d(K){K&&_(e),K&&_(we),he&&he.d(K),K&&_(de)}}}function Mu(s){let e,t=s[2].length+"",n,r,i=s[2]>1?"Attachments":"Attachment",u,a,o,l=[],c=new Map,f=s[2];const h=d=>d[11].hash;for(let d=0;d<f.length;d+=1){let p=Iu(s,f,d),g=h(p);c.set(g,l[d]=Nu(g,p))}return{c(){e=D("h4"),n=L(t),r=I(),u=L(i),a=I(),o=D("div");for(let d=0;d<l.length;d+=1)l[d].c();y(e,"class","py-4"),y(o,"class","flex flex-col py-4 h-50vh overflow-y-scroll svelte-1vxr72o")},m(d,p){w(d,e,p),m(e,n),m(e,r),m(e,u),w(d,a,p),w(d,o,p);for(let g=0;g<l.length;g+=1)l[g].m(o,null)},p(d,p){p&4&&t!==(t=d[2].length+"")&&re(n,t),p&4&&i!==(i=d[2]>1?"Attachments":"Attachment")&&re(u,i),p&4&&(f=d[2],l=mt(l,p,h,1,d,f,c,o,Yn,Nu,null,Iu))},d(d){d&&_(e),d&&_(a),d&&_(o);for(let p=0;p<l.length;p+=1)l[p].d()}}}function Nu(s,e){let t,n,r,i=e[11].kind+"",u,a,o,l=e[11].status+"",c,f,h,d,p,g=e[11].bytesLoaded+"",C,b,A,E,B,k=e[11].totalBytes+"",F,T,P,R,$,W=e[11].author.slice(0,9)+"",le,ue,qe;return{key:s,first:null,c(){t=D("div"),n=D("h5"),r=D("span"),u=L(i),a=I(),o=D("strong"),c=L(l),f=I(),h=D("p"),d=L("Bytes loaded: "),p=D("strong"),C=L(g),b=I(),A=D("p"),E=L("Total bytes: "),B=D("strong"),F=L(k),T=I(),P=D("p"),R=L("Author: "),$=D("strong"),le=L(W),ue=L("..."),qe=I(),y(r,"class","kind svelte-1vxr72o"),y(h,"class","svelte-1vxr72o"),y(A,"class","svelte-1vxr72o"),y(P,"class","svelte-1vxr72o"),this.first=t},m(we,de){w(we,t,de),m(t,n),m(n,r),m(r,u),m(n,a),m(n,o),m(o,c),m(t,f),m(t,h),m(h,d),m(h,p),m(p,C),m(t,b),m(t,A),m(A,E),m(A,B),m(B,F),m(t,T),m(t,P),m(P,R),m(P,$),m($,le),m($,ue),m(t,qe)},p(we,de){e=we,de&4&&i!==(i=e[11].kind+"")&&re(u,i),de&4&&l!==(l=e[11].status+"")&&re(c,l),de&4&&g!==(g=e[11].bytesLoaded+"")&&re(C,g),de&4&&k!==(k=e[11].totalBytes+"")&&re(F,k),de&4&&W!==(W=e[11].author.slice(0,9)+"")&&re(le,W)},d(we){we&&_(t)}}}function em(s){let e,t,n,r,i,u,a,o=s[8].shareAddress+"",l,c,f,h,d,p=s[8].secret+"",g,C,b,A=s[9].settings.servers.length>0&&Ru(s),E=s[0]!==void 0&&xu(s);return{c(){e=D("div"),t=D("div"),n=D("h4"),n.textContent="Status Panel & Current Share Details",r=I(),i=D("p"),u=D("b"),u.textContent="Address:",a=I(),l=L(o),c=I(),f=D("p"),h=D("b"),h.textContent="Secret:",d=I(),g=L(p),C=I(),A&&A.c(),b=I(),E&&E.c(),y(n,"class","mb-6"),y(i,"class","svelte-1vxr72o"),y(f,"class","svelte-1vxr72o"),y(t,"class","flex flex-col items-left"),y(e,"class","flex flex-col mt-8 px-8 border-2 p-4")},m(B,k){w(B,e,k),m(e,t),m(t,n),m(t,r),m(t,i),m(i,u),m(i,a),m(i,l),m(t,c),m(t,f),m(f,h),m(f,d),m(f,g),m(e,C),A&&A.m(e,null),m(e,b),E&&E.m(e,null)},p(B,[k]){k&256&&o!==(o=B[8].shareAddress+"")&&re(l,o),k&256&&p!==(p=B[8].secret+"")&&re(g,p),B[9].settings.servers.length>0?A?A.p(B,k):(A=Ru(B),A.c(),A.m(e,b)):A&&(A.d(1),A=null),B[0]!==void 0?E?E.p(B,k):(E=xu(B),E.c(),E.m(e,null)):E&&(E.d(1),E=null)},i:N,o:N,d(B){B&&_(e),A&&A.d(),E&&E.d()}}}function tm(s,e,t){let n,r;Be(s,Vn,p=>t(8,n=p)),Be(s,tt,p=>t(9,r=p));let{status:i=void 0}=e,u,a,o,l,c,f=!1,h,d;return Vn.subscribe(p=>{t(10,d=p.shareAddress),t(7,h=d.slice(0,8))}),s.$$set=p=>{"status"in p&&t(0,i=p.status)},s.$$.update=()=>{s.$$.dirty&1031&&i&&i[d]&&(t(1,u=i[d].docs),t(2,a=i[d].attachments),t(3,o=u.sentCount),t(4,l=u.receivedCount),t(5,c=u.requestedCount),t(6,f=a&&a.length>0))},[i,u,a,o,l,c,f,h,n,r,d]}class nm extends Z{constructor(e){super(),X(this,e,tm,em,J,{status:0})}}function $u(s){let e,t,n,r,i;return{c(){e=D("input"),t=I(),n=D("button"),n.textContent="Submit address",y(e,"type","text"),y(e,"spellcheck","false"),y(e,"class","svelte-16mc8a4"),y(n,"class","svelte-16mc8a4")},m(u,a){w(u,e,a),ze(e,s[1]),w(u,t,a),w(u,n,a),r||(i=[j(e,"input",s[9]),j(n,"click",s[10])],r=!0)},p(u,a){a&2&&e.value!==u[1]&&ze(e,u[1])},d(u){u&&_(e),u&&_(t),u&&_(n),r=!1,ge(i)}}}function Lu(s){let e,t,n;return{c(){e=D("p"),t=D("strong"),n=L(s[3])},m(r,i){w(r,e,i),m(e,t),m(t,n)},p(r,i){i&8&&re(n,r[3])},d(r){r&&_(e)}}}function rm(s){let e,t,n,r,i,u,a,o,l=s[4]&&$u(s),c=s[2]&&Lu(s);return{c(){e=D("div"),t=D("input"),n=I(),r=D("button"),r.textContent="Submit address",i=I(),l&&l.c(),u=I(),c&&c.c(),y(t,"type","text"),y(t,"spellcheck","false"),y(t,"class","svelte-16mc8a4"),y(r,"class","svelte-16mc8a4"),y(e,"class","svelte-16mc8a4")},m(f,h){w(f,e,h),m(e,t),ze(t,s[0]),m(e,n),m(e,r),m(e,i),l&&l.m(e,null),m(e,u),c&&c.m(e,null),a||(o=[j(t,"input",s[7]),j(r,"click",s[8])],a=!0)},p(f,[h]){h&1&&t.value!==f[0]&&ze(t,f[0]),f[4]?l?l.p(f,h):(l=$u(f),l.c(),l.m(e,u)):l&&(l.d(1),l=null),f[2]?c?c.p(f,h):(c=Lu(f),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i:N,o:N,d(f){f&&_(e),l&&l.d(),c&&c.d(),a=!1,ge(o)}}}function sm(s,e,t){let n;Be(s,Vn,C=>t(12,n=C));let r="Add a new share address",i="Add the share's secret",u=!1,a,o=!1,l;tt.subscribe(C=>{l=C.settings});function c(C){if(M(Ut(C))){t(2,u=!0),t(3,a="Not a valid share address");return}else t(2,u=!1),l.addShare(C),tt.set({settings:l}),t(4,o=!0),console.log("You are currently signed in as",l.author||"no-one!"),console.log("You have",l.shares.length,"shares"),console.log("Your shares are",l.shares)}async function f(){let C={address:r,secret:i};const b=await De.checkKeypairIsValid(C);if(console.log(r,typeof r),console.log(i,typeof i),console.log(b),M(b)){t(2,u=!0),t(3,a="Not the right secret for this share.");return}else t(2,u=!1),l.addSecret(r,i),tt.set({settings:l}),console.log("You are currently signed in as",l.author||"no-one!"),console.log("You have",l.shares.length,"shares"),console.log("Your shares are",l.shares),console.log("You know the secret to these shares:",l.shareSecrets)}pt(()=>{n!==void 0&&(l.addShare(n.shareAddress),l.addSecret(n.shareAddress,n.secret))});function h(){r=this.value,t(0,r)}const d=()=>c(r);function p(){i=this.value,t(1,i)}return[r,i,u,a,o,c,f,h,d,p,()=>f()]}class im extends Z{constructor(e){super(),X(this,e,sm,rm,J,{})}}function um(s){let e,t,n,r=s[3]&&am(s);return{c(){e=D("p"),e.textContent="Successfully generated new share keypair!",t=I(),r&&r.c(),n=ie()},m(i,u){w(i,e,u),w(i,t,u),r&&r.m(i,u),w(i,n,u)},p(i,u){i[3]&&r.p(i,u)},d(i){i&&_(e),i&&_(t),r&&r.d(i),i&&_(n)}}}function om(s){let e,t,n=s[1].message+"",r;return{c(){e=D("p"),t=L("Error: "),r=L(n)},m(i,u){w(i,e,u),m(e,t),m(e,r)},p(i,u){u&2&&n!==(n=i[1].message+"")&&re(r,n)},d(i){i&&_(e)}}}function am(s){let e,t,n;return{c(){e=D("p"),e.textContent=`${s[3].shareAddress}`,t=I(),n=D("p"),n.textContent=`${s[3].secret}`},m(r,i){w(r,e,i),w(r,t,i),w(r,n,i)},p:N,d(r){r&&_(e),r&&_(t),r&&_(n)}}}function lm(s){let e,t,n,r,i,u,a;function o(f,h){if(f[1])return om;if(f[2])return um}let l=o(s),c=l&&l(s);return{c(){e=D("input"),t=I(),n=D("button"),n.textContent="Generate New Share Keypair",r=I(),c&&c.c(),i=ie(),y(e,"type","text"),y(e,"placeholder","Enter share name"),y(e,"class","svelte-16mc8a4"),y(n,"class","svelte-16mc8a4")},m(f,h){w(f,e,h),ze(e,s[0]),w(f,t,h),w(f,n,h),w(f,r,h),c&&c.m(f,h),w(f,i,h),u||(a=[j(e,"input",s[5]),j(n,"click",s[4])],u=!0)},p(f,[h]){h&1&&e.value!==f[0]&&ze(e,f[0]),l===(l=o(f))&&c?c.p(f,h):(c&&c.d(1),c=l&&l(f),c&&(c.c(),c.m(i.parentNode,i)))},i:N,o:N,d(f){f&&_(e),f&&_(t),f&&_(n),f&&_(r),c&&c.d(f),f&&_(i),u=!1,ge(a)}}}function cm(s,e,t){let n;Be(s,tt,c=>t(6,n=c));let r="",i,u=!1,a;const o=async()=>{try{const c=await De.generateShareKeypair(r);if(console.log(c),n.settings){const f=n.settings.addShare(c.shareAddress),h=n.settings.addSecret(c.shareAddress,c.secret);if(typeof f!="string"&&typeof h!="string")tt.set({settings:n.settings}),t(2,u=!0),t(1,i=null);else throw new Error("Error adding new share keypair")}}catch(c){t(1,i=c),t(2,u=!1)}};function l(){r=this.value,t(0,r)}return[r,i,u,a,o,l]}class fm extends Z{constructor(e){super(),X(this,e,cm,lm,J,{})}}function hm(s){let e,t,n,r,i;return t=new im({}),r=new fm({}),{c(){e=D("div"),U(t.$$.fragment),n=I(),U(r.$$.fragment)},m(u,a){w(u,e,a),z(t,e,null),m(e,n),z(r,e,null),i=!0},p:N,i(u){i||(v(t.$$.fragment,u),v(r.$$.fragment,u),i=!0)},o(u){S(t.$$.fragment,u),S(r.$$.fragment,u),i=!1},d(u){u&&_(e),H(t),H(r)}}}class dm extends Z{constructor(e){super(),X(this,e,null,hm,J,{})}}function ju(s,e,t){const n=s.slice();return n[14]=e[t],n}function Uu(s){let e;return{c(){e=D("p"),e.innerHTML="<strong>Server was added successfully!</strong>"},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function zu(s){let e;return{c(){e=D("p"),e.innerHTML="<strong>Sync is complete!</strong>"},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function Hu(s){let e,t,n;return{c(){e=D("p"),t=D("strong"),n=L(s[4])},m(r,i){w(r,e,i),m(e,t),m(t,n)},p(r,i){i&16&&re(n,r[4])},d(r){r&&_(e)}}}function qu(s,e){let t,n=e[14]+"",r,i;return{key:s,first:null,c(){t=D("option"),r=L(n),t.__value=i=e[14],t.value=t.__value,this.first=t},m(u,a){w(u,t,a),m(t,r)},p(u,a){e=u,a&128&&n!==(n=e[14]+"")&&re(r,n),a&128&&i!==(i=e[14])&&(t.__value=i,t.value=t.__value)},d(u){u&&_(t)}}}function Wu(s){let e;return{c(){e=D("p"),e.innerHTML="<strong>Server was removed successfully!</strong>"},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function pm(s){let e,t,n,r,i,u,a,o,l,c,f,h=[],d=new Map,p,g,C,b,A,E=s[5]&&Uu(),B=s[6]&&zu(),k=s[3]&&Hu(s),F=s[7].servers;const T=R=>R[14];for(let R=0;R<F.length;R+=1){let $=ju(s,F,R),W=T($);d.set(W,h[R]=qu(W,$))}let P=s[2]&&Wu();return{c(){e=D("div"),t=D("input"),n=I(),r=D("button"),r.textContent="Add server",i=I(),E&&E.c(),u=I(),B&&B.c(),a=I(),k&&k.c(),o=I(),l=D("div"),c=D("select"),f=D("option"),f.textContent="Select a server to remove";for(let R=0;R<h.length;R+=1)h[R].c();p=I(),g=D("button"),g.textContent="Remove server",C=I(),P&&P.c(),y(t,"type","text"),y(t,"spellcheck","false"),y(t,"class","svelte-s2f1tg"),y(r,"class","svelte-s2f1tg"),y(e,"class","svelte-s2f1tg"),f.__value="",f.value=f.__value,y(c,"class","svelte-s2f1tg"),s[1]===void 0&&An(()=>s[12].call(c)),y(g,"class","svelte-s2f1tg"),y(l,"class","svelte-s2f1tg")},m(R,$){w(R,e,$),m(e,t),ze(t,s[0]),m(e,n),m(e,r),m(e,i),E&&E.m(e,null),m(e,u),B&&B.m(e,null),m(e,a),k&&k.m(e,null),w(R,o,$),w(R,l,$),m(l,c),m(c,f);for(let W=0;W<h.length;W+=1)h[W].m(c,null);$s(c,s[1]),m(l,p),m(l,g),m(l,C),P&&P.m(l,null),b||(A=[j(t,"input",s[10]),j(r,"click",s[11]),j(c,"change",s[12]),j(g,"click",s[9])],b=!0)},p(R,[$]){$&1&&t.value!==R[0]&&ze(t,R[0]),R[5]?E||(E=Uu(),E.c(),E.m(e,u)):E&&(E.d(1),E=null),R[6]?B||(B=zu(),B.c(),B.m(e,a)):B&&(B.d(1),B=null),R[3]?k?k.p(R,$):(k=Hu(R),k.c(),k.m(e,null)):k&&(k.d(1),k=null),$&128&&(F=R[7].servers,h=mt(h,$,T,1,R,F,d,c,Yn,qu,null,ju)),$&130&&$s(c,R[1]),R[2]?P||(P=Wu(),P.c(),P.m(l,null)):P&&(P.d(1),P=null)},i:N,o:N,d(R){R&&_(e),E&&E.d(),B&&B.d(),k&&k.d(),R&&_(o),R&&_(l);for(let $=0;$<h.length;$+=1)h[$].d();P&&P.d(),b=!1,ge(A)}}}function mm(s,e,t){let n="Add a new server URL",r,i=!1,u=!1,a,o=!1,l=!1,c,f;tt.subscribe(b=>{t(7,c=b.settings)}),Tt.subscribe(b=>{f=b.replica});async function h(b){let A=c.addServer(b);if(M(A)){t(3,u=!0),t(4,a="Not a valid server URL");return}else{t(3,u=!1),t(5,o=!0),tt.set({settings:c}),console.log("You have",c.servers.length,"servers"),console.log("Your servers are",c.servers);const E=new Xn;E.addReplica(f),await E.sync(b).isDone(),t(6,l=!0),console.log("Sync is done")}}function d(){let b=c.removeServer(r);M(b)?(t(3,u=!0),t(4,a="Failed to remove server")):(t(3,u=!1),t(2,i=!0),tt.set({settings:c}),console.log("You have",c.servers.length,"servers"),console.log("Your servers are",c.servers))}function p(){n=this.value,t(0,n)}const g=()=>h(n);function C(){r=Wa(this),t(1,r),t(7,c)}return[n,r,i,u,a,o,l,c,h,d,p,g,C]}class gm extends Z{constructor(e){super(),X(this,e,mm,pm,J,{})}}function Dm(s){let e,t,n,r=JSON.stringify(s[1],null,2)+"",i;return{c(){e=D("p"),e.textContent="Parsed Invitation:",t=I(),n=D("pre"),i=L(r)},m(u,a){w(u,e,a),w(u,t,a),w(u,n,a),m(n,i)},p(u,a){a&2&&r!==(r=JSON.stringify(u[1],null,2)+"")&&re(i,r)},d(u){u&&_(e),u&&_(t),u&&_(n)}}}function bm(s){let e;return{c(){e=D("p"),e.textContent="Successfully redeemed invitation!"},m(t,n){w(t,e,n)},p:N,d(t){t&&_(e)}}}function wm(s){let e,t,n=s[2].message+"",r;return{c(){e=D("p"),t=L("Error: "),r=L(n)},m(i,u){w(i,e,u),m(e,t),m(e,r)},p(i,u){u&4&&n!==(n=i[2].message+"")&&re(r,n)},d(i){i&&_(e)}}}function _m(s){let e,t,n,r,i,u,a;function o(f,h){if(f[2])return wm;if(f[3])return bm;if(f[1])return Dm}let l=o(s),c=l&&l(s);return{c(){e=D("input"),t=I(),n=D("button"),n.textContent="Redeem Invitation URL",r=I(),c&&c.c(),i=ie(),y(e,"type","text"),y(e,"placeholder","Enter invitation URL")},m(f,h){w(f,e,h),ze(e,s[0]),w(f,t,h),w(f,n,h),w(f,r,h),c&&c.m(f,h),w(f,i,h),u||(a=[j(e,"input",s[5]),j(n,"click",s[4])],u=!0)},p(f,[h]){h&1&&e.value!==f[0]&&ze(e,f[0]),l===(l=o(f))&&c?c.p(f,h):(c&&c.d(1),c=l&&l(f),c&&(c.c(),c.m(i.parentNode,i)))},i:N,o:N,d(f){f&&_(e),f&&_(t),f&&_(n),f&&_(r),c&&c.d(f),f&&_(i),u=!1,ge(a)}}}function ym(s,e,t){let n="",r,i,u,a=!1;tt.subscribe(h=>{u=h.settings});const o=async()=>{try{return t(1,r=await ta(n)),console.log(n),console.log(r),t(2,i=null),t(3,a=!1),!0}catch(h){return t(2,i=h),console.log(h),!1}},l=async()=>{try{const h=await u.redeemInvitationURL(n);h===!0?(t(3,a=!0),t(2,i=null)):(t(2,i=h),t(3,a=!1))}catch(h){t(2,i=h),t(3,a=!1)}},c=async()=>{await o()&&await l()};function f(){n=this.value,t(0,n)}return[n,r,i,a,c,f]}class Cm extends Z{constructor(e){super(),X(this,e,ym,_m,J,{})}}var tr={},Am=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},ba={},st={};let Ts;const Em=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];st.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};st.getSymbolTotalCodewords=function(e){return Em[e]};st.getBCHDigit=function(s){let e=0;for(;s!==0;)e++,s>>>=1;return e};st.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');Ts=e};st.isKanjiModeEnabled=function(){return typeof Ts<"u"};st.toSJIS=function(e){return Ts(e)};var $r={};(function(s){s.L={bit:1},s.M={bit:0},s.Q={bit:3},s.H={bit:2};function e(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"l":case"low":return s.L;case"m":case"medium":return s.M;case"q":case"quartile":return s.Q;case"h":case"high":return s.H;default:throw new Error("Unknown EC Level: "+t)}}s.isValid=function(n){return n&&typeof n.bit<"u"&&n.bit>=0&&n.bit<4},s.from=function(n,r){if(s.isValid(n))return n;try{return e(n)}catch{return r}}})($r);function wa(){this.buffer=[],this.length=0}wa.prototype={get:function(s){const e=Math.floor(s/8);return(this.buffer[e]>>>7-s%8&1)===1},put:function(s,e){for(let t=0;t<e;t++)this.putBit((s>>>e-t-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(s){const e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),s&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var vm=wa;function nr(s){if(!s||s<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=s,this.data=new Uint8Array(s*s),this.reservedBit=new Uint8Array(s*s)}nr.prototype.set=function(s,e,t,n){const r=s*this.size+e;this.data[r]=t,n&&(this.reservedBit[r]=!0)};nr.prototype.get=function(s,e){return this.data[s*this.size+e]};nr.prototype.xor=function(s,e,t){this.data[s*this.size+e]^=t};nr.prototype.isReserved=function(s,e){return this.reservedBit[s*this.size+e]};var km=nr,_a={};(function(s){const e=st.getSymbolSize;s.getRowColCoords=function(n){if(n===1)return[];const r=Math.floor(n/7)+2,i=e(n),u=i===145?26:Math.ceil((i-13)/(2*r-2))*2,a=[i-7];for(let o=1;o<r-1;o++)a[o]=a[o-1]-u;return a.push(6),a.reverse()},s.getPositions=function(n){const r=[],i=s.getRowColCoords(n),u=i.length;for(let a=0;a<u;a++)for(let o=0;o<u;o++)a===0&&o===0||a===0&&o===u-1||a===u-1&&o===0||r.push([i[a],i[o]]);return r}})(_a);var ya={};const Fm=st.getSymbolSize,Ku=7;ya.getPositions=function(e){const t=Fm(e);return[[0,0],[t-Ku,0],[0,t-Ku]]};var Ca={};(function(s){s.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};s.isValid=function(r){return r!=null&&r!==""&&!isNaN(r)&&r>=0&&r<=7},s.from=function(r){return s.isValid(r)?parseInt(r,10):void 0},s.getPenaltyN1=function(r){const i=r.size;let u=0,a=0,o=0,l=null,c=null;for(let f=0;f<i;f++){a=o=0,l=c=null;for(let h=0;h<i;h++){let d=r.get(f,h);d===l?a++:(a>=5&&(u+=e.N1+(a-5)),l=d,a=1),d=r.get(h,f),d===c?o++:(o>=5&&(u+=e.N1+(o-5)),c=d,o=1)}a>=5&&(u+=e.N1+(a-5)),o>=5&&(u+=e.N1+(o-5))}return u},s.getPenaltyN2=function(r){const i=r.size;let u=0;for(let a=0;a<i-1;a++)for(let o=0;o<i-1;o++){const l=r.get(a,o)+r.get(a,o+1)+r.get(a+1,o)+r.get(a+1,o+1);(l===4||l===0)&&u++}return u*e.N2},s.getPenaltyN3=function(r){const i=r.size;let u=0,a=0,o=0;for(let l=0;l<i;l++){a=o=0;for(let c=0;c<i;c++)a=a<<1&2047|r.get(l,c),c>=10&&(a===1488||a===93)&&u++,o=o<<1&2047|r.get(c,l),c>=10&&(o===1488||o===93)&&u++}return u*e.N3},s.getPenaltyN4=function(r){let i=0;const u=r.data.length;for(let o=0;o<u;o++)i+=r.data[o];return Math.abs(Math.ceil(i*100/u/5)-10)*e.N4};function t(n,r,i){switch(n){case s.Patterns.PATTERN000:return(r+i)%2===0;case s.Patterns.PATTERN001:return r%2===0;case s.Patterns.PATTERN010:return i%3===0;case s.Patterns.PATTERN011:return(r+i)%3===0;case s.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(i/3))%2===0;case s.Patterns.PATTERN101:return r*i%2+r*i%3===0;case s.Patterns.PATTERN110:return(r*i%2+r*i%3)%2===0;case s.Patterns.PATTERN111:return(r*i%3+(r+i)%2)%2===0;default:throw new Error("bad maskPattern:"+n)}}s.applyMask=function(r,i){const u=i.size;for(let a=0;a<u;a++)for(let o=0;o<u;o++)i.isReserved(o,a)||i.xor(o,a,t(r,o,a))},s.getBestMask=function(r,i){const u=Object.keys(s.Patterns).length;let a=0,o=1/0;for(let l=0;l<u;l++){i(l),s.applyMask(l,r);const c=s.getPenaltyN1(r)+s.getPenaltyN2(r)+s.getPenaltyN3(r)+s.getPenaltyN4(r);s.applyMask(l,r),c<o&&(o=c,a=l)}return a}})(Ca);var Lr={};const xt=$r,gr=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],Dr=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];Lr.getBlocksCount=function(e,t){switch(t){case xt.L:return gr[(e-1)*4+0];case xt.M:return gr[(e-1)*4+1];case xt.Q:return gr[(e-1)*4+2];case xt.H:return gr[(e-1)*4+3];default:return}};Lr.getTotalCodewordsCount=function(e,t){switch(t){case xt.L:return Dr[(e-1)*4+0];case xt.M:return Dr[(e-1)*4+1];case xt.Q:return Dr[(e-1)*4+2];case xt.H:return Dr[(e-1)*4+3];default:return}};var Aa={},jr={};const zn=new Uint8Array(512),vr=new Uint8Array(256);(function(){let e=1;for(let t=0;t<255;t++)zn[t]=e,vr[e]=t,e<<=1,e&256&&(e^=285);for(let t=255;t<512;t++)zn[t]=zn[t-255]})();jr.log=function(e){if(e<1)throw new Error("log("+e+")");return vr[e]};jr.exp=function(e){return zn[e]};jr.mul=function(e,t){return e===0||t===0?0:zn[vr[e]+vr[t]]};(function(s){const e=jr;s.mul=function(n,r){const i=new Uint8Array(n.length+r.length-1);for(let u=0;u<n.length;u++)for(let a=0;a<r.length;a++)i[u+a]^=e.mul(n[u],r[a]);return i},s.mod=function(n,r){let i=new Uint8Array(n);for(;i.length-r.length>=0;){const u=i[0];for(let o=0;o<r.length;o++)i[o]^=e.mul(r[o],u);let a=0;for(;a<i.length&&i[a]===0;)a++;i=i.slice(a)}return i},s.generateECPolynomial=function(n){let r=new Uint8Array([1]);for(let i=0;i<n;i++)r=s.mul(r,new Uint8Array([1,e.exp(i)]));return r}})(Aa);const Ea=Aa;function Is(s){this.genPoly=void 0,this.degree=s,this.degree&&this.initialize(this.degree)}Is.prototype.initialize=function(e){this.degree=e,this.genPoly=Ea.generateECPolynomial(this.degree)};Is.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(e.length+this.degree);t.set(e);const n=Ea.mod(t,this.genPoly),r=this.degree-n.length;if(r>0){const i=new Uint8Array(this.degree);return i.set(n,r),i}return n};var Bm=Is,va={},zt={},Ps={};Ps.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40};var gt={};const ka="[0-9]+",Sm="[A-Z $%*+\\-./:]+";let Qn="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";Qn=Qn.replace(/u/g,"\\u");const Tm="(?:(?![A-Z0-9 $%*+\\-./:]|"+Qn+`)(?:.|[\r
]))+`;gt.KANJI=new RegExp(Qn,"g");gt.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");gt.BYTE=new RegExp(Tm,"g");gt.NUMERIC=new RegExp(ka,"g");gt.ALPHANUMERIC=new RegExp(Sm,"g");const Im=new RegExp("^"+Qn+"$"),Pm=new RegExp("^"+ka+"$"),Rm=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");gt.testKanji=function(e){return Im.test(e)};gt.testNumeric=function(e){return Pm.test(e)};gt.testAlphanumeric=function(e){return Rm.test(e)};(function(s){const e=Ps,t=gt;s.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},s.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},s.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},s.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},s.MIXED={bit:-1},s.getCharCountIndicator=function(i,u){if(!i.ccBits)throw new Error("Invalid mode: "+i);if(!e.isValid(u))throw new Error("Invalid version: "+u);return u>=1&&u<10?i.ccBits[0]:u<27?i.ccBits[1]:i.ccBits[2]},s.getBestModeForData=function(i){return t.testNumeric(i)?s.NUMERIC:t.testAlphanumeric(i)?s.ALPHANUMERIC:t.testKanji(i)?s.KANJI:s.BYTE},s.toString=function(i){if(i&&i.id)return i.id;throw new Error("Invalid mode")},s.isValid=function(i){return i&&i.bit&&i.ccBits};function n(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"numeric":return s.NUMERIC;case"alphanumeric":return s.ALPHANUMERIC;case"kanji":return s.KANJI;case"byte":return s.BYTE;default:throw new Error("Unknown mode: "+r)}}s.from=function(i,u){if(s.isValid(i))return i;try{return n(i)}catch{return u}}})(zt);(function(s){const e=st,t=Lr,n=$r,r=zt,i=Ps,u=7973,a=e.getBCHDigit(u);function o(h,d,p){for(let g=1;g<=40;g++)if(d<=s.getCapacity(g,p,h))return g}function l(h,d){return r.getCharCountIndicator(h,d)+4}function c(h,d){let p=0;return h.forEach(function(g){const C=l(g.mode,d);p+=C+g.getBitsLength()}),p}function f(h,d){for(let p=1;p<=40;p++)if(c(h,p)<=s.getCapacity(p,d,r.MIXED))return p}s.from=function(d,p){return i.isValid(d)?parseInt(d,10):p},s.getCapacity=function(d,p,g){if(!i.isValid(d))throw new Error("Invalid QR Code version");typeof g>"u"&&(g=r.BYTE);const C=e.getSymbolTotalCodewords(d),b=t.getTotalCodewordsCount(d,p),A=(C-b)*8;if(g===r.MIXED)return A;const E=A-l(g,d);switch(g){case r.NUMERIC:return Math.floor(E/10*3);case r.ALPHANUMERIC:return Math.floor(E/11*2);case r.KANJI:return Math.floor(E/13);case r.BYTE:default:return Math.floor(E/8)}},s.getBestVersionForData=function(d,p){let g;const C=n.from(p,n.M);if(Array.isArray(d)){if(d.length>1)return f(d,C);if(d.length===0)return 1;g=d[0]}else g=d;return o(g.mode,g.getLength(),C)},s.getEncodedBits=function(d){if(!i.isValid(d)||d<7)throw new Error("Invalid QR Code version");let p=d<<12;for(;e.getBCHDigit(p)-a>=0;)p^=u<<e.getBCHDigit(p)-a;return d<<12|p}})(va);var Fa={};const ds=st,Ba=1335,Om=21522,Vu=ds.getBCHDigit(Ba);Fa.getEncodedBits=function(e,t){const n=e.bit<<3|t;let r=n<<10;for(;ds.getBCHDigit(r)-Vu>=0;)r^=Ba<<ds.getBCHDigit(r)-Vu;return(n<<10|r)^Om};var Sa={};const xm=zt;function wn(s){this.mode=xm.NUMERIC,this.data=s.toString()}wn.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};wn.prototype.getLength=function(){return this.data.length};wn.prototype.getBitsLength=function(){return wn.getBitsLength(this.data.length)};wn.prototype.write=function(e){let t,n,r;for(t=0;t+3<=this.data.length;t+=3)n=this.data.substr(t,3),r=parseInt(n,10),e.put(r,10);const i=this.data.length-t;i>0&&(n=this.data.substr(t),r=parseInt(n,10),e.put(r,i*3+1))};var Mm=wn;const Nm=zt,es=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function _n(s){this.mode=Nm.ALPHANUMERIC,this.data=s}_n.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};_n.prototype.getLength=function(){return this.data.length};_n.prototype.getBitsLength=function(){return _n.getBitsLength(this.data.length)};_n.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let n=es.indexOf(this.data[t])*45;n+=es.indexOf(this.data[t+1]),e.put(n,11)}this.data.length%2&&e.put(es.indexOf(this.data[t]),6)};var $m=_n,Lm=function(e){for(var t=[],n=e.length,r=0;r<n;r++){var i=e.charCodeAt(r);if(i>=55296&&i<=56319&&n>r+1){var u=e.charCodeAt(r+1);u>=56320&&u<=57343&&(i=(i-55296)*1024+u-56320+65536,r+=1)}if(i<128){t.push(i);continue}if(i<2048){t.push(i>>6|192),t.push(i&63|128);continue}if(i<55296||i>=57344&&i<65536){t.push(i>>12|224),t.push(i>>6&63|128),t.push(i&63|128);continue}if(i>=65536&&i<=1114111){t.push(i>>18|240),t.push(i>>12&63|128),t.push(i>>6&63|128),t.push(i&63|128);continue}t.push(239,191,189)}return new Uint8Array(t).buffer};const jm=Lm,Um=zt;function yn(s){this.mode=Um.BYTE,typeof s=="string"&&(s=jm(s)),this.data=new Uint8Array(s)}yn.getBitsLength=function(e){return e*8};yn.prototype.getLength=function(){return this.data.length};yn.prototype.getBitsLength=function(){return yn.getBitsLength(this.data.length)};yn.prototype.write=function(s){for(let e=0,t=this.data.length;e<t;e++)s.put(this.data[e],8)};var zm=yn;const Hm=zt,qm=st;function Cn(s){this.mode=Hm.KANJI,this.data=s}Cn.getBitsLength=function(e){return e*13};Cn.prototype.getLength=function(){return this.data.length};Cn.prototype.getBitsLength=function(){return Cn.getBitsLength(this.data.length)};Cn.prototype.write=function(s){let e;for(e=0;e<this.data.length;e++){let t=qm.toSJIS(this.data[e]);if(t>=33088&&t<=40956)t-=33088;else if(t>=57408&&t<=60351)t-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);t=(t>>>8&255)*192+(t&255),s.put(t,13)}};var Wm=Cn,Ta={exports:{}};(function(s){var e={single_source_shortest_paths:function(t,n,r){var i={},u={};u[n]=0;var a=e.PriorityQueue.make();a.push(n,0);for(var o,l,c,f,h,d,p,g,C;!a.empty();){o=a.pop(),l=o.value,f=o.cost,h=t[l]||{};for(c in h)h.hasOwnProperty(c)&&(d=h[c],p=f+d,g=u[c],C=typeof u[c]>"u",(C||g>p)&&(u[c]=p,a.push(c,p),i[c]=l))}if(typeof r<"u"&&typeof u[r]>"u"){var b=["Could not find a path from ",n," to ",r,"."].join("");throw new Error(b)}return i},extract_shortest_path_from_predecessor_list:function(t,n){for(var r=[],i=n;i;)r.push(i),t[i],i=t[i];return r.reverse(),r},find_path:function(t,n,r){var i=e.single_source_shortest_paths(t,n,r);return e.extract_shortest_path_from_predecessor_list(i,r)},PriorityQueue:{make:function(t){var n=e.PriorityQueue,r={},i;t=t||{};for(i in n)n.hasOwnProperty(i)&&(r[i]=n[i]);return r.queue=[],r.sorter=t.sorter||n.default_sorter,r},default_sorter:function(t,n){return t.cost-n.cost},push:function(t,n){var r={value:t,cost:n};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};s.exports=e})(Ta);var Km=Ta.exports;(function(s){const e=zt,t=Mm,n=$m,r=zm,i=Wm,u=gt,a=st,o=Km;function l(b){return unescape(encodeURIComponent(b)).length}function c(b,A,E){const B=[];let k;for(;(k=b.exec(E))!==null;)B.push({data:k[0],index:k.index,mode:A,length:k[0].length});return B}function f(b){const A=c(u.NUMERIC,e.NUMERIC,b),E=c(u.ALPHANUMERIC,e.ALPHANUMERIC,b);let B,k;return a.isKanjiModeEnabled()?(B=c(u.BYTE,e.BYTE,b),k=c(u.KANJI,e.KANJI,b)):(B=c(u.BYTE_KANJI,e.BYTE,b),k=[]),A.concat(E,B,k).sort(function(T,P){return T.index-P.index}).map(function(T){return{data:T.data,mode:T.mode,length:T.length}})}function h(b,A){switch(A){case e.NUMERIC:return t.getBitsLength(b);case e.ALPHANUMERIC:return n.getBitsLength(b);case e.KANJI:return i.getBitsLength(b);case e.BYTE:return r.getBitsLength(b)}}function d(b){return b.reduce(function(A,E){const B=A.length-1>=0?A[A.length-1]:null;return B&&B.mode===E.mode?(A[A.length-1].data+=E.data,A):(A.push(E),A)},[])}function p(b){const A=[];for(let E=0;E<b.length;E++){const B=b[E];switch(B.mode){case e.NUMERIC:A.push([B,{data:B.data,mode:e.ALPHANUMERIC,length:B.length},{data:B.data,mode:e.BYTE,length:B.length}]);break;case e.ALPHANUMERIC:A.push([B,{data:B.data,mode:e.BYTE,length:B.length}]);break;case e.KANJI:A.push([B,{data:B.data,mode:e.BYTE,length:l(B.data)}]);break;case e.BYTE:A.push([{data:B.data,mode:e.BYTE,length:l(B.data)}])}}return A}function g(b,A){const E={},B={start:{}};let k=["start"];for(let F=0;F<b.length;F++){const T=b[F],P=[];for(let R=0;R<T.length;R++){const $=T[R],W=""+F+R;P.push(W),E[W]={node:$,lastCount:0},B[W]={};for(let le=0;le<k.length;le++){const ue=k[le];E[ue]&&E[ue].node.mode===$.mode?(B[ue][W]=h(E[ue].lastCount+$.length,$.mode)-h(E[ue].lastCount,$.mode),E[ue].lastCount+=$.length):(E[ue]&&(E[ue].lastCount=$.length),B[ue][W]=h($.length,$.mode)+4+e.getCharCountIndicator($.mode,A))}}k=P}for(let F=0;F<k.length;F++)B[k[F]].end=0;return{map:B,table:E}}function C(b,A){let E;const B=e.getBestModeForData(b);if(E=e.from(A,B),E!==e.BYTE&&E.bit<B.bit)throw new Error('"'+b+'" cannot be encoded with mode '+e.toString(E)+`.
 Suggested mode is: `+e.toString(B));switch(E===e.KANJI&&!a.isKanjiModeEnabled()&&(E=e.BYTE),E){case e.NUMERIC:return new t(b);case e.ALPHANUMERIC:return new n(b);case e.KANJI:return new i(b);case e.BYTE:return new r(b)}}s.fromArray=function(A){return A.reduce(function(E,B){return typeof B=="string"?E.push(C(B,null)):B.data&&E.push(C(B.data,B.mode)),E},[])},s.fromString=function(A,E){const B=f(A,a.isKanjiModeEnabled()),k=p(B),F=g(k,E),T=o.find_path(F.map,"start","end"),P=[];for(let R=1;R<T.length-1;R++)P.push(F.table[T[R]].node);return s.fromArray(d(P))},s.rawSplit=function(A){return s.fromArray(f(A,a.isKanjiModeEnabled()))}})(Sa);const Ur=st,ts=$r,Vm=vm,Qm=km,Gm=_a,Ym=ya,ps=Ca,ms=Lr,Jm=Bm,kr=va,Zm=Fa,Xm=zt,ns=Sa;function eg(s,e){const t=s.size,n=Ym.getPositions(e);for(let r=0;r<n.length;r++){const i=n[r][0],u=n[r][1];for(let a=-1;a<=7;a++)if(!(i+a<=-1||t<=i+a))for(let o=-1;o<=7;o++)u+o<=-1||t<=u+o||(a>=0&&a<=6&&(o===0||o===6)||o>=0&&o<=6&&(a===0||a===6)||a>=2&&a<=4&&o>=2&&o<=4?s.set(i+a,u+o,!0,!0):s.set(i+a,u+o,!1,!0))}}function tg(s){const e=s.size;for(let t=8;t<e-8;t++){const n=t%2===0;s.set(t,6,n,!0),s.set(6,t,n,!0)}}function ng(s,e){const t=Gm.getPositions(e);for(let n=0;n<t.length;n++){const r=t[n][0],i=t[n][1];for(let u=-2;u<=2;u++)for(let a=-2;a<=2;a++)u===-2||u===2||a===-2||a===2||u===0&&a===0?s.set(r+u,i+a,!0,!0):s.set(r+u,i+a,!1,!0)}}function rg(s,e){const t=s.size,n=kr.getEncodedBits(e);let r,i,u;for(let a=0;a<18;a++)r=Math.floor(a/3),i=a%3+t-8-3,u=(n>>a&1)===1,s.set(r,i,u,!0),s.set(i,r,u,!0)}function rs(s,e,t){const n=s.size,r=Zm.getEncodedBits(e,t);let i,u;for(i=0;i<15;i++)u=(r>>i&1)===1,i<6?s.set(i,8,u,!0):i<8?s.set(i+1,8,u,!0):s.set(n-15+i,8,u,!0),i<8?s.set(8,n-i-1,u,!0):i<9?s.set(8,15-i-1+1,u,!0):s.set(8,15-i-1,u,!0);s.set(n-8,8,1,!0)}function sg(s,e){const t=s.size;let n=-1,r=t-1,i=7,u=0;for(let a=t-1;a>0;a-=2)for(a===6&&a--;;){for(let o=0;o<2;o++)if(!s.isReserved(r,a-o)){let l=!1;u<e.length&&(l=(e[u]>>>i&1)===1),s.set(r,a-o,l),i--,i===-1&&(u++,i=7)}if(r+=n,r<0||t<=r){r-=n,n=-n;break}}}function ig(s,e,t){const n=new Vm;t.forEach(function(o){n.put(o.mode.bit,4),n.put(o.getLength(),Xm.getCharCountIndicator(o.mode,s)),o.write(n)});const r=Ur.getSymbolTotalCodewords(s),i=ms.getTotalCodewordsCount(s,e),u=(r-i)*8;for(n.getLengthInBits()+4<=u&&n.put(0,4);n.getLengthInBits()%8!==0;)n.putBit(0);const a=(u-n.getLengthInBits())/8;for(let o=0;o<a;o++)n.put(o%2?17:236,8);return ug(n,s,e)}function ug(s,e,t){const n=Ur.getSymbolTotalCodewords(e),r=ms.getTotalCodewordsCount(e,t),i=n-r,u=ms.getBlocksCount(e,t),a=n%u,o=u-a,l=Math.floor(n/u),c=Math.floor(i/u),f=c+1,h=l-c,d=new Jm(h);let p=0;const g=new Array(u),C=new Array(u);let b=0;const A=new Uint8Array(s.buffer);for(let T=0;T<u;T++){const P=T<o?c:f;g[T]=A.slice(p,p+P),C[T]=d.encode(g[T]),p+=P,b=Math.max(b,P)}const E=new Uint8Array(n);let B=0,k,F;for(k=0;k<b;k++)for(F=0;F<u;F++)k<g[F].length&&(E[B++]=g[F][k]);for(k=0;k<h;k++)for(F=0;F<u;F++)E[B++]=C[F][k];return E}function og(s,e,t,n){let r;if(Array.isArray(s))r=ns.fromArray(s);else if(typeof s=="string"){let l=e;if(!l){const c=ns.rawSplit(s);l=kr.getBestVersionForData(c,t)}r=ns.fromString(s,l||40)}else throw new Error("Invalid data");const i=kr.getBestVersionForData(r,t);if(!i)throw new Error("The amount of data is too big to be stored in a QR Code");if(!e)e=i;else if(e<i)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+i+`.
`);const u=ig(e,t,r),a=Ur.getSymbolSize(e),o=new Qm(a);return eg(o,e),tg(o),ng(o,e),rs(o,t,0),e>=7&&rg(o,e),sg(o,u),isNaN(n)&&(n=ps.getBestMask(o,rs.bind(null,o,t))),ps.applyMask(n,o),rs(o,t,n),{modules:o,version:e,errorCorrectionLevel:t,maskPattern:n,segments:r}}ba.create=function(e,t){if(typeof e>"u"||e==="")throw new Error("No input text");let n=ts.M,r,i;return typeof t<"u"&&(n=ts.from(t.errorCorrectionLevel,ts.M),r=kr.from(t.version),i=ps.from(t.maskPattern),t.toSJISFunc&&Ur.setToSJISFunction(t.toSJISFunc)),og(e,r,n,i)};var Ia={},Rs={};(function(s){function e(t){if(typeof t=="number"&&(t=t.toString()),typeof t!="string")throw new Error("Color should be defined as hex string");let n=t.slice().replace("#","").split("");if(n.length<3||n.length===5||n.length>8)throw new Error("Invalid hex color: "+t);(n.length===3||n.length===4)&&(n=Array.prototype.concat.apply([],n.map(function(i){return[i,i]}))),n.length===6&&n.push("F","F");const r=parseInt(n.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:r&255,hex:"#"+n.slice(0,6).join("")}}s.getOptions=function(n){n||(n={}),n.color||(n.color={});const r=typeof n.margin>"u"||n.margin===null||n.margin<0?4:n.margin,i=n.width&&n.width>=21?n.width:void 0,u=n.scale||4;return{width:i,scale:i?4:u,margin:r,color:{dark:e(n.color.dark||"#000000ff"),light:e(n.color.light||"#ffffffff")},type:n.type,rendererOpts:n.rendererOpts||{}}},s.getScale=function(n,r){return r.width&&r.width>=n+r.margin*2?r.width/(n+r.margin*2):r.scale},s.getImageWidth=function(n,r){const i=s.getScale(n,r);return Math.floor((n+r.margin*2)*i)},s.qrToImageData=function(n,r,i){const u=r.modules.size,a=r.modules.data,o=s.getScale(u,i),l=Math.floor((u+i.margin*2)*o),c=i.margin*o,f=[i.color.light,i.color.dark];for(let h=0;h<l;h++)for(let d=0;d<l;d++){let p=(h*l+d)*4,g=i.color.light;if(h>=c&&d>=c&&h<l-c&&d<l-c){const C=Math.floor((h-c)/o),b=Math.floor((d-c)/o);g=f[a[C*u+b]?1:0]}n[p++]=g.r,n[p++]=g.g,n[p++]=g.b,n[p]=g.a}}})(Rs);(function(s){const e=Rs;function t(r,i,u){r.clearRect(0,0,i.width,i.height),i.style||(i.style={}),i.height=u,i.width=u,i.style.height=u+"px",i.style.width=u+"px"}function n(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}s.render=function(i,u,a){let o=a,l=u;typeof o>"u"&&(!u||!u.getContext)&&(o=u,u=void 0),u||(l=n()),o=e.getOptions(o);const c=e.getImageWidth(i.modules.size,o),f=l.getContext("2d"),h=f.createImageData(c,c);return e.qrToImageData(h.data,i,o),t(f,l,c),f.putImageData(h,0,0),l},s.renderToDataURL=function(i,u,a){let o=a;typeof o>"u"&&(!u||!u.getContext)&&(o=u,u=void 0),o||(o={});const l=s.render(i,u,o),c=o.type||"image/png",f=o.rendererOpts||{};return l.toDataURL(c,f.quality)}})(Ia);var Pa={};const ag=Rs;function Qu(s,e){const t=s.a/255,n=e+'="'+s.hex+'"';return t<1?n+" "+e+'-opacity="'+t.toFixed(2).slice(1)+'"':n}function ss(s,e,t){let n=s+e;return typeof t<"u"&&(n+=" "+t),n}function lg(s,e,t){let n="",r=0,i=!1,u=0;for(let a=0;a<s.length;a++){const o=Math.floor(a%e),l=Math.floor(a/e);!o&&!i&&(i=!0),s[a]?(u++,a>0&&o>0&&s[a-1]||(n+=i?ss("M",o+t,.5+l+t):ss("m",r,0),r=0,i=!1),o+1<e&&s[a+1]||(n+=ss("h",u),u=0)):r++}return n}Pa.render=function(e,t,n){const r=ag.getOptions(t),i=e.modules.size,u=e.modules.data,a=i+r.margin*2,o=r.color.light.a?"<path "+Qu(r.color.light,"fill")+' d="M0 0h'+a+"v"+a+'H0z"/>':"",l="<path "+Qu(r.color.dark,"stroke")+' d="'+lg(u,i,r.margin)+'"/>',c='viewBox="0 0 '+a+" "+a+'"',h='<svg xmlns="http://www.w3.org/2000/svg" '+(r.width?'width="'+r.width+'" height="'+r.width+'" ':"")+c+' shape-rendering="crispEdges">'+o+l+`</svg>
`;return typeof n=="function"&&n(null,h),h};const cg=Am,gs=ba,Ra=Ia,fg=Pa;function Os(s,e,t,n,r){const i=[].slice.call(arguments,1),u=i.length,a=typeof i[u-1]=="function";if(!a&&!cg())throw new Error("Callback required as last argument");if(a){if(u<2)throw new Error("Too few arguments provided");u===2?(r=t,t=e,e=n=void 0):u===3&&(e.getContext&&typeof r>"u"?(r=n,n=void 0):(r=n,n=t,t=e,e=void 0))}else{if(u<1)throw new Error("Too few arguments provided");return u===1?(t=e,e=n=void 0):u===2&&!e.getContext&&(n=t,t=e,e=void 0),new Promise(function(o,l){try{const c=gs.create(t,n);o(s(c,e,n))}catch(c){l(c)}})}try{const o=gs.create(t,n);r(null,s(o,e,n))}catch(o){r(o)}}tr.create=gs.create;tr.toCanvas=Os.bind(null,Ra.render);tr.toDataURL=Os.bind(null,Ra.renderToDataURL);tr.toString=Os.bind(null,function(s,e,t){return fg.render(s,t)});function hg(s){let e,t;return{c(){e=D("div"),y(e,"id","qrcode")},m(n,r){w(n,e,r),s[3](e)},p:N,i(n){t||An(()=>{t=Ka(e,Pf,{duration:300}),t.start()})},o:N,d(n){n&&_(e),s[3](null)}}}function dg(s,e,t){let{codeValue:n}=e,{squareSize:r}=e,i,u;pt(async()=>{u=await tr.toCanvas(n,{width:r,small:!0,color:{dark:"#000000",light:"#ffffff"}}),i.appendChild(u)}),Va(()=>{u&&u.remove()});function a(o){Fr[o?"unshift":"push"](()=>{i=o,t(0,i)})}return s.$$set=o=>{"codeValue"in o&&t(1,n=o.codeValue),"squareSize"in o&&t(2,r=o.squareSize)},[i,n,r,a]}class pg extends Z{constructor(e){super(),X(this,e,dg,hg,J,{codeValue:1,squareSize:2})}}function Gu(s){let e,t,n,r,i,u,a,o,l,c,f,h,d,p,g,C,b=s[2]&&Yu();function A(F,T){return F[3]?gg:mg}let E=A(s),B=E(s),k=s[3]&&Ju(s);return{c(){e=D("p"),t=D("strong"),t.textContent="Your invitation URL is:",n=I(),r=D("span"),i=L(s[1]),u=I(),b&&b.c(),a=I(),o=D("button"),o.textContent="Copy URL to clipboard",l=I(),c=D("button"),B.c(),f=L(`
        QR code`),h=I(),k&&k.c(),d=ie(),y(r,"class","break-all"),y(e,"class","py-2")},m(F,T){w(F,e,T),m(e,t),m(e,n),m(e,r),m(r,i),m(e,u),b&&b.m(e,null),w(F,a,T),w(F,o,T),w(F,l,T),w(F,c,T),B.m(c,null),m(c,f),w(F,h,T),k&&k.m(F,T),w(F,d,T),p=!0,g||(C=[j(o,"click",s[5]),j(c,"click",s[6])],g=!0)},p(F,T){(!p||T&2)&&re(i,F[1]),F[2]?b||(b=Yu(),b.c(),b.m(e,null)):b&&(b.d(1),b=null),E!==(E=A(F))&&(B.d(1),B=E(F),B&&(B.c(),B.m(c,f))),F[3]?k?(k.p(F,T),T&8&&v(k,1)):(k=Ju(F),k.c(),v(k,1),k.m(d.parentNode,d)):k&&(V(),S(k,1,1,()=>{k=null}),Q())},i(F){p||(v(k),p=!0)},o(F){S(k),p=!1},d(F){F&&_(e),b&&b.d(),F&&_(a),F&&_(o),F&&_(l),F&&_(c),B.d(),F&&_(h),k&&k.d(F),F&&_(d),g=!1,ge(C)}}}function Yu(s){let e;return{c(){e=D("span"),e.innerHTML="<strong>URL copied to clipboard!</strong>"},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function mg(s){let e;return{c(){e=L("Show")},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function gg(s){let e;return{c(){e=L("Hide")},m(t,n){w(t,e,n)},d(t){t&&_(e)}}}function Ju(s){let e,t,n;return t=new pg({props:{codeValue:s[1],squareSize:s[0]}}),{c(){e=D("div"),U(t.$$.fragment),y(e,"id","qrcodeContainer"),y(e,"class","ml-1/5 svelte-tchhkp")},m(r,i){w(r,e,i),z(t,e,null),n=!0},p(r,i){const u={};i&2&&(u.codeValue=r[1]),i&1&&(u.squareSize=r[0]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function Dg(s){let e,t,n,r,i,u,a=s[1]&&Gu(s);return{c(){e=D("div"),t=D("button"),t.textContent="Generate Invitation URL",n=I(),a&&a.c()},m(o,l){w(o,e,l),m(e,t),m(e,n),a&&a.m(e,null),r=!0,i||(u=j(t,"click",s[4]),i=!0)},p(o,[l]){o[1]?a?(a.p(o,l),l&2&&v(a,1)):(a=Gu(o),a.c(),v(a,1),a.m(e,null)):a&&(V(),S(a,1,1,()=>{a=null}),Q())},i(o){r||(v(a),r=!0)},o(o){S(a),r=!1},d(o){o&&_(e),a&&a.d(),i=!1,u()}}}function bg(s,e,t){let n;pt(()=>{t(0,n=window.innerWidth*.4),window.addEventListener("resize",()=>{t(0,n=window.innerWidth*.4)})});let r="",i=!1,u=!1,a;tt.subscribe(h=>{a=h.settings});let o;Vn.subscribe(h=>{o=h});async function l(){const h=await vf(o.shareAddress,a.servers,o.secret);typeof h=="string"?t(1,r=h):console.error("Failed to create invitation URL:",h)}async function c(){try{await navigator.clipboard.writeText(r),t(2,i=!0)}catch(h){console.error("Failed to copy text: ",h)}}function f(){t(3,u=!u)}return[n,r,i,u,l,c,f]}class wg extends Z{constructor(e){super(),X(this,e,bg,Dg,J,{})}}function _g(s){let e,t,n,r;return e=new Cm({}),n=new wg({}),{c(){U(e.$$.fragment),t=I(),U(n.$$.fragment)},m(i,u){z(e,i,u),w(i,t,u),z(n,i,u),r=!0},p:N,i(i){r||(v(e.$$.fragment,i),v(n.$$.fragment,i),r=!0)},o(i){S(e.$$.fragment,i),S(n.$$.fragment,i),r=!1},d(i){H(e,i),i&&_(t),H(n,i)}}}class yg extends Z{constructor(e){super(),X(this,e,null,_g,J,{})}}function Zu(s){let e,t,n;return t=new dm({}),{c(){e=D("div"),U(t.$$.fragment)},m(r,i){w(r,e,i),z(t,e,null),n=!0},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function Xu(s){let e,t,n;return t=new gm({}),{c(){e=D("div"),U(t.$$.fragment)},m(r,i){w(r,e,i),z(t,e,null),n=!0},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function eo(s){let e,t,n;return t=new yg({}),{c(){e=D("div"),U(t.$$.fragment)},m(r,i){w(r,e,i),z(t,e,null),n=!0},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function Cg(s){let e,t,n,r,i,u,a,o,l,c,f,h,d,p,g,C,b,A,E,B,k,F=s[1]==="share"&&Zu(),T=s[1]==="server"&&Xu(),P=s[1]==="invitation"&&eo();return C=new th({}),A=new nm({props:{status:s[0]}}),{c(){e=D("div"),t=D("button"),t.textContent="Hide Details",n=I(),r=D("div"),i=D("div"),u=D("button"),u.textContent="Show Share Settings",a=I(),o=D("button"),o.textContent="Show Server Settings",l=I(),c=D("button"),c.textContent="Show Invitation URL",f=I(),F&&F.c(),h=I(),T&&T.c(),d=I(),P&&P.c(),p=I(),g=D("div"),U(C.$$.fragment),b=I(),U(A.$$.fragment),y(t,"class","h-auto m-6"),y(e,"class","w-screen flex flex-row justify-end"),y(u,"class","my-1"),it(u,"phase2",s[1]==="share"),y(o,"class","my-1"),it(o,"phase2",s[1]==="server"),y(c,"class","my-1"),it(c,"phase2",s[1]==="invitation"),y(i,"class","mx-1 mt-12 w-1/5 paper-yellow flex flex-col p-8 h-[80vh] sticky top-0"),y(g,"class","py-12 px-2 flex flex-row justify-center w-4/5 items-start"),y(r,"class","flex min-h-screen overflow-y-auto")},m(R,$){w(R,e,$),m(e,t),w(R,n,$),w(R,r,$),m(r,i),m(i,u),m(i,a),m(i,o),m(i,l),m(i,c),m(i,f),F&&F.m(i,null),m(i,h),T&&T.m(i,null),m(i,d),P&&P.m(i,null),m(r,p),m(r,g),z(C,g,null),m(g,b),z(A,g,null),E=!0,B||(k=[j(t,"click",s[2]),j(u,"click",s[3]),j(o,"click",s[4]),j(c,"click",s[5])],B=!0)},p(R,[$]){(!E||$&2)&&it(u,"phase2",R[1]==="share"),(!E||$&2)&&it(o,"phase2",R[1]==="server"),(!E||$&2)&&it(c,"phase2",R[1]==="invitation"),R[1]==="share"?F?$&2&&v(F,1):(F=Zu(),F.c(),v(F,1),F.m(i,h)):F&&(V(),S(F,1,1,()=>{F=null}),Q()),R[1]==="server"?T?$&2&&v(T,1):(T=Xu(),T.c(),v(T,1),T.m(i,d)):T&&(V(),S(T,1,1,()=>{T=null}),Q()),R[1]==="invitation"?P?$&2&&v(P,1):(P=eo(),P.c(),v(P,1),P.m(i,null)):P&&(V(),S(P,1,1,()=>{P=null}),Q());const W={};$&1&&(W.status=R[0]),A.$set(W)},i(R){E||(v(F),v(T),v(P),v(C.$$.fragment,R),v(A.$$.fragment,R),E=!0)},o(R){S(F),S(T),S(P),S(C.$$.fragment,R),S(A.$$.fragment,R),E=!1},d(R){R&&_(e),R&&_(n),R&&_(r),F&&F.d(),T&&T.d(),P&&P.d(),H(C),H(A),B=!1,ge(k)}}}function Ag(s,e,t){let{status:n}=e,r=null;const i=rt();function u(){i("toggle")}const a=()=>t(1,r="share"),o=()=>t(1,r="server"),l=()=>t(1,r="invitation");return s.$$set=c=>{"status"in c&&t(0,n=c.status)},[n,r,u,a,o,l]}class Eg extends Z{constructor(e){super(),X(this,e,Ag,Cg,J,{status:0})}}function to(s){let e,t,n,r,i,u,a,o,l,c;r=new bp({}),r.$on("validated",s[5]),r.$on("error",s[6]),r.$on("generateNewIdentity",s[11]),a=new Wf({}),a.$on("alias",s[5]),a.$on("error",s[6]);let f=s[2]===!0&&no();return{c(){e=D("div"),t=D("div"),n=D("div"),U(r.$$.fragment),i=I(),u=D("div"),U(a.$$.fragment),o=I(),f&&f.c(),l=ie(),y(u,"class","mb-8"),y(n,"class","flex flex-col items-start mx-6 my-12"),y(t,"class","flex flex-col lg:flex-row items-center mx-2 justify-between my-12"),y(e,"class","my-12")},m(h,d){w(h,e,d),m(e,t),m(t,n),z(r,n,null),m(n,i),m(n,u),z(a,u,null),w(h,o,d),f&&f.m(h,d),w(h,l,d),c=!0},p(h,d){h[2]===!0?f?d&4&&v(f,1):(f=no(),f.c(),v(f,1),f.m(l.parentNode,l)):f&&(V(),S(f,1,1,()=>{f=null}),Q())},i(h){c||(v(r.$$.fragment,h),v(a.$$.fragment,h),v(f),c=!0)},o(h){S(r.$$.fragment,h),S(a.$$.fragment,h),S(f),c=!1},d(h){h&&_(e),H(r),H(a),h&&_(o),f&&f.d(h),h&&_(l)}}}function no(s){let e,t,n;return{c(){e=D("blockquote"),e.textContent="There was an error with your identity file"},m(r,i){w(r,e,i),n=!0},i(r){n||(An(()=>{t||(t=Mt(e,Lt,{y:200,duration:2e3},!0)),t.run(1)}),n=!0)},o(r){t||(t=Mt(e,Lt,{y:200,duration:2e3},!1)),t.run(0),n=!1},d(r){r&&_(e),r&&t&&t.end()}}}function vg(s){let e,t,n;return t=new Eg({props:{status:s[4]}}),t.$on("toggle",s[9]),{c(){e=D("div"),U(t.$$.fragment),y(e,"class","w-full")},m(r,i){w(r,e,i),z(t,e,null),n=!0},p(r,i){const u={};i&16&&(u.status=r[4]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function kg(s){let e,t,n;return t=new Xp({props:{inStudio:s[7],showDetails:s[1],IDcreated:s[0]}}),t.$on("toggle",s[9]),t.$on("view",s[8]),t.$on("details",s[12]),{c(){e=D("div"),U(t.$$.fragment),y(e,"class","w-full")},m(r,i){w(r,e,i),z(t,e,null),n=!0},p(r,i){const u={};i&2&&(u.showDetails=r[1]),i&1&&(u.IDcreated=r[0]),t.$set(u)},i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){r&&_(e),H(t)}}}function Fg(s){let e,t,n,r,i,u=!s[0]&&!s[1]&&to(s);const a=[kg,vg],o=[];function l(c,f){return c[0]&&!c[3]?0:1}return n=l(s),r=o[n]=a[n](s),{c(){e=D("main"),u&&u.c(),t=I(),r.c(),y(e,"class","svelte-l2iqfv")},m(c,f){w(c,e,f),u&&u.m(e,null),m(e,t),o[n].m(e,null),i=!0},p(c,[f]){!c[0]&&!c[1]?u?(u.p(c,f),f&3&&v(u,1)):(u=to(c),u.c(),v(u,1),u.m(e,t)):u&&(V(),S(u,1,1,()=>{u=null}),Q());let h=n;n=l(c),n===h?o[n].p(c,f):(V(),S(o[h],1,1,()=>{o[h]=null}),Q(),r=o[n],r?r.p(c,f):(r=o[n]=a[n](c),r.c()),v(r,1),r.m(e,null))},i(c){i||(v(u),v(r),i=!0)},o(c){S(u),S(r),i=!1},d(c){c&&_(e),u&&u.d(),o[n].d()}}}function Bg(s,e,t){let n;Be(s,Tt,F=>t(13,n=F));let r=!1,i=!1,u=!0,a=!1,o=!1,l;const c=new Xn;c.addReplica(n.replica);const f=c.sync("https://earthstar-server.fly.dev/sync",!0),h=c.sync("https://languid-sand-parallelogram.glitch.me/",!0);f.onStatusChange(F=>{t(4,l=F),console.log(F),t(4,l)}),h.onStatusChange(F=>{t(4,l=F),console.log(F),t(4,l)}),f.isDone().then(()=>{console.log("Sync complete")}).catch(F=>{console.error("Sync failed",F)});function d(F){t(0,r=!0),t(1,i=!0)}function p(F){t(2,a=!0)}const g=new URLSearchParams(window.location.search),C=g.has("studio"),b=g.has("oracle");function A(){t(10,u=!u)}function E(){t(3,o=!o)}const B=()=>t(0,r=!r),k=()=>t(3,o=!0);return s.$$.update=()=>{s.$$.dirty&1&&console.log("IDcreated",r),s.$$.dirty&2&&console.log("showDetails",i),s.$$.dirty&1024&&console.log("imageView",u)},console.log("inStudio",C),console.log("oracle",b),[r,i,a,o,l,d,p,C,A,E,u,B,k]}class Sg extends Z{constructor(e){super(),X(this,e,Bg,Fg,J,{})}}new Sg({target:document.getElementById("app")});
