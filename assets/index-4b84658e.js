var Fr=Object.defineProperty;var Tr=(q,_,M)=>_ in q?Fr(q,_,{enumerable:!0,configurable:!0,writable:!0,value:M}):q[_]=M;var $t=(q,_,M)=>(Tr(q,typeof _!="symbol"?_+"":_,M),M),mn=(q,_,M)=>{if(!_.has(q))throw TypeError("Cannot "+M)};var we=(q,_,M)=>(mn(q,_,"read from private field"),M?M.call(q):_.get(q)),Ze=(q,_,M)=>{if(_.has(q))throw TypeError("Cannot add the same private member more than once");_ instanceof WeakSet?_.add(q):_.set(q,M)},dt=(q,_,M,$)=>(mn(q,_,"write to private field"),$?$.call(q,M):_.set(q,M),M),Wt=(q,_,M,$)=>({set _(j){dt(q,_,j,M)},get _(){return we(q,_,$)}}),st=(q,_,M)=>(mn(q,_,"access private method"),M);import{c as commonjsGlobal,r as require$$5,g as getDefaultExportFromCjs,n as nodeCrypto,i as identity,a as noop,s as subscribe,b as run_all,d as safe_not_equal,e as is_function,S as SvelteComponent,f as init,h as element,j as space,k as set_style,l as attr,m as insert,o as append,p as listen,q as detach,t as createEventDispatcher,u as binding_callbacks,v as create_component,w as text,x as mount_component,y as transition_in,z as group_outros,A as transition_out,B as check_outros,C as set_data,D as destroy_component,E as component_subscribe,F as onMount,G as add_render_callback,H as create_in_transition,I as create_bidirectional_transition,J as set_input_value,K as bubble,L as update_keyed_each,M as destroy_block,N as empty,O as toggle_class,P as compute_rest_props,Q as assign,R as exclude_internal_props,T as destroy_each,U as get_spread_update,V as get_spread_object,W as construct_svelte_component,X as getContext,Y as create_slot,Z as update_slot_base,_ as get_all_dirty_from_scope,$ as get_slot_changes,a0 as src_url_equal,a1 as HtmlTag,a2 as setContext,a3 as null_to_empty,a4 as create_out_transition,a5 as onDestroy,a6 as globals,a7 as tick,a8 as svg_element,a9 as handle_promise,aa as update_await_block_branch,ab as self$1,ac as outro_and_destroy_block,ad as select_option,ae as get_store_value,af as select_value,ag as afterUpdate}from"./svelte-5d71e690.js";function _mergeNamespaces(q,_){for(var M=0;M<_.length;M++){const $=_[M];if(typeof $!="string"&&!Array.isArray($)){for(const j in $)if(j!=="default"&&!(j in q)){const z=Object.getOwnPropertyDescriptor($,j);z&&Object.defineProperty(q,j,z.get?z:{enumerable:!0,get:()=>$[j]})}}}return Object.freeze(Object.defineProperty(q,Symbol.toStringTag,{value:"Module"}))}(function(){const _=document.createElement("link").relList;if(_&&_.supports&&_.supports("modulepreload"))return;for(const j of document.querySelectorAll('link[rel="modulepreload"]'))$(j);new MutationObserver(j=>{for(const z of j)if(z.type==="childList")for(const V of z.addedNodes)V.tagName==="LINK"&&V.rel==="modulepreload"&&$(V)}).observe(document,{childList:!0,subtree:!0});function M(j){const z={};return j.integrity&&(z.integrity=j.integrity),j.referrerPolicy&&(z.referrerPolicy=j.referrerPolicy),j.crossOrigin==="use-credentials"?z.credentials="include":j.crossOrigin==="anonymous"?z.credentials="omit":z.credentials="same-origin",z}function $(j){if(j.ep)return;j.ep=!0;const z=M(j);fetch(j.href,z)}})();const app="";class EarthstarError extends Error{constructor(_){super(_||""),this.name="EarthstarError"}}class ValidationError extends EarthstarError{constructor(_){super(_||"Validation error"),this.name="ValidationError"}}class ReplicaIsClosedError extends EarthstarError{constructor(_){super(_||"a Replica or ReplicaDriver was used after being closed"),this.name="ReplicaIsClosedError"}}class ReplicaCacheIsClosedError extends EarthstarError{constructor(_){super(_||"a ReplicaCache was used after being closed"),this.name="ReplicaCacheIsClosedError"}}class NotSupportedError extends EarthstarError{constructor(_){super(_||"Not supported"),this.name="NotSupportedError"}}function isErr(q){return q instanceof EarthstarError}function notErr(q){return!(q instanceof EarthstarError)}var dist$2={},crypto_types_gen={};Object.defineProperty(crypto_types_gen,"__esModule",{value:!0});(function(q){var _=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(z,V,X,G){G===void 0&&(G=X);var Y=Object.getOwnPropertyDescriptor(V,X);(!Y||("get"in Y?!V.__esModule:Y.writable||Y.configurable))&&(Y={enumerable:!0,get:function(){return V[X]}}),Object.defineProperty(z,G,Y)}:function(z,V,X,G){G===void 0&&(G=X),z[G]=V[X]}),M=commonjsGlobal&&commonjsGlobal.__exportStar||function(z,V){for(var X in z)X!=="default"&&!Object.prototype.hasOwnProperty.call(V,X)&&_(V,z,X)};Object.defineProperty(q,"__esModule",{value:!0}),q.crypto=void 0;const j=require$$5.webcrypto;q.crypto=j,M(crypto_types_gen,q)})(dist$2);var dist$1={};Object.defineProperty(dist$1,"__esModule",{value:!0});var setInterval_1=dist$1.setInterval=setTimeout_1=dist$1.setTimeout=void 0;const originalSetTimeout=globalThis.setTimeout;function setTimeout$1(q,_,...M){const $=originalSetTimeout(q,_,...M);return typeof $=="number"?$:$[Symbol.toPrimitive]()}var setTimeout_1=dist$1.setTimeout=setTimeout$1;const originalSetInterval=globalThis.setInterval;function setInterval$1(q,_,...M){const $=originalSetInterval(q,_,...M);return typeof $=="number"?$:$[Symbol.toPrimitive]()}setInterval_1=dist$1.setInterval=setInterval$1;var dist={},_a$2,_b;Object.defineProperty(dist,"__esModule",{value:!0});var WeakRef_1=dist.WeakRef=void 0;WeakRef_1=dist.WeakRef=(_a$2=globalThis.WeakRef)!==null&&_a$2!==void 0?_a$2:(_b=class{constructor(_){}deref(){throw new Error("WeakRef is not supported in Node 14 and below.")}},_b);const{Blob:Blob$1}=window,{Request,Response,Headers:Headers$1,fetch:fetch$1}=window,{ReadableStream:ReadableStream$1,ReadableStreamDefaultReader,ReadableStreamBYOBReader,ReadableStreamBYOBRequest,ReadableByteStreamController,ReadableStreamDefaultController,TransformStream,TransformStreamDefaultController,WritableStream,WritableStreamDefaultWriter,WritableStreamDefaultController,ByteLengthQueuingStrategy,CountQueuingStrategy,TextEncoderStream,TextDecoderStream}=window;if(!ReadableStream$1.prototype[Symbol.asyncIterator]){async function*q(){const _=this.getReader();try{for(;;){const{done:M,value:$}=await _.read();if(M)return;yield $}}finally{_.releaseLock()}}ReadableStream$1.prototype[Symbol.asyncIterator]=q}var ws=null;typeof WebSocket<"u"?ws=WebSocket:typeof MozWebSocket<"u"?ws=MozWebSocket:typeof global<"u"?ws=global.WebSocket||global.MozWebSocket:typeof window<"u"?ws=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(ws=self.WebSocket||self.MozWebSocket);const WebSocket$1=ws,{TextDecoder:TextDecoder$1,TextEncoder}=window;function u(q,_){for(var M=0;M<_.length;M++){var $=_[M];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(q,$.key,$)}}function D(q,_,M){return _&&u(q.prototype,_),M&&u(q,M),q}function t(q,_){(_==null||_>q.length)&&(_=q.length);for(var M=0,$=new Array(_);M<_;M++)$[M]=q[M];return $}function F(q,_){var M=typeof Symbol<"u"&&q[Symbol.iterator]||q["@@iterator"];if(M)return(M=M.call(q)).next.bind(M);if(Array.isArray(q)||(M=function(j,z){if(j){if(typeof j=="string")return t(j,z);var V=Object.prototype.toString.call(j).slice(8,-1);return V==="Object"&&j.constructor&&(V=j.constructor.name),V==="Map"||V==="Set"?Array.from(j):V==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(V)?t(j,z):void 0}}(q))||_&&q&&typeof q.length=="number"){M&&(q=M);var $=0;return function(){return $>=q.length?{done:!0}:{done:!1,value:q[$++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var e=/(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDEC0-\uDEEB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/,C=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/;function A(q,_){return(_?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(q)}function E(q,_){_===void 0&&(_=!1);for(var M=[],$=0;$<q.length;){var j=q[$],z=function(Z){if(!_)throw new TypeError(Z);M.push({type:"INVALID_CHAR",index:$,value:q[$++]})};if(j!=="*")if(j!=="+"&&j!=="?")if(j!=="\\")if(j!=="{")if(j!=="}")if(j!==":")if(j!=="(")M.push({type:"CHAR",index:$,value:q[$++]});else{var V=1,X="",G=$+1,Y=!1;if(q[G]==="?"){z('Pattern cannot start with "?" at '+G);continue}for(;G<q.length;){if(!A(q[G],!1)){z("Invalid character '"+q[G]+"' at "+G+"."),Y=!0;break}if(q[G]!=="\\"){if(q[G]===")"){if(--V==0){G++;break}}else if(q[G]==="("&&(V++,q[G+1]!=="?")){z("Capturing groups are not allowed at "+G),Y=!0;break}X+=q[G++]}else X+=q[G++]+q[G++]}if(Y)continue;if(V){z("Unbalanced pattern at "+$);continue}if(!X){z("Missing pattern at "+$);continue}M.push({type:"PATTERN",index:$,value:X}),$=G}else{for(var Q="",ee=$+1;ee<q.length;){var te=q.substr(ee,1);if(!(ee===$+1&&e.test(te)||ee!==$+1&&C.test(te)))break;Q+=q[ee++]}if(!Q){z("Missing parameter name at "+$);continue}M.push({type:"NAME",index:$,value:Q}),$=ee}else M.push({type:"CLOSE",index:$,value:q[$++]});else M.push({type:"OPEN",index:$,value:q[$++]});else M.push({type:"ESCAPED_CHAR",index:$++,value:q[$++]});else M.push({type:"MODIFIER",index:$,value:q[$++]});else M.push({type:"ASTERISK",index:$,value:q[$++]})}return M.push({type:"END",index:$,value:""}),M}function n(q,_){_===void 0&&(_={});for(var M=E(q),$=_.prefixes,j=$===void 0?"./":$,z="[^"+r(_.delimiter||"/#?")+"]+?",V=[],X=0,G=0,Y="",Q=new Set,ee=function(ye){if(G<M.length&&M[G].type===ye)return M[G++].value},te=function(){return ee("MODIFIER")||ee("ASTERISK")},Z=function(ye){var _e=ee(ye);if(_e!==void 0)return _e;var De=M[G];throw new TypeError("Unexpected "+De.type+" at "+De.index+", expected "+ye)},ne=function(){for(var ye,_e="";ye=ee("CHAR")||ee("ESCAPED_CHAR");)_e+=ye;return _e},re=_.encodePart||function(ye){return ye};G<M.length;){var se=ee("CHAR"),ie=ee("NAME"),oe=ee("PATTERN");if(ie||oe||!ee("ASTERISK")||(oe=".*"),ie||oe){var ue=se||"";j.indexOf(ue)===-1&&(Y+=ue,ue=""),Y&&(V.push(re(Y)),Y="");var ce=ie||X++;if(Q.has(ce))throw new TypeError("Duplicate name '"+ce+"'.");Q.add(ce),V.push({name:ce,prefix:re(ue),suffix:"",pattern:oe||z,modifier:te()||""})}else{var ae=se||ee("ESCAPED_CHAR");if(ae)Y+=ae;else if(ee("OPEN")){var le=ne(),he=ee("NAME")||"",ge=ee("PATTERN")||"";he||ge||!ee("ASTERISK")||(ge=".*");var de=ne();Z("CLOSE");var pe=te()||"";if(!he&&!ge&&!pe){Y+=le;continue}if(!he&&!ge&&!le)continue;Y&&(V.push(re(Y)),Y=""),V.push({name:he||(ge?X++:""),pattern:he&&!ge?z:ge,prefix:re(le),suffix:re(de),modifier:pe})}else Y&&(V.push(re(Y)),Y=""),Z("END")}}return V}function r(q){return q.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function i(q){return q&&q.sensitive?"u":"ui"}function s(q,_,M){M===void 0&&(M={});for(var $,j=M.strict,z=j!==void 0&&j,V=M.start,X=V===void 0||V,G=M.end,Y=G===void 0||G,Q=M.encode,ee=Q===void 0?function(ae){return ae}:Q,te="["+r(M.endsWith||"")+"]|$",Z="["+r(M.delimiter||"/#?")+"]",ne=X?"^":"",re=F(q);!($=re()).done;){var se=$.value;if(typeof se=="string")ne+=r(ee(se));else{var ie=r(ee(se.prefix)),oe=r(ee(se.suffix));se.pattern?(_&&_.push(se),ne+=ie||oe?se.modifier==="+"||se.modifier==="*"?"(?:"+ie+"((?:"+se.pattern+")(?:"+oe+ie+"(?:"+se.pattern+"))*)"+oe+")"+(se.modifier==="*"?"?":""):"(?:"+ie+"("+se.pattern+")"+oe+")"+se.modifier:se.modifier==="+"||se.modifier==="*"?"((?:"+se.pattern+")"+se.modifier+")":"("+se.pattern+")"+se.modifier):ne+="(?:"+ie+oe+")"+se.modifier}}if(Y)z||(ne+=Z+"?"),ne+=M.endsWith?"(?="+te+")":"$";else{var ue=q[q.length-1],ce=typeof ue=="string"?Z.indexOf(ue[ue.length-1])>-1:ue===void 0;z||(ne+="(?:"+Z+"(?="+te+"))?"),ce||(ne+="(?="+Z+"|"+te+")")}return new RegExp(ne,i(M))}function a(q,_,M){return q instanceof RegExp?function($,j){if(!j)return $;for(var z=/\((?:\?<(.*?)>)?(?!\?)/g,V=0,X=z.exec($.source);X;)j.push({name:X[1]||V++,prefix:"",suffix:"",modifier:"",pattern:""}),X=z.exec($.source);return $}(q,_):Array.isArray(q)?function($,j,z){var V=$.map(function(X){return a(X,j,z).source});return new RegExp("(?:"+V.join("|")+")",i(z))}(q,_,M):function($,j,z){return s(n($,z),j,z)}(q,_,M)}var B={delimiter:"",prefixes:"",sensitive:!0,strict:!0},o={delimiter:".",prefixes:"",sensitive:!0,strict:!0},h={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function p(q,_){return q.startsWith(_)?q.substring(_.length,q.length):q}function c(q){return!(!q||q.length<2||q[0]!=="["&&(q[0]!=="\\"&&q[0]!=="{"||q[1]!=="["))}var f,l=["ftp","file","http","https","ws","wss"];function m(q){if(!q)return!0;for(var _,M=F(l);!(_=M()).done;)if(q.test(_.value))return!0;return!1}function d(q){switch(q){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function g(q){if(q==="")return q;if(/^[-+.A-Za-z0-9]*$/.test(q))return q.toLowerCase();throw new TypeError("Invalid protocol '"+q+"'.")}function x(q){if(q==="")return q;var _=new URL("https://example.com");return _.username=q,_.username}function S(q){if(q==="")return q;var _=new URL("https://example.com");return _.password=q,_.password}function v(q){if(q==="")return q;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(q))throw new TypeError("Invalid hostname '"+q+"'");var _=new URL("https://example.com");return _.hostname=q,_.hostname}function y(q){if(q==="")return q;if(/[^0-9a-fA-F[\]:]/g.test(q))throw new TypeError("Invalid IPv6 hostname '"+q+"'");return q.toLowerCase()}function R(q){if(q===""||/^[0-9]*$/.test(q)&&parseInt(q)<=65535)return q;throw new TypeError("Invalid port '"+q+"'.")}function k(q){if(q==="")return q;var _=new URL("https://example.com");return _.pathname=q[0]!=="/"?"/-"+q:q,q[0]!=="/"?_.pathname.substring(2,_.pathname.length):_.pathname}function w(q){return q===""?q:new URL("data:"+q).pathname}function P(q){if(q==="")return q;var _=new URL("https://example.com");return _.search=q,_.search.substring(1,_.search.length)}function T(q){if(q==="")return q;var _=new URL("https://example.com");return _.hash=q,_.hash.substring(1,_.hash.length)}(function(q){q[q.INIT=0]="INIT",q[q.PROTOCOL=1]="PROTOCOL",q[q.AUTHORITY=2]="AUTHORITY",q[q.USERNAME=3]="USERNAME",q[q.PASSWORD=4]="PASSWORD",q[q.HOSTNAME=5]="HOSTNAME",q[q.PORT=6]="PORT",q[q.PATHNAME=7]="PATHNAME",q[q.SEARCH=8]="SEARCH",q[q.HASH=9]="HASH",q[q.DONE=10]="DONE"})(f||(f={}));var b=function(){function q(M){this.input=void 0,this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=f.INIT,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=M}var _=q.prototype;return _.parse=function(){for(this.tokenList=E(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===f.INIT){this.rewind(),this.isHashPrefix()?this.changeState(f.HASH,1):this.isSearchPrefix()?(this.changeState(f.SEARCH,1),this.internalResult.hash=""):(this.changeState(f.PATHNAME,0),this.internalResult.search="",this.internalResult.hash="");continue}if(this.state===f.AUTHORITY){this.rewindAndSetState(f.HOSTNAME);continue}this.changeState(f.DONE,0);break}if(this.groupDepth>0){if(!this.isGroupClose())continue;this.groupDepth-=1}if(this.isGroupOpen())this.groupDepth+=1;else switch(this.state){case f.INIT:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(f.PROTOCOL));break;case f.PROTOCOL:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();var M=f.PATHNAME,$=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(M=f.AUTHORITY,$=3):this.shouldTreatAsStandardURL&&(M=f.AUTHORITY),this.changeState(M,$)}break;case f.AUTHORITY:this.isIdentityTerminator()?this.rewindAndSetState(f.USERNAME):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(f.HOSTNAME);break;case f.USERNAME:this.isPasswordPrefix()?this.changeState(f.PASSWORD,1):this.isIdentityTerminator()&&this.changeState(f.HOSTNAME,1);break;case f.PASSWORD:this.isIdentityTerminator()&&this.changeState(f.HOSTNAME,1);break;case f.HOSTNAME:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(f.PORT,1):this.isPathnameStart()?this.changeState(f.PATHNAME,0):this.isSearchPrefix()?this.changeState(f.SEARCH,1):this.isHashPrefix()&&this.changeState(f.HASH,1);break;case f.PORT:this.isPathnameStart()?this.changeState(f.PATHNAME,0):this.isSearchPrefix()?this.changeState(f.SEARCH,1):this.isHashPrefix()&&this.changeState(f.HASH,1);break;case f.PATHNAME:this.isSearchPrefix()?this.changeState(f.SEARCH,1):this.isHashPrefix()&&this.changeState(f.HASH,1);break;case f.SEARCH:this.isHashPrefix()&&this.changeState(f.HASH,1)}}},_.changeState=function(M,$){switch(this.state){case f.INIT:break;case f.PROTOCOL:this.internalResult.protocol=this.makeComponentString();break;case f.AUTHORITY:break;case f.USERNAME:this.internalResult.username=this.makeComponentString();break;case f.PASSWORD:this.internalResult.password=this.makeComponentString();break;case f.HOSTNAME:this.internalResult.hostname=this.makeComponentString();break;case f.PORT:this.internalResult.port=this.makeComponentString();break;case f.PATHNAME:this.internalResult.pathname=this.makeComponentString();break;case f.SEARCH:this.internalResult.search=this.makeComponentString();break;case f.HASH:this.internalResult.hash=this.makeComponentString()}this.changeStateWithoutSettingComponent(M,$)},_.changeStateWithoutSettingComponent=function(M,$){this.state=M,this.componentStart=this.tokenIndex+$,this.tokenIndex+=$,this.tokenIncrement=0},_.rewind=function(){this.tokenIndex=this.componentStart,this.tokenIncrement=0},_.rewindAndSetState=function(M){this.rewind(),this.state=M},_.safeToken=function(M){return M<0&&(M=this.tokenList.length-M),M<this.tokenList.length?this.tokenList[M]:this.tokenList[this.tokenList.length-1]},_.isNonSpecialPatternChar=function(M,$){var j=this.safeToken(M);return j.value===$&&(j.type==="CHAR"||j.type==="ESCAPED_CHAR"||j.type==="INVALID_CHAR")},_.isProtocolSuffix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},_.nextIsAuthoritySlashes=function(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")},_.isIdentityTerminator=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")},_.isPasswordPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},_.isPortPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},_.isPathnameStart=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")},_.isSearchPrefix=function(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;var M=this.safeToken(this.tokenIndex-1);return M.type!=="NAME"&&M.type!=="PATTERN"&&M.type!=="CLOSE"&&M.type!=="ASTERISK"},_.isHashPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")},_.isGroupOpen=function(){return this.tokenList[this.tokenIndex].type=="OPEN"},_.isGroupClose=function(){return this.tokenList[this.tokenIndex].type=="CLOSE"},_.isIPv6Open=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")},_.isIPv6Close=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")},_.makeComponentString=function(){var M=this.tokenList[this.tokenIndex],$=this.safeToken(this.componentStart).index;return this.input.substring($,M.index)},_.computeShouldTreatAsStandardURL=function(){var M={};Object.assign(M,B),M.encodePart=g;var $=a(this.makeComponentString(),void 0,M);this.shouldTreatAsStandardURL=m($)},D(q,[{key:"result",get:function(){return this.internalResult}}]),q}(),I=["protocol","username","password","hostname","port","pathname","search","hash"];function O(q,_){if(typeof q!="string")throw new TypeError("parameter 1 is not of type 'string'.");var M=new URL(q,_);return{protocol:M.protocol.substring(0,M.protocol.length-1),username:M.username,password:M.password,hostname:M.hostname,port:M.port,pathname:M.pathname,search:M.search!=""?M.search.substring(1,M.search.length):void 0,hash:M.hash!=""?M.hash.substring(1,M.hash.length):void 0}}function H(q,_,M){var $;if(typeof _.baseURL=="string")try{$=new URL(_.baseURL),q.protocol=$.protocol?$.protocol.substring(0,$.protocol.length-1):"",q.username=$.username,q.password=$.password,q.hostname=$.hostname,q.port=$.port,q.pathname=$.pathname,q.search=$.search?$.search.substring(1,$.search.length):"",q.hash=$.hash?$.hash.substring(1,$.hash.length):""}catch{throw new TypeError("invalid baseURL '"+_.baseURL+"'.")}if(typeof _.protocol=="string"&&(q.protocol=function(z,V){var X;return z=(X=z).endsWith(":")?X.substr(0,X.length-1):X,V||z===""?z:g(z)}(_.protocol,M)),typeof _.username=="string"&&(q.username=function(z,V){if(V||z==="")return z;var X=new URL("https://example.com");return X.username=z,X.username}(_.username,M)),typeof _.password=="string"&&(q.password=function(z,V){if(V||z==="")return z;var X=new URL("https://example.com");return X.password=z,X.password}(_.password,M)),typeof _.hostname=="string"&&(q.hostname=function(z,V){return V||z===""?z:c(z)?y(z):v(z)}(_.hostname,M)),typeof _.port=="string"&&(q.port=function(z,V,X){return d(V)===z&&(z=""),X||z===""?z:R(z)}(_.port,q.protocol,M)),typeof _.pathname=="string"){if(q.pathname=_.pathname,$&&!function(z,V){return!(!z.length||z[0]!=="/"&&(!V||z.length<2||z[0]!="\\"&&z[0]!="{"||z[1]!="/"))}(q.pathname,M)){var j=$.pathname.lastIndexOf("/");j>=0&&(q.pathname=$.pathname.substring(0,j+1)+q.pathname)}q.pathname=function(z,V,X){if(X||z==="")return z;if(V&&!l.includes(V))return new URL(V+":"+z).pathname;var G=z[0]=="/";return z=new URL(G?z:"/-"+z,"https://example.com").pathname,G||(z=z.substring(2,z.length)),z}(q.pathname,q.protocol,M)}return typeof _.search=="string"&&(q.search=function(z,V){if(z=p(z,"?"),V||z==="")return z;var X=new URL("https://example.com");return X.search=z,X.search?X.search.substring(1,X.search.length):""}(_.search,M)),typeof _.hash=="string"&&(q.hash=function(z,V){if(z=p(z,"#"),V||z==="")return z;var X=new URL("https://example.com");return X.hash=z,X.hash?X.hash.substring(1,X.hash.length):""}(_.hash,M)),q}function N(q){return q.replace(/([+*?:{}()\\])/g,"\\$1")}function L(q,_){for(var M="[^"+(_.delimiter||"/#?").replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")+"]+?",$=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/,j="",z=0;z<q.length;++z){var V=q[z],X=z>0?q[z-1]:null,G=z<q.length-1?q[z+1]:null;if(typeof V!="string")if(V.pattern!==""){var Y=typeof V.name!="number",Q=_.prefixes!==void 0?_.prefixes:"./",ee=V.suffix!==""||V.prefix!==""&&(V.prefix.length!==1||!Q.includes(V.prefix));ee||!Y||V.pattern!==M||V.modifier!==""||!G||G.prefix||G.suffix||(ee=typeof G=="string"?$.test(G.length>0?G[0]:""):typeof G.name=="number"),!ee&&V.prefix===""&&X&&typeof X=="string"&&X.length>0&&(ee=Q.includes(X[X.length-1])),ee&&(j+="{"),j+=N(V.prefix),Y&&(j+=":"+V.name),V.pattern===".*"?j+=Y||X&&typeof X!="string"&&!X.modifier&&!ee&&V.prefix===""?"(.*)":"*":V.pattern===M?Y||(j+="("+M+")"):j+="("+V.pattern+")",V.pattern===M&&Y&&V.suffix!==""&&$.test(V.suffix[0])&&(j+="\\"),j+=N(V.suffix),ee&&(j+="}"),j+=V.modifier}else{if(V.modifier===""){j+=N(V.prefix);continue}j+="{"+N(V.prefix)+"}"+V.modifier}else j+=N(V)}return j}var U=function(){function q(M,$){M===void 0&&(M={}),this.pattern=void 0,this.regexp={},this.keys={},this.component_pattern={};try{if(typeof M=="string"){var j=new b(M);if(j.parse(),M=j.result,$){if(typeof $!="string")throw new TypeError("'baseURL' parameter is not of type 'string'.");M.baseURL=$}else if(typeof M.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if($)throw new TypeError("parameter 1 is not of type 'string'.");if(!M||typeof M!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");var z;this.pattern=H({pathname:"*",protocol:"*",username:"*",password:"*",hostname:"*",port:"*",search:"*",hash:"*"},M,!0),d(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");for(var V,X=F(I);!(V=X()).done;)if((z=V.value)in this.pattern){var G={},Y=this.pattern[z];switch(this.keys[z]=[],z){case"protocol":Object.assign(G,B),G.encodePart=g;break;case"username":Object.assign(G,B),G.encodePart=x;break;case"password":Object.assign(G,B),G.encodePart=S;break;case"hostname":Object.assign(G,o),G.encodePart=c(Y)?y:v;break;case"port":Object.assign(G,B),G.encodePart=R;break;case"pathname":m(this.regexp.protocol)?(Object.assign(G,h),G.encodePart=k):(Object.assign(G,B),G.encodePart=w);break;case"search":Object.assign(G,B),G.encodePart=P;break;case"hash":Object.assign(G,B),G.encodePart=T}try{var Q=n(Y,G);this.regexp[z]=s(Q,this.keys[z],G),this.component_pattern[z]=L(Q,G)}catch{throw new TypeError("invalid "+z+" pattern '"+this.pattern[z]+"'.")}}}catch(ee){throw new TypeError("Failed to construct 'URLPattern': "+ee.message)}}var _=q.prototype;return _.test=function(M,$){M===void 0&&(M={});var j,z={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof M!="string"&&$)throw new TypeError("parameter 1 is not of type 'string'.");if(M===void 0)return!1;try{z=H(z,typeof M=="object"?M:O(M,$),!1)}catch{return!1}for(j in this.pattern)if(!this.regexp[j].exec(z[j]))return!1;return!0},_.exec=function(M,$){M===void 0&&(M={});var j={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof M!="string"&&$)throw new TypeError("parameter 1 is not of type 'string'.");if(M!==void 0){try{j=H(j,typeof M=="object"?M:O(M,$),!1)}catch{return null}var z,V={};for(z in V.inputs=$?[M,$]:[M],this.pattern){var X=this.regexp[z].exec(j[z]);if(!X)return null;for(var G,Y={},Q=F(this.keys[z].entries());!(G=Q()).done;){var ee=G.value,te=ee[1];typeof te.name!="string"&&typeof te.name!="number"||(Y[te.name]=X[ee[0]+1]||"")}V[z]={input:j[z]||"",groups:Y}}return V}},D(q,[{key:"protocol",get:function(){return this.component_pattern.protocol}},{key:"username",get:function(){return this.component_pattern.username}},{key:"password",get:function(){return this.component_pattern.password}},{key:"hostname",get:function(){return this.component_pattern.hostname}},{key:"port",get:function(){return this.component_pattern.port}},{key:"pathname",get:function(){return this.component_pattern.pathname}},{key:"search",get:function(){return this.component_pattern.search}},{key:"hash",get:function(){return this.component_pattern.hash}}]),q}();const dntGlobals={crypto:dist$2.crypto,setInterval:setInterval_1,setTimeout:setTimeout_1,WeakRef:WeakRef_1,Blob:Blob$1,Request,Response,Headers:Headers$1,WritableStream,TransformStream,ReadableStream:ReadableStream$1,TransformStreamDefaultController,WritableStreamDefaultWriter,WebSocket:WebSocket$1,TextEncoder,TextDecoder:TextDecoder$1,URLPattern:U},dntGlobalThis=createMergeProxy(globalThis,dntGlobals);function createMergeProxy(q,_){return new Proxy(q,{get(M,$,j){return $ in _?_[$]:q[$]},set(M,$,j){return $ in _&&delete _[$],q[$]=j,!0},deleteProperty(M,$){let j=!1;return $ in _&&(delete _[$],j=!0),$ in q&&(delete q[$],j=!0),j},ownKeys(M){const $=Reflect.ownKeys(q),j=Reflect.ownKeys(_),z=new Set(j);return[...$.filter(V=>!z.has(V)),...j]},defineProperty(M,$,j){return $ in _&&delete _[$],Reflect.defineProperty(q,$,j),!0},getOwnPropertyDescriptor(M,$){return $ in _?Reflect.getOwnPropertyDescriptor(_,$):Reflect.getOwnPropertyDescriptor(q,$)},has(M,$){return $ in _||$ in q}})}function shallowEqualArrays(q,_){if(q===_)return!0;if(!q||!_)return!1;var M=q.length;if(_.length!==M)return!1;for(var $=0;$<M;$++)if(q[$]!==_[$])return!1;return!0}function shallowEqualObjects(q,_){if(q===_)return!0;if(!q||!_)return!1;var M=Object.keys(q),$=Object.keys(_),j=M.length;if($.length!==j)return!1;for(var z=0;z<j;z++){var V=M[z];if(q[V]!==_[V]||!Object.prototype.hasOwnProperty.call(_,V))return!1}return!0}var fastJsonStableStringify=function(q,_){_||(_={}),typeof _=="function"&&(_={cmp:_});var M=typeof _.cycles=="boolean"?_.cycles:!1,$=_.cmp&&function(z){return function(V){return function(X,G){var Y={key:X,value:V[X]},Q={key:G,value:V[G]};return z(Y,Q)}}}(_.cmp),j=[];return function z(V){if(V&&V.toJSON&&typeof V.toJSON=="function"&&(V=V.toJSON()),V!==void 0){if(typeof V=="number")return isFinite(V)?""+V:"null";if(typeof V!="object")return JSON.stringify(V);var X,G;if(Array.isArray(V)){for(G="[",X=0;X<V.length;X++)X&&(G+=","),G+=z(V[X])||"null";return G+"]"}if(V===null)return"null";if(j.indexOf(V)!==-1){if(M)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var Y=j.push(V)-1,Q=Object.keys(V).sort($&&$(V));for(G="",X=0;X<Q.length;X++){var ee=Q[X],te=z(V[ee]);te&&(G&&(G+=","),G+=JSON.stringify(ee)+":"+te)}return j.splice(Y,1),"{"+G+"}"}}(q)};const stringify$1=getDefaultExportFromCjs(fastJsonStableStringify);var lib={};Object.defineProperty(lib,"__esModule",{value:!0});function parse(q,_,M){var $;if(M===void 0&&(M={}),!_.codes){_.codes={};for(var j=0;j<_.chars.length;++j)_.codes[_.chars[j]]=j}if(!M.loose&&q.length*_.bits&7)throw new SyntaxError("Invalid padding");for(var z=q.length;q[z-1]==="=";)if(--z,!M.loose&&!((q.length-z)*_.bits&7))throw new SyntaxError("Invalid padding");for(var V=new(($=M.out)!=null?$:Uint8Array)(z*_.bits/8|0),X=0,G=0,Y=0,Q=0;Q<z;++Q){var ee=_.codes[q[Q]];if(ee===void 0)throw new SyntaxError("Invalid character "+q[Q]);G=G<<_.bits|ee,X+=_.bits,X>=8&&(X-=8,V[Y++]=255&G>>X)}if(X>=_.bits||255&G<<8-X)throw new SyntaxError("Unexpected end of data");return V}function stringify(q,_,M){M===void 0&&(M={});for(var $=M,j=$.pad,z=j===void 0?!0:j,V=(1<<_.bits)-1,X="",G=0,Y=0,Q=0;Q<q.length;++Q)for(Y=Y<<8|255&q[Q],G+=8;G>_.bits;)G-=_.bits,X+=_.chars[V&Y>>G];if(G&&(X+=_.chars[V&Y<<_.bits-G]),z)for(;X.length*_.bits&7;)X+="=";return X}var base16Encoding={chars:"0123456789ABCDEF",bits:4},base32Encoding={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},base32HexEncoding={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},base64Encoding={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},base64UrlEncoding={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},base16$1={parse:function(_,M){return parse(_.toUpperCase(),base16Encoding,M)},stringify:function(_,M){return stringify(_,base16Encoding,M)}},base32$1={parse:function(_,M){return M===void 0&&(M={}),parse(M.loose?_.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):_,base32Encoding,M)},stringify:function(_,M){return stringify(_,base32Encoding,M)}},base32hex$1={parse:function(_,M){return parse(_,base32HexEncoding,M)},stringify:function(_,M){return stringify(_,base32HexEncoding,M)}},base64$1={parse:function(_,M){return parse(_,base64Encoding,M)},stringify:function(_,M){return stringify(_,base64Encoding,M)}},base64url$1={parse:function(_,M){return parse(_,base64UrlEncoding,M)},stringify:function(_,M){return stringify(_,base64UrlEncoding,M)}},codec$2={parse,stringify};lib.base16=base16$1;lib.base32=base32$1;lib.base32hex=base32hex$1;lib.base64=base64$1;lib.base64url=base64url$1;lib.codec=codec$2;const base16=lib.base16,base32=lib.base32,base32hex=lib.base32hex,base64=lib.base64,base64url=lib.base64url,codec$1=lib.codec,rfc4648=Object.freeze(Object.defineProperty({__proto__:null,base16,base32,base32hex,base64,base64url,codec:codec$1,default:lib},Symbol.toStringTag,{value:"Module"}));var sha256Uint8array={};Object.defineProperty(sha256Uint8array,"__esModule",{value:!0});var Hash_1=sha256Uint8array.Hash=createHash_1=sha256Uint8array.createHash=void 0;const K=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],algorithms={sha256:1};function createHash$1(q){if(q&&!algorithms[q]&&!algorithms[q.toLowerCase()])throw new Error("Digest method not supported");return new Hash}var createHash_1=sha256Uint8array.createHash=createHash$1;class Hash{constructor(){this.A=1779033703,this.B=-1150833019,this.C=1013904242,this.D=-1521486534,this.E=1359893119,this.F=-1694144372,this.G=528734635,this.H=1541459225,this._size=0,this._sp=0,(!sharedBuffer||sharedOffset>=8e3)&&(sharedBuffer=new ArrayBuffer(8e3),sharedOffset=0),this._byte=new Uint8Array(sharedBuffer,sharedOffset,80),this._word=new Int32Array(sharedBuffer,sharedOffset,20),sharedOffset+=80}update(_){if(typeof _=="string")return this._utf8(_);if(_==null)throw new TypeError("Invalid type: "+typeof _);const M=_.byteOffset,$=_.byteLength;let j=$/64|0,z=0;if(j&&!(M&3)&&!(this._size%64)){const X=new Int32Array(_.buffer,M,j*16);for(;j--;)this._int32(X,z>>2),z+=64;this._size+=z}if(_.BYTES_PER_ELEMENT!==1&&_.buffer){const X=new Uint8Array(_.buffer,M+z,$-z);return this._uint8(X)}return z===$?this:this._uint8(_,z)}_uint8(_,M){const{_byte:$,_word:j}=this,z=_.length;for(M=M|0;M<z;){const V=this._size%64;let X=V;for(;M<z&&X<64;)$[X++]=_[M++];X>=64&&this._int32(j),this._size+=X-V}return this}_utf8(_){const{_byte:M,_word:$}=this,j=_.length;let z=this._sp;for(let V=0;V<j;){const X=this._size%64;let G=X;for(;V<j&&G<64;){let Y=_.charCodeAt(V++)|0;Y<128?M[G++]=Y:Y<2048?(M[G++]=192|Y>>>6,M[G++]=128|Y&63):Y<55296||Y>57343?(M[G++]=224|Y>>>12,M[G++]=128|Y>>>6&63,M[G++]=128|Y&63):z?(Y=((z&1023)<<10)+(Y&1023)+65536,M[G++]=240|Y>>>18,M[G++]=128|Y>>>12&63,M[G++]=128|Y>>>6&63,M[G++]=128|Y&63,z=0):z=Y}G>=64&&(this._int32($),$[0]=$[16]),this._size+=G-X}return this._sp=z,this}_int32(_,M){let{A:$,B:j,C:z,D:V,E:X,F:G,G:Y,H:Q}=this,ee=0;for(M=M|0;ee<16;)W[ee++]=swap32(_[M++]);for(ee=16;ee<64;ee++)W[ee]=gamma1(W[ee-2])+W[ee-7]+gamma0(W[ee-15])+W[ee-16]|0;for(ee=0;ee<64;ee++){const te=Q+sigma1(X)+ch(X,G,Y)+K[ee]+W[ee]|0,Z=sigma0($)+maj($,j,z)|0;Q=Y,Y=G,G=X,X=V+te|0,V=z,z=j,j=$,$=te+Z|0}this.A=$+this.A|0,this.B=j+this.B|0,this.C=z+this.C|0,this.D=V+this.D|0,this.E=X+this.E|0,this.F=G+this.F|0,this.G=Y+this.G|0,this.H=Q+this.H|0}digest(_){const{_byte:M,_word:$}=this;let j=this._size%64|0;for(M[j++]=128;j&3;)M[j++]=0;if(j>>=2,j>14){for(;j<16;)$[j++]=0;j=0,this._int32($)}for(;j<16;)$[j++]=0;const z=this._size*8,V=(z&4294967295)>>>0,X=(z-V)/4294967296;return X&&($[14]=swap32(X)),V&&($[15]=swap32(V)),this._int32($),_==="hex"?this._hex():this._bin()}_hex(){const{A:_,B:M,C:$,D:j,E:z,F:V,G:X,H:G}=this;return hex32(_)+hex32(M)+hex32($)+hex32(j)+hex32(z)+hex32(V)+hex32(X)+hex32(G)}_bin(){const{A:_,B:M,C:$,D:j,E:z,F:V,G:X,H:G,_byte:Y,_word:Q}=this;return Q[0]=swap32(_),Q[1]=swap32(M),Q[2]=swap32($),Q[3]=swap32(j),Q[4]=swap32(z),Q[5]=swap32(V),Q[6]=swap32(X),Q[7]=swap32(G),Y.slice(0,32)}}Hash_1=sha256Uint8array.Hash=Hash;const W=new Int32Array(64);let sharedBuffer,sharedOffset=0;const hex32=q=>(q+4294967296).toString(16).substr(-8),swapLE=q=>q<<24&4278190080|q<<8&16711680|q>>8&65280|q>>24&255,swapBE=q=>q,swap32=isBE()?swapBE:swapLE,ch=(q,_,M)=>M^q&(_^M),maj=(q,_,M)=>q&_|M&(q|_),sigma0=q=>(q>>>2|q<<30)^(q>>>13|q<<19)^(q>>>22|q<<10),sigma1=q=>(q>>>6|q<<26)^(q>>>11|q<<21)^(q>>>25|q<<7),gamma0=q=>(q>>>7|q<<25)^(q>>>18|q<<14)^q>>>3,gamma1=q=>(q>>>17|q<<15)^(q>>>19|q<<13)^q>>>10;function isBE(){return new Uint8Array(new Uint16Array([65279]).buffer)[0]===254}const sha256_uint8array=_mergeNamespaces({__proto__:null,get Hash(){return Hash_1},get createHash(){return createHash_1},default:sha256Uint8array},[sha256Uint8array]);/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const _0n=BigInt(0),_1n=BigInt(1),_2n=BigInt(2),_255n=BigInt(255),CURVE_ORDER=_2n**BigInt(252)+BigInt("27742317777372353535851937790883648493"),CURVE={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:_2n**_255n-BigInt(19),l:CURVE_ORDER,n:CURVE_ORDER,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},MAX_256B=_2n**BigInt(256),SQRT_M1=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");const SQRT_AD_MINUS_ONE=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),INVSQRT_A_MINUS_D=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),ONE_MINUS_D_SQ=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),D_MINUS_ONE_SQ=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class ExtendedPoint{constructor(_,M,$,j){this.x=_,this.y=M,this.z=$,this.t=j}static fromAffine(_){if(!(_ instanceof Point))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return _.equals(Point.ZERO)?ExtendedPoint.ZERO:new ExtendedPoint(_.x,_.y,_1n,mod(_.x*_.y))}static toAffineBatch(_){const M=invertBatch(_.map($=>$.z));return _.map(($,j)=>$.toAffine(M[j]))}static normalizeZ(_){return this.toAffineBatch(_).map(this.fromAffine)}equals(_){assertExtPoint(_);const{x:M,y:$,z:j}=this,{x:z,y:V,z:X}=_,G=mod(M*X),Y=mod(z*j),Q=mod($*X),ee=mod(V*j);return G===Y&&Q===ee}negate(){return new ExtendedPoint(mod(-this.x),this.y,this.z,mod(-this.t))}double(){const{x:_,y:M,z:$}=this,{a:j}=CURVE,z=mod(_**_2n),V=mod(M**_2n),X=mod(_2n*mod($**_2n)),G=mod(j*z),Y=mod(mod((_+M)**_2n)-z-V),Q=G+V,ee=Q-X,te=G-V,Z=mod(Y*ee),ne=mod(Q*te),re=mod(Y*te),se=mod(ee*Q);return new ExtendedPoint(Z,ne,se,re)}add(_){assertExtPoint(_);const{x:M,y:$,z:j,t:z}=this,{x:V,y:X,z:G,t:Y}=_,Q=mod(($-M)*(X+V)),ee=mod(($+M)*(X-V)),te=mod(ee-Q);if(te===_0n)return this.double();const Z=mod(j*_2n*Y),ne=mod(z*_2n*G),re=ne+Z,se=ee+Q,ie=ne-Z,oe=mod(re*te),ue=mod(se*ie),ce=mod(re*ie),ae=mod(te*se);return new ExtendedPoint(oe,ue,ae,ce)}subtract(_){return this.add(_.negate())}precomputeWindow(_){const M=1+256/_,$=[];let j=this,z=j;for(let V=0;V<M;V++){z=j,$.push(z);for(let X=1;X<2**(_-1);X++)z=z.add(j),$.push(z);j=z.double()}return $}wNAF(_,M){!M&&this.equals(ExtendedPoint.BASE)&&(M=Point.BASE);const $=M&&M._WINDOW_SIZE||1;if(256%$)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let j=M&&pointPrecomputes.get(M);j||(j=this.precomputeWindow($),M&&$!==1&&(j=ExtendedPoint.normalizeZ(j),pointPrecomputes.set(M,j)));let z=ExtendedPoint.ZERO,V=ExtendedPoint.ZERO;const X=1+256/$,G=2**($-1),Y=BigInt(2**$-1),Q=2**$,ee=BigInt($);for(let te=0;te<X;te++){const Z=te*G;let ne=Number(_&Y);if(_>>=ee,ne>G&&(ne-=Q,_+=_1n),ne===0){let re=j[Z];te%2&&(re=re.negate()),V=V.add(re)}else{let re=j[Z+Math.abs(ne)-1];ne<0&&(re=re.negate()),z=z.add(re)}}return ExtendedPoint.normalizeZ([z,V])[0]}multiply(_,M){return this.wNAF(normalizeScalar(_,CURVE.l),M)}multiplyUnsafe(_){let M=normalizeScalar(_,CURVE.l,!1);const $=ExtendedPoint.BASE,j=ExtendedPoint.ZERO;if(M===_0n)return j;if(this.equals(j)||M===_1n)return this;if(this.equals($))return this.wNAF(M);let z=j,V=this;for(;M>_0n;)M&_1n&&(z=z.add(V)),V=V.double(),M>>=_1n;return z}isSmallOrder(){return this.multiplyUnsafe(CURVE.h).equals(ExtendedPoint.ZERO)}isTorsionFree(){return this.multiplyUnsafe(CURVE.l).equals(ExtendedPoint.ZERO)}toAffine(_=invert(this.z)){const{x:M,y:$,z:j}=this,z=mod(M*_),V=mod($*_);if(mod(j*_)!==_1n)throw new Error("invZ was invalid");return new Point(z,V)}fromRistrettoBytes(){legacyRist()}toRistrettoBytes(){legacyRist()}fromRistrettoHash(){legacyRist()}}ExtendedPoint.BASE=new ExtendedPoint(CURVE.Gx,CURVE.Gy,_1n,mod(CURVE.Gx*CURVE.Gy));ExtendedPoint.ZERO=new ExtendedPoint(_0n,_1n,_1n,_0n);function assertExtPoint(q){if(!(q instanceof ExtendedPoint))throw new TypeError("ExtendedPoint expected")}function assertRstPoint(q){if(!(q instanceof RistrettoPoint))throw new TypeError("RistrettoPoint expected")}function legacyRist(){throw new Error("Legacy method: switch to RistrettoPoint")}class RistrettoPoint{constructor(_){this.ep=_}static calcElligatorRistrettoMap(_){const{d:M}=CURVE,$=mod(SQRT_M1*_*_),j=mod(($+_1n)*ONE_MINUS_D_SQ);let z=BigInt(-1);const V=mod((z-M*$)*mod($+M));let{isValid:X,value:G}=uvRatio(j,V),Y=mod(G*_);edIsNegative(Y)||(Y=mod(-Y)),X||(G=Y),X||(z=$);const Q=mod(z*($-_1n)*D_MINUS_ONE_SQ-V),ee=G*G,te=mod((G+G)*V),Z=mod(Q*SQRT_AD_MINUS_ONE),ne=mod(_1n-ee),re=mod(_1n+ee);return new ExtendedPoint(mod(te*re),mod(ne*Z),mod(Z*re),mod(te*ne))}static hashToCurve(_){_=ensureBytes(_,64);const M=bytes255ToNumberLE(_.slice(0,32)),$=this.calcElligatorRistrettoMap(M),j=bytes255ToNumberLE(_.slice(32,64)),z=this.calcElligatorRistrettoMap(j);return new RistrettoPoint($.add(z))}static fromHex(_){_=ensureBytes(_,32);const{a:M,d:$}=CURVE,j="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",z=bytes255ToNumberLE(_);if(!equalBytes(numberTo32BytesLE(z),_)||edIsNegative(z))throw new Error(j);const V=mod(z*z),X=mod(_1n+M*V),G=mod(_1n-M*V),Y=mod(X*X),Q=mod(G*G),ee=mod(M*$*Y-Q),{isValid:te,value:Z}=invertSqrt(mod(ee*Q)),ne=mod(Z*G),re=mod(Z*ne*ee);let se=mod((z+z)*ne);edIsNegative(se)&&(se=mod(-se));const ie=mod(X*re),oe=mod(se*ie);if(!te||edIsNegative(oe)||ie===_0n)throw new Error(j);return new RistrettoPoint(new ExtendedPoint(se,ie,_1n,oe))}toRawBytes(){let{x:_,y:M,z:$,t:j}=this.ep;const z=mod(mod($+M)*mod($-M)),V=mod(_*M),{value:X}=invertSqrt(mod(z*V**_2n)),G=mod(X*z),Y=mod(X*V),Q=mod(G*Y*j);let ee;if(edIsNegative(j*Q)){let Z=mod(M*SQRT_M1),ne=mod(_*SQRT_M1);_=Z,M=ne,ee=mod(G*INVSQRT_A_MINUS_D)}else ee=Y;edIsNegative(_*Q)&&(M=mod(-M));let te=mod(($-M)*ee);return edIsNegative(te)&&(te=mod(-te)),numberTo32BytesLE(te)}toHex(){return bytesToHex(this.toRawBytes())}toString(){return this.toHex()}equals(_){assertRstPoint(_);const M=this.ep,$=_.ep,j=mod(M.x*$.y)===mod(M.y*$.x),z=mod(M.y*$.y)===mod(M.x*$.x);return j||z}add(_){return assertRstPoint(_),new RistrettoPoint(this.ep.add(_.ep))}subtract(_){return assertRstPoint(_),new RistrettoPoint(this.ep.subtract(_.ep))}multiply(_){return new RistrettoPoint(this.ep.multiply(_))}multiplyUnsafe(_){return new RistrettoPoint(this.ep.multiplyUnsafe(_))}}RistrettoPoint.BASE=new RistrettoPoint(ExtendedPoint.BASE);RistrettoPoint.ZERO=new RistrettoPoint(ExtendedPoint.ZERO);const pointPrecomputes=new WeakMap;class Point{constructor(_,M){this.x=_,this.y=M}_setWindowSize(_){this._WINDOW_SIZE=_,pointPrecomputes.delete(this)}static fromHex(_,M=!0){const{d:$,P:j}=CURVE;_=ensureBytes(_,32);const z=_.slice();z[31]=_[31]&-129;const V=bytesToNumberLE(z);if(M&&V>=j)throw new Error("Expected 0 < hex < P");if(!M&&V>=MAX_256B)throw new Error("Expected 0 < hex < 2**256");const X=mod(V*V),G=mod(X-_1n),Y=mod($*X+_1n);let{isValid:Q,value:ee}=uvRatio(G,Y);if(!Q)throw new Error("Point.fromHex: invalid y coordinate");const te=(ee&_1n)===_1n;return(_[31]&128)!==0!==te&&(ee=mod(-ee)),new Point(ee,V)}static async fromPrivateKey(_){return(await getExtendedPublicKey(_)).point}toRawBytes(){const _=numberTo32BytesLE(this.y);return _[31]|=this.x&_1n?128:0,_}toHex(){return bytesToHex(this.toRawBytes())}toX25519(){const{y:_}=this,M=mod((_1n+_)*invert(_1n-_));return numberTo32BytesLE(M)}isTorsionFree(){return ExtendedPoint.fromAffine(this).isTorsionFree()}equals(_){return this.x===_.x&&this.y===_.y}negate(){return new Point(mod(-this.x),this.y)}add(_){return ExtendedPoint.fromAffine(this).add(ExtendedPoint.fromAffine(_)).toAffine()}subtract(_){return this.add(_.negate())}multiply(_){return ExtendedPoint.fromAffine(this).multiply(_,this).toAffine()}}Point.BASE=new Point(CURVE.Gx,CURVE.Gy);Point.ZERO=new Point(_0n,_1n);class Signature{constructor(_,M){this.r=_,this.s=M,this.assertValidity()}static fromHex(_){const M=ensureBytes(_,64),$=Point.fromHex(M.slice(0,32),!1),j=bytesToNumberLE(M.slice(32,64));return new Signature($,j)}assertValidity(){const{r:_,s:M}=this;if(!(_ instanceof Point))throw new Error("Expected Point instance");return normalizeScalar(M,CURVE.l,!1),this}toRawBytes(){const _=new Uint8Array(64);return _.set(this.r.toRawBytes()),_.set(numberTo32BytesLE(this.s),32),_}toHex(){return bytesToHex(this.toRawBytes())}}function concatBytes(...q){if(!q.every($=>$ instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(q.length===1)return q[0];const _=q.reduce(($,j)=>$+j.length,0),M=new Uint8Array(_);for(let $=0,j=0;$<q.length;$++){const z=q[$];M.set(z,j),j+=z.length}return M}const hexes=Array.from({length:256},(q,_)=>_.toString(16).padStart(2,"0"));function bytesToHex(q){if(!(q instanceof Uint8Array))throw new Error("Uint8Array expected");let _="";for(let M=0;M<q.length;M++)_+=hexes[q[M]];return _}function hexToBytes(q){if(typeof q!="string")throw new TypeError("hexToBytes: expected string, got "+typeof q);if(q.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const _=new Uint8Array(q.length/2);for(let M=0;M<_.length;M++){const $=M*2,j=q.slice($,$+2),z=Number.parseInt(j,16);if(Number.isNaN(z)||z<0)throw new Error("Invalid byte sequence");_[M]=z}return _}function numberTo32BytesBE(q){const M=q.toString(16).padStart(64,"0");return hexToBytes(M)}function numberTo32BytesLE(q){return numberTo32BytesBE(q).reverse()}function edIsNegative(q){return(mod(q)&_1n)===_1n}function bytesToNumberLE(q){if(!(q instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+bytesToHex(Uint8Array.from(q).reverse()))}function bytes255ToNumberLE(q){return mod(bytesToNumberLE(q)&_2n**_255n-_1n)}function mod(q,_=CURVE.P){const M=q%_;return M>=_0n?M:_+M}function invert(q,_=CURVE.P){if(q===_0n||_<=_0n)throw new Error(`invert: expected positive integers, got n=${q} mod=${_}`);let M=mod(q,_),$=_,j=_0n,z=_1n;for(;M!==_0n;){const X=$/M,G=$%M,Y=j-z*X;$=M,M=G,j=z,z=Y}if($!==_1n)throw new Error("invert: does not exist");return mod(j,_)}function invertBatch(q,_=CURVE.P){const M=new Array(q.length),$=q.reduce((z,V,X)=>V===_0n?z:(M[X]=z,mod(z*V,_)),_1n),j=invert($,_);return q.reduceRight((z,V,X)=>V===_0n?z:(M[X]=mod(z*M[X],_),mod(z*V,_)),j),M}function pow2(q,_){const{P:M}=CURVE;let $=q;for(;_-- >_0n;)$*=$,$%=M;return $}function pow_2_252_3(q){const{P:_}=CURVE,M=BigInt(5),$=BigInt(10),j=BigInt(20),z=BigInt(40),V=BigInt(80),G=q*q%_*q%_,Y=pow2(G,_2n)*G%_,Q=pow2(Y,_1n)*q%_,ee=pow2(Q,M)*Q%_,te=pow2(ee,$)*ee%_,Z=pow2(te,j)*te%_,ne=pow2(Z,z)*Z%_,re=pow2(ne,V)*ne%_,se=pow2(re,V)*ne%_,ie=pow2(se,$)*ee%_;return{pow_p_5_8:pow2(ie,_2n)*q%_,b2:G}}function uvRatio(q,_){const M=mod(_*_*_),$=mod(M*M*_),j=pow_2_252_3(q*$).pow_p_5_8;let z=mod(q*M*j);const V=mod(_*z*z),X=z,G=mod(z*SQRT_M1),Y=V===q,Q=V===mod(-q),ee=V===mod(-q*SQRT_M1);return Y&&(z=X),(Q||ee)&&(z=G),edIsNegative(z)&&(z=mod(-z)),{isValid:Y||Q,value:z}}function invertSqrt(q){return uvRatio(_1n,q)}async function sha512ModqLE(...q){const _=await utils$2.sha512(concatBytes(...q)),M=bytesToNumberLE(_);return mod(M,CURVE.l)}function equalBytes(q,_){if(q.length!==_.length)return!1;for(let M=0;M<q.length;M++)if(q[M]!==_[M])return!1;return!0}function ensureBytes(q,_){const M=q instanceof Uint8Array?Uint8Array.from(q):hexToBytes(q);if(typeof _=="number"&&M.length!==_)throw new Error(`Expected ${_} bytes`);return M}function normalizeScalar(q,_,M=!0){if(!_)throw new TypeError("Specify max value");if(typeof q=="number"&&Number.isSafeInteger(q)&&(q=BigInt(q)),typeof q=="bigint"&&q<_){if(M){if(_0n<q)return q}else if(_0n<=q)return q}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function adjustBytes25519(q){return q[0]&=248,q[31]&=127,q[31]|=64,q}async function getExtendedPublicKey(q){if(q=typeof q=="bigint"||typeof q=="number"?numberTo32BytesBE(normalizeScalar(q,MAX_256B)):ensureBytes(q),q.length!==32)throw new Error("Expected 32 bytes");const _=await utils$2.sha512(q),M=adjustBytes25519(_.slice(0,32)),$=_.slice(32,64),j=mod(bytesToNumberLE(M),CURVE.l),z=Point.BASE.multiply(j),V=z.toRawBytes();return{head:M,prefix:$,scalar:j,point:z,pointBytes:V}}async function getPublicKey(q){return(await getExtendedPublicKey(q)).pointBytes}async function sign(q,_){q=ensureBytes(q);const{prefix:M,scalar:$,pointBytes:j}=await getExtendedPublicKey(_),z=await sha512ModqLE(M,q),V=Point.BASE.multiply(z),X=await sha512ModqLE(V.toRawBytes(),j,q),G=mod(z+X*$,CURVE.l);return new Signature(V,G).toRawBytes()}async function verify(q,_,M){_=ensureBytes(_),M instanceof Point||(M=Point.fromHex(M,!1));const{r:$,s:j}=q instanceof Signature?q.assertValidity():Signature.fromHex(q),z=ExtendedPoint.BASE.multiplyUnsafe(j),V=await sha512ModqLE($.toRawBytes(),M.toRawBytes(),_),X=ExtendedPoint.fromAffine(M).multiplyUnsafe(V);return ExtendedPoint.fromAffine($).add(X).subtract(z).multiplyUnsafe(CURVE.h).equals(ExtendedPoint.ZERO)}Point.BASE._setWindowSize(8);const crypto$1={node:nodeCrypto,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},utils$2={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex,getExtendedPublicKey,mod,invert,hashToPrivateScalar:q=>{if(q=ensureBytes(q),q.length<40||q.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const _=mod(bytesToNumberLE(q),CURVE.l);if(_===_0n||_===_1n)throw new Error("Invalid private key");return _},randomBytes:(q=32)=>{if(crypto$1.web)return crypto$1.web.getRandomValues(new Uint8Array(q));if(crypto$1.node){const{randomBytes:_}=crypto$1.node;return new Uint8Array(_(q).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>utils$2.randomBytes(32),sha512:async q=>{if(crypto$1.web){const _=await crypto$1.web.subtle.digest("SHA-512",q.buffer);return new Uint8Array(_)}else{if(crypto$1.node)return Uint8Array.from(crypto$1.node.createHash("sha512").update(q).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(q=8,_=Point.BASE){const M=_.equals(Point.BASE)?_:new Point(_.x,_.y);return M._setWindowSize(q),M.multiply(_2n),M}};var __classPrivateFieldGet$1=globalThis&&globalThis.__classPrivateFieldGet||function(q,_,M,$){if(M==="a"&&!$)throw new TypeError("Private accessor was defined without a getter");if(typeof _=="function"?q!==_||!$:!_.has(q))throw new TypeError("Cannot read private member from an object whose class did not declare it");return M==="m"?$:M==="a"?$.call(q):$?$.value:_.get(q)},__classPrivateFieldSet$1=globalThis&&globalThis.__classPrivateFieldSet||function(q,_,M,$,j){if($==="m")throw new TypeError("Private method is not writable");if($==="a"&&!j)throw new TypeError("Private accessor was defined without a setter");if(typeof _=="function"?q!==_||!j:!_.has(q))throw new TypeError("Cannot write private member to an object whose class did not declare it");return $==="a"?j.call(q,M):j?j.value=M:_.set(q,M),M},_XXH64_seed,_XXH64_v1,_XXH64_v2,_XXH64_v3,_XXH64_v4,_XXH64_memory,_XXH64_len,_XXH64_memsize;const PRIME64_1=11400714785074694791n,PRIME64_2=14029467366897019727n,PRIME64_3=1609587929392839161n,PRIME64_4=9650029242287828579n,PRIME64_5=2870177450012600261n,BITS=64n,BITMASK=2n**BITS-1n,encoder$1=new TextEncoder;function bitsToBigInt(q,_,M,$){return BigInt(q)|BigInt(_)<<16n|BigInt(M)<<32n|BigInt($)<<48n}function memoryToBigInt(q,_){return BigInt(q[_])|BigInt(q[_+1])<<8n|BigInt(q[_+2])<<16n|BigInt(q[_+3])<<24n|BigInt(q[_+4])<<32n|BigInt(q[_+5])<<40n|BigInt(q[_+6])<<48n|BigInt(q[_+7])<<56n}function rotl(q,_){return q<<_&BITMASK|q>>BITS-_}function trunc(q){return BigInt.asUintN(64,q)}class XXH64{constructor(_=0){_XXH64_seed.set(this,void 0),_XXH64_v1.set(this,void 0),_XXH64_v2.set(this,void 0),_XXH64_v3.set(this,void 0),_XXH64_v4.set(this,void 0),_XXH64_memory.set(this,void 0),_XXH64_len.set(this,void 0),_XXH64_memsize.set(this,void 0),this.reset(_)}reset(_=__classPrivateFieldGet$1(this,_XXH64_seed,"f")){return __classPrivateFieldSet$1(this,_XXH64_seed,BigInt.asUintN(32,BigInt(_)),"f"),__classPrivateFieldSet$1(this,_XXH64_v1,trunc(__classPrivateFieldGet$1(this,_XXH64_seed,"f")+PRIME64_1+PRIME64_2),"f"),__classPrivateFieldSet$1(this,_XXH64_v2,trunc(__classPrivateFieldGet$1(this,_XXH64_seed,"f")+PRIME64_2),"f"),__classPrivateFieldSet$1(this,_XXH64_v3,__classPrivateFieldGet$1(this,_XXH64_seed,"f"),"f"),__classPrivateFieldSet$1(this,_XXH64_v4,trunc(__classPrivateFieldGet$1(this,_XXH64_seed,"f")-PRIME64_1),"f"),__classPrivateFieldSet$1(this,_XXH64_memory,null,"f"),__classPrivateFieldSet$1(this,_XXH64_len,0,"f"),__classPrivateFieldSet$1(this,_XXH64_memsize,0,"f"),this}update(_){typeof _=="string"&&(_=encoder$1.encode(_));let M=0,$=_.length,j=M+$;if($===0)return this;if(__classPrivateFieldSet$1(this,_XXH64_len,__classPrivateFieldGet$1(this,_XXH64_len,"f")+$,"f"),__classPrivateFieldGet$1(this,_XXH64_memsize,"f")===0&&__classPrivateFieldSet$1(this,_XXH64_memory,new Uint8Array(32),"f"),__classPrivateFieldGet$1(this,_XXH64_memsize,"f")+$<32)return __classPrivateFieldGet$1(this,_XXH64_memory,"f").set(_.subarray(0,$),__classPrivateFieldGet$1(this,_XXH64_memsize,"f")),__classPrivateFieldSet$1(this,_XXH64_memsize,__classPrivateFieldGet$1(this,_XXH64_memsize,"f")+$,"f"),this;if(__classPrivateFieldGet$1(this,_XXH64_memsize,"f")>0){__classPrivateFieldGet$1(this,_XXH64_memory,"f").set(_.subarray(0,32-__classPrivateFieldGet$1(this,_XXH64_memsize,"f")),__classPrivateFieldGet$1(this,_XXH64_memsize,"f"));let z=0,V;V=memoryToBigInt(__classPrivateFieldGet$1(this,_XXH64_memory,"f"),z),__classPrivateFieldSet$1(this,_XXH64_v1,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v1,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),z+=8,V=memoryToBigInt(this.memory,z),__classPrivateFieldSet$1(this,_XXH64_v2,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v2,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),z+=8,V=memoryToBigInt(this.memory,z),__classPrivateFieldSet$1(this,_XXH64_v3,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v3,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),z+=8,V=memoryToBigInt(this.memory,z),__classPrivateFieldSet$1(this,_XXH64_v4,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v4,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),M+=32-__classPrivateFieldGet$1(this,_XXH64_memsize,"f"),__classPrivateFieldSet$1(this,_XXH64_memsize,0,"f")}if(M<=j-32){const z=j-32;do{let V;V=memoryToBigInt(_,M),__classPrivateFieldSet$1(this,_XXH64_v1,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v1,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),M+=8,V=memoryToBigInt(_,M),__classPrivateFieldSet$1(this,_XXH64_v2,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v2,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),M+=8,V=memoryToBigInt(_,M),__classPrivateFieldSet$1(this,_XXH64_v3,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v3,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),M+=8,V=memoryToBigInt(_,M),__classPrivateFieldSet$1(this,_XXH64_v4,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v4,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),M+=8}while(M<=z)}return M<j&&(__classPrivateFieldGet$1(this,_XXH64_memory,"f").set(_.subarray(M,j),__classPrivateFieldGet$1(this,_XXH64_memsize,"f")),__classPrivateFieldSet$1(this,_XXH64_memsize,j-M,"f")),this}digest(){let _=__classPrivateFieldGet$1(this,_XXH64_memory,"f"),M=__classPrivateFieldGet$1(this,_XXH64_memsize,"f"),$=0,j=0n,z=0n,V=0n;for(__classPrivateFieldGet$1(this,_XXH64_len,"f")>=32?(j=rotl(__classPrivateFieldGet$1(this,_XXH64_v1,"f"),1n)+rotl(__classPrivateFieldGet$1(this,_XXH64_v2,"f"),7n)+rotl(__classPrivateFieldGet$1(this,_XXH64_v3,"f"),12n)+rotl(__classPrivateFieldGet$1(this,_XXH64_v4,"f"),18n),j=trunc(j^rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v1,"f")*PRIME64_2),31n)*PRIME64_1),j=trunc(j*PRIME64_1+PRIME64_4),j=trunc(j^rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v2,"f")*PRIME64_2),31n)*PRIME64_1),j=trunc(j*PRIME64_1+PRIME64_4),j=trunc(j^rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v3,"f")*PRIME64_2),31n)*PRIME64_1),j=trunc(j*PRIME64_1+PRIME64_4),j=trunc(j^rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v4,"f")*PRIME64_2),31n)*PRIME64_1),j=trunc(j*PRIME64_1+PRIME64_4)):j=trunc(__classPrivateFieldGet$1(this,_XXH64_seed,"f")+PRIME64_5),j+=BigInt(__classPrivateFieldGet$1(this,_XXH64_len,"f"));$<=M-8;)V=memoryToBigInt(_,$),V=trunc(rotl(trunc(V*PRIME64_2),31n)*PRIME64_1),j=trunc(rotl(j^V,27n)*PRIME64_1+PRIME64_4),$+=8;for($+4<=M&&(V=bitsToBigInt(_[$+1]<<8|_[$],_[$+3]<<8|_[$+2],0,0),j=trunc(rotl(j^trunc(V*PRIME64_1),23n)*PRIME64_2+PRIME64_3),$+=4);$<M;)V=bitsToBigInt(_[$++],0,0,0),j=trunc(rotl(j^trunc(V*PRIME64_5),11n)*PRIME64_1);return z=trunc(j>>33n),j=trunc((j^z)*PRIME64_2),z=trunc(j>>29n),j=trunc((j^z)*PRIME64_3),z=trunc(j>>32n),j=trunc(j^z),j}}_XXH64_seed=new WeakMap,_XXH64_v1=new WeakMap,_XXH64_v2=new WeakMap,_XXH64_v3=new WeakMap,_XXH64_v4=new WeakMap,_XXH64_memory=new WeakMap,_XXH64_len=new WeakMap,_XXH64_memsize=new WeakMap;function hash(q,_=0){return new XXH64(_).update(q).digest()}function ascend(q,_){return q<_?-1:q>_?1:0}class BinarySearchNode{constructor(_,M){Object.defineProperty(this,"parent",{enumerable:!0,configurable:!0,writable:!0,value:_}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:M}),Object.defineProperty(this,"left",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"right",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.left=null,this.right=null}static from(_){const M=new BinarySearchNode(_.parent,_.value);return M.left=_.left,M.right=_.right,M}directionFromParent(){return this.parent===null?null:this===this.parent.left?"left":this===this.parent.right?"right":null}findMinNode(){let _=this.left;for(;_!=null&&_.left;)_=_.left;return _??this}findMaxNode(){let _=this.right;for(;_!=null&&_.right;)_=_.right;return _??this}findSuccessorNode(){if(this.right!==null)return this.right.findMinNode();let _=this.parent,M=this.directionFromParent();for(;_&&M==="right";)M=_.directionFromParent(),_=_.parent;return _}}class BinarySearchTree{constructor(_=ascend){Object.defineProperty(this,"compare",{enumerable:!0,configurable:!0,writable:!0,value:_}),Object.defineProperty(this,"root",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_size",{enumerable:!0,configurable:!0,writable:!0,value:0})}static from(_,M){let $,j=[];if(_ instanceof BinarySearchTree)if($=new BinarySearchTree((M==null?void 0:M.compare)??_.compare),M!=null&&M.compare||M!=null&&M.map)j=_;else{const V=[];for(_.root&&($.root=BinarySearchNode.from(_.root),V.push($.root));V.length;){const X=V.pop(),G=X.left?BinarySearchNode.from(X.left):null,Y=X.right?BinarySearchNode.from(X.right):null;G&&(G.parent=X,V.push(G)),Y&&(Y.parent=X,V.push(Y))}}else $=M!=null&&M.compare?new BinarySearchTree(M.compare):new BinarySearchTree,j=_;const z=M!=null&&M.map?Array.from(j,M.map,M.thisArg):j;for(const V of z)$.insert(V);return $}get size(){return this._size}findNode(_){let M=this.root;for(;M;){const $=this.compare(_,M.value);if($===0)break;const j=$<0?"left":"right";M=M[j]}return M}rotateNode(_,M){const $=M==="left"?"right":"left";if(!_[$])throw new TypeError(`cannot rotate ${M} without ${$} child`);const j=_[$];if(_[$]=j[M]??null,j[M]&&(j[M].parent=_),j.parent=_.parent,_.parent){const z=_===_.parent[M]?M:$;_.parent[z]=j}else this.root=j;j[M]=_,_.parent=j}insertNode(_,M){if(this.root){let $=this.root;for(;;){const j=this.compare(M,$.value);if(j===0)break;const z=j<0?"left":"right";if($[z])$=$[z];else return $[z]=new _($,M),this._size++,$[z]}}else return this.root=new _(null,M),this._size++,this.root;return null}removeNode(_){let M=this.findNode(_);if(M){const $=!M.left||!M.right?M:M.findSuccessorNode(),j=$.left??$.right;j&&(j.parent=$.parent),$.parent?$.parent[$.directionFromParent()]=j:this.root=j,$!==M&&(M.value=$.value,M=$),this._size--}return M}insert(_){return!!this.insertNode(BinarySearchNode,_)}remove(_){return!!this.removeNode(_)}find(_){var M;return((M=this.findNode(_))==null?void 0:M.value)??null}min(){return this.root?this.root.findMinNode().value:null}max(){return this.root?this.root.findMaxNode().value:null}clear(){this.root=null,this._size=0}isEmpty(){return this.size===0}*lnrValues(){const _=[];let M=this.root;for(;_.length||M;)M?(_.push(M),M=M.left):(M=_.pop(),yield M.value,M=M.right)}*rnlValues(){const _=[];let M=this.root;for(;_.length||M;)M?(_.push(M),M=M.right):(M=_.pop(),yield M.value,M=M.left)}*nlrValues(){const _=[];for(this.root&&_.push(this.root);_.length;){const M=_.pop();yield M.value,M.right&&_.push(M.right),M.left&&_.push(M.left)}}*lrnValues(){const _=[];let M=this.root,$=null;for(;_.length||M;)if(M)_.push(M),M=M.left;else{const j=_[_.length-1];j.right&&j.right!==$?M=j.right:(yield j.value,$=_.pop())}}*lvlValues(){const _=[];let M=this.root;for(;M;)yield M.value,M.left&&_.push(M.left),M.right&&_.push(M.right),M=_.shift()??null}*[Symbol.iterator](){yield*this.lnrValues()}}class RedBlackNode extends BinarySearchNode{constructor(_,M){super(_,M),Object.defineProperty(this,"red",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.red=!0}static from(_){const M=new RedBlackNode(_.parent,_.value);return M.left=_.left,M.right=_.right,M.red=_.red,M}}class RedBlackTree extends BinarySearchTree{constructor(_=ascend){super(_)}static from(_,M){let $,j=[];if(_ instanceof RedBlackTree)if($=new RedBlackTree((M==null?void 0:M.compare)??_.compare),M!=null&&M.compare||M!=null&&M.map)j=_;else{const V=[];for(_.root&&($.root=RedBlackNode.from(_.root),V.push($.root));V.length;){const X=V.pop(),G=X.left?RedBlackNode.from(X.left):null,Y=X.right?RedBlackNode.from(X.right):null;G&&(G.parent=X,V.push(G)),Y&&(Y.parent=X,V.push(Y))}}else $=M!=null&&M.compare?new RedBlackTree(M.compare):new RedBlackTree,j=_;const z=M!=null&&M.map?Array.from(j,M.map,M.thisArg):j;for(const V of z)$.insert(V);return $}removeFixup(_,M){var $,j,z;for(;_&&!(M!=null&&M.red);){const V=_.left===M?"left":"right",X=V==="right"?"left":"right";let G=_[X];G!=null&&G.red&&(G.red=!1,_.red=!0,this.rotateNode(_,V),G=_[X]),G&&(!(($=G.left)!=null&&$.red)&&!((j=G.right)!=null&&j.red)?(G.red=!0,M=_,_=M.parent):((z=G[X])!=null&&z.red||(G[V].red=!1,G.red=!0,this.rotateNode(G,X),G=_[X]),G.red=_.red,_.red=!1,G[X].red=!1,this.rotateNode(_,V),M=this.root,_=null))}M&&(M.red=!1)}insert(_){var $;let M=this.insertNode(RedBlackNode,_);if(M){for(;($=M.parent)!=null&&$.red;){let j=M.parent;const z=j.directionFromParent(),V=z==="right"?"left":"right",X=j.parent[V]??null;X!=null&&X.red?(j.red=!1,X.red=!1,j.parent.red=!0,M=j.parent):(M===j[V]&&(M=j,this.rotateNode(M,z),j=M.parent),j.red=!1,j.parent.red=!0,this.rotateNode(j.parent,V))}this.root.red=!1}return!!M}remove(_){const M=this.removeNode(_);return M&&!M.red&&this.removeFixup(M.parent,M.left??M.right),!!M}}function combineMonoid(q,_){return{lift:M=>[q.lift(M),_.lift(M)],combine:(M,$)=>{const j=q.combine(M[0],$[0]),z=_.combine(M[1],$[1]);return[j,z]},neutral:[q.neutral,_.neutral]}}const sizeMonoid={lift:q=>1,combine:(q,_)=>q+_,neutral:0};class FingerprintNode extends RedBlackNode{constructor(_,M,$){super(_,M),Object.defineProperty(this,"label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"liftedValue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"monoid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.label=$.neutral,this.liftedValue=$.lift(M),this.monoid=$}updateLabel(_=!0,M){var $;this.left!==null&&this.right===null?this.label=this.monoid.combine(this.left.label,this.liftedValue):this.left===null&&this.right!==null?this.label=this.monoid.combine(this.liftedValue,this.right.label):this.left&&this.right?this.label=this.monoid.combine(this.left.label,this.monoid.combine(this.liftedValue,this.right.label)):this.label=this.liftedValue,_&&(($=this.parent)==null||$.updateLabel(!0,"Updated by child"))}}class FingerprintTree extends RedBlackTree{constructor(_,M){super(M),Object.defineProperty(this,"monoid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedMinNode",{enumerable:!0,configurable:!0,writable:!0,value:null});const z=combineMonoid({lift:V=>[V],combine:(V,X)=>V.concat(X),neutral:[]},{lift:V=>V,combine:(V,X)=>{if(!(V===void 0&&X===void 0))return X===void 0?V:V===void 0?X:M(V,X)>0?V:X},neutral:void 0});this.monoid=combineMonoid(_,combineMonoid(sizeMonoid,z))}getLowestValue(){if(!this.root)throw new Error("Can't get a range from a tree with no items");return this.cachedMinNode?this.cachedMinNode.value:this.root.findMinNode().value}rotateNode(_,M){var z;const $=M==="left"?"right":"left";if(!_[$])throw new TypeError(`cannot rotate ${M} without ${$} child`);const j=_[$];if(_[$]=j[M]??null,j[M]&&(j[M].parent=_),j.parent=_.parent,_.parent){const V=_===_.parent[M]?M:$;_.parent[V]=j}else this.root=j;j[M]=_,_.parent=j,(z=j[M])==null||z.updateLabel(!1,"Node rotated")}removeFixup(_,M){var $,j,z;for(;_&&!(M!=null&&M.red);){const V=_.left===M?"left":"right",X=V==="right"?"left":"right";let G=_[X];G!=null&&G.red&&(G.red=!1,_.red=!0,this.rotateNode(_,V),G=_[X]),G&&(!(($=G.left)!=null&&$.red)&&!((j=G.right)!=null&&j.red)?(G.red=!0,M=_,_=M.parent):((z=G[X])!=null&&z.red||(G[V].red=!1,G.red=!0,this.rotateNode(G,X),G=_[X]),G.red=_.red,_.red=!1,G[X].red=!1,this.rotateNode(_,V),M=this.root,_=null))}M&&(M.red=!1)}insertFingerprintNode(_){if(this.root){let M=this.root,$=!0;for(;;){const j=this.compare(_,M.value);if(j===0){$=!1;break}const z=j<0?"left":"right";if($&&z==="right"&&($=!1),M[z])M=M[z];else return M[z]=new FingerprintNode(M,_,this.monoid),this._size++,$&&(this.cachedMinNode=M[z]),M[z]}}else return this.root=new FingerprintNode(null,_,this.monoid),this._size++,this.cachedMinNode=this.root,this.root;return null}insert(_){var j;const M=this.insertFingerprintNode(_);let $=M;if($){for(;(j=$.parent)!=null&&j.red;){let z=$.parent;const V=z.directionFromParent(),X=V==="right"?"left":"right",G=z.parent[X]??null;G!=null&&G.red?(z.red=!1,G.red=!1,z.parent.red=!0,$=z.parent):($===z[X]&&($=z,this.rotateNode($,V),z=$.parent),z.red=!1,z.parent.red=!0,this.rotateNode(z.parent,X))}this.root.red=!1}return M==null||M.updateLabel(!0,"Node inserted"),!!$}remove(_){var $;const M=this.removeNode(_);return M&&!M.red&&this.removeFixup(M.parent,M.left??M.right),M&&(($=M.parent)==null||$.updateLabel(!0,"Child node removed")),!!M}getFingerprint(_,M,$){if(this.root===null)return{fingerprint:this.monoid.neutral[0],size:0,items:[],nextTree:null};const j=this.compare(_,M);if(j===0)return{fingerprint:this.root.label[0],size:this.root.label[1][0],items:this.root.label[1][1][0],nextTree:this.cachedMinNode};if(j<0){const z=this.compare(_,this.cachedMinNode.value)<=0?this.cachedMinNode:null,V=$||z||this.findGteNode(_),{label:X,nextTree:G}=this.aggregateUntil(V,_,M);return{fingerprint:X[0],size:X[1][0],items:X[1][1][0],nextTree:G}}else{const z=this.cachedMinNode,V=this.root.label[1][1][1],X=this.compare(M,z.value)>0,G=this.compare(_,V)<=0;if(X&&G){const{label:Y,nextTree:Q}=this.aggregateUntil(z,z.value,M),te=[this.monoid.lift(V)[0],[1,[[V],V]]],Z=$||this.findGteNode(_),{label:ne}=this.aggregateUntil(Z,_,V),re=this.monoid.combine(ne,te),se=this.monoid.combine(Y,re);return{fingerprint:se[0],size:se[1][0],items:se[1][1][0],nextTree:Q}}else if(X){const{label:Y,nextTree:Q}=this.aggregateUntil(z,z.value,M);return{fingerprint:Y[0],size:Y[1][0],items:Y[1][1][0],nextTree:Q}}else{const Y=this.compare(_,this.cachedMinNode.value)<=0?this.cachedMinNode:null,Q=$||Y||this.findGteNode(_),{label:ee}=this.aggregateUntil(Q,_,V),Z=[this.monoid.lift(V)[0],[1,[[V],V]]],ne=this.monoid.combine(ee,Z);return{fingerprint:ne[0],size:ne[1][0],items:ne[1][1][0],nextTree:Y}}}}findGteNode(_){let M=this.root;for(;M;){const $=this.compare(_,M.value);if($===0)break;const j=$<0?"left":"right";if(M[j])M=M[j];else break}return M}aggregateUntil(_,M,$){const{label:j,nextTree:z}=this.aggregateUp(_,M,$);return z===null||this.compare(z.value,$)>=0?{label:j,nextTree:z}:this.aggregateDown(z.right,$,this.monoid.combine(j,z.liftedValue))}aggregateUp(_,M,$){var V;let j=this.monoid.neutral,z=_;for(;this.compare(z.label[1][1][1],$)<0;){if(this.compare(z.value,M)>=0&&(j=this.monoid.combine(j,this.monoid.combine(z.liftedValue,((V=z.right)==null?void 0:V.label)||this.monoid.neutral))),z.parent===null)return{label:j,nextTree:null};z=z.parent}return{label:j,nextTree:z}}aggregateDown(_,M,$){var V,X;let j=_,z=$;for(;j!==null;)if(this.compare(j.value,M)<0)z=this.monoid.combine(z,this.monoid.combine(((V=j.left)==null?void 0:V.label)||this.monoid.neutral,j.liftedValue)),j=j.right;else{if(j.left===null||this.compare(j.label[1][1][1],M)<0)return{label:this.monoid.combine(z,((X=j.left)==null?void 0:X.label)||this.monoid.neutral),nextTree:j};j=j.left}return{label:z,nextTree:null}}isValueEqual(_,M){return this.compare(_,M)===0}}function deferred$1(){let q,_="pending";const M=new Promise(($,j)=>{q={async resolve(z){await z,_="fulfilled",$(z)},reject(z){_="rejected",j(z)}}});return Object.defineProperty(M,"state",{get:()=>_}),Object.assign(M,q)}class TeeableDeferred{constructor(){Object.defineProperty(this,"deferreds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"pending"})}resolve(_){if(this.state==="pending"){this.state="fulfilled";for(const M of this.deferreds)M.resolve(_)}}reject(_){if(this.state==="pending"){this.state="rejected";for(const M of this.deferreds)M.reject(_)}}tee(){const _=deferred$1();return this.state==="fulfilled"?_.resolve():this.state==="rejected"?_.reject():this.deferreds.add(_),_}}class RangeMessenger{constructor(_){Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDoneTee",{enumerable:!0,configurable:!0,writable:!0,value:new TeeableDeferred}),Object.defineProperty(this,"insertionCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"fingerprintEquals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowerBoundFromPrev",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"collatedPayload",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"collatePayloads",{enumerable:!0,configurable:!0,writable:!0,value:M=>{switch(M.type){case"payload":{let $=this.collatedPayload;if($===null&&($={type:"payload",lowerBound:M.lowerBound,payload:[],end:{canRespond:!1,upperBound:M.payload}}),$.payload.push(M.payload),this.collatedPayload=$,M.end)return M.end.upperBound?$.end=M.end:$.end={...M.end,upperBound:M.payload},this.collatedPayload=null,$;break}default:return this.collatedPayload&&(this.collatedPayload=null),M}}}),Object.defineProperty(this,"reusableTree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastAdjacentDoneUpperBound",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"isDoneSoFar",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.tree=_.tree,this.fingerprintEquals=_.fingerprintEquals,this.encoding=_.encoding,this.payloadThreshold=_.payloadThreshold,this.rangeDivision=_.rangeDivision}decode(_){const M=this.lowerBoundFromPrev;try{switch(this.encoding.decode.getType(_)){case"payload":{const j=this.encoding.decode.payload(_);return j.end&&(this.lowerBoundFromPrev=j.end.upperBound),{type:"payload",lowerBound:M,payload:j.value,...j.end?{end:j.end}:{}}}case"fingerprint":{const j=this.encoding.decode.fingerprint(_);return this.lowerBoundFromPrev=j.upperBound,{type:"fingerprint",lowerBound:M,fingerprint:j.fingerprint,upperBound:j.upperBound}}case"emptyPayload":{const j=this.encoding.decode.emptyPayload(_);return this.lowerBoundFromPrev=j,{lowerBound:M,type:"emptyPayload",upperBound:j}}case"done":{const j=this.encoding.decode.done(_);return this.lowerBoundFromPrev=j,{lowerBound:M,type:"done",upperBound:j}}case"emptySet":return{type:"emptySet",canRespond:this.encoding.decode.emptySet(_)};case"lowerBound":{const j=this.encoding.decode.lowerBound(_);return this.lowerBoundFromPrev=j,{type:"lowerBound",value:j}}case"terminal":return this.encoding.decode.terminal(_),{type:"terminal"}}}catch($){console.group("range-reconcile: Could not decode message"),console.warn(_),console.warn($)}return null}setReusableTree(_){this.reusableTree=_||void 0}process(_){const M=this.reusableTree;switch(_.type){case"lowerBound":case"terminal":case"done":return this.setReusableTree(null),[_];case"emptySet":{if(_.canRespond===!1&&this.isDoneTee.resolve(),this.tree.size===0)return[{type:"emptySet",canRespond:!1}];const $=this.tree.getLowestValue(),j=[{type:"lowerBound",value:$}],{items:z}=this.tree.getFingerprint($,$);for(let V=0;V<z.length;V++){const X=z[V];V===z.length-1?j.push({type:"payload",payload:X,end:{upperBound:$,canRespond:!1}}):j.push({type:"payload",payload:X})}return j.push({type:"terminal"}),j}case"fingerprint":{const{fingerprint:$,size:j,items:z,nextTree:V}=this.tree.getFingerprint(_.lowerBound,_.upperBound,M);if(this.setReusableTree(V),this.fingerprintEquals($,_.fingerprint))return[{type:"done",upperBound:_.upperBound}];if(j<=this.payloadThreshold){if(j===0)return[{type:"emptyPayload",upperBound:_.upperBound}];const X=[];for(let G=0;G<j;G++)X.push({type:"payload",payload:z[G],...G===z.length-1?{end:{upperBound:_.upperBound,canRespond:!0}}:{}});return X}else{const X=Math.ceil(j/this.rangeDivision),G=[];if(X<=this.payloadThreshold){for(let te=0;te<z.length;te++)G.push({type:"payload",payload:z[te],...te===z.length-1?{end:{upperBound:_.upperBound,canRespond:!0}}:{}});return G}let Y;const Q=z;let ee=!1;if(_.lowerBound>=_.upperBound){let te=0;for(let Z=0;Z<=z.length;Z++)if(z[Z]>=_.lowerBound){te=Z;break}if(te>0){const Z=Q.splice(0,te);Q.push(...Z),ee=!0}}for(let te=0;te<j;te+=X){const Z=Q[te],ne=Q[te+X]||_.upperBound,{fingerprint:re,nextTree:se}=this.tree.getFingerprint(Z,ne,Y);Y=ee?void 0:se||void 0,G.push({type:"fingerprint",fingerprint:re,upperBound:ne})}return G}}case"payload":{for(const $ of _.payload){this.tree.insert($);for(const j of this.insertionCallbacks)j($)}if(_.end.canRespond){const{items:$,size:j,nextTree:z}=this.tree.getFingerprint(_.lowerBound,_.end.upperBound,M);if(this.setReusableTree(z),j===0)return[{type:"emptyPayload",upperBound:_.end.upperBound}];const V=[];for(let G=0;G<j;G++){let Y=!1;for(let Q=0;Q<_.payload.length;Q++)this.tree.isValueEqual($[G],_.payload[Q])&&(Y=!0);Y||V.push({type:"payload",payload:$[G]})}const X=V[V.length-1];return V[V.length-1]={...X,end:{upperBound:_.end.upperBound,canRespond:!1}},V}else return this.setReusableTree(null),[{type:"done",upperBound:_.end.upperBound}]}case"emptyPayload":{this.setReusableTree(null);const{items:$,size:j,nextTree:z}=this.tree.getFingerprint(_.lowerBound,_.upperBound);if(this.setReusableTree(z),j===0)return this.setReusableTree(null),[];const V=[];for(let X=0;X<j;X++)V.push({type:"payload",payload:$[X],...X===$.length-1?{end:{upperBound:_.upperBound,canRespond:!1}}:{}});return V}}}consolidateAdjacentDones(_){switch(_.type){case"done":{this.lastAdjacentDoneUpperBound=_.upperBound;break}default:{const M=this.lastAdjacentDoneUpperBound;return M?(this.lastAdjacentDoneUpperBound=null,[{type:"done",upperBound:M},_]):[_]}}}checkIsDone(_){var M;if(this.isDoneTee.state==="pending")switch(_.type){case"emptySet":{_.canRespond&&(this.isDoneSoFar=!1);break}case"lowerBound":break;case"fingerprint":this.isDoneSoFar=!1;break;case"emptyPayload":this.isDoneSoFar=!1;break;case"payload":((M=_.end)==null?void 0:M.canRespond)===!0&&(this.isDoneSoFar=!1);break;case"terminal":this.isDoneSoFar?this.isDoneTee.resolve():this.isDoneSoFar=!0}}encode(_){let M;switch(_.type){case"emptySet":{M=this.encoding.encode.emptySet(_.canRespond);break}case"lowerBound":{M=this.encoding.encode.lowerBound(_.value);break}case"done":{M=this.encoding.encode.done(_.upperBound);break}case"fingerprint":{M=this.encoding.encode.fingerprint(_.fingerprint,_.upperBound);break}case"payload":{M=this.encoding.encode.payload(_.payload,_.end);break}case"emptyPayload":{M=this.encoding.encode.emptyPayload(_.upperBound);break}case"terminal":{M=this.encoding.encode.terminal();break}}return M}respond(_){if(this.isDone().state==="fulfilled")return[];const M=this.decode(_),$=this.collatePayloads(M);if($===void 0)return[];const j=this.process($),z=[];for(const X of j){const G=this.consolidateAdjacentDones(X);G&&z.push(...G)}for(const X of z)this.checkIsDone(X);const V=[];for(const X of z)V.push(this.encode(X));return V}isDone(){return this.isDoneTee.tee()}initialMessages(_){const{tree:M,encoding:$,payloadThreshold:j,rangeDivision:z}=this;function*V(){if(M.size===0){yield $.encode.emptySet(!0);return}const X=M.getLowestValue();yield $.encode.lowerBound(X);const{items:Y}=M.getFingerprint(X,X),ee=(_||(ne=>{const re=Math.ceil(ne.length/z),se=[];for(let ie=0;ie<ne.length;ie+=re){const oe=ne.slice(ie,ie+re);se.push(oe)}return se}))(Y);let te;for(let ne=0;ne<ee.length;ne++){const re=ee[ne+1]?ee[ne+1][0]:X,se=ee[ne];if(se.length<=j)for(let ie=0;ie<se.length;ie++)yield $.encode.payload(se[ie],ie===se.length-1?{upperBound:re,canRespond:!0}:void 0);else{const ie=se[0],{fingerprint:oe,nextTree:ue}=M.getFingerprint(ie,re,te);te=ue||void 0,yield $.encode.fingerprint(oe,re)}}yield $.encode.terminal()}return V()}onInsertion(_){return this.insertionCallbacks.add(_),()=>{this.insertionCallbacks.delete(_)}}}var __classPrivateFieldGet=globalThis&&globalThis.__classPrivateFieldGet||function(q,_,M,$){if(M==="a"&&!$)throw new TypeError("Private accessor was defined without a getter");if(typeof _=="function"?q!==_||!$:!_.has(q))throw new TypeError("Cannot read private member from an object whose class did not declare it");return M==="m"?$:M==="a"?$.call(q):$?$.value:_.get(q)},__classPrivateFieldSet=globalThis&&globalThis.__classPrivateFieldSet||function(q,_,M,$,j){if($==="m")throw new TypeError("Private method is not writable");if($==="a"&&!j)throw new TypeError("Private accessor was defined without a setter");if(typeof _=="function"?q!==_||!j:!_.has(q))throw new TypeError("Cannot write private member to an object whose class did not declare it");return $==="a"?j.call(q,M):j?j.value=M:_.set(q,M),M},_AsyncQueue_instances,_AsyncQueue_queue,_AsyncQueue_resolve,_AsyncQueue_error,_AsyncQueue_handleError,_AsyncQueue_enqueue;const END=Symbol("Stream ended."),ERROR=Symbol("Stream errored.");class AsyncQueue{constructor(_){var M,$,j;_AsyncQueue_instances.add(this),_AsyncQueue_queue.set(this,[]),_AsyncQueue_resolve.set(this,null),_AsyncQueue_error.set(this,void 0),Object.defineProperty(this,"push",{enumerable:!0,configurable:!0,writable:!0,value:(...z)=>{z.length?__classPrivateFieldGet(this,_AsyncQueue_instances,"m",_AsyncQueue_enqueue).call(this,!1,z):(__classPrivateFieldGet(this,_AsyncQueue_instances,"m",_AsyncQueue_enqueue).call(this,!1,[ERROR]),__classPrivateFieldGet(this,_AsyncQueue_instances,"m",_AsyncQueue_handleError).call(this,new Error("AsyncQueueError: queue.push was called with no arguments")))}}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:({immediately:z=!1,withError:V}={})=>{V&&__classPrivateFieldGet(this,_AsyncQueue_instances,"m",_AsyncQueue_handleError).call(this,V),__classPrivateFieldGet(this,_AsyncQueue_instances,"m",_AsyncQueue_enqueue).call(this,z,[V?ERROR:END]),this.push=this.close=()=>{}}}),(j=($=(M=_==null?void 0:_.catch)==null?void 0:M.call(_,z=>this.close({withError:z})))==null?void 0:$.finally)==null||j.call($,()=>this.close())}get length(){return __classPrivateFieldGet(this,_AsyncQueue_queue,"f").length}async*[(_AsyncQueue_queue=new WeakMap,_AsyncQueue_resolve=new WeakMap,_AsyncQueue_error=new WeakMap,_AsyncQueue_instances=new WeakSet,_AsyncQueue_handleError=function(M){__classPrivateFieldGet(this,_AsyncQueue_error,"f")instanceof AggregateError?__classPrivateFieldGet(this,_AsyncQueue_error,"f").errors.push(M):__classPrivateFieldGet(this,_AsyncQueue_error,"f")?__classPrivateFieldSet(this,_AsyncQueue_error,new AggregateError([__classPrivateFieldGet(this,_AsyncQueue_error,"f"),M]),"f"):__classPrivateFieldSet(this,_AsyncQueue_error,M,"f")},_AsyncQueue_enqueue=function(M,$){var j;__classPrivateFieldGet(this,_AsyncQueue_queue,"f")[M?"unshift":"push"](...$),(j=__classPrivateFieldGet(this,_AsyncQueue_resolve,"f"))==null||j.call(this,__classPrivateFieldGet(this,_AsyncQueue_queue,"f").shift()),__classPrivateFieldSet(this,_AsyncQueue_resolve,null,"f")},Symbol.asyncIterator)](){for(;;){const _=__classPrivateFieldGet(this,_AsyncQueue_queue,"f").length?__classPrivateFieldGet(this,_AsyncQueue_queue,"f").shift():await new Promise(M=>{__classPrivateFieldSet(this,_AsyncQueue_resolve,M,"f")});if(_===ERROR)throw __classPrivateFieldGet(this,_AsyncQueue_error,"f");if(_===END)break;yield _}}}function deferred(){let q,_="pending";const M=new Promise(($,j)=>{q={async resolve(z){await z,_="fulfilled",$(z)},reject(z){_="rejected",j(z)}}});return Object.defineProperty(M,"state",{get:()=>_}),Object.assign(M,q)}new TextDecoder$1;const encoder=new TextEncoder;function stringToBytes(q){return encoder.encode(q)}function stringLengthInBytes(q){return stringToBytes(q).length}function onlyHasChars(q,_){for(let M of q)if(_.indexOf(M)===-1)return!1;return!0}function isDigit(q){return q===""?!1:digits.indexOf(q)!==-1}const alphaLower="abcdefghijklmnopqrstuvwxyz",alphaUpper=alphaLower.toUpperCase(),digits="0123456789",b32chars=alphaLower+"234567",authorNameChars=alphaLower+digits,authorKeyChars=b32chars,authorAddressChars=authorNameChars+b32chars+"@.",workspaceNameChars=alphaLower+digits,workspaceKeyChars=b32chars,workspaceAddressChars=workspaceNameChars+b32chars+"+.",pathPunctuation="/'()-._~!$&+,:=@%",pathChars=alphaLower+alphaUpper+digits+pathPunctuation;function assembleAuthorAddress(q,_){return`@${q}.${_}`}function assembleShareAddress(q,_){return`+${q}.${_}`}function checkAuthorIsValid(q){const _=parseAuthorAddress(q);return notErr(_)?!0:_}function checkShareIsValid(q){const _=parseShareAddress(q);return notErr(_)?!0:_}function parseAuthorOrShareAddress(q){return q.startsWith("@")?parseAuthorAddress(q):q.startsWith("+")?parseShareAddress(q):new ValidationError("address must start with either @ or +")}function parseAuthorAddress(q){return parseAddress(q,{sigil:"@",separator:".",minNameLength:4,maxNameLength:4,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:authorNameChars,allowedPubkeyCharacters:authorKeyChars,pubkeyMustStartWithB:!0})}function parseShareAddress(q){return parseAddress(q,{sigil:"+",separator:".",minNameLength:1,maxNameLength:15,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:workspaceNameChars,allowedPubkeyCharacters:workspaceKeyChars,pubkeyMustStartWithB:!0})}function parseAddress(q,_){const{sigil:M,separator:$,minNameLength:j,maxNameLength:z,minPubkeyLength:V,maxPubkeyLength:X,allowedNameCharacters:G,allowedPubkeyCharacters:Y,pubkeyMustStartWithB:Q}=_;if(typeof q!="string")return new ValidationError("address must be a string");if(q.length<4)return new ValidationError("address is too short");if(q[0]!==M)return new ValidationError(`address must start with a sigil: "${M}"`);if(q.indexOf($)===-1)return new ValidationError(`address must contain a separator character: "${$}"`);const ee=q.slice(1).split($);if(ee.length!==2)return new ValidationError(`address must have exactly 2 parts separated by a "${$}" separator`);const[te,Z]=ee;return te.length<j||te.length>z?new ValidationError(`name must be between ${j} and ${z} characters long, but is ${te.length}`):Z.length<V||Z.length>X?new ValidationError(`pubkey must be between ${V} and ${X} characters long, but is ${Z.length}`):onlyHasChars(te,G)?onlyHasChars(Z,Y)?isDigit(te[0])?new ValidationError(`name "${te}" must not start with a digit`):isDigit(Z[0])?new ValidationError(`pubkey "${Z}" must not start with a digit`):Q&&Z[0]!=="b"?new ValidationError(`pubkey "${Z}" must start with 'b'`):{address:q,name:te,pubkey:Z}:new ValidationError(`pubkey "${Z}" must only have allowed characters`):new ValidationError(`name "${te}" must only have allowed characters`)}function isPlainObject(q){return!(Object.prototype.toString.call(q)!=="[object Object]"||(""+q.constructor).startsWith("class"))}function checkLiteral(q){return _=>_!==q?`expected literal value ${JSON.stringify(q)}`:null}function checkString(q={}){return _=>{if(q.optional!==!0&&_===void 0)return"required";if(q.optional===!0&&_===void 0)return null;let M=stringLengthInBytes(_);return typeof _!="string"?"expected a string but got "+JSON.stringify(_):q.minLen!==void 0&&M<q.minLen?`string shorter than min length of ${q.minLen} chars`:q.maxLen!==void 0&&M>q.maxLen?`string shorter than max length of ${q.maxLen} chars`:q.len!==void 0&&M!==q.len?`string does not have required length of ${q.len} chars: ${_}`:q.allowedChars!==void 0&&!onlyHasChars(_,q.allowedChars)?"contains disallowed characters":null}}function checkInt(q={}){return _=>q.optional!==!0&&_===void 0?"required":q.optional===!0&&_===void 0?null:q.nullable!==!0&&_===null?"not nullable":q.nullable===!0&&_===null?null:typeof _!="number"?"expected a number but got "+JSON.stringify(_):isNaN(_)?"is NaN":isFinite(_)?_!==Math.round(_)?"expected an integer":q.min!==void 0&&_<q.min?`integer too small (must be >= ${q.min})`:q.max!==void 0&&_>q.max?`integer too large (must be <= ${q.max})`:null:"is Infinity"}function checkObj(q={}){return q.allowLiteralUndefined=q.allowLiteralUndefined??!1,q.allowExtraKeys=q.allowExtraKeys??!1,_=>{if(!isPlainObject(_))return"expected an object";if(q.allowLiteralUndefined===!1){for(let[M,$]of Object.entries(_))if($===void 0)return`${M} is explicitly set to undefined but should be missing instead`}if(q.objSchema!==void 0){if(q.allowExtraKeys===!1){let M=Object.keys(_),$=Object.keys(q.objSchema),j=M.filter(z=>$.indexOf(z)===-1);if(j.length>0)return`object has extra keys not in the schema: ${j.join(", ")}`}for(let[M,$]of Object.entries(q.objSchema)){let j=$(_[M]);if(j!==null)return`${M}: ${j}`}}return null}}const{codec}=rfc4648,myEncoding={chars:"abcdefghijklmnopqrstuvwxyz234567",bits:5};function base32BytesToString(q){return"b"+codec.stringify(q,myEncoding,{pad:!1})}function base32StringToBytes(q){if(!q.startsWith("b"))throw new ValidationError("can't decode base32 string - it should start with a 'b'. "+q);if(q[q.length-1]==="=")throw new ValidationError("can't decode base32 string - it contains padding characters ('=')");return codec.parse(q.slice(1),myEncoding,{loose:!0})}var LogLevel;(function(q){q[q.None=-1]="None",q[q.Error=0]="Error",q[q.Warn=1]="Warn",q[q.Log=2]="Log",q[q.Info=3]="Info",q[q.Debug=4]="Debug"})(LogLevel||(LogLevel={}));const DEFAULT_LOG_LEVEL=LogLevel.Error;let globalLogLevels={_default:DEFAULT_LOG_LEVEL};function getLogLevel(q){return q in globalLogLevels?globalLogLevels[q]:globalLogLevels._default}class Logger{constructor(_,M){Object.defineProperty(this,"source",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.source=_,this.color=M||"aqua"}_print(_,M,$,...j){if(_<=getLogLevel(this.source))if(M){const z=`[${this.source}]`;if(this.color!==void 0){const V=[`%c ${z}`,`color: ${this.color}`];console.log($,...V,...j)}else console.log($,z,...j)}else console.log($,...j)}error(..._){this._print(LogLevel.Error,!0,"!!",..._)}warn(..._){this._print(LogLevel.Warn,!0,"! ",..._)}log(..._){this._print(LogLevel.Log,!0,"  ",..._)}info(..._){this._print(LogLevel.Info,!0,"    ",..._)}debug(..._){this._print(LogLevel.Debug,!0,"      ",..._)}blank(){this._print(LogLevel.Info,!1,"")}}class UpdatableHash{constructor(_){Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalDigest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.hash=_.hash,this.internalUpdate=_.update,this.internalDigest=_.digest}update(_){return this.hash=this.internalUpdate(this.hash,_),this.hash}digest(){return this.internalDigest(this.hash)}}const{createHash}=sha256_uint8array,logger$7=new Logger("crypto-driver-noble","cyan"),CryptoDriverNoble=class{static sha256(q){return typeof q=="string"?Promise.resolve(createHash("sha256").update(q,"utf-8").digest()):Promise.resolve(createHash("sha256").update(q).digest())}static updatableSha256(){return new UpdatableHash({hash:createHash("sha256"),update:(q,_)=>q.update(_),digest:q=>q.digest()})}static async generateKeypairBytes(){logger$7.debug("generateKeypairBytes");const q=utils$2.randomPrivateKey();return{pubkey:await getPublicKey(q),secret:q}}static sign(q,_){return logger$7.debug("sign"),typeof _=="string"&&(_=stringToBytes(_)),sign(_,q.secret)}static async verify(q,_,M){logger$7.debug("verify");try{return typeof M=="string"&&(M=stringToBytes(M)),await verify(_,M,q)}catch{return!1}}};function microsecondNow(){return Date.now()*1e3}function sleep(q){return new Promise(_=>{setTimeout_1(_,q)})}function randomId(){return""+Math.floor(Math.random()*1e3)+Math.floor(Math.random()*1e3)}function decodeKeypairToBytes(q){try{const _=isAuthorKeypair(q)?q.address:q.shareAddress,M=parseAuthorOrShareAddress(_);if(isErr(M))return M;const $={pubkey:base32StringToBytes(M.pubkey),secret:base32StringToBytes(q.secret)};return $.pubkey.length!==32?new ValidationError(`pubkey bytes should be 32 bytes long, not ${$.pubkey.length} after base32 decoding.  ${_}`):$.secret.length!==32?new ValidationError(`secret bytes should be 32 bytes long, not ${$.secret.length} after base32 decoding.  ${q.secret}`):$}catch(_){return new ValidationError("crash while decoding author keypair: "+_.message)}}function isAuthorKeypair(q){return"address"in q}new Logger("crypto","cyan");let GlobalCryptoDriver=CryptoDriverNoble,logger$6=new Logger("crypto","cyan");const Crypto=class{static async sha256base32(q){const _=await GlobalCryptoDriver.sha256(q);return base32BytesToString(_)}static updatableSha256(){return GlobalCryptoDriver.updatableSha256()}static async generateAuthorKeypair(q){logger$6.debug(`generateAuthorKeypair("${q}")`);const _=await GlobalCryptoDriver.generateKeypairBytes(),M={address:assembleAuthorAddress(q,base32BytesToString(_.pubkey)),secret:base32BytesToString(_.secret)},$=checkAuthorIsValid(M.address);return isErr($)?$:M}static async generateShareKeypair(q){logger$6.debug(`generateAuthorKeypair("${q}")`);const _=await GlobalCryptoDriver.generateKeypairBytes(),M={shareAddress:assembleShareAddress(q,base32BytesToString(_.pubkey)),secret:base32BytesToString(_.secret)},$=checkShareIsValid(M.shareAddress);return isErr($)?$:M}static async sign(q,_){logger$6.debug("sign");try{const M=decodeKeypairToBytes(q);if(isErr(M))return M;const $=await GlobalCryptoDriver.sign(M,_);return base32BytesToString($)}catch(M){return new ValidationError("unexpected error while signing: "+M.message)}}static verify(q,_,M){logger$6.debug("verify");try{const $=parseAuthorOrShareAddress(q);return isErr($)?Promise.resolve(!1):GlobalCryptoDriver.verify(base32StringToBytes($.pubkey),base32StringToBytes(_),M)}catch{return Promise.resolve(!1)}}static async checkKeypairIsValid(q){logger$6.debug("checkAuthorKeypairIsValid");const _=isAuthorKeypair(q)?q.address:q.shareAddress;try{if(typeof _!="string"||typeof q.secret!="string")return new ValidationError("address and secret must be strings");const M=parseAuthorOrShareAddress(_);if(isErr(M))return M;const $="a test message to sign. "+randomId(),j=await this.sign(q,$);return isErr(j)?j:await this.verify(_,j,$)===!1?new ValidationError("pubkey does not match secret"):!0}catch(M){return new ValidationError("unexpected error in checkAuthorKeypairIsValid: "+M.message)}}};var __setFunctionName$1=globalThis&&globalThis.__setFunctionName||function(q,_,M){return typeof _=="symbol"&&(_=_.description?"[".concat(_.description,"]"):""),Object.defineProperty(q,"name",{configurable:!0,value:M?"".concat(M," ",_):_})},_a$1;new Logger("validator es.4","red");const FUTURE_CUTOFF_MINUTES$1=10,FUTURE_CUTOFF_MICROSECONDS$1=FUTURE_CUTOFF_MINUTES$1*60*1e3*1e3,MIN_TIMESTAMP$1=1e13,MAX_TIMESTAMP$1=9007199254740990,MAX_CONTENT_LENGTH=4e6,HASH_STR_LEN$1=53,SIG_STR_LEN$1=104,ES4_CORE_SCHEMA={objSchema:{format:checkLiteral("es.4"),author:checkString({allowedChars:authorAddressChars}),content:checkString({maxLen:MAX_CONTENT_LENGTH}),contentHash:checkString({allowedChars:b32chars,len:HASH_STR_LEN$1}),deleteAfter:checkInt({min:MIN_TIMESTAMP$1,max:MAX_TIMESTAMP$1,nullable:!0}),path:checkString({allowedChars:pathChars,minLen:2,maxLen:512}),signature:checkString({allowedChars:b32chars,len:SIG_STR_LEN$1}),timestamp:checkInt({min:MIN_TIMESTAMP$1,max:MAX_TIMESTAMP$1}),workspace:checkString({allowedChars:workspaceAddressChars})},allowLiteralUndefined:!1,allowExtraKeys:!1};_a$1=class{static hashDocument(q){const _={...q,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},M=this._checkBasicDocumentValidity(_);return isErr(M)?Promise.resolve(M):Crypto.sha256base32(`author	${q.author}
contentHash	${q.contentHash}
`+(q.deleteAfter===null?"":`deleteAfter	${q.deleteAfter}
`)+`format	${q.format}
path	${q.path}
timestamp	${q.timestamp}
workspace	${q.workspace}
`)}static async generateDocument({input:q,keypair:_,share:M,timestamp:$}){const j={format:"es.4",author:_.address,content:q.content,contentHash:await Crypto.sha256base32(q.content),deleteAfter:q.deleteAfter??null,path:q.path,timestamp:$,workspace:M,signature:"?"},z=await this.signDocument(_,j);return isErr(z)?z:{doc:z}}static async signDocument(q,_){const M=await this.hashDocument(_);if(isErr(M))return M;const $=await Crypto.sign(q,M);return isErr($)?$:{..._,signature:$}}static async wipeDocument(q,_){if(_.content.length===0)return _;const M=this.removeExtraFields(_);if(isErr(M))return M;const j={...M.doc,content:"",contentHash:await Crypto.sha256base32(""),signature:"?"};return this.signDocument(q,j)}static removeExtraFields(q){if(!isPlainObject(q))return new ValidationError("doc is not a plain javascript object");const _=new Set(Object.keys(ES4_CORE_SCHEMA.objSchema||{})),M={},$={};for(const[j,z]of Object.entries(q))if(_.has(j))M[j]=z;else{if(!j.startsWith("_"))return new ValidationError("extra document fields must have names starting with an underscore");$[j]=z}return{doc:M,extras:$}}static async checkDocumentIsValid(q,_){_===void 0&&(_=Date.now()*1e3);const M=this._checkBasicDocumentValidity(q);if(isErr(M))return M;const $=this._checkTimestampIsOk(q.timestamp,q.deleteAfter,_);if(isErr($))return $;const j=this._checkAuthorCanWriteToPath(q.author,q.path);if(isErr(j))return j;const z=this._checkPathIsValid(q.path,q.deleteAfter);if(isErr(z))return z;const V=checkAuthorIsValid(q.author);if(isErr(V))return V;const X=checkShareIsValid(q.workspace);if(isErr(X))return X;const G=await this._checkAuthorSignatureIsValid(q);if(isErr(G))return G;const Y=await this._checkContentMatchesHash(q.content,q.contentHash);return isErr(Y)?Y:!0}static _checkBasicDocumentValidity(q){const _=checkObj(ES4_CORE_SCHEMA)(q);return _!==null?new ValidationError(_):!0}static _checkAuthorCanWriteToPath(q,_){return _.indexOf("~")===-1||_.indexOf("~"+q)!==-1?!0:new ValidationError(`author ${q} can't write to path ${_}`)}static _checkTimestampIsOk(q,_,M){if(q>M+FUTURE_CUTOFF_MICROSECONDS$1)return new ValidationError("timestamp too far in the future");if(_!==null){if(M>_)return new ValidationError("ephemeral doc has expired");if(_<=q)return new ValidationError("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(q,_){if(!q.startsWith("/"))return new ValidationError("invalid path: must start with /");if(q.endsWith("/"))return new ValidationError("invalid path: must not end with /");if(q.startsWith("/@"))return new ValidationError('invalid path: must not start with "/@"');if(q.indexOf("//")!==-1)return new ValidationError("invalid path: must not contain two consecutive slashes");if(_!==void 0){if(q.indexOf("!")===-1&&_!==null)return new ValidationError("when deleteAfter is set, path must contain '!'");if(q.indexOf("!")!==-1&&_===null)return new ValidationError("when deleteAfter is null, path must not contain '!'")}return!0}static async _checkAuthorSignatureIsValid(q){try{const _=await this.hashDocument(q);return isErr(_)?_:await Crypto.verify(q.author,q.signature,_)!==!0?new ValidationError("signature is invalid"):!0}catch{return new ValidationError("signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(q,_){return await Crypto.sha256base32(q)!==_?new ValidationError("content does not match contentHash"):!0}static getAttachmentInfo(q){return new ValidationError("es.4 does not support attachments")}static updateAttachmentFields(q,_,M,$){return Promise.resolve(new ValidationError("es.4 does not support attachments"))}static authorFromCredentials(q){return q.address}},__setFunctionName$1(_a$1,"FormatEs4"),Object.defineProperty(_a$1,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.4"});var __setFunctionName=globalThis&&globalThis.__setFunctionName||function(q,_,M){return typeof _=="symbol"&&(_=_.description?"[".concat(_.description,"]"):""),Object.defineProperty(q,"name",{configurable:!0,value:M?"".concat(M," ",_):_})},_a;new Logger("validator es.5","red");const FUTURE_CUTOFF_MINUTES=10,FUTURE_CUTOFF_MICROSECONDS=FUTURE_CUTOFF_MINUTES*60*1e3*1e3,MIN_TIMESTAMP=1e13,MAX_TIMESTAMP=9007199254740990,MAX_TEXT_LENGTH=8e3,HASH_STR_LEN=53,SIG_STR_LEN=104,MIN_BLOB_SIZE=0,MAX_BLOB_SIZE=Number.MAX_SAFE_INTEGER,ES5_CORE_SCHEMA={objSchema:{format:checkLiteral("es.5"),author:checkString({allowedChars:authorAddressChars}),text:checkString({maxLen:MAX_TEXT_LENGTH}),textHash:checkString({allowedChars:b32chars,len:HASH_STR_LEN}),deleteAfter:checkInt({min:MIN_TIMESTAMP,max:MAX_TIMESTAMP,optional:!0}),path:checkString({allowedChars:pathChars,minLen:2,maxLen:512}),signature:checkString({allowedChars:b32chars,len:SIG_STR_LEN}),shareSignature:checkString({allowedChars:b32chars,len:SIG_STR_LEN}),timestamp:checkInt({min:MIN_TIMESTAMP,max:MAX_TIMESTAMP}),share:checkString({allowedChars:workspaceAddressChars}),attachmentSize:checkInt({min:MIN_BLOB_SIZE,max:MAX_BLOB_SIZE,optional:!0}),attachmentHash:checkString({allowedChars:b32chars,len:HASH_STR_LEN,optional:!0})},allowLiteralUndefined:!1,allowExtraKeys:!1},FormatEs5=(_a=class{static hashDocument(q){const _={...q,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",shareSignature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},M=this._checkBasicDocumentValidity(_);return isErr(M)?Promise.resolve(M):Crypto.sha256base32((q.attachmentHash===void 0?"":`attachmentHash	${q.attachmentHash}
`)+(q.attachmentSize===void 0?"":`attachmentSize	${q.attachmentSize}
`)+`author	${q.author}
`+(q.deleteAfter===void 0?"":`deleteAfter	${q.deleteAfter}
`)+`format	${q.format}
path	${q.path}
textHash	${q.textHash}
timestamp	${q.timestamp}
share	${q.share}
`)}static async generateDocument({input:q,keypair:_,share:M,timestamp:$,prevLatestDoc:j,config:z}){if(q.text===void 0&&(j==null?void 0:j.text)===void 0)return new ValidationError("Couldn't determine document text from given input or previous version's text.");const V=q.text!==void 0?q.text:j==null?void 0:j.text,X={...j,format:"es.5",author:_.address,text:V,textHash:await Crypto.sha256base32(V),path:q.path,timestamp:$,share:M,signature:"?",shareSignature:"?"};q.deleteAfter&&(X.deleteAfter=q.deleteAfter);const G=await this.signDocument(_,X,z);return isErr(G)?G:q.attachment?{doc:G,attachment:q.attachment}:{doc:G}}static async signDocument(q,_,M){const $=await this.hashDocument(_);if(isErr($))return $;const j=await Crypto.sign(q,$);if(M.shareSecret===void 0)return new EarthstarError(`Tried to write a document to ${_.share} without the secret.`);const z=await Crypto.sign({shareAddress:_.share,secret:M.shareSecret},$);return isErr(j)?j:isErr(z)?z:{..._,signature:j,shareSignature:z}}static async wipeDocument(q,_,M){if(_.text.length===0)return _;const $=this.removeExtraFields(_);if(isErr($))return $;const j=$.doc;if(j.attachmentHash){const V={...j,text:"",textHash:await Crypto.sha256base32(""),signature:"?",shareSignature:"?",attachmentHash:await Crypto.sha256base32(""),attachmentSize:0};return this.signDocument(q,V,M)}const z={...j,text:"",textHash:await Crypto.sha256base32(""),signature:"?",shareSignature:"?"};return this.signDocument(q,z,M)}static removeExtraFields(q){if(!isPlainObject(q))return new ValidationError("doc is not a plain javascript object");const _=new Set(Object.keys(ES5_CORE_SCHEMA.objSchema||{})),M={},$={};for(const[j,z]of Object.entries(q))if(_.has(j))M[j]=z;else{if(!j.startsWith("_"))return new ValidationError("extra document fields must have names starting with an underscore");$[j]=z}return{doc:M,extras:$}}static async checkDocumentIsValid(q,_){_===void 0&&(_=Date.now()*1e3);const M=this._checkBasicDocumentValidity(q);if(isErr(M))return M;const $=this._checkTimestampIsOk(q.timestamp,q.deleteAfter?q.deleteAfter:null,_);if(isErr($))return $;const j=this._checkAuthorCanWriteToPath(q.author,q.path);if(isErr(j))return j;const z=this._checkAttachmentFieldsConsistent(q);if(isErr(z))return z;const V=this._checkPathIsValid(q.path,!!q.attachmentHash,q.deleteAfter);if(isErr(V))return V;const X=checkAuthorIsValid(q.author);if(isErr(X))return X;const G=checkShareIsValid(q.share);if(isErr(G))return G;const Y=await this._checkAuthorSignatureIsValid(q);if(isErr(Y))return Y;const Q=await this._checkShareSignatureIsValid(q);if(isErr(Q))return Q;const ee=await this._checkContentMatchesHash(q.text,q.textHash);return isErr(ee)?ee:!0}static _checkBasicDocumentValidity(q){const _=checkObj(ES5_CORE_SCHEMA)(q);return _!==null?new ValidationError(_):!0}static _checkAttachmentFieldsConsistent(q){return q.text.length===0&&q.attachmentSize&&q.attachmentSize>0?new ValidationError("Documents with attachments must have text."):(q.text.length>0&&q.attachmentSize&&q.attachmentSize,q.attachmentHash&&q.attachmentSize===void 0?new ValidationError("Attachment size is undefined while attachment hash is defined"):q.attachmentSize&&q.attachmentHash===void 0?new ValidationError("Attachment hash is undefined while attachment size is defined"):!0)}static _checkAuthorCanWriteToPath(q,_){return _.indexOf("~")===-1||_.indexOf("~"+q)!==-1?!0:new ValidationError(`author ${q} can't write to path ${_}`)}static _checkTimestampIsOk(q,_,M){if(q>M+FUTURE_CUTOFF_MICROSECONDS)return new ValidationError("timestamp too far in the future");if(_!==null){if(M>_)return new ValidationError("ephemeral doc has expired");if(_<=q)return new ValidationError("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(q,_,M){if(!q.startsWith("/"))return new ValidationError("invalid path: must start with /");if(q.endsWith("/"))return new ValidationError("invalid path: must not end with /");if(q.startsWith("/@"))return new ValidationError('invalid path: must not start with "/@"');if(q.indexOf("//")!==-1)return new ValidationError("invalid path: must not contain two consecutive slashes");if(M!==void 0){if(q.indexOf("!")===-1&&M!==null)return new ValidationError("when deleteAfter is set, path must contain '!'");if(q.indexOf("!")!==-1&&M===null)return new ValidationError("when deleteAfter is null, path must not contain '!'")}return!pathHasFileExtension(q)&&_?new ValidationError("when a attachment is provided, the path must end with a file extension"):pathHasFileExtension(q)&&_===!1?new ValidationError("when no attachment is provided, the path cannot end with a file extension"):!0}static async _checkAuthorSignatureIsValid(q){try{const _=await this.hashDocument(q);return isErr(_)?_:await Crypto.verify(q.author,q.signature,_)!==!0?new ValidationError("signature is invalid"):!0}catch{return new ValidationError("signature is invalid (unexpected exception)")}}static async _checkShareSignatureIsValid(q){try{const _=await this.hashDocument(q);return isErr(_)?_:await Crypto.verify(q.share,q.shareSignature,_)!==!0?new ValidationError("share signature is invalid"):!0}catch{return new ValidationError("share signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(q,_){return await Crypto.sha256base32(q)!==_?new ValidationError("content does not match contentHash"):!0}static getAttachmentInfo(q){return q.attachmentHash&&q.attachmentSize===0?new ValidationError("This document has had its attachment wiped"):!q.attachmentHash||!q.attachmentSize?new ValidationError("This document has no attachment."):{size:q.attachmentSize,hash:q.attachmentHash}}static updateAttachmentFields(q,_,M,$,j){const z={..._,attachmentHash:$,attachmentSize:M};return this.signDocument(q,z,j)}static authorFromCredentials(q){return q.address}},__setFunctionName(_a,"FormatEs5"),Object.defineProperty(_a,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.5"}),_a),fileExtensionRegex=/^.*\.(\w+)$/,endingWithKeypairAddrRegex=/^.*~@\w{4}\.\w{53}$/;function pathHasFileExtension(q){if(q.indexOf(".")===-1)return!1;const _=q.match(fileExtensionRegex);return!(_===null||_[1].length===53&&q.match(endingWithKeypairAddrRegex))}const DEFAULT_FORMAT=FormatEs5,DEFAULT_FORMATS=[DEFAULT_FORMAT];function getFormatWithFallback(q){return q||DEFAULT_FORMAT}function getFormatsWithFallback(q){return q||DEFAULT_FORMATS}function getFormatIntersection(q,_){const M=[];for(const $ of _)q.includes($.id)&&M.push($);return M}function getFormatLookup(q){const _=q||DEFAULT_FORMATS,M={};for(const $ of _)M[$.id]=$;return M}class MultiDeferred{constructor(){Object.defineProperty(this,"deferreds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"pending"})}resolve(_){if(this.state==="pending"){this.state="fulfilled";for(const M of this.deferreds)M.resolve(_)}}reject(_){if(this.state==="pending"){this.state="rejected";for(const M of this.deferreds)M.reject(_)}}getPromise(){const _=deferred();return this.state==="fulfilled"?_.resolve():this.state==="rejected"?_.reject():this.deferreds.add(_),_}}class PromiseEnroller{constructor(_=!1){Object.defineProperty(this,"promises",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"sealed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"multiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new MultiDeferred}),Object.defineProperty(this,"allowRejectedPromises",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.allowRejectedPromises=_}enrol(_){if(this.sealed)throw new EarthstarError("Tried to enrol a promise when enrolment was already sealed.");this.promises.add(_),_.then(()=>{this.checkAllDone()}).catch(M=>{if(!this.allowRejectedPromises)throw M})}checkAllDone(){this.sealed&&(this.allowRejectedPromises?Promise.allSettled(this.promises).then(()=>{this.multiDeferred.resolve()}):Promise.all(this.promises).then(()=>{this.multiDeferred.resolve()}).catch(()=>{this.multiDeferred.reject()}))}seal(){this.sealed||(this.sealed=!0,this.checkAllDone())}isSealed(){return this.sealed}isDone(){return this.multiDeferred.getPromise()}}class CombineStream{constructor(){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"transform",{enumerable:!0,configurable:!0,writable:!0,value:new TransformStream({transform(_,M){M.enqueue(_)}})}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:this.transform.writable.getWriter()}),Object.defineProperty(this,"readable",{enumerable:!0,configurable:!0,writable:!0,value:this.transform.readable}),Object.defineProperty(this,"writables",{enumerable:!0,configurable:!0,writable:!0,value:[]})}checkClosed(){if(this.closed)throw"Closed"}getWritableStream(){this.checkClosed();const _=this.writer,M=new WritableStream({async write($){await _.ready,await _.write($)}});return this.writables.push(M),M}async close(){this.checkClosed();for(const _ of this.writables)await _.abort();this.transform.writable.abort(),this.closed=!0}isClosed(){return this.closed}}class CloneStream{constructor(){Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:new TransformStream(new PassThroughTransformer)}),Object.defineProperty(this,"sourceReadable",{enumerable:!0,configurable:!0,writable:!0,value:this.transformStream.readable}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:this.transformStream.writable})}getReadableStream(){const[_,M]=this.sourceReadable.tee();return this.sourceReadable=_,M}}class CloneMidStream{checkClosed(){if(this.closed)throw"Closed"}constructor(){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"subscribers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"writables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const _=this.subscribers;this.writable=new WritableStream({write(M){const $=_.map(({writer:j})=>new Promise(z=>{j.ready.then(()=>{j.write(M).then(z)})}));Promise.all($)}})}getReadableStream(){this.checkClosed();const _=new TransformStream({transform(M,$){$.enqueue(M)}});return this.subscribers.push({transform:_,writer:_.writable.getWriter()}),_.readable}async close(){this.checkClosed();for(const _ of this.writables)await _.abort();for(const{transform:_}of this.subscribers)await _.writable.abort(),await _.readable.cancel();this.closed=!0}isClosed(){return this.closed}}class MultiStream{checkClosed(){if(this.closed)throw"Closed"}constructor(_){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineStream",{enumerable:!0,configurable:!0,writable:!0,value:new CombineStream}),Object.defineProperty(this,"cloneStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),_?this.cloneStream=new CloneMidStream:this.cloneStream=new CloneStream,this.combineStream.readable.pipeTo(this.cloneStream.writable)}getWritableStream(){return this.combineStream.getWritableStream()}getReadableStream(){return this.cloneStream.getReadableStream()}close(){this.checkClosed(),this.combineStream.close(),this.closed=!0}isClosed(){return this.closed}}class CallbackSink{constructor(){Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set})}onWrite(_){return this.callbacks.add(_),()=>{this.callbacks.delete(_)}}async write(_){for(const M of this.callbacks)await M(_)}close(){this.callbacks.clear()}}class BlockingBus{constructor(){Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"lock",{enumerable:!0,configurable:!0,writable:!0,value:new LockStream})}on(_){return this.callbacks.add(_),()=>{this.callbacks.delete(_)}}async send(_){for(const M of this.callbacks)await this.lock.run(()=>M(_))}}class PassThroughTransformer{transform(_,M){M.enqueue(_)}}class LockStream{constructor(){Object.defineProperty(this,"doneEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new PromiseEnroller}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:new WritableStream({async write(_){await _()}})}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:this.writable.getWriter()}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1})}checkClosed(){if(this.closed)throw"Closed"}async run(_){this.checkClosed(),await this.writer.ready;const M=this.writer.write(_);return this.doneEnroller.enrol(M),M}async close(){this.checkClosed(),this.doneEnroller.seal(),await this.doneEnroller.isDone(),this.writer.releaseLock(),await this.writable.abort(),this.closed=!0}isClosed(){return this.closed}}class ChannelTransformer{constructor(_,M){Object.defineProperty(this,"channel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.channel=_,this.channelKey=M}transform(_,M){if(this.channel==="*"||this.channel===_[this.channelKey]){M.enqueue(_);return}}}class ChannelMultiStream{constructor(_,M){Object.defineProperty(this,"multistream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.multistream=new MultiStream(M),this.channelKey=_}getWritableStream(){return this.multistream.getWritableStream()}getReadableStream(_){const M=new TransformStream(new ChannelTransformer(_,this.channelKey));return this.multistream.getReadableStream().pipeThrough(M)}}function websocketWritable(q,_){const M=deferred(),$=deferred(),j=()=>{if($.state==="pending"){let z;q instanceof WebSocket$1?z=q:z=new WebSocket$1(q),$.resolve(z),z.binaryType="arraybuffer",z.readyState===z.OPEN&&M.resolve(),z.onopen=()=>{M.resolve()}}};return new WritableStream({async write(z,V){j();const X=await $;await M;try{const G=_(z);X.send(G)}catch(G){V.error(G)}X.onclose=()=>{V.error("Socket closed before we were done")}},async close(){j();const z=await $;await M,z.close()},async abort(){j();const z=await $;await M,z.close()}})}function websocketReadable(q,_){const M=deferred();let $=!1;const j=()=>{if(M.state==="pending")if(q instanceof WebSocket$1)M.resolve(q);else try{const z=new WebSocket$1(q);M.resolve(z)}catch(z){M.reject(z)}};return new ReadableStream$1({async start(z){j();const V=await M;V.binaryType="arraybuffer",V.onmessage=X=>{const G=_(X);try{z.enqueue(G)}catch{}},V.onclose=()=>{if(!$)try{z.close()}catch{}},V.onerror=X=>{$=!0,z.error(X)}},async cancel(){j(),(await M).close()}})}function bigIntToHex(q){let M=q.toString(16);return M.length%2&&(M="0"+M),M}function bigIntFromHex(q){return BigInt("0x"+q)}const TYPE_MAPPINGS={EMPTY_SET:"emptySet",LOWER_BOUND:"lowerBound",PAYLOAD:"payload",EMPTY_PAYLOAD:"emptyPayload",DONE:"done",FINGERPRINT:"fingerprint",TERMINAL:"terminal"},encoding={encode:{emptySet:q=>({type:"EMPTY_SET",canRespond:q}),lowerBound:q=>({type:"LOWER_BOUND",value:q}),payload:(q,_)=>({type:"PAYLOAD",payload:q,..._?{end:_}:{}}),emptyPayload:q=>({type:"EMPTY_PAYLOAD",upperBound:q}),done:q=>({type:"DONE",upperBound:q}),fingerprint:(q,_)=>({type:"FINGERPRINT",fingerprint:bigIntToHex(q),upperBound:_}),terminal:()=>({type:"TERMINAL"})},decode:{getType:q=>TYPE_MAPPINGS[q.type],emptySet:q=>{if(q.type==="EMPTY_SET")return q.canRespond;throw"Can't decode"},lowerBound:q=>{if(q.type==="LOWER_BOUND")return q.value;throw"Can't decode"},payload:q=>{if(q.type==="PAYLOAD")return{value:q.payload,...q.end?{end:q.end}:{}};throw"Can't decode"},emptyPayload:q=>{if(q.type==="EMPTY_PAYLOAD")return q.upperBound;throw"Can't decode"},done:q=>{if(q.type==="DONE")return q.upperBound;throw"Can't decode"},fingerprint:q=>{if(q.type==="FINGERPRINT")return{fingerprint:bigIntFromHex(q.fingerprint),upperBound:q.upperBound};throw"Can't decode"},terminal:q=>{if(q.type==="TERMINAL")return!0;throw"Can't decode"}}};class EarthstarRangeMessenger extends RangeMessenger{constructor(_,M,$){super({tree:_,encoding,fingerprintEquals:(j,z)=>j===z,payloadThreshold:M,rangeDivision:$})}}class SyncAgent{sendEvent(_){return this.inboundEventQueue.push(_)}events(){return this.outboundEventQueue}getStatus(){return{requestedCount:this.requestedCount,receivedCount:this.receivedDocsCount,sentCount:this.sentDocsCount,status:this.isDoneMultiDeferred.state==="rejected"?"aborted":this.hasPrepared.state==="pending"?"preparing":this.hasReconciled.state==="pending"?"reconciling":this.isDoneMultiDeferred.state==="fulfilled"?"done":"gossiping"}}constructor(_){Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"isDoneMultiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new MultiDeferred}),Object.defineProperty(this,"inboundEventQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"outboundEventQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"gossiperInboundQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"reconcilerInboundQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"hasPrepared",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"hasReconciled",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"hasCheckedAllExistingDocsForAttachments",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"requestedCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sentDocsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"receivedDocsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"counterpartId",{enumerable:!0,configurable:!0,writable:!0,value:randomId()}),Object.defineProperty(this,"replica",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.replica=_.replica,_.replica.onEvent(V=>{V.kind==="willClose"&&this.cancel()});const{treeIsReady:M}=_.syncerManager.getDocThumbnailTreeAndDocLookup(_.replica.share,getFormatsWithFallback(_.formats));M.then(()=>{this.hasPrepared.resolve()}),(async()=>{for await(const V of this.inboundEventQueue)switch(V.kind){case"RANGE_MSG":{this.reconcilerInboundQueue.push(V.message);break}default:this.gossiperInboundQueue.push(V)}})(),new ExistingDocAttachmentChecker({outboundEventQueue:this.outboundEventQueue,formats:_.formats,replica:_.replica,counterpartId:this.counterpartId,transferManager:_.transferManager,hasCheckedAllExistingDocsForAttachments:this.hasCheckedAllExistingDocsForAttachments});const $=new WantTracker,j=new SyncAgentReconciler({inboundEventQueue:this.reconcilerInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:_.syncerManager,formats:_.formats,replica:_.replica,initiateMessaging:_.initiateMessaging,wantTracker:$,payloadThreshold:_.payloadThreshold,rangeDivision:_.rangeDivision,onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}});j.isDone.then(()=>{this.hasReconciled.resolve()}),new SyncAgentGossiper({inboundEventQueue:this.gossiperInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:_.syncerManager,formats:_.formats,replica:_.replica,counterpartId:this.counterpartId,transferManager:_.transferManager,cancel:this.cancel.bind(this),reconciliationIsDone:j.isDone,wantTracker:$,syncAppetite:_.syncAppetite,onDocReceived:async()=>{this.receivedDocsCount++,await this.statusBus.send(this.getStatus())},onDocSent:async()=>{this.sentDocsCount++,await this.statusBus.send(this.getStatus())},onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}}).isDone.then(async()=>{await this.hasCheckedAllExistingDocsForAttachments,this.isDoneMultiDeferred.resolve()}),this.statusBus.send(this.getStatus())}onStatusUpdate(_){return this.statusBus.on(_)}async cancel(_){this.isDoneMultiDeferred.state==="fulfilled"||this.isDoneMultiDeferred.state==="rejected"||(this.isDoneMultiDeferred.reject(_||"Cancelled"),await this.statusBus.send(this.getStatus()),this.outboundEventQueue.push({kind:"ABORT"}),this.outboundEventQueue.close(),this.inboundEventQueue.close({immediately:!0}),this.gossiperInboundQueue.close({immediately:!0}),this.reconcilerInboundQueue.close({immediately:!0}))}isDone(){return this.isDoneMultiDeferred.getPromise()}}class SyncAgentGossiper{constructor(_){Object.defineProperty(this,"isPartnerFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"isFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:deferred()});const M=getFormatLookup(_.formats),$=_.syncerManager.getPlumTree(_.replica.share);if(_.syncAppetite==="continuous"){const V=_.replica.getQueryStream(void 0,"new",_.formats),X=new XXH64;V.pipeTo(new WritableStream({async write(G){if(G.kind==="success"&&G.sourceId!==_.counterpartId){const Y=$.getMode(G.sourceId);X.reset(),X.update(`${G.doc.path} ${G.doc.author}`);const Q=X.digest().toString(16),ee=`${G.doc.timestamp} ${Q}`;if(Y==="EAGER"){const te=M[G.doc.format],Z=te.getAttachmentInfo(G.doc),ne=!isErr(Z);let re=!1;ne&&await _.replica.getAttachment(G.doc,te)&&(re=!0),_.outboundEventQueue.push({kind:"DOC",thumbnail:ee,doc:G.doc,attachmentHeld:re}),_.onDocSent()}else _.outboundEventQueue.push({kind:"HAVE",thumbnail:ee})}}})).catch(()=>{})}const j=_.replica.onEvent(V=>{V.kind==="attachment_ingest"&&V.sourceId!==_.counterpartId&&_.outboundEventQueue.push({kind:"NEW_ATTACHMENT",path:V.doc.path,author:V.doc.author,format:V.doc.format,hash:V.hash})}),{lookup:z}=_.syncerManager.getDocThumbnailTreeAndDocLookup(_.replica.share,getFormatsWithFallback(_.formats));(async()=>{for await(const V of _.inboundEventQueue)switch(V.kind){case"PRUNE":{$.onPrune(_.counterpartId);break}case"HAVE":{if(_.reconciliationIsDone.state==="fulfilled"&&_.syncAppetite==="once")break;_.wantTracker.addWantedThumbnail(V.thumbnail),$.onLazyMessage(V,X=>{_.outboundEventQueue.push({kind:"WANT",thumbnail:X})}),_.onDocRequested();break}case"WANT":{$.onGraftMessage(_.counterpartId);const[,X]=V.thumbnail.split(" "),G=z[X];if(!G)return;const[,Y,Q]=G,te=(await _.replica.getAllDocsAtPath(Y,_.formats)).find(Z=>Z.author===Q);if(te){const Z=M[te.format],ne=Z.getAttachmentInfo(te),re=!isErr(ne);let se=!1;re&&await _.replica.getAttachment(te,Z)&&(se=!0),_.outboundEventQueue.push({kind:"DOC",thumbnail:V.thumbnail,doc:te,attachmentHeld:se}),await _.onDocSent()}else console.error("Got a WANT event for a document not on record.");break}case"DOC":{if(this.isFulfilled.state==="fulfilled"&&_.syncAppetite==="once"||($.onEagerMessage(_.counterpartId,V)&&_.outboundEventQueue.push({kind:"PRUNE"}),_.wantTracker.isReceived(V.thumbnail)))break;const G=M[V.doc.format];if(!G){console.error(`Was sent a doc with a format we don't know about (${V.doc.format})`);break}if(V.attachmentHeld&&await _.replica.getAttachment(V.doc,M[V.doc.format])===void 0){const Q=await _.transferManager.handleDownload(V.doc,_.replica,_.counterpartId);if(isErr(Q)){const ee=G.getAttachmentInfo(V.doc);_.transferManager.registerExpectedTransfer(_.replica.share,ee.hash),_.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:ee.hash,doc:V.doc,shareAddress:_.replica.share})}}await _.replica.ingest(G,V.doc,_.counterpartId),_.wantTracker.receivedWantedThumbnail(V.thumbnail),await _.onDocReceived();break}case"NEW_ATTACHMENT":{if(_.transferManager.isAlreadyQueued(V.hash,"download"))break;const X=M[V.format],Y=(await _.replica.getAllDocsAtPath(V.path,[X])).find(ee=>V.author===ee.author);if(!Y)break;if(await _.replica.getAttachment(Y,M[Y.format])===void 0){const ee=await _.transferManager.handleDownload(Y,_.replica,_.counterpartId);if(isErr(ee)){const te=X.getAttachmentInfo(Y);_.transferManager.registerExpectedTransfer(_.replica.share,te.hash),_.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:te.hash,doc:Y,shareAddress:_.replica.share})}}break}case"FULFILLED":this.isPartnerFulfilled.resolve(!0);break;case"WANT_ATTACHMENT":_.transferManager.handleUpload(V,_.replica);break;case"ABORT":await _.cancel()}})(),_.reconciliationIsDone.then(async()=>{_.syncAppetite==="once"&&(j(),_.wantTracker.seal(),await _.wantTracker.isDone(),_.outboundEventQueue.push({kind:"FULFILLED"}),this.isFulfilled.resolve())})}get isDone(){return Promise.all([this.isPartnerFulfilled,this.isFulfilled])}}class SyncAgentReconciler{constructor(_){Object.defineProperty(this,"communicationRoundsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isDone",{enumerable:!0,configurable:!0,writable:!0,value:deferred()});const{tree:M,lookup:$,treeIsReady:j}=_.syncerManager.getDocThumbnailTreeAndDocLookup(_.replica.share,getFormatsWithFallback(_.formats));_.initiateMessaging&&j.then(()=>{for(const V of z.initialMessages())_.outboundEventQueue.push({kind:"RANGE_MSG",message:V})});const z=new EarthstarRangeMessenger(M,_.payloadThreshold,_.rangeDivision);z.onInsertion(V=>{const[X,G]=V.split(" "),Y=$[G];Y&&Y[0]>=parseInt(X)||(_.wantTracker.addWantedThumbnail(V),_.outboundEventQueue.push({kind:"WANT",thumbnail:V}),_.onDocRequested())}),(async()=>{await j;for await(const V of _.inboundEventQueue){if(this.isDone.state==="fulfilled")return;V.type==="TERMINAL"&&this.communicationRoundsCount++;const X=z.respond(V);for(const G of X)_.outboundEventQueue.push({kind:"RANGE_MSG",message:G})}})(),z.isDone().then(()=>{this.isDone.resolve(this.communicationRoundsCount)})}}class ExistingDocAttachmentChecker{constructor(_){const M=_.replica.getQueryStream({orderBy:"localIndex ASC"},"existing",_.formats),$=getFormatLookup(_.formats),j=_.transferManager.handleDownload.bind(_.transferManager);M.pipeTo(new WritableStream({start(z){_.replica.onEvent(V=>{V.kind==="willClose"&&z.error()})},async write(z){if(z.kind==="existing"||z.kind==="success"){const V=$[z.doc.format],X=await _.replica.getAttachment(z.doc,V);if(isErr(X))return;if(X===void 0){const G=await j(z.doc,_.replica,_.counterpartId);if(isErr(G)){const Y=V.getAttachmentInfo(z.doc);_.transferManager.registerExpectedTransfer(_.replica.share,Y.hash),_.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:Y.hash,doc:z.doc,shareAddress:_.replica.share})}}}}})).then(()=>{_.hasCheckedAllExistingDocsForAttachments.resolve()}).catch(()=>{_.hasCheckedAllExistingDocsForAttachments.resolve()})}}class WantTracker{constructor(){Object.defineProperty(this,"isSealed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"wantedThumbnails",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"enroller",{enumerable:!0,configurable:!0,writable:!0,value:new PromiseEnroller}),Object.defineProperty(this,"received",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:randomId()})}addWantedThumbnail(_){if(!this.isSealed&&!this.wantedThumbnails.has(_)){const M=deferred();this.wantedThumbnails.set(_,M),this.enroller.enrol(M)}}receivedWantedThumbnail(_){const M=this.wantedThumbnails.get(_);M&&(M.resolve(),this.received++)}isRequested(_){return this.wantedThumbnails.has(_)}isReceived(_){const M=this.wantedThumbnails.get(_);return M?M.state==="fulfilled":!1}seal(){this.enroller.seal()}isDone(){return this.enroller.isDone()}get requestedCount(){return this.wantedThumbnails.size}get receivedCount(){return this.received}}class BumpingTimeout{constructor(_,M){Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.cb=_,this.ms=M,this.timeout=setTimeout_1(_,M)}bump(){this.closed||(clearTimeout(this.timeout),this.timeout=setTimeout_1(this.cb,this.ms))}close(){this.closed=!0,clearTimeout(this.timeout)}}const TIMEOUT_MS=1e4;class AttachmentTransfer{constructor({stream:_,replica:M,doc:$,format:j,requester:z,counterpartId:V}){Object.defineProperty(this,"kind",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:"ready"}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"expectedSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sourceDoc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"transferOp",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"abortCb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new MultiDeferred}),Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"requester",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.sourceDoc=$,this.share=M.share,this.requester=z;const X=j.getAttachmentInfo($);if(isErr(X))throw new ValidationError("AttachmentTransfer was given a doc which has no attachment!");this.hash=X.hash,this.expectedSize=X.size;const G=this.updateLoaded.bind(this);if(_ instanceof ReadableStream$1){this.kind="download";let Y;this.abortCb=()=>{Y?Y.cancel():_.cancel()};const Q=()=>this.loaded,ee=()=>new ReadableStream$1({async start(te){const Z=_.getReader();Y=Z;const ne=new BumpingTimeout(()=>{te.error("Attachment download timed out.")},TIMEOUT_MS);for(;;){const{done:re,value:se}=await Z.read();if(ne.bump(),re||(G(se.byteLength),te.enqueue(se),Q()>=X.size))break}ne.close(),te.close()}});this.transferOp.resolve(()=>{const te=deferred();return M.ingestAttachment(j,$,ee(),V).then(Z=>{if(isErr(Z)&&this.loaded===0){this.changeStatus("missing_attachment");return}if(isErr(Z)){console.warn(`Couldn't ingest the attachment for ${$.path} by ${$.author}: ${Z.message}`),te.reject(Z);return}te.resolve()}).catch(Z=>{console.log(Z),te.reject(Z)}),te})}else this.kind="upload",this.abortCb=()=>{_.abort().catch(()=>{})},M.getAttachment($,j).then(async Y=>{if(!Y){await this.changeStatus("missing_attachment"),await _.abort();return}if(isErr(Y)){await this.changeStatus("failed"),await _.abort();return}const Q=new TransformStream({transform(ee,te){G(ee.byteLength),te.enqueue(ee)}});this.transferOp.resolve(()=>Y.stream().then(ee=>ee.pipeThrough(Q).pipeTo(_)).catch(ee=>{console.log(ee)}))})}async start(){if(this.status!=="ready")return;const _=await this.transferOp;await this.changeStatus("in_progress"),_().then(async()=>{await this.changeStatus("complete")}).catch(async()=>{await this.changeStatus("failed")})}updateLoaded(_){this.loaded+=_,this.statusBus.send({status:this.status,bytesLoaded:this.loaded,totalBytes:this.expectedSize})}async changeStatus(_){this.status==="complete"||this.status==="failed"||this.status==="missing_attachment"||(this.status=_,await this.statusBus.send({status:_,bytesLoaded:this.loaded,totalBytes:this.expectedSize}),_==="complete"&&this.multiDeferred.resolve(),_==="failed"&&this.multiDeferred.reject("Attachment transfer failed"),_==="missing_attachment"&&this.multiDeferred.reject("The other peer does not have this attachment"))}get doc(){return this.sourceDoc}onProgress(_){return this.statusBus.on(_)}abort(){this.abortCb()}isDone(){return this.multiDeferred.getPromise()}}class TransferQueue{constructor(_){Object.defineProperty(this,"waiting",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"active",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"failed",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"completed",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"activeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transfersRequestedByUsEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new PromiseEnroller(!0)}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"reports",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"reportBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),this.activeLimit=_}async activate(_){this.active.add(_),_.isDone().then(()=>{this.completed.add(_)}).catch(()=>{this.failed.add(_)}).finally(()=>{this.active.delete(_),this.admitNext()}),await _.start()}queue(_){this.waiting.push(_)}admitNext(){if(this.waiting.length===0||this.active.size>=this.activeLimit)return;const _=this.waiting.shift();_&&this.activate(_)}async addTransfer(_){if(this.closed){_.abort();return}_.onProgress(()=>{this.updateTransferStatus(_)}),_.requester==="us"&&this.transfersRequestedByUsEnroller.enrol(_.isDone()),this.active.size<this.activeLimit?await this.activate(_):this.queue(_)}gotAllTransfersRequestedByUs(){this.transfersRequestedByUsEnroller.seal()}cancel(){this.closed=!0,this.transfersRequestedByUsEnroller.seal();for(const _ of this.active)_.abort()}updateTransferStatus(_){this.reports[_.share]||(this.reports[_.share]={}),this.reports[_.share][_.hash+_.kind]={author:_.doc.author,path:_.doc.path,format:_.doc.format,hash:_.hash,kind:_.kind,status:_.status,bytesLoaded:_.loaded,totalBytes:_.expectedSize},this.reportBus.send(this.getReport())}getReport(){const _={};for(const M in this.reports){const $=[],j=this.reports[M];for(const z in j){const V=j[z];$.push(V)}_[M]=$}return _}hasQueuedTransfer(_,M){for(const $ of this.waiting)if($.hash===_&&$.kind===M)return!0;for(const $ of this.active)if($.hash===_&&$.kind===M)return!0;for(const $ of this.completed)if($.hash===_&&$.kind===M)return!0;return!1}onReportUpdate(_){return this.reportBus.on(_)}transfersRequestedByUsFinished(){return this.transfersRequestedByUsEnroller.isDone()}}class TransferManager{constructor(_){Object.defineProperty(this,"partner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"otherSyncerId",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"receivedAllExpectedTransfersEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new PromiseEnroller}),Object.defineProperty(this,"madeAllAttachmentRequestsEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new PromiseEnroller(!0)}),Object.defineProperty(this,"formatsLookup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reportDidUpdateBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"expectedTransferPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.partner=_.partner,this.queue=new TransferQueue(this.partner.concurrentTransfers),this.formats=_.formats,this.formatsLookup=getFormatLookup(this.formats),this.queue.onReportUpdate(async M=>{await this.reportDidUpdateBus.send(M)}),this.madeAllAttachmentRequestsEnroller.isDone().then(()=>{this.receivedAllExpectedTransfersEnroller.seal()}),this.receivedAllExpectedTransfersEnroller.isDone().then(()=>{this.queue.gotAllTransfersRequestedByUs()})}registerSyncAgent(_){this.madeAllAttachmentRequestsEnroller.enrol(_.isDone())}allSyncAgentsKnown(){this.madeAllAttachmentRequestsEnroller.seal()}registerExpectedTransfer(_,M){const $=`${_}_${M}`;if(this.expectedTransferPromises.has($))return;const j=deferred();this.expectedTransferPromises.set($,j),this.receivedAllExpectedTransfersEnroller.enrol(j)}async queueTransfer(_){this.queue.hasQueuedTransfer(_.hash,_.kind)||await this.queue.addTransfer(_)}async handleDownload(_,M,$){const j=this.formatsLookup[_.format],z=j.getAttachmentInfo(_);if(isErr(z))throw new EarthstarError("TransferManager: attempted to download doc with no attachment.");if(this.queue.hasQueuedTransfer(z.hash,"download"))return"queued";const V=await this.partner.getDownload({doc:_,shareAddress:M.share,syncerId:await this.otherSyncerId,attachmentHash:z.hash});if(V===void 0)return"no_attachment";if(isErr(V))return V;const X=new AttachmentTransfer({replica:M,doc:_,format:j,stream:V,requester:"us",counterpartId:$});return await this.queueTransfer(X),"queued"}async handleUpload(_,M){if(this.queue.hasQueuedTransfer(_.attachmentHash,"upload"))return!1;const $=this.formatsLookup[_.doc.format];if(!await M.getAttachment(_.doc,$))return!1;const z=await this.partner.handleUploadRequest({shareAddress:_.shareAddress,syncerId:await this.otherSyncerId,doc:_.doc,attachmentHash:_.attachmentHash});if(isErr(z))return!1;try{const V=new AttachmentTransfer({doc:_.doc,format:$,replica:M,stream:z,requester:"them",counterpartId:"unused"});await this.queueTransfer(V)}catch{return!1}return!0}async handleTransferRequest({replica:_,path:M,author:$,source:j,kind:z,formatName:V,counterpartId:X}){const G=await this.partner.handleTransferRequest(j,z);if(G===void 0||isErr(G))return;const Y=getFormatLookup(this.formats)[V];if(!Y)return;const ee=(await _.getAllDocsAtPath(M,[Y])).find(Z=>Z.author===$);if(!ee)return;const te=new AttachmentTransfer({doc:ee,format:Y,replica:_,stream:G,requester:z==="upload"?"us":"them",counterpartId:X});if(te.requester==="us"){const Z=`${te.share}_${te.hash}`,ne=this.expectedTransferPromises.get(Z);ne&&ne.resolve()}await this.queueTransfer(te)}cancel(){this.queue.cancel()}getReport(){return this.queue.getReport()}onReportUpdate(_){return this.reportDidUpdateBus.on(_)}transfersRequestedByUsFinished(){return this.queue.transfersRequestedByUsFinished()}registerOtherSyncerId(_){this.otherSyncerId.resolve(_)}isAlreadyQueued(_,M){return this.queue.hasQueuedTransfer(_,M)}}class Syncer{constructor(_){Object.defineProperty(this,"peer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:randomId()}),Object.defineProperty(this,"manager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"syncAgents",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"syncAgentQueues",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"appetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"formats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transferManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partnerIsFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"isDoneMultiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new MultiDeferred}),Object.defineProperty(this,"heartbeatInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bumpingTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.manager=_.manager,this.peer=_.manager.peer,this.appetite=_.partner.syncAppetite,this.formats=getFormatsWithFallback(_.formats),this.partner=_.partner,this.transferManager=new TransferManager({partner:this.partner,formats:this.formats}),this.transferManager.onReportUpdate(async()=>{await this.statusBus.send(this.getStatus())}),this.heartbeatInterval=setInterval_1(()=>{this.partner.sendEvent({kind:"HEARTBEAT"})},1e3),(async()=>{try{for await(const $ of _.partner.getEvents())this.handleIncomingEvent($)}catch($){this.cancel($||"Partner disconnected")}})();const M=randomId();Promise.all(this.peer.shares().map($=>saltAndHashShare(M,$))).then($=>{this.partner.sendEvent({kind:"DISCLOSE",salt:M,syncerId:this.id,shares:$,formats:this.formats?this.formats.map(j=>j.id):[DEFAULT_FORMAT.id],canRespond:!1})}),this.transferManager.transfersRequestedByUsFinished().then(async()=>{_.partner.syncAppetite!=="continuous"&&(await this.partner.sendEvent({kind:"SYNCER_FULFILLED"}),await this.partnerIsFulfilled,clearInterval(this.heartbeatInterval),await this.partner.closeConnection(),this.bumpingTimeout.close(),this.isDoneMultiDeferred.resolve())}),this.peer.onReplicasChange(async $=>{if(this.appetite==="once")return;const j=Array.from($.keys());for(const[V,X]of this.syncAgents)j.includes(V)===!1&&(await X.cancel("Replica was removed from peer."),this.syncAgents.delete(V));const z=randomId();Promise.all(j.map(V=>saltAndHashShare(z,V))).then(V=>{this.partner.sendEvent({kind:"DISCLOSE",salt:z,syncerId:this.id,shares:V,formats:this.formats?this.formats.map(X=>X.id):[DEFAULT_FORMAT.id],canRespond:!0})})}),this.bumpingTimeout=new BumpingTimeout(()=>{this.cancel("No communication from the other peer in the last three seconds.")},TIMEOUT_MS)}addShare(_,M,$){if(this.syncAgents.has(_))return;const j=this.peer.getReplica(_);if(!j){console.error("Couldn't get the replica for a share we had in common.");return}const z=new SyncAgent({replica:j,formats:M,syncerManager:this.manager,transferManager:this.transferManager,initiateMessaging:$,payloadThreshold:this.partner.payloadThreshold,rangeDivision:this.partner.rangeDivision,syncAppetite:this.appetite});z.onStatusUpdate(()=>{this.statusBus.send(this.getStatus())}),this.syncAgents.set(_,z),this.transferManager.registerSyncAgent(z);const V=this.syncAgentQueues.get(_);let X;if(V)X=V;else{const G=new AsyncQueue;X=G,this.syncAgentQueues.set(_,G)}(async()=>{for await(const G of X)z.sendEvent(G)})(),(async()=>{for await(const G of z.events())await this.partner.sendEvent({to:_,...G})})()}async handleIncomingEvent(_){if(this.bumpingTimeout.bump(),this.isDoneMultiDeferred.state==="pending")switch(_.kind){case"DISCLOSE":{const M=getFormatIntersection(_.formats,this.formats);if(M.length===0)break;const $=new Set(_.shares),j=new Set,z=new Set;for(const X of this.peer.shares()){const G=await saltAndHashShare(_.salt,X);$.has(G)?j.add(X):z.add(X)}const V=this.id>_.syncerId;for(const X of j)this.addShare(X,M,V);for(const X of z){const G=this.syncAgents.get(X);G&&(G.cancel("No longer in common with the other peer."),this.syncAgents.delete(X))}if(this.transferManager.registerOtherSyncerId(_.syncerId),this.appetite==="once"&&this.transferManager.allSyncAgentsKnown(),_.canRespond){const X=randomId();Promise.all(this.peer.shares().map(G=>saltAndHashShare(X,G))).then(G=>{this.partner.sendEvent({kind:"DISCLOSE",salt:X,syncerId:this.id,shares:G,formats:this.formats?this.formats.map(Y=>Y.id):[DEFAULT_FORMAT.id],canRespond:!1})})}j.size===0&&this.appetite==="once"&&this.partner.sendEvent({kind:"SYNCER_FULFILLED"});break}case"SYNCER_FULFILLED":{this.partnerIsFulfilled.resolve();break}case"HEARTBEAT":break;default:{const{to:M}=_,$=this.syncAgentQueues.get(M);if(!$){const j=new AsyncQueue;j.push(_),this.syncAgentQueues.set(M,j);break}$.push(_)}}}getStatus(){const _={};for(const[M,$]of this.syncAgents)_[M]={docs:$.getStatus(),attachments:this.transferManager.getReport()[M]||[]};return _}onStatusChange(_){return this.statusBus.on(_)}async cancel(_){this.bumpingTimeout.close(),this.isDoneMultiDeferred.reject(_);for(const[M,$]of this.syncAgents)await $.cancel();clearInterval(this.heartbeatInterval),this.transferManager.cancel(),await this.partner.closeConnection()}handleTransferRequest({shareAddress:_,path:M,author:$,source:j,kind:z,formatName:V}){if(this.isDoneMultiDeferred.state!=="pending")return;const X=this.peer.getReplica(_);if(!X)return;let G="unused";if(z==="upload"){const Y=this.syncAgents.get(_);Y&&(G=Y.counterpartId)}return this.transferManager.handleTransferRequest({replica:X,author:$,formatName:V,kind:z,path:M,source:j,counterpartId:G})}isDone(){return this.isDoneMultiDeferred.getPromise()}}function saltAndHashShare(q,_){return Crypto.sha256base32(q+_+q)}class PartnerLocal{constructor(_,M,$,j){Object.defineProperty(this,"concurrentTransfers",{enumerable:!0,configurable:!0,writable:!0,value:1024}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"syncAppetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outgoingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"incomingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"partnerPeer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partnerSyncer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.syncAppetite=$,this.partnerPeer=_;const{incomingQueue:z,outgoingQueue:V}=this;this.partnerSyncer=new Syncer({manager:_.syncerManager,formats:j,partner:{syncAppetite:$,getEvents(){return z},sendEvent(X){return V.push(X),Promise.resolve()},concurrentTransfers:1024,payloadThreshold:32,rangeDivision:32,async getDownload(X){const G=M.getReplica(X.shareAddress);if(!G)throw new ValidationError("Tried to get a receiving transfer for an unknown share.");const Y=await G.replicaDriver.attachmentDriver.getAttachment(X.doc.format,X.attachmentHash);if(Y&&!isErr(Y))return await Y.stream()},closeConnection(){return V.close(),Promise.resolve()},handleUploadRequest(X){return Promise.resolve(new NotSupportedError("PartnerLocal does not support uploads."))},handleTransferRequest(X,G){return Promise.resolve(new NotSupportedError("PartnerLocal does not support transfer requests."))}}})}getEvents(){return this.outgoingQueue}sendEvent(_){return this.incomingQueue.push(_),Promise.resolve()}closeConnection(){return this.incomingQueue.close(),Promise.resolve()}async getDownload(_){const M=this.partnerPeer.getReplica(_.shareAddress);if(!M)throw new ValidationError("Tried to get a receiving transfer for an unknown share.");const $=await M.replicaDriver.attachmentDriver.getAttachment(_.doc.format,_.attachmentHash);if($&&!isErr($))return await $.stream()}handleUploadRequest(_){return Promise.resolve(new NotSupportedError("PartnerLocal does not support uploads."))}handleTransferRequest(_,M){return Promise.resolve(new NotSupportedError("PartnerLocal does not support transfer requests."))}}class PartnerWebServer{constructor(_){Object.defineProperty(this,"syncAppetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"concurrentTransfers",{enumerable:!0,configurable:!0,writable:!0,value:24}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"isSecure",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wsUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"socket",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"incomingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"socketIsReady",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),this.syncAppetite=_.appetite;const M=new URL(_.url),$=`${M.host}${M.pathname==="/"?"":M.pathname}`;this.isSecure=M.protocol==="https:"||M.protocol==="wss:",this.wsUrl=`${this.isSecure?"wss://":"ws://"}${$}/'`;const j=new URL(_.appetite,this.wsUrl);this.socket=new WebSocket$1(j.toString()),this.socket.onopen=()=>{this.socketIsReady.resolve()},this.socket.binaryType="arraybuffer",this.socket.onmessage=z=>{this.incomingQueue.push(JSON.parse(z.data))},this.socket.onclose=()=>{this.incomingQueue.close()},this.socket.onerror=z=>{if("error"in z){this.incomingQueue.close({withError:z.error});return}this.incomingQueue.close({withError:new EarthstarError("Websocket error.")})}}async sendEvent(_){if(await this.socketIsReady,!(this.socket.readyState===this.socket.CLOSED||this.socket.readyState===this.socket.CLOSING))return this.socket.send(JSON.stringify(_))}getEvents(){return this.incomingQueue}closeConnection(){return this.socket.close(),Promise.resolve()}getDownload(_){const M=new URL(`${_.syncerId}/download/${_.shareAddress}/${_.doc.format}/${_.doc.author}${_.doc.path}`,this.wsUrl),$=websocketReadable(M.toString(),j=>j.data instanceof ArrayBuffer?new Uint8Array(j.data):null);return Promise.resolve($)}handleUploadRequest(_){const M=new URL(`${_.syncerId}/upload/${_.shareAddress}/${_.doc.format}/${_.doc.author}${_.doc.path}`,this.wsUrl),$=websocketWritable(M.toString(),j=>j);return Promise.resolve($)}handleTransferRequest(_,M){return Promise.resolve(new NotSupportedError("SyncDriverWebClient does not support external transfer requests."))}}function compareThumbnails(q,_){const[M,$]=q.split(" "),[j,z]=_.split(" "),V=parseInt(M),X=parseInt(j);return V>X?1:V<X?-1:$>z?1:$<z?-1:0}const docThumbnailMonoid={lift:q=>hash(q),combine:(q,_)=>q+_,neutral:BigInt(0)};class DocThumbnailTree extends FingerprintTree{constructor(){super(docThumbnailMonoid,compareThumbnails)}}class PlumTree{constructor(){Object.defineProperty(this,"messagingModes",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"eagerMessageThumbnails",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"haveTimeouts",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}getMode(_){const M=this.messagingModes.get(_);if(M)return M;const $=this.messagingModes.size===0?"EAGER":"LAZY";return this.messagingModes.set(_,$),"EAGER"}onEagerMessage(_,M){const $=this.haveTimeouts.get(M.thumbnail);return $?(clearTimeout($),!1):this.eagerMessageThumbnails.has(M.thumbnail)?(this.messagingModes.set(_,"LAZY"),!0):(this.eagerMessageThumbnails.add(M.thumbnail),!1)}onLazyMessage(_,M){if(!this.haveTimeouts.has(_.thumbnail)){const $=setTimeout_1(()=>{M(_.thumbnail)},5);this.haveTimeouts.set(_.thumbnail,$)}}onGraftMessage(_){this.messagingModes.set(_,"EAGER")}onPrune(_){this.messagingModes.set(_,"LAZY")}}class SyncerManager{constructor(_){Object.defineProperty(this,"syncers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"syncerEventBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"peer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docThumbnailTreeAndLookup",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"hasher",{enumerable:!0,configurable:!0,writable:!0,value:new XXH64}),Object.defineProperty(this,"plumTrees",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.peer=_}addPartner(_,M,$){const j=new Syncer({manager:this,partner:_,formats:$});return this.syncers.set(j.id,{syncer:j,description:M}),this.syncerEventBus.send(this.syncers),j}getSyncers(){return this.syncers}getDocThumbnailTreeAndDocLookup(_,M){const $=M.map(te=>te.id),j=`${_} ${$}`,z=this.docThumbnailTreeAndLookup.get(j);if(z){const[te,Z]=z;return{tree:te,lookup:Z,treeIsReady:Promise.resolve(!0)}}const V=this.peer.getReplica(_);if(!V)throw new EarthstarError("A DocThumbnailTree was requested for a share the peer doesn't know about, big problem!");const X=this.hasher,G=V.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"everything",M),Y=new DocThumbnailTree,Q={},ee=deferred();return G.pipeTo(new WritableStream({write(te){if(te.kind==="processed_all_existing"){ee.resolve();return}X.reset(),X.update(`${te.doc.path} ${te.doc.author}`);const Z=X.digest().toString(16),ne=`${te.doc.timestamp} ${Z}`;(te.kind==="existing"||te.kind==="success")&&(Q[Z]=[te.doc.timestamp,te.doc.path,te.doc.author],Y.insert(ne)),te.kind==="expire"&&(delete Q[Z],Y.remove(ne))}})),{tree:Y,lookup:Q,treeIsReady:ee}}getPlumTree(_){const M=this.plumTrees.get(_);if(M)return M;const $=new PlumTree;return this.plumTrees.set(_,$),$}onSyncersChange(_){return this.syncerEventBus.on(_)}}const logger$5=new Logger("peer","orangeRed"),J$1=JSON.stringify;class Peer{constructor(){Object.defineProperty(this,"replicaEventBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"syncerManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicaMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),logger$5.debug("constructor"),this.syncerManager=new SyncerManager(this)}hasShare(_){return this.replicaMap.has(_)}shares(){const _=[...this.replicaMap.keys()];return _.sort(),_}replicas(){const _=[...this.replicaMap.keys()];return _.sort(),_.map(M=>this.replicaMap.get(M))}size(){return this.replicaMap.size}getReplica(_){return this.replicaMap.get(_)}async addReplica(_){if(logger$5.debug(`addReplica(${J$1(_.share)})`),this.replicaMap.has(_.share))throw logger$5.debug("already had a replica with that share"),new Error(`Peer.addReplica: already has a replica with share ${J$1(_.share)}.  Don't add another one.`);this.replicaMap.set(_.share,_),await this.replicaEventBus.send(this.replicaMap),logger$5.debug("    ...addReplica: done")}async removeReplicaByShare(_){logger$5.debug(`removeReplicaByShare(${J$1(_)})`),this.replicaMap.delete(_),await this.replicaEventBus.send(this.replicaMap)}async removeReplica(_){const M=this.replicaMap.get(_.share);_===M?(logger$5.debug(`removeReplica(${J$1(_.share)})`),await this.removeReplicaByShare(_.share)):logger$5.debug(`removeReplica(${J$1(_.share)}) -- same share but it's a different instance now; ignoring`)}sync(_,M=!1,$){try{const j=new PartnerWebServer({url:_,appetite:M?"continuous":"once"});return this.syncerManager.addPartner(j,_,$)}catch{if(_ instanceof Peer){const j=new PartnerLocal(_,this,M?"continuous":"once",$);return this.syncerManager.addPartner(j,"Local",$)}console.error("Provided an invalid target for syncing to a peer:",_);return}}addSyncPartner(_,M,$){return this.syncerManager.addPartner(_,M,$)}getSyncers(){return this.syncerManager.getSyncers()}onReplicasChange(_){return this.replicaEventBus.on(_)}onSyncersChange(_){return this.syncerManager.onSyncersChange(_)}discover(_){const M=this;return{async*[Symbol.asyncIterator](){for await(const $ of _.events){if($.kind==="SERVICE_STOPPED")break;if($.kind==="PEER_EXITED"){yield $;continue}if($.kind==="PEER_INITIATED_SYNC"){const j=await $.begin(M);yield{kind:"PEER_INITIATED_SYNC",description:$.description,syncer:j};continue}yield{kind:"PEER_DISCOVERED",description:$.description,sync:async j=>await $.begin(M,j!=null&&j.syncContinuously?"continuous":"once")}}}}}}const DEFAULT_QUERY={historyMode:"latest",orderBy:"path ASC",startAfter:void 0,limit:void 0,filter:void 0,formats:["es.5"]},logger$4=new Logger("query","green");function cleanUpQuery(q){var j,z,V,X;const _={...DEFAULT_QUERY,...q},M={query:{limit:0},isValid:!1,willMatch:"nothing"};if(_.limit!==void 0&&_.limit<0)return logger$4.debug("cleanUpQuery: unreasonable limit - returning empty invalid query",M),M;if((j=_.orderBy)!=null&&j.startsWith("path")&&((z=_.startAfter)==null?void 0:z.localIndex)!==void 0)return logger$4.debug('cleanUpQuery: orderBy is "path" but startAfter is not compatible - returning empty invalid query',M),M;if((V=_.orderBy)!=null&&V.startsWith("localIndex")&&((X=_.startAfter)==null?void 0:X.path)!==void 0)return logger$4.debug('cleanUpQuery: orderBy is "localIndex" but startAfter is not compatible - returning empty invalid query',M),M;if(_.historyMode!==void 0&&_.historyMode!=="all"&&_.historyMode!=="latest")return logger$4.debug(`cleanUpQuery: unknown historyMode ${JSON.stringify(_.historyMode)} - returning empty invalid query`,M),M;if(_.orderBy!==void 0&&["path ASC","path DESC","localIndex ASC","localIndex DESC"].indexOf(_.orderBy)===-1)return logger$4.debug(`cleanUpQuery: unrecognized orderBy value ${JSON.stringify(_.orderBy)} - returning empty invalid query`,M),M;let $=_.historyMode==="all"?"all":"all-latest";if(_.filter!==void 0&&!shallowEqualObjects(_.filter,{})&&($="some"),_.startAfter!==void 0&&!shallowEqualObjects(_.startAfter,{})&&($="some"),_.limit!==void 0&&(_.limit>0&&($="some"),_.limit===0&&($="nothing")),_.filter!==void 0){const G=_.filter;G.path&&G.pathStartsWith&&!G.path.startsWith(G.pathStartsWith)&&($="nothing"),G.path&&G.pathEndsWith&&!G.path.endsWith(G.pathEndsWith)&&($="nothing"),G.timestamp&&G.timestampGt&&!(G.timestamp>G.timestampGt)&&($="nothing"),G.timestamp&&G.timestampLt&&!(G.timestamp<G.timestampLt)&&($="nothing"),G.timestampGt&&G.timestampLt&&!(G.timestampLt+1<G.timestampGt)&&($="nothing")}if($==="nothing"){let G={query:{limit:0},isValid:!0,willMatch:"nothing"};return logger$4.debug("cleanUpQuery - this query will match nothing, so returning a simpler query that also matches nothing",G),G}return logger$4.debug(`cleanUpQuery - query is ok!  willMatch = ${$}`),{query:_,isValid:!0,willMatch:$}}function docMatchesFilter(q,_){return!(_.path!==void 0&&q.path!==_.path||_.pathStartsWith!==void 0&&!q.path.startsWith(_.pathStartsWith)||_.pathEndsWith!==void 0&&!q.path.endsWith(_.pathEndsWith)||_.author!==void 0&&q.author!==_.author||_.timestamp!==void 0&&q.timestamp!==_.timestamp||_.timestampGt!==void 0&&!(q.timestamp>_.timestampGt)||_.timestampLt!==void 0&&!(q.timestamp<_.timestampLt))}new Logger("query helpers","gold");var Cmp;(function(q){q[q.LT=-1]="LT",q[q.EQ=0]="EQ",q[q.GT=1]="GT"})(Cmp||(Cmp={}));function compareBasic(q,_,M="ASC"){if(Array.isArray(q)&&shallowEqualArrays(q,_)||typeof q=="object"&&shallowEqualObjects(q,_)||q===_)return Cmp.EQ;if(M==="ASC"||M===void 0)return q<_?Cmp.LT:Cmp.GT;if(M==="DESC")return q>_?Cmp.LT:Cmp.GT;throw new Error("unexpected sort order to compareBasic: "+JSON.stringify(M))}function compareArrays(q,_,M){let $=Math.min(q.length,_.length);for(let V=0;V<$;V++){let X=(M==null?void 0:M[V])??"ASC",G=compareBasic(q[V],_[V],X);if(G!==Cmp.EQ)return G}if(q.length===_.length)return Cmp.EQ;let j=Math.min(q.length,_.length),z=(M==null?void 0:M[j])??"ASC";return compareBasic(q.length,_.length,z)}function compareByObjKey(q,_="ASC"){return(M,$)=>compareBasic(M[q],$[q],_)}const J=JSON.stringify,logger$3=new Logger("replica","gold"),loggerSet=new Logger("replica set","gold"),loggerIngest=new Logger("replica ingest","gold");function docCompareNewestFirst(q,_){return compareArrays([q.timestamp,q.signature],[_.timestamp,q.signature],["DESC","ASC"])}class MultiformatReplica{constructor({driver:_,config:M}){var j;Object.defineProperty(this,"replicaId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicaDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formatsConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isClosed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ingestLockStream",{enumerable:!0,configurable:!0,writable:!0,value:new LockStream}),Object.defineProperty(this,"eventMultiStream",{enumerable:!0,configurable:!0,writable:!0,value:new ChannelMultiStream("kind",!0)}),Object.defineProperty(this,"eventWriter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbackSink",{enumerable:!0,configurable:!0,writable:!0,value:new CallbackSink}),Object.defineProperty(this,"eraseInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"expireEventTimeouts",{enumerable:!0,configurable:!0,writable:!0,value:new Map});const $=checkShareIsValid(_.docDriver.share);if(isErr($))throw $;logger$3.debug(`constructor.  driver = ${(j=_==null?void 0:_.constructor)==null?void 0:j.name}`),this.replicaId="replica-"+randomId(),this.share=_.docDriver.share,this.replicaDriver=_,this.formatsConfig=M||{},this.eventWriter=this.eventMultiStream.getWritableStream().getWriter(),this.eventMultiStream.getReadableStream("*").pipeTo(new WritableStream(this.callbackSink)),this.eraseInterval=setInterval_1(()=>{this.isClosed()?clearInterval(this.eraseInterval):this.pruneExpiredDocsAndAttachments()},1e3*60*60)}isClosed(){return this._isClosed}async close(_){if(logger$3.debug("closing..."),this._isClosed)throw new ReplicaIsClosedError;await this.ingestLockStream.close();for(const M of this.expireEventTimeouts.values())clearTimeout(M);return logger$3.debug("    sending willClose blockingly..."),await this.eventWriter.write({kind:"willClose"}),logger$3.debug("    marking self as closed..."),_===!1&&await this.pruneExpiredDocsAndAttachments(),await this.replicaDriver.attachmentDriver.clearStaging(),this._isClosed=!0,logger$3.debug(`    closing ReplicaDriver (erase = ${_})...`),await this.replicaDriver.docDriver.close(_),await this.replicaDriver.attachmentDriver.close(_),clearInterval(this.eraseInterval),logger$3.debug("    sending didClose nonblockingly..."),await this.eventWriter.write({kind:"didClose"}),logger$3.debug("...closing done"),Promise.resolve()}async getConfig(_){if(this._isClosed)throw new ReplicaIsClosedError;return await this.replicaDriver.docDriver.getConfig(_)}async setConfig(_,M){if(this._isClosed)throw new ReplicaIsClosedError;return await this.replicaDriver.docDriver.setConfig(_,M)}async listConfigKeys(){if(this._isClosed)throw new ReplicaIsClosedError;return await this.replicaDriver.docDriver.listConfigKeys()}async deleteConfig(_){if(this._isClosed)throw new ReplicaIsClosedError;return await this.replicaDriver.docDriver.deleteConfig(_)}getMaxLocalIndex(){if(this._isClosed)throw new ReplicaIsClosedError;return this.replicaDriver.docDriver.getMaxLocalIndex()}getAllDocs(_){return logger$3.debug("getAllDocs()"),this.queryDocs({historyMode:"all",orderBy:"path ASC"},_)}getLatestDocs(_){return logger$3.debug("getLatestDocs()"),this.queryDocs({historyMode:"latest",orderBy:"path ASC"},_)}getAllDocsAtPath(_,M){return logger$3.debug(`getAllDocsAtPath("${_}")`),this.queryDocs({historyMode:"all",orderBy:"path ASC",filter:{path:_}},M)}async getLatestDocAtPath(_,M){logger$3.debug(`getLatestDocsAtPath("${_}")`);const $=await this.queryDocs({historyMode:"latest",orderBy:"path ASC",filter:{path:_}},M?[M]:void 0);if($.length!==0)return $[0]}async queryDocs(_={},M){if(logger$3.debug("queryDocs",_),this._isClosed)throw new ReplicaIsClosedError;const $=getFormatsWithFallback(M);return await this.replicaDriver.docDriver.queryDocs({..._,formats:$.map(j=>j.id)})}async queryPaths(_={},M){const $=await this.queryDocs(_,M),j=new Set($.map(({path:z})=>z));return Array.from(j).sort()}async queryAuthors(_={},M){const $=await this.queryDocs(_,M),j=new Set($.map(({author:z})=>z));return Array.from(j).sort()}async set(_,M,$=DEFAULT_FORMAT){if(loggerSet.debug("set",M),this._isClosed)throw new ReplicaIsClosedError;loggerSet.debug("...deciding timestamp: getting latest doc at the same path (from any author)");const j=await this.getLatestDocAtPath(M.path);let z;typeof M.timestamp=="number"?z=M.timestamp:j===void 0?z=microsecondNow():z=Math.max(microsecondNow(),j.timestamp+1),loggerSet.debug("...generating doc");let V;if(j){const Y=$.removeExtraFields(j);isErr(Y)||(V=Y.doc)}const X=await $.generateDocument({keypair:_,input:{...M,format:$.id},share:this.share,timestamp:z,prevLatestDoc:V,config:this.formatsConfig[$.id]});if(isErr(X))return{kind:"failure",reason:"invalid_document",err:X};if(loggerSet.debug("...signature =",X.doc.signature),X.attachment){const Y=await this.replicaDriver.attachmentDriver.stage($.id,X.attachment);if(isErr(Y))return{kind:"failure",reason:"invalid_document",err:Y};const Q=await $.updateAttachmentFields(_,X.doc,Y.size,Y.hash,this.formatsConfig[$.id]);if(isErr(Q))return await Y.reject(),{kind:"failure",reason:"invalid_document",err:Q};loggerSet.debug("...ingesting attachment"),loggerSet.debug("-----------------------"),await Y.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:Q,hash:Y.hash,size:Y.size,sourceId:"local"}),loggerSet.debug("...done ingesting attachment"),loggerSet.debug("...ingesting"),loggerSet.debug("-----------------------");const ee=await this.ingest($,Q,"local");return loggerSet.debug("...done ingesting"),loggerSet.debug("...set is done."),ee}loggerSet.debug("...ingesting"),loggerSet.debug("-----------------------");const G=await this.ingest($,X.doc,"local");return loggerSet.debug("...done ingesting"),loggerSet.debug("...set is done."),G}async ingest(_,M,$){if(loggerIngest.debug("ingest",M),this._isClosed)throw new ReplicaIsClosedError;loggerIngest.debug("...removing extra fields");const j=_.removeExtraFields(M);if(isErr(j))return{kind:"failure",reason:"invalid_document",err:j};M=j.doc;const z=j.extras;Object.keys(z).length>0&&loggerIngest.debug(`...extra fields found: ${J(z)}`);const V=await _.checkDocumentIsValid(M);if(isErr(V))return{kind:"failure",reason:"invalid_document",err:V};const X=deferred();return await this.ingestLockStream.run(async()=>{loggerIngest.debug(" >> ingest: start of protected region"),loggerIngest.debug("  > getting other history docs at the same path by any author");const G=await this.getAllDocsAtPath(M.path,[_]);loggerIngest.debug(`  > ...got ${G.length}`),loggerIngest.debug("  > getting prevLatest and prevSameAuthor");const Y=G[0]??null,Q=G.filter(re=>re.author===M.author)[0]??null;loggerIngest.debug("  > checking if new doc is latest at this path"),G.push(M),G.sort(docCompareNewestFirst);const ee=G[0]===M;if(loggerIngest.debug(`  > ...isLatest: ${ee}`),!ee&&Q!==null){loggerIngest.debug("  > new doc is not latest and there is another one from the same author...");const re=docCompareNewestFirst(M,Q);if(re===Cmp.GT){loggerIngest.debug("  > new doc is GT prevSameAuthor, so it is obsolete"),X.resolve({kind:"nothing_happened",reason:"obsolete_from_same_author",doc:M});return}if(re===Cmp.EQ){loggerIngest.debug("  > new doc is EQ prevSameAuthor, so it is redundant (already_had_it)"),X.resolve({kind:"nothing_happened",reason:"already_had_it",doc:M});return}}loggerIngest.debug("  > upserting into ReplicaDriver...");const te=await this.replicaDriver.docDriver.upsert(M);loggerIngest.debug("  > ...done upserting into ReplicaDriver"),loggerIngest.debug("  > ...getting ReplicaDriver maxLocalIndex...");const Z=await this.replicaDriver.docDriver.getMaxLocalIndex();loggerIngest.debug(" >> ingest: end of protected region, returning a WriteEvent from the lock");const ne={kind:"success",maxLocalIndex:Z,doc:te,docIsLatest:ee,prevDocFromSameAuthor:Q,prevLatestDoc:Y,sourceId:$};if(X.resolve(ne),await this.eventWriter.write(ne),te.deleteAfter){const re=`${te.path}|${te.author}`,se=this.expireEventTimeouts.get(re);se&&clearTimeout(se);const ie=te.deleteAfter/1e3-Date.now();this.expireEventTimeouts.set(re,setTimeout_1(()=>{this.eventWriter.write({kind:"expire",doc:te})},ie))}}),X}async overwriteAllDocsByAuthor(_,M){const $=getFormatWithFallback(M);if(logger$3.debug(`overwriteAllDocsByAuthor("${_.address}")`),this._isClosed)throw new ReplicaIsClosedError;const j=await this.queryDocs({filter:{author:_.address},historyMode:"all"},[$]);logger$3.debug(`    ...found ${j.length} docs to overwrite`);let z=0,V=0;for(const X of j){const G=await this.wipeDocument(_,X,getFormatWithFallback(M));if(isErr(G))return G;z+=1}return logger$3.debug(`    ...done; ${z} overwritten to be empty; ${V} were already empty; out of total ${j.length} docs`),z}async wipeDocAtPath(_,M,$=DEFAULT_FORMAT){const j=await this.getLatestDocAtPath(M,$);return j?this.wipeDocument(_,j,$):new ValidationError("No document exists at that path")}async wipeDocument(_,M,$){const j={...M,timestamp:Math.max(M.timestamp+1,Date.now()*1e3),author:_.address},z=await $.wipeDocument(_,j,this.formatsConfig[$.id]);if(isErr(z))return{kind:"failure",err:z,reason:"invalid_document"};const V=await this.ingest($,z,"local");if(V.kind==="success"){const X=$.getAttachmentInfo(M);if(!isErr(X)){const G=await this.replicaDriver.attachmentDriver.erase($.id,X.hash);isErr(G)||await this.eventWriter.write({kind:"attachment_prune",format:$.id,hash:X.hash})}}return V}async pruneExpiredDocsAndAttachments(_=DEFAULT_FORMATS){const M=await this.replicaDriver.docDriver.eraseExpiredDocs();for(const V of M)await this.eventWriter.write({kind:"expire",doc:V});const $=getFormatLookup(_),j={};await this.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"existing",_).pipeTo(new WritableStream({write(V){if(V.kind==="existing"){const X=$[V.doc.format],G=X.getAttachmentInfo(V.doc);if(!isErr(G)){const Y=j[X.id];Y?Y.add(G.hash):j[X.id]=new Set([G.hash])}}}}));const z=await this.replicaDriver.attachmentDriver.filter(j);for(const V of z)await this.eventWriter.write({kind:"attachment_prune",format:V.format,hash:V.hash})}getEventStream(_="*"){return this.eventMultiStream.getReadableStream(_)}getQueryStream(_={},M,$){const j=this.queryDocs.bind(this),z=this.getEventStream.bind(this);return new ReadableStream$1({async start(V){if(M==="existing"||M==="everything"){const Y=await j(_,$);for(const Q of Y)V.enqueue({kind:"existing",doc:Q})}if(V.enqueue({kind:"processed_all_existing"}),M==="existing"){V.close();return}const G=z().getReader();for(;;){const{done:Y,value:Q}=await G.read();if(Y)return;if(Q.kind==="expire"||Q.kind==="success"){if(_.filter&&docMatchesFilter(Q.doc,_.filter)){V.enqueue(Q);continue}V.enqueue(Q);continue}Q.kind==="didClose"&&V.close()}}})}onEvent(_){return this.callbackSink.onWrite(_)}async ingestAttachment(_,M,$,j){if(this._isClosed)throw new ReplicaIsClosedError;const z=_.removeExtraFields(M);if(isErr(z))return Promise.resolve(z);M=z.doc;const V=await _.checkDocumentIsValid(M);if(isErr(V))return Promise.resolve(V);const X=await this.getAttachment(M,_);if(X&&!isErr(X))return!1;const G=_.getAttachmentInfo(M);if(isErr(G))return Promise.resolve(G);const Y=await this.replicaDriver.attachmentDriver.stage(M.format,$);return isErr(Y)?Y:Y.hash!==G.hash?(await Y.reject(),new ValidationError("Attachment's hash did not match the document's")):Y.size!==G.size?(await Y.reject(),new ValidationError("Attachment's size did not match the document's")):(await Y.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:M,hash:Y.hash,size:Y.size,sourceId:j}),!0)}getAttachment(_,M=DEFAULT_FORMAT){if(_.deleteAfter&&_.deleteAfter<Date.now()*1e3)return Promise.resolve(new ValidationError("This document has expired"));const $=M.getAttachmentInfo(_);return isErr($)?Promise.resolve($):this.replicaDriver.attachmentDriver.getAttachment(_.format,$.hash)}addAttachments(_,M){const $=getFormatsWithFallback(M),j={};for(const V of $)j[V.id]=V;const z=_.map(V=>new Promise(X=>{const Y=j[V.format].getAttachmentInfo(V);if(!isErr(Y))this.replicaDriver.attachmentDriver.getAttachment(V.format,Y.hash).then(Q=>{X({...V,attachment:Q})});else return X({...V,attachment:Y})}));return Promise.all(z)}}class Replica extends MultiformatReplica{constructor(_){super({driver:_.driver,config:{"es.5":{shareSecret:_.shareSecret}}})}}const logger$2=new Logger("replica-cache","green");function justLocalIndex({_localIndex:q}){return q}function sortAndLimit(q,_){const M=[];for(const $ of _)if(!(q.orderBy==="path ASC"&&q.startAfter!==void 0&&q.startAfter.path!==void 0&&$.path<=q.startAfter.path)&&!(q.orderBy==="path DESC"&&q.startAfter!==void 0&&q.startAfter.path!==void 0&&$.path>=q.startAfter.path)&&!(q.orderBy==="localIndex ASC"&&q.startAfter!==void 0&&q.startAfter.localIndex!==void 0&&($._localIndex||0)<=q.startAfter.localIndex)&&!(q.orderBy==="localIndex DESC"&&q.startAfter!==void 0&&q.startAfter.localIndex!==void 0&&($._localIndex||0)>=q.startAfter.localIndex)&&(M.push($),q.limit!==void 0&&M.length>=q.limit))break;return M}class ReplicaCache{constructor(_,M,$){Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"replica",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"timeToLive",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onCacheUpdatedCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"onFireCacheUpdatedsWrapper",{enumerable:!0,configurable:!0,writable:!0,value:X=>X()}),Object.defineProperty(this,"attachmentCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.replica=_,this.timeToLive=M||1e3,$&&(this.onFireCacheUpdatedsWrapper=$);const j=this.onReplicaEvent.bind(this),z=this.close.bind(this),V=this.isClosed.bind(this);this.replica.getEventStream("*").pipeTo(new WritableStream({async write(X){X.kind==="attachment_ingest"||X.kind==="success"||X.kind==="expire"?await j(X):X.kind==="willClose"&&!V()&&await z()}})).catch(()=>{})}async close(){if(this.closed)throw new ReplicaCacheIsClosedError;this.closed=!0,await Promise.all(Array.from(this.docCache.values()).map(_=>_.close())),this.docCache.clear(),this.onCacheUpdatedCallbacks.clear()}isClosed(){return this.closed}getAllDocs(_){return this.queryDocs({historyMode:"all",orderBy:"path DESC"},_)}getLatestDocs(_){return this.queryDocs({historyMode:"latest",orderBy:"path DESC"},_)}getAllDocsAtPath(_,M){return this.queryDocs({historyMode:"all",orderBy:"path DESC",filter:{path:_}},M)}getLatestDocAtPath(_,M){const $=this.queryDocs({historyMode:"latest",orderBy:"path DESC",filter:{path:_}},M?[M]:void 0);if($.length!==0)return $[0]}queryDocs(_={},M){if(this.closed)throw new ReplicaCacheIsClosedError;if(this.replica.isClosed())throw new ReplicaIsClosedError;const j={..._,formats:(M||DEFAULT_FORMATS).map(ne=>ne.id)},z=cleanUpQuery(j);if(z.willMatch==="nothing")return[];const V=stringify$1(z.query),X=this.docCache.get(V);if(X)return Date.now()>X.expires&&this.replica.queryDocs(_,M).then(ne=>{const re=ne.map(justLocalIndex).sort(),se=X.docs.map(justLocalIndex).sort();shallowEqualArrays(re,se)||(this.docCache.set(V,{stream:X.stream,close:X.close,docs:ne,expires:Date.now()+this.timeToLive}),logger$2.debug("Updated cache because result expired."),this.fireOnCacheUpdateds())}),X.docs;const G=this.replica.getQueryStream(_,"new",M),Y=new CallbackSink,Q=Y.onWrite(ne=>{(ne.kind==="existing"||ne.kind==="success")&&(logger$2.debug({doc:ne.doc.path,queryString:V}),this._updateCache(V,ne.doc))}),ee=new WritableStream(Y),te=new AbortController;G.pipeTo(ee,{signal:te.signal});const Z=()=>{Q()};return this.docCache.set(V,{stream:G,docs:[],expires:Date.now()+this.timeToLive,close:Z}),this.replica.queryDocs(j).then(ne=>{this.docCache.set(V,{stream:G,close:Z,docs:ne,expires:Date.now()+this.timeToLive}),logger$2.debug("Updated cache with a new entry."),this.fireOnCacheUpdateds()}),[]}queryPaths(_={},M){const $=this.queryDocs(_,M),j=new Set($.map(({path:z})=>z));return Array.from(j).sort()}queryAuthors(_={},M){const $=this.queryDocs(_,M),j=new Set($.map(({author:z})=>z));return Array.from(j).sort()}_updateCache(_,M){const $=this.docCache.get(_);if(!$)return;const j=JSON.parse(_),z=()=>{const Z=[...$.docs,M];this.docCache.set(_,{...$,docs:sortAndLimit(j,Z)}),this.fireOnCacheUpdateds()},V=({exact:Z})=>{const ne=$.docs.map(re=>Z&&re.path===M.path&&re.author===M.author||!Z&&re.path===M.path?M:re);this.docCache.set(_,{...$,docs:sortAndLimit(j,ne)}),this.fireOnCacheUpdateds()},X=$.docs.filter(Z=>Z.path===M.path),G=$.docs.filter(Z=>Z.path===M.path&&Z.author===M.author);if(X.length===0){(j.filter&&docMatchesFilter(M,j.filter)||!j.filter)&&(logger$2.debug("Updated cache after appending a doc to a entry with matching filter."),z());return}if((j.historyMode||"latest")==="all"){if(G.length===0){logger$2.debug("Updated cache after appending a version of a doc to a historyMode: all query."),z();return}logger$2.debug("Updated cache after replacing a version of a doc in a historyMode: all query."),V({exact:!0});return}const Q=X[0],ee=M.author!==(Q==null?void 0:Q.author)||!shallowEqualObjects(M,Q),te=M.timestamp>Q.timestamp;if(ee&&te){logger$2.debug("Updated cache after replacing a doc with its latest version."),V({exact:!1});return}}fireOnCacheUpdateds(){this.version++,this.onFireCacheUpdatedsWrapper(()=>{this.onCacheUpdatedCallbacks.forEach(_=>{_()})})}onCacheUpdated(_){if(this.closed)throw new ReplicaCacheIsClosedError;if(this.replica.isClosed())throw new ReplicaIsClosedError;return this.onCacheUpdatedCallbacks.add(_),()=>{this.onCacheUpdatedCallbacks.delete(_)}}set(_,M,$){if(this.closed)throw new ReplicaCacheIsClosedError;return this.replica.set(_,M,$)}overwriteAllDocsByAuthor(_,M){if(this.closed)throw new ReplicaCacheIsClosedError;if(this.replica.isClosed())throw new ReplicaIsClosedError;return this.replica.overwriteAllDocsByAuthor(_,M)}wipeDocAtPath(_,M,$=DEFAULT_FORMAT){if(this.closed)throw new ReplicaCacheIsClosedError;return this.replica.wipeDocAtPath(_,M,$)}async onReplicaEvent(_){const M=`${_.doc.path}|${_.doc.author}`,$=this.attachmentCache.get(M);if(!$)return;const j=await this.replica.getAttachment(_.doc,$.format);this.attachmentCache.set(M,{expires:Date.now()+this.timeToLive,attachment:j,format:$.format}),this.fireOnCacheUpdateds()}getAttachment(_,M=DEFAULT_FORMAT){if(this.closed)throw new ReplicaCacheIsClosedError;if(this.replica.isClosed())throw new ReplicaIsClosedError;const $=M.getAttachmentInfo(_);if(isErr($))return $;const j=`${_.path}|${_.author}`,z=this.attachmentCache.get(j);if(z)return Date.now()>z.expires&&this.replica.getAttachment(_,M).then(V=>{this.attachmentCache.set(j,{expires:Date.now()+this.timeToLive,attachment:V,format:M}),this.fireOnCacheUpdateds()}),_.deleteAfter&&Date.now()*1e3>_.deleteAfter?new ValidationError("This document has expired"):z.attachment;this.attachmentCache.set(j,{attachment:void 0,expires:Date.now()+this.timeToLive,format:M}),this.replica.getAttachment(_,M).then(V=>{this.attachmentCache.set(j,{expires:Date.now()+this.timeToLive,attachment:V,format:M}),this.fireOnCacheUpdateds()})}addAttachments(_,M){const $=[],j=getFormatLookup(M);for(const z of _){const V=this.getAttachment(z,j[z.format]);$.push({...z,attachment:V})}return $}}new Logger("storage driver async memory","yellow");async function streamToBytes(q){let _=new Uint8Array;return await q.pipeTo(new WritableStream({write(M){const $=new Uint8Array(_.length+M.length);$.set(_),$.set(M,_.length),_=$}})),_}async function createInvitationURL(q,_,M){const $=parseShareAddress(q);if(isErr($))return new ValidationError("Invalid share address.");for(const X of _)try{new URL(X)}catch{return new ValidationError(`Could not parse ${X} as a URL.`)}const j=_.map(X=>`&server=${X}`).join("&");let z="";if(M){const X=await Crypto.checkKeypairIsValid({shareAddress:q,secret:M});if(isErr(X))return new ValidationError(`Supplied the wrong secret for ${q}`);z=`&secret=${M}`}return`earthstar://${q}/?invite${j}${z}&v=2`}async function parseInvitationURL(q){try{const _=new URL(q),M=_.hostname.length>0?_.hostname:_.pathname.replaceAll("/",""),$=parseShareAddress(M);if(isErr($))return new ValidationError("Invitation did not include a valid share address.");const j=new URLSearchParams(_.search),z=j.get("invite"),V=j.get("v");if(z===null)return new ValidationError("Not an invitation URL");if(V===null)return new ValidationError("Invitation version not specified.");if(V!=="2")return new ValidationError(`Invitation version is ${V}, expected version 2.`);const X=j.getAll("server");for(const Y of X)try{new URL(Y)}catch{return new ValidationError(`Invitation's servers included a malformed URL: ${Y}`)}const G=j.get("secret");if(G){const Y=await Crypto.checkKeypairIsValid({shareAddress:M,secret:G});if(isErr(Y))return new ValidationError(`Invitation contains the wrong secret for share ${M}.`)}return{shareAddress:M,secret:G||void 0,servers:X}}catch{return new ValidationError("Could not parse the invitation URL.")}}const EARTHSTAR_KEY="earthstar",AUTHOR_KEY="current_author",SHARES_KEY="shares",SHARE_SECRETS_KEY="share_secrets",SERVERS_KEY="servers";class SharedSettings{constructor(_){Object.defineProperty(this,"namespace",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:localStorage}),Object.defineProperty(this,"authorChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"sharesChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"shareSecretsChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"serversChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),this.namespace=_==null?void 0:_.namespace,_!=null&&_.sessionOnly&&(this.storage=sessionStorage),addEventListener("storage",M=>{switch(M.key){case makeStorageKey(AUTHOR_KEY,this.namespace):{this.fireAuthorEvent();break}case makeStorageKey(SHARES_KEY,this.namespace):{this.fireSharesEvent();break}case makeStorageKey(SHARE_SECRETS_KEY,this.namespace):{this.fireSecretsEvent();break}case makeStorageKey(SERVERS_KEY,this.namespace):{this.fireServersEvent();break}}})}get author(){const _=makeStorageKey(AUTHOR_KEY,this.namespace);return getParsedValue(this.storage,_,isParsedAuthorKeypair)||null}set author(_){const M=makeStorageKey(AUTHOR_KEY,this.namespace);this.storage.setItem(M,JSON.stringify(_)),this.fireAuthorEvent()}get shares(){const _=makeStorageKey(SHARES_KEY,this.namespace);return getParsedValue(this.storage,_,isParsedSharesArray)||[]}addShare(_){if(isErr(checkShareIsValid(_)))return new ValidationError("Not a valid share");const M=makeStorageKey(SHARES_KEY,this.namespace),$=new Set([...this.shares,_]),j=Array.from($);return this.storage.setItem(M,JSON.stringify(j)),this.fireSharesEvent(),j}removeShare(_){const M=this.shares,$=M.findIndex(z=>z===_);if($===-1)return new ValidationError("That share is not known yet");M.splice($,1);const j=makeStorageKey(SHARES_KEY,this.namespace);return this.storage.setItem(j,JSON.stringify(M)),this.fireSharesEvent(),M}get shareSecrets(){const _=makeStorageKey(SHARE_SECRETS_KEY,this.namespace);return getParsedValue(this.storage,_,isParsedSecretsDict)||{}}async addSecret(_,M){if(!this.shares.find(V=>_===V))return new ValidationError("This share is not yet known.");if(isErr(await Crypto.checkKeypairIsValid({shareAddress:_,secret:M})))return new ValidationError("Not the right secret for this share.");const j=makeStorageKey(SHARE_SECRETS_KEY,this.namespace),z={...this.shareSecrets,[_]:M};return this.storage.setItem(j,JSON.stringify(z)),this.fireSecretsEvent(),z}removeSecret(_){const M=this.shareSecrets;if(!M[_])return new ValidationError("Unknown share");const j=makeStorageKey(SHARE_SECRETS_KEY,this.namespace),z={...M};return delete z[_],this.storage.setItem(j,JSON.stringify(z)),this.fireSecretsEvent(),z}get servers(){const _=makeStorageKey(SERVERS_KEY,this.namespace);return getParsedValue(this.storage,_,isParsedUrlArray)||[]}addServer(_){try{const M=new URL(_),$=new Set([...this.servers,M.toString()]),j=Array.from($),z=makeStorageKey(SERVERS_KEY,this.namespace);return this.storage.setItem(z,JSON.stringify(j)),this.fireServersEvent(),j}catch{return new ValidationError("Not a valid URL.")}}removeServer(_){try{const M=new URL(_),$=this.servers,j=$.findIndex(V=>V===M.toString());if(j===-1)return new ValidationError("That server is not known yet");$.splice(j,1);const z=makeStorageKey(SERVERS_KEY,this.namespace);return this.storage.setItem(z,JSON.stringify($)),this.fireServersEvent(),$}catch{return new ValidationError("Not a valid URL")}}clear(){const _=makeStorageKey(AUTHOR_KEY,this.namespace);this.storage.setItem(_,JSON.stringify(null));const M=makeStorageKey(SHARES_KEY,this.namespace);this.storage.setItem(M,JSON.stringify([]));const $=makeStorageKey(SHARE_SECRETS_KEY,this.namespace);this.storage.setItem($,JSON.stringify({}));const j=makeStorageKey(SERVERS_KEY,this.namespace);this.storage.setItem(j,JSON.stringify([])),this.fireAuthorEvent(),this.fireSharesEvent(),this.fireSecretsEvent(),this.fireServersEvent()}onAuthorChanged(_){return this.authorChangedCbs.add(_),()=>{this.authorChangedCbs.delete(_)}}onSharesChanged(_){return this.sharesChangedCbs.add(_),()=>{this.sharesChangedCbs.delete(_)}}onShareSecretsChanged(_){return this.shareSecretsChangedCbs.add(_),()=>{this.shareSecretsChangedCbs.delete(_)}}onServersChanged(_){return this.serversChangedCbs.add(_),()=>{this.serversChangedCbs.delete(_)}}getPeer({sync:_,onCreateReplica:M}){const $=new Peer,j=this.shares;for(const Y of j){const Q=M(Y,this.shareSecrets[Y]);$.addReplica(Q)}const z=this.onSharesChanged(async Y=>{const Q=$.replicas(),ee=$.shares();for(const te of Q)Y.includes(te.share)||($.removeReplica(te),await te.close(!1));for(const te of Y)if(!ee.includes(te)){const Z=M(te,this.shareSecrets[te]);$.addReplica(Z)}}),V=this.onShareSecretsChanged(async Y=>{const Q=$.shares(),ee=Object.keys(Y);for(const te of Q)if(!ee.includes(te)){const Z=$.getReplica(te);Z&&($.removeReplica(Z),Z.close(!1));const ne=M(te);$.addReplica(ne)}for(const te of ee){const Z=$.getReplica(te);if(Z!=null&&Z.formatsConfig["es.5"]&&Z.formatsConfig["es.5"].shareSecret)continue;await(Z==null?void 0:Z.close(!1)),$.removeReplicaByShare(te);const ne=M(te,Y[te]);$.addReplica(ne)}});if(_)for(const Y of this.servers)$.sync(Y,_==="continuous");const X=this.onServersChanged(Y=>{if(_){const Q=$.getSyncers();for(const[ee,{description:te,syncer:Z}]of Q)Y.includes(te)||Z.cancel();for(const ee of Y)$.sync(ee,_==="continuous")}});return{peer:$,unsubscribeFromSettings:()=>{z(),V(),X()}}}fireAuthorEvent(){const _=this.author;for(const M of this.authorChangedCbs)M(_)}fireSharesEvent(){const _=this.shares;for(const M of this.sharesChangedCbs)M(_)}fireSecretsEvent(){const _=this.shareSecrets;for(const M of this.shareSecretsChangedCbs)M(_)}fireServersEvent(){const _=this.servers;for(const M of this.serversChangedCbs)M(_)}async redeemInvitationURL(_){const M=await parseInvitationURL(_);if(isErr(M))return M;this.addShare(M.shareAddress);for(const $ of M.servers)this.addServer($);return M.secret&&this.addSecret(M.shareAddress,M.secret),!0}}function makeStorageKey(q,_){return`${EARTHSTAR_KEY}:${_?`${_}:`:""}${q}`}function getParsedValue(q,_,M){const $=q.getItem(_);if($!==null)try{const j=JSON.parse($);return M(j)?j:void 0}catch{return}}function isObject(q){return!(q==null||typeof q!="object")}function isParsedAuthorKeypair(q){return!(!isObject(q)||Object.keys(q).length!==2||!("address"in q)||!("secret"in q))}function isParsedSharesArray(q){return!(!Array.isArray(q)||q.some(_=>typeof _!="string")||q.some(_=>isErr(checkShareIsValid(_))))}function isParsedSecretsDict(q){if(!isObject(q))return!1;for(const _ in q){const M=q[_];if(typeof M!="string"||isErr(Crypto.checkKeypairIsValid({shareAddress:_,secret:M})))return!1}return!0}function isParsedUrlArray(q){if(!Array.isArray(q)||q.some(_=>typeof _!="string"))return!1;for(const _ of q)try{new URL(_)}catch{return!1}return!0}function cubicOut(q){const _=q-1;return _*_*_+1}function fade(q,{delay:_=0,duration:M=400,easing:$=identity}={}){const j=+getComputedStyle(q).opacity;return{delay:_,duration:M,easing:$,css:z=>`opacity: ${z*j}`}}function fly(q,{delay:_=0,duration:M=400,easing:$=cubicOut,x:j=0,y:z=0,opacity:V=0}={}){const X=getComputedStyle(q),G=+X.opacity,Y=X.transform==="none"?"":X.transform,Q=G*(1-V);return{delay:_,duration:M,easing:$,css:(ee,te)=>`
			transform: ${Y} translate(${(1-ee)*j}px, ${(1-ee)*z}px);
			opacity: ${G-Q*te}`}}function scale(q,{delay:_=0,duration:M=400,easing:$=cubicOut,start:j=0,opacity:z=0}={}){const V=getComputedStyle(q),X=+V.opacity,G=V.transform==="none"?"":V.transform,Y=1-j,Q=X*(1-z);return{delay:_,duration:M,easing:$,css:(ee,te)=>`
			transform: ${G} scale(${1-Y*te});
			opacity: ${X-Q*te}
		`}}const subscriber_queue=[];function readable(q,_){return{subscribe:writable(q,_).subscribe}}function writable(q,_=noop){let M;const $=new Set;function j(X){if(safe_not_equal(q,X)&&(q=X,M)){const G=!subscriber_queue.length;for(const Y of $)Y[1](),subscriber_queue.push(Y,q);if(G){for(let Y=0;Y<subscriber_queue.length;Y+=2)subscriber_queue[Y][0](subscriber_queue[Y+1]);subscriber_queue.length=0}}}function z(X){j(X(q))}function V(X,G=noop){const Y=[X,G];return $.add(Y),$.size===1&&(M=_(j)||noop),X(q),()=>{$.delete(Y),$.size===0&&(M(),M=null)}}return{set:j,update:z,subscribe:V}}function derived(q,_,M){const $=!Array.isArray(q),j=$?[q]:q,z=_.length<2;return readable(M,V=>{let X=!1;const G=[];let Y=0,Q=noop;const ee=()=>{if(Y)return;Q();const Z=_($?G[0]:G,V);z?V(Z):Q=is_function(Z)?Z:noop},te=j.map((Z,ne)=>subscribe(Z,re=>{G[ne]=re,Y&=~(1<<ne),X&&ee()},()=>{Y|=1<<ne}));return X=!0,ee(),function(){run_all(te),Q()}})}const authorKeypair=writable({address:"",secret:""});new Logger("storage driver localStorage","gold");const logger$1=new Logger("replica driver indexeddb","gold");function docComparePathASCthenNewestFirst(q,_){return compareArrays([q.path,q.timestamp,q.signature],[_.path,_.timestamp,q.signature],["ASC","DESC","ASC"])}function docComparePathDESCthenNewestFirst(q,_){return compareArrays([q.path,q.timestamp,q.signature],[_.path,_.timestamp,q.signature],["DESC","DESC","ASC"])}const DOCS_STORE="docs",CONFIG_STORE="config";class DocDriverIndexedDB{constructor(_,M){Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"gotInitialMaxLocalIndex",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"localMaxLocalIndex",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1});const $=checkShareIsValid(_);if(isErr($))throw $;if(this.share=_,logger$1.debug("constructor"),!window.indexedDB)throw new EarthstarError("IndexedDB is not supported by this runtime.");const j=dntGlobalThis.indexedDB.open(`earthstar:share_docs:${this.share}${M?`/${M}`:""}`,1);j.onerror=()=>{throw logger$1.error(`Could not open IndexedDB for ${this.share}'s attachments.`),logger$1.error(j.error),new EarthstarError(`Could not open IndexedDB for ${this.share}'s attachments.`)},j.onupgradeneeded=function(){const z=j.result,V=z.createObjectStore(DOCS_STORE,{keyPath:["path","author"]});V.createIndex("comboIndex",["_localIndex","timestamp","path","author"],{unique:!0}),V.createIndex("pathTimestampIndex",["path","timestamp"],{unique:!1}),V.createIndex("pathAuthorIndex",["path","author"],{unique:!0}),V.createIndex("deleteAfterIndex","deleteAfter",{unique:!1}),V.createIndex("localIndexIndex","_localIndex",{unique:!0}),z.createObjectStore(CONFIG_STORE,{keyPath:"key"}).createIndex("keyIndex",["key"],{unique:!0})},j.onsuccess=()=>{this.db.resolve(j.result);const V=j.result.transaction([DOCS_STORE],"readonly").objectStore(DOCS_STORE).index("localIndexIndex").openCursor(null,"prev");V.onsuccess=()=>{V.result?this.gotInitialMaxLocalIndex.resolve(V.result.value._localIndex):this.gotInitialMaxLocalIndex.resolve(-1)}},this.gotInitialMaxLocalIndex.then(z=>{this.localMaxLocalIndex=z})}isClosed(){return this.closed}async close(_){if(this.closed)throw new ReplicaIsClosedError;this.closed=!0;const M=deferred();if(_){const j=(await this.db).transaction([DOCS_STORE,CONFIG_STORE],"readwrite"),z=deferred(),V=deferred(),X=j.objectStore(DOCS_STORE).clear().onsuccess=()=>{z.resolve()},G=j.objectStore(CONFIG_STORE).clear().onsuccess=()=>{V.resolve()};await Promise.all([X,G]),M.resolve()}else M.resolve();return(await this.db).close(),await sleep(20),M}async getMaxLocalIndex(){return await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex}async queryDocs(_){var Q,ee,te,Z,ne,re,se,ie,oe,ue,ce,ae,le;const $=(await this.db).transaction([DOCS_STORE],"readonly").objectStore(DOCS_STORE),j=deferred(),{query:z,willMatch:V}=cleanUpQuery(_);if(logger$1.debug(`    cleanUpQuery.  willMatch = ${V}`),V==="nothing")return[];if((Q=z.filter)!=null&&Q.path&&z.historyMode==="latest"){const he=IDBKeyRange.bound([z.filter.path,z.filter.timestampGt||0],[z.filter.path,z.filter.timestampLt||Number.MAX_SAFE_INTEGER]),de=$.index("pathTimestampIndex").openCursor(he,"prev");de.onsuccess=()=>{var pe;(pe=de.result)!=null&&pe.value?j.resolve([de.result.value]):j.resolve([])}}else if((ee=z.filter)!=null&&ee.path&&z.historyMode==="all"){const he=$.index("pathAuthorIndex"),ge=IDBKeyRange.bound([z.filter.path," "],[z.filter.path,"~"]),de=he.getAll(ge);de.onsuccess=()=>{de.result?j.resolve(Array.from(de.result)):j.resolve([])}}else{const he=((te=z.startAfter)==null?void 0:te.path)||((Z=z.filter)==null?void 0:Z.path)||((ne=z.filter)==null?void 0:ne.pathStartsWith)||" ",ge=((re=z.filter)==null?void 0:re.author)||" ",de=((se=z.filter)==null?void 0:se.timestamp)||((ie=z.filter)==null?void 0:ie.timestampGt)||0,pe=((oe=z.startAfter)==null?void 0:oe.localIndex)||0,ye=((ue=z.filter)==null?void 0:ue.path)||"~",_e=((ce=z.filter)==null?void 0:ce.author)||"~",De=((ae=z.filter)==null?void 0:ae.timestamp)||((le=z.filter)==null?void 0:le.timestampLt)||Number.MAX_SAFE_INTEGER,fe=Number.MAX_SAFE_INTEGER,Ae=IDBKeyRange.bound([pe,de,he,ge],[fe,De,ye,_e]),Ee=$.index("comboIndex").getAll(Ae);Ee.onsuccess=()=>{Ee.result?j.resolve(Ee.result):j.resolve([])}}const X=await j;if(z.historyMode==="latest"){const he=X.splice(0,X.length),ge=new Map;for(const de of he){const pe=ge.get(de.path);(!pe||pe.timestamp<de.timestamp)&&ge.set(de.path,de)}X.push(...ge.values())}const G=[];logger$1.debug("    filtering docs");const Y=Date.now()*1e3;for(const he of X)he.deleteAfter&&he.deleteAfter<Y||z.filter&&!docMatchesFilter(he,z.filter)||G.push(he);if(logger$1.debug(`    ordering docs: ${z.orderBy}`),z.orderBy==="path ASC")G.sort(docComparePathASCthenNewestFirst);else if(z.orderBy==="path DESC")G.sort(docComparePathDESCthenNewestFirst);else if(z.orderBy==="localIndex ASC")G.sort(compareByObjKey("_localIndex","ASC"));else if(z.orderBy==="localIndex DESC")G.sort(compareByObjKey("_localIndex","DESC"));else if(z.orderBy)throw new ValidationError("unrecognized query orderBy: "+JSON.stringify(z.orderBy));return z.limit!==void 0&&X.length>=z.limit?G.slice(0,z.limit):(logger$1.debug(`    queryDocs is done: found ${G.length} docs.`),G)}async upsert(_){const M=await this.db,j=M.transaction([DOCS_STORE],"readwrite").objectStore(DOCS_STORE).index("pathAuthorIndex"),z=deferred(),V=j.openCursor([_.path,_.author]);if(await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex+=1,_._localIndex=this.localMaxLocalIndex,V.onsuccess=()=>{if(V.result){const ee=V.result.update(_);ee.onsuccess=()=>{z.resolve(!!ee.result)}}else z.resolve(!1)},await z)return _;const Y=M.transaction([DOCS_STORE],"readwrite").objectStore(DOCS_STORE).put(_),Q=deferred();return Y.onsuccess=()=>{Q.resolve()},Y.onerror=()=>{throw Y.error},await Q,_}async eraseExpiredDocs(){const _=[],j=(await this.db).transaction([DOCS_STORE],"readwrite").objectStore(DOCS_STORE).index("deleteAfterIndex"),z=Date.now()*1e3,V=IDBKeyRange.bound(0,z),X=j.openCursor(V),G=deferred();return X.onsuccess=()=>{var Y;if((Y=X.result)!=null&&Y.value){const Q=X.result.value;if(Q.deleteAfter!==null&&Q.deleteAfter!==void 0){_.push(Q);const ee=X.result.delete();ee.onsuccess=()=>{var te;(te=X.result)==null||te.continue()}}}else G.resolve()},await G,_}async getConfig(_){const $=(await this.db).transaction([CONFIG_STORE],"readonly").objectStore(CONFIG_STORE),j=deferred(),z=$.get(_);return z.onsuccess=()=>{var V;j.resolve((V=z.result)==null?void 0:V.value)},j}async setConfig(_,M){const j=(await this.db).transaction([CONFIG_STORE],"readwrite").objectStore(CONFIG_STORE),z=deferred(),V=j.put({key:_,value:M});return V.onsuccess=()=>{z.resolve()},z}async listConfigKeys(){const M=(await this.db).transaction([CONFIG_STORE],"readonly").objectStore(CONFIG_STORE),$=deferred(),z=M.index("keyIndex").openKeyCursor(),V=[];return z.onsuccess=()=>{z.result?(V.push(z.result.primaryKey),z.result.continue()):$.resolve(V)},$}async deleteConfig(_){const $=(await this.db).transaction([CONFIG_STORE],"readwrite").objectStore(CONFIG_STORE),j=deferred(),z=$.index("keyIndex"),V=IDBKeyRange.bound([_],[_]),X=z.openCursor(V);return X.onsuccess=()=>{if(X.result){const G=X.result.delete();G.onsuccess=()=>{j.resolve(!0)}}else j.resolve(!1)},j}}const logger=new Logger("replica driver indexeddb","gold"),ATTACHMENT_STAGING_STORE="attachment_staging_index",ATTACHMENT_INDEX_STORE="attachments_index",ATTACHMENT_BYTES_STORE="attachments_bytes";class AttachmentDriverIndexedDB{constructor(_,M){if(Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.share=_,!window.indexedDB)throw new EarthstarError("IndexedDB is not supported by this runtime.");const $=dntGlobalThis.indexedDB.open(`earthstar:share_attachments:${this.share}${M?`/${M}`:""}`,1);$.onerror=()=>{throw logger.error(`Could not open IndexedDB for ${this.share}'s attachments.`),logger.error($.error),new EarthstarError(`Could not open IndexedDB for ${this.share}'s attachments.`)},$.onupgradeneeded=function(){const j=$.result;j.createObjectStore(ATTACHMENT_BYTES_STORE),j.createObjectStore(ATTACHMENT_INDEX_STORE,{keyPath:"id"}),j.createObjectStore(ATTACHMENT_STAGING_STORE,{keyPath:"id"})},$.onsuccess=()=>{this.db.resolve($.result)}}getIndexKey(_,M){return`${_}___${M}`}async getAttachment(_,M){if(this.closed)throw new ReplicaIsClosedError;const $=deferred(),j=this.getIndexKey(_,M),z=await this.db,X=z.transaction([ATTACHMENT_INDEX_STORE],"readonly").objectStore(ATTACHMENT_INDEX_STORE).get(j),G=deferred();return X.onerror=()=>{G.reject()},X.onsuccess=()=>{X.result===void 0?G.reject():G.resolve(X.result.blobKey)},G.then(Y=>{const ee=z.transaction([ATTACHMENT_BYTES_STORE],"readonly").objectStore(ATTACHMENT_BYTES_STORE).get(Y);ee.onsuccess=()=>{const te=new Blob$1([ee.result]);$.resolve({bytes:async()=>new Uint8Array(await te.arrayBuffer()),stream:()=>Promise.resolve(te.stream())})},ee.onerror=()=>{$.resolve(void 0)}}).catch(()=>{$.resolve(void 0)}),$}async erase(_,M){if(this.closed)throw new ReplicaIsClosedError;const $=deferred(),j=this.getIndexKey(_,M),z=await this.db,X=z.transaction([ATTACHMENT_INDEX_STORE],"readonly").objectStore(ATTACHMENT_INDEX_STORE).get(j),G=deferred();return X.onerror=()=>{G.reject()},X.onsuccess=()=>{z.transaction([ATTACHMENT_INDEX_STORE],"readwrite").objectStore(ATTACHMENT_INDEX_STORE).delete(j),X.result===void 0?G.reject():G.resolve(X.result.blobKey)},G.then(Y=>{const Q=z.transaction([ATTACHMENT_BYTES_STORE],"readwrite").objectStore(ATTACHMENT_BYTES_STORE).delete(Y);Q.onsuccess=()=>{$.resolve(!0)},Q.onerror=()=>{$.resolve(void 0)}}).catch(()=>{$.resolve(new ValidationError("No attachment found"))}),$}async stage(_,M){if(this.closed)throw new ReplicaIsClosedError;const $=await this.db,j=M instanceof Uint8Array?M:await streamToBytes(M),z=await Crypto.sha256base32(j),V=this.getIndexKey(_,z),X=`${V}___${randomId()}`,G=$.transaction([ATTACHMENT_BYTES_STORE,ATTACHMENT_STAGING_STORE],"readwrite"),Y=G.objectStore(ATTACHMENT_BYTES_STORE).put(j,X),Q=G.objectStore(ATTACHMENT_STAGING_STORE).put({id:V,blobKey:X}),ee=deferred(),te=deferred();return Y.onsuccess=()=>ee.resolve(),Q.onsuccess=()=>te.resolve(),await ee,await te,{hash:z,size:j.byteLength,reject:async()=>{const Z=$.transaction([ATTACHMENT_BYTES_STORE,ATTACHMENT_STAGING_STORE],"readwrite"),ne=Z.objectStore(ATTACHMENT_BYTES_STORE).delete(X),re=Z.objectStore(ATTACHMENT_STAGING_STORE).delete(V),se=deferred(),ie=deferred();ne.onsuccess=()=>{se.resolve()},re.onsuccess=()=>{ie.resolve()},await Promise.all([se,ie])},commit:async()=>{const Z=$.transaction([ATTACHMENT_INDEX_STORE,ATTACHMENT_STAGING_STORE],"readwrite"),ne=Z.objectStore(ATTACHMENT_STAGING_STORE).delete(V),re=Z.objectStore(ATTACHMENT_INDEX_STORE).put({id:V,blobKey:X}),se=deferred(),ie=deferred();ne.onsuccess=()=>se.resolve(),re.onsuccess=()=>ie.resolve(),await Promise.all([se,ie])}}}async wipe(){if(this.closed)throw new ReplicaIsClosedError;const M=(await this.db).transaction([ATTACHMENT_BYTES_STORE,ATTACHMENT_INDEX_STORE,ATTACHMENT_STAGING_STORE],"readwrite"),$=M.objectStore(ATTACHMENT_BYTES_STORE).clear(),j=M.objectStore(ATTACHMENT_INDEX_STORE).clear(),z=M.objectStore(ATTACHMENT_STAGING_STORE).clear(),V=deferred(),X=deferred(),G=deferred();$.onsuccess=()=>V.resolve(),j.onsuccess=()=>X.resolve(),z.onsuccess=()=>G.resolve(),await Promise.all([V,X,G])}async clearStaging(){if(this.closed)throw new ReplicaIsClosedError;const M=(await this.db).transaction([ATTACHMENT_BYTES_STORE,ATTACHMENT_STAGING_STORE]),$=M.objectStore(ATTACHMENT_STAGING_STORE).openCursor(),j=deferred();return $.onsuccess=()=>{const z=$.result;if(!z){j.resolve();return}const V=z.value.blobKey,X=M.objectStore(ATTACHMENT_BYTES_STORE).delete(V);z.delete(),X.onsuccess=()=>{z.continue()},X.onerror=()=>{z.continue()}},j}async filter(_){if(this.closed)throw new ReplicaIsClosedError;const $=(await this.db).transaction([ATTACHMENT_BYTES_STORE,ATTACHMENT_INDEX_STORE],"readwrite"),j=50,z=[],V=[],X=deferred(),G=(Y=null)=>{const Q=$.objectStore(ATTACHMENT_INDEX_STORE).getAll(Y,j);Q.onsuccess=()=>{const ee=Q.result;for(const te of ee){const[Z,ne]=te.id.split("___");_[Z]&&!_[Z].has(ne)&&(z.push({format:Z,hash:ne}),V.push(this.erase(Z,ne)))}if(ee.length===j){const te=ee[ee.length-1],Z=IDBKeyRange.lowerBound(te.id,!0);G(Z)}else X.resolve()}};return G(),await X,await Promise.all(V),z}isClosed(){return this.closed}async close(_){if(this.closed)throw new ReplicaIsClosedError;_&&await this.wipe(),this.closed=!0,(await this.db).close(),await sleep(20)}}class ReplicaDriverWeb{constructor(_,M){Object.defineProperty(this,"docDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachmentDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.docDriver=new DocDriverIndexedDB(_,M),this.attachmentDriver=new AttachmentDriverIndexedDB(_,M)}}const initialKeypair={shareAddress:"+commons.b7q4gt64yiefosdafnmhvtxz43akzk6gw54aesdahtf4kdgpbyeia",secret:"bigzorlvyjy5fy5a3kglfzcyfzramsic3cihj4rqphmd6x5wo5jcq"},shareKeypair=writable(initialKeypair),replicaDetails=writable(null);shareKeypair.subscribe(q=>{console.log("shareKeypair store changed:",q);const _=q.shareAddress,M=q.secret,$=new Replica({driver:new ReplicaDriverWeb(_),shareSecret:M});replicaDetails.set({replica:$})});const settings=new SharedSettings,shares=writable(settings.shares);settings.onSharesChanged(q=>{shares.set(q)});function removeShare(q){const _=settings.removeShare(q);Array.isArray(_)?shares.set(_):console.error(_)}const studioShares=derived(shares,q=>q.filter(_=>_.includes("studio"))),UploadId_svelte_svelte_type_style_lang="";function create_fragment$12(q){let _,M,$,j,z,V;return{c(){_=element("input"),M=space(),$=element("div"),j=element("button"),j.innerHTML=`Upload your current alias in .JSON

    <span class="tooltiptext svelte-llh4qb">It is a JSON file</span>`,set_style(_,"display","none"),attr(_,"type","file"),attr(_,"accept",".json, .txt"),attr(j,"class","tooltip phase1 my-2  svelte-llh4qb"),attr($,"class","flex w-auto lg:w-11/12 items-center align-center flex-col")},m(X,G){insert(X,_,G),q[4](_),insert(X,M,G),insert(X,$,G),append($,j),z||(V=[listen(_,"change",q[3]),listen(j,"click",q[5])],z=!0)},p:noop,i:noop,o:noop,d(X){X&&detach(_),q[4](null),X&&detach(M),X&&detach($),z=!1,run_all(V)}}}function readFileAsync$1(q){return new Promise((_,M)=>{let $=new FileReader;$.onload=()=>{_($.result)},$.onerror=M,$.readAsBinaryString(q)})}function instance$Y(q,_,M){const $=createEventDispatcher();let j,z,{identityPg:V=!1}=_;async function X(ee){let te=ee.target.files[0],Z=await readFileAsync$1(te);try{let ne=JSON.parse(Z);console.log(typeof ne),console.log("fileReady",Z);let re=ne.address;console.log("authorAddress",re);let se=ne.secret;console.log("authorSecret",se),authorKeypair.set({address:re,secret:se}),z=re.slice(1,5),$("alias",z)}catch{$("error")}}const G=ee=>X(ee);function Y(ee){binding_callbacks[ee?"unshift":"push"](()=>{j=ee,M(0,j)})}const Q=()=>{j.click()};return q.$$set=ee=>{"identityPg"in ee&&M(2,V=ee.identityPg)},[j,X,V,G,Y,Q]}class UploadId extends SvelteComponent{constructor(_){super(),init(this,_,instance$Y,create_fragment$12,safe_not_equal,{identityPg:2})}}const Identity_svelte_svelte_type_style_lang="";function create_else_block_1$7(q){let _,M;return{c(){_=element("br"),M=text(q[1])},m($,j){insert($,_,j),insert($,M,j)},p($,j){j&2&&set_data(M,$[1])},d($){$&&detach(_),$&&detach(M)}}}function create_if_block_5$6(q){let _,M,$,j;return{c(){_=element("div"),M=element("input"),attr(M,"class","w-auto lg:w-2/3 svelte-19qp35a"),attr(M,"type","text"),attr(M,"spellcheck","false"),attr(M,"maxlength","4")},m(z,V){insert(z,_,V),append(_,M),set_input_value(M,q[3]),$||(j=[listen(M,"input",q[14]),listen(M,"keypress",q[15]),listen(M,"focus",q[16]),listen(M,"keypress",q[17])],$=!0)},p(z,V){V&8&&M.value!==z[3]&&set_input_value(M,z[3])},d(z){z&&detach(_),$=!1,run_all(j)}}}function create_if_block_1$k(q){let _,M;function $(V,X){return V[4]==="ID must be 4 characters long"?create_if_block_2$h:V[4]==="ID must start with a letter"?create_if_block_3$d:V[4]==="ID must not contain special characters"?create_if_block_4$9:create_else_block$d}let j=$(q),z=j(q);return{c(){_=element("blockquote"),z.c()},m(V,X){insert(V,_,X),z.m(_,null)},p(V,X){j!==(j=$(V))&&(z.d(1),z=j(V),z&&(z.c(),z.m(_,null)))},i(V){M||add_render_callback(()=>{M=create_in_transition(_,fly,{y:50,duration:2e3}),M.start()})},o:noop,d(V){V&&detach(_),z.d()}}}function create_else_block$d(q){let _,M,$;return{c(){_=text("Press enter or click on "),M=element("b"),M.textContent="Change alias",$=text(" to generate a new keypair.")},m(j,z){insert(j,_,z),insert(j,M,z),insert(j,$,z)},d(j){j&&detach(_),j&&detach(M),j&&detach($)}}}function create_if_block_4$9(q){let _;return{c(){_=element("i"),_.innerHTML=`<strong>Special characters are not allowed.</strong> 
                  <br/>`},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_3$d(q){let _;return{c(){_=element("i"),_.innerHTML=`<strong>A valid alias must begin with a letter.</strong> It needs to
                  be 4 characters long and can only contain letters and numbers.`},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_2$h(q){let _;return{c(){_=element("i"),_.innerHTML="A valid id <strong>needs to be 4 characters long</strong>."},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block$y(q){let _,M,$;return{c(){_=element("blockquote"),_.innerHTML="<strong>Please upload a valid identity file</strong>"},m(j,z){insert(j,_,z),$=!0},i(j){$||(add_render_callback(()=>{M||(M=create_bidirectional_transition(_,fly,{y:200,duration:2e3},!0)),M.run(1)}),$=!0)},o(j){M||(M=create_bidirectional_transition(_,fly,{y:200,duration:2e3},!1)),M.run(0),$=!1},d(j){j&&detach(_),j&&M&&M.end()}}}function create_fragment$11(q){let _,M,$,j,z,V,X,G,Y,Q,ee,te,Z,ne,re,se,ie,oe,ue,ce,ae,le,he,ge,de,pe,ye,_e,De,fe,Ae,Me,Ee,Te,Be,Xe,ze,Oe,Pe,ve,be,Ce,Ne,Ie,Le,je,Ve,ot,lt;function me($e,Je){return $e[7]?create_if_block_5$6:create_else_block_1$7}let We=me(q),Ye=We(q),Fe=q[5]&&create_if_block_1$k(q),xe=q[6]===!0&&create_if_block$y();return ae=new UploadId({props:{identityPg:!0}}),ae.$on("alias",q[10]),ae.$on("error",q[11]),{c(){_=element("div"),M=element("div"),$=element("div"),j=element("div"),z=element("h3"),z.textContent="manage alias",V=space(),X=element("h4"),G=element("b"),G.textContent="Your current alias:",Y=space(),Ye.c(),Q=space(),ee=element("div"),te=element("button"),te.textContent="edit current alias",Z=space(),ne=element("button"),ne.textContent="change alias",re=space(),se=element("div"),ie=element("div"),Fe&&Fe.c(),oe=space(),xe&&xe.c(),ue=space(),ce=element("div"),create_component(ae.$$.fragment),le=space(),he=element("div"),he.textContent=`Your alias (the identity you assume on this platform when interacting with
      others) is represented by the keypair seen below. It contains an address
      and a secret. If you intend on using the same alias consistently, it is
      important that you save your keypair safe in folder offline. Workspaces
      you have been invited to may be tied to your alias. Always keep a backup
      of all keypairs of your workspaces and aliases.`,ge=space(),de=element("div"),pe=element("div"),ye=element("b"),ye.textContent="Address:",_e=space(),De=text(q[2]),fe=space(),Ae=element("br"),Me=space(),Ee=element("b"),Ee.textContent="Secret:",Te=space(),Be=text(q[8]),Xe=space(),ze=element("div"),Oe=element("button"),Oe.textContent="download your current alias in .JSON",Pe=space(),ve=element("div"),be=element("div"),Ce=element("h5"),Ce.innerHTML="<b>generate a new alias</b>",Ne=space(),Ie=element("div"),Ie.textContent="You can aways assume a new identity.",Le=space(),je=element("button"),je.textContent="generate another identity",attr(X,"class","my-4"),attr(j,"class","flex flex-col"),attr(te,"class","phase1 w-auto lg:w-11/12 mx-4"),attr(ne,"class","phase1 w-auto lg:w-11/12"),attr(ee,"class","my-4 flex flex-row h-1/3"),attr($,"class","w-4/5 lg:w-3/5 flex flex-row justify-between items-end"),attr(ie,"class","text-left flex-grow"),attr(se,"class","w-4/5 lg:w-3/5 flex flex-row justify-between"),attr(he,"class","w-4/5 lg:w-3/5"),attr(de,"class","my-6"),attr(Oe,"class","phase1 w-auto lg:w-11/12"),attr(ze,"class","mt-4 flex items-start align-left flex-col"),attr(Ce,"class","my-4"),attr(Ie,"class","w-4/5 lg:w-3/5"),attr(je,"class","phase1 my-8"),attr(M,"class","flex flex-col items-start pb-24"),attr(_,"class","w-full text-left")},m($e,Je){insert($e,_,Je),append(_,M),append(M,$),append($,j),append(j,z),append(j,V),append(j,X),append(X,G),append(X,Y),Ye.m(X,null),append($,Q),append($,ee),append(ee,te),append(ee,Z),append(ee,ne),append(M,re),append(M,se),append(se,ie),Fe&&Fe.m(ie,null),append(ie,oe),xe&&xe.m(ie,null),append(se,ue),append(se,ce),mount_component(ae,ce,null),append(M,le),append(M,he),append(M,ge),append(M,de),append(de,pe),append(pe,ye),append(pe,_e),append(pe,De),append(pe,fe),append(pe,Ae),append(pe,Me),append(pe,Ee),append(pe,Te),append(pe,Be),append(M,Xe),append(M,ze),append(ze,Oe),append(M,Pe),append(M,ve),append(ve,be),append(be,Ce),append(be,Ne),append(be,Ie),append(be,Le),append(be,je),Ve=!0,ot||(lt=[listen(te,"click",q[12]),listen(ne,"click",q[0]),listen(Oe,"click",q[18]),listen(je,"click",q[19])],ot=!0)},p($e,[Je]){We===(We=me($e))&&Ye?Ye.p($e,Je):(Ye.d(1),Ye=We($e),Ye&&(Ye.c(),Ye.m(X,null))),$e[5]?Fe?(Fe.p($e,Je),Je&32&&transition_in(Fe,1)):(Fe=create_if_block_1$k($e),Fe.c(),transition_in(Fe,1),Fe.m(ie,oe)):Fe&&(Fe.d(1),Fe=null),$e[6]===!0?xe?Je&64&&transition_in(xe,1):(xe=create_if_block$y(),xe.c(),transition_in(xe,1),xe.m(ie,null)):xe&&(group_outros(),transition_out(xe,1,1,()=>{xe=null}),check_outros()),(!Ve||Je&4)&&set_data(De,$e[2]),(!Ve||Je&256)&&set_data(Be,$e[8])},i($e){Ve||(transition_in(Fe),transition_in(xe),transition_in(ae.$$.fragment,$e),Ve=!0)},o($e){transition_out(xe),transition_out(ae.$$.fragment,$e),Ve=!1},d($e){$e&&detach(_),Ye.d(),Fe&&Fe.d(),xe&&xe.d(),destroy_component(ae),ot=!1,run_all(lt)}}}function isNumber(q){return/[0-9]/.test(q)}function isSpecialChar(q){return/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(q)}function RandomId(){let q="",_="abcdefghijklmnopqrstuvwxyz",M=_.length,$="abcdefghijklmnopqrstuvwxyz0123456789",j=$.length;q+=_.charAt(Math.floor(Math.random()*M));for(let z=0;z<3;z++)q+=$.charAt(Math.floor(Math.random()*j));return q}function instance$X(q,_,M){let $,j,z,V;component_subscribe(q,authorKeypair,ge=>M(13,V=ge));let X,G,Y=!1,Q,ee=!1,te=!1;function Z(){let ge=document.createElement("a"),de=new Blob([JSON.stringify(V)],{type:"text/plain"}),pe=V.address+".json";ge.href=URL.createObjectURL(de),ge.download=pe,ge.style.display="none",document.body.appendChild(ge),ge.click()}async function ne(ge){ge=="r"&&M(3,X=RandomId());let de=X.slice(0,1);if(isNumber(de))console.log("firstChar",de),M(4,G="ID must start with a letter");else if(X.length!==4)M(4,G="ID must be 4 characters long");else if(isSpecialChar(X))M(4,G="ID must not contain special characters");else{let pe=await Crypto.generateAuthorKeypair(X),ye=pe.address,_e=pe.secret;authorKeypair.set({address:ye,secret:_e}),M(4,G=null),M(5,Y=!1),settings.author=pe}}function re(ge){console.log("event",ge),Q=ge.detail,M(3,X=Q),M(6,ee=!1)}function se(){M(6,ee=!0)}onMount(async()=>{settings.author?authorKeypair.set(settings.author):ne("r")});function ie(){M(7,te=!te)}function oe(){X=this.value,M(3,X),M(1,z),M(2,$),M(13,V)}const ue=()=>{M(5,Y=!0)},ce=()=>{M(5,Y=!0)},ae=()=>ne(),le=()=>Z(),he=()=>ne("r");return q.$$.update=()=>{q.$$.dirty&8192&&M(2,$=V.address),q.$$.dirty&8192&&M(8,j=V.secret),q.$$.dirty&4&&M(1,z=$.slice(0,5)),q.$$.dirty&2&&M(3,X=z.slice(1,5))},[ne,z,$,X,G,Y,ee,te,j,Z,re,se,ie,V,oe,ue,ce,ae,le,he]}class Identity extends SvelteComponent{constructor(_){super(),init(this,_,instance$X,create_fragment$11,safe_not_equal,{generateID:0})}get generateID(){return this.$$.ctx[0]}}const ValidateId_svelte_svelte_type_style_lang="";function create_if_block$x(q){let _,M;return{c(){_=element("p"),M=text(q[1]),attr(_,"class","text-2xl")},m($,j){insert($,_,j),append(_,M)},p($,j){j&2&&set_data(M,$[1])},d($){$&&detach(_)}}}function create_fragment$10(q){let _,M,$,j,z,V,X,G,Y,Q,ee,te,Z;Y=new UploadId({}),Y.$on("alias",q[4]),Y.$on("error",q[5]);let ne=q[1]&&create_if_block$x(q);return{c(){_=element("div"),M=element("label"),M.textContent="Have an existing ID?",$=space(),j=element("div"),z=element("textarea"),V=space(),X=element("button"),X.textContent="Validate ID",G=space(),create_component(Y.$$.fragment),Q=space(),ne&&ne.c(),attr(M,"for","keypair"),attr(z,"class","px-5 my-2 svelte-5at67e"),attr(z,"id","keypair"),attr(z,"placeholder",`Paste it here:       
{
"address": "", 
"secret": ""
}`),attr(X,"class","phase1 mx-4 my-2"),attr(j,"class","flex md:flex-row items-end mx-0 flex-col svelte-5at67e"),attr(_,"class","flex flex-col items-start mx-0 svelte-5at67e")},m(re,se){insert(re,_,se),append(_,M),append(_,$),append(_,j),append(j,z),set_input_value(z,q[0]),append(j,V),append(j,X),append(j,G),mount_component(Y,j,null),append(_,Q),ne&&ne.m(_,null),ee=!0,te||(Z=[listen(z,"input",q[3]),listen(X,"click",q[2])],te=!0)},p(re,[se]){se&1&&set_input_value(z,re[0]),re[1]?ne?ne.p(re,se):(ne=create_if_block$x(re),ne.c(),ne.m(_,null)):ne&&(ne.d(1),ne=null)},i(re){ee||(transition_in(Y.$$.fragment,re),ee=!0)},o(re){transition_out(Y.$$.fragment,re),ee=!1},d(re){re&&detach(_),destroy_component(Y),ne&&ne.d(),te=!1,run_all(Z)}}}function instance$W(q,_,M){const $=createEventDispatcher();let j="",z="";function V(){try{let Q=JSON.parse(j);Q.address&&Q.secret?isErr(checkAuthorIsValid(Q.address))?(M(1,z="Invalid address"),$("error")):(authorKeypair.set({address:Q.address,secret:Q.secret}),settings.author=Q,$("validated")):(M(1,z="Invalid keypair"),$("error"))}catch{M(1,z="Invalid JSON"),$("error")}}function X(){j=this.value,M(0,j)}function G(Q){bubble.call(this,q,Q)}function Y(Q){bubble.call(this,q,Q)}return[j,z,V,X,G,Y]}class ValidateId extends SvelteComponent{constructor(_){super(),init(this,_,instance$W,create_fragment$10,safe_not_equal,{})}}const FileSharing_svelte_svelte_type_style_lang="";function create_fragment$$(q){let _,M,$,j,z;return{c(){_=element("div"),M=element("div"),$=element("button"),$.textContent="file upload",attr($,"class","phase1"),attr(M,"class","svelte-1483hci"),attr(_,"class","svelte-1483hci")},m(V,X){insert(V,_,X),append(_,M),append(M,$),j||(z=[listen($,"click",q[0]),listen($,"keypress",q[0])],j=!0)},p:noop,i:noop,o:noop,d(V){V&&detach(_),j=!1,run_all(z)}}}function instance$V(q,_,M){const $=createEventDispatcher();let{xy:j=void 0}=_;function z(){$("selected",{type:"file",location:j})}return q.$$set=V=>{"xy"in V&&M(1,j=V.xy)},[z,j]}class FileSharing extends SvelteComponent{constructor(_){super(),init(this,_,instance$V,create_fragment$$,safe_not_equal,{xy:1})}}const cacheDetails=writable(null);replicaDetails.subscribe(q=>{if(!q||!q.replica){console.error("Replica is undefined or does not contain a valid replica property");return}try{const _=new ReplicaCache(q.replica);cacheDetails.set(_)}catch(_){console.error("Failed to create new cache:",_)}});const time=readable(new Date,function(_){const M=setInterval(()=>{_(new Date)},1e3);return function(){clearInterval(M)}}),start=new Date,elapsed=derived(time,q=>Math.round((Number(q)-Number(start))/1e3));function mapNumberToLetter$1(q){return String.fromCharCode(65+q)}function pathToXY(q){let _=q.split("/"),M=_[2],$=_[3],j=Number(M)+1,z=mapNumberToLetter$1(Number($));return[j,z]}const Voice_svelte_svelte_type_style_lang$1="";function create_fragment$_(q){let _,M,$,j;return{c(){_=element("div"),M=element("button"),M.textContent="record audio",attr(M,"class","phase1"),attr(_,"class","svelte-lllvde")},m(z,V){insert(z,_,V),append(_,M),$||(j=listen(M,"click",q[0]),$=!0)},p:noop,i:noop,o:noop,d(z){z&&detach(_),$=!1,j()}}}function instance$U(q,_,M){const $=createEventDispatcher();let{xy:j=void 0}=_;function z(){$("selected",{type:"audio",location:j})}return q.$$set=V=>{"xy"in V&&M(1,j=V.xy)},[z,j]}let Voice$1=class extends SvelteComponent{constructor(_){super(),init(this,_,instance$U,create_fragment$_,safe_not_equal,{xy:1})}};const TextInput_svelte_svelte_type_style_lang="";function create_fragment$Z(q){let _,M,$,j,z;return{c(){_=element("div"),M=element("div"),$=element("button"),$.textContent="written text",attr($,"class","phase1"),attr(M,"class","svelte-j8m7xm"),attr(_,"class","svelte-j8m7xm")},m(V,X){insert(V,_,X),append(_,M),append(M,$),j||(z=listen($,"click",q[0]),j=!0)},p:noop,i:noop,o:noop,d(V){V&&detach(_),j=!1,z()}}}function instance$T(q,_,M){const $=createEventDispatcher();let{xy:j=[0,0]}=_;function z(){$("selected",{type:"text",location:j})}return q.$$set=V=>{"xy"in V&&M(1,j=V.xy)},[z,j]}class TextInput extends SvelteComponent{constructor(_){super(),init(this,_,instance$T,create_fragment$Z,safe_not_equal,{xy:1})}}const GridUpload_svelte_svelte_type_style_lang="";function get_each_context$b(q,_,M){const $=q.slice();return $[19]=_[M],$[21]=M,$}function get_each_context_1$2(q,_,M){const $=q.slice();return $[19]=_[M],$[23]=M,$}function create_if_block$w(q){let _,M,$,j,z,V=mapNumberToLetter(q[5][1])+"",X,G,Y=q[5][0]+1+"",Q,ee,te,Z,ne,re,se,ie,oe,ue,ce,ae,le;return Z=new TextInput({props:{xy:q[5]}}),Z.$on("selected",q[11]),re=new FileSharing({props:{xy:q[5]}}),re.$on("selected",q[12]),ie=new Voice$1({props:{xy:q[5]}}),ie.$on("selected",q[13]),{c(){_=element("div"),M=element("div"),$=text(`What artefact would you like to create? 
      `),j=element("br"),z=space(),X=text(V),G=text(", "),Q=text(Y),ee=space(),te=element("div"),create_component(Z.$$.fragment),ne=space(),create_component(re.$$.fragment),se=space(),create_component(ie.$$.fragment),oe=space(),ue=element("button"),ue.textContent="close",attr(M,"class","mt-6 brown text-left px-6 svelte-beup2s"),attr(ue,"class","phase1"),attr(te,"class","flex-col"),attr(_,"class","modal pb-6  svelte-beup2s"),attr(_,"style",q[6])},m(he,ge){insert(he,_,ge),append(_,M),append(M,$),append(M,j),append(M,z),append(M,X),append(M,G),append(M,Q),append(_,ee),append(_,te),mount_component(Z,te,null),append(te,ne),mount_component(re,te,null),append(te,se),mount_component(ie,te,null),append(te,oe),append(te,ue),ce=!0,ae||(le=listen(ue,"click",q[8]),ae=!0)},p(he,ge){(!ce||ge&32)&&V!==(V=mapNumberToLetter(he[5][1])+"")&&set_data(X,V),(!ce||ge&32)&&Y!==(Y=he[5][0]+1+"")&&set_data(Q,Y);const de={};ge&32&&(de.xy=he[5]),Z.$set(de);const pe={};ge&32&&(pe.xy=he[5]),re.$set(pe);const ye={};ge&32&&(ye.xy=he[5]),ie.$set(ye),(!ce||ge&64)&&attr(_,"style",he[6])},i(he){ce||(transition_in(Z.$$.fragment,he),transition_in(re.$$.fragment,he),transition_in(ie.$$.fragment,he),ce=!0)},o(he){transition_out(Z.$$.fragment,he),transition_out(re.$$.fragment,he),transition_out(ie.$$.fragment,he),ce=!1},d(he){he&&detach(_),destroy_component(Z),destroy_component(re),destroy_component(ie),ae=!1,le()}}}function create_each_block_1$2(q,_){let M,$=mapNumberToLetter(_[23])+"",j,z,V=_[21]+1+"",X,G,Y,Q;function ee(){return _[14](_[21],_[23])}function te(){return _[15](_[21],_[23])}return{key:q,first:null,c(){M=element("div"),j=text($),z=text(", "),X=text(V),G=space(),set_style(M,"display","flex"),set_style(M,"justify-content","center"),set_style(M,"align-items","center"),set_style(M,"height","100%"),attr(M,"class","svelte-beup2s"),toggle_class(M,"active",_[4][_[21]][_[23]]),this.first=M},m(Z,ne){insert(Z,M,ne),append(M,j),append(M,z),append(M,X),append(M,G),Y||(Q=[listen(M,"click",ee),listen(M,"keypress",te)],Y=!0)},p(Z,ne){_=Z,ne&1&&$!==($=mapNumberToLetter(_[23])+"")&&set_data(j,$),ne&1&&V!==(V=_[21]+1+"")&&set_data(X,V),ne&17&&toggle_class(M,"active",_[4][_[21]][_[23]])},d(Z){Z&&detach(M),Y=!1,run_all(Q)}}}function create_each_block$b(q,_){let M,$=[],j=new Map,z,V={length:_[0][1]};const X=G=>G[23];for(let G=0;G<V.length;G+=1){let Y=get_each_context_1$2(_,V,G),Q=X(Y);j.set(Q,$[G]=create_each_block_1$2(Q,Y))}return{key:q,first:null,c(){M=empty();for(let G=0;G<$.length;G+=1)$[G].c();z=empty(),this.first=M},m(G,Y){insert(G,M,Y);for(let Q=0;Q<$.length;Q+=1)$[Q].m(G,Y);insert(G,z,Y)},p(G,Y){_=G,Y&145&&(V={length:_[0][1]},$=update_keyed_each($,Y,X,1,_,V,j,z.parentNode,destroy_block,create_each_block_1$2,z,get_each_context_1$2))},d(G){G&&detach(M);for(let Y=0;Y<$.length;Y+=1)$[Y].d(G);G&&detach(z)}}}function create_fragment$Y(q){let _,M,$,j,z,V,X,G=[],Y=new Map,Q,ee=q[1]&&create_if_block$w(q),te={length:q[0][0]};const Z=ne=>ne[21];for(let ne=0;ne<te.length;ne+=1){let re=get_each_context$b(q,te,ne),se=Z(re);Y.set(se,G[ne]=create_each_block$b(se,re))}return{c(){_=element("div"),M=element("div"),ee&&ee.c(),$=space(),j=element("div"),z=element("h4"),z.textContent="Select location on map",V=space(),X=element("div");for(let ne=0;ne<G.length;ne+=1)G[ne].c();attr(z,"class","svelte-beup2s"),attr(X,"class","container mt-8 svelte-beup2s"),set_style(X,"grid-template-rows",q[3]),set_style(X,"grid-template-columns",q[2]),attr(j,"class","w-4/5"),set_style(M,"position","relative"),set_style(M,"z-index","52"),set_style(_,"position","fixed")},m(ne,re){insert(ne,_,re),append(_,M),ee&&ee.m(M,null),append(M,$),append(M,j),append(j,z),append(j,V),append(j,X);for(let se=0;se<G.length;se+=1)G[se].m(X,null);Q=!0},p(ne,[re]){ne[1]?ee?(ee.p(ne,re),re&2&&transition_in(ee,1)):(ee=create_if_block$w(ne),ee.c(),transition_in(ee,1),ee.m(M,$)):ee&&(group_outros(),transition_out(ee,1,1,()=>{ee=null}),check_outros()),re&145&&(te={length:ne[0][0]},G=update_keyed_each(G,re,Z,1,ne,te,Y,X,destroy_block,create_each_block$b,null,get_each_context$b)),(!Q||re&8)&&set_style(X,"grid-template-rows",ne[3]),(!Q||re&4)&&set_style(X,"grid-template-columns",ne[2])},i(ne){Q||(transition_in(ee),Q=!0)},o(ne){transition_out(ee),Q=!1},d(ne){ne&&detach(_),ee&&ee.d();for(let re=0;re<G.length;re+=1)G[re].d()}}}function mapNumberToLetter(q){return String.fromCharCode(65+q)}function instance$S(q,_,M){let $,{windowWidth:j}=_,z,V,X,G,Y=[],Q=!1,ee=["0px","0px"];function te(ae,le){M(5,Y=[ae,le]),ne([ae,le]),setTimeout(()=>{M(1,Q=!0),M(10,ee=[ae*50+"px",le*50+50+"px"])},500)}function Z([ae,le],[he,ge]){return(ae-Y[0])*(ae-he)<=0&&(le-Y[1])*(le-ge)<=0}function ne(ae){M(4,G=G.map((le,he)=>le.map((ge,de)=>Z([he,de],ae))))}function re(){M(1,Q=!1),M(4,G=Array(z[0]).fill(0).map(ae=>Array(z[1]).fill(!1)))}function se(ae){bubble.call(this,q,ae)}function ie(ae){bubble.call(this,q,ae)}function oe(ae){bubble.call(this,q,ae)}const ue=(ae,le)=>te(ae,le),ce=(ae,le)=>te(ae,le);return q.$$set=ae=>{"windowWidth"in ae&&M(9,j=ae.windowWidth)},q.$$.update=()=>{q.$$.dirty&513&&(j<=768?M(0,z=[18,3]):M(0,z=[6,9]),M(2,V=`repeat(${z[1]}, 1fr)`),M(3,X=`repeat(${z[0]}, 1fr)`),M(4,G=Array(z[0]).fill(0).map(ae=>Array(z[1]).fill(!1)))),q.$$.dirty&1026&&M(6,$=`top: ${ee[0]}; left: ${ee[1]}; visibility: ${Q?"visible":"hidden"};`)},[z,Q,V,X,G,Y,$,te,re,j,ee,se,ie,oe,ue,ce]}class GridUpload extends SvelteComponent{constructor(_){super(),init(this,_,instance$S,create_fragment$Y,safe_not_equal,{windowWidth:9})}}function supressWarnings(){const q=console.warn;console.warn=_=>{_.includes("unknown prop")||_.includes("unexpected slot")||q(_)},onMount(()=>{console.warn=q})}function get_each_context_5$1(q,_,M){const $=q.slice();return $[18]=_[M],$}function get_each_context_4$1(q,_,M){const $=q.slice();return $[18]=_[M],$}function get_each_context_1$1(q,_,M){const $=q.slice();return $[10]=_[M],$}function get_each_context_2$1(q,_,M){const $=q.slice();return $[13]=_[M],$[15]=M,$}function get_each_context_3$1(q,_,M){const $=q.slice();return $[16]=_[M],$[15]=M,$}function get_each_context$a(q,_,M){const $=q.slice();return $[7]=_[M],$}function create_if_block_1$j(q){let _,M,$,j;const z=[create_if_block_2$g,create_if_block_3$c,create_else_block_1$6],V=[];function X(G,Y){return G[0]==="table"?0:G[0]==="list"?1:2}return _=X(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(G,Y){V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,Y){let Q=_;_=X(G),_===Q?V[_].p(G,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){V[_].d(G),G&&detach($)}}}function create_if_block$v(q){let _,M,$=q[1],j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block$a(get_each_context$a(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=empty()},m(V,X){for(let G=0;G<j.length;G+=1)j[G].m(V,X);insert(V,_,X),M=!0},p(V,X){if(X&34){$=V[1];let G;for(G=0;G<$.length;G+=1){const Y=get_each_context$a(V,$,G);j[G]?(j[G].p(Y,X),transition_in(j[G],1)):(j[G]=create_each_block$a(Y),j[G].c(),transition_in(j[G],1),j[G].m(_.parentNode,_))}for(group_outros(),G=$.length;G<j.length;G+=1)z(G);check_outros()}},i(V){if(!M){for(let X=0;X<$.length;X+=1)transition_in(j[X]);M=!0}},o(V){j=j.filter(Boolean);for(let X=0;X<j.length;X+=1)transition_out(j[X]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_else_block_1$6(q){let _,M,$;const j=[q[6]];var z=q[5][q[0]];function V(X){let G={$$slots:{default:[create_default_slot_11]},$$scope:{ctx:X}};for(let Y=0;Y<j.length;Y+=1)G=assign(G,j[Y]);return{props:G}}return z&&(_=construct_svelte_component(z,V(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(X,G){_&&mount_component(_,X,G),insert(X,M,G),$=!0},p(X,G){const Y=G&64?get_spread_update(j,[get_spread_object(X[6])]):{};if(G&8388706&&(Y.$$scope={dirty:G,ctx:X}),z!==(z=X[5][X[0]])){if(_){group_outros();const Q=_;transition_out(Q.$$.fragment,1,0,()=>{destroy_component(Q,1)}),check_outros()}z?(_=construct_svelte_component(z,V(X)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else z&&_.$set(Y)},i(X){$||(_&&transition_in(_.$$.fragment,X),$=!0)},o(X){_&&transition_out(_.$$.fragment,X),$=!1},d(X){X&&detach(M),_&&destroy_component(_,X)}}}function create_if_block_3$c(q){let _,M,$,j;const z=[create_if_block_4$8,create_else_block$c],V=[];function X(G,Y){return G[4]?0:1}return _=X(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(G,Y){V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,Y){let Q=_;_=X(G),_===Q?V[_].p(G,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){V[_].d(G),G&&detach($)}}}function create_if_block_2$g(q){let _,M,$;var j=q[5].table;function z(V){return{props:{$$slots:{default:[create_default_slot$3]},$$scope:{ctx:V}}}}return j&&(_=construct_svelte_component(j,z(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(V,X){_&&mount_component(_,V,X),insert(V,M,X),$=!0},p(V,X){const G={};if(X&8388716&&(G.$$scope={dirty:X,ctx:V}),j!==(j=V[5].table)){if(_){group_outros();const Y=_;transition_out(Y.$$.fragment,1,0,()=>{destroy_component(Y,1)}),check_outros()}j?(_=construct_svelte_component(j,z(V)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else j&&_.$set(G)},i(V){$||(_&&transition_in(_.$$.fragment,V),$=!0)},o(V){_&&transition_out(_.$$.fragment,V),$=!1},d(V){V&&detach(M),_&&destroy_component(_,V)}}}function create_else_block_2$1(q){let _=q[6].raw+"",M;return{c(){M=text(_)},m($,j){insert($,M,j)},p($,j){j&64&&_!==(_=$[6].raw+"")&&set_data(M,_)},i:noop,o:noop,d($){$&&detach(M)}}}function create_if_block_5$5(q){let _,M;return _=new Parser$1({props:{tokens:q[1],renderers:q[5]}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.tokens=$[1]),j&32&&(z.renderers=$[5]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_default_slot_11(q){let _,M,$,j;const z=[create_if_block_5$5,create_else_block_2$1],V=[];function X(G,Y){return G[1]?0:1}return _=X(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(G,Y){V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,Y){let Q=_;_=X(G),_===Q?V[_].p(G,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){V[_].d(G),G&&detach($)}}}function create_else_block$c(q){let _,M,$;const j=[{ordered:q[4]},q[6]];var z=q[5].list;function V(X){let G={$$slots:{default:[create_default_slot_9]},$$scope:{ctx:X}};for(let Y=0;Y<j.length;Y+=1)G=assign(G,j[Y]);return{props:G}}return z&&(_=construct_svelte_component(z,V(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(X,G){_&&mount_component(_,X,G),insert(X,M,G),$=!0},p(X,G){const Y=G&80?get_spread_update(j,[G&16&&{ordered:X[4]},G&64&&get_spread_object(X[6])]):{};if(G&8388704&&(Y.$$scope={dirty:G,ctx:X}),z!==(z=X[5].list)){if(_){group_outros();const Q=_;transition_out(Q.$$.fragment,1,0,()=>{destroy_component(Q,1)}),check_outros()}z?(_=construct_svelte_component(z,V(X)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else z&&_.$set(Y)},i(X){$||(_&&transition_in(_.$$.fragment,X),$=!0)},o(X){_&&transition_out(_.$$.fragment,X),$=!1},d(X){X&&detach(M),_&&destroy_component(_,X)}}}function create_if_block_4$8(q){let _,M,$;const j=[{ordered:q[4]},q[6]];var z=q[5].list;function V(X){let G={$$slots:{default:[create_default_slot_7$1]},$$scope:{ctx:X}};for(let Y=0;Y<j.length;Y+=1)G=assign(G,j[Y]);return{props:G}}return z&&(_=construct_svelte_component(z,V(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(X,G){_&&mount_component(_,X,G),insert(X,M,G),$=!0},p(X,G){const Y=G&80?get_spread_update(j,[G&16&&{ordered:X[4]},G&64&&get_spread_object(X[6])]):{};if(G&8388704&&(Y.$$scope={dirty:G,ctx:X}),z!==(z=X[5].list)){if(_){group_outros();const Q=_;transition_out(Q.$$.fragment,1,0,()=>{destroy_component(Q,1)}),check_outros()}z?(_=construct_svelte_component(z,V(X)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else z&&_.$set(Y)},i(X){$||(_&&transition_in(_.$$.fragment,X),$=!0)},o(X){_&&transition_out(_.$$.fragment,X),$=!1},d(X){X&&detach(M),_&&destroy_component(_,X)}}}function create_default_slot_10(q){let _,M,$;return _=new Parser$1({props:{tokens:q[18].tokens,renderers:q[5]}}),{c(){create_component(_.$$.fragment),M=space()},m(j,z){mount_component(_,j,z),insert(j,M,z),$=!0},p(j,z){const V={};z&64&&(V.tokens=j[18].tokens),z&32&&(V.renderers=j[5]),_.$set(V)},i(j){$||(transition_in(_.$$.fragment,j),$=!0)},o(j){transition_out(_.$$.fragment,j),$=!1},d(j){destroy_component(_,j),j&&detach(M)}}}function create_each_block_5$1(q){let _,M,$;const j=[q[18]];var z=q[5].unorderedlistitem||q[5].listitem;function V(X){let G={$$slots:{default:[create_default_slot_10]},$$scope:{ctx:X}};for(let Y=0;Y<j.length;Y+=1)G=assign(G,j[Y]);return{props:G}}return z&&(_=construct_svelte_component(z,V(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(X,G){_&&mount_component(_,X,G),insert(X,M,G),$=!0},p(X,G){const Y=G&64?get_spread_update(j,[get_spread_object(X[18])]):{};if(G&8388704&&(Y.$$scope={dirty:G,ctx:X}),z!==(z=X[5].unorderedlistitem||X[5].listitem)){if(_){group_outros();const Q=_;transition_out(Q.$$.fragment,1,0,()=>{destroy_component(Q,1)}),check_outros()}z?(_=construct_svelte_component(z,V(X)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else z&&_.$set(Y)},i(X){$||(_&&transition_in(_.$$.fragment,X),$=!0)},o(X){_&&transition_out(_.$$.fragment,X),$=!1},d(X){X&&detach(M),_&&destroy_component(_,X)}}}function create_default_slot_9(q){let _,M,$=q[6].items,j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block_5$1(get_each_context_5$1(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=empty()},m(V,X){for(let G=0;G<j.length;G+=1)j[G].m(V,X);insert(V,_,X),M=!0},p(V,X){if(X&96){$=V[6].items;let G;for(G=0;G<$.length;G+=1){const Y=get_each_context_5$1(V,$,G);j[G]?(j[G].p(Y,X),transition_in(j[G],1)):(j[G]=create_each_block_5$1(Y),j[G].c(),transition_in(j[G],1),j[G].m(_.parentNode,_))}for(group_outros(),G=$.length;G<j.length;G+=1)z(G);check_outros()}},i(V){if(!M){for(let X=0;X<$.length;X+=1)transition_in(j[X]);M=!0}},o(V){j=j.filter(Boolean);for(let X=0;X<j.length;X+=1)transition_out(j[X]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_default_slot_8$1(q){let _,M,$;return _=new Parser$1({props:{tokens:q[18].tokens,renderers:q[5]}}),{c(){create_component(_.$$.fragment),M=space()},m(j,z){mount_component(_,j,z),insert(j,M,z),$=!0},p(j,z){const V={};z&64&&(V.tokens=j[18].tokens),z&32&&(V.renderers=j[5]),_.$set(V)},i(j){$||(transition_in(_.$$.fragment,j),$=!0)},o(j){transition_out(_.$$.fragment,j),$=!1},d(j){destroy_component(_,j),j&&detach(M)}}}function create_each_block_4$1(q){let _,M,$;const j=[q[18]];var z=q[5].orderedlistitem||q[5].listitem;function V(X){let G={$$slots:{default:[create_default_slot_8$1]},$$scope:{ctx:X}};for(let Y=0;Y<j.length;Y+=1)G=assign(G,j[Y]);return{props:G}}return z&&(_=construct_svelte_component(z,V(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(X,G){_&&mount_component(_,X,G),insert(X,M,G),$=!0},p(X,G){const Y=G&64?get_spread_update(j,[get_spread_object(X[18])]):{};if(G&8388704&&(Y.$$scope={dirty:G,ctx:X}),z!==(z=X[5].orderedlistitem||X[5].listitem)){if(_){group_outros();const Q=_;transition_out(Q.$$.fragment,1,0,()=>{destroy_component(Q,1)}),check_outros()}z?(_=construct_svelte_component(z,V(X)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else z&&_.$set(Y)},i(X){$||(_&&transition_in(_.$$.fragment,X),$=!0)},o(X){_&&transition_out(_.$$.fragment,X),$=!1},d(X){X&&detach(M),_&&destroy_component(_,X)}}}function create_default_slot_7$1(q){let _,M,$=q[6].items,j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block_4$1(get_each_context_4$1(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=empty()},m(V,X){for(let G=0;G<j.length;G+=1)j[G].m(V,X);insert(V,_,X),M=!0},p(V,X){if(X&96){$=V[6].items;let G;for(G=0;G<$.length;G+=1){const Y=get_each_context_4$1(V,$,G);j[G]?(j[G].p(Y,X),transition_in(j[G],1)):(j[G]=create_each_block_4$1(Y),j[G].c(),transition_in(j[G],1),j[G].m(_.parentNode,_))}for(group_outros(),G=$.length;G<j.length;G+=1)z(G);check_outros()}},i(V){if(!M){for(let X=0;X<$.length;X+=1)transition_in(j[X]);M=!0}},o(V){j=j.filter(Boolean);for(let X=0;X<j.length;X+=1)transition_out(j[X]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_default_slot_6$1(q){let _,M,$;return _=new Parser$1({props:{tokens:q[16].tokens,renderers:q[5]}}),{c(){create_component(_.$$.fragment),M=space()},m(j,z){mount_component(_,j,z),insert(j,M,z),$=!0},p(j,z){const V={};z&4&&(V.tokens=j[16].tokens),z&32&&(V.renderers=j[5]),_.$set(V)},i(j){$||(transition_in(_.$$.fragment,j),$=!0)},o(j){transition_out(_.$$.fragment,j),$=!1},d(j){destroy_component(_,j),j&&detach(M)}}}function create_each_block_3$1(q){let _,M,$;var j=q[5].tablecell;function z(V){return{props:{header:!0,align:V[6].align[V[15]]||"center",$$slots:{default:[create_default_slot_6$1]},$$scope:{ctx:V}}}}return j&&(_=construct_svelte_component(j,z(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(V,X){_&&mount_component(_,V,X),insert(V,M,X),$=!0},p(V,X){const G={};if(X&64&&(G.align=V[6].align[V[15]]||"center"),X&8388644&&(G.$$scope={dirty:X,ctx:V}),j!==(j=V[5].tablecell)){if(_){group_outros();const Y=_;transition_out(Y.$$.fragment,1,0,()=>{destroy_component(Y,1)}),check_outros()}j?(_=construct_svelte_component(j,z(V)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else j&&_.$set(G)},i(V){$||(_&&transition_in(_.$$.fragment,V),$=!0)},o(V){_&&transition_out(_.$$.fragment,V),$=!1},d(V){V&&detach(M),_&&destroy_component(_,V)}}}function create_default_slot_5$1(q){let _,M,$=q[2],j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block_3$1(get_each_context_3$1(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=empty()},m(V,X){for(let G=0;G<j.length;G+=1)j[G].m(V,X);insert(V,_,X),M=!0},p(V,X){if(X&100){$=V[2];let G;for(G=0;G<$.length;G+=1){const Y=get_each_context_3$1(V,$,G);j[G]?(j[G].p(Y,X),transition_in(j[G],1)):(j[G]=create_each_block_3$1(Y),j[G].c(),transition_in(j[G],1),j[G].m(_.parentNode,_))}for(group_outros(),G=$.length;G<j.length;G+=1)z(G);check_outros()}},i(V){if(!M){for(let X=0;X<$.length;X+=1)transition_in(j[X]);M=!0}},o(V){j=j.filter(Boolean);for(let X=0;X<j.length;X+=1)transition_out(j[X]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_default_slot_4$1(q){let _,M,$;var j=q[5].tablerow;function z(V){return{props:{$$slots:{default:[create_default_slot_5$1]},$$scope:{ctx:V}}}}return j&&(_=construct_svelte_component(j,z(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(V,X){_&&mount_component(_,V,X),insert(V,M,X),$=!0},p(V,X){const G={};if(X&8388708&&(G.$$scope={dirty:X,ctx:V}),j!==(j=V[5].tablerow)){if(_){group_outros();const Y=_;transition_out(Y.$$.fragment,1,0,()=>{destroy_component(Y,1)}),check_outros()}j?(_=construct_svelte_component(j,z(V)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else j&&_.$set(G)},i(V){$||(_&&transition_in(_.$$.fragment,V),$=!0)},o(V){_&&transition_out(_.$$.fragment,V),$=!1},d(V){V&&detach(M),_&&destroy_component(_,V)}}}function create_default_slot_3$1(q){let _,M;return _=new Parser$1({props:{tokens:q[13].tokens,renderers:q[5]}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&8&&(z.tokens=$[13].tokens),j&32&&(z.renderers=$[5]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_each_block_2$1(q){let _,M,$;var j=q[5].tablecell;function z(V){return{props:{header:!1,align:V[6].align[V[15]]||"center",$$slots:{default:[create_default_slot_3$1]},$$scope:{ctx:V}}}}return j&&(_=construct_svelte_component(j,z(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(V,X){_&&mount_component(_,V,X),insert(V,M,X),$=!0},p(V,X){const G={};if(X&64&&(G.align=V[6].align[V[15]]||"center"),X&8388648&&(G.$$scope={dirty:X,ctx:V}),j!==(j=V[5].tablecell)){if(_){group_outros();const Y=_;transition_out(Y.$$.fragment,1,0,()=>{destroy_component(Y,1)}),check_outros()}j?(_=construct_svelte_component(j,z(V)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else j&&_.$set(G)},i(V){$||(_&&transition_in(_.$$.fragment,V),$=!0)},o(V){_&&transition_out(_.$$.fragment,V),$=!1},d(V){V&&detach(M),_&&destroy_component(_,V)}}}function create_default_slot_2$1(q){let _,M,$=q[10],j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block_2$1(get_each_context_2$1(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=space()},m(V,X){for(let G=0;G<j.length;G+=1)j[G].m(V,X);insert(V,_,X),M=!0},p(V,X){if(X&104){$=V[10];let G;for(G=0;G<$.length;G+=1){const Y=get_each_context_2$1(V,$,G);j[G]?(j[G].p(Y,X),transition_in(j[G],1)):(j[G]=create_each_block_2$1(Y),j[G].c(),transition_in(j[G],1),j[G].m(_.parentNode,_))}for(group_outros(),G=$.length;G<j.length;G+=1)z(G);check_outros()}},i(V){if(!M){for(let X=0;X<$.length;X+=1)transition_in(j[X]);M=!0}},o(V){j=j.filter(Boolean);for(let X=0;X<j.length;X+=1)transition_out(j[X]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_each_block_1$1(q){let _,M,$;var j=q[5].tablerow;function z(V){return{props:{$$slots:{default:[create_default_slot_2$1]},$$scope:{ctx:V}}}}return j&&(_=construct_svelte_component(j,z(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(V,X){_&&mount_component(_,V,X),insert(V,M,X),$=!0},p(V,X){const G={};if(X&8388712&&(G.$$scope={dirty:X,ctx:V}),j!==(j=V[5].tablerow)){if(_){group_outros();const Y=_;transition_out(Y.$$.fragment,1,0,()=>{destroy_component(Y,1)}),check_outros()}j?(_=construct_svelte_component(j,z(V)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else j&&_.$set(G)},i(V){$||(_&&transition_in(_.$$.fragment,V),$=!0)},o(V){_&&transition_out(_.$$.fragment,V),$=!1},d(V){V&&detach(M),_&&destroy_component(_,V)}}}function create_default_slot_1$1(q){let _,M,$=q[3],j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block_1$1(get_each_context_1$1(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=empty()},m(V,X){for(let G=0;G<j.length;G+=1)j[G].m(V,X);insert(V,_,X),M=!0},p(V,X){if(X&104){$=V[3];let G;for(G=0;G<$.length;G+=1){const Y=get_each_context_1$1(V,$,G);j[G]?(j[G].p(Y,X),transition_in(j[G],1)):(j[G]=create_each_block_1$1(Y),j[G].c(),transition_in(j[G],1),j[G].m(_.parentNode,_))}for(group_outros(),G=$.length;G<j.length;G+=1)z(G);check_outros()}},i(V){if(!M){for(let X=0;X<$.length;X+=1)transition_in(j[X]);M=!0}},o(V){j=j.filter(Boolean);for(let X=0;X<j.length;X+=1)transition_out(j[X]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_default_slot$3(q){let _,M,$,j,z;var V=q[5].tablehead;function X(Q){return{props:{$$slots:{default:[create_default_slot_4$1]},$$scope:{ctx:Q}}}}V&&(_=construct_svelte_component(V,X(q)));var G=q[5].tablebody;function Y(Q){return{props:{$$slots:{default:[create_default_slot_1$1]},$$scope:{ctx:Q}}}}return G&&($=construct_svelte_component(G,Y(q))),{c(){_&&create_component(_.$$.fragment),M=space(),$&&create_component($.$$.fragment),j=empty()},m(Q,ee){_&&mount_component(_,Q,ee),insert(Q,M,ee),$&&mount_component($,Q,ee),insert(Q,j,ee),z=!0},p(Q,ee){const te={};if(ee&8388708&&(te.$$scope={dirty:ee,ctx:Q}),V!==(V=Q[5].tablehead)){if(_){group_outros();const ne=_;transition_out(ne.$$.fragment,1,0,()=>{destroy_component(ne,1)}),check_outros()}V?(_=construct_svelte_component(V,X(Q)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else V&&_.$set(te);const Z={};if(ee&8388712&&(Z.$$scope={dirty:ee,ctx:Q}),G!==(G=Q[5].tablebody)){if($){group_outros();const ne=$;transition_out(ne.$$.fragment,1,0,()=>{destroy_component(ne,1)}),check_outros()}G?($=construct_svelte_component(G,Y(Q)),create_component($.$$.fragment),transition_in($.$$.fragment,1),mount_component($,j.parentNode,j)):$=null}else G&&$.$set(Z)},i(Q){z||(_&&transition_in(_.$$.fragment,Q),$&&transition_in($.$$.fragment,Q),z=!0)},o(Q){_&&transition_out(_.$$.fragment,Q),$&&transition_out($.$$.fragment,Q),z=!1},d(Q){_&&destroy_component(_,Q),Q&&detach(M),Q&&detach(j),$&&destroy_component($,Q)}}}function create_each_block$a(q){let _,M;const $=[q[7],{renderers:q[5]}];let j={};for(let z=0;z<$.length;z+=1)j=assign(j,$[z]);return _=new Parser$1({props:j}),{c(){create_component(_.$$.fragment)},m(z,V){mount_component(_,z,V),M=!0},p(z,V){const X=V&34?get_spread_update($,[V&2&&get_spread_object(z[7]),V&32&&{renderers:z[5]}]):{};_.$set(X)},i(z){M||(transition_in(_.$$.fragment,z),M=!0)},o(z){transition_out(_.$$.fragment,z),M=!1},d(z){destroy_component(_,z)}}}function create_fragment$X(q){let _,M,$,j;const z=[create_if_block$v,create_if_block_1$j],V=[];function X(G,Y){return G[0]?G[5][G[0]]?1:-1:0}return~(_=X(q))&&(M=V[_]=z[_](q)),{c(){M&&M.c(),$=empty()},m(G,Y){~_&&V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,[Y]){let Q=_;_=X(G),_===Q?~_&&V[_].p(G,Y):(M&&(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros()),~_?(M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$)):M=null)},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){~_&&V[_].d(G),G&&detach($)}}}function instance$R(q,_,M){const $=["type","tokens","header","rows","ordered","renderers"];let j=compute_rest_props(_,$),{type:z=void 0}=_,{tokens:V=void 0}=_,{header:X=void 0}=_,{rows:G=void 0}=_,{ordered:Y=!1}=_,{renderers:Q}=_;return supressWarnings(),q.$$set=ee=>{_=assign(assign({},_),exclude_internal_props(ee)),M(6,j=compute_rest_props(_,$)),"type"in ee&&M(0,z=ee.type),"tokens"in ee&&M(1,V=ee.tokens),"header"in ee&&M(2,X=ee.header),"rows"in ee&&M(3,G=ee.rows),"ordered"in ee&&M(4,Y=ee.ordered),"renderers"in ee&&M(5,Q=ee.renderers)},[z,V,X,G,Y,Q,j]}let Parser$1=class extends SvelteComponent{constructor(_){super(),init(this,_,instance$R,create_fragment$X,safe_not_equal,{type:0,tokens:1,header:2,rows:3,ordered:4,renderers:5})}};function getDefaults(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let defaults=getDefaults();function changeDefaults(q){defaults=q}const escapeTest=/[&<>"']/,escapeReplace=new RegExp(escapeTest.source,"g"),escapeTestNoEncode=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode=new RegExp(escapeTestNoEncode.source,"g"),escapeReplacements={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},getEscapeReplacement=q=>escapeReplacements[q];function escape$1(q,_){if(_){if(escapeTest.test(q))return q.replace(escapeReplace,getEscapeReplacement)}else if(escapeTestNoEncode.test(q))return q.replace(escapeReplaceNoEncode,getEscapeReplacement);return q}const unescapeTest=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function unescape$1(q){return q.replace(unescapeTest,(_,M)=>(M=M.toLowerCase(),M==="colon"?":":M.charAt(0)==="#"?M.charAt(1)==="x"?String.fromCharCode(parseInt(M.substring(2),16)):String.fromCharCode(+M.substring(1)):""))}const caret=/(^|[^\[])\^/g;function edit(q,_){q=typeof q=="string"?q:q.source,_=_||"";const M={replace:($,j)=>(j=j.source||j,j=j.replace(caret,"$1"),q=q.replace($,j),M),getRegex:()=>new RegExp(q,_)};return M}const nonWordAndColonTest=/[^\w:]/g,originIndependentUrl=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function cleanUrl(q,_,M){if(q){let $;try{$=decodeURIComponent(unescape$1(M)).replace(nonWordAndColonTest,"").toLowerCase()}catch{return null}if($.indexOf("javascript:")===0||$.indexOf("vbscript:")===0||$.indexOf("data:")===0)return null}_&&!originIndependentUrl.test(M)&&(M=resolveUrl(_,M));try{M=encodeURI(M).replace(/%25/g,"%")}catch{return null}return M}const baseUrls={},justDomain=/^[^:]+:\/*[^/]*$/,protocol=/^([^:]+:)[\s\S]*$/,domain=/^([^:]+:\/*[^/]*)[\s\S]*$/;function resolveUrl(q,_){baseUrls[" "+q]||(justDomain.test(q)?baseUrls[" "+q]=q+"/":baseUrls[" "+q]=rtrim(q,"/",!0)),q=baseUrls[" "+q];const M=q.indexOf(":")===-1;return _.substring(0,2)==="//"?M?_:q.replace(protocol,"$1")+_:_.charAt(0)==="/"?M?_:q.replace(domain,"$1")+_:q+_}const noopTest={exec:function(){}};function splitCells(q,_){const M=q.replace(/\|/g,(z,V,X)=>{let G=!1,Y=V;for(;--Y>=0&&X[Y]==="\\";)G=!G;return G?"|":" |"}),$=M.split(/ \|/);let j=0;if($[0].trim()||$.shift(),$.length>0&&!$[$.length-1].trim()&&$.pop(),$.length>_)$.splice(_);else for(;$.length<_;)$.push("");for(;j<$.length;j++)$[j]=$[j].trim().replace(/\\\|/g,"|");return $}function rtrim(q,_,M){const $=q.length;if($===0)return"";let j=0;for(;j<$;){const z=q.charAt($-j-1);if(z===_&&!M)j++;else if(z!==_&&M)j++;else break}return q.slice(0,$-j)}function findClosingBracket(q,_){if(q.indexOf(_[1])===-1)return-1;const M=q.length;let $=0,j=0;for(;j<M;j++)if(q[j]==="\\")j++;else if(q[j]===_[0])$++;else if(q[j]===_[1]&&($--,$<0))return j;return-1}function checkSanitizeDeprecation(q){q&&q.sanitize&&!q.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function repeatString(q,_){if(_<1)return"";let M="";for(;_>1;)_&1&&(M+=q),_>>=1,q+=q;return M+q}function outputLink(q,_,M,$){const j=_.href,z=_.title?escape$1(_.title):null,V=q[1].replace(/\\([\[\]])/g,"$1");if(q[0].charAt(0)!=="!"){$.state.inLink=!0;const X={type:"link",raw:M,href:j,title:z,text:V,tokens:$.inlineTokens(V)};return $.state.inLink=!1,X}return{type:"image",raw:M,href:j,title:z,text:escape$1(V)}}function indentCodeCompensation(q,_){const M=q.match(/^(\s+)(?:```)/);if(M===null)return _;const $=M[1];return _.split(`
`).map(j=>{const z=j.match(/^\s+/);if(z===null)return j;const[V]=z;return V.length>=$.length?j.slice($.length):j}).join(`
`)}class Tokenizer{constructor(_){this.options=_||defaults}space(_){const M=this.rules.block.newline.exec(_);if(M&&M[0].length>0)return{type:"space",raw:M[0]}}code(_){const M=this.rules.block.code.exec(_);if(M){const $=M[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:M[0],codeBlockStyle:"indented",text:this.options.pedantic?$:rtrim($,`
`)}}}fences(_){const M=this.rules.block.fences.exec(_);if(M){const $=M[0],j=indentCodeCompensation($,M[3]||"");return{type:"code",raw:$,lang:M[2]?M[2].trim().replace(this.rules.inline._escapes,"$1"):M[2],text:j}}}heading(_){const M=this.rules.block.heading.exec(_);if(M){let $=M[2].trim();if(/#$/.test($)){const j=rtrim($,"#");(this.options.pedantic||!j||/ $/.test(j))&&($=j.trim())}return{type:"heading",raw:M[0],depth:M[1].length,text:$,tokens:this.lexer.inline($)}}}hr(_){const M=this.rules.block.hr.exec(_);if(M)return{type:"hr",raw:M[0]}}blockquote(_){const M=this.rules.block.blockquote.exec(_);if(M){const $=M[0].replace(/^ *>[ \t]?/gm,""),j=this.lexer.state.top;this.lexer.state.top=!0;const z=this.lexer.blockTokens($);return this.lexer.state.top=j,{type:"blockquote",raw:M[0],tokens:z,text:$}}}list(_){let M=this.rules.block.list.exec(_);if(M){let $,j,z,V,X,G,Y,Q,ee,te,Z,ne,re=M[1].trim();const se=re.length>1,ie={type:"list",raw:"",ordered:se,start:se?+re.slice(0,-1):"",loose:!1,items:[]};re=se?`\\d{1,9}\\${re.slice(-1)}`:`\\${re}`,this.options.pedantic&&(re=se?re:"[*+-]");const oe=new RegExp(`^( {0,3}${re})((?:[	 ][^\\n]*)?(?:\\n|$))`);for(;_&&(ne=!1,!(!(M=oe.exec(_))||this.rules.block.hr.test(_)));){if($=M[0],_=_.substring($.length),Q=M[2].split(`
`,1)[0].replace(/^\t+/,ce=>" ".repeat(3*ce.length)),ee=_.split(`
`,1)[0],this.options.pedantic?(V=2,Z=Q.trimLeft()):(V=M[2].search(/[^ ]/),V=V>4?1:V,Z=Q.slice(V),V+=M[1].length),G=!1,!Q&&/^ *$/.test(ee)&&($+=ee+`
`,_=_.substring(ee.length+1),ne=!0),!ne){const ce=new RegExp(`^ {0,${Math.min(3,V-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),ae=new RegExp(`^ {0,${Math.min(3,V-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),le=new RegExp(`^ {0,${Math.min(3,V-1)}}(?:\`\`\`|~~~)`),he=new RegExp(`^ {0,${Math.min(3,V-1)}}#`);for(;_&&(te=_.split(`
`,1)[0],ee=te,this.options.pedantic&&(ee=ee.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(le.test(ee)||he.test(ee)||ce.test(ee)||ae.test(_)));){if(ee.search(/[^ ]/)>=V||!ee.trim())Z+=`
`+ee.slice(V);else{if(G||Q.search(/[^ ]/)>=4||le.test(Q)||he.test(Q)||ae.test(Q))break;Z+=`
`+ee}!G&&!ee.trim()&&(G=!0),$+=te+`
`,_=_.substring(te.length+1),Q=ee.slice(V)}}ie.loose||(Y?ie.loose=!0:/\n *\n *$/.test($)&&(Y=!0)),this.options.gfm&&(j=/^\[[ xX]\] /.exec(Z),j&&(z=j[0]!=="[ ] ",Z=Z.replace(/^\[[ xX]\] +/,""))),ie.items.push({type:"list_item",raw:$,task:!!j,checked:z,loose:!1,text:Z}),ie.raw+=$}ie.items[ie.items.length-1].raw=$.trimRight(),ie.items[ie.items.length-1].text=Z.trimRight(),ie.raw=ie.raw.trimRight();const ue=ie.items.length;for(X=0;X<ue;X++)if(this.lexer.state.top=!1,ie.items[X].tokens=this.lexer.blockTokens(ie.items[X].text,[]),!ie.loose){const ce=ie.items[X].tokens.filter(le=>le.type==="space"),ae=ce.length>0&&ce.some(le=>/\n.*\n/.test(le.raw));ie.loose=ae}if(ie.loose)for(X=0;X<ue;X++)ie.items[X].loose=!0;return ie}}html(_){const M=this.rules.block.html.exec(_);if(M){const $={type:"html",raw:M[0],pre:!this.options.sanitizer&&(M[1]==="pre"||M[1]==="script"||M[1]==="style"),text:M[0]};if(this.options.sanitize){const j=this.options.sanitizer?this.options.sanitizer(M[0]):escape$1(M[0]);$.type="paragraph",$.text=j,$.tokens=this.lexer.inline(j)}return $}}def(_){const M=this.rules.block.def.exec(_);if(M){const $=M[1].toLowerCase().replace(/\s+/g," "),j=M[2]?M[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",z=M[3]?M[3].substring(1,M[3].length-1).replace(this.rules.inline._escapes,"$1"):M[3];return{type:"def",tag:$,raw:M[0],href:j,title:z}}}table(_){const M=this.rules.block.table.exec(_);if(M){const $={type:"table",header:splitCells(M[1]).map(j=>({text:j})),align:M[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:M[3]&&M[3].trim()?M[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if($.header.length===$.align.length){$.raw=M[0];let j=$.align.length,z,V,X,G;for(z=0;z<j;z++)/^ *-+: *$/.test($.align[z])?$.align[z]="right":/^ *:-+: *$/.test($.align[z])?$.align[z]="center":/^ *:-+ *$/.test($.align[z])?$.align[z]="left":$.align[z]=null;for(j=$.rows.length,z=0;z<j;z++)$.rows[z]=splitCells($.rows[z],$.header.length).map(Y=>({text:Y}));for(j=$.header.length,V=0;V<j;V++)$.header[V].tokens=this.lexer.inline($.header[V].text);for(j=$.rows.length,V=0;V<j;V++)for(G=$.rows[V],X=0;X<G.length;X++)G[X].tokens=this.lexer.inline(G[X].text);return $}}}lheading(_){const M=this.rules.block.lheading.exec(_);if(M)return{type:"heading",raw:M[0],depth:M[2].charAt(0)==="="?1:2,text:M[1],tokens:this.lexer.inline(M[1])}}paragraph(_){const M=this.rules.block.paragraph.exec(_);if(M){const $=M[1].charAt(M[1].length-1)===`
`?M[1].slice(0,-1):M[1];return{type:"paragraph",raw:M[0],text:$,tokens:this.lexer.inline($)}}}text(_){const M=this.rules.block.text.exec(_);if(M)return{type:"text",raw:M[0],text:M[0],tokens:this.lexer.inline(M[0])}}escape(_){const M=this.rules.inline.escape.exec(_);if(M)return{type:"escape",raw:M[0],text:escape$1(M[1])}}tag(_){const M=this.rules.inline.tag.exec(_);if(M)return!this.lexer.state.inLink&&/^<a /i.test(M[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(M[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(M[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(M[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:M[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(M[0]):escape$1(M[0]):M[0]}}link(_){const M=this.rules.inline.link.exec(_);if(M){const $=M[2].trim();if(!this.options.pedantic&&/^</.test($)){if(!/>$/.test($))return;const V=rtrim($.slice(0,-1),"\\");if(($.length-V.length)%2===0)return}else{const V=findClosingBracket(M[2],"()");if(V>-1){const G=(M[0].indexOf("!")===0?5:4)+M[1].length+V;M[2]=M[2].substring(0,V),M[0]=M[0].substring(0,G).trim(),M[3]=""}}let j=M[2],z="";if(this.options.pedantic){const V=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(j);V&&(j=V[1],z=V[3])}else z=M[3]?M[3].slice(1,-1):"";return j=j.trim(),/^</.test(j)&&(this.options.pedantic&&!/>$/.test($)?j=j.slice(1):j=j.slice(1,-1)),outputLink(M,{href:j&&j.replace(this.rules.inline._escapes,"$1"),title:z&&z.replace(this.rules.inline._escapes,"$1")},M[0],this.lexer)}}reflink(_,M){let $;if(($=this.rules.inline.reflink.exec(_))||($=this.rules.inline.nolink.exec(_))){let j=($[2]||$[1]).replace(/\s+/g," ");if(j=M[j.toLowerCase()],!j){const z=$[0].charAt(0);return{type:"text",raw:z,text:z}}return outputLink($,j,$[0],this.lexer)}}emStrong(_,M,$=""){let j=this.rules.inline.emStrong.lDelim.exec(_);if(!j||j[3]&&$.match(/[\p{L}\p{N}]/u))return;const z=j[1]||j[2]||"";if(!z||z&&($===""||this.rules.inline.punctuation.exec($))){const V=j[0].length-1;let X,G,Y=V,Q=0;const ee=j[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(ee.lastIndex=0,M=M.slice(-1*_.length+V);(j=ee.exec(M))!=null;){if(X=j[1]||j[2]||j[3]||j[4]||j[5]||j[6],!X)continue;if(G=X.length,j[3]||j[4]){Y+=G;continue}else if((j[5]||j[6])&&V%3&&!((V+G)%3)){Q+=G;continue}if(Y-=G,Y>0)continue;G=Math.min(G,G+Y+Q);const te=_.slice(0,V+j.index+(j[0].length-X.length)+G);if(Math.min(V,G)%2){const ne=te.slice(1,-1);return{type:"em",raw:te,text:ne,tokens:this.lexer.inlineTokens(ne)}}const Z=te.slice(2,-2);return{type:"strong",raw:te,text:Z,tokens:this.lexer.inlineTokens(Z)}}}}codespan(_){const M=this.rules.inline.code.exec(_);if(M){let $=M[2].replace(/\n/g," ");const j=/[^ ]/.test($),z=/^ /.test($)&&/ $/.test($);return j&&z&&($=$.substring(1,$.length-1)),$=escape$1($,!0),{type:"codespan",raw:M[0],text:$}}}br(_){const M=this.rules.inline.br.exec(_);if(M)return{type:"br",raw:M[0]}}del(_){const M=this.rules.inline.del.exec(_);if(M)return{type:"del",raw:M[0],text:M[2],tokens:this.lexer.inlineTokens(M[2])}}autolink(_,M){const $=this.rules.inline.autolink.exec(_);if($){let j,z;return $[2]==="@"?(j=escape$1(this.options.mangle?M($[1]):$[1]),z="mailto:"+j):(j=escape$1($[1]),z=j),{type:"link",raw:$[0],text:j,href:z,tokens:[{type:"text",raw:j,text:j}]}}}url(_,M){let $;if($=this.rules.inline.url.exec(_)){let j,z;if($[2]==="@")j=escape$1(this.options.mangle?M($[0]):$[0]),z="mailto:"+j;else{let V;do V=$[0],$[0]=this.rules.inline._backpedal.exec($[0])[0];while(V!==$[0]);j=escape$1($[0]),$[1]==="www."?z="http://"+$[0]:z=$[0]}return{type:"link",raw:$[0],text:j,href:z,tokens:[{type:"text",raw:j,text:j}]}}}inlineText(_,M){const $=this.rules.inline.text.exec(_);if($){let j;return this.lexer.state.inRawBlock?j=this.options.sanitize?this.options.sanitizer?this.options.sanitizer($[0]):escape$1($[0]):$[0]:j=escape$1(this.options.smartypants?M($[0]):$[0]),{type:"text",raw:$[0],text:j}}}}const block={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:noopTest,lheading:/^((?:.|\n(?!\n))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};block._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;block._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;block.def=edit(block.def).replace("label",block._label).replace("title",block._title).getRegex();block.bullet=/(?:[*+-]|\d{1,9}[.)])/;block.listItemStart=edit(/^( *)(bull) */).replace("bull",block.bullet).getRegex();block.list=edit(block.list).replace(/bull/g,block.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+block.def.source+")").getRegex();block._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";block._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;block.html=edit(block.html,"i").replace("comment",block._comment).replace("tag",block._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();block.paragraph=edit(block._paragraph).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.blockquote=edit(block.blockquote).replace("paragraph",block.paragraph).getRegex();block.normal={...block};block.gfm={...block.normal,table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"};block.gfm.table=edit(block.gfm.table).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.gfm.paragraph=edit(block._paragraph).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",block.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.pedantic={...block.normal,html:edit(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",block._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:noopTest,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:edit(block.normal._paragraph).replace("hr",block.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",block.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()};const inline={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:noopTest,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^(?:[^_*\\]|\\.)*?\_\_(?:[^_*\\]|\\.)*?\*(?:[^_*\\]|\\.)*?(?=\_\_)|(?:[^*\\]|\\.)+(?=[^*])|[punct_](\*+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|(?:[^punct*_\s\\]|\\.)(\*+)(?=[^punct*_\s])/,rDelimUnd:/^(?:[^_*\\]|\\.)*?\*\*(?:[^_*\\]|\\.)*?\_(?:[^_*\\]|\\.)*?(?=\*\*)|(?:[^_\\]|\\.)+(?=[^_])|[punct*](\_+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:noopTest,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};inline._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~";inline.punctuation=edit(inline.punctuation).replace(/punctuation/g,inline._punctuation).getRegex();inline.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;inline.escapedEmSt=/(?:^|[^\\])(?:\\\\)*\\[*_]/g;inline._comment=edit(block._comment).replace("(?:-->|$)","-->").getRegex();inline.emStrong.lDelim=edit(inline.emStrong.lDelim).replace(/punct/g,inline._punctuation).getRegex();inline.emStrong.rDelimAst=edit(inline.emStrong.rDelimAst,"g").replace(/punct/g,inline._punctuation).getRegex();inline.emStrong.rDelimUnd=edit(inline.emStrong.rDelimUnd,"g").replace(/punct/g,inline._punctuation).getRegex();inline._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;inline._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;inline._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;inline.autolink=edit(inline.autolink).replace("scheme",inline._scheme).replace("email",inline._email).getRegex();inline._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;inline.tag=edit(inline.tag).replace("comment",inline._comment).replace("attribute",inline._attribute).getRegex();inline._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;inline._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;inline._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;inline.link=edit(inline.link).replace("label",inline._label).replace("href",inline._href).replace("title",inline._title).getRegex();inline.reflink=edit(inline.reflink).replace("label",inline._label).replace("ref",block._label).getRegex();inline.nolink=edit(inline.nolink).replace("ref",block._label).getRegex();inline.reflinkSearch=edit(inline.reflinkSearch,"g").replace("reflink",inline.reflink).replace("nolink",inline.nolink).getRegex();inline.normal={...inline};inline.pedantic={...inline.normal,strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:edit(/^!?\[(label)\]\((.*?)\)/).replace("label",inline._label).getRegex(),reflink:edit(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",inline._label).getRegex()};inline.gfm={...inline.normal,escape:edit(inline.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/};inline.gfm.url=edit(inline.gfm.url,"i").replace("email",inline.gfm._extended_email).getRegex();inline.breaks={...inline.gfm,br:edit(inline.br).replace("{2,}","*").getRegex(),text:edit(inline.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()};function smartypants(q){return q.replace(/---/g,"").replace(/--/g,"").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1").replace(/'/g,"").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1").replace(/"/g,"").replace(/\.{3}/g,"")}function mangle(q){let _="",M,$;const j=q.length;for(M=0;M<j;M++)$=q.charCodeAt(M),Math.random()>.5&&($="x"+$.toString(16)),_+="&#"+$+";";return _}class Lexer{constructor(_){this.tokens=[],this.tokens.links=Object.create(null),this.options=_||defaults,this.options.tokenizer=this.options.tokenizer||new Tokenizer,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const M={block:block.normal,inline:inline.normal};this.options.pedantic?(M.block=block.pedantic,M.inline=inline.pedantic):this.options.gfm&&(M.block=block.gfm,this.options.breaks?M.inline=inline.breaks:M.inline=inline.gfm),this.tokenizer.rules=M}static get rules(){return{block,inline}}static lex(_,M){return new Lexer(M).lex(_)}static lexInline(_,M){return new Lexer(M).inlineTokens(_)}lex(_){_=_.replace(/\r\n|\r/g,`
`),this.blockTokens(_,this.tokens);let M;for(;M=this.inlineQueue.shift();)this.inlineTokens(M.src,M.tokens);return this.tokens}blockTokens(_,M=[]){this.options.pedantic?_=_.replace(/\t/g,"    ").replace(/^ +$/gm,""):_=_.replace(/^( *)(\t+)/gm,(X,G,Y)=>G+"    ".repeat(Y.length));let $,j,z,V;for(;_;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(X=>($=X.call({lexer:this},_,M))?(_=_.substring($.raw.length),M.push($),!0):!1))){if($=this.tokenizer.space(_)){_=_.substring($.raw.length),$.raw.length===1&&M.length>0?M[M.length-1].raw+=`
`:M.push($);continue}if($=this.tokenizer.code(_)){_=_.substring($.raw.length),j=M[M.length-1],j&&(j.type==="paragraph"||j.type==="text")?(j.raw+=`
`+$.raw,j.text+=`
`+$.text,this.inlineQueue[this.inlineQueue.length-1].src=j.text):M.push($);continue}if($=this.tokenizer.fences(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.heading(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.hr(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.blockquote(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.list(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.html(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.def(_)){_=_.substring($.raw.length),j=M[M.length-1],j&&(j.type==="paragraph"||j.type==="text")?(j.raw+=`
`+$.raw,j.text+=`
`+$.raw,this.inlineQueue[this.inlineQueue.length-1].src=j.text):this.tokens.links[$.tag]||(this.tokens.links[$.tag]={href:$.href,title:$.title});continue}if($=this.tokenizer.table(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.lheading(_)){_=_.substring($.raw.length),M.push($);continue}if(z=_,this.options.extensions&&this.options.extensions.startBlock){let X=1/0;const G=_.slice(1);let Y;this.options.extensions.startBlock.forEach(function(Q){Y=Q.call({lexer:this},G),typeof Y=="number"&&Y>=0&&(X=Math.min(X,Y))}),X<1/0&&X>=0&&(z=_.substring(0,X+1))}if(this.state.top&&($=this.tokenizer.paragraph(z))){j=M[M.length-1],V&&j.type==="paragraph"?(j.raw+=`
`+$.raw,j.text+=`
`+$.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=j.text):M.push($),V=z.length!==_.length,_=_.substring($.raw.length);continue}if($=this.tokenizer.text(_)){_=_.substring($.raw.length),j=M[M.length-1],j&&j.type==="text"?(j.raw+=`
`+$.raw,j.text+=`
`+$.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=j.text):M.push($);continue}if(_){const X="Infinite loop on byte: "+_.charCodeAt(0);if(this.options.silent){console.error(X);break}else throw new Error(X)}}return this.state.top=!0,M}inline(_,M=[]){return this.inlineQueue.push({src:_,tokens:M}),M}inlineTokens(_,M=[]){let $,j,z,V=_,X,G,Y;if(this.tokens.links){const Q=Object.keys(this.tokens.links);if(Q.length>0)for(;(X=this.tokenizer.rules.inline.reflinkSearch.exec(V))!=null;)Q.includes(X[0].slice(X[0].lastIndexOf("[")+1,-1))&&(V=V.slice(0,X.index)+"["+repeatString("a",X[0].length-2)+"]"+V.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(X=this.tokenizer.rules.inline.blockSkip.exec(V))!=null;)V=V.slice(0,X.index)+"["+repeatString("a",X[0].length-2)+"]"+V.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(X=this.tokenizer.rules.inline.escapedEmSt.exec(V))!=null;)V=V.slice(0,X.index+X[0].length-2)+"++"+V.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex),this.tokenizer.rules.inline.escapedEmSt.lastIndex--;for(;_;)if(G||(Y=""),G=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(Q=>($=Q.call({lexer:this},_,M))?(_=_.substring($.raw.length),M.push($),!0):!1))){if($=this.tokenizer.escape(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.tag(_)){_=_.substring($.raw.length),j=M[M.length-1],j&&$.type==="text"&&j.type==="text"?(j.raw+=$.raw,j.text+=$.text):M.push($);continue}if($=this.tokenizer.link(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.reflink(_,this.tokens.links)){_=_.substring($.raw.length),j=M[M.length-1],j&&$.type==="text"&&j.type==="text"?(j.raw+=$.raw,j.text+=$.text):M.push($);continue}if($=this.tokenizer.emStrong(_,V,Y)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.codespan(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.br(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.del(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.autolink(_,mangle)){_=_.substring($.raw.length),M.push($);continue}if(!this.state.inLink&&($=this.tokenizer.url(_,mangle))){_=_.substring($.raw.length),M.push($);continue}if(z=_,this.options.extensions&&this.options.extensions.startInline){let Q=1/0;const ee=_.slice(1);let te;this.options.extensions.startInline.forEach(function(Z){te=Z.call({lexer:this},ee),typeof te=="number"&&te>=0&&(Q=Math.min(Q,te))}),Q<1/0&&Q>=0&&(z=_.substring(0,Q+1))}if($=this.tokenizer.inlineText(z,smartypants)){_=_.substring($.raw.length),$.raw.slice(-1)!=="_"&&(Y=$.raw.slice(-1)),G=!0,j=M[M.length-1],j&&j.type==="text"?(j.raw+=$.raw,j.text+=$.text):M.push($);continue}if(_){const Q="Infinite loop on byte: "+_.charCodeAt(0);if(this.options.silent){console.error(Q);break}else throw new Error(Q)}}return M}}class Renderer{constructor(_){this.options=_||defaults}code(_,M,$){const j=(M||"").match(/\S*/)[0];if(this.options.highlight){const z=this.options.highlight(_,j);z!=null&&z!==_&&($=!0,_=z)}return _=_.replace(/\n$/,"")+`
`,j?'<pre><code class="'+this.options.langPrefix+escape$1(j)+'">'+($?_:escape$1(_,!0))+`</code></pre>
`:"<pre><code>"+($?_:escape$1(_,!0))+`</code></pre>
`}blockquote(_){return`<blockquote>
${_}</blockquote>
`}html(_){return _}heading(_,M,$,j){if(this.options.headerIds){const z=this.options.headerPrefix+j.slug($);return`<h${M} id="${z}">${_}</h${M}>
`}return`<h${M}>${_}</h${M}>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(_,M,$){const j=M?"ol":"ul",z=M&&$!==1?' start="'+$+'"':"";return"<"+j+z+`>
`+_+"</"+j+`>
`}listitem(_){return`<li>${_}</li>
`}checkbox(_){return"<input "+(_?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(_){return`<p>${_}</p>
`}table(_,M){return M&&(M=`<tbody>${M}</tbody>`),`<table>
<thead>
`+_+`</thead>
`+M+`</table>
`}tablerow(_){return`<tr>
${_}</tr>
`}tablecell(_,M){const $=M.header?"th":"td";return(M.align?`<${$} align="${M.align}">`:`<${$}>`)+_+`</${$}>
`}strong(_){return`<strong>${_}</strong>`}em(_){return`<em>${_}</em>`}codespan(_){return`<code>${_}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(_){return`<del>${_}</del>`}link(_,M,$){if(_=cleanUrl(this.options.sanitize,this.options.baseUrl,_),_===null)return $;let j='<a href="'+_+'"';return M&&(j+=' title="'+M+'"'),j+=">"+$+"</a>",j}image(_,M,$){if(_=cleanUrl(this.options.sanitize,this.options.baseUrl,_),_===null)return $;let j=`<img src="${_}" alt="${$}"`;return M&&(j+=` title="${M}"`),j+=this.options.xhtml?"/>":">",j}text(_){return _}}class TextRenderer{strong(_){return _}em(_){return _}codespan(_){return _}del(_){return _}html(_){return _}text(_){return _}link(_,M,$){return""+$}image(_,M,$){return""+$}br(){return""}}class Slugger{constructor(){this.seen={}}serialize(_){return _.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(_,M){let $=_,j=0;if(this.seen.hasOwnProperty($)){j=this.seen[_];do j++,$=_+"-"+j;while(this.seen.hasOwnProperty($))}return M||(this.seen[_]=j,this.seen[$]=0),$}slug(_,M={}){const $=this.serialize(_);return this.getNextSafeSlug($,M.dryrun)}}class Parser{constructor(_){this.options=_||defaults,this.options.renderer=this.options.renderer||new Renderer,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new TextRenderer,this.slugger=new Slugger}static parse(_,M){return new Parser(M).parse(_)}static parseInline(_,M){return new Parser(M).parseInline(_)}parse(_,M=!0){let $="",j,z,V,X,G,Y,Q,ee,te,Z,ne,re,se,ie,oe,ue,ce,ae,le;const he=_.length;for(j=0;j<he;j++){if(Z=_[j],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[Z.type]&&(le=this.options.extensions.renderers[Z.type].call({parser:this},Z),le!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(Z.type))){$+=le||"";continue}switch(Z.type){case"space":continue;case"hr":{$+=this.renderer.hr();continue}case"heading":{$+=this.renderer.heading(this.parseInline(Z.tokens),Z.depth,unescape$1(this.parseInline(Z.tokens,this.textRenderer)),this.slugger);continue}case"code":{$+=this.renderer.code(Z.text,Z.lang,Z.escaped);continue}case"table":{for(ee="",Q="",X=Z.header.length,z=0;z<X;z++)Q+=this.renderer.tablecell(this.parseInline(Z.header[z].tokens),{header:!0,align:Z.align[z]});for(ee+=this.renderer.tablerow(Q),te="",X=Z.rows.length,z=0;z<X;z++){for(Y=Z.rows[z],Q="",G=Y.length,V=0;V<G;V++)Q+=this.renderer.tablecell(this.parseInline(Y[V].tokens),{header:!1,align:Z.align[V]});te+=this.renderer.tablerow(Q)}$+=this.renderer.table(ee,te);continue}case"blockquote":{te=this.parse(Z.tokens),$+=this.renderer.blockquote(te);continue}case"list":{for(ne=Z.ordered,re=Z.start,se=Z.loose,X=Z.items.length,te="",z=0;z<X;z++)oe=Z.items[z],ue=oe.checked,ce=oe.task,ie="",oe.task&&(ae=this.renderer.checkbox(ue),se?oe.tokens.length>0&&oe.tokens[0].type==="paragraph"?(oe.tokens[0].text=ae+" "+oe.tokens[0].text,oe.tokens[0].tokens&&oe.tokens[0].tokens.length>0&&oe.tokens[0].tokens[0].type==="text"&&(oe.tokens[0].tokens[0].text=ae+" "+oe.tokens[0].tokens[0].text)):oe.tokens.unshift({type:"text",text:ae}):ie+=ae),ie+=this.parse(oe.tokens,se),te+=this.renderer.listitem(ie,ce,ue);$+=this.renderer.list(te,ne,re);continue}case"html":{$+=this.renderer.html(Z.text);continue}case"paragraph":{$+=this.renderer.paragraph(this.parseInline(Z.tokens));continue}case"text":{for(te=Z.tokens?this.parseInline(Z.tokens):Z.text;j+1<he&&_[j+1].type==="text";)Z=_[++j],te+=`
`+(Z.tokens?this.parseInline(Z.tokens):Z.text);$+=M?this.renderer.paragraph(te):te;continue}default:{const ge='Token with "'+Z.type+'" type was not found.';if(this.options.silent){console.error(ge);return}else throw new Error(ge)}}}return $}parseInline(_,M){M=M||this.renderer;let $="",j,z,V;const X=_.length;for(j=0;j<X;j++){if(z=_[j],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[z.type]&&(V=this.options.extensions.renderers[z.type].call({parser:this},z),V!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(z.type))){$+=V||"";continue}switch(z.type){case"escape":{$+=M.text(z.text);break}case"html":{$+=M.html(z.text);break}case"link":{$+=M.link(z.href,z.title,this.parseInline(z.tokens,M));break}case"image":{$+=M.image(z.href,z.title,z.text);break}case"strong":{$+=M.strong(this.parseInline(z.tokens,M));break}case"em":{$+=M.em(this.parseInline(z.tokens,M));break}case"codespan":{$+=M.codespan(z.text);break}case"br":{$+=M.br();break}case"del":{$+=M.del(this.parseInline(z.tokens,M));break}case"text":{$+=M.text(z.text);break}default:{const G='Token with "'+z.type+'" type was not found.';if(this.options.silent){console.error(G);return}else throw new Error(G)}}}return $}}class Hooks{constructor(_){this.options=_||defaults}preprocess(_){return _}postprocess(_){return _}}$t(Hooks,"passThroughHooks",new Set(["preprocess","postprocess"]));function onError(q,_,M){return $=>{if($.message+=`
Please report this to https://github.com/markedjs/marked.`,q){const j="<p>An error occurred:</p><pre>"+escape$1($.message+"",!0)+"</pre>";if(_)return Promise.resolve(j);if(M){M(null,j);return}return j}if(_)return Promise.reject($);if(M){M($);return}throw $}}function parseMarkdown(q,_){return(M,$,j)=>{typeof $=="function"&&(j=$,$=null);const z={...$};$={...marked.defaults,...z};const V=onError($.silent,$.async,j);if(typeof M>"u"||M===null)return V(new Error("marked(): input parameter is undefined or null"));if(typeof M!="string")return V(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(M)+", string expected"));if(checkSanitizeDeprecation($),$.hooks&&($.hooks.options=$),j){const X=$.highlight;let G;try{$.hooks&&(M=$.hooks.preprocess(M)),G=q(M,$)}catch(ee){return V(ee)}const Y=function(ee){let te;if(!ee)try{$.walkTokens&&marked.walkTokens(G,$.walkTokens),te=_(G,$),$.hooks&&(te=$.hooks.postprocess(te))}catch(Z){ee=Z}return $.highlight=X,ee?V(ee):j(null,te)};if(!X||X.length<3||(delete $.highlight,!G.length))return Y();let Q=0;marked.walkTokens(G,function(ee){ee.type==="code"&&(Q++,setTimeout(()=>{X(ee.text,ee.lang,function(te,Z){if(te)return Y(te);Z!=null&&Z!==ee.text&&(ee.text=Z,ee.escaped=!0),Q--,Q===0&&Y()})},0))}),Q===0&&Y();return}if($.async)return Promise.resolve($.hooks?$.hooks.preprocess(M):M).then(X=>q(X,$)).then(X=>$.walkTokens?Promise.all(marked.walkTokens(X,$.walkTokens)).then(()=>X):X).then(X=>_(X,$)).then(X=>$.hooks?$.hooks.postprocess(X):X).catch(V);try{$.hooks&&(M=$.hooks.preprocess(M));const X=q(M,$);$.walkTokens&&marked.walkTokens(X,$.walkTokens);let G=_(X,$);return $.hooks&&(G=$.hooks.postprocess(G)),G}catch(X){return V(X)}}}function marked(q,_,M){return parseMarkdown(Lexer.lex,Parser.parse)(q,_,M)}marked.options=marked.setOptions=function(q){return marked.defaults={...marked.defaults,...q},changeDefaults(marked.defaults),marked};marked.getDefaults=getDefaults;marked.defaults=defaults;marked.use=function(...q){const _=marked.defaults.extensions||{renderers:{},childTokens:{}};q.forEach(M=>{const $={...M};if($.async=marked.defaults.async||$.async||!1,M.extensions&&(M.extensions.forEach(j=>{if(!j.name)throw new Error("extension name required");if(j.renderer){const z=_.renderers[j.name];z?_.renderers[j.name]=function(...V){let X=j.renderer.apply(this,V);return X===!1&&(X=z.apply(this,V)),X}:_.renderers[j.name]=j.renderer}if(j.tokenizer){if(!j.level||j.level!=="block"&&j.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");_[j.level]?_[j.level].unshift(j.tokenizer):_[j.level]=[j.tokenizer],j.start&&(j.level==="block"?_.startBlock?_.startBlock.push(j.start):_.startBlock=[j.start]:j.level==="inline"&&(_.startInline?_.startInline.push(j.start):_.startInline=[j.start]))}j.childTokens&&(_.childTokens[j.name]=j.childTokens)}),$.extensions=_),M.renderer){const j=marked.defaults.renderer||new Renderer;for(const z in M.renderer){const V=j[z];j[z]=(...X)=>{let G=M.renderer[z].apply(j,X);return G===!1&&(G=V.apply(j,X)),G}}$.renderer=j}if(M.tokenizer){const j=marked.defaults.tokenizer||new Tokenizer;for(const z in M.tokenizer){const V=j[z];j[z]=(...X)=>{let G=M.tokenizer[z].apply(j,X);return G===!1&&(G=V.apply(j,X)),G}}$.tokenizer=j}if(M.hooks){const j=marked.defaults.hooks||new Hooks;for(const z in M.hooks){const V=j[z];Hooks.passThroughHooks.has(z)?j[z]=X=>{if(marked.defaults.async)return Promise.resolve(M.hooks[z].call(j,X)).then(Y=>V.call(j,Y));const G=M.hooks[z].call(j,X);return V.call(j,G)}:j[z]=(...X)=>{let G=M.hooks[z].apply(j,X);return G===!1&&(G=V.apply(j,X)),G}}$.hooks=j}if(M.walkTokens){const j=marked.defaults.walkTokens;$.walkTokens=function(z){let V=[];return V.push(M.walkTokens.call(this,z)),j&&(V=V.concat(j.call(this,z))),V}}marked.setOptions($)})};marked.walkTokens=function(q,_){let M=[];for(const $ of q)switch(M=M.concat(_.call(marked,$)),$.type){case"table":{for(const j of $.header)M=M.concat(marked.walkTokens(j.tokens,_));for(const j of $.rows)for(const z of j)M=M.concat(marked.walkTokens(z.tokens,_));break}case"list":{M=M.concat(marked.walkTokens($.items,_));break}default:marked.defaults.extensions&&marked.defaults.extensions.childTokens&&marked.defaults.extensions.childTokens[$.type]?marked.defaults.extensions.childTokens[$.type].forEach(function(j){M=M.concat(marked.walkTokens($[j],_))}):$.tokens&&(M=M.concat(marked.walkTokens($.tokens,_)))}return M};marked.parseInline=parseMarkdown(Lexer.lexInline,Parser.parseInline);marked.Parser=Parser;marked.parser=Parser.parse;marked.Renderer=Renderer;marked.TextRenderer=TextRenderer;marked.Lexer=Lexer;marked.lexer=Lexer.lex;marked.Tokenizer=Tokenizer;marked.Slugger=Slugger;marked.Hooks=Hooks;marked.parse=marked;marked.options;marked.setOptions;marked.use;marked.walkTokens;marked.parseInline;Parser.parse;Lexer.lex;const key={};function create_else_block$b(q){let _;return{c(){_=text(q[1])},m(M,$){insert(M,_,$)},p(M,$){$&2&&set_data(_,M[1])},i:noop,o:noop,d(M){M&&detach(_)}}}function create_if_block_5$4(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h6"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block_4$7(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h5"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block_3$b(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h4"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block_2$f(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h3"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block_1$i(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h2"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block$u(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h1"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_fragment$W(q){let _,M,$,j;const z=[create_if_block$u,create_if_block_1$i,create_if_block_2$f,create_if_block_3$b,create_if_block_4$7,create_if_block_5$4,create_else_block$b],V=[];function X(G,Y){return G[0]===1?0:G[0]===2?1:G[0]===3?2:G[0]===4?3:G[0]===5?4:G[0]===6?5:6}return _=X(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(G,Y){V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,[Y]){let Q=_;_=X(G),_===Q?V[_].p(G,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){V[_].d(G),G&&detach($)}}}function instance$Q(q,_,M){let $,{$$slots:j={},$$scope:z}=_,{depth:V}=_,{raw:X}=_,{text:G}=_;const{slug:Y,getOptions:Q}=getContext(key),ee=Q();return q.$$set=te=>{"depth"in te&&M(0,V=te.depth),"raw"in te&&M(1,X=te.raw),"text"in te&&M(3,G=te.text),"$$scope"in te&&M(4,z=te.$$scope)},q.$$.update=()=>{q.$$.dirty&8&&M(2,$=ee.headerIds?ee.headerPrefix+Y(G):void 0)},[V,X,$,G,z,j]}class Heading extends SvelteComponent{constructor(_){super(),init(this,_,instance$Q,create_fragment$W,safe_not_equal,{depth:0,raw:1,text:3})}}function create_fragment$V(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("p"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$P(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Paragraph extends SvelteComponent{constructor(_){super(),init(this,_,instance$P,create_fragment$V,safe_not_equal,{})}}function create_fragment$U(q){let _;const M=q[3].default,$=create_slot(M,q,q[2],null);return{c(){$&&$.c()},m(j,z){$&&$.m(j,z),_=!0},p(j,[z]){$&&$.p&&(!_||z&4)&&update_slot_base($,M,j,j[2],_?get_slot_changes(M,j[2],z,null):get_all_dirty_from_scope(j[2]),null)},i(j){_||(transition_in($,j),_=!0)},o(j){transition_out($,j),_=!1},d(j){$&&$.d(j)}}}function instance$O(q,_,M){let{$$slots:$={},$$scope:j}=_,{text:z}=_,{raw:V}=_;return q.$$set=X=>{"text"in X&&M(0,z=X.text),"raw"in X&&M(1,V=X.raw),"$$scope"in X&&M(2,j=X.$$scope)},[z,V,j,$]}class Text extends SvelteComponent{constructor(_){super(),init(this,_,instance$O,create_fragment$U,safe_not_equal,{text:0,raw:1})}}function create_fragment$T(q){let _,M;return{c(){_=element("img"),src_url_equal(_.src,M=q[0])||attr(_,"src",M),attr(_,"title",q[1]),attr(_,"alt",q[2])},m($,j){insert($,_,j)},p($,[j]){j&1&&!src_url_equal(_.src,M=$[0])&&attr(_,"src",M),j&2&&attr(_,"title",$[1]),j&4&&attr(_,"alt",$[2])},i:noop,o:noop,d($){$&&detach(_)}}}function instance$N(q,_,M){let{href:$=""}=_,{title:j=void 0}=_,{text:z=""}=_;return q.$$set=V=>{"href"in V&&M(0,$=V.href),"title"in V&&M(1,j=V.title),"text"in V&&M(2,z=V.text)},[$,j,z]}let Image$1=class extends SvelteComponent{constructor(_){super(),init(this,_,instance$N,create_fragment$T,safe_not_equal,{href:0,title:1,text:2})}};function create_fragment$S(q){let _,M;const $=q[3].default,j=create_slot($,q,q[2],null);return{c(){_=element("a"),j&&j.c(),attr(_,"href",q[0]),attr(_,"title",q[1])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&4)&&update_slot_base(j,$,z,z[2],M?get_slot_changes($,z[2],V,null):get_all_dirty_from_scope(z[2]),null),(!M||V&1)&&attr(_,"href",z[0]),(!M||V&2)&&attr(_,"title",z[1])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$M(q,_,M){let{$$slots:$={},$$scope:j}=_,{href:z=""}=_,{title:V=void 0}=_;return q.$$set=X=>{"href"in X&&M(0,z=X.href),"title"in X&&M(1,V=X.title),"$$scope"in X&&M(2,j=X.$$scope)},[z,V,j,$]}class Link extends SvelteComponent{constructor(_){super(),init(this,_,instance$M,create_fragment$S,safe_not_equal,{href:0,title:1})}}function create_fragment$R(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("em"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$L(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Em extends SvelteComponent{constructor(_){super(),init(this,_,instance$L,create_fragment$R,safe_not_equal,{})}}function create_fragment$Q(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("del"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$K(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Del extends SvelteComponent{constructor(_){super(),init(this,_,instance$K,create_fragment$Q,safe_not_equal,{})}}function create_fragment$P(q){let _,M=q[0].replace(/`/g,"")+"",$;return{c(){_=element("code"),$=text(M)},m(j,z){insert(j,_,z),append(_,$)},p(j,[z]){z&1&&M!==(M=j[0].replace(/`/g,"")+"")&&set_data($,M)},i:noop,o:noop,d(j){j&&detach(_)}}}function instance$J(q,_,M){let{raw:$}=_;return q.$$set=j=>{"raw"in j&&M(0,$=j.raw)},[$]}class Codespan extends SvelteComponent{constructor(_){super(),init(this,_,instance$J,create_fragment$P,safe_not_equal,{raw:0})}}function create_fragment$O(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("strong"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$I(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Strong extends SvelteComponent{constructor(_){super(),init(this,_,instance$I,create_fragment$O,safe_not_equal,{})}}function create_fragment$N(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("table"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$H(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Table extends SvelteComponent{constructor(_){super(),init(this,_,instance$H,create_fragment$N,safe_not_equal,{})}}function create_fragment$M(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("thead"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$G(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class TableHead extends SvelteComponent{constructor(_){super(),init(this,_,instance$G,create_fragment$M,safe_not_equal,{})}}function create_fragment$L(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("tbody"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$F(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class TableBody extends SvelteComponent{constructor(_){super(),init(this,_,instance$F,create_fragment$L,safe_not_equal,{})}}function create_fragment$K(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("tr"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$E(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class TableRow extends SvelteComponent{constructor(_){super(),init(this,_,instance$E,create_fragment$K,safe_not_equal,{})}}function create_else_block$a(q){let _,M;const $=q[3].default,j=create_slot($,q,q[2],null);return{c(){_=element("td"),j&&j.c(),attr(_,"align",q[1])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&4)&&update_slot_base(j,$,z,z[2],M?get_slot_changes($,z[2],V,null):get_all_dirty_from_scope(z[2]),null),(!M||V&2)&&attr(_,"align",z[1])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block$t(q){let _,M;const $=q[3].default,j=create_slot($,q,q[2],null);return{c(){_=element("th"),j&&j.c(),attr(_,"align",q[1])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&4)&&update_slot_base(j,$,z,z[2],M?get_slot_changes($,z[2],V,null):get_all_dirty_from_scope(z[2]),null),(!M||V&2)&&attr(_,"align",z[1])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_fragment$J(q){let _,M,$,j;const z=[create_if_block$t,create_else_block$a],V=[];function X(G,Y){return G[0]?0:1}return _=X(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(G,Y){V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,[Y]){let Q=_;_=X(G),_===Q?V[_].p(G,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){V[_].d(G),G&&detach($)}}}function instance$D(q,_,M){let{$$slots:$={},$$scope:j}=_,{header:z}=_,{align:V}=_;return q.$$set=X=>{"header"in X&&M(0,z=X.header),"align"in X&&M(1,V=X.align),"$$scope"in X&&M(2,j=X.$$scope)},[z,V,j,$]}class TableCell extends SvelteComponent{constructor(_){super(),init(this,_,instance$D,create_fragment$J,safe_not_equal,{header:0,align:1})}}function create_else_block$9(q){let _,M;const $=q[3].default,j=create_slot($,q,q[2],null);return{c(){_=element("ul"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&4)&&update_slot_base(j,$,z,z[2],M?get_slot_changes($,z[2],V,null):get_all_dirty_from_scope(z[2]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block$s(q){let _,M;const $=q[3].default,j=create_slot($,q,q[2],null);return{c(){_=element("ol"),j&&j.c(),attr(_,"start",q[1])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&4)&&update_slot_base(j,$,z,z[2],M?get_slot_changes($,z[2],V,null):get_all_dirty_from_scope(z[2]),null),(!M||V&2)&&attr(_,"start",z[1])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_fragment$I(q){let _,M,$,j;const z=[create_if_block$s,create_else_block$9],V=[];function X(G,Y){return G[0]?0:1}return _=X(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(G,Y){V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,[Y]){let Q=_;_=X(G),_===Q?V[_].p(G,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){V[_].d(G),G&&detach($)}}}function instance$C(q,_,M){let{$$slots:$={},$$scope:j}=_,{ordered:z}=_,{start:V}=_;return q.$$set=X=>{"ordered"in X&&M(0,z=X.ordered),"start"in X&&M(1,V=X.start),"$$scope"in X&&M(2,j=X.$$scope)},[z,V,j,$]}class List extends SvelteComponent{constructor(_){super(),init(this,_,instance$C,create_fragment$I,safe_not_equal,{ordered:0,start:1})}}function create_fragment$H(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("li"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$B(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class ListItem extends SvelteComponent{constructor(_){super(),init(this,_,instance$B,create_fragment$H,safe_not_equal,{})}}function create_fragment$G(q){let _;return{c(){_=element("hr")},m(M,$){insert(M,_,$)},p:noop,i:noop,o:noop,d(M){M&&detach(_)}}}class Hr extends SvelteComponent{constructor(_){super(),init(this,_,null,create_fragment$G,safe_not_equal,{})}}function create_fragment$F(q){let _,M;return{c(){_=new HtmlTag(!1),M=empty(),_.a=M},m($,j){_.m(q[0],$,j),insert($,M,j)},p($,[j]){j&1&&_.p($[0])},i:noop,o:noop,d($){$&&detach(M),$&&_.d()}}}function instance$A(q,_,M){let{text:$}=_;return q.$$set=j=>{"text"in j&&M(0,$=j.text)},[$]}class Html extends SvelteComponent{constructor(_){super(),init(this,_,instance$A,create_fragment$F,safe_not_equal,{text:0})}}function create_fragment$E(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("blockquote"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$z(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Blockquote extends SvelteComponent{constructor(_){super(),init(this,_,instance$z,create_fragment$E,safe_not_equal,{})}}function create_fragment$D(q){let _,M,$;return{c(){_=element("pre"),M=element("code"),$=text(q[1]),attr(_,"class",q[0])},m(j,z){insert(j,_,z),append(_,M),append(M,$)},p(j,[z]){z&2&&set_data($,j[1]),z&1&&attr(_,"class",j[0])},i:noop,o:noop,d(j){j&&detach(_)}}}function instance$y(q,_,M){let{lang:$}=_,{text:j}=_;return q.$$set=z=>{"lang"in z&&M(0,$=z.lang),"text"in z&&M(1,j=z.text)},[$,j]}class Code extends SvelteComponent{constructor(_){super(),init(this,_,instance$y,create_fragment$D,safe_not_equal,{lang:0,text:1})}}function create_fragment$C(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("br"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(z,V),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$x(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Br extends SvelteComponent{constructor(_){super(),init(this,_,instance$x,create_fragment$C,safe_not_equal,{})}}const defaultRenderers={heading:Heading,paragraph:Paragraph,text:Text,image:Image$1,link:Link,em:Em,strong:Strong,codespan:Codespan,del:Del,table:Table,tablehead:TableHead,tablebody:TableBody,tablerow:TableRow,tablecell:TableCell,list:List,orderedlistitem:null,unorderedlistitem:null,listitem:ListItem,hr:Hr,html:Html,blockquote:Blockquote,code:Code,br:Br},defaultOptions={baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,xhtml:!1};function create_fragment$B(q){let _,M;return _=new Parser$1({props:{tokens:q[0],renderers:q[1]}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,[j]){const z={};j&1&&(z.tokens=$[0]),j&2&&(z.renderers=$[1]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function instance$w(q,_,M){let $,j,z,V,{source:X=[]}=_,{renderers:G={}}=_,{options:Y={}}=_,{isInline:Q=!1}=_;const ee=createEventDispatcher();let te,Z,ne;return setContext(key,{slug:re=>j?j.slug(re):"",getOptions:()=>z}),onMount(()=>{M(7,ne=!0)}),q.$$set=re=>{"source"in re&&M(2,X=re.source),"renderers"in re&&M(3,G=re.renderers),"options"in re&&M(4,Y=re.options),"isInline"in re&&M(5,Q=re.isInline)},q.$$.update=()=>{q.$$.dirty&4&&M(8,$=Array.isArray(X)),q.$$.dirty&4&&(j=X?new Slugger:void 0),q.$$.dirty&16&&M(9,z={...defaultOptions,...Y}),q.$$.dirty&869&&($?M(0,te=X):(M(6,Z=new Lexer(z)),M(0,te=Q?Z.inlineTokens(X):Z.lex(X)),ee("parsed",{tokens:te}))),q.$$.dirty&8&&M(1,V={...defaultRenderers,...G}),q.$$.dirty&385&&ne&&!$&&ee("parsed",{tokens:te})},[te,V,X,G,Y,Q,Z,ne,$,z]}class SvelteMarkdown extends SvelteComponent{constructor(_){super(),init(this,_,instance$w,create_fragment$B,safe_not_equal,{source:2,renderers:3,options:4,isInline:5})}}function commonjsRequire(q){throw new Error('Could not dynamically require "'+q+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};(function(module,exports){(function(_,M){module.exports=M()})(globalThis,()=>(()=>{var __webpack_modules__=[,(q,_)=>{var At;Object.defineProperty(_,"__esModule",{value:!0}),_.VerbosityLevel=_.Util=_.UnknownErrorException=_.UnexpectedResponseException=_.TextRenderingMode=_.RenderingIntentFlag=_.PromiseCapability=_.PermissionFlag=_.PasswordResponses=_.PasswordException=_.PageActionEventType=_.OPS=_.MissingPDFException=_.MAX_IMAGE_SIZE_TO_CACHE=_.LINE_FACTOR=_.LINE_DESCENT_FACTOR=_.InvalidPDFException=_.ImageKind=_.IDENTITY_MATRIX=_.FormatError=_.FeatureTest=_.FONT_IDENTITY_MATRIX=_.DocumentActionEventType=_.CMapCompressionType=_.BaseException=_.BASELINE_FACTOR=_.AnnotationType=_.AnnotationReplyType=_.AnnotationMode=_.AnnotationFlag=_.AnnotationFieldFlag=_.AnnotationEditorType=_.AnnotationEditorPrefix=_.AnnotationEditorParamsType=_.AnnotationBorderStyleType=_.AnnotationActionEventType=_.AbortException=void 0,_.assert=Be,_.bytesToString=Ve,_.createValidAbsoluteUrl=ze,_.getModificationDate=mt,_.getUuid=Tt,_.getVerbosityLevel=Ae,_.info=Me,_.isArrayBuffer=et,_.isArrayEqual=ct,_.isNodeJS=void 0,_.normalizeUnicode=xt,_.objectFromMap=We,_.objectSize=me,_.setVerbosityLevel=fe,_.shadow=Oe,_.string32=lt,_.stringToBytes=ot,_.stringToPDFString=qe,_.stringToUTF8String=Ge,_.unreachable=Te,_.utf8StringToString=Ke,_.warn=Ee;const M=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");_.isNodeJS=M;const $=[1,0,0,1,0,0];_.IDENTITY_MATRIX=$;const j=[.001,0,0,.001,0,0];_.FONT_IDENTITY_MATRIX=j;const z=1e7;_.MAX_IMAGE_SIZE_TO_CACHE=z;const V=1.35;_.LINE_FACTOR=V;const X=.35;_.LINE_DESCENT_FACTOR=X;const G=X/V;_.BASELINE_FACTOR=G;const Y={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};_.RenderingIntentFlag=Y;const Q={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};_.AnnotationMode=Q;const ee="pdfjs_internal_editor_";_.AnnotationEditorPrefix=ee;const te={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};_.AnnotationEditorType=te;const Z={RESIZE:1,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};_.AnnotationEditorParamsType=Z;const ne={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};_.PermissionFlag=ne;const re={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};_.TextRenderingMode=re;const se={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};_.ImageKind=se;const ie={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};_.AnnotationType=ie;const oe={GROUP:"Group",REPLY:"R"};_.AnnotationReplyType=oe;const ue={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};_.AnnotationFlag=ue;const ce={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};_.AnnotationFieldFlag=ce;const ae={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};_.AnnotationBorderStyleType=ae;const le={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};_.AnnotationActionEventType=le;const he={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};_.DocumentActionEventType=he;const ge={O:"PageOpen",C:"PageClose"};_.PageActionEventType=ge;const de={ERRORS:0,WARNINGS:1,INFOS:5};_.VerbosityLevel=de;const pe={NONE:0,BINARY:1};_.CMapCompressionType=pe;const ye={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};_.OPS=ye;const _e={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};_.PasswordResponses=_e;let De=de.WARNINGS;function fe(nt){Number.isInteger(nt)&&(De=nt)}function Ae(){return De}function Me(nt){De>=de.INFOS&&console.log(`Info: ${nt}`)}function Ee(nt){De>=de.WARNINGS&&console.log(`Warning: ${nt}`)}function Te(nt){throw new Error(nt)}function Be(nt,it){nt||Te(it)}function Xe(nt){switch(nt==null?void 0:nt.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function ze(nt,it=null,rt=null){if(!nt)return null;try{if(rt&&typeof nt=="string"){if(rt.addDefaultProtocol&&nt.startsWith("www.")){const Pt=nt.match(/\./g);(Pt==null?void 0:Pt.length)>=2&&(nt=`http://${nt}`)}if(rt.tryConvertEncoding)try{nt=Ge(nt)}catch{}}const gt=it?new URL(nt,it):new URL(nt);if(Xe(gt))return gt}catch{}return null}function Oe(nt,it,rt,gt=!1){return Object.defineProperty(nt,it,{value:rt,enumerable:!gt,configurable:!0,writable:!1}),rt}const Pe=function(){function it(rt,gt){this.constructor===it&&Te("Cannot initialize BaseException."),this.message=rt,this.name=gt}return it.prototype=new Error,it.constructor=it,it}();_.BaseException=Pe;class ve extends Pe{constructor(it,rt){super(it,"PasswordException"),this.code=rt}}_.PasswordException=ve;class be extends Pe{constructor(it,rt){super(it,"UnknownErrorException"),this.details=rt}}_.UnknownErrorException=be;class Ce extends Pe{constructor(it){super(it,"InvalidPDFException")}}_.InvalidPDFException=Ce;class Ne extends Pe{constructor(it){super(it,"MissingPDFException")}}_.MissingPDFException=Ne;class Ie extends Pe{constructor(it,rt){super(it,"UnexpectedResponseException"),this.status=rt}}_.UnexpectedResponseException=Ie;class Le extends Pe{constructor(it){super(it,"FormatError")}}_.FormatError=Le;class je extends Pe{constructor(it){super(it,"AbortException")}}_.AbortException=je;function Ve(nt){(typeof nt!="object"||(nt==null?void 0:nt.length)===void 0)&&Te("Invalid argument for bytesToString");const it=nt.length,rt=8192;if(it<rt)return String.fromCharCode.apply(null,nt);const gt=[];for(let Pt=0;Pt<it;Pt+=rt){const St=Math.min(Pt+rt,it),Bt=nt.subarray(Pt,St);gt.push(String.fromCharCode.apply(null,Bt))}return gt.join("")}function ot(nt){typeof nt!="string"&&Te("Invalid argument for stringToBytes");const it=nt.length,rt=new Uint8Array(it);for(let gt=0;gt<it;++gt)rt[gt]=nt.charCodeAt(gt)&255;return rt}function lt(nt){return String.fromCharCode(nt>>24&255,nt>>16&255,nt>>8&255,nt&255)}function me(nt){return Object.keys(nt).length}function We(nt){const it=Object.create(null);for(const[rt,gt]of nt)it[rt]=gt;return it}function Ye(){const nt=new Uint8Array(4);return nt[0]=1,new Uint32Array(nt.buffer,0,1)[0]===1}function Fe(){try{return new Function(""),!0}catch{return!1}}class xe{static get isLittleEndian(){return Oe(this,"isLittleEndian",Ye())}static get isEvalSupported(){return Oe(this,"isEvalSupported",Fe())}static get isOffscreenCanvasSupported(){return Oe(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?Oe(this,"platform",{isWin:!1,isMac:!1}):Oe(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}}_.FeatureTest=xe;const $e=[...Array(256).keys()].map(nt=>nt.toString(16).padStart(2,"0"));class Je{static makeHexColor(it,rt,gt){return`#${$e[it]}${$e[rt]}${$e[gt]}`}static scaleMinMax(it,rt){let gt;it[0]?(it[0]<0&&(gt=rt[0],rt[0]=rt[1],rt[1]=gt),rt[0]*=it[0],rt[1]*=it[0],it[3]<0&&(gt=rt[2],rt[2]=rt[3],rt[3]=gt),rt[2]*=it[3],rt[3]*=it[3]):(gt=rt[0],rt[0]=rt[2],rt[2]=gt,gt=rt[1],rt[1]=rt[3],rt[3]=gt,it[1]<0&&(gt=rt[2],rt[2]=rt[3],rt[3]=gt),rt[2]*=it[1],rt[3]*=it[1],it[2]<0&&(gt=rt[0],rt[0]=rt[1],rt[1]=gt),rt[0]*=it[2],rt[1]*=it[2]),rt[0]+=it[4],rt[1]+=it[4],rt[2]+=it[5],rt[3]+=it[5]}static transform(it,rt){return[it[0]*rt[0]+it[2]*rt[1],it[1]*rt[0]+it[3]*rt[1],it[0]*rt[2]+it[2]*rt[3],it[1]*rt[2]+it[3]*rt[3],it[0]*rt[4]+it[2]*rt[5]+it[4],it[1]*rt[4]+it[3]*rt[5]+it[5]]}static applyTransform(it,rt){const gt=it[0]*rt[0]+it[1]*rt[2]+rt[4],Pt=it[0]*rt[1]+it[1]*rt[3]+rt[5];return[gt,Pt]}static applyInverseTransform(it,rt){const gt=rt[0]*rt[3]-rt[1]*rt[2],Pt=(it[0]*rt[3]-it[1]*rt[2]+rt[2]*rt[5]-rt[4]*rt[3])/gt,St=(-it[0]*rt[1]+it[1]*rt[0]+rt[4]*rt[1]-rt[5]*rt[0])/gt;return[Pt,St]}static getAxialAlignedBoundingBox(it,rt){const gt=this.applyTransform(it,rt),Pt=this.applyTransform(it.slice(2,4),rt),St=this.applyTransform([it[0],it[3]],rt),Bt=this.applyTransform([it[2],it[1]],rt);return[Math.min(gt[0],Pt[0],St[0],Bt[0]),Math.min(gt[1],Pt[1],St[1],Bt[1]),Math.max(gt[0],Pt[0],St[0],Bt[0]),Math.max(gt[1],Pt[1],St[1],Bt[1])]}static inverseTransform(it){const rt=it[0]*it[3]-it[1]*it[2];return[it[3]/rt,-it[1]/rt,-it[2]/rt,it[0]/rt,(it[2]*it[5]-it[4]*it[3])/rt,(it[4]*it[1]-it[5]*it[0])/rt]}static singularValueDecompose2dScale(it){const rt=[it[0],it[2],it[1],it[3]],gt=it[0]*rt[0]+it[1]*rt[2],Pt=it[0]*rt[1]+it[1]*rt[3],St=it[2]*rt[0]+it[3]*rt[2],Bt=it[2]*rt[1]+it[3]*rt[3],Lt=(gt+Bt)/2,Se=Math.sqrt((gt+Bt)**2-4*(gt*Bt-St*Pt))/2,tt=Lt+Se||1,ft=Lt-Se||1;return[Math.sqrt(tt),Math.sqrt(ft)]}static normalizeRect(it){const rt=it.slice(0);return it[0]>it[2]&&(rt[0]=it[2],rt[2]=it[0]),it[1]>it[3]&&(rt[1]=it[3],rt[3]=it[1]),rt}static intersect(it,rt){const gt=Math.max(Math.min(it[0],it[2]),Math.min(rt[0],rt[2])),Pt=Math.min(Math.max(it[0],it[2]),Math.max(rt[0],rt[2]));if(gt>Pt)return null;const St=Math.max(Math.min(it[1],it[3]),Math.min(rt[1],rt[3])),Bt=Math.min(Math.max(it[1],it[3]),Math.max(rt[1],rt[3]));return St>Bt?null:[gt,St,Pt,Bt]}static bezierBoundingBox(it,rt,gt,Pt,St,Bt,Lt,Se){const tt=[],ft=[[],[]];let ht,Re,ke,He,Ue,Qe,at,pt;for(let Ft=0;Ft<2;++Ft){if(Ft===0?(Re=6*it-12*gt+6*St,ht=-3*it+9*gt-9*St+3*Lt,ke=3*gt-3*it):(Re=6*rt-12*Pt+6*Bt,ht=-3*rt+9*Pt-9*Bt+3*Se,ke=3*Pt-3*rt),Math.abs(ht)<1e-12){if(Math.abs(Re)<1e-12)continue;He=-ke/Re,0<He&&He<1&&tt.push(He);continue}at=Re*Re-4*ke*ht,pt=Math.sqrt(at),!(at<0)&&(Ue=(-Re+pt)/(2*ht),0<Ue&&Ue<1&&tt.push(Ue),Qe=(-Re-pt)/(2*ht),0<Qe&&Qe<1&&tt.push(Qe))}let wt=tt.length,Dt;const bt=wt;for(;wt--;)He=tt[wt],Dt=1-He,ft[0][wt]=Dt*Dt*Dt*it+3*Dt*Dt*He*gt+3*Dt*He*He*St+He*He*He*Lt,ft[1][wt]=Dt*Dt*Dt*rt+3*Dt*Dt*He*Pt+3*Dt*He*He*Bt+He*He*He*Se;return ft[0][bt]=it,ft[1][bt]=rt,ft[0][bt+1]=Lt,ft[1][bt+1]=Se,ft[0].length=ft[1].length=bt+2,[Math.min(...ft[0]),Math.min(...ft[1]),Math.max(...ft[0]),Math.max(...ft[1])]}}_.Util=Je;const ut=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function qe(nt){if(nt[0]>=""){let rt;if(nt[0]===""&&nt[1]===""?rt="utf-16be":nt[0]===""&&nt[1]===""?rt="utf-16le":nt[0]===""&&nt[1]===""&&nt[2]===""&&(rt="utf-8"),rt)try{const gt=new TextDecoder(rt,{fatal:!0}),Pt=ot(nt);return gt.decode(Pt)}catch(gt){Ee(`stringToPDFString: "${gt}".`)}}const it=[];for(let rt=0,gt=nt.length;rt<gt;rt++){const Pt=ut[nt.charCodeAt(rt)];it.push(Pt?String.fromCharCode(Pt):nt.charAt(rt))}return it.join("")}function Ge(nt){return decodeURIComponent(escape(nt))}function Ke(nt){return unescape(encodeURIComponent(nt))}function et(nt){return typeof nt=="object"&&(nt==null?void 0:nt.byteLength)!==void 0}function ct(nt,it){if(nt.length!==it.length)return!1;for(let rt=0,gt=nt.length;rt<gt;rt++)if(nt[rt]!==it[rt])return!1;return!0}function mt(nt=new Date){return[nt.getUTCFullYear().toString(),(nt.getUTCMonth()+1).toString().padStart(2,"0"),nt.getUTCDate().toString().padStart(2,"0"),nt.getUTCHours().toString().padStart(2,"0"),nt.getUTCMinutes().toString().padStart(2,"0"),nt.getUTCSeconds().toString().padStart(2,"0")].join("")}class _t{constructor(){Ze(this,At,!1);this.promise=new Promise((it,rt)=>{this.resolve=gt=>{dt(this,At,!0),it(gt)},this.reject=gt=>{dt(this,At,!0),rt(gt)}})}get settled(){return we(this,At)}}At=new WeakMap,_.PromiseCapability=_t;let Ct=null,Et=null;function xt(nt){return Ct||(Ct=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Et=new Map([["","t"]])),nt.replaceAll(Ct,(it,rt,gt)=>rt?rt.normalize("NFKC"):Et.get(gt))}function Tt(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const nt=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(nt);else for(let it=0;it<32;it++)nt[it]=Math.floor(Math.random()*255);return Ve(nt)}},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var q,M,$,j,Xt,V,an,G,Y,Q,ee,te,Z,ne,re,se,_n,oe,ue,gn,ae,le;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports.build=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(ge){if(typeof ge=="string"||ge instanceof URL?ge={url:ge}:(0,_util.isArrayBuffer)(ge)&&(ge={data:ge}),typeof ge!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!ge.url&&!ge.data&&!ge.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const de=new PDFDocumentLoadingTask,{docId:pe}=de,ye=ge.url?getUrlProp(ge.url):null,_e=ge.data?getDataProp(ge.data):null,De=ge.httpHeaders||null,fe=ge.withCredentials===!0,Ae=ge.password??null,Me=ge.range instanceof PDFDataRangeTransport?ge.range:null,Ee=Number.isInteger(ge.rangeChunkSize)&&ge.rangeChunkSize>0?ge.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let Te=ge.worker instanceof PDFWorker?ge.worker:null;const Be=ge.verbosity,Xe=typeof ge.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(ge.docBaseUrl)?ge.docBaseUrl:null,ze=typeof ge.cMapUrl=="string"?ge.cMapUrl:null,Oe=ge.cMapPacked!==!1,Pe=ge.CMapReaderFactory||DefaultCMapReaderFactory,ve=typeof ge.standardFontDataUrl=="string"?ge.standardFontDataUrl:null,be=ge.StandardFontDataFactory||DefaultStandardFontDataFactory,Ce=ge.stopAtErrors!==!0,Ne=Number.isInteger(ge.maxImageSize)&&ge.maxImageSize>-1?ge.maxImageSize:-1,Ie=ge.isEvalSupported!==!1,Le=typeof ge.isOffscreenCanvasSupported=="boolean"?ge.isOffscreenCanvasSupported:!_util.isNodeJS,je=Number.isInteger(ge.canvasMaxAreaInBytes)?ge.canvasMaxAreaInBytes:-1,Ve=typeof ge.disableFontFace=="boolean"?ge.disableFontFace:_util.isNodeJS,ot=ge.fontExtraProperties===!0,lt=ge.enableXfa===!0,me=ge.ownerDocument||globalThis.document,We=ge.disableRange===!0,Ye=ge.disableStream===!0,Fe=ge.disableAutoFetch===!0,xe=ge.pdfBug===!0,$e=Me?Me.length:ge.length??NaN,Je=typeof ge.useSystemFonts=="boolean"?ge.useSystemFonts:!_util.isNodeJS&&!Ve,ut=typeof ge.useWorkerFetch=="boolean"?ge.useWorkerFetch:Pe===_display_utils.DOMCMapReaderFactory&&be===_display_utils.DOMStandardFontDataFactory&&ze&&ve&&(0,_display_utils.isValidFetchUrl)(ze,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(ve,document.baseURI),qe=ge.canvasFactory||new DefaultCanvasFactory({ownerDocument:me}),Ge=ge.filterFactory||new DefaultFilterFactory({docId:pe,ownerDocument:me}),Ke=null;(0,_util.setVerbosityLevel)(Be);const et={canvasFactory:qe,filterFactory:Ge};if(ut||(et.cMapReaderFactory=new Pe({baseUrl:ze,isCompressed:Oe}),et.standardFontDataFactory=new be({baseUrl:ve})),!Te){const _t={verbosity:Be,port:_worker_options.GlobalWorkerOptions.workerPort};Te=_t.port?PDFWorker.fromPort(_t):new PDFWorker(_t),de._worker=Te}const ct={docId:pe,apiVersion:"3.9.179",data:_e,password:Ae,disableAutoFetch:Fe,rangeChunkSize:Ee,length:$e,docBaseUrl:Xe,enableXfa:lt,evaluatorOptions:{maxImageSize:Ne,disableFontFace:Ve,ignoreErrors:Ce,isEvalSupported:Ie,isOffscreenCanvasSupported:Le,canvasMaxAreaInBytes:je,fontExtraProperties:ot,useSystemFonts:Je,cMapUrl:ut?ze:null,standardFontDataUrl:ut?ve:null}},mt={ignoreErrors:Ce,isEvalSupported:Ie,disableFontFace:Ve,fontExtraProperties:ot,enableXfa:lt,ownerDocument:me,disableAutoFetch:Fe,pdfBug:xe,styleElement:Ke};return Te.promise.then(function(){if(de.destroyed)throw new Error("Loading aborted");const _t=_fetchDocument(Te,ct),Ct=new Promise(function(Et){let xt;Me?xt=new _transport_stream.PDFDataTransportStream({length:$e,initialData:Me.initialData,progressiveDone:Me.progressiveDone,contentDispositionFilename:Me.contentDispositionFilename,disableRange:We,disableStream:Ye},Me):_e||(xt=(At=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(At):(0,_display_utils.isValidFetchUrl)(At.url)?new _displayFetch_stream.PDFFetchStream(At):new _displayNetwork.PDFNetworkStream(At))({url:ye,length:$e,httpHeaders:De,withCredentials:fe,rangeChunkSize:Ee,disableRange:We,disableStream:Ye})),Et(xt)});return Promise.all([_t,Ct]).then(function([Et,xt]){if(de.destroyed)throw new Error("Loading aborted");const Tt=new _message_handler.MessageHandler(pe,Et,Te.port),At=new WorkerTransport(Tt,de,xt,mt,et);de._transport=At,Tt.send("Ready",null)})}).catch(de._capability.reject),de}async function _fetchDocument(ge,de){if(ge.destroyed)throw new Error("Worker was destroyed");const pe=await ge.messageHandler.sendWithPromise("GetDocRequest",de,de.data?[de.data.buffer]:null);if(ge.destroyed)throw new Error("Worker was destroyed");return pe}function getUrlProp(ge){if(ge instanceof URL)return ge.href;try{return new URL(ge,window.location).href}catch{if(_util.isNodeJS&&typeof ge=="string")return ge}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(ge){if(_util.isNodeJS&&typeof Buffer<"u"&&ge instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(ge instanceof Uint8Array&&ge.byteLength===ge.buffer.byteLength)return ge;if(typeof ge=="string")return(0,_util.stringToBytes)(ge);if(typeof ge=="object"&&!isNaN(ge==null?void 0:ge.length)||(0,_util.isArrayBuffer)(ge))return new Uint8Array(ge);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const _=class{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${Wt(_,q)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var de;this.destroyed=!0,await((de=this._transport)==null?void 0:de.destroy()),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};let PDFDocumentLoadingTask=_;q=new WeakMap,Ze(PDFDocumentLoadingTask,q,0),exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(de,pe,ye=!1,_e=null){this.length=de,this.initialData=pe,this.progressiveDone=ye,this.contentDispositionFilename=_e,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(de){this._rangeListeners.push(de)}addProgressListener(de){this._progressListeners.push(de)}addProgressiveReadListener(de){this._progressiveReadListeners.push(de)}addProgressiveDoneListener(de){this._progressiveDoneListeners.push(de)}onDataRange(de,pe){for(const ye of this._rangeListeners)ye(de,pe)}onDataProgress(de,pe){this._readyCapability.promise.then(()=>{for(const ye of this._progressListeners)ye(de,pe)})}onDataProgressiveRead(de){this._readyCapability.promise.then(()=>{for(const pe of this._progressiveReadListeners)pe(de)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const de of this._progressiveDoneListeners)de()})}transportReady(){this._readyCapability.resolve()}requestDataRange(de,pe){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(de,pe){this._pdfInfo=de,this._transport=pe}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(de){return this._transport.getPage(de)}getPageIndex(de){return this._transport.getPageIndex(de)}getDestinations(){return this._transport.getDestinations()}getDestination(de){return this._transport.getDestination(de)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(de=!1){return this._transport.startCleanup(de||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(de,pe,ye,_e=!1){Ze(this,j);Ze(this,V);Ze(this,M,null);Ze(this,$,!1);this._pageIndex=de,this._pageInfo=pe,this._transport=ye,this._stats=_e?new _display_utils.StatTimer:null,this._pdfBug=_e,this.commonObjs=ye.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:de,rotation:pe=this.rotate,offsetX:ye=0,offsetY:_e=0,dontFlip:De=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:de,rotation:pe,offsetX:ye,offsetY:_e,dontFlip:De})}getAnnotations({intent:de="display"}={}){const pe=this._transport.getRenderingIntent(de);return this._transport.getAnnotations(this._pageIndex,pe.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var de;return((de=this._transport._htmlForXfa)==null?void 0:de.children[this._pageIndex])||null}render({canvasContext:de,viewport:pe,intent:ye="display",annotationMode:_e=_util.AnnotationMode.ENABLE,transform:De=null,background:fe=null,optionalContentConfigPromise:Ae=null,annotationCanvasMap:Me=null,pageColors:Ee=null,printAnnotationStorage:Te=null}){var be,Ce;(be=this._stats)==null||be.time("Overall");const Be=this._transport.getRenderingIntent(ye,_e,Te);dt(this,$,!1),st(this,V,an).call(this),Ae||(Ae=this._transport.getOptionalContentConfig());let Xe=this._intentStates.get(Be.cacheKey);Xe||(Xe=Object.create(null),this._intentStates.set(Be.cacheKey,Xe)),Xe.streamReaderCancelTimeout&&(clearTimeout(Xe.streamReaderCancelTimeout),Xe.streamReaderCancelTimeout=null);const ze=!!(Be.renderingIntent&_util.RenderingIntentFlag.PRINT);Xe.displayReadyCapability||(Xe.displayReadyCapability=new _util.PromiseCapability,Xe.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(Ce=this._stats)==null||Ce.time("Page Request"),this._pumpOperatorList(Be));const Oe=Ne=>{var Ie,Le;Xe.renderTasks.delete(Pe),(this._maybeCleanupAfterRender||ze)&&dt(this,$,!0),st(this,j,Xt).call(this,!ze),Ne?(Pe.capability.reject(Ne),this._abortOperatorList({intentState:Xe,reason:Ne instanceof Error?Ne:new Error(Ne)})):Pe.capability.resolve(),(Ie=this._stats)==null||Ie.timeEnd("Rendering"),(Le=this._stats)==null||Le.timeEnd("Overall")},Pe=new InternalRenderTask({callback:Oe,params:{canvasContext:de,viewport:pe,transform:De,background:fe},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:Me,operatorList:Xe.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!ze,pdfBug:this._pdfBug,pageColors:Ee});(Xe.renderTasks||(Xe.renderTasks=new Set)).add(Pe);const ve=Pe.task;return Promise.all([Xe.displayReadyCapability.promise,Ae]).then(([Ne,Ie])=>{var Le;if(this.destroyed){Oe();return}(Le=this._stats)==null||Le.time("Rendering"),Pe.initializeGraphics({transparency:Ne,optionalContentConfig:Ie}),Pe.operatorListChanged()}).catch(Oe),ve}getOperatorList({intent:de="display",annotationMode:pe=_util.AnnotationMode.ENABLE,printAnnotationStorage:ye=null}={}){var Me;function _e(){fe.operatorList.lastChunk&&(fe.opListReadCapability.resolve(fe.operatorList),fe.renderTasks.delete(Ae))}const De=this._transport.getRenderingIntent(de,pe,ye,!0);let fe=this._intentStates.get(De.cacheKey);fe||(fe=Object.create(null),this._intentStates.set(De.cacheKey,fe));let Ae;return fe.opListReadCapability||(Ae=Object.create(null),Ae.operatorListChanged=_e,fe.opListReadCapability=new _util.PromiseCapability,(fe.renderTasks||(fe.renderTasks=new Set)).add(Ae),fe.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(Me=this._stats)==null||Me.time("Page Request"),this._pumpOperatorList(De)),fe.opListReadCapability.promise}streamTextContent({includeMarkedContent:de=!1,disableNormalization:pe=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:de===!0,disableNormalization:pe===!0},{highWaterMark:100,size(_e){return _e.items.length}})}getTextContent(de={}){if(this._transport._htmlForXfa)return this.getXfa().then(ye=>_xfa_text.XfaText.textContent(ye));const pe=this.streamTextContent(de);return new Promise(function(ye,_e){function De(){fe.read().then(function({value:Me,done:Ee}){if(Ee){ye(Ae);return}Object.assign(Ae.styles,Me.styles),Ae.items.push(...Me.items),De()},_e)}const fe=pe.getReader(),Ae={items:[],styles:Object.create(null)};De()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const de=[];for(const pe of this._intentStates.values())if(this._abortOperatorList({intentState:pe,reason:new Error("Page was destroyed."),force:!0}),!pe.opListReadCapability)for(const ye of pe.renderTasks)de.push(ye.completed),ye.cancel();return this.objs.clear(),dt(this,$,!1),st(this,V,an).call(this),Promise.all(de)}cleanup(de=!1){dt(this,$,!0);const pe=st(this,j,Xt).call(this,!1);return de&&pe&&this._stats&&(this._stats=new _display_utils.StatTimer),pe}_startRenderPage(de,pe){var _e,De;const ye=this._intentStates.get(pe);ye&&((_e=this._stats)==null||_e.timeEnd("Page Request"),(De=ye.displayReadyCapability)==null||De.resolve(de))}_renderPageChunk(de,pe){for(let ye=0,_e=de.length;ye<_e;ye++)pe.operatorList.fnArray.push(de.fnArray[ye]),pe.operatorList.argsArray.push(de.argsArray[ye]);pe.operatorList.lastChunk=de.lastChunk,pe.operatorList.separateAnnots=de.separateAnnots;for(const ye of pe.renderTasks)ye.operatorListChanged();de.lastChunk&&st(this,j,Xt).call(this,!0)}_pumpOperatorList({renderingIntent:de,cacheKey:pe,annotationStorageSerializable:ye}){const{map:_e,transfers:De}=ye,Ae=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:de,cacheKey:pe,annotationStorage:_e},De).getReader(),Me=this._intentStates.get(pe);Me.streamReader=Ae;const Ee=()=>{Ae.read().then(({value:Te,done:Be})=>{if(Be){Me.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(Te,Me),Ee())},Te=>{if(Me.streamReader=null,!this._transport.destroyed){if(Me.operatorList){Me.operatorList.lastChunk=!0;for(const Be of Me.renderTasks)Be.operatorListChanged();st(this,j,Xt).call(this,!0)}if(Me.displayReadyCapability)Me.displayReadyCapability.reject(Te);else if(Me.opListReadCapability)Me.opListReadCapability.reject(Te);else throw Te}})};Ee()}_abortOperatorList({intentState:de,reason:pe,force:ye=!1}){if(de.streamReader){if(de.streamReaderCancelTimeout&&(clearTimeout(de.streamReaderCancelTimeout),de.streamReaderCancelTimeout=null),!ye){if(de.renderTasks.size>0)return;if(pe instanceof _display_utils.RenderingCancelledException){let _e=RENDERING_CANCELLED_TIMEOUT;pe.extraDelay>0&&pe.extraDelay<1e3&&(_e+=pe.extraDelay),de.streamReaderCancelTimeout=setTimeout(()=>{de.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:de,reason:pe,force:!0})},_e);return}}if(de.streamReader.cancel(new _util.AbortException(pe.message)).catch(()=>{}),de.streamReader=null,!this._transport.destroyed){for(const[_e,De]of this._intentStates)if(De===de){this._intentStates.delete(_e);break}this.cleanup()}}}get stats(){return this._stats}}M=new WeakMap,$=new WeakMap,j=new WeakSet,Xt=function(de=!1){if(st(this,V,an).call(this),!we(this,$)||this.destroyed)return!1;if(de)return dt(this,M,setTimeout(()=>{dt(this,M,null),st(this,j,Xt).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:pe,operatorList:ye}of this._intentStates.values())if(pe.size>0||!ye.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),dt(this,$,!1),!0},V=new WeakSet,an=function(){we(this,M)&&(clearTimeout(we(this,M)),dt(this,M,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){Ze(this,G,new Set);Ze(this,Y,Promise.resolve())}postMessage(de,pe){const ye={data:structuredClone(de,pe?{transfer:pe}:null)};we(this,Y).then(()=>{for(const _e of we(this,G))_e.call(this,ye)})}addEventListener(de,pe){we(this,G).add(pe)}removeEventListener(de,pe){we(this,G).delete(pe)}terminate(){we(this,G).clear()}}G=new WeakMap,Y=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const ge=(Q=document==null?void 0:document.currentScript)==null?void 0:Q.src;ge&&(PDFWorkerUtil.fallbackWorkerSrc=ge.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(ge,de){let pe;try{if(pe=new URL(ge),!pe.origin||pe.origin==="null")return!1}catch{return!1}const ye=new URL(de,pe);return pe.origin===ye.origin},PDFWorkerUtil.createCDNWrapper=function(ge){const de=`importScripts("${ge}");`;return URL.createObjectURL(new Blob([de]))}}const _PDFWorker=class{constructor({name:ge=null,port:de=null,verbosity:pe=(0,_util.getVerbosityLevel)()}={}){if(de&&we(_PDFWorker,ee).has(de))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=ge,this.destroyed=!1,this.verbosity=pe,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,de){we(_PDFWorker,ee).set(de,this),this._initializeFromPort(de);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(ge){this._port=ge,this._messageHandler=new _message_handler.MessageHandler("main","worker",ge),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:ge}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,ge)||(ge=PDFWorkerUtil.createCDNWrapper(new URL(ge,window.location).href));const de=new Worker(ge),pe=new _message_handler.MessageHandler("main","worker",de),ye=()=>{de.removeEventListener("error",_e),pe.destroy(),de.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},_e=()=>{this._webWorker||ye()};de.addEventListener("error",_e),pe.on("test",fe=>{if(de.removeEventListener("error",_e),this.destroyed){ye();return}fe?(this._messageHandler=pe,this._port=de,this._webWorker=de,this._readyCapability.resolve(),pe.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),pe.destroy(),de.terminate())}),pe.on("ready",fe=>{if(de.removeEventListener("error",_e),this.destroyed){ye();return}try{De()}catch{this._setupFakeWorker()}});const De=()=>{const fe=new Uint8Array;pe.send("test",fe,[fe.buffer])};De();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(ge=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const de=new LoopbackPort;this._port=de;const pe=`fake${PDFWorkerUtil.fakeWorkerId++}`,ye=new _message_handler.MessageHandler(pe+"_worker",pe,de);ge.setup(ye,de);const _e=new _message_handler.MessageHandler(pe,pe+"_worker",de);this._messageHandler=_e,this._readyCapability.resolve(),_e.send("configure",{verbosity:this.verbosity})}).catch(ge=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${ge.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),we(_PDFWorker,ee).delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(ge){if(!(ge!=null&&ge.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return we(this,ee).has(ge.port)?we(this,ee).get(ge.port):new _PDFWorker(ge)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var ge;try{return((ge=globalThis.pdfjsWorker)==null?void 0:ge.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};let PDFWorker=_PDFWorker;ee=new WeakMap,Ze(PDFWorker,ee,new WeakMap),exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(de,pe,ye,_e,De){Ze(this,se);Ze(this,te,new Map);Ze(this,Z,new Map);Ze(this,ne,new Map);Ze(this,re,null);this.messageHandler=de,this.loadingTask=pe,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:_e.ownerDocument,styleElement:_e.styleElement}),this._params=_e,this.canvasFactory=De.canvasFactory,this.filterFactory=De.filterFactory,this.cMapReaderFactory=De.cMapReaderFactory,this.standardFontDataFactory=De.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=ye,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(de,pe=_util.AnnotationMode.ENABLE,ye=null,_e=!1){let De=_util.RenderingIntentFlag.DISPLAY,fe=_annotation_storage.SerializableEmpty;switch(de){case"any":De=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":De=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${de}`)}switch(pe){case _util.AnnotationMode.DISABLE:De+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:De+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:De+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,fe=(De&_util.RenderingIntentFlag.PRINT&&ye instanceof _annotation_storage.PrintAnnotationStorage?ye:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${pe}`)}return _e&&(De+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:De,cacheKey:`${De}_${fe.hash}`,annotationStorageSerializable:fe}}destroy(){var ye;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,(ye=we(this,re))==null||ye.reject(new Error("Worker was destroyed during onPassword callback"));const de=[];for(const _e of we(this,Z).values())de.push(_e._destroy());we(this,Z).clear(),we(this,ne).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const pe=this.messageHandler.sendWithPromise("Terminate",null);return de.push(pe),Promise.all(de).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),we(this,te).clear(),this.filterFactory.destroy(),this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:de,loadingTask:pe}=this;de.on("GetReader",(ye,_e)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=De=>{this._lastProgress={loaded:De.loaded,total:De.total}},_e.onPull=()=>{this._fullReader.read().then(function({value:De,done:fe}){if(fe){_e.close();return}(0,_util.assert)(De instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),_e.enqueue(new Uint8Array(De),1,[De])}).catch(De=>{_e.error(De)})},_e.onCancel=De=>{this._fullReader.cancel(De),_e.ready.catch(fe=>{if(!this.destroyed)throw fe})}}),de.on("ReaderHeadersReady",ye=>{const _e=new _util.PromiseCapability,De=this._fullReader;return De.headersReady.then(()=>{var fe;(!De.isStreamingSupported||!De.isRangeSupported)&&(this._lastProgress&&((fe=pe.onProgress)==null||fe.call(pe,this._lastProgress)),De.onProgress=Ae=>{var Me;(Me=pe.onProgress)==null||Me.call(pe,{loaded:Ae.loaded,total:Ae.total})}),_e.resolve({isStreamingSupported:De.isStreamingSupported,isRangeSupported:De.isRangeSupported,contentLength:De.contentLength})},_e.reject),_e.promise}),de.on("GetRangeReader",(ye,_e)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const De=this._networkStream.getRangeReader(ye.begin,ye.end);if(!De){_e.close();return}_e.onPull=()=>{De.read().then(function({value:fe,done:Ae}){if(Ae){_e.close();return}(0,_util.assert)(fe instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),_e.enqueue(new Uint8Array(fe),1,[fe])}).catch(fe=>{_e.error(fe)})},_e.onCancel=fe=>{De.cancel(fe),_e.ready.catch(Ae=>{if(!this.destroyed)throw Ae})}}),de.on("GetDoc",({pdfInfo:ye})=>{this._numPages=ye.numPages,this._htmlForXfa=ye.htmlForXfa,delete ye.htmlForXfa,pe._capability.resolve(new PDFDocumentProxy(ye,this))}),de.on("DocException",function(ye){let _e;switch(ye.name){case"PasswordException":_e=new _util.PasswordException(ye.message,ye.code);break;case"InvalidPDFException":_e=new _util.InvalidPDFException(ye.message);break;case"MissingPDFException":_e=new _util.MissingPDFException(ye.message);break;case"UnexpectedResponseException":_e=new _util.UnexpectedResponseException(ye.message,ye.status);break;case"UnknownErrorException":_e=new _util.UnknownErrorException(ye.message,ye.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}pe._capability.reject(_e)}),de.on("PasswordRequest",ye=>{if(dt(this,re,new _util.PromiseCapability),pe.onPassword){const _e=De=>{De instanceof Error?we(this,re).reject(De):we(this,re).resolve({password:De})};try{pe.onPassword(_e,ye.code)}catch(De){we(this,re).reject(De)}}else we(this,re).reject(new _util.PasswordException(ye.message,ye.code));return we(this,re).promise}),de.on("DataLoaded",ye=>{var _e;(_e=pe.onProgress)==null||_e.call(pe,{loaded:ye.length,total:ye.length}),this.downloadInfoCapability.resolve(ye)}),de.on("StartRenderPage",ye=>{if(this.destroyed)return;we(this,Z).get(ye.pageIndex)._startRenderPage(ye.transparency,ye.cacheKey)}),de.on("commonobj",([ye,_e,De])=>{var fe;if(!this.destroyed&&!this.commonObjs.has(ye))switch(_e){case"Font":const Ae=this._params;if("error"in De){const Te=De.error;(0,_util.warn)(`Error during font loading: ${Te}`),this.commonObjs.resolve(ye,Te);break}const Me=Ae.pdfBug&&((fe=globalThis.FontInspector)!=null&&fe.enabled)?(Te,Be)=>globalThis.FontInspector.fontAdded(Te,Be):null,Ee=new _font_loader.FontFaceObject(De,{isEvalSupported:Ae.isEvalSupported,disableFontFace:Ae.disableFontFace,ignoreErrors:Ae.ignoreErrors,inspectFont:Me});this.fontLoader.bind(Ee).catch(Te=>de.sendWithPromise("FontFallback",{id:ye})).finally(()=>{!Ae.fontExtraProperties&&Ee.data&&(Ee.data=null),this.commonObjs.resolve(ye,Ee)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(ye,De);break;default:throw new Error(`Got unknown common object type ${_e}`)}}),de.on("obj",([ye,_e,De,fe])=>{var Me;if(this.destroyed)return;const Ae=we(this,Z).get(_e);if(!Ae.objs.has(ye))switch(De){case"Image":if(Ae.objs.resolve(ye,fe),fe){let Ee;if(fe.bitmap){const{width:Te,height:Be}=fe;Ee=Te*Be*4}else Ee=((Me=fe.data)==null?void 0:Me.length)||0;Ee>_util.MAX_IMAGE_SIZE_TO_CACHE&&(Ae._maybeCleanupAfterRender=!0)}break;case"Pattern":Ae.objs.resolve(ye,fe);break;default:throw new Error(`Got unknown object type ${De}`)}}),de.on("DocProgress",ye=>{var _e;this.destroyed||(_e=pe.onProgress)==null||_e.call(pe,{loaded:ye.loaded,total:ye.total})}),de.on("FetchBuiltInCMap",ye=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(ye):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),de.on("FetchStandardFontData",ye=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(ye):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var ye;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:de,transfers:pe}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:de,filename:((ye=this._fullReader)==null?void 0:ye.filename)??null},pe).finally(()=>{this.annotationStorage.resetModified()})}getPage(de){if(!Number.isInteger(de)||de<=0||de>this._numPages)return Promise.reject(new Error("Invalid page request."));const pe=de-1,ye=we(this,ne).get(pe);if(ye)return ye;const _e=this.messageHandler.sendWithPromise("GetPage",{pageIndex:pe}).then(De=>{if(this.destroyed)throw new Error("Transport destroyed");const fe=new PDFPageProxy(pe,De,this,this._params.pdfBug);return we(this,Z).set(pe,fe),fe});return we(this,ne).set(pe,_e),_e}getPageIndex(de){return typeof de!="object"||de===null||!Number.isInteger(de.num)||de.num<0||!Number.isInteger(de.gen)||de.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:de.num,gen:de.gen})}getAnnotations(de,pe){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:de,intent:pe})}getFieldObjects(){return st(this,se,_n).call(this,"GetFieldObjects")}hasJSActions(){return st(this,se,_n).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(de){return typeof de!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:de})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(de){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:de})}getStructTree(de){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:de})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(de=>new _optional_content_config.OptionalContentConfig(de))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const de="GetMetadata",pe=we(this,te).get(de);if(pe)return pe;const ye=this.messageHandler.sendWithPromise(de,null).then(_e=>{var De,fe;return{info:_e[0],metadata:_e[1]?new _metadata.Metadata(_e[1]):null,contentDispositionFilename:((De=this._fullReader)==null?void 0:De.filename)??null,contentLength:((fe=this._fullReader)==null?void 0:fe.contentLength)??null}});return we(this,te).set(de,ye),ye}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(de=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const pe of we(this,Z).values())if(!pe.cleanup())throw new Error(`startCleanup: Page ${pe.pageNumber} is currently rendering.`);this.commonObjs.clear(),de||this.fontLoader.clear(),we(this,te).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:de,enableXfa:pe}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:de,enableXfa:pe})}}te=new WeakMap,Z=new WeakMap,ne=new WeakMap,re=new WeakMap,se=new WeakSet,_n=function(de,pe=null){const ye=we(this,te).get(de);if(ye)return ye;const _e=this.messageHandler.sendWithPromise(de,pe);return we(this,te).set(de,_e),_e};class PDFObjects{constructor(){Ze(this,ue);Ze(this,oe,Object.create(null))}get(de,pe=null){if(pe){const _e=st(this,ue,gn).call(this,de);return _e.capability.promise.then(()=>pe(_e.data)),null}const ye=we(this,oe)[de];if(!(ye!=null&&ye.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${de}.`);return ye.data}has(de){const pe=we(this,oe)[de];return(pe==null?void 0:pe.capability.settled)||!1}resolve(de,pe=null){const ye=st(this,ue,gn).call(this,de);ye.data=pe,ye.capability.resolve()}clear(){var de;for(const pe in we(this,oe)){const{data:ye}=we(this,oe)[pe];(de=ye==null?void 0:ye.bitmap)==null||de.close()}dt(this,oe,Object.create(null))}}oe=new WeakMap,ue=new WeakSet,gn=function(de){const pe=we(this,oe)[de];return pe||(we(this,oe)[de]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(de){Ze(this,ae,null);dt(this,ae,de),this.onContinue=null}get promise(){return we(this,ae).capability.promise}cancel(de=0){we(this,ae).cancel(null,de)}get separateAnnots(){const{separateAnnots:de}=we(this,ae).operatorList;if(!de)return!1;const{annotationCanvasMap:pe}=we(this,ae);return de.form||de.canvas&&(pe==null?void 0:pe.size)>0}}ae=new WeakMap,exports.RenderTask=RenderTask;const he=class{constructor({callback:de,params:pe,objs:ye,commonObjs:_e,annotationCanvasMap:De,operatorList:fe,pageIndex:Ae,canvasFactory:Me,filterFactory:Ee,useRequestAnimationFrame:Te=!1,pdfBug:Be=!1,pageColors:Xe=null}){this.callback=de,this.params=pe,this.objs=ye,this.commonObjs=_e,this.annotationCanvasMap=De,this.operatorListIdx=null,this.operatorList=fe,this._pageIndex=Ae,this.canvasFactory=Me,this.filterFactory=Ee,this._pdfBug=Be,this.pageColors=Xe,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=Te===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=pe.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:de=!1,optionalContentConfig:pe}){var Ae,Me;if(this.cancelled)return;if(this._canvas){if(we(he,le).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");we(he,le).add(this._canvas)}this._pdfBug&&((Ae=globalThis.StepperManager)!=null&&Ae.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:ye,viewport:_e,transform:De,background:fe}=this.params;this.gfx=new _canvas.CanvasGraphics(ye,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:pe},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:De,viewport:_e,transparency:de,background:fe}),this.operatorListIdx=0,this.graphicsReady=!0,(Me=this.graphicsReadyCallback)==null||Me.call(this)}cancel(de=null,pe=0){var ye;this.running=!1,this.cancelled=!0,(ye=this.gfx)==null||ye.endDrawing(),this._canvas&&we(he,le).delete(this._canvas),this.callback(de||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,pe))}operatorListChanged(){var de;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(de=this.stepper)==null||de.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(this.pageColors),this._canvas&&we(he,le).delete(this._canvas),this.callback())))}};let InternalRenderTask=he;le=new WeakMap,Ze(InternalRenderTask,le,new WeakSet);const version="3.9.179";exports.version=version;const build="1ef6fbc52";exports.build=build},(q,_,M)=>{var Y,Q,ee,Vn,Z;Object.defineProperty(_,"__esModule",{value:!0}),_.SerializableEmpty=_.PrintAnnotationStorage=_.AnnotationStorage=void 0;var $=M(1),j=M(4),z=M(8);const V=Object.freeze({map:null,hash:"",transfers:void 0});_.SerializableEmpty=V;class X{constructor(){Ze(this,ee);Ze(this,Y,!1);Ze(this,Q,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(re,se){const ie=we(this,Q).get(re);return ie===void 0?se:Object.assign(se,ie)}getRawValue(re){return we(this,Q).get(re)}remove(re){if(we(this,Q).delete(re),we(this,Q).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const se of we(this,Q).values())if(se instanceof j.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(re,se){const ie=we(this,Q).get(re);let oe=!1;if(ie!==void 0)for(const[ue,ce]of Object.entries(se))ie[ue]!==ce&&(oe=!0,ie[ue]=ce);else oe=!0,we(this,Q).set(re,se);oe&&st(this,ee,Vn).call(this),se instanceof j.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(se.constructor._type)}has(re){return we(this,Q).has(re)}getAll(){return we(this,Q).size>0?(0,$.objectFromMap)(we(this,Q)):null}setAll(re){for(const[se,ie]of Object.entries(re))this.setValue(se,ie)}get size(){return we(this,Q).size}resetModified(){we(this,Y)&&(dt(this,Y,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new G(this)}get serializable(){if(we(this,Q).size===0)return V;const re=new Map,se=new z.MurmurHash3_64,ie=[],oe=Object.create(null);let ue=!1;for(const[ce,ae]of we(this,Q)){const le=ae instanceof j.AnnotationEditor?ae.serialize(!1,oe):ae;le&&(re.set(ce,le),se.update(`${ce}:${JSON.stringify(le)}`),ue||(ue=!!le.bitmap))}if(ue)for(const ce of re.values())ce.bitmap&&ie.push(ce.bitmap);return re.size>0?{map:re,hash:se.hexdigest(),transfers:ie}:V}}Y=new WeakMap,Q=new WeakMap,ee=new WeakSet,Vn=function(){we(this,Y)||(dt(this,Y,!0),typeof this.onSetModified=="function"&&this.onSetModified())},_.AnnotationStorage=X;class G extends X{constructor(se){super();Ze(this,Z,void 0);const{map:ie,hash:oe,transfers:ue}=se.serializable,ce=structuredClone(ie,ue?{transfer:ue}:null);dt(this,Z,{map:ce,hash:oe,transfers:ue})}get print(){(0,$.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return we(this,Z)}}Z=new WeakMap,_.PrintAnnotationStorage=G},(q,_,M)=>{var X,G,Y,Q,ee,te,Z,ne,re,se,bn,oe,Gn,ce,Xn,le,Kn;Object.defineProperty(_,"__esModule",{value:!0}),_.AnnotationEditor=void 0;var $=M(1),j=M(5);const ge=class{constructor(pe){Ze(this,se);Ze(this,oe);Ze(this,ce);Ze(this,le);Ze(this,X,!1);Ze(this,G,null);Ze(this,Y,null);Ze(this,Q,this.focusin.bind(this));Ze(this,ee,this.focusout.bind(this));Ze(this,te,!1);Ze(this,Z,!1);Ze(this,ne,!1);$t(this,"_uiManager",null);Ze(this,re,ge._zIndex++);this.constructor===ge&&(0,$.unreachable)("Cannot initialize AnnotationEditor."),this.parent=pe.parent,this.id=pe.id,this.width=this.height=null,this.pageIndex=pe.parent.pageIndex,this.name=pe.name,this.div=null,this._uiManager=pe.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1;const{rotation:ye,rawDims:{pageWidth:_e,pageHeight:De,pageX:fe,pageY:Ae}}=this.parent.viewport;this.rotation=ye,this.pageRotation=(360+ye-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[_e,De],this.pageTranslation=[fe,Ae];const[Me,Ee]=this.parentDimensions;this.x=pe.x/Me,this.y=pe.y/Ee,this.isAttachedToDOM=!1,this.deleted=!1}static get _defaultLineColor(){return(0,$.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(pe){const ye=new V({id:pe.parent.getNextId(),parent:pe.parent,uiManager:pe._uiManager});ye.annotationElementId=pe.annotationElementId,ye.deleted=!0,ye._uiManager.addToAnnotationStorage(ye)}static initialize(pe){}static updateDefaultParams(pe,ye){}static get defaultPropertiesToUpdate(){return[]}get propertiesToUpdate(){return[]}addCommands(pe){this._uiManager.addCommands(pe)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=we(this,re)}setParent(pe){pe!==null&&(this.pageIndex=pe.pageIndex,this.pageDimensions=pe.pageDimensions),this.parent=pe}focusin(pe){we(this,te)?dt(this,te,!1):this.parent.setSelected(this)}focusout(pe){var _e;if(!this.isAttachedToDOM)return;const ye=pe.relatedTarget;ye!=null&&ye.closest(`#${this.id}`)||(pe.preventDefault(),(_e=this.parent)!=null&&_e.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}dragstart(pe){const ye=this.parent.div.getBoundingClientRect();this.startX=pe.clientX-ye.x,this.startY=pe.clientY-ye.y,pe.dataTransfer.setData("text/plain",this.id),pe.dataTransfer.effectAllowed="move"}setAt(pe,ye,_e,De){const[fe,Ae]=this.parentDimensions;[_e,De]=this.screenToPageTranslation(_e,De),this.x=(pe+_e)/fe,this.y=(ye+De)/Ae,this.fixAndSetPosition()}translate(pe,ye){st(this,se,bn).call(this,this.parentDimensions,pe,ye)}translateInPage(pe,ye){st(this,se,bn).call(this,this.pageDimensions,pe,ye),this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[pe,ye]=this.pageDimensions;let{x:_e,y:De,width:fe,height:Ae}=this;switch(fe*=pe,Ae*=ye,_e*=pe,De*=ye,this.rotation){case 0:_e=Math.max(0,Math.min(pe-fe,_e)),De=Math.max(0,Math.min(ye-Ae,De));break;case 90:_e=Math.max(0,Math.min(pe-Ae,_e)),De=Math.min(ye,Math.max(fe,De));break;case 180:_e=Math.min(pe,Math.max(fe,_e)),De=Math.min(ye,Math.max(Ae,De));break;case 270:_e=Math.min(pe,Math.max(Ae,_e)),De=Math.max(0,Math.min(ye-fe,De));break}this.x=_e/pe,this.y=De/ye,this.div.style.left=`${(100*this.x).toFixed(2)}%`,this.div.style.top=`${(100*this.y).toFixed(2)}%`}screenToPageTranslation(pe,ye){switch(this.parentRotation){case 90:return[ye,-pe];case 180:return[-pe,-ye];case 270:return[-ye,pe];default:return[pe,ye]}}pageTranslationToScreen(pe,ye){switch(this.parentRotation){case 90:return[-ye,pe];case 180:return[-pe,-ye];case 270:return[ye,-pe];default:return[pe,ye]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{realScale:pe}=this._uiManager.viewParameters,[ye,_e]=this.pageDimensions;return[ye*pe,_e*pe]}setDims(pe,ye){const[_e,De]=this.parentDimensions;this.div.style.width=`${(100*pe/_e).toFixed(2)}%`,we(this,X)||(this.div.style.height=`${(100*ye/De).toFixed(2)}%`)}fixDims(){const{style:pe}=this.div,{height:ye,width:_e}=pe,De=_e.endsWith("%"),fe=!we(this,X)&&ye.endsWith("%");if(De&&fe)return;const[Ae,Me]=this.parentDimensions;De||(pe.width=`${(100*parseFloat(_e)/Ae).toFixed(2)}%`),!we(this,X)&&!fe&&(pe.height=`${(100*parseFloat(ye)/Me).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",we(this,Q)),this.div.addEventListener("focusout",we(this,ee));const[pe,ye]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*ye/pe).toFixed(2)}%`,this.div.style.maxHeight=`${(100*pe/ye).toFixed(2)}%`);const[_e,De]=this.getInitialTranslation();return this.translate(_e,De),(0,j.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(pe){const{isMac:ye}=$.FeatureTest.platform;if(pe.button!==0||pe.ctrlKey&&ye){pe.preventDefault();return}pe.ctrlKey&&!ye||pe.shiftKey||pe.metaKey&&ye?this.parent.toggleSelected(this):this.parent.setSelected(this),dt(this,te,!0)}getRect(pe,ye){const _e=this.parentScale,[De,fe]=this.pageDimensions,[Ae,Me]=this.pageTranslation,Ee=pe/_e,Te=ye/_e,Be=this.x*De,Xe=this.y*fe,ze=this.width*De,Oe=this.height*fe;switch(this.rotation){case 0:return[Be+Ee+Ae,fe-Xe-Te-Oe+Me,Be+Ee+ze+Ae,fe-Xe-Te+Me];case 90:return[Be+Te+Ae,fe-Xe+Ee+Me,Be+Te+Oe+Ae,fe-Xe+Ee+ze+Me];case 180:return[Be-Ee-ze+Ae,fe-Xe+Te+Me,Be-Ee+Ae,fe-Xe+Te+Oe+Me];case 270:return[Be-Te-Oe+Ae,fe-Xe-Ee-ze+Me,Be-Te+Ae,fe-Xe-Ee+Me];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(pe,ye){const[_e,De,fe,Ae]=pe,Me=fe-_e,Ee=Ae-De;switch(this.rotation){case 0:return[_e,ye-Ae,Me,Ee];case 90:return[_e,ye-De,Ee,Me];case 180:return[fe,ye-De,Me,Ee];case 270:return[fe,ye-Ae,Ee,Me];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){dt(this,ne,!0)}disableEditMode(){dt(this,ne,!1)}isInEditMode(){return we(this,ne)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var pe,ye;(pe=this.div)==null||pe.addEventListener("focusin",we(this,Q)),(ye=this.div)==null||ye.addEventListener("focusout",we(this,ee))}serialize(pe=!1,ye=null){(0,$.unreachable)("An editor must be serializable")}static deserialize(pe,ye,_e){const De=new this.prototype.constructor({parent:ye,id:ye.getNextId(),uiManager:_e});De.rotation=pe.rotation;const[fe,Ae]=De.pageDimensions,[Me,Ee,Te,Be]=De.getRectInCurrentCoords(pe.rect,Ae);return De.x=Me/fe,De.y=Ee/Ae,De.width=Te/fe,De.height=Be/Ae,De}remove(){this.div.removeEventListener("focusin",we(this,Q)),this.div.removeEventListener("focusout",we(this,ee)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this)}get isResizable(){return!1}makeResizable(){this.isResizable&&(st(this,oe,Gn).call(this),we(this,G).classList.remove("hidden"))}select(){var pe;this.makeResizable(),(pe=this.div)==null||pe.classList.add("selectedEditor")}unselect(){var pe,ye,_e;(pe=we(this,G))==null||pe.classList.add("hidden"),(ye=this.div)==null||ye.classList.remove("selectedEditor"),(_e=this.div)!=null&&_e.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(pe,ye){}disableEditing(){}enableEditing(){}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return we(this,Z)}set isEditing(pe){dt(this,Z,pe),this.parent&&(pe?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(pe,ye){dt(this,X,!0);const _e=pe/ye,{style:De}=this.div;De.aspectRatio=_e,De.height="auto"}static get MIN_SIZE(){return 16}};let z=ge;X=new WeakMap,G=new WeakMap,Y=new WeakMap,Q=new WeakMap,ee=new WeakMap,te=new WeakMap,Z=new WeakMap,ne=new WeakMap,re=new WeakMap,se=new WeakSet,bn=function([pe,ye],_e,De){[_e,De]=this.screenToPageTranslation(_e,De),this.x+=_e/pe,this.y+=De/ye,this.fixAndSetPosition()},oe=new WeakSet,Gn=function(){if(we(this,G))return;dt(this,G,document.createElement("div")),we(this,G).classList.add("resizers");const pe=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||pe.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const ye of pe){const _e=document.createElement("div");we(this,G).append(_e),_e.classList.add("resizer",ye),_e.addEventListener("pointerdown",st(this,ce,Xn).bind(this,ye))}this.div.prepend(we(this,G))},ce=new WeakSet,Xn=function(pe,ye){ye.preventDefault(),dt(this,Y,[ye.clientX,ye.clientY]);const _e=st(this,le,Kn).bind(this,pe),De=this.div.draggable;this.div.draggable=!1;const fe=`resizing${pe.charAt(0).toUpperCase()}${pe.slice(1)}`;this.parent.div.classList.add(fe);const Ae={passive:!0,capture:!0};window.addEventListener("pointermove",_e,Ae);const Me=()=>{this._uiManager.stopUndoAccumulation(),this.div.draggable=De,this.parent.div.classList.remove(fe),window.removeEventListener("pointermove",_e,Ae)};window.addEventListener("pointerup",Me,{once:!0})},le=new WeakSet,Kn=function(pe,ye){const{clientX:_e,clientY:De}=ye,fe=_e-we(this,Y)[0],Ae=De-we(this,Y)[1];we(this,Y)[0]=_e,we(this,Y)[1]=De;const[Me,Ee]=this.parentDimensions,Te=this.x,Be=this.y,Xe=this.width,ze=this.height,Oe=ge.MIN_SIZE/Me,Pe=ge.MIN_SIZE/Ee;let ve;const be=Ie=>Math.round(Ie*1e4)/1e4,Ce=(Ie,Le)=>{const[je,Ve]=this.parentDimensions;this.setDims(je*Ie,Ve*Le),this.fixAndSetPosition()},Ne=()=>{this.width=Xe,this.height=ze,this.x=Te,this.y=Be,Ce(Xe,ze)};switch(pe){case"topLeft":{if(Math.sign(fe)*Math.sign(Ae)<0)return;const Ie=Math.hypot(fe,Ae),Le=Math.hypot(Xe*Me,ze*Ee),je=be(Te+Xe),Ve=be(Be+ze),ot=Math.max(Math.min(1-Math.sign(fe)*(Ie/Le),1/Xe,1/ze),Oe/Xe,Pe/ze),lt=be(Xe*ot),me=be(ze*ot),We=je-lt,Ye=Ve-me;ve=()=>{this.width=lt,this.height=me,this.x=We,this.y=Ye,Ce(lt,me)};break}case"topMiddle":{const Ie=be(this.y+ze),Le=be(Math.max(Pe,Math.min(1,ze-Ae/Ee))),je=Ie-Le;ve=()=>{this.height=Le,this.y=je,Ce(Xe,Le)};break}case"topRight":{if(Math.sign(fe)*Math.sign(Ae)>0)return;const Ie=Math.hypot(fe,Ae),Le=Math.hypot(this.width*Me,this.height*Ee),je=be(Be+this.height),Ve=Math.max(Math.min(1+Math.sign(fe)*(Ie/Le),1/Xe,1/ze),Oe/Xe,Pe/ze),ot=be(Xe*Ve),lt=be(ze*Ve),me=je-lt;ve=()=>{this.width=ot,this.height=lt,this.y=me,Ce(ot,lt)};break}case"middleRight":{const Ie=be(Math.max(Oe,Math.min(1,Xe+fe/Me)));ve=()=>{this.width=Ie,Ce(Ie,ze)};break}case"bottomRight":{if(Math.sign(fe)*Math.sign(Ae)<0)return;const Ie=Math.hypot(fe,Ae),Le=Math.hypot(this.width*Me,this.height*Ee),je=Math.max(Math.min(1+Math.sign(fe)*(Ie/Le),1/Xe,1/ze),Oe/Xe,Pe/ze),Ve=be(Xe*je),ot=be(ze*je);ve=()=>{this.width=Ve,this.height=ot,Ce(Ve,ot)};break}case"bottomMiddle":{const Ie=be(Math.max(Pe,Math.min(1,ze+Ae/Ee)));ve=()=>{this.height=Ie,Ce(Xe,Ie)};break}case"bottomLeft":{if(Math.sign(fe)*Math.sign(Ae)>0)return;const Ie=Math.hypot(fe,Ae),Le=Math.hypot(this.width*Me,this.height*Ee),je=be(Te+this.width),Ve=Math.max(Math.min(1-Math.sign(fe)*(Ie/Le),1/Xe,1/ze),Oe/Xe,Pe/ze),ot=be(Xe*Ve),lt=be(ze*Ve),me=je-ot;ve=()=>{this.width=ot,this.height=lt,this.x=me,Ce(ot,lt)};break}case"middleLeft":{const Ie=be(Te+Xe),Le=be(Math.max(Oe,Math.min(1,Xe-fe/Me))),je=Ie-Le;ve=()=>{this.width=Le,this.x=je,Ce(Le,ze)};break}}this.addCommands({cmd:ve,undo:Ne,mustExec:!0,type:$.AnnotationEditorParamsType.RESIZE,overwriteIfSameType:!0,keepUndo:!0})},$t(z,"_colorManager",new j.ColorManager),$t(z,"_zIndex",1),_.AnnotationEditor=z;class V extends z{constructor(pe){super(pe),this.annotationElementId=pe.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(q,_,M)=>{var Z,ne,re,se,ie,yn,ue,ce,ae,le,he,Yn,pe,ye,_e,De,fe,Ae,Me,Ee,Te,Be,Xe,ze,Oe,Pe,ve,be,Ce,Ne,Ie,Le,je,Ve,ot,lt,me,We,Ye,Fe,xe,Qn,Je,vn,qe,Zn,Ke,Jn,ct,Ht,_t,Jt,Et,er,Tt,tr,nt,wn,rt,en,Pt,An;Object.defineProperty(_,"__esModule",{value:!0}),_.KeyboardManager=_.CommandManager=_.ColorManager=_.AnnotationEditorUIManager=void 0,_.bindEvents=z,_.opacityToHex=V;var $=M(1),j=M(6);function z(Lt,Se,tt){for(const ft of tt)Se.addEventListener(ft,Lt[ft].bind(Lt))}function V(Lt){return Math.round(Math.min(255,Math.max(1,255*Lt))).toString(16).padStart(2,"0")}class X{constructor(){Ze(this,Z,0)}getId(){return`${$.AnnotationEditorPrefix}${Wt(this,Z)._++}`}}Z=new WeakMap;class G{constructor(){Ze(this,ie);Ze(this,ne,(0,$.getUuid)());Ze(this,re,0);Ze(this,se,null)}async getFromFile(Se){const{lastModified:tt,name:ft,size:ht,type:Re}=Se;return st(this,ie,yn).call(this,`${tt}_${ft}_${ht}_${Re}`,Se)}async getFromUrl(Se){return st(this,ie,yn).call(this,Se,Se)}async getFromId(Se){we(this,se)||dt(this,se,new Map);const tt=we(this,se).get(Se);return tt?tt.bitmap?(tt.refCounter+=1,tt):tt.file?this.getFromFile(tt.file):this.getFromUrl(tt.url):null}getSvgUrl(Se){const tt=we(this,se).get(Se);return tt!=null&&tt.isSvg?tt.svgUrl:null}deleteId(Se){we(this,se)||dt(this,se,new Map);const tt=we(this,se).get(Se);tt&&(tt.refCounter-=1,tt.refCounter===0&&(tt.bitmap=null))}isValidId(Se){return Se.startsWith(`image_${we(this,ne)}_`)}}ne=new WeakMap,re=new WeakMap,se=new WeakMap,ie=new WeakSet,yn=async function(Se,tt){we(this,se)||dt(this,se,new Map);let ft=we(this,se).get(Se);if(ft===null)return null;if(ft!=null&&ft.bitmap)return ft.refCounter+=1,ft;try{ft||(ft={bitmap:null,id:`image_${we(this,ne)}_${Wt(this,re)._++}`,refCounter:0,isSvg:!1});let ht;if(typeof tt=="string"){ft.url=tt;const Re=await fetch(tt);if(!Re.ok)throw new Error(Re.statusText);ht=await Re.blob()}else ht=ft.file=tt;if(ht.type==="image/svg+xml"){const Re=new FileReader,ke=new Image,He=new Promise((Ue,Qe)=>{ke.onload=()=>{ft.bitmap=ke,ft.isSvg=!0,Ue()},Re.onload=()=>{ke.src=ft.svgUrl=Re.result},ke.onerror=Re.onerror=Qe});Re.readAsDataURL(ht),await He}else ft.bitmap=await createImageBitmap(ht);ft.refCounter=1}catch(ht){console.error(ht),ft=null}return we(this,se).set(Se,ft),ft&&we(this,se).set(ft.id,ft),ft};class Y{constructor(Se=128){Ze(this,ue,[]);Ze(this,ce,!1);Ze(this,ae,void 0);Ze(this,le,-1);dt(this,ae,Se)}add({cmd:Se,undo:tt,mustExec:ft,type:ht=NaN,overwriteIfSameType:Re=!1,keepUndo:ke=!1}){if(ft&&Se(),we(this,ce))return;const He={cmd:Se,undo:tt,type:ht};if(we(this,le)===-1){we(this,ue).length>0&&(we(this,ue).length=0),dt(this,le,0),we(this,ue).push(He);return}if(Re&&we(this,ue)[we(this,le)].type===ht){ke&&(He.undo=we(this,ue)[we(this,le)].undo),we(this,ue)[we(this,le)]=He;return}const Ue=we(this,le)+1;Ue===we(this,ae)?we(this,ue).splice(0,1):(dt(this,le,Ue),Ue<we(this,ue).length&&we(this,ue).splice(Ue)),we(this,ue).push(He)}stopUndoAccumulation(){we(this,le)!==-1&&(we(this,ue)[we(this,le)].type=NaN)}undo(){we(this,le)!==-1&&(dt(this,ce,!0),we(this,ue)[we(this,le)].undo(),dt(this,ce,!1),dt(this,le,we(this,le)-1))}redo(){we(this,le)<we(this,ue).length-1&&(dt(this,le,we(this,le)+1),dt(this,ce,!0),we(this,ue)[we(this,le)].cmd(),dt(this,ce,!1))}hasSomethingToUndo(){return we(this,le)!==-1}hasSomethingToRedo(){return we(this,le)<we(this,ue).length-1}destroy(){dt(this,ue,null)}}ue=new WeakMap,ce=new WeakMap,ae=new WeakMap,le=new WeakMap,_.CommandManager=Y;class Q{constructor(Se){Ze(this,he);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:tt}=$.FeatureTest.platform;for(const[ft,ht,Re={}]of Se)for(const ke of ft){const He=ke.startsWith("mac+");tt&&He?(this.callbacks.set(ke.slice(4),{callback:ht,options:Re}),this.allKeys.add(ke.split("+").at(-1))):!tt&&!He&&(this.callbacks.set(ke,{callback:ht,options:Re}),this.allKeys.add(ke.split("+").at(-1)))}}exec(Se,tt){if(!this.allKeys.has(tt.key))return;const ft=this.callbacks.get(st(this,he,Yn).call(this,tt));if(!ft)return;const{callback:ht,options:{bubbles:Re=!1,args:ke=[],checker:He=null}}=ft;He&&!He(Se,tt)||(ht.bind(Se,...ke)(),Re||(tt.stopPropagation(),tt.preventDefault()))}}he=new WeakSet,Yn=function(Se){Se.altKey&&this.buffer.push("alt"),Se.ctrlKey&&this.buffer.push("ctrl"),Se.metaKey&&this.buffer.push("meta"),Se.shiftKey&&this.buffer.push("shift"),this.buffer.push(Se.key);const tt=this.buffer.join("+");return this.buffer.length=0,tt},_.KeyboardManager=Q;const de=class{get _colors(){const Se=new Map([["CanvasText",null],["Canvas",null]]);return(0,j.getColorValues)(Se),(0,$.shadow)(this,"_colors",Se)}convert(Se){const tt=(0,j.getRGB)(Se);if(!window.matchMedia("(forced-colors: active)").matches)return tt;for(const[ft,ht]of this._colors)if(ht.every((Re,ke)=>Re===tt[ke]))return de._colorsMapping.get(ft);return tt}getHexCode(Se){const tt=this._colors.get(Se);return tt?$.Util.makeHexColor(...tt):Se}};let ee=de;$t(ee,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]])),_.ColorManager=ee;const Bt=class{constructor(Se,tt,ft,ht){Ze(this,xe);Ze(this,Je);Ze(this,qe);Ze(this,Ke);Ze(this,ct);Ze(this,_t);Ze(this,Et);Ze(this,Tt);Ze(this,nt);Ze(this,rt);Ze(this,Pt);Ze(this,pe,null);Ze(this,ye,new Map);Ze(this,_e,new Map);Ze(this,De,null);Ze(this,fe,new Y);Ze(this,Ae,0);Ze(this,Me,new Set);Ze(this,Ee,null);Ze(this,Te,new Set);Ze(this,Be,null);Ze(this,Xe,null);Ze(this,ze,new X);Ze(this,Oe,!1);Ze(this,Pe,$.AnnotationEditorType.NONE);Ze(this,ve,new Set);Ze(this,be,null);Ze(this,Ce,this.copy.bind(this));Ze(this,Ne,this.cut.bind(this));Ze(this,Ie,this.paste.bind(this));Ze(this,Le,this.keydown.bind(this));Ze(this,je,this.onEditingAction.bind(this));Ze(this,Ve,this.onPageChanging.bind(this));Ze(this,ot,this.onScaleChanging.bind(this));Ze(this,lt,this.onRotationChanging.bind(this));Ze(this,me,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});Ze(this,We,[0,0]);Ze(this,Ye,null);Ze(this,Fe,null);dt(this,Fe,Se),dt(this,Be,tt),we(this,Be)._on("editingaction",we(this,je)),we(this,Be)._on("pagechanging",we(this,Ve)),we(this,Be)._on("scalechanging",we(this,ot)),we(this,Be)._on("rotationchanging",we(this,lt)),dt(this,De,ft.annotationStorage),dt(this,Xe,ft.filterFactory),dt(this,be,ht),this.viewParameters={realScale:j.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const Se=Bt.prototype,tt=Re=>{const{activeElement:ke}=document;return ke&&we(Re,Fe).contains(ke)&&Re.hasSomethingToControl()},ft=this.TRANSLATE_SMALL,ht=this.TRANSLATE_BIG;return(0,$.shadow)(this,"_keyboardManager",new Q([[["ctrl+a","mac+meta+a"],Se.selectAll],[["ctrl+z","mac+meta+z"],Se.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],Se.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],Se.delete],[["Escape","mac+Escape"],Se.unselectAll],[["ArrowLeft","mac+ArrowLeft"],Se.translateSelectedEditors,{args:[-ft,0],checker:tt}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],Se.translateSelectedEditors,{args:[-ht,0],checker:tt}],[["ArrowRight","mac+ArrowRight"],Se.translateSelectedEditors,{args:[ft,0],checker:tt}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],Se.translateSelectedEditors,{args:[ht,0],checker:tt}],[["ArrowUp","mac+ArrowUp"],Se.translateSelectedEditors,{args:[0,-ft],checker:tt}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],Se.translateSelectedEditors,{args:[0,-ht],checker:tt}],[["ArrowDown","mac+ArrowDown"],Se.translateSelectedEditors,{args:[0,ft],checker:tt}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],Se.translateSelectedEditors,{args:[0,ht],checker:tt}]]))}destroy(){st(this,Je,vn).call(this),we(this,Be)._off("editingaction",we(this,je)),we(this,Be)._off("pagechanging",we(this,Ve)),we(this,Be)._off("scalechanging",we(this,ot)),we(this,Be)._off("rotationchanging",we(this,lt));for(const Se of we(this,_e).values())Se.destroy();we(this,_e).clear(),we(this,ye).clear(),we(this,Te).clear(),dt(this,pe,null),we(this,ve).clear(),we(this,fe).destroy()}get hcmFilter(){return(0,$.shadow)(this,"hcmFilter",we(this,be)?we(this,Xe).addHCMFilter(we(this,be).foreground,we(this,be).background):"none")}onPageChanging({pageNumber:Se}){dt(this,Ae,Se-1)}focusMainContainer(){we(this,Fe).focus()}addShouldRescale(Se){we(this,Te).add(Se)}removeShouldRescale(Se){we(this,Te).delete(Se)}onScaleChanging({scale:Se}){this.commitOrRemove(),this.viewParameters.realScale=Se*j.PixelsPerInch.PDF_TO_CSS_UNITS;for(const tt of we(this,Te))tt.onScaleChanging()}onRotationChanging({pagesRotation:Se}){this.commitOrRemove(),this.viewParameters.rotation=Se}addToAnnotationStorage(Se){!Se.isEmpty()&&we(this,De)&&!we(this,De).has(Se.id)&&we(this,De).setValue(Se.id,Se)}copy(Se){if(Se.preventDefault(),we(this,pe)&&we(this,pe).commitOrRemove(),!this.hasSelection)return;const tt=[];for(const ft of we(this,ve)){const ht=ft.serialize(!0);ht&&tt.push(ht)}tt.length!==0&&Se.clipboardData.setData("application/pdfjs",JSON.stringify(tt))}cut(Se){this.copy(Se),this.delete()}paste(Se){Se.preventDefault();let tt=Se.clipboardData.getData("application/pdfjs");if(!tt)return;try{tt=JSON.parse(tt)}catch(ht){(0,$.warn)(`paste: "${ht.message}".`);return}if(!Array.isArray(tt))return;this.unselectAll();const ft=this.currentLayer;try{const ht=[];for(const He of tt){const Ue=ft.deserialize(He);if(!Ue)return;ht.push(Ue)}const Re=()=>{for(const He of ht)st(this,nt,wn).call(this,He);st(this,Pt,An).call(this,ht)},ke=()=>{for(const He of ht)He.remove()};this.addCommands({cmd:Re,undo:ke,mustExec:!0})}catch(ht){(0,$.warn)(`paste: "${ht.message}".`)}}keydown(Se){var tt;(tt=this.getActive())!=null&&tt.shouldGetKeyboardEvents()||Bt._keyboardManager.exec(this,Se)}onEditingAction(Se){["undo","redo","delete","selectAll"].includes(Se.name)&&this[Se.name]()}setEditingState(Se){Se?(st(this,xe,Qn).call(this),st(this,qe,Zn).call(this),st(this,ct,Ht).call(this,{isEditing:we(this,Pe)!==$.AnnotationEditorType.NONE,isEmpty:st(this,rt,en).call(this),hasSomethingToUndo:we(this,fe).hasSomethingToUndo(),hasSomethingToRedo:we(this,fe).hasSomethingToRedo(),hasSelectedEditor:!1})):(st(this,Je,vn).call(this),st(this,Ke,Jn).call(this),st(this,ct,Ht).call(this,{isEditing:!1}))}registerEditorTypes(Se){if(!we(this,Ee)){dt(this,Ee,Se);for(const tt of we(this,Ee))st(this,_t,Jt).call(this,tt.defaultPropertiesToUpdate)}}getId(){return we(this,ze).getId()}get currentLayer(){return we(this,_e).get(we(this,Ae))}get currentPageIndex(){return we(this,Ae)}addLayer(Se){we(this,_e).set(Se.pageIndex,Se),we(this,Oe)?Se.enable():Se.disable()}removeLayer(Se){we(this,_e).delete(Se.pageIndex)}updateMode(Se,tt=null){if(dt(this,Pe,Se),Se===$.AnnotationEditorType.NONE){this.setEditingState(!1),st(this,Tt,tr).call(this);return}this.setEditingState(!0),st(this,Et,er).call(this);for(const ft of we(this,_e).values())ft.updateMode(Se);if(tt){for(const ft of we(this,ye).values())if(ft.annotationElementId===tt){this.setSelected(ft),ft.enterInEditMode();break}}}updateToolbar(Se){Se!==we(this,Pe)&&we(this,Be).dispatch("switchannotationeditormode",{source:this,mode:Se})}updateParams(Se,tt){if(we(this,Ee)){for(const ft of we(this,ve))ft.updateParams(Se,tt);for(const ft of we(this,Ee))ft.updateDefaultParams(Se,tt)}}getEditors(Se){const tt=[];for(const ft of we(this,ye).values())ft.pageIndex===Se&&tt.push(ft);return tt}getEditor(Se){return we(this,ye).get(Se)}addEditor(Se){we(this,ye).set(Se.id,Se)}removeEditor(Se){var tt;we(this,ye).delete(Se.id),this.unselect(Se),(!Se.annotationElementId||!we(this,Me).has(Se.annotationElementId))&&((tt=we(this,De))==null||tt.remove(Se.id))}addDeletedAnnotationElement(Se){we(this,Me).add(Se.annotationElementId),Se.deleted=!0}isDeletedAnnotationElement(Se){return we(this,Me).has(Se)}removeDeletedAnnotationElement(Se){we(this,Me).delete(Se.annotationElementId),Se.deleted=!1}setActiveEditor(Se){we(this,pe)!==Se&&(dt(this,pe,Se),Se&&st(this,_t,Jt).call(this,Se.propertiesToUpdate))}toggleSelected(Se){if(we(this,ve).has(Se)){we(this,ve).delete(Se),Se.unselect(),st(this,ct,Ht).call(this,{hasSelectedEditor:this.hasSelection});return}we(this,ve).add(Se),Se.select(),st(this,_t,Jt).call(this,Se.propertiesToUpdate),st(this,ct,Ht).call(this,{hasSelectedEditor:!0})}setSelected(Se){for(const tt of we(this,ve))tt!==Se&&tt.unselect();we(this,ve).clear(),we(this,ve).add(Se),Se.select(),st(this,_t,Jt).call(this,Se.propertiesToUpdate),st(this,ct,Ht).call(this,{hasSelectedEditor:!0})}isSelected(Se){return we(this,ve).has(Se)}unselect(Se){Se.unselect(),we(this,ve).delete(Se),st(this,ct,Ht).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return we(this,ve).size!==0}stopUndoAccumulation(){we(this,fe).stopUndoAccumulation()}undo(){we(this,fe).undo(),st(this,ct,Ht).call(this,{hasSomethingToUndo:we(this,fe).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:st(this,rt,en).call(this)})}redo(){we(this,fe).redo(),st(this,ct,Ht).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:we(this,fe).hasSomethingToRedo(),isEmpty:st(this,rt,en).call(this)})}addCommands(Se){we(this,fe).add(Se),st(this,ct,Ht).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:st(this,rt,en).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const Se=[...we(this,ve)],tt=()=>{for(const ht of Se)ht.remove()},ft=()=>{for(const ht of Se)st(this,nt,wn).call(this,ht)};this.addCommands({cmd:tt,undo:ft,mustExec:!0})}commitOrRemove(){var Se;(Se=we(this,pe))==null||Se.commitOrRemove()}hasSomethingToControl(){return we(this,pe)||this.hasSelection}selectAll(){for(const Se of we(this,ve))Se.commit();st(this,Pt,An).call(this,we(this,ye).values())}unselectAll(){if(we(this,pe)){we(this,pe).commitOrRemove();return}if(this.hasSelection){for(const Se of we(this,ve))Se.unselect();we(this,ve).clear(),st(this,ct,Ht).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(Se,tt,ft=!1){if(ft||this.commitOrRemove(),!this.hasSelection)return;we(this,We)[0]+=Se,we(this,We)[1]+=tt;const[ht,Re]=we(this,We),ke=[...we(this,ve)],He=1e3;we(this,Ye)&&clearTimeout(we(this,Ye)),dt(this,Ye,setTimeout(()=>{dt(this,Ye,null),we(this,We)[0]=we(this,We)[1]=0,this.addCommands({cmd:()=>{for(const Ue of ke)we(this,ye).has(Ue.id)&&Ue.translateInPage(ht,Re)},undo:()=>{for(const Ue of ke)we(this,ye).has(Ue.id)&&Ue.translateInPage(-ht,-Re)},mustExec:!1})},He));for(const Ue of ke)Ue.translateInPage(Se,tt)}isActive(Se){return we(this,pe)===Se}getActive(){return we(this,pe)}getMode(){return we(this,Pe)}get imageManager(){return(0,$.shadow)(this,"imageManager",new G)}};let te=Bt;pe=new WeakMap,ye=new WeakMap,_e=new WeakMap,De=new WeakMap,fe=new WeakMap,Ae=new WeakMap,Me=new WeakMap,Ee=new WeakMap,Te=new WeakMap,Be=new WeakMap,Xe=new WeakMap,ze=new WeakMap,Oe=new WeakMap,Pe=new WeakMap,ve=new WeakMap,be=new WeakMap,Ce=new WeakMap,Ne=new WeakMap,Ie=new WeakMap,Le=new WeakMap,je=new WeakMap,Ve=new WeakMap,ot=new WeakMap,lt=new WeakMap,me=new WeakMap,We=new WeakMap,Ye=new WeakMap,Fe=new WeakMap,xe=new WeakSet,Qn=function(){window.addEventListener("keydown",we(this,Le),{capture:!0})},Je=new WeakSet,vn=function(){window.removeEventListener("keydown",we(this,Le),{capture:!0})},qe=new WeakSet,Zn=function(){document.addEventListener("copy",we(this,Ce)),document.addEventListener("cut",we(this,Ne)),document.addEventListener("paste",we(this,Ie))},Ke=new WeakSet,Jn=function(){document.removeEventListener("copy",we(this,Ce)),document.removeEventListener("cut",we(this,Ne)),document.removeEventListener("paste",we(this,Ie))},ct=new WeakSet,Ht=function(Se){Object.entries(Se).some(([ft,ht])=>we(this,me)[ft]!==ht)&&we(this,Be).dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(we(this,me),Se)})},_t=new WeakSet,Jt=function(Se){we(this,Be).dispatch("annotationeditorparamschanged",{source:this,details:Se})},Et=new WeakSet,er=function(){if(!we(this,Oe)){dt(this,Oe,!0);for(const Se of we(this,_e).values())Se.enable()}},Tt=new WeakSet,tr=function(){if(this.unselectAll(),we(this,Oe)){dt(this,Oe,!1);for(const Se of we(this,_e).values())Se.disable()}},nt=new WeakSet,wn=function(Se){const tt=we(this,_e).get(Se.pageIndex);tt?tt.addOrRebuild(Se):this.addEditor(Se)},rt=new WeakSet,en=function(){if(we(this,ye).size===0)return!0;if(we(this,ye).size===1)for(const Se of we(this,ye).values())return Se.isEmpty();return!1},Pt=new WeakSet,An=function(Se){we(this,ve).clear();for(const tt of Se)tt.isEmpty()||(we(this,ve).add(tt),tt.select());st(this,ct,Ht).call(this,{hasSelectedEditor:!0})},$t(te,"TRANSLATE_SMALL",1),$t(te,"TRANSLATE_BIG",10),_.AnnotationEditorUIManager=te},(q,_,M)=>{var Ee,Te,Be,Xe,ze,Oe,Pe,ve,be,Ce,Ne,Ie,Kt,je,Yt,ot,Dn,me,on,Ye,ln,xe,tn,Je,nn;Object.defineProperty(_,"__esModule",{value:!0}),_.StatTimer=_.RenderingCancelledException=_.PixelsPerInch=_.PageViewport=_.PDFDateString=_.DOMStandardFontDataFactory=_.DOMSVGFactory=_.DOMFilterFactory=_.DOMCanvasFactory=_.DOMCMapReaderFactory=_.AnnotationPrefix=void 0,_.deprecated=he,_.getColorValues=_e,_.getCurrentTransform=De,_.getCurrentTransformInverse=fe,_.getFilenameFromUrl=oe,_.getPdfFilenameFromUrl=ue,_.getRGB=ye,_.getXfaPageViewport=pe,_.isDataScheme=se,_.isPdfFile=ie,_.isValidFetchUrl=ae,_.loadScript=le,_.setLayerDimensions=Ae;var $=M(7),j=M(1);const z="http://www.w3.org/2000/svg",V="pdfjs_internal_id_";_.AnnotationPrefix=V;const Me=class{};let X=Me;$t(X,"CSS",96),$t(X,"PDF",72),$t(X,"PDF_TO_CSS_UNITS",Me.CSS/Me.PDF),_.PixelsPerInch=X;class G extends $.BaseFilterFactory{constructor({docId:Ke,ownerDocument:et=globalThis.document}={}){super();Ze(this,Ie);Ze(this,je);Ze(this,ot);Ze(this,me);Ze(this,Ye);Ze(this,xe);Ze(this,Je);Ze(this,Ee,void 0);Ze(this,Te,void 0);Ze(this,Be,void 0);Ze(this,Xe,void 0);Ze(this,ze,void 0);Ze(this,Oe,void 0);Ze(this,Pe,void 0);Ze(this,ve,void 0);Ze(this,be,void 0);Ze(this,Ce,void 0);Ze(this,Ne,0);dt(this,Be,Ke),dt(this,Xe,et)}addFilter(Ke){if(!Ke)return"none";let et=we(this,Ie,Kt).get(Ke);if(et)return et;let ct,mt,_t,Ct;if(Ke.length===1){const At=Ke[0],nt=new Array(256);for(let it=0;it<256;it++)nt[it]=At[it]/255;Ct=ct=mt=_t=nt.join(",")}else{const[At,nt,it]=Ke,rt=new Array(256),gt=new Array(256),Pt=new Array(256);for(let St=0;St<256;St++)rt[St]=At[St]/255,gt[St]=nt[St]/255,Pt[St]=it[St]/255;ct=rt.join(","),mt=gt.join(","),_t=Pt.join(","),Ct=`${ct}${mt}${_t}`}if(et=we(this,Ie,Kt).get(Ct),et)return we(this,Ie,Kt).set(Ke,et),et;const Et=`g_${we(this,Be)}_transfer_map_${Wt(this,Ne)._++}`,xt=`url(#${Et})`;we(this,Ie,Kt).set(Ke,xt),we(this,Ie,Kt).set(Ct,xt);const Tt=st(this,me,on).call(this,Et);return st(this,xe,tn).call(this,ct,mt,_t,Tt),xt}addHCMFilter(Ke,et){var nt;const ct=`${Ke}-${et}`;if(we(this,Oe)===ct)return we(this,Pe);if(dt(this,Oe,ct),dt(this,Pe,"none"),(nt=we(this,ze))==null||nt.remove(),!Ke||!et)return we(this,Pe);const mt=st(this,Je,nn).call(this,Ke);Ke=j.Util.makeHexColor(...mt);const _t=st(this,Je,nn).call(this,et);if(et=j.Util.makeHexColor(..._t),we(this,je,Yt).style.color="",Ke==="#000000"&&et==="#ffffff"||Ke===et)return we(this,Pe);const Ct=new Array(256);for(let it=0;it<=255;it++){const rt=it/255;Ct[it]=rt<=.03928?rt/12.92:((rt+.055)/1.055)**2.4}const Et=Ct.join(","),xt=`g_${we(this,Be)}_hcm_filter`,Tt=dt(this,ve,st(this,me,on).call(this,xt));st(this,xe,tn).call(this,Et,Et,Et,Tt),st(this,ot,Dn).call(this,Tt);const At=(it,rt)=>{const gt=mt[it]/255,Pt=_t[it]/255,St=new Array(rt+1);for(let Bt=0;Bt<=rt;Bt++)St[Bt]=gt+Bt/rt*(Pt-gt);return St.join(",")};return st(this,xe,tn).call(this,At(0,5),At(1,5),At(2,5),Tt),dt(this,Pe,`url(#${xt})`),we(this,Pe)}addHighlightHCMFilter(Ke,et,ct,mt){var Pt;const _t=`${Ke}-${et}-${ct}-${mt}`;if(we(this,be)===_t)return we(this,Ce);if(dt(this,be,_t),dt(this,Ce,"none"),(Pt=we(this,ve))==null||Pt.remove(),!Ke||!et)return we(this,Ce);const[Ct,Et]=[Ke,et].map(st(this,Je,nn).bind(this));let xt=Math.round(.2126*Ct[0]+.7152*Ct[1]+.0722*Ct[2]),Tt=Math.round(.2126*Et[0]+.7152*Et[1]+.0722*Et[2]),[At,nt]=[ct,mt].map(st(this,Je,nn).bind(this));Tt<xt&&([xt,Tt,At,nt]=[Tt,xt,nt,At]),we(this,je,Yt).style.color="";const it=(St,Bt,Lt)=>{const Se=new Array(256),tt=(Tt-xt)/Lt,ft=St/255,ht=(Bt-St)/(255*Lt);let Re=0;for(let ke=0;ke<=Lt;ke++){const He=Math.round(xt+ke*tt),Ue=ft+ke*ht;for(let Qe=Re;Qe<=He;Qe++)Se[Qe]=Ue;Re=He+1}for(let ke=Re;ke<256;ke++)Se[ke]=Se[Re-1];return Se.join(",")},rt=`g_${we(this,Be)}_hcm_highlight_filter`,gt=dt(this,ve,st(this,me,on).call(this,rt));return st(this,ot,Dn).call(this,gt),st(this,xe,tn).call(this,it(At[0],nt[0],5),it(At[1],nt[1],5),it(At[2],nt[2],5),gt),dt(this,Ce,`url(#${rt})`),we(this,Ce)}destroy(Ke=!1){Ke&&(we(this,Pe)||we(this,Ce))||(we(this,Te)&&(we(this,Te).parentNode.parentNode.remove(),dt(this,Te,null)),we(this,Ee)&&(we(this,Ee).clear(),dt(this,Ee,null)),dt(this,Ne,0))}}Ee=new WeakMap,Te=new WeakMap,Be=new WeakMap,Xe=new WeakMap,ze=new WeakMap,Oe=new WeakMap,Pe=new WeakMap,ve=new WeakMap,be=new WeakMap,Ce=new WeakMap,Ne=new WeakMap,Ie=new WeakSet,Kt=function(){return we(this,Ee)||dt(this,Ee,new Map)},je=new WeakSet,Yt=function(){if(!we(this,Te)){const Ke=we(this,Xe).createElement("div"),{style:et}=Ke;et.visibility="hidden",et.contain="strict",et.width=et.height=0,et.position="absolute",et.top=et.left=0,et.zIndex=-1;const ct=we(this,Xe).createElementNS(z,"svg");ct.setAttribute("width",0),ct.setAttribute("height",0),dt(this,Te,we(this,Xe).createElementNS(z,"defs")),Ke.append(ct),ct.append(we(this,Te)),we(this,Xe).body.append(Ke)}return we(this,Te)},ot=new WeakSet,Dn=function(Ke){const et=we(this,Xe).createElementNS(z,"feColorMatrix");et.setAttribute("type","matrix"),et.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),Ke.append(et)},me=new WeakSet,on=function(Ke){const et=we(this,Xe).createElementNS(z,"filter");return et.setAttribute("color-interpolation-filters","sRGB"),et.setAttribute("id",Ke),we(this,je,Yt).append(et),et},Ye=new WeakSet,ln=function(Ke,et,ct){const mt=we(this,Xe).createElementNS(z,et);mt.setAttribute("type","discrete"),mt.setAttribute("tableValues",ct),Ke.append(mt)},xe=new WeakSet,tn=function(Ke,et,ct,mt){const _t=we(this,Xe).createElementNS(z,"feComponentTransfer");mt.append(_t),st(this,Ye,ln).call(this,_t,"feFuncR",Ke),st(this,Ye,ln).call(this,_t,"feFuncG",et),st(this,Ye,ln).call(this,_t,"feFuncB",ct)},Je=new WeakSet,nn=function(Ke){return we(this,je,Yt).style.color=Ke,ye(getComputedStyle(we(this,je,Yt)).getPropertyValue("color"))},_.DOMFilterFactory=G;class Y extends $.BaseCanvasFactory{constructor({ownerDocument:Ge=globalThis.document}={}){super(),this._document=Ge}_createCanvas(Ge,Ke){const et=this._document.createElement("canvas");return et.width=Ge,et.height=Ke,et}}_.DOMCanvasFactory=Y;async function Q(qe,Ge=!1){if(ae(qe,document.baseURI)){const Ke=await fetch(qe);if(!Ke.ok)throw new Error(Ke.statusText);return Ge?new Uint8Array(await Ke.arrayBuffer()):(0,j.stringToBytes)(await Ke.text())}return new Promise((Ke,et)=>{const ct=new XMLHttpRequest;ct.open("GET",qe,!0),Ge&&(ct.responseType="arraybuffer"),ct.onreadystatechange=()=>{if(ct.readyState===XMLHttpRequest.DONE){if(ct.status===200||ct.status===0){let mt;if(Ge&&ct.response?mt=new Uint8Array(ct.response):!Ge&&ct.responseText&&(mt=(0,j.stringToBytes)(ct.responseText)),mt){Ke(mt);return}}et(new Error(ct.statusText))}},ct.send(null)})}class ee extends $.BaseCMapReaderFactory{_fetchData(Ge,Ke){return Q(Ge,this.isCompressed).then(et=>({cMapData:et,compressionType:Ke}))}}_.DOMCMapReaderFactory=ee;class te extends $.BaseStandardFontDataFactory{_fetchData(Ge){return Q(Ge,!0)}}_.DOMStandardFontDataFactory=te;class Z extends $.BaseSVGFactory{_createSVG(Ge){return document.createElementNS(z,Ge)}}_.DOMSVGFactory=Z;class ne{constructor({viewBox:Ge,scale:Ke,rotation:et,offsetX:ct=0,offsetY:mt=0,dontFlip:_t=!1}){this.viewBox=Ge,this.scale=Ke,this.rotation=et,this.offsetX=ct,this.offsetY=mt;const Ct=(Ge[2]+Ge[0])/2,Et=(Ge[3]+Ge[1])/2;let xt,Tt,At,nt;switch(et%=360,et<0&&(et+=360),et){case 180:xt=-1,Tt=0,At=0,nt=1;break;case 90:xt=0,Tt=1,At=1,nt=0;break;case 270:xt=0,Tt=-1,At=-1,nt=0;break;case 0:xt=1,Tt=0,At=0,nt=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}_t&&(At=-At,nt=-nt);let it,rt,gt,Pt;xt===0?(it=Math.abs(Et-Ge[1])*Ke+ct,rt=Math.abs(Ct-Ge[0])*Ke+mt,gt=(Ge[3]-Ge[1])*Ke,Pt=(Ge[2]-Ge[0])*Ke):(it=Math.abs(Ct-Ge[0])*Ke+ct,rt=Math.abs(Et-Ge[1])*Ke+mt,gt=(Ge[2]-Ge[0])*Ke,Pt=(Ge[3]-Ge[1])*Ke),this.transform=[xt*Ke,Tt*Ke,At*Ke,nt*Ke,it-xt*Ke*Ct-At*Ke*Et,rt-Tt*Ke*Ct-nt*Ke*Et],this.width=gt,this.height=Pt}get rawDims(){const{viewBox:Ge}=this;return(0,j.shadow)(this,"rawDims",{pageWidth:Ge[2]-Ge[0],pageHeight:Ge[3]-Ge[1],pageX:Ge[0],pageY:Ge[1]})}clone({scale:Ge=this.scale,rotation:Ke=this.rotation,offsetX:et=this.offsetX,offsetY:ct=this.offsetY,dontFlip:mt=!1}={}){return new ne({viewBox:this.viewBox.slice(),scale:Ge,rotation:Ke,offsetX:et,offsetY:ct,dontFlip:mt})}convertToViewportPoint(Ge,Ke){return j.Util.applyTransform([Ge,Ke],this.transform)}convertToViewportRectangle(Ge){const Ke=j.Util.applyTransform([Ge[0],Ge[1]],this.transform),et=j.Util.applyTransform([Ge[2],Ge[3]],this.transform);return[Ke[0],Ke[1],et[0],et[1]]}convertToPdfPoint(Ge,Ke){return j.Util.applyInverseTransform([Ge,Ke],this.transform)}}_.PageViewport=ne;class re extends j.BaseException{constructor(Ge,Ke=0){super(Ge,"RenderingCancelledException"),this.extraDelay=Ke}}_.RenderingCancelledException=re;function se(qe){const Ge=qe.length;let Ke=0;for(;Ke<Ge&&qe[Ke].trim()==="";)Ke++;return qe.substring(Ke,Ke+5).toLowerCase()==="data:"}function ie(qe){return typeof qe=="string"&&/\.pdf$/i.test(qe)}function oe(qe,Ge=!1){return Ge||([qe]=qe.split(/[#?]/,1)),qe.substring(qe.lastIndexOf("/")+1)}function ue(qe,Ge="document.pdf"){if(typeof qe!="string")return Ge;if(se(qe))return(0,j.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),Ge;const Ke=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,et=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,ct=Ke.exec(qe);let mt=et.exec(ct[1])||et.exec(ct[2])||et.exec(ct[3]);if(mt&&(mt=mt[0],mt.includes("%")))try{mt=et.exec(decodeURIComponent(mt))[0]}catch{}return mt||Ge}class ce{constructor(){$t(this,"started",Object.create(null));$t(this,"times",[])}time(Ge){Ge in this.started&&(0,j.warn)(`Timer is already running for ${Ge}`),this.started[Ge]=Date.now()}timeEnd(Ge){Ge in this.started||(0,j.warn)(`Timer has not been started for ${Ge}`),this.times.push({name:Ge,start:this.started[Ge],end:Date.now()}),delete this.started[Ge]}toString(){const Ge=[];let Ke=0;for(const{name:et}of this.times)Ke=Math.max(et.length,Ke);for(const{name:et,start:ct,end:mt}of this.times)Ge.push(`${et.padEnd(Ke)} ${mt-ct}ms
`);return Ge.join("")}}_.StatTimer=ce;function ae(qe,Ge){try{const{protocol:Ke}=Ge?new URL(qe,Ge):new URL(qe);return Ke==="http:"||Ke==="https:"}catch{return!1}}function le(qe,Ge=!1){return new Promise((Ke,et)=>{const ct=document.createElement("script");ct.src=qe,ct.onload=function(mt){Ge&&ct.remove(),Ke(mt)},ct.onerror=function(){et(new Error(`Cannot load script at: ${ct.src}`))},(document.head||document.documentElement).append(ct)})}function he(qe){console.log("Deprecated API usage: "+qe)}let ge;class de{static toDateObject(Ge){if(!Ge||typeof Ge!="string")return null;ge||(ge=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const Ke=ge.exec(Ge);if(!Ke)return null;const et=parseInt(Ke[1],10);let ct=parseInt(Ke[2],10);ct=ct>=1&&ct<=12?ct-1:0;let mt=parseInt(Ke[3],10);mt=mt>=1&&mt<=31?mt:1;let _t=parseInt(Ke[4],10);_t=_t>=0&&_t<=23?_t:0;let Ct=parseInt(Ke[5],10);Ct=Ct>=0&&Ct<=59?Ct:0;let Et=parseInt(Ke[6],10);Et=Et>=0&&Et<=59?Et:0;const xt=Ke[7]||"Z";let Tt=parseInt(Ke[8],10);Tt=Tt>=0&&Tt<=23?Tt:0;let At=parseInt(Ke[9],10)||0;return At=At>=0&&At<=59?At:0,xt==="-"?(_t+=Tt,Ct+=At):xt==="+"&&(_t-=Tt,Ct-=At),new Date(Date.UTC(et,ct,mt,_t,Ct,Et))}}_.PDFDateString=de;function pe(qe,{scale:Ge=1,rotation:Ke=0}){const{width:et,height:ct}=qe.attributes.style,mt=[0,0,parseInt(et),parseInt(ct)];return new ne({viewBox:mt,scale:Ge,rotation:Ke})}function ye(qe){if(qe.startsWith("#")){const Ge=parseInt(qe.slice(1),16);return[(Ge&16711680)>>16,(Ge&65280)>>8,Ge&255]}return qe.startsWith("rgb(")?qe.slice(4,-1).split(",").map(Ge=>parseInt(Ge)):qe.startsWith("rgba(")?qe.slice(5,-1).split(",").map(Ge=>parseInt(Ge)).slice(0,3):((0,j.warn)(`Not a valid color format: "${qe}"`),[0,0,0])}function _e(qe){const Ge=document.createElement("span");Ge.style.visibility="hidden",document.body.append(Ge);for(const Ke of qe.keys()){Ge.style.color=Ke;const et=window.getComputedStyle(Ge).color;qe.set(Ke,ye(et))}Ge.remove()}function De(qe){const{a:Ge,b:Ke,c:et,d:ct,e:mt,f:_t}=qe.getTransform();return[Ge,Ke,et,ct,mt,_t]}function fe(qe){const{a:Ge,b:Ke,c:et,d:ct,e:mt,f:_t}=qe.getTransform().invertSelf();return[Ge,Ke,et,ct,mt,_t]}function Ae(qe,Ge,Ke=!1,et=!0){if(Ge instanceof ne){const{pageWidth:ct,pageHeight:mt}=Ge.rawDims,{style:_t}=qe,Ct=`calc(var(--scale-factor) * ${ct}px)`,Et=`calc(var(--scale-factor) * ${mt}px)`;!Ke||Ge.rotation%180===0?(_t.width=Ct,_t.height=Et):(_t.width=Et,_t.height=Ct)}et&&qe.setAttribute("data-main-rotation",Ge.rotation)}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.BaseStandardFontDataFactory=_.BaseSVGFactory=_.BaseFilterFactory=_.BaseCanvasFactory=_.BaseCMapReaderFactory=void 0;var $=M(1);class j{constructor(){this.constructor===j&&(0,$.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(Q){return"none"}addHCMFilter(Q,ee){return"none"}addHighlightHCMFilter(Q,ee,te,Z){return"none"}destroy(Q=!1){}}_.BaseFilterFactory=j;class z{constructor(){this.constructor===z&&(0,$.unreachable)("Cannot initialize BaseCanvasFactory.")}create(Q,ee){if(Q<=0||ee<=0)throw new Error("Invalid canvas size");const te=this._createCanvas(Q,ee);return{canvas:te,context:te.getContext("2d")}}reset(Q,ee,te){if(!Q.canvas)throw new Error("Canvas is not specified");if(ee<=0||te<=0)throw new Error("Invalid canvas size");Q.canvas.width=ee,Q.canvas.height=te}destroy(Q){if(!Q.canvas)throw new Error("Canvas is not specified");Q.canvas.width=0,Q.canvas.height=0,Q.canvas=null,Q.context=null}_createCanvas(Q,ee){(0,$.unreachable)("Abstract method `_createCanvas` called.")}}_.BaseCanvasFactory=z;class V{constructor({baseUrl:Q=null,isCompressed:ee=!0}){this.constructor===V&&(0,$.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=Q,this.isCompressed=ee}async fetch({name:Q}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!Q)throw new Error("CMap name must be specified.");const ee=this.baseUrl+Q+(this.isCompressed?".bcmap":""),te=this.isCompressed?$.CMapCompressionType.BINARY:$.CMapCompressionType.NONE;return this._fetchData(ee,te).catch(Z=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${ee}`)})}_fetchData(Q,ee){(0,$.unreachable)("Abstract method `_fetchData` called.")}}_.BaseCMapReaderFactory=V;class X{constructor({baseUrl:Q=null}){this.constructor===X&&(0,$.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=Q}async fetch({filename:Q}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!Q)throw new Error("Font filename must be specified.");const ee=`${this.baseUrl}${Q}`;return this._fetchData(ee).catch(te=>{throw new Error(`Unable to load font data at: ${ee}`)})}_fetchData(Q){(0,$.unreachable)("Abstract method `_fetchData` called.")}}_.BaseStandardFontDataFactory=X;class G{constructor(){this.constructor===G&&(0,$.unreachable)("Cannot initialize BaseSVGFactory.")}create(Q,ee,te=!1){if(Q<=0||ee<=0)throw new Error("Invalid SVG dimensions");const Z=this._createSVG("svg:svg");return Z.setAttribute("version","1.1"),te||(Z.setAttribute("width",`${Q}px`),Z.setAttribute("height",`${ee}px`)),Z.setAttribute("preserveAspectRatio","none"),Z.setAttribute("viewBox",`0 0 ${Q} ${ee}`),Z}createElement(Q){if(typeof Q!="string")throw new Error("Invalid SVG element type");return this._createSVG(Q)}_createSVG(Q){(0,$.unreachable)("Abstract method `_createSVG` called.")}}_.BaseSVGFactory=G},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.MurmurHash3_64=void 0;var $=M(1);const j=3285377520,z=4294901760,V=65535;class X{constructor(Y){this.h1=Y?Y&4294967295:j,this.h2=Y?Y&4294967295:j}update(Y){let Q,ee;if(typeof Y=="string"){Q=new Uint8Array(Y.length*2),ee=0;for(let he=0,ge=Y.length;he<ge;he++){const de=Y.charCodeAt(he);de<=255?Q[ee++]=de:(Q[ee++]=de>>>8,Q[ee++]=de&255)}}else if((0,$.isArrayBuffer)(Y))Q=Y.slice(),ee=Q.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const te=ee>>2,Z=ee-te*4,ne=new Uint32Array(Q.buffer,0,te);let re=0,se=0,ie=this.h1,oe=this.h2;const ue=3432918353,ce=461845907,ae=ue&V,le=ce&V;for(let he=0;he<te;he++)he&1?(re=ne[he],re=re*ue&z|re*ae&V,re=re<<15|re>>>17,re=re*ce&z|re*le&V,ie^=re,ie=ie<<13|ie>>>19,ie=ie*5+3864292196):(se=ne[he],se=se*ue&z|se*ae&V,se=se<<15|se>>>17,se=se*ce&z|se*le&V,oe^=se,oe=oe<<13|oe>>>19,oe=oe*5+3864292196);switch(re=0,Z){case 3:re^=Q[te*4+2]<<16;case 2:re^=Q[te*4+1]<<8;case 1:re^=Q[te*4],re=re*ue&z|re*ae&V,re=re<<15|re>>>17,re=re*ce&z|re*le&V,te&1?ie^=re:oe^=re}this.h1=ie,this.h2=oe}hexdigest(){let Y=this.h1,Q=this.h2;return Y^=Q>>>1,Y=Y*3981806797&z|Y*36045&V,Q=Q*4283543511&z|((Q<<16|Y>>>16)*2950163797&z)>>>16,Y^=Q>>>1,Y=Y*444984403&z|Y*60499&V,Q=Q*3301882366&z|((Q<<16|Y>>>16)*3120437893&z)>>>16,Y^=Q>>>1,(Y>>>0).toString(16).padStart(8,"0")+(Q>>>0).toString(16).padStart(8,"0")}}_.MurmurHash3_64=X},(q,_,M)=>{var V;Object.defineProperty(_,"__esModule",{value:!0}),_.FontLoader=_.FontFaceObject=void 0;var $=M(1);class j{constructor({ownerDocument:G=globalThis.document,styleElement:Y=null}){Ze(this,V,new Set);this._document=G,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(G){this.nativeFontFaces.add(G),this._document.fonts.add(G)}removeNativeFontFace(G){this.nativeFontFaces.delete(G),this._document.fonts.delete(G)}insertRule(G){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const Y=this.styleElement.sheet;Y.insertRule(G,Y.cssRules.length)}clear(){for(const G of this.nativeFontFaces)this._document.fonts.delete(G);this.nativeFontFaces.clear(),we(this,V).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(G){if(!(!G||we(this,V).has(G.loadedName))){if((0,$.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:Y,src:Q,style:ee}=G,te=new FontFace(Y,Q,ee);this.addNativeFontFace(te);try{await te.load(),we(this,V).add(Y)}catch{(0,$.warn)(`Cannot load system font: ${G.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(te)}return}(0,$.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(G){if(G.attached||G.missingFile&&!G.systemFontInfo)return;if(G.attached=!0,G.systemFontInfo){await this.loadSystemFont(G.systemFontInfo);return}if(this.isFontLoadingAPISupported){const Q=G.createNativeFontFace();if(Q){this.addNativeFontFace(Q);try{await Q.loaded}catch(ee){throw(0,$.warn)(`Failed to load font '${Q.family}': '${ee}'.`),G.disableFontFace=!0,ee}}return}const Y=G.createFontFaceRule();if(Y){if(this.insertRule(Y),this.isSyncFontLoadingSupported)return;await new Promise(Q=>{const ee=this._queueLoadingCallback(Q);this._prepareFontLoadEvent(G,ee)})}}get isFontLoadingAPISupported(){var Y;const G=!!((Y=this._document)!=null&&Y.fonts);return(0,$.shadow)(this,"isFontLoadingAPISupported",G)}get isSyncFontLoadingSupported(){let G=!1;return($.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(G=!0),(0,$.shadow)(this,"isSyncFontLoadingSupported",G)}_queueLoadingCallback(G){function Y(){for((0,$.assert)(!ee.done,"completeRequest() cannot be called twice."),ee.done=!0;Q.length>0&&Q[0].done;){const te=Q.shift();setTimeout(te.callback,0)}}const{loadingRequests:Q}=this,ee={done:!1,complete:Y,callback:G};return Q.push(ee),ee}get _loadTestFont(){const G=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,$.shadow)(this,"_loadTestFont",G)}_prepareFontLoadEvent(G,Y){function Q(ye,_e){return ye.charCodeAt(_e)<<24|ye.charCodeAt(_e+1)<<16|ye.charCodeAt(_e+2)<<8|ye.charCodeAt(_e+3)&255}function ee(ye,_e,De,fe){const Ae=ye.substring(0,_e),Me=ye.substring(_e+De);return Ae+fe+Me}let te,Z;const ne=this._document.createElement("canvas");ne.width=1,ne.height=1;const re=ne.getContext("2d");let se=0;function ie(ye,_e){if(++se>30){(0,$.warn)("Load test font never loaded."),_e();return}if(re.font="30px "+ye,re.fillText(".",0,20),re.getImageData(0,0,1,1).data[3]>0){_e();return}setTimeout(ie.bind(null,ye,_e))}const oe=`lt${Date.now()}${this.loadTestFontId++}`;let ue=this._loadTestFont;ue=ee(ue,976,oe.length,oe);const ae=16,le=1482184792;let he=Q(ue,ae);for(te=0,Z=oe.length-3;te<Z;te+=4)he=he-le+Q(oe,te)|0;te<oe.length&&(he=he-le+Q(oe+"XXX",te)|0),ue=ee(ue,ae,4,(0,$.string32)(he));const ge=`url(data:font/opentype;base64,${btoa(ue)});`,de=`@font-face {font-family:"${oe}";src:${ge}}`;this.insertRule(de);const pe=this._document.createElement("div");pe.style.visibility="hidden",pe.style.width=pe.style.height="10px",pe.style.position="absolute",pe.style.top=pe.style.left="0px";for(const ye of[G.loadedName,oe]){const _e=this._document.createElement("span");_e.textContent="Hi",_e.style.fontFamily=ye,pe.append(_e)}this._document.body.append(pe),ie(oe,()=>{pe.remove(),Y.complete()})}}V=new WeakMap,_.FontLoader=j;class z{constructor(G,{isEvalSupported:Y=!0,disableFontFace:Q=!1,ignoreErrors:ee=!1,inspectFont:te=null}){this.compiledGlyphs=Object.create(null);for(const Z in G)this[Z]=G[Z];this.isEvalSupported=Y!==!1,this.disableFontFace=Q===!0,this.ignoreErrors=ee===!0,this._inspectFont=te}createNativeFontFace(){var Y;if(!this.data||this.disableFontFace)return null;let G;if(!this.cssFontInfo)G=new FontFace(this.loadedName,this.data,{});else{const Q={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(Q.style=`oblique ${this.cssFontInfo.italicAngle}deg`),G=new FontFace(this.cssFontInfo.fontFamily,this.data,Q)}return(Y=this._inspectFont)==null||Y.call(this,this),G}createFontFaceRule(){var ee;if(!this.data||this.disableFontFace)return null;const G=(0,$.bytesToString)(this.data),Y=`url(data:${this.mimetype};base64,${btoa(G)});`;let Q;if(!this.cssFontInfo)Q=`@font-face {font-family:"${this.loadedName}";src:${Y}}`;else{let te=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(te+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),Q=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${te}src:${Y}}`}return(ee=this._inspectFont)==null||ee.call(this,this,Y),Q}getPathGenerator(G,Y){if(this.compiledGlyphs[Y]!==void 0)return this.compiledGlyphs[Y];let Q;try{Q=G.get(this.loadedName+"_path_"+Y)}catch(ee){if(!this.ignoreErrors)throw ee;return(0,$.warn)(`getPathGenerator - ignoring character: "${ee}".`),this.compiledGlyphs[Y]=function(te,Z){}}if(this.isEvalSupported&&$.FeatureTest.isEvalSupported){const ee=[];for(const te of Q){const Z=te.args!==void 0?te.args.join(","):"";ee.push("c.",te.cmd,"(",Z,`);
`)}return this.compiledGlyphs[Y]=new Function("c","size",ee.join(""))}return this.compiledGlyphs[Y]=function(ee,te){for(const Z of Q)Z.cmd==="scale"&&(Z.args=[te,-te]),ee[Z.cmd].apply(ee,Z.args)}}}_.FontFaceObject=z},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.NodeStandardFontDataFactory=_.NodeFilterFactory=_.NodeCanvasFactory=_.NodeCMapReaderFactory=void 0;var $=M(7);M(1);const j=function(Y){return new Promise((Q,ee)=>{require$$5.readFile(Y,(Z,ne)=>{if(Z||!ne){ee(new Error(Z));return}Q(new Uint8Array(ne))})})};class z extends $.BaseFilterFactory{}_.NodeFilterFactory=z;class V extends $.BaseCanvasFactory{_createCanvas(Q,ee){return require$$5.createCanvas(Q,ee)}}_.NodeCanvasFactory=V;class X extends $.BaseCMapReaderFactory{_fetchData(Q,ee){return j(Q).then(te=>({cMapData:te,compressionType:ee}))}}_.NodeCMapReaderFactory=X;class G extends $.BaseStandardFontDataFactory{_fetchData(Q){return j(Q)}}_.NodeStandardFontDataFactory=G},(q,_,M)=>{var Te,En,Xe,kn;Object.defineProperty(_,"__esModule",{value:!0}),_.CanvasGraphics=void 0;var $=M(1),j=M(6),z=M(12),V=M(13);const X=16,G=100,Y=4096,Q=15,ee=10,te=1e3,Z=16;function ne(Pe,ve){if(Pe._removeMirroring)throw new Error("Context is already forwarding operations.");Pe.__originalSave=Pe.save,Pe.__originalRestore=Pe.restore,Pe.__originalRotate=Pe.rotate,Pe.__originalScale=Pe.scale,Pe.__originalTranslate=Pe.translate,Pe.__originalTransform=Pe.transform,Pe.__originalSetTransform=Pe.setTransform,Pe.__originalResetTransform=Pe.resetTransform,Pe.__originalClip=Pe.clip,Pe.__originalMoveTo=Pe.moveTo,Pe.__originalLineTo=Pe.lineTo,Pe.__originalBezierCurveTo=Pe.bezierCurveTo,Pe.__originalRect=Pe.rect,Pe.__originalClosePath=Pe.closePath,Pe.__originalBeginPath=Pe.beginPath,Pe._removeMirroring=()=>{Pe.save=Pe.__originalSave,Pe.restore=Pe.__originalRestore,Pe.rotate=Pe.__originalRotate,Pe.scale=Pe.__originalScale,Pe.translate=Pe.__originalTranslate,Pe.transform=Pe.__originalTransform,Pe.setTransform=Pe.__originalSetTransform,Pe.resetTransform=Pe.__originalResetTransform,Pe.clip=Pe.__originalClip,Pe.moveTo=Pe.__originalMoveTo,Pe.lineTo=Pe.__originalLineTo,Pe.bezierCurveTo=Pe.__originalBezierCurveTo,Pe.rect=Pe.__originalRect,Pe.closePath=Pe.__originalClosePath,Pe.beginPath=Pe.__originalBeginPath,delete Pe._removeMirroring},Pe.save=function(){ve.save(),this.__originalSave()},Pe.restore=function(){ve.restore(),this.__originalRestore()},Pe.translate=function(Ce,Ne){ve.translate(Ce,Ne),this.__originalTranslate(Ce,Ne)},Pe.scale=function(Ce,Ne){ve.scale(Ce,Ne),this.__originalScale(Ce,Ne)},Pe.transform=function(Ce,Ne,Ie,Le,je,Ve){ve.transform(Ce,Ne,Ie,Le,je,Ve),this.__originalTransform(Ce,Ne,Ie,Le,je,Ve)},Pe.setTransform=function(Ce,Ne,Ie,Le,je,Ve){ve.setTransform(Ce,Ne,Ie,Le,je,Ve),this.__originalSetTransform(Ce,Ne,Ie,Le,je,Ve)},Pe.resetTransform=function(){ve.resetTransform(),this.__originalResetTransform()},Pe.rotate=function(Ce){ve.rotate(Ce),this.__originalRotate(Ce)},Pe.clip=function(Ce){ve.clip(Ce),this.__originalClip(Ce)},Pe.moveTo=function(be,Ce){ve.moveTo(be,Ce),this.__originalMoveTo(be,Ce)},Pe.lineTo=function(be,Ce){ve.lineTo(be,Ce),this.__originalLineTo(be,Ce)},Pe.bezierCurveTo=function(be,Ce,Ne,Ie,Le,je){ve.bezierCurveTo(be,Ce,Ne,Ie,Le,je),this.__originalBezierCurveTo(be,Ce,Ne,Ie,Le,je)},Pe.rect=function(be,Ce,Ne,Ie){ve.rect(be,Ce,Ne,Ie),this.__originalRect(be,Ce,Ne,Ie)},Pe.closePath=function(){ve.closePath(),this.__originalClosePath()},Pe.beginPath=function(){ve.beginPath(),this.__originalBeginPath()}}class re{constructor(ve){this.canvasFactory=ve,this.cache=Object.create(null)}getCanvas(ve,be,Ce){let Ne;return this.cache[ve]!==void 0?(Ne=this.cache[ve],this.canvasFactory.reset(Ne,be,Ce)):(Ne=this.canvasFactory.create(be,Ce),this.cache[ve]=Ne),Ne}delete(ve){delete this.cache[ve]}clear(){for(const ve in this.cache){const be=this.cache[ve];this.canvasFactory.destroy(be),delete this.cache[ve]}}}function se(Pe,ve,be,Ce,Ne,Ie,Le,je,Ve,ot){const[lt,me,We,Ye,Fe,xe]=(0,j.getCurrentTransform)(Pe);if(me===0&&We===0){const ut=Le*lt+Fe,qe=Math.round(ut),Ge=je*Ye+xe,Ke=Math.round(Ge),et=(Le+Ve)*lt+Fe,ct=Math.abs(Math.round(et)-qe)||1,mt=(je+ot)*Ye+xe,_t=Math.abs(Math.round(mt)-Ke)||1;return Pe.setTransform(Math.sign(lt),0,0,Math.sign(Ye),qe,Ke),Pe.drawImage(ve,be,Ce,Ne,Ie,0,0,ct,_t),Pe.setTransform(lt,me,We,Ye,Fe,xe),[ct,_t]}if(lt===0&&Ye===0){const ut=je*We+Fe,qe=Math.round(ut),Ge=Le*me+xe,Ke=Math.round(Ge),et=(je+ot)*We+Fe,ct=Math.abs(Math.round(et)-qe)||1,mt=(Le+Ve)*me+xe,_t=Math.abs(Math.round(mt)-Ke)||1;return Pe.setTransform(0,Math.sign(me),Math.sign(We),0,qe,Ke),Pe.drawImage(ve,be,Ce,Ne,Ie,0,0,_t,ct),Pe.setTransform(lt,me,We,Ye,Fe,xe),[_t,ct]}Pe.drawImage(ve,be,Ce,Ne,Ie,Le,je,Ve,ot);const $e=Math.hypot(lt,me),Je=Math.hypot(We,Ye);return[$e*Ve,Je*ot]}function ie(Pe){const{width:ve,height:be}=Pe;if(ve>te||be>te)return null;const Ce=1e3,Ne=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),Ie=ve+1;let Le=new Uint8Array(Ie*(be+1)),je,Ve,ot;const lt=ve+7&-8;let me=new Uint8Array(lt*be),We=0;for(const Je of Pe.data){let ut=128;for(;ut>0;)me[We++]=Je&ut?0:255,ut>>=1}let Ye=0;for(We=0,me[We]!==0&&(Le[0]=1,++Ye),Ve=1;Ve<ve;Ve++)me[We]!==me[We+1]&&(Le[Ve]=me[We]?2:1,++Ye),We++;for(me[We]!==0&&(Le[Ve]=2,++Ye),je=1;je<be;je++){We=je*lt,ot=je*Ie,me[We-lt]!==me[We]&&(Le[ot]=me[We]?1:8,++Ye);let Je=(me[We]?4:0)+(me[We-lt]?8:0);for(Ve=1;Ve<ve;Ve++)Je=(Je>>2)+(me[We+1]?4:0)+(me[We-lt+1]?8:0),Ne[Je]&&(Le[ot+Ve]=Ne[Je],++Ye),We++;if(me[We-lt]!==me[We]&&(Le[ot+Ve]=me[We]?2:4,++Ye),Ye>Ce)return null}for(We=lt*(be-1),ot=je*Ie,me[We]!==0&&(Le[ot]=8,++Ye),Ve=1;Ve<ve;Ve++)me[We]!==me[We+1]&&(Le[ot+Ve]=me[We]?4:8,++Ye),We++;if(me[We]!==0&&(Le[ot+Ve]=4,++Ye),Ye>Ce)return null;const Fe=new Int32Array([0,Ie,-1,0,-Ie,0,0,0,1]),xe=new Path2D;for(je=0;Ye&&je<=be;je++){let Je=je*Ie;const ut=Je+ve;for(;Je<ut&&!Le[Je];)Je++;if(Je===ut)continue;xe.moveTo(Je%Ie,je);const qe=Je;let Ge=Le[Je];do{const Ke=Fe[Ge];do Je+=Ke;while(!Le[Je]);const et=Le[Je];et!==5&&et!==10?(Ge=et,Le[Je]=0):(Ge=et&51*Ge>>4,Le[Je]&=Ge>>2|Ge<<2),xe.lineTo(Je%Ie,Je/Ie|0),Le[Je]||--Ye}while(qe!==Je);--je}return me=null,Le=null,function(Je){Je.save(),Je.scale(1/ve,-1/be),Je.translate(0,-be),Je.fill(xe),Je.beginPath(),Je.restore()}}class oe{constructor(ve,be){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=$.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=$.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=$.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,ve,be])}clone(){const ve=Object.create(this);return ve.clipBox=this.clipBox.slice(),ve}setCurrentPoint(ve,be){this.x=ve,this.y=be}updatePathMinMax(ve,be,Ce){[be,Ce]=$.Util.applyTransform([be,Ce],ve),this.minX=Math.min(this.minX,be),this.minY=Math.min(this.minY,Ce),this.maxX=Math.max(this.maxX,be),this.maxY=Math.max(this.maxY,Ce)}updateRectMinMax(ve,be){const Ce=$.Util.applyTransform(be,ve),Ne=$.Util.applyTransform(be.slice(2),ve);this.minX=Math.min(this.minX,Ce[0],Ne[0]),this.minY=Math.min(this.minY,Ce[1],Ne[1]),this.maxX=Math.max(this.maxX,Ce[0],Ne[0]),this.maxY=Math.max(this.maxY,Ce[1],Ne[1])}updateScalingPathMinMax(ve,be){$.Util.scaleMinMax(ve,be),this.minX=Math.min(this.minX,be[0]),this.maxX=Math.max(this.maxX,be[1]),this.minY=Math.min(this.minY,be[2]),this.maxY=Math.max(this.maxY,be[3])}updateCurvePathMinMax(ve,be,Ce,Ne,Ie,Le,je,Ve,ot,lt){const me=$.Util.bezierBoundingBox(be,Ce,Ne,Ie,Le,je,Ve,ot);if(lt){lt[0]=Math.min(lt[0],me[0],me[2]),lt[1]=Math.max(lt[1],me[0],me[2]),lt[2]=Math.min(lt[2],me[1],me[3]),lt[3]=Math.max(lt[3],me[1],me[3]);return}this.updateRectMinMax(ve,me)}getPathBoundingBox(ve=z.PathType.FILL,be=null){const Ce=[this.minX,this.minY,this.maxX,this.maxY];if(ve===z.PathType.STROKE){be||(0,$.unreachable)("Stroke bounding box must include transform.");const Ne=$.Util.singularValueDecompose2dScale(be),Ie=Ne[0]*this.lineWidth/2,Le=Ne[1]*this.lineWidth/2;Ce[0]-=Ie,Ce[1]-=Le,Ce[2]+=Ie,Ce[3]+=Le}return Ce}updateClipFromPath(){const ve=$.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(ve||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(ve){this.clipBox=ve,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(ve=z.PathType.FILL,be=null){return $.Util.intersect(this.clipBox,this.getPathBoundingBox(ve,be))}}function ue(Pe,ve){if(typeof ImageData<"u"&&ve instanceof ImageData){Pe.putImageData(ve,0,0);return}const be=ve.height,Ce=ve.width,Ne=be%Z,Ie=(be-Ne)/Z,Le=Ne===0?Ie:Ie+1,je=Pe.createImageData(Ce,Z);let Ve=0,ot;const lt=ve.data,me=je.data;let We,Ye,Fe,xe;if(ve.kind===$.ImageKind.GRAYSCALE_1BPP){const $e=lt.byteLength,Je=new Uint32Array(me.buffer,0,me.byteLength>>2),ut=Je.length,qe=Ce+7>>3,Ge=4294967295,Ke=$.FeatureTest.isLittleEndian?4278190080:255;for(We=0;We<Le;We++){for(Fe=We<Ie?Z:Ne,ot=0,Ye=0;Ye<Fe;Ye++){const et=$e-Ve;let ct=0;const mt=et>qe?Ce:et*8-7,_t=mt&-8;let Ct=0,Et=0;for(;ct<_t;ct+=8)Et=lt[Ve++],Je[ot++]=Et&128?Ge:Ke,Je[ot++]=Et&64?Ge:Ke,Je[ot++]=Et&32?Ge:Ke,Je[ot++]=Et&16?Ge:Ke,Je[ot++]=Et&8?Ge:Ke,Je[ot++]=Et&4?Ge:Ke,Je[ot++]=Et&2?Ge:Ke,Je[ot++]=Et&1?Ge:Ke;for(;ct<mt;ct++)Ct===0&&(Et=lt[Ve++],Ct=128),Je[ot++]=Et&Ct?Ge:Ke,Ct>>=1}for(;ot<ut;)Je[ot++]=0;Pe.putImageData(je,0,We*Z)}}else if(ve.kind===$.ImageKind.RGBA_32BPP){for(Ye=0,xe=Ce*Z*4,We=0;We<Ie;We++)me.set(lt.subarray(Ve,Ve+xe)),Ve+=xe,Pe.putImageData(je,0,Ye),Ye+=Z;We<Le&&(xe=Ce*Ne*4,me.set(lt.subarray(Ve,Ve+xe)),Pe.putImageData(je,0,Ye))}else if(ve.kind===$.ImageKind.RGB_24BPP)for(Fe=Z,xe=Ce*Fe,We=0;We<Le;We++){for(We>=Ie&&(Fe=Ne,xe=Ce*Fe),ot=0,Ye=xe;Ye--;)me[ot++]=lt[Ve++],me[ot++]=lt[Ve++],me[ot++]=lt[Ve++],me[ot++]=255;Pe.putImageData(je,0,We*Z)}else throw new Error(`bad image kind: ${ve.kind}`)}function ce(Pe,ve){if(ve.bitmap){Pe.drawImage(ve.bitmap,0,0);return}const be=ve.height,Ce=ve.width,Ne=be%Z,Ie=(be-Ne)/Z,Le=Ne===0?Ie:Ie+1,je=Pe.createImageData(Ce,Z);let Ve=0;const ot=ve.data,lt=je.data;for(let me=0;me<Le;me++){const We=me<Ie?Z:Ne;({srcPos:Ve}=(0,V.convertBlackAndWhiteToRGBA)({src:ot,srcPos:Ve,dest:lt,width:Ce,height:We,nonBlackColor:0})),Pe.putImageData(je,0,me*Z)}}function ae(Pe,ve){const be=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const Ce of be)Pe[Ce]!==void 0&&(ve[Ce]=Pe[Ce]);Pe.setLineDash!==void 0&&(ve.setLineDash(Pe.getLineDash()),ve.lineDashOffset=Pe.lineDashOffset)}function le(Pe){if(Pe.strokeStyle=Pe.fillStyle="#000000",Pe.fillRule="nonzero",Pe.globalAlpha=1,Pe.lineWidth=1,Pe.lineCap="butt",Pe.lineJoin="miter",Pe.miterLimit=10,Pe.globalCompositeOperation="source-over",Pe.font="10px sans-serif",Pe.setLineDash!==void 0&&(Pe.setLineDash([]),Pe.lineDashOffset=0),!$.isNodeJS){const{filter:ve}=Pe;ve!=="none"&&ve!==""&&(Pe.filter="none")}}function he(Pe,ve,be,Ce){const Ne=Pe.length;for(let Ie=3;Ie<Ne;Ie+=4){const Le=Pe[Ie];if(Le===0)Pe[Ie-3]=ve,Pe[Ie-2]=be,Pe[Ie-1]=Ce;else if(Le<255){const je=255-Le;Pe[Ie-3]=Pe[Ie-3]*Le+ve*je>>8,Pe[Ie-2]=Pe[Ie-2]*Le+be*je>>8,Pe[Ie-1]=Pe[Ie-1]*Le+Ce*je>>8}}}function ge(Pe,ve,be){const Ce=Pe.length,Ne=1/255;for(let Ie=3;Ie<Ce;Ie+=4){const Le=be?be[Pe[Ie]]:Pe[Ie];ve[Ie]=ve[Ie]*Le*Ne|0}}function de(Pe,ve,be){const Ce=Pe.length;for(let Ne=3;Ne<Ce;Ne+=4){const Ie=Pe[Ne-3]*77+Pe[Ne-2]*152+Pe[Ne-1]*28;ve[Ne]=be?ve[Ne]*be[Ie>>8]>>8:ve[Ne]*Ie>>16}}function pe(Pe,ve,be,Ce,Ne,Ie,Le,je,Ve,ot,lt){const me=!!Ie,We=me?Ie[0]:0,Ye=me?Ie[1]:0,Fe=me?Ie[2]:0,xe=Ne==="Luminosity"?de:ge,Je=Math.min(Ce,Math.ceil(1048576/be));for(let ut=0;ut<Ce;ut+=Je){const qe=Math.min(Je,Ce-ut),Ge=Pe.getImageData(je-ot,ut+(Ve-lt),be,qe),Ke=ve.getImageData(je,ut+Ve,be,qe);me&&he(Ge.data,We,Ye,Fe),xe(Ge.data,Ke.data,Le),ve.putImageData(Ke,je,ut+Ve)}}function ye(Pe,ve,be,Ce){const Ne=Ce[0],Ie=Ce[1],Le=Ce[2]-Ne,je=Ce[3]-Ie;Le===0||je===0||(pe(ve.context,be,Le,je,ve.subtype,ve.backdrop,ve.transferMap,Ne,Ie,ve.offsetX,ve.offsetY),Pe.save(),Pe.globalAlpha=1,Pe.globalCompositeOperation="source-over",Pe.setTransform(1,0,0,1,0,0),Pe.drawImage(be.canvas,0,0),Pe.restore())}function _e(Pe,ve){const be=$.Util.singularValueDecompose2dScale(Pe);be[0]=Math.fround(be[0]),be[1]=Math.fround(be[1]);const Ce=Math.fround((globalThis.devicePixelRatio||1)*j.PixelsPerInch.PDF_TO_CSS_UNITS);return ve!==void 0?ve:be[0]<=Ce||be[1]<=Ce}const De=["butt","round","square"],fe=["miter","round","bevel"],Ae={},Me={},Oe=class{constructor(ve,be,Ce,Ne,Ie,{optionalContentConfig:Le,markedContentStack:je=null},Ve,ot){Ze(this,Te);Ze(this,Xe);this.ctx=ve,this.current=new oe(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=be,this.objs=Ce,this.canvasFactory=Ne,this.filterFactory=Ie,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=je||[],this.optionalContentConfig=Le,this.cachedCanvases=new re(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=Ve,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=ot,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(ve,be=null){return typeof ve=="string"?ve.startsWith("g_")?this.commonObjs.get(ve):this.objs.get(ve):be}beginDrawing({transform:ve,viewport:be,transparency:Ce=!1,background:Ne=null}){const Ie=this.ctx.canvas.width,Le=this.ctx.canvas.height,je=this.ctx.fillStyle;if(this.ctx.fillStyle=Ne||"#ffffff",this.ctx.fillRect(0,0,Ie,Le),this.ctx.fillStyle=je,Ce){const Ve=this.cachedCanvases.getCanvas("transparent",Ie,Le);this.compositeCtx=this.ctx,this.transparentCanvas=Ve.canvas,this.ctx=Ve.context,this.ctx.save(),this.ctx.transform(...(0,j.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),le(this.ctx),ve&&(this.ctx.transform(...ve),this.outputScaleX=ve[0],this.outputScaleY=ve[0]),this.ctx.transform(...be.transform),this.viewportScale=be.scale,this.baseTransform=(0,j.getCurrentTransform)(this.ctx)}executeOperatorList(ve,be,Ce,Ne){const Ie=ve.argsArray,Le=ve.fnArray;let je=be||0;const Ve=Ie.length;if(Ve===je)return je;const ot=Ve-je>ee&&typeof Ce=="function",lt=ot?Date.now()+Q:0;let me=0;const We=this.commonObjs,Ye=this.objs;let Fe;for(;;){if(Ne!==void 0&&je===Ne.nextBreakPoint)return Ne.breakIt(je,Ce),je;if(Fe=Le[je],Fe!==$.OPS.dependency)this[Fe].apply(this,Ie[je]);else for(const xe of Ie[je]){const $e=xe.startsWith("g_")?We:Ye;if(!$e.has(xe))return $e.get(xe,Ce),je}if(je++,je===Ve)return je;if(ot&&++me>ee){if(Date.now()>lt)return Ce(),je;me=0}}}endDrawing(){st(this,Te,En).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const ve of this._cachedBitmapsMap.values()){for(const be of ve.values())typeof HTMLCanvasElement<"u"&&be instanceof HTMLCanvasElement&&(be.width=be.height=0);ve.clear()}this._cachedBitmapsMap.clear(),st(this,Xe,kn).call(this)}_scaleImage(ve,be){const Ce=ve.width,Ne=ve.height;let Ie=Math.max(Math.hypot(be[0],be[1]),1),Le=Math.max(Math.hypot(be[2],be[3]),1),je=Ce,Ve=Ne,ot="prescale1",lt,me;for(;Ie>2&&je>1||Le>2&&Ve>1;){let We=je,Ye=Ve;Ie>2&&je>1&&(We=je>=16384?Math.floor(je/2)-1||1:Math.ceil(je/2),Ie/=je/We),Le>2&&Ve>1&&(Ye=Ve>=16384?Math.floor(Ve/2)-1||1:Math.ceil(Ve)/2,Le/=Ve/Ye),lt=this.cachedCanvases.getCanvas(ot,We,Ye),me=lt.context,me.clearRect(0,0,We,Ye),me.drawImage(ve,0,0,je,Ve,0,0,We,Ye),ve=lt.canvas,je=We,Ve=Ye,ot=ot==="prescale1"?"prescale2":"prescale1"}return{img:ve,paintWidth:je,paintHeight:Ve}}_createMaskCanvas(ve){const be=this.ctx,{width:Ce,height:Ne}=ve,Ie=this.current.fillColor,Le=this.current.patternFill,je=(0,j.getCurrentTransform)(be);let Ve,ot,lt,me;if((ve.bitmap||ve.data)&&ve.count>1){const ct=ve.bitmap||ve.data.buffer;ot=JSON.stringify(Le?je:[je.slice(0,4),Ie]),Ve=this._cachedBitmapsMap.get(ct),Ve||(Ve=new Map,this._cachedBitmapsMap.set(ct,Ve));const mt=Ve.get(ot);if(mt&&!Le){const _t=Math.round(Math.min(je[0],je[2])+je[4]),Ct=Math.round(Math.min(je[1],je[3])+je[5]);return{canvas:mt,offsetX:_t,offsetY:Ct}}lt=mt}lt||(me=this.cachedCanvases.getCanvas("maskCanvas",Ce,Ne),ce(me.context,ve));let We=$.Util.transform(je,[1/Ce,0,0,-1/Ne,0,0]);We=$.Util.transform(We,[1,0,0,1,0,-Ne]);const Ye=$.Util.applyTransform([0,0],We),Fe=$.Util.applyTransform([Ce,Ne],We),xe=$.Util.normalizeRect([Ye[0],Ye[1],Fe[0],Fe[1]]),$e=Math.round(xe[2]-xe[0])||1,Je=Math.round(xe[3]-xe[1])||1,ut=this.cachedCanvases.getCanvas("fillCanvas",$e,Je),qe=ut.context,Ge=Math.min(Ye[0],Fe[0]),Ke=Math.min(Ye[1],Fe[1]);qe.translate(-Ge,-Ke),qe.transform(...We),lt||(lt=this._scaleImage(me.canvas,(0,j.getCurrentTransformInverse)(qe)),lt=lt.img,Ve&&Le&&Ve.set(ot,lt)),qe.imageSmoothingEnabled=_e((0,j.getCurrentTransform)(qe),ve.interpolate),se(qe,lt,0,0,lt.width,lt.height,0,0,Ce,Ne),qe.globalCompositeOperation="source-in";const et=$.Util.transform((0,j.getCurrentTransformInverse)(qe),[1,0,0,1,-Ge,-Ke]);return qe.fillStyle=Le?Ie.getPattern(be,this,et,z.PathType.FILL):Ie,qe.fillRect(0,0,Ce,Ne),Ve&&!Le&&(this.cachedCanvases.delete("fillCanvas"),Ve.set(ot,ut.canvas)),{canvas:ut.canvas,offsetX:Math.round(Ge),offsetY:Math.round(Ke)}}setLineWidth(ve){ve!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=ve,this.ctx.lineWidth=ve}setLineCap(ve){this.ctx.lineCap=De[ve]}setLineJoin(ve){this.ctx.lineJoin=fe[ve]}setMiterLimit(ve){this.ctx.miterLimit=ve}setDash(ve,be){const Ce=this.ctx;Ce.setLineDash!==void 0&&(Ce.setLineDash(ve),Ce.lineDashOffset=be)}setRenderingIntent(ve){}setFlatness(ve){}setGState(ve){for(const[be,Ce]of ve)switch(be){case"LW":this.setLineWidth(Ce);break;case"LC":this.setLineCap(Ce);break;case"LJ":this.setLineJoin(Ce);break;case"ML":this.setMiterLimit(Ce);break;case"D":this.setDash(Ce[0],Ce[1]);break;case"RI":this.setRenderingIntent(Ce);break;case"FL":this.setFlatness(Ce);break;case"Font":this.setFont(Ce[0],Ce[1]);break;case"CA":this.current.strokeAlpha=Ce;break;case"ca":this.current.fillAlpha=Ce,this.ctx.globalAlpha=Ce;break;case"BM":this.ctx.globalCompositeOperation=Ce;break;case"SMask":this.current.activeSMask=Ce?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(Ce);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const ve=this.inSMaskMode;this.current.activeSMask&&!ve?this.beginSMaskMode():!this.current.activeSMask&&ve&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const ve=this.ctx.canvas.width,be=this.ctx.canvas.height,Ce="smaskGroupAt"+this.groupLevel,Ne=this.cachedCanvases.getCanvas(Ce,ve,be);this.suspendedCtx=this.ctx,this.ctx=Ne.context;const Ie=this.ctx;Ie.setTransform(...(0,j.getCurrentTransform)(this.suspendedCtx)),ae(this.suspendedCtx,Ie),ne(Ie,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ae(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(ve){if(!this.current.activeSMask)return;ve?(ve[0]=Math.floor(ve[0]),ve[1]=Math.floor(ve[1]),ve[2]=Math.ceil(ve[2]),ve[3]=Math.ceil(ve[3])):ve=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const be=this.current.activeSMask,Ce=this.suspendedCtx;ye(Ce,be,this.ctx,ve),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(ae(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const ve=this.current;this.stateStack.push(ve),this.current=ve.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),ae(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(ve,be,Ce,Ne,Ie,Le){this.ctx.transform(ve,be,Ce,Ne,Ie,Le),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(ve,be,Ce){const Ne=this.ctx,Ie=this.current;let Le=Ie.x,je=Ie.y,Ve,ot;const lt=(0,j.getCurrentTransform)(Ne),me=lt[0]===0&&lt[3]===0||lt[1]===0&&lt[2]===0,We=me?Ce.slice(0):null;for(let Ye=0,Fe=0,xe=ve.length;Ye<xe;Ye++)switch(ve[Ye]|0){case $.OPS.rectangle:Le=be[Fe++],je=be[Fe++];const $e=be[Fe++],Je=be[Fe++],ut=Le+$e,qe=je+Je;Ne.moveTo(Le,je),$e===0||Je===0?Ne.lineTo(ut,qe):(Ne.lineTo(ut,je),Ne.lineTo(ut,qe),Ne.lineTo(Le,qe)),me||Ie.updateRectMinMax(lt,[Le,je,ut,qe]),Ne.closePath();break;case $.OPS.moveTo:Le=be[Fe++],je=be[Fe++],Ne.moveTo(Le,je),me||Ie.updatePathMinMax(lt,Le,je);break;case $.OPS.lineTo:Le=be[Fe++],je=be[Fe++],Ne.lineTo(Le,je),me||Ie.updatePathMinMax(lt,Le,je);break;case $.OPS.curveTo:Ve=Le,ot=je,Le=be[Fe+4],je=be[Fe+5],Ne.bezierCurveTo(be[Fe],be[Fe+1],be[Fe+2],be[Fe+3],Le,je),Ie.updateCurvePathMinMax(lt,Ve,ot,be[Fe],be[Fe+1],be[Fe+2],be[Fe+3],Le,je,We),Fe+=6;break;case $.OPS.curveTo2:Ve=Le,ot=je,Ne.bezierCurveTo(Le,je,be[Fe],be[Fe+1],be[Fe+2],be[Fe+3]),Ie.updateCurvePathMinMax(lt,Ve,ot,Le,je,be[Fe],be[Fe+1],be[Fe+2],be[Fe+3],We),Le=be[Fe+2],je=be[Fe+3],Fe+=4;break;case $.OPS.curveTo3:Ve=Le,ot=je,Le=be[Fe+2],je=be[Fe+3],Ne.bezierCurveTo(be[Fe],be[Fe+1],Le,je,Le,je),Ie.updateCurvePathMinMax(lt,Ve,ot,be[Fe],be[Fe+1],Le,je,Le,je,We),Fe+=4;break;case $.OPS.closePath:Ne.closePath();break}me&&Ie.updateScalingPathMinMax(lt,We),Ie.setCurrentPoint(Le,je)}closePath(){this.ctx.closePath()}stroke(ve=!0){const be=this.ctx,Ce=this.current.strokeColor;be.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof Ce=="object"&&(Ce!=null&&Ce.getPattern)?(be.save(),be.strokeStyle=Ce.getPattern(be,this,(0,j.getCurrentTransformInverse)(be),z.PathType.STROKE),this.rescaleAndStroke(!1),be.restore()):this.rescaleAndStroke(!0)),ve&&this.consumePath(this.current.getClippedPathBoundingBox()),be.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(ve=!0){const be=this.ctx,Ce=this.current.fillColor,Ne=this.current.patternFill;let Ie=!1;Ne&&(be.save(),be.fillStyle=Ce.getPattern(be,this,(0,j.getCurrentTransformInverse)(be),z.PathType.FILL),Ie=!0);const Le=this.current.getClippedPathBoundingBox();this.contentVisible&&Le!==null&&(this.pendingEOFill?(be.fill("evenodd"),this.pendingEOFill=!1):be.fill()),Ie&&be.restore(),ve&&this.consumePath(Le)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Ae}eoClip(){this.pendingClip=Me}beginText(){this.current.textMatrix=$.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const ve=this.pendingTextPaths,be=this.ctx;if(ve===void 0){be.beginPath();return}be.save(),be.beginPath();for(const Ce of ve)be.setTransform(...Ce.transform),be.translate(Ce.x,Ce.y),Ce.addToPath(be,Ce.fontSize);be.restore(),be.clip(),be.beginPath(),delete this.pendingTextPaths}setCharSpacing(ve){this.current.charSpacing=ve}setWordSpacing(ve){this.current.wordSpacing=ve}setHScale(ve){this.current.textHScale=ve/100}setLeading(ve){this.current.leading=-ve}setFont(ve,be){var lt;const Ce=this.commonObjs.get(ve),Ne=this.current;if(!Ce)throw new Error(`Can't find font for ${ve}`);if(Ne.fontMatrix=Ce.fontMatrix||$.FONT_IDENTITY_MATRIX,(Ne.fontMatrix[0]===0||Ne.fontMatrix[3]===0)&&(0,$.warn)("Invalid font matrix for font "+ve),be<0?(be=-be,Ne.fontDirection=-1):Ne.fontDirection=1,this.current.font=Ce,this.current.fontSize=be,Ce.isType3Font)return;const Ie=Ce.loadedName||"sans-serif",Le=((lt=Ce.systemFontInfo)==null?void 0:lt.css)||`"${Ie}", ${Ce.fallbackName}`;let je="normal";Ce.black?je="900":Ce.bold&&(je="bold");const Ve=Ce.italic?"italic":"normal";let ot=be;be<X?ot=X:be>G&&(ot=G),this.current.fontSizeScale=be/ot,this.ctx.font=`${Ve} ${je} ${ot}px ${Le}`}setTextRenderingMode(ve){this.current.textRenderingMode=ve}setTextRise(ve){this.current.textRise=ve}moveText(ve,be){this.current.x=this.current.lineX+=ve,this.current.y=this.current.lineY+=be}setLeadingMoveText(ve,be){this.setLeading(-be),this.moveText(ve,be)}setTextMatrix(ve,be,Ce,Ne,Ie,Le){this.current.textMatrix=[ve,be,Ce,Ne,Ie,Le],this.current.textMatrixScale=Math.hypot(ve,be),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(ve,be,Ce,Ne){const Ie=this.ctx,Le=this.current,je=Le.font,Ve=Le.textRenderingMode,ot=Le.fontSize/Le.fontSizeScale,lt=Ve&$.TextRenderingMode.FILL_STROKE_MASK,me=!!(Ve&$.TextRenderingMode.ADD_TO_PATH_FLAG),We=Le.patternFill&&!je.missingFile;let Ye;(je.disableFontFace||me||We)&&(Ye=je.getPathGenerator(this.commonObjs,ve)),je.disableFontFace||We?(Ie.save(),Ie.translate(be,Ce),Ie.beginPath(),Ye(Ie,ot),Ne&&Ie.setTransform(...Ne),(lt===$.TextRenderingMode.FILL||lt===$.TextRenderingMode.FILL_STROKE)&&Ie.fill(),(lt===$.TextRenderingMode.STROKE||lt===$.TextRenderingMode.FILL_STROKE)&&Ie.stroke(),Ie.restore()):((lt===$.TextRenderingMode.FILL||lt===$.TextRenderingMode.FILL_STROKE)&&Ie.fillText(ve,be,Ce),(lt===$.TextRenderingMode.STROKE||lt===$.TextRenderingMode.FILL_STROKE)&&Ie.strokeText(ve,be,Ce)),me&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,j.getCurrentTransform)(Ie),x:be,y:Ce,fontSize:ot,addToPath:Ye})}get isFontSubpixelAAEnabled(){const{context:ve}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);ve.scale(1.5,1),ve.fillText("I",0,10);const be=ve.getImageData(0,0,10,10).data;let Ce=!1;for(let Ne=3;Ne<be.length;Ne+=4)if(be[Ne]>0&&be[Ne]<255){Ce=!0;break}return(0,$.shadow)(this,"isFontSubpixelAAEnabled",Ce)}showText(ve){const be=this.current,Ce=be.font;if(Ce.isType3Font)return this.showType3Text(ve);const Ne=be.fontSize;if(Ne===0)return;const Ie=this.ctx,Le=be.fontSizeScale,je=be.charSpacing,Ve=be.wordSpacing,ot=be.fontDirection,lt=be.textHScale*ot,me=ve.length,We=Ce.vertical,Ye=We?1:-1,Fe=Ce.defaultVMetrics,xe=Ne*be.fontMatrix[0],$e=be.textRenderingMode===$.TextRenderingMode.FILL&&!Ce.disableFontFace&&!be.patternFill;Ie.save(),Ie.transform(...be.textMatrix),Ie.translate(be.x,be.y+be.textRise),ot>0?Ie.scale(lt,-1):Ie.scale(lt,1);let Je;if(be.patternFill){Ie.save();const et=be.fillColor.getPattern(Ie,this,(0,j.getCurrentTransformInverse)(Ie),z.PathType.FILL);Je=(0,j.getCurrentTransform)(Ie),Ie.restore(),Ie.fillStyle=et}let ut=be.lineWidth;const qe=be.textMatrixScale;if(qe===0||ut===0){const et=be.textRenderingMode&$.TextRenderingMode.FILL_STROKE_MASK;(et===$.TextRenderingMode.STROKE||et===$.TextRenderingMode.FILL_STROKE)&&(ut=this.getSinglePixelWidth())}else ut/=qe;if(Le!==1&&(Ie.scale(Le,Le),ut/=Le),Ie.lineWidth=ut,Ce.isInvalidPDFjsFont){const et=[];let ct=0;for(const mt of ve)et.push(mt.unicode),ct+=mt.width;Ie.fillText(et.join(""),0,0),be.x+=ct*xe*lt,Ie.restore(),this.compose();return}let Ge=0,Ke;for(Ke=0;Ke<me;++Ke){const et=ve[Ke];if(typeof et=="number"){Ge+=Ye*et*Ne/1e3;continue}let ct=!1;const mt=(et.isSpace?Ve:0)+je,_t=et.fontChar,Ct=et.accent;let Et,xt,Tt=et.width;if(We){const nt=et.vmetric||Fe,it=-(et.vmetric?nt[1]:Tt*.5)*xe,rt=nt[2]*xe;Tt=nt?-nt[0]:Tt,Et=it/Le,xt=(Ge+rt)/Le}else Et=Ge/Le,xt=0;if(Ce.remeasure&&Tt>0){const nt=Ie.measureText(_t).width*1e3/Ne*Le;if(Tt<nt&&this.isFontSubpixelAAEnabled){const it=Tt/nt;ct=!0,Ie.save(),Ie.scale(it,1),Et/=it}else Tt!==nt&&(Et+=(Tt-nt)/2e3*Ne/Le)}if(this.contentVisible&&(et.isInFont||Ce.missingFile)){if($e&&!Ct)Ie.fillText(_t,Et,xt);else if(this.paintChar(_t,Et,xt,Je),Ct){const nt=Et+Ne*Ct.offset.x/Le,it=xt-Ne*Ct.offset.y/Le;this.paintChar(Ct.fontChar,nt,it,Je)}}const At=We?Tt*xe-mt*ot:Tt*xe+mt*ot;Ge+=At,ct&&Ie.restore()}We?be.y-=Ge:be.x+=Ge*lt,Ie.restore(),this.compose()}showType3Text(ve){const be=this.ctx,Ce=this.current,Ne=Ce.font,Ie=Ce.fontSize,Le=Ce.fontDirection,je=Ne.vertical?1:-1,Ve=Ce.charSpacing,ot=Ce.wordSpacing,lt=Ce.textHScale*Le,me=Ce.fontMatrix||$.FONT_IDENTITY_MATRIX,We=ve.length,Ye=Ce.textRenderingMode===$.TextRenderingMode.INVISIBLE;let Fe,xe,$e,Je;if(!(Ye||Ie===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,be.save(),be.transform(...Ce.textMatrix),be.translate(Ce.x,Ce.y),be.scale(lt,Le),Fe=0;Fe<We;++Fe){if(xe=ve[Fe],typeof xe=="number"){Je=je*xe*Ie/1e3,this.ctx.translate(Je,0),Ce.x+=Je*lt;continue}const ut=(xe.isSpace?ot:0)+Ve,qe=Ne.charProcOperatorList[xe.operatorListId];if(!qe){(0,$.warn)(`Type3 character "${xe.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=xe,this.save(),be.scale(Ie,Ie),be.transform(...me),this.executeOperatorList(qe),this.restore()),$e=$.Util.applyTransform([xe.width,0],me)[0]*Ie+ut,be.translate($e,0),Ce.x+=$e*lt}be.restore(),this.processingType3=null}}setCharWidth(ve,be){}setCharWidthAndBounds(ve,be,Ce,Ne,Ie,Le){this.ctx.rect(Ce,Ne,Ie-Ce,Le-Ne),this.ctx.clip(),this.endPath()}getColorN_Pattern(ve){let be;if(ve[0]==="TilingPattern"){const Ce=ve[1],Ne=this.baseTransform||(0,j.getCurrentTransform)(this.ctx),Ie={createCanvasGraphics:Le=>new Oe(Le,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};be=new z.TilingPattern(ve,Ce,this.ctx,Ie,Ne)}else be=this._getPattern(ve[1],ve[2]);return be}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(ve,be,Ce){const Ne=$.Util.makeHexColor(ve,be,Ce);this.ctx.strokeStyle=Ne,this.current.strokeColor=Ne}setFillRGBColor(ve,be,Ce){const Ne=$.Util.makeHexColor(ve,be,Ce);this.ctx.fillStyle=Ne,this.current.fillColor=Ne,this.current.patternFill=!1}_getPattern(ve,be=null){let Ce;return this.cachedPatterns.has(ve)?Ce=this.cachedPatterns.get(ve):(Ce=(0,z.getShadingPattern)(this.getObject(ve)),this.cachedPatterns.set(ve,Ce)),be&&(Ce.matrix=be),Ce}shadingFill(ve){if(!this.contentVisible)return;const be=this.ctx;this.save();const Ce=this._getPattern(ve);be.fillStyle=Ce.getPattern(be,this,(0,j.getCurrentTransformInverse)(be),z.PathType.SHADING);const Ne=(0,j.getCurrentTransformInverse)(be);if(Ne){const{width:Ie,height:Le}=be.canvas,[je,Ve,ot,lt]=$.Util.getAxialAlignedBoundingBox([0,0,Ie,Le],Ne);this.ctx.fillRect(je,Ve,ot-je,lt-Ve)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,$.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,$.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(ve,be){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(ve)&&ve.length===6&&this.transform(...ve),this.baseTransform=(0,j.getCurrentTransform)(this.ctx),be)){const Ce=be[2]-be[0],Ne=be[3]-be[1];this.ctx.rect(be[0],be[1],Ce,Ne),this.current.updateRectMinMax((0,j.getCurrentTransform)(this.ctx),be),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(ve){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const be=this.ctx;ve.isolated||(0,$.info)("TODO: Support non-isolated groups."),ve.knockout&&(0,$.warn)("Knockout groups not supported.");const Ce=(0,j.getCurrentTransform)(be);if(ve.matrix&&be.transform(...ve.matrix),!ve.bbox)throw new Error("Bounding box is required.");let Ne=$.Util.getAxialAlignedBoundingBox(ve.bbox,(0,j.getCurrentTransform)(be));const Ie=[0,0,be.canvas.width,be.canvas.height];Ne=$.Util.intersect(Ne,Ie)||[0,0,0,0];const Le=Math.floor(Ne[0]),je=Math.floor(Ne[1]);let Ve=Math.max(Math.ceil(Ne[2])-Le,1),ot=Math.max(Math.ceil(Ne[3])-je,1),lt=1,me=1;Ve>Y&&(lt=Ve/Y,Ve=Y),ot>Y&&(me=ot/Y,ot=Y),this.current.startNewPathAndClipBox([0,0,Ve,ot]);let We="groupAt"+this.groupLevel;ve.smask&&(We+="_smask_"+this.smaskCounter++%2);const Ye=this.cachedCanvases.getCanvas(We,Ve,ot),Fe=Ye.context;Fe.scale(1/lt,1/me),Fe.translate(-Le,-je),Fe.transform(...Ce),ve.smask?this.smaskStack.push({canvas:Ye.canvas,context:Fe,offsetX:Le,offsetY:je,scaleX:lt,scaleY:me,subtype:ve.smask.subtype,backdrop:ve.smask.backdrop,transferMap:ve.smask.transferMap||null,startTransformInverse:null}):(be.setTransform(1,0,0,1,0,0),be.translate(Le,je),be.scale(lt,me),be.save()),ae(be,Fe),this.ctx=Fe,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(be),this.groupLevel++}endGroup(ve){if(!this.contentVisible)return;this.groupLevel--;const be=this.ctx,Ce=this.groupStack.pop();if(this.ctx=Ce,this.ctx.imageSmoothingEnabled=!1,ve.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const Ne=(0,j.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...Ne);const Ie=$.Util.getAxialAlignedBoundingBox([0,0,be.canvas.width,be.canvas.height],Ne);this.ctx.drawImage(be.canvas,0,0),this.ctx.restore(),this.compose(Ie)}}beginAnnotation(ve,be,Ce,Ne,Ie){if(st(this,Te,En).call(this),le(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(be)&&be.length===4){const Le=be[2]-be[0],je=be[3]-be[1];if(Ie&&this.annotationCanvasMap){Ce=Ce.slice(),Ce[4]-=be[0],Ce[5]-=be[1],be=be.slice(),be[0]=be[1]=0,be[2]=Le,be[3]=je;const[Ve,ot]=$.Util.singularValueDecompose2dScale((0,j.getCurrentTransform)(this.ctx)),{viewportScale:lt}=this,me=Math.ceil(Le*this.outputScaleX*lt),We=Math.ceil(je*this.outputScaleY*lt);this.annotationCanvas=this.canvasFactory.create(me,We);const{canvas:Ye,context:Fe}=this.annotationCanvas;this.annotationCanvasMap.set(ve,Ye),this.annotationCanvas.savedCtx=this.ctx,this.ctx=Fe,this.ctx.save(),this.ctx.setTransform(Ve,0,0,-ot,0,je*ot),le(this.ctx)}else le(this.ctx),this.ctx.rect(be[0],be[1],Le,je),this.ctx.clip(),this.endPath()}this.current=new oe(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...Ce),this.transform(...Ne)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),st(this,Xe,kn).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(ve){if(!this.contentVisible)return;const be=ve.count;ve=this.getObject(ve.data,ve),ve.count=be;const Ce=this.ctx,Ne=this.processingType3;if(Ne&&(Ne.compiled===void 0&&(Ne.compiled=ie(ve)),Ne.compiled)){Ne.compiled(Ce);return}const Ie=this._createMaskCanvas(ve),Le=Ie.canvas;Ce.save(),Ce.setTransform(1,0,0,1,0,0),Ce.drawImage(Le,Ie.offsetX,Ie.offsetY),Ce.restore(),this.compose()}paintImageMaskXObjectRepeat(ve,be,Ce=0,Ne=0,Ie,Le){if(!this.contentVisible)return;ve=this.getObject(ve.data,ve);const je=this.ctx;je.save();const Ve=(0,j.getCurrentTransform)(je);je.transform(be,Ce,Ne,Ie,0,0);const ot=this._createMaskCanvas(ve);je.setTransform(1,0,0,1,ot.offsetX-Ve[4],ot.offsetY-Ve[5]);for(let lt=0,me=Le.length;lt<me;lt+=2){const We=$.Util.transform(Ve,[be,Ce,Ne,Ie,Le[lt],Le[lt+1]]),[Ye,Fe]=$.Util.applyTransform([0,0],We);je.drawImage(ot.canvas,Ye,Fe)}je.restore(),this.compose()}paintImageMaskXObjectGroup(ve){if(!this.contentVisible)return;const be=this.ctx,Ce=this.current.fillColor,Ne=this.current.patternFill;for(const Ie of ve){const{data:Le,width:je,height:Ve,transform:ot}=Ie,lt=this.cachedCanvases.getCanvas("maskCanvas",je,Ve),me=lt.context;me.save();const We=this.getObject(Le,Ie);ce(me,We),me.globalCompositeOperation="source-in",me.fillStyle=Ne?Ce.getPattern(me,this,(0,j.getCurrentTransformInverse)(be),z.PathType.FILL):Ce,me.fillRect(0,0,je,Ve),me.restore(),be.save(),be.transform(...ot),be.scale(1,-1),se(be,lt.canvas,0,0,je,Ve,0,-1,1,1),be.restore()}this.compose()}paintImageXObject(ve){if(!this.contentVisible)return;const be=this.getObject(ve);if(!be){(0,$.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(be)}paintImageXObjectRepeat(ve,be,Ce,Ne){if(!this.contentVisible)return;const Ie=this.getObject(ve);if(!Ie){(0,$.warn)("Dependent image isn't ready yet");return}const Le=Ie.width,je=Ie.height,Ve=[];for(let ot=0,lt=Ne.length;ot<lt;ot+=2)Ve.push({transform:[be,0,0,Ce,Ne[ot],Ne[ot+1]],x:0,y:0,w:Le,h:je});this.paintInlineImageXObjectGroup(Ie,Ve)}applyTransferMapsToCanvas(ve){return this.current.transferMaps!=="none"&&(ve.filter=this.current.transferMaps,ve.drawImage(ve.canvas,0,0),ve.filter="none"),ve.canvas}applyTransferMapsToBitmap(ve){if(this.current.transferMaps==="none")return ve.bitmap;const{bitmap:be,width:Ce,height:Ne}=ve,Ie=this.cachedCanvases.getCanvas("inlineImage",Ce,Ne),Le=Ie.context;return Le.filter=this.current.transferMaps,Le.drawImage(be,0,0),Le.filter="none",Ie.canvas}paintInlineImageXObject(ve){if(!this.contentVisible)return;const be=ve.width,Ce=ve.height,Ne=this.ctx;if(this.save(),!$.isNodeJS){const{filter:je}=Ne;je!=="none"&&je!==""&&(Ne.filter="none")}Ne.scale(1/be,-1/Ce);let Ie;if(ve.bitmap)Ie=this.applyTransferMapsToBitmap(ve);else if(typeof HTMLElement=="function"&&ve instanceof HTMLElement||!ve.data)Ie=ve;else{const Ve=this.cachedCanvases.getCanvas("inlineImage",be,Ce).context;ue(Ve,ve),Ie=this.applyTransferMapsToCanvas(Ve)}const Le=this._scaleImage(Ie,(0,j.getCurrentTransformInverse)(Ne));Ne.imageSmoothingEnabled=_e((0,j.getCurrentTransform)(Ne),ve.interpolate),se(Ne,Le.img,0,0,Le.paintWidth,Le.paintHeight,0,-Ce,be,Ce),this.compose(),this.restore()}paintInlineImageXObjectGroup(ve,be){if(!this.contentVisible)return;const Ce=this.ctx;let Ne;if(ve.bitmap)Ne=ve.bitmap;else{const Ie=ve.width,Le=ve.height,Ve=this.cachedCanvases.getCanvas("inlineImage",Ie,Le).context;ue(Ve,ve),Ne=this.applyTransferMapsToCanvas(Ve)}for(const Ie of be)Ce.save(),Ce.transform(...Ie.transform),Ce.scale(1,-1),se(Ce,Ne,Ie.x,Ie.y,Ie.w,Ie.h,0,-1,1,1),Ce.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(ve){}markPointProps(ve,be){}beginMarkedContent(ve){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(ve,be){ve==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(be)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(ve){const be=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(ve);const Ce=this.ctx;this.pendingClip&&(be||(this.pendingClip===Me?Ce.clip("evenodd"):Ce.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),Ce.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const ve=(0,j.getCurrentTransform)(this.ctx);if(ve[1]===0&&ve[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(ve[0]),Math.abs(ve[3]));else{const be=Math.abs(ve[0]*ve[3]-ve[2]*ve[1]),Ce=Math.hypot(ve[0],ve[2]),Ne=Math.hypot(ve[1],ve[3]);this._cachedGetSinglePixelWidth=Math.max(Ce,Ne)/be}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:ve}=this.current,{a:be,b:Ce,c:Ne,d:Ie}=this.ctx.getTransform();let Le,je;if(Ce===0&&Ne===0){const Ve=Math.abs(be),ot=Math.abs(Ie);if(Ve===ot)if(ve===0)Le=je=1/Ve;else{const lt=Ve*ve;Le=je=lt<1?1/lt:1}else if(ve===0)Le=1/Ve,je=1/ot;else{const lt=Ve*ve,me=ot*ve;Le=lt<1?1/lt:1,je=me<1?1/me:1}}else{const Ve=Math.abs(be*Ie-Ce*Ne),ot=Math.hypot(be,Ce),lt=Math.hypot(Ne,Ie);if(ve===0)Le=lt/Ve,je=ot/Ve;else{const me=ve*Ve;Le=lt>me?lt/me:1,je=ot>me?ot/me:1}}this._cachedScaleForStroking[0]=Le,this._cachedScaleForStroking[1]=je}return this._cachedScaleForStroking}rescaleAndStroke(ve){const{ctx:be}=this,{lineWidth:Ce}=this.current,[Ne,Ie]=this.getScaleForStroking();if(be.lineWidth=Ce||1,Ne===1&&Ie===1){be.stroke();return}const Le=be.getLineDash();if(ve&&be.save(),be.scale(Ne,Ie),Le.length>0){const je=Math.max(Ne,Ie);be.setLineDash(Le.map(Ve=>Ve/je)),be.lineDashOffset/=je}be.stroke(),ve&&be.restore()}isContentVisible(){for(let ve=this.markedContentStack.length-1;ve>=0;ve--)if(!this.markedContentStack[ve].visible)return!1;return!0}};let Ee=Oe;Te=new WeakSet,En=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Xe=new WeakSet,kn=function(){if(this.pageColors){const ve=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(ve!=="none"){const be=this.ctx.filter;this.ctx.filter=ve,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=be}}},_.CanvasGraphics=Ee;for(const Pe in $.OPS)Ee.prototype[Pe]!==void 0&&(Ee.prototype[$.OPS[Pe]]=Ee.prototype[Pe])},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.TilingPattern=_.PathType=void 0,_.getShadingPattern=Z;var $=M(1),j=M(6);const z={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};_.PathType=z;function V(ie,oe){if(!oe)return;const ue=oe[2]-oe[0],ce=oe[3]-oe[1],ae=new Path2D;ae.rect(oe[0],oe[1],ue,ce),ie.clip(ae)}class X{constructor(){this.constructor===X&&(0,$.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,$.unreachable)("Abstract method `getPattern` called.")}}class G extends X{constructor(oe){super(),this._type=oe[1],this._bbox=oe[2],this._colorStops=oe[3],this._p0=oe[4],this._p1=oe[5],this._r0=oe[6],this._r1=oe[7],this.matrix=null}_createGradient(oe){let ue;this._type==="axial"?ue=oe.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(ue=oe.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const ce of this._colorStops)ue.addColorStop(ce[0],ce[1]);return ue}getPattern(oe,ue,ce,ae){let le;if(ae===z.STROKE||ae===z.FILL){const he=ue.current.getClippedPathBoundingBox(ae,(0,j.getCurrentTransform)(oe))||[0,0,0,0],ge=Math.ceil(he[2]-he[0])||1,de=Math.ceil(he[3]-he[1])||1,pe=ue.cachedCanvases.getCanvas("pattern",ge,de,!0),ye=pe.context;ye.clearRect(0,0,ye.canvas.width,ye.canvas.height),ye.beginPath(),ye.rect(0,0,ye.canvas.width,ye.canvas.height),ye.translate(-he[0],-he[1]),ce=$.Util.transform(ce,[1,0,0,1,he[0],he[1]]),ye.transform(...ue.baseTransform),this.matrix&&ye.transform(...this.matrix),V(ye,this._bbox),ye.fillStyle=this._createGradient(ye),ye.fill(),le=oe.createPattern(pe.canvas,"no-repeat");const _e=new DOMMatrix(ce);le.setTransform(_e)}else V(oe,this._bbox),le=this._createGradient(oe);return le}}function Y(ie,oe,ue,ce,ae,le,he,ge){const de=oe.coords,pe=oe.colors,ye=ie.data,_e=ie.width*4;let De;de[ue+1]>de[ce+1]&&(De=ue,ue=ce,ce=De,De=le,le=he,he=De),de[ce+1]>de[ae+1]&&(De=ce,ce=ae,ae=De,De=he,he=ge,ge=De),de[ue+1]>de[ce+1]&&(De=ue,ue=ce,ce=De,De=le,le=he,he=De);const fe=(de[ue]+oe.offsetX)*oe.scaleX,Ae=(de[ue+1]+oe.offsetY)*oe.scaleY,Me=(de[ce]+oe.offsetX)*oe.scaleX,Ee=(de[ce+1]+oe.offsetY)*oe.scaleY,Te=(de[ae]+oe.offsetX)*oe.scaleX,Be=(de[ae+1]+oe.offsetY)*oe.scaleY;if(Ae>=Be)return;const Xe=pe[le],ze=pe[le+1],Oe=pe[le+2],Pe=pe[he],ve=pe[he+1],be=pe[he+2],Ce=pe[ge],Ne=pe[ge+1],Ie=pe[ge+2],Le=Math.round(Ae),je=Math.round(Be);let Ve,ot,lt,me,We,Ye,Fe,xe;for(let $e=Le;$e<=je;$e++){if($e<Ee){const Ke=$e<Ae?0:(Ae-$e)/(Ae-Ee);Ve=fe-(fe-Me)*Ke,ot=Xe-(Xe-Pe)*Ke,lt=ze-(ze-ve)*Ke,me=Oe-(Oe-be)*Ke}else{let Ke;$e>Be?Ke=1:Ee===Be?Ke=0:Ke=(Ee-$e)/(Ee-Be),Ve=Me-(Me-Te)*Ke,ot=Pe-(Pe-Ce)*Ke,lt=ve-(ve-Ne)*Ke,me=be-(be-Ie)*Ke}let Je;$e<Ae?Je=0:$e>Be?Je=1:Je=(Ae-$e)/(Ae-Be),We=fe-(fe-Te)*Je,Ye=Xe-(Xe-Ce)*Je,Fe=ze-(ze-Ne)*Je,xe=Oe-(Oe-Ie)*Je;const ut=Math.round(Math.min(Ve,We)),qe=Math.round(Math.max(Ve,We));let Ge=_e*$e+ut*4;for(let Ke=ut;Ke<=qe;Ke++)Je=(Ve-Ke)/(Ve-We),Je<0?Je=0:Je>1&&(Je=1),ye[Ge++]=ot-(ot-Ye)*Je|0,ye[Ge++]=lt-(lt-Fe)*Je|0,ye[Ge++]=me-(me-xe)*Je|0,ye[Ge++]=255}}function Q(ie,oe,ue){const ce=oe.coords,ae=oe.colors;let le,he;switch(oe.type){case"lattice":const ge=oe.verticesPerRow,de=Math.floor(ce.length/ge)-1,pe=ge-1;for(le=0;le<de;le++){let ye=le*ge;for(let _e=0;_e<pe;_e++,ye++)Y(ie,ue,ce[ye],ce[ye+1],ce[ye+ge],ae[ye],ae[ye+1],ae[ye+ge]),Y(ie,ue,ce[ye+ge+1],ce[ye+1],ce[ye+ge],ae[ye+ge+1],ae[ye+1],ae[ye+ge])}break;case"triangles":for(le=0,he=ce.length;le<he;le+=3)Y(ie,ue,ce[le],ce[le+1],ce[le+2],ae[le],ae[le+1],ae[le+2]);break;default:throw new Error("illegal figure")}}class ee extends X{constructor(oe){super(),this._coords=oe[2],this._colors=oe[3],this._figures=oe[4],this._bounds=oe[5],this._bbox=oe[7],this._background=oe[8],this.matrix=null}_createMeshCanvas(oe,ue,ce){const ge=Math.floor(this._bounds[0]),de=Math.floor(this._bounds[1]),pe=Math.ceil(this._bounds[2])-ge,ye=Math.ceil(this._bounds[3])-de,_e=Math.min(Math.ceil(Math.abs(pe*oe[0]*1.1)),3e3),De=Math.min(Math.ceil(Math.abs(ye*oe[1]*1.1)),3e3),fe=pe/_e,Ae=ye/De,Me={coords:this._coords,colors:this._colors,offsetX:-ge,offsetY:-de,scaleX:1/fe,scaleY:1/Ae},Ee=_e+2*2,Te=De+2*2,Be=ce.getCanvas("mesh",Ee,Te,!1),Xe=Be.context,ze=Xe.createImageData(_e,De);if(ue){const Pe=ze.data;for(let ve=0,be=Pe.length;ve<be;ve+=4)Pe[ve]=ue[0],Pe[ve+1]=ue[1],Pe[ve+2]=ue[2],Pe[ve+3]=255}for(const Pe of this._figures)Q(ze,Pe,Me);return Xe.putImageData(ze,2,2),{canvas:Be.canvas,offsetX:ge-2*fe,offsetY:de-2*Ae,scaleX:fe,scaleY:Ae}}getPattern(oe,ue,ce,ae){V(oe,this._bbox);let le;if(ae===z.SHADING)le=$.Util.singularValueDecompose2dScale((0,j.getCurrentTransform)(oe));else if(le=$.Util.singularValueDecompose2dScale(ue.baseTransform),this.matrix){const ge=$.Util.singularValueDecompose2dScale(this.matrix);le=[le[0]*ge[0],le[1]*ge[1]]}const he=this._createMeshCanvas(le,ae===z.SHADING?null:this._background,ue.cachedCanvases);return ae!==z.SHADING&&(oe.setTransform(...ue.baseTransform),this.matrix&&oe.transform(...this.matrix)),oe.translate(he.offsetX,he.offsetY),oe.scale(he.scaleX,he.scaleY),oe.createPattern(he.canvas,"no-repeat")}}class te extends X{getPattern(){return"hotpink"}}function Z(ie){switch(ie[0]){case"RadialAxial":return new G(ie);case"Mesh":return new ee(ie);case"Dummy":return new te}throw new Error(`Unknown IR type: ${ie[0]}`)}const ne={COLORED:1,UNCOLORED:2},se=class{constructor(oe,ue,ce,ae,le){this.operatorList=oe[2],this.matrix=oe[3]||[1,0,0,1,0,0],this.bbox=oe[4],this.xstep=oe[5],this.ystep=oe[6],this.paintType=oe[7],this.tilingType=oe[8],this.color=ue,this.ctx=ce,this.canvasGraphicsFactory=ae,this.baseTransform=le}createPatternCanvas(oe){const ue=this.operatorList,ce=this.bbox,ae=this.xstep,le=this.ystep,he=this.paintType,ge=this.tilingType,de=this.color,pe=this.canvasGraphicsFactory;(0,$.info)("TilingType: "+ge);const ye=ce[0],_e=ce[1],De=ce[2],fe=ce[3],Ae=$.Util.singularValueDecompose2dScale(this.matrix),Me=$.Util.singularValueDecompose2dScale(this.baseTransform),Ee=[Ae[0]*Me[0],Ae[1]*Me[1]],Te=this.getSizeAndScale(ae,this.ctx.canvas.width,Ee[0]),Be=this.getSizeAndScale(le,this.ctx.canvas.height,Ee[1]),Xe=oe.cachedCanvases.getCanvas("pattern",Te.size,Be.size,!0),ze=Xe.context,Oe=pe.createCanvasGraphics(ze);Oe.groupLevel=oe.groupLevel,this.setFillAndStrokeStyleToContext(Oe,he,de);let Pe=ye,ve=_e,be=De,Ce=fe;return ye<0&&(Pe=0,be+=Math.abs(ye)),_e<0&&(ve=0,Ce+=Math.abs(_e)),ze.translate(-(Te.scale*Pe),-(Be.scale*ve)),Oe.transform(Te.scale,0,0,Be.scale,0,0),ze.save(),this.clipBbox(Oe,Pe,ve,be,Ce),Oe.baseTransform=(0,j.getCurrentTransform)(Oe.ctx),Oe.executeOperatorList(ue),Oe.endDrawing(),{canvas:Xe.canvas,scaleX:Te.scale,scaleY:Be.scale,offsetX:Pe,offsetY:ve}}getSizeAndScale(oe,ue,ce){oe=Math.abs(oe);const ae=Math.max(se.MAX_PATTERN_SIZE,ue);let le=Math.ceil(oe*ce);return le>=ae?le=ae:ce=le/oe,{scale:ce,size:le}}clipBbox(oe,ue,ce,ae,le){const he=ae-ue,ge=le-ce;oe.ctx.rect(ue,ce,he,ge),oe.current.updateRectMinMax((0,j.getCurrentTransform)(oe.ctx),[ue,ce,ae,le]),oe.clip(),oe.endPath()}setFillAndStrokeStyleToContext(oe,ue,ce){const ae=oe.ctx,le=oe.current;switch(ue){case ne.COLORED:const he=this.ctx;ae.fillStyle=he.fillStyle,ae.strokeStyle=he.strokeStyle,le.fillColor=he.fillStyle,le.strokeColor=he.strokeStyle;break;case ne.UNCOLORED:const ge=$.Util.makeHexColor(ce[0],ce[1],ce[2]);ae.fillStyle=ge,ae.strokeStyle=ge,le.fillColor=ge,le.strokeColor=ge;break;default:throw new $.FormatError(`Unsupported paint type: ${ue}`)}}getPattern(oe,ue,ce,ae){let le=ce;ae!==z.SHADING&&(le=$.Util.transform(le,ue.baseTransform),this.matrix&&(le=$.Util.transform(le,this.matrix)));const he=this.createPatternCanvas(ue);let ge=new DOMMatrix(le);ge=ge.translate(he.offsetX,he.offsetY),ge=ge.scale(1/he.scaleX,1/he.scaleY);const de=oe.createPattern(he.canvas,"repeat");return de.setTransform(ge),de}};let re=se;$t(re,"MAX_PATTERN_SIZE",3e3),_.TilingPattern=re},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.convertBlackAndWhiteToRGBA=z,_.convertToRGBA=j,_.grayToRGBA=X;var $=M(1);function j(G){switch(G.kind){case $.ImageKind.GRAYSCALE_1BPP:return z(G);case $.ImageKind.RGB_24BPP:return V(G)}return null}function z({src:G,srcPos:Y=0,dest:Q,width:ee,height:te,nonBlackColor:Z=4294967295,inverseDecode:ne=!1}){const re=$.FeatureTest.isLittleEndian?4278190080:255,[se,ie]=ne?[Z,re]:[re,Z],oe=ee>>3,ue=ee&7,ce=G.length;Q=new Uint32Array(Q.buffer);let ae=0;for(let le=0;le<te;le++){for(const ge=Y+oe;Y<ge;Y++){const de=Y<ce?G[Y]:255;Q[ae++]=de&128?ie:se,Q[ae++]=de&64?ie:se,Q[ae++]=de&32?ie:se,Q[ae++]=de&16?ie:se,Q[ae++]=de&8?ie:se,Q[ae++]=de&4?ie:se,Q[ae++]=de&2?ie:se,Q[ae++]=de&1?ie:se}if(ue===0)continue;const he=Y<ce?G[Y++]:255;for(let ge=0;ge<ue;ge++)Q[ae++]=he&1<<7-ge?ie:se}return{srcPos:Y,destPos:ae}}function V({src:G,srcPos:Y=0,dest:Q,destPos:ee=0,width:te,height:Z}){let ne=0;const re=G.length>>2,se=new Uint32Array(G.buffer,Y,re);if($.FeatureTest.isLittleEndian){for(;ne<re-2;ne+=3,ee+=4){const ie=se[ne],oe=se[ne+1],ue=se[ne+2];Q[ee]=ie|4278190080,Q[ee+1]=ie>>>24|oe<<8|4278190080,Q[ee+2]=oe>>>16|ue<<16|4278190080,Q[ee+3]=ue>>>8|4278190080}for(let ie=ne*4,oe=G.length;ie<oe;ie+=3)Q[ee++]=G[ie]|G[ie+1]<<8|G[ie+2]<<16|4278190080}else{for(;ne<re-2;ne+=3,ee+=4){const ie=se[ne],oe=se[ne+1],ue=se[ne+2];Q[ee]=ie|255,Q[ee+1]=ie<<24|oe>>>8|255,Q[ee+2]=oe<<16|ue>>>16|255,Q[ee+3]=ue<<8|255}for(let ie=ne*4,oe=G.length;ie<oe;ie+=3)Q[ee++]=G[ie]<<24|G[ie+1]<<16|G[ie+2]<<8|255}return{srcPos:Y,destPos:ee}}function X(G,Y){if($.FeatureTest.isLittleEndian)for(let Q=0,ee=G.length;Q<ee;Q++)Y[Q]=G[Q]*65793|4278190080;else for(let Q=0,ee=G.length;Q<ee;Q++)Y[Q]=G[Q]*16843008|255}},(q,_)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.GlobalWorkerOptions=void 0;const M=Object.create(null);_.GlobalWorkerOptions=M,M.workerPort=null,M.workerSrc=""},(q,_,M)=>{var G,nr,Q,rr,te,un;Object.defineProperty(_,"__esModule",{value:!0}),_.MessageHandler=void 0;var $=M(1);const j={UNKNOWN:0,DATA:1,ERROR:2},z={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function V(ne){switch(ne instanceof Error||typeof ne=="object"&&ne!==null||(0,$.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),ne.name){case"AbortException":return new $.AbortException(ne.message);case"MissingPDFException":return new $.MissingPDFException(ne.message);case"PasswordException":return new $.PasswordException(ne.message,ne.code);case"UnexpectedResponseException":return new $.UnexpectedResponseException(ne.message,ne.status);case"UnknownErrorException":return new $.UnknownErrorException(ne.message,ne.details);default:return new $.UnknownErrorException(ne.message,ne.toString())}}class X{constructor(re,se,ie){Ze(this,G);Ze(this,Q);Ze(this,te);this.sourceName=re,this.targetName=se,this.comObj=ie,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=oe=>{const ue=oe.data;if(ue.targetName!==this.sourceName)return;if(ue.stream){st(this,Q,rr).call(this,ue);return}if(ue.callback){const ae=ue.callbackId,le=this.callbackCapabilities[ae];if(!le)throw new Error(`Cannot resolve callback ${ae}`);if(delete this.callbackCapabilities[ae],ue.callback===j.DATA)le.resolve(ue.data);else if(ue.callback===j.ERROR)le.reject(V(ue.reason));else throw new Error("Unexpected callback case");return}const ce=this.actionHandler[ue.action];if(!ce)throw new Error(`Unknown action from worker: ${ue.action}`);if(ue.callbackId){const ae=this.sourceName,le=ue.sourceName;new Promise(function(he){he(ce(ue.data))}).then(function(he){ie.postMessage({sourceName:ae,targetName:le,callback:j.DATA,callbackId:ue.callbackId,data:he})},function(he){ie.postMessage({sourceName:ae,targetName:le,callback:j.ERROR,callbackId:ue.callbackId,reason:V(he)})});return}if(ue.streamId){st(this,G,nr).call(this,ue);return}ce(ue.data)},ie.addEventListener("message",this._onComObjOnMessage)}on(re,se){const ie=this.actionHandler;if(ie[re])throw new Error(`There is already an actionName called "${re}"`);ie[re]=se}send(re,se,ie){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:re,data:se},ie)}sendWithPromise(re,se,ie){const oe=this.callbackId++,ue=new $.PromiseCapability;this.callbackCapabilities[oe]=ue;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:re,callbackId:oe,data:se},ie)}catch(ce){ue.reject(ce)}return ue.promise}sendWithStream(re,se,ie,oe){const ue=this.streamId++,ce=this.sourceName,ae=this.targetName,le=this.comObj;return new ReadableStream({start:he=>{const ge=new $.PromiseCapability;return this.streamControllers[ue]={controller:he,startCall:ge,pullCall:null,cancelCall:null,isClosed:!1},le.postMessage({sourceName:ce,targetName:ae,action:re,streamId:ue,data:se,desiredSize:he.desiredSize},oe),ge.promise},pull:he=>{const ge=new $.PromiseCapability;return this.streamControllers[ue].pullCall=ge,le.postMessage({sourceName:ce,targetName:ae,stream:z.PULL,streamId:ue,desiredSize:he.desiredSize}),ge.promise},cancel:he=>{(0,$.assert)(he instanceof Error,"cancel must have a valid reason");const ge=new $.PromiseCapability;return this.streamControllers[ue].cancelCall=ge,this.streamControllers[ue].isClosed=!0,le.postMessage({sourceName:ce,targetName:ae,stream:z.CANCEL,streamId:ue,reason:V(he)}),ge.promise}},ie)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}G=new WeakSet,nr=function(re){const se=re.streamId,ie=this.sourceName,oe=re.sourceName,ue=this.comObj,ce=this,ae=this.actionHandler[re.action],le={enqueue(he,ge=1,de){if(this.isCancelled)return;const pe=this.desiredSize;this.desiredSize-=ge,pe>0&&this.desiredSize<=0&&(this.sinkCapability=new $.PromiseCapability,this.ready=this.sinkCapability.promise),ue.postMessage({sourceName:ie,targetName:oe,stream:z.ENQUEUE,streamId:se,chunk:he},de)},close(){this.isCancelled||(this.isCancelled=!0,ue.postMessage({sourceName:ie,targetName:oe,stream:z.CLOSE,streamId:se}),delete ce.streamSinks[se])},error(he){(0,$.assert)(he instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,ue.postMessage({sourceName:ie,targetName:oe,stream:z.ERROR,streamId:se,reason:V(he)}))},sinkCapability:new $.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:re.desiredSize,ready:null};le.sinkCapability.resolve(),le.ready=le.sinkCapability.promise,this.streamSinks[se]=le,new Promise(function(he){he(ae(re.data,le))}).then(function(){ue.postMessage({sourceName:ie,targetName:oe,stream:z.START_COMPLETE,streamId:se,success:!0})},function(he){ue.postMessage({sourceName:ie,targetName:oe,stream:z.START_COMPLETE,streamId:se,reason:V(he)})})},Q=new WeakSet,rr=function(re){const se=re.streamId,ie=this.sourceName,oe=re.sourceName,ue=this.comObj,ce=this.streamControllers[se],ae=this.streamSinks[se];switch(re.stream){case z.START_COMPLETE:re.success?ce.startCall.resolve():ce.startCall.reject(V(re.reason));break;case z.PULL_COMPLETE:re.success?ce.pullCall.resolve():ce.pullCall.reject(V(re.reason));break;case z.PULL:if(!ae){ue.postMessage({sourceName:ie,targetName:oe,stream:z.PULL_COMPLETE,streamId:se,success:!0});break}ae.desiredSize<=0&&re.desiredSize>0&&ae.sinkCapability.resolve(),ae.desiredSize=re.desiredSize,new Promise(function(le){var he;le((he=ae.onPull)==null?void 0:he.call(ae))}).then(function(){ue.postMessage({sourceName:ie,targetName:oe,stream:z.PULL_COMPLETE,streamId:se,success:!0})},function(le){ue.postMessage({sourceName:ie,targetName:oe,stream:z.PULL_COMPLETE,streamId:se,reason:V(le)})});break;case z.ENQUEUE:if((0,$.assert)(ce,"enqueue should have stream controller"),ce.isClosed)break;ce.controller.enqueue(re.chunk);break;case z.CLOSE:if((0,$.assert)(ce,"close should have stream controller"),ce.isClosed)break;ce.isClosed=!0,ce.controller.close(),st(this,te,un).call(this,ce,se);break;case z.ERROR:(0,$.assert)(ce,"error should have stream controller"),ce.controller.error(V(re.reason)),st(this,te,un).call(this,ce,se);break;case z.CANCEL_COMPLETE:re.success?ce.cancelCall.resolve():ce.cancelCall.reject(V(re.reason)),st(this,te,un).call(this,ce,se);break;case z.CANCEL:if(!ae)break;new Promise(function(le){var he;le((he=ae.onCancel)==null?void 0:he.call(ae,V(re.reason)))}).then(function(){ue.postMessage({sourceName:ie,targetName:oe,stream:z.CANCEL_COMPLETE,streamId:se,success:!0})},function(le){ue.postMessage({sourceName:ie,targetName:oe,stream:z.CANCEL_COMPLETE,streamId:se,reason:V(le)})}),ae.sinkCapability.reject(V(re.reason)),ae.isCancelled=!0,delete this.streamSinks[se];break;default:throw new Error("Unexpected stream case")}},te=new WeakSet,un=async function(re,se){var ie,oe,ue;await Promise.allSettled([(ie=re.startCall)==null?void 0:ie.promise,(oe=re.pullCall)==null?void 0:oe.promise,(ue=re.cancelCall)==null?void 0:ue.promise]),delete this.streamControllers[se]},_.MessageHandler=X},(q,_,M)=>{var z,V;Object.defineProperty(_,"__esModule",{value:!0}),_.Metadata=void 0;var $=M(1);class j{constructor({parsedData:G,rawData:Y}){Ze(this,z,void 0);Ze(this,V,void 0);dt(this,z,G),dt(this,V,Y)}getRaw(){return we(this,V)}get(G){return we(this,z).get(G)??null}getAll(){return(0,$.objectFromMap)(we(this,z))}has(G){return we(this,z).has(G)}}z=new WeakMap,V=new WeakMap,_.Metadata=j},(q,_,M)=>{var G,Y,Q,ee,te,Z,Cn;Object.defineProperty(_,"__esModule",{value:!0}),_.OptionalContentConfig=void 0;var $=M(1),j=M(8);const z=Symbol("INTERNAL");class V{constructor(se,ie){Ze(this,G,!0);this.name=se,this.intent=ie}get visible(){return we(this,G)}_setVisible(se,ie){se!==z&&(0,$.unreachable)("Internal method `_setVisible` called."),dt(this,G,ie)}}G=new WeakMap;class X{constructor(se){Ze(this,Z);Ze(this,Y,null);Ze(this,Q,new Map);Ze(this,ee,null);Ze(this,te,null);if(this.name=null,this.creator=null,se!==null){this.name=se.name,this.creator=se.creator,dt(this,te,se.order);for(const ie of se.groups)we(this,Q).set(ie.id,new V(ie.name,ie.intent));if(se.baseState==="OFF")for(const ie of we(this,Q).values())ie._setVisible(z,!1);for(const ie of se.on)we(this,Q).get(ie)._setVisible(z,!0);for(const ie of se.off)we(this,Q).get(ie)._setVisible(z,!1);dt(this,ee,this.getHash())}}isVisible(se){if(we(this,Q).size===0)return!0;if(!se)return(0,$.warn)("Optional content group not defined."),!0;if(se.type==="OCG")return we(this,Q).has(se.id)?we(this,Q).get(se.id).visible:((0,$.warn)(`Optional content group not found: ${se.id}`),!0);if(se.type==="OCMD"){if(se.expression)return st(this,Z,Cn).call(this,se.expression);if(!se.policy||se.policy==="AnyOn"){for(const ie of se.ids){if(!we(this,Q).has(ie))return(0,$.warn)(`Optional content group not found: ${ie}`),!0;if(we(this,Q).get(ie).visible)return!0}return!1}else if(se.policy==="AllOn"){for(const ie of se.ids){if(!we(this,Q).has(ie))return(0,$.warn)(`Optional content group not found: ${ie}`),!0;if(!we(this,Q).get(ie).visible)return!1}return!0}else if(se.policy==="AnyOff"){for(const ie of se.ids){if(!we(this,Q).has(ie))return(0,$.warn)(`Optional content group not found: ${ie}`),!0;if(!we(this,Q).get(ie).visible)return!0}return!1}else if(se.policy==="AllOff"){for(const ie of se.ids){if(!we(this,Q).has(ie))return(0,$.warn)(`Optional content group not found: ${ie}`),!0;if(we(this,Q).get(ie).visible)return!1}return!0}return(0,$.warn)(`Unknown optional content policy ${se.policy}.`),!0}return(0,$.warn)(`Unknown group type ${se.type}.`),!0}setVisibility(se,ie=!0){if(!we(this,Q).has(se)){(0,$.warn)(`Optional content group not found: ${se}`);return}we(this,Q).get(se)._setVisible(z,!!ie),dt(this,Y,null)}get hasInitialVisibility(){return this.getHash()===we(this,ee)}getOrder(){return we(this,Q).size?we(this,te)?we(this,te).slice():[...we(this,Q).keys()]:null}getGroups(){return we(this,Q).size>0?(0,$.objectFromMap)(we(this,Q)):null}getGroup(se){return we(this,Q).get(se)||null}getHash(){if(we(this,Y)!==null)return we(this,Y);const se=new j.MurmurHash3_64;for(const[ie,oe]of we(this,Q))se.update(`${ie}:${oe.visible}`);return dt(this,Y,se.hexdigest())}}Y=new WeakMap,Q=new WeakMap,ee=new WeakMap,te=new WeakMap,Z=new WeakSet,Cn=function(se){const ie=se.length;if(ie<2)return!0;const oe=se[0];for(let ue=1;ue<ie;ue++){const ce=se[ue];let ae;if(Array.isArray(ce))ae=st(this,Z,Cn).call(this,ce);else if(we(this,Q).has(ce))ae=we(this,Q).get(ce).visible;else return(0,$.warn)(`Optional content group not found: ${ce}`),!0;switch(oe){case"And":if(!ae)return!1;break;case"Or":if(ae)return!0;break;case"Not":return!ae;default:return!0}}return oe==="And"},_.OptionalContentConfig=X},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.PDFDataTransportStream=void 0;var $=M(1),j=M(6);class z{constructor({length:Y,initialData:Q,progressiveDone:ee=!1,contentDispositionFilename:te=null,disableRange:Z=!1,disableStream:ne=!1},re){if((0,$.assert)(re,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=ee,this._contentDispositionFilename=te,(Q==null?void 0:Q.length)>0){const se=Q instanceof Uint8Array&&Q.byteLength===Q.buffer.byteLength?Q.buffer:new Uint8Array(Q).buffer;this._queuedChunks.push(se)}this._pdfDataRangeTransport=re,this._isStreamingSupported=!ne,this._isRangeSupported=!Z,this._contentLength=Y,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((se,ie)=>{this._onReceiveData({begin:se,chunk:ie})}),this._pdfDataRangeTransport.addProgressListener((se,ie)=>{this._onProgress({loaded:se,total:ie})}),this._pdfDataRangeTransport.addProgressiveReadListener(se=>{this._onReceiveData({chunk:se})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:Y,chunk:Q}){const ee=Q instanceof Uint8Array&&Q.byteLength===Q.buffer.byteLength?Q.buffer:new Uint8Array(Q).buffer;if(Y===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(ee):this._queuedChunks.push(ee);else{const te=this._rangeReaders.some(function(Z){return Z._begin!==Y?!1:(Z._enqueue(ee),!0)});(0,$.assert)(te,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var Y;return((Y=this._fullRequestReader)==null?void 0:Y._loaded)??0}_onProgress(Y){var Q,ee,te,Z;Y.total===void 0?(ee=(Q=this._rangeReaders[0])==null?void 0:Q.onProgress)==null||ee.call(Q,{loaded:Y.loaded}):(Z=(te=this._fullRequestReader)==null?void 0:te.onProgress)==null||Z.call(te,{loaded:Y.loaded,total:Y.total})}_onProgressiveDone(){var Y;(Y=this._fullRequestReader)==null||Y.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(Y){const Q=this._rangeReaders.indexOf(Y);Q>=0&&this._rangeReaders.splice(Q,1)}getFullReader(){(0,$.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const Y=this._queuedChunks;return this._queuedChunks=null,new V(this,Y,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(Y,Q){if(Q<=this._progressiveDataLength)return null;const ee=new X(this,Y,Q);return this._pdfDataRangeTransport.requestDataRange(Y,Q),this._rangeReaders.push(ee),ee}cancelAllRequests(Y){var Q;(Q=this._fullRequestReader)==null||Q.cancel(Y);for(const ee of this._rangeReaders.slice(0))ee.cancel(Y);this._pdfDataRangeTransport.abort()}}_.PDFDataTransportStream=z;class V{constructor(Y,Q,ee=!1,te=null){this._stream=Y,this._done=ee||!1,this._filename=(0,j.isPdfFile)(te)?te:null,this._queuedChunks=Q||[],this._loaded=0;for(const Z of this._queuedChunks)this._loaded+=Z.byteLength;this._requests=[],this._headersReady=Promise.resolve(),Y._fullRequestReader=this,this.onProgress=null}_enqueue(Y){this._done||(this._requests.length>0?this._requests.shift().resolve({value:Y,done:!1}):this._queuedChunks.push(Y),this._loaded+=Y.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const Y=new $.PromiseCapability;return this._requests.push(Y),Y.promise}cancel(Y){this._done=!0;for(const Q of this._requests)Q.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class X{constructor(Y,Q,ee){this._stream=Y,this._begin=Q,this._end=ee,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(Y){if(!this._done){if(this._requests.length===0)this._queuedChunk=Y;else{this._requests.shift().resolve({value:Y,done:!1});for(const ee of this._requests)ee.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const Q=this._queuedChunk;return this._queuedChunk=null,{value:Q,done:!1}}if(this._done)return{value:void 0,done:!0};const Y=new $.PromiseCapability;return this._requests.push(Y),Y.promise}cancel(Y){this._done=!0;for(const Q of this._requests)Q.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.PDFFetchStream=void 0;var $=M(1),j=M(20);function z(ee,te,Z){return{method:"GET",headers:ee,signal:Z.signal,mode:"cors",credentials:te?"include":"same-origin",redirect:"follow"}}function V(ee){const te=new Headers;for(const Z in ee){const ne=ee[Z];ne!==void 0&&te.append(Z,ne)}return te}function X(ee){return ee instanceof Uint8Array?ee.buffer:ee instanceof ArrayBuffer?ee:((0,$.warn)(`getArrayBuffer - unexpected data format: ${ee}`),new Uint8Array(ee).buffer)}class G{constructor(te){this.source=te,this.isHttp=/^https?:/i.test(te.url),this.httpHeaders=this.isHttp&&te.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var te;return((te=this._fullRequestReader)==null?void 0:te._loaded)??0}getFullReader(){return(0,$.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Y(this),this._fullRequestReader}getRangeReader(te,Z){if(Z<=this._progressiveDataLength)return null;const ne=new Q(this,te,Z);return this._rangeRequestReaders.push(ne),ne}cancelAllRequests(te){var Z;(Z=this._fullRequestReader)==null||Z.cancel(te);for(const ne of this._rangeRequestReaders.slice(0))ne.cancel(te)}}_.PDFFetchStream=G;class Y{constructor(te){this._stream=te,this._reader=null,this._loaded=0,this._filename=null;const Z=te.source;this._withCredentials=Z.withCredentials||!1,this._contentLength=Z.length,this._headersCapability=new $.PromiseCapability,this._disableRange=Z.disableRange||!1,this._rangeChunkSize=Z.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!Z.disableStream,this._isRangeSupported=!Z.disableRange,this._headers=V(this._stream.httpHeaders);const ne=Z.url;fetch(ne,z(this._headers,this._withCredentials,this._abortController)).then(re=>{if(!(0,j.validateResponseStatus)(re.status))throw(0,j.createResponseStatusError)(re.status,ne);this._reader=re.body.getReader(),this._headersCapability.resolve();const se=ue=>re.headers.get(ue),{allowRangeRequests:ie,suggestedLength:oe}=(0,j.validateRangeRequestCapabilities)({getResponseHeader:se,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=ie,this._contentLength=oe||this._contentLength,this._filename=(0,j.extractFilenameFromHeader)(se),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new $.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var ne;await this._headersCapability.promise;const{value:te,done:Z}=await this._reader.read();return Z?{value:te,done:Z}:(this._loaded+=te.byteLength,(ne=this.onProgress)==null||ne.call(this,{loaded:this._loaded,total:this._contentLength}),{value:X(te),done:!1})}cancel(te){var Z;(Z=this._reader)==null||Z.cancel(te),this._abortController.abort()}}class Q{constructor(te,Z,ne){this._stream=te,this._reader=null,this._loaded=0;const re=te.source;this._withCredentials=re.withCredentials||!1,this._readCapability=new $.PromiseCapability,this._isStreamingSupported=!re.disableStream,this._abortController=new AbortController,this._headers=V(this._stream.httpHeaders),this._headers.append("Range",`bytes=${Z}-${ne-1}`);const se=re.url;fetch(se,z(this._headers,this._withCredentials,this._abortController)).then(ie=>{if(!(0,j.validateResponseStatus)(ie.status))throw(0,j.createResponseStatusError)(ie.status,se);this._readCapability.resolve(),this._reader=ie.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var ne;await this._readCapability.promise;const{value:te,done:Z}=await this._reader.read();return Z?{value:te,done:Z}:(this._loaded+=te.byteLength,(ne=this.onProgress)==null||ne.call(this,{loaded:this._loaded}),{value:X(te),done:!1})}cancel(te){var Z;(Z=this._reader)==null||Z.cancel(te),this._abortController.abort()}}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.createResponseStatusError=G,_.extractFilenameFromHeader=X,_.validateRangeRequestCapabilities=V,_.validateResponseStatus=Y;var $=M(1),j=M(21),z=M(6);function V({getResponseHeader:Q,isHttp:ee,rangeChunkSize:te,disableRange:Z}){const ne={allowRangeRequests:!1,suggestedLength:void 0},re=parseInt(Q("Content-Length"),10);return!Number.isInteger(re)||(ne.suggestedLength=re,re<=2*te)||Z||!ee||Q("Accept-Ranges")!=="bytes"||(Q("Content-Encoding")||"identity")!=="identity"||(ne.allowRangeRequests=!0),ne}function X(Q){const ee=Q("Content-Disposition");if(ee){let te=(0,j.getFilenameFromContentDispositionHeader)(ee);if(te.includes("%"))try{te=decodeURIComponent(te)}catch{}if((0,z.isPdfFile)(te))return te}return null}function G(Q,ee){return Q===404||Q===0&&ee.startsWith("file:")?new $.MissingPDFException('Missing PDF "'+ee+'".'):new $.UnexpectedResponseException(`Unexpected server response (${Q}) while retrieving PDF "${ee}".`,Q)}function Y(Q){return Q===200||Q===206}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.getFilenameFromContentDispositionHeader=j;var $=M(1);function j(z){let V=!0,X=G("filename\\*","i").exec(z);if(X){X=X[1];let re=te(X);return re=unescape(re),re=Z(re),re=ne(re),Q(re)}if(X=ee(z),X){const re=ne(X);return Q(re)}if(X=G("filename","i").exec(z),X){X=X[1];let re=te(X);return re=ne(re),Q(re)}function G(re,se){return new RegExp("(?:^|;)\\s*"+re+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',se)}function Y(re,se){if(re){if(!/^[\x00-\xFF]+$/.test(se))return se;try{const ie=new TextDecoder(re,{fatal:!0}),oe=(0,$.stringToBytes)(se);se=ie.decode(oe),V=!1}catch{}}return se}function Q(re){return V&&/[\x80-\xff]/.test(re)&&(re=Y("utf-8",re),V&&(re=Y("iso-8859-1",re))),re}function ee(re){const se=[];let ie;const oe=G("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(ie=oe.exec(re))!==null;){let[,ce,ae,le]=ie;if(ce=parseInt(ce,10),ce in se){if(ce===0)break;continue}se[ce]=[ae,le]}const ue=[];for(let ce=0;ce<se.length&&ce in se;++ce){let[ae,le]=se[ce];le=te(le),ae&&(le=unescape(le),ce===0&&(le=Z(le))),ue.push(le)}return ue.join("")}function te(re){if(re.startsWith('"')){const se=re.slice(1).split('\\"');for(let ie=0;ie<se.length;++ie){const oe=se[ie].indexOf('"');oe!==-1&&(se[ie]=se[ie].slice(0,oe),se.length=ie+1),se[ie]=se[ie].replaceAll(/\\(.)/g,"$1")}re=se.join('"')}return re}function Z(re){const se=re.indexOf("'");if(se===-1)return re;const ie=re.slice(0,se),ue=re.slice(se+1).replace(/^[^']*'/,"");return Y(ie,ue)}function ne(re){return!re.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(re)?re:re.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(se,ie,oe,ue){if(oe==="q"||oe==="Q")return ue=ue.replaceAll("_"," "),ue=ue.replaceAll(/=([0-9a-fA-F]{2})/g,function(ce,ae){return String.fromCharCode(parseInt(ae,16))}),Y(ie,ue);try{ue=atob(ue)}catch{}return Y(ie,ue)})}return""}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.PDFNetworkStream=void 0;var $=M(1),j=M(20);const z=200,V=206;function X(te){const Z=te.response;return typeof Z!="string"?Z:(0,$.stringToBytes)(Z).buffer}class G{constructor(Z,ne={}){this.url=Z,this.isHttp=/^https?:/i.test(Z),this.httpHeaders=this.isHttp&&ne.httpHeaders||Object.create(null),this.withCredentials=ne.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(Z,ne,re){const se={begin:Z,end:ne};for(const ie in re)se[ie]=re[ie];return this.request(se)}requestFull(Z){return this.request(Z)}request(Z){const ne=new XMLHttpRequest,re=this.currXhrId++,se=this.pendingRequests[re]={xhr:ne};ne.open("GET",this.url),ne.withCredentials=this.withCredentials;for(const ie in this.httpHeaders){const oe=this.httpHeaders[ie];oe!==void 0&&ne.setRequestHeader(ie,oe)}return this.isHttp&&"begin"in Z&&"end"in Z?(ne.setRequestHeader("Range",`bytes=${Z.begin}-${Z.end-1}`),se.expectedStatus=V):se.expectedStatus=z,ne.responseType="arraybuffer",Z.onError&&(ne.onerror=function(ie){Z.onError(ne.status)}),ne.onreadystatechange=this.onStateChange.bind(this,re),ne.onprogress=this.onProgress.bind(this,re),se.onHeadersReceived=Z.onHeadersReceived,se.onDone=Z.onDone,se.onError=Z.onError,se.onProgress=Z.onProgress,ne.send(null),re}onProgress(Z,ne){var se;const re=this.pendingRequests[Z];re&&((se=re.onProgress)==null||se.call(re,ne))}onStateChange(Z,ne){var ce,ae,le;const re=this.pendingRequests[Z];if(!re)return;const se=re.xhr;if(se.readyState>=2&&re.onHeadersReceived&&(re.onHeadersReceived(),delete re.onHeadersReceived),se.readyState!==4||!(Z in this.pendingRequests))return;if(delete this.pendingRequests[Z],se.status===0&&this.isHttp){(ce=re.onError)==null||ce.call(re,se.status);return}const ie=se.status||z;if(!(ie===z&&re.expectedStatus===V)&&ie!==re.expectedStatus){(ae=re.onError)==null||ae.call(re,se.status);return}const ue=X(se);if(ie===V){const he=se.getResponseHeader("Content-Range"),ge=/bytes (\d+)-(\d+)\/(\d+)/.exec(he);re.onDone({begin:parseInt(ge[1],10),chunk:ue})}else ue?re.onDone({begin:0,chunk:ue}):(le=re.onError)==null||le.call(re,se.status)}getRequestXhr(Z){return this.pendingRequests[Z].xhr}isPendingRequest(Z){return Z in this.pendingRequests}abortRequest(Z){const ne=this.pendingRequests[Z].xhr;delete this.pendingRequests[Z],ne.abort()}}class Y{constructor(Z){this._source=Z,this._manager=new G(Z.url,{httpHeaders:Z.httpHeaders,withCredentials:Z.withCredentials}),this._rangeChunkSize=Z.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(Z){const ne=this._rangeRequestReaders.indexOf(Z);ne>=0&&this._rangeRequestReaders.splice(ne,1)}getFullReader(){return(0,$.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Q(this._manager,this._source),this._fullRequestReader}getRangeReader(Z,ne){const re=new ee(this._manager,Z,ne);return re.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(re),re}cancelAllRequests(Z){var ne;(ne=this._fullRequestReader)==null||ne.cancel(Z);for(const re of this._rangeRequestReaders.slice(0))re.cancel(Z)}}_.PDFNetworkStream=Y;class Q{constructor(Z,ne){this._manager=Z;const re={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=ne.url,this._fullRequestId=Z.requestFull(re),this._headersReceivedCapability=new $.PromiseCapability,this._disableRange=ne.disableRange||!1,this._contentLength=ne.length,this._rangeChunkSize=ne.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const Z=this._fullRequestId,ne=this._manager.getRequestXhr(Z),re=oe=>ne.getResponseHeader(oe),{allowRangeRequests:se,suggestedLength:ie}=(0,j.validateRangeRequestCapabilities)({getResponseHeader:re,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});se&&(this._isRangeSupported=!0),this._contentLength=ie||this._contentLength,this._filename=(0,j.extractFilenameFromHeader)(re),this._isRangeSupported&&this._manager.abortRequest(Z),this._headersReceivedCapability.resolve()}_onDone(Z){if(Z&&(this._requests.length>0?this._requests.shift().resolve({value:Z.chunk,done:!1}):this._cachedChunks.push(Z.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const ne of this._requests)ne.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(Z){this._storedError=(0,j.createResponseStatusError)(Z,this._url),this._headersReceivedCapability.reject(this._storedError);for(const ne of this._requests)ne.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(Z){var ne;(ne=this.onProgress)==null||ne.call(this,{loaded:Z.loaded,total:Z.lengthComputable?Z.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const Z=new $.PromiseCapability;return this._requests.push(Z),Z.promise}cancel(Z){this._done=!0,this._headersReceivedCapability.reject(Z);for(const ne of this._requests)ne.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class ee{constructor(Z,ne,re){this._manager=Z;const se={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=Z.url,this._requestId=Z.requestRange(ne,re,se),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var Z;(Z=this.onClosed)==null||Z.call(this,this)}_onDone(Z){const ne=Z.chunk;this._requests.length>0?this._requests.shift().resolve({value:ne,done:!1}):this._queuedChunk=ne,this._done=!0;for(const re of this._requests)re.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(Z){this._storedError=(0,j.createResponseStatusError)(Z,this._url);for(const ne of this._requests)ne.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(Z){var ne;this.isStreamingSupported||(ne=this.onProgress)==null||ne.call(this,{loaded:Z.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const ne=this._queuedChunk;return this._queuedChunk=null,{value:ne,done:!1}}if(this._done)return{value:void 0,done:!0};const Z=new $.PromiseCapability;return this._requests.push(Z),Z.promise}cancel(Z){this._done=!0;for(const ne of this._requests)ne.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.PDFNodeStream=void 0;var $=M(1),j=M(20);const z=/^file:\/\/\/[a-zA-Z]:\//;function V(re){const se=require$$5,ie=se.parse(re);return ie.protocol==="file:"||ie.host?ie:/^[a-z]:[/\\]/i.test(re)?se.parse(`file:///${re}`):(ie.host||(ie.protocol="file:"),ie)}class X{constructor(se){this.source=se,this.url=V(se.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&se.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var se;return((se=this._fullRequestReader)==null?void 0:se._loaded)??0}getFullReader(){return(0,$.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new Z(this):new ee(this),this._fullRequestReader}getRangeReader(se,ie){if(ie<=this._progressiveDataLength)return null;const oe=this.isFsUrl?new ne(this,se,ie):new te(this,se,ie);return this._rangeRequestReaders.push(oe),oe}cancelAllRequests(se){var ie;(ie=this._fullRequestReader)==null||ie.cancel(se);for(const oe of this._rangeRequestReaders.slice(0))oe.cancel(se)}}_.PDFNodeStream=X;class G{constructor(se){this._url=se.url,this._done=!1,this._storedError=null,this.onProgress=null;const ie=se.source;this._contentLength=ie.length,this._loaded=0,this._filename=null,this._disableRange=ie.disableRange||!1,this._rangeChunkSize=ie.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!ie.disableStream,this._isRangeSupported=!ie.disableRange,this._readableStream=null,this._readCapability=new $.PromiseCapability,this._headersCapability=new $.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var oe;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const se=this._readableStream.read();return se===null?(this._readCapability=new $.PromiseCapability,this.read()):(this._loaded+=se.length,(oe=this.onProgress)==null||oe.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(se).buffer,done:!1})}cancel(se){if(!this._readableStream){this._error(se);return}this._readableStream.destroy(se)}_error(se){this._storedError=se,this._readCapability.resolve()}_setReadableStream(se){this._readableStream=se,se.on("readable",()=>{this._readCapability.resolve()}),se.on("end",()=>{se.destroy(),this._done=!0,this._readCapability.resolve()}),se.on("error",ie=>{this._error(ie)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new $.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Y{constructor(se){this._url=se.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new $.PromiseCapability;const ie=se.source;this._isStreamingSupported=!ie.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var oe;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const se=this._readableStream.read();return se===null?(this._readCapability=new $.PromiseCapability,this.read()):(this._loaded+=se.length,(oe=this.onProgress)==null||oe.call(this,{loaded:this._loaded}),{value:new Uint8Array(se).buffer,done:!1})}cancel(se){if(!this._readableStream){this._error(se);return}this._readableStream.destroy(se)}_error(se){this._storedError=se,this._readCapability.resolve()}_setReadableStream(se){this._readableStream=se,se.on("readable",()=>{this._readCapability.resolve()}),se.on("end",()=>{se.destroy(),this._done=!0,this._readCapability.resolve()}),se.on("error",ie=>{this._error(ie)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function Q(re,se){return{protocol:re.protocol,auth:re.auth,host:re.hostname,port:re.port,path:re.path,method:"GET",headers:se}}class ee extends G{constructor(se){super(se);const ie=oe=>{if(oe.statusCode===404){const le=new $.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=le,this._headersCapability.reject(le);return}this._headersCapability.resolve(),this._setReadableStream(oe);const ue=le=>this._readableStream.headers[le.toLowerCase()],{allowRangeRequests:ce,suggestedLength:ae}=(0,j.validateRangeRequestCapabilities)({getResponseHeader:ue,isHttp:se.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=ce,this._contentLength=ae||this._contentLength,this._filename=(0,j.extractFilenameFromHeader)(ue)};if(this._request=null,this._url.protocol==="http:"){const oe=require$$5;this._request=oe.request(Q(this._url,se.httpHeaders),ie)}else{const oe=require$$5;this._request=oe.request(Q(this._url,se.httpHeaders),ie)}this._request.on("error",oe=>{this._storedError=oe,this._headersCapability.reject(oe)}),this._request.end()}}class te extends Y{constructor(se,ie,oe){super(se),this._httpHeaders={};for(const ce in se.httpHeaders){const ae=se.httpHeaders[ce];ae!==void 0&&(this._httpHeaders[ce]=ae)}this._httpHeaders.Range=`bytes=${ie}-${oe-1}`;const ue=ce=>{if(ce.statusCode===404){const ae=new $.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=ae;return}this._setReadableStream(ce)};if(this._request=null,this._url.protocol==="http:"){const ce=require$$5;this._request=ce.request(Q(this._url,this._httpHeaders),ue)}else{const ce=require$$5;this._request=ce.request(Q(this._url,this._httpHeaders),ue)}this._request.on("error",ce=>{this._storedError=ce}),this._request.end()}}class Z extends G{constructor(se){super(se);let ie=decodeURIComponent(this._url.path);z.test(this._url.href)&&(ie=ie.replace(/^\//,""));const oe=require$$5;oe.lstat(ie,(ue,ce)=>{if(ue){ue.code==="ENOENT"&&(ue=new $.MissingPDFException(`Missing PDF "${ie}".`)),this._storedError=ue,this._headersCapability.reject(ue);return}this._contentLength=ce.size,this._setReadableStream(oe.createReadStream(ie)),this._headersCapability.resolve()})}}class ne extends Y{constructor(se,ie,oe){super(se);let ue=decodeURIComponent(this._url.path);z.test(this._url.href)&&(ue=ue.replace(/^\//,""));const ce=require$$5;this._setReadableStream(ce.createReadStream(ue,{start:ie,end:oe-1}))}}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.SVGGraphics=void 0;var $=M(6),j=M(1);const z={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},V="http://www.w3.org/XML/1998/namespace",X="http://www.w3.org/1999/xlink",G=["butt","round","square"],Y=["miter","round","bevel"],Q=function(ce,ae="",le=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!le)return URL.createObjectURL(new Blob([ce],{type:ae}));const he="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let ge=`data:${ae};base64,`;for(let de=0,pe=ce.length;de<pe;de+=3){const ye=ce[de]&255,_e=ce[de+1]&255,De=ce[de+2]&255,fe=ye>>2,Ae=(ye&3)<<4|_e>>4,Me=de+1<pe?(_e&15)<<2|De>>6:64,Ee=de+2<pe?De&63:64;ge+=he[fe]+he[Ae]+he[Me]+he[Ee]}return ge},ee=function(){const ce=new Uint8Array([137,80,78,71,13,10,26,10]),ae=12,le=new Int32Array(256);for(let De=0;De<256;De++){let fe=De;for(let Ae=0;Ae<8;Ae++)fe=fe&1?3988292384^fe>>1&2147483647:fe>>1&2147483647;le[De]=fe}function he(De,fe,Ae){let Me=-1;for(let Ee=fe;Ee<Ae;Ee++){const Te=(Me^De[Ee])&255,Be=le[Te];Me=Me>>>8^Be}return Me^-1}function ge(De,fe,Ae,Me){let Ee=Me;const Te=fe.length;Ae[Ee]=Te>>24&255,Ae[Ee+1]=Te>>16&255,Ae[Ee+2]=Te>>8&255,Ae[Ee+3]=Te&255,Ee+=4,Ae[Ee]=De.charCodeAt(0)&255,Ae[Ee+1]=De.charCodeAt(1)&255,Ae[Ee+2]=De.charCodeAt(2)&255,Ae[Ee+3]=De.charCodeAt(3)&255,Ee+=4,Ae.set(fe,Ee),Ee+=fe.length;const Be=he(Ae,Me+4,Ee);Ae[Ee]=Be>>24&255,Ae[Ee+1]=Be>>16&255,Ae[Ee+2]=Be>>8&255,Ae[Ee+3]=Be&255}function de(De,fe,Ae){let Me=1,Ee=0;for(let Te=fe;Te<Ae;++Te)Me=(Me+(De[Te]&255))%65521,Ee=(Ee+Me)%65521;return Ee<<16|Me}function pe(De){if(!j.isNodeJS)return ye(De);try{const fe=parseInt(process.versions.node)>=8?De:Buffer.from(De),Ae=require$$5.deflateSync(fe,{level:9});return Ae instanceof Uint8Array?Ae:new Uint8Array(Ae)}catch(fe){(0,j.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+fe)}return ye(De)}function ye(De){let fe=De.length;const Ae=65535,Me=Math.ceil(fe/Ae),Ee=new Uint8Array(2+fe+Me*5+4);let Te=0;Ee[Te++]=120,Ee[Te++]=156;let Be=0;for(;fe>Ae;)Ee[Te++]=0,Ee[Te++]=255,Ee[Te++]=255,Ee[Te++]=0,Ee[Te++]=0,Ee.set(De.subarray(Be,Be+Ae),Te),Te+=Ae,Be+=Ae,fe-=Ae;Ee[Te++]=1,Ee[Te++]=fe&255,Ee[Te++]=fe>>8&255,Ee[Te++]=~fe&65535&255,Ee[Te++]=(~fe&65535)>>8&255,Ee.set(De.subarray(Be),Te),Te+=De.length-Be;const Xe=de(De,0,De.length);return Ee[Te++]=Xe>>24&255,Ee[Te++]=Xe>>16&255,Ee[Te++]=Xe>>8&255,Ee[Te++]=Xe&255,Ee}function _e(De,fe,Ae,Me){const Ee=De.width,Te=De.height;let Be,Xe,ze;const Oe=De.data;switch(fe){case j.ImageKind.GRAYSCALE_1BPP:Xe=0,Be=1,ze=Ee+7>>3;break;case j.ImageKind.RGB_24BPP:Xe=2,Be=8,ze=Ee*3;break;case j.ImageKind.RGBA_32BPP:Xe=6,Be=8,ze=Ee*4;break;default:throw new Error("invalid format")}const Pe=new Uint8Array((1+ze)*Te);let ve=0,be=0;for(let Ve=0;Ve<Te;++Ve)Pe[ve++]=0,Pe.set(Oe.subarray(be,be+ze),ve),be+=ze,ve+=ze;if(fe===j.ImageKind.GRAYSCALE_1BPP&&Me){ve=0;for(let Ve=0;Ve<Te;Ve++){ve++;for(let ot=0;ot<ze;ot++)Pe[ve++]^=255}}const Ce=new Uint8Array([Ee>>24&255,Ee>>16&255,Ee>>8&255,Ee&255,Te>>24&255,Te>>16&255,Te>>8&255,Te&255,Be,Xe,0,0,0]),Ne=pe(Pe),Ie=ce.length+ae*3+Ce.length+Ne.length,Le=new Uint8Array(Ie);let je=0;return Le.set(ce,je),je+=ce.length,ge("IHDR",Ce,Le,je),je+=ae+Ce.length,ge("IDATA",Ne,Le,je),je+=ae+Ne.length,ge("IEND",new Uint8Array(0),Le,je),Q(Le,"image/png",Ae)}return function(fe,Ae,Me){const Ee=fe.kind===void 0?j.ImageKind.GRAYSCALE_1BPP:fe.kind;return _e(fe,Ee,Ae,Me)}}();class te{constructor(){this.fontSizeScale=1,this.fontWeight=z.fontWeight,this.fontSize=0,this.textMatrix=j.IDENTITY_MATRIX,this.fontMatrix=j.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=j.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=z.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(ae,le){this.x=ae,this.y=le}}function Z(ce){let ae=[];const le=[];for(const he of ce){if(he.fn==="save"){ae.push({fnId:92,fn:"group",items:[]}),le.push(ae),ae=ae.at(-1).items;continue}he.fn==="restore"?ae=le.pop():ae.push(he)}return ae}function ne(ce){if(Number.isInteger(ce))return ce.toString();const ae=ce.toFixed(10);let le=ae.length-1;if(ae[le]!=="0")return ae;do le--;while(ae[le]==="0");return ae.substring(0,ae[le]==="."?le:le+1)}function re(ce){if(ce[4]===0&&ce[5]===0){if(ce[1]===0&&ce[2]===0)return ce[0]===1&&ce[3]===1?"":`scale(${ne(ce[0])} ${ne(ce[3])})`;if(ce[0]===ce[3]&&ce[1]===-ce[2]){const ae=Math.acos(ce[0])*180/Math.PI;return`rotate(${ne(ae)})`}}else if(ce[0]===1&&ce[1]===0&&ce[2]===0&&ce[3]===1)return`translate(${ne(ce[4])} ${ne(ce[5])})`;return`matrix(${ne(ce[0])} ${ne(ce[1])} ${ne(ce[2])} ${ne(ce[3])} ${ne(ce[4])} ${ne(ce[5])})`}let se=0,ie=0,oe=0;class ue{constructor(ae,le,he=!1){(0,$.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new $.DOMSVGFactory,this.current=new te,this.transformMatrix=j.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=ae,this.objs=le,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!he,this._operatorIdMapping=[];for(const ge in j.OPS)this._operatorIdMapping[j.OPS[ge]]=ge}getObject(ae,le=null){return typeof ae=="string"?ae.startsWith("g_")?this.commonObjs.get(ae):this.objs.get(ae):le}save(){this.transformStack.push(this.transformMatrix);const ae=this.current;this.extraStack.push(ae),this.current=ae.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(ae){this.save(),this.executeOpTree(ae),this.restore()}loadDependencies(ae){const le=ae.fnArray,he=ae.argsArray;for(let ge=0,de=le.length;ge<de;ge++)if(le[ge]===j.OPS.dependency)for(const pe of he[ge]){const ye=pe.startsWith("g_")?this.commonObjs:this.objs,_e=new Promise(De=>{ye.get(pe,De)});this.current.dependencies.push(_e)}return Promise.all(this.current.dependencies)}transform(ae,le,he,ge,de,pe){const ye=[ae,le,he,ge,de,pe];this.transformMatrix=j.Util.transform(this.transformMatrix,ye),this.tgrp=null}getSVG(ae,le){this.viewport=le;const he=this._initialize(le);return this.loadDependencies(ae).then(()=>(this.transformMatrix=j.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(ae)),he))}convertOpList(ae){const le=this._operatorIdMapping,he=ae.argsArray,ge=ae.fnArray,de=[];for(let pe=0,ye=ge.length;pe<ye;pe++){const _e=ge[pe];de.push({fnId:_e,fn:le[_e],args:he[pe]})}return Z(de)}executeOpTree(ae){for(const le of ae){const he=le.fn,ge=le.fnId,de=le.args;switch(ge|0){case j.OPS.beginText:this.beginText();break;case j.OPS.dependency:break;case j.OPS.setLeading:this.setLeading(de);break;case j.OPS.setLeadingMoveText:this.setLeadingMoveText(de[0],de[1]);break;case j.OPS.setFont:this.setFont(de);break;case j.OPS.showText:this.showText(de[0]);break;case j.OPS.showSpacedText:this.showText(de[0]);break;case j.OPS.endText:this.endText();break;case j.OPS.moveText:this.moveText(de[0],de[1]);break;case j.OPS.setCharSpacing:this.setCharSpacing(de[0]);break;case j.OPS.setWordSpacing:this.setWordSpacing(de[0]);break;case j.OPS.setHScale:this.setHScale(de[0]);break;case j.OPS.setTextMatrix:this.setTextMatrix(de[0],de[1],de[2],de[3],de[4],de[5]);break;case j.OPS.setTextRise:this.setTextRise(de[0]);break;case j.OPS.setTextRenderingMode:this.setTextRenderingMode(de[0]);break;case j.OPS.setLineWidth:this.setLineWidth(de[0]);break;case j.OPS.setLineJoin:this.setLineJoin(de[0]);break;case j.OPS.setLineCap:this.setLineCap(de[0]);break;case j.OPS.setMiterLimit:this.setMiterLimit(de[0]);break;case j.OPS.setFillRGBColor:this.setFillRGBColor(de[0],de[1],de[2]);break;case j.OPS.setStrokeRGBColor:this.setStrokeRGBColor(de[0],de[1],de[2]);break;case j.OPS.setStrokeColorN:this.setStrokeColorN(de);break;case j.OPS.setFillColorN:this.setFillColorN(de);break;case j.OPS.shadingFill:this.shadingFill(de[0]);break;case j.OPS.setDash:this.setDash(de[0],de[1]);break;case j.OPS.setRenderingIntent:this.setRenderingIntent(de[0]);break;case j.OPS.setFlatness:this.setFlatness(de[0]);break;case j.OPS.setGState:this.setGState(de[0]);break;case j.OPS.fill:this.fill();break;case j.OPS.eoFill:this.eoFill();break;case j.OPS.stroke:this.stroke();break;case j.OPS.fillStroke:this.fillStroke();break;case j.OPS.eoFillStroke:this.eoFillStroke();break;case j.OPS.clip:this.clip("nonzero");break;case j.OPS.eoClip:this.clip("evenodd");break;case j.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case j.OPS.paintImageXObject:this.paintImageXObject(de[0]);break;case j.OPS.paintInlineImageXObject:this.paintInlineImageXObject(de[0]);break;case j.OPS.paintImageMaskXObject:this.paintImageMaskXObject(de[0]);break;case j.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(de[0],de[1]);break;case j.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case j.OPS.closePath:this.closePath();break;case j.OPS.closeStroke:this.closeStroke();break;case j.OPS.closeFillStroke:this.closeFillStroke();break;case j.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case j.OPS.nextLine:this.nextLine();break;case j.OPS.transform:this.transform(de[0],de[1],de[2],de[3],de[4],de[5]);break;case j.OPS.constructPath:this.constructPath(de[0],de[1]);break;case j.OPS.endPath:this.endPath();break;case 92:this.group(le.items);break;default:(0,j.warn)(`Unimplemented operator ${he}`);break}}}setWordSpacing(ae){this.current.wordSpacing=ae}setCharSpacing(ae){this.current.charSpacing=ae}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(ae,le,he,ge,de,pe){const ye=this.current;ye.textMatrix=ye.lineMatrix=[ae,le,he,ge,de,pe],ye.textMatrixScale=Math.hypot(ae,le),ye.x=ye.lineX=0,ye.y=ye.lineY=0,ye.xcoords=[],ye.ycoords=[],ye.tspan=this.svgFactory.createElement("svg:tspan"),ye.tspan.setAttributeNS(null,"font-family",ye.fontFamily),ye.tspan.setAttributeNS(null,"font-size",`${ne(ye.fontSize)}px`),ye.tspan.setAttributeNS(null,"y",ne(-ye.y)),ye.txtElement=this.svgFactory.createElement("svg:text"),ye.txtElement.append(ye.tspan)}beginText(){const ae=this.current;ae.x=ae.lineX=0,ae.y=ae.lineY=0,ae.textMatrix=j.IDENTITY_MATRIX,ae.lineMatrix=j.IDENTITY_MATRIX,ae.textMatrixScale=1,ae.tspan=this.svgFactory.createElement("svg:tspan"),ae.txtElement=this.svgFactory.createElement("svg:text"),ae.txtgrp=this.svgFactory.createElement("svg:g"),ae.xcoords=[],ae.ycoords=[]}moveText(ae,le){const he=this.current;he.x=he.lineX+=ae,he.y=he.lineY+=le,he.xcoords=[],he.ycoords=[],he.tspan=this.svgFactory.createElement("svg:tspan"),he.tspan.setAttributeNS(null,"font-family",he.fontFamily),he.tspan.setAttributeNS(null,"font-size",`${ne(he.fontSize)}px`),he.tspan.setAttributeNS(null,"y",ne(-he.y))}showText(ae){const le=this.current,he=le.font,ge=le.fontSize;if(ge===0)return;const de=le.fontSizeScale,pe=le.charSpacing,ye=le.wordSpacing,_e=le.fontDirection,De=le.textHScale*_e,fe=he.vertical,Ae=fe?1:-1,Me=he.defaultVMetrics,Ee=ge*le.fontMatrix[0];let Te=0;for(const ze of ae){if(ze===null){Te+=_e*ye;continue}else if(typeof ze=="number"){Te+=Ae*ze*ge/1e3;continue}const Oe=(ze.isSpace?ye:0)+pe,Pe=ze.fontChar;let ve,be,Ce=ze.width;if(fe){let Ie;const Le=ze.vmetric||Me;Ie=ze.vmetric?Le[1]:Ce*.5,Ie=-Ie*Ee;const je=Le[2]*Ee;Ce=Le?-Le[0]:Ce,ve=Ie/de,be=(Te+je)/de}else ve=Te/de,be=0;(ze.isInFont||he.missingFile)&&(le.xcoords.push(le.x+ve),fe&&le.ycoords.push(-le.y+be),le.tspan.textContent+=Pe);const Ne=fe?Ce*Ee-Oe*_e:Ce*Ee+Oe*_e;Te+=Ne}le.tspan.setAttributeNS(null,"x",le.xcoords.map(ne).join(" ")),fe?le.tspan.setAttributeNS(null,"y",le.ycoords.map(ne).join(" ")):le.tspan.setAttributeNS(null,"y",ne(-le.y)),fe?le.y-=Te:le.x+=Te*De,le.tspan.setAttributeNS(null,"font-family",le.fontFamily),le.tspan.setAttributeNS(null,"font-size",`${ne(le.fontSize)}px`),le.fontStyle!==z.fontStyle&&le.tspan.setAttributeNS(null,"font-style",le.fontStyle),le.fontWeight!==z.fontWeight&&le.tspan.setAttributeNS(null,"font-weight",le.fontWeight);const Be=le.textRenderingMode&j.TextRenderingMode.FILL_STROKE_MASK;if(Be===j.TextRenderingMode.FILL||Be===j.TextRenderingMode.FILL_STROKE?(le.fillColor!==z.fillColor&&le.tspan.setAttributeNS(null,"fill",le.fillColor),le.fillAlpha<1&&le.tspan.setAttributeNS(null,"fill-opacity",le.fillAlpha)):le.textRenderingMode===j.TextRenderingMode.ADD_TO_PATH?le.tspan.setAttributeNS(null,"fill","transparent"):le.tspan.setAttributeNS(null,"fill","none"),Be===j.TextRenderingMode.STROKE||Be===j.TextRenderingMode.FILL_STROKE){const ze=1/(le.textMatrixScale||1);this._setStrokeAttributes(le.tspan,ze)}let Xe=le.textMatrix;le.textRise!==0&&(Xe=Xe.slice(),Xe[5]+=le.textRise),le.txtElement.setAttributeNS(null,"transform",`${re(Xe)} scale(${ne(De)}, -1)`),le.txtElement.setAttributeNS(V,"xml:space","preserve"),le.txtElement.append(le.tspan),le.txtgrp.append(le.txtElement),this._ensureTransformGroup().append(le.txtElement)}setLeadingMoveText(ae,le){this.setLeading(-le),this.moveText(ae,le)}addFontStyle(ae){if(!ae.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const le=Q(ae.data,ae.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${ae.loadedName}"; src: url(${le}); }
`}setFont(ae){const le=this.current,he=this.commonObjs.get(ae[0]);let ge=ae[1];le.font=he,this.embedFonts&&!he.missingFile&&!this.embeddedFonts[he.loadedName]&&(this.addFontStyle(he),this.embeddedFonts[he.loadedName]=he),le.fontMatrix=he.fontMatrix||j.FONT_IDENTITY_MATRIX;let de="normal";he.black?de="900":he.bold&&(de="bold");const pe=he.italic?"italic":"normal";ge<0?(ge=-ge,le.fontDirection=-1):le.fontDirection=1,le.fontSize=ge,le.fontFamily=he.loadedName,le.fontWeight=de,le.fontStyle=pe,le.tspan=this.svgFactory.createElement("svg:tspan"),le.tspan.setAttributeNS(null,"y",ne(-le.y)),le.xcoords=[],le.ycoords=[]}endText(){var le;const ae=this.current;ae.textRenderingMode&j.TextRenderingMode.ADD_TO_PATH_FLAG&&((le=ae.txtElement)!=null&&le.hasChildNodes())&&(ae.element=ae.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(ae){ae>0&&(this.current.lineWidth=ae)}setLineCap(ae){this.current.lineCap=G[ae]}setLineJoin(ae){this.current.lineJoin=Y[ae]}setMiterLimit(ae){this.current.miterLimit=ae}setStrokeAlpha(ae){this.current.strokeAlpha=ae}setStrokeRGBColor(ae,le,he){this.current.strokeColor=j.Util.makeHexColor(ae,le,he)}setFillAlpha(ae){this.current.fillAlpha=ae}setFillRGBColor(ae,le,he){this.current.fillColor=j.Util.makeHexColor(ae,le,he),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(ae){this.current.strokeColor=this._makeColorN_Pattern(ae)}setFillColorN(ae){this.current.fillColor=this._makeColorN_Pattern(ae)}shadingFill(ae){const{width:le,height:he}=this.viewport,ge=j.Util.inverseTransform(this.transformMatrix),[de,pe,ye,_e]=j.Util.getAxialAlignedBoundingBox([0,0,le,he],ge),De=this.svgFactory.createElement("svg:rect");De.setAttributeNS(null,"x",de),De.setAttributeNS(null,"y",pe),De.setAttributeNS(null,"width",ye-de),De.setAttributeNS(null,"height",_e-pe),De.setAttributeNS(null,"fill",this._makeShadingPattern(ae)),this.current.fillAlpha<1&&De.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(De)}_makeColorN_Pattern(ae){return ae[0]==="TilingPattern"?this._makeTilingPattern(ae):this._makeShadingPattern(ae)}_makeTilingPattern(ae){const le=ae[1],he=ae[2],ge=ae[3]||j.IDENTITY_MATRIX,[de,pe,ye,_e]=ae[4],De=ae[5],fe=ae[6],Ae=ae[7],Me=`shading${oe++}`,[Ee,Te,Be,Xe]=j.Util.normalizeRect([...j.Util.applyTransform([de,pe],ge),...j.Util.applyTransform([ye,_e],ge)]),[ze,Oe]=j.Util.singularValueDecompose2dScale(ge),Pe=De*ze,ve=fe*Oe,be=this.svgFactory.createElement("svg:pattern");be.setAttributeNS(null,"id",Me),be.setAttributeNS(null,"patternUnits","userSpaceOnUse"),be.setAttributeNS(null,"width",Pe),be.setAttributeNS(null,"height",ve),be.setAttributeNS(null,"x",`${Ee}`),be.setAttributeNS(null,"y",`${Te}`);const Ce=this.svg,Ne=this.transformMatrix,Ie=this.current.fillColor,Le=this.current.strokeColor,je=this.svgFactory.create(Be-Ee,Xe-Te);if(this.svg=je,this.transformMatrix=ge,Ae===2){const Ve=j.Util.makeHexColor(...le);this.current.fillColor=Ve,this.current.strokeColor=Ve}return this.executeOpTree(this.convertOpList(he)),this.svg=Ce,this.transformMatrix=Ne,this.current.fillColor=Ie,this.current.strokeColor=Le,be.append(je.childNodes[0]),this.defs.append(be),`url(#${Me})`}_makeShadingPattern(ae){switch(typeof ae=="string"&&(ae=this.objs.get(ae)),ae[0]){case"RadialAxial":const le=`shading${oe++}`,he=ae[3];let ge;switch(ae[1]){case"axial":const de=ae[4],pe=ae[5];ge=this.svgFactory.createElement("svg:linearGradient"),ge.setAttributeNS(null,"id",le),ge.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),ge.setAttributeNS(null,"x1",de[0]),ge.setAttributeNS(null,"y1",de[1]),ge.setAttributeNS(null,"x2",pe[0]),ge.setAttributeNS(null,"y2",pe[1]);break;case"radial":const ye=ae[4],_e=ae[5],De=ae[6],fe=ae[7];ge=this.svgFactory.createElement("svg:radialGradient"),ge.setAttributeNS(null,"id",le),ge.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),ge.setAttributeNS(null,"cx",_e[0]),ge.setAttributeNS(null,"cy",_e[1]),ge.setAttributeNS(null,"r",fe),ge.setAttributeNS(null,"fx",ye[0]),ge.setAttributeNS(null,"fy",ye[1]),ge.setAttributeNS(null,"fr",De);break;default:throw new Error(`Unknown RadialAxial type: ${ae[1]}`)}for(const de of he){const pe=this.svgFactory.createElement("svg:stop");pe.setAttributeNS(null,"offset",de[0]),pe.setAttributeNS(null,"stop-color",de[1]),ge.append(pe)}return this.defs.append(ge),`url(#${le})`;case"Mesh":return(0,j.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${ae[0]}`)}}setDash(ae,le){this.current.dashArray=ae,this.current.dashPhase=le}constructPath(ae,le){const he=this.current;let ge=he.x,de=he.y,pe=[],ye=0;for(const _e of ae)switch(_e|0){case j.OPS.rectangle:ge=le[ye++],de=le[ye++];const De=le[ye++],fe=le[ye++],Ae=ge+De,Me=de+fe;pe.push("M",ne(ge),ne(de),"L",ne(Ae),ne(de),"L",ne(Ae),ne(Me),"L",ne(ge),ne(Me),"Z");break;case j.OPS.moveTo:ge=le[ye++],de=le[ye++],pe.push("M",ne(ge),ne(de));break;case j.OPS.lineTo:ge=le[ye++],de=le[ye++],pe.push("L",ne(ge),ne(de));break;case j.OPS.curveTo:ge=le[ye+4],de=le[ye+5],pe.push("C",ne(le[ye]),ne(le[ye+1]),ne(le[ye+2]),ne(le[ye+3]),ne(ge),ne(de)),ye+=6;break;case j.OPS.curveTo2:pe.push("C",ne(ge),ne(de),ne(le[ye]),ne(le[ye+1]),ne(le[ye+2]),ne(le[ye+3])),ge=le[ye+2],de=le[ye+3],ye+=4;break;case j.OPS.curveTo3:ge=le[ye+2],de=le[ye+3],pe.push("C",ne(le[ye]),ne(le[ye+1]),ne(ge),ne(de),ne(ge),ne(de)),ye+=4;break;case j.OPS.closePath:pe.push("Z");break}pe=pe.join(" "),he.path&&ae.length>0&&ae[0]!==j.OPS.rectangle&&ae[0]!==j.OPS.moveTo?pe=he.path.getAttributeNS(null,"d")+pe:(he.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(he.path)),he.path.setAttributeNS(null,"d",pe),he.path.setAttributeNS(null,"fill","none"),he.element=he.path,he.setCurrentPoint(ge,de)}endPath(){const ae=this.current;if(ae.path=null,!this.pendingClip)return;if(!ae.element){this.pendingClip=null;return}const le=`clippath${se++}`,he=this.svgFactory.createElement("svg:clipPath");he.setAttributeNS(null,"id",le),he.setAttributeNS(null,"transform",re(this.transformMatrix));const ge=ae.element.cloneNode(!0);if(this.pendingClip==="evenodd"?ge.setAttributeNS(null,"clip-rule","evenodd"):ge.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,he.append(ge),this.defs.append(he),ae.activeClipUrl){ae.clipGroup=null;for(const de of this.extraStack)de.clipGroup=null;he.setAttributeNS(null,"clip-path",ae.activeClipUrl)}ae.activeClipUrl=`url(#${le})`,this.tgrp=null}clip(ae){this.pendingClip=ae}closePath(){const ae=this.current;if(ae.path){const le=`${ae.path.getAttributeNS(null,"d")}Z`;ae.path.setAttributeNS(null,"d",le)}}setLeading(ae){this.current.leading=-ae}setTextRise(ae){this.current.textRise=ae}setTextRenderingMode(ae){this.current.textRenderingMode=ae}setHScale(ae){this.current.textHScale=ae/100}setRenderingIntent(ae){}setFlatness(ae){}setGState(ae){for(const[le,he]of ae)switch(le){case"LW":this.setLineWidth(he);break;case"LC":this.setLineCap(he);break;case"LJ":this.setLineJoin(he);break;case"ML":this.setMiterLimit(he);break;case"D":this.setDash(he[0],he[1]);break;case"RI":this.setRenderingIntent(he);break;case"FL":this.setFlatness(he);break;case"Font":this.setFont(he);break;case"CA":this.setStrokeAlpha(he);break;case"ca":this.setFillAlpha(he);break;default:(0,j.warn)(`Unimplemented graphic state operator ${le}`);break}}fill(){const ae=this.current;ae.element&&(ae.element.setAttributeNS(null,"fill",ae.fillColor),ae.element.setAttributeNS(null,"fill-opacity",ae.fillAlpha),this.endPath())}stroke(){const ae=this.current;ae.element&&(this._setStrokeAttributes(ae.element),ae.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(ae,le=1){const he=this.current;let ge=he.dashArray;le!==1&&ge.length>0&&(ge=ge.map(function(de){return le*de})),ae.setAttributeNS(null,"stroke",he.strokeColor),ae.setAttributeNS(null,"stroke-opacity",he.strokeAlpha),ae.setAttributeNS(null,"stroke-miterlimit",ne(he.miterLimit)),ae.setAttributeNS(null,"stroke-linecap",he.lineCap),ae.setAttributeNS(null,"stroke-linejoin",he.lineJoin),ae.setAttributeNS(null,"stroke-width",ne(le*he.lineWidth)+"px"),ae.setAttributeNS(null,"stroke-dasharray",ge.map(ne).join(" ")),ae.setAttributeNS(null,"stroke-dashoffset",ne(le*he.dashPhase)+"px")}eoFill(){var ae;(ae=this.current.element)==null||ae.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var ae;(ae=this.current.element)==null||ae.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const ae=this.svgFactory.createElement("svg:rect");ae.setAttributeNS(null,"x","0"),ae.setAttributeNS(null,"y","0"),ae.setAttributeNS(null,"width","1px"),ae.setAttributeNS(null,"height","1px"),ae.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(ae)}paintImageXObject(ae){const le=this.getObject(ae);if(!le){(0,j.warn)(`Dependent image with object ID ${ae} is not ready yet`);return}this.paintInlineImageXObject(le)}paintInlineImageXObject(ae,le){const he=ae.width,ge=ae.height,de=ee(ae,this.forceDataSchema,!!le),pe=this.svgFactory.createElement("svg:rect");pe.setAttributeNS(null,"x","0"),pe.setAttributeNS(null,"y","0"),pe.setAttributeNS(null,"width",ne(he)),pe.setAttributeNS(null,"height",ne(ge)),this.current.element=pe,this.clip("nonzero");const ye=this.svgFactory.createElement("svg:image");ye.setAttributeNS(X,"xlink:href",de),ye.setAttributeNS(null,"x","0"),ye.setAttributeNS(null,"y",ne(-ge)),ye.setAttributeNS(null,"width",ne(he)+"px"),ye.setAttributeNS(null,"height",ne(ge)+"px"),ye.setAttributeNS(null,"transform",`scale(${ne(1/he)} ${ne(-1/ge)})`),le?le.append(ye):this._ensureTransformGroup().append(ye)}paintImageMaskXObject(ae){const le=this.getObject(ae.data,ae);if(le.bitmap){(0,j.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const he=this.current,ge=le.width,de=le.height,pe=he.fillColor;he.maskId=`mask${ie++}`;const ye=this.svgFactory.createElement("svg:mask");ye.setAttributeNS(null,"id",he.maskId);const _e=this.svgFactory.createElement("svg:rect");_e.setAttributeNS(null,"x","0"),_e.setAttributeNS(null,"y","0"),_e.setAttributeNS(null,"width",ne(ge)),_e.setAttributeNS(null,"height",ne(de)),_e.setAttributeNS(null,"fill",pe),_e.setAttributeNS(null,"mask",`url(#${he.maskId})`),this.defs.append(ye),this._ensureTransformGroup().append(_e),this.paintInlineImageXObject(le,ye)}paintFormXObjectBegin(ae,le){if(Array.isArray(ae)&&ae.length===6&&this.transform(ae[0],ae[1],ae[2],ae[3],ae[4],ae[5]),le){const he=le[2]-le[0],ge=le[3]-le[1],de=this.svgFactory.createElement("svg:rect");de.setAttributeNS(null,"x",le[0]),de.setAttributeNS(null,"y",le[1]),de.setAttributeNS(null,"width",ne(he)),de.setAttributeNS(null,"height",ne(ge)),this.current.element=de,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(ae){const le=this.svgFactory.create(ae.width,ae.height),he=this.svgFactory.createElement("svg:defs");le.append(he),this.defs=he;const ge=this.svgFactory.createElement("svg:g");return ge.setAttributeNS(null,"transform",re(ae.transform)),le.append(ge),this.svg=ge,le}_ensureClipGroup(){if(!this.current.clipGroup){const ae=this.svgFactory.createElement("svg:g");ae.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(ae),this.current.clipGroup=ae}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",re(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}_.SVGGraphics=ue},(q,_)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.XfaText=void 0;class M{static textContent(j){const z=[],V={items:z,styles:Object.create(null)};function X(G){var ee;if(!G)return;let Y=null;const Q=G.name;if(Q==="#text")Y=G.value;else if(M.shouldBuildText(Q))(ee=G==null?void 0:G.attributes)!=null&&ee.textContent?Y=G.attributes.textContent:G.value&&(Y=G.value);else return;if(Y!==null&&z.push({str:Y}),!!G.children)for(const te of G.children)X(te)}return X(j),V}static shouldBuildText(j){return!(j==="textarea"||j==="input"||j==="option"||j==="select")}}_.XfaText=M},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.TextLayerRenderTask=void 0,_.renderTextLayer=re,_.updateTextLayer=se;var $=M(1),j=M(6);const z=1e5,V=30,X=.8,G=new Map;function Y(ie,oe){let ue;if(oe&&$.FeatureTest.isOffscreenCanvasSupported)ue=new OffscreenCanvas(ie,ie).getContext("2d",{alpha:!1});else{const ce=document.createElement("canvas");ce.width=ce.height=ie,ue=ce.getContext("2d",{alpha:!1})}return ue}function Q(ie,oe){const ue=G.get(ie);if(ue)return ue;const ce=Y(V,oe);ce.font=`${V}px ${ie}`;const ae=ce.measureText("");let le=ae.fontBoundingBoxAscent,he=Math.abs(ae.fontBoundingBoxDescent);if(le){const de=le/(le+he);return G.set(ie,de),ce.canvas.width=ce.canvas.height=0,de}ce.strokeStyle="red",ce.clearRect(0,0,V,V),ce.strokeText("g",0,0);let ge=ce.getImageData(0,0,V,V).data;he=0;for(let de=ge.length-1-3;de>=0;de-=4)if(ge[de]>0){he=Math.ceil(de/4/V);break}ce.clearRect(0,0,V,V),ce.strokeText("A",0,V),ge=ce.getImageData(0,0,V,V).data,le=0;for(let de=0,pe=ge.length;de<pe;de+=4)if(ge[de]>0){le=V-Math.floor(de/4/V);break}if(ce.canvas.width=ce.canvas.height=0,le){const de=le/(le+he);return G.set(ie,de),de}return G.set(ie,X),X}function ee(ie,oe,ue){const ce=document.createElement("span"),ae={angle:0,canvasWidth:0,hasText:oe.str!=="",hasEOL:oe.hasEOL,fontSize:0};ie._textDivs.push(ce);const le=$.Util.transform(ie._transform,oe.transform);let he=Math.atan2(le[1],le[0]);const ge=ue[oe.fontName];ge.vertical&&(he+=Math.PI/2);const de=Math.hypot(le[2],le[3]),pe=de*Q(ge.fontFamily,ie._isOffscreenCanvasSupported);let ye,_e;he===0?(ye=le[4],_e=le[5]-pe):(ye=le[4]+pe*Math.sin(he),_e=le[5]-pe*Math.cos(he));const De="calc(var(--scale-factor)*",fe=ce.style;ie._container===ie._rootContainer?(fe.left=`${(100*ye/ie._pageWidth).toFixed(2)}%`,fe.top=`${(100*_e/ie._pageHeight).toFixed(2)}%`):(fe.left=`${De}${ye.toFixed(2)}px)`,fe.top=`${De}${_e.toFixed(2)}px)`),fe.fontSize=`${De}${de.toFixed(2)}px)`,fe.fontFamily=ge.fontFamily,ae.fontSize=de,ce.setAttribute("role","presentation"),ce.textContent=oe.str,ce.dir=oe.dir,ie._fontInspectorEnabled&&(ce.dataset.fontName=oe.fontName),he!==0&&(ae.angle=he*(180/Math.PI));let Ae=!1;if(oe.str.length>1)Ae=!0;else if(oe.str!==" "&&oe.transform[0]!==oe.transform[3]){const Me=Math.abs(oe.transform[0]),Ee=Math.abs(oe.transform[3]);Me!==Ee&&Math.max(Me,Ee)/Math.min(Me,Ee)>1.5&&(Ae=!0)}Ae&&(ae.canvasWidth=ge.vertical?oe.height:oe.width),ie._textDivProperties.set(ce,ae),ie._isReadableStream&&ie._layoutText(ce)}function te(ie){const{div:oe,scale:ue,properties:ce,ctx:ae,prevFontSize:le,prevFontFamily:he}=ie,{style:ge}=oe;let de="";if(ce.canvasWidth!==0&&ce.hasText){const{fontFamily:pe}=ge,{canvasWidth:ye,fontSize:_e}=ce;(le!==_e||he!==pe)&&(ae.font=`${_e*ue}px ${pe}`,ie.prevFontSize=_e,ie.prevFontFamily=pe);const{width:De}=ae.measureText(oe.textContent);De>0&&(de=`scaleX(${ye*ue/De})`)}ce.angle!==0&&(de=`rotate(${ce.angle}deg) ${de}`),de.length>0&&(ge.transform=de)}function Z(ie){if(ie._canceled)return;const oe=ie._textDivs,ue=ie._capability;if(oe.length>z){ue.resolve();return}if(!ie._isReadableStream)for(const ae of oe)ie._layoutText(ae);ue.resolve()}class ne{constructor({textContentSource:oe,container:ue,viewport:ce,textDivs:ae,textDivProperties:le,textContentItemsStr:he,isOffscreenCanvasSupported:ge}){var De;this._textContentSource=oe,this._isReadableStream=oe instanceof ReadableStream,this._container=this._rootContainer=ue,this._textDivs=ae||[],this._textContentItemsStr=he||[],this._isOffscreenCanvasSupported=ge,this._fontInspectorEnabled=!!((De=globalThis.FontInspector)!=null&&De.enabled),this._reader=null,this._textDivProperties=le||new WeakMap,this._canceled=!1,this._capability=new $.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:ce.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:Y(0,ge)};const{pageWidth:de,pageHeight:pe,pageX:ye,pageY:_e}=ce.rawDims;this._transform=[1,0,0,-1,-ye,_e+pe],this._pageWidth=de,this._pageHeight=pe,(0,j.setLayerDimensions)(ue,ce),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new $.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new $.AbortException("TextLayer task cancelled."))}_processItems(oe,ue){for(const ce of oe){if(ce.str===void 0){if(ce.type==="beginMarkedContentProps"||ce.type==="beginMarkedContent"){const ae=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),ce.id!==null&&this._container.setAttribute("id",`${ce.id}`),ae.append(this._container)}else ce.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(ce.str),ee(this,ce,ue)}}_layoutText(oe){const ue=this._layoutTextParams.properties=this._textDivProperties.get(oe);if(this._layoutTextParams.div=oe,te(this._layoutTextParams),ue.hasText&&this._container.append(oe),ue.hasEOL){const ce=document.createElement("br");ce.setAttribute("role","presentation"),this._container.append(ce)}}_render(){const oe=new $.PromiseCapability;let ue=Object.create(null);if(this._isReadableStream){const ce=()=>{this._reader.read().then(({value:ae,done:le})=>{if(le){oe.resolve();return}Object.assign(ue,ae.styles),this._processItems(ae.items,ue),ce()},oe.reject)};this._reader=this._textContentSource.getReader(),ce()}else if(this._textContentSource){const{items:ce,styles:ae}=this._textContentSource;this._processItems(ce,ae),oe.resolve()}else throw new Error('No "textContentSource" parameter specified.');oe.promise.then(()=>{ue=null,Z(this)},this._capability.reject)}}_.TextLayerRenderTask=ne;function re(ie){!ie.textContentSource&&(ie.textContent||ie.textContentStream)&&((0,j.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),ie.textContentSource=ie.textContent||ie.textContentStream);const{container:oe,viewport:ue}=ie,ce=getComputedStyle(oe),ae=ce.getPropertyValue("visibility"),le=parseFloat(ce.getPropertyValue("--scale-factor"));ae==="visible"&&(!le||Math.abs(le-ue.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const he=new ne(ie);return he._render(),he}function se({container:ie,viewport:oe,textDivs:ue,textDivProperties:ce,isOffscreenCanvasSupported:ae,mustRotate:le=!0,mustRescale:he=!0}){if(le&&(0,j.setLayerDimensions)(ie,{rotation:oe.rotation}),he){const ge=Y(0,ae),pe={prevFontSize:null,prevFontFamily:null,div:null,scale:oe.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:ge};for(const ye of ue)pe.properties=ce.get(ye),pe.div=ye,te(pe)}}},(q,_,M)=>{var ee,te,Z,ne,re,se,ie,oe,ue,ce,ae,Sn,he,ir,de,Fn,ye,Tn;Object.defineProperty(_,"__esModule",{value:!0}),_.AnnotationEditorLayer=void 0;var $=M(1),j=M(4),z=M(5),V=M(28),X=M(33),G=M(6),Y=M(34);const De=class{constructor({uiManager:Ae,pageIndex:Me,div:Ee,accessibilityManager:Te,annotationLayer:Be,viewport:Xe,l10n:ze}){Ze(this,ae);Ze(this,he);Ze(this,de);Ze(this,ye);Ze(this,ee,void 0);Ze(this,te,!1);Ze(this,Z,null);Ze(this,ne,this.pointerup.bind(this));Ze(this,re,this.pointerdown.bind(this));Ze(this,se,new Map);Ze(this,ie,!1);Ze(this,oe,!1);Ze(this,ue,!1);Ze(this,ce,void 0);const Oe=[V.FreeTextEditor,X.InkEditor,Y.StampEditor];if(!De._initialized){De._initialized=!0;for(const Pe of Oe)Pe.initialize(ze)}Ae.registerEditorTypes(Oe),dt(this,ce,Ae),this.pageIndex=Me,this.div=Ee,dt(this,ee,Te),dt(this,Z,Be),this.viewport=Xe,we(this,ce).addLayer(this)}get isEmpty(){return we(this,se).size===0}updateToolbar(Ae){we(this,ce).updateToolbar(Ae)}updateMode(Ae=we(this,ce).getMode()){st(this,ye,Tn).call(this),Ae===$.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),we(this,ce).unselectAll(),Ae!==$.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",Ae===$.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",Ae===$.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",Ae===$.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(Ae){if(!Ae&&we(this,ce).getMode()!==$.AnnotationEditorType.INK)return;if(!Ae){for(const Ee of we(this,se).values())if(Ee.isEmpty()){Ee.setInBackground();return}}st(this,de,Fn).call(this,{offsetX:0,offsetY:0}).setInBackground()}setEditingState(Ae){we(this,ce).setEditingState(Ae)}addCommands(Ae){we(this,ce).addCommands(Ae)}enable(){this.div.style.pointerEvents="auto";const Ae=new Set;for(const Ee of we(this,se).values())Ee.enableEditing(),Ee.annotationElementId&&Ae.add(Ee.annotationElementId);if(!we(this,Z))return;const Me=we(this,Z).getEditableAnnotations();for(const Ee of Me){if(Ee.hide(),we(this,ce).isDeletedAnnotationElement(Ee.data.id)||Ae.has(Ee.data.id))continue;const Te=this.deserialize(Ee);Te&&(this.addOrRebuild(Te),Te.enableEditing())}}disable(){var Me;dt(this,ue,!0),this.div.style.pointerEvents="none";const Ae=new Set;for(const Ee of we(this,se).values()){if(Ee.disableEditing(),!Ee.annotationElementId||Ee.serialize()!==null){Ae.add(Ee.annotationElementId);continue}(Me=this.getEditableAnnotation(Ee.annotationElementId))==null||Me.show(),Ee.remove()}if(we(this,Z)){const Ee=we(this,Z).getEditableAnnotations();for(const Te of Ee){const{id:Be}=Te.data;Ae.has(Be)||we(this,ce).isDeletedAnnotationElement(Be)||Te.show()}}st(this,ye,Tn).call(this),this.isEmpty&&(this.div.hidden=!0),dt(this,ue,!1)}getEditableAnnotation(Ae){var Me;return((Me=we(this,Z))==null?void 0:Me.getEditableAnnotation(Ae))||null}setActiveEditor(Ae){we(this,ce).getActive()!==Ae&&we(this,ce).setActiveEditor(Ae)}enableClick(){this.div.addEventListener("pointerdown",we(this,re)),this.div.addEventListener("pointerup",we(this,ne))}disableClick(){this.div.removeEventListener("pointerdown",we(this,re)),this.div.removeEventListener("pointerup",we(this,ne))}attach(Ae){we(this,se).set(Ae.id,Ae);const{annotationElementId:Me}=Ae;Me&&we(this,ce).isDeletedAnnotationElement(Me)&&we(this,ce).removeDeletedAnnotationElement(Ae)}detach(Ae){var Me;we(this,se).delete(Ae.id),(Me=we(this,ee))==null||Me.removePointerInTextLayer(Ae.contentDiv),!we(this,ue)&&Ae.annotationElementId&&we(this,ce).addDeletedAnnotationElement(Ae)}remove(Ae){this.detach(Ae),we(this,ce).removeEditor(Ae),Ae.div.style.display="none",setTimeout(()=>{Ae.div.style.display="",Ae.div.remove(),Ae.isAttachedToDOM=!1,document.activeElement===document.body&&we(this,ce).focusMainContainer()},0),we(this,oe)||this.addInkEditorIfNeeded(!1)}add(Ae){if(st(this,ae,Sn).call(this,Ae),we(this,ce).addEditor(Ae),this.attach(Ae),!Ae.isAttachedToDOM){const Me=Ae.render();this.div.append(Me),Ae.isAttachedToDOM=!0}this.moveEditorInDOM(Ae),Ae.onceAdded(),we(this,ce).addToAnnotationStorage(Ae)}moveEditorInDOM(Ae){var Me;(Me=we(this,ee))==null||Me.moveElementInDOM(this.div,Ae.div,Ae.contentDiv,!0)}addOrRebuild(Ae){Ae.needsToBeRebuilt()?Ae.rebuild():this.add(Ae)}addUndoableEditor(Ae){const Me=()=>{this.addOrRebuild(Ae)},Ee=()=>{Ae.remove()};this.addCommands({cmd:Me,undo:Ee,mustExec:!1})}getNextId(){return we(this,ce).getId()}deserialize(Ae){switch(Ae.annotationType??Ae.annotationEditorType){case $.AnnotationEditorType.FREETEXT:return V.FreeTextEditor.deserialize(Ae,this,we(this,ce));case $.AnnotationEditorType.INK:return X.InkEditor.deserialize(Ae,this,we(this,ce));case $.AnnotationEditorType.STAMP:return Y.StampEditor.deserialize(Ae,this,we(this,ce))}return null}setSelected(Ae){we(this,ce).setSelected(Ae)}toggleSelected(Ae){we(this,ce).toggleSelected(Ae)}isSelected(Ae){return we(this,ce).isSelected(Ae)}unselect(Ae){we(this,ce).unselect(Ae)}pointerup(Ae){const{isMac:Me}=$.FeatureTest.platform;if(!(Ae.button!==0||Ae.ctrlKey&&Me)&&Ae.target===this.div&&we(this,ie)){if(dt(this,ie,!1),!we(this,te)){dt(this,te,!0);return}st(this,de,Fn).call(this,Ae)}}pointerdown(Ae){if(we(this,ie)){dt(this,ie,!1);return}const{isMac:Me}=$.FeatureTest.platform;if(Ae.button!==0||Ae.ctrlKey&&Me||Ae.target!==this.div)return;dt(this,ie,!0);const Ee=we(this,ce).getActive();dt(this,te,!Ee||Ee.isEmpty())}drop(Ae){const Me=Ae.dataTransfer.getData("text/plain"),Ee=we(this,ce).getEditor(Me);if(!Ee)return;Ae.preventDefault(),Ae.dataTransfer.dropEffect="move",st(this,ae,Sn).call(this,Ee);const Te=this.div.getBoundingClientRect(),Be=Ae.clientX-Te.x,Xe=Ae.clientY-Te.y;Ee.translate(Be-Ee.startX,Xe-Ee.startY),this.moveEditorInDOM(Ee),Ee.div.focus()}dragover(Ae){Ae.preventDefault()}destroy(){var Ae,Me;((Ae=we(this,ce).getActive())==null?void 0:Ae.parent)===this&&we(this,ce).setActiveEditor(null);for(const Ee of we(this,se).values())(Me=we(this,ee))==null||Me.removePointerInTextLayer(Ee.contentDiv),Ee.setParent(null),Ee.isAttachedToDOM=!1,Ee.div.remove();this.div=null,we(this,se).clear(),we(this,ce).removeLayer(this)}render({viewport:Ae}){this.viewport=Ae,(0,G.setLayerDimensions)(this.div,Ae),(0,z.bindEvents)(this,this.div,["dragover","drop"]);for(const Me of we(this,ce).getEditors(this.pageIndex))this.add(Me);this.updateMode()}update({viewport:Ae}){we(this,ce).commitOrRemove(),this.viewport=Ae,(0,G.setLayerDimensions)(this.div,{rotation:Ae.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:Ae,pageHeight:Me}=this.viewport.rawDims;return[Ae,Me]}};let Q=De;ee=new WeakMap,te=new WeakMap,Z=new WeakMap,ne=new WeakMap,re=new WeakMap,se=new WeakMap,ie=new WeakMap,oe=new WeakMap,ue=new WeakMap,ce=new WeakMap,ae=new WeakSet,Sn=function(Ae){var Me;Ae.parent!==this&&(Ae.annotationElementId&&(we(this,ce).addDeletedAnnotationElement(Ae.annotationElementId),j.AnnotationEditor.deleteAnnotationElement(Ae),Ae.annotationElementId=null),this.attach(Ae),(Me=Ae.parent)==null||Me.detach(Ae),Ae.setParent(this),Ae.div&&Ae.isAttachedToDOM&&(Ae.div.remove(),this.div.append(Ae.div)))},he=new WeakSet,ir=function(Ae){switch(we(this,ce).getMode()){case $.AnnotationEditorType.FREETEXT:return new V.FreeTextEditor(Ae);case $.AnnotationEditorType.INK:return new X.InkEditor(Ae);case $.AnnotationEditorType.STAMP:return new Y.StampEditor(Ae)}return null},de=new WeakSet,Fn=function(Ae){const Me=this.getNextId(),Ee=st(this,he,ir).call(this,{parent:this,id:Me,x:Ae.offsetX,y:Ae.offsetY,uiManager:we(this,ce)});return Ee&&this.add(Ee),Ee},ye=new WeakSet,Tn=function(){dt(this,oe,!0);for(const Ae of we(this,se).values())Ae.isEmpty()&&Ae.remove();dt(this,oe,!1)},$t(Q,"_initialized",!1),_.AnnotationEditorLayer=Q},(q,_,M)=>{var G,Y,Q,ee,te,Z,ne,re,se,ie,sr,ue,ar,ae,or,he,rn,de,Pn,ye,lr,De,Rn;Object.defineProperty(_,"__esModule",{value:!0}),_.FreeTextEditor=void 0;var $=M(1),j=M(5),z=M(4),V=M(29);const Ae=class extends z.AnnotationEditor{constructor(Te){super({...Te,name:"freeTextEditor"});Ze(this,ie);Ze(this,ue);Ze(this,ae);Ze(this,he);Ze(this,de);Ze(this,ye);Ze(this,De);Ze(this,G,this.editorDivBlur.bind(this));Ze(this,Y,this.editorDivFocus.bind(this));Ze(this,Q,this.editorDivInput.bind(this));Ze(this,ee,this.editorDivKeydown.bind(this));Ze(this,te,void 0);Ze(this,Z,"");Ze(this,ne,`${this.id}-editor`);Ze(this,re,void 0);Ze(this,se,null);dt(this,te,Te.color||Ae._defaultColor||z.AnnotationEditor._defaultLineColor),dt(this,re,Te.fontSize||Ae._defaultFontSize)}static get _keyboardManager(){const Te=Ae.prototype,Be=Oe=>Oe.isEmpty(),Xe=j.AnnotationEditorUIManager.TRANSLATE_SMALL,ze=j.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,$.shadow)(this,"_keyboardManager",new j.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],Te.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],Te.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],Te._translateEmpty,{args:[-Xe,0],checker:Be}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],Te._translateEmpty,{args:[-ze,0],checker:Be}],[["ArrowRight","mac+ArrowRight"],Te._translateEmpty,{args:[Xe,0],checker:Be}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],Te._translateEmpty,{args:[ze,0],checker:Be}],[["ArrowUp","mac+ArrowUp"],Te._translateEmpty,{args:[0,-Xe],checker:Be}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],Te._translateEmpty,{args:[0,-ze],checker:Be}],[["ArrowDown","mac+ArrowDown"],Te._translateEmpty,{args:[0,Xe],checker:Be}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],Te._translateEmpty,{args:[0,ze],checker:Be}]]))}static initialize(Te){this._l10nPromise=new Map(["free_text2_default_content","editor_free_text2_aria_label"].map(Xe=>[Xe,Te.get(Xe)]));const Be=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(Be.getPropertyValue("--freetext-padding"))}static updateDefaultParams(Te,Be){switch(Te){case $.AnnotationEditorParamsType.FREETEXT_SIZE:Ae._defaultFontSize=Be;break;case $.AnnotationEditorParamsType.FREETEXT_COLOR:Ae._defaultColor=Be;break}}updateParams(Te,Be){switch(Te){case $.AnnotationEditorParamsType.FREETEXT_SIZE:st(this,ie,sr).call(this,Be);break;case $.AnnotationEditorParamsType.FREETEXT_COLOR:st(this,ue,ar).call(this,Be);break}}static get defaultPropertiesToUpdate(){return[[$.AnnotationEditorParamsType.FREETEXT_SIZE,Ae._defaultFontSize],[$.AnnotationEditorParamsType.FREETEXT_COLOR,Ae._defaultColor||z.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[$.AnnotationEditorParamsType.FREETEXT_SIZE,we(this,re)],[$.AnnotationEditorParamsType.FREETEXT_COLOR,we(this,te)]]}_translateEmpty(Te,Be){this._uiManager.translateSelectedEditors(Te,Be,!0)}getInitialTranslation(){const Te=this.parentScale;return[-Ae._internalPadding*Te,-(Ae._internalPadding+we(this,re))*Te]}rebuild(){super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar($.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",we(this,ee)),this.editorDiv.addEventListener("focus",we(this,Y)),this.editorDiv.addEventListener("blur",we(this,G)),this.editorDiv.addEventListener("input",we(this,Q)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",we(this,ne)),this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",we(this,ee)),this.editorDiv.removeEventListener("focus",we(this,Y)),this.editorDiv.removeEventListener("blur",we(this,G)),this.editorDiv.removeEventListener("input",we(this,Q)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(Te){super.focusin(Te),Te.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){if(this.width){st(this,De,Rn).call(this);return}this.enableEditMode(),this.editorDiv.focus()}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const Te=we(this,Z),Be=dt(this,Z,st(this,ae,or).call(this).trimEnd());if(Te===Be)return;const Xe=ze=>{if(dt(this,Z,ze),!ze){this.remove();return}st(this,de,Pn).call(this),this.rebuild(),st(this,he,rn).call(this)};this.addCommands({cmd:()=>{Xe(Be)},undo:()=>{Xe(Te)},mustExec:!1}),st(this,he,rn).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(Te){this.enterInEditMode()}keydown(Te){Te.target===this.div&&Te.key==="Enter"&&this.enterInEditMode()}editorDivKeydown(Te){Ae._keyboardManager.exec(this,Te)}editorDivFocus(Te){this.isEditing=!0}editorDivBlur(Te){this.isEditing=!1}editorDivInput(Te){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let Te,Be;this.width&&(Te=this.x,Be=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",we(this,ne)),this.enableEditing(),Ae._l10nPromise.get("editor_free_text2_aria_label").then(ze=>{var Oe;return(Oe=this.editorDiv)==null?void 0:Oe.setAttribute("aria-label",ze)}),Ae._l10nPromise.get("free_text2_default_content").then(ze=>{var Oe;return(Oe=this.editorDiv)==null?void 0:Oe.setAttribute("default-content",ze)}),this.editorDiv.contentEditable=!0;const{style:Xe}=this.editorDiv;if(Xe.fontSize=`calc(${we(this,re)}px * var(--scale-factor))`,Xe.color=we(this,te),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,j.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[ze,Oe]=this.parentDimensions;if(this.annotationElementId){const{position:Pe}=we(this,se);let[ve,be]=this.getInitialTranslation();[ve,be]=this.pageTranslationToScreen(ve,be);const[Ce,Ne]=this.pageDimensions,[Ie,Le]=this.pageTranslation;let je,Ve;switch(this.rotation){case 0:je=Te+(Pe[0]-Ie)/Ce,Ve=Be+this.height-(Pe[1]-Le)/Ne;break;case 90:je=Te+(Pe[0]-Ie)/Ce,Ve=Be-(Pe[1]-Le)/Ne,[ve,be]=[be,-ve];break;case 180:je=Te-this.width+(Pe[0]-Ie)/Ce,Ve=Be-(Pe[1]-Le)/Ne,[ve,be]=[-ve,-be];break;case 270:je=Te+(Pe[0]-Ie-this.height*Ne)/Ce,Ve=Be+(Pe[1]-Le-this.width*Ce)/Ne,[ve,be]=[-be,ve];break}this.setAt(je*ze,Ve*Oe,ve,be)}else this.setAt(Te*ze,Be*Oe,this.width*ze,this.height*Oe);st(this,de,Pn).call(this),this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(Te,Be,Xe){let ze=null;if(Te instanceof V.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:Pe,fontColor:ve},rect:be,rotation:Ce,id:Ne},textContent:Ie,textPosition:Le,parent:{page:{pageNumber:je}}}=Te;if(!Ie||Ie.length===0)return null;ze=Te={annotationType:$.AnnotationEditorType.FREETEXT,color:Array.from(ve),fontSize:Pe,value:Ie.join(`
`),position:Le,pageIndex:je-1,rect:be,rotation:Ce,id:Ne,deleted:!1}}const Oe=super.deserialize(Te,Be,Xe);return dt(Oe,re,Te.fontSize),dt(Oe,te,$.Util.makeHexColor(...Te.color)),dt(Oe,Z,Te.value),Oe.annotationElementId=Te.id||null,dt(Oe,se,ze),Oe}serialize(Te=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const Be=Ae._internalPadding*this.parentScale,Xe=this.getRect(Be,Be),ze=z.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:we(this,te)),Oe={annotationType:$.AnnotationEditorType.FREETEXT,color:ze,fontSize:we(this,re),value:we(this,Z),pageIndex:this.pageIndex,rect:Xe,rotation:this.rotation};return Te?Oe:this.annotationElementId&&!st(this,ye,lr).call(this,Oe)?null:(Oe.id=this.annotationElementId,Oe)}};let X=Ae;G=new WeakMap,Y=new WeakMap,Q=new WeakMap,ee=new WeakMap,te=new WeakMap,Z=new WeakMap,ne=new WeakMap,re=new WeakMap,se=new WeakMap,ie=new WeakSet,sr=function(Te){const Be=ze=>{this.editorDiv.style.fontSize=`calc(${ze}px * var(--scale-factor))`,this.translate(0,-(ze-we(this,re))*this.parentScale),dt(this,re,ze),st(this,he,rn).call(this)},Xe=we(this,re);this.addCommands({cmd:()=>{Be(Te)},undo:()=>{Be(Xe)},mustExec:!0,type:$.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},ue=new WeakSet,ar=function(Te){const Be=we(this,te);this.addCommands({cmd:()=>{dt(this,te,this.editorDiv.style.color=Te)},undo:()=>{dt(this,te,this.editorDiv.style.color=Be)},mustExec:!0,type:$.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},ae=new WeakSet,or=function(){const Te=this.editorDiv.getElementsByTagName("div");if(Te.length===0)return this.editorDiv.innerText;const Be=[];for(const Xe of Te)Be.push(Xe.innerText.replace(/\r\n?|\n/,""));return Be.join(`
`)},he=new WeakSet,rn=function(){const[Te,Be]=this.parentDimensions;let Xe;if(this.isAttachedToDOM)Xe=this.div.getBoundingClientRect();else{const{currentLayer:ze,div:Oe}=this,Pe=Oe.style.display;Oe.style.display="hidden",ze.div.append(this.div),Xe=Oe.getBoundingClientRect(),Oe.remove(),Oe.style.display=Pe}this.rotation%180===this.parentRotation%180?(this.width=Xe.width/Te,this.height=Xe.height/Be):(this.width=Xe.height/Te,this.height=Xe.width/Be),this.fixAndSetPosition()},de=new WeakSet,Pn=function(){if(this.editorDiv.replaceChildren(),!!we(this,Z))for(const Te of we(this,Z).split(`
`)){const Be=document.createElement("div");Be.append(Te?document.createTextNode(Te):document.createElement("br")),this.editorDiv.append(Be)}},ye=new WeakSet,lr=function(Te){const{value:Be,fontSize:Xe,color:ze,rect:Oe,pageIndex:Pe}=we(this,se);return Te.value!==Be||Te.fontSize!==Xe||Te.rect.some((ve,be)=>Math.abs(ve-Oe[be])>=1)||Te.color.some((ve,be)=>ve!==ze[be])||Te.pageIndex!==Pe},De=new WeakSet,Rn=function(Te=!1){if(!this.annotationElementId)return;if(st(this,he,rn).call(this),!Te&&(this.width===0||this.height===0)){setTimeout(()=>st(this,De,Rn).call(this,!0),0);return}const Be=Ae._internalPadding*this.parentScale;we(this,se).rect=this.getRect(Be,Be)},$t(X,"_freeTextDefaultContent",""),$t(X,"_l10nPromise"),$t(X,"_internalPadding",0),$t(X,"_defaultColor",null),$t(X,"_defaultFontSize",10),$t(X,"_type","freetext"),_.FreeTextEditor=X},(q,_,M)=>{var be,Ce,Gt,Ie,ur,je,Ve,ot,lt,me,We,Ye,Fe,xe,$e,Je,ut,qe,Ge,Ke,et,ct,xn,_t,In,Et,Bn,Tt,At,nt,it,rt,gt,Pt,St,Bt,Lt,cr,tt,Mn;Object.defineProperty(_,"__esModule",{value:!0}),_.StampAnnotationElement=_.InkAnnotationElement=_.FreeTextAnnotationElement=_.AnnotationLayer=void 0;var $=M(1),j=M(6),z=M(3),V=M(30),X=M(31),G=M(32);const Y=1e3,Q=9,ee=new WeakSet;function te(ht){return{width:ht[2]-ht[0],height:ht[3]-ht[1]}}class Z{static create(Re){switch(Re.data.annotationType){case $.AnnotationType.LINK:return new re(Re);case $.AnnotationType.TEXT:return new se(Re);case $.AnnotationType.WIDGET:switch(Re.data.fieldType){case"Tx":return new oe(Re);case"Btn":return Re.data.radioButton?new ae(Re):Re.data.checkBox?new ce(Re):new le(Re);case"Ch":return new he(Re);case"Sig":return new ue(Re)}return new ie(Re);case $.AnnotationType.POPUP:return new ge(Re);case $.AnnotationType.FREETEXT:return new pe(Re);case $.AnnotationType.LINE:return new ye(Re);case $.AnnotationType.SQUARE:return new _e(Re);case $.AnnotationType.CIRCLE:return new De(Re);case $.AnnotationType.POLYLINE:return new fe(Re);case $.AnnotationType.CARET:return new Me(Re);case $.AnnotationType.INK:return new Ee(Re);case $.AnnotationType.POLYGON:return new Ae(Re);case $.AnnotationType.HIGHLIGHT:return new Te(Re);case $.AnnotationType.UNDERLINE:return new Be(Re);case $.AnnotationType.SQUIGGLY:return new Xe(Re);case $.AnnotationType.STRIKEOUT:return new ze(Re);case $.AnnotationType.STAMP:return new Oe(Re);case $.AnnotationType.FILEATTACHMENT:return new Pe(Re);default:return new ne(Re)}}}class ne{constructor(Re,{isRenderable:ke=!1,ignoreBorder:He=!1,createQuadrilaterals:Ue=!1}={}){Ze(this,be,!1);this.isRenderable=ke,this.data=Re.data,this.layer=Re.layer,this.linkService=Re.linkService,this.downloadManager=Re.downloadManager,this.imageResourcesPath=Re.imageResourcesPath,this.renderForms=Re.renderForms,this.svgFactory=Re.svgFactory,this.annotationStorage=Re.annotationStorage,this.enableScripting=Re.enableScripting,this.hasJSActions=Re.hasJSActions,this._fieldObjects=Re.fieldObjects,this.parent=Re.parent,ke&&(this.container=this._createContainer(He)),Ue&&this._createQuadrilaterals()}_createContainer(Re){const{data:ke,parent:{page:He,viewport:Ue}}=this,Qe=document.createElement("section");Qe.setAttribute("data-annotation-id",ke.id),Qe.style.zIndex=this.parent.zIndex++,this.data.popupRef&&Qe.setAttribute("aria-haspopup","dialog"),ke.noRotate&&Qe.classList.add("norotate");const{pageWidth:at,pageHeight:pt,pageX:wt,pageY:Dt}=Ue.rawDims;if(!ke.rect||this instanceof ge){const{rotation:kt}=ke;return!ke.hasOwnCanvas&&kt!==0&&this.setRotation(kt,Qe),Qe}const{width:bt,height:Ft}=te(ke.rect),yt=$.Util.normalizeRect([ke.rect[0],He.view[3]-ke.rect[1]+He.view[1],ke.rect[2],He.view[3]-ke.rect[3]+He.view[1]]);if(!Re&&ke.borderStyle.width>0){Qe.style.borderWidth=`${ke.borderStyle.width}px`;const kt=ke.borderStyle.horizontalCornerRadius,Rt=ke.borderStyle.verticalCornerRadius;if(kt>0||Rt>0){const Mt=`calc(${kt}px * var(--scale-factor)) / calc(${Rt}px * var(--scale-factor))`;Qe.style.borderRadius=Mt}else if(this instanceof ae){const Mt=`calc(${bt}px * var(--scale-factor)) / calc(${Ft}px * var(--scale-factor))`;Qe.style.borderRadius=Mt}switch(ke.borderStyle.style){case $.AnnotationBorderStyleType.SOLID:Qe.style.borderStyle="solid";break;case $.AnnotationBorderStyleType.DASHED:Qe.style.borderStyle="dashed";break;case $.AnnotationBorderStyleType.BEVELED:(0,$.warn)("Unimplemented border style: beveled");break;case $.AnnotationBorderStyleType.INSET:(0,$.warn)("Unimplemented border style: inset");break;case $.AnnotationBorderStyleType.UNDERLINE:Qe.style.borderBottomStyle="solid";break}const It=ke.borderColor||null;It?(dt(this,be,!0),Qe.style.borderColor=$.Util.makeHexColor(It[0]|0,It[1]|0,It[2]|0)):Qe.style.borderWidth=0}Qe.style.left=`${100*(yt[0]-wt)/at}%`,Qe.style.top=`${100*(yt[1]-Dt)/pt}%`;const{rotation:vt}=ke;return ke.hasOwnCanvas||vt===0?(Qe.style.width=`${100*bt/at}%`,Qe.style.height=`${100*Ft/pt}%`):this.setRotation(vt,Qe),Qe}setRotation(Re,ke=this.container){if(!this.data.rect)return;const{pageWidth:He,pageHeight:Ue}=this.parent.viewport.rawDims,{width:Qe,height:at}=te(this.data.rect);let pt,wt;Re%180===0?(pt=100*Qe/He,wt=100*at/Ue):(pt=100*at/He,wt=100*Qe/Ue),ke.style.width=`${pt}%`,ke.style.height=`${wt}%`,ke.setAttribute("data-main-rotation",(360-Re)%360)}get _commonActions(){const Re=(ke,He,Ue)=>{const Qe=Ue.detail[ke];Ue.target.style[He]=V.ColorConverters[`${Qe[0]}_HTML`](Qe.slice(1))};return(0,$.shadow)(this,"_commonActions",{display:ke=>{const He=ke.detail.display%2===1;this.container.style.visibility=He?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:He,print:ke.detail.display===0||ke.detail.display===3})},print:ke=>{this.annotationStorage.setValue(this.data.id,{print:ke.detail.print})},hidden:ke=>{this.container.style.visibility=ke.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:ke.detail.hidden})},focus:ke=>{setTimeout(()=>ke.target.focus({preventScroll:!1}),0)},userName:ke=>{ke.target.title=ke.detail.userName},readonly:ke=>{ke.detail.readonly?ke.target.setAttribute("readonly",""):ke.target.removeAttribute("readonly")},required:ke=>{this._setRequired(ke.target,ke.detail.required)},bgColor:ke=>{Re("bgColor","backgroundColor",ke)},fillColor:ke=>{Re("fillColor","backgroundColor",ke)},fgColor:ke=>{Re("fgColor","color",ke)},textColor:ke=>{Re("textColor","color",ke)},borderColor:ke=>{Re("borderColor","borderColor",ke)},strokeColor:ke=>{Re("strokeColor","borderColor",ke)},rotation:ke=>{const He=ke.detail.rotation;this.setRotation(He),this.annotationStorage.setValue(this.data.id,{rotation:He})}})}_dispatchEventFromSandbox(Re,ke){const He=this._commonActions;for(const Ue of Object.keys(ke.detail)){const Qe=Re[Ue]||He[Ue];Qe==null||Qe(ke)}}_setDefaultPropertiesFromJS(Re){if(!this.enableScripting)return;const ke=this.annotationStorage.getRawValue(this.data.id);if(!ke)return;const He=this._commonActions;for(const[Ue,Qe]of Object.entries(ke)){const at=He[Ue];if(at){const pt={detail:{[Ue]:Qe},target:Re};at(pt),delete ke[Ue]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:Re}=this.data;if(!Re)return;const[ke,He,Ue,Qe]=this.data.rect;if(Re.length===1){const[,{x:Rt,y:It},{x:Mt,y:Nt}]=Re[0];if(Ue===Rt&&Qe===It&&ke===Mt&&He===Nt)return}const{style:at}=this.container;let pt;if(we(this,be)){const{borderColor:Rt,borderWidth:It}=at;at.borderWidth=0,pt=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${Rt}" stroke-width="${It}">`],this.container.classList.add("hasBorder")}const wt=Ue-ke,Dt=Qe-He,{svgFactory:bt}=this,Ft=bt.createElement("svg");Ft.classList.add("quadrilateralsContainer"),Ft.setAttribute("width",0),Ft.setAttribute("height",0);const yt=bt.createElement("defs");Ft.append(yt);const vt=bt.createElement("clipPath"),kt=`clippath_${this.data.id}`;vt.setAttribute("id",kt),vt.setAttribute("clipPathUnits","objectBoundingBox"),yt.append(vt);for(const[,{x:Rt,y:It},{x:Mt,y:Nt}]of Re){const Ot=bt.createElement("rect"),Ut=(Mt-ke)/wt,zt=(Qe-It)/Dt,jt=(Rt-Mt)/wt,Vt=(It-Nt)/Dt;Ot.setAttribute("x",Ut),Ot.setAttribute("y",zt),Ot.setAttribute("width",jt),Ot.setAttribute("height",Vt),vt.append(Ot),pt==null||pt.push(`<rect vector-effect="non-scaling-stroke" x="${Ut}" y="${zt}" width="${jt}" height="${Vt}"/>`)}we(this,be)&&(pt.push("</g></svg>')"),at.backgroundImage=pt.join("")),this.container.append(Ft),this.container.style.clipPath=`url(#${kt})`}_createPopup(){const{container:Re,data:ke}=this;Re.setAttribute("aria-haspopup","dialog");const He=new ge({data:{color:ke.color,titleObj:ke.titleObj,modificationDate:ke.modificationDate,contentsObj:ke.contentsObj,richText:ke.richText,parentRect:ke.rect,borderStyle:0,id:`popup_${ke.id}`,rotation:ke.rotation},parent:this.parent,elements:[this]});this.parent.div.append(He.render())}render(){(0,$.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(Re,ke=null){const He=[];if(this._fieldObjects){const Ue=this._fieldObjects[Re];if(Ue)for(const{page:Qe,id:at,exportValues:pt}of Ue){if(Qe===-1||at===ke)continue;const wt=typeof pt=="string"?pt:null,Dt=document.querySelector(`[data-element-id="${at}"]`);if(Dt&&!ee.has(Dt)){(0,$.warn)(`_getElementsByName - element not allowed: ${at}`);continue}He.push({id:at,exportValue:wt,domElement:Dt})}return He}for(const Ue of document.getElementsByName(Re)){const{exportValue:Qe}=Ue,at=Ue.getAttribute("data-element-id");at!==ke&&ee.has(Ue)&&He.push({id:at,exportValue:Qe,domElement:Ue})}return He}show(){var Re;this.container&&(this.container.hidden=!1),(Re=this.popup)==null||Re.maybeShow()}hide(){var Re;this.container&&(this.container.hidden=!0),(Re=this.popup)==null||Re.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const Re=this.getElementsToTriggerPopup();if(Array.isArray(Re))for(const ke of Re)ke.classList.add("highlightArea");else Re.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:Re,data:{id:ke}}=this;this.container.addEventListener("dblclick",()=>{var He;(He=this.linkService.eventBus)==null||He.dispatch("switchannotationeditormode",{source:this,mode:Re,editId:ke})})}}be=new WeakMap;class re extends ne{constructor(ke,He=null){super(ke,{isRenderable:!0,ignoreBorder:!!(He!=null&&He.ignoreBorder),createQuadrilaterals:!0});Ze(this,Ce);Ze(this,Ie);this.isTooltipOnly=ke.data.isTooltipOnly}render(){const{data:ke,linkService:He}=this,Ue=document.createElement("a");Ue.setAttribute("data-element-id",ke.id);let Qe=!1;return ke.url?(He.addLinkAttributes(Ue,ke.url,ke.newWindow),Qe=!0):ke.action?(this._bindNamedAction(Ue,ke.action),Qe=!0):ke.attachment?(this._bindAttachment(Ue,ke.attachment),Qe=!0):ke.setOCGState?(st(this,Ie,ur).call(this,Ue,ke.setOCGState),Qe=!0):ke.dest?(this._bindLink(Ue,ke.dest),Qe=!0):(ke.actions&&(ke.actions.Action||ke.actions["Mouse Up"]||ke.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(Ue,ke),Qe=!0),ke.resetForm?(this._bindResetFormAction(Ue,ke.resetForm),Qe=!0):this.isTooltipOnly&&!Qe&&(this._bindLink(Ue,""),Qe=!0)),this.container.classList.add("linkAnnotation"),Qe&&this.container.append(Ue),this.container}_bindLink(ke,He){ke.href=this.linkService.getDestinationHash(He),ke.onclick=()=>(He&&this.linkService.goToDestination(He),!1),(He||He==="")&&st(this,Ce,Gt).call(this)}_bindNamedAction(ke,He){ke.href=this.linkService.getAnchorUrl(""),ke.onclick=()=>(this.linkService.executeNamedAction(He),!1),st(this,Ce,Gt).call(this)}_bindAttachment(ke,He){ke.href=this.linkService.getAnchorUrl(""),ke.onclick=()=>{var Ue;return(Ue=this.downloadManager)==null||Ue.openOrDownloadData(this.container,He.content,He.filename),!1},st(this,Ce,Gt).call(this)}_bindJSAction(ke,He){ke.href=this.linkService.getAnchorUrl("");const Ue=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const Qe of Object.keys(He.actions)){const at=Ue.get(Qe);at&&(ke[at]=()=>{var pt;return(pt=this.linkService.eventBus)==null||pt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:He.id,name:Qe}}),!1})}ke.onclick||(ke.onclick=()=>!1),st(this,Ce,Gt).call(this)}_bindResetFormAction(ke,He){const Ue=ke.onclick;if(Ue||(ke.href=this.linkService.getAnchorUrl("")),st(this,Ce,Gt).call(this),!this._fieldObjects){(0,$.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),Ue||(ke.onclick=()=>!1);return}ke.onclick=()=>{var Ft;Ue==null||Ue();const{fields:Qe,refs:at,include:pt}=He,wt=[];if(Qe.length!==0||at.length!==0){const yt=new Set(at);for(const vt of Qe){const kt=this._fieldObjects[vt]||[];for(const{id:Rt}of kt)yt.add(Rt)}for(const vt of Object.values(this._fieldObjects))for(const kt of vt)yt.has(kt.id)===pt&&wt.push(kt)}else for(const yt of Object.values(this._fieldObjects))wt.push(...yt);const Dt=this.annotationStorage,bt=[];for(const yt of wt){const{id:vt}=yt;switch(bt.push(vt),yt.type){case"text":{const Rt=yt.defaultValue||"";Dt.setValue(vt,{value:Rt});break}case"checkbox":case"radiobutton":{const Rt=yt.defaultValue===yt.exportValues;Dt.setValue(vt,{value:Rt});break}case"combobox":case"listbox":{const Rt=yt.defaultValue||"";Dt.setValue(vt,{value:Rt});break}default:continue}const kt=document.querySelector(`[data-element-id="${vt}"]`);if(kt){if(!ee.has(kt)){(0,$.warn)(`_bindResetFormAction - element not allowed: ${vt}`);continue}}else continue;kt.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((Ft=this.linkService.eventBus)==null||Ft.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:bt,name:"ResetForm"}})),!1}}}Ce=new WeakSet,Gt=function(){this.container.setAttribute("data-internal-link","")},Ie=new WeakSet,ur=function(ke,He){ke.href=this.linkService.getAnchorUrl(""),ke.onclick=()=>(this.linkService.executeSetOCGState(He),!1),st(this,Ce,Gt).call(this)};class se extends ne{constructor(Re){var He,Ue,Qe;const ke=!!(Re.data.popupRef||(He=Re.data.titleObj)!=null&&He.str||(Ue=Re.data.contentsObj)!=null&&Ue.str||(Qe=Re.data.richText)!=null&&Qe.str);super(Re,{isRenderable:ke})}render(){this.container.classList.add("textAnnotation");const Re=document.createElement("img");return Re.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",Re.alt="[{{type}} Annotation]",Re.dataset.l10nId="text_annotation_type",Re.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.popupRef||this._createPopup(),this.container.append(Re),this.container}}class ie extends ne{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(Re){var ke;this.data.hasOwnCanvas&&(((ke=Re.previousSibling)==null?void 0:ke.nodeName)==="CANVAS"&&(Re.previousSibling.hidden=!0),Re.hidden=!1)}_getKeyModifier(Re){const{isWin:ke,isMac:He}=$.FeatureTest.platform;return ke&&Re.ctrlKey||He&&Re.metaKey}_setEventListener(Re,ke,He,Ue){ke.includes("mouse")?Re.addEventListener(ke,Qe=>{var at;(at=this.linkService.eventBus)==null||at.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:He,value:Ue(Qe),shift:Qe.shiftKey,modifier:this._getKeyModifier(Qe)}})}):Re.addEventListener(ke,Qe=>{var at;(at=this.linkService.eventBus)==null||at.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:He,value:Ue(Qe)}})})}_setEventListeners(Re,ke,He){var Ue;for(const[Qe,at]of ke)(at==="Action"||(Ue=this.data.actions)!=null&&Ue[at])&&this._setEventListener(Re,Qe,at,He)}_setBackgroundColor(Re){const ke=this.data.backgroundColor||null;Re.style.backgroundColor=ke===null?"transparent":$.Util.makeHexColor(ke[0],ke[1],ke[2])}_setTextStyle(Re){const ke=["left","center","right"],{fontColor:He}=this.data.defaultAppearanceData,Ue=this.data.defaultAppearanceData.fontSize||Q,Qe=Re.style;let at;const pt=2,wt=Dt=>Math.round(10*Dt)/10;if(this.data.multiLine){const Dt=Math.abs(this.data.rect[3]-this.data.rect[1]-pt),bt=Math.round(Dt/($.LINE_FACTOR*Ue))||1,Ft=Dt/bt;at=Math.min(Ue,wt(Ft/$.LINE_FACTOR))}else{const Dt=Math.abs(this.data.rect[3]-this.data.rect[1]-pt);at=Math.min(Ue,wt(Dt/$.LINE_FACTOR))}Qe.fontSize=`calc(${at}px * var(--scale-factor))`,Qe.color=$.Util.makeHexColor(He[0],He[1],He[2]),this.data.textAlignment!==null&&(Qe.textAlign=ke[this.data.textAlignment])}_setRequired(Re,ke){ke?Re.setAttribute("required",!0):Re.removeAttribute("required"),Re.setAttribute("aria-required",ke)}}class oe extends ie{constructor(Re){const ke=Re.renderForms||!Re.data.hasAppearance&&!!Re.data.fieldValue;super(Re,{isRenderable:ke})}setPropertyOnSiblings(Re,ke,He,Ue){const Qe=this.annotationStorage;for(const at of this._getElementsByName(Re.name,Re.id))at.domElement&&(at.domElement[ke]=He),Qe.setValue(at.id,{[Ue]:He})}render(){var Ue,Qe;const Re=this.annotationStorage,ke=this.data.id;this.container.classList.add("textWidgetAnnotation");let He=null;if(this.renderForms){const at=Re.getValue(ke,{value:this.data.fieldValue});let pt=at.value||"";const wt=Re.getValue(ke,{charLimit:this.data.maxLen}).charLimit;wt&&pt.length>wt&&(pt=pt.slice(0,wt));let Dt=at.formattedValue||((Ue=this.data.textContent)==null?void 0:Ue.join(`
`))||null;Dt&&this.data.comb&&(Dt=Dt.replaceAll(/\s+/g,""));const bt={userValue:pt,formattedValue:Dt,lastCommittedValue:null,commitKey:1};this.data.multiLine?(He=document.createElement("textarea"),He.textContent=Dt??pt,this.data.doNotScroll&&(He.style.overflowY="hidden")):(He=document.createElement("input"),He.type="text",He.setAttribute("value",Dt??pt),this.data.doNotScroll&&(He.style.overflowX="hidden")),this.data.hasOwnCanvas&&(He.hidden=!0),ee.add(He),He.setAttribute("data-element-id",ke),He.disabled=this.data.readOnly,He.name=this.data.baseFieldName||this.data.fieldName,He.tabIndex=Y,this._setRequired(He,this.data.required),wt&&(He.maxLength=wt),He.addEventListener("input",yt=>{Re.setValue(ke,{value:yt.target.value}),this.setPropertyOnSiblings(He,"value",yt.target.value,"value"),bt.formattedValue=null}),He.addEventListener("resetform",yt=>{const vt=this.data.defaultFieldValue??"";He.value=bt.userValue=vt,bt.formattedValue=null});let Ft=yt=>{const{formattedValue:vt}=bt;vt!=null&&(yt.target.value=vt),yt.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){He.addEventListener("focus",vt=>{const{target:kt}=vt;bt.userValue&&(kt.value=bt.userValue),bt.lastCommittedValue=kt.value,bt.commitKey=1}),He.addEventListener("updatefromsandbox",vt=>{this.showElementAndHideCanvas(vt.target);const kt={value(Rt){bt.userValue=Rt.detail.value??"",Re.setValue(ke,{value:bt.userValue.toString()}),Rt.target.value=bt.userValue},formattedValue(Rt){const{formattedValue:It}=Rt.detail;bt.formattedValue=It,It!=null&&Rt.target!==document.activeElement&&(Rt.target.value=It),Re.setValue(ke,{formattedValue:It})},selRange(Rt){Rt.target.setSelectionRange(...Rt.detail.selRange)},charLimit:Rt=>{var Ot;const{charLimit:It}=Rt.detail,{target:Mt}=Rt;if(It===0){Mt.removeAttribute("maxLength");return}Mt.setAttribute("maxLength",It);let Nt=bt.userValue;!Nt||Nt.length<=It||(Nt=Nt.slice(0,It),Mt.value=bt.userValue=Nt,Re.setValue(ke,{value:Nt}),(Ot=this.linkService.eventBus)==null||Ot.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ke,name:"Keystroke",value:Nt,willCommit:!0,commitKey:1,selStart:Mt.selectionStart,selEnd:Mt.selectionEnd}}))}};this._dispatchEventFromSandbox(kt,vt)}),He.addEventListener("keydown",vt=>{var It;bt.commitKey=1;let kt=-1;if(vt.key==="Escape"?kt=0:vt.key==="Enter"&&!this.data.multiLine?kt=2:vt.key==="Tab"&&(bt.commitKey=3),kt===-1)return;const{value:Rt}=vt.target;bt.lastCommittedValue!==Rt&&(bt.lastCommittedValue=Rt,bt.userValue=Rt,(It=this.linkService.eventBus)==null||It.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ke,name:"Keystroke",value:Rt,willCommit:!0,commitKey:kt,selStart:vt.target.selectionStart,selEnd:vt.target.selectionEnd}}))});const yt=Ft;Ft=null,He.addEventListener("blur",vt=>{var Rt;if(!vt.relatedTarget)return;const{value:kt}=vt.target;bt.userValue=kt,bt.lastCommittedValue!==kt&&((Rt=this.linkService.eventBus)==null||Rt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ke,name:"Keystroke",value:kt,willCommit:!0,commitKey:bt.commitKey,selStart:vt.target.selectionStart,selEnd:vt.target.selectionEnd}})),yt(vt)}),(Qe=this.data.actions)!=null&&Qe.Keystroke&&He.addEventListener("beforeinput",vt=>{var zt;bt.lastCommittedValue=null;const{data:kt,target:Rt}=vt,{value:It,selectionStart:Mt,selectionEnd:Nt}=Rt;let Ot=Mt,Ut=Nt;switch(vt.inputType){case"deleteWordBackward":{const jt=It.substring(0,Mt).match(/\w*[^\w]*$/);jt&&(Ot-=jt[0].length);break}case"deleteWordForward":{const jt=It.substring(Mt).match(/^[^\w]*\w*/);jt&&(Ut+=jt[0].length);break}case"deleteContentBackward":Mt===Nt&&(Ot-=1);break;case"deleteContentForward":Mt===Nt&&(Ut+=1);break}vt.preventDefault(),(zt=this.linkService.eventBus)==null||zt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ke,name:"Keystroke",value:It,change:kt||"",willCommit:!1,selStart:Ot,selEnd:Ut}})}),this._setEventListeners(He,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],vt=>vt.target.value)}if(Ft&&He.addEventListener("blur",Ft),this.data.comb){const vt=(this.data.rect[2]-this.data.rect[0])/wt;He.classList.add("comb"),He.style.letterSpacing=`calc(${vt}px * var(--scale-factor) - 1ch)`}}else He=document.createElement("div"),He.textContent=this.data.fieldValue,He.style.verticalAlign="middle",He.style.display="table-cell";return this._setTextStyle(He),this._setBackgroundColor(He),this._setDefaultPropertiesFromJS(He),this.container.append(He),this.container}}class ue extends ie{constructor(Re){super(Re,{isRenderable:!!Re.data.hasOwnCanvas})}}class ce extends ie{constructor(Re){super(Re,{isRenderable:Re.renderForms})}render(){const Re=this.annotationStorage,ke=this.data,He=ke.id;let Ue=Re.getValue(He,{value:ke.exportValue===ke.fieldValue}).value;typeof Ue=="string"&&(Ue=Ue!=="Off",Re.setValue(He,{value:Ue})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const Qe=document.createElement("input");return ee.add(Qe),Qe.setAttribute("data-element-id",He),Qe.disabled=ke.readOnly,this._setRequired(Qe,this.data.required),Qe.type="checkbox",Qe.name=ke.baseFieldName||ke.fieldName,Ue&&Qe.setAttribute("checked",!0),Qe.setAttribute("exportValue",ke.exportValue),Qe.tabIndex=Y,Qe.addEventListener("change",at=>{const{name:pt,checked:wt}=at.target;for(const Dt of this._getElementsByName(pt,He)){const bt=wt&&Dt.exportValue===ke.exportValue;Dt.domElement&&(Dt.domElement.checked=bt),Re.setValue(Dt.id,{value:bt})}Re.setValue(He,{value:wt})}),Qe.addEventListener("resetform",at=>{const pt=ke.defaultFieldValue||"Off";at.target.checked=pt===ke.exportValue}),this.enableScripting&&this.hasJSActions&&(Qe.addEventListener("updatefromsandbox",at=>{const pt={value(wt){wt.target.checked=wt.detail.value!=="Off",Re.setValue(He,{value:wt.target.checked})}};this._dispatchEventFromSandbox(pt,at)}),this._setEventListeners(Qe,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],at=>at.target.checked)),this._setBackgroundColor(Qe),this._setDefaultPropertiesFromJS(Qe),this.container.append(Qe),this.container}}class ae extends ie{constructor(Re){super(Re,{isRenderable:Re.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const Re=this.annotationStorage,ke=this.data,He=ke.id;let Ue=Re.getValue(He,{value:ke.fieldValue===ke.buttonValue}).value;typeof Ue=="string"&&(Ue=Ue!==ke.buttonValue,Re.setValue(He,{value:Ue}));const Qe=document.createElement("input");if(ee.add(Qe),Qe.setAttribute("data-element-id",He),Qe.disabled=ke.readOnly,this._setRequired(Qe,this.data.required),Qe.type="radio",Qe.name=ke.baseFieldName||ke.fieldName,Ue&&Qe.setAttribute("checked",!0),Qe.tabIndex=Y,Qe.addEventListener("change",at=>{const{name:pt,checked:wt}=at.target;for(const Dt of this._getElementsByName(pt,He))Re.setValue(Dt.id,{value:!1});Re.setValue(He,{value:wt})}),Qe.addEventListener("resetform",at=>{const pt=ke.defaultFieldValue;at.target.checked=pt!=null&&pt===ke.buttonValue}),this.enableScripting&&this.hasJSActions){const at=ke.buttonValue;Qe.addEventListener("updatefromsandbox",pt=>{const wt={value:Dt=>{const bt=at===Dt.detail.value;for(const Ft of this._getElementsByName(Dt.target.name)){const yt=bt&&Ft.id===He;Ft.domElement&&(Ft.domElement.checked=yt),Re.setValue(Ft.id,{value:yt})}}};this._dispatchEventFromSandbox(wt,pt)}),this._setEventListeners(Qe,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],pt=>pt.target.checked)}return this._setBackgroundColor(Qe),this._setDefaultPropertiesFromJS(Qe),this.container.append(Qe),this.container}}class le extends re{constructor(Re){super(Re,{ignoreBorder:Re.data.hasAppearance})}render(){const Re=super.render();Re.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(Re.title=this.data.alternativeText);const ke=Re.lastChild;return this.enableScripting&&this.hasJSActions&&ke&&(this._setDefaultPropertiesFromJS(ke),ke.addEventListener("updatefromsandbox",He=>{this._dispatchEventFromSandbox({},He)})),Re}}class he extends ie{constructor(Re){super(Re,{isRenderable:Re.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const Re=this.annotationStorage,ke=this.data.id,He=Re.getValue(ke,{value:this.data.fieldValue}),Ue=document.createElement("select");ee.add(Ue),Ue.setAttribute("data-element-id",ke),Ue.disabled=this.data.readOnly,this._setRequired(Ue,this.data.required),Ue.name=this.data.baseFieldName||this.data.fieldName,Ue.tabIndex=Y;let Qe=this.data.combo&&this.data.options.length>0;this.data.combo||(Ue.size=this.data.options.length,this.data.multiSelect&&(Ue.multiple=!0)),Ue.addEventListener("resetform",bt=>{const Ft=this.data.defaultFieldValue;for(const yt of Ue.options)yt.selected=yt.value===Ft});for(const bt of this.data.options){const Ft=document.createElement("option");Ft.textContent=bt.displayValue,Ft.value=bt.exportValue,He.value.includes(bt.exportValue)&&(Ft.setAttribute("selected",!0),Qe=!1),Ue.append(Ft)}let at=null;if(Qe){const bt=document.createElement("option");bt.value=" ",bt.setAttribute("hidden",!0),bt.setAttribute("selected",!0),Ue.prepend(bt),at=()=>{bt.remove(),Ue.removeEventListener("input",at),at=null},Ue.addEventListener("input",at)}const pt=bt=>{const Ft=bt?"value":"textContent",{options:yt,multiple:vt}=Ue;return vt?Array.prototype.filter.call(yt,kt=>kt.selected).map(kt=>kt[Ft]):yt.selectedIndex===-1?null:yt[yt.selectedIndex][Ft]};let wt=pt(!1);const Dt=bt=>{const Ft=bt.target.options;return Array.prototype.map.call(Ft,yt=>({displayValue:yt.textContent,exportValue:yt.value}))};return this.enableScripting&&this.hasJSActions?(Ue.addEventListener("updatefromsandbox",bt=>{const Ft={value(yt){at==null||at();const vt=yt.detail.value,kt=new Set(Array.isArray(vt)?vt:[vt]);for(const Rt of Ue.options)Rt.selected=kt.has(Rt.value);Re.setValue(ke,{value:pt(!0)}),wt=pt(!1)},multipleSelection(yt){Ue.multiple=!0},remove(yt){const vt=Ue.options,kt=yt.detail.remove;vt[kt].selected=!1,Ue.remove(kt),vt.length>0&&Array.prototype.findIndex.call(vt,It=>It.selected)===-1&&(vt[0].selected=!0),Re.setValue(ke,{value:pt(!0),items:Dt(yt)}),wt=pt(!1)},clear(yt){for(;Ue.length!==0;)Ue.remove(0);Re.setValue(ke,{value:null,items:[]}),wt=pt(!1)},insert(yt){const{index:vt,displayValue:kt,exportValue:Rt}=yt.detail.insert,It=Ue.children[vt],Mt=document.createElement("option");Mt.textContent=kt,Mt.value=Rt,It?It.before(Mt):Ue.append(Mt),Re.setValue(ke,{value:pt(!0),items:Dt(yt)}),wt=pt(!1)},items(yt){const{items:vt}=yt.detail;for(;Ue.length!==0;)Ue.remove(0);for(const kt of vt){const{displayValue:Rt,exportValue:It}=kt,Mt=document.createElement("option");Mt.textContent=Rt,Mt.value=It,Ue.append(Mt)}Ue.options.length>0&&(Ue.options[0].selected=!0),Re.setValue(ke,{value:pt(!0),items:Dt(yt)}),wt=pt(!1)},indices(yt){const vt=new Set(yt.detail.indices);for(const kt of yt.target.options)kt.selected=vt.has(kt.index);Re.setValue(ke,{value:pt(!0)}),wt=pt(!1)},editable(yt){yt.target.disabled=!yt.detail.editable}};this._dispatchEventFromSandbox(Ft,bt)}),Ue.addEventListener("input",bt=>{var yt;const Ft=pt(!0);Re.setValue(ke,{value:Ft}),bt.preventDefault(),(yt=this.linkService.eventBus)==null||yt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ke,name:"Keystroke",value:wt,changeEx:Ft,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(Ue,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],bt=>bt.target.value)):Ue.addEventListener("input",function(bt){Re.setValue(ke,{value:pt(!0)})}),this.data.combo&&this._setTextStyle(Ue),this._setBackgroundColor(Ue),this._setDefaultPropertiesFromJS(Ue),this.container.append(Ue),this.container}}class ge extends ne{constructor(Re){var Qe,at,pt;const{data:ke,elements:He}=Re,Ue=!!((Qe=ke.titleObj)!=null&&Qe.str||(at=ke.contentsObj)!=null&&at.str||(pt=ke.richText)!=null&&pt.str);super(Re,{isRenderable:Ue}),this.elements=He}render(){this.container.classList.add("popupAnnotation");const Re=new de({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),ke=[];for(const He of this.elements)He.popup=Re,ke.push(He.data.id),He.addHighlightArea();return this.container.setAttribute("aria-controls",ke.join(",")),this.container}}class de{constructor({container:Re,color:ke,elements:He,titleObj:Ue,modificationDate:Qe,contentsObj:at,richText:pt,parent:wt,rect:Dt,parentRect:bt,open:Ft}){Ze(this,ct);Ze(this,_t);Ze(this,Et);Ze(this,je,null);Ze(this,Ve,st(this,Et,Bn).bind(this));Ze(this,ot,st(this,_t,In).bind(this));Ze(this,lt,st(this,ct,xn).bind(this));Ze(this,me,null);Ze(this,We,null);Ze(this,Ye,null);Ze(this,Fe,null);Ze(this,xe,null);Ze(this,$e,null);Ze(this,Je,!1);Ze(this,ut,null);Ze(this,qe,null);Ze(this,Ge,null);Ze(this,Ke,null);Ze(this,et,!1);dt(this,We,Re),dt(this,Ke,Ue),dt(this,Ye,at),dt(this,Ge,pt),dt(this,xe,wt),dt(this,me,ke),dt(this,qe,Dt),dt(this,$e,bt),dt(this,Fe,He);const yt=j.PDFDateString.toDateObject(Qe);yt&&dt(this,je,wt.l10n.get("annotation_date_string",{date:yt.toLocaleDateString(),time:yt.toLocaleTimeString()})),this.trigger=He.flatMap(vt=>vt.getElementsToTriggerPopup());for(const vt of this.trigger)vt.addEventListener("click",we(this,lt)),vt.addEventListener("mouseenter",we(this,ot)),vt.addEventListener("mouseleave",we(this,Ve));we(this,We).hidden=!0,Ft&&st(this,ct,xn).call(this)}render(){if(we(this,ut))return;const{page:{view:Re},viewport:{rawDims:{pageWidth:ke,pageHeight:He,pageX:Ue,pageY:Qe}}}=we(this,xe),at=dt(this,ut,document.createElement("div"));if(at.className="popup",we(this,me)){const Ot=at.style.outlineColor=$.Util.makeHexColor(...we(this,me));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?at.style.backgroundColor=`color-mix(in srgb, ${Ot} 30%, white)`:at.style.backgroundColor=$.Util.makeHexColor(...we(this,me).map(zt=>Math.floor(.7*(255-zt)+zt)))}const pt=document.createElement("span");pt.className="header";const wt=document.createElement("h1");if(pt.append(wt),{dir:wt.dir,str:wt.textContent}=we(this,Ke),at.append(pt),we(this,je)){const Ot=document.createElement("span");Ot.classList.add("popupDate"),we(this,je).then(Ut=>{Ot.textContent=Ut}),pt.append(Ot)}const Dt=we(this,Ye),bt=we(this,Ge);if(bt!=null&&bt.str&&(!(Dt!=null&&Dt.str)||Dt.str===bt.str))G.XfaLayer.render({xfaHtml:bt.html,intent:"richText",div:at}),at.lastChild.classList.add("richText","popupContent");else{const Ot=this._formatContents(Dt);at.append(Ot)}let Ft=!!we(this,$e),yt=Ft?we(this,$e):we(this,qe);for(const Ot of we(this,Fe))if(!yt||$.Util.intersect(Ot.data.rect,yt)!==null){yt=Ot.data.rect,Ft=!0;break}const vt=$.Util.normalizeRect([yt[0],Re[3]-yt[1]+Re[1],yt[2],Re[3]-yt[3]+Re[1]]),kt=5,Rt=Ft?yt[2]-yt[0]+kt:0,It=vt[0]+Rt,Mt=vt[1],{style:Nt}=we(this,We);Nt.left=`${100*(It-Ue)/ke}%`,Nt.top=`${100*(Mt-Qe)/He}%`,we(this,We).append(at)}_formatContents({str:Re,dir:ke}){const He=document.createElement("p");He.classList.add("popupContent"),He.dir=ke;const Ue=Re.split(/(?:\r\n?|\n)/);for(let Qe=0,at=Ue.length;Qe<at;++Qe){const pt=Ue[Qe];He.append(document.createTextNode(pt)),Qe<at-1&&He.append(document.createElement("br"))}return He}forceHide(){dt(this,et,this.isVisible),we(this,et)&&(we(this,We).hidden=!0)}maybeShow(){we(this,et)&&(dt(this,et,!1),we(this,We).hidden=!1)}get isVisible(){return we(this,We).hidden===!1}}je=new WeakMap,Ve=new WeakMap,ot=new WeakMap,lt=new WeakMap,me=new WeakMap,We=new WeakMap,Ye=new WeakMap,Fe=new WeakMap,xe=new WeakMap,$e=new WeakMap,Je=new WeakMap,ut=new WeakMap,qe=new WeakMap,Ge=new WeakMap,Ke=new WeakMap,et=new WeakMap,ct=new WeakSet,xn=function(){dt(this,Je,!we(this,Je)),we(this,Je)?(st(this,_t,In).call(this),we(this,We).addEventListener("click",we(this,lt))):(st(this,Et,Bn).call(this),we(this,We).removeEventListener("click",we(this,lt)))},_t=new WeakSet,In=function(){we(this,ut)||this.render(),this.isVisible?we(this,Je)&&we(this,We).classList.add("focused"):(we(this,We).hidden=!1,we(this,We).style.zIndex=parseInt(we(this,We).style.zIndex)+1e3)},Et=new WeakSet,Bn=function(){we(this,We).classList.remove("focused"),!(we(this,Je)||!this.isVisible)&&(we(this,We).hidden=!0,we(this,We).style.zIndex=parseInt(we(this,We).style.zIndex)-1e3)};class pe extends ne{constructor(Re){var He,Ue,Qe;const ke=!!(Re.data.popupRef||(He=Re.data.titleObj)!=null&&He.str||(Ue=Re.data.contentsObj)!=null&&Ue.str||(Qe=Re.data.richText)!=null&&Qe.str);super(Re,{isRenderable:ke,ignoreBorder:!0}),this.textContent=Re.data.textContent,this.textPosition=Re.data.textPosition,this.annotationEditorType=$.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const Re=document.createElement("div");Re.classList.add("annotationTextContent"),Re.setAttribute("role","comment");for(const ke of this.textContent){const He=document.createElement("span");He.textContent=ke,Re.append(He)}this.container.append(Re)}return this.data.popupRef||this._createPopup(),this._editOnDoubleClick(),this.container}}_.FreeTextAnnotationElement=pe;class ye extends ne{constructor(ke){var Ue,Qe,at;const He=!!(ke.data.popupRef||(Ue=ke.data.titleObj)!=null&&Ue.str||(Qe=ke.data.contentsObj)!=null&&Qe.str||(at=ke.data.richText)!=null&&at.str);super(ke,{isRenderable:He,ignoreBorder:!0});Ze(this,Tt,null)}render(){this.container.classList.add("lineAnnotation");const ke=this.data,{width:He,height:Ue}=te(ke.rect),Qe=this.svgFactory.create(He,Ue,!0),at=dt(this,Tt,this.svgFactory.createElement("svg:line"));return at.setAttribute("x1",ke.rect[2]-ke.lineCoordinates[0]),at.setAttribute("y1",ke.rect[3]-ke.lineCoordinates[1]),at.setAttribute("x2",ke.rect[2]-ke.lineCoordinates[2]),at.setAttribute("y2",ke.rect[3]-ke.lineCoordinates[3]),at.setAttribute("stroke-width",ke.borderStyle.width||1),at.setAttribute("stroke","transparent"),at.setAttribute("fill","transparent"),Qe.append(at),this.container.append(Qe),ke.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return we(this,Tt)}addHighlightArea(){this.container.classList.add("highlightArea")}}Tt=new WeakMap;class _e extends ne{constructor(ke){var Ue,Qe,at;const He=!!(ke.data.popupRef||(Ue=ke.data.titleObj)!=null&&Ue.str||(Qe=ke.data.contentsObj)!=null&&Qe.str||(at=ke.data.richText)!=null&&at.str);super(ke,{isRenderable:He,ignoreBorder:!0});Ze(this,At,null)}render(){this.container.classList.add("squareAnnotation");const ke=this.data,{width:He,height:Ue}=te(ke.rect),Qe=this.svgFactory.create(He,Ue,!0),at=ke.borderStyle.width,pt=dt(this,At,this.svgFactory.createElement("svg:rect"));return pt.setAttribute("x",at/2),pt.setAttribute("y",at/2),pt.setAttribute("width",He-at),pt.setAttribute("height",Ue-at),pt.setAttribute("stroke-width",at||1),pt.setAttribute("stroke","transparent"),pt.setAttribute("fill","transparent"),Qe.append(pt),this.container.append(Qe),ke.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return we(this,At)}addHighlightArea(){this.container.classList.add("highlightArea")}}At=new WeakMap;class De extends ne{constructor(ke){var Ue,Qe,at;const He=!!(ke.data.popupRef||(Ue=ke.data.titleObj)!=null&&Ue.str||(Qe=ke.data.contentsObj)!=null&&Qe.str||(at=ke.data.richText)!=null&&at.str);super(ke,{isRenderable:He,ignoreBorder:!0});Ze(this,nt,null)}render(){this.container.classList.add("circleAnnotation");const ke=this.data,{width:He,height:Ue}=te(ke.rect),Qe=this.svgFactory.create(He,Ue,!0),at=ke.borderStyle.width,pt=dt(this,nt,this.svgFactory.createElement("svg:ellipse"));return pt.setAttribute("cx",He/2),pt.setAttribute("cy",Ue/2),pt.setAttribute("rx",He/2-at/2),pt.setAttribute("ry",Ue/2-at/2),pt.setAttribute("stroke-width",at||1),pt.setAttribute("stroke","transparent"),pt.setAttribute("fill","transparent"),Qe.append(pt),this.container.append(Qe),ke.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return we(this,nt)}addHighlightArea(){this.container.classList.add("highlightArea")}}nt=new WeakMap;class fe extends ne{constructor(ke){var Ue,Qe,at;const He=!!(ke.data.popupRef||(Ue=ke.data.titleObj)!=null&&Ue.str||(Qe=ke.data.contentsObj)!=null&&Qe.str||(at=ke.data.richText)!=null&&at.str);super(ke,{isRenderable:He,ignoreBorder:!0});Ze(this,it,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const ke=this.data,{width:He,height:Ue}=te(ke.rect),Qe=this.svgFactory.create(He,Ue,!0);let at=[];for(const wt of ke.vertices){const Dt=wt.x-ke.rect[0],bt=ke.rect[3]-wt.y;at.push(Dt+","+bt)}at=at.join(" ");const pt=dt(this,it,this.svgFactory.createElement(this.svgElementName));return pt.setAttribute("points",at),pt.setAttribute("stroke-width",ke.borderStyle.width||1),pt.setAttribute("stroke","transparent"),pt.setAttribute("fill","transparent"),Qe.append(pt),this.container.append(Qe),ke.popupRef||this._createPopup(pt,ke),this.container}getElementsToTriggerPopup(){return we(this,it)}addHighlightArea(){this.container.classList.add("highlightArea")}}it=new WeakMap;class Ae extends fe{constructor(Re){super(Re),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Me extends ne{constructor(Re){var He,Ue,Qe;const ke=!!(Re.data.popupRef||(He=Re.data.titleObj)!=null&&He.str||(Ue=Re.data.contentsObj)!=null&&Ue.str||(Qe=Re.data.richText)!=null&&Qe.str);super(Re,{isRenderable:ke,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),this.data.popupRef||this._createPopup(),this.container}}class Ee extends ne{constructor(ke){var Ue,Qe,at;const He=!!(ke.data.popupRef||(Ue=ke.data.titleObj)!=null&&Ue.str||(Qe=ke.data.contentsObj)!=null&&Qe.str||(at=ke.data.richText)!=null&&at.str);super(ke,{isRenderable:He,ignoreBorder:!0});Ze(this,rt,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=$.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const ke=this.data,{width:He,height:Ue}=te(ke.rect),Qe=this.svgFactory.create(He,Ue,!0);for(const at of ke.inkLists){let pt=[];for(const Dt of at){const bt=Dt.x-ke.rect[0],Ft=ke.rect[3]-Dt.y;pt.push(`${bt},${Ft}`)}pt=pt.join(" ");const wt=this.svgFactory.createElement(this.svgElementName);we(this,rt).push(wt),wt.setAttribute("points",pt),wt.setAttribute("stroke-width",ke.borderStyle.width||1),wt.setAttribute("stroke","transparent"),wt.setAttribute("fill","transparent"),ke.popupRef||this._createPopup(wt,ke),Qe.append(wt)}return this.container.append(Qe),this.container}getElementsToTriggerPopup(){return we(this,rt)}addHighlightArea(){this.container.classList.add("highlightArea")}}rt=new WeakMap,_.InkAnnotationElement=Ee;class Te extends ne{constructor(Re){var He,Ue,Qe;const ke=!!(Re.data.popupRef||(He=Re.data.titleObj)!=null&&He.str||(Ue=Re.data.contentsObj)!=null&&Ue.str||(Qe=Re.data.richText)!=null&&Qe.str);super(Re,{isRenderable:ke,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class Be extends ne{constructor(Re){var He,Ue,Qe;const ke=!!(Re.data.popupRef||(He=Re.data.titleObj)!=null&&He.str||(Ue=Re.data.contentsObj)!=null&&Ue.str||(Qe=Re.data.richText)!=null&&Qe.str);super(Re,{isRenderable:ke,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Xe extends ne{constructor(Re){var He,Ue,Qe;const ke=!!(Re.data.popupRef||(He=Re.data.titleObj)!=null&&He.str||(Ue=Re.data.contentsObj)!=null&&Ue.str||(Qe=Re.data.richText)!=null&&Qe.str);super(Re,{isRenderable:ke,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class ze extends ne{constructor(Re){var He,Ue,Qe;const ke=!!(Re.data.popupRef||(He=Re.data.titleObj)!=null&&He.str||(Ue=Re.data.contentsObj)!=null&&Ue.str||(Qe=Re.data.richText)!=null&&Qe.str);super(Re,{isRenderable:ke,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class Oe extends ne{constructor(Re){var He,Ue,Qe;const ke=!!(Re.data.popupRef||(He=Re.data.titleObj)!=null&&He.str||(Ue=Re.data.contentsObj)!=null&&Ue.str||(Qe=Re.data.richText)!=null&&Qe.str);super(Re,{isRenderable:ke,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),this.data.popupRef||this._createPopup(),this.container}}_.StampAnnotationElement=Oe;class Pe extends ne{constructor(ke){var Qe;super(ke,{isRenderable:!0});Ze(this,gt,null);const{filename:He,content:Ue}=this.data.file;this.filename=(0,j.getFilenameFromUrl)(He,!0),this.content=Ue,(Qe=this.linkService.eventBus)==null||Qe.dispatch("fileattachmentannotation",{source:this,filename:He,content:Ue})}render(){var He,Ue;this.container.classList.add("fileAttachmentAnnotation");let ke;return this.data.hasAppearance?ke=document.createElement("div"):(ke=document.createElement("img"),ke.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(this.data.name)?"paperclip":"pushpin"}.svg`),ke.classList.add("popupTriggerArea"),ke.addEventListener("dblclick",this._download.bind(this)),dt(this,gt,ke),!this.data.popupRef&&((He=this.data.titleObj)!=null&&He.str||(Ue=this.data.contentsObj)!=null&&Ue.str||this.data.richText)&&this._createPopup(),this.container.append(ke),this.container}getElementsToTriggerPopup(){return we(this,gt)}addHighlightArea(){this.container.classList.add("highlightArea")}_download(){var ke;(ke=this.downloadManager)==null||ke.openOrDownloadData(this.container,this.content,this.filename)}}gt=new WeakMap;class ve{constructor({div:Re,accessibilityManager:ke,annotationCanvasMap:He,l10n:Ue,page:Qe,viewport:at}){Ze(this,Lt);Ze(this,tt);Ze(this,Pt,null);Ze(this,St,null);Ze(this,Bt,new Map);this.div=Re,dt(this,Pt,ke),dt(this,St,He),this.l10n=Ue,this.page=Qe,this.viewport=at,this.zIndex=0,this.l10n||(this.l10n=X.NullL10n)}async render(Re){const{annotations:ke}=Re,He=this.div;(0,j.setLayerDimensions)(He,this.viewport);const Ue=new Map,Qe={data:null,layer:He,linkService:Re.linkService,downloadManager:Re.downloadManager,imageResourcesPath:Re.imageResourcesPath||"",renderForms:Re.renderForms!==!1,svgFactory:new j.DOMSVGFactory,annotationStorage:Re.annotationStorage||new z.AnnotationStorage,enableScripting:Re.enableScripting===!0,hasJSActions:Re.hasJSActions,fieldObjects:Re.fieldObjects,parent:this,elements:null};for(const at of ke){if(at.noHTML)continue;const pt=at.annotationType===$.AnnotationType.POPUP;if(pt){const bt=Ue.get(at.id);if(!bt)continue;Qe.elements=bt}else{const{width:bt,height:Ft}=te(at.rect);if(bt<=0||Ft<=0)continue}Qe.data=at;const wt=Z.create(Qe);if(!wt.isRenderable)continue;if(!pt&&at.popupRef){const bt=Ue.get(at.popupRef);bt?bt.push(wt):Ue.set(at.popupRef,[wt])}wt.annotationEditorType>0&&we(this,Bt).set(wt.data.id,wt);const Dt=wt.render();at.hidden&&(Dt.style.visibility="hidden"),st(this,Lt,cr).call(this,Dt,at.id)}st(this,tt,Mn).call(this),await this.l10n.translate(He)}update({viewport:Re}){const ke=this.div;this.viewport=Re,(0,j.setLayerDimensions)(ke,{rotation:Re.rotation}),st(this,tt,Mn).call(this),ke.hidden=!1}getEditableAnnotations(){return Array.from(we(this,Bt).values())}getEditableAnnotation(Re){return we(this,Bt).get(Re)}}Pt=new WeakMap,St=new WeakMap,Bt=new WeakMap,Lt=new WeakSet,cr=function(Re,ke){var Ue;const He=Re.firstChild||Re;He.id=`${j.AnnotationPrefix}${ke}`,this.div.append(Re),(Ue=we(this,Pt))==null||Ue.moveElementInDOM(this.div,Re,He,!1)},tt=new WeakSet,Mn=function(){if(!we(this,St))return;const Re=this.div;for(const[ke,He]of we(this,St)){const Ue=Re.querySelector(`[data-annotation-id="${ke}"]`);if(!Ue)continue;const{firstChild:Qe}=Ue;Qe?Qe.nodeName==="CANVAS"?Qe.replaceWith(He):Qe.before(He):Ue.append(He)}we(this,St).clear()},_.AnnotationLayer=ve},(q,_)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.ColorConverters=void 0;function M(j){return Math.floor(Math.max(0,Math.min(1,j))*255).toString(16).padStart(2,"0")}class ${static CMYK_G([z,V,X,G]){return["G",1-Math.min(1,.3*z+.59*X+.11*V+G)]}static G_CMYK([z]){return["CMYK",0,0,0,1-z]}static G_RGB([z]){return["RGB",z,z,z]}static G_HTML([z]){const V=M(z);return`#${V}${V}${V}`}static RGB_G([z,V,X]){return["G",.3*z+.59*V+.11*X]}static RGB_HTML([z,V,X]){const G=M(z),Y=M(V),Q=M(X);return`#${G}${Y}${Q}`}static T_HTML(){return"#00000000"}static CMYK_RGB([z,V,X,G]){return["RGB",1-Math.min(1,z+G),1-Math.min(1,X+G),1-Math.min(1,V+G)]}static CMYK_HTML(z){const V=this.CMYK_RGB(z).slice(1);return this.RGB_HTML(V)}static RGB_CMYK([z,V,X]){const G=1-z,Y=1-V,Q=1-X,ee=Math.min(G,Y,Q);return["CMYK",G,Y,Q,ee]}}_.ColorConverters=$},(q,_)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.NullL10n=void 0,_.getL10nFallback=$;const M={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}}  {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}}  {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image"};M.print_progress_percent="{{progress}}%";function $(V,X){switch(V){case"find_match_count":V=`find_match_count[${X.total===1?"one":"other"}]`;break;case"find_match_count_limit":V=`find_match_count_limit[${X.limit===1?"one":"other"}]`;break}return M[V]||""}function j(V,X){return X?V.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(G,Y)=>Y in X?X[Y]:"{{"+Y+"}}"):V}const z={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(V,X=null,G=$(V,X)){return j(G,X)},async translate(V){}};_.NullL10n=z},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.XfaLayer=void 0;var $=M(25);class j{static setupStorage(V,X,G,Y,Q){const ee=Y.getValue(X,{value:null});switch(G.name){case"textarea":if(ee.value!==null&&(V.textContent=ee.value),Q==="print")break;V.addEventListener("input",te=>{Y.setValue(X,{value:te.target.value})});break;case"input":if(G.attributes.type==="radio"||G.attributes.type==="checkbox"){if(ee.value===G.attributes.xfaOn?V.setAttribute("checked",!0):ee.value===G.attributes.xfaOff&&V.removeAttribute("checked"),Q==="print")break;V.addEventListener("change",te=>{Y.setValue(X,{value:te.target.checked?te.target.getAttribute("xfaOn"):te.target.getAttribute("xfaOff")})})}else{if(ee.value!==null&&V.setAttribute("value",ee.value),Q==="print")break;V.addEventListener("input",te=>{Y.setValue(X,{value:te.target.value})})}break;case"select":if(ee.value!==null){V.setAttribute("value",ee.value);for(const te of G.children)te.attributes.value===ee.value?te.attributes.selected=!0:te.attributes.hasOwnProperty("selected")&&delete te.attributes.selected}V.addEventListener("input",te=>{const Z=te.target.options,ne=Z.selectedIndex===-1?"":Z[Z.selectedIndex].value;Y.setValue(X,{value:ne})});break}}static setAttributes({html:V,element:X,storage:G=null,intent:Y,linkService:Q}){const{attributes:ee}=X,te=V instanceof HTMLAnchorElement;ee.type==="radio"&&(ee.name=`${ee.name}-${Y}`);for(const[Z,ne]of Object.entries(ee))if(ne!=null)switch(Z){case"class":ne.length&&V.setAttribute(Z,ne.join(" "));break;case"dataId":break;case"id":V.setAttribute("data-element-id",ne);break;case"style":Object.assign(V.style,ne);break;case"textContent":V.textContent=ne;break;default:(!te||Z!=="href"&&Z!=="newWindow")&&V.setAttribute(Z,ne)}te&&Q.addLinkAttributes(V,ee.href,ee.newWindow),G&&ee.dataId&&this.setupStorage(V,ee.dataId,X,G)}static render(V){var re;const X=V.annotationStorage,G=V.linkService,Y=V.xfaHtml,Q=V.intent||"display",ee=document.createElement(Y.name);Y.attributes&&this.setAttributes({html:ee,element:Y,intent:Q,linkService:G});const te=[[Y,-1,ee]],Z=V.div;if(Z.append(ee),V.viewport){const se=`matrix(${V.viewport.transform.join(",")})`;Z.style.transform=se}Q!=="richText"&&Z.setAttribute("class","xfaLayer xfaFont");const ne=[];for(;te.length>0;){const[se,ie,oe]=te.at(-1);if(ie+1===se.children.length){te.pop();continue}const ue=se.children[++te.at(-1)[1]];if(ue===null)continue;const{name:ce}=ue;if(ce==="#text"){const le=document.createTextNode(ue.value);ne.push(le),oe.append(le);continue}const ae=(re=ue==null?void 0:ue.attributes)!=null&&re.xmlns?document.createElementNS(ue.attributes.xmlns,ce):document.createElement(ce);if(oe.append(ae),ue.attributes&&this.setAttributes({html:ae,element:ue,storage:X,intent:Q,linkService:G}),ue.children&&ue.children.length>0)te.push([ue,-1,ae]);else if(ue.value){const le=document.createTextNode(ue.value);$.XfaText.shouldBuildText(ce)&&ne.push(le),ae.append(le)}}for(const se of Z.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))se.setAttribute("readOnly",!0);return{textDivs:ne}}static update(V){const X=`matrix(${V.viewport.transform.join(",")})`;V.div.style.transform=X,V.div.hidden=!1}}_.XfaLayer=j},(q,_,M)=>{var G,Y,Q,ee,te,Z,ne,re,se,ie,oe,ue,ce,ae,le,he,dr,de,hr,ye,fr,De,pr,Ae,On,Ee,mr,Be,Ln,ze,_r,Pe,gr,be,br,Ne,yr,Le,vr,Ve,qt,lt,$n,We,cn,Fe,dn,$e,Qt,ut,Nn,Ge,hn,et,wr,mt,Un,Ct,Ar,xt,Dr,At,jn,it,fn,gt,Zt;Object.defineProperty(_,"__esModule",{value:!0}),_.InkEditor=void 0;var $=M(1),j=M(4),z=M(29),V=M(5);const St=class extends j.AnnotationEditor{constructor(Se){super({...Se,name:"inkEditor"});Ze(this,he);Ze(this,de);Ze(this,ye);Ze(this,De);Ze(this,Ae);Ze(this,Ee);Ze(this,Be);Ze(this,ze);Ze(this,Pe);Ze(this,be);Ze(this,Ne);Ze(this,Le);Ze(this,Ve);Ze(this,lt);Ze(this,We);Ze(this,Fe);Ze(this,$e);Ze(this,ut);Ze(this,Ge);Ze(this,xt);Ze(this,At);Ze(this,it);Ze(this,gt);Ze(this,G,0);Ze(this,Y,0);Ze(this,Q,this.canvasContextMenu.bind(this));Ze(this,ee,this.canvasPointermove.bind(this));Ze(this,te,this.canvasPointerleave.bind(this));Ze(this,Z,this.canvasPointerup.bind(this));Ze(this,ne,this.canvasPointerdown.bind(this));Ze(this,re,new Path2D);Ze(this,se,!1);Ze(this,ie,!1);Ze(this,oe,!1);Ze(this,ue,null);Ze(this,ce,0);Ze(this,ae,0);Ze(this,le,null);this.color=Se.color||null,this.thickness=Se.thickness||null,this.opacity=Se.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(Se){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink2_aria_label"].map(tt=>[tt,Se.get(tt)]))}static updateDefaultParams(Se,tt){switch(Se){case $.AnnotationEditorParamsType.INK_THICKNESS:St._defaultThickness=tt;break;case $.AnnotationEditorParamsType.INK_COLOR:St._defaultColor=tt;break;case $.AnnotationEditorParamsType.INK_OPACITY:St._defaultOpacity=tt/100;break}}updateParams(Se,tt){switch(Se){case $.AnnotationEditorParamsType.INK_THICKNESS:st(this,he,dr).call(this,tt);break;case $.AnnotationEditorParamsType.INK_COLOR:st(this,de,hr).call(this,tt);break;case $.AnnotationEditorParamsType.INK_OPACITY:st(this,ye,fr).call(this,tt);break}}static get defaultPropertiesToUpdate(){return[[$.AnnotationEditorParamsType.INK_THICKNESS,St._defaultThickness],[$.AnnotationEditorParamsType.INK_COLOR,St._defaultColor||j.AnnotationEditor._defaultLineColor],[$.AnnotationEditorParamsType.INK_OPACITY,Math.round(St._defaultOpacity*100)]]}get propertiesToUpdate(){return[[$.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||St._defaultThickness],[$.AnnotationEditorParamsType.INK_COLOR,this.color||St._defaultColor||j.AnnotationEditor._defaultLineColor],[$.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??St._defaultOpacity))]]}rebuild(){super.rebuild(),this.div!==null&&(this.canvas||(st(this,We,cn).call(this),st(this,Fe,dn).call(this)),this.isAttachedToDOM||(this.parent.add(this),st(this,$e,Qt).call(this)),st(this,gt,Zt).call(this))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,we(this,ue).disconnect(),dt(this,ue,null),super.remove())}setParent(Se){!this.parent&&Se?this._uiManager.removeShouldRescale(this):this.parent&&Se===null&&this._uiManager.addShouldRescale(this),super.setParent(Se)}onScaleChanging(){const[Se,tt]=this.parentDimensions,ft=this.width*Se,ht=this.height*tt;this.setDimensions(ft,ht)}enableEditMode(){we(this,se)||this.canvas===null||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",we(this,ne)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",we(this,ne)))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){we(this,se)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),dt(this,se,!0),this.div.classList.add("disabled"),st(this,gt,Zt).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus({preventScroll:!0}))}focusin(Se){super.focusin(Se),this.enableEditMode()}canvasPointerdown(Se){Se.button!==0||!this.isInEditMode()||we(this,se)||(this.setInForeground(),Se.preventDefault(),Se.type!=="mouse"&&this.div.focus(),st(this,Ee,mr).call(this,Se.offsetX,Se.offsetY))}canvasContextMenu(Se){Se.preventDefault()}canvasPointermove(Se){Se.preventDefault(),st(this,Be,Ln).call(this,Se.offsetX,Se.offsetY)}canvasPointerup(Se){Se.preventDefault(),st(this,lt,$n).call(this,Se)}canvasPointerleave(Se){st(this,lt,$n).call(this,Se)}get isResizable(){return!this.isEmpty()&&we(this,se)}render(){if(this.div)return this.div;let Se,tt;this.width&&(Se=this.x,tt=this.y),super.render(),St._l10nPromise.get("editor_ink2_aria_label").then(He=>{var Ue;return(Ue=this.div)==null?void 0:Ue.setAttribute("aria-label",He)});const[ft,ht,Re,ke]=st(this,De,pr).call(this);if(this.setAt(ft,ht,0,0),this.setDims(Re,ke),st(this,We,cn).call(this),this.width){const[He,Ue]=this.parentDimensions;this.setAspectRatio(this.width*He,this.height*Ue),this.setAt(Se*He,tt*Ue,this.width*He,this.height*Ue),dt(this,oe,!0),st(this,$e,Qt).call(this),this.setDims(this.width*He,this.height*Ue),st(this,Ve,qt).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return st(this,Fe,dn).call(this),this.div}setDimensions(Se,tt){const ft=Math.round(Se),ht=Math.round(tt);if(we(this,ce)===ft&&we(this,ae)===ht)return;dt(this,ce,ft),dt(this,ae,ht),this.canvas.style.visibility="hidden";const[Re,ke]=this.parentDimensions;this.width=Se/Re,this.height=tt/ke,this.fixAndSetPosition(),we(this,se)&&st(this,ut,Nn).call(this,Se,tt),st(this,$e,Qt).call(this),st(this,Ve,qt).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(Se,tt,ft){var Ft,yt,vt;if(Se instanceof z.InkAnnotationElement)return null;const ht=super.deserialize(Se,tt,ft);ht.thickness=Se.thickness,ht.color=$.Util.makeHexColor(...Se.color),ht.opacity=Se.opacity;const[Re,ke]=ht.pageDimensions,He=ht.width*Re,Ue=ht.height*ke,Qe=ht.parentScale,at=Se.thickness/2;dt(ht,se,!0),dt(ht,ce,Math.round(He)),dt(ht,ae,Math.round(Ue));const{paths:pt,rect:wt,rotation:Dt}=Se;for(let{bezier:kt}of pt){kt=st(Ft=St,Ct,Ar).call(Ft,kt,wt,Dt);const Rt=[];ht.paths.push(Rt);let It=Qe*(kt[0]-at),Mt=Qe*(kt[1]-at);for(let Ot=2,Ut=kt.length;Ot<Ut;Ot+=6){const zt=Qe*(kt[Ot]-at),jt=Qe*(kt[Ot+1]-at),Vt=Qe*(kt[Ot+2]-at),Sr=Qe*(kt[Ot+3]-at),Wn=Qe*(kt[Ot+4]-at),qn=Qe*(kt[Ot+5]-at);Rt.push([[It,Mt],[zt,jt],[Vt,Sr],[Wn,qn]]),It=Wn,Mt=qn}const Nt=st(this,et,wr).call(this,Rt);ht.bezierPath2D.push(Nt)}const bt=st(yt=ht,At,jn).call(yt);return dt(ht,Y,Math.max(j.AnnotationEditor.MIN_SIZE,bt[2]-bt[0])),dt(ht,G,Math.max(j.AnnotationEditor.MIN_SIZE,bt[3]-bt[1])),st(vt=ht,ut,Nn).call(vt,He,Ue),ht}serialize(){if(this.isEmpty())return null;const Se=this.getRect(0,0),tt=j.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:$.AnnotationEditorType.INK,color:tt,thickness:this.thickness,opacity:this.opacity,paths:st(this,xt,Dr).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,Se),pageIndex:this.pageIndex,rect:Se,rotation:this.rotation}}};let X=St;G=new WeakMap,Y=new WeakMap,Q=new WeakMap,ee=new WeakMap,te=new WeakMap,Z=new WeakMap,ne=new WeakMap,re=new WeakMap,se=new WeakMap,ie=new WeakMap,oe=new WeakMap,ue=new WeakMap,ce=new WeakMap,ae=new WeakMap,le=new WeakMap,he=new WeakSet,dr=function(Se){const tt=this.thickness;this.addCommands({cmd:()=>{this.thickness=Se,st(this,gt,Zt).call(this)},undo:()=>{this.thickness=tt,st(this,gt,Zt).call(this)},mustExec:!0,type:$.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},de=new WeakSet,hr=function(Se){const tt=this.color;this.addCommands({cmd:()=>{this.color=Se,st(this,Ve,qt).call(this)},undo:()=>{this.color=tt,st(this,Ve,qt).call(this)},mustExec:!0,type:$.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},ye=new WeakSet,fr=function(Se){Se/=100;const tt=this.opacity;this.addCommands({cmd:()=>{this.opacity=Se,st(this,Ve,qt).call(this)},undo:()=>{this.opacity=tt,st(this,Ve,qt).call(this)},mustExec:!0,type:$.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},De=new WeakSet,pr=function(){const{parentRotation:Se,parentDimensions:[tt,ft]}=this;switch(Se){case 90:return[0,ft,ft,tt];case 180:return[tt,ft,tt,ft];case 270:return[tt,0,ft,tt];default:return[0,0,tt,ft]}},Ae=new WeakSet,On=function(){const{ctx:Se,color:tt,opacity:ft,thickness:ht,parentScale:Re,scaleFactor:ke}=this;Se.lineWidth=ht*Re/ke,Se.lineCap="round",Se.lineJoin="round",Se.miterLimit=10,Se.strokeStyle=`${tt}${(0,V.opacityToHex)(ft)}`},Ee=new WeakSet,mr=function(Se,tt){this.canvas.addEventListener("contextmenu",we(this,Q)),this.canvas.addEventListener("pointerleave",we(this,te)),this.canvas.addEventListener("pointermove",we(this,ee)),this.canvas.addEventListener("pointerup",we(this,Z)),this.canvas.removeEventListener("pointerdown",we(this,ne)),this.isEditing=!0,we(this,oe)||(dt(this,oe,!0),st(this,$e,Qt).call(this),this.thickness||(this.thickness=St._defaultThickness),this.color||(this.color=St._defaultColor||j.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=St._defaultOpacity)),this.currentPath.push([Se,tt]),dt(this,ie,!1),st(this,Ae,On).call(this),dt(this,le,()=>{st(this,be,br).call(this),we(this,le)&&window.requestAnimationFrame(we(this,le))}),window.requestAnimationFrame(we(this,le))},Be=new WeakSet,Ln=function(Se,tt){const[ft,ht]=this.currentPath.at(-1);if(this.currentPath.length>1&&Se===ft&&tt===ht)return;const Re=this.currentPath;let ke=we(this,re);if(Re.push([Se,tt]),dt(this,ie,!0),Re.length<=2){ke.moveTo(...Re[0]),ke.lineTo(Se,tt);return}Re.length===3&&(dt(this,re,ke=new Path2D),ke.moveTo(...Re[0])),st(this,Ne,yr).call(this,ke,...Re.at(-3),...Re.at(-2),Se,tt)},ze=new WeakSet,_r=function(){if(this.currentPath.length===0)return;const Se=this.currentPath.at(-1);we(this,re).lineTo(...Se)},Pe=new WeakSet,gr=function(Se,tt){dt(this,le,null),Se=Math.min(Math.max(Se,0),this.canvas.width),tt=Math.min(Math.max(tt,0),this.canvas.height),st(this,Be,Ln).call(this,Se,tt),st(this,ze,_r).call(this);let ft;if(this.currentPath.length!==1)ft=st(this,Le,vr).call(this);else{const Ue=[Se,tt];ft=[[Ue,Ue.slice(),Ue.slice(),Ue]]}const ht=we(this,re),Re=this.currentPath;this.currentPath=[],dt(this,re,new Path2D);const ke=()=>{this.allRawPaths.push(Re),this.paths.push(ft),this.bezierPath2D.push(ht),this.rebuild()},He=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(st(this,We,cn).call(this),st(this,Fe,dn).call(this)),st(this,gt,Zt).call(this))};this.addCommands({cmd:ke,undo:He,mustExec:!0})},be=new WeakSet,br=function(){if(!we(this,ie))return;dt(this,ie,!1);const Se=Math.ceil(this.thickness*this.parentScale),tt=this.currentPath.slice(-3),ft=tt.map(ke=>ke[0]),ht=tt.map(ke=>ke[1]);Math.min(...ft)-Se,Math.max(...ft)+Se,Math.min(...ht)-Se,Math.max(...ht)+Se;const{ctx:Re}=this;Re.save(),Re.clearRect(0,0,this.canvas.width,this.canvas.height);for(const ke of this.bezierPath2D)Re.stroke(ke);Re.stroke(we(this,re)),Re.restore()},Ne=new WeakSet,yr=function(Se,tt,ft,ht,Re,ke,He){const Ue=(tt+ht)/2,Qe=(ft+Re)/2,at=(ht+ke)/2,pt=(Re+He)/2;Se.bezierCurveTo(Ue+2*(ht-Ue)/3,Qe+2*(Re-Qe)/3,at+2*(ht-at)/3,pt+2*(Re-pt)/3,at,pt)},Le=new WeakSet,vr=function(){const Se=this.currentPath;if(Se.length<=2)return[[Se[0],Se[0],Se.at(-1),Se.at(-1)]];const tt=[];let ft,[ht,Re]=Se[0];for(ft=1;ft<Se.length-2;ft++){const[wt,Dt]=Se[ft],[bt,Ft]=Se[ft+1],yt=(wt+bt)/2,vt=(Dt+Ft)/2,kt=[ht+2*(wt-ht)/3,Re+2*(Dt-Re)/3],Rt=[yt+2*(wt-yt)/3,vt+2*(Dt-vt)/3];tt.push([[ht,Re],kt,Rt,[yt,vt]]),[ht,Re]=[yt,vt]}const[ke,He]=Se[ft],[Ue,Qe]=Se[ft+1],at=[ht+2*(ke-ht)/3,Re+2*(He-Re)/3],pt=[Ue+2*(ke-Ue)/3,Qe+2*(He-Qe)/3];return tt.push([[ht,Re],at,pt,[Ue,Qe]]),tt},Ve=new WeakSet,qt=function(){if(this.isEmpty()){st(this,Ge,hn).call(this);return}st(this,Ae,On).call(this);const{canvas:Se,ctx:tt}=this;tt.setTransform(1,0,0,1,0,0),tt.clearRect(0,0,Se.width,Se.height),st(this,Ge,hn).call(this);for(const ft of this.bezierPath2D)tt.stroke(ft)},lt=new WeakSet,$n=function(Se){this.canvas.removeEventListener("pointerleave",we(this,te)),this.canvas.removeEventListener("pointermove",we(this,ee)),this.canvas.removeEventListener("pointerup",we(this,Z)),this.canvas.addEventListener("pointerdown",we(this,ne)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",we(this,Q))},10),st(this,Pe,gr).call(this,Se.offsetX,Se.offsetY),this.addToAnnotationStorage(),this.setInBackground()},We=new WeakSet,cn=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",St._l10nPromise.get("editor_ink_canvas_aria_label").then(Se=>{var tt;return(tt=this.canvas)==null?void 0:tt.setAttribute("aria-label",Se)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},Fe=new WeakSet,dn=function(){dt(this,ue,new ResizeObserver(Se=>{const tt=Se[0].contentRect;tt.width&&tt.height&&this.setDimensions(tt.width,tt.height)})),we(this,ue).observe(this.div)},$e=new WeakSet,Qt=function(){if(!we(this,oe))return;const[Se,tt]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*Se),this.canvas.height=Math.ceil(this.height*tt),st(this,Ge,hn).call(this)},ut=new WeakSet,Nn=function(Se,tt){const ft=st(this,it,fn).call(this),ht=(Se-ft)/we(this,Y),Re=(tt-ft)/we(this,G);this.scaleFactor=Math.min(ht,Re)},Ge=new WeakSet,hn=function(){const Se=st(this,it,fn).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+Se,this.translationY*this.scaleFactor+Se)},et=new WeakSet,wr=function(Se){const tt=new Path2D;for(let ft=0,ht=Se.length;ft<ht;ft++){const[Re,ke,He,Ue]=Se[ft];ft===0&&tt.moveTo(...Re),tt.bezierCurveTo(ke[0],ke[1],He[0],He[1],Ue[0],Ue[1])}return tt},mt=new WeakSet,Un=function(Se,tt,ft){const[ht,Re,ke,He]=tt;switch(ft){case 0:for(let Ue=0,Qe=Se.length;Ue<Qe;Ue+=2)Se[Ue]+=ht,Se[Ue+1]=He-Se[Ue+1];break;case 90:for(let Ue=0,Qe=Se.length;Ue<Qe;Ue+=2){const at=Se[Ue];Se[Ue]=Se[Ue+1]+ht,Se[Ue+1]=at+Re}break;case 180:for(let Ue=0,Qe=Se.length;Ue<Qe;Ue+=2)Se[Ue]=ke-Se[Ue],Se[Ue+1]+=Re;break;case 270:for(let Ue=0,Qe=Se.length;Ue<Qe;Ue+=2){const at=Se[Ue];Se[Ue]=ke-Se[Ue+1],Se[Ue+1]=He-at}break;default:throw new Error("Invalid rotation")}return Se},Ct=new WeakSet,Ar=function(Se,tt,ft){const[ht,Re,ke,He]=tt;switch(ft){case 0:for(let Ue=0,Qe=Se.length;Ue<Qe;Ue+=2)Se[Ue]-=ht,Se[Ue+1]=He-Se[Ue+1];break;case 90:for(let Ue=0,Qe=Se.length;Ue<Qe;Ue+=2){const at=Se[Ue];Se[Ue]=Se[Ue+1]-Re,Se[Ue+1]=at-ht}break;case 180:for(let Ue=0,Qe=Se.length;Ue<Qe;Ue+=2)Se[Ue]=ke-Se[Ue],Se[Ue+1]-=Re;break;case 270:for(let Ue=0,Qe=Se.length;Ue<Qe;Ue+=2){const at=Se[Ue];Se[Ue]=He-Se[Ue+1],Se[Ue+1]=ke-at}break;default:throw new Error("Invalid rotation")}return Se},xt=new WeakSet,Dr=function(Se,tt,ft,ht){var Qe,at;const Re=[],ke=this.thickness/2,He=Se*tt+ke,Ue=Se*ft+ke;for(const pt of this.paths){const wt=[],Dt=[];for(let bt=0,Ft=pt.length;bt<Ft;bt++){const[yt,vt,kt,Rt]=pt[bt],It=Se*yt[0]+He,Mt=Se*yt[1]+Ue,Nt=Se*vt[0]+He,Ot=Se*vt[1]+Ue,Ut=Se*kt[0]+He,zt=Se*kt[1]+Ue,jt=Se*Rt[0]+He,Vt=Se*Rt[1]+Ue;bt===0&&(wt.push(It,Mt),Dt.push(It,Mt)),wt.push(Nt,Ot,Ut,zt,jt,Vt),Dt.push(Nt,Ot),bt===Ft-1&&Dt.push(jt,Vt)}Re.push({bezier:st(Qe=St,mt,Un).call(Qe,wt,ht,this.rotation),points:st(at=St,mt,Un).call(at,Dt,ht,this.rotation)})}return Re},At=new WeakSet,jn=function(){let Se=1/0,tt=-1/0,ft=1/0,ht=-1/0;for(const Re of this.paths)for(const[ke,He,Ue,Qe]of Re){const at=$.Util.bezierBoundingBox(...ke,...He,...Ue,...Qe);Se=Math.min(Se,at[0]),ft=Math.min(ft,at[1]),tt=Math.max(tt,at[2]),ht=Math.max(ht,at[3])}return[Se,ft,tt,ht]},it=new WeakSet,fn=function(){return we(this,se)?Math.ceil(this.thickness*this.parentScale):0},gt=new WeakSet,Zt=function(Se=!1){if(this.isEmpty())return;if(!we(this,se)){st(this,Ve,qt).call(this);return}const tt=st(this,At,jn).call(this),ft=st(this,it,fn).call(this);dt(this,Y,Math.max(j.AnnotationEditor.MIN_SIZE,tt[2]-tt[0])),dt(this,G,Math.max(j.AnnotationEditor.MIN_SIZE,tt[3]-tt[1]));const ht=Math.ceil(ft+we(this,Y)*this.scaleFactor),Re=Math.ceil(ft+we(this,G)*this.scaleFactor),[ke,He]=this.parentDimensions;this.width=ht/ke,this.height=Re/He,this.setAspectRatio(ht,Re);const Ue=this.translationX,Qe=this.translationY;this.translationX=-tt[0],this.translationY=-tt[1],st(this,$e,Qt).call(this),st(this,Ve,qt).call(this),dt(this,ce,ht),dt(this,ae,Re),this.setDims(ht,Re);const at=Se?ft/this.scaleFactor/2:0;this.translate(Ue-this.translationX-at,Qe-this.translationY-at)},Ze(X,et),Ze(X,mt),Ze(X,Ct),$t(X,"_defaultColor",null),$t(X,"_defaultOpacity",1),$t(X,"_defaultThickness",1),$t(X,"_l10nPromise"),$t(X,"_type","ink"),_.InkEditor=X},(q,_,M)=>{var G,Y,Q,ee,te,Z,ne,re,se,zn,oe,sn,ce,Er,le,kr,ge,Hn,pe,pn,_e,Cr;Object.defineProperty(_,"__esModule",{value:!0}),_.StampEditor=void 0;var $=M(4),j=M(1),z=M(6),V=M(29);class X extends $.AnnotationEditor{constructor(Me){super({...Me,name:"stampEditor"});Ze(this,se);Ze(this,oe);Ze(this,ce);Ze(this,le);Ze(this,ge);Ze(this,pe);Ze(this,_e);Ze(this,G,null);Ze(this,Y,null);Ze(this,Q,null);Ze(this,ee,null);Ze(this,te,null);Ze(this,Z,null);Ze(this,ne,null);Ze(this,re,!1);dt(this,ee,Me.bitmapUrl)}remove(){var Me,Ee;we(this,Y)&&(dt(this,G,null),this._uiManager.imageManager.deleteId(we(this,Y)),(Me=we(this,te))==null||Me.remove(),dt(this,te,null),(Ee=we(this,Z))==null||Ee.disconnect(),dt(this,Z,null)),super.remove()}rebuild(){super.rebuild(),this.div!==null&&(we(this,Y)&&st(this,se,zn).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this.div.draggable=!0,this.parent.addUndoableEditor(this),this.div.focus()}isEmpty(){return we(this,Q)===null&&we(this,G)===null&&we(this,ee)===null}get isResizable(){return!0}render(){if(this.div)return this.div;let Me,Ee;if(this.width&&(Me=this.x,Ee=this.y),super.render(),we(this,G)?st(this,oe,sn).call(this):(this.div.classList.add("loading"),st(this,se,zn).call(this)),this.width){const[Te,Be]=this.parentDimensions;this.setAt(Me*Te,Ee*Be,this.width*Te,this.height*Be)}return this.div}static deserialize(Me,Ee,Te){if(Me instanceof V.StampAnnotationElement)return null;const Be=super.deserialize(Me,Ee,Te),{rect:Xe,bitmapUrl:ze,bitmapId:Oe,isSvg:Pe}=Me;Oe&&Te.imageManager.isValidId(Oe)?dt(Be,Y,Oe):dt(Be,ee,ze),dt(Be,re,Pe);const[ve,be]=Be.pageDimensions;return Be.width=(Xe[2]-Xe[0])/ve,Be.height=(Xe[3]-Xe[1])/be,Be}serialize(Me=!1,Ee=null){if(this.isEmpty())return null;const Te={annotationType:j.AnnotationEditorType.STAMP,bitmapId:we(this,Y),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:we(this,re)};if(Me)return Te.bitmapUrl=st(this,pe,pn).call(this,!0),Te;if(Ee===null)return Te;Ee.stamps||(Ee.stamps=new Map);const Be=we(this,re)?(Te.rect[2]-Te.rect[0])*(Te.rect[3]-Te.rect[1]):null;if(!Ee.stamps.has(we(this,Y)))Ee.stamps.set(we(this,Y),{area:Be,serialized:Te}),Te.bitmap=st(this,pe,pn).call(this,!1);else if(we(this,re)){const Xe=Ee.stamps.get(we(this,Y));Be>Xe.area&&(Xe.area=Be,Xe.serialized.bitmap.close(),Xe.serialized.bitmap=st(this,pe,pn).call(this,!1))}return Te}}G=new WeakMap,Y=new WeakMap,Q=new WeakMap,ee=new WeakMap,te=new WeakMap,Z=new WeakMap,ne=new WeakMap,re=new WeakMap,se=new WeakSet,zn=function(){if(we(this,Y)){this._uiManager.imageManager.getFromId(we(this,Y)).then(Ee=>{if(!Ee){this.remove();return}dt(this,G,Ee.bitmap),st(this,oe,sn).call(this)});return}if(we(this,ee)){const Ee=we(this,ee);dt(this,ee,null),dt(this,Q,this._uiManager.imageManager.getFromUrl(Ee).then(Te=>{if(dt(this,Q,null),!Te){this.remove();return}({bitmap:Wt(this,G)._,id:Wt(this,Y)._,isSvg:Wt(this,re)._}=Te),st(this,oe,sn).call(this)}));return}const Me=document.createElement("input");Me.type="file",Me.accept="image/*",dt(this,Q,new Promise(Ee=>{Me.addEventListener("change",async()=>{if(dt(this,Q,null),!Me.files||Me.files.length===0)this.remove();else{const Te=await this._uiManager.imageManager.getFromFile(Me.files[0]);if(!Te){this.remove();return}({bitmap:Wt(this,G)._,id:Wt(this,Y)._,isSvg:Wt(this,re)._}=Te),st(this,oe,sn).call(this)}Ee()}),Me.addEventListener("cancel",()=>{dt(this,Q,null),this.remove(),Ee()})})),Me.click()},oe=new WeakSet,sn=function(){const{div:Me}=this;let{width:Ee,height:Te}=we(this,G);const[Be,Xe]=this.pageDimensions,ze=.75;if(this.width)Ee=this.width*Be,Te=this.height*Xe;else if(Ee>ze*Be||Te>ze*Xe){const be=Math.min(ze*Be/Ee,ze*Xe/Te);Ee*=be,Te*=be}const[Oe,Pe]=this.parentDimensions;this.setDims(Ee*Oe/Be,Te*Pe/Xe);const ve=dt(this,te,document.createElement("canvas"));Me.append(ve),st(this,ge,Hn).call(this,Ee,Te),st(this,_e,Cr).call(this),Me.classList.remove("loading")},ce=new WeakSet,Er=function(Me,Ee){const[Te,Be]=this.parentDimensions;this.width=Me/Te,this.height=Ee/Be,this.setDims(Me,Ee),this.fixAndSetPosition(),we(this,ne)!==null&&clearTimeout(we(this,ne)),dt(this,ne,setTimeout(()=>{dt(this,ne,null),st(this,ge,Hn).call(this,Me,Ee)},200))},le=new WeakSet,kr=function(Me,Ee){const{width:Te,height:Be}=we(this,G);let Xe=Te,ze=Be,Oe=we(this,G);for(;Xe>2*Me||ze>2*Ee;){const Pe=Xe,ve=ze;Xe>2*Me&&(Xe=Xe>=16384?Math.floor(Xe/2)-1:Math.ceil(Xe/2)),ze>2*Ee&&(ze=ze>=16384?Math.floor(ze/2)-1:Math.ceil(ze/2));const be=new OffscreenCanvas(Xe,ze);be.getContext("2d").drawImage(Oe,0,0,Pe,ve,0,0,Xe,ze),Oe=be.transferToImageBitmap()}return Oe},ge=new WeakSet,Hn=function(Me,Ee){const Te=we(this,te);if(!Te||Te.width===Me&&Te.height===Ee)return;Te.width=Me,Te.height=Ee;const Be=we(this,re)?we(this,G):st(this,le,kr).call(this,Me,Ee),Xe=Te.getContext("2d");Xe.filter=this._uiManager.hcmFilter,Xe.drawImage(Be,0,0,Be.width,Be.height,0,0,Me,Ee)},pe=new WeakSet,pn=function(Me){if(Me){if(we(this,re)){const Be=this._uiManager.imageManager.getSvgUrl(we(this,Y));if(Be)return Be}const Ee=document.createElement("canvas");return{width:Ee.width,height:Ee.height}=we(this,G),Ee.getContext("2d").drawImage(we(this,G),0,0),Ee.toDataURL()}if(we(this,re)){const[Ee,Te]=this.pageDimensions,Be=Math.round(this.width*Ee*z.PixelsPerInch.PDF_TO_CSS_UNITS),Xe=Math.round(this.height*Te*z.PixelsPerInch.PDF_TO_CSS_UNITS),ze=new OffscreenCanvas(Be,Xe);return ze.getContext("2d").drawImage(we(this,G),0,0,we(this,G).width,we(this,G).height,0,0,Be,Xe),ze.transferToImageBitmap()}return structuredClone(we(this,G))},_e=new WeakSet,Cr=function(){dt(this,Z,new ResizeObserver(Me=>{const Ee=Me[0].contentRect;Ee.width&&Ee.height&&st(this,ce,Er).call(this,Ee.width,Ee.height)})),we(this,Z).observe(this.div)},$t(X,"_type","stamp"),_.StampEditor=X}],__webpack_module_cache__={};function __w_pdfjs_require__(q){var _=__webpack_module_cache__[q];if(_!==void 0)return _.exports;var M=__webpack_module_cache__[q]={exports:{}};return __webpack_modules__[q](M,M.exports,__w_pdfjs_require__),M.exports}var __webpack_exports__={};return(()=>{var q=__webpack_exports__;Object.defineProperty(q,"__esModule",{value:!0}),Object.defineProperty(q,"AbortException",{enumerable:!0,get:function(){return _.AbortException}}),Object.defineProperty(q,"AnnotationEditorLayer",{enumerable:!0,get:function(){return z.AnnotationEditorLayer}}),Object.defineProperty(q,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return _.AnnotationEditorParamsType}}),Object.defineProperty(q,"AnnotationEditorType",{enumerable:!0,get:function(){return _.AnnotationEditorType}}),Object.defineProperty(q,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return V.AnnotationEditorUIManager}}),Object.defineProperty(q,"AnnotationLayer",{enumerable:!0,get:function(){return X.AnnotationLayer}}),Object.defineProperty(q,"AnnotationMode",{enumerable:!0,get:function(){return _.AnnotationMode}}),Object.defineProperty(q,"CMapCompressionType",{enumerable:!0,get:function(){return _.CMapCompressionType}}),Object.defineProperty(q,"FeatureTest",{enumerable:!0,get:function(){return _.FeatureTest}}),Object.defineProperty(q,"GlobalWorkerOptions",{enumerable:!0,get:function(){return G.GlobalWorkerOptions}}),Object.defineProperty(q,"ImageKind",{enumerable:!0,get:function(){return _.ImageKind}}),Object.defineProperty(q,"InvalidPDFException",{enumerable:!0,get:function(){return _.InvalidPDFException}}),Object.defineProperty(q,"MissingPDFException",{enumerable:!0,get:function(){return _.MissingPDFException}}),Object.defineProperty(q,"OPS",{enumerable:!0,get:function(){return _.OPS}}),Object.defineProperty(q,"PDFDataRangeTransport",{enumerable:!0,get:function(){return M.PDFDataRangeTransport}}),Object.defineProperty(q,"PDFDateString",{enumerable:!0,get:function(){return $.PDFDateString}}),Object.defineProperty(q,"PDFWorker",{enumerable:!0,get:function(){return M.PDFWorker}}),Object.defineProperty(q,"PasswordResponses",{enumerable:!0,get:function(){return _.PasswordResponses}}),Object.defineProperty(q,"PermissionFlag",{enumerable:!0,get:function(){return _.PermissionFlag}}),Object.defineProperty(q,"PixelsPerInch",{enumerable:!0,get:function(){return $.PixelsPerInch}}),Object.defineProperty(q,"PromiseCapability",{enumerable:!0,get:function(){return _.PromiseCapability}}),Object.defineProperty(q,"RenderingCancelledException",{enumerable:!0,get:function(){return $.RenderingCancelledException}}),Object.defineProperty(q,"SVGGraphics",{enumerable:!0,get:function(){return M.SVGGraphics}}),Object.defineProperty(q,"UnexpectedResponseException",{enumerable:!0,get:function(){return _.UnexpectedResponseException}}),Object.defineProperty(q,"Util",{enumerable:!0,get:function(){return _.Util}}),Object.defineProperty(q,"VerbosityLevel",{enumerable:!0,get:function(){return _.VerbosityLevel}}),Object.defineProperty(q,"XfaLayer",{enumerable:!0,get:function(){return Y.XfaLayer}}),Object.defineProperty(q,"build",{enumerable:!0,get:function(){return M.build}}),Object.defineProperty(q,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return _.createValidAbsoluteUrl}}),Object.defineProperty(q,"getDocument",{enumerable:!0,get:function(){return M.getDocument}}),Object.defineProperty(q,"getFilenameFromUrl",{enumerable:!0,get:function(){return $.getFilenameFromUrl}}),Object.defineProperty(q,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return $.getPdfFilenameFromUrl}}),Object.defineProperty(q,"getXfaPageViewport",{enumerable:!0,get:function(){return $.getXfaPageViewport}}),Object.defineProperty(q,"isDataScheme",{enumerable:!0,get:function(){return $.isDataScheme}}),Object.defineProperty(q,"isPdfFile",{enumerable:!0,get:function(){return $.isPdfFile}}),Object.defineProperty(q,"loadScript",{enumerable:!0,get:function(){return $.loadScript}}),Object.defineProperty(q,"normalizeUnicode",{enumerable:!0,get:function(){return _.normalizeUnicode}}),Object.defineProperty(q,"renderTextLayer",{enumerable:!0,get:function(){return j.renderTextLayer}}),Object.defineProperty(q,"setLayerDimensions",{enumerable:!0,get:function(){return $.setLayerDimensions}}),Object.defineProperty(q,"shadow",{enumerable:!0,get:function(){return _.shadow}}),Object.defineProperty(q,"updateTextLayer",{enumerable:!0,get:function(){return j.updateTextLayer}}),Object.defineProperty(q,"version",{enumerable:!0,get:function(){return M.version}});var _=__w_pdfjs_require__(1),M=__w_pdfjs_require__(2),$=__w_pdfjs_require__(6),j=__w_pdfjs_require__(26),z=__w_pdfjs_require__(27),V=__w_pdfjs_require__(5),X=__w_pdfjs_require__(29),G=__w_pdfjs_require__(14),Y=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;const onPrint=q=>{let _;_||(_=document.createElement("iframe"),document.body.appendChild(_),_.style.display="none",_.onload=function(){setTimeout(function(){_.focus(),_.contentWindow.print()},1)}),_.src=q},calcRT=q=>{let M=q.split(" ").length;if(M>0)return Math.ceil(M/200)},getPageText=(q,_)=>new Promise(function(M,$){_.getPage(q).then(function(j){j.getTextContent().then(function(z){for(var V=z.items,X="",G=0;G<V.length;G++){var Y=V[G];X+=Y.str+" "}M(X)})})}),savePDF=async({fileUrl:q,data:_,name:M="download.pdf"})=>{const $=document.createElement("a");$.download=M,$.rel="noopener",q||(q=`data:application/pdf;base64,${btoa(_)}`);let j=await fetch(q).then(V=>V.blob());(!j||!(j instanceof Blob))&&console.log("Invalid blob object passed to URL.createObjectURL()"),typeof URL.createObjectURL>"u"&&console.log("Your browser does not support URL.createObjectURL()");const z=URL.createObjectURL(j);$.href=z,$.click(),URL.revokeObjectURL($.href)};class ClassBuilder{constructor(_,M){this.defaults=typeof _=="function"?_(M):_,this.classes=this.defaults}flush(){return this.classes=this.defaults,this}extend(..._){return this}get(){return this.classes}replace(_,M=!0){return M&&_&&(this.classes=Object.keys(_).reduce(($,j)=>$.replace(new RegExp(j,"g"),_[j]),this.classes)),this}remove(_,M=!0){return M&&_&&(this.classes=_.split(" ").reduce(($,j)=>$.replace(new RegExp(j,"g"),""),this.classes)),this}add(_,M=!0,$){if(!M||!_)return this;switch(typeof _){case"string":default:return this.classes+=` ${_} `,this;case"function":return this.classes+=` ${_($||this.classes)} `,this}}}const Tooltip_svelte_svelte_type_style_lang="",get_activator_slot_changes=q=>({}),get_activator_slot_context=q=>({});function create_if_block$r(q){let _,M,$,j,z;const V=q[8].default,X=create_slot(V,q,q[7],null);return{c(){_=element("div"),X&&X.c(),attr(_,"class",M=null_to_empty(q[1])+" svelte-10lk5cm")},m(G,Y){insert(G,_,Y),X&&X.m(_,null),z=!0},p(G,Y){X&&X.p&&(!z||Y&128)&&update_slot_base(X,V,G,G[7],z?get_slot_changes(V,G[7],Y,null):get_all_dirty_from_scope(G[7]),null),(!z||Y&2&&M!==(M=null_to_empty(G[1])+" svelte-10lk5cm"))&&attr(_,"class",M)},i(G){z||(transition_in(X,G),add_render_callback(()=>{j&&j.end(1),$=create_in_transition(_,scale,{duration:150}),$.start()}),z=!0)},o(G){transition_out(X,G),$&&$.invalidate(),j=create_out_transition(_,scale,{duration:150,delay:100}),z=!1},d(G){G&&detach(_),X&&X.d(G),G&&j&&j.end()}}}function create_fragment$A(q){let _,M,$,j,z,V;const X=q[8].activator,G=create_slot(X,q,q[7],get_activator_slot_context);let Y=q[0]&&create_if_block$r(q);return{c(){_=element("div"),M=element("div"),G&&G.c(),$=space(),Y&&Y.c(),attr(_,"class","activator svelte-10lk5cm")},m(Q,ee){insert(Q,_,ee),append(_,M),G&&G.m(M,null),append(_,$),Y&&Y.m(_,null),j=!0,z||(V=[listen(M,"mouseenter",debounce(q[2],100)),listen(M,"mouseleave",debounce(q[3],500)),listen(M,"mouseenter",q[9]),listen(M,"mouseleave",q[10]),listen(M,"focus",q[11]),listen(M,"blur",q[12])],z=!0)},p(Q,[ee]){G&&G.p&&(!j||ee&128)&&update_slot_base(G,X,Q,Q[7],j?get_slot_changes(X,Q[7],ee,get_activator_slot_changes):get_all_dirty_from_scope(Q[7]),get_activator_slot_context),Q[0]?Y?(Y.p(Q,ee),ee&1&&transition_in(Y,1)):(Y=create_if_block$r(Q),Y.c(),transition_in(Y,1),Y.m(_,null)):Y&&(group_outros(),transition_out(Y,1,1,()=>{Y=null}),check_outros())},i(Q){j||(transition_in(G,Q),transition_in(Y),j=!0)},o(Q){transition_out(G,Q),transition_out(Y),j=!1},d(Q){Q&&detach(_),G&&G.d(Q),Y&&Y.d(),z=!1,run_all(V)}}}const classesDefault="tooltip";function debounce(q,_,M){let $;return function(){let j=this,z=arguments,V=function(){$=null,M||q.apply(j,z)},X=M&&!$;clearTimeout($),$=setTimeout(V,_),X&&q.apply(j,z)}}function instance$v(q,_,M){let $,{$$slots:j={},$$scope:z}=_,{class:V=""}=_,{classes:X=classesDefault}=_,{show:G=!1}=_,{timeout:Y=null}=_;const Q=new ClassBuilder(X,classesDefault);function ee(){G||(M(0,G=!0),Y&&M(4,Y=setTimeout(()=>{M(0,G=!1)},Y)))}function te(){G&&(M(0,G=!1),clearTimeout(Y))}function Z(ie){bubble.call(this,q,ie)}function ne(ie){bubble.call(this,q,ie)}function re(ie){bubble.call(this,q,ie)}function se(ie){bubble.call(this,q,ie)}return q.$$set=ie=>{"class"in ie&&M(5,V=ie.class),"classes"in ie&&M(6,X=ie.classes),"show"in ie&&M(0,G=ie.show),"timeout"in ie&&M(4,Y=ie.timeout),"$$scope"in ie&&M(7,z=ie.$$scope)},q.$$.update=()=>{q.$$.dirty&96&&M(1,$=Q.flush().add(X,!0,classesDefault).add(V).get())},[G,$,ee,te,Y,V,X,z,j,Z,ne,re,se]}let Tooltip$1=class extends SvelteComponent{constructor(_){super(),init(this,_,instance$v,create_fragment$A,safe_not_equal,{class:5,classes:6,show:0,timeout:4})}};const PdfViewer_svelte_svelte_type_style_lang="",{window:window_1}=globals;function create_else_block_1$5(q){let _,M,$;return{c(){_=element("div"),M=element("canvas"),attr(M,"class","svelte-19h83wp"),attr(_,"class",$=null_to_empty(q[6]===!0?"viewer":"null")+" svelte-19h83wp")},m(j,z){insert(j,_,z),append(_,M),q[54](M)},p(j,z){z[0]&64&&$!==($=null_to_empty(j[6]===!0?"viewer":"null")+" svelte-19h83wp")&&attr(_,"class",$)},i:noop,o:noop,d(j){j&&detach(_),q[54](null)}}}function create_if_block_1$h(q){let _,M,$=q[5].includes("navigation"),j,z=q[5].includes("zoom"),V,X=q[5].includes("print"),G,Y=q[5].includes("rotate"),Q,ee=q[5].includes("download"),te,Z=q[5].includes("autoflip"),ne,re,se,ie,oe,ue,ce,ae,le,he,ge,de,pe,ye,_e,De,fe,Ae,Me,Ee,Te,Be,Xe,ze,Oe,Pe=$&&create_if_block_8$2(q),ve=z&&create_if_block_7$3(q),be=X&&create_if_block_6$3(q),Ce=Y&&create_if_block_5$3(q),Ne=ee&&create_if_block_4$6(q),Ie=Z&&create_if_block_2$e(q);return{c(){_=element("div"),M=element("div"),Pe&&Pe.c(),j=space(),ve&&ve.c(),V=space(),be&&be.c(),G=space(),Ce&&Ce.c(),Q=space(),Ne&&Ne.c(),te=space(),Ie&&Ie.c(),ne=space(),re=element("span"),se=svg_element("svg"),ie=svg_element("path"),oe=space(),ue=element("span"),ce=text(q[10]),ae=text(" min read"),he=space(),ge=element("span"),de=svg_element("svg"),pe=svg_element("path"),ye=space(),_e=element("div"),De=text(`Page :
              `),fe=element("span"),Ae=text(`
              /
              `),Me=element("span"),Te=space(),Be=element("div"),Xe=element("canvas"),attr(ie,"d",`M16.32 7.1A8 8 0 1 1 9 4.06V2h2v2.06c1.46.18 2.8.76 3.9
                1.62l1.46-1.46 1.42 1.42-1.46 1.45zM10 18a6 6 0 1 0 0-12 6 6 0 0
                0 0 12zM7 0h6v2H7V0zm5.12 8.46l1.42 1.42L10 13.4 8.59
                12l3.53-3.54z`),attr(se,"class","icon svelte-19h83wp"),attr(se,"xmlns","http://www.w3.org/2000/svg"),attr(se,"viewBox","0 0 20 20"),attr(ue,"class","text svelte-19h83wp"),attr(re,"class","page-info svelte-19h83wp"),attr(re,"style",le=q[5].includes("timeInfo")?"":"display: none;"),attr(pe,"d",`M16 2h4v15a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V0h16v2zm0 2v13a1 1 0
                0 0 1 1 1 1 0 0 0 1-1V4h-2zM2 2v15a1 1 0 0 0 1 1h11.17a2.98 2.98
                0 0 1-.17-1V2H2zm2 8h8v2H4v-2zm0 4h8v2H4v-2zM4 4h8v4H4V4z`),attr(de,"class","icon svelte-19h83wp"),attr(de,"xmlns","http://www.w3.org/2000/svg"),attr(de,"viewBox","0 0 20 20"),attr(_e,"class","text svelte-19h83wp"),attr(ge,"class","page-info svelte-19h83wp"),attr(ge,"style",Ee=q[5].includes("pageInfo")?"":"display: none;"),attr(M,"class","line svelte-19h83wp"),attr(Xe,"width",q[16]),attr(Xe,"height",q[17]),attr(Xe,"class","svelte-19h83wp"),attr(Be,"class",ze=null_to_empty(q[6]===!0?"viewer":"null")+" svelte-19h83wp"),attr(_,"class","control-start svelte-19h83wp")},m(Le,je){insert(Le,_,je),append(_,M),Pe&&Pe.m(M,null),append(M,j),ve&&ve.m(M,null),append(M,V),be&&be.m(M,null),append(M,G),Ce&&Ce.m(M,null),append(M,Q),Ne&&Ne.m(M,null),append(M,te),Ie&&Ie.m(M,null),append(M,ne),append(M,re),append(re,se),append(se,ie),append(re,oe),append(re,ue),append(ue,ce),append(ue,ae),append(M,he),append(M,ge),append(ge,de),append(de,pe),append(ge,ye),append(ge,_e),append(_e,De),append(_e,fe),q[51](fe),append(_e,Ae),append(_e,Me),q[52](Me),append(_,Te),append(_,Be),append(Be,Xe),q[53](Xe),Oe=!0},p(Le,je){je[0]&32&&($=Le[5].includes("navigation")),$?Pe?(Pe.p(Le,je),je[0]&32&&transition_in(Pe,1)):(Pe=create_if_block_8$2(Le),Pe.c(),transition_in(Pe,1),Pe.m(M,j)):Pe&&(group_outros(),transition_out(Pe,1,1,()=>{Pe=null}),check_outros()),je[0]&32&&(z=Le[5].includes("zoom")),z?ve?(ve.p(Le,je),je[0]&32&&transition_in(ve,1)):(ve=create_if_block_7$3(Le),ve.c(),transition_in(ve,1),ve.m(M,V)):ve&&(group_outros(),transition_out(ve,1,1,()=>{ve=null}),check_outros()),je[0]&32&&(X=Le[5].includes("print")),X?be?(be.p(Le,je),je[0]&32&&transition_in(be,1)):(be=create_if_block_6$3(Le),be.c(),transition_in(be,1),be.m(M,G)):be&&(group_outros(),transition_out(be,1,1,()=>{be=null}),check_outros()),je[0]&32&&(Y=Le[5].includes("rotate")),Y?Ce?(Ce.p(Le,je),je[0]&32&&transition_in(Ce,1)):(Ce=create_if_block_5$3(Le),Ce.c(),transition_in(Ce,1),Ce.m(M,Q)):Ce&&(group_outros(),transition_out(Ce,1,1,()=>{Ce=null}),check_outros()),je[0]&32&&(ee=Le[5].includes("download")),ee?Ne?(Ne.p(Le,je),je[0]&32&&transition_in(Ne,1)):(Ne=create_if_block_4$6(Le),Ne.c(),transition_in(Ne,1),Ne.m(M,te)):Ne&&(group_outros(),transition_out(Ne,1,1,()=>{Ne=null}),check_outros()),je[0]&32&&(Z=Le[5].includes("autoflip")),Z?Ie?(Ie.p(Le,je),je[0]&32&&transition_in(Ie,1)):(Ie=create_if_block_2$e(Le),Ie.c(),transition_in(Ie,1),Ie.m(M,ne)):Ie&&(group_outros(),transition_out(Ie,1,1,()=>{Ie=null}),check_outros()),(!Oe||je[0]&1024)&&set_data(ce,Le[10]),(!Oe||je[0]&32&&le!==(le=Le[5].includes("timeInfo")?"":"display: none;"))&&attr(re,"style",le),(!Oe||je[0]&32&&Ee!==(Ee=Le[5].includes("pageInfo")?"":"display: none;"))&&attr(ge,"style",Ee),(!Oe||je[0]&65536)&&attr(Xe,"width",Le[16]),(!Oe||je[0]&131072)&&attr(Xe,"height",Le[17]),(!Oe||je[0]&64&&ze!==(ze=null_to_empty(Le[6]===!0?"viewer":"null")+" svelte-19h83wp"))&&attr(Be,"class",ze)},i(Le){Oe||(transition_in(Pe),transition_in(ve),transition_in(be),transition_in(Ce),transition_in(Ne),transition_in(Ie),Oe=!0)},o(Le){transition_out(Pe),transition_out(ve),transition_out(be),transition_out(Ce),transition_out(Ne),transition_out(Ie),Oe=!1},d(Le){Le&&detach(_),Pe&&Pe.d(),ve&&ve.d(),be&&be.d(),Ce&&Ce.d(),Ne&&Ne.d(),Ie&&Ie.d(),q[51](null),q[52](null),q[53](null)}}}function create_if_block$q(q){let _,M,$,j,z,V,X,G,Y,Q,ee,te;return{c(){_=element("div"),M=element("p"),M.textContent="This document requires a password to open:",$=space(),j=element("p"),z=text(q[15]),V=space(),X=element("div"),G=element("input"),Y=space(),Q=element("button"),Q.textContent="Submit",attr(j,"class","password-message svelte-19h83wp"),attr(G,"type","password"),attr(G,"class","password-input svelte-19h83wp"),attr(Q,"class","password-button svelte-19h83wp"),attr(X,"class","password-container svelte-19h83wp"),attr(_,"class","password-viewer svelte-19h83wp")},m(Z,ne){insert(Z,_,ne),append(_,M),append(_,$),append(_,j),append(j,z),append(_,V),append(_,X),append(X,G),set_input_value(G,q[13]),append(X,Y),append(X,Q),ee||(te=[listen(G,"input",q[41]),listen(Q,"click",q[25])],ee=!0)},p(Z,ne){ne[0]&32768&&set_data(z,Z[15]),ne[0]&8192&&G.value!==Z[13]&&set_input_value(G,Z[13])},i:noop,o:noop,d(Z){Z&&detach(_),ee=!1,run_all(te)}}}function create_if_block_8$2(q){let _,M,$,j;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_8],default:[create_default_slot_8]},$$scope:{ctx:q}}}),$=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_7],default:[create_default_slot_7]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment),M=space(),create_component($.$$.fragment)},m(z,V){mount_component(_,z,V),insert(z,M,V),mount_component($,z,V),j=!0},p(z,V){const X={};V[0]&1|V[2]&64&&(X.$$scope={dirty:V,ctx:z}),_.$set(X);const G={};V[0]&5|V[2]&64&&(G.$$scope={dirty:V,ctx:z}),$.$set(G)},i(z){j||(transition_in(_.$$.fragment,z),transition_in($.$$.fragment,z),j=!0)},o(z){transition_out(_.$$.fragment,z),transition_out($.$$.fragment,z),j=!1},d(z){destroy_component(_,z),z&&detach(M),destroy_component($,z)}}}function create_default_slot_8(q){let _;return{c(){_=text("Previous")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_8(q){let _,M,$,j,z,V;return{c(){_=element("span"),M=svg_element("svg"),$=svg_element("polygon"),attr($,"points",`3.828 9 9.899 2.929 8.485 1.515 0 10 .707 10.707 8.485
                  18.485 9.899 17.071 3.828 11 20 11 20 9 3.828 9`),attr(M,"class","icon svelte-19h83wp"),attr(M,"xmlns","http://www.w3.org/2000/svg"),attr(M,"viewBox","0 0 20 20"),attr(_,"slot","activator"),attr(_,"class",j="button-control "+(q[0]<=1?"disabled":null)+" svelte-19h83wp")},m(X,G){insert(X,_,G),append(_,M),append(M,$),z||(V=[listen(_,"click",q[42]),listen(_,"keydown",q[39])],z=!0)},p(X,G){G[0]&1&&j!==(j="button-control "+(X[0]<=1?"disabled":null)+" svelte-19h83wp")&&attr(_,"class",j)},d(X){X&&detach(_),z=!1,run_all(V)}}}function create_default_slot_7(q){let _;return{c(){_=text("Next")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_7(q){let _,M,$,j,z,V;return{c(){_=element("span"),M=svg_element("svg"),$=svg_element("polygon"),attr($,"points",`16.172 9 10.101 2.929 11.515 1.515 20 10 19.293 10.707
                  11.515 18.485 10.101 17.071 16.172 11 0 11 0 9`),attr(M,"class","icon svelte-19h83wp"),attr(M,"xmlns","http://www.w3.org/2000/svg"),attr(M,"viewBox","0 0 20 20"),attr(_,"slot","activator"),attr(_,"class",j="button-control "+(q[0]>=q[2]?"disabled":null)+" svelte-19h83wp")},m(X,G){insert(X,_,G),append(_,M),append(M,$),z||(V=[listen(_,"click",q[43]),listen(_,"keydown",q[38])],z=!0)},p(X,G){G[0]&5&&j!==(j="button-control "+(X[0]>=X[2]?"disabled":null)+" svelte-19h83wp")&&attr(_,"class",j)},d(X){X&&detach(_),z=!1,run_all(V)}}}function create_if_block_7$3(q){let _,M,$,j;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_6],default:[create_default_slot_6]},$$scope:{ctx:q}}}),$=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_5],default:[create_default_slot_5]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment),M=space(),create_component($.$$.fragment)},m(z,V){mount_component(_,z,V),insert(z,M,V),mount_component($,z,V),j=!0},p(z,V){const X={};V[0]&2|V[2]&64&&(X.$$scope={dirty:V,ctx:z}),_.$set(X);const G={};V[0]&2|V[2]&64&&(G.$$scope={dirty:V,ctx:z}),$.$set(G)},i(z){j||(transition_in(_.$$.fragment,z),transition_in($.$$.fragment,z),j=!0)},o(z){transition_out(_.$$.fragment,z),transition_out($.$$.fragment,z),j=!1},d(z){destroy_component(_,z),z&&detach(M),destroy_component($,z)}}}function create_default_slot_6(q){let _;return{c(){_=text("Zoom In")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_6(q){let _,M,$,j,z,V;return{c(){_=element("span"),M=svg_element("svg"),$=svg_element("path"),attr($,"fill-rule","evenodd"),attr($,"d",`M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42
                  1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12zM7
                  7V5h2v2h2v2H9v2H7V9H5V7h2z`),attr(M,"class","icon svelte-19h83wp"),attr(M,"xmlns","http://www.w3.org/2000/svg"),attr(M,"viewBox","0 0 20 20"),attr(_,"slot","activator"),attr(_,"class",j="button-control "+(q[1]>=maxScale?"disabled":null)+" svelte-19h83wp")},m(X,G){insert(X,_,G),append(_,M),append(M,$),z||(V=[listen(_,"click",q[44]),listen(_,"keydown",q[37])],z=!0)},p(X,G){G[0]&2&&j!==(j="button-control "+(X[1]>=maxScale?"disabled":null)+" svelte-19h83wp")&&attr(_,"class",j)},d(X){X&&detach(_),z=!1,run_all(V)}}}function create_default_slot_5(q){let _;return{c(){_=text("Zoom Out")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_5(q){let _,M,$,j,z,V;return{c(){_=element("span"),M=svg_element("svg"),$=svg_element("path"),attr($,"fill-rule","evenodd"),attr($,"d",`M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42
                  1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12zM5
                  7h6v2H5V7z`),attr(M,"class","icon svelte-19h83wp"),attr(M,"xmlns","http://www.w3.org/2000/svg"),attr(M,"viewBox","0 0 20 20"),attr(_,"slot","activator"),attr(_,"class",j="button-control "+(q[1]<=minScale?"disabled":null)+" svelte-19h83wp")},m(X,G){insert(X,_,G),append(_,M),append(M,$),z||(V=[listen(_,"click",q[45]),listen(_,"keydown",q[36])],z=!0)},p(X,G){G[0]&2&&j!==(j="button-control "+(X[1]<=minScale?"disabled":null)+" svelte-19h83wp")&&attr(_,"class",j)},d(X){X&&detach(_),z=!1,run_all(V)}}}function create_if_block_6$3(q){let _,M;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_4],default:[create_default_slot_4]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j[0]&8|j[2]&64&&(z.$$scope={dirty:j,ctx:$}),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_default_slot_4(q){let _;return{c(){_=text("Print")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_4(q){let _,M,$;return{c(){_=element("span"),_.innerHTML=`<svg class="icon svelte-19h83wp" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M4 16H0V6h20v10h-4v4H4v-4zm2-4v6h8v-6H6zM4 0h12v5H4V0zM2
                  8v2h2V8H2zm4 0v2h2V8H6z"></path></svg>`,attr(_,"slot","activator"),attr(_,"class","button-control svelte-19h83wp")},m(j,z){insert(j,_,z),M||($=[listen(_,"click",q[46]),listen(_,"keydown",q[35])],M=!0)},p:noop,d(j){j&&detach(_),M=!1,run_all($)}}}function create_if_block_5$3(q){let _,M,$,j;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_3],default:[create_default_slot_3]},$$scope:{ctx:q}}}),$=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_2],default:[create_default_slot_2]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment),M=space(),create_component($.$$.fragment)},m(z,V){mount_component(_,z,V),insert(z,M,V),mount_component($,z,V),j=!0},p(z,V){const X={};V[2]&64&&(X.$$scope={dirty:V,ctx:z}),_.$set(X);const G={};V[2]&64&&(G.$$scope={dirty:V,ctx:z}),$.$set(G)},i(z){j||(transition_in(_.$$.fragment,z),transition_in($.$$.fragment,z),j=!0)},o(z){transition_out(_.$$.fragment,z),transition_out($.$$.fragment,z),j=!1},d(z){destroy_component(_,z),z&&detach(M),destroy_component($,z)}}}function create_default_slot_3(q){let _;return{c(){_=text("Anti-Clockwise")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_3(q){let _,M,$;return{c(){_=element("span"),_.innerHTML=`<svg class="icon rot-icon svelte-19h83wp" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M14.66 15.66A8 8 0 1 1 17 10h-2a6 6 0 1 0-1.76 4.24l1.42
                  1.42zM12 10h8l-4 4-4-4z"></path></svg>`,attr(_,"slot","activator"),attr(_,"class","button-control svelte-19h83wp")},m(j,z){insert(j,_,z),M||($=[listen(_,"click",q[47]),listen(_,"keydown",q[34])],M=!0)},p:noop,d(j){j&&detach(_),M=!1,run_all($)}}}function create_default_slot_2(q){let _;return{c(){_=text("Clockwise")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_2(q){let _,M,$;return{c(){_=element("span"),_.innerHTML=`<svg class="icon svelte-19h83wp" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M14.66 15.66A8 8 0 1 1 17 10h-2a6 6 0 1 0-1.76 4.24l1.42
                  1.42zM12 10h8l-4 4-4-4z"></path></svg>`,attr(_,"slot","activator"),attr(_,"class","button-control svelte-19h83wp")},m(j,z){insert(j,_,z),M||($=[listen(_,"click",q[48]),listen(_,"keydown",q[33])],M=!0)},p:noop,d(j){j&&detach(_),M=!1,run_all($)}}}function create_if_block_4$6(q){let _,M;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_1],default:[create_default_slot_1]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j[0]&24|j[2]&64&&(z.$$scope={dirty:j,ctx:$}),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_default_slot_1(q){let _;return{c(){_=text("Download")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_1(q){let _,M,$;return{c(){_=element("span"),_.innerHTML='<svg class="icon svelte-19h83wp" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M13 8V2H7v6H2l8 8 8-8h-5zM0 18h20v2H0v-2z"></path></svg>',attr(_,"slot","activator"),attr(_,"class","button-control svelte-19h83wp")},m(j,z){insert(j,_,z),M||($=[listen(_,"click",q[49]),listen(_,"keydown",q[32])],M=!0)},p:noop,d(j){j&&detach(_),M=!1,run_all($)}}}function create_if_block_2$e(q){let _,M;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot],default:[create_default_slot$2]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j[0]&6144|j[2]&64&&(z.$$scope={dirty:j,ctx:$}),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_default_slot$2(q){let _=(q[11]===!0?q[12]:"Auto Turn Page")+"",M;return{c(){M=text(_)},m($,j){insert($,M,j)},p($,j){j[0]&6144&&_!==(_=($[11]===!0?$[12]:"Auto Turn Page")+"")&&set_data(M,_)},d($){$&&detach(M)}}}function create_else_block$8(q){let _;return{c(){_=svg_element("path"),attr(_,"d",`M9.896,3.838L0.792,1.562v14.794l9.104,2.276L19,16.356V1.562L9.896,3.838z
                    M9.327,17.332L1.93,15.219V3.27 l7.397,1.585V17.332z
                    M17.862,15.219l-7.397,2.113V4.855l7.397-1.585V15.219z`)},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_3$a(q){let _;return{c(){_=svg_element("path"),attr(_,"d","M4 18h12V6h-4V2H4v16zm-2 1V0h12l4 4v16H2v-1z")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot(q){let _,M,$,j;function z(G,Y){return G[11]===!0?create_if_block_3$a:create_else_block$8}let V=z(q),X=V(q);return{c(){_=element("span"),M=svg_element("svg"),X.c(),attr(M,"class","icon svelte-19h83wp"),attr(M,"xmlns","http://www.w3.org/2000/svg"),attr(M,"viewBox","0 0 20 20"),attr(_,"slot","activator"),attr(_,"class","page-info button-control svelte-19h83wp")},m(G,Y){insert(G,_,Y),append(_,M),X.m(M,null),$||(j=[listen(_,"click",q[50]),listen(_,"keydown",q[31])],$=!0)},p(G,Y){V!==(V=z(G))&&(X.d(1),X=V(G),X&&(X.c(),X.m(M,null)))},d(G){G&&detach(_),X.d(),$=!1,run_all(j)}}}function create_fragment$z(q){let _,M,$,j,z,V,X,G,Y,Q;add_render_callback(q[40]);const ee=[create_if_block$q,create_if_block_1$h,create_else_block_1$5],te=[];function Z(ne,re){return ne[14]===!0?0:ne[5].length?1:2}return $=Z(q),j=te[$]=ee[$](q),{c(){_=element("div"),M=element("div"),j.c(),V=space(),X=element("button"),X.innerHTML='<svg class="icon svelte-19h83wp" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M7 10v8h6v-8h5l-8-8-8 8h5z"></path></svg>',attr(M,"class",z=null_to_empty(q[6]===!0?"control":"null")+" svelte-19h83wp"),attr(X,"id","topBtn"),attr(X,"class","svelte-19h83wp"),attr(_,"class","parent svelte-19h83wp")},m(ne,re){insert(ne,_,re),append(_,M),te[$].m(M,null),append(_,V),append(_,X),G=!0,Y||(Q=[listen(window_1,"resize",q[40]),listen(X,"click",q[55])],Y=!0)},p(ne,re){let se=$;$=Z(ne),$===se?te[$].p(ne,re):(group_outros(),transition_out(te[se],1,1,()=>{te[se]=null}),check_outros(),j=te[$],j?j.p(ne,re):(j=te[$]=ee[$](ne),j.c()),transition_in(j,1),j.m(M,null)),(!G||re[0]&64&&z!==(z=null_to_empty(ne[6]===!0?"control":"null")+" svelte-19h83wp"))&&attr(M,"class",z)},i(ne){G||(transition_in(j),G=!0)},o(ne){transition_out(j),G=!1},d(ne){ne&&detach(_),te[$].d(),Y=!1,run_all(Q)}}}const minScale=1,maxScale=2.3;function instance$u(q,_,M){let{url:$}=_,{data:j}=_,{scale:z=1.8}=_,{pageNum:V=1}=_,{flipTime:X=120}=_,{showButtons:G=["navigation","zoom","print","rotate","download","autoflip","timeInfo","pageInfo"]}=_,{showBorder:Y=!0}=_,{totalPage:Q=0}=_,{downloadFileName:ee=""}=_;pdfExports.GlobalWorkerOptions.workerSrc=new URL(""+new URL("pdf.worker-cec92788.js",import.meta.url).href,self.location);let te,Z=0,ne=0,re=null,se=!1,ie=null,oe=0,ue="",ce=0,ae=!1,le,he,ge=X,de=[],pe="",ye=!1,_e="",De=!1;const fe=nt=>{se=!0,re.getPage(nt).then(function(it){let rt=it.getViewport({scale:z,rotation:oe});const gt=te.getContext("2d");M(7,te.height=rt.height,te),M(7,te.width=rt.width,te);let Pt={canvasContext:gt,viewport:rt};it.render(Pt).promise.then(function(){if(se=!1,ie!==null){if(V<re.totalPage)de[V]=te,M(0,V++,V),re.getPage(V).then(fe);else for(let Bt=1;Bt<de.length;Bt++)te.appendChild(de[Bt]);ie=null}})}),G.length&&M(8,Z.textContent=nt,Z)},Ae=nt=>{se?ie=nt:fe(nt)},Me=()=>{V<=1||(M(0,V--,V),Ae(V))},Ee=()=>{V>=re.numPages||(M(0,V++,V),Ae(V))},Te=()=>{z<=maxScale&&(M(1,z=z+.1),Ae(V))},Be=()=>{z>=minScale&&(M(1,z=z-.1),Ae(V))},Xe=nt=>{onPrint(nt)},ze=()=>{oe=oe+90,Ae(V)},Oe=()=>{oe=oe-90,Ae(V)},Pe=()=>{ve()},ve=async()=>{pdfExports.getDocument({...$&&{url:$},...j&&{data:j},...pe&&{password:pe}}).promise.then(async function(it){if(re=it,M(14,ye=!1),await tick(),G.length&&M(9,ne.textContent=re.numPages,ne),M(2,Q=re.numPages),G.length)for(let rt=1;rt<=Q;rt++)getPageText(rt,re).then(function(gt){ue=ue.concat(gt),M(10,ce=calcRT(ue))});M(30,De=!0)}).catch(function(it){M(14,ye=!0),M(15,_e=it.message)})};ve();const be=()=>{M(11,ae=!ae),ae===!1&&(clearInterval(le),clearInterval(he)),ae===!0&&V<=Q&&(he=setInterval(()=>{M(12,ge=ge-1)},1e3),le=setInterval(()=>{M(12,ge=X),Ee()},X*1e3))},Ce=({url:nt,data:it})=>{let rt=ee||nt&&nt.substring(nt.lastIndexOf("/")+1);savePDF({fileURL:nt,data:it,name:rt})};onDestroy(()=>{clearInterval(le),clearInterval(he)});let Ne,Ie;function Le(nt){bubble.call(this,q,nt)}function je(nt){bubble.call(this,q,nt)}function Ve(nt){bubble.call(this,q,nt)}function ot(nt){bubble.call(this,q,nt)}function lt(nt){bubble.call(this,q,nt)}function me(nt){bubble.call(this,q,nt)}function We(nt){bubble.call(this,q,nt)}function Ye(nt){bubble.call(this,q,nt)}function Fe(nt){bubble.call(this,q,nt)}function xe(){M(16,Ne=window_1.innerWidth),M(17,Ie=window_1.innerHeight)}function $e(){pe=this.value,M(13,pe)}const Je=()=>Me(),ut=()=>Ee(),qe=()=>Te(),Ge=()=>Be(),Ke=()=>Xe($),et=()=>Oe(),ct=()=>ze(),mt=()=>Ce({url:$,data:j}),_t=()=>be();function Ct(nt){binding_callbacks[nt?"unshift":"push"](()=>{Z=nt,M(8,Z)})}function Et(nt){binding_callbacks[nt?"unshift":"push"](()=>{ne=nt,M(9,ne)})}function xt(nt){binding_callbacks[nt?"unshift":"push"](()=>{te=nt,M(7,te)})}function Tt(nt){binding_callbacks[nt?"unshift":"push"](()=>{te=nt,M(7,te)})}const At=()=>window.scrollTo(0,0);return q.$$set=nt=>{"url"in nt&&M(3,$=nt.url),"data"in nt&&M(4,j=nt.data),"scale"in nt&&M(1,z=nt.scale),"pageNum"in nt&&M(0,V=nt.pageNum),"flipTime"in nt&&M(28,X=nt.flipTime),"showButtons"in nt&&M(5,G=nt.showButtons),"showBorder"in nt&&M(6,Y=nt.showBorder),"totalPage"in nt&&M(2,Q=nt.totalPage),"downloadFileName"in nt&&M(29,ee=nt.downloadFileName)},q.$$.update=()=>{q.$$.dirty[0]&1073741825&&De&&Ae(V)},[V,z,Q,$,j,G,Y,te,Z,ne,ce,ae,ge,pe,ye,_e,Ne,Ie,Me,Ee,Te,Be,Xe,ze,Oe,Pe,be,Ce,X,ee,De,Le,je,Ve,ot,lt,me,We,Ye,Fe,xe,$e,Je,ut,qe,Ge,Ke,et,ct,mt,_t,Ct,Et,xt,Tt,At]}class PdfViewer extends SvelteComponent{constructor(_){super(),init(this,_,instance$u,create_fragment$z,safe_not_equal,{url:3,data:4,scale:1,pageNum:0,flipTime:28,showButtons:5,showBorder:6,totalPage:2,downloadFileName:29},null,[-1,-1,-1])}}const GetAttachment_svelte_svelte_type_style_lang="";function create_if_block$p(q){let _,M,$,j={ctx:q,current:null,token:null,hasCatch:!1,pending:create_pending_block,then:create_then_block,catch:create_catch_block,value:13,blocks:[,,,]};return handle_promise(M=q[4],j),{c(){_=empty(),j.block.c()},m(z,V){insert(z,_,V),j.block.m(z,j.anchor=V),j.mount=()=>_.parentNode,j.anchor=_,$=!0},p(z,V){q=z,j.ctx=q,V&16&&M!==(M=q[4])&&handle_promise(M,j)||update_await_block_branch(j,q,V)},i(z){$||(transition_in(j.block),$=!0)},o(z){for(let V=0;V<3;V+=1){const X=j.blocks[V];transition_out(X)}$=!1},d(z){z&&detach(_),j.block.d(z),j.token=null,j=null}}}function create_catch_block(q){return{c:noop,m:noop,p:noop,i:noop,o:noop,d:noop}}function create_then_block(q){let _,M,$,j=!q[2]&&create_if_block_3$9(q),z=q[3]!==void 0&&q[1]!=="true"&&create_if_block_1$g(q);return{c(){_=element("div"),j&&j.c(),M=space(),z&&z.c(),attr(_,"class","flex flex-row mb-4 flex-wrap")},m(V,X){insert(V,_,X),j&&j.m(_,null),append(_,M),z&&z.m(_,null),$=!0},p(V,X){V[2]?j&&(group_outros(),transition_out(j,1,1,()=>{j=null}),check_outros()):j?(j.p(V,X),X&4&&transition_in(j,1)):(j=create_if_block_3$9(V),j.c(),transition_in(j,1),j.m(_,M)),V[3]!==void 0&&V[1]!=="true"?z?z.p(V,X):(z=create_if_block_1$g(V),z.c(),z.m(_,null)):z&&(z.d(1),z=null)},i(V){$||(transition_in(j),$=!0)},o(V){transition_out(j),$=!1},d(V){V&&detach(_),j&&j.d(),z&&z.d()}}}function create_if_block_3$9(q){let _,M,$,j,z;const V=[create_if_block_4$5,create_if_block_5$2,create_if_block_6$2,create_if_block_7$2,create_if_block_8$1,create_else_block$7],X=[];function G(Y,Q){return Y[6]=="image"?0:Y[6]=="text"?1:Y[6]=="audio"?2:Y[6]=="markdown"?3:Y[6]=="pdf"?4:5}return $=G(q),j=X[$]=V[$](q),{c(){_=element("div"),M=element("div"),j.c(),attr(M,"class","mt-2"),attr(_,"class","flex flex-col justify-between h-auto")},m(Y,Q){insert(Y,_,Q),append(_,M),X[$].m(M,null),z=!0},p(Y,Q){let ee=$;$=G(Y),$===ee?X[$].p(Y,Q):(group_outros(),transition_out(X[ee],1,1,()=>{X[ee]=null}),check_outros(),j=X[$],j?j.p(Y,Q):(j=X[$]=V[$](Y),j.c()),transition_in(j,1),j.m(M,null))},i(Y){z||(transition_in(j),z=!0)},o(Y){transition_out(j),z=!1},d(Y){Y&&detach(_),X[$].d()}}}function create_else_block$7(q){let _;return{c(){_=element("p"),_.textContent="Attachment type not supported"},m(M,$){insert(M,_,$)},p:noop,i:noop,o:noop,d(M){M&&detach(_)}}}function create_if_block_8$1(q){let _,M,$;return M=new PdfViewer({props:{url:q[13],showButtons:["navigation","pageInfo"],showBorder:!1}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","pdfViewer svelte-1un3rdf")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&16&&(V.url=j[13]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_7$2(q){let _,M,$;return M=new SvelteMarkdown({props:{source:q[13]}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","markdown svelte-1un3rdf")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&16&&(V.source=j[13]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_6$2(q){let _,M,$;return{c(){_=element("div"),M=element("audio"),src_url_equal(M.src,$=q[13])||attr(M,"src",$),M.controls=!0,attr(M,"class","svelte-1un3rdf"),attr(_,"class","w-auto")},m(j,z){insert(j,_,z),append(_,M)},p(j,z){z&16&&!src_url_equal(M.src,$=j[13])&&attr(M,"src",$)},i:noop,o:noop,d(j){j&&detach(_)}}}function create_if_block_5$2(q){let _,M=q[13]+"";return{c(){_=element("p"),attr(_,"class","my-6 textbox svelte-1un3rdf")},m($,j){insert($,_,j),_.innerHTML=M},p($,j){j&16&&M!==(M=$[13]+"")&&(_.innerHTML=M)},i:noop,o:noop,d($){$&&detach(_)}}}function create_if_block_4$5(q){let _,M,$;return{c(){_=element("img"),src_url_equal(_.src,M=q[13])||attr(_,"src",M),attr(_,"alt",$=q[0].text),attr(_,"class","svelte-1un3rdf")},m(j,z){insert(j,_,z)},p(j,z){z&16&&!src_url_equal(_.src,M=j[13])&&attr(_,"src",M),z&1&&$!==($=j[0].text)&&attr(_,"alt",$)},i:noop,o:noop,d(j){j&&detach(_)}}}function create_if_block_1$g(q){let _,M,$=!q[5]&&create_if_block_2$d(q);return{c(){_=element("div"),M=element("p"),$&&$.c(),attr(M,"class","mx-4"),attr(_,"class","flex flex-row mb-4 items-end pb-8")},m(j,z){insert(j,_,z),append(_,M),$&&$.m(M,null)},p(j,z){j[5]?$&&($.d(1),$=null):$?$.p(j,z):($=create_if_block_2$d(j),$.c(),$.m(M,null))},d(j){j&&detach(_),$&&$.d()}}}function create_if_block_2$d(q){let _,M,$;return{c(){_=element("button"),_.textContent="Get attachment",attr(_,"class","svelte-1un3rdf")},m(j,z){insert(j,_,z),M||($=listen(_,"click",function(){is_function(q[7](q[0]))&&q[7](q[0]).apply(this,arguments)}),M=!0)},p(j,z){q=j},d(j){j&&detach(_),M=!1,$()}}}function create_pending_block(q){let _;return{c(){_=text("Loading attachment...")},m(M,$){insert(M,_,$)},p:noop,i:noop,o:noop,d(M){M&&detach(_)}}}function create_fragment$y(q){let _,M,$=create_if_block$p(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,[z]){$.p(j,z)},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function instance$t(q,_,M){let $;component_subscribe(q,replicaDetails,ne=>M(10,$=ne));let{doc:j}=_,{replies:z}=_,V,X,G=!1,Y=!0,Q,ee;async function te(ne){const re=await $.replica.getAttachment(ne);let se=ne.path.split(".").pop();if(re!==void 0){console.log("fileExtension",se);const ue=await re.bytes();console.log("docdata",ue);let ce=new Uint8Array(ue.length);for(var ie=0;ie<ue.length;ie++)ce[ie]=ue[ie];if(se==="md")M(6,Q="markdown"),M(6,Q),M(3,V=String.fromCharCode(...ce));else if(se=="mp3"||se=="ogg"||se=="webm")M(6,Q="audio"),ee="audio/"+se,M(6,Q),ee=ee,console.log("this is audio"),console.log(Q,ee),M(3,V=URL.createObjectURL(new Blob([ce],{type:ee})));else if(se==="txt"){M(6,Q="text"),M(6,Q),console.log(Q);var oe=new TextDecoder("utf-8");M(3,V=oe.decode(Uint8Array.from(ce)))}else se=="png"||se=="gif"||se=="jpeg"?(M(6,Q="image"),console.log("this is an image"),console.log("fileExtension "+se),ee="image/"+se,M(6,Q),ee=ee,M(3,V=URL.createObjectURL(new Blob([ce],{type:ee})))):se==="pdf"?(M(6,Q="pdf"),M(3,V=URL.createObjectURL(new Blob([ce],{type:"application/pdf"})))):(M(6,Q="other"),M(6,Q),console.log(Q),M(3,V=URL.createObjectURL(new Blob([ce],{type:"application/octet-stream"}))));return V}}function Z(ne){M(4,X=te(ne)),M(5,G=!0),M(2,Y=!1)}return q.$$set=ne=>{"doc"in ne&&M(0,j=ne.doc),"replies"in ne&&M(1,z=ne.replies)},q.$$.update=()=>{q.$$.dirty&1&&j&&(M(4,X=te(j)),M(5,G=!0),M(2,Y=!1)),q.$$.dirty&4,q.$$.dirty&1&&console.log("selectedDoc in GetAttachment",j)},[j,z,Y,V,X,G,Q,Z]}class GetAttachment extends SvelteComponent{constructor(_){super(),init(this,_,instance$t,create_fragment$y,safe_not_equal,{doc:0,replies:1})}}const Ephemerality_svelte_svelte_type_style_lang="";function create_if_block$o(q){let _,M,$,j,z,V,X,G=Math.trunc(q[2])+"",Y,Q,ee=q[2]<=1?"minute":"minutes",te,Z,ne,re,se=Math.trunc((q[3]/1e3-(q[0]*1e3+q[4]))/6e4)+"",ie,oe,ue,ce,ae,le;return{c(){_=element("div"),M=element("button"),M.textContent="Extend",$=space(),j=element("button"),j.textContent="Shorten",z=space(),V=element("p"),X=text("last interaction was "),Y=text(G),Q=space(),te=text(ee),Z=text(" ago"),ne=space(),re=element("p"),ie=text(se),oe=text(" minutes left until deletion"),ue=space(),ce=element("button"),ce.textContent="Delete",attr(M,"class","svelte-mmxx8s"),attr(j,"class","svelte-mmxx8s"),attr(V,"class","svelte-mmxx8s"),attr(re,"class","svelte-mmxx8s"),attr(ce,"class","svelte-mmxx8s"),attr(_,"id","flexcontainer"),attr(_,"class","svelte-mmxx8s")},m(he,ge){insert(he,_,ge),append(_,M),append(_,$),append(_,j),append(_,z),append(_,V),append(V,X),append(V,Y),append(V,Q),append(V,te),append(V,Z),append(_,ne),append(_,re),append(re,ie),append(re,oe),append(_,ue),append(_,ce),ae||(le=[listen(M,"click",q[5]),listen(j,"click",q[6]),listen(ce,"click",q[10])],ae=!0)},p(he,ge){ge&4&&G!==(G=Math.trunc(he[2])+"")&&set_data(Y,G),ge&4&&ee!==(ee=he[2]<=1?"minute":"minutes")&&set_data(te,ee),ge&9&&se!==(se=Math.trunc((he[3]/1e3-(he[0]*1e3+he[4]))/6e4)+"")&&set_data(ie,se)},d(he){he&&detach(_),ae=!1,run_all(le)}}}function create_fragment$x(q){let _,M=q[1]?"Ephemeral":"Ephemeral",$,j,z,V,X,G=q[1]&&create_if_block$o(q);return{c(){_=element("button"),$=text(M),j=space(),G&&G.c(),z=empty(),attr(_,"class","svelte-mmxx8s")},m(Y,Q){insert(Y,_,Q),append(_,$),insert(Y,j,Q),G&&G.m(Y,Q),insert(Y,z,Q),V||(X=listen(_,"click",q[9]),V=!0)},p(Y,[Q]){Q&2&&M!==(M=Y[1]?"Ephemeral":"Ephemeral")&&set_data($,M),Y[1]?G?G.p(Y,Q):(G=create_if_block$o(Y),G.c(),G.m(z.parentNode,z)):G&&(G.d(1),G=null)},i:noop,o:noop,d(Y){Y&&detach(_),Y&&detach(j),G&&G.d(Y),Y&&detach(z),V=!1,X()}}}function instance$s(q,_,M){let $,j,z;component_subscribe(q,elapsed,ie=>M(0,$=ie)),component_subscribe(q,authorKeypair,ie=>M(11,j=ie)),component_subscribe(q,replicaDetails,ie=>M(12,z=ie));const V=createEventDispatcher();let X=Date.now(),G=!1,Y=0,{doc:Q}=_,ee=Q.deleteAfter;async function te(){M(3,ee+=36e8);let ie=j.address.slice(1,5),oe=Q.path.split("!"),ue=oe[0].replace("/documents","/studio")+oe[1];const ce=await z.replica.set(j,{text:Q.text+"<br> lifespan extended by "+ie+" on "+new Date().toLocaleString(),path:Q.path,deleteAfter:ee}),ae=await z.replica.set(j,{text:Q.text+"<br> lifespan extended by "+ie+" on "+new Date().toLocaleString(),path:ue});console.log("studioPath",ue),console.log("doc.path",Q.path),console.log("result c",ce),console.log("result s",ae)}async function Z(){let ie=j.address.slice(1,5),oe=Q.path.split("!"),ue=oe[0].replace("/documents","/studio")+oe[1];console.log("studioPath",ue),M(3,ee-=864e8);const ce=await z.replica.set(j,{text:Q.text+"<br> lifespan shortened by "+ie+" on "+new Date().toLocaleString(),path:Q.path,deleteAfter:ee}),ae=await z.replica.set(j,{text:Q.text+"<br> lifespan shortened by "+ie+" on "+new Date().toLocaleString(),path:ue});console.log("result c",ce),console.log("result s",ae)}async function ne(){V("update");let ie=j.address.slice(1,5),oe=Q.path.split("!"),ue=oe[0].replace("/documents","/studio")+oe[1];const ce=await z.replica.set(j,{path:Q.path,deleteAfter:(Date.now()+1e3)*1e3}),ae=await z.replica.set(j,{text:Q.text+"<br> deleted by "+ie+" on "+new Date().toLocaleString(),path:ue});console.log("studio 'delete'",ae),console.log("result delete",ce)}const re=()=>M(1,G=!G),se=()=>ne();return q.$$set=ie=>{"doc"in ie&&M(8,Q=ie.doc)},q.$$.update=()=>{q.$$.dirty&257&&M(2,Y=($+X/1e3-Q.timestamp/1e6)/60)},[$,G,Y,ee,X,te,Z,ne,Q,re,se]}class Ephemerality extends SvelteComponent{constructor(_){super(),init(this,_,instance$s,create_fragment$x,safe_not_equal,{doc:8})}}function splitTitleAndNotes(q){let _="",M="";const $=q.split("#Title:");if($[1]!==void 0){const j=$[1].split("#Notes:");_=j[0].trim(),j[1]!==void 0&&(M=j[1].trim())}return{title:_,notes:M}}const DocDetails_svelte_svelte_type_style_lang="";function create_else_block_1$4(q){let _;return{c(){_=text("Show details")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_4$4(q){let _;return{c(){_=text("Hide details")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block$n(q){let _,M,$,j,z,V,X,G,Y=q[0].path+"",Q,ee,te,Z,ne,re=q[0].author+"",se,ie,oe,ue,ce,ae=q[0].share+"",le,he,ge,de,pe,ye=q[0].timestamp/1e3+"",_e,De=q[1]&&create_if_block_3$8(q);function fe(Ee,Te){return Ee[3]!==void 0?create_if_block_1$f:create_else_block$6}let Ae=fe(q),Me=Ae(q);return{c(){_=element("div"),De&&De.c(),M=space(),Me.c(),$=space(),j=element("div"),z=element("ul"),V=element("li"),X=element("b"),X.textContent="path:",G=space(),Q=text(Y),ee=space(),te=element("li"),Z=element("b"),Z.textContent="author:",ne=space(),se=text(re),ie=space(),oe=element("li"),ue=element("b"),ue.textContent="share:",ce=space(),le=text(ae),he=space(),ge=element("li"),de=element("b"),de.textContent="timestamp:",pe=space(),_e=text(ye),attr(V,"class","svelte-1ob97v4"),attr(te,"class","svelte-1ob97v4"),attr(oe,"class","svelte-1ob97v4"),attr(ge,"class","svelte-1ob97v4"),attr(z,"class","svelte-1ob97v4"),attr(j,"class","my-4 break-all svelte-1ob97v4"),attr(_,"class","svelte-1ob97v4")},m(Ee,Te){insert(Ee,_,Te),De&&De.m(_,null),append(_,M),Me.m(_,null),append(_,$),append(_,j),append(j,z),append(z,V),append(V,X),append(V,G),append(V,Q),append(z,ee),append(z,te),append(te,Z),append(te,ne),append(te,se),append(z,ie),append(z,oe),append(oe,ue),append(oe,ce),append(oe,le),append(z,he),append(z,ge),append(ge,de),append(ge,pe),append(ge,_e)},p(Ee,Te){Ee[1]?De?De.p(Ee,Te):(De=create_if_block_3$8(Ee),De.c(),De.m(_,M)):De&&(De.d(1),De=null),Ae===(Ae=fe(Ee))&&Me?Me.p(Ee,Te):(Me.d(1),Me=Ae(Ee),Me&&(Me.c(),Me.m(_,$))),Te&1&&Y!==(Y=Ee[0].path+"")&&set_data(Q,Y),Te&1&&re!==(re=Ee[0].author+"")&&set_data(se,re),Te&1&&ae!==(ae=Ee[0].share+"")&&set_data(le,ae),Te&1&&ye!==(ye=Ee[0].timestamp/1e3+"")&&set_data(_e,ye)},d(Ee){Ee&&detach(_),De&&De.d(),Me.d()}}}function create_if_block_3$8(q){let _,M,$,j,z,V,X=q[0].path.split(".")[q[0].path.split(".").length-1]+"",G,Y,Q,ee,te,Z,ne=q[0].attachmentSize/1e3+"",re,se;return{c(){_=element("table"),M=element("tr"),$=element("td"),$.textContent="Attachment type:",j=space(),z=element("td"),V=element("strong"),G=text(X),Y=space(),Q=element("tr"),ee=element("td"),ee.textContent="Attachment size:",te=space(),Z=element("td"),re=text(ne),se=text(" kb"),attr(_,"class","my-4 svelte-1ob97v4")},m(ie,oe){insert(ie,_,oe),append(_,M),append(M,$),append(M,j),append(M,z),append(z,V),append(V,G),append(_,Y),append(_,Q),append(Q,ee),append(Q,te),append(Q,Z),append(Z,re),append(Q,se)},p(ie,oe){oe&1&&X!==(X=ie[0].path.split(".")[ie[0].path.split(".").length-1]+"")&&set_data(G,X),oe&1&&ne!==(ne=ie[0].attachmentSize/1e3+"")&&set_data(re,ne)},d(ie){ie&&detach(_)}}}function create_else_block$6(q){let _;return{c(){_=element("div"),attr(_,"class","my-4 break-words")},m(M,$){insert(M,_,$),_.innerHTML=q[4]},p(M,$){$&16&&(_.innerHTML=M[4])},d(M){M&&detach(_)}}}function create_if_block_1$f(q){let _,M,$;return{c(){_=element("div"),M=space(),$=empty()},m(j,z){insert(j,_,z),_.innerHTML=q[3],insert(j,M,z),insert(j,$,z)},p(j,z){z&8&&(_.innerHTML=j[3])},d(j){j&&detach(_),j&&detach(M),j&&detach($)}}}function create_fragment$w(q){let _,M,$,j,z;function V(Q,ee){return Q[2]?create_if_block_4$4:create_else_block_1$4}let X=V(q),G=X(q),Y=q[2]&&create_if_block$n(q);return{c(){_=element("div"),M=element("button"),G.c(),$=space(),Y&&Y.c(),attr(_,"class","my-4 text-left svelte-1ob97v4")},m(Q,ee){insert(Q,_,ee),append(_,M),G.m(M,null),append(_,$),Y&&Y.m(_,null),j||(z=listen(M,"click",q[8]),j=!0)},p(Q,[ee]){X!==(X=V(Q))&&(G.d(1),G=X(Q),G&&(G.c(),G.m(M,null))),Q[2]?Y?Y.p(Q,ee):(Y=create_if_block$n(Q),Y.c(),Y.m(_,null)):Y&&(Y.d(1),Y=null)},i:noop,o:noop,d(Q){Q&&detach(_),G.d(),Y&&Y.d(),j=!1,z()}}}function instance$r(q,_,M){let{doc:$}=_,{attachment:j=!0}=_,{isReply:z=!1}=_,V=!1,X,G,Y,Q;onMount(()=>{M(2,V=!0)});const ee=()=>M(2,V=!V);return q.$$set=te=>{"doc"in te&&M(0,$=te.doc),"attachment"in te&&M(1,j=te.attachment),"isReply"in te&&M(6,z=te.isReply)},q.$$.update=()=>{q.$$.dirty&129&&$.text!==void 0&&(M(7,Y=splitTitleAndNotes($.text)),M(3,X=Y.title),M(4,G=Y.notes))},[$,j,V,X,G,Q,z,Y,ee]}class DocDetails extends SvelteComponent{constructor(_){super(),init(this,_,instance$r,create_fragment$w,safe_not_equal,{doc:0,attachment:1,isReply:6})}}const SingleDoc_svelte_svelte_type_style_lang="";function create_else_block$5(q){let _,M,$,j,z,V=!q[9]&&create_if_block_5$1(q),X=q[9]&&create_if_block_1$e(q);return{c(){_=element("div"),V&&V.c(),M=space(),X&&X.c(),attr(_,"class","main svelte-tithd8"),toggle_class(_,"replies",q[5]===!0)},m(G,Y){insert(G,_,Y),V&&V.m(_,null),append(_,M),X&&X.m(_,null),$=!0,j||(z=[listen(_,"click",self$1(q[18])),listen(_,"keypress",self$1(q[19]))],j=!0)},p(G,Y){G[9]?V&&(group_outros(),transition_out(V,1,1,()=>{V=null}),check_outros()):V?(V.p(G,Y),Y&512&&transition_in(V,1)):(V=create_if_block_5$1(G),V.c(),transition_in(V,1),V.m(_,M)),G[9]?X?(X.p(G,Y),Y&512&&transition_in(X,1)):(X=create_if_block_1$e(G),X.c(),transition_in(X,1),X.m(_,null)):X&&(group_outros(),transition_out(X,1,1,()=>{X=null}),check_outros()),(!$||Y&32)&&toggle_class(_,"replies",G[5]===!0)},i(G){$||(transition_in(V),transition_in(X),$=!0)},o(G){transition_out(V),transition_out(X),$=!1},d(G){G&&detach(_),V&&V.d(),X&&X.d(),j=!1,run_all(z)}}}function create_if_block$m(q){let _;return{c(){_=element("div"),attr(_,"class","main disabled svelte-tithd8"),toggle_class(_,"replies",q[5]===!0)},m(M,$){insert(M,_,$)},p(M,$){$&32&&toggle_class(_,"replies",M[5]===!0)},i:noop,o:noop,d(M){M&&detach(_)}}}function create_if_block_5$1(q){let _,M,$,j,z,V,X=q[0]!==void 0&&create_if_block_6$1(q);return{c(){_=element("div"),M=element("p"),$=space(),X&&X.c(),attr(M,"class","svelte-tithd8"),attr(_,"class","flex flex-col svelte-tithd8")},m(G,Y){insert(G,_,Y),append(_,M),append(_,$),X&&X.m(_,null),j=!0,z||(V=[listen(M,"click",q[13]),listen(M,"keypress",q[14])],z=!0)},p(G,Y){G[0]!==void 0?X?(X.p(G,Y),Y&1&&transition_in(X,1)):(X=create_if_block_6$1(G),X.c(),transition_in(X,1),X.m(_,null)):X&&(group_outros(),transition_out(X,1,1,()=>{X=null}),check_outros())},i(G){j||(transition_in(X),j=!0)},o(G){transition_out(X),j=!1},d(G){G&&detach(_),X&&X.d(),z=!1,run_all(V)}}}function create_if_block_6$1(q){let _,M,$,j,z=q[3]&&create_if_block_7$1(q);return{c(){_=element("div"),M=space(),z&&z.c(),$=empty(),attr(_,"class","svelte-tithd8")},m(V,X){insert(V,_,X),_.innerHTML=q[0],insert(V,M,X),z&&z.m(V,X),insert(V,$,X),j=!0},p(V,X){(!j||X&1)&&(_.innerHTML=V[0]),V[3]?z?(z.p(V,X),X&8&&transition_in(z,1)):(z=create_if_block_7$1(V),z.c(),transition_in(z,1),z.m($.parentNode,$)):z&&(group_outros(),transition_out(z,1,1,()=>{z=null}),check_outros())},i(V){j||(transition_in(z),j=!0)},o(V){transition_out(z),j=!1},d(V){V&&detach(_),V&&detach(M),z&&z.d(V),V&&detach($)}}}function create_if_block_7$1(q){let _,M,$;return M=new GetAttachment({props:{doc:q[1],replies:"true"}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","svelte-tithd8")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&2&&(V.doc=j[1]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_1$e(q){let _,M,$,j,z,V,X,G,Y,Q,ee,te,Z,ne,re=q[3]&&create_if_block_4$3(q);Y=new DocDetails({props:{doc:q[1],attachment:q[3],isReply:q[5]}});let se=q[4]&&create_if_block_3$7(q),ie=!q[2]&&create_if_block_2$c(q);return{c(){_=element("div"),M=element("button"),$=element("img"),z=text(`
            Artifact`),V=space(),re&&re.c(),X=space(),G=element("div"),create_component(Y.$$.fragment),Q=space(),se&&se.c(),ee=space(),ie&&ie.c(),set_style($,"margin-bottom","-3px"),src_url_equal($.src,j=q[11][q[8]])||attr($,"src",j),attr($,"alt","document icon"),attr($,"width",q[7]),attr($,"height",q[7]),attr($,"class","svelte-tithd8"),attr(M,"class","svelte-tithd8"),attr(G,"class","svelte-tithd8"),attr(_,"class","flex svelte-tithd8")},m(oe,ue){insert(oe,_,ue),append(_,M),append(M,$),append(M,z),append(_,V),re&&re.m(_,null),append(_,X),append(_,G),mount_component(Y,G,null),append(_,Q),se&&se.m(_,null),append(_,ee),ie&&ie.m(_,null),te=!0,Z||(ne=[listen(M,"click",q[15]),listen(M,"keypress",self$1(q[16]))],Z=!0)},p(oe,ue){(!te||ue&256&&!src_url_equal($.src,j=oe[11][oe[8]]))&&attr($,"src",j),(!te||ue&128)&&attr($,"width",oe[7]),(!te||ue&128)&&attr($,"height",oe[7]),oe[3]?re?(re.p(oe,ue),ue&8&&transition_in(re,1)):(re=create_if_block_4$3(oe),re.c(),transition_in(re,1),re.m(_,X)):re&&(group_outros(),transition_out(re,1,1,()=>{re=null}),check_outros());const ce={};ue&2&&(ce.doc=oe[1]),ue&8&&(ce.attachment=oe[3]),ue&32&&(ce.isReply=oe[5]),Y.$set(ce),oe[4]?se?(se.p(oe,ue),ue&16&&transition_in(se,1)):(se=create_if_block_3$7(oe),se.c(),transition_in(se,1),se.m(_,ee)):se&&(group_outros(),transition_out(se,1,1,()=>{se=null}),check_outros()),oe[2]?ie&&(group_outros(),transition_out(ie,1,1,()=>{ie=null}),check_outros()):ie?(ie.p(oe,ue),ue&4&&transition_in(ie,1)):(ie=create_if_block_2$c(oe),ie.c(),transition_in(ie,1),ie.m(_,null))},i(oe){te||(transition_in(re),transition_in(Y.$$.fragment,oe),transition_in(se),transition_in(ie),te=!0)},o(oe){transition_out(re),transition_out(Y.$$.fragment,oe),transition_out(se),transition_out(ie),te=!1},d(oe){oe&&detach(_),re&&re.d(),destroy_component(Y),se&&se.d(),ie&&ie.d(),Z=!1,run_all(ne)}}}function create_if_block_4$3(q){let _,M,$;return M=new GetAttachment({props:{doc:q[1],replies:"true"}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","svelte-tithd8")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&2&&(V.doc=j[1]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_3$7(q){let _,M,$;return M=new Reply({props:{doc:q[1]}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","svelte-tithd8")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&2&&(V.doc=j[1]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_2$c(q){let _,M,$;return M=new Ephemerality({props:{doc:q[1]}}),M.$on("update",q[17]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","svelte-tithd8")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&2&&(V.doc=j[1]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_fragment$v(q){let _,M,$,j;const z=[create_if_block$m,create_else_block$5],V=[];function X(G,Y){return G[6]?0:1}return _=X(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(G,Y){V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,[Y]){let Q=_;_=X(G),_===Q?V[_].p(G,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){V[_].d(G),G&&detach($)}}}function instance$q(q,_,M){const $=createEventDispatcher();let j=["icons/mountain-phase-0-02.png","icons/mountain-phase-1-02.png","icons/mountain-phase-2-02.png","icons/mountain-phase-3-02.png","icons/mountain-phase-4-02.png","icons/mountain-phase-5-02.png","icons/mountain-phase-6-02.png","icons/mountain-phase-7-02.png","icons/mountain-phase-8-02.png"],z=!1,{doc:V}=_,{studio:X=!1}=_,{attachment:G=!0}=_,{reply:Y=!0}=_,{title:Q=void 0}=_,{isReply:ee=!1}=_,{disabled:te=!1}=_,Z=V.deleteAfter,ne,re=24,se;const ie=()=>{M(9,z=!z),$("click",V)},oe=()=>M(9,z=!z),ue=()=>M(9,z=!z),ce=()=>M(9,z=!z);function ae(ge){bubble.call(this,q,ge)}const le=()=>{$("click",V)},he=()=>M(9,z=!z);return q.$$set=ge=>{"doc"in ge&&M(1,V=ge.doc),"studio"in ge&&M(2,X=ge.studio),"attachment"in ge&&M(3,G=ge.attachment),"reply"in ge&&M(4,Y=ge.reply),"title"in ge&&M(0,Q=ge.title),"isReply"in ge&&M(5,ee=ge.isReply),"disabled"in ge&&M(6,te=ge.disabled)},q.$$.update=()=>{q.$$.dirty&258&&console.log(V.path+"phase "+se),q.$$.dirty&4131&&(Q!==void 0&&Q.includes("<br>")?(M(12,ne=Q.split("<br>")),M(0,Q=ne.shift()),M(0,Q),M(12,ne),M(1,V),M(5,ee),console.log("content",ne),M(7,re=ne.length*2+12)):V.text.includes("<br>")?(M(12,ne=V.text.split("<br>")),M(7,re=ne.length*3+8)):ee&&M(7,re=10)),q.$$.dirty&128&&console.log("reaction",re)},console.log("deletionTime"+Z),M(8,se=Math.floor((Z-Date.now())/(25488e8/9))%9),[Q,V,X,G,Y,ee,te,re,se,z,$,j,ne,ie,oe,ue,ce,ae,le,he]}class SingleDoc extends SvelteComponent{constructor(_){super(),init(this,_,instance$q,create_fragment$v,safe_not_equal,{doc:1,studio:2,attachment:3,reply:4,title:0,isReply:5,disabled:6})}}const ShowReply_svelte_svelte_type_style_lang="";function get_each_context$9(q,_,M){const $=q.slice();return $[0]=_[M],$}function create_if_block_2$b(q){let _,M=[],$=new Map,j,z=q[1];const V=X=>X[0].signature;for(let X=0;X<z.length;X+=1){let G=get_each_context$9(q,z,X),Y=V(G);$.set(Y,M[X]=create_each_block$9(Y,G))}return{c(){_=element("ul");for(let X=0;X<M.length;X+=1)M[X].c();attr(_,"class","svelte-zu5h6d")},m(X,G){insert(X,_,G);for(let Y=0;Y<M.length;Y+=1)M[Y].m(_,null);j=!0},p(X,G){G&34&&(z=X[1],group_outros(),M=update_keyed_each(M,G,V,1,X,z,$,_,outro_and_destroy_block,create_each_block$9,null,get_each_context$9),check_outros())},i(X){if(!j){for(let G=0;G<z.length;G+=1)transition_in(M[G]);j=!0}},o(X){for(let G=0;G<M.length;G+=1)transition_out(M[G]);j=!1},d(X){X&&detach(_);for(let G=0;G<M.length;G+=1)M[G].d()}}}function create_if_block_1$d(q){let _=q[4]()+"",M;return{c(){M=text(_)},m($,j){insert($,M,j)},p:noop,i:noop,o:noop,d($){$&&detach(M)}}}function create_else_block_1$3(q){let _,M;return _=new SingleDoc({props:{isReply:!0,title:q[0].text,doc:q[0],attachment:!1,reply:!1}}),_.$on("click",q[5]),_.$on("update",q[5]),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.title=$[0].text),j&2&&(z.doc=$[0]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block_3$6(q){let _,M;return _=new SingleDoc({props:{isReply:!0,title:q[0].text,doc:q[0],attachment:!0,reply:!1}}),_.$on("click",q[5]),_.$on("update",q[5]),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.title=$[0].text),j&2&&(z.doc=$[0]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_each_block$9(q,_){let M,$,j,z,V,X,G;const Y=[create_if_block_3$6,create_else_block_1$3],Q=[];function ee(te,Z){return Z&2&&($=null),$==null&&($=!!te[0].text.includes("replied with voice")),$?0:1}return j=ee(_,-1),z=Q[j]=Y[j](_),{key:q,first:null,c(){M=element("li"),z.c(),V=space(),attr(M,"id",X=_[0].textHash),attr(M,"class","svelte-zu5h6d"),this.first=M},m(te,Z){insert(te,M,Z),Q[j].m(M,null),append(M,V),G=!0},p(te,Z){_=te;let ne=j;j=ee(_,Z),j===ne?Q[j].p(_,Z):(group_outros(),transition_out(Q[ne],1,1,()=>{Q[ne]=null}),check_outros(),z=Q[j],z?z.p(_,Z):(z=Q[j]=Y[j](_),z.c()),transition_in(z,1),z.m(M,V)),(!G||Z&2&&X!==(X=_[0].textHash))&&attr(M,"id",X)},i(te){G||(transition_in(z),G=!0)},o(te){transition_out(z),G=!1},d(te){te&&detach(M),Q[j].d()}}}function create_else_block$4(q){return{c:noop,m:noop,d:noop}}function create_if_block$l(q){let _;return{c(){_=element("p"),_.textContent="There are no replies yet.",attr(_,"class","max-content svelte-zu5h6d")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_fragment$u(q){let _,M,$,j,z,V;const X=[create_if_block_1$d,create_if_block_2$b],G=[];function Y(Z,ne){return Z[1]===void 0?0:Z[2]?1:-1}~(M=Y(q))&&($=G[M]=X[M](q));function Q(Z,ne){return Z[3]?create_if_block$l:create_else_block$4}let ee=Q(q),te=ee(q);return{c(){_=element("div"),$&&$.c(),j=space(),z=element("div"),te.c()},m(Z,ne){insert(Z,_,ne),~M&&G[M].m(_,null),insert(Z,j,ne),insert(Z,z,ne),te.m(z,null),V=!0},p(Z,[ne]){let re=M;M=Y(Z),M===re?~M&&G[M].p(Z,ne):($&&(group_outros(),transition_out(G[re],1,1,()=>{G[re]=null}),check_outros()),~M?($=G[M],$?$.p(Z,ne):($=G[M]=X[M](Z),$.c()),transition_in($,1),$.m(_,null)):$=null),ee!==(ee=Q(Z))&&(te.d(1),te=ee(Z),te&&(te.c(),te.m(z,null)))},i(Z){V||(transition_in($),V=!0)},o(Z){transition_out($),V=!1},d(Z){Z&&detach(_),~M&&G[M].d(),Z&&detach(j),Z&&detach(z),te.d()}}}function instance$p(q,_,M){let $;component_subscribe(q,cacheDetails,Q=>M(6,$=Q));let{doc:j}=_,z=[],V=!0,X=!1;const G=async()=>{let Q=j.path.split("!");M(1,z=await $.queryDocs({filter:{pathStartsWith:Q[0]}})),M(1,z=z.filter(ee=>ee.path.split("/").length>6)),M(2,V=!0)};$.onCacheUpdated(()=>{G(),M(1,z)});function Y(){setTimeout(()=>{G()},1e3)}return onMount(()=>{G()}),q.$$set=Q=>{"doc"in Q&&M(0,j=Q.doc)},q.$$.update=()=>{q.$$.dirty&2&&M(1,z),q.$$.dirty&2&&(z.length>=1?(M(2,V=!0),M(3,X=!1)):M(3,X=!0))},[j,z,V,X,G,Y]}class ShowReply extends SvelteComponent{constructor(_){super(),init(this,_,instance$p,create_fragment$u,safe_not_equal,{doc:0})}}const Voice_svelte_svelte_type_style_lang="";function create_else_block$3(q){let _,M,$,j,z,V,X,G=q[0]!=="reply"&&create_if_block_3$5();function Y(te,Z){return te[2]?create_if_block_2$a:create_else_block_1$2}let Q=Y(q),ee=Q(q);return{c(){_=element("div"),M=element("div"),G&&G.c(),$=space(),j=element("div"),z=element("button"),ee.c(),attr(z,"class","phase1 mt-6 svelte-1n9oqk8"),attr(j,"class","mt-6 svelte-1n9oqk8"),attr(M,"class","svelte-1n9oqk8"),attr(_,"class","text-left svelte-1n9oqk8")},m(te,Z){insert(te,_,Z),append(_,M),G&&G.m(M,null),append(M,$),append(M,j),append(j,z),ee.m(z,null),V||(X=[listen(z,"click",q[10]),listen(z,"keypress",q[11])],V=!0)},p(te,Z){te[0]!=="reply"?G||(G=create_if_block_3$5(),G.c(),G.m(M,$)):G&&(G.d(1),G=null),Q!==(Q=Y(te))&&(ee.d(1),ee=Q(te),ee&&(ee.c(),ee.m(z,null)))},d(te){te&&detach(_),G&&G.d(),ee.d(),V=!1,run_all(X)}}}function create_if_block$k(q){let _,M,$,j,z,V,X,G,Y,Q,ee,te,Z,ne,re,se,ie=!q[1]&&create_if_block_1$c();return{c(){_=element("div"),M=element("h5"),M.textContent="Review your recording",$=space(),j=element("audio"),z=element("source"),X=text(`
            Your browser does not support the audio element.`),G=space(),ie&&ie.c(),Y=space(),Q=element("button"),Q.textContent="Record again",ee=space(),te=element("button"),Z=text("Upload"),attr(M,"class","m-2 svelte-1n9oqk8"),src_url_equal(z.src,V=q[3])||attr(z,"src",V),attr(z,"type","audio/ogg"),j.controls=!0,attr(j,"class","my-6 mx-2 svelte-1n9oqk8"),attr(Q,"class","svelte-1n9oqk8"),te.disabled=ne=!q[1],attr(te,"class","svelte-1n9oqk8"),attr(_,"class","text-left m-2 svelte-1n9oqk8")},m(oe,ue){insert(oe,_,ue),append(_,M),append(_,$),append(_,j),append(j,z),append(j,X),append(_,G),ie&&ie.m(_,null),append(_,Y),append(_,Q),append(_,ee),append(_,te),append(te,Z),re||(se=[listen(Q,"click",q[6]),listen(te,"click",q[5])],re=!0)},p(oe,ue){ue&8&&!src_url_equal(z.src,V=oe[3])&&attr(z,"src",V),oe[1]?ie&&(ie.d(1),ie=null):ie||(ie=create_if_block_1$c(),ie.c(),ie.m(_,Y)),ue&2&&ne!==(ne=!oe[1])&&(te.disabled=ne)},d(oe){oe&&detach(_),ie&&ie.d(),re=!1,run_all(se)}}}function create_if_block_3$5(q){let _,M,$;return{c(){_=element("h5"),_.textContent="Record your voice note",M=space(),$=element("div"),$.textContent="Click the button below to start recording. Click again to stop.",attr(_,"class","m-2 svelte-1n9oqk8"),attr($,"class","svelte-1n9oqk8")},m(j,z){insert(j,_,z),insert(j,M,z),insert(j,$,z)},d(j){j&&detach(_),j&&detach(M),j&&detach($)}}}function create_else_block_1$2(q){let _;return{c(){_=text("Record audio")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_2$a(q){let _;return{c(){_=text("Stop recording")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_1$c(q){let _;return{c(){_=element("div"),_.textContent="The upload button is disabled because a title is required.",attr(_,"class","svelte-1n9oqk8")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_fragment$t(q){let _;function M(z,V){return z[3]?create_if_block$k:create_else_block$3}let $=M(q),j=$(q);return{c(){j.c(),_=empty()},m(z,V){j.m(z,V),insert(z,_,V)},p(z,[V]){$===($=M(z))&&j?j.p(z,V):(j.d(1),j=$(z),j&&(j.c(),j.m(_.parentNode,_)))},i:noop,o:noop,d(z){j.d(z),z&&detach(_)}}}function readBlobAsArrayBuffer(q){return new Promise((_,M)=>{const $=new FileReader;$.onloadend=()=>_($.result),$.onerror=M,$.readAsArrayBuffer(q)})}function instance$o(q,_,M){let $,j,z;component_subscribe(q,authorKeypair,he=>M(15,$=he)),component_subscribe(q,replicaDetails,he=>M(16,j=he)),component_subscribe(q,shareKeypair,he=>M(17,z=he));const V=createEventDispatcher();let X=[],G=null,Y=!1,Q=null,ee=null,te=$.address.slice(1,5),{xy:Z=void 0}=_,{doc:ne=void 0}=_,{title:re=void 0}=_,{notes:se=void 0}=_,{isValid:ie=!0}=_;async function oe(){if(Y){G.stop();let he=G.mimeType;he===""&&(he="audio/ogg; codecs=opus"),console.log("mediaRecorder",G),console.log("mediaRecorder mime",G.mimeType),M(2,Y=!1),G.ondataavailable=ge=>X.push(ge.data),await new Promise(ge=>{G.onstop=function(){ee=new Blob(X,{type:he}),M(3,Q=URL.createObjectURL(ee)),console.log("blob",ee),ge()}})}else{const he=await navigator.mediaDevices.getUserMedia({audio:!0});G=new MediaRecorder(he),G.start(),console.log("mediaRecorder",G),console.log("mediaRecorder mime",G.mimeType),console.log("recording"),M(2,Y=!0)}}async function ue(){let he;se&&re?he=`#Title: ${re}#Notes: ${se}`:re?he=`#Title: ${re}`:he="";let ge=Date.now(),de=new Date().toLocaleString(),pe=(Date.now()+25488e5)*1e3,ye=G.mimeType||"audio/ogg; codecs=opus",De=ye.split(";")[0].split("/")[1];const fe=await readBlobAsArrayBuffer(ee),Ae=new Uint8Array(fe);console.log("mime",ye);let Me=`/documents/${Z[0]}/${Z[1]}/${ge}/!voice-note-by-${te}.${De}`,Ee={path:Me,text:`Voice note shared by ${te} on ${de} ${he}`,attachment:Ae};if(Z=="reply"){const Be=ne.path.split("!");Ee.path=`${Be[0]}${ge}/!reply-by-${te}.${De}`,Ee.text=`${te} replied with voice <br>Shared on ${de}`}console.log("shareKeypair",z),z.shareAddress.includes("commons")?Z=="reply"?Ee.deleteAfter=ne.deleteAfter:(Ee.deleteAfter=pe,console.log("added deleteAfter to doc")):(Ee.path=Me.replace("!",""),console.log("removed ! from path"));const Te=await j.replica.set($,Ee);return console.log("Upload Result: ",Te),V(Z=="reply"?"success":"upload"),X=[],Te}async function ce(){M(3,Q=null),X=[],await oe()}const ae=async()=>{oe()},le=async()=>{oe()};return q.$$set=he=>{"xy"in he&&M(0,Z=he.xy),"doc"in he&&M(7,ne=he.doc),"title"in he&&M(8,re=he.title),"notes"in he&&M(9,se=he.notes),"isValid"in he&&M(1,ie=he.isValid)},q.$$.update=()=>{q.$$.dirty&768&&re&&se&&console.log("title and note",re,se)},[Z,ie,Y,Q,oe,ue,ce,ne,re,se,ae,le]}class Voice extends SvelteComponent{constructor(_){super(),init(this,_,instance$o,create_fragment$t,safe_not_equal,{xy:0,doc:7,title:8,notes:9,isValid:1})}}function create_if_block_2$9(q){let _,M,$,j,z,V,X,G,Y;return{c(){_=element("p"),M=element("textarea"),$=space(),j=element("p"),z=element("button"),V=text("Send Reply"),attr(M,"class","my-2"),attr(M,"placeholder",q[4]),set_style(M,"width","100%"),z.disabled=X=q[5](q[1])},m(Q,ee){insert(Q,_,ee),append(_,M),set_input_value(M,q[1]),insert(Q,$,ee),insert(Q,j,ee),append(j,z),append(z,V),G||(Y=[listen(M,"input",q[10]),listen(z,"click",q[7])],G=!0)},p(Q,ee){ee&16&&attr(M,"placeholder",Q[4]),ee&2&&set_input_value(M,Q[1]),ee&2&&X!==(X=Q[5](Q[1]))&&(z.disabled=X)},d(Q){Q&&detach(_),Q&&detach($),Q&&detach(j),G=!1,run_all(Y)}}}function create_if_block_1$b(q){let _,M;return _=new Voice({props:{xy:"reply",doc:q[0]}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&1&&(z.doc=$[0]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block$j(q){let _;return{c(){_=element("span"),_.textContent=`${q[6].kind}`},m(M,$){insert(M,_,$)},p:noop,d(M){M&&detach(_)}}}function create_fragment$s(q){let _,M,$,j,z,V,X,G,Y,Q,ee,te,Z=q[2]&&create_if_block_2$9(q),ne=q[3]&&create_if_block_1$b(q),re=q[6]&&create_if_block$j(q);return{c(){_=element("div"),M=element("div"),$=element("button"),$.textContent="Text reply",j=space(),z=element("button"),z.textContent="Voice reply",V=space(),Z&&Z.c(),X=space(),ne&&ne.c(),G=space(),Y=element("p"),re&&re.c(),attr($,"class","mb-2")},m(se,ie){insert(se,_,ie),append(_,M),append(M,$),append(M,j),append(M,z),append(_,V),Z&&Z.m(_,null),append(_,X),ne&&ne.m(_,null),append(_,G),append(_,Y),re&&re.m(Y,null),Q=!0,ee||(te=[listen($,"click",q[8]),listen(z,"click",q[9])],ee=!0)},p(se,[ie]){se[2]?Z?Z.p(se,ie):(Z=create_if_block_2$9(se),Z.c(),Z.m(_,X)):Z&&(Z.d(1),Z=null),se[3]?ne?(ne.p(se,ie),ie&8&&transition_in(ne,1)):(ne=create_if_block_1$b(se),ne.c(),transition_in(ne,1),ne.m(_,G)):ne&&(group_outros(),transition_out(ne,1,1,()=>{ne=null}),check_outros()),se[6]&&re.p(se,ie)},i(se){Q||(transition_in(ne),Q=!0)},o(se){transition_out(ne),Q=!1},d(se){se&&detach(_),Z&&Z.d(),ne&&ne.d(),re&&re.d(),ee=!1,run_all(te)}}}function instance$n(q,_,M){let $,j;component_subscribe(q,authorKeypair,ie=>M(12,$=ie)),component_subscribe(q,replicaDetails,ie=>M(13,j=ie));const z=createEventDispatcher();function V(ie){return ie==ee}let X,G=!1,Y=!1,Q="",ee="Type your reply here";Q.length;async function te(){let ie=$.address.slice(1,5),oe=Z.path.split("!"),ue=Z.deleteAfter,ce=Date.now();const ae=await j.replica.set($,{text:ie+" replied: "+Q,path:oe[0]+ce+"/!reply-by-"+ie,deleteAfter:ue});return console.log("result ",ae),z("success"),M(1,Q=""),ae}let{doc:Z}=_;function ne(){M(2,G=!G),M(3,Y=!1)}function re(){M(2,G=!1),M(3,Y=!Y)}function se(){Q=this.value,M(1,Q),M(6,X)}return q.$$set=ie=>{"doc"in ie&&M(0,Z=ie.doc)},q.$$.update=()=>{q.$$.dirty&2&&Q!==void 0&&Q.length},console.log("result",X),[Z,Q,G,Y,ee,V,X,te,ne,re,se]}class SendReply extends SvelteComponent{constructor(_){super(),init(this,_,instance$n,create_fragment$s,safe_not_equal,{doc:0})}}const Reply_svelte_svelte_type_style_lang="";function create_if_block$i(q){let _,M,$,j,z,V;return $=new ShowReply({props:{doc:q[0]}}),$.$on("success",q[1]),z=new SendReply({props:{doc:q[0]}}),z.$on("success",q[2]),{c(){_=element("div"),M=element("div"),create_component($.$$.fragment),j=space(),create_component(z.$$.fragment),attr(M,"class","replies mb-2 svelte-1gwlcd9")},m(X,G){insert(X,_,G),append(_,M),mount_component($,M,null),append(_,j),mount_component(z,_,null),V=!0},p(X,G){const Y={};G&1&&(Y.doc=X[0]),$.$set(Y);const Q={};G&1&&(Q.doc=X[0]),z.$set(Q)},i(X){V||(transition_in($.$$.fragment,X),transition_in(z.$$.fragment,X),V=!0)},o(X){transition_out($.$$.fragment,X),transition_out(z.$$.fragment,X),V=!1},d(X){X&&detach(_),destroy_component($),destroy_component(z)}}}function create_fragment$r(q){let _,M,$=create_if_block$i(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,[z]){$.p(j,z)},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function instance$m(q,_,M){let{doc:$}=_;function j(V){bubble.call(this,q,V)}function z(V){bubble.call(this,q,V)}return q.$$set=V=>{"doc"in V&&M(0,$=V.doc)},[$,j,z]}class Reply extends SvelteComponent{constructor(_){super(),init(this,_,instance$m,create_fragment$r,safe_not_equal,{doc:0})}}const View_svelte_svelte_type_style_lang="";function create_if_block_2$8(q){let _,M,$;return{c(){_=element("div"),M=element("h4"),$=text(q[3]),attr(M,"class","mt-12 p-2"),attr(_,"class","text-left")},m(j,z){insert(j,_,z),append(_,M),append(M,$)},p(j,z){z&8&&set_data($,j[3])},d(j){j&&detach(_)}}}function create_if_block_1$a(q){let _,M,$;return M=new GetAttachment({props:{doc:q[0],replies:"false"}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","attachmentbox svelte-m6taqv")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&1&&(V.doc=j[0]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block$h(q){let _,M,$;return M=new Reply({props:{doc:q[0]}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","mr-12")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&1&&(V.doc=j[0]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_fragment$q(q){let _,M,$,j,z,V,X,G,Y,Q=q[3]&&create_if_block_2$8(q),ee=q[1]&&create_if_block_1$a(q),te=q[2]&&create_if_block$h(q);return{c(){_=element("div"),Q&&Q.c(),M=space(),$=element("div"),ee&&ee.c(),j=space(),te&&te.c(),z=space(),V=element("button"),V.textContent="close",attr($,"class","flex flex-row justify-between w-full"),attr(_,"class","w-full ml-12 mr-8"),attr(V,"class","top-right svelte-m6taqv")},m(Z,ne){insert(Z,_,ne),Q&&Q.m(_,null),append(_,M),append(_,$),ee&&ee.m($,null),append($,j),te&&te.m($,null),insert(Z,z,ne),insert(Z,V,ne),X=!0,G||(Y=listen(V,"click",q[4]),G=!0)},p(Z,[ne]){Z[3]?Q?Q.p(Z,ne):(Q=create_if_block_2$8(Z),Q.c(),Q.m(_,M)):Q&&(Q.d(1),Q=null),Z[1]?ee?(ee.p(Z,ne),ne&2&&transition_in(ee,1)):(ee=create_if_block_1$a(Z),ee.c(),transition_in(ee,1),ee.m($,j)):ee&&(group_outros(),transition_out(ee,1,1,()=>{ee=null}),check_outros()),Z[2]?te?(te.p(Z,ne),ne&4&&transition_in(te,1)):(te=create_if_block$h(Z),te.c(),transition_in(te,1),te.m($,null)):te&&(group_outros(),transition_out(te,1,1,()=>{te=null}),check_outros())},i(Z){X||(transition_in(ee),transition_in(te),X=!0)},o(Z){transition_out(ee),transition_out(te),X=!1},d(Z){Z&&detach(_),Q&&Q.d(),ee&&ee.d(),te&&te.d(),Z&&detach(z),Z&&detach(V),G=!1,Y()}}}function instance$l(q,_,M){const $=createEventDispatcher();let{selectedDocument:j}=_,{attachment:z=!0}=_,{reply:V=!0}=_,X;function G(){$("close")}return q.$$set=Y=>{"selectedDocument"in Y&&M(0,j=Y.selectedDocument),"attachment"in Y&&M(1,z=Y.attachment),"reply"in Y&&M(2,V=Y.reply)},q.$$.update=()=>{q.$$.dirty&1&&j&&(j.text.includes("#Title:")&&j.text.includes("#Notes:")?M(3,X=j.text.split("#Title:")[1].split("#Notes:")[0].trim()):j.text.includes("#Title:")&&!j.text.includes("#Notes:")?M(3,X=j.text.split("#Title:")[1].trim()):M(3,X="")),q.$$.dirty&1&&console.log("selectedDocument in ArtifactView",j)},[j,z,V,X,G]}class View extends SvelteComponent{constructor(_){super(),init(this,_,instance$l,create_fragment$q,safe_not_equal,{selectedDocument:0,attachment:1,reply:2})}}const Icon_svelte_svelte_type_style_lang="";function create_else_block$2(q){let _,M,$,j,z,V,X,G,Y,Q=!q[2]&&create_if_block_1$9(q);return{c(){_=element("div"),M=element("img"),V=space(),Q&&Q.c(),src_url_equal(M.src,$=q[3][q[11]])||attr(M,"src",$),attr(M,"alt",j="document icon, phase #"+q[1]),attr(M,"class",z=null_to_empty(q[2]?"small-icon":"")+" svelte-zzihih"),attr(_,"class",X="icon-container "+(q[4]&&!q[2]?"hovered":"")+" "+(q[2]?"small-icon":"")+" svelte-zzihih")},m(ee,te){insert(ee,_,te),append(_,M),append(_,V),Q&&Q.m(_,null),G||(Y=[listen(_,"click",q[10]),listen(_,"keypress",q[10]),listen(_,"mouseenter",q[8]),listen(_,"mouseleave",q[9])],G=!0)},p(ee,te){te&8&&!src_url_equal(M.src,$=ee[3][ee[11]])&&attr(M,"src",$),te&2&&j!==(j="document icon, phase #"+ee[1])&&attr(M,"alt",j),te&4&&z!==(z=null_to_empty(ee[2]?"small-icon":"")+" svelte-zzihih")&&attr(M,"class",z),ee[2]?Q&&(Q.d(1),Q=null):Q?Q.p(ee,te):(Q=create_if_block_1$9(ee),Q.c(),Q.m(_,null)),te&20&&X!==(X="icon-container "+(ee[4]&&!ee[2]?"hovered":"")+" "+(ee[2]?"small-icon":"")+" svelte-zzihih")&&attr(_,"class",X)},d(ee){ee&&detach(_),Q&&Q.d(),G=!1,run_all(Y)}}}function create_if_block$g(q){let _,M,$,j;return{c(){_=element("div"),M=element("img"),src_url_equal(M.src,$=q[3][q[11]])||attr(M,"src",$),attr(M,"alt","document icon"),attr(M,"class",j="blurred "+(q[2]?"small-icon":"")+" svelte-zzihih"),attr(_,"class","icon-container h-full no-event svelte-zzihih")},m(z,V){insert(z,_,V),append(_,M)},p(z,V){V&8&&!src_url_equal(M.src,$=z[3][z[11]])&&attr(M,"src",$),V&4&&j!==(j="blurred "+(z[2]?"small-icon":"")+" svelte-zzihih")&&attr(M,"class",j)},d(z){z&&detach(_)}}}function create_if_block_1$9(q){let _,M,$,j,z,V,X,G=q[4]&&create_if_block_2$7(q);return{c(){_=element("div"),M=element("p"),$=text(q[5]),j=text("."),z=text(q[7]),V=space(),G&&G.c(),X=empty(),attr(_,"class","w-full details flex flex-row items-center justify-center svelte-zzihih")},m(Y,Q){insert(Y,_,Q),append(_,M),append(M,$),append(M,j),append(M,z),insert(Y,V,Q),G&&G.m(Y,Q),insert(Y,X,Q)},p(Y,Q){Q&32&&set_data($,Y[5]),Y[4]?G?G.p(Y,Q):(G=create_if_block_2$7(Y),G.c(),G.m(X.parentNode,X)):G&&(G.d(1),G=null)},d(Y){Y&&detach(_),Y&&detach(V),G&&G.d(Y),Y&&detach(X)}}}function create_if_block_2$7(q){let _,M;return{c(){_=element("div"),M=element("p"),M.textContent=`${q[6][0]}, ${q[6][1]}`,attr(_,"class","coordinates svelte-zzihih")},m($,j){insert($,_,j),append(_,M)},p:noop,d($){$&&detach(_)}}}function create_fragment$p(q){let _;function M(z,V){return z[0]?create_if_block$g:create_else_block$2}let $=M(q),j=$(q);return{c(){j.c(),_=empty()},m(z,V){j.m(z,V),insert(z,_,V)},p(z,[V]){$===($=M(z))&&j?j.p(z,V):(j.d(1),j=$(z),j&&(j.c(),j.m(_.parentNode,_)))},i:noop,o:noop,d(z){j.d(z),z&&detach(_)}}}function instance$k(q,_,M){let $;component_subscribe(q,shareKeypair,le=>M(15,$=le));const j=createEventDispatcher();let z=["icons/mountain-phase-0-02.png","icons/mountain-phase-1-02.png","icons/mountain-phase-2-02.png","icons/mountain-phase-3-02.png","icons/mountain-phase-4-02.png","icons/mountain-phase-5-02.png","icons/mountain-phase-6-02.png","icons/mountain-phase-7-02.png","icons/mountain-phase-8-02.png"],V=["icons/flower-phase-0-02.png","icons/flower-phase-1-02.png","icons/flower-phase-2-02.png","icons/flower-phase-3-02.png","icons/flower-phase-4-02.png","icons/flower-phase-5-02.png","icons/flower-phase-6-02.png","icons/flower-phase-7-02.png","icons/flower-phase-8-02.png"],{doc:X}=_,{disabled:G=!1}=_,{phase:Y}=_,{replies:Q=!1}=_,ee,te=X.deleteAfter,Z=!1,ne,re,se=pathToXY(X.path),ie=X.path.split(".").pop();function oe(){G||M(4,Z=!0)}function ue(){G||M(4,Z=!1)}function ce(le){console.log("clicked"),j("click",le)}X.path.endsWith(".md")?ee=z:ee=V;let ae=$.shareAddress.includes("commons")?Math.floor((te-Date.now())/(25488e8/ee.length))%ee.length:1;return q.$$set=le=>{"doc"in le&&M(12,X=le.doc),"disabled"in le&&M(0,G=le.disabled),"phase"in le&&M(1,Y=le.phase),"replies"in le&&M(2,Q=le.replies)},q.$$.update=()=>{q.$$.dirty&12288&&X.text!==void 0&&(M(13,ne=splitTitleAndNotes(X.text)),M(5,re=ne.title),ne.note)},[G,Y,Q,ee,Z,re,se,ie,oe,ue,ce,ae,X,ne]}class Icon extends SvelteComponent{constructor(_){super(),init(this,_,instance$k,create_fragment$p,safe_not_equal,{doc:12,disabled:0,phase:1,replies:2})}}const File_svelte_svelte_type_style_lang="";function create_if_block_1$8(q){let _;return{c(){_=element("div"),_.textContent="The upload button is disabled because a title is required.",attr(_,"class","svelte-902auw")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block$f(q){let _,M,$=q[1].kind+"",j;return{c(){_=element("p"),M=element("strong"),j=text($)},m(z,V){insert(z,_,V),append(_,M),append(M,j)},p(z,V){V&2&&$!==($=z[1].kind+"")&&set_data(j,$)},d(z){z&&detach(_)}}}function create_fragment$o(q){let _,M,$,j,z,V,X,G,Y,Q,ee,te,Z,ne,re,se,ie,oe=!q[0]&&create_if_block_1$8(),ue=q[1]&&create_if_block$f(q);return{c(){_=element("div"),M=element("div"),$=element("h5"),$.textContent="Upload a file",j=space(),z=element("div"),z.textContent="Start by entering your title and the optional note.",V=space(),X=element("div"),X.textContent="Once the file is selected, it will be automatically uploaded.",G=space(),oe&&oe.c(),Y=space(),Q=element("button"),ee=text("file upload"),Z=space(),ne=element("input"),re=space(),ue&&ue.c(),attr($,"class","m-2"),attr(z,"class","svelte-902auw"),attr(X,"class","svelte-902auw"),attr(Q,"class","phase1 m-2 svelte-902auw"),Q.disabled=te=!q[0],set_style(ne,"display","none"),attr(ne,"type","file"),attr(ne,"accept",".jpg, .jpeg, .png, .gif, .txt, .pdf, .md, .webm, .mp3, .ogg, .wav"),attr(M,"class","text-left svelte-902auw"),attr(_,"class","svelte-902auw")},m(ce,ae){insert(ce,_,ae),append(_,M),append(M,$),append(M,j),append(M,z),append(M,V),append(M,X),append(M,G),oe&&oe.m(M,null),append(M,Y),append(M,Q),append(Q,ee),append(M,Z),append(M,ne),q[10](ne),append(_,re),ue&&ue.m(_,null),se||(ie=[listen(Q,"click",q[7]),listen(Q,"keypress",q[8]),listen(ne,"change",q[9])],se=!0)},p(ce,[ae]){ce[0]?oe&&(oe.d(1),oe=null):oe||(oe=create_if_block_1$8(),oe.c(),oe.m(M,Y)),ae&1&&te!==(te=!ce[0])&&(Q.disabled=te),ce[1]?ue?ue.p(ce,ae):(ue=create_if_block$f(ce),ue.c(),ue.m(_,null)):ue&&(ue.d(1),ue=null)},i:noop,o:noop,d(ce){ce&&detach(_),oe&&oe.d(),q[10](null),ue&&ue.d(),se=!1,run_all(ie)}}}function readFileAsync(q){return new Promise((_,M)=>{let $=new FileReader;$.onload=()=>{_($.result),console.log("typeof",$.result)},$.onerror=M,$.readAsArrayBuffer(q)})}function instance$j(q,_,M){let $,j,z;component_subscribe(q,authorKeypair,ue=>M(13,$=ue)),component_subscribe(q,replicaDetails,ue=>M(14,j=ue)),component_subscribe(q,shareKeypair,ue=>M(15,z=ue));const V=createEventDispatcher();let{xy:X=[0,0]}=_,G,Y,Q,{title:ee=void 0}=_,{notes:te=void 0}=_,{isValid:Z=!0}=_;async function ne(ue){te&&ee?Q="#Title: "+ee+"#Notes: "+te:ee?Q="#Title: "+ee:Q="";let ce=ue.target.files[0],le=ce.name.replace(/\s+/g,"_").replace(/[@,\/#!$%\^&\*;:{}=\-`~()]/g,""),he=le.split(".").pop(),ge=le.split(".")[le.split(".").length-2],de;(he==="JPG"||he==="jpg")&&(he="jpeg"),de=ge+"."+he;let pe=Date.now(),ye=await readFileAsync(ce),_e=(Date.now()+25488e5)*1e3,De=new Uint8Array(ye),fe=`/documents/${X[0]}/${X[1]}/${pe}/!${de}`,Ae="Shared by "+$.address.slice(1,5)+" on "+new Date().toLocaleString()+" "+Q,Me={path:fe,text:Ae,attachment:De};return z.shareAddress.includes("commons")?(Me.deleteAfter=_e,console.log("added deleteAfter to doc")):(Me.path=fe.replace("!",""),console.log("removed ! from path")),M(1,Y=await j.replica.set($,Me)),console.log("Result: ",Y),isErr(Y)?(console.error(Y),Y.message):(console.log("Success!"),V("upload")),Y}const re=()=>{G.click()},se=()=>{G.click()},ie=ue=>ne(ue);function oe(ue){binding_callbacks[ue?"unshift":"push"](()=>{G=ue,M(2,G)})}return q.$$set=ue=>{"xy"in ue&&M(4,X=ue.xy),"title"in ue&&M(5,ee=ue.title),"notes"in ue&&M(6,te=ue.notes),"isValid"in ue&&M(0,Z=ue.isValid)},q.$$.update=()=>{q.$$.dirty&2&&M(1,Y)},[Z,Y,G,ne,X,ee,te,re,se,ie,oe]}class File extends SvelteComponent{constructor(_){super(),init(this,_,instance$j,create_fragment$o,safe_not_equal,{xy:4,title:5,notes:6,isValid:0})}}const Upload_svelte_svelte_type_style_lang="";function create_if_block_4$2(q){let _,M;return _=new File({props:{xy:q[1],title:q[2],notes:q[5],isValid:q[3]}}),_.$on("upload",q[8]),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.xy=$[1]),j&4&&(z.title=$[2]),j&32&&(z.notes=$[5]),j&8&&(z.isValid=$[3]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block_3$4(q){let _,M;return _=new Voice({props:{xy:q[1],title:q[2],notes:q[5],isValid:q[3]}}),_.$on("upload",q[8]),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.xy=$[1]),j&4&&(z.title=$[2]),j&32&&(z.notes=$[5]),j&8&&(z.isValid=$[3]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block_2$6(q){let _,M,$;return{c(){_=element("textarea"),attr(_,"id","mainInput"),attr(_,"placeholder","Enter text"),attr(_,"class","svelte-xye4z5")},m(j,z){insert(j,_,z),set_input_value(_,q[4]),M||($=listen(_,"input",q[11]),M=!0)},p(j,z){z&16&&set_input_value(_,j[4])},i:noop,o:noop,d(j){j&&detach(_),M=!1,$()}}}function create_if_block$e(q){let _,M,$,j,z,V,X=!q[3]&&create_if_block_1$7();return{c(){X&&X.c(),_=space(),M=element("button"),$=text("Submit"),attr(M,"class","phase1 svelte-xye4z5"),M.disabled=j=!q[3]},m(G,Y){X&&X.m(G,Y),insert(G,_,Y),insert(G,M,Y),append(M,$),z||(V=listen(M,"click",q[7]),z=!0)},p(G,Y){G[3]?X&&(X.d(1),X=null):X||(X=create_if_block_1$7(),X.c(),X.m(_.parentNode,_)),Y&8&&j!==(j=!G[3])&&(M.disabled=j)},d(G){X&&X.d(G),G&&detach(_),G&&detach(M),z=!1,V()}}}function create_if_block_1$7(q){let _;return{c(){_=element("div"),_.textContent="Title is required."},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_fragment$n(q){let _,M,$,j,z,V,X,G,Y,Q,ee,te,Z,ne,re,se,ie,oe,ue,ce,ae,le,he,ge;const de=[create_if_block_2$6,create_if_block_3$4,create_if_block_4$2],pe=[];function ye(De,fe){return De[0]==="text"?0:De[0]==="audio"?1:De[0]==="file"?2:-1}~(te=ye(q))&&(Z=pe[te]=de[te](q));let _e=q[0]==="text"&&create_if_block$e(q);return{c(){_=element("div"),M=element("div"),$=element("div"),j=element("div"),z=element("button"),z.textContent="Close",V=space(),X=element("div"),G=element("input"),Y=space(),Q=element("div"),ee=element("div"),Z&&Z.c(),ne=space(),re=element("div"),se=element("h5"),se.textContent="Notes",ie=space(),oe=element("input"),ue=space(),ce=element("div"),ae=element("div"),_e&&_e.c(),attr(z,"class","close-button svelte-xye4z5"),attr(G,"id","titleInput"),attr(G,"class","align-left my-2 svelte-xye4z5"),attr(G,"type","text"),attr(G,"placeholder","Enter a title (required)"),attr(X,"class","flex flex-row justify-start"),attr(ee,"class","flex flex-col w-[50vw] items-start"),attr(se,"class","text-left"),attr(oe,"type","text"),attr(oe,"placeholder","Enter optional notes"),attr(re,"class","pr-6"),attr(Q,"class","flex flex-row justify-between"),attr(ae,"class","flex flex-col"),attr(ce,"class","flex flex-row justify-end my-6"),attr(j,"class","p-6 w-full h-full bg-white"),attr($,"class","h-[80vh] w-full"),set_style(M,"position","relative"),set_style(M,"z-index","52"),set_style(_,"position","fixed"),set_style(_,"width","79vw")},m(De,fe){insert(De,_,fe),append(_,M),append(M,$),append($,j),append(j,z),append(j,V),append(j,X),append(X,G),set_input_value(G,q[2]),append(j,Y),append(j,Q),append(Q,ee),~te&&pe[te].m(ee,null),append(Q,ne),append(Q,re),append(re,se),append(re,ie),append(re,oe),set_input_value(oe,q[5]),append(j,ue),append(j,ce),append(ce,ae),_e&&_e.m(ae,null),le=!0,he||(ge=[listen(z,"click",q[9]),listen(G,"input",q[10]),listen(oe,"input",q[12])],he=!0)},p(De,[fe]){fe&4&&G.value!==De[2]&&set_input_value(G,De[2]);let Ae=te;te=ye(De),te===Ae?~te&&pe[te].p(De,fe):(Z&&(group_outros(),transition_out(pe[Ae],1,1,()=>{pe[Ae]=null}),check_outros()),~te?(Z=pe[te],Z?Z.p(De,fe):(Z=pe[te]=de[te](De),Z.c()),transition_in(Z,1),Z.m(ee,null)):Z=null),fe&32&&oe.value!==De[5]&&set_input_value(oe,De[5]),De[0]==="text"?_e?_e.p(De,fe):(_e=create_if_block$e(De),_e.c(),_e.m(ae,null)):_e&&(_e.d(1),_e=null)},i(De){le||(transition_in(Z),le=!0)},o(De){transition_out(Z),le=!1},d(De){De&&detach(_),~te&&pe[te].d(),_e&&_e.d(),he=!1,run_all(ge)}}}function instance$i(q,_,M){let $,j,z;component_subscribe(q,authorKeypair,he=>M(15,$=he)),component_subscribe(q,replicaDetails,he=>M(16,j=he)),component_subscribe(q,shareKeypair,he=>M(17,z=he));let{filetype:V}=_,{xy:X=[0,0]}=_,G,Y="",Q="",ee,te,Z=!0,ne=Date.now(),re=(Date.now()+25488e5)*1e3;const se=createEventDispatcher();async function ie(){let ge=await new Blob([G],{type:"text/markdown"}).arrayBuffer(),de=new Uint8Array(ge),pe=$.address.slice(1,5);Q?ee="#Title: "+Y+"#Notes: "+Q:ee="#Title: "+Y;let ye=`/documents/${X[0]}/${X[1]}/${ne}/!text-input-by-${pe}.md`,_e="Text input by "+$.address.slice(1,5)+" on "+new Date().toLocaleString()+ee,De={path:ye,text:_e,attachment:de};return z.shareAddress.includes("commons")?(De.deleteAfter=re,console.log("added deleteAfter to doc")):(De.path=ye.replace("!",""),console.log("removed ! from path")),te=await j.replica.set($,De),console.log("Result: ",te),isErr(te)&&console.error(te),se("success"),te}function oe(he){console.log("event in Upload.svelte",he),se("success")}const ue=()=>se("close");function ce(){Y=this.value,M(2,Y)}function ae(){G=this.value,M(4,G)}function le(){Q=this.value,M(5,Q)}return q.$$set=he=>{"filetype"in he&&M(0,V=he.filetype),"xy"in he&&M(1,X=he.xy)},q.$$.update=()=>{q.$$.dirty&4&&(Y&&Y.trim()!==""?M(3,Z=!0):M(3,Z=!1)),q.$$.dirty&8&&console.log("isValid",Z),q.$$.dirty&1&&console.log("filetype in Upload.svelte",V),q.$$.dirty&1&&console.log("filetype in Upload.svelte",V)},[V,X,Y,Z,G,Q,se,ie,oe,ue,ce,ae,le]}class Upload extends SvelteComponent{constructor(_){super(),init(this,_,instance$i,create_fragment$n,safe_not_equal,{filetype:0,xy:1})}}const OrbitingIcons_svelte_svelte_type_style_lang="";function create_fragment$m(q){let _,M,$;return M=new Icon({props:{doc:q[0],phase:q[1]%9,replies:replies$1}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","icon-container svelte-1p6jdr4")},m(j,z){insert(j,_,z),mount_component(M,_,null),q[5](_),$=!0},p(j,[z]){const V={};z&1&&(V.doc=j[0]),z&2&&(V.phase=j[1]%9),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M),q[5](null)}}}let replies$1=!0;function instance$h(q,_,M){let{doc:$}=_,{index:j}=_,{orbitDiameter:z}=_,{disabled:V=!1}=_,X;onMount(()=>{let Y=Math.random()*360;const Q=1.2;function ee(){if(X){Y+=Q;const te=Y*Math.PI/180,Z=z/4-j*19,ne=Math.cos(te)*Z,re=Math.sin(te)*Z;M(2,X.style.transform=`translate(${ne}px, ${re}px)`,X),requestAnimationFrame(ee)}}ee()});function G(Y){binding_callbacks[Y?"unshift":"push"](()=>{X=Y,M(2,X)})}return q.$$set=Y=>{"doc"in Y&&M(0,$=Y.doc),"index"in Y&&M(1,j=Y.index),"orbitDiameter"in Y&&M(3,z=Y.orbitDiameter),"disabled"in Y&&M(4,V=Y.disabled)},[$,j,X,z,V,G]}class OrbitingIcons extends SvelteComponent{constructor(_){super(),init(this,_,instance$h,create_fragment$m,safe_not_equal,{doc:0,index:1,orbitDiameter:3,disabled:4})}}const OrbitingReplies_svelte_svelte_type_style_lang="";function get_each_context$8(q,_,M){const $=q.slice();return $[5]=_[M],$[7]=M,$}function create_each_block$8(q,_){let M,$,j;return $=new OrbitingIcons({props:{doc:_[0],index:_[7],orbitDiameter,disabled:_[1]}}),{key:q,first:null,c(){M=empty(),create_component($.$$.fragment),this.first=M},m(z,V){insert(z,M,V),mount_component($,z,V),j=!0},p(z,V){_=z;const X={};V&1&&(X.doc=_[0]),V&4&&(X.index=_[7]),V&2&&(X.disabled=_[1]),$.$set(X)},i(z){j||(transition_in($.$$.fragment,z),j=!0)},o(z){transition_out($.$$.fragment,z),j=!1},d(z){z&&detach(M),destroy_component($,z)}}}function create_fragment$l(q){let _,M=[],$=new Map,j,z=q[2];const V=X=>X[5].textHash+X[5].timestamp;for(let X=0;X<z.length;X+=1){let G=get_each_context$8(q,z,X),Y=V(G);$.set(Y,M[X]=create_each_block$8(Y,G))}return{c(){_=element("div");for(let X=0;X<M.length;X+=1)M[X].c();attr(_,"id","circle-orbit-container"),set_style(_,"height",orbitDiameter+"px"),set_style(_,"width",orbitDiameter+"px"),attr(_,"class","svelte-10tbmvf"),toggle_class(_,"disabled",q[1])},m(X,G){insert(X,_,G);for(let Y=0;Y<M.length;Y+=1)M[Y].m(_,null);j=!0},p(X,[G]){G&7&&(z=X[2],group_outros(),M=update_keyed_each(M,G,V,1,X,z,$,_,outro_and_destroy_block,create_each_block$8,null,get_each_context$8),check_outros()),(!j||G&2)&&toggle_class(_,"disabled",X[1])},i(X){if(!j){for(let G=0;G<z.length;G+=1)transition_in(M[G]);j=!0}},o(X){for(let G=0;G<M.length;G+=1)transition_out(M[G]);j=!1},d(X){X&&detach(_);for(let G=0;G<M.length;G+=1)M[G].d()}}}const orbitDiameter=160;function instance$g(q,_,M){let $;component_subscribe(q,cacheDetails,G=>M(3,$=G));let{doc:j=null}=_,{disabled:z=!1}=_,V=[];const X=async()=>{const G=j.path.split("/");G.pop();const Y=G.join("/");let Q=await $.queryDocs({filter:{pathStartsWith:Y}});M(2,V=Q.slice(1))};return onMount(X),q.$$set=G=>{"doc"in G&&M(0,j=G.doc),"disabled"in G&&M(1,z=G.disabled)},q.$$.update=()=>{q.$$.dirty&1&&j&&X()},[j,z,V]}class OrbitingReplies extends SvelteComponent{constructor(_){super(),init(this,_,instance$g,create_fragment$l,safe_not_equal,{doc:0,disabled:1})}}function create_if_block$d(q){let _,M;return{c(){_=element("div"),M=text(q[0]),set_style(_,"position","absolute"),set_style(_,"top","20px"),set_style(_,"left","0"),set_style(_,"background","lightgray"),set_style(_,"padding","10px"),set_style(_,"border-radius","5px"),set_style(_,"z-index","1")},m($,j){insert($,_,j),append(_,M)},p($,j){j&1&&set_data(M,$[0])},d($){$&&detach(_)}}}function create_fragment$k(q){let _,M,$,j=q[2]&&create_if_block$d(q);const z=q[4].default,V=create_slot(z,q,q[3],null);return{c(){_=element("div"),j&&j.c(),M=space(),V&&V.c(),set_style(_,"display","inline-block"),set_style(_,"position","relative")},m(X,G){insert(X,_,G),j&&j.m(_,null),append(_,M),V&&V.m(_,null),q[5](_),$=!0},p(X,[G]){X[2]?j?j.p(X,G):(j=create_if_block$d(X),j.c(),j.m(_,M)):j&&(j.d(1),j=null),V&&V.p&&(!$||G&8)&&update_slot_base(V,z,X,X[3],$?get_slot_changes(z,X[3],G,null):get_all_dirty_from_scope(X[3]),null)},i(X){$||(transition_in(V,X),$=!0)},o(X){transition_out(V,X),$=!1},d(X){X&&detach(_),j&&j.d(),V&&V.d(X),q[5](null)}}}function instance$f(q,_,M){let{$$slots:$={},$$scope:j}=_,z,{text:V=""}=_,X=!1;onMount(()=>{z.addEventListener("mouseover",()=>{M(2,X=!0)}),z.addEventListener("mouseout",()=>{M(2,X=!1)})});function G(Y){binding_callbacks[Y?"unshift":"push"](()=>{z=Y,M(1,z)})}return q.$$set=Y=>{"text"in Y&&M(0,V=Y.text),"$$scope"in Y&&M(3,j=Y.$$scope)},[V,z,X,j,$,G]}class Tooltip extends SvelteComponent{constructor(_){super(),init(this,_,instance$f,create_fragment$k,safe_not_equal,{text:0})}}const StudioPortal_svelte_svelte_type_style_lang="";function get_each_context$7(q,_,M){const $=q.slice();return $[5]=_[M],$}function create_default_slot$1(q){let _;return{c(){_=element("p"),_.innerHTML="You have reached the Beginning of Studio portals. <br/>Choose the Studio you want to enter:",attr(_,"class","svelte-as39s0")},m(M,$){insert(M,_,$)},p:noop,d(M){M&&detach(_)}}}function create_each_block$7(q,_){let M,$=_[5]+"",j,z;return{key:q,first:null,c(){M=element("option"),j=text($),M.__value=z=_[5],M.value=M.__value,this.first=M},m(V,X){insert(V,M,X),append(M,j)},p(V,X){_=V,X&2&&$!==($=_[5]+"")&&set_data(j,$),X&2&&z!==(z=_[5])&&(M.__value=z,M.value=M.__value)},d(V){V&&detach(M)}}}function create_fragment$j(q){let _,M,$,j,z,V,X,G=[],Y=new Map,Q,ee,te,Z,ne;$=new Tooltip({props:{text:"You can choose from any studio you saved in the share in settings. Settings can be accessed from the top left corner under 'workspace settings'.",$$slots:{default:[create_default_slot$1]},$$scope:{ctx:q}}});let re=q[1];const se=ie=>ie[5];for(let ie=0;ie<re.length;ie+=1){let oe=get_each_context$7(q,re,ie),ue=se(oe);Y.set(ue,G[ie]=create_each_block$7(ue,oe))}return{c(){_=element("div"),M=element("div"),create_component($.$$.fragment),j=space(),z=element("label"),z.textContent="Select Workspace",V=space(),X=element("select");for(let ie=0;ie<G.length;ie+=1)G[ie].c();Q=space(),ee=element("button"),ee.textContent="enter selected studio",attr(z,"for","share-switcher"),attr(z,"class","text-center svelte-as39s0"),attr(X,"id","share-switcher"),attr(X,"class","form-control svelte-as39s0"),q[0]===void 0&&add_render_callback(()=>q[3].call(X)),attr(ee,"class","phase1 my-2 mb-24"),attr(M,"class","flex flex-col items-center justify-center max-w-3xl mx-auto w-full md:w-1/2 svelte-as39s0"),attr(_,"class","flex flex-col items-center justify-center svelte-as39s0")},m(ie,oe){insert(ie,_,oe),append(_,M),mount_component($,M,null),append(M,j),append(M,z),append(M,V),append(M,X);for(let ue=0;ue<G.length;ue+=1)G[ue].m(X,null);select_option(X,q[0]),append(M,Q),append(M,ee),te=!0,Z||(ne=[listen(X,"change",q[3]),listen(ee,"click",q[2])],Z=!0)},p(ie,[oe]){const ue={};oe&256&&(ue.$$scope={dirty:oe,ctx:ie}),$.$set(ue),oe&2&&(re=ie[1],G=update_keyed_each(G,oe,se,1,ie,re,Y,X,destroy_block,create_each_block$7,null,get_each_context$7)),oe&3&&select_option(X,ie[0])},i(ie){te||(transition_in($.$$.fragment,ie),te=!0)},o(ie){transition_out($.$$.fragment,ie),te=!1},d(ie){ie&&detach(_),destroy_component($);for(let oe=0;oe<G.length;oe+=1)G[oe].d();Z=!1,run_all(ne)}}}function instance$e(q,_,M){const $=createEventDispatcher();let j=get_store_value(shareKeypair).shareAddress;shareKeypair.subscribe(G=>{M(0,j=G.shareAddress)});function z(){const G=j,Y=settings.shareSecrets[G];shareKeypair.set({shareAddress:G,secret:Y}),$("shareUpdated")}let V=[];studioShares.subscribe(G=>{M(1,V=[...G])});function X(){j=select_value(this),M(0,j),M(1,V)}return[j,V,z,X]}class StudioPortal extends SvelteComponent{constructor(_){super(),init(this,_,instance$e,create_fragment$j,safe_not_equal,{})}}const ServerList_svelte_svelte_type_style_lang="";function get_each_context$6(q,_,M){const $=q.slice();return $[0]=_[M],$[2]=M,$}function create_if_block$c(q){let _,M,$=[],j=new Map,z=settings.servers;const V=X=>X[2];for(let X=0;X<z.length;X+=1){let G=get_each_context$6(q,z,X),Y=V(G);j.set(Y,$[X]=create_each_block$6(Y,G))}return{c(){_=element("div"),M=element("ul");for(let X=0;X<$.length;X+=1)$[X].c();attr(M,"class","ml-0 svelte-9q8bf3")},m(X,G){insert(X,_,G),append(_,M);for(let Y=0;Y<$.length;Y+=1)$[Y].m(M,null)},p(X,G){G&0&&(z=settings.servers,$=update_keyed_each($,G,V,1,X,z,j,M,destroy_block,create_each_block$6,null,get_each_context$6))},d(X){X&&detach(_);for(let G=0;G<$.length;G+=1)$[G].d()}}}function create_each_block$6(q,_){let M,$=_[0]+"",j;return{key:q,first:null,c(){M=element("li"),j=text($),this.first=M},m(z,V){insert(z,M,V),append(M,j)},p(z,V){_=z},d(z){z&&detach(M)}}}function create_fragment$i(q){let _,M=settings.servers.length>0&&create_if_block$c(q);return{c(){M&&M.c(),_=empty()},m($,j){M&&M.m($,j),insert($,_,j)},p($,[j]){settings.servers.length>0&&M.p($,j)},i:noop,o:noop,d($){M&&M.d($),$&&detach(_)}}}class ServerList extends SvelteComponent{constructor(_){super(),init(this,_,null,create_fragment$i,safe_not_equal,{})}}var jszip_min={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(q,_){(function(M){q.exports=M()})(function(){return function M($,j,z){function V(Y,Q){if(!j[Y]){if(!$[Y]){var ee=typeof commonjsRequire=="function"&&commonjsRequire;if(!Q&&ee)return ee(Y,!0);if(X)return X(Y,!0);var te=new Error("Cannot find module '"+Y+"'");throw te.code="MODULE_NOT_FOUND",te}var Z=j[Y]={exports:{}};$[Y][0].call(Z.exports,function(ne){var re=$[Y][1][ne];return V(re||ne)},Z,Z.exports,M,$,j,z)}return j[Y].exports}for(var X=typeof commonjsRequire=="function"&&commonjsRequire,G=0;G<z.length;G++)V(z[G]);return V}({1:[function(M,$,j){var z=M("./utils"),V=M("./support"),X="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";j.encode=function(G){for(var Y,Q,ee,te,Z,ne,re,se=[],ie=0,oe=G.length,ue=oe,ce=z.getTypeOf(G)!=="string";ie<G.length;)ue=oe-ie,ee=ce?(Y=G[ie++],Q=ie<oe?G[ie++]:0,ie<oe?G[ie++]:0):(Y=G.charCodeAt(ie++),Q=ie<oe?G.charCodeAt(ie++):0,ie<oe?G.charCodeAt(ie++):0),te=Y>>2,Z=(3&Y)<<4|Q>>4,ne=1<ue?(15&Q)<<2|ee>>6:64,re=2<ue?63&ee:64,se.push(X.charAt(te)+X.charAt(Z)+X.charAt(ne)+X.charAt(re));return se.join("")},j.decode=function(G){var Y,Q,ee,te,Z,ne,re=0,se=0,ie="data:";if(G.substr(0,ie.length)===ie)throw new Error("Invalid base64 input, it looks like a data url.");var oe,ue=3*(G=G.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(G.charAt(G.length-1)===X.charAt(64)&&ue--,G.charAt(G.length-2)===X.charAt(64)&&ue--,ue%1!=0)throw new Error("Invalid base64 input, bad content length.");for(oe=V.uint8array?new Uint8Array(0|ue):new Array(0|ue);re<G.length;)Y=X.indexOf(G.charAt(re++))<<2|(te=X.indexOf(G.charAt(re++)))>>4,Q=(15&te)<<4|(Z=X.indexOf(G.charAt(re++)))>>2,ee=(3&Z)<<6|(ne=X.indexOf(G.charAt(re++))),oe[se++]=Y,Z!==64&&(oe[se++]=Q),ne!==64&&(oe[se++]=ee);return oe}},{"./support":30,"./utils":32}],2:[function(M,$,j){var z=M("./external"),V=M("./stream/DataWorker"),X=M("./stream/Crc32Probe"),G=M("./stream/DataLengthProbe");function Y(Q,ee,te,Z,ne){this.compressedSize=Q,this.uncompressedSize=ee,this.crc32=te,this.compression=Z,this.compressedContent=ne}Y.prototype={getContentWorker:function(){var Q=new V(z.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new G("data_length")),ee=this;return Q.on("end",function(){if(this.streamInfo.data_length!==ee.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),Q},getCompressedWorker:function(){return new V(z.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},Y.createWorkerFrom=function(Q,ee,te){return Q.pipe(new X).pipe(new G("uncompressedSize")).pipe(ee.compressWorker(te)).pipe(new G("compressedSize")).withStreamInfo("compression",ee)},$.exports=Y},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(M,$,j){var z=M("./stream/GenericWorker");j.STORE={magic:"\0\0",compressWorker:function(){return new z("STORE compression")},uncompressWorker:function(){return new z("STORE decompression")}},j.DEFLATE=M("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(M,$,j){var z=M("./utils"),V=function(){for(var X,G=[],Y=0;Y<256;Y++){X=Y;for(var Q=0;Q<8;Q++)X=1&X?3988292384^X>>>1:X>>>1;G[Y]=X}return G}();$.exports=function(X,G){return X!==void 0&&X.length?z.getTypeOf(X)!=="string"?function(Y,Q,ee,te){var Z=V,ne=te+ee;Y^=-1;for(var re=te;re<ne;re++)Y=Y>>>8^Z[255&(Y^Q[re])];return-1^Y}(0|G,X,X.length,0):function(Y,Q,ee,te){var Z=V,ne=te+ee;Y^=-1;for(var re=te;re<ne;re++)Y=Y>>>8^Z[255&(Y^Q.charCodeAt(re))];return-1^Y}(0|G,X,X.length,0):0}},{"./utils":32}],5:[function(M,$,j){j.base64=!1,j.binary=!1,j.dir=!1,j.createFolders=!0,j.date=null,j.compression=null,j.compressionOptions=null,j.comment=null,j.unixPermissions=null,j.dosPermissions=null},{}],6:[function(M,$,j){var z=null;z=typeof Promise<"u"?Promise:M("lie"),$.exports={Promise:z}},{lie:37}],7:[function(M,$,j){var z=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",V=M("pako"),X=M("./utils"),G=M("./stream/GenericWorker"),Y=z?"uint8array":"array";function Q(ee,te){G.call(this,"FlateWorker/"+ee),this._pako=null,this._pakoAction=ee,this._pakoOptions=te,this.meta={}}j.magic="\b\0",X.inherits(Q,G),Q.prototype.processChunk=function(ee){this.meta=ee.meta,this._pako===null&&this._createPako(),this._pako.push(X.transformTo(Y,ee.data),!1)},Q.prototype.flush=function(){G.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},Q.prototype.cleanUp=function(){G.prototype.cleanUp.call(this),this._pako=null},Q.prototype._createPako=function(){this._pako=new V[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var ee=this;this._pako.onData=function(te){ee.push({data:te,meta:ee.meta})}},j.compressWorker=function(ee){return new Q("Deflate",ee)},j.uncompressWorker=function(){return new Q("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(M,$,j){function z(Z,ne){var re,se="";for(re=0;re<ne;re++)se+=String.fromCharCode(255&Z),Z>>>=8;return se}function V(Z,ne,re,se,ie,oe){var ue,ce,ae=Z.file,le=Z.compression,he=oe!==Y.utf8encode,ge=X.transformTo("string",oe(ae.name)),de=X.transformTo("string",Y.utf8encode(ae.name)),pe=ae.comment,ye=X.transformTo("string",oe(pe)),_e=X.transformTo("string",Y.utf8encode(pe)),De=de.length!==ae.name.length,fe=_e.length!==pe.length,Ae="",Me="",Ee="",Te=ae.dir,Be=ae.date,Xe={crc32:0,compressedSize:0,uncompressedSize:0};ne&&!re||(Xe.crc32=Z.crc32,Xe.compressedSize=Z.compressedSize,Xe.uncompressedSize=Z.uncompressedSize);var ze=0;ne&&(ze|=8),he||!De&&!fe||(ze|=2048);var Oe=0,Pe=0;Te&&(Oe|=16),ie==="UNIX"?(Pe=798,Oe|=function(be,Ce){var Ne=be;return be||(Ne=Ce?16893:33204),(65535&Ne)<<16}(ae.unixPermissions,Te)):(Pe=20,Oe|=function(be){return 63&(be||0)}(ae.dosPermissions)),ue=Be.getUTCHours(),ue<<=6,ue|=Be.getUTCMinutes(),ue<<=5,ue|=Be.getUTCSeconds()/2,ce=Be.getUTCFullYear()-1980,ce<<=4,ce|=Be.getUTCMonth()+1,ce<<=5,ce|=Be.getUTCDate(),De&&(Me=z(1,1)+z(Q(ge),4)+de,Ae+="up"+z(Me.length,2)+Me),fe&&(Ee=z(1,1)+z(Q(ye),4)+_e,Ae+="uc"+z(Ee.length,2)+Ee);var ve="";return ve+=`
\0`,ve+=z(ze,2),ve+=le.magic,ve+=z(ue,2),ve+=z(ce,2),ve+=z(Xe.crc32,4),ve+=z(Xe.compressedSize,4),ve+=z(Xe.uncompressedSize,4),ve+=z(ge.length,2),ve+=z(Ae.length,2),{fileRecord:ee.LOCAL_FILE_HEADER+ve+ge+Ae,dirRecord:ee.CENTRAL_FILE_HEADER+z(Pe,2)+ve+z(ye.length,2)+"\0\0\0\0"+z(Oe,4)+z(se,4)+ge+Ae+ye}}var X=M("../utils"),G=M("../stream/GenericWorker"),Y=M("../utf8"),Q=M("../crc32"),ee=M("../signature");function te(Z,ne,re,se){G.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=ne,this.zipPlatform=re,this.encodeFileName=se,this.streamFiles=Z,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}X.inherits(te,G),te.prototype.push=function(Z){var ne=Z.meta.percent||0,re=this.entriesCount,se=this._sources.length;this.accumulate?this.contentBuffer.push(Z):(this.bytesWritten+=Z.data.length,G.prototype.push.call(this,{data:Z.data,meta:{currentFile:this.currentFile,percent:re?(ne+100*(re-se-1))/re:100}}))},te.prototype.openedSource=function(Z){this.currentSourceOffset=this.bytesWritten,this.currentFile=Z.file.name;var ne=this.streamFiles&&!Z.file.dir;if(ne){var re=V(Z,ne,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:re.fileRecord,meta:{percent:0}})}else this.accumulate=!0},te.prototype.closedSource=function(Z){this.accumulate=!1;var ne=this.streamFiles&&!Z.file.dir,re=V(Z,ne,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(re.dirRecord),ne)this.push({data:function(se){return ee.DATA_DESCRIPTOR+z(se.crc32,4)+z(se.compressedSize,4)+z(se.uncompressedSize,4)}(Z),meta:{percent:100}});else for(this.push({data:re.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},te.prototype.flush=function(){for(var Z=this.bytesWritten,ne=0;ne<this.dirRecords.length;ne++)this.push({data:this.dirRecords[ne],meta:{percent:100}});var re=this.bytesWritten-Z,se=function(ie,oe,ue,ce,ae){var le=X.transformTo("string",ae(ce));return ee.CENTRAL_DIRECTORY_END+"\0\0\0\0"+z(ie,2)+z(ie,2)+z(oe,4)+z(ue,4)+z(le.length,2)+le}(this.dirRecords.length,re,Z,this.zipComment,this.encodeFileName);this.push({data:se,meta:{percent:100}})},te.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},te.prototype.registerPrevious=function(Z){this._sources.push(Z);var ne=this;return Z.on("data",function(re){ne.processChunk(re)}),Z.on("end",function(){ne.closedSource(ne.previous.streamInfo),ne._sources.length?ne.prepareNextSource():ne.end()}),Z.on("error",function(re){ne.error(re)}),this},te.prototype.resume=function(){return!!G.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},te.prototype.error=function(Z){var ne=this._sources;if(!G.prototype.error.call(this,Z))return!1;for(var re=0;re<ne.length;re++)try{ne[re].error(Z)}catch{}return!0},te.prototype.lock=function(){G.prototype.lock.call(this);for(var Z=this._sources,ne=0;ne<Z.length;ne++)Z[ne].lock()},$.exports=te},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(M,$,j){var z=M("../compressions"),V=M("./ZipFileWorker");j.generateWorker=function(X,G,Y){var Q=new V(G.streamFiles,Y,G.platform,G.encodeFileName),ee=0;try{X.forEach(function(te,Z){ee++;var ne=function(oe,ue){var ce=oe||ue,ae=z[ce];if(!ae)throw new Error(ce+" is not a valid compression method !");return ae}(Z.options.compression,G.compression),re=Z.options.compressionOptions||G.compressionOptions||{},se=Z.dir,ie=Z.date;Z._compressWorker(ne,re).withStreamInfo("file",{name:te,dir:se,date:ie,comment:Z.comment||"",unixPermissions:Z.unixPermissions,dosPermissions:Z.dosPermissions}).pipe(Q)}),Q.entriesCount=ee}catch(te){Q.error(te)}return Q}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(M,$,j){function z(){if(!(this instanceof z))return new z;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var V=new z;for(var X in this)typeof this[X]!="function"&&(V[X]=this[X]);return V}}(z.prototype=M("./object")).loadAsync=M("./load"),z.support=M("./support"),z.defaults=M("./defaults"),z.version="3.10.1",z.loadAsync=function(V,X){return new z().loadAsync(V,X)},z.external=M("./external"),$.exports=z},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(M,$,j){var z=M("./utils"),V=M("./external"),X=M("./utf8"),G=M("./zipEntries"),Y=M("./stream/Crc32Probe"),Q=M("./nodejsUtils");function ee(te){return new V.Promise(function(Z,ne){var re=te.decompressed.getContentWorker().pipe(new Y);re.on("error",function(se){ne(se)}).on("end",function(){re.streamInfo.crc32!==te.decompressed.crc32?ne(new Error("Corrupted zip : CRC32 mismatch")):Z()}).resume()})}$.exports=function(te,Z){var ne=this;return Z=z.extend(Z||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:X.utf8decode}),Q.isNode&&Q.isStream(te)?V.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):z.prepareContent("the loaded zip file",te,!0,Z.optimizedBinaryString,Z.base64).then(function(re){var se=new G(Z);return se.load(re),se}).then(function(re){var se=[V.Promise.resolve(re)],ie=re.files;if(Z.checkCRC32)for(var oe=0;oe<ie.length;oe++)se.push(ee(ie[oe]));return V.Promise.all(se)}).then(function(re){for(var se=re.shift(),ie=se.files,oe=0;oe<ie.length;oe++){var ue=ie[oe],ce=ue.fileNameStr,ae=z.resolve(ue.fileNameStr);ne.file(ae,ue.decompressed,{binary:!0,optimizedBinaryString:!0,date:ue.date,dir:ue.dir,comment:ue.fileCommentStr.length?ue.fileCommentStr:null,unixPermissions:ue.unixPermissions,dosPermissions:ue.dosPermissions,createFolders:Z.createFolders}),ue.dir||(ne.file(ae).unsafeOriginalName=ce)}return se.zipComment.length&&(ne.comment=se.zipComment),ne})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(M,$,j){var z=M("../utils"),V=M("../stream/GenericWorker");function X(G,Y){V.call(this,"Nodejs stream input adapter for "+G),this._upstreamEnded=!1,this._bindStream(Y)}z.inherits(X,V),X.prototype._bindStream=function(G){var Y=this;(this._stream=G).pause(),G.on("data",function(Q){Y.push({data:Q,meta:{percent:0}})}).on("error",function(Q){Y.isPaused?this.generatedError=Q:Y.error(Q)}).on("end",function(){Y.isPaused?Y._upstreamEnded=!0:Y.end()})},X.prototype.pause=function(){return!!V.prototype.pause.call(this)&&(this._stream.pause(),!0)},X.prototype.resume=function(){return!!V.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},$.exports=X},{"../stream/GenericWorker":28,"../utils":32}],13:[function(M,$,j){var z=M("readable-stream").Readable;function V(X,G,Y){z.call(this,G),this._helper=X;var Q=this;X.on("data",function(ee,te){Q.push(ee)||Q._helper.pause(),Y&&Y(te)}).on("error",function(ee){Q.emit("error",ee)}).on("end",function(){Q.push(null)})}M("../utils").inherits(V,z),V.prototype._read=function(){this._helper.resume()},$.exports=V},{"../utils":32,"readable-stream":16}],14:[function(M,$,j){$.exports={isNode:typeof Buffer<"u",newBufferFrom:function(z,V){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(z,V);if(typeof z=="number")throw new Error('The "data" argument must not be a number');return new Buffer(z,V)},allocBuffer:function(z){if(Buffer.alloc)return Buffer.alloc(z);var V=new Buffer(z);return V.fill(0),V},isBuffer:function(z){return Buffer.isBuffer(z)},isStream:function(z){return z&&typeof z.on=="function"&&typeof z.pause=="function"&&typeof z.resume=="function"}}},{}],15:[function(M,$,j){function z(ae,le,he){var ge,de=X.getTypeOf(le),pe=X.extend(he||{},Q);pe.date=pe.date||new Date,pe.compression!==null&&(pe.compression=pe.compression.toUpperCase()),typeof pe.unixPermissions=="string"&&(pe.unixPermissions=parseInt(pe.unixPermissions,8)),pe.unixPermissions&&16384&pe.unixPermissions&&(pe.dir=!0),pe.dosPermissions&&16&pe.dosPermissions&&(pe.dir=!0),pe.dir&&(ae=ie(ae)),pe.createFolders&&(ge=se(ae))&&oe.call(this,ge,!0);var ye=de==="string"&&pe.binary===!1&&pe.base64===!1;he&&he.binary!==void 0||(pe.binary=!ye),(le instanceof ee&&le.uncompressedSize===0||pe.dir||!le||le.length===0)&&(pe.base64=!1,pe.binary=!0,le="",pe.compression="STORE",de="string");var _e=null;_e=le instanceof ee||le instanceof G?le:ne.isNode&&ne.isStream(le)?new re(ae,le):X.prepareContent(ae,le,pe.binary,pe.optimizedBinaryString,pe.base64);var De=new te(ae,_e,pe);this.files[ae]=De}var V=M("./utf8"),X=M("./utils"),G=M("./stream/GenericWorker"),Y=M("./stream/StreamHelper"),Q=M("./defaults"),ee=M("./compressedObject"),te=M("./zipObject"),Z=M("./generate"),ne=M("./nodejsUtils"),re=M("./nodejs/NodejsStreamInputAdapter"),se=function(ae){ae.slice(-1)==="/"&&(ae=ae.substring(0,ae.length-1));var le=ae.lastIndexOf("/");return 0<le?ae.substring(0,le):""},ie=function(ae){return ae.slice(-1)!=="/"&&(ae+="/"),ae},oe=function(ae,le){return le=le!==void 0?le:Q.createFolders,ae=ie(ae),this.files[ae]||z.call(this,ae,null,{dir:!0,createFolders:le}),this.files[ae]};function ue(ae){return Object.prototype.toString.call(ae)==="[object RegExp]"}var ce={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(ae){var le,he,ge;for(le in this.files)ge=this.files[le],(he=le.slice(this.root.length,le.length))&&le.slice(0,this.root.length)===this.root&&ae(he,ge)},filter:function(ae){var le=[];return this.forEach(function(he,ge){ae(he,ge)&&le.push(ge)}),le},file:function(ae,le,he){if(arguments.length!==1)return ae=this.root+ae,z.call(this,ae,le,he),this;if(ue(ae)){var ge=ae;return this.filter(function(pe,ye){return!ye.dir&&ge.test(pe)})}var de=this.files[this.root+ae];return de&&!de.dir?de:null},folder:function(ae){if(!ae)return this;if(ue(ae))return this.filter(function(de,pe){return pe.dir&&ae.test(de)});var le=this.root+ae,he=oe.call(this,le),ge=this.clone();return ge.root=he.name,ge},remove:function(ae){ae=this.root+ae;var le=this.files[ae];if(le||(ae.slice(-1)!=="/"&&(ae+="/"),le=this.files[ae]),le&&!le.dir)delete this.files[ae];else for(var he=this.filter(function(de,pe){return pe.name.slice(0,ae.length)===ae}),ge=0;ge<he.length;ge++)delete this.files[he[ge].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(ae){var le,he={};try{if((he=X.extend(ae||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:V.utf8encode})).type=he.type.toLowerCase(),he.compression=he.compression.toUpperCase(),he.type==="binarystring"&&(he.type="string"),!he.type)throw new Error("No output type specified.");X.checkSupport(he.type),he.platform!=="darwin"&&he.platform!=="freebsd"&&he.platform!=="linux"&&he.platform!=="sunos"||(he.platform="UNIX"),he.platform==="win32"&&(he.platform="DOS");var ge=he.comment||this.comment||"";le=Z.generateWorker(this,he,ge)}catch(de){(le=new G("error")).error(de)}return new Y(le,he.type||"string",he.mimeType)},generateAsync:function(ae,le){return this.generateInternalStream(ae).accumulate(le)},generateNodeStream:function(ae,le){return(ae=ae||{}).type||(ae.type="nodebuffer"),this.generateInternalStream(ae).toNodejsStream(le)}};$.exports=ce},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(M,$,j){$.exports=M("stream")},{stream:void 0}],17:[function(M,$,j){var z=M("./DataReader");function V(X){z.call(this,X);for(var G=0;G<this.data.length;G++)X[G]=255&X[G]}M("../utils").inherits(V,z),V.prototype.byteAt=function(X){return this.data[this.zero+X]},V.prototype.lastIndexOfSignature=function(X){for(var G=X.charCodeAt(0),Y=X.charCodeAt(1),Q=X.charCodeAt(2),ee=X.charCodeAt(3),te=this.length-4;0<=te;--te)if(this.data[te]===G&&this.data[te+1]===Y&&this.data[te+2]===Q&&this.data[te+3]===ee)return te-this.zero;return-1},V.prototype.readAndCheckSignature=function(X){var G=X.charCodeAt(0),Y=X.charCodeAt(1),Q=X.charCodeAt(2),ee=X.charCodeAt(3),te=this.readData(4);return G===te[0]&&Y===te[1]&&Q===te[2]&&ee===te[3]},V.prototype.readData=function(X){if(this.checkOffset(X),X===0)return[];var G=this.data.slice(this.zero+this.index,this.zero+this.index+X);return this.index+=X,G},$.exports=V},{"../utils":32,"./DataReader":18}],18:[function(M,$,j){var z=M("../utils");function V(X){this.data=X,this.length=X.length,this.index=0,this.zero=0}V.prototype={checkOffset:function(X){this.checkIndex(this.index+X)},checkIndex:function(X){if(this.length<this.zero+X||X<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+X+"). Corrupted zip ?")},setIndex:function(X){this.checkIndex(X),this.index=X},skip:function(X){this.setIndex(this.index+X)},byteAt:function(){},readInt:function(X){var G,Y=0;for(this.checkOffset(X),G=this.index+X-1;G>=this.index;G--)Y=(Y<<8)+this.byteAt(G);return this.index+=X,Y},readString:function(X){return z.transformTo("string",this.readData(X))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var X=this.readInt(4);return new Date(Date.UTC(1980+(X>>25&127),(X>>21&15)-1,X>>16&31,X>>11&31,X>>5&63,(31&X)<<1))}},$.exports=V},{"../utils":32}],19:[function(M,$,j){var z=M("./Uint8ArrayReader");function V(X){z.call(this,X)}M("../utils").inherits(V,z),V.prototype.readData=function(X){this.checkOffset(X);var G=this.data.slice(this.zero+this.index,this.zero+this.index+X);return this.index+=X,G},$.exports=V},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(M,$,j){var z=M("./DataReader");function V(X){z.call(this,X)}M("../utils").inherits(V,z),V.prototype.byteAt=function(X){return this.data.charCodeAt(this.zero+X)},V.prototype.lastIndexOfSignature=function(X){return this.data.lastIndexOf(X)-this.zero},V.prototype.readAndCheckSignature=function(X){return X===this.readData(4)},V.prototype.readData=function(X){this.checkOffset(X);var G=this.data.slice(this.zero+this.index,this.zero+this.index+X);return this.index+=X,G},$.exports=V},{"../utils":32,"./DataReader":18}],21:[function(M,$,j){var z=M("./ArrayReader");function V(X){z.call(this,X)}M("../utils").inherits(V,z),V.prototype.readData=function(X){if(this.checkOffset(X),X===0)return new Uint8Array(0);var G=this.data.subarray(this.zero+this.index,this.zero+this.index+X);return this.index+=X,G},$.exports=V},{"../utils":32,"./ArrayReader":17}],22:[function(M,$,j){var z=M("../utils"),V=M("../support"),X=M("./ArrayReader"),G=M("./StringReader"),Y=M("./NodeBufferReader"),Q=M("./Uint8ArrayReader");$.exports=function(ee){var te=z.getTypeOf(ee);return z.checkSupport(te),te!=="string"||V.uint8array?te==="nodebuffer"?new Y(ee):V.uint8array?new Q(z.transformTo("uint8array",ee)):new X(z.transformTo("array",ee)):new G(ee)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(M,$,j){j.LOCAL_FILE_HEADER="PK",j.CENTRAL_FILE_HEADER="PK",j.CENTRAL_DIRECTORY_END="PK",j.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",j.ZIP64_CENTRAL_DIRECTORY_END="PK",j.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(M,$,j){var z=M("./GenericWorker"),V=M("../utils");function X(G){z.call(this,"ConvertWorker to "+G),this.destType=G}V.inherits(X,z),X.prototype.processChunk=function(G){this.push({data:V.transformTo(this.destType,G.data),meta:G.meta})},$.exports=X},{"../utils":32,"./GenericWorker":28}],25:[function(M,$,j){var z=M("./GenericWorker"),V=M("../crc32");function X(){z.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}M("../utils").inherits(X,z),X.prototype.processChunk=function(G){this.streamInfo.crc32=V(G.data,this.streamInfo.crc32||0),this.push(G)},$.exports=X},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(M,$,j){var z=M("../utils"),V=M("./GenericWorker");function X(G){V.call(this,"DataLengthProbe for "+G),this.propName=G,this.withStreamInfo(G,0)}z.inherits(X,V),X.prototype.processChunk=function(G){if(G){var Y=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=Y+G.data.length}V.prototype.processChunk.call(this,G)},$.exports=X},{"../utils":32,"./GenericWorker":28}],27:[function(M,$,j){var z=M("../utils"),V=M("./GenericWorker");function X(G){V.call(this,"DataWorker");var Y=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,G.then(function(Q){Y.dataIsReady=!0,Y.data=Q,Y.max=Q&&Q.length||0,Y.type=z.getTypeOf(Q),Y.isPaused||Y._tickAndRepeat()},function(Q){Y.error(Q)})}z.inherits(X,V),X.prototype.cleanUp=function(){V.prototype.cleanUp.call(this),this.data=null},X.prototype.resume=function(){return!!V.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,z.delay(this._tickAndRepeat,[],this)),!0)},X.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(z.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},X.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var G=null,Y=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":G=this.data.substring(this.index,Y);break;case"uint8array":G=this.data.subarray(this.index,Y);break;case"array":case"nodebuffer":G=this.data.slice(this.index,Y)}return this.index=Y,this.push({data:G,meta:{percent:this.max?this.index/this.max*100:0}})},$.exports=X},{"../utils":32,"./GenericWorker":28}],28:[function(M,$,j){function z(V){this.name=V||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}z.prototype={push:function(V){this.emit("data",V)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(V){this.emit("error",V)}return!0},error:function(V){return!this.isFinished&&(this.isPaused?this.generatedError=V:(this.isFinished=!0,this.emit("error",V),this.previous&&this.previous.error(V),this.cleanUp()),!0)},on:function(V,X){return this._listeners[V].push(X),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(V,X){if(this._listeners[V])for(var G=0;G<this._listeners[V].length;G++)this._listeners[V][G].call(this,X)},pipe:function(V){return V.registerPrevious(this)},registerPrevious:function(V){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=V.streamInfo,this.mergeStreamInfo(),this.previous=V;var X=this;return V.on("data",function(G){X.processChunk(G)}),V.on("end",function(){X.end()}),V.on("error",function(G){X.error(G)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var V=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),V=!0),this.previous&&this.previous.resume(),!V},flush:function(){},processChunk:function(V){this.push(V)},withStreamInfo:function(V,X){return this.extraStreamInfo[V]=X,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var V in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,V)&&(this.streamInfo[V]=this.extraStreamInfo[V])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var V="Worker "+this.name;return this.previous?this.previous+" -> "+V:V}},$.exports=z},{}],29:[function(M,$,j){var z=M("../utils"),V=M("./ConvertWorker"),X=M("./GenericWorker"),G=M("../base64"),Y=M("../support"),Q=M("../external"),ee=null;if(Y.nodestream)try{ee=M("../nodejs/NodejsStreamOutputAdapter")}catch{}function te(ne,re){return new Q.Promise(function(se,ie){var oe=[],ue=ne._internalType,ce=ne._outputType,ae=ne._mimeType;ne.on("data",function(le,he){oe.push(le),re&&re(he)}).on("error",function(le){oe=[],ie(le)}).on("end",function(){try{var le=function(he,ge,de){switch(he){case"blob":return z.newBlob(z.transformTo("arraybuffer",ge),de);case"base64":return G.encode(ge);default:return z.transformTo(he,ge)}}(ce,function(he,ge){var de,pe=0,ye=null,_e=0;for(de=0;de<ge.length;de++)_e+=ge[de].length;switch(he){case"string":return ge.join("");case"array":return Array.prototype.concat.apply([],ge);case"uint8array":for(ye=new Uint8Array(_e),de=0;de<ge.length;de++)ye.set(ge[de],pe),pe+=ge[de].length;return ye;case"nodebuffer":return Buffer.concat(ge);default:throw new Error("concat : unsupported type '"+he+"'")}}(ue,oe),ae);se(le)}catch(he){ie(he)}oe=[]}).resume()})}function Z(ne,re,se){var ie=re;switch(re){case"blob":case"arraybuffer":ie="uint8array";break;case"base64":ie="string"}try{this._internalType=ie,this._outputType=re,this._mimeType=se,z.checkSupport(ie),this._worker=ne.pipe(new V(ie)),ne.lock()}catch(oe){this._worker=new X("error"),this._worker.error(oe)}}Z.prototype={accumulate:function(ne){return te(this,ne)},on:function(ne,re){var se=this;return ne==="data"?this._worker.on(ne,function(ie){re.call(se,ie.data,ie.meta)}):this._worker.on(ne,function(){z.delay(re,arguments,se)}),this},resume:function(){return z.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(ne){if(z.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new ee(this,{objectMode:this._outputType!=="nodebuffer"},ne)}},$.exports=Z},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(M,$,j){if(j.base64=!0,j.array=!0,j.string=!0,j.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",j.nodebuffer=typeof Buffer<"u",j.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")j.blob=!1;else{var z=new ArrayBuffer(0);try{j.blob=new Blob([z],{type:"application/zip"}).size===0}catch{try{var V=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);V.append(z),j.blob=V.getBlob("application/zip").size===0}catch{j.blob=!1}}}try{j.nodestream=!!M("readable-stream").Readable}catch{j.nodestream=!1}},{"readable-stream":16}],31:[function(M,$,j){for(var z=M("./utils"),V=M("./support"),X=M("./nodejsUtils"),G=M("./stream/GenericWorker"),Y=new Array(256),Q=0;Q<256;Q++)Y[Q]=252<=Q?6:248<=Q?5:240<=Q?4:224<=Q?3:192<=Q?2:1;Y[254]=Y[254]=1;function ee(){G.call(this,"utf-8 decode"),this.leftOver=null}function te(){G.call(this,"utf-8 encode")}j.utf8encode=function(Z){return V.nodebuffer?X.newBufferFrom(Z,"utf-8"):function(ne){var re,se,ie,oe,ue,ce=ne.length,ae=0;for(oe=0;oe<ce;oe++)(64512&(se=ne.charCodeAt(oe)))==55296&&oe+1<ce&&(64512&(ie=ne.charCodeAt(oe+1)))==56320&&(se=65536+(se-55296<<10)+(ie-56320),oe++),ae+=se<128?1:se<2048?2:se<65536?3:4;for(re=V.uint8array?new Uint8Array(ae):new Array(ae),oe=ue=0;ue<ae;oe++)(64512&(se=ne.charCodeAt(oe)))==55296&&oe+1<ce&&(64512&(ie=ne.charCodeAt(oe+1)))==56320&&(se=65536+(se-55296<<10)+(ie-56320),oe++),se<128?re[ue++]=se:(se<2048?re[ue++]=192|se>>>6:(se<65536?re[ue++]=224|se>>>12:(re[ue++]=240|se>>>18,re[ue++]=128|se>>>12&63),re[ue++]=128|se>>>6&63),re[ue++]=128|63&se);return re}(Z)},j.utf8decode=function(Z){return V.nodebuffer?z.transformTo("nodebuffer",Z).toString("utf-8"):function(ne){var re,se,ie,oe,ue=ne.length,ce=new Array(2*ue);for(re=se=0;re<ue;)if((ie=ne[re++])<128)ce[se++]=ie;else if(4<(oe=Y[ie]))ce[se++]=65533,re+=oe-1;else{for(ie&=oe===2?31:oe===3?15:7;1<oe&&re<ue;)ie=ie<<6|63&ne[re++],oe--;1<oe?ce[se++]=65533:ie<65536?ce[se++]=ie:(ie-=65536,ce[se++]=55296|ie>>10&1023,ce[se++]=56320|1023&ie)}return ce.length!==se&&(ce.subarray?ce=ce.subarray(0,se):ce.length=se),z.applyFromCharCode(ce)}(Z=z.transformTo(V.uint8array?"uint8array":"array",Z))},z.inherits(ee,G),ee.prototype.processChunk=function(Z){var ne=z.transformTo(V.uint8array?"uint8array":"array",Z.data);if(this.leftOver&&this.leftOver.length){if(V.uint8array){var re=ne;(ne=new Uint8Array(re.length+this.leftOver.length)).set(this.leftOver,0),ne.set(re,this.leftOver.length)}else ne=this.leftOver.concat(ne);this.leftOver=null}var se=function(oe,ue){var ce;for((ue=ue||oe.length)>oe.length&&(ue=oe.length),ce=ue-1;0<=ce&&(192&oe[ce])==128;)ce--;return ce<0||ce===0?ue:ce+Y[oe[ce]]>ue?ce:ue}(ne),ie=ne;se!==ne.length&&(V.uint8array?(ie=ne.subarray(0,se),this.leftOver=ne.subarray(se,ne.length)):(ie=ne.slice(0,se),this.leftOver=ne.slice(se,ne.length))),this.push({data:j.utf8decode(ie),meta:Z.meta})},ee.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:j.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},j.Utf8DecodeWorker=ee,z.inherits(te,G),te.prototype.processChunk=function(Z){this.push({data:j.utf8encode(Z.data),meta:Z.meta})},j.Utf8EncodeWorker=te},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(M,$,j){var z=M("./support"),V=M("./base64"),X=M("./nodejsUtils"),G=M("./external");function Y(re){return re}function Q(re,se){for(var ie=0;ie<re.length;++ie)se[ie]=255&re.charCodeAt(ie);return se}M("setimmediate"),j.newBlob=function(re,se){j.checkSupport("blob");try{return new Blob([re],{type:se})}catch{try{var ie=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return ie.append(re),ie.getBlob(se)}catch{throw new Error("Bug : can't construct the Blob.")}}};var ee={stringifyByChunk:function(re,se,ie){var oe=[],ue=0,ce=re.length;if(ce<=ie)return String.fromCharCode.apply(null,re);for(;ue<ce;)se==="array"||se==="nodebuffer"?oe.push(String.fromCharCode.apply(null,re.slice(ue,Math.min(ue+ie,ce)))):oe.push(String.fromCharCode.apply(null,re.subarray(ue,Math.min(ue+ie,ce)))),ue+=ie;return oe.join("")},stringifyByChar:function(re){for(var se="",ie=0;ie<re.length;ie++)se+=String.fromCharCode(re[ie]);return se},applyCanBeUsed:{uint8array:function(){try{return z.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return z.nodebuffer&&String.fromCharCode.apply(null,X.allocBuffer(1)).length===1}catch{return!1}}()}};function te(re){var se=65536,ie=j.getTypeOf(re),oe=!0;if(ie==="uint8array"?oe=ee.applyCanBeUsed.uint8array:ie==="nodebuffer"&&(oe=ee.applyCanBeUsed.nodebuffer),oe)for(;1<se;)try{return ee.stringifyByChunk(re,ie,se)}catch{se=Math.floor(se/2)}return ee.stringifyByChar(re)}function Z(re,se){for(var ie=0;ie<re.length;ie++)se[ie]=re[ie];return se}j.applyFromCharCode=te;var ne={};ne.string={string:Y,array:function(re){return Q(re,new Array(re.length))},arraybuffer:function(re){return ne.string.uint8array(re).buffer},uint8array:function(re){return Q(re,new Uint8Array(re.length))},nodebuffer:function(re){return Q(re,X.allocBuffer(re.length))}},ne.array={string:te,array:Y,arraybuffer:function(re){return new Uint8Array(re).buffer},uint8array:function(re){return new Uint8Array(re)},nodebuffer:function(re){return X.newBufferFrom(re)}},ne.arraybuffer={string:function(re){return te(new Uint8Array(re))},array:function(re){return Z(new Uint8Array(re),new Array(re.byteLength))},arraybuffer:Y,uint8array:function(re){return new Uint8Array(re)},nodebuffer:function(re){return X.newBufferFrom(new Uint8Array(re))}},ne.uint8array={string:te,array:function(re){return Z(re,new Array(re.length))},arraybuffer:function(re){return re.buffer},uint8array:Y,nodebuffer:function(re){return X.newBufferFrom(re)}},ne.nodebuffer={string:te,array:function(re){return Z(re,new Array(re.length))},arraybuffer:function(re){return ne.nodebuffer.uint8array(re).buffer},uint8array:function(re){return Z(re,new Uint8Array(re.length))},nodebuffer:Y},j.transformTo=function(re,se){if(se=se||"",!re)return se;j.checkSupport(re);var ie=j.getTypeOf(se);return ne[ie][re](se)},j.resolve=function(re){for(var se=re.split("/"),ie=[],oe=0;oe<se.length;oe++){var ue=se[oe];ue==="."||ue===""&&oe!==0&&oe!==se.length-1||(ue===".."?ie.pop():ie.push(ue))}return ie.join("/")},j.getTypeOf=function(re){return typeof re=="string"?"string":Object.prototype.toString.call(re)==="[object Array]"?"array":z.nodebuffer&&X.isBuffer(re)?"nodebuffer":z.uint8array&&re instanceof Uint8Array?"uint8array":z.arraybuffer&&re instanceof ArrayBuffer?"arraybuffer":void 0},j.checkSupport=function(re){if(!z[re.toLowerCase()])throw new Error(re+" is not supported by this platform")},j.MAX_VALUE_16BITS=65535,j.MAX_VALUE_32BITS=-1,j.pretty=function(re){var se,ie,oe="";for(ie=0;ie<(re||"").length;ie++)oe+="\\x"+((se=re.charCodeAt(ie))<16?"0":"")+se.toString(16).toUpperCase();return oe},j.delay=function(re,se,ie){setImmediate(function(){re.apply(ie||null,se||[])})},j.inherits=function(re,se){function ie(){}ie.prototype=se.prototype,re.prototype=new ie},j.extend=function(){var re,se,ie={};for(re=0;re<arguments.length;re++)for(se in arguments[re])Object.prototype.hasOwnProperty.call(arguments[re],se)&&ie[se]===void 0&&(ie[se]=arguments[re][se]);return ie},j.prepareContent=function(re,se,ie,oe,ue){return G.Promise.resolve(se).then(function(ce){return z.blob&&(ce instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(ce))!==-1)&&typeof FileReader<"u"?new G.Promise(function(ae,le){var he=new FileReader;he.onload=function(ge){ae(ge.target.result)},he.onerror=function(ge){le(ge.target.error)},he.readAsArrayBuffer(ce)}):ce}).then(function(ce){var ae=j.getTypeOf(ce);return ae?(ae==="arraybuffer"?ce=j.transformTo("uint8array",ce):ae==="string"&&(ue?ce=V.decode(ce):ie&&oe!==!0&&(ce=function(le){return Q(le,z.uint8array?new Uint8Array(le.length):new Array(le.length))}(ce))),ce):G.Promise.reject(new Error("Can't read the data of '"+re+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(M,$,j){var z=M("./reader/readerFor"),V=M("./utils"),X=M("./signature"),G=M("./zipEntry"),Y=M("./support");function Q(ee){this.files=[],this.loadOptions=ee}Q.prototype={checkSignature:function(ee){if(!this.reader.readAndCheckSignature(ee)){this.reader.index-=4;var te=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+V.pretty(te)+", expected "+V.pretty(ee)+")")}},isSignature:function(ee,te){var Z=this.reader.index;this.reader.setIndex(ee);var ne=this.reader.readString(4)===te;return this.reader.setIndex(Z),ne},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var ee=this.reader.readData(this.zipCommentLength),te=Y.uint8array?"uint8array":"array",Z=V.transformTo(te,ee);this.zipComment=this.loadOptions.decodeFileName(Z)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var ee,te,Z,ne=this.zip64EndOfCentralSize-44;0<ne;)ee=this.reader.readInt(2),te=this.reader.readInt(4),Z=this.reader.readData(te),this.zip64ExtensibleData[ee]={id:ee,length:te,value:Z}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var ee,te;for(ee=0;ee<this.files.length;ee++)te=this.files[ee],this.reader.setIndex(te.localHeaderOffset),this.checkSignature(X.LOCAL_FILE_HEADER),te.readLocalPart(this.reader),te.handleUTF8(),te.processAttributes()},readCentralDir:function(){var ee;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(X.CENTRAL_FILE_HEADER);)(ee=new G({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(ee);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var ee=this.reader.lastIndexOfSignature(X.CENTRAL_DIRECTORY_END);if(ee<0)throw this.isSignature(0,X.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(ee);var te=ee;if(this.checkSignature(X.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===V.MAX_VALUE_16BITS||this.diskWithCentralDirStart===V.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===V.MAX_VALUE_16BITS||this.centralDirRecords===V.MAX_VALUE_16BITS||this.centralDirSize===V.MAX_VALUE_32BITS||this.centralDirOffset===V.MAX_VALUE_32BITS){if(this.zip64=!0,(ee=this.reader.lastIndexOfSignature(X.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(ee),this.checkSignature(X.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,X.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(X.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(X.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var Z=this.centralDirOffset+this.centralDirSize;this.zip64&&(Z+=20,Z+=12+this.zip64EndOfCentralSize);var ne=te-Z;if(0<ne)this.isSignature(te,X.CENTRAL_FILE_HEADER)||(this.reader.zero=ne);else if(ne<0)throw new Error("Corrupted zip: missing "+Math.abs(ne)+" bytes.")},prepareReader:function(ee){this.reader=z(ee)},load:function(ee){this.prepareReader(ee),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},$.exports=Q},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(M,$,j){var z=M("./reader/readerFor"),V=M("./utils"),X=M("./compressedObject"),G=M("./crc32"),Y=M("./utf8"),Q=M("./compressions"),ee=M("./support");function te(Z,ne){this.options=Z,this.loadOptions=ne}te.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(Z){var ne,re;if(Z.skip(22),this.fileNameLength=Z.readInt(2),re=Z.readInt(2),this.fileName=Z.readData(this.fileNameLength),Z.skip(re),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((ne=function(se){for(var ie in Q)if(Object.prototype.hasOwnProperty.call(Q,ie)&&Q[ie].magic===se)return Q[ie];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+V.pretty(this.compressionMethod)+" unknown (inner file : "+V.transformTo("string",this.fileName)+")");this.decompressed=new X(this.compressedSize,this.uncompressedSize,this.crc32,ne,Z.readData(this.compressedSize))},readCentralPart:function(Z){this.versionMadeBy=Z.readInt(2),Z.skip(2),this.bitFlag=Z.readInt(2),this.compressionMethod=Z.readString(2),this.date=Z.readDate(),this.crc32=Z.readInt(4),this.compressedSize=Z.readInt(4),this.uncompressedSize=Z.readInt(4);var ne=Z.readInt(2);if(this.extraFieldsLength=Z.readInt(2),this.fileCommentLength=Z.readInt(2),this.diskNumberStart=Z.readInt(2),this.internalFileAttributes=Z.readInt(2),this.externalFileAttributes=Z.readInt(4),this.localHeaderOffset=Z.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");Z.skip(ne),this.readExtraFields(Z),this.parseZIP64ExtraField(Z),this.fileComment=Z.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var Z=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),Z==0&&(this.dosPermissions=63&this.externalFileAttributes),Z==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var Z=z(this.extraFields[1].value);this.uncompressedSize===V.MAX_VALUE_32BITS&&(this.uncompressedSize=Z.readInt(8)),this.compressedSize===V.MAX_VALUE_32BITS&&(this.compressedSize=Z.readInt(8)),this.localHeaderOffset===V.MAX_VALUE_32BITS&&(this.localHeaderOffset=Z.readInt(8)),this.diskNumberStart===V.MAX_VALUE_32BITS&&(this.diskNumberStart=Z.readInt(4))}},readExtraFields:function(Z){var ne,re,se,ie=Z.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});Z.index+4<ie;)ne=Z.readInt(2),re=Z.readInt(2),se=Z.readData(re),this.extraFields[ne]={id:ne,length:re,value:se};Z.setIndex(ie)},handleUTF8:function(){var Z=ee.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=Y.utf8decode(this.fileName),this.fileCommentStr=Y.utf8decode(this.fileComment);else{var ne=this.findExtraFieldUnicodePath();if(ne!==null)this.fileNameStr=ne;else{var re=V.transformTo(Z,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(re)}var se=this.findExtraFieldUnicodeComment();if(se!==null)this.fileCommentStr=se;else{var ie=V.transformTo(Z,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(ie)}}},findExtraFieldUnicodePath:function(){var Z=this.extraFields[28789];if(Z){var ne=z(Z.value);return ne.readInt(1)!==1||G(this.fileName)!==ne.readInt(4)?null:Y.utf8decode(ne.readData(Z.length-5))}return null},findExtraFieldUnicodeComment:function(){var Z=this.extraFields[25461];if(Z){var ne=z(Z.value);return ne.readInt(1)!==1||G(this.fileComment)!==ne.readInt(4)?null:Y.utf8decode(ne.readData(Z.length-5))}return null}},$.exports=te},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(M,$,j){function z(ne,re,se){this.name=ne,this.dir=se.dir,this.date=se.date,this.comment=se.comment,this.unixPermissions=se.unixPermissions,this.dosPermissions=se.dosPermissions,this._data=re,this._dataBinary=se.binary,this.options={compression:se.compression,compressionOptions:se.compressionOptions}}var V=M("./stream/StreamHelper"),X=M("./stream/DataWorker"),G=M("./utf8"),Y=M("./compressedObject"),Q=M("./stream/GenericWorker");z.prototype={internalStream:function(ne){var re=null,se="string";try{if(!ne)throw new Error("No output type specified.");var ie=(se=ne.toLowerCase())==="string"||se==="text";se!=="binarystring"&&se!=="text"||(se="string"),re=this._decompressWorker();var oe=!this._dataBinary;oe&&!ie&&(re=re.pipe(new G.Utf8EncodeWorker)),!oe&&ie&&(re=re.pipe(new G.Utf8DecodeWorker))}catch(ue){(re=new Q("error")).error(ue)}return new V(re,se,"")},async:function(ne,re){return this.internalStream(ne).accumulate(re)},nodeStream:function(ne,re){return this.internalStream(ne||"nodebuffer").toNodejsStream(re)},_compressWorker:function(ne,re){if(this._data instanceof Y&&this._data.compression.magic===ne.magic)return this._data.getCompressedWorker();var se=this._decompressWorker();return this._dataBinary||(se=se.pipe(new G.Utf8EncodeWorker)),Y.createWorkerFrom(se,ne,re)},_decompressWorker:function(){return this._data instanceof Y?this._data.getContentWorker():this._data instanceof Q?this._data:new X(this._data)}};for(var ee=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],te=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},Z=0;Z<ee.length;Z++)z.prototype[ee[Z]]=te;$.exports=z},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(M,$,j){(function(z){var V,X,G=z.MutationObserver||z.WebKitMutationObserver;if(G){var Y=0,Q=new G(ne),ee=z.document.createTextNode("");Q.observe(ee,{characterData:!0}),V=function(){ee.data=Y=++Y%2}}else if(z.setImmediate||z.MessageChannel===void 0)V="document"in z&&"onreadystatechange"in z.document.createElement("script")?function(){var re=z.document.createElement("script");re.onreadystatechange=function(){ne(),re.onreadystatechange=null,re.parentNode.removeChild(re),re=null},z.document.documentElement.appendChild(re)}:function(){setTimeout(ne,0)};else{var te=new z.MessageChannel;te.port1.onmessage=ne,V=function(){te.port2.postMessage(0)}}var Z=[];function ne(){var re,se;X=!0;for(var ie=Z.length;ie;){for(se=Z,Z=[],re=-1;++re<ie;)se[re]();ie=Z.length}X=!1}$.exports=function(re){Z.push(re)!==1||X||V()}}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(M,$,j){var z=M("immediate");function V(){}var X={},G=["REJECTED"],Y=["FULFILLED"],Q=["PENDING"];function ee(ie){if(typeof ie!="function")throw new TypeError("resolver must be a function");this.state=Q,this.queue=[],this.outcome=void 0,ie!==V&&re(this,ie)}function te(ie,oe,ue){this.promise=ie,typeof oe=="function"&&(this.onFulfilled=oe,this.callFulfilled=this.otherCallFulfilled),typeof ue=="function"&&(this.onRejected=ue,this.callRejected=this.otherCallRejected)}function Z(ie,oe,ue){z(function(){var ce;try{ce=oe(ue)}catch(ae){return X.reject(ie,ae)}ce===ie?X.reject(ie,new TypeError("Cannot resolve promise with itself")):X.resolve(ie,ce)})}function ne(ie){var oe=ie&&ie.then;if(ie&&(typeof ie=="object"||typeof ie=="function")&&typeof oe=="function")return function(){oe.apply(ie,arguments)}}function re(ie,oe){var ue=!1;function ce(he){ue||(ue=!0,X.reject(ie,he))}function ae(he){ue||(ue=!0,X.resolve(ie,he))}var le=se(function(){oe(ae,ce)});le.status==="error"&&ce(le.value)}function se(ie,oe){var ue={};try{ue.value=ie(oe),ue.status="success"}catch(ce){ue.status="error",ue.value=ce}return ue}($.exports=ee).prototype.finally=function(ie){if(typeof ie!="function")return this;var oe=this.constructor;return this.then(function(ue){return oe.resolve(ie()).then(function(){return ue})},function(ue){return oe.resolve(ie()).then(function(){throw ue})})},ee.prototype.catch=function(ie){return this.then(null,ie)},ee.prototype.then=function(ie,oe){if(typeof ie!="function"&&this.state===Y||typeof oe!="function"&&this.state===G)return this;var ue=new this.constructor(V);return this.state!==Q?Z(ue,this.state===Y?ie:oe,this.outcome):this.queue.push(new te(ue,ie,oe)),ue},te.prototype.callFulfilled=function(ie){X.resolve(this.promise,ie)},te.prototype.otherCallFulfilled=function(ie){Z(this.promise,this.onFulfilled,ie)},te.prototype.callRejected=function(ie){X.reject(this.promise,ie)},te.prototype.otherCallRejected=function(ie){Z(this.promise,this.onRejected,ie)},X.resolve=function(ie,oe){var ue=se(ne,oe);if(ue.status==="error")return X.reject(ie,ue.value);var ce=ue.value;if(ce)re(ie,ce);else{ie.state=Y,ie.outcome=oe;for(var ae=-1,le=ie.queue.length;++ae<le;)ie.queue[ae].callFulfilled(oe)}return ie},X.reject=function(ie,oe){ie.state=G,ie.outcome=oe;for(var ue=-1,ce=ie.queue.length;++ue<ce;)ie.queue[ue].callRejected(oe);return ie},ee.resolve=function(ie){return ie instanceof this?ie:X.resolve(new this(V),ie)},ee.reject=function(ie){var oe=new this(V);return X.reject(oe,ie)},ee.all=function(ie){var oe=this;if(Object.prototype.toString.call(ie)!=="[object Array]")return this.reject(new TypeError("must be an array"));var ue=ie.length,ce=!1;if(!ue)return this.resolve([]);for(var ae=new Array(ue),le=0,he=-1,ge=new this(V);++he<ue;)de(ie[he],he);return ge;function de(pe,ye){oe.resolve(pe).then(function(_e){ae[ye]=_e,++le!==ue||ce||(ce=!0,X.resolve(ge,ae))},function(_e){ce||(ce=!0,X.reject(ge,_e))})}},ee.race=function(ie){var oe=this;if(Object.prototype.toString.call(ie)!=="[object Array]")return this.reject(new TypeError("must be an array"));var ue=ie.length,ce=!1;if(!ue)return this.resolve([]);for(var ae=-1,le=new this(V);++ae<ue;)he=ie[ae],oe.resolve(he).then(function(ge){ce||(ce=!0,X.resolve(le,ge))},function(ge){ce||(ce=!0,X.reject(le,ge))});var he;return le}},{immediate:36}],38:[function(M,$,j){var z={};(0,M("./lib/utils/common").assign)(z,M("./lib/deflate"),M("./lib/inflate"),M("./lib/zlib/constants")),$.exports=z},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(M,$,j){var z=M("./zlib/deflate"),V=M("./utils/common"),X=M("./utils/strings"),G=M("./zlib/messages"),Y=M("./zlib/zstream"),Q=Object.prototype.toString,ee=0,te=-1,Z=0,ne=8;function re(ie){if(!(this instanceof re))return new re(ie);this.options=V.assign({level:te,method:ne,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z,to:""},ie||{});var oe=this.options;oe.raw&&0<oe.windowBits?oe.windowBits=-oe.windowBits:oe.gzip&&0<oe.windowBits&&oe.windowBits<16&&(oe.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Y,this.strm.avail_out=0;var ue=z.deflateInit2(this.strm,oe.level,oe.method,oe.windowBits,oe.memLevel,oe.strategy);if(ue!==ee)throw new Error(G[ue]);if(oe.header&&z.deflateSetHeader(this.strm,oe.header),oe.dictionary){var ce;if(ce=typeof oe.dictionary=="string"?X.string2buf(oe.dictionary):Q.call(oe.dictionary)==="[object ArrayBuffer]"?new Uint8Array(oe.dictionary):oe.dictionary,(ue=z.deflateSetDictionary(this.strm,ce))!==ee)throw new Error(G[ue]);this._dict_set=!0}}function se(ie,oe){var ue=new re(oe);if(ue.push(ie,!0),ue.err)throw ue.msg||G[ue.err];return ue.result}re.prototype.push=function(ie,oe){var ue,ce,ae=this.strm,le=this.options.chunkSize;if(this.ended)return!1;ce=oe===~~oe?oe:oe===!0?4:0,typeof ie=="string"?ae.input=X.string2buf(ie):Q.call(ie)==="[object ArrayBuffer]"?ae.input=new Uint8Array(ie):ae.input=ie,ae.next_in=0,ae.avail_in=ae.input.length;do{if(ae.avail_out===0&&(ae.output=new V.Buf8(le),ae.next_out=0,ae.avail_out=le),(ue=z.deflate(ae,ce))!==1&&ue!==ee)return this.onEnd(ue),!(this.ended=!0);ae.avail_out!==0&&(ae.avail_in!==0||ce!==4&&ce!==2)||(this.options.to==="string"?this.onData(X.buf2binstring(V.shrinkBuf(ae.output,ae.next_out))):this.onData(V.shrinkBuf(ae.output,ae.next_out)))}while((0<ae.avail_in||ae.avail_out===0)&&ue!==1);return ce===4?(ue=z.deflateEnd(this.strm),this.onEnd(ue),this.ended=!0,ue===ee):ce!==2||(this.onEnd(ee),!(ae.avail_out=0))},re.prototype.onData=function(ie){this.chunks.push(ie)},re.prototype.onEnd=function(ie){ie===ee&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=V.flattenChunks(this.chunks)),this.chunks=[],this.err=ie,this.msg=this.strm.msg},j.Deflate=re,j.deflate=se,j.deflateRaw=function(ie,oe){return(oe=oe||{}).raw=!0,se(ie,oe)},j.gzip=function(ie,oe){return(oe=oe||{}).gzip=!0,se(ie,oe)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(M,$,j){var z=M("./zlib/inflate"),V=M("./utils/common"),X=M("./utils/strings"),G=M("./zlib/constants"),Y=M("./zlib/messages"),Q=M("./zlib/zstream"),ee=M("./zlib/gzheader"),te=Object.prototype.toString;function Z(re){if(!(this instanceof Z))return new Z(re);this.options=V.assign({chunkSize:16384,windowBits:0,to:""},re||{});var se=this.options;se.raw&&0<=se.windowBits&&se.windowBits<16&&(se.windowBits=-se.windowBits,se.windowBits===0&&(se.windowBits=-15)),!(0<=se.windowBits&&se.windowBits<16)||re&&re.windowBits||(se.windowBits+=32),15<se.windowBits&&se.windowBits<48&&!(15&se.windowBits)&&(se.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Q,this.strm.avail_out=0;var ie=z.inflateInit2(this.strm,se.windowBits);if(ie!==G.Z_OK)throw new Error(Y[ie]);this.header=new ee,z.inflateGetHeader(this.strm,this.header)}function ne(re,se){var ie=new Z(se);if(ie.push(re,!0),ie.err)throw ie.msg||Y[ie.err];return ie.result}Z.prototype.push=function(re,se){var ie,oe,ue,ce,ae,le,he=this.strm,ge=this.options.chunkSize,de=this.options.dictionary,pe=!1;if(this.ended)return!1;oe=se===~~se?se:se===!0?G.Z_FINISH:G.Z_NO_FLUSH,typeof re=="string"?he.input=X.binstring2buf(re):te.call(re)==="[object ArrayBuffer]"?he.input=new Uint8Array(re):he.input=re,he.next_in=0,he.avail_in=he.input.length;do{if(he.avail_out===0&&(he.output=new V.Buf8(ge),he.next_out=0,he.avail_out=ge),(ie=z.inflate(he,G.Z_NO_FLUSH))===G.Z_NEED_DICT&&de&&(le=typeof de=="string"?X.string2buf(de):te.call(de)==="[object ArrayBuffer]"?new Uint8Array(de):de,ie=z.inflateSetDictionary(this.strm,le)),ie===G.Z_BUF_ERROR&&pe===!0&&(ie=G.Z_OK,pe=!1),ie!==G.Z_STREAM_END&&ie!==G.Z_OK)return this.onEnd(ie),!(this.ended=!0);he.next_out&&(he.avail_out!==0&&ie!==G.Z_STREAM_END&&(he.avail_in!==0||oe!==G.Z_FINISH&&oe!==G.Z_SYNC_FLUSH)||(this.options.to==="string"?(ue=X.utf8border(he.output,he.next_out),ce=he.next_out-ue,ae=X.buf2string(he.output,ue),he.next_out=ce,he.avail_out=ge-ce,ce&&V.arraySet(he.output,he.output,ue,ce,0),this.onData(ae)):this.onData(V.shrinkBuf(he.output,he.next_out)))),he.avail_in===0&&he.avail_out===0&&(pe=!0)}while((0<he.avail_in||he.avail_out===0)&&ie!==G.Z_STREAM_END);return ie===G.Z_STREAM_END&&(oe=G.Z_FINISH),oe===G.Z_FINISH?(ie=z.inflateEnd(this.strm),this.onEnd(ie),this.ended=!0,ie===G.Z_OK):oe!==G.Z_SYNC_FLUSH||(this.onEnd(G.Z_OK),!(he.avail_out=0))},Z.prototype.onData=function(re){this.chunks.push(re)},Z.prototype.onEnd=function(re){re===G.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=V.flattenChunks(this.chunks)),this.chunks=[],this.err=re,this.msg=this.strm.msg},j.Inflate=Z,j.inflate=ne,j.inflateRaw=function(re,se){return(se=se||{}).raw=!0,ne(re,se)},j.ungzip=ne},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(M,$,j){var z=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";j.assign=function(G){for(var Y=Array.prototype.slice.call(arguments,1);Y.length;){var Q=Y.shift();if(Q){if(typeof Q!="object")throw new TypeError(Q+"must be non-object");for(var ee in Q)Q.hasOwnProperty(ee)&&(G[ee]=Q[ee])}}return G},j.shrinkBuf=function(G,Y){return G.length===Y?G:G.subarray?G.subarray(0,Y):(G.length=Y,G)};var V={arraySet:function(G,Y,Q,ee,te){if(Y.subarray&&G.subarray)G.set(Y.subarray(Q,Q+ee),te);else for(var Z=0;Z<ee;Z++)G[te+Z]=Y[Q+Z]},flattenChunks:function(G){var Y,Q,ee,te,Z,ne;for(Y=ee=0,Q=G.length;Y<Q;Y++)ee+=G[Y].length;for(ne=new Uint8Array(ee),Y=te=0,Q=G.length;Y<Q;Y++)Z=G[Y],ne.set(Z,te),te+=Z.length;return ne}},X={arraySet:function(G,Y,Q,ee,te){for(var Z=0;Z<ee;Z++)G[te+Z]=Y[Q+Z]},flattenChunks:function(G){return[].concat.apply([],G)}};j.setTyped=function(G){G?(j.Buf8=Uint8Array,j.Buf16=Uint16Array,j.Buf32=Int32Array,j.assign(j,V)):(j.Buf8=Array,j.Buf16=Array,j.Buf32=Array,j.assign(j,X))},j.setTyped(z)},{}],42:[function(M,$,j){var z=M("./common"),V=!0,X=!0;try{String.fromCharCode.apply(null,[0])}catch{V=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{X=!1}for(var G=new z.Buf8(256),Y=0;Y<256;Y++)G[Y]=252<=Y?6:248<=Y?5:240<=Y?4:224<=Y?3:192<=Y?2:1;function Q(ee,te){if(te<65537&&(ee.subarray&&X||!ee.subarray&&V))return String.fromCharCode.apply(null,z.shrinkBuf(ee,te));for(var Z="",ne=0;ne<te;ne++)Z+=String.fromCharCode(ee[ne]);return Z}G[254]=G[254]=1,j.string2buf=function(ee){var te,Z,ne,re,se,ie=ee.length,oe=0;for(re=0;re<ie;re++)(64512&(Z=ee.charCodeAt(re)))==55296&&re+1<ie&&(64512&(ne=ee.charCodeAt(re+1)))==56320&&(Z=65536+(Z-55296<<10)+(ne-56320),re++),oe+=Z<128?1:Z<2048?2:Z<65536?3:4;for(te=new z.Buf8(oe),re=se=0;se<oe;re++)(64512&(Z=ee.charCodeAt(re)))==55296&&re+1<ie&&(64512&(ne=ee.charCodeAt(re+1)))==56320&&(Z=65536+(Z-55296<<10)+(ne-56320),re++),Z<128?te[se++]=Z:(Z<2048?te[se++]=192|Z>>>6:(Z<65536?te[se++]=224|Z>>>12:(te[se++]=240|Z>>>18,te[se++]=128|Z>>>12&63),te[se++]=128|Z>>>6&63),te[se++]=128|63&Z);return te},j.buf2binstring=function(ee){return Q(ee,ee.length)},j.binstring2buf=function(ee){for(var te=new z.Buf8(ee.length),Z=0,ne=te.length;Z<ne;Z++)te[Z]=ee.charCodeAt(Z);return te},j.buf2string=function(ee,te){var Z,ne,re,se,ie=te||ee.length,oe=new Array(2*ie);for(Z=ne=0;Z<ie;)if((re=ee[Z++])<128)oe[ne++]=re;else if(4<(se=G[re]))oe[ne++]=65533,Z+=se-1;else{for(re&=se===2?31:se===3?15:7;1<se&&Z<ie;)re=re<<6|63&ee[Z++],se--;1<se?oe[ne++]=65533:re<65536?oe[ne++]=re:(re-=65536,oe[ne++]=55296|re>>10&1023,oe[ne++]=56320|1023&re)}return Q(oe,ne)},j.utf8border=function(ee,te){var Z;for((te=te||ee.length)>ee.length&&(te=ee.length),Z=te-1;0<=Z&&(192&ee[Z])==128;)Z--;return Z<0||Z===0?te:Z+G[ee[Z]]>te?Z:te}},{"./common":41}],43:[function(M,$,j){$.exports=function(z,V,X,G){for(var Y=65535&z|0,Q=z>>>16&65535|0,ee=0;X!==0;){for(X-=ee=2e3<X?2e3:X;Q=Q+(Y=Y+V[G++]|0)|0,--ee;);Y%=65521,Q%=65521}return Y|Q<<16|0}},{}],44:[function(M,$,j){$.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(M,$,j){var z=function(){for(var V,X=[],G=0;G<256;G++){V=G;for(var Y=0;Y<8;Y++)V=1&V?3988292384^V>>>1:V>>>1;X[G]=V}return X}();$.exports=function(V,X,G,Y){var Q=z,ee=Y+G;V^=-1;for(var te=Y;te<ee;te++)V=V>>>8^Q[255&(V^X[te])];return-1^V}},{}],46:[function(M,$,j){var z,V=M("../utils/common"),X=M("./trees"),G=M("./adler32"),Y=M("./crc32"),Q=M("./messages"),ee=0,te=4,Z=0,ne=-2,re=-1,se=4,ie=2,oe=8,ue=9,ce=286,ae=30,le=19,he=2*ce+1,ge=15,de=3,pe=258,ye=pe+de+1,_e=42,De=113,fe=1,Ae=2,Me=3,Ee=4;function Te(me,We){return me.msg=Q[We],We}function Be(me){return(me<<1)-(4<me?9:0)}function Xe(me){for(var We=me.length;0<=--We;)me[We]=0}function ze(me){var We=me.state,Ye=We.pending;Ye>me.avail_out&&(Ye=me.avail_out),Ye!==0&&(V.arraySet(me.output,We.pending_buf,We.pending_out,Ye,me.next_out),me.next_out+=Ye,We.pending_out+=Ye,me.total_out+=Ye,me.avail_out-=Ye,We.pending-=Ye,We.pending===0&&(We.pending_out=0))}function Oe(me,We){X._tr_flush_block(me,0<=me.block_start?me.block_start:-1,me.strstart-me.block_start,We),me.block_start=me.strstart,ze(me.strm)}function Pe(me,We){me.pending_buf[me.pending++]=We}function ve(me,We){me.pending_buf[me.pending++]=We>>>8&255,me.pending_buf[me.pending++]=255&We}function be(me,We){var Ye,Fe,xe=me.max_chain_length,$e=me.strstart,Je=me.prev_length,ut=me.nice_match,qe=me.strstart>me.w_size-ye?me.strstart-(me.w_size-ye):0,Ge=me.window,Ke=me.w_mask,et=me.prev,ct=me.strstart+pe,mt=Ge[$e+Je-1],_t=Ge[$e+Je];me.prev_length>=me.good_match&&(xe>>=2),ut>me.lookahead&&(ut=me.lookahead);do if(Ge[(Ye=We)+Je]===_t&&Ge[Ye+Je-1]===mt&&Ge[Ye]===Ge[$e]&&Ge[++Ye]===Ge[$e+1]){$e+=2,Ye++;do;while(Ge[++$e]===Ge[++Ye]&&Ge[++$e]===Ge[++Ye]&&Ge[++$e]===Ge[++Ye]&&Ge[++$e]===Ge[++Ye]&&Ge[++$e]===Ge[++Ye]&&Ge[++$e]===Ge[++Ye]&&Ge[++$e]===Ge[++Ye]&&Ge[++$e]===Ge[++Ye]&&$e<ct);if(Fe=pe-(ct-$e),$e=ct-pe,Je<Fe){if(me.match_start=We,ut<=(Je=Fe))break;mt=Ge[$e+Je-1],_t=Ge[$e+Je]}}while((We=et[We&Ke])>qe&&--xe!=0);return Je<=me.lookahead?Je:me.lookahead}function Ce(me){var We,Ye,Fe,xe,$e,Je,ut,qe,Ge,Ke,et=me.w_size;do{if(xe=me.window_size-me.lookahead-me.strstart,me.strstart>=et+(et-ye)){for(V.arraySet(me.window,me.window,et,et,0),me.match_start-=et,me.strstart-=et,me.block_start-=et,We=Ye=me.hash_size;Fe=me.head[--We],me.head[We]=et<=Fe?Fe-et:0,--Ye;);for(We=Ye=et;Fe=me.prev[--We],me.prev[We]=et<=Fe?Fe-et:0,--Ye;);xe+=et}if(me.strm.avail_in===0)break;if(Je=me.strm,ut=me.window,qe=me.strstart+me.lookahead,Ge=xe,Ke=void 0,Ke=Je.avail_in,Ge<Ke&&(Ke=Ge),Ye=Ke===0?0:(Je.avail_in-=Ke,V.arraySet(ut,Je.input,Je.next_in,Ke,qe),Je.state.wrap===1?Je.adler=G(Je.adler,ut,Ke,qe):Je.state.wrap===2&&(Je.adler=Y(Je.adler,ut,Ke,qe)),Je.next_in+=Ke,Je.total_in+=Ke,Ke),me.lookahead+=Ye,me.lookahead+me.insert>=de)for($e=me.strstart-me.insert,me.ins_h=me.window[$e],me.ins_h=(me.ins_h<<me.hash_shift^me.window[$e+1])&me.hash_mask;me.insert&&(me.ins_h=(me.ins_h<<me.hash_shift^me.window[$e+de-1])&me.hash_mask,me.prev[$e&me.w_mask]=me.head[me.ins_h],me.head[me.ins_h]=$e,$e++,me.insert--,!(me.lookahead+me.insert<de)););}while(me.lookahead<ye&&me.strm.avail_in!==0)}function Ne(me,We){for(var Ye,Fe;;){if(me.lookahead<ye){if(Ce(me),me.lookahead<ye&&We===ee)return fe;if(me.lookahead===0)break}if(Ye=0,me.lookahead>=de&&(me.ins_h=(me.ins_h<<me.hash_shift^me.window[me.strstart+de-1])&me.hash_mask,Ye=me.prev[me.strstart&me.w_mask]=me.head[me.ins_h],me.head[me.ins_h]=me.strstart),Ye!==0&&me.strstart-Ye<=me.w_size-ye&&(me.match_length=be(me,Ye)),me.match_length>=de)if(Fe=X._tr_tally(me,me.strstart-me.match_start,me.match_length-de),me.lookahead-=me.match_length,me.match_length<=me.max_lazy_match&&me.lookahead>=de){for(me.match_length--;me.strstart++,me.ins_h=(me.ins_h<<me.hash_shift^me.window[me.strstart+de-1])&me.hash_mask,Ye=me.prev[me.strstart&me.w_mask]=me.head[me.ins_h],me.head[me.ins_h]=me.strstart,--me.match_length!=0;);me.strstart++}else me.strstart+=me.match_length,me.match_length=0,me.ins_h=me.window[me.strstart],me.ins_h=(me.ins_h<<me.hash_shift^me.window[me.strstart+1])&me.hash_mask;else Fe=X._tr_tally(me,0,me.window[me.strstart]),me.lookahead--,me.strstart++;if(Fe&&(Oe(me,!1),me.strm.avail_out===0))return fe}return me.insert=me.strstart<de-1?me.strstart:de-1,We===te?(Oe(me,!0),me.strm.avail_out===0?Me:Ee):me.last_lit&&(Oe(me,!1),me.strm.avail_out===0)?fe:Ae}function Ie(me,We){for(var Ye,Fe,xe;;){if(me.lookahead<ye){if(Ce(me),me.lookahead<ye&&We===ee)return fe;if(me.lookahead===0)break}if(Ye=0,me.lookahead>=de&&(me.ins_h=(me.ins_h<<me.hash_shift^me.window[me.strstart+de-1])&me.hash_mask,Ye=me.prev[me.strstart&me.w_mask]=me.head[me.ins_h],me.head[me.ins_h]=me.strstart),me.prev_length=me.match_length,me.prev_match=me.match_start,me.match_length=de-1,Ye!==0&&me.prev_length<me.max_lazy_match&&me.strstart-Ye<=me.w_size-ye&&(me.match_length=be(me,Ye),me.match_length<=5&&(me.strategy===1||me.match_length===de&&4096<me.strstart-me.match_start)&&(me.match_length=de-1)),me.prev_length>=de&&me.match_length<=me.prev_length){for(xe=me.strstart+me.lookahead-de,Fe=X._tr_tally(me,me.strstart-1-me.prev_match,me.prev_length-de),me.lookahead-=me.prev_length-1,me.prev_length-=2;++me.strstart<=xe&&(me.ins_h=(me.ins_h<<me.hash_shift^me.window[me.strstart+de-1])&me.hash_mask,Ye=me.prev[me.strstart&me.w_mask]=me.head[me.ins_h],me.head[me.ins_h]=me.strstart),--me.prev_length!=0;);if(me.match_available=0,me.match_length=de-1,me.strstart++,Fe&&(Oe(me,!1),me.strm.avail_out===0))return fe}else if(me.match_available){if((Fe=X._tr_tally(me,0,me.window[me.strstart-1]))&&Oe(me,!1),me.strstart++,me.lookahead--,me.strm.avail_out===0)return fe}else me.match_available=1,me.strstart++,me.lookahead--}return me.match_available&&(Fe=X._tr_tally(me,0,me.window[me.strstart-1]),me.match_available=0),me.insert=me.strstart<de-1?me.strstart:de-1,We===te?(Oe(me,!0),me.strm.avail_out===0?Me:Ee):me.last_lit&&(Oe(me,!1),me.strm.avail_out===0)?fe:Ae}function Le(me,We,Ye,Fe,xe){this.good_length=me,this.max_lazy=We,this.nice_length=Ye,this.max_chain=Fe,this.func=xe}function je(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=oe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new V.Buf16(2*he),this.dyn_dtree=new V.Buf16(2*(2*ae+1)),this.bl_tree=new V.Buf16(2*(2*le+1)),Xe(this.dyn_ltree),Xe(this.dyn_dtree),Xe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new V.Buf16(ge+1),this.heap=new V.Buf16(2*ce+1),Xe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new V.Buf16(2*ce+1),Xe(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ve(me){var We;return me&&me.state?(me.total_in=me.total_out=0,me.data_type=ie,(We=me.state).pending=0,We.pending_out=0,We.wrap<0&&(We.wrap=-We.wrap),We.status=We.wrap?_e:De,me.adler=We.wrap===2?0:1,We.last_flush=ee,X._tr_init(We),Z):Te(me,ne)}function ot(me){var We=Ve(me);return We===Z&&function(Ye){Ye.window_size=2*Ye.w_size,Xe(Ye.head),Ye.max_lazy_match=z[Ye.level].max_lazy,Ye.good_match=z[Ye.level].good_length,Ye.nice_match=z[Ye.level].nice_length,Ye.max_chain_length=z[Ye.level].max_chain,Ye.strstart=0,Ye.block_start=0,Ye.lookahead=0,Ye.insert=0,Ye.match_length=Ye.prev_length=de-1,Ye.match_available=0,Ye.ins_h=0}(me.state),We}function lt(me,We,Ye,Fe,xe,$e){if(!me)return ne;var Je=1;if(We===re&&(We=6),Fe<0?(Je=0,Fe=-Fe):15<Fe&&(Je=2,Fe-=16),xe<1||ue<xe||Ye!==oe||Fe<8||15<Fe||We<0||9<We||$e<0||se<$e)return Te(me,ne);Fe===8&&(Fe=9);var ut=new je;return(me.state=ut).strm=me,ut.wrap=Je,ut.gzhead=null,ut.w_bits=Fe,ut.w_size=1<<ut.w_bits,ut.w_mask=ut.w_size-1,ut.hash_bits=xe+7,ut.hash_size=1<<ut.hash_bits,ut.hash_mask=ut.hash_size-1,ut.hash_shift=~~((ut.hash_bits+de-1)/de),ut.window=new V.Buf8(2*ut.w_size),ut.head=new V.Buf16(ut.hash_size),ut.prev=new V.Buf16(ut.w_size),ut.lit_bufsize=1<<xe+6,ut.pending_buf_size=4*ut.lit_bufsize,ut.pending_buf=new V.Buf8(ut.pending_buf_size),ut.d_buf=1*ut.lit_bufsize,ut.l_buf=3*ut.lit_bufsize,ut.level=We,ut.strategy=$e,ut.method=Ye,ot(me)}z=[new Le(0,0,0,0,function(me,We){var Ye=65535;for(Ye>me.pending_buf_size-5&&(Ye=me.pending_buf_size-5);;){if(me.lookahead<=1){if(Ce(me),me.lookahead===0&&We===ee)return fe;if(me.lookahead===0)break}me.strstart+=me.lookahead,me.lookahead=0;var Fe=me.block_start+Ye;if((me.strstart===0||me.strstart>=Fe)&&(me.lookahead=me.strstart-Fe,me.strstart=Fe,Oe(me,!1),me.strm.avail_out===0)||me.strstart-me.block_start>=me.w_size-ye&&(Oe(me,!1),me.strm.avail_out===0))return fe}return me.insert=0,We===te?(Oe(me,!0),me.strm.avail_out===0?Me:Ee):(me.strstart>me.block_start&&(Oe(me,!1),me.strm.avail_out),fe)}),new Le(4,4,8,4,Ne),new Le(4,5,16,8,Ne),new Le(4,6,32,32,Ne),new Le(4,4,16,16,Ie),new Le(8,16,32,32,Ie),new Le(8,16,128,128,Ie),new Le(8,32,128,256,Ie),new Le(32,128,258,1024,Ie),new Le(32,258,258,4096,Ie)],j.deflateInit=function(me,We){return lt(me,We,oe,15,8,0)},j.deflateInit2=lt,j.deflateReset=ot,j.deflateResetKeep=Ve,j.deflateSetHeader=function(me,We){return me&&me.state?me.state.wrap!==2?ne:(me.state.gzhead=We,Z):ne},j.deflate=function(me,We){var Ye,Fe,xe,$e;if(!me||!me.state||5<We||We<0)return me?Te(me,ne):ne;if(Fe=me.state,!me.output||!me.input&&me.avail_in!==0||Fe.status===666&&We!==te)return Te(me,me.avail_out===0?-5:ne);if(Fe.strm=me,Ye=Fe.last_flush,Fe.last_flush=We,Fe.status===_e)if(Fe.wrap===2)me.adler=0,Pe(Fe,31),Pe(Fe,139),Pe(Fe,8),Fe.gzhead?(Pe(Fe,(Fe.gzhead.text?1:0)+(Fe.gzhead.hcrc?2:0)+(Fe.gzhead.extra?4:0)+(Fe.gzhead.name?8:0)+(Fe.gzhead.comment?16:0)),Pe(Fe,255&Fe.gzhead.time),Pe(Fe,Fe.gzhead.time>>8&255),Pe(Fe,Fe.gzhead.time>>16&255),Pe(Fe,Fe.gzhead.time>>24&255),Pe(Fe,Fe.level===9?2:2<=Fe.strategy||Fe.level<2?4:0),Pe(Fe,255&Fe.gzhead.os),Fe.gzhead.extra&&Fe.gzhead.extra.length&&(Pe(Fe,255&Fe.gzhead.extra.length),Pe(Fe,Fe.gzhead.extra.length>>8&255)),Fe.gzhead.hcrc&&(me.adler=Y(me.adler,Fe.pending_buf,Fe.pending,0)),Fe.gzindex=0,Fe.status=69):(Pe(Fe,0),Pe(Fe,0),Pe(Fe,0),Pe(Fe,0),Pe(Fe,0),Pe(Fe,Fe.level===9?2:2<=Fe.strategy||Fe.level<2?4:0),Pe(Fe,3),Fe.status=De);else{var Je=oe+(Fe.w_bits-8<<4)<<8;Je|=(2<=Fe.strategy||Fe.level<2?0:Fe.level<6?1:Fe.level===6?2:3)<<6,Fe.strstart!==0&&(Je|=32),Je+=31-Je%31,Fe.status=De,ve(Fe,Je),Fe.strstart!==0&&(ve(Fe,me.adler>>>16),ve(Fe,65535&me.adler)),me.adler=1}if(Fe.status===69)if(Fe.gzhead.extra){for(xe=Fe.pending;Fe.gzindex<(65535&Fe.gzhead.extra.length)&&(Fe.pending!==Fe.pending_buf_size||(Fe.gzhead.hcrc&&Fe.pending>xe&&(me.adler=Y(me.adler,Fe.pending_buf,Fe.pending-xe,xe)),ze(me),xe=Fe.pending,Fe.pending!==Fe.pending_buf_size));)Pe(Fe,255&Fe.gzhead.extra[Fe.gzindex]),Fe.gzindex++;Fe.gzhead.hcrc&&Fe.pending>xe&&(me.adler=Y(me.adler,Fe.pending_buf,Fe.pending-xe,xe)),Fe.gzindex===Fe.gzhead.extra.length&&(Fe.gzindex=0,Fe.status=73)}else Fe.status=73;if(Fe.status===73)if(Fe.gzhead.name){xe=Fe.pending;do{if(Fe.pending===Fe.pending_buf_size&&(Fe.gzhead.hcrc&&Fe.pending>xe&&(me.adler=Y(me.adler,Fe.pending_buf,Fe.pending-xe,xe)),ze(me),xe=Fe.pending,Fe.pending===Fe.pending_buf_size)){$e=1;break}$e=Fe.gzindex<Fe.gzhead.name.length?255&Fe.gzhead.name.charCodeAt(Fe.gzindex++):0,Pe(Fe,$e)}while($e!==0);Fe.gzhead.hcrc&&Fe.pending>xe&&(me.adler=Y(me.adler,Fe.pending_buf,Fe.pending-xe,xe)),$e===0&&(Fe.gzindex=0,Fe.status=91)}else Fe.status=91;if(Fe.status===91)if(Fe.gzhead.comment){xe=Fe.pending;do{if(Fe.pending===Fe.pending_buf_size&&(Fe.gzhead.hcrc&&Fe.pending>xe&&(me.adler=Y(me.adler,Fe.pending_buf,Fe.pending-xe,xe)),ze(me),xe=Fe.pending,Fe.pending===Fe.pending_buf_size)){$e=1;break}$e=Fe.gzindex<Fe.gzhead.comment.length?255&Fe.gzhead.comment.charCodeAt(Fe.gzindex++):0,Pe(Fe,$e)}while($e!==0);Fe.gzhead.hcrc&&Fe.pending>xe&&(me.adler=Y(me.adler,Fe.pending_buf,Fe.pending-xe,xe)),$e===0&&(Fe.status=103)}else Fe.status=103;if(Fe.status===103&&(Fe.gzhead.hcrc?(Fe.pending+2>Fe.pending_buf_size&&ze(me),Fe.pending+2<=Fe.pending_buf_size&&(Pe(Fe,255&me.adler),Pe(Fe,me.adler>>8&255),me.adler=0,Fe.status=De)):Fe.status=De),Fe.pending!==0){if(ze(me),me.avail_out===0)return Fe.last_flush=-1,Z}else if(me.avail_in===0&&Be(We)<=Be(Ye)&&We!==te)return Te(me,-5);if(Fe.status===666&&me.avail_in!==0)return Te(me,-5);if(me.avail_in!==0||Fe.lookahead!==0||We!==ee&&Fe.status!==666){var ut=Fe.strategy===2?function(qe,Ge){for(var Ke;;){if(qe.lookahead===0&&(Ce(qe),qe.lookahead===0)){if(Ge===ee)return fe;break}if(qe.match_length=0,Ke=X._tr_tally(qe,0,qe.window[qe.strstart]),qe.lookahead--,qe.strstart++,Ke&&(Oe(qe,!1),qe.strm.avail_out===0))return fe}return qe.insert=0,Ge===te?(Oe(qe,!0),qe.strm.avail_out===0?Me:Ee):qe.last_lit&&(Oe(qe,!1),qe.strm.avail_out===0)?fe:Ae}(Fe,We):Fe.strategy===3?function(qe,Ge){for(var Ke,et,ct,mt,_t=qe.window;;){if(qe.lookahead<=pe){if(Ce(qe),qe.lookahead<=pe&&Ge===ee)return fe;if(qe.lookahead===0)break}if(qe.match_length=0,qe.lookahead>=de&&0<qe.strstart&&(et=_t[ct=qe.strstart-1])===_t[++ct]&&et===_t[++ct]&&et===_t[++ct]){mt=qe.strstart+pe;do;while(et===_t[++ct]&&et===_t[++ct]&&et===_t[++ct]&&et===_t[++ct]&&et===_t[++ct]&&et===_t[++ct]&&et===_t[++ct]&&et===_t[++ct]&&ct<mt);qe.match_length=pe-(mt-ct),qe.match_length>qe.lookahead&&(qe.match_length=qe.lookahead)}if(qe.match_length>=de?(Ke=X._tr_tally(qe,1,qe.match_length-de),qe.lookahead-=qe.match_length,qe.strstart+=qe.match_length,qe.match_length=0):(Ke=X._tr_tally(qe,0,qe.window[qe.strstart]),qe.lookahead--,qe.strstart++),Ke&&(Oe(qe,!1),qe.strm.avail_out===0))return fe}return qe.insert=0,Ge===te?(Oe(qe,!0),qe.strm.avail_out===0?Me:Ee):qe.last_lit&&(Oe(qe,!1),qe.strm.avail_out===0)?fe:Ae}(Fe,We):z[Fe.level].func(Fe,We);if(ut!==Me&&ut!==Ee||(Fe.status=666),ut===fe||ut===Me)return me.avail_out===0&&(Fe.last_flush=-1),Z;if(ut===Ae&&(We===1?X._tr_align(Fe):We!==5&&(X._tr_stored_block(Fe,0,0,!1),We===3&&(Xe(Fe.head),Fe.lookahead===0&&(Fe.strstart=0,Fe.block_start=0,Fe.insert=0))),ze(me),me.avail_out===0))return Fe.last_flush=-1,Z}return We!==te?Z:Fe.wrap<=0?1:(Fe.wrap===2?(Pe(Fe,255&me.adler),Pe(Fe,me.adler>>8&255),Pe(Fe,me.adler>>16&255),Pe(Fe,me.adler>>24&255),Pe(Fe,255&me.total_in),Pe(Fe,me.total_in>>8&255),Pe(Fe,me.total_in>>16&255),Pe(Fe,me.total_in>>24&255)):(ve(Fe,me.adler>>>16),ve(Fe,65535&me.adler)),ze(me),0<Fe.wrap&&(Fe.wrap=-Fe.wrap),Fe.pending!==0?Z:1)},j.deflateEnd=function(me){var We;return me&&me.state?(We=me.state.status)!==_e&&We!==69&&We!==73&&We!==91&&We!==103&&We!==De&&We!==666?Te(me,ne):(me.state=null,We===De?Te(me,-3):Z):ne},j.deflateSetDictionary=function(me,We){var Ye,Fe,xe,$e,Je,ut,qe,Ge,Ke=We.length;if(!me||!me.state||($e=(Ye=me.state).wrap)===2||$e===1&&Ye.status!==_e||Ye.lookahead)return ne;for($e===1&&(me.adler=G(me.adler,We,Ke,0)),Ye.wrap=0,Ke>=Ye.w_size&&($e===0&&(Xe(Ye.head),Ye.strstart=0,Ye.block_start=0,Ye.insert=0),Ge=new V.Buf8(Ye.w_size),V.arraySet(Ge,We,Ke-Ye.w_size,Ye.w_size,0),We=Ge,Ke=Ye.w_size),Je=me.avail_in,ut=me.next_in,qe=me.input,me.avail_in=Ke,me.next_in=0,me.input=We,Ce(Ye);Ye.lookahead>=de;){for(Fe=Ye.strstart,xe=Ye.lookahead-(de-1);Ye.ins_h=(Ye.ins_h<<Ye.hash_shift^Ye.window[Fe+de-1])&Ye.hash_mask,Ye.prev[Fe&Ye.w_mask]=Ye.head[Ye.ins_h],Ye.head[Ye.ins_h]=Fe,Fe++,--xe;);Ye.strstart=Fe,Ye.lookahead=de-1,Ce(Ye)}return Ye.strstart+=Ye.lookahead,Ye.block_start=Ye.strstart,Ye.insert=Ye.lookahead,Ye.lookahead=0,Ye.match_length=Ye.prev_length=de-1,Ye.match_available=0,me.next_in=ut,me.input=qe,me.avail_in=Je,Ye.wrap=$e,Z},j.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(M,$,j){$.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(M,$,j){$.exports=function(z,V){var X,G,Y,Q,ee,te,Z,ne,re,se,ie,oe,ue,ce,ae,le,he,ge,de,pe,ye,_e,De,fe,Ae;X=z.state,G=z.next_in,fe=z.input,Y=G+(z.avail_in-5),Q=z.next_out,Ae=z.output,ee=Q-(V-z.avail_out),te=Q+(z.avail_out-257),Z=X.dmax,ne=X.wsize,re=X.whave,se=X.wnext,ie=X.window,oe=X.hold,ue=X.bits,ce=X.lencode,ae=X.distcode,le=(1<<X.lenbits)-1,he=(1<<X.distbits)-1;e:do{ue<15&&(oe+=fe[G++]<<ue,ue+=8,oe+=fe[G++]<<ue,ue+=8),ge=ce[oe&le];t:for(;;){if(oe>>>=de=ge>>>24,ue-=de,(de=ge>>>16&255)===0)Ae[Q++]=65535&ge;else{if(!(16&de)){if(!(64&de)){ge=ce[(65535&ge)+(oe&(1<<de)-1)];continue t}if(32&de){X.mode=12;break e}z.msg="invalid literal/length code",X.mode=30;break e}pe=65535&ge,(de&=15)&&(ue<de&&(oe+=fe[G++]<<ue,ue+=8),pe+=oe&(1<<de)-1,oe>>>=de,ue-=de),ue<15&&(oe+=fe[G++]<<ue,ue+=8,oe+=fe[G++]<<ue,ue+=8),ge=ae[oe&he];n:for(;;){if(oe>>>=de=ge>>>24,ue-=de,!(16&(de=ge>>>16&255))){if(!(64&de)){ge=ae[(65535&ge)+(oe&(1<<de)-1)];continue n}z.msg="invalid distance code",X.mode=30;break e}if(ye=65535&ge,ue<(de&=15)&&(oe+=fe[G++]<<ue,(ue+=8)<de&&(oe+=fe[G++]<<ue,ue+=8)),Z<(ye+=oe&(1<<de)-1)){z.msg="invalid distance too far back",X.mode=30;break e}if(oe>>>=de,ue-=de,(de=Q-ee)<ye){if(re<(de=ye-de)&&X.sane){z.msg="invalid distance too far back",X.mode=30;break e}if(De=ie,(_e=0)===se){if(_e+=ne-de,de<pe){for(pe-=de;Ae[Q++]=ie[_e++],--de;);_e=Q-ye,De=Ae}}else if(se<de){if(_e+=ne+se-de,(de-=se)<pe){for(pe-=de;Ae[Q++]=ie[_e++],--de;);if(_e=0,se<pe){for(pe-=de=se;Ae[Q++]=ie[_e++],--de;);_e=Q-ye,De=Ae}}}else if(_e+=se-de,de<pe){for(pe-=de;Ae[Q++]=ie[_e++],--de;);_e=Q-ye,De=Ae}for(;2<pe;)Ae[Q++]=De[_e++],Ae[Q++]=De[_e++],Ae[Q++]=De[_e++],pe-=3;pe&&(Ae[Q++]=De[_e++],1<pe&&(Ae[Q++]=De[_e++]))}else{for(_e=Q-ye;Ae[Q++]=Ae[_e++],Ae[Q++]=Ae[_e++],Ae[Q++]=Ae[_e++],2<(pe-=3););pe&&(Ae[Q++]=Ae[_e++],1<pe&&(Ae[Q++]=Ae[_e++]))}break}}break}}while(G<Y&&Q<te);G-=pe=ue>>3,oe&=(1<<(ue-=pe<<3))-1,z.next_in=G,z.next_out=Q,z.avail_in=G<Y?Y-G+5:5-(G-Y),z.avail_out=Q<te?te-Q+257:257-(Q-te),X.hold=oe,X.bits=ue}},{}],49:[function(M,$,j){var z=M("../utils/common"),V=M("./adler32"),X=M("./crc32"),G=M("./inffast"),Y=M("./inftrees"),Q=1,ee=2,te=0,Z=-2,ne=1,re=852,se=592;function ie(_e){return(_e>>>24&255)+(_e>>>8&65280)+((65280&_e)<<8)+((255&_e)<<24)}function oe(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new z.Buf16(320),this.work=new z.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ue(_e){var De;return _e&&_e.state?(De=_e.state,_e.total_in=_e.total_out=De.total=0,_e.msg="",De.wrap&&(_e.adler=1&De.wrap),De.mode=ne,De.last=0,De.havedict=0,De.dmax=32768,De.head=null,De.hold=0,De.bits=0,De.lencode=De.lendyn=new z.Buf32(re),De.distcode=De.distdyn=new z.Buf32(se),De.sane=1,De.back=-1,te):Z}function ce(_e){var De;return _e&&_e.state?((De=_e.state).wsize=0,De.whave=0,De.wnext=0,ue(_e)):Z}function ae(_e,De){var fe,Ae;return _e&&_e.state?(Ae=_e.state,De<0?(fe=0,De=-De):(fe=1+(De>>4),De<48&&(De&=15)),De&&(De<8||15<De)?Z:(Ae.window!==null&&Ae.wbits!==De&&(Ae.window=null),Ae.wrap=fe,Ae.wbits=De,ce(_e))):Z}function le(_e,De){var fe,Ae;return _e?(Ae=new oe,(_e.state=Ae).window=null,(fe=ae(_e,De))!==te&&(_e.state=null),fe):Z}var he,ge,de=!0;function pe(_e){if(de){var De;for(he=new z.Buf32(512),ge=new z.Buf32(32),De=0;De<144;)_e.lens[De++]=8;for(;De<256;)_e.lens[De++]=9;for(;De<280;)_e.lens[De++]=7;for(;De<288;)_e.lens[De++]=8;for(Y(Q,_e.lens,0,288,he,0,_e.work,{bits:9}),De=0;De<32;)_e.lens[De++]=5;Y(ee,_e.lens,0,32,ge,0,_e.work,{bits:5}),de=!1}_e.lencode=he,_e.lenbits=9,_e.distcode=ge,_e.distbits=5}function ye(_e,De,fe,Ae){var Me,Ee=_e.state;return Ee.window===null&&(Ee.wsize=1<<Ee.wbits,Ee.wnext=0,Ee.whave=0,Ee.window=new z.Buf8(Ee.wsize)),Ae>=Ee.wsize?(z.arraySet(Ee.window,De,fe-Ee.wsize,Ee.wsize,0),Ee.wnext=0,Ee.whave=Ee.wsize):(Ae<(Me=Ee.wsize-Ee.wnext)&&(Me=Ae),z.arraySet(Ee.window,De,fe-Ae,Me,Ee.wnext),(Ae-=Me)?(z.arraySet(Ee.window,De,fe-Ae,Ae,0),Ee.wnext=Ae,Ee.whave=Ee.wsize):(Ee.wnext+=Me,Ee.wnext===Ee.wsize&&(Ee.wnext=0),Ee.whave<Ee.wsize&&(Ee.whave+=Me))),0}j.inflateReset=ce,j.inflateReset2=ae,j.inflateResetKeep=ue,j.inflateInit=function(_e){return le(_e,15)},j.inflateInit2=le,j.inflate=function(_e,De){var fe,Ae,Me,Ee,Te,Be,Xe,ze,Oe,Pe,ve,be,Ce,Ne,Ie,Le,je,Ve,ot,lt,me,We,Ye,Fe,xe=0,$e=new z.Buf8(4),Je=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!_e||!_e.state||!_e.output||!_e.input&&_e.avail_in!==0)return Z;(fe=_e.state).mode===12&&(fe.mode=13),Te=_e.next_out,Me=_e.output,Xe=_e.avail_out,Ee=_e.next_in,Ae=_e.input,Be=_e.avail_in,ze=fe.hold,Oe=fe.bits,Pe=Be,ve=Xe,We=te;e:for(;;)switch(fe.mode){case ne:if(fe.wrap===0){fe.mode=13;break}for(;Oe<16;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}if(2&fe.wrap&&ze===35615){$e[fe.check=0]=255&ze,$e[1]=ze>>>8&255,fe.check=X(fe.check,$e,2,0),Oe=ze=0,fe.mode=2;break}if(fe.flags=0,fe.head&&(fe.head.done=!1),!(1&fe.wrap)||(((255&ze)<<8)+(ze>>8))%31){_e.msg="incorrect header check",fe.mode=30;break}if((15&ze)!=8){_e.msg="unknown compression method",fe.mode=30;break}if(Oe-=4,me=8+(15&(ze>>>=4)),fe.wbits===0)fe.wbits=me;else if(me>fe.wbits){_e.msg="invalid window size",fe.mode=30;break}fe.dmax=1<<me,_e.adler=fe.check=1,fe.mode=512&ze?10:12,Oe=ze=0;break;case 2:for(;Oe<16;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}if(fe.flags=ze,(255&fe.flags)!=8){_e.msg="unknown compression method",fe.mode=30;break}if(57344&fe.flags){_e.msg="unknown header flags set",fe.mode=30;break}fe.head&&(fe.head.text=ze>>8&1),512&fe.flags&&($e[0]=255&ze,$e[1]=ze>>>8&255,fe.check=X(fe.check,$e,2,0)),Oe=ze=0,fe.mode=3;case 3:for(;Oe<32;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}fe.head&&(fe.head.time=ze),512&fe.flags&&($e[0]=255&ze,$e[1]=ze>>>8&255,$e[2]=ze>>>16&255,$e[3]=ze>>>24&255,fe.check=X(fe.check,$e,4,0)),Oe=ze=0,fe.mode=4;case 4:for(;Oe<16;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}fe.head&&(fe.head.xflags=255&ze,fe.head.os=ze>>8),512&fe.flags&&($e[0]=255&ze,$e[1]=ze>>>8&255,fe.check=X(fe.check,$e,2,0)),Oe=ze=0,fe.mode=5;case 5:if(1024&fe.flags){for(;Oe<16;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}fe.length=ze,fe.head&&(fe.head.extra_len=ze),512&fe.flags&&($e[0]=255&ze,$e[1]=ze>>>8&255,fe.check=X(fe.check,$e,2,0)),Oe=ze=0}else fe.head&&(fe.head.extra=null);fe.mode=6;case 6:if(1024&fe.flags&&(Be<(be=fe.length)&&(be=Be),be&&(fe.head&&(me=fe.head.extra_len-fe.length,fe.head.extra||(fe.head.extra=new Array(fe.head.extra_len)),z.arraySet(fe.head.extra,Ae,Ee,be,me)),512&fe.flags&&(fe.check=X(fe.check,Ae,be,Ee)),Be-=be,Ee+=be,fe.length-=be),fe.length))break e;fe.length=0,fe.mode=7;case 7:if(2048&fe.flags){if(Be===0)break e;for(be=0;me=Ae[Ee+be++],fe.head&&me&&fe.length<65536&&(fe.head.name+=String.fromCharCode(me)),me&&be<Be;);if(512&fe.flags&&(fe.check=X(fe.check,Ae,be,Ee)),Be-=be,Ee+=be,me)break e}else fe.head&&(fe.head.name=null);fe.length=0,fe.mode=8;case 8:if(4096&fe.flags){if(Be===0)break e;for(be=0;me=Ae[Ee+be++],fe.head&&me&&fe.length<65536&&(fe.head.comment+=String.fromCharCode(me)),me&&be<Be;);if(512&fe.flags&&(fe.check=X(fe.check,Ae,be,Ee)),Be-=be,Ee+=be,me)break e}else fe.head&&(fe.head.comment=null);fe.mode=9;case 9:if(512&fe.flags){for(;Oe<16;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}if(ze!==(65535&fe.check)){_e.msg="header crc mismatch",fe.mode=30;break}Oe=ze=0}fe.head&&(fe.head.hcrc=fe.flags>>9&1,fe.head.done=!0),_e.adler=fe.check=0,fe.mode=12;break;case 10:for(;Oe<32;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}_e.adler=fe.check=ie(ze),Oe=ze=0,fe.mode=11;case 11:if(fe.havedict===0)return _e.next_out=Te,_e.avail_out=Xe,_e.next_in=Ee,_e.avail_in=Be,fe.hold=ze,fe.bits=Oe,2;_e.adler=fe.check=1,fe.mode=12;case 12:if(De===5||De===6)break e;case 13:if(fe.last){ze>>>=7&Oe,Oe-=7&Oe,fe.mode=27;break}for(;Oe<3;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}switch(fe.last=1&ze,Oe-=1,3&(ze>>>=1)){case 0:fe.mode=14;break;case 1:if(pe(fe),fe.mode=20,De!==6)break;ze>>>=2,Oe-=2;break e;case 2:fe.mode=17;break;case 3:_e.msg="invalid block type",fe.mode=30}ze>>>=2,Oe-=2;break;case 14:for(ze>>>=7&Oe,Oe-=7&Oe;Oe<32;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}if((65535&ze)!=(ze>>>16^65535)){_e.msg="invalid stored block lengths",fe.mode=30;break}if(fe.length=65535&ze,Oe=ze=0,fe.mode=15,De===6)break e;case 15:fe.mode=16;case 16:if(be=fe.length){if(Be<be&&(be=Be),Xe<be&&(be=Xe),be===0)break e;z.arraySet(Me,Ae,Ee,be,Te),Be-=be,Ee+=be,Xe-=be,Te+=be,fe.length-=be;break}fe.mode=12;break;case 17:for(;Oe<14;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}if(fe.nlen=257+(31&ze),ze>>>=5,Oe-=5,fe.ndist=1+(31&ze),ze>>>=5,Oe-=5,fe.ncode=4+(15&ze),ze>>>=4,Oe-=4,286<fe.nlen||30<fe.ndist){_e.msg="too many length or distance symbols",fe.mode=30;break}fe.have=0,fe.mode=18;case 18:for(;fe.have<fe.ncode;){for(;Oe<3;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}fe.lens[Je[fe.have++]]=7&ze,ze>>>=3,Oe-=3}for(;fe.have<19;)fe.lens[Je[fe.have++]]=0;if(fe.lencode=fe.lendyn,fe.lenbits=7,Ye={bits:fe.lenbits},We=Y(0,fe.lens,0,19,fe.lencode,0,fe.work,Ye),fe.lenbits=Ye.bits,We){_e.msg="invalid code lengths set",fe.mode=30;break}fe.have=0,fe.mode=19;case 19:for(;fe.have<fe.nlen+fe.ndist;){for(;Le=(xe=fe.lencode[ze&(1<<fe.lenbits)-1])>>>16&255,je=65535&xe,!((Ie=xe>>>24)<=Oe);){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}if(je<16)ze>>>=Ie,Oe-=Ie,fe.lens[fe.have++]=je;else{if(je===16){for(Fe=Ie+2;Oe<Fe;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}if(ze>>>=Ie,Oe-=Ie,fe.have===0){_e.msg="invalid bit length repeat",fe.mode=30;break}me=fe.lens[fe.have-1],be=3+(3&ze),ze>>>=2,Oe-=2}else if(je===17){for(Fe=Ie+3;Oe<Fe;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}Oe-=Ie,me=0,be=3+(7&(ze>>>=Ie)),ze>>>=3,Oe-=3}else{for(Fe=Ie+7;Oe<Fe;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}Oe-=Ie,me=0,be=11+(127&(ze>>>=Ie)),ze>>>=7,Oe-=7}if(fe.have+be>fe.nlen+fe.ndist){_e.msg="invalid bit length repeat",fe.mode=30;break}for(;be--;)fe.lens[fe.have++]=me}}if(fe.mode===30)break;if(fe.lens[256]===0){_e.msg="invalid code -- missing end-of-block",fe.mode=30;break}if(fe.lenbits=9,Ye={bits:fe.lenbits},We=Y(Q,fe.lens,0,fe.nlen,fe.lencode,0,fe.work,Ye),fe.lenbits=Ye.bits,We){_e.msg="invalid literal/lengths set",fe.mode=30;break}if(fe.distbits=6,fe.distcode=fe.distdyn,Ye={bits:fe.distbits},We=Y(ee,fe.lens,fe.nlen,fe.ndist,fe.distcode,0,fe.work,Ye),fe.distbits=Ye.bits,We){_e.msg="invalid distances set",fe.mode=30;break}if(fe.mode=20,De===6)break e;case 20:fe.mode=21;case 21:if(6<=Be&&258<=Xe){_e.next_out=Te,_e.avail_out=Xe,_e.next_in=Ee,_e.avail_in=Be,fe.hold=ze,fe.bits=Oe,G(_e,ve),Te=_e.next_out,Me=_e.output,Xe=_e.avail_out,Ee=_e.next_in,Ae=_e.input,Be=_e.avail_in,ze=fe.hold,Oe=fe.bits,fe.mode===12&&(fe.back=-1);break}for(fe.back=0;Le=(xe=fe.lencode[ze&(1<<fe.lenbits)-1])>>>16&255,je=65535&xe,!((Ie=xe>>>24)<=Oe);){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}if(Le&&!(240&Le)){for(Ve=Ie,ot=Le,lt=je;Le=(xe=fe.lencode[lt+((ze&(1<<Ve+ot)-1)>>Ve)])>>>16&255,je=65535&xe,!(Ve+(Ie=xe>>>24)<=Oe);){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}ze>>>=Ve,Oe-=Ve,fe.back+=Ve}if(ze>>>=Ie,Oe-=Ie,fe.back+=Ie,fe.length=je,Le===0){fe.mode=26;break}if(32&Le){fe.back=-1,fe.mode=12;break}if(64&Le){_e.msg="invalid literal/length code",fe.mode=30;break}fe.extra=15&Le,fe.mode=22;case 22:if(fe.extra){for(Fe=fe.extra;Oe<Fe;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}fe.length+=ze&(1<<fe.extra)-1,ze>>>=fe.extra,Oe-=fe.extra,fe.back+=fe.extra}fe.was=fe.length,fe.mode=23;case 23:for(;Le=(xe=fe.distcode[ze&(1<<fe.distbits)-1])>>>16&255,je=65535&xe,!((Ie=xe>>>24)<=Oe);){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}if(!(240&Le)){for(Ve=Ie,ot=Le,lt=je;Le=(xe=fe.distcode[lt+((ze&(1<<Ve+ot)-1)>>Ve)])>>>16&255,je=65535&xe,!(Ve+(Ie=xe>>>24)<=Oe);){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}ze>>>=Ve,Oe-=Ve,fe.back+=Ve}if(ze>>>=Ie,Oe-=Ie,fe.back+=Ie,64&Le){_e.msg="invalid distance code",fe.mode=30;break}fe.offset=je,fe.extra=15&Le,fe.mode=24;case 24:if(fe.extra){for(Fe=fe.extra;Oe<Fe;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}fe.offset+=ze&(1<<fe.extra)-1,ze>>>=fe.extra,Oe-=fe.extra,fe.back+=fe.extra}if(fe.offset>fe.dmax){_e.msg="invalid distance too far back",fe.mode=30;break}fe.mode=25;case 25:if(Xe===0)break e;if(be=ve-Xe,fe.offset>be){if((be=fe.offset-be)>fe.whave&&fe.sane){_e.msg="invalid distance too far back",fe.mode=30;break}Ce=be>fe.wnext?(be-=fe.wnext,fe.wsize-be):fe.wnext-be,be>fe.length&&(be=fe.length),Ne=fe.window}else Ne=Me,Ce=Te-fe.offset,be=fe.length;for(Xe<be&&(be=Xe),Xe-=be,fe.length-=be;Me[Te++]=Ne[Ce++],--be;);fe.length===0&&(fe.mode=21);break;case 26:if(Xe===0)break e;Me[Te++]=fe.length,Xe--,fe.mode=21;break;case 27:if(fe.wrap){for(;Oe<32;){if(Be===0)break e;Be--,ze|=Ae[Ee++]<<Oe,Oe+=8}if(ve-=Xe,_e.total_out+=ve,fe.total+=ve,ve&&(_e.adler=fe.check=fe.flags?X(fe.check,Me,ve,Te-ve):V(fe.check,Me,ve,Te-ve)),ve=Xe,(fe.flags?ze:ie(ze))!==fe.check){_e.msg="incorrect data check",fe.mode=30;break}Oe=ze=0}fe.mode=28;case 28:if(fe.wrap&&fe.flags){for(;Oe<32;){if(Be===0)break e;Be--,ze+=Ae[Ee++]<<Oe,Oe+=8}if(ze!==(4294967295&fe.total)){_e.msg="incorrect length check",fe.mode=30;break}Oe=ze=0}fe.mode=29;case 29:We=1;break e;case 30:We=-3;break e;case 31:return-4;case 32:default:return Z}return _e.next_out=Te,_e.avail_out=Xe,_e.next_in=Ee,_e.avail_in=Be,fe.hold=ze,fe.bits=Oe,(fe.wsize||ve!==_e.avail_out&&fe.mode<30&&(fe.mode<27||De!==4))&&ye(_e,_e.output,_e.next_out,ve-_e.avail_out)?(fe.mode=31,-4):(Pe-=_e.avail_in,ve-=_e.avail_out,_e.total_in+=Pe,_e.total_out+=ve,fe.total+=ve,fe.wrap&&ve&&(_e.adler=fe.check=fe.flags?X(fe.check,Me,ve,_e.next_out-ve):V(fe.check,Me,ve,_e.next_out-ve)),_e.data_type=fe.bits+(fe.last?64:0)+(fe.mode===12?128:0)+(fe.mode===20||fe.mode===15?256:0),(Pe==0&&ve===0||De===4)&&We===te&&(We=-5),We)},j.inflateEnd=function(_e){if(!_e||!_e.state)return Z;var De=_e.state;return De.window&&(De.window=null),_e.state=null,te},j.inflateGetHeader=function(_e,De){var fe;return _e&&_e.state&&2&(fe=_e.state).wrap?((fe.head=De).done=!1,te):Z},j.inflateSetDictionary=function(_e,De){var fe,Ae=De.length;return _e&&_e.state?(fe=_e.state).wrap!==0&&fe.mode!==11?Z:fe.mode===11&&V(1,De,Ae,0)!==fe.check?-3:ye(_e,De,Ae,Ae)?(fe.mode=31,-4):(fe.havedict=1,te):Z},j.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(M,$,j){var z=M("../utils/common"),V=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],X=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],G=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Y=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];$.exports=function(Q,ee,te,Z,ne,re,se,ie){var oe,ue,ce,ae,le,he,ge,de,pe,ye=ie.bits,_e=0,De=0,fe=0,Ae=0,Me=0,Ee=0,Te=0,Be=0,Xe=0,ze=0,Oe=null,Pe=0,ve=new z.Buf16(16),be=new z.Buf16(16),Ce=null,Ne=0;for(_e=0;_e<=15;_e++)ve[_e]=0;for(De=0;De<Z;De++)ve[ee[te+De]]++;for(Me=ye,Ae=15;1<=Ae&&ve[Ae]===0;Ae--);if(Ae<Me&&(Me=Ae),Ae===0)return ne[re++]=20971520,ne[re++]=20971520,ie.bits=1,0;for(fe=1;fe<Ae&&ve[fe]===0;fe++);for(Me<fe&&(Me=fe),_e=Be=1;_e<=15;_e++)if(Be<<=1,(Be-=ve[_e])<0)return-1;if(0<Be&&(Q===0||Ae!==1))return-1;for(be[1]=0,_e=1;_e<15;_e++)be[_e+1]=be[_e]+ve[_e];for(De=0;De<Z;De++)ee[te+De]!==0&&(se[be[ee[te+De]]++]=De);if(he=Q===0?(Oe=Ce=se,19):Q===1?(Oe=V,Pe-=257,Ce=X,Ne-=257,256):(Oe=G,Ce=Y,-1),_e=fe,le=re,Te=De=ze=0,ce=-1,ae=(Xe=1<<(Ee=Me))-1,Q===1&&852<Xe||Q===2&&592<Xe)return 1;for(;;){for(ge=_e-Te,pe=se[De]<he?(de=0,se[De]):se[De]>he?(de=Ce[Ne+se[De]],Oe[Pe+se[De]]):(de=96,0),oe=1<<_e-Te,fe=ue=1<<Ee;ne[le+(ze>>Te)+(ue-=oe)]=ge<<24|de<<16|pe|0,ue!==0;);for(oe=1<<_e-1;ze&oe;)oe>>=1;if(oe!==0?(ze&=oe-1,ze+=oe):ze=0,De++,--ve[_e]==0){if(_e===Ae)break;_e=ee[te+se[De]]}if(Me<_e&&(ze&ae)!==ce){for(Te===0&&(Te=Me),le+=fe,Be=1<<(Ee=_e-Te);Ee+Te<Ae&&!((Be-=ve[Ee+Te])<=0);)Ee++,Be<<=1;if(Xe+=1<<Ee,Q===1&&852<Xe||Q===2&&592<Xe)return 1;ne[ce=ze&ae]=Me<<24|Ee<<16|le-re|0}}return ze!==0&&(ne[le+ze]=_e-Te<<24|64<<16|0),ie.bits=Me,0}},{"../utils/common":41}],51:[function(M,$,j){$.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(M,$,j){var z=M("../utils/common"),V=0,X=1;function G(xe){for(var $e=xe.length;0<=--$e;)xe[$e]=0}var Y=0,Q=29,ee=256,te=ee+1+Q,Z=30,ne=19,re=2*te+1,se=15,ie=16,oe=7,ue=256,ce=16,ae=17,le=18,he=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ge=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],de=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],pe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ye=new Array(2*(te+2));G(ye);var _e=new Array(2*Z);G(_e);var De=new Array(512);G(De);var fe=new Array(256);G(fe);var Ae=new Array(Q);G(Ae);var Me,Ee,Te,Be=new Array(Z);function Xe(xe,$e,Je,ut,qe){this.static_tree=xe,this.extra_bits=$e,this.extra_base=Je,this.elems=ut,this.max_length=qe,this.has_stree=xe&&xe.length}function ze(xe,$e){this.dyn_tree=xe,this.max_code=0,this.stat_desc=$e}function Oe(xe){return xe<256?De[xe]:De[256+(xe>>>7)]}function Pe(xe,$e){xe.pending_buf[xe.pending++]=255&$e,xe.pending_buf[xe.pending++]=$e>>>8&255}function ve(xe,$e,Je){xe.bi_valid>ie-Je?(xe.bi_buf|=$e<<xe.bi_valid&65535,Pe(xe,xe.bi_buf),xe.bi_buf=$e>>ie-xe.bi_valid,xe.bi_valid+=Je-ie):(xe.bi_buf|=$e<<xe.bi_valid&65535,xe.bi_valid+=Je)}function be(xe,$e,Je){ve(xe,Je[2*$e],Je[2*$e+1])}function Ce(xe,$e){for(var Je=0;Je|=1&xe,xe>>>=1,Je<<=1,0<--$e;);return Je>>>1}function Ne(xe,$e,Je){var ut,qe,Ge=new Array(se+1),Ke=0;for(ut=1;ut<=se;ut++)Ge[ut]=Ke=Ke+Je[ut-1]<<1;for(qe=0;qe<=$e;qe++){var et=xe[2*qe+1];et!==0&&(xe[2*qe]=Ce(Ge[et]++,et))}}function Ie(xe){var $e;for($e=0;$e<te;$e++)xe.dyn_ltree[2*$e]=0;for($e=0;$e<Z;$e++)xe.dyn_dtree[2*$e]=0;for($e=0;$e<ne;$e++)xe.bl_tree[2*$e]=0;xe.dyn_ltree[2*ue]=1,xe.opt_len=xe.static_len=0,xe.last_lit=xe.matches=0}function Le(xe){8<xe.bi_valid?Pe(xe,xe.bi_buf):0<xe.bi_valid&&(xe.pending_buf[xe.pending++]=xe.bi_buf),xe.bi_buf=0,xe.bi_valid=0}function je(xe,$e,Je,ut){var qe=2*$e,Ge=2*Je;return xe[qe]<xe[Ge]||xe[qe]===xe[Ge]&&ut[$e]<=ut[Je]}function Ve(xe,$e,Je){for(var ut=xe.heap[Je],qe=Je<<1;qe<=xe.heap_len&&(qe<xe.heap_len&&je($e,xe.heap[qe+1],xe.heap[qe],xe.depth)&&qe++,!je($e,ut,xe.heap[qe],xe.depth));)xe.heap[Je]=xe.heap[qe],Je=qe,qe<<=1;xe.heap[Je]=ut}function ot(xe,$e,Je){var ut,qe,Ge,Ke,et=0;if(xe.last_lit!==0)for(;ut=xe.pending_buf[xe.d_buf+2*et]<<8|xe.pending_buf[xe.d_buf+2*et+1],qe=xe.pending_buf[xe.l_buf+et],et++,ut===0?be(xe,qe,$e):(be(xe,(Ge=fe[qe])+ee+1,$e),(Ke=he[Ge])!==0&&ve(xe,qe-=Ae[Ge],Ke),be(xe,Ge=Oe(--ut),Je),(Ke=ge[Ge])!==0&&ve(xe,ut-=Be[Ge],Ke)),et<xe.last_lit;);be(xe,ue,$e)}function lt(xe,$e){var Je,ut,qe,Ge=$e.dyn_tree,Ke=$e.stat_desc.static_tree,et=$e.stat_desc.has_stree,ct=$e.stat_desc.elems,mt=-1;for(xe.heap_len=0,xe.heap_max=re,Je=0;Je<ct;Je++)Ge[2*Je]!==0?(xe.heap[++xe.heap_len]=mt=Je,xe.depth[Je]=0):Ge[2*Je+1]=0;for(;xe.heap_len<2;)Ge[2*(qe=xe.heap[++xe.heap_len]=mt<2?++mt:0)]=1,xe.depth[qe]=0,xe.opt_len--,et&&(xe.static_len-=Ke[2*qe+1]);for($e.max_code=mt,Je=xe.heap_len>>1;1<=Je;Je--)Ve(xe,Ge,Je);for(qe=ct;Je=xe.heap[1],xe.heap[1]=xe.heap[xe.heap_len--],Ve(xe,Ge,1),ut=xe.heap[1],xe.heap[--xe.heap_max]=Je,xe.heap[--xe.heap_max]=ut,Ge[2*qe]=Ge[2*Je]+Ge[2*ut],xe.depth[qe]=(xe.depth[Je]>=xe.depth[ut]?xe.depth[Je]:xe.depth[ut])+1,Ge[2*Je+1]=Ge[2*ut+1]=qe,xe.heap[1]=qe++,Ve(xe,Ge,1),2<=xe.heap_len;);xe.heap[--xe.heap_max]=xe.heap[1],function(_t,Ct){var Et,xt,Tt,At,nt,it,rt=Ct.dyn_tree,gt=Ct.max_code,Pt=Ct.stat_desc.static_tree,St=Ct.stat_desc.has_stree,Bt=Ct.stat_desc.extra_bits,Lt=Ct.stat_desc.extra_base,Se=Ct.stat_desc.max_length,tt=0;for(At=0;At<=se;At++)_t.bl_count[At]=0;for(rt[2*_t.heap[_t.heap_max]+1]=0,Et=_t.heap_max+1;Et<re;Et++)Se<(At=rt[2*rt[2*(xt=_t.heap[Et])+1]+1]+1)&&(At=Se,tt++),rt[2*xt+1]=At,gt<xt||(_t.bl_count[At]++,nt=0,Lt<=xt&&(nt=Bt[xt-Lt]),it=rt[2*xt],_t.opt_len+=it*(At+nt),St&&(_t.static_len+=it*(Pt[2*xt+1]+nt)));if(tt!==0){do{for(At=Se-1;_t.bl_count[At]===0;)At--;_t.bl_count[At]--,_t.bl_count[At+1]+=2,_t.bl_count[Se]--,tt-=2}while(0<tt);for(At=Se;At!==0;At--)for(xt=_t.bl_count[At];xt!==0;)gt<(Tt=_t.heap[--Et])||(rt[2*Tt+1]!==At&&(_t.opt_len+=(At-rt[2*Tt+1])*rt[2*Tt],rt[2*Tt+1]=At),xt--)}}(xe,$e),Ne(Ge,mt,xe.bl_count)}function me(xe,$e,Je){var ut,qe,Ge=-1,Ke=$e[1],et=0,ct=7,mt=4;for(Ke===0&&(ct=138,mt=3),$e[2*(Je+1)+1]=65535,ut=0;ut<=Je;ut++)qe=Ke,Ke=$e[2*(ut+1)+1],++et<ct&&qe===Ke||(et<mt?xe.bl_tree[2*qe]+=et:qe!==0?(qe!==Ge&&xe.bl_tree[2*qe]++,xe.bl_tree[2*ce]++):et<=10?xe.bl_tree[2*ae]++:xe.bl_tree[2*le]++,Ge=qe,mt=(et=0)===Ke?(ct=138,3):qe===Ke?(ct=6,3):(ct=7,4))}function We(xe,$e,Je){var ut,qe,Ge=-1,Ke=$e[1],et=0,ct=7,mt=4;for(Ke===0&&(ct=138,mt=3),ut=0;ut<=Je;ut++)if(qe=Ke,Ke=$e[2*(ut+1)+1],!(++et<ct&&qe===Ke)){if(et<mt)for(;be(xe,qe,xe.bl_tree),--et!=0;);else qe!==0?(qe!==Ge&&(be(xe,qe,xe.bl_tree),et--),be(xe,ce,xe.bl_tree),ve(xe,et-3,2)):et<=10?(be(xe,ae,xe.bl_tree),ve(xe,et-3,3)):(be(xe,le,xe.bl_tree),ve(xe,et-11,7));Ge=qe,mt=(et=0)===Ke?(ct=138,3):qe===Ke?(ct=6,3):(ct=7,4)}}G(Be);var Ye=!1;function Fe(xe,$e,Je,ut){ve(xe,(Y<<1)+(ut?1:0),3),function(qe,Ge,Ke,et){Le(qe),et&&(Pe(qe,Ke),Pe(qe,~Ke)),z.arraySet(qe.pending_buf,qe.window,Ge,Ke,qe.pending),qe.pending+=Ke}(xe,$e,Je,!0)}j._tr_init=function(xe){Ye||(function(){var $e,Je,ut,qe,Ge,Ke=new Array(se+1);for(qe=ut=0;qe<Q-1;qe++)for(Ae[qe]=ut,$e=0;$e<1<<he[qe];$e++)fe[ut++]=qe;for(fe[ut-1]=qe,qe=Ge=0;qe<16;qe++)for(Be[qe]=Ge,$e=0;$e<1<<ge[qe];$e++)De[Ge++]=qe;for(Ge>>=7;qe<Z;qe++)for(Be[qe]=Ge<<7,$e=0;$e<1<<ge[qe]-7;$e++)De[256+Ge++]=qe;for(Je=0;Je<=se;Je++)Ke[Je]=0;for($e=0;$e<=143;)ye[2*$e+1]=8,$e++,Ke[8]++;for(;$e<=255;)ye[2*$e+1]=9,$e++,Ke[9]++;for(;$e<=279;)ye[2*$e+1]=7,$e++,Ke[7]++;for(;$e<=287;)ye[2*$e+1]=8,$e++,Ke[8]++;for(Ne(ye,te+1,Ke),$e=0;$e<Z;$e++)_e[2*$e+1]=5,_e[2*$e]=Ce($e,5);Me=new Xe(ye,he,ee+1,te,se),Ee=new Xe(_e,ge,0,Z,se),Te=new Xe(new Array(0),de,0,ne,oe)}(),Ye=!0),xe.l_desc=new ze(xe.dyn_ltree,Me),xe.d_desc=new ze(xe.dyn_dtree,Ee),xe.bl_desc=new ze(xe.bl_tree,Te),xe.bi_buf=0,xe.bi_valid=0,Ie(xe)},j._tr_stored_block=Fe,j._tr_flush_block=function(xe,$e,Je,ut){var qe,Ge,Ke=0;0<xe.level?(xe.strm.data_type===2&&(xe.strm.data_type=function(et){var ct,mt=4093624447;for(ct=0;ct<=31;ct++,mt>>>=1)if(1&mt&&et.dyn_ltree[2*ct]!==0)return V;if(et.dyn_ltree[18]!==0||et.dyn_ltree[20]!==0||et.dyn_ltree[26]!==0)return X;for(ct=32;ct<ee;ct++)if(et.dyn_ltree[2*ct]!==0)return X;return V}(xe)),lt(xe,xe.l_desc),lt(xe,xe.d_desc),Ke=function(et){var ct;for(me(et,et.dyn_ltree,et.l_desc.max_code),me(et,et.dyn_dtree,et.d_desc.max_code),lt(et,et.bl_desc),ct=ne-1;3<=ct&&et.bl_tree[2*pe[ct]+1]===0;ct--);return et.opt_len+=3*(ct+1)+5+5+4,ct}(xe),qe=xe.opt_len+3+7>>>3,(Ge=xe.static_len+3+7>>>3)<=qe&&(qe=Ge)):qe=Ge=Je+5,Je+4<=qe&&$e!==-1?Fe(xe,$e,Je,ut):xe.strategy===4||Ge===qe?(ve(xe,2+(ut?1:0),3),ot(xe,ye,_e)):(ve(xe,4+(ut?1:0),3),function(et,ct,mt,_t){var Ct;for(ve(et,ct-257,5),ve(et,mt-1,5),ve(et,_t-4,4),Ct=0;Ct<_t;Ct++)ve(et,et.bl_tree[2*pe[Ct]+1],3);We(et,et.dyn_ltree,ct-1),We(et,et.dyn_dtree,mt-1)}(xe,xe.l_desc.max_code+1,xe.d_desc.max_code+1,Ke+1),ot(xe,xe.dyn_ltree,xe.dyn_dtree)),Ie(xe),ut&&Le(xe)},j._tr_tally=function(xe,$e,Je){return xe.pending_buf[xe.d_buf+2*xe.last_lit]=$e>>>8&255,xe.pending_buf[xe.d_buf+2*xe.last_lit+1]=255&$e,xe.pending_buf[xe.l_buf+xe.last_lit]=255&Je,xe.last_lit++,$e===0?xe.dyn_ltree[2*Je]++:(xe.matches++,$e--,xe.dyn_ltree[2*(fe[Je]+ee+1)]++,xe.dyn_dtree[2*Oe($e)]++),xe.last_lit===xe.lit_bufsize-1},j._tr_align=function(xe){ve(xe,2,3),be(xe,ue,ye),function($e){$e.bi_valid===16?(Pe($e,$e.bi_buf),$e.bi_buf=0,$e.bi_valid=0):8<=$e.bi_valid&&($e.pending_buf[$e.pending++]=255&$e.bi_buf,$e.bi_buf>>=8,$e.bi_valid-=8)}(xe)}},{"../utils/common":41}],53:[function(M,$,j){$.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(M,$,j){(function(z){(function(V,X){if(!V.setImmediate){var G,Y,Q,ee,te=1,Z={},ne=!1,re=V.document,se=Object.getPrototypeOf&&Object.getPrototypeOf(V);se=se&&se.setTimeout?se:V,G={}.toString.call(V.process)==="[object process]"?function(ce){process.nextTick(function(){oe(ce)})}:function(){if(V.postMessage&&!V.importScripts){var ce=!0,ae=V.onmessage;return V.onmessage=function(){ce=!1},V.postMessage("","*"),V.onmessage=ae,ce}}()?(ee="setImmediate$"+Math.random()+"$",V.addEventListener?V.addEventListener("message",ue,!1):V.attachEvent("onmessage",ue),function(ce){V.postMessage(ee+ce,"*")}):V.MessageChannel?((Q=new MessageChannel).port1.onmessage=function(ce){oe(ce.data)},function(ce){Q.port2.postMessage(ce)}):re&&"onreadystatechange"in re.createElement("script")?(Y=re.documentElement,function(ce){var ae=re.createElement("script");ae.onreadystatechange=function(){oe(ce),ae.onreadystatechange=null,Y.removeChild(ae),ae=null},Y.appendChild(ae)}):function(ce){setTimeout(oe,0,ce)},se.setImmediate=function(ce){typeof ce!="function"&&(ce=new Function(""+ce));for(var ae=new Array(arguments.length-1),le=0;le<ae.length;le++)ae[le]=arguments[le+1];var he={callback:ce,args:ae};return Z[te]=he,G(te),te++},se.clearImmediate=ie}function ie(ce){delete Z[ce]}function oe(ce){if(ne)setTimeout(oe,0,ce);else{var ae=Z[ce];if(ae){ne=!0;try{(function(le){var he=le.callback,ge=le.args;switch(ge.length){case 0:he();break;case 1:he(ge[0]);break;case 2:he(ge[0],ge[1]);break;case 3:he(ge[0],ge[1],ge[2]);break;default:he.apply(X,ge)}})(ae)}finally{ie(ce),ne=!1}}}}function ue(ce){ce.source===V&&typeof ce.data=="string"&&ce.data.indexOf(ee)===0&&oe(+ce.data.slice(ee.length))}})(typeof self>"u"?z===void 0?this:z:self)}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(jszip_min);var jszip_minExports=jszip_min.exports;const JSZip=getDefaultExportFromCjs(jszip_minExports);function create_if_block$b(q){let _,M,$,j,z=q[0]>1?"times":"time",V;return{c(){_=element("p"),M=text("This button was used "),$=text(q[0]),j=space(),V=text(z),attr(_,"class","text-left")},m(X,G){insert(X,_,G),append(_,M),append(_,$),append(_,j),append(_,V)},p(X,G){G&1&&set_data($,X[0]),G&1&&z!==(z=X[0]>1?"times":"time")&&set_data(V,z)},d(X){X&&detach(_)}}}function create_fragment$h(q){let _,M,$,j,z,V=q[0]&&create_if_block$b(q);return{c(){_=element("button"),_.textContent="Create Archive",M=space(),V&&V.c(),$=empty()},m(X,G){insert(X,_,G),insert(X,M,G),V&&V.m(X,G),insert(X,$,G),j||(z=listen(_,"click",q[1]),j=!0)},p(X,[G]){X[0]?V?V.p(X,G):(V=create_if_block$b(X),V.c(),V.m($.parentNode,$)):V&&(V.d(1),V=null)},i:noop,o:noop,d(X){X&&detach(_),X&&detach(M),V&&V.d(X),X&&detach($),j=!1,z()}}}function instance$d(q,_,M){let $,j,z;component_subscribe(q,replicaDetails,ne=>M(4,$=ne)),component_subscribe(q,cacheDetails,ne=>M(5,j=ne)),component_subscribe(q,authorKeypair,ne=>M(6,z=ne));let V=[],X;const G=async()=>{let ne=await j.queryDocs({filter:{pathStartsWith:"/counter"}});ne.length>0?M(0,X=ne[0].text):M(0,X="0")};onMount(async()=>{await G()});const Y=async()=>{await G();let ne=X,oe=(parseInt(ne||"0")+1).toString(),ue=await $.replica.set(z,{path:"/counter/number",text:oe});console.log("new count",ue),M(0,X=oe)},Q=async()=>{V=j.queryDocs({filter:{pathStartsWith:"/documents"}}),V.map(ne=>ne.path)},ee=async ne=>{for(let re of V){let se=ne.folder(re.path.replace("/","_"));if(se.file("document.txt",JSON.stringify(re)),re.attachmentSize){let ie=await $.replica.getAttachment(re),oe=ie?await ie.bytes():void 0,ue=re.path.split("/").pop().replace("!","");se.file(ue,oe)}}},te=async ne=>{let re=await ne.generateAsync({type:"blob"}),se=document.createElement("a"),ie=new Date().toISOString().slice(0,10);se.href=URL.createObjectURL(re),se.download="archive_"+ie+".zip",se.style.display="none",document.body.appendChild(se),se.click()};return[X,async()=>{let ne=new JSZip;await Q(),await ee(ne),await te(ne),await Y()}]}class DownloadTool extends SvelteComponent{constructor(_){super(),init(this,_,instance$d,create_fragment$h,safe_not_equal,{})}}const ONE_WEEK=7*24*60*60*1e3*1e3,PHASE_DURATION=[4*ONE_WEEK,3*ONE_WEEK,2*ONE_WEEK,ONE_WEEK];function calculateLunarPhase(q){let _=0,M=0;q.forEach(j=>{const z=parseInt(j.path.split("/")[2]),V=parseInt(j.path.split("/")[3]);_=Math.max(_,z),M=Math.max(M,V)});let $=Array(M+1);for(let j=0;j<M+1;j++)$[j]=Array(_+1).fill().map(()=>[]);return q.forEach(j=>{const z=parseInt(j.path.split("/")[2]),V=parseInt(j.path.split("/")[3]),X=j.deleteAfter,G=Date.now()*1e3,Y=X-G;let Q;Y>PHASE_DURATION[1]?Q=0:Y>PHASE_DURATION[2]?Q=1:Y>PHASE_DURATION[3]?Q=2:Q=3,$[V][z].push({doc:j,lunarPhase:Q})}),$}function createObserver(q,_){return new IntersectionObserver(q,{threshold:_})}function observeElement(q,_){_&&q&&q.observe(_)}function disconnectObserver(q){q&&q.disconnect()}const LUNAR_PHASE=[191808e7,127872e7,63936e7,0],COLOR_CYCLE=["#fff5d9","#d3e3d9","#F9DFDD","#CCE9F0"],PHASE_NAME=["spores","emergence","epic","fizz"],GridView_svelte_svelte_type_style_lang="";function get_each_context_5(q,_,M){const $=q.slice();return $[55]=_[M],$[57]=M,$}function get_each_context_6(q,_,M){const $=q.slice();return $[55]=_[M],$[59]=M,$}function get_each_context_8(q,_,M){const $=q.slice();return $[63]=_[M],$}function get_each_context_7(q,_,M){const $=q.slice();return $[60]=_[M],$}function get_each_context$5(q,_,M){const $=q.slice();return $[52]=_[M],$[54]=M,$}function get_each_context_1(q,_,M){const $=q.slice();return $[55]=_[M],$[57]=M,$}function get_each_context_2(q,_,M){const $=q.slice();return $[55]=_[M],$[59]=M,$}function get_each_context_4(q,_,M){const $=q.slice();return $[63]=_[M],$}function get_each_context_3(q,_,M){const $=q.slice();return $[60]=_[M],$}function create_if_block_24(q){return{c:noop,m:noop,d:noop}}function create_else_block_6(q){let _,M,$,j,z=q[5]?`${q[13]}, ${q[12]} `:"",V,X,G,Y,Q,ee,te,Z,ne,re,se=settings.servers.length===1?"Server:":`${settings.servers.length} Servers:`,ie,oe,ue,ce,ae,le,he,ge,de,pe=PHASE_NAME[q[3]]+"",ye,_e,De,fe,Ae,Me=q[4].length+"",Ee,Te,Be,Xe=!q[7].includes("commons"),ze,Oe,Pe,ve,be,Ce;ce=new ServerList({});let Ne=Xe&&create_if_block_23(q);function Ie(Ve,ot){return Ve[11]?create_if_block_22:create_else_block_7}let Le=Ie(q),je=Le(q);return{c(){_=element("div"),M=element("h6"),M.textContent=`${q[31]} status`,$=space(),j=element("p"),V=text(z),X=space(),G=element("div"),Y=text("Share Address:"),Q=element("br"),ee=space(),te=text(q[7]),Z=space(),ne=element("div"),re=text("Currrent "),ie=text(se),oe=element("br"),ue=space(),create_component(ce.$$.fragment),ae=space(),le=element("div"),he=element("p"),ge=element("b"),ge.textContent="Phase of decay:",de=space(),ye=text(pe),_e=space(),De=element("p"),fe=element("b"),fe.textContent="Number of artefacts in the Commons:",Ae=space(),Ee=text(Me),Te=space(),Be=element("div"),Ne&&Ne.c(),ze=space(),Oe=element("div"),Pe=element("button"),je.c(),attr(M,"class","text-left"),attr(j,"class","text-left text-xl font-bold mb-2"),attr(G,"class","text-left font-bold mb-2 truncate ..."),attr(ne,"class","text-left font-bold mb-2 truncate ..."),attr(he,"class","text-left"),attr(De,"class","text-left"),attr(le,"class","flex flex-col justify-left"),attr(Pe,"class","my-6"),attr(Oe,"class","w-full"),attr(Be,"class","flex flex-col w-full")},m(Ve,ot){insert(Ve,_,ot),append(_,M),append(_,$),append(_,j),append(j,V),append(_,X),append(_,G),append(G,Y),append(G,Q),append(G,ee),append(G,te),append(_,Z),append(_,ne),append(ne,re),append(ne,ie),append(ne,oe),append(ne,ue),mount_component(ce,ne,null),append(_,ae),append(_,le),append(le,he),append(he,ge),append(he,de),append(he,ye),append(le,_e),append(le,De),append(De,fe),append(De,Ae),append(De,Ee),insert(Ve,Te,ot),insert(Ve,Be,ot),Ne&&Ne.m(Be,null),append(Be,ze),append(Be,Oe),append(Oe,Pe),je.m(Pe,null),ve=!0,be||(Ce=listen(Pe,"click",q[24]),be=!0)},p(Ve,ot){(!ve||ot[0]&12320)&&z!==(z=Ve[5]?`${Ve[13]}, ${Ve[12]} `:"")&&set_data(V,z),(!ve||ot[0]&128)&&set_data(te,Ve[7]),(!ve||ot[0]&8)&&pe!==(pe=PHASE_NAME[Ve[3]]+"")&&set_data(ye,pe),(!ve||ot[0]&16)&&Me!==(Me=Ve[4].length+"")&&set_data(Ee,Me),ot[0]&128&&(Xe=!Ve[7].includes("commons")),Xe?Ne?Ne.p(Ve,ot):(Ne=create_if_block_23(Ve),Ne.c(),Ne.m(Be,ze)):Ne&&(Ne.d(1),Ne=null),Le!==(Le=Ie(Ve))&&(je.d(1),je=Le(Ve),je&&(je.c(),je.m(Pe,null)))},i(Ve){ve||(transition_in(ce.$$.fragment,Ve),ve=!0)},o(Ve){transition_out(ce.$$.fragment,Ve),ve=!1},d(Ve){Ve&&detach(_),destroy_component(ce),Ve&&detach(Te),Ve&&detach(Be),Ne&&Ne.d(),je.d(),be=!1,Ce()}}}function create_if_block_21(q){let _,M,$;return M=new DocDetails({props:{doc:q[5],attachment:q[1],isReply:q[2]}}),{c(){_=element("div"),create_component(M.$$.fragment)},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z[0]&32&&(V.doc=j[5]),z[0]&2&&(V.attachment=j[1]),z[0]&4&&(V.isReply=j[2]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_23(q){let _,M,$,j;return{c(){_=element("div"),M=element("button"),M.textContent="take me back to Commons",attr(_,"class","w-auto")},m(z,V){insert(z,_,V),append(_,M),$||(j=listen(M,"click",q[20]),$=!0)},p:noop,d(z){z&&detach(_),$=!1,j()}}}function create_else_block_7(q){let _;return{c(){_=text("Back to viewing")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_22(q){let _;return{c(){_=text("Place an artefact")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_20(q){let _,M,$;return M=new Upload({props:{filetype:q[15],xy:q[16]}}),M.$on("success",q[28]),M.$on("close",q[29]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","relative"),set_style(_,"z-index","51")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z[0]&32768&&(V.filetype=j[15]),z[0]&65536&&(V.xy=j[16]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_19(q){let _,M,$;return M=new GridUpload({props:{windowWidth:q[6]}}),M.$on("success",q[37]),M.$on("upload",q[38]),M.$on("selected",q[27]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","relative pl-6"),set_style(_,"z-index","51")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z[0]&64&&(V.windowWidth=j[6]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_18(q){let _,M,$;return M=new View({props:{selectedDocument:q[5]}}),M.$on("close",q[36]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","artifact-overlay ml-24 mt-[12vh] h-[80vh] w-[76vw] fixed svelte-jlslkc")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z[0]&32&&(V.selectedDocument=j[5]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_else_block_4(q){let _,M=[],$=new Map,j,z,V={length:q[21][0]};const X=G=>G[57];for(let G=0;G<V.length;G+=1){let Y=get_each_context_5(q,V,G),Q=X(Y);$.set(Q,M[G]=create_each_block_5(Q,Y))}return{c(){_=element("div");for(let G=0;G<M.length;G+=1)M[G].c();attr(_,"id","Studio"),attr(_,"class","my-grid-container studio-grid w-screen mb-32 svelte-jlslkc"),attr(_,"style",j=`background-color: white; ${q[9]?"grid-template-columns: repeat(3, 1fr); grid-template-rows: auto;":`grid-template-columns: ${q[17]}; grid-template-rows: ${q[18]};`}`)},m(G,Y){insert(G,_,Y);for(let Q=0;Q<M.length;Q+=1)M[Q].m(_,null);z=!0},p(G,Y){Y[0]&10486544&&(V={length:G[21][0]},group_outros(),M=update_keyed_each(M,Y,X,1,G,V,$,_,outro_and_destroy_block,create_each_block_5,null,get_each_context_5),check_outros()),(!z||Y[0]&393728&&j!==(j=`background-color: white; ${G[9]?"grid-template-columns: repeat(3, 1fr); grid-template-rows: auto;":`grid-template-columns: ${G[17]}; grid-template-rows: ${G[18]};`}`))&&attr(_,"style",j)},i(G){if(!z){for(let Y=0;Y<V.length;Y+=1)transition_in(M[Y]);z=!0}},o(G){for(let Y=0;Y<M.length;Y+=1)transition_out(M[Y]);z=!1},d(G){G&&detach(_);for(let Y=0;Y<M.length;Y+=1)M[Y].d()}}}function create_if_block_1$6(q){let _=[],M=new Map,$,j,z,V=LUNAR_PHASE;const X=G=>G[54];for(let G=0;G<V.length;G+=1){let Y=get_each_context$5(q,V,G),Q=X(Y);M.set(Q,_[G]=create_each_block$5(Q,Y))}return j=new StudioPortal({}),j.$on("shareUpdated",q[30]),{c(){for(let G=0;G<_.length;G+=1)_[G].c();$=space(),create_component(j.$$.fragment)},m(G,Y){for(let Q=0;Q<_.length;Q+=1)_[Q].m(G,Y);insert(G,$,Y),mount_component(j,G,Y),z=!0},p(G,Y){Y[0]&15074064&&(V=LUNAR_PHASE,group_outros(),_=update_keyed_each(_,Y,X,1,G,V,M,$.parentNode,outro_and_destroy_block,create_each_block$5,$,get_each_context$5),check_outros())},i(G){if(!z){for(let Y=0;Y<V.length;Y+=1)transition_in(_[Y]);transition_in(j.$$.fragment,G),z=!0}},o(G){for(let Y=0;Y<_.length;Y+=1)transition_out(_[Y]);transition_out(j.$$.fragment,G),z=!1},d(G){for(let Y=0;Y<_.length;Y+=1)_[Y].d(G);G&&detach($),destroy_component(j,G)}}}function create_if_block$a(q){let _;return{c(){_=element("div"),_.innerHTML='<h3 class="p-6">Looking for artefacts</h3>',attr(_,"class","flex flex-col items-center justify-center align-middle h-[60vh]")},m(M,$){insert(M,_,$)},p:noop,i:noop,o:noop,d(M){M&&detach(_)}}}function create_else_block_5(q){let _,M,$=q[4].find(V),j,z;function V(...ee){return q[34](q[57],q[59],...ee)}function X(ee,te){if(ee[57]===0)return create_if_block_15;if(ee[59]===0)return create_if_block_17}let G=X(q),Y=G&&G(q),Q=$&&create_if_block_14(q);return{c(){_=element("div"),Y&&Y.c(),M=space(),Q&&Q.c(),j=space(),attr(_,"class","borderstudio svelte-jlslkc")},m(ee,te){insert(ee,_,te),Y&&Y.m(_,null),append(_,M),Q&&Q.m(_,null),append(_,j),z=!0},p(ee,te){q=ee,Y&&Y.p(q,te),te[0]&16&&($=q[4].find(V)),$?Q?(Q.p(q,te),te[0]&16&&transition_in(Q,1)):(Q=create_if_block_14(q),Q.c(),transition_in(Q,1),Q.m(_,j)):Q&&(group_outros(),transition_out(Q,1,1,()=>{Q=null}),check_outros())},i(ee){z||(transition_in(Q),z=!0)},o(ee){transition_out(Q),z=!1},d(ee){ee&&detach(_),Y&&Y.d(),Q&&Q.d()}}}function create_if_block_12(q){let _,M,$=q[8][q[59]][q[57]]&&q[8][q[59]][q[57]].length>0&&create_if_block_13(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,z){j[8][j[59]][j[57]]&&j[8][j[59]][j[57]].length>0?$?($.p(j,z),z[0]&256&&transition_in($,1)):($=create_if_block_13(j),$.c(),transition_in($,1),$.m(_.parentNode,_)):$&&(group_outros(),transition_out($,1,1,()=>{$=null}),check_outros())},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function create_if_block_17(q){let _,M=q[57]+1+"",$;return{c(){_=element("p"),$=text(M),attr(_,"class","text-left text-xl")},m(j,z){insert(j,_,z),append(_,$)},p:noop,d(j){j&&detach(_)}}}function create_if_block_15(q){let _,M=mapNumberToLetter$1(q[59])+"",$,j,z,V=q[59]===0&&create_if_block_16(q);return{c(){_=element("p"),$=text(M),j=space(),V&&V.c(),z=empty(),attr(_,"class","text-xl")},m(X,G){insert(X,_,G),append(_,$),insert(X,j,G),V&&V.m(X,G),insert(X,z,G)},p(X,G){X[59]===0&&V.p(X,G)},d(X){X&&detach(_),X&&detach(j),V&&V.d(X),X&&detach(z)}}}function create_if_block_16(q){let _,M=q[57]+1+"",$;return{c(){_=element("p"),$=text(M),attr(_,"class","text-left text-xl")},m(j,z){insert(j,_,z),append(_,$)},p:noop,d(j){j&&detach(_)}}}function create_if_block_14(q){let _=[],M=new Map,$,j;function z(...G){return q[44](q[57],q[59],...G)}let V=q[4].filter(z);const X=G=>G[63].textHash+G[63].timestamp;for(let G=0;G<V.length;G+=1){let Y=get_each_context_8(q,V,G),Q=X(Y);M.set(Q,_[G]=create_each_block_8(Q,Y))}return{c(){for(let G=0;G<_.length;G+=1)_[G].c();$=empty()},m(G,Y){for(let Q=0;Q<_.length;Q+=1)_[Q].m(G,Y);insert(G,$,Y),j=!0},p(G,Y){q=G,Y[0]&10485776&&(V=q[4].filter(z),group_outros(),_=update_keyed_each(_,Y,X,1,q,V,M,$.parentNode,outro_and_destroy_block,create_each_block_8,$,get_each_context_8),check_outros())},i(G){if(!j){for(let Y=0;Y<V.length;Y+=1)transition_in(_[Y]);j=!0}},o(G){for(let Y=0;Y<_.length;Y+=1)transition_out(_[Y]);j=!1},d(G){for(let Y=0;Y<_.length;Y+=1)_[Y].d(G);G&&detach($)}}}function create_each_block_8(q,_){let M,$,j,z,V,X,G,Y;$=new OrbitingReplies({props:{doc:_[63]}});function Q(){return _[45](_[63])}return V=new Icon({props:{replies,phase:"1",doc:_[63]}}),V.$on("click",Q),{key:q,first:null,c(){M=element("div"),create_component($.$$.fragment),j=space(),z=element("div"),create_component(V.$$.fragment),X=space(),attr(z,"class","orbit-icon svelte-jlslkc"),attr(M,"id",G=_[63].textHash+_[63].timestamp),attr(M,"class","orbit-icon-container svelte-jlslkc"),this.first=M},m(ee,te){insert(ee,M,te),mount_component($,M,null),append(M,j),append(M,z),mount_component(V,z,null),append(M,X),Y=!0},p(ee,te){_=ee;const Z={};te[0]&16&&(Z.doc=_[63]),$.$set(Z);const ne={};te[0]&16&&(ne.doc=_[63]),V.$set(ne),(!Y||te[0]&16&&G!==(G=_[63].textHash+_[63].timestamp))&&attr(M,"id",G)},i(ee){Y||(transition_in($.$$.fragment,ee),transition_in(V.$$.fragment,ee),Y=!0)},o(ee){transition_out($.$$.fragment,ee),transition_out(V.$$.fragment,ee),Y=!1},d(ee){ee&&detach(M),destroy_component($),destroy_component(V)}}}function create_if_block_13(q){let _,M=q[57]+"",$,j,z=q[59]+"",V,X,G,Y,Q=q[8][q[59]][q[57]],ee=[];for(let Z=0;Z<Q.length;Z+=1)ee[Z]=create_each_block_7(get_each_context_7(q,Q,Z));const te=Z=>transition_out(ee[Z],1,1,()=>{ee[Z]=null});return{c(){_=element("div"),$=text(M),j=text(","),V=text(z),X=space();for(let Z=0;Z<ee.length;Z+=1)ee[Z].c();G=space(),attr(_,"id",`Studio_cell_${q[57]}_${q[59]}`),attr(_,"class","grid-cell svelte-jlslkc")},m(Z,ne){insert(Z,_,ne),append(_,$),append(_,j),append(_,V),append(_,X);for(let re=0;re<ee.length;re+=1)ee[re].m(_,null);append(_,G),Y=!0},p(Z,ne){if(ne[0]&10486016){Q=Z[8][Z[59]][Z[57]];let re;for(re=0;re<Q.length;re+=1){const se=get_each_context_7(Z,Q,re);ee[re]?(ee[re].p(se,ne),transition_in(ee[re],1)):(ee[re]=create_each_block_7(se),ee[re].c(),transition_in(ee[re],1),ee[re].m(_,G))}for(group_outros(),re=Q.length;re<ee.length;re+=1)te(re);check_outros()}},i(Z){if(!Y){for(let ne=0;ne<Q.length;ne+=1)transition_in(ee[ne]);Y=!0}},o(Z){ee=ee.filter(Boolean);for(let ne=0;ne<ee.length;ne+=1)transition_out(ee[ne]);Y=!1},d(Z){Z&&detach(_),destroy_each(ee,Z)}}}function create_each_block_7(q){let _,M,$,j,z,V,X;M=new OrbitingReplies({props:{doc:q[60].doc}});function G(){return q[43](q[60])}return z=new Icon({props:{replies,phase:1,doc:q[60].doc}}),z.$on("click",G),{c(){_=element("div"),create_component(M.$$.fragment),$=space(),j=element("div"),create_component(z.$$.fragment),attr(j,"class","orbit-icon svelte-jlslkc"),attr(_,"id",V=q[57]+q[59]+q[60].doc.textHash+q[60].doc.timestamp),attr(_,"class","orbit-icon-container svelte-jlslkc")},m(Y,Q){insert(Y,_,Q),mount_component(M,_,null),append(_,$),append(_,j),mount_component(z,j,null),X=!0},p(Y,Q){q=Y;const ee={};Q[0]&256&&(ee.doc=q[60].doc),M.$set(ee);const te={};Q[0]&256&&(te.doc=q[60].doc),z.$set(te),(!X||Q[0]&256&&V!==(V=q[57]+q[59]+q[60].doc.textHash+q[60].doc.timestamp))&&attr(_,"id",V)},i(Y){X||(transition_in(M.$$.fragment,Y),transition_in(z.$$.fragment,Y),X=!0)},o(Y){transition_out(M.$$.fragment,Y),transition_out(z.$$.fragment,Y),X=!1},d(Y){Y&&detach(_),destroy_component(M),destroy_component(z)}}}function create_each_block_6(q,_){let M,$,j,z,V;const X=[create_if_block_12,create_else_block_5],G=[];function Y(Q,ee){return Q[9]?0:1}return $=Y(_),j=G[$]=X[$](_),{key:q,first:null,c(){M=empty(),j.c(),z=empty(),this.first=M},m(Q,ee){insert(Q,M,ee),G[$].m(Q,ee),insert(Q,z,ee),V=!0},p(Q,ee){_=Q;let te=$;$=Y(_),$===te?G[$].p(_,ee):(group_outros(),transition_out(G[te],1,1,()=>{G[te]=null}),check_outros(),j=G[$],j?j.p(_,ee):(j=G[$]=X[$](_),j.c()),transition_in(j,1),j.m(z.parentNode,z))},i(Q){V||(transition_in(j),V=!0)},o(Q){transition_out(j),V=!1},d(Q){Q&&detach(M),G[$].d(Q),Q&&detach(z)}}}function create_each_block_5(q,_){let M,$=[],j=new Map,z,V,X={length:_[21][1]};const G=Y=>Y[59];for(let Y=0;Y<X.length;Y+=1){let Q=get_each_context_6(_,X,Y),ee=G(Q);j.set(ee,$[Y]=create_each_block_6(ee,Q))}return{key:q,first:null,c(){M=empty();for(let Y=0;Y<$.length;Y+=1)$[Y].c();z=empty(),this.first=M},m(Y,Q){insert(Y,M,Q);for(let ee=0;ee<$.length;ee+=1)$[ee].m(Y,Q);insert(Y,z,Q),V=!0},p(Y,Q){_=Y,Q[0]&10486544&&(X={length:_[21][1]},group_outros(),$=update_keyed_each($,Q,G,1,_,X,j,z.parentNode,outro_and_destroy_block,create_each_block_6,z,get_each_context_6),check_outros())},i(Y){if(!V){for(let Q=0;Q<X.length;Q+=1)transition_in($[Q]);V=!0}},o(Y){for(let Q=0;Q<$.length;Q+=1)transition_out($[Q]);V=!1},d(Y){Y&&detach(M);for(let Q=0;Q<$.length;Q+=1)$[Q].d(Y);Y&&detach(z)}}}function create_else_block_1$1(q){let _,M,$=q[4].find(z),j;function z(...Q){return q[33](q[57],q[59],...Q)}function V(Q,ee){if(Q[57]===0)return create_if_block_9;if(Q[59]===0)return create_if_block_11}let X=V(q),G=X&&X(q),Y=$&&create_if_block_5(q);return{c(){_=element("div"),G&&G.c(),M=space(),Y&&Y.c(),attr(_,"id",q[59]+"+"+q[57]+"+"+q[54]),attr(_,"class","grid-cell "+(q[59]===0&&q[57]===0&&q[54]===0?"first-cell-offset":"")+" "+(q[57]===0&&q[59]!==0&&q[54]===0?"top-row-offset":"")+" "+(q[59]===0&&!(q[57]===0&&q[59]===0&&q[54]===0)?"first-col-offset":"")+" svelte-jlslkc")},m(Q,ee){insert(Q,_,ee),G&&G.m(_,null),append(_,M),Y&&Y.m(_,null),j=!0},p(Q,ee){q=Q,G&&G.p(q,ee),ee[0]&16&&($=q[4].find(z)),$?Y?(Y.p(q,ee),ee[0]&16&&transition_in(Y,1)):(Y=create_if_block_5(q),Y.c(),transition_in(Y,1),Y.m(_,null)):Y&&(group_outros(),transition_out(Y,1,1,()=>{Y=null}),check_outros())},i(Q){j||(transition_in(Y),j=!0)},o(Q){transition_out(Y),j=!1},d(Q){Q&&detach(_),G&&G.d(),Y&&Y.d()}}}function create_if_block_2$5(q){let _,M,$=q[8][q[59]][q[57]]&&q[8][q[59]][q[57]].length>0&&create_if_block_3$3(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,z){j[8][j[59]][j[57]]&&j[8][j[59]][j[57]].length>0?$?($.p(j,z),z[0]&256&&transition_in($,1)):($=create_if_block_3$3(j),$.c(),transition_in($,1),$.m(_.parentNode,_)):$&&(group_outros(),transition_out($,1,1,()=>{$=null}),check_outros())},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function create_if_block_11(q){let _,M=q[57]+1+"",$;return{c(){_=element("p"),$=text(M),attr(_,"class","text-left text-xl")},m(j,z){insert(j,_,z),append(_,$)},p:noop,d(j){j&&detach(_)}}}function create_if_block_9(q){let _,M=mapNumberToLetter$1(q[59])+"",$,j,z,V=q[59]===0&&create_if_block_10(q);return{c(){_=element("p"),$=text(M),j=space(),V&&V.c(),z=empty(),attr(_,"class","text-xl")},m(X,G){insert(X,_,G),append(_,$),insert(X,j,G),V&&V.m(X,G),insert(X,z,G)},p(X,G){X[59]===0&&V.p(X,G)},d(X){X&&detach(_),X&&detach(j),V&&V.d(X),X&&detach(z)}}}function create_if_block_10(q){let _,M=q[57]+1+"",$;return{c(){_=element("p"),$=text(M),attr(_,"class","text-left text-xl")},m(j,z){insert(j,_,z),append(_,$)},p:noop,d(j){j&&detach(_)}}}function create_if_block_5(q){let _=[],M=new Map,$,j;function z(...G){return q[40](q[57],q[59],...G)}let V=q[4].filter(z);const X=G=>G[63].textHash+G[63].timestamp;for(let G=0;G<V.length;G+=1){let Y=get_each_context_4(q,V,G),Q=X(Y);M.set(Q,_[G]=create_each_block_4(Q,Y))}return{c(){for(let G=0;G<_.length;G+=1)_[G].c();$=empty()},m(G,Y){for(let Q=0;Q<_.length;Q+=1)_[Q].m(G,Y);insert(G,$,Y),j=!0},p(G,Y){q=G,Y[0]&14680080&&(V=q[4].filter(z),group_outros(),_=update_keyed_each(_,Y,X,1,q,V,M,$.parentNode,outro_and_destroy_block,create_each_block_4,$,get_each_context_4),check_outros())},i(G){if(!j){for(let Y=0;Y<V.length;Y+=1)transition_in(_[Y]);j=!0}},o(G){for(let Y=0;Y<_.length;Y+=1)transition_out(_[Y]);j=!1},d(G){for(let Y=0;Y<_.length;Y+=1)_[Y].d(G);G&&detach($)}}}function create_else_block_3(q){let _,M,$,j,z;_=new OrbitingReplies({props:{doc:q[63]}});function V(){return q[42](q[63])}return j=new Icon({props:{replies,phase:q[63].lunarPhase,doc:q[63]}}),j.$on("click",V),{c(){create_component(_.$$.fragment),M=space(),$=element("div"),create_component(j.$$.fragment),attr($,"class","orbit-icon svelte-jlslkc")},m(X,G){mount_component(_,X,G),insert(X,M,G),insert(X,$,G),mount_component(j,$,null),z=!0},p(X,G){q=X;const Y={};G[0]&16&&(Y.doc=q[63]),_.$set(Y);const Q={};G[0]&16&&(Q.phase=q[63].lunarPhase),G[0]&16&&(Q.doc=q[63]),j.$set(Q)},i(X){z||(transition_in(_.$$.fragment,X),transition_in(j.$$.fragment,X),z=!0)},o(X){transition_out(_.$$.fragment,X),transition_out(j.$$.fragment,X),z=!1},d(X){destroy_component(_,X),X&&detach(M),X&&detach($),destroy_component(j)}}}function create_if_block_8(q){let _,M,$,j,z;return _=new OrbitingReplies({props:{doc:q[63],disabled:!0}}),j=new Icon({props:{replies,phase:q[63].lunarPhase,doc:q[63],disabled:!0}}),{c(){create_component(_.$$.fragment),M=space(),$=element("div"),create_component(j.$$.fragment),attr($,"class","orbit-icon svelte-jlslkc")},m(V,X){mount_component(_,V,X),insert(V,M,X),insert(V,$,X),mount_component(j,$,null),z=!0},p(V,X){const G={};X[0]&16&&(G.doc=V[63]),_.$set(G);const Y={};X[0]&16&&(Y.phase=V[63].lunarPhase),X[0]&16&&(Y.doc=V[63]),j.$set(Y)},i(V){z||(transition_in(_.$$.fragment,V),transition_in(j.$$.fragment,V),z=!0)},o(V){transition_out(_.$$.fragment,V),transition_out(j.$$.fragment,V),z=!1},d(V){destroy_component(_,V),V&&detach(M),V&&detach($),destroy_component(j)}}}function create_if_block_6(q){let _,M,$,j;const z=[create_if_block_7,create_else_block_2],V=[];function X(G,Y){return G[22]<G[63].deleteAfter-G[52]?1:0}return _=X(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(G,Y){V[_].m(G,Y),insert(G,$,Y),j=!0},p(G,Y){let Q=_;_=X(G),_===Q?V[_].p(G,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(G,Y):(M=V[_]=z[_](G),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(G){j||(transition_in(M),j=!0)},o(G){transition_out(M),j=!1},d(G){V[_].d(G),G&&detach($)}}}function create_else_block_2(q){let _,M,$,j,z;_=new OrbitingReplies({props:{doc:q[63]}});function V(){return q[41](q[63])}return j=new Icon({props:{replies,phase:q[52],doc:q[63]}}),j.$on("click",V),{c(){create_component(_.$$.fragment),M=space(),$=element("div"),create_component(j.$$.fragment),attr($,"class","orbit-icon svelte-jlslkc")},m(X,G){mount_component(_,X,G),insert(X,M,G),insert(X,$,G),mount_component(j,$,null),z=!0},p(X,G){q=X;const Y={};G[0]&16&&(Y.doc=q[63]),_.$set(Y);const Q={};G[0]&16&&(Q.doc=q[63]),j.$set(Q)},i(X){z||(transition_in(_.$$.fragment,X),transition_in(j.$$.fragment,X),z=!0)},o(X){transition_out(_.$$.fragment,X),transition_out(j.$$.fragment,X),z=!1},d(X){destroy_component(_,X),X&&detach(M),X&&detach($),destroy_component(j)}}}function create_if_block_7(q){let _,M,$,j,z;return _=new OrbitingReplies({props:{doc:q[63],disabled:!0}}),j=new Icon({props:{replies,phase:q[63].lunarPhase,doc:q[63],disabled:!0}}),{c(){create_component(_.$$.fragment),M=space(),$=element("div"),create_component(j.$$.fragment),attr($,"class","orbit-icon svelte-jlslkc")},m(V,X){mount_component(_,V,X),insert(V,M,X),insert(V,$,X),mount_component(j,$,null),z=!0},p(V,X){const G={};X[0]&16&&(G.doc=V[63]),_.$set(G);const Y={};X[0]&16&&(Y.phase=V[63].lunarPhase),X[0]&16&&(Y.doc=V[63]),j.$set(Y)},i(V){z||(transition_in(_.$$.fragment,V),transition_in(j.$$.fragment,V),z=!0)},o(V){transition_out(_.$$.fragment,V),transition_out(j.$$.fragment,V),z=!1},d(V){destroy_component(_,V),V&&detach(M),V&&detach($),destroy_component(j)}}}function create_each_block_4(q,_){let M,$,j,z,V;const X=[create_if_block_6,create_if_block_8,create_else_block_3],G=[];function Y(Q,ee){return Q[63].lunarPhase===Q[54]?0:Q[22]<Q[63].deleteAfter-Q[52]&&Q[22]>Q[63].deleteAfter-(Q[52]+63936e7)?2:1}return $=Y(_),j=G[$]=X[$](_),{key:q,first:null,c(){M=element("div"),j.c(),attr(M,"id",z=_[63].textHash+_[63].timestamp),attr(M,"class","orbit-icon-container svelte-jlslkc"),this.first=M},m(Q,ee){insert(Q,M,ee),G[$].m(M,null),V=!0},p(Q,ee){_=Q;let te=$;$=Y(_),$===te?G[$].p(_,ee):(group_outros(),transition_out(G[te],1,1,()=>{G[te]=null}),check_outros(),j=G[$],j?j.p(_,ee):(j=G[$]=X[$](_),j.c()),transition_in(j,1),j.m(M,null)),(!V||ee[0]&16&&z!==(z=_[63].textHash+_[63].timestamp))&&attr(M,"id",z)},i(Q){V||(transition_in(j),V=!0)},o(Q){transition_out(j),V=!1},d(Q){Q&&detach(M),G[$].d()}}}function create_if_block_3$3(q){let _,M=q[57]+"",$,j,z=q[59]+"",V,X,G,Y=q[8][q[59]][q[57]],Q=[];for(let te=0;te<Y.length;te+=1)Q[te]=create_each_block_3(get_each_context_3(q,Y,te));const ee=te=>transition_out(Q[te],1,1,()=>{Q[te]=null});return{c(){_=element("div"),$=text(M),j=text(","),V=text(z),X=space();for(let te=0;te<Q.length;te+=1)Q[te].c();attr(_,"id",`phase${q[54]}_cell_${q[57]}_${q[59]}`),attr(_,"class","grid-cell h-full svelte-jlslkc")},m(te,Z){insert(te,_,Z),append(_,$),append(_,j),append(_,V),append(_,X);for(let ne=0;ne<Q.length;ne+=1)Q[ne].m(_,null);G=!0},p(te,Z){if(Z[0]&10486016){Y=te[8][te[59]][te[57]];let ne;for(ne=0;ne<Y.length;ne+=1){const re=get_each_context_3(te,Y,ne);Q[ne]?(Q[ne].p(re,Z),transition_in(Q[ne],1)):(Q[ne]=create_each_block_3(re),Q[ne].c(),transition_in(Q[ne],1),Q[ne].m(_,null))}for(group_outros(),ne=Y.length;ne<Q.length;ne+=1)ee(ne);check_outros()}},i(te){if(!G){for(let Z=0;Z<Y.length;Z+=1)transition_in(Q[Z]);G=!0}},o(te){Q=Q.filter(Boolean);for(let Z=0;Z<Q.length;Z+=1)transition_out(Q[Z]);G=!1},d(te){te&&detach(_),destroy_each(Q,te)}}}function create_else_block$1(q){let _,M,$,j,z;return _=new OrbitingReplies({props:{doc:q[60].doc,disabled:!0}}),j=new Icon({props:{replies,phase:q[52],doc:q[60].doc,disabled:!0}}),{c(){create_component(_.$$.fragment),M=space(),$=element("div"),create_component(j.$$.fragment),attr($,"class","orbit-icon svelte-jlslkc")},m(V,X){mount_component(_,V,X),insert(V,M,X),insert(V,$,X),mount_component(j,$,null),z=!0},p(V,X){const G={};X[0]&256&&(G.doc=V[60].doc),_.$set(G);const Y={};X[0]&256&&(Y.doc=V[60].doc),j.$set(Y)},i(V){z||(transition_in(_.$$.fragment,V),transition_in(j.$$.fragment,V),z=!0)},o(V){transition_out(_.$$.fragment,V),transition_out(j.$$.fragment,V),z=!1},d(V){destroy_component(_,V),V&&detach(M),V&&detach($),destroy_component(j)}}}function create_if_block_4$1(q){let _,M,$,j,z;_=new OrbitingReplies({props:{doc:q[60].doc}});function V(){return q[39](q[60])}return j=new Icon({props:{replies,phase:q[54],doc:q[60].doc}}),j.$on("click",V),{c(){create_component(_.$$.fragment),M=space(),$=element("div"),create_component(j.$$.fragment),attr($,"class","orbit-icon h-full svelte-jlslkc")},m(X,G){mount_component(_,X,G),insert(X,M,G),insert(X,$,G),mount_component(j,$,null),z=!0},p(X,G){q=X;const Y={};G[0]&256&&(Y.doc=q[60].doc),_.$set(Y);const Q={};G[0]&256&&(Q.doc=q[60].doc),j.$set(Q)},i(X){z||(transition_in(_.$$.fragment,X),transition_in(j.$$.fragment,X),z=!0)},o(X){transition_out(_.$$.fragment,X),transition_out(j.$$.fragment,X),z=!1},d(X){destroy_component(_,X),X&&detach(M),X&&detach($),destroy_component(j)}}}function create_each_block_3(q){let _,M,$,j,z;const V=[create_if_block_4$1,create_else_block$1],X=[];function G(Y,Q){return Y[60].lunarPhase===Y[54]?0:1}return M=G(q),$=X[M]=V[M](q),{c(){_=element("div"),$.c(),attr(_,"id",j=q[57]+q[59]+q[60].doc.textHash+q[60].doc.timestamp),attr(_,"class","orbit-icon-container h-full svelte-jlslkc")},m(Y,Q){insert(Y,_,Q),X[M].m(_,null),z=!0},p(Y,Q){let ee=M;M=G(Y),M===ee?X[M].p(Y,Q):(group_outros(),transition_out(X[ee],1,1,()=>{X[ee]=null}),check_outros(),$=X[M],$?$.p(Y,Q):($=X[M]=V[M](Y),$.c()),transition_in($,1),$.m(_,null)),(!z||Q[0]&256&&j!==(j=Y[57]+Y[59]+Y[60].doc.textHash+Y[60].doc.timestamp))&&attr(_,"id",j)},i(Y){z||(transition_in($),z=!0)},o(Y){transition_out($),z=!1},d(Y){Y&&detach(_),X[M].d()}}}function create_each_block_2(q,_){let M,$,j,z,V;const X=[create_if_block_2$5,create_else_block_1$1],G=[];function Y(Q,ee){return Q[9]?0:1}return $=Y(_),j=G[$]=X[$](_),{key:q,first:null,c(){M=empty(),j.c(),z=empty(),this.first=M},m(Q,ee){insert(Q,M,ee),G[$].m(Q,ee),insert(Q,z,ee),V=!0},p(Q,ee){_=Q;let te=$;$=Y(_),$===te?G[$].p(_,ee):(group_outros(),transition_out(G[te],1,1,()=>{G[te]=null}),check_outros(),j=G[$],j?j.p(_,ee):(j=G[$]=X[$](_),j.c()),transition_in(j,1),j.m(z.parentNode,z))},i(Q){V||(transition_in(j),V=!0)},o(Q){transition_out(j),V=!1},d(Q){Q&&detach(M),G[$].d(Q),Q&&detach(z)}}}function create_each_block_1(q,_){let M,$=[],j=new Map,z,V,X={length:_[21][1]};const G=Y=>Y[59];for(let Y=0;Y<X.length;Y+=1){let Q=get_each_context_2(_,X,Y),ee=G(Q);j.set(ee,$[Y]=create_each_block_2(ee,Q))}return{key:q,first:null,c(){M=empty();for(let Y=0;Y<$.length;Y+=1)$[Y].c();z=empty(),this.first=M},m(Y,Q){insert(Y,M,Q);for(let ee=0;ee<$.length;ee+=1)$[ee].m(Y,Q);insert(Y,z,Q),V=!0},p(Y,Q){_=Y,Q[0]&14680848&&(X={length:_[21][1]},group_outros(),$=update_keyed_each($,Q,G,1,_,X,j,z.parentNode,outro_and_destroy_block,create_each_block_2,z,get_each_context_2),check_outros())},i(Y){if(!V){for(let Q=0;Q<X.length;Q+=1)transition_in($[Q]);V=!0}},o(Y){for(let Q=0;Q<$.length;Q+=1)transition_out($[Q]);V=!1},d(Y){Y&&detach(M);for(let Q=0;Q<$.length;Q+=1)$[Q].d(Y);Y&&detach(z)}}}function create_each_block$5(q,_){let M,$=[],j=new Map,z,V,X={length:_[21][0]};const G=Y=>Y[57];for(let Y=0;Y<X.length;Y+=1){let Q=get_each_context_1(_,X,Y),ee=G(Q);j.set(ee,$[Y]=create_each_block_1(ee,Q))}return{key:q,first:null,c(){M=element("div");for(let Y=0;Y<$.length;Y+=1)$[Y].c();attr(M,"id",`section${_[54]}`),attr(M,"class","my-grid-container w-screen h-full svelte-jlslkc"),attr(M,"style",z=`background-color: ${COLOR_CYCLE[_[54]]}; ${_[9]?"grid-template-columns: repeat(3, 1fr); grid-template-rows: auto;":`grid-template-columns: ${_[17]}; grid-template-rows: ${_[18]};`}`),this.first=M},m(Y,Q){insert(Y,M,Q);for(let ee=0;ee<$.length;ee+=1)$[ee].m(M,null);V=!0},p(Y,Q){_=Y,Q[0]&14680848&&(X={length:_[21][0]},group_outros(),$=update_keyed_each($,Q,G,1,_,X,j,M,outro_and_destroy_block,create_each_block_1,null,get_each_context_1),check_outros()),(!V||Q[0]&393728&&z!==(z=`background-color: ${COLOR_CYCLE[_[54]]}; ${_[9]?"grid-template-columns: repeat(3, 1fr); grid-template-rows: auto;":`grid-template-columns: ${_[17]}; grid-template-rows: ${_[18]};`}`))&&attr(M,"style",z)},i(Y){if(!V){for(let Q=0;Q<X.length;Q+=1)transition_in($[Q]);V=!0}},o(Y){for(let Q=0;Q<$.length;Q+=1)transition_out($[Q]);V=!1},d(Y){Y&&detach(M);for(let Q=0;Q<$.length;Q+=1)$[Q].d()}}}function create_fragment$g(q){let _,M,$,j,z,V,X,G,Y=q[19].address.slice(0,5)+"",Q,ee,te,Z,ne,re,se,ie,oe,ue,ce,ae,le,he,ge,de,pe,ye,_e=q[0]&&create_if_block_24();const De=[create_if_block_21,create_else_block_6],fe=[];function Ae(Oe,Pe){return Oe[5]?0:1}Z=Ae(q),ne=fe[Z]=De[Z](q);const Me=[create_if_block_18,create_if_block_19,create_if_block_20],Ee=[];function Te(Oe,Pe){return Oe[5]?0:Oe[11]?Oe[14]?2:-1:1}~(oe=Te(q))&&(ue=Ee[oe]=Me[oe](q));const Be=[create_if_block$a,create_if_block_1$6,create_else_block_4],Xe=[];function ze(Oe,Pe){return Pe[0]&128&&(le=null),Oe[4].length===0?0:(le==null&&(le=!!Oe[7].includes("commons")),le?1:2)}return he=ze(q,[-1,-1,-1]),ge=Xe[he]=Be[he](q),{c(){_=element("div"),_e&&_e.c(),M=space(),$=element("div"),j=element("div"),z=element("button"),z.textContent=" server customization",V=space(),X=element("p"),G=element("b"),G.textContent=`current alias:
  `,Q=text(Y),ee=space(),te=element("div"),ne.c(),re=space(),se=element("div"),ie=element("div"),ue&&ue.c(),ce=space(),ae=element("div"),ge.c(),attr(_,"class","w-screen flex flex-row justify-start h-auto"),attr(z,"class","ml-6 mt-4 mb-2 h-auto mr-1 border-black"),attr(X,"class","ml-6 text-2xl text-left"),attr(te,"class","ml-6 mx-1 sm:mt-4 flex flex-row justify-between sm:flex-col p-8 h-auto sm:h-[80vh] z-50 customBorder svelte-jlslkc"),set_style(te,"background-color",q[10]),set_style(te,"transition","background-color 1s ease"),set_style(te,"color","#71302B"),attr(j,"class","sm:w-1/5 flex flex-col side-bar fixed "),attr(ae,"class","flex flex-col w-auto"),attr(ie,"class","my-grid-container-wrapper pl-4 ml-4 svelte-jlslkc"),attr(se,"class","w-full sm:w-[80vw] mt-16 sm:mt-10 sm:ml-[20vw]"),attr($,"class","the-scroll flex flex-row sm:flex-col min-h-screen overflow-y-auto svelte-jlslkc")},m(Oe,Pe){insert(Oe,_,Pe),_e&&_e.m(_,null),insert(Oe,M,Pe),insert(Oe,$,Pe),append($,j),append(j,z),append(j,V),append(j,X),append(X,G),append(X,Q),append(j,ee),append(j,te),fe[Z].m(te,null),append($,re),append($,se),append(se,ie),~oe&&Ee[oe].m(ie,null),append(ie,ce),append(ie,ae),Xe[he].m(ae,null),de=!0,pe||(ye=[listen(_,"click",q[35]),listen(_,"keydown",q[26]),listen(z,"click",q[25])],pe=!0)},p(Oe,Pe){Oe[0]?_e||(_e=create_if_block_24(),_e.c(),_e.m(_,null)):_e&&(_e.d(1),_e=null),(!de||Pe[0]&524288)&&Y!==(Y=Oe[19].address.slice(0,5)+"")&&set_data(Q,Y);let ve=Z;Z=Ae(Oe),Z===ve?fe[Z].p(Oe,Pe):(group_outros(),transition_out(fe[ve],1,1,()=>{fe[ve]=null}),check_outros(),ne=fe[Z],ne?ne.p(Oe,Pe):(ne=fe[Z]=De[Z](Oe),ne.c()),transition_in(ne,1),ne.m(te,null)),(!de||Pe[0]&1024)&&set_style(te,"background-color",Oe[10]);let be=oe;oe=Te(Oe),oe===be?~oe&&Ee[oe].p(Oe,Pe):(ue&&(group_outros(),transition_out(Ee[be],1,1,()=>{Ee[be]=null}),check_outros()),~oe?(ue=Ee[oe],ue?ue.p(Oe,Pe):(ue=Ee[oe]=Me[oe](Oe),ue.c()),transition_in(ue,1),ue.m(ie,ce)):ue=null);let Ce=he;he=ze(Oe,Pe),he===Ce?Xe[he].p(Oe,Pe):(group_outros(),transition_out(Xe[Ce],1,1,()=>{Xe[Ce]=null}),check_outros(),ge=Xe[he],ge?ge.p(Oe,Pe):(ge=Xe[he]=Be[he](Oe),ge.c()),transition_in(ge,1),ge.m(ae,null))},i(Oe){de||(transition_in(ne),transition_in(ue),transition_in(ge),de=!0)},o(Oe){transition_out(ne),transition_out(ue),transition_out(ge),de=!1},d(Oe){Oe&&detach(_),_e&&_e.d(),Oe&&detach(M),Oe&&detach($),fe[Z].d(),~oe&&Ee[oe].d(),Xe[he].d(),pe=!1,run_all(ye)}}}let replies=!1;function instance$c(q,_,M){let $,j,z;component_subscribe(q,cacheDetails,$e=>M(47,$=$e)),component_subscribe(q,time,$e=>M(48,j=$e)),component_subscribe(q,authorKeypair,$e=>M(19,z=$e));const V=createEventDispatcher();let X=get_store_value(shareKeypair).shareAddress;shareKeypair.subscribe($e=>{M(7,X=$e.shareAddress)});function G(){const $e="+commons.b7q4gt64yiefosdafnmhvtxz43akzk6gw54aesdahtf4kdgpbyeia",Je=settings.shareSecrets[$e];shareKeypair.set({shareAddress:$e,secret:Je}),Pe()}let{showDetails:Y=!0}=_,{IDcreated:Q=!1}=_,{attachment:ee=!0}=_,{isReply:te=!1}=_,Z=[6,9],ne=0,re=Array(Z[0]).fill().map(()=>Array(Z[1]).fill(!1)),se=[],ie=j.getTime()*1e3,oe=!1,ue,ce=COLOR_CYCLE[0];function ae(){disconnectObserver(ue);let $e;window.innerWidth<=768?$e=.45:$e=.5,ue=createObserver(ut=>{ut.forEach(qe=>{qe.isIntersecting&&(M(3,ne=parseInt(qe.target.getAttribute("id").replace("section",""))),M(10,ce=COLOR_CYCLE[ne%COLOR_CYCLE.length]))})},$e)}afterUpdate(()=>{X.includes("commons")&&LUNAR_PHASE.forEach(($e,Je)=>{const ut=document.querySelector(`#section${Je}`);observeElement(ue,ut)})}),onDestroy(()=>{disconnectObserver(ue)});let le=!0,he=null,ge,de,pe=!1,ye=null,_e=[0,0],De,fe;cacheDetails.subscribe($e=>{console.log("Cache details changed:",$e)});function Ae($e){M(5,he=$e),console.log("selecteddoc",$e)}const Me=async()=>{M(4,se=$.queryDocs({filter:{pathStartsWith:"/documents"}})),M(4,se=se.filter($e=>$e.path.split("/").length<=6)),console.log("Docs",se),M(8,re=calculateLunarPhase(se)),console.log("gridState",re)};$.onCacheUpdated(()=>{setTimeout(()=>{Me()},500)}),onMount(()=>{Me()});function Ee(){M(11,le=!le),M(5,he=null)}function Te(){V("toggle")}function Be($e){$e.key==="Escape"&&M(5,he=null)}function Xe($e){M(14,pe=!0),M(11,le=!0),M(5,he=null),M(15,ye=$e.detail.type),M(16,_e=$e.detail.location),console.log("filetype",ye),console.log("xy",_e)}function ze(){M(14,pe=!1),M(11,le=!0),M(5,he=null),M(15,ye=null),M(16,_e=[0,0])}function Oe(){M(14,pe=!1),M(11,le=!0),M(5,he=null),M(15,ye=null),M(16,_e=[0,0])}function Pe(){M(4,se=[]),M(7,X=get_store_value(shareKeypair).shareAddress),setTimeout(()=>{Me()},500)}let ve=X.split("+")[1].split(".")[0],be;onMount(()=>{M(6,be=window.innerWidth),window.addEventListener("resize",()=>{M(6,be=window.innerWidth)})});const Ce=($e,Je,ut)=>parseInt(ut.path.split("/")[2])==$e&&parseInt(ut.path.split("/")[3])==Je,Ne=($e,Je,ut)=>parseInt(ut.path.split("/")[2])==$e&&parseInt(ut.path.split("/")[3])==Je,Ie=()=>M(5,he=null),Le=()=>M(5,he=null),je=()=>M(11,le=!le),Ve=()=>M(11,le=!le),ot=$e=>Ae($e.doc),lt=($e,Je,ut)=>parseInt(ut.path.split("/")[2])==$e&&parseInt(ut.path.split("/")[3])==Je,me=$e=>Ae($e),We=$e=>Ae($e),Ye=$e=>Ae($e.doc),Fe=($e,Je,ut)=>parseInt(ut.path.split("/")[2])==$e&&parseInt(ut.path.split("/")[3])==Je,xe=$e=>Ae($e);return q.$$set=$e=>{"showDetails"in $e&&M(32,Y=$e.showDetails),"IDcreated"in $e&&M(0,Q=$e.IDcreated),"attachment"in $e&&M(1,ee=$e.attachment),"isReply"in $e&&M(2,te=$e.isReply)},q.$$.update=()=>{if(q.$$.dirty[0]&32&&he){console.log("if selectedDoc",he);let $e=pathToXY(he.path);console.log("XY",$e),M(12,ge=$e[1]),M(13,de=$e[0])}q.$$.dirty[0]&16&&se.length===0&&setTimeout(()=>{Me()},2e3),q.$$.dirty[0]&8&&console.log(ne),q.$$.dirty[0]&64&&(be<=768?(M(9,oe=!0),M(17,De="repeat(3, minmax(min-content, 1fr))"),M(18,fe="repeat(18, minmax(min-content, 1fr))")):(M(9,oe=!1),M(17,De="repeat("+Z[1]+", minmax(min-content, 1fr))"),M(18,fe="repeat("+Z[0]+", minmax(min-content, 1fr))")),ae())},M(6,be=window.innerWidth),[Q,ee,te,ne,se,he,be,X,re,oe,ce,le,ge,de,pe,ye,_e,De,fe,z,G,Z,ie,Ae,Ee,Te,Be,Xe,ze,Oe,Pe,ve,Y,Ce,Ne,Ie,Le,je,Ve,ot,lt,me,We,Ye,Fe,xe]}class GridView extends SvelteComponent{constructor(_){super(),init(this,_,instance$c,create_fragment$g,safe_not_equal,{showDetails:32,IDcreated:0,attachment:1,isReply:2},null,[-1,-1,-1])}}const StatusPanel_svelte_svelte_type_style_lang="";function get_each_context$4(q,_,M){const $=q.slice();return $[10]=_[M],$}function create_if_block$9(q){let _,M,$,j,z,V=q[1].status+"",X,G,Y,Q,ee,te,Z,ne,re,se,ie,oe,ue,ce,ae,le,he,ge,de,pe,ye,_e,De,fe,Ae,Me,Ee=q[6]&&create_if_block_1$5(q);return{c(){_=element("div"),M=element("div"),$=element("h4"),j=text("Status: "),z=element("strong"),X=text(V),G=space(),Y=element("h4"),Q=text("Share "),ee=element("strong"),te=text(q[7]),Z=space(),ne=element("div"),re=element("h4"),re.textContent="Documents",se=space(),ie=element("p"),oe=element("strong"),ue=text(q[3]),ce=text(" documents sent"),ae=space(),le=element("p"),he=element("strong"),ge=text(q[4]),de=text(" documents received"),pe=space(),ye=element("p"),_e=element("strong"),De=text(q[5]),fe=text(" documents requested"),Ae=space(),Ee&&Ee.c(),Me=empty(),attr(M,"class","flex-col py-4"),attr(ie,"class","svelte-1vxr72o"),attr(le,"class","svelte-1vxr72o"),attr(ye,"class","svelte-1vxr72o"),attr(ne,"class","flex-col items-center py-4"),attr(_,"class","flex flex-col")},m(Te,Be){insert(Te,_,Be),append(_,M),append(M,$),append($,j),append($,z),append(z,X),append(M,G),append(M,Y),append(Y,Q),append(Y,ee),append(ee,te),append(_,Z),append(_,ne),append(ne,re),append(ne,se),append(ne,ie),append(ie,oe),append(oe,ue),append(ie,ce),append(ne,ae),append(ne,le),append(le,he),append(he,ge),append(le,de),append(ne,pe),append(ne,ye),append(ye,_e),append(_e,De),append(ye,fe),insert(Te,Ae,Be),Ee&&Ee.m(Te,Be),insert(Te,Me,Be)},p(Te,Be){Be&2&&V!==(V=Te[1].status+"")&&set_data(X,V),Be&128&&set_data(te,Te[7]),Be&8&&set_data(ue,Te[3]),Be&16&&set_data(ge,Te[4]),Be&32&&set_data(De,Te[5]),Te[6]?Ee?Ee.p(Te,Be):(Ee=create_if_block_1$5(Te),Ee.c(),Ee.m(Me.parentNode,Me)):Ee&&(Ee.d(1),Ee=null)},d(Te){Te&&detach(_),Te&&detach(Ae),Ee&&Ee.d(Te),Te&&detach(Me)}}}function create_if_block_1$5(q){let _,M=q[2].length+"",$,j,z=q[2]>1?"Attachments":"Attachment",V,X,G,Y=[],Q=new Map,ee=q[2];const te=Z=>Z[10].hash;for(let Z=0;Z<ee.length;Z+=1){let ne=get_each_context$4(q,ee,Z),re=te(ne);Q.set(re,Y[Z]=create_each_block$4(re,ne))}return{c(){_=element("h4"),$=text(M),j=space(),V=text(z),X=space(),G=element("div");for(let Z=0;Z<Y.length;Z+=1)Y[Z].c();attr(_,"class","py-4"),attr(G,"class","flex flex-col py-4 h-50vh overflow-y-scroll svelte-1vxr72o")},m(Z,ne){insert(Z,_,ne),append(_,$),append(_,j),append(_,V),insert(Z,X,ne),insert(Z,G,ne);for(let re=0;re<Y.length;re+=1)Y[re].m(G,null)},p(Z,ne){ne&4&&M!==(M=Z[2].length+"")&&set_data($,M),ne&4&&z!==(z=Z[2]>1?"Attachments":"Attachment")&&set_data(V,z),ne&4&&(ee=Z[2],Y=update_keyed_each(Y,ne,te,1,Z,ee,Q,G,destroy_block,create_each_block$4,null,get_each_context$4))},d(Z){Z&&detach(_),Z&&detach(X),Z&&detach(G);for(let ne=0;ne<Y.length;ne+=1)Y[ne].d()}}}function create_each_block$4(q,_){let M,$,j,z=_[10].kind+"",V,X,G,Y=_[10].status+"",Q,ee,te,Z,ne,re=_[10].bytesLoaded+"",se,ie,oe,ue,ce,ae=_[10].totalBytes+"",le,he,ge,de,pe,ye=_[10].author.slice(0,9)+"",_e,De,fe;return{key:q,first:null,c(){M=element("div"),$=element("h5"),j=element("span"),V=text(z),X=space(),G=element("strong"),Q=text(Y),ee=space(),te=element("p"),Z=text("Bytes loaded: "),ne=element("strong"),se=text(re),ie=space(),oe=element("p"),ue=text("Total bytes: "),ce=element("strong"),le=text(ae),he=space(),ge=element("p"),de=text("Author: "),pe=element("strong"),_e=text(ye),De=text("..."),fe=space(),attr(j,"class","kind svelte-1vxr72o"),attr(te,"class","svelte-1vxr72o"),attr(oe,"class","svelte-1vxr72o"),attr(ge,"class","svelte-1vxr72o"),this.first=M},m(Ae,Me){insert(Ae,M,Me),append(M,$),append($,j),append(j,V),append($,X),append($,G),append(G,Q),append(M,ee),append(M,te),append(te,Z),append(te,ne),append(ne,se),append(M,ie),append(M,oe),append(oe,ue),append(oe,ce),append(ce,le),append(M,he),append(M,ge),append(ge,de),append(ge,pe),append(pe,_e),append(pe,De),append(M,fe)},p(Ae,Me){_=Ae,Me&4&&z!==(z=_[10].kind+"")&&set_data(V,z),Me&4&&Y!==(Y=_[10].status+"")&&set_data(Q,Y),Me&4&&re!==(re=_[10].bytesLoaded+"")&&set_data(se,re),Me&4&&ae!==(ae=_[10].totalBytes+"")&&set_data(le,ae),Me&4&&ye!==(ye=_[10].author.slice(0,9)+"")&&set_data(_e,ye)},d(Ae){Ae&&detach(M)}}}function create_fragment$f(q){let _,M,$,j,z,V,X,G=q[8].shareAddress+"",Y,Q,ee,te,Z,ne=q[8].secret+"",re,se,ie,oe,ue,ce,ae=q[0]!==void 0&&create_if_block$9(q);return ue=new DownloadTool({}),{c(){_=element("div"),M=element("div"),$=element("h4"),$.textContent="Status Panel & Current Share Details",j=space(),z=element("p"),V=element("b"),V.textContent="Address:",X=space(),Y=text(G),Q=space(),ee=element("p"),te=element("b"),te.textContent="Secret:",Z=space(),re=text(ne),se=space(),ae&&ae.c(),ie=space(),oe=element("div"),create_component(ue.$$.fragment),attr($,"class","mb-6"),attr(z,"class","svelte-1vxr72o"),attr(ee,"class","svelte-1vxr72o"),attr(M,"class","flex flex-col items-left"),attr(oe,"class","my-4"),attr(_,"class","flex flex-col px-8 p-4 w-full text-left")},m(le,he){insert(le,_,he),append(_,M),append(M,$),append(M,j),append(M,z),append(z,V),append(z,X),append(z,Y),append(M,Q),append(M,ee),append(ee,te),append(ee,Z),append(ee,re),append(_,se),ae&&ae.m(_,null),append(_,ie),append(_,oe),mount_component(ue,oe,null),ce=!0},p(le,[he]){(!ce||he&256)&&G!==(G=le[8].shareAddress+"")&&set_data(Y,G),(!ce||he&256)&&ne!==(ne=le[8].secret+"")&&set_data(re,ne),le[0]!==void 0?ae?ae.p(le,he):(ae=create_if_block$9(le),ae.c(),ae.m(_,ie)):ae&&(ae.d(1),ae=null)},i(le){ce||(transition_in(ue.$$.fragment,le),ce=!0)},o(le){transition_out(ue.$$.fragment,le),ce=!1},d(le){le&&detach(_),ae&&ae.d(),destroy_component(ue)}}}function instance$b(q,_,M){let $;component_subscribe(q,shareKeypair,Z=>M(8,$=Z));let{status:j=void 0}=_,z,V,X,G,Y,Q=!1,ee,te;return shareKeypair.subscribe(Z=>{M(9,te=Z.shareAddress),M(7,ee=te.slice(0,8))}),q.$$set=Z=>{"status"in Z&&M(0,j=Z.status)},q.$$.update=()=>{q.$$.dirty&519&&j&&j[te]&&(M(1,z=j[te].docs),M(2,V=j[te].attachments),M(3,X=z.sentCount),M(4,G=z.receivedCount),M(5,Y=z.requestedCount),M(6,Q=V&&V.length>0))},[j,z,V,X,G,Y,Q,ee,$,te]}class StatusPanel extends SvelteComponent{constructor(_){super(),init(this,_,instance$b,create_fragment$f,safe_not_equal,{status:0})}}function create_if_block$8(q){let _,M,$;return{c(){_=element("p"),M=element("strong"),$=text(q[3])},m(j,z){insert(j,_,z),append(_,M),append(M,$)},p(j,z){z&8&&set_data($,j[3])},d(j){j&&detach(_)}}}function create_fragment$e(q){let _,M,$,j,z,V,X,G,Y,Q,ee,te,Z,ne,re,se,ie,oe,ue,ce,ae=q[2]&&create_if_block$8(q);return{c(){_=element("div"),M=element("h4"),M.textContent="add/remove workspace shares",$=space(),j=element("div"),z=element("h6"),z.textContent="add shares",V=space(),X=element("div"),G=element("label"),Y=text(`Address:
      `),Q=element("input"),ee=space(),te=element("label"),Z=text(`Secret:
    `),ne=element("input"),re=space(),se=element("div"),ie=element("button"),ie.textContent="add a share",oe=space(),ae&&ae.c(),attr(z,"class","text-left py-2"),attr(Q,"id","shareAddress"),attr(Q,"type","text"),attr(Q,"spellcheck","false"),attr(Q,"placeholder","Add a new share address"),attr(ne,"type","text"),attr(ne,"spellcheck","false"),attr(ne,"placeholder","Add the secret for this share"),attr(ie,"class","w-60 phase1 my-4"),attr(te,"for","shareAddress"),set_style(te,"text-align","left"),attr(G,"for","shareAddress"),set_style(G,"text-align","left"),attr(X,"class","flex flex-col lg:flex-row"),attr(j,"class","flex flex-col justify-start py-2")},m(le,he){insert(le,_,he),append(_,M),append(_,$),append(_,j),append(j,z),append(j,V),append(j,X),append(X,G),append(G,Y),append(G,Q),set_input_value(Q,q[0]),append(G,ee),append(G,te),append(te,Z),append(te,ne),set_input_value(ne,q[1]),append(te,re),append(te,se),append(se,ie),append(_,oe),ae&&ae.m(_,null),ue||(ce=[listen(Q,"input",q[5]),listen(ne,"input",q[6]),listen(ie,"click",q[7])],ue=!0)},p(le,[he]){he&1&&Q.value!==le[0]&&set_input_value(Q,le[0]),he&2&&ne.value!==le[1]&&set_input_value(ne,le[1]),le[2]?ae?ae.p(le,he):(ae=create_if_block$8(le),ae.c(),ae.m(_,null)):ae&&(ae.d(1),ae=null)},i:noop,o:noop,d(le){le&&detach(_),ae&&ae.d(),ue=!1,run_all(ce)}}}function instance$a(q,_,M){let $;component_subscribe(q,shareKeypair,Z=>M(9,$=Z));let j,z,V=!1,X;function G(Z){if(isErr(checkShareIsValid(Z))){M(2,V=!0),M(3,X="Not a valid share address");return}else M(2,V=!1),settings.addShare(Z),console.log("You are currently signed in as",settings.author||"no-one!"),console.log("You have",settings.shares.length,"shares"),console.log("Your shares are",settings.shares);Y()}async function Y(){let Z={address:j,secret:z};const ne=await Crypto.checkKeypairIsValid(Z);if(console.log(j,typeof j),console.log(z,typeof z),console.log(ne),isErr(ne)){M(2,V=!0),M(3,X="Not the right secret for this share.");return}else M(2,V=!1),settings.addSecret(j,z),console.log("You are currently signed in as",settings.author||"no-one!"),console.log("You have",settings.shares.length,"shares"),console.log("Your shares are",settings.shares),console.log("You know the secret to these shares:",settings.shareSecrets)}onMount(()=>{$!==void 0&&(settings.addShare($.shareAddress),settings.addSecret($.shareAddress,$.secret))});function Q(){j=this.value,M(0,j)}function ee(){z=this.value,M(1,z)}return[j,z,V,X,G,Q,ee,()=>G(j)]}class AddShare extends SvelteComponent{constructor(_){super(),init(this,_,instance$a,create_fragment$e,safe_not_equal,{})}}const ShareSwitcher_svelte_svelte_type_style_lang="",RemoveShare_svelte_svelte_type_style_lang="";function get_each_context$3(q,_,M){const $=q.slice();return $[11]=_[M],$}function create_each_block$3(q,_){let M,$=_[11]+"",j,z;return{key:q,first:null,c(){M=element("option"),j=text($),M.__value=z=_[11],M.value=M.__value,this.first=M},m(V,X){insert(V,M,X),append(M,j)},p(V,X){_=V,X&16&&$!==($=_[11]+"")&&set_data(j,$),X&16&&z!==(z=_[11])&&(M.__value=z,M.value=M.__value)},d(V){V&&detach(M)}}}function create_if_block$7(q){let _,M,$,j,z,V,X,G,Y,Q,ee,te,Z,ne=settings.shareSecrets[q[0]]+"",re,se,ie,oe,ue,ce,ae,le,he,ge,de=q[0].split(".")[1]+"",pe,ye,_e,De,fe,Ae,Me,Ee;return{c(){_=element("div"),M=element("div"),$=element("div"),j=element("h5"),j.textContent="removing the following share from your workspace:",z=space(),V=element("p"),X=element("b"),X.textContent=`Address:
    `,G=text(q[0]),Y=element("br"),Q=space(),ee=element("p"),te=element("b"),te.textContent="Secret:",Z=space(),re=text(ne),se=element("br"),ie=space(),oe=element("h6"),oe.textContent="type the name of this share to remove it from your browser's memory",ue=space(),ce=element("div"),ae=element("p"),le=text(`+
      `),he=element("input"),ge=text(`
      .`),pe=text(de),ye=space(),_e=element("div"),De=element("button"),De.textContent="remove this share",fe=space(),Ae=element("button"),Ae.textContent="cancel",attr(j,"class","text-left"),attr(V,"class","pt-2 text-left truncate ..."),attr(ee,"class","pb-2 text-left truncate ..."),attr(oe,"class","text-left"),attr(he,"type","text"),attr(he,"placeholder",q[5]),attr(he,"class","svelte-1qgxk0l"),attr(ae,"class","truncate ..."),attr(De,"class","py-2 m-4"),attr(Ae,"class","py-2 m-4"),attr(_e,"class","flex flex-row justify-between"),attr(ce,"class","flex flex-col py-2"),attr($,"class","flex flex-col justify-start"),attr(M,"class","modal-content w-2/3 lg:w-1/6 svelte-1qgxk0l"),attr(_,"class","modal svelte-1qgxk0l")},m(Te,Be){insert(Te,_,Be),append(_,M),append(M,$),append($,j),append($,z),append($,V),append(V,X),append(V,G),append(V,Y),append($,Q),append($,ee),append(ee,te),append(ee,Z),append(ee,re),append(ee,se),append($,ie),append($,oe),append($,ue),append($,ce),append(ce,ae),append(ae,le),append(ae,he),set_input_value(he,q[2]),append(ae,ge),append(ae,pe),append(ce,ye),append(ce,_e),append(_e,De),append(_e,fe),append(_e,Ae),Me||(Ee=[listen(he,"input",q[10]),listen(De,"click",q[7]),listen(Ae,"click",q[8])],Me=!0)},p(Te,Be){Be&1&&set_data(G,Te[0]),Be&1&&ne!==(ne=settings.shareSecrets[Te[0]]+"")&&set_data(re,ne),Be&4&&he.value!==Te[2]&&set_input_value(he,Te[2]),Be&1&&de!==(de=Te[0].split(".")[1]+"")&&set_data(pe,de)},d(Te){Te&&detach(_),Me=!1,run_all(Ee)}}}function create_fragment$d(q){let _,M,$,j,z,V,X,G=[],Y=new Map,Q,ee,te,Z,ne,re,se,ie,oe,ue=q[4];const ce=le=>le[11];for(let le=0;le<ue.length;le+=1){let he=get_each_context$3(q,ue,le),ge=ce(he);Y.set(ge,G[le]=create_each_block$3(ge,he))}let ae=q[3]&&create_if_block$7(q);return{c(){_=element("div"),M=element("h6"),M.textContent="remove shares",$=space(),j=element("label"),j.textContent="this action is irreversible",z=space(),V=element("div"),X=element("select");for(let le=0;le<G.length;le+=1)G[le].c();Q=space(),ee=element("button"),ee.textContent="remove share",te=space(),Z=element("p"),ne=text(q[1]),re=space(),ae&&ae.c(),se=empty(),attr(M,"class","text-left"),attr(j,"class","text-left"),attr(j,"for","share-switcher"),attr(X,"id","share-selecter"),attr(X,"class","form-control my-2 w-3/5"),q[0]===void 0&&add_render_callback(()=>q[9].call(X)),attr(ee,"class","phase1 w-2/5 m-2"),attr(V,"class","flex flex-col 2xl:flex-row"),attr(_,"class","flex flex-col justify-start py-6")},m(le,he){insert(le,_,he),append(_,M),append(_,$),append(_,j),append(_,z),append(_,V),append(V,X);for(let ge=0;ge<G.length;ge+=1)G[ge].m(X,null);select_option(X,q[0]),append(V,Q),append(V,ee),append(_,te),append(_,Z),append(Z,ne),insert(le,re,he),ae&&ae.m(le,he),insert(le,se,he),ie||(oe=[listen(X,"change",q[9]),listen(ee,"click",q[6])],ie=!0)},p(le,[he]){he&16&&(ue=le[4],G=update_keyed_each(G,he,ce,1,le,ue,Y,X,destroy_block,create_each_block$3,null,get_each_context$3)),he&17&&select_option(X,le[0]),he&2&&set_data(ne,le[1]),le[3]?ae?ae.p(le,he):(ae=create_if_block$7(le),ae.c(),ae.m(se.parentNode,se)):ae&&(ae.d(1),ae=null)},i:noop,o:noop,d(le){le&&detach(_);for(let he=0;he<G.length;he+=1)G[he].d();le&&detach(re),ae&&ae.d(le),le&&detach(se),ie=!1,run_all(oe)}}}function instance$9(q,_,M){let $;component_subscribe(q,shares,ne=>M(4,$=ne));let j=get_store_value(shareKeypair).shareAddress,z="",V="",X=!1,G=j.split("+")[1].split(".")[0];shareKeypair.subscribe(ne=>{M(0,j=ne.shareAddress)});function Y(){M(3,X=!0)}function Q(){V===G&&(removeShare(j),M(1,z=`Share ${j} has been removed.`),get_store_value(shareKeypair).shareAddress===j&&shareKeypair.set({shareAddress:null,secret:null})),M(2,V=""),M(3,X=!1)}function ee(){M(2,V=""),M(3,X=!1)}function te(){j=select_value(this),M(0,j)}function Z(){V=this.value,M(2,V)}return[j,z,V,X,$,G,Y,Q,ee,te,Z]}class RemoveShare extends SvelteComponent{constructor(_){super(),init(this,_,instance$9,create_fragment$d,safe_not_equal,{})}}const GenerateShare_svelte_svelte_type_style_lang="",ShareSettings_svelte_svelte_type_style_lang="";function create_if_block_2$4(q){let _;return{c(){_=element("p"),_.innerHTML="<strong>Server was added successfully!</strong>"},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_1$4(q){let _;return{c(){_=element("p"),_.innerHTML="<strong>Sync is complete!</strong>"},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block$6(q){let _,M,$;return{c(){_=element("p"),M=element("strong"),$=text(q[2])},m(j,z){insert(j,_,z),append(_,M),append(M,$)},p(j,z){z&4&&set_data($,j[2])},d(j){j&&detach(_)}}}function create_fragment$c(q){let _,M,$,j,z,V,X,G,Y,Q=q[3]&&create_if_block_2$4(),ee=q[4]&&create_if_block_1$4(),te=q[1]&&create_if_block$6(q);return{c(){_=element("div"),M=element("input"),$=space(),j=element("button"),j.textContent="Add server",z=space(),Q&&Q.c(),V=space(),ee&&ee.c(),X=space(),te&&te.c(),attr(M,"type","text"),attr(M,"spellcheck","false"),attr(M,"placeholder","Add a new server URL"),attr(j,"class","mx-4 phase1"),attr(_,"class","w-full flex flex-col lg:flex-row my-2")},m(Z,ne){insert(Z,_,ne),append(_,M),set_input_value(M,q[0]),append(_,$),append(_,j),append(_,z),Q&&Q.m(_,null),append(_,V),ee&&ee.m(_,null),append(_,X),te&&te.m(_,null),G||(Y=[listen(M,"input",q[6]),listen(j,"click",q[7])],G=!0)},p(Z,[ne]){ne&1&&M.value!==Z[0]&&set_input_value(M,Z[0]),Z[3]?Q||(Q=create_if_block_2$4(),Q.c(),Q.m(_,V)):Q&&(Q.d(1),Q=null),Z[4]?ee||(ee=create_if_block_1$4(),ee.c(),ee.m(_,X)):ee&&(ee.d(1),ee=null),Z[1]?te?te.p(Z,ne):(te=create_if_block$6(Z),te.c(),te.m(_,null)):te&&(te.d(1),te=null)},i:noop,o:noop,d(Z){Z&&detach(_),Q&&Q.d(),ee&&ee.d(),te&&te.d(),G=!1,run_all(Y)}}}function instance$8(q,_,M){let $,j=!1,z,V=!1,X=!1,G;replicaDetails.subscribe(te=>{G=te.replica});async function Y(te){let Z=settings.addServer(te);if(isErr(Z)){M(1,j=!0),M(2,z="Not a valid server URL");return}else{M(1,j=!1),M(3,V=!0),console.log("You have",settings.servers.length,"servers"),console.log("Your servers are",settings.servers);const ne=new Peer;ne.addReplica(G),await ne.sync(te).isDone(),M(4,X=!0),console.log("Sync is done")}}function Q(){$=this.value,M(0,$)}return[$,j,z,V,X,Y,Q,()=>Y($)]}class AddServer extends SvelteComponent{constructor(_){super(),init(this,_,instance$8,create_fragment$c,safe_not_equal,{})}}function get_each_context$2(q,_,M){const $=q.slice();return $[7]=_[M],$}function create_each_block$2(q,_){let M,$=_[7]+"",j;return{key:q,first:null,c(){M=element("option"),j=text($),M.__value=_[7],M.value=M.__value,this.first=M},m(z,V){insert(z,M,V),append(M,j)},p(z,V){_=z},d(z){z&&detach(M)}}}function create_if_block$5(q){let _;return{c(){_=element("p"),_.innerHTML="<strong>Server was removed successfully!</strong>"},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_fragment$b(q){let _,M,$,j=[],z=new Map,V,X,G,Y,Q,ee=settings.servers;const te=ne=>ne[7];for(let ne=0;ne<ee.length;ne+=1){let re=get_each_context$2(q,ee,ne),se=te(re);z.set(se,j[ne]=create_each_block$2(se,re))}let Z=q[1]&&create_if_block$5();return{c(){_=element("div"),M=element("select"),$=element("option"),$.textContent="Select a server to remove";for(let ne=0;ne<j.length;ne+=1)j[ne].c();V=space(),X=element("button"),X.textContent="Remove server",G=space(),Z&&Z.c(),$.__value="",$.value=$.__value,q[0]===void 0&&add_render_callback(()=>q[3].call(M)),attr(X,"class","mx-4 phase1"),attr(_,"class","flex flex-col lg:flex-row my-2")},m(ne,re){insert(ne,_,re),append(_,M),append(M,$);for(let se=0;se<j.length;se+=1)j[se].m(M,null);select_option(M,q[0]),append(_,V),append(_,X),append(_,G),Z&&Z.m(_,null),Y||(Q=[listen(M,"change",q[3]),listen(X,"click",q[2])],Y=!0)},p(ne,[re]){re&0&&(ee=settings.servers,j=update_keyed_each(j,re,te,1,ne,ee,z,M,destroy_block,create_each_block$2,null,get_each_context$2)),re&1&&select_option(M,ne[0]),ne[1]?Z||(Z=create_if_block$5(),Z.c(),Z.m(_,null)):Z&&(Z.d(1),Z=null)},i:noop,o:noop,d(ne){ne&&detach(_);for(let re=0;re<j.length;re+=1)j[re].d();Z&&Z.d(),Y=!1,run_all(Q)}}}function instance$7(q,_,M){let $,j=!1;function z(){let X=settings.removeServer($);isErr(X)||(M(1,j=!0),console.log("You have",settings.servers.length,"servers"),console.log("Your servers are",settings.servers))}function V(){$=select_value(this),M(0,$)}return[$,j,z,V]}class RemoveServer extends SvelteComponent{constructor(_){super(),init(this,_,instance$7,create_fragment$b,safe_not_equal,{})}}function create_fragment$a(q){let _,M,$,j,z,V,X,G,Y,Q,ee,te;return X=new ServerList({}),Y=new AddServer({}),ee=new RemoveServer({}),{c(){_=element("div"),M=element("h3"),M.textContent="Server settings",$=space(),j=element("h4"),j.textContent=`Currrent ${settings.servers.length===1?"Server:":`${settings.servers.length} Servers:`}`,z=space(),V=element("div"),create_component(X.$$.fragment),G=space(),create_component(Y.$$.fragment),Q=space(),create_component(ee.$$.fragment),attr(V,"class","my-4"),attr(_,"class","flex flex-col items-start pb-24")},m(Z,ne){insert(Z,_,ne),append(_,M),append(_,$),append(_,j),append(_,z),append(_,V),mount_component(X,V,null),append(_,G),mount_component(Y,_,null),append(_,Q),mount_component(ee,_,null),te=!0},p:noop,i(Z){te||(transition_in(X.$$.fragment,Z),transition_in(Y.$$.fragment,Z),transition_in(ee.$$.fragment,Z),te=!0)},o(Z){transition_out(X.$$.fragment,Z),transition_out(Y.$$.fragment,Z),transition_out(ee.$$.fragment,Z),te=!1},d(Z){Z&&detach(_),destroy_component(X),destroy_component(Y),destroy_component(ee)}}}class Server extends SvelteComponent{constructor(_){super(),init(this,_,null,create_fragment$a,safe_not_equal,{})}}function create_if_block_2$3(q){let _,M,$,j=JSON.stringify(q[1],null,2)+"",z;return{c(){_=element("p"),_.textContent="Parsed Invitation:",M=space(),$=element("pre"),z=text(j)},m(V,X){insert(V,_,X),insert(V,M,X),insert(V,$,X),append($,z)},p(V,X){X&2&&j!==(j=JSON.stringify(V[1],null,2)+"")&&set_data(z,j)},d(V){V&&detach(_),V&&detach(M),V&&detach($)}}}function create_if_block_1$3(q){let _;return{c(){_=element("p"),_.textContent="Successfully redeemed invitation!"},m(M,$){insert(M,_,$)},p:noop,d(M){M&&detach(_)}}}function create_if_block$4(q){let _,M,$=q[2].message+"",j;return{c(){_=element("p"),M=text("Error: "),j=text($)},m(z,V){insert(z,_,V),append(_,M),append(_,j)},p(z,V){V&4&&$!==($=z[2].message+"")&&set_data(j,$)},d(z){z&&detach(_)}}}function create_fragment$9(q){let _,M,$,j,z,V,X,G;function Y(te,Z){if(te[2])return create_if_block$4;if(te[3])return create_if_block_1$3;if(te[1])return create_if_block_2$3}let Q=Y(q),ee=Q&&Q(q);return{c(){_=element("div"),M=element("input"),$=space(),j=element("div"),z=element("button"),z.textContent="Redeem Invitation URL",V=space(),ee&&ee.c(),attr(M,"class","mr-2"),attr(M,"type","text"),attr(M,"placeholder","Enter invitation URL"),attr(z,"class","phase1"),attr(j,"class","mx-2"),attr(_,"class","flex flex-col md:flex-row items-cente space-between")},m(te,Z){insert(te,_,Z),append(_,M),set_input_value(M,q[0]),append(_,$),append(_,j),append(j,z),append(_,V),ee&&ee.m(_,null),X||(G=[listen(M,"input",q[5]),listen(z,"click",q[4])],X=!0)},p(te,[Z]){Z&1&&M.value!==te[0]&&set_input_value(M,te[0]),Q===(Q=Y(te))&&ee?ee.p(te,Z):(ee&&ee.d(1),ee=Q&&Q(te),ee&&(ee.c(),ee.m(_,null)))},i:noop,o:noop,d(te){te&&detach(_),ee&&ee.d(),X=!1,run_all(G)}}}function instance$6(q,_,M){let $="",j,z,V=!1;const X=async()=>{try{const Q=await settings.redeemInvitationURL($);Q===!0?(M(3,V=!0),M(2,z=null)):(M(2,z=Q),M(3,V=!1))}catch(Q){M(2,z=Q),M(3,V=!1)}},G=async()=>{await X()};function Y(){$=this.value,M(0,$)}return[$,j,z,V,G,Y]}class RedeemInvitation extends SvelteComponent{constructor(_){super(),init(this,_,instance$6,create_fragment$9,safe_not_equal,{})}}var browser={},canPromise$1=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},qrcode={},utils$1={};let toSJISFunction;const CODEWORDS_COUNT=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];utils$1.getSymbolSize=function q(_){if(!_)throw new Error('"version" cannot be null or undefined');if(_<1||_>40)throw new Error('"version" should be in range from 1 to 40');return _*4+17};utils$1.getSymbolTotalCodewords=function q(_){return CODEWORDS_COUNT[_]};utils$1.getBCHDigit=function(q){let _=0;for(;q!==0;)_++,q>>>=1;return _};utils$1.setToSJISFunction=function q(_){if(typeof _!="function")throw new Error('"toSJISFunc" is not a valid function.');toSJISFunction=_};utils$1.isKanjiModeEnabled=function(){return typeof toSJISFunction<"u"};utils$1.toSJIS=function q(_){return toSJISFunction(_)};var errorCorrectionLevel={};(function(q){q.L={bit:1},q.M={bit:0},q.Q={bit:3},q.H={bit:2};function _(M){if(typeof M!="string")throw new Error("Param is not a string");switch(M.toLowerCase()){case"l":case"low":return q.L;case"m":case"medium":return q.M;case"q":case"quartile":return q.Q;case"h":case"high":return q.H;default:throw new Error("Unknown EC Level: "+M)}}q.isValid=function($){return $&&typeof $.bit<"u"&&$.bit>=0&&$.bit<4},q.from=function($,j){if(q.isValid($))return $;try{return _($)}catch{return j}}})(errorCorrectionLevel);function BitBuffer$1(){this.buffer=[],this.length=0}BitBuffer$1.prototype={get:function(q){const _=Math.floor(q/8);return(this.buffer[_]>>>7-q%8&1)===1},put:function(q,_){for(let M=0;M<_;M++)this.putBit((q>>>_-M-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(q){const _=Math.floor(this.length/8);this.buffer.length<=_&&this.buffer.push(0),q&&(this.buffer[_]|=128>>>this.length%8),this.length++}};var bitBuffer=BitBuffer$1;function BitMatrix$1(q){if(!q||q<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=q,this.data=new Uint8Array(q*q),this.reservedBit=new Uint8Array(q*q)}BitMatrix$1.prototype.set=function(q,_,M,$){const j=q*this.size+_;this.data[j]=M,$&&(this.reservedBit[j]=!0)};BitMatrix$1.prototype.get=function(q,_){return this.data[q*this.size+_]};BitMatrix$1.prototype.xor=function(q,_,M){this.data[q*this.size+_]^=M};BitMatrix$1.prototype.isReserved=function(q,_){return this.reservedBit[q*this.size+_]};var bitMatrix=BitMatrix$1,alignmentPattern={};(function(q){const _=utils$1.getSymbolSize;q.getRowColCoords=function($){if($===1)return[];const j=Math.floor($/7)+2,z=_($),V=z===145?26:Math.ceil((z-13)/(2*j-2))*2,X=[z-7];for(let G=1;G<j-1;G++)X[G]=X[G-1]-V;return X.push(6),X.reverse()},q.getPositions=function($){const j=[],z=q.getRowColCoords($),V=z.length;for(let X=0;X<V;X++)for(let G=0;G<V;G++)X===0&&G===0||X===0&&G===V-1||X===V-1&&G===0||j.push([z[X],z[G]]);return j}})(alignmentPattern);var finderPattern={};const getSymbolSize=utils$1.getSymbolSize,FINDER_PATTERN_SIZE=7;finderPattern.getPositions=function q(_){const M=getSymbolSize(_);return[[0,0],[M-FINDER_PATTERN_SIZE,0],[0,M-FINDER_PATTERN_SIZE]]};var maskPattern={};(function(q){q.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const _={N1:3,N2:3,N3:40,N4:10};q.isValid=function(j){return j!=null&&j!==""&&!isNaN(j)&&j>=0&&j<=7},q.from=function(j){return q.isValid(j)?parseInt(j,10):void 0},q.getPenaltyN1=function(j){const z=j.size;let V=0,X=0,G=0,Y=null,Q=null;for(let ee=0;ee<z;ee++){X=G=0,Y=Q=null;for(let te=0;te<z;te++){let Z=j.get(ee,te);Z===Y?X++:(X>=5&&(V+=_.N1+(X-5)),Y=Z,X=1),Z=j.get(te,ee),Z===Q?G++:(G>=5&&(V+=_.N1+(G-5)),Q=Z,G=1)}X>=5&&(V+=_.N1+(X-5)),G>=5&&(V+=_.N1+(G-5))}return V},q.getPenaltyN2=function(j){const z=j.size;let V=0;for(let X=0;X<z-1;X++)for(let G=0;G<z-1;G++){const Y=j.get(X,G)+j.get(X,G+1)+j.get(X+1,G)+j.get(X+1,G+1);(Y===4||Y===0)&&V++}return V*_.N2},q.getPenaltyN3=function(j){const z=j.size;let V=0,X=0,G=0;for(let Y=0;Y<z;Y++){X=G=0;for(let Q=0;Q<z;Q++)X=X<<1&2047|j.get(Y,Q),Q>=10&&(X===1488||X===93)&&V++,G=G<<1&2047|j.get(Q,Y),Q>=10&&(G===1488||G===93)&&V++}return V*_.N3},q.getPenaltyN4=function(j){let z=0;const V=j.data.length;for(let G=0;G<V;G++)z+=j.data[G];return Math.abs(Math.ceil(z*100/V/5)-10)*_.N4};function M($,j,z){switch($){case q.Patterns.PATTERN000:return(j+z)%2===0;case q.Patterns.PATTERN001:return j%2===0;case q.Patterns.PATTERN010:return z%3===0;case q.Patterns.PATTERN011:return(j+z)%3===0;case q.Patterns.PATTERN100:return(Math.floor(j/2)+Math.floor(z/3))%2===0;case q.Patterns.PATTERN101:return j*z%2+j*z%3===0;case q.Patterns.PATTERN110:return(j*z%2+j*z%3)%2===0;case q.Patterns.PATTERN111:return(j*z%3+(j+z)%2)%2===0;default:throw new Error("bad maskPattern:"+$)}}q.applyMask=function(j,z){const V=z.size;for(let X=0;X<V;X++)for(let G=0;G<V;G++)z.isReserved(G,X)||z.xor(G,X,M(j,G,X))},q.getBestMask=function(j,z){const V=Object.keys(q.Patterns).length;let X=0,G=1/0;for(let Y=0;Y<V;Y++){z(Y),q.applyMask(Y,j);const Q=q.getPenaltyN1(j)+q.getPenaltyN2(j)+q.getPenaltyN3(j)+q.getPenaltyN4(j);q.applyMask(Y,j),Q<G&&(G=Q,X=Y)}return X}})(maskPattern);var errorCorrectionCode={};const ECLevel$1=errorCorrectionLevel,EC_BLOCKS_TABLE=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],EC_CODEWORDS_TABLE=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];errorCorrectionCode.getBlocksCount=function q(_,M){switch(M){case ECLevel$1.L:return EC_BLOCKS_TABLE[(_-1)*4+0];case ECLevel$1.M:return EC_BLOCKS_TABLE[(_-1)*4+1];case ECLevel$1.Q:return EC_BLOCKS_TABLE[(_-1)*4+2];case ECLevel$1.H:return EC_BLOCKS_TABLE[(_-1)*4+3];default:return}};errorCorrectionCode.getTotalCodewordsCount=function q(_,M){switch(M){case ECLevel$1.L:return EC_CODEWORDS_TABLE[(_-1)*4+0];case ECLevel$1.M:return EC_CODEWORDS_TABLE[(_-1)*4+1];case ECLevel$1.Q:return EC_CODEWORDS_TABLE[(_-1)*4+2];case ECLevel$1.H:return EC_CODEWORDS_TABLE[(_-1)*4+3];default:return}};var polynomial={},galoisField={};const EXP_TABLE=new Uint8Array(512),LOG_TABLE=new Uint8Array(256);(function q(){let _=1;for(let M=0;M<255;M++)EXP_TABLE[M]=_,LOG_TABLE[_]=M,_<<=1,_&256&&(_^=285);for(let M=255;M<512;M++)EXP_TABLE[M]=EXP_TABLE[M-255]})();galoisField.log=function q(_){if(_<1)throw new Error("log("+_+")");return LOG_TABLE[_]};galoisField.exp=function q(_){return EXP_TABLE[_]};galoisField.mul=function q(_,M){return _===0||M===0?0:EXP_TABLE[LOG_TABLE[_]+LOG_TABLE[M]]};(function(q){const _=galoisField;q.mul=function($,j){const z=new Uint8Array($.length+j.length-1);for(let V=0;V<$.length;V++)for(let X=0;X<j.length;X++)z[V+X]^=_.mul($[V],j[X]);return z},q.mod=function($,j){let z=new Uint8Array($);for(;z.length-j.length>=0;){const V=z[0];for(let G=0;G<j.length;G++)z[G]^=_.mul(j[G],V);let X=0;for(;X<z.length&&z[X]===0;)X++;z=z.slice(X)}return z},q.generateECPolynomial=function($){let j=new Uint8Array([1]);for(let z=0;z<$;z++)j=q.mul(j,new Uint8Array([1,_.exp(z)]));return j}})(polynomial);const Polynomial=polynomial;function ReedSolomonEncoder$1(q){this.genPoly=void 0,this.degree=q,this.degree&&this.initialize(this.degree)}ReedSolomonEncoder$1.prototype.initialize=function q(_){this.degree=_,this.genPoly=Polynomial.generateECPolynomial(this.degree)};ReedSolomonEncoder$1.prototype.encode=function q(_){if(!this.genPoly)throw new Error("Encoder not initialized");const M=new Uint8Array(_.length+this.degree);M.set(_);const $=Polynomial.mod(M,this.genPoly),j=this.degree-$.length;if(j>0){const z=new Uint8Array(this.degree);return z.set($,j),z}return $};var reedSolomonEncoder=ReedSolomonEncoder$1,version={},mode={},versionCheck={};versionCheck.isValid=function q(_){return!isNaN(_)&&_>=1&&_<=40};var regex={};const numeric="[0-9]+",alphanumeric="[A-Z $%*+\\-./:]+";let kanji="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";kanji=kanji.replace(/u/g,"\\u");const byte="(?:(?![A-Z0-9 $%*+\\-./:]|"+kanji+`)(?:.|[\r
]))+`;regex.KANJI=new RegExp(kanji,"g");regex.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");regex.BYTE=new RegExp(byte,"g");regex.NUMERIC=new RegExp(numeric,"g");regex.ALPHANUMERIC=new RegExp(alphanumeric,"g");const TEST_KANJI=new RegExp("^"+kanji+"$"),TEST_NUMERIC=new RegExp("^"+numeric+"$"),TEST_ALPHANUMERIC=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");regex.testKanji=function q(_){return TEST_KANJI.test(_)};regex.testNumeric=function q(_){return TEST_NUMERIC.test(_)};regex.testAlphanumeric=function q(_){return TEST_ALPHANUMERIC.test(_)};(function(q){const _=versionCheck,M=regex;q.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},q.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},q.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},q.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},q.MIXED={bit:-1},q.getCharCountIndicator=function(z,V){if(!z.ccBits)throw new Error("Invalid mode: "+z);if(!_.isValid(V))throw new Error("Invalid version: "+V);return V>=1&&V<10?z.ccBits[0]:V<27?z.ccBits[1]:z.ccBits[2]},q.getBestModeForData=function(z){return M.testNumeric(z)?q.NUMERIC:M.testAlphanumeric(z)?q.ALPHANUMERIC:M.testKanji(z)?q.KANJI:q.BYTE},q.toString=function(z){if(z&&z.id)return z.id;throw new Error("Invalid mode")},q.isValid=function(z){return z&&z.bit&&z.ccBits};function $(j){if(typeof j!="string")throw new Error("Param is not a string");switch(j.toLowerCase()){case"numeric":return q.NUMERIC;case"alphanumeric":return q.ALPHANUMERIC;case"kanji":return q.KANJI;case"byte":return q.BYTE;default:throw new Error("Unknown mode: "+j)}}q.from=function(z,V){if(q.isValid(z))return z;try{return $(z)}catch{return V}}})(mode);(function(q){const _=utils$1,M=errorCorrectionCode,$=errorCorrectionLevel,j=mode,z=versionCheck,V=7973,X=_.getBCHDigit(V);function G(te,Z,ne){for(let re=1;re<=40;re++)if(Z<=q.getCapacity(re,ne,te))return re}function Y(te,Z){return j.getCharCountIndicator(te,Z)+4}function Q(te,Z){let ne=0;return te.forEach(function(re){const se=Y(re.mode,Z);ne+=se+re.getBitsLength()}),ne}function ee(te,Z){for(let ne=1;ne<=40;ne++)if(Q(te,ne)<=q.getCapacity(ne,Z,j.MIXED))return ne}q.from=function(Z,ne){return z.isValid(Z)?parseInt(Z,10):ne},q.getCapacity=function(Z,ne,re){if(!z.isValid(Z))throw new Error("Invalid QR Code version");typeof re>"u"&&(re=j.BYTE);const se=_.getSymbolTotalCodewords(Z),ie=M.getTotalCodewordsCount(Z,ne),oe=(se-ie)*8;if(re===j.MIXED)return oe;const ue=oe-Y(re,Z);switch(re){case j.NUMERIC:return Math.floor(ue/10*3);case j.ALPHANUMERIC:return Math.floor(ue/11*2);case j.KANJI:return Math.floor(ue/13);case j.BYTE:default:return Math.floor(ue/8)}},q.getBestVersionForData=function(Z,ne){let re;const se=$.from(ne,$.M);if(Array.isArray(Z)){if(Z.length>1)return ee(Z,se);if(Z.length===0)return 1;re=Z[0]}else re=Z;return G(re.mode,re.getLength(),se)},q.getEncodedBits=function(Z){if(!z.isValid(Z)||Z<7)throw new Error("Invalid QR Code version");let ne=Z<<12;for(;_.getBCHDigit(ne)-X>=0;)ne^=V<<_.getBCHDigit(ne)-X;return Z<<12|ne}})(version);var formatInfo={};const Utils$3=utils$1,G15=1335,G15_MASK=21522,G15_BCH=Utils$3.getBCHDigit(G15);formatInfo.getEncodedBits=function q(_,M){const $=_.bit<<3|M;let j=$<<10;for(;Utils$3.getBCHDigit(j)-G15_BCH>=0;)j^=G15<<Utils$3.getBCHDigit(j)-G15_BCH;return($<<10|j)^G15_MASK};var segments={};const Mode$4=mode;function NumericData(q){this.mode=Mode$4.NUMERIC,this.data=q.toString()}NumericData.getBitsLength=function q(_){return 10*Math.floor(_/3)+(_%3?_%3*3+1:0)};NumericData.prototype.getLength=function q(){return this.data.length};NumericData.prototype.getBitsLength=function q(){return NumericData.getBitsLength(this.data.length)};NumericData.prototype.write=function q(_){let M,$,j;for(M=0;M+3<=this.data.length;M+=3)$=this.data.substr(M,3),j=parseInt($,10),_.put(j,10);const z=this.data.length-M;z>0&&($=this.data.substr(M),j=parseInt($,10),_.put(j,z*3+1))};var numericData=NumericData;const Mode$3=mode,ALPHA_NUM_CHARS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function AlphanumericData(q){this.mode=Mode$3.ALPHANUMERIC,this.data=q}AlphanumericData.getBitsLength=function q(_){return 11*Math.floor(_/2)+6*(_%2)};AlphanumericData.prototype.getLength=function q(){return this.data.length};AlphanumericData.prototype.getBitsLength=function q(){return AlphanumericData.getBitsLength(this.data.length)};AlphanumericData.prototype.write=function q(_){let M;for(M=0;M+2<=this.data.length;M+=2){let $=ALPHA_NUM_CHARS.indexOf(this.data[M])*45;$+=ALPHA_NUM_CHARS.indexOf(this.data[M+1]),_.put($,11)}this.data.length%2&&_.put(ALPHA_NUM_CHARS.indexOf(this.data[M]),6)};var alphanumericData=AlphanumericData,encodeUtf8$1=function q(_){for(var M=[],$=_.length,j=0;j<$;j++){var z=_.charCodeAt(j);if(z>=55296&&z<=56319&&$>j+1){var V=_.charCodeAt(j+1);V>=56320&&V<=57343&&(z=(z-55296)*1024+V-56320+65536,j+=1)}if(z<128){M.push(z);continue}if(z<2048){M.push(z>>6|192),M.push(z&63|128);continue}if(z<55296||z>=57344&&z<65536){M.push(z>>12|224),M.push(z>>6&63|128),M.push(z&63|128);continue}if(z>=65536&&z<=1114111){M.push(z>>18|240),M.push(z>>12&63|128),M.push(z>>6&63|128),M.push(z&63|128);continue}M.push(239,191,189)}return new Uint8Array(M).buffer};const encodeUtf8=encodeUtf8$1,Mode$2=mode;function ByteData(q){this.mode=Mode$2.BYTE,typeof q=="string"&&(q=encodeUtf8(q)),this.data=new Uint8Array(q)}ByteData.getBitsLength=function q(_){return _*8};ByteData.prototype.getLength=function q(){return this.data.length};ByteData.prototype.getBitsLength=function q(){return ByteData.getBitsLength(this.data.length)};ByteData.prototype.write=function(q){for(let _=0,M=this.data.length;_<M;_++)q.put(this.data[_],8)};var byteData=ByteData;const Mode$1=mode,Utils$2=utils$1;function KanjiData(q){this.mode=Mode$1.KANJI,this.data=q}KanjiData.getBitsLength=function q(_){return _*13};KanjiData.prototype.getLength=function q(){return this.data.length};KanjiData.prototype.getBitsLength=function q(){return KanjiData.getBitsLength(this.data.length)};KanjiData.prototype.write=function(q){let _;for(_=0;_<this.data.length;_++){let M=Utils$2.toSJIS(this.data[_]);if(M>=33088&&M<=40956)M-=33088;else if(M>=57408&&M<=60351)M-=49472;else throw new Error("Invalid SJIS character: "+this.data[_]+`
Make sure your charset is UTF-8`);M=(M>>>8&255)*192+(M&255),q.put(M,13)}};var kanjiData=KanjiData,dijkstra={exports:{}};(function(q){var _={single_source_shortest_paths:function(M,$,j){var z={},V={};V[$]=0;var X=_.PriorityQueue.make();X.push($,0);for(var G,Y,Q,ee,te,Z,ne,re,se;!X.empty();){G=X.pop(),Y=G.value,ee=G.cost,te=M[Y]||{};for(Q in te)te.hasOwnProperty(Q)&&(Z=te[Q],ne=ee+Z,re=V[Q],se=typeof V[Q]>"u",(se||re>ne)&&(V[Q]=ne,X.push(Q,ne),z[Q]=Y))}if(typeof j<"u"&&typeof V[j]>"u"){var ie=["Could not find a path from ",$," to ",j,"."].join("");throw new Error(ie)}return z},extract_shortest_path_from_predecessor_list:function(M,$){for(var j=[],z=$;z;)j.push(z),M[z],z=M[z];return j.reverse(),j},find_path:function(M,$,j){var z=_.single_source_shortest_paths(M,$,j);return _.extract_shortest_path_from_predecessor_list(z,j)},PriorityQueue:{make:function(M){var $=_.PriorityQueue,j={},z;M=M||{};for(z in $)$.hasOwnProperty(z)&&(j[z]=$[z]);return j.queue=[],j.sorter=M.sorter||$.default_sorter,j},default_sorter:function(M,$){return M.cost-$.cost},push:function(M,$){var j={value:M,cost:$};this.queue.push(j),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};q.exports=_})(dijkstra);var dijkstraExports=dijkstra.exports;(function(q){const _=mode,M=numericData,$=alphanumericData,j=byteData,z=kanjiData,V=regex,X=utils$1,G=dijkstraExports;function Y(ie){return unescape(encodeURIComponent(ie)).length}function Q(ie,oe,ue){const ce=[];let ae;for(;(ae=ie.exec(ue))!==null;)ce.push({data:ae[0],index:ae.index,mode:oe,length:ae[0].length});return ce}function ee(ie){const oe=Q(V.NUMERIC,_.NUMERIC,ie),ue=Q(V.ALPHANUMERIC,_.ALPHANUMERIC,ie);let ce,ae;return X.isKanjiModeEnabled()?(ce=Q(V.BYTE,_.BYTE,ie),ae=Q(V.KANJI,_.KANJI,ie)):(ce=Q(V.BYTE_KANJI,_.BYTE,ie),ae=[]),oe.concat(ue,ce,ae).sort(function(he,ge){return he.index-ge.index}).map(function(he){return{data:he.data,mode:he.mode,length:he.length}})}function te(ie,oe){switch(oe){case _.NUMERIC:return M.getBitsLength(ie);case _.ALPHANUMERIC:return $.getBitsLength(ie);case _.KANJI:return z.getBitsLength(ie);case _.BYTE:return j.getBitsLength(ie)}}function Z(ie){return ie.reduce(function(oe,ue){const ce=oe.length-1>=0?oe[oe.length-1]:null;return ce&&ce.mode===ue.mode?(oe[oe.length-1].data+=ue.data,oe):(oe.push(ue),oe)},[])}function ne(ie){const oe=[];for(let ue=0;ue<ie.length;ue++){const ce=ie[ue];switch(ce.mode){case _.NUMERIC:oe.push([ce,{data:ce.data,mode:_.ALPHANUMERIC,length:ce.length},{data:ce.data,mode:_.BYTE,length:ce.length}]);break;case _.ALPHANUMERIC:oe.push([ce,{data:ce.data,mode:_.BYTE,length:ce.length}]);break;case _.KANJI:oe.push([ce,{data:ce.data,mode:_.BYTE,length:Y(ce.data)}]);break;case _.BYTE:oe.push([{data:ce.data,mode:_.BYTE,length:Y(ce.data)}])}}return oe}function re(ie,oe){const ue={},ce={start:{}};let ae=["start"];for(let le=0;le<ie.length;le++){const he=ie[le],ge=[];for(let de=0;de<he.length;de++){const pe=he[de],ye=""+le+de;ge.push(ye),ue[ye]={node:pe,lastCount:0},ce[ye]={};for(let _e=0;_e<ae.length;_e++){const De=ae[_e];ue[De]&&ue[De].node.mode===pe.mode?(ce[De][ye]=te(ue[De].lastCount+pe.length,pe.mode)-te(ue[De].lastCount,pe.mode),ue[De].lastCount+=pe.length):(ue[De]&&(ue[De].lastCount=pe.length),ce[De][ye]=te(pe.length,pe.mode)+4+_.getCharCountIndicator(pe.mode,oe))}}ae=ge}for(let le=0;le<ae.length;le++)ce[ae[le]].end=0;return{map:ce,table:ue}}function se(ie,oe){let ue;const ce=_.getBestModeForData(ie);if(ue=_.from(oe,ce),ue!==_.BYTE&&ue.bit<ce.bit)throw new Error('"'+ie+'" cannot be encoded with mode '+_.toString(ue)+`.
 Suggested mode is: `+_.toString(ce));switch(ue===_.KANJI&&!X.isKanjiModeEnabled()&&(ue=_.BYTE),ue){case _.NUMERIC:return new M(ie);case _.ALPHANUMERIC:return new $(ie);case _.KANJI:return new z(ie);case _.BYTE:return new j(ie)}}q.fromArray=function(oe){return oe.reduce(function(ue,ce){return typeof ce=="string"?ue.push(se(ce,null)):ce.data&&ue.push(se(ce.data,ce.mode)),ue},[])},q.fromString=function(oe,ue){const ce=ee(oe,X.isKanjiModeEnabled()),ae=ne(ce),le=re(ae,ue),he=G.find_path(le.map,"start","end"),ge=[];for(let de=1;de<he.length-1;de++)ge.push(le.table[he[de]].node);return q.fromArray(Z(ge))},q.rawSplit=function(oe){return q.fromArray(ee(oe,X.isKanjiModeEnabled()))}})(segments);const Utils$1=utils$1,ECLevel=errorCorrectionLevel,BitBuffer=bitBuffer,BitMatrix=bitMatrix,AlignmentPattern=alignmentPattern,FinderPattern=finderPattern,MaskPattern=maskPattern,ECCode=errorCorrectionCode,ReedSolomonEncoder=reedSolomonEncoder,Version=version,FormatInfo=formatInfo,Mode=mode,Segments=segments;function setupFinderPattern(q,_){const M=q.size,$=FinderPattern.getPositions(_);for(let j=0;j<$.length;j++){const z=$[j][0],V=$[j][1];for(let X=-1;X<=7;X++)if(!(z+X<=-1||M<=z+X))for(let G=-1;G<=7;G++)V+G<=-1||M<=V+G||(X>=0&&X<=6&&(G===0||G===6)||G>=0&&G<=6&&(X===0||X===6)||X>=2&&X<=4&&G>=2&&G<=4?q.set(z+X,V+G,!0,!0):q.set(z+X,V+G,!1,!0))}}function setupTimingPattern(q){const _=q.size;for(let M=8;M<_-8;M++){const $=M%2===0;q.set(M,6,$,!0),q.set(6,M,$,!0)}}function setupAlignmentPattern(q,_){const M=AlignmentPattern.getPositions(_);for(let $=0;$<M.length;$++){const j=M[$][0],z=M[$][1];for(let V=-2;V<=2;V++)for(let X=-2;X<=2;X++)V===-2||V===2||X===-2||X===2||V===0&&X===0?q.set(j+V,z+X,!0,!0):q.set(j+V,z+X,!1,!0)}}function setupVersionInfo(q,_){const M=q.size,$=Version.getEncodedBits(_);let j,z,V;for(let X=0;X<18;X++)j=Math.floor(X/3),z=X%3+M-8-3,V=($>>X&1)===1,q.set(j,z,V,!0),q.set(z,j,V,!0)}function setupFormatInfo(q,_,M){const $=q.size,j=FormatInfo.getEncodedBits(_,M);let z,V;for(z=0;z<15;z++)V=(j>>z&1)===1,z<6?q.set(z,8,V,!0):z<8?q.set(z+1,8,V,!0):q.set($-15+z,8,V,!0),z<8?q.set(8,$-z-1,V,!0):z<9?q.set(8,15-z-1+1,V,!0):q.set(8,15-z-1,V,!0);q.set($-8,8,1,!0)}function setupData(q,_){const M=q.size;let $=-1,j=M-1,z=7,V=0;for(let X=M-1;X>0;X-=2)for(X===6&&X--;;){for(let G=0;G<2;G++)if(!q.isReserved(j,X-G)){let Y=!1;V<_.length&&(Y=(_[V]>>>z&1)===1),q.set(j,X-G,Y),z--,z===-1&&(V++,z=7)}if(j+=$,j<0||M<=j){j-=$,$=-$;break}}}function createData(q,_,M){const $=new BitBuffer;M.forEach(function(G){$.put(G.mode.bit,4),$.put(G.getLength(),Mode.getCharCountIndicator(G.mode,q)),G.write($)});const j=Utils$1.getSymbolTotalCodewords(q),z=ECCode.getTotalCodewordsCount(q,_),V=(j-z)*8;for($.getLengthInBits()+4<=V&&$.put(0,4);$.getLengthInBits()%8!==0;)$.putBit(0);const X=(V-$.getLengthInBits())/8;for(let G=0;G<X;G++)$.put(G%2?17:236,8);return createCodewords($,q,_)}function createCodewords(q,_,M){const $=Utils$1.getSymbolTotalCodewords(_),j=ECCode.getTotalCodewordsCount(_,M),z=$-j,V=ECCode.getBlocksCount(_,M),X=$%V,G=V-X,Y=Math.floor($/V),Q=Math.floor(z/V),ee=Q+1,te=Y-Q,Z=new ReedSolomonEncoder(te);let ne=0;const re=new Array(V),se=new Array(V);let ie=0;const oe=new Uint8Array(q.buffer);for(let he=0;he<V;he++){const ge=he<G?Q:ee;re[he]=oe.slice(ne,ne+ge),se[he]=Z.encode(re[he]),ne+=ge,ie=Math.max(ie,ge)}const ue=new Uint8Array($);let ce=0,ae,le;for(ae=0;ae<ie;ae++)for(le=0;le<V;le++)ae<re[le].length&&(ue[ce++]=re[le][ae]);for(ae=0;ae<te;ae++)for(le=0;le<V;le++)ue[ce++]=se[le][ae];return ue}function createSymbol(q,_,M,$){let j;if(Array.isArray(q))j=Segments.fromArray(q);else if(typeof q=="string"){let Y=_;if(!Y){const Q=Segments.rawSplit(q);Y=Version.getBestVersionForData(Q,M)}j=Segments.fromString(q,Y||40)}else throw new Error("Invalid data");const z=Version.getBestVersionForData(j,M);if(!z)throw new Error("The amount of data is too big to be stored in a QR Code");if(!_)_=z;else if(_<z)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+z+`.
`);const V=createData(_,M,j),X=Utils$1.getSymbolSize(_),G=new BitMatrix(X);return setupFinderPattern(G,_),setupTimingPattern(G),setupAlignmentPattern(G,_),setupFormatInfo(G,M,0),_>=7&&setupVersionInfo(G,_),setupData(G,V),isNaN($)&&($=MaskPattern.getBestMask(G,setupFormatInfo.bind(null,G,M))),MaskPattern.applyMask($,G),setupFormatInfo(G,M,$),{modules:G,version:_,errorCorrectionLevel:M,maskPattern:$,segments:j}}qrcode.create=function q(_,M){if(typeof _>"u"||_==="")throw new Error("No input text");let $=ECLevel.M,j,z;return typeof M<"u"&&($=ECLevel.from(M.errorCorrectionLevel,ECLevel.M),j=Version.from(M.version),z=MaskPattern.from(M.maskPattern),M.toSJISFunc&&Utils$1.setToSJISFunction(M.toSJISFunc)),createSymbol(_,j,$,z)};var canvas={},utils={};(function(q){function _(M){if(typeof M=="number"&&(M=M.toString()),typeof M!="string")throw new Error("Color should be defined as hex string");let $=M.slice().replace("#","").split("");if($.length<3||$.length===5||$.length>8)throw new Error("Invalid hex color: "+M);($.length===3||$.length===4)&&($=Array.prototype.concat.apply([],$.map(function(z){return[z,z]}))),$.length===6&&$.push("F","F");const j=parseInt($.join(""),16);return{r:j>>24&255,g:j>>16&255,b:j>>8&255,a:j&255,hex:"#"+$.slice(0,6).join("")}}q.getOptions=function($){$||($={}),$.color||($.color={});const j=typeof $.margin>"u"||$.margin===null||$.margin<0?4:$.margin,z=$.width&&$.width>=21?$.width:void 0,V=$.scale||4;return{width:z,scale:z?4:V,margin:j,color:{dark:_($.color.dark||"#000000ff"),light:_($.color.light||"#ffffffff")},type:$.type,rendererOpts:$.rendererOpts||{}}},q.getScale=function($,j){return j.width&&j.width>=$+j.margin*2?j.width/($+j.margin*2):j.scale},q.getImageWidth=function($,j){const z=q.getScale($,j);return Math.floor(($+j.margin*2)*z)},q.qrToImageData=function($,j,z){const V=j.modules.size,X=j.modules.data,G=q.getScale(V,z),Y=Math.floor((V+z.margin*2)*G),Q=z.margin*G,ee=[z.color.light,z.color.dark];for(let te=0;te<Y;te++)for(let Z=0;Z<Y;Z++){let ne=(te*Y+Z)*4,re=z.color.light;if(te>=Q&&Z>=Q&&te<Y-Q&&Z<Y-Q){const se=Math.floor((te-Q)/G),ie=Math.floor((Z-Q)/G);re=ee[X[se*V+ie]?1:0]}$[ne++]=re.r,$[ne++]=re.g,$[ne++]=re.b,$[ne]=re.a}}})(utils);(function(q){const _=utils;function M(j,z,V){j.clearRect(0,0,z.width,z.height),z.style||(z.style={}),z.height=V,z.width=V,z.style.height=V+"px",z.style.width=V+"px"}function $(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}q.render=function(z,V,X){let G=X,Y=V;typeof G>"u"&&(!V||!V.getContext)&&(G=V,V=void 0),V||(Y=$()),G=_.getOptions(G);const Q=_.getImageWidth(z.modules.size,G),ee=Y.getContext("2d"),te=ee.createImageData(Q,Q);return _.qrToImageData(te.data,z,G),M(ee,Y,Q),ee.putImageData(te,0,0),Y},q.renderToDataURL=function(z,V,X){let G=X;typeof G>"u"&&(!V||!V.getContext)&&(G=V,V=void 0),G||(G={});const Y=q.render(z,V,G),Q=G.type||"image/png",ee=G.rendererOpts||{};return Y.toDataURL(Q,ee.quality)}})(canvas);var svgTag={};const Utils=utils;function getColorAttrib(q,_){const M=q.a/255,$=_+'="'+q.hex+'"';return M<1?$+" "+_+'-opacity="'+M.toFixed(2).slice(1)+'"':$}function svgCmd(q,_,M){let $=q+_;return typeof M<"u"&&($+=" "+M),$}function qrToPath(q,_,M){let $="",j=0,z=!1,V=0;for(let X=0;X<q.length;X++){const G=Math.floor(X%_),Y=Math.floor(X/_);!G&&!z&&(z=!0),q[X]?(V++,X>0&&G>0&&q[X-1]||($+=z?svgCmd("M",G+M,.5+Y+M):svgCmd("m",j,0),j=0,z=!1),G+1<_&&q[X+1]||($+=svgCmd("h",V),V=0)):j++}return $}svgTag.render=function q(_,M,$){const j=Utils.getOptions(M),z=_.modules.size,V=_.modules.data,X=z+j.margin*2,G=j.color.light.a?"<path "+getColorAttrib(j.color.light,"fill")+' d="M0 0h'+X+"v"+X+'H0z"/>':"",Y="<path "+getColorAttrib(j.color.dark,"stroke")+' d="'+qrToPath(V,z,j.margin)+'"/>',Q='viewBox="0 0 '+X+" "+X+'"',te='<svg xmlns="http://www.w3.org/2000/svg" '+(j.width?'width="'+j.width+'" height="'+j.width+'" ':"")+Q+' shape-rendering="crispEdges">'+G+Y+`</svg>
`;return typeof $=="function"&&$(null,te),te};const canPromise=canPromise$1,QRCode=qrcode,CanvasRenderer=canvas,SvgRenderer=svgTag;function renderCanvas(q,_,M,$,j){const z=[].slice.call(arguments,1),V=z.length,X=typeof z[V-1]=="function";if(!X&&!canPromise())throw new Error("Callback required as last argument");if(X){if(V<2)throw new Error("Too few arguments provided");V===2?(j=M,M=_,_=$=void 0):V===3&&(_.getContext&&typeof j>"u"?(j=$,$=void 0):(j=$,$=M,M=_,_=void 0))}else{if(V<1)throw new Error("Too few arguments provided");return V===1?(M=_,_=$=void 0):V===2&&!_.getContext&&($=M,M=_,_=void 0),new Promise(function(G,Y){try{const Q=QRCode.create(M,$);G(q(Q,_,$))}catch(Q){Y(Q)}})}try{const G=QRCode.create(M,$);j(null,q(G,_,$))}catch(G){j(G)}}browser.create=QRCode.create;browser.toCanvas=renderCanvas.bind(null,CanvasRenderer.render);browser.toDataURL=renderCanvas.bind(null,CanvasRenderer.renderToDataURL);browser.toString=renderCanvas.bind(null,function(q,_,M){return SvgRenderer.render(q,M)});function create_fragment$8(q){let _,M;return{c(){_=element("div"),attr(_,"id","qrcode")},m($,j){insert($,_,j),q[3](_)},p:noop,i($){M||add_render_callback(()=>{M=create_in_transition(_,fade,{duration:300}),M.start()})},o:noop,d($){$&&detach(_),q[3](null)}}}function instance$5(q,_,M){let{codeValue:$}=_,{squareSize:j}=_,z,V;onMount(async()=>{V=await browser.toCanvas($,{width:j,small:!0,color:{dark:"#000000",light:"#ffffff"}}),z.appendChild(V)}),onDestroy(()=>{V&&V.remove()});function X(G){binding_callbacks[G?"unshift":"push"](()=>{z=G,M(0,z)})}return q.$$set=G=>{"codeValue"in G&&M(1,$=G.codeValue),"squareSize"in G&&M(2,j=G.squareSize)},[z,$,j,X]}class QRJS extends SvelteComponent{constructor(_){super(),init(this,_,instance$5,create_fragment$8,safe_not_equal,{codeValue:1,squareSize:2})}}const CreateInvitation_svelte_svelte_type_style_lang="";function create_if_block$3(q){let _,M,$,j,z,V,X,G,Y,Q,ee,te,Z,ne;function re(le,he){return le[2]?create_else_block_1:create_if_block_3$2}let se=re(q),ie=se(q);function oe(le,he){return le[3]?create_if_block_2$2:create_else_block}let ue=oe(q),ce=ue(q),ae=q[3]&&create_if_block_1$2(q);return{c(){_=element("p"),M=element("strong"),M.textContent="Your invitation URL is:",$=space(),j=element("span"),z=text(q[1]),V=space(),ie.c(),X=space(),G=element("button"),ce.c(),Y=text(`
        QR code`),Q=space(),ae&&ae.c(),ee=empty(),attr(j,"class","break-all text-xs"),attr(_,"class","py-2"),attr(G,"class","mt-2")},m(le,he){insert(le,_,he),append(_,M),append(_,$),append(_,j),append(j,z),insert(le,V,he),ie.m(le,he),insert(le,X,he),insert(le,G,he),ce.m(G,null),append(G,Y),insert(le,Q,he),ae&&ae.m(le,he),insert(le,ee,he),te=!0,Z||(ne=listen(G,"click",q[6]),Z=!0)},p(le,he){(!te||he&2)&&set_data(z,le[1]),se===(se=re(le))&&ie?ie.p(le,he):(ie.d(1),ie=se(le),ie&&(ie.c(),ie.m(X.parentNode,X))),ue!==(ue=oe(le))&&(ce.d(1),ce=ue(le),ce&&(ce.c(),ce.m(G,Y))),le[3]?ae?(ae.p(le,he),he&8&&transition_in(ae,1)):(ae=create_if_block_1$2(le),ae.c(),transition_in(ae,1),ae.m(ee.parentNode,ee)):ae&&(group_outros(),transition_out(ae,1,1,()=>{ae=null}),check_outros())},i(le){te||(transition_in(ae),te=!0)},o(le){transition_out(ae),te=!1},d(le){le&&detach(_),le&&detach(V),ie.d(le),le&&detach(X),le&&detach(G),ce.d(),le&&detach(Q),ae&&ae.d(le),le&&detach(ee),Z=!1,ne()}}}function create_else_block_1(q){let _,M,$;return{c(){_=element("button"),_.textContent="URL copied to clipboard!"},m(j,z){insert(j,_,z),M||($=listen(_,"click",q[5]),M=!0)},p:noop,d(j){j&&detach(_),M=!1,$()}}}function create_if_block_3$2(q){let _,M,$;return{c(){_=element("button"),_.textContent="Copy URL to clipboard"},m(j,z){insert(j,_,z),M||($=listen(_,"click",q[5]),M=!0)},p:noop,d(j){j&&detach(_),M=!1,$()}}}function create_else_block(q){let _;return{c(){_=text("Show")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_2$2(q){let _;return{c(){_=text("Hide")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_1$2(q){let _,M,$;return M=new QRJS({props:{codeValue:q[1],squareSize:q[0]}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"id","qrcodeContainer"),attr(_,"class","ml-1/5 mb-12 svelte-tchhkp")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&2&&(V.codeValue=j[1]),z&1&&(V.squareSize=j[0]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_fragment$7(q){let _,M,$,j,z,V,X=q[1]&&create_if_block$3(q);return{c(){_=element("div"),M=element("button"),M.textContent="generate invitation url",$=space(),X&&X.c(),attr(M,"class","phase1 w-60")},m(G,Y){insert(G,_,Y),append(_,M),append(_,$),X&&X.m(_,null),j=!0,z||(V=listen(M,"click",q[4]),z=!0)},p(G,[Y]){G[1]?X?(X.p(G,Y),Y&2&&transition_in(X,1)):(X=create_if_block$3(G),X.c(),transition_in(X,1),X.m(_,null)):X&&(group_outros(),transition_out(X,1,1,()=>{X=null}),check_outros())},i(G){j||(transition_in(X),j=!0)},o(G){transition_out(X),j=!1},d(G){G&&detach(_),X&&X.d(),z=!1,V()}}}function instance$4(q,_,M){let $;onMount(()=>{M(0,$=window.innerWidth*.4),window.addEventListener("resize",()=>{M(0,$=window.innerWidth*.4)})});let j="",z=!1,V=!1,{shareAddress:X}=_;async function G(){const ee=await createInvitationURL(X,settings.servers,settings.shareSecrets[X]);typeof ee=="string"?M(1,j=ee):console.error("Failed to create invitation URL:",ee)}async function Y(){try{await navigator.clipboard.writeText(j),M(2,z=!0)}catch(ee){console.error("Failed to copy text: ",ee)}}function Q(){M(3,V=!V)}return q.$$set=ee=>{"shareAddress"in ee&&M(7,X=ee.shareAddress)},[$,j,z,V,G,Y,Q,X]}class CreateInvitation extends SvelteComponent{constructor(_){super(),init(this,_,instance$4,create_fragment$7,safe_not_equal,{shareAddress:7})}}const InvitationUrl_svelte_svelte_type_style_lang="";function create_fragment$6(q){let _,M,$,j,z,V,X;return $=new RedeemInvitation({}),V=new CreateInvitation({}),{c(){_=element("div"),M=element("div"),create_component($.$$.fragment),j=space(),z=element("div"),create_component(V.$$.fragment),attr(M,"class","svelte-a2uzsp"),attr(z,"class","svelte-a2uzsp"),attr(_,"class","svelte-a2uzsp")},m(G,Y){insert(G,_,Y),append(_,M),mount_component($,M,null),append(_,j),append(_,z),mount_component(V,z,null),X=!0},p:noop,i(G){X||(transition_in($.$$.fragment,G),transition_in(V.$$.fragment,G),X=!0)},o(G){transition_out($.$$.fragment,G),transition_out(V.$$.fragment,G),X=!1},d(G){G&&detach(_),destroy_component($),destroy_component(V)}}}class InvitationUrl extends SvelteComponent{constructor(_){super(),init(this,_,null,create_fragment$6,safe_not_equal,{})}}const ShareViewer_svelte_svelte_type_style_lang="";function get_each_context$1(q,_,M){const $=q.slice();return $[1]=_[M],$}function create_if_block$2(q){let _=[],M=new Map,$,j,z=q[0];const V=X=>X[1];for(let X=0;X<z.length;X+=1){let G=get_each_context$1(q,z,X),Y=V(G);M.set(Y,_[X]=create_each_block$1(Y,G))}return{c(){for(let X=0;X<_.length;X+=1)_[X].c();$=empty()},m(X,G){for(let Y=0;Y<_.length;Y+=1)_[Y].m(X,G);insert(X,$,G),j=!0},p(X,G){G&1&&(z=X[0],group_outros(),_=update_keyed_each(_,G,V,1,X,z,M,$.parentNode,outro_and_destroy_block,create_each_block$1,$,get_each_context$1),check_outros())},i(X){if(!j){for(let G=0;G<z.length;G+=1)transition_in(_[G]);j=!0}},o(X){for(let G=0;G<_.length;G+=1)transition_out(_[G]);j=!1},d(X){for(let G=0;G<_.length;G+=1)_[G].d(X);X&&detach($)}}}function create_each_block$1(q,_){let M,$,j,z,V=_[1]+"",X,G,Y,Q,ee,te=settings.shareSecrets[_[1]]+"",Z,ne,re,se,ie,oe=_[1].includes("commons")?"Commons":"Studio",ue,ce,ae,le,he,ge,de,pe;return le=new CreateInvitation({props:{shareAddress:_[1]}}),{key:q,first:null,c(){M=element("div"),$=element("p"),j=element("b"),j.textContent="Address:",z=space(),X=text(V),G=space(),Y=element("p"),Q=element("b"),Q.textContent="Secret:",ee=space(),Z=text(te),ne=space(),re=element("p"),se=element("b"),se.textContent="Type:",ie=space(),ue=text(oe),ce=space(),ae=element("div"),create_component(le.$$.fragment),he=space(),ge=element("hr"),de=space(),attr(ae,"class","mt-4"),attr(ge,"class","divider w-full mt-4 mb-2 svelte-vszkp2"),attr(M,"class","flex flex-col items-start py-2"),this.first=M},m(ye,_e){insert(ye,M,_e),append(M,$),append($,j),append($,z),append($,X),append(M,G),append(M,Y),append(Y,Q),append(Y,ee),append(Y,Z),append(M,ne),append(M,re),append(re,se),append(re,ie),append(re,ue),append(M,ce),append(M,ae),mount_component(le,ae,null),append(M,he),append(M,ge),append(M,de),pe=!0},p(ye,_e){_=ye,(!pe||_e&1)&&V!==(V=_[1]+"")&&set_data(X,V),(!pe||_e&1)&&te!==(te=settings.shareSecrets[_[1]]+"")&&set_data(Z,te),(!pe||_e&1)&&oe!==(oe=_[1].includes("commons")?"Commons":"Studio")&&set_data(ue,oe);const De={};_e&1&&(De.shareAddress=_[1]),le.$set(De)},i(ye){pe||(transition_in(le.$$.fragment,ye),pe=!0)},o(ye){transition_out(le.$$.fragment,ye),pe=!1},d(ye){ye&&detach(M),destroy_component(le)}}}function create_fragment$5(q){let _,M,$=q[0].length>0&&create_if_block$2(q);return{c(){_=element("div"),$&&$.c(),attr(_,"class","flex flex-col items-start")},m(j,z){insert(j,_,z),$&&$.m(_,null),M=!0},p(j,[z]){j[0].length>0?$?($.p(j,z),z&1&&transition_in($,1)):($=create_if_block$2(j),$.c(),transition_in($,1),$.m(_,null)):$&&(group_outros(),transition_out($,1,1,()=>{$=null}),check_outros())},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){j&&detach(_),$&&$.d()}}}function instance$3(q,_,M){let $=[];return shares.subscribe(j=>{M(0,$=[...j])}),q.$$.update=()=>{q.$$.dirty&1&&console.log("shareList",$)},console.log("shareSecrets",settings.shareSecrets),[$]}class ShareViewer extends SvelteComponent{constructor(_){super(),init(this,_,instance$3,create_fragment$5,safe_not_equal,{})}}function create_default_slot(q){let _;return{c(){_=element("sup"),_.textContent="?",attr(_,"class","font-features sups")},m(M,$){insert(M,_,$)},p:noop,d(M){M&&detach(_)}}}function create_fragment$4(q){let _,M,$,j,z,V,X,G,Y,Q,ee,te,Z,ne,re;return V=new Tooltip({props:{text:'tool tip on hover explaining what "shares" means',$$slots:{default:[create_default_slot]},$$scope:{ctx:q}}}),G=new ShareViewer({}),Q=new AddShare({}),te=new RedeemInvitation({}),ne=new RemoveShare({}),{c(){_=element("div"),M=element("h3"),M.textContent="workspace settings",$=space(),j=element("h4"),z=text(`all workspace shares
        `),create_component(V.$$.fragment),X=space(),create_component(G.$$.fragment),Y=space(),create_component(Q.$$.fragment),ee=space(),create_component(te.$$.fragment),Z=space(),create_component(ne.$$.fragment),attr(_,"class","flex flex-col items-start pb-24")},m(se,ie){insert(se,_,ie),append(_,M),append(_,$),append(_,j),append(j,z),mount_component(V,j,null),append(_,X),mount_component(G,_,null),append(_,Y),mount_component(Q,_,null),append(_,ee),mount_component(te,_,null),append(_,Z),mount_component(ne,_,null),re=!0},p(se,[ie]){const oe={};ie&1&&(oe.$$scope={dirty:ie,ctx:se}),V.$set(oe)},i(se){re||(transition_in(V.$$.fragment,se),transition_in(G.$$.fragment,se),transition_in(Q.$$.fragment,se),transition_in(te.$$.fragment,se),transition_in(ne.$$.fragment,se),re=!0)},o(se){transition_out(V.$$.fragment,se),transition_out(G.$$.fragment,se),transition_out(Q.$$.fragment,se),transition_out(te.$$.fragment,se),transition_out(ne.$$.fragment,se),re=!1},d(se){se&&detach(_),destroy_component(V),destroy_component(G),destroy_component(Q),destroy_component(te),destroy_component(ne)}}}class Workspace extends SvelteComponent{constructor(_){super(),init(this,_,null,create_fragment$4,safe_not_equal,{})}}function create_if_block_4(q){let _,M;return _=new Workspace({}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block_3$1(q){let _,M,$;return M=new Server({}),{c(){_=element("div"),create_component(M.$$.fragment)},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_2$1(q){let _,M;return _=new Identity({}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block_1$1(q){let _,M;return _=new StatusPanel({props:{status:q[0]}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&1&&(z.status=$[0]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block$1(q){let _,M,$;return M=new InvitationUrl({}),{c(){_=element("div"),create_component(M.$$.fragment)},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_fragment$3(q){let _,M,$,j,z,V,X=q[2].address.slice(0,5)+"",G,Y,Q,ee,te,Z,ne,re,se,ie,oe,ue,ce,ae,le,he,ge,de=q[1]==="workspace"&&create_if_block_4(),pe=q[1]==="server"&&create_if_block_3$1(),ye=q[1]==="identity"&&create_if_block_2$1(),_e=q[1]==="status"&&create_if_block_1$1(q),De=q[1]==="invitation"&&create_if_block$1();return{c(){_=element("div"),M=element("div"),$=element("button"),$.textContent=" exit server customization",j=space(),z=element("p"),V=element("b"),V.textContent=`current alias:
    `,G=text(X),Y=space(),Q=element("div"),ee=element("button"),ee.textContent="workspace settings",te=space(),Z=element("button"),Z.textContent="server settings",ne=space(),re=element("button"),re.textContent="manage alias",se=space(),ie=element("div"),de&&de.c(),oe=space(),pe&&pe.c(),ue=space(),ye&&ye.c(),ce=space(),_e&&_e.c(),ae=space(),De&&De.c(),attr($,"class","ml-6 mt-4 mb-2 h-auto mr-1 border-black"),attr(z,"class","ml-6 text-2xl text-left"),attr(ee,"class","my-1"),toggle_class(ee,"phase2",q[1]==="workspace"),attr(Z,"class","my-1"),toggle_class(Z,"phase2",q[1]==="server"),attr(re,"class","my-1"),toggle_class(re,"phase2",q[1]==="identity"),attr(Q,"class","paper-yellow ml-6 mx-1 sm:mt-4 flex flex-row sm:flex-col p-8 h-auto sm:h-[80vh] z-50 customBorder"),attr(M,"class","sm:w-1/5 flex flex-col fixed"),attr(ie,"class","w-full sm:w-[80vw] mt-16 sm:mt-10 sm:ml-[25vw]"),attr(_,"class","the-scroll flex flex-col sm:flex-row min-h-screen overflow-y-auto")},m(fe,Ae){insert(fe,_,Ae),append(_,M),append(M,$),append(M,j),append(M,z),append(z,V),append(z,G),append(M,Y),append(M,Q),append(Q,ee),append(Q,te),append(Q,Z),append(Q,ne),append(Q,re),append(_,se),append(_,ie),de&&de.m(ie,null),append(ie,oe),pe&&pe.m(ie,null),append(ie,ue),ye&&ye.m(ie,null),append(ie,ce),_e&&_e.m(ie,null),append(ie,ae),De&&De.m(ie,null),le=!0,he||(ge=[listen($,"click",q[3]),listen(ee,"click",q[4]),listen(Z,"click",q[5]),listen(re,"click",q[6])],he=!0)},p(fe,[Ae]){(!le||Ae&4)&&X!==(X=fe[2].address.slice(0,5)+"")&&set_data(G,X),(!le||Ae&2)&&toggle_class(ee,"phase2",fe[1]==="workspace"),(!le||Ae&2)&&toggle_class(Z,"phase2",fe[1]==="server"),(!le||Ae&2)&&toggle_class(re,"phase2",fe[1]==="identity"),fe[1]==="workspace"?de?Ae&2&&transition_in(de,1):(de=create_if_block_4(),de.c(),transition_in(de,1),de.m(ie,oe)):de&&(group_outros(),transition_out(de,1,1,()=>{de=null}),check_outros()),fe[1]==="server"?pe?Ae&2&&transition_in(pe,1):(pe=create_if_block_3$1(),pe.c(),transition_in(pe,1),pe.m(ie,ue)):pe&&(group_outros(),transition_out(pe,1,1,()=>{pe=null}),check_outros()),fe[1]==="identity"?ye?Ae&2&&transition_in(ye,1):(ye=create_if_block_2$1(),ye.c(),transition_in(ye,1),ye.m(ie,ce)):ye&&(group_outros(),transition_out(ye,1,1,()=>{ye=null}),check_outros()),fe[1]==="status"?_e?(_e.p(fe,Ae),Ae&2&&transition_in(_e,1)):(_e=create_if_block_1$1(fe),_e.c(),transition_in(_e,1),_e.m(ie,ae)):_e&&(group_outros(),transition_out(_e,1,1,()=>{_e=null}),check_outros()),fe[1]==="invitation"?De?Ae&2&&transition_in(De,1):(De=create_if_block$1(),De.c(),transition_in(De,1),De.m(ie,null)):De&&(group_outros(),transition_out(De,1,1,()=>{De=null}),check_outros())},i(fe){le||(transition_in(de),transition_in(pe),transition_in(ye),transition_in(_e),transition_in(De),le=!0)},o(fe){transition_out(de),transition_out(pe),transition_out(ye),transition_out(_e),transition_out(De),le=!1},d(fe){fe&&detach(_),de&&de.d(),pe&&pe.d(),ye&&ye.d(),_e&&_e.d(),De&&De.d(),he=!1,run_all(ge)}}}function instance$2(q,_,M){let $;component_subscribe(q,authorKeypair,ee=>M(2,$=ee));let{status:j}=_,z="identity";const V=createEventDispatcher();function X(){V("toggle")}const G=()=>M(1,z="workspace"),Y=()=>M(1,z="server"),Q=()=>M(1,z="identity");return q.$$set=ee=>{"status"in ee&&M(0,j=ee.status)},[j,z,$,X,G,Y,Q]}class UserSettings extends SvelteComponent{constructor(_){super(),init(this,_,instance$2,create_fragment$3,safe_not_equal,{status:0})}}const MouseBanner_svelte_svelte_type_style_lang="";function get_each_context(q,_,M){const $=q.slice();return $[1]=_[M],$[3]=M,$}function create_each_block(q){let _,M,$,j;return{c(){_=element("div"),M=element("div"),$=space(),j=element("div"),attr(M,"class","ml-12 bgimg svelte-1veluwv"),attr(M,"style",`background-image: url(${src});`),attr(_,"class","cell svelte-1veluwv"),attr(j,"class","cell svelte-1veluwv")},m(z,V){insert(z,_,V),append(_,M),insert(z,$,V),insert(z,j,V)},p:noop,d(z){z&&detach(_),z&&detach($),z&&detach(j)}}}function create_fragment$2(q){let _,M=q[0],$=[];for(let j=0;j<M.length;j+=1)$[j]=create_each_block(get_each_context(q,M,j));return{c(){_=element("div");for(let j=0;j<$.length;j+=1)$[j].c();attr(_,"class","banner svelte-1veluwv")},m(j,z){insert(j,_,z);for(let V=0;V<$.length;V+=1)$[V].m(_,null)},p(j,[z]){if(z&0){M=j[0];let V;for(V=0;V<M.length;V+=1){const X=get_each_context(j,M,V);$[V]?$[V].p(X,z):($[V]=create_each_block(),$[V].c(),$[V].m(_,null))}for(;V<$.length;V+=1)$[V].d(1);$.length=M.length}},i:noop,o:noop,d(j){j&&detach(_),destroy_each($,j)}}}const src="images/upload-img.png",repetitions=7;function instance$1(q){return[Array(repetitions).fill().map(()=>({}))]}class MouseBanner extends SvelteComponent{constructor(_){super(),init(this,_,instance$1,create_fragment$2,safe_not_equal,{})}}const Footer_svelte_svelte_type_style_lang="";function create_fragment$1(q){let _;return{c(){_=element("footer"),_.innerHTML=`<div class="footer mx-6 flex flex-row justify-between svelte-1bopaqf"><div class="flex flex-row justify-between w-1/3 ml-8"><div>read manual</div> 
      <div>report bugs</div> 
      <div>about</div></div> 
    <div class="mr-8">open source project [link to repo???CTA for engagement??] thank funder?</div></div>`,attr(_,"class","w-full")},m(M,$){insert(M,_,$)},p:noop,i:noop,o:noop,d(M){M&&detach(_)}}}class Footer extends SvelteComponent{constructor(_){super(),init(this,_,null,create_fragment$1,safe_not_equal,{})}}const App_svelte_svelte_type_style_lang="";function create_if_block_2(q){let _,M,$,j,z,V,X,G,Y,Q,ee,te,Z,ne,re,se,ie,oe,ue,ce;Z=new ValidateId({}),Z.$on("validated",q[5]),Z.$on("error",q[7]),Z.$on("generateNewIdentity",q[12]),Z.$on("alias",q[5]),re=new MouseBanner({});let ae=q[2]===!0&&create_if_block_3();return{c(){_=element("div"),M=element("h1"),M.textContent="Eccentric Networks",$=space(),j=element("h4"),j.textContent="Collaboration space for the unconnected",z=space(),V=element("div"),X=element("button"),X.textContent="Generate new Identity",G=space(),Y=element("button"),Y.textContent="Explore the commons",Q=space(),ee=element("div"),te=element("div"),create_component(Z.$$.fragment),ne=space(),create_component(re.$$.fragment),se=space(),ae&&ae.c(),ie=empty(),attr(M,"class","svelte-w61yp2"),attr(X,"class","phase1 mx-16 mt-12 text-2xl"),attr(Y,"class","phase1 mx-16 mt-12 text-2xl"),attr(V,"class","flex flex-col lg:flex-row items-center mx-16 justify-evenly my-12"),attr(te,"class","flex flex-row items-center mx-6 my-12"),attr(ee,"class","w-1/2 flex flex-col lg:flex-row items-center mx-2 justify-center my-12"),attr(_,"class","my-12")},m(le,he){insert(le,_,he),append(_,M),append(_,$),append(_,j),append(_,z),append(_,V),append(V,X),append(V,G),append(V,Y),append(_,Q),append(_,ee),append(ee,te),mount_component(Z,te,null),append(_,ne),mount_component(re,_,null),insert(le,se,he),ae&&ae.m(le,he),insert(le,ie,he),oe=!0,ue||(ce=[listen(X,"click",q[6]),listen(Y,"click",q[11])],ue=!0)},p(le,he){le[2]===!0?ae?he&4&&transition_in(ae,1):(ae=create_if_block_3(),ae.c(),transition_in(ae,1),ae.m(ie.parentNode,ie)):ae&&(group_outros(),transition_out(ae,1,1,()=>{ae=null}),check_outros())},i(le){oe||(transition_in(Z.$$.fragment,le),transition_in(re.$$.fragment,le),transition_in(ae),oe=!0)},o(le){transition_out(Z.$$.fragment,le),transition_out(re.$$.fragment,le),transition_out(ae),oe=!1},d(le){le&&detach(_),destroy_component(Z),destroy_component(re),le&&detach(se),ae&&ae.d(le),le&&detach(ie),ue=!1,run_all(ce)}}}function create_if_block_3(q){let _,M,$;return{c(){_=element("blockquote"),_.textContent="There was an error with your identity file"},m(j,z){insert(j,_,z),$=!0},i(j){$||(add_render_callback(()=>{M||(M=create_bidirectional_transition(_,fly,{y:200,duration:2e3},!0)),M.run(1)}),$=!0)},o(j){M||(M=create_bidirectional_transition(_,fly,{y:200,duration:2e3},!1)),M.run(0),$=!1},d(j){j&&detach(_),j&&M&&M.end()}}}function create_if_block_1(q){let _,M,$;return M=new UserSettings({props:{status:q[4]}}),M.$on("toggle",q[9]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","w-full")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&16&&(V.status=j[4]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block(q){let _,M,$;return M=new GridView({props:{showDetails:q[1],IDcreated:q[0]}}),M.$on("toggle",q[9]),M.$on("view",q[8]),M.$on("details",q[13]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","w-full")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&2&&(V.showDetails=j[1]),z&1&&(V.IDcreated=j[0]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_fragment(q){let _,M,$,j,z,V,X,G=!q[0]&&!q[1]&&create_if_block_2(q);const Y=[create_if_block,create_if_block_1],Q=[];function ee(te,Z){return te[0]&&!te[3]?0:te[0]&&te[3]?1:-1}return~($=ee(q))&&(j=Q[$]=Y[$](q)),V=new Footer({}),{c(){_=element("main"),G&&G.c(),M=space(),j&&j.c(),z=space(),create_component(V.$$.fragment),attr(_,"class","svelte-w61yp2")},m(te,Z){insert(te,_,Z),G&&G.m(_,null),append(_,M),~$&&Q[$].m(_,null),insert(te,z,Z),mount_component(V,te,Z),X=!0},p(te,[Z]){!te[0]&&!te[1]?G?(G.p(te,Z),Z&3&&transition_in(G,1)):(G=create_if_block_2(te),G.c(),transition_in(G,1),G.m(_,M)):G&&(group_outros(),transition_out(G,1,1,()=>{G=null}),check_outros());let ne=$;$=ee(te),$===ne?~$&&Q[$].p(te,Z):(j&&(group_outros(),transition_out(Q[ne],1,1,()=>{Q[ne]=null}),check_outros()),~$?(j=Q[$],j?j.p(te,Z):(j=Q[$]=Y[$](te),j.c()),transition_in(j,1),j.m(_,null)):j=null)},i(te){X||(transition_in(G),transition_in(j),transition_in(V.$$.fragment,te),X=!0)},o(te){transition_out(G),transition_out(j),transition_out(V.$$.fragment,te),X=!1},d(te){te&&detach(_),G&&G.d(),~$&&Q[$].d(),te&&detach(z),destroy_component(V,te)}}}function instance(q,_,M){let $,j;component_subscribe(q,replicaDetails,he=>M(14,$=he)),component_subscribe(q,shareKeypair,he=>M(15,j=he));let z=!1,V=!1,X=!0,G=!1,Y=!1,Q;console.log("settings",settings),onMount(async()=>{settings.author?(authorKeypair.set(settings.author),M(0,z=!0)):M(0,z=!1),settings.addShare("+studio.bywytquv2ypa7qqwtj3gbuel5fnqh6w5n5yecdqbwzsr4keativ3a"),settings.addSecret("+studio.bywytquv2ypa7qqwtj3gbuel5fnqh6w5n5yecdqbwzsr4keativ3a","bexvgelmf632ecsgvqhhbwgqgmny5vren673canlay2istswfzspq"),settings.addShare(j.shareAddress),settings.addSecret(j.shareAddress,j.shareSecret),console.log(settings.shareSecrets)});const ee=new Peer;ee.addReplica($.replica);const te=ee.sync("https://earthstar-server.fly.dev/sync",!0),Z=settings.addServer("https://earthstar-server.fly.dev/sync");console.log(Z),te.onStatusChange(he=>{M(4,Q=he),console.log(he),M(4,Q)}),te.isDone().then(()=>{console.log("Sync complete")}).catch(he=>{console.error("Sync failed",he)});function ne(he){M(0,z=!0),M(1,V=!0)}function re(){M(0,z=!0),M(3,Y=!0)}function se(he){M(2,G=!0)}const ie=new URLSearchParams(window.location.search);ie.has("studio"),ie.has("oracle");function oe(){M(10,X=!X)}function ue(){M(3,Y=!Y)}const ce=()=>M(0,z=!z&&V===!1),ae=()=>M(0,z=!z),le=()=>M(3,Y=!0);return q.$$.update=()=>{q.$$.dirty&1027&&(console.log("IDcreated",z),console.log("showDetails",V),console.log("imageView",X))},[z,V,G,Y,Q,ne,re,se,oe,ue,X,ce,ae,le]}class App extends SvelteComponent{constructor(_){super(),init(this,_,instance,create_fragment,safe_not_equal,{})}}new App({target:document.getElementById("app")});
