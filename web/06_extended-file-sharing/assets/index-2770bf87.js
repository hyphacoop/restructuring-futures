var Kr=(t,e,u)=>{if(!e.has(t))throw TypeError("Cannot "+u)};var L=(t,e,u)=>(Kr(t,e,"read from private field"),u?u.call(t):e.get(t)),Qt=(t,e,u)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,u)},ut=(t,e,u,r)=>(Kr(t,e,"write to private field"),r?r.call(t,u):e.set(t,u),u);function Fs(t,e){for(var u=0;u<e.length;u++){const r=e[u];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in t)){const i=Object.getOwnPropertyDescriptor(r,n);i&&Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function u(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=u(n);fetch(n.href,i)}})();function W(){}function ys(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function ui(t){return t()}function Vr(){return Object.create(null)}function Ce(t){t.forEach(ui)}function Sr(t){return typeof t=="function"}function Se(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let bu;function cu(t,e){return bu||(bu=document.createElement("a")),bu.href=e,t===bu.href}function bs(t){return Object.keys(t).length===0}function P(t,e){t.appendChild(e)}function T(t,e,u){t.insertBefore(e,u||null)}function I(t){t.parentNode&&t.parentNode.removeChild(t)}function Bs(t,e){for(let u=0;u<t.length;u+=1)t[u]&&t[u].d(e)}function $(t){return document.createElement(t)}function Y(t){return document.createTextNode(t)}function X(){return Y(" ")}function Hu(){return Y("")}function Ft(t,e,u,r){return t.addEventListener(e,u,r),()=>t.removeEventListener(e,u,r)}function Q(t,e,u){u==null?t.removeAttribute(e):t.getAttribute(e)!==u&&t.setAttribute(e,u)}function vs(t){return Array.from(t.childNodes)}function Lt(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function _s(t,e,u,r){u===null?t.style.removeProperty(e):t.style.setProperty(e,u,r?"important":"")}function Bu(t,e,u){t.classList[u?"add":"remove"](e)}let lu;function oe(t){lu=t}function ri(){if(!lu)throw new Error("Function called outside component initialization");return lu}function xs(t){ri().$$.on_mount.push(t)}const He=[],fr=[],_u=[],Gr=[],Ss=Promise.resolve();let dr=!1;function ks(){dr||(dr=!0,Ss.then(kr))}function pr(t){_u.push(t)}const Gu=new Set;let Ie=0;function kr(){if(Ie!==0)return;const t=lu;do{try{for(;Ie<He.length;){const e=He[Ie];Ie++,oe(e),Is(e.$$)}}catch(e){throw He.length=0,Ie=0,e}for(oe(null),He.length=0,Ie=0;fr.length;)fr.pop()();for(let e=0;e<_u.length;e+=1){const u=_u[e];Gu.has(u)||(Gu.add(u),u())}_u.length=0}while(He.length);for(;Gr.length;)Gr.pop()();dr=!1,Gu.clear(),oe(t)}function Is(t){if(t.fragment!==null){t.update(),Ce(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(pr)}}const xu=new Set;let Be;function Le(){Be={r:0,c:[],p:Be}}function Me(){Be.r||Ce(Be.c),Be=Be.p}function ct(t,e){t&&t.i&&(xu.delete(t),t.i(e))}function At(t,e,u,r){if(t&&t.o){if(xu.has(t))return;xu.add(t),Be.c.push(()=>{xu.delete(t),r&&(u&&t.d(1),r())}),t.o(e)}else r&&r()}function hu(t,e){const u=e.token={};function r(n,i,s,o){if(e.token!==u)return;e.resolved=o;let a=e.ctx;s!==void 0&&(a=a.slice(),a[s]=o);const c=n&&(e.current=n)(a);let h=!1;e.block&&(e.blocks?e.blocks.forEach((l,D)=>{D!==i&&l&&(Le(),At(l,1,1,()=>{e.blocks[D]===l&&(e.blocks[D]=null)}),Me())}):e.block.d(1),c.c(),ct(c,1),c.m(e.mount(),e.anchor),h=!0),e.block=c,e.blocks&&(e.blocks[i]=c),h&&kr()}if(ys(t)){const n=ri();if(t.then(i=>{oe(n),r(e.then,1,e.value,i),oe(null)},i=>{if(oe(n),r(e.catch,2,e.error,i),oe(null),!e.hasCatch)throw i}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function Ir(t,e,u){const r=e.slice(),{resolved:n}=t;t.current===t.then&&(r[t.value]=n),t.current===t.catch&&(r[t.error]=n),t.block.p(r,u)}function Du(t){t&&t.c()}function je(t,e,u,r){const{fragment:n,after_update:i}=t.$$;n&&n.m(e,u),r||pr(()=>{const s=t.$$.on_mount.map(ui).filter(Sr);t.$$.on_destroy?t.$$.on_destroy.push(...s):Ce(s),t.$$.on_mount=[]}),i.forEach(pr)}function We(t,e){const u=t.$$;u.fragment!==null&&(Ce(u.on_destroy),u.fragment&&u.fragment.d(e),u.on_destroy=u.fragment=null,u.ctx=[])}function Ts(t,e){t.$$.dirty[0]===-1&&(He.push(t),ks(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ze(t,e,u,r,n,i,s,o=[-1]){const a=lu;oe(t);const c=t.$$={fragment:null,ctx:[],props:i,update:W,not_equal:n,bound:Vr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:Vr(),dirty:o,skip_bound:!1,root:e.target||a.$$.root};s&&s(c.root);let h=!1;if(c.ctx=u?u(t,e.props||{},(l,D,...p)=>{const f=p.length?p[0]:D;return c.ctx&&n(c.ctx[l],c.ctx[l]=f)&&(!c.skip_bound&&c.bound[l]&&c.bound[l](f),h&&Ts(t,l)),D}):[],c.update(),h=!0,Ce(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const l=vs(e.target);c.fragment&&c.fragment.l(l),l.forEach(I)}else c.fragment&&c.fragment.c();e.intro&&ct(t.$$.fragment),je(t,e.target,e.anchor,e.customElement),kr()}oe(a)}class qe{$destroy(){We(this,1),this.$destroy=W}$on(e,u){if(!Sr(u))return W;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(u),()=>{const n=r.indexOf(u);n!==-1&&r.splice(n,1)}}$set(e){this.$$set&&!bs(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}var Rs=Object.defineProperty,Tr=(t,e)=>{for(var u in e)Rs(t,u,{get:e[u],enumerable:!0})},Mt=class extends Error{constructor(e){super(e||""),this.name="EarthstarError"}},B=class extends Mt{constructor(e){super(e||"Validation error"),this.name="ValidationError"}},et=class extends Mt{constructor(e){super(e||"a Replica or ReplicaDriver was used after being closed"),this.name="ReplicaIsClosedError"}},we=class extends Mt{constructor(t){super(t||"a ReplicaCache was used after being closed"),this.name="ReplicaCacheIsClosedError"}};function k(t){return t instanceof Mt}function ni(t){return!(t instanceof Mt)}function ii(t,e){if(t===e)return!0;if(!t||!e)return!1;var u=t.length;if(e.length!==u)return!1;for(var r=0;r<u;r++)if(t[r]!==e[r])return!1;return!0}function Su(t,e){if(t===e)return!0;if(!t||!e)return!1;var u=Object.keys(t),r=Object.keys(e),n=u.length;if(r.length!==n)return!1;for(var i=0;i<n;i++){var s=u[i];if(t[s]!==e[s]||!Object.prototype.hasOwnProperty.call(e,s))return!1}return!0}var Ps=Object.create,si=Object.defineProperty,$s=Object.getOwnPropertyDescriptor,Os=Object.getOwnPropertyNames,Hs=Object.getPrototypeOf,Ns=Object.prototype.hasOwnProperty,Us=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ls=(t,e,u,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Os(e))!Ns.call(t,n)&&n!==u&&si(t,n,{get:()=>e[n],enumerable:!(r=$s(e,n))||r.enumerable});return t},Ms=(t,e,u)=>(u=t!=null?Ps(Hs(t)):{},Ls(e||!t||!t.__esModule?si(u,"default",{value:t,enumerable:!0}):u,t)),js=Us((t,e)=>{e.exports=function(u,r){r||(r={}),typeof r=="function"&&(r={cmp:r});var n=typeof r.cycles=="boolean"?r.cycles:!1,i=r.cmp&&function(o){return function(a){return function(c,h){var l={key:c,value:a[c]},D={key:h,value:a[h]};return o(l,D)}}}(r.cmp),s=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a!==void 0){if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);var c,h;if(Array.isArray(a)){for(h="[",c=0;c<a.length;c++)c&&(h+=","),h+=o(a[c])||"null";return h+"]"}if(a===null)return"null";if(s.indexOf(a)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=s.push(a)-1,D=Object.keys(a).sort(i&&i(a));for(h="",c=0;c<D.length;c++){var p=D[c],f=o(a[p]);!f||(h&&(h+=","),h+=JSON.stringify(p)+":"+f)}return s.splice(l,1),"{"+h+"}"}}(u)}}),Ws=Ms(js()),{default:Zr,...zs}=Ws,qs=Zr!==void 0?Zr:zs,ai={};Tr(ai,{base16:()=>ea,base32:()=>ua,base32hex:()=>ra,base64:()=>na,base64url:()=>ia,codec:()=>sa,default:()=>aa});var Ks=Object.create,oi=Object.defineProperty,Vs=Object.getOwnPropertyDescriptor,Gs=Object.getOwnPropertyNames,Zs=Object.getPrototypeOf,Xs=Object.prototype.hasOwnProperty,Qs=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ys=(t,e,u,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Gs(e))!Xs.call(t,n)&&n!==u&&oi(t,n,{get:()=>e[n],enumerable:!(r=Vs(e,n))||r.enumerable});return t},Js=(t,e,u)=>(u=t!=null?Ks(Zs(t)):{},Ys(e||!t||!t.__esModule?oi(u,"default",{value:t,enumerable:!0}):u,t)),ta=Qs(t=>{Object.defineProperty(t,"__esModule",{value:!0});function e(f,d,A){var x;if(A===void 0&&(A={}),!d.codes){d.codes={};for(var y=0;y<d.chars.length;++y)d.codes[d.chars[y]]=y}if(!A.loose&&f.length*d.bits&7)throw new SyntaxError("Invalid padding");for(var m=f.length;f[m-1]==="=";)if(--m,!A.loose&&!((f.length-m)*d.bits&7))throw new SyntaxError("Invalid padding");for(var F=new((x=A.out)!=null?x:Uint8Array)(m*d.bits/8|0),g=0,v=0,b=0,E=0;E<m;++E){var S=d.codes[f[E]];if(S===void 0)throw new SyntaxError("Invalid character "+f[E]);v=v<<d.bits|S,g+=d.bits,g>=8&&(g-=8,F[b++]=255&v>>g)}if(g>=d.bits||255&v<<8-g)throw new SyntaxError("Unexpected end of data");return F}function u(f,d,A){A===void 0&&(A={});for(var x=A,y=x.pad,m=y===void 0?!0:y,F=(1<<d.bits)-1,g="",v=0,b=0,E=0;E<f.length;++E)for(b=b<<8|255&f[E],v+=8;v>d.bits;)v-=d.bits,g+=d.chars[F&b>>v];if(v&&(g+=d.chars[F&b<<d.bits-v]),m)for(;g.length*d.bits&7;)g+="=";return g}var r={chars:"0123456789ABCDEF",bits:4},n={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},i={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},s={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},o={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},a={parse:function(f,d){return e(f.toUpperCase(),r,d)},stringify:function(f,d){return u(f,r,d)}},c={parse:function(f,d){return d===void 0&&(d={}),e(d.loose?f.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):f,n,d)},stringify:function(f,d){return u(f,n,d)}},h={parse:function(f,d){return e(f,i,d)},stringify:function(f,d){return u(f,i,d)}},l={parse:function(f,d){return e(f,s,d)},stringify:function(f,d){return u(f,s,d)}},D={parse:function(f,d){return e(f,o,d)},stringify:function(f,d){return u(f,o,d)}},p={parse:e,stringify:u};t.base16=a,t.base32=c,t.base32hex=h,t.base64=l,t.base64url=D,t.codec=p}),ke=Js(ta(),1),ea=ke.default.base16,ua=ke.default.base32,ra=ke.default.base32hex,na=ke.default.base64,ia=ke.default.base64url,sa=ke.default.codec,aa=ke.default,ci={};Tr(ci,{Hash:()=>Ca,__esModule:()=>Aa,createHash:()=>wa,default:()=>ga});var oa=Object.create,li=Object.defineProperty,ca=Object.getOwnPropertyDescriptor,la=Object.getOwnPropertyNames,ha=Object.getPrototypeOf,Da=Object.prototype.hasOwnProperty,fa=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),da=(t,e,u,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of la(e))!Da.call(t,n)&&n!==u&&li(t,n,{get:()=>e[n],enumerable:!(r=ca(e,n))||r.enumerable});return t},pa=(t,e,u)=>(u=t!=null?oa(ha(t)):{},da(e||!t||!t.__esModule?li(u,"default",{value:t,enumerable:!0}):u,t)),ma=fa(t=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Hash=t.createHash=void 0;var e=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],u={sha256:1};function r(m){if(m&&!u[m]&&!u[m.toLowerCase()])throw new Error("Digest method not supported");return new n}t.createHash=r;var n=class{constructor(){this.A=1779033703,this.B=-1150833019,this.C=1013904242,this.D=-1521486534,this.E=1359893119,this.F=-1694144372,this.G=528734635,this.H=1541459225,this._size=0,this._sp=0,(!s||o>=8e3)&&(s=new ArrayBuffer(8e3),o=0),this._byte=new Uint8Array(s,o,80),this._word=new Int32Array(s,o,20),o+=80}update(m){if(typeof m=="string")return this._utf8(m);if(m==null)throw new TypeError("Invalid type: "+typeof m);let F=m.byteOffset,g=m.byteLength,v=g/64|0,b=0;if(v&&!(F&3)&&!(this._size%64)){let E=new Int32Array(m.buffer,F,v*16);for(;v--;)this._int32(E,b>>2),b+=64;this._size+=b}if(m.BYTES_PER_ELEMENT!==1&&m.buffer){let E=new Uint8Array(m.buffer,F+b,g-b);return this._uint8(E)}return b===g?this:this._uint8(m,b)}_uint8(m,F){let{_byte:g,_word:v}=this,b=m.length;for(F=F|0;F<b;){let E=this._size%64,S=E;for(;F<b&&S<64;)g[S++]=m[F++];S>=64&&this._int32(v),this._size+=S-E}return this}_utf8(m){let{_byte:F,_word:g}=this,v=m.length,b=this._sp;for(let E=0;E<v;){let S=this._size%64,Z=S;for(;E<v&&Z<64;){let R=m.charCodeAt(E++)|0;R<128?F[Z++]=R:R<2048?(F[Z++]=192|R>>>6,F[Z++]=128|R&63):R<55296||R>57343?(F[Z++]=224|R>>>12,F[Z++]=128|R>>>6&63,F[Z++]=128|R&63):b?(R=((b&1023)<<10)+(R&1023)+65536,F[Z++]=240|R>>>18,F[Z++]=128|R>>>12&63,F[Z++]=128|R>>>6&63,F[Z++]=128|R&63,b=0):b=R}Z>=64&&(this._int32(g),g[0]=g[16]),this._size+=Z-S}return this._sp=b,this}_int32(m,F){let{A:g,B:v,C:b,D:E,E:S,F:Z,G:R,H:U}=this,K=0;for(F=F|0;K<16;)i[K++]=l(m[F++]);for(K=16;K<64;K++)i[K]=x(i[K-2])+i[K-7]+A(i[K-15])+i[K-16]|0;for(K=0;K<64;K++){let jt=U+d(S)+D(S,Z,R)+e[K]+i[K]|0,gs=f(g)+p(g,v,b)|0;U=R,R=Z,Z=S,S=E+jt|0,E=b,b=v,v=g,g=jt+gs|0}this.A=g+this.A|0,this.B=v+this.B|0,this.C=b+this.C|0,this.D=E+this.D|0,this.E=S+this.E|0,this.F=Z+this.F|0,this.G=R+this.G|0,this.H=U+this.H|0}digest(m){let{_byte:F,_word:g}=this,v=this._size%64|0;for(F[v++]=128;v&3;)F[v++]=0;if(v>>=2,v>14){for(;v<16;)g[v++]=0;v=0,this._int32(g)}for(;v<16;)g[v++]=0;let b=this._size*8,E=(b&4294967295)>>>0,S=(b-E)/4294967296;return S&&(g[14]=l(S)),E&&(g[15]=l(E)),this._int32(g),m==="hex"?this._hex():this._bin()}_hex(){let{A:m,B:F,C:g,D:v,E:b,F:E,G:S,H:Z}=this;return a(m)+a(F)+a(g)+a(v)+a(b)+a(E)+a(S)+a(Z)}_bin(){let{A:m,B:F,C:g,D:v,E:b,F:E,G:S,H:Z,_byte:R,_word:U}=this;return U[0]=l(m),U[1]=l(F),U[2]=l(g),U[3]=l(v),U[4]=l(b),U[5]=l(E),U[6]=l(S),U[7]=l(Z),R.slice(0,32)}};t.Hash=n;var i=new Int32Array(64),s,o=0,a=m=>(m+4294967296).toString(16).substr(-8),c=m=>m<<24&4278190080|m<<8&16711680|m>>8&65280|m>>24&255,h=m=>m,l=y()?h:c,D=(m,F,g)=>g^m&(F^g),p=(m,F,g)=>m&F|g&(m|F),f=m=>(m>>>2|m<<30)^(m>>>13|m<<19)^(m>>>22|m<<10),d=m=>(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7),A=m=>(m>>>7|m<<25)^(m>>>18|m<<14)^m>>>3,x=m=>(m>>>17|m<<15)^(m>>>19|m<<13)^m>>>10;function y(){return new Uint8Array(new Uint16Array([65279]).buffer)[0]===254}}),hi=pa(ma()),Aa=!0,{Hash:Ca,createHash:wa}=hi,{default:Xr,...Ea}=hi,ga=Xr!==void 0?Xr:Ea,nu={};Tr(nu,{CURVE:()=>J,ExtendedPoint:()=>yt,Point:()=>Ct,RistrettoPoint:()=>ku,getPublicKey:()=>Ta,sign:()=>Ra,utils:()=>Lu,verify:()=>Pa});var lt=BigInt(0),z=BigInt(1),_t=BigInt(2),Di=BigInt(255),Qr=_t**BigInt(252)+BigInt("27742317777372353535851937790883648493"),J={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:_t**Di-BigInt(19),l:Qr,n:Qr,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},fi=_t**BigInt(256),iu=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");var Fa=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),ya=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),ba=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Ba=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),dt=class{constructor(t,e,u,r){this.x=t,this.y=e,this.z=u,this.t=r}static fromAffine(t){if(!(t instanceof Ct))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return t.equals(Ct.ZERO)?dt.ZERO:new dt(t.x,t.y,z,C(t.x*t.y))}static toAffineBatch(t){let e=xa(t.map(u=>u.z));return t.map((u,r)=>u.toAffine(e[r]))}static normalizeZ(t){return this.toAffineBatch(t).map(this.fromAffine)}equals(t){Yr(t);let{x:e,y:u,z:r}=this,{x:n,y:i,z:s}=t,o=C(e*s),a=C(n*r),c=C(u*s),h=C(i*r);return o===a&&c===h}negate(){return new dt(C(-this.x),this.y,this.z,C(-this.t))}double(){let{x:t,y:e,z:u}=this,{a:r}=J,n=C(t**_t),i=C(e**_t),s=C(_t*C(u**_t)),o=C(r*n),a=C(C((t+e)**_t)-n-i),c=o+i,h=c-s,l=o-i,D=C(a*h),p=C(c*l),f=C(a*l),d=C(h*c);return new dt(D,p,d,f)}add(t){Yr(t);let{x:e,y:u,z:r,t:n}=this,{x:i,y:s,z:o,t:a}=t,c=C((u-e)*(s+i)),h=C((u+e)*(s-i)),l=C(h-c);if(l===lt)return this.double();let D=C(r*_t*a),p=C(n*_t*o),f=p+D,d=h+c,A=p-D,x=C(f*l),y=C(d*A),m=C(f*A),F=C(l*d);return new dt(x,y,F,m)}subtract(t){return this.add(t.negate())}precomputeWindow(t){let e=1+256/t,u=[],r=this,n=r;for(let i=0;i<e;i++){n=r,u.push(n);for(let s=1;s<2**(t-1);s++)n=n.add(r),u.push(n);r=n.double()}return u}wNAF(t,e){!e&&this.equals(dt.BASE)&&(e=Ct.BASE);let u=e&&e._WINDOW_SIZE||1;if(256%u)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let r=e&&mr.get(e);r||(r=this.precomputeWindow(u),e&&u!==1&&(r=dt.normalizeZ(r),mr.set(e,r)));let n=dt.ZERO,i=dt.ZERO,s=1+256/u,o=2**(u-1),a=BigInt(2**u-1),c=2**u,h=BigInt(u);for(let l=0;l<s;l++){let D=l*o,p=Number(t&a);if(t>>=h,p>o&&(p-=c,t+=z),p===0){let f=r[D];l%2&&(f=f.negate()),i=i.add(f)}else{let f=r[D+Math.abs(p)-1];p<0&&(f=f.negate()),n=n.add(f)}}return dt.normalizeZ([n,i])[0]}multiply(t,e){return this.wNAF(Tu(t,J.l),e)}multiplyUnsafe(t){let e=Tu(t,J.l,!1),u=dt.BASE,r=dt.ZERO;if(e===lt)return r;if(this.equals(r)||e===z)return this;if(this.equals(u))return this.wNAF(e);let n=r,i=this;for(;e>lt;)e&z&&(n=n.add(i)),i=i.double(),e>>=z;return n}isSmallOrder(){return this.multiplyUnsafe(J.h).equals(dt.ZERO)}isTorsionFree(){return this.multiplyUnsafe(J.l).equals(dt.ZERO)}toAffine(t=Nu(this.z)){let{x:e,y:u,z:r}=this,n=C(e*t),i=C(u*t);if(C(r*t)!==z)throw new Error("invZ was invalid");return new Ct(n,i)}fromRistrettoBytes(){Xu()}toRistrettoBytes(){Xu()}fromRistrettoHash(){Xu()}},yt=dt;yt.BASE=new dt(J.Gx,J.Gy,z,C(J.Gx*J.Gy)),yt.ZERO=new dt(lt,z,z,lt);function Yr(t){if(!(t instanceof yt))throw new TypeError("ExtendedPoint expected")}function Zu(t){if(!(t instanceof ku))throw new TypeError("RistrettoPoint expected")}function Xu(){throw new Error("Legacy method: switch to RistrettoPoint")}var se=class{constructor(t){this.ep=t}static calcElligatorRistrettoMap(t){let{d:e}=J,u=C(iu*t*t),r=C((u+z)*ba),n=BigInt(-1),i=C((n-e*u)*C(u+e)),{isValid:s,value:o}=Rr(r,i),a=C(o*t);fe(a)||(a=C(-a)),s||(o=a),s||(n=u);let c=C(n*(u-z)*Ba-i),h=o*o,l=C((o+o)*i),D=C(c*Fa),p=C(z-h),f=C(z+h);return new yt(C(l*f),C(p*D),C(D*f),C(l*p))}static hashToCurve(t){t=me(t,64);let e=Qu(t.slice(0,32)),u=this.calcElligatorRistrettoMap(e),r=Qu(t.slice(32,64)),n=this.calcElligatorRistrettoMap(r);return new se(u.add(n))}static fromHex(t){t=me(t,32);let{a:e,d:u}=J,r="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",n=Qu(t);if(!ka(du(n),t)||fe(n))throw new Error(r);let i=C(n*n),s=C(z+e*i),o=C(z-e*i),a=C(s*s),c=C(o*o),h=C(e*u*a-c),{isValid:l,value:D}=Jr(C(h*c)),p=C(D*o),f=C(D*p*h),d=C((n+n)*p);fe(d)&&(d=C(-d));let A=C(s*f),x=C(d*A);if(!l||fe(x)||A===lt)throw new Error(r);return new se(new yt(d,A,z,x))}toRawBytes(){let{x:t,y:e,z:u,t:r}=this.ep,n=C(C(u+e)*C(u-e)),i=C(t*e),{value:s}=Jr(C(n*i**_t)),o=C(s*n),a=C(s*i),c=C(o*a*r),h;if(fe(r*c)){let D=C(e*iu),p=C(t*iu);t=D,e=p,h=C(o*ya)}else h=a;fe(t*c)&&(e=C(-e));let l=C((u-e)*h);return fe(l)&&(l=C(-l)),du(l)}toHex(){return wu(this.toRawBytes())}toString(){return this.toHex()}equals(t){Zu(t);let e=this.ep,u=t.ep,r=C(e.x*u.y)===C(e.y*u.x),n=C(e.y*u.y)===C(e.x*u.x);return r||n}add(t){return Zu(t),new se(this.ep.add(t.ep))}subtract(t){return Zu(t),new se(this.ep.subtract(t.ep))}multiply(t){return new se(this.ep.multiply(t))}multiplyUnsafe(t){return new se(this.ep.multiplyUnsafe(t))}},ku=se;ku.BASE=new se(yt.BASE),ku.ZERO=new se(yt.ZERO);var mr=new WeakMap,fu=class{constructor(t,e){this.x=t,this.y=e}_setWindowSize(t){this._WINDOW_SIZE=t,mr.delete(this)}static fromHex(t,e=!0){let{d:u,P:r}=J;t=me(t,32);let n=t.slice();n[31]=t[31]&-129;let i=Ke(n);if(e&&i>=r)throw new Error("Expected 0 < hex < P");if(!e&&i>=fi)throw new Error("Expected 0 < hex < 2**256");let s=C(i*i),o=C(s-z),a=C(u*s+z),{isValid:c,value:h}=Rr(o,a);if(!c)throw new Error("Point.fromHex: invalid y coordinate");let l=(h&z)===z;return(t[31]&128)!==0!==l&&(h=C(-h)),new fu(h,i)}static async fromPrivateKey(t){return(await Uu(t)).point}toRawBytes(){let t=du(this.y);return t[31]|=this.x&z?128:0,t}toHex(){return wu(this.toRawBytes())}toX25519(){let{y:t}=this,e=C((z+t)*Nu(z-t));return du(e)}isTorsionFree(){return yt.fromAffine(this).isTorsionFree()}equals(t){return this.x===t.x&&this.y===t.y}negate(){return new fu(C(-this.x),this.y)}add(t){return yt.fromAffine(this).add(yt.fromAffine(t)).toAffine()}subtract(t){return this.add(t.negate())}multiply(t){return yt.fromAffine(this).multiply(t,this).toAffine()}},Ct=fu;Ct.BASE=new fu(J.Gx,J.Gy),Ct.ZERO=new fu(lt,z);var Iu=class{constructor(t,e){this.r=t,this.s=e,this.assertValidity()}static fromHex(t){let e=me(t,64),u=Ct.fromHex(e.slice(0,32),!1),r=Ke(e.slice(32,64));return new Iu(u,r)}assertValidity(){let{r:t,s:e}=this;if(!(t instanceof Ct))throw new Error("Expected Point instance");return Tu(e,J.l,!1),this}toRawBytes(){let t=new Uint8Array(64);return t.set(this.r.toRawBytes()),t.set(du(this.s),32),t}toHex(){return wu(this.toRawBytes())}};function va(...t){if(!t.every(r=>r instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(t.length===1)return t[0];let e=t.reduce((r,n)=>r+n.length,0),u=new Uint8Array(e);for(let r=0,n=0;r<t.length;r++){let i=t[r];u.set(i,n),n+=i.length}return u}var _a=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function wu(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let u=0;u<t.length;u++)e+=_a[t[u]];return e}function di(t){if(typeof t!="string")throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex");let e=new Uint8Array(t.length/2);for(let u=0;u<e.length;u++){let r=u*2,n=t.slice(r,r+2),i=Number.parseInt(n,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");e[u]=i}return e}function pi(t){let e=t.toString(16).padStart(64,"0");return di(e)}function du(t){return pi(t).reverse()}function fe(t){return(C(t)&z)===z}function Ke(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+wu(Uint8Array.from(t).reverse()))}function Qu(t){return C(Ke(t)&_t**Di-z)}function C(t,e=J.P){let u=t%e;return u>=lt?u:e+u}function Nu(t,e=J.P){if(t===lt||e<=lt)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let u=C(t,e),r=e,n=lt,i=z;for(;u!==lt;){let s=r/u,o=r%u,a=n-i*s;r=u,u=o,n=i,i=a}if(r!==z)throw new Error("invert: does not exist");return C(n,e)}function xa(t,e=J.P){let u=new Array(t.length),r=t.reduce((i,s,o)=>s===lt?i:(u[o]=i,C(i*s,e)),z),n=Nu(r,e);return t.reduceRight((i,s,o)=>s===lt?i:(u[o]=C(i*u[o],e),C(i*s,e)),n),u}function Wt(t,e){let{P:u}=J,r=t;for(;e-- >lt;)r*=r,r%=u;return r}function Sa(t){let{P:e}=J,u=BigInt(5),r=BigInt(10),n=BigInt(20),i=BigInt(40),s=BigInt(80),o=t*t%e*t%e,a=Wt(o,_t)*o%e,c=Wt(a,z)*t%e,h=Wt(c,u)*c%e,l=Wt(h,r)*h%e,D=Wt(l,n)*l%e,p=Wt(D,i)*D%e,f=Wt(p,s)*p%e,d=Wt(f,s)*p%e,A=Wt(d,r)*h%e;return{pow_p_5_8:Wt(A,_t)*t%e,b2:o}}function Rr(t,e){let u=C(e*e*e),r=C(u*u*e),n=Sa(t*r).pow_p_5_8,i=C(t*u*n),s=C(e*i*i),o=i,a=C(i*iu),c=s===t,h=s===C(-t),l=s===C(-t*iu);return c&&(i=o),(h||l)&&(i=a),fe(i)&&(i=C(-i)),{isValid:c||h,value:i}}function Jr(t){return Rr(z,t)}async function Ar(...t){let e=await Lu.sha512(va(...t)),u=Ke(e);return C(u,J.l)}function ka(t,e){if(t.length!==e.length)return!1;for(let u=0;u<t.length;u++)if(t[u]!==e[u])return!1;return!0}function me(t,e){let u=t instanceof Uint8Array?Uint8Array.from(t):di(t);if(typeof e=="number"&&u.length!==e)throw new Error(`Expected ${e} bytes`);return u}function Tu(t,e,u=!0){if(!e)throw new TypeError("Specify max value");if(typeof t=="number"&&Number.isSafeInteger(t)&&(t=BigInt(t)),typeof t=="bigint"&&t<e){if(u){if(lt<t)return t}else if(lt<=t)return t}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function Ia(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}async function Uu(t){if(t=typeof t=="bigint"||typeof t=="number"?pi(Tu(t,fi)):me(t),t.length!==32)throw new Error("Expected 32 bytes");let e=await Lu.sha512(t),u=Ia(e.slice(0,32)),r=e.slice(32,64),n=C(Ke(u),J.l),i=Ct.BASE.multiply(n),s=i.toRawBytes();return{head:u,prefix:r,scalar:n,point:i,pointBytes:s}}async function Ta(t){return(await Uu(t)).pointBytes}async function Ra(t,e){t=me(t);let{prefix:u,scalar:r,pointBytes:n}=await Uu(e),i=await Ar(u,t),s=Ct.BASE.multiply(i),o=await Ar(s.toRawBytes(),n,t),a=C(i+o*r,J.l);return new Iu(s,a).toRawBytes()}async function Pa(t,e,u){e=me(e),u instanceof Ct||(u=Ct.fromHex(u,!1));let{r,s:n}=t instanceof Iu?t.assertValidity():Iu.fromHex(t),i=yt.BASE.multiplyUnsafe(n),s=await Ar(r.toRawBytes(),u.toRawBytes(),e),o=yt.fromAffine(u).multiplyUnsafe(s);return yt.fromAffine(r).add(o).subtract(i).multiplyUnsafe(J.h).equals(yt.ZERO)}Ct.BASE._setWindowSize(8);var Lu={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:wu,getExtendedPublicKey:Uu,mod:C,invert:Nu,hashToPrivateScalar:t=>{if(t=me(t),t.length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");let e=C(Ke(t),J.l);if(e===lt||e===z)throw new Error("Invalid private key");return e},randomBytes:(t=32)=>crypto.getRandomValues(new Uint8Array(t)),randomPrivateKey:()=>Lu.randomBytes(32),sha512:async t=>{let e=await crypto.subtle.digest("SHA-512",t.buffer);return new Uint8Array(e)},precompute(t=8,e=Ct.BASE){let u=e.equals(Ct.BASE)?e:new Ct(e.x,e.y);return u._setWindowSize(t),u.multiply(_t),u}},rt=11400714785074694791n,Dt=14029467366897019727n,tn=1609587929392839161n,Ye=9650029242287828579n,en=2870177450012600261n,mi=64n,$a=2n**mi-1n,Oa=new TextEncoder;function un(t,e,u,r){return BigInt(t)|BigInt(e)<<16n|BigInt(u)<<32n|BigInt(r)<<48n}function Yt(t,e){return BigInt(t[e])|BigInt(t[e+1])<<8n|BigInt(t[e+2])<<16n|BigInt(t[e+3])<<24n|BigInt(t[e+4])<<32n|BigInt(t[e+5])<<40n|BigInt(t[e+6])<<48n|BigInt(t[e+7])<<56n}function at(t,e){return t<<e&$a|t>>mi-e}function H(t){return BigInt.asUintN(64,t)}var qt,Kt,Vt,Gt,Zt,Xt,ve,gt,ei,Ha=(ei=class{constructor(t=0){Qt(this,qt,void 0);Qt(this,Kt,void 0);Qt(this,Vt,void 0);Qt(this,Gt,void 0);Qt(this,Zt,void 0);Qt(this,Xt,void 0);Qt(this,ve,void 0);Qt(this,gt,void 0);this.reset(t)}reset(t=L(this,qt)){return ut(this,qt,BigInt.asUintN(32,BigInt(t))),ut(this,Kt,H(L(this,qt)+rt+Dt)),ut(this,Vt,H(L(this,qt)+Dt)),ut(this,Gt,L(this,qt)),ut(this,Zt,H(L(this,qt)-rt)),ut(this,Xt,null),ut(this,ve,0),ut(this,gt,0),this}update(t){typeof t=="string"&&(t=Oa.encode(t));let e=0,u=t.length,r=e+u;if(u===0)return this;if(ut(this,ve,L(this,ve)+u),L(this,gt)===0&&ut(this,Xt,new Uint8Array(32)),L(this,gt)+u<32)return L(this,Xt).set(t.subarray(0,u),L(this,gt)),ut(this,gt,L(this,gt)+u),this;if(L(this,gt)>0){L(this,Xt).set(t.subarray(0,32-L(this,gt)),L(this,gt));let n=0,i;i=Yt(L(this,Xt),n),ut(this,Kt,H(at(H(L(this,Kt)+i*Dt),31n)*rt)),n+=8,i=Yt(this.memory,n),ut(this,Vt,H(at(H(L(this,Vt)+i*Dt),31n)*rt)),n+=8,i=Yt(this.memory,n),ut(this,Gt,H(at(H(L(this,Gt)+i*Dt),31n)*rt)),n+=8,i=Yt(this.memory,n),ut(this,Zt,H(at(H(L(this,Zt)+i*Dt),31n)*rt)),e+=32-L(this,gt),ut(this,gt,0)}if(e<=r-32){let n=r-32;do{let i;i=Yt(t,e),ut(this,Kt,H(at(H(L(this,Kt)+i*Dt),31n)*rt)),e+=8,i=Yt(t,e),ut(this,Vt,H(at(H(L(this,Vt)+i*Dt),31n)*rt)),e+=8,i=Yt(t,e),ut(this,Gt,H(at(H(L(this,Gt)+i*Dt),31n)*rt)),e+=8,i=Yt(t,e),ut(this,Zt,H(at(H(L(this,Zt)+i*Dt),31n)*rt)),e+=8}while(e<=n)}return e<r&&(L(this,Xt).set(t.subarray(e,r),L(this,gt)),ut(this,gt,r-e)),this}digest(){let t=L(this,Xt),e=L(this,gt),u=0,r=0n,n=0n,i=0n;for(L(this,ve)>=32?(r=at(L(this,Kt),1n)+at(L(this,Vt),7n)+at(L(this,Gt),12n)+at(L(this,Zt),18n),r=H(r^at(H(L(this,Kt)*Dt),31n)*rt),r=H(r*rt+Ye),r=H(r^at(H(L(this,Vt)*Dt),31n)*rt),r=H(r*rt+Ye),r=H(r^at(H(L(this,Gt)*Dt),31n)*rt),r=H(r*rt+Ye),r=H(r^at(H(L(this,Zt)*Dt),31n)*rt),r=H(r*rt+Ye)):r=H(L(this,qt)+en),r+=BigInt(L(this,ve));u<=e-8;)i=Yt(t,u),i=H(at(H(i*Dt),31n)*rt),r=H(at(r^i,27n)*rt+Ye),u+=8;for(u+4<=e&&(i=un(t[u+1]<<8|t[u],t[u+3]<<8|t[u+2],0,0),r=H(at(r^H(i*rt),23n)*Dt+tn),u+=4);u<e;)i=un(t[u++],0,0,0),r=H(at(r^H(i*en),11n)*rt);return n=H(r>>33n),r=H((r^n)*Dt),n=H(r>>29n),r=H((r^n)*tn),n=H(r>>32n),r=H(r^n),r}},qt=new WeakMap,Kt=new WeakMap,Vt=new WeakMap,Gt=new WeakMap,Zt=new WeakMap,Xt=new WeakMap,ve=new WeakMap,gt=new WeakMap,ei);function Na(t,e=0){return new Ha(e).update(t).digest()}function G(){let t,e="pending",u=new Promise((r,n)=>{t={async resolve(i){await i,e="fulfilled",r(i)},reject(i){e="rejected",n(i)}}});return Object.defineProperty(u,"state",{get:()=>e}),Object.assign(u,t)}new TextDecoder;var Ua=new TextEncoder;function Cr(t){return Ua.encode(t)}function La(t){return Cr(t).length}function wr(t,e){for(let u of t)if(e.indexOf(u)===-1)return!1;return!0}function rn(t){return t===""?!1:Eu.indexOf(t)!==-1}var Ve="abcdefghijklmnopqrstuvwxyz",Ma=Ve.toUpperCase(),Eu="0123456789",ce=Ve+"234567",Ai=Ve+Eu,ja=ce,Ci=Ai+ce+"@.",wi=Ve+Eu,Wa=Ve+Eu,Ei=wi+ce+"+.",za="/'()-._~!$&+,:=@%",gi=Ve+Ma+Eu+za;function qa(t,e){return`@${t}.${e}`}function Ka(t,e){return`+${t}.${e}`}function Pr(t){let e=Fi(t);return ni(e)?!0:e}function gu(t){let e=yi(t);return ni(e)?!0:e}function Er(t){return t.startsWith("@")?Fi(t):t.startsWith("+")?yi(t):new B("address must start with either @ or +")}function Fi(t){return bi(t,{sigil:"@",separator:".",minNameLength:4,maxNameLength:4,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:Ai,allowedPubkeyCharacters:ja,pubkeyMustStartWithB:!0})}function yi(t){return bi(t,{sigil:"+",separator:".",minNameLength:1,maxNameLength:15,minPubkeyLength:1,maxPubkeyLength:53,allowedNameCharacters:wi,allowedPubkeyCharacters:Wa,pubkeyMustStartWithB:!1})}function bi(t,e){let{sigil:u,separator:r,minNameLength:n,maxNameLength:i,minPubkeyLength:s,maxPubkeyLength:o,allowedNameCharacters:a,allowedPubkeyCharacters:c,pubkeyMustStartWithB:h}=e;if(typeof t!="string")return new B("address must be a string");if(t.length<4)return new B("address is too short");if(t[0]!==u)return new B(`address must start with a sigil: "${u}"`);if(t.indexOf(r)===-1)return new B(`address must contain a separator character: "${r}"`);let l=t.slice(1).split(r);if(l.length!==2)return new B(`address must have exactly 2 parts separated by a "${r}" separator`);let[D,p]=l;return D.length<n||D.length>i?new B(`name must be between ${n} and ${i} characters long, but is ${D.length}`):p.length<s||p.length>o?new B(`pubkey must be between ${s} and ${o} characters long, but is ${p.length}`):wr(D,a)?wr(p,c)?rn(D[0])?new B(`name "${D}" must not start with a digit`):rn(p[0])?new B(`pubkey "${p}" must not start with a digit`):h&&p[0]!=="b"?new B(`pubkey "${p}" must start with 'b'`):{address:t,name:D,pubkey:p}:new B(`pubkey "${p}" must only have allowed characters`):new B(`name "${D}" must only have allowed characters`)}function $r(t){return!(Object.prototype.toString.call(t)!=="[object Object]"||(""+t.constructor).startsWith("class"))}function Bi(t){return e=>e!==t?`expected literal value ${JSON.stringify(t)}`:null}function kt(t={}){return e=>{if(t.optional!==!0&&e===void 0)return"required";if(t.optional===!0&&e===void 0)return null;let u=La(e);return typeof e!="string"?"expected a string but got "+JSON.stringify(e):t.minLen!==void 0&&u<t.minLen?`string shorter than min length of ${t.minLen} chars`:t.maxLen!==void 0&&u>t.maxLen?`string shorter than max length of ${t.maxLen} chars`:t.len!==void 0&&u!==t.len?`string does not have required length of ${t.len} chars: ${e}`:t.allowedChars!==void 0&&!wr(e,t.allowedChars)?"contains disallowed characters":null}}function su(t={}){return e=>t.optional!==!0&&e===void 0?"required":t.optional===!0&&e===void 0?null:t.nullable!==!0&&e===null?"not nullable":t.nullable===!0&&e===null?null:typeof e!="number"?"expected a number but got "+JSON.stringify(e):isNaN(e)?"is NaN":isFinite(e)?e!==Math.round(e)?"expected an integer":t.min!==void 0&&e<t.min?`integer too small (must be >= ${t.min})`:t.max!==void 0&&e>t.max?`integer too large (must be <= ${t.max})`:null:"is Infinity"}function vi(t={}){return t.allowLiteralUndefined=t.allowLiteralUndefined??!1,t.allowExtraKeys=t.allowExtraKeys??!1,e=>{if(!$r(e))return"expected an object";if(t.allowLiteralUndefined===!1){for(let[u,r]of Object.entries(e))if(r===void 0)return`${u} is explicitly set to undefined but should be missing instead`}if(t.objSchema!==void 0){if(t.allowExtraKeys===!1){let u=Object.keys(e),r=Object.keys(t.objSchema),n=u.filter(i=>r.indexOf(i)===-1);if(n.length>0)return`object has extra keys not in the schema: ${n.join(", ")}`}for(let[u,r]of Object.entries(t.objSchema)){let n=r(e[u]);if(n!==null)return`${u}: ${n}`}}return null}}var{codec:_i}=ai,xi={chars:"abcdefghijklmnopqrstuvwxyz234567",bits:5};function Te(t){return"b"+_i.stringify(t,xi,{pad:!1})}function Ru(t){if(!t.startsWith("b"))throw new B("can't decode base32 string - it should start with a 'b'. "+t);if(t[t.length-1]==="=")throw new B("can't decode base32 string - it contains padding characters ('=')");return _i.parse(t.slice(1),xi,{loose:!0})}var Va=(t=>(t[t.None=-1]="None",t[t.Error=0]="Error",t[t.Warn=1]="Warn",t[t.Log=2]="Log",t[t.Info=3]="Info",t[t.Debug=4]="Debug",t))(Va||{}),Ga=0,Yu={_default:Ga};function Za(t){return t in Yu?Yu[t]:Yu._default}var bt=class{constructor(e,u){this.color=void 0,this.source=e,this.color=u||"aqua"}_print(e,u,r,...n){if(e<=Za(this.source))if(u){let i=`[${this.source}]`;if(this.color!==void 0){let s=[`%c ${i}`,`color: ${this.color}`];console.log(r,...s,...n)}else console.log(r,i,...n)}else console.log(r,...n)}error(...e){this._print(0,!0,"!!",...e)}warn(...e){this._print(1,!0,"! ",...e)}log(...e){this._print(2,!0,"  ",...e)}info(...e){this._print(3,!0,"    ",...e)}debug(...e){this._print(4,!0,"      ",...e)}blank(){this._print(3,!1,"")}},Xa=class{constructor(t){this.hash=t.hash,this.internalUpdate=t.update,this.internalDigest=t.digest}update(t){return this.hash=this.internalUpdate(this.hash,t),this.hash}digest(){return this.internalDigest(this.hash)}},{createHash:Ju}=ci,tr=new bt("crypto-driver-noble","cyan"),Qa=class{static sha256(t){return typeof t=="string"?Promise.resolve(Ju("sha256").update(t,"utf-8").digest()):Promise.resolve(Ju("sha256").update(t).digest())}static updatableSha256(){return new Xa({hash:Ju("sha256"),update:(t,e)=>t.update(e),digest:t=>t.digest()})}static async generateKeypairBytes(){tr.debug("generateKeypairBytes");let t=nu.utils.randomPrivateKey();return{pubkey:await nu.getPublicKey(t),secret:t}}static sign(t,e){return tr.debug("sign"),typeof e=="string"&&(e=Cr(e)),nu.sign(e,t.secret)}static async verify(t,e,u){tr.debug("verify");try{return typeof u=="string"&&(u=Cr(u)),await nu.verify(e,u,t)}catch{return!1}}};function nn(){return Date.now()*1e3}function Si(t){return new Promise(e=>{setTimeout(e,t)})}function Or(){return""+Math.floor(Math.random()*1e3)+Math.floor(Math.random()*1e3)}function Ya(t){try{let e=ki(t)?t.address:t.shareAddress,u=Er(e);if(k(u))return u;let r={pubkey:Ru(u.pubkey),secret:Ru(t.secret)};return r.pubkey.length!==32?new B(`pubkey bytes should be 32 bytes long, not ${r.pubkey.length} after base32 decoding.  ${e}`):r.secret.length!==32?new B(`secret bytes should be 32 bytes long, not ${r.secret.length} after base32 decoding.  ${t.secret}`):r}catch(e){return new B("crash while decoding author keypair: "+e.message)}}function ki(t){return"address"in t}var Ja=Qa;new bt("crypto","cyan");var Re=Ja,Je=new bt("crypto","cyan"),pt=class{static async sha256base32(e){let u=await Re.sha256(e);return Te(u)}static updatableSha256(){return Re.updatableSha256()}static async generateAuthorKeypair(e){Je.debug(`generateAuthorKeypair("${e}")`);let u=await Re.generateKeypairBytes(),r={address:qa(e,Te(u.pubkey)),secret:Te(u.secret)},n=Pr(r.address);return k(n)?n:r}static async generateShareKeypair(e){Je.debug(`generateAuthorKeypair("${e}")`);let u=await Re.generateKeypairBytes(),r={shareAddress:Ka(e,Te(u.pubkey)),secret:Te(u.secret)},n=gu(r.shareAddress);return k(n)?n:r}static async sign(e,u){Je.debug("sign");try{let r=Ya(e);if(k(r))return r;let n=await Re.sign(r,u);return Te(n)}catch(r){return new B("unexpected error while signing: "+r.message)}}static verify(e,u,r){Je.debug("verify");try{let n=Er(e);return k(n)?Promise.resolve(!1):Re.verify(Ru(n.pubkey),Ru(u),r)}catch{return Promise.resolve(!1)}}static async checkKeypairIsValid(e){Je.debug("checkAuthorKeypairIsValid");let u=ki(e)?e.address:e.shareAddress;try{if(typeof u!="string"||typeof e.secret!="string")return new B("address and secret must be strings");let r=Er(u);if(k(r))return r;let n="a test message to sign. "+Or(),i=await this.sign(e,n);return k(i)?i:await this.verify(u,i,n)===!1?new B("pubkey does not match secret"):!0}catch(r){return new B("unexpected error in checkAuthorKeypairIsValid: "+r.message)}}};new bt("validator es.4","red");var to=10,eo=to*60*1e3*1e3,sn=1e13,an=9007199254740990,uo=4e6,ro=53,no=104,on={objSchema:{format:Bi("es.4"),author:kt({allowedChars:Ci}),content:kt({maxLen:uo}),contentHash:kt({allowedChars:ce,len:ro}),deleteAfter:su({min:sn,max:an,nullable:!0}),path:kt({allowedChars:gi,minLen:2,maxLen:512}),signature:kt({allowedChars:ce,len:no}),timestamp:su({min:sn,max:an}),workspace:kt({allowedChars:Ei})},allowLiteralUndefined:!1,allowExtraKeys:!1},er;er=class{static hashDocument(t){let e={...t,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},u=this._checkBasicDocumentValidity(e);return k(u)?Promise.resolve(u):pt.sha256base32(`author	${t.author}
contentHash	${t.contentHash}
`+(t.deleteAfter===null?"":`deleteAfter	${t.deleteAfter}
`)+`format	${t.format}
path	${t.path}
timestamp	${t.timestamp}
workspace	${t.workspace}
`)}static async generateDocument({input:t,keypair:e,share:u,timestamp:r}){let n={format:"es.4",author:e.address,content:t.content,contentHash:await pt.sha256base32(t.content),deleteAfter:t.deleteAfter??null,path:t.path,timestamp:r,workspace:u,signature:"?"},i=await this.signDocument(e,n);return k(i)?i:{doc:i}}static async signDocument(t,e){let u=await this.hashDocument(e);if(k(u))return u;let r=await pt.sign(t,u);return k(r)?r:{...e,signature:r}}static async wipeDocument(t,e){if(e.content.length===0)return e;let u=this.removeExtraFields(e);if(k(u))return u;let r={...u.doc,content:"",contentHash:await pt.sha256base32(""),signature:"?"};return this.signDocument(t,r)}static removeExtraFields(t){if(!$r(t))return new B("doc is not a plain javascript object");let e=new Set(Object.keys(on.objSchema||{})),u={},r={};for(let[n,i]of Object.entries(t))if(e.has(n))u[n]=i;else{if(!n.startsWith("_"))return new B("extra document fields must have names starting with an underscore");r[n]=i}return{doc:u,extras:r}}static async checkDocumentIsValid(t,e){e===void 0&&(e=Date.now()*1e3);let u=this._checkBasicDocumentValidity(t);if(k(u))return u;let r=this._checkTimestampIsOk(t.timestamp,t.deleteAfter,e);if(k(r))return r;let n=this._checkAuthorCanWriteToPath(t.author,t.path);if(k(n))return n;let i=this._checkPathIsValid(t.path,t.deleteAfter);if(k(i))return i;let s=Pr(t.author);if(k(s))return s;let o=gu(t.workspace);if(k(o))return o;let a=await this._checkAuthorSignatureIsValid(t);if(k(a))return a;let c=await this._checkContentMatchesHash(t.content,t.contentHash);return k(c)?c:!0}static _checkBasicDocumentValidity(t){let e=vi(on)(t);return e!==null?new B(e):!0}static _checkAuthorCanWriteToPath(t,e){return e.indexOf("~")===-1||e.indexOf("~"+t)!==-1?!0:new B(`author ${t} can't write to path ${e}`)}static _checkTimestampIsOk(t,e,u){if(t>u+eo)return new B("timestamp too far in the future");if(e!==null){if(u>e)return new B("ephemeral doc has expired");if(e<=t)return new B("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(t,e){if(!t.startsWith("/"))return new B("invalid path: must start with /");if(t.endsWith("/"))return new B("invalid path: must not end with /");if(t.startsWith("/@"))return new B('invalid path: must not start with "/@"');if(t.indexOf("//")!==-1)return new B("invalid path: must not contain two consecutive slashes");if(e!==void 0){if(t.indexOf("!")===-1&&e!==null)return new B("when deleteAfter is set, path must contain '!'");if(t.indexOf("!")!==-1&&e===null)return new B("when deleteAfter is null, path must not contain '!'")}return!0}static async _checkAuthorSignatureIsValid(t){try{let e=await this.hashDocument(t);return k(e)?e:await pt.verify(t.author,t.signature,e)!==!0?new B("signature is invalid"):!0}catch{return new B("signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(t,e){return await pt.sha256base32(t)!==e?new B("content does not match contentHash"):!0}static getAttachmentInfo(t){return new B("es.4 does not support attachments")}static updateAttachmentFields(t,e,u,r){return Promise.resolve(new B("es.4 does not support attachments"))}static authorFromCredentials(t){return t.address}},er.id="es.4";new bt("validator es.5","red");var io=10,so=io*60*1e3*1e3,cn=1e13,ln=9007199254740990,ao=8e3,hn=53,Dn=104,oo=0,co=Number.MAX_SAFE_INTEGER,fn={objSchema:{format:Bi("es.5"),author:kt({allowedChars:Ci}),text:kt({maxLen:ao}),textHash:kt({allowedChars:ce,len:hn}),deleteAfter:su({min:cn,max:ln,optional:!0}),path:kt({allowedChars:gi,minLen:2,maxLen:512}),signature:kt({allowedChars:ce,len:Dn}),shareSignature:kt({allowedChars:ce,len:Dn}),timestamp:su({min:cn,max:ln}),share:kt({allowedChars:Ei}),attachmentSize:su({min:oo,max:co,optional:!0}),attachmentHash:kt({allowedChars:ce,len:hn,optional:!0})},allowLiteralUndefined:!1,allowExtraKeys:!1},ur,lo=(ur=class{static hashDocument(t){let e={...t,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",shareSignature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},u=this._checkBasicDocumentValidity(e);return k(u)?Promise.resolve(u):pt.sha256base32((t.attachmentHash===void 0?"":`attachmentHash	${t.attachmentHash}
`)+(t.attachmentSize===void 0?"":`attachmentSize	${t.attachmentSize}
`)+`author	${t.author}
`+(t.deleteAfter===void 0?"":`deleteAfter	${t.deleteAfter}
`)+`format	${t.format}
path	${t.path}
textHash	${t.textHash}
timestamp	${t.timestamp}
share	${t.share}
`)}static async generateDocument({input:t,keypair:e,share:u,timestamp:r,prevLatestDoc:n,config:i}){if(t.text===void 0&&(n==null?void 0:n.text)===void 0)return new B("Couldn't determine document text from given input or previous version's text.");let s=t.text!==void 0?t.text:n==null?void 0:n.text,o={...n,format:"es.5",author:e.address,text:s,textHash:await pt.sha256base32(s),path:t.path,timestamp:r,share:u,signature:"?",shareSignature:"?"};t.deleteAfter&&(o.deleteAfter=t.deleteAfter);let a=await this.signDocument(e,o,i);return k(a)?a:t.attachment?{doc:a,attachment:t.attachment}:{doc:a}}static async signDocument(t,e,u){let r=await this.hashDocument(e);if(k(r))return r;let n=await pt.sign(t,r);if(u.shareSecret===void 0)return new Mt(`Tried to write a document to ${e.share} without the secret.`);let i=await pt.sign({shareAddress:e.share,secret:u.shareSecret},r);return k(n)?n:k(i)?i:{...e,signature:n,shareSignature:i}}static async wipeDocument(t,e,u){if(e.text.length===0)return e;let r=this.removeExtraFields(e);if(k(r))return r;let n=r.doc;if(n.attachmentHash){let s={...n,text:"",textHash:await pt.sha256base32(""),signature:"?",shareSignature:"?",attachmentHash:await pt.sha256base32(""),attachmentSize:0};return this.signDocument(t,s,u)}let i={...n,text:"",textHash:await pt.sha256base32(""),signature:"?",shareSignature:"?"};return this.signDocument(t,i,u)}static removeExtraFields(t){if(!$r(t))return new B("doc is not a plain javascript object");let e=new Set(Object.keys(fn.objSchema||{})),u={},r={};for(let[n,i]of Object.entries(t))if(e.has(n))u[n]=i;else{if(!n.startsWith("_"))return new B("extra document fields must have names starting with an underscore");r[n]=i}return{doc:u,extras:r}}static async checkDocumentIsValid(t,e){e===void 0&&(e=Date.now()*1e3);let u=this._checkBasicDocumentValidity(t);if(k(u))return u;let r=this._checkTimestampIsOk(t.timestamp,t.deleteAfter?t.deleteAfter:null,e);if(k(r))return r;let n=this._checkAuthorCanWriteToPath(t.author,t.path);if(k(n))return n;let i=this._checkAttachmentFieldsConsistent(t);if(k(i))return i;let s=this._checkPathIsValid(t.path,!!t.attachmentHash,t.deleteAfter);if(k(s))return s;let o=Pr(t.author);if(k(o))return o;let a=gu(t.share);if(k(a))return a;let c=await this._checkAuthorSignatureIsValid(t);if(k(c))return c;let h=await this._checkShareSignatureIsValid(t);if(k(h))return h;let l=await this._checkContentMatchesHash(t.text,t.textHash);return k(l)?l:!0}static _checkBasicDocumentValidity(t){let e=vi(fn)(t);return e!==null?new B(e):!0}static _checkAttachmentFieldsConsistent(t){return t.text.length===0&&t.attachmentSize&&t.attachmentSize>0?new B("Documents with attachments must have text."):(t.text.length>0&&t.attachmentSize&&t.attachmentSize,t.attachmentHash&&t.attachmentSize===void 0?new B("Attachment size is undefined while attachment hash is defined"):t.attachmentSize&&t.attachmentHash===void 0?new B("Attachment hash is undefined while attachment size is defined"):!0)}static _checkAuthorCanWriteToPath(t,e){return e.indexOf("~")===-1||e.indexOf("~"+t)!==-1?!0:new B(`author ${t} can't write to path ${e}`)}static _checkTimestampIsOk(t,e,u){if(t>u+so)return new B("timestamp too far in the future");if(e!==null){if(u>e)return new B("ephemeral doc has expired");if(e<=t)return new B("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(t,e,u){if(!t.startsWith("/"))return new B("invalid path: must start with /");if(t.endsWith("/"))return new B("invalid path: must not end with /");if(t.startsWith("/@"))return new B('invalid path: must not start with "/@"');if(t.indexOf("//")!==-1)return new B("invalid path: must not contain two consecutive slashes");if(u!==void 0){if(t.indexOf("!")===-1&&u!==null)return new B("when deleteAfter is set, path must contain '!'");if(t.indexOf("!")!==-1&&u===null)return new B("when deleteAfter is null, path must not contain '!'")}return!dn(t)&&e?new B("when a attachment is provided, the path must end with a file extension"):dn(t)&&e===!1?new B("when no attachment is provided, the path cannot end with a file extension"):!0}static async _checkAuthorSignatureIsValid(t){try{let e=await this.hashDocument(t);return k(e)?e:await pt.verify(t.author,t.signature,e)!==!0?new B("signature is invalid"):!0}catch{return new B("signature is invalid (unexpected exception)")}}static async _checkShareSignatureIsValid(t){try{let e=await this.hashDocument(t);return k(e)?e:await pt.verify(t.share,t.shareSignature,e)!==!0?new B("share signature is invalid"):!0}catch{return new B("share signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(t,e){return await pt.sha256base32(t)!==e?new B("content does not match contentHash"):!0}static getAttachmentInfo(t){return t.attachmentHash&&t.attachmentSize===0?new B("This document has had its attachment wiped"):!t.attachmentHash||!t.attachmentSize?new B("This document has no attachment."):{size:t.attachmentSize,hash:t.attachmentHash}}static updateAttachmentFields(t,e,u,r,n){let i={...e,attachmentHash:r,attachmentSize:u};return this.signDocument(t,i,n)}static authorFromCredentials(t){return t.address}},ur.id="es.5",ur),ho=/^.*\.(\w+)$/,Do=/^.*~@\w{4}\.\w{53}$/;function dn(t){if(t.indexOf(".")===-1)return!1;let e=t.match(ho);return!(e===null||e[1].length===53&&t.match(Do))}var _e=lo,Mu=[_e];function pn(t){return t||_e}function mn(t){return t||Mu}function Ii(t){let e=t||Mu,u={};for(let r of e)u[r.id]=r;return u}var fo=class{constructor(){this.deferreds=new Set,this.state="pending"}resolve(t){if(this.state==="pending"){this.state="fulfilled";for(let e of this.deferreds)e.resolve(t)}}reject(t){if(this.state==="pending"){this.state="rejected";for(let e of this.deferreds)e.reject(t)}}getPromise(){let t=G();return this.state==="fulfilled"?t.resolve():this.state==="rejected"?t.reject():this.deferreds.add(t),t}},po=class{constructor(t=!1){this.promises=new Set,this.sealed=!1,this.multiDeferred=new fo,this.allowRejectedPromises=t}enrol(t){if(this.sealed)throw new Mt("Tried to enrol a promise when enrolment was already sealed.");this.promises.add(t),t.then(()=>{this.checkAllDone()}).catch(e=>{if(!this.allowRejectedPromises)throw e})}checkAllDone(){!this.sealed||(this.allowRejectedPromises?Promise.allSettled(this.promises).then(()=>{this.multiDeferred.resolve()}):Promise.all(this.promises).then(()=>{this.multiDeferred.resolve()}).catch(()=>{this.multiDeferred.reject()}))}seal(){this.sealed||(this.sealed=!0,this.checkAllDone())}isSealed(){return this.sealed}isDone(){return this.multiDeferred.getPromise()}},mo=class{constructor(){this.closed=!1,this.transform=new TransformStream({transform(t,e){e.enqueue(t)}}),this.writer=this.transform.writable.getWriter(),this.readable=this.transform.readable,this.writables=[]}checkClosed(){if(this.closed)throw"Closed"}getWritableStream(){this.checkClosed();let t=this.writer,e=new WritableStream({async write(u){await t.ready,await t.write(u)}});return this.writables.push(e),e}async close(){this.checkClosed();for(let t of this.writables)await t.abort();this.transform.writable.abort(),this.closed=!0}isClosed(){return this.closed}},Ao=class{constructor(){this.transformStream=new TransformStream(new Eo),this.sourceReadable=this.transformStream.readable,this.writable=this.transformStream.writable}getReadableStream(){let[t,e]=this.sourceReadable.tee();return this.sourceReadable=t,e}},Co=class{constructor(){this.closed=!1,this.subscribers=[],this.writables=[];let t=this.subscribers;this.writable=new WritableStream({write(e){let u=t.map(({writer:r})=>new Promise(n=>{r.ready.then(()=>{r.write(e).then(n)})}));Promise.all(u)}})}checkClosed(){if(this.closed)throw"Closed"}getReadableStream(){this.checkClosed();let t=new TransformStream({transform(e,u){u.enqueue(e)}});return this.subscribers.push({transform:t,writer:t.writable.getWriter()}),t.readable}async close(){this.checkClosed();for(let t of this.writables)await t.abort();for(let{transform:t}of this.subscribers)await t.writable.abort(),await t.readable.cancel();this.closed=!0}isClosed(){return this.closed}},wo=class{constructor(t){this.closed=!1,this.combineStream=new mo,t?this.cloneStream=new Co:this.cloneStream=new Ao,this.combineStream.readable.pipeTo(this.cloneStream.writable)}checkClosed(){if(this.closed)throw"Closed"}getWritableStream(){return this.combineStream.getWritableStream()}getReadableStream(){return this.cloneStream.getReadableStream()}close(){this.checkClosed(),this.combineStream.close(),this.closed=!0}isClosed(){return this.closed}},Ti=class{constructor(){this.callbacks=new Set}onWrite(t){return this.callbacks.add(t),()=>{this.callbacks.delete(t)}}async write(t){for(let e of this.callbacks)await e(t)}close(){this.callbacks.clear()}},Eo=class{transform(t,e){e.enqueue(t)}},go=class{constructor(){this.doneEnroller=new po,this.writable=new WritableStream({async write(t){await t()}}),this.writer=this.writable.getWriter(),this.closed=!1}checkClosed(){if(this.closed)throw"Closed"}async run(t){this.checkClosed(),await this.writer.ready;let e=this.writer.write(t);return this.doneEnroller.enrol(e),e}async close(){this.checkClosed(),this.doneEnroller.seal(),await this.doneEnroller.isDone(),this.writer.releaseLock(),await this.writable.abort(),this.closed=!0}isClosed(){return this.closed}},Fo=class{constructor(t,e){this.channel=t,this.channelKey=e}transform(t,e){if(this.channel==="*"||this.channel===t[this.channelKey]){e.enqueue(t);return}}},yo=class{constructor(t,e){this.multistream=new wo(e),this.channelKey=t}getWritableStream(){return this.multistream.getWritableStream()}getReadableStream(t){let e=new TransformStream(new Fo(t,this.channelKey));return this.multistream.getReadableStream().pipeThrough(e)}};BigInt(0);new bt("peer","orangeRed");var bo={historyMode:"latest",orderBy:"path ASC",startAfter:void 0,limit:void 0,filter:void 0,formats:["es.5"]},Ee=new bt("query","green");function Ri(t){var n,i,s,o;let e={...bo,...t},u={query:{limit:0},isValid:!1,willMatch:"nothing"};if(e.limit!==void 0&&e.limit<0)return Ee.debug("cleanUpQuery: unreasonable limit - returning empty invalid query",u),u;if((n=e.orderBy)!=null&&n.startsWith("path")&&((i=e.startAfter)==null?void 0:i.localIndex)!==void 0)return Ee.debug('cleanUpQuery: orderBy is "path" but startAfter is not compatible - returning empty invalid query',u),u;if((s=e.orderBy)!=null&&s.startsWith("localIndex")&&((o=e.startAfter)==null?void 0:o.path)!==void 0)return Ee.debug('cleanUpQuery: orderBy is "localIndex" but startAfter is not compatible - returning empty invalid query',u),u;if(e.historyMode!==void 0&&e.historyMode!=="all"&&e.historyMode!=="latest")return Ee.debug(`cleanUpQuery: unknown historyMode ${JSON.stringify(e.historyMode)} - returning empty invalid query`,u),u;if(e.orderBy!==void 0&&["path ASC","path DESC","localIndex ASC","localIndex DESC"].indexOf(e.orderBy)===-1)return Ee.debug(`cleanUpQuery: unrecognized orderBy value ${JSON.stringify(e.orderBy)} - returning empty invalid query`,u),u;let r=e.historyMode==="all"?"all":"all-latest";if(e.filter!==void 0&&!Su(e.filter,{})&&(r="some"),e.startAfter!==void 0&&!Su(e.startAfter,{})&&(r="some"),e.limit!==void 0&&(e.limit>0&&(r="some"),e.limit===0&&(r="nothing")),e.filter!==void 0){let a=e.filter;a.path&&a.pathStartsWith&&!a.path.startsWith(a.pathStartsWith)&&(r="nothing"),a.path&&a.pathEndsWith&&!a.path.endsWith(a.pathEndsWith)&&(r="nothing"),a.timestamp&&a.timestampGt&&!(a.timestamp>a.timestampGt)&&(r="nothing"),a.timestamp&&a.timestampLt&&!(a.timestamp<a.timestampLt)&&(r="nothing"),a.timestampGt&&a.timestampLt&&!(a.timestampLt+1<a.timestampGt)&&(r="nothing")}if(r==="nothing"){let a={query:{limit:0},isValid:!0,willMatch:"nothing"};return Ee.debug("cleanUpQuery - this query will match nothing, so returning a simpler query that also matches nothing",a),a}return Ee.debug(`cleanUpQuery - query is ok!  willMatch = ${r}`),{query:e,isValid:!0,willMatch:r}}function Hr(t,e){return!(e.path!==void 0&&t.path!==e.path||e.pathStartsWith!==void 0&&!t.path.startsWith(e.pathStartsWith)||e.pathEndsWith!==void 0&&!t.path.endsWith(e.pathEndsWith)||e.author!==void 0&&t.author!==e.author||e.timestamp!==void 0&&t.timestamp!==e.timestamp||e.timestampGt!==void 0&&!(t.timestamp>e.timestampGt)||e.timestampLt!==void 0&&!(t.timestamp<e.timestampLt))}new bt("query helpers","gold");var Bo=(t=>(t[t.LT=-1]="LT",t[t.EQ=0]="EQ",t[t.GT=1]="GT",t))(Bo||{});function gr(t,e,u="ASC"){if(Array.isArray(t)&&ii(t,e)||typeof t=="object"&&Su(t,e)||t===e)return 0;if(u==="ASC"||u===void 0)return t<e?-1:1;if(u==="DESC")return t>e?-1:1;throw new Error("unexpected sort order to compareBasic: "+JSON.stringify(u))}function Nr(t,e,u){let r=Math.min(t.length,e.length);for(let s=0;s<r;s++){let o=(u==null?void 0:u[s])??"ASC",a=gr(t[s],e[s],o);if(a!==0)return a}if(t.length===e.length)return 0;let n=Math.min(t.length,e.length),i=(u==null?void 0:u[n])??"ASC";return gr(t.length,e.length,i)}function An(t,e="ASC"){return(u,r)=>gr(u[t],r[t],e)}var vo=JSON.stringify,Bt=new bt("replica","gold"),vt=new bt("replica set","gold"),wt=new bt("replica ingest","gold");function Cn(t,e){return Nr([t.timestamp,t.signature],[e.timestamp,t.signature],["DESC","ASC"])}var _o=class{constructor({driver:t,config:e}){var r;this._isClosed=!1,this.ingestLockStream=new go,this.eventMultiStream=new yo("kind",!0),this.callbackSink=new Ti,this.expireEventTimeouts=new Map;let u=gu(t.docDriver.share);if(k(u))throw u;Bt.debug(`constructor.  driver = ${(r=t==null?void 0:t.constructor)==null?void 0:r.name}`),this.replicaId="replica-"+Or(),this.share=t.docDriver.share,this.replicaDriver=t,this.formatsConfig=e||{},this.eventWriter=this.eventMultiStream.getWritableStream().getWriter(),this.eventMultiStream.getReadableStream("*").pipeTo(new WritableStream(this.callbackSink)),this.eraseInterval=setInterval(()=>{this.isClosed()?clearInterval(this.eraseInterval):this.pruneExpiredDocsAndAttachments()},1e3*60*60)}isClosed(){return this._isClosed}async close(t){if(Bt.debug("closing..."),this._isClosed)throw new et;await this.ingestLockStream.close();for(let e of this.expireEventTimeouts.values())clearTimeout(e);return Bt.debug("    sending willClose blockingly..."),await this.eventWriter.write({kind:"willClose"}),Bt.debug("    marking self as closed..."),t===!1&&await this.pruneExpiredDocsAndAttachments(),await this.replicaDriver.attachmentDriver.clearStaging(),this._isClosed=!0,Bt.debug(`    closing ReplicaDriver (erase = ${t})...`),await this.replicaDriver.docDriver.close(t),await this.replicaDriver.attachmentDriver.close(t),clearInterval(this.eraseInterval),Bt.debug("    sending didClose nonblockingly..."),await this.eventWriter.write({kind:"didClose"}),Bt.debug("...closing done"),Promise.resolve()}async getConfig(t){if(this._isClosed)throw new et;return await this.replicaDriver.docDriver.getConfig(t)}async setConfig(t,e){if(this._isClosed)throw new et;return await this.replicaDriver.docDriver.setConfig(t,e)}async listConfigKeys(){if(this._isClosed)throw new et;return await this.replicaDriver.docDriver.listConfigKeys()}async deleteConfig(t){if(this._isClosed)throw new et;return await this.replicaDriver.docDriver.deleteConfig(t)}getMaxLocalIndex(){if(this._isClosed)throw new et;return this.replicaDriver.docDriver.getMaxLocalIndex()}getAllDocs(t){return Bt.debug("getAllDocs()"),this.queryDocs({historyMode:"all",orderBy:"path ASC"},t)}getLatestDocs(t){return Bt.debug("getLatestDocs()"),this.queryDocs({historyMode:"latest",orderBy:"path ASC"},t)}getAllDocsAtPath(t,e){return Bt.debug(`getAllDocsAtPath("${t}")`),this.queryDocs({historyMode:"all",orderBy:"path ASC",filter:{path:t}},e)}async getLatestDocAtPath(t,e){Bt.debug(`getLatestDocsAtPath("${t}")`);let u=await this.queryDocs({historyMode:"latest",orderBy:"path ASC",filter:{path:t}},e?[e]:void 0);if(u.length!==0)return u[0]}async queryDocs(t={},e){if(Bt.debug("queryDocs",t),this._isClosed)throw new et;let u=mn(e);return await this.replicaDriver.docDriver.queryDocs({...t,formats:u.map(r=>r.id)})}async queryPaths(t={},e){let u=await this.queryDocs(t,e),r=new Set(u.map(({path:n})=>n));return Array.from(r).sort()}async queryAuthors(t={},e){let u=await this.queryDocs(t,e),r=new Set(u.map(({author:n})=>n));return Array.from(r).sort()}async set(t,e,u=_e){if(vt.debug("set",e),this._isClosed)throw new et;vt.debug("...deciding timestamp: getting latest doc at the same path (from any author)");let r=await this.getLatestDocAtPath(e.path),n;typeof e.timestamp=="number"?n=e.timestamp:r===void 0?n=nn():n=Math.max(nn(),r.timestamp+1),vt.debug("...generating doc");let i;if(r){let a=u.removeExtraFields(r);k(a)||(i=a.doc)}let s=await u.generateDocument({keypair:t,input:{...e,format:u.id},share:this.share,timestamp:n,prevLatestDoc:i,config:this.formatsConfig[u.id]});if(k(s))return{kind:"failure",reason:"invalid_document",err:s};if(vt.debug("...signature =",s.doc.signature),s.attachment){let a=await this.replicaDriver.attachmentDriver.stage(u.id,s.attachment);if(k(a))return{kind:"failure",reason:"invalid_document",err:a};let c=await u.updateAttachmentFields(t,s.doc,a.size,a.hash,this.formatsConfig[u.id]);if(k(c))return await a.reject(),{kind:"failure",reason:"invalid_document",err:c};vt.debug("...ingesting attachment"),vt.debug("-----------------------"),await a.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:c,hash:a.hash,size:a.size,sourceId:"local"}),vt.debug("...done ingesting attachment"),vt.debug("...ingesting"),vt.debug("-----------------------");let h=await this.ingest(u,c,"local");return vt.debug("...done ingesting"),vt.debug("...set is done."),h}vt.debug("...ingesting"),vt.debug("-----------------------");let o=await this.ingest(u,s.doc,"local");return vt.debug("...done ingesting"),vt.debug("...set is done."),o}async ingest(t,e,u){if(wt.debug("ingest",e),this._isClosed)throw new et;wt.debug("...removing extra fields");let r=t.removeExtraFields(e);if(k(r))return{kind:"failure",reason:"invalid_document",err:r};e=r.doc;let n=r.extras;Object.keys(n).length>0&&wt.debug(`...extra fields found: ${vo(n)}`);let i=await t.checkDocumentIsValid(e);if(k(i))return{kind:"failure",reason:"invalid_document",err:i};let s=G();return await this.ingestLockStream.run(async()=>{wt.debug(" >> ingest: start of protected region"),wt.debug("  > getting other history docs at the same path by any author");let o=await this.getAllDocsAtPath(e.path,[t]);wt.debug(`  > ...got ${o.length}`),wt.debug("  > getting prevLatest and prevSameAuthor");let a=o[0]??null,c=o.filter(f=>f.author===e.author)[0]??null;wt.debug("  > checking if new doc is latest at this path"),o.push(e),o.sort(Cn);let h=o[0]===e;if(wt.debug(`  > ...isLatest: ${h}`),!h&&c!==null){wt.debug("  > new doc is not latest and there is another one from the same author...");let f=Cn(e,c);if(f===1){wt.debug("  > new doc is GT prevSameAuthor, so it is obsolete"),s.resolve({kind:"nothing_happened",reason:"obsolete_from_same_author",doc:e});return}if(f===0){wt.debug("  > new doc is EQ prevSameAuthor, so it is redundant (already_had_it)"),s.resolve({kind:"nothing_happened",reason:"already_had_it",doc:e});return}}wt.debug("  > upserting into ReplicaDriver...");let l=await this.replicaDriver.docDriver.upsert(e);wt.debug("  > ...done upserting into ReplicaDriver"),wt.debug("  > ...getting ReplicaDriver maxLocalIndex...");let D=await this.replicaDriver.docDriver.getMaxLocalIndex();wt.debug(" >> ingest: end of protected region, returning a WriteEvent from the lock");let p={kind:"success",maxLocalIndex:D,doc:l,docIsLatest:h,prevDocFromSameAuthor:c,prevLatestDoc:a,sourceId:u};if(s.resolve(p),await this.eventWriter.write(p),l.deleteAfter){let f=`${l.path}|${l.author}`,d=this.expireEventTimeouts.get(f);d&&clearTimeout(d);let A=l.deleteAfter/1e3-Date.now();this.expireEventTimeouts.set(f,setTimeout(()=>{this.eventWriter.write({kind:"expire",doc:l})},A))}}),s}async overwriteAllDocsByAuthor(t,e){let u=pn(e);if(Bt.debug(`overwriteAllDocsByAuthor("${t.address}")`),this._isClosed)throw new et;let r=await this.queryDocs({filter:{author:t.address},historyMode:"all"},[u]);Bt.debug(`    ...found ${r.length} docs to overwrite`);let n=0,i=0;for(let s of r){let o=await this.wipeDocument(t,s,pn(e));if(k(o))return o;n+=1}return Bt.debug(`    ...done; ${n} overwritten to be empty; ${i} were already empty; out of total ${r.length} docs`),n}async wipeDocAtPath(t,e,u=_e){let r=await this.getLatestDocAtPath(e,u);return r?this.wipeDocument(t,r,u):new B("No document exists at that path")}async wipeDocument(t,e,u){let r={...e,timestamp:Math.max(e.timestamp+1,Date.now()*1e3),author:t.address},n=await u.wipeDocument(t,r,this.formatsConfig[u.id]);if(k(n))return{kind:"failure",err:n,reason:"invalid_document"};let i=await this.ingest(u,n,"local");if(i.kind==="success"){let s=u.getAttachmentInfo(e);if(!k(s)){let o=await this.replicaDriver.attachmentDriver.erase(u.id,s.hash);k(o)||await this.eventWriter.write({kind:"attachment_prune",format:u.id,hash:s.hash})}}return i}async pruneExpiredDocsAndAttachments(t=Mu){let e=await this.replicaDriver.docDriver.eraseExpiredDocs();for(let i of e)await this.eventWriter.write({kind:"expire",doc:i});let u=Ii(t),r={};await this.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"existing",t).pipeTo(new WritableStream({write(i){if(i.kind==="existing"){let s=u[i.doc.format],o=s.getAttachmentInfo(i.doc);if(!k(o)){let a=r[s.id];a?a.add(o.hash):r[s.id]=new Set([o.hash])}}}}));let n=await this.replicaDriver.attachmentDriver.filter(r);for(let i of n)await this.eventWriter.write({kind:"attachment_prune",format:i.format,hash:i.hash})}getEventStream(t="*"){return this.eventMultiStream.getReadableStream(t)}getQueryStream(t={},e,u){let r=this.queryDocs.bind(this),n=this.getEventStream.bind(this);return new ReadableStream({async start(i){if(e==="existing"||e==="everything"){let o=await r(t,u);for(let a of o)i.enqueue({kind:"existing",doc:a})}if(i.enqueue({kind:"processed_all_existing"}),e==="existing"){i.close();return}let s=n().getReader();for(;;){let{done:o,value:a}=await s.read();if(o)return;if(a.kind==="expire"||a.kind==="success"){if(t.filter&&Hr(a.doc,t.filter)){i.enqueue(a);continue}i.enqueue(a);continue}a.kind==="didClose"&&i.close()}}})}onEvent(t){return this.callbackSink.onWrite(t)}async ingestAttachment(t,e,u,r){if(this._isClosed)throw new et;let n=t.removeExtraFields(e);if(k(n))return Promise.resolve(n);e=n.doc;let i=await t.checkDocumentIsValid(e);if(k(i))return Promise.resolve(i);let s=await this.getAttachment(e,t);if(s&&!k(s))return!1;let o=t.getAttachmentInfo(e);if(k(o))return Promise.resolve(o);let a=await this.replicaDriver.attachmentDriver.stage(e.format,u);return k(a)?a:a.hash!==o.hash?(await a.reject(),new B("Attachment's hash did not match the document's")):a.size!==o.size?(await a.reject(),new B("Attachment's size did not match the document's")):(await a.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:e,hash:a.hash,size:a.size,sourceId:r}),!0)}getAttachment(t,e=_e){if(t.deleteAfter&&t.deleteAfter<Date.now()*1e3)return Promise.resolve(new B("This document has expired"));let u=e.getAttachmentInfo(t);return k(u)?Promise.resolve(u):this.replicaDriver.attachmentDriver.getAttachment(t.format,u.hash)}addAttachments(t,e){let u=mn(e),r={};for(let i of u)r[i.id]=i;let n=t.map(i=>new Promise(s=>{let o=r[i.format].getAttachmentInfo(i);if(!k(o))this.replicaDriver.attachmentDriver.getAttachment(i.format,o.hash).then(a=>{s({...i,attachment:a})});else return s({...i,attachment:o})}));return Promise.all(n)}},xo=class extends _o{constructor(t){super({driver:t.driver,config:{"es.5":{shareSecret:t.shareSecret}}})}},ge=new bt("replica-cache","green");function wn({_localIndex:t}){return t}function En(t,e){let u=[];for(let r of e)if(!(t.orderBy==="path ASC"&&t.startAfter!==void 0&&t.startAfter.path!==void 0&&r.path<=t.startAfter.path)&&!(t.orderBy==="path DESC"&&t.startAfter!==void 0&&t.startAfter.path!==void 0&&r.path>=t.startAfter.path)&&!(t.orderBy==="localIndex ASC"&&t.startAfter!==void 0&&t.startAfter.localIndex!==void 0&&(r._localIndex||0)<=t.startAfter.localIndex)&&!(t.orderBy==="localIndex DESC"&&t.startAfter!==void 0&&t.startAfter.localIndex!==void 0&&(r._localIndex||0)>=t.startAfter.localIndex)&&(u.push(r),t.limit!==void 0&&u.length>=t.limit))break;return u}var So=class{constructor(t,e,u){this.version=0,this.docCache=new Map,this.onCacheUpdatedCallbacks=new Set,this.closed=!1,this.onFireCacheUpdatedsWrapper=s=>s(),this.attachmentCache=new Map,this.replica=t,this.timeToLive=e||1e3,u&&(this.onFireCacheUpdatedsWrapper=u);let r=this.onReplicaEvent.bind(this),n=this.close.bind(this),i=this.isClosed.bind(this);this.replica.getEventStream("*").pipeTo(new WritableStream({async write(s){s.kind==="attachment_ingest"||s.kind==="success"||s.kind==="expire"?await r(s):s.kind==="willClose"&&!i()&&await n()}})).catch(()=>{})}async close(){if(this.closed)throw new we;this.closed=!0,await Promise.all(Array.from(this.docCache.values()).map(t=>t.close())),this.docCache.clear(),this.onCacheUpdatedCallbacks.clear()}isClosed(){return this.closed}getAllDocs(t){return this.queryDocs({historyMode:"all",orderBy:"path DESC"},t)}getLatestDocs(t){return this.queryDocs({historyMode:"latest",orderBy:"path DESC"},t)}getAllDocsAtPath(t,e){return this.queryDocs({historyMode:"all",orderBy:"path DESC",filter:{path:t}},e)}getLatestDocAtPath(t,e){let u=this.queryDocs({historyMode:"latest",orderBy:"path DESC",filter:{path:t}},e?[e]:void 0);if(u.length!==0)return u[0]}queryDocs(t={},e){if(this.closed)throw new we;if(this.replica.isClosed())throw new et;let u={...t,formats:(e||Mu).map(D=>D.id)},r=Ri(u);if(r.willMatch==="nothing")return[];let n=qs(r.query),i=this.docCache.get(n);if(i)return Date.now()>i.expires&&this.replica.queryDocs(t,e).then(D=>{let p=D.map(wn).sort(),f=i.docs.map(wn).sort();ii(p,f)||(this.docCache.set(n,{stream:i.stream,close:i.close,docs:D,expires:Date.now()+this.timeToLive}),ge.debug("Updated cache because result expired."),this.fireOnCacheUpdateds())}),i.docs;let s=this.replica.getQueryStream(t,"new",e),o=new Ti,a=o.onWrite(D=>{(D.kind==="existing"||D.kind==="success")&&(ge.debug({doc:D.doc.path,queryString:n}),this._updateCache(n,D.doc))}),c=new WritableStream(o),h=new AbortController;s.pipeTo(c,{signal:h.signal});let l=()=>{a()};return this.docCache.set(n,{stream:s,docs:[],expires:Date.now()+this.timeToLive,close:l}),this.replica.queryDocs(u).then(D=>{this.docCache.set(n,{stream:s,close:l,docs:D,expires:Date.now()+this.timeToLive}),ge.debug("Updated cache with a new entry."),this.fireOnCacheUpdateds()}),[]}queryPaths(t={},e){let u=this.queryDocs(t,e),r=new Set(u.map(({path:n})=>n));return Array.from(r).sort()}queryAuthors(t={},e){let u=this.queryDocs(t,e),r=new Set(u.map(({author:n})=>n));return Array.from(r).sort()}_updateCache(t,e){let u=this.docCache.get(t);if(!u)return;let r=JSON.parse(t),n=()=>{let l=[...u.docs,e];this.docCache.set(t,{...u,docs:En(r,l)}),this.fireOnCacheUpdateds()},i=({exact:l})=>{let D=u.docs.map(p=>l&&p.path===e.path&&p.author===e.author||!l&&p.path===e.path?e:p);this.docCache.set(t,{...u,docs:En(r,D)}),this.fireOnCacheUpdateds()},s=u.docs.filter(l=>l.path===e.path),o=u.docs.filter(l=>l.path===e.path&&l.author===e.author);if(s.length===0){(r.filter&&Hr(e,r.filter)||!r.filter)&&(ge.debug("Updated cache after appending a doc to a entry with matching filter."),n());return}if((r.historyMode||"latest")==="all"){if(o.length===0){ge.debug("Updated cache after appending a version of a doc to a historyMode: all query."),n();return}ge.debug("Updated cache after replacing a version of a doc in a historyMode: all query."),i({exact:!0});return}let a=s[0],c=e.author!==(a==null?void 0:a.author)||!Su(e,a),h=e.timestamp>a.timestamp;if(c&&h){ge.debug("Updated cache after replacing a doc with its latest version."),i({exact:!1});return}}fireOnCacheUpdateds(){this.version++,this.onFireCacheUpdatedsWrapper(()=>{this.onCacheUpdatedCallbacks.forEach(t=>{t()})})}onCacheUpdated(t){if(this.closed)throw new we;if(this.replica.isClosed())throw new et;return this.onCacheUpdatedCallbacks.add(t),()=>{this.onCacheUpdatedCallbacks.delete(t)}}set(t,e,u){if(this.closed)throw new we;return this.replica.set(t,e,u)}overwriteAllDocsByAuthor(t,e){if(this.closed)throw new we;if(this.replica.isClosed())throw new et;return this.replica.overwriteAllDocsByAuthor(t,e)}wipeDocAtPath(t,e,u=_e){if(this.closed)throw new we;return this.replica.wipeDocAtPath(t,e,u)}async onReplicaEvent(t){let e=`${t.doc.path}|${t.doc.author}`,u=this.attachmentCache.get(e);if(!u)return;let r=await this.replica.getAttachment(t.doc,u.format);this.attachmentCache.set(e,{expires:Date.now()+this.timeToLive,attachment:r,format:u.format}),this.fireOnCacheUpdateds()}getAttachment(t,e=_e){if(this.closed)throw new we;if(this.replica.isClosed())throw new et;let u=e.getAttachmentInfo(t);if(k(u))return u;let r=`${t.path}|${t.author}`,n=this.attachmentCache.get(r);if(n)return Date.now()>n.expires&&this.replica.getAttachment(t,e).then(i=>{this.attachmentCache.set(r,{expires:Date.now()+this.timeToLive,attachment:i,format:e}),this.fireOnCacheUpdateds()}),t.deleteAfter&&Date.now()*1e3>t.deleteAfter?new B("This document has expired"):n.attachment;this.attachmentCache.set(r,{attachment:void 0,expires:Date.now()+this.timeToLive,format:e}),this.replica.getAttachment(t,e).then(i=>{this.attachmentCache.set(r,{expires:Date.now()+this.timeToLive,attachment:i,format:e}),this.fireOnCacheUpdateds()})}addAttachments(t,e){let u=[],r=Ii(e);for(let n of t){let i=this.getAttachment(n,r[n.format]);u.push({...n,attachment:i})}return u}};new bt("storage driver async memory","yellow");async function ko(t){let e=new Uint8Array;return await t.pipeTo(new WritableStream({write(u){let r=new Uint8Array(e.length+u.length);r.set(e),r.set(u,e.length),e=r}})),e}new bt("storage driver localStorage","gold");var Fe=new bt("replica driver indexeddb","gold");function Io(t,e){return Nr([t.path,t.timestamp,t.signature],[e.path,e.timestamp,t.signature],["ASC","DESC","ASC"])}function To(t,e){return Nr([t.path,t.timestamp,t.signature],[e.path,e.timestamp,t.signature],["DESC","DESC","ASC"])}var Rt="docs",Ht="config",Ro=class{constructor(t,e){this.db=G(),this.gotInitialMaxLocalIndex=G(),this.localMaxLocalIndex=-1,this.closed=!1;let u=gu(t);if(k(u))throw u;if(this.share=t,Fe.debug("constructor"),!window.indexedDB)throw new Mt("IndexedDB is not supported by this runtime.");let r=window.indexedDB.open(`earthstar:share_docs:${this.share}${e?`/${e}`:""}`,1);r.onerror=()=>{throw Fe.error(`Could not open IndexedDB for ${this.share}'s attachments.`),Fe.error(r.error),new Mt(`Could not open IndexedDB for ${this.share}'s attachments.`)},r.onupgradeneeded=function(){let n=r.result,i=n.createObjectStore(Rt,{keyPath:["path","author"]});i.createIndex("comboIndex",["_localIndex","timestamp","path","author"],{unique:!0}),i.createIndex("pathTimestampIndex",["path","timestamp"],{unique:!1}),i.createIndex("pathAuthorIndex",["path","author"],{unique:!0}),i.createIndex("deleteAfterIndex","deleteAfter",{unique:!1}),i.createIndex("localIndexIndex","_localIndex",{unique:!0}),n.createObjectStore(Ht,{keyPath:"key"}).createIndex("keyIndex",["key"],{unique:!0})},r.onsuccess=()=>{this.db.resolve(r.result);let n=r.result.transaction([Rt],"readonly").objectStore(Rt).index("localIndexIndex").openCursor(null,"prev");n.onsuccess=()=>{n.result?this.gotInitialMaxLocalIndex.resolve(n.result.value._localIndex):this.gotInitialMaxLocalIndex.resolve(-1)}},this.gotInitialMaxLocalIndex.then(n=>{this.localMaxLocalIndex=n})}isClosed(){return this.closed}async close(t){if(this.closed)throw new et;this.closed=!0;let e=G();if(t){let u=(await this.db).transaction([Rt,Ht],"readwrite"),r=G(),n=G(),i=u.objectStore(Rt).clear().onsuccess=()=>{r.resolve()},s=u.objectStore(Ht).clear().onsuccess=()=>{n.resolve()};await Promise.all([i,s]),e.resolve()}else e.resolve();return(await this.db).close(),await Si(20),e}async getMaxLocalIndex(){return await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex}async queryDocs(t){var a,c,h,l,D,p,f,d,A,x,y,m,F;let e=(await this.db).transaction([Rt],"readonly").objectStore(Rt),u=G(),{query:r,willMatch:n}=Ri(t);if(Fe.debug(`    cleanUpQuery.  willMatch = ${n}`),n==="nothing")return[];if((a=r.filter)!=null&&a.path&&r.historyMode==="latest"){let g=IDBKeyRange.bound([r.filter.path,r.filter.timestampGt||0],[r.filter.path,r.filter.timestampLt||Number.MAX_SAFE_INTEGER]),v=e.index("pathTimestampIndex").openCursor(g,"prev");v.onsuccess=()=>{var b;(b=v.result)!=null&&b.value?u.resolve([v.result.value]):u.resolve([])}}else if((c=r.filter)!=null&&c.path&&r.historyMode==="all"){let g=e.index("pathAuthorIndex"),v=IDBKeyRange.bound([r.filter.path," "],[r.filter.path,"~"]),b=g.getAll(v);b.onsuccess=()=>{b.result?u.resolve(Array.from(b.result)):u.resolve([])}}else{let g=((h=r.startAfter)==null?void 0:h.path)||((l=r.filter)==null?void 0:l.path)||((D=r.filter)==null?void 0:D.pathStartsWith)||" ",v=((p=r.filter)==null?void 0:p.author)||" ",b=((f=r.filter)==null?void 0:f.timestamp)||((d=r.filter)==null?void 0:d.timestampGt)||0,E=((A=r.startAfter)==null?void 0:A.localIndex)||0,S=((x=r.filter)==null?void 0:x.path)||"~",Z=((y=r.filter)==null?void 0:y.author)||"~",R=((m=r.filter)==null?void 0:m.timestamp)||((F=r.filter)==null?void 0:F.timestampLt)||Number.MAX_SAFE_INTEGER,U=Number.MAX_SAFE_INTEGER,K=IDBKeyRange.bound([E,b,g,v],[U,R,S,Z]),jt=e.index("comboIndex").getAll(K);jt.onsuccess=()=>{jt.result?u.resolve(jt.result):u.resolve([])}}let i=await u;if(r.historyMode==="latest"){let g=i.splice(0,i.length),v=new Map;for(let b of g){let E=v.get(b.path);(!E||E.timestamp<b.timestamp)&&v.set(b.path,b)}i.push(...v.values())}let s=[];Fe.debug("    filtering docs");let o=Date.now()*1e3;for(let g of i)g.deleteAfter&&g.deleteAfter<o||r.filter&&!Hr(g,r.filter)||s.push(g);if(Fe.debug(`    ordering docs: ${r.orderBy}`),r.orderBy==="path ASC")s.sort(Io);else if(r.orderBy==="path DESC")s.sort(To);else if(r.orderBy==="localIndex ASC")s.sort(An("_localIndex","ASC"));else if(r.orderBy==="localIndex DESC")s.sort(An("_localIndex","DESC"));else if(r.orderBy)throw new B("unrecognized query orderBy: "+JSON.stringify(r.orderBy));return r.limit!==void 0&&i.length>=r.limit?s.slice(0,r.limit):(Fe.debug(`    queryDocs is done: found ${s.length} docs.`),s)}async upsert(t){let e=await this.db,u=e.transaction([Rt],"readwrite").objectStore(Rt).index("pathAuthorIndex"),r=G(),n=u.openCursor([t.path,t.author]);if(await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex+=1,t._localIndex=this.localMaxLocalIndex,n.onsuccess=()=>{if(n.result){let o=n.result.update(t);o.onsuccess=()=>{r.resolve(!!o.result)}}else r.resolve(!1)},await r)return t;let i=e.transaction([Rt],"readwrite").objectStore(Rt).put(t),s=G();return i.onsuccess=()=>{s.resolve()},i.onerror=()=>{throw i.error},await s,t}async eraseExpiredDocs(){let t=[],e=(await this.db).transaction([Rt],"readwrite").objectStore(Rt).index("deleteAfterIndex"),u=Date.now()*1e3,r=IDBKeyRange.bound(0,u),n=e.openCursor(r),i=G();return n.onsuccess=()=>{var s;if((s=n.result)!=null&&s.value){let o=n.result.value;if(o.deleteAfter!==null&&o.deleteAfter!==void 0){t.push(o);let a=n.result.delete();a.onsuccess=()=>{var c;(c=n.result)==null||c.continue()}}}else i.resolve()},await i,t}async getConfig(t){let e=(await this.db).transaction([Ht],"readonly").objectStore(Ht),u=G(),r=e.get(t);return r.onsuccess=()=>{var n;u.resolve((n=r.result)==null?void 0:n.value)},u}async setConfig(t,e){let u=(await this.db).transaction([Ht],"readwrite").objectStore(Ht),r=G(),n=u.put({key:t,value:e});return n.onsuccess=()=>{r.resolve()},r}async listConfigKeys(){let t=(await this.db).transaction([Ht],"readonly").objectStore(Ht),e=G(),u=t.index("keyIndex").openKeyCursor(),r=[];return u.onsuccess=()=>{u.result?(r.push(u.result.primaryKey),u.result.continue()):e.resolve(r)},e}async deleteConfig(t){let e=(await this.db).transaction([Ht],"readwrite").objectStore(Ht),u=G(),r=e.index("keyIndex"),n=IDBKeyRange.bound([t],[t]),i=r.openCursor(n);return i.onsuccess=()=>{if(i.result){let s=i.result.delete();s.onsuccess=()=>{u.resolve(!0)}}else u.resolve(!1)},u}},gn=new bt("replica driver indexeddb","gold"),Nt="attachment_staging_index",Pt="attachments_index",St="attachments_bytes",Po=class{constructor(t,e){if(this.db=G(),this.closed=!1,this.share=t,!window.indexedDB)throw new Mt("IndexedDB is not supported by this runtime.");let u=window.indexedDB.open(`earthstar:share_attachments:${this.share}${e?`/${e}`:""}`,1);u.onerror=()=>{throw gn.error(`Could not open IndexedDB for ${this.share}'s attachments.`),gn.error(u.error),new Mt(`Could not open IndexedDB for ${this.share}'s attachments.`)},u.onupgradeneeded=function(){let r=u.result;r.createObjectStore(St),r.createObjectStore(Pt,{keyPath:"id"}),r.createObjectStore(Nt,{keyPath:"id"})},u.onsuccess=()=>{this.db.resolve(u.result)}}getIndexKey(t,e){return`${t}___${e}`}async getAttachment(t,e){if(this.closed)throw new et;let u=G(),r=this.getIndexKey(t,e),n=await this.db,i=n.transaction([Pt],"readonly").objectStore(Pt).get(r),s=G();return i.onerror=()=>{s.reject()},i.onsuccess=()=>{i.result===void 0?s.reject():s.resolve(i.result.blobKey)},s.then(o=>{let a=n.transaction([St],"readonly").objectStore(St).get(o);a.onsuccess=()=>{let c=new Blob([a.result]);u.resolve({bytes:async()=>new Uint8Array(await c.arrayBuffer()),stream:()=>Promise.resolve(c.stream())})},a.onerror=()=>{u.resolve(void 0)}}).catch(()=>{u.resolve(void 0)}),u}async erase(t,e){if(this.closed)throw new et;let u=G(),r=this.getIndexKey(t,e),n=await this.db,i=n.transaction([Pt],"readonly").objectStore(Pt).get(r),s=G();return i.onerror=()=>{s.reject()},i.onsuccess=()=>{n.transaction([Pt],"readwrite").objectStore(Pt).delete(r),i.result===void 0?s.reject():s.resolve(i.result.blobKey)},s.then(o=>{let a=n.transaction([St],"readwrite").objectStore(St).delete(o);a.onsuccess=()=>{u.resolve(!0)},a.onerror=()=>{u.resolve(void 0)}}).catch(()=>{u.resolve(new B("No attachment found"))}),u}async stage(t,e){if(this.closed)throw new et;let u=await this.db,r=e instanceof Uint8Array?e:await ko(e),n=await pt.sha256base32(r),i=this.getIndexKey(t,n),s=`${i}___${Or()}`,o=u.transaction([St,Nt],"readwrite"),a=o.objectStore(St).put(r,s),c=o.objectStore(Nt).put({id:i,blobKey:s}),h=G(),l=G();return a.onsuccess=()=>h.resolve(),c.onsuccess=()=>l.resolve(),await h,await l,{hash:n,size:r.byteLength,reject:async()=>{let D=u.transaction([St,Nt],"readwrite"),p=D.objectStore(St).delete(s),f=D.objectStore(Nt).delete(i),d=G(),A=G();p.onsuccess=()=>{d.resolve()},f.onsuccess=()=>{A.resolve()},await Promise.all([d,A])},commit:async()=>{let D=u.transaction([Pt,Nt],"readwrite"),p=D.objectStore(Nt).delete(i),f=D.objectStore(Pt).put({id:i,blobKey:s}),d=G(),A=G();p.onsuccess=()=>d.resolve(),f.onsuccess=()=>A.resolve(),await Promise.all([d,A])}}}async wipe(){if(this.closed)throw new et;let t=(await this.db).transaction([St,Pt,Nt],"readwrite"),e=t.objectStore(St).clear(),u=t.objectStore(Pt).clear(),r=t.objectStore(Nt).clear(),n=G(),i=G(),s=G();e.onsuccess=()=>n.resolve(),u.onsuccess=()=>i.resolve(),r.onsuccess=()=>s.resolve(),await Promise.all([n,i,s])}async clearStaging(){if(this.closed)throw new et;let t=(await this.db).transaction([St,Nt]),e=t.objectStore(Nt).openCursor(),u=G();return e.onsuccess=()=>{let r=e.result;if(!r){u.resolve();return}let n=r.value.blobKey,i=t.objectStore(St).delete(n);r.delete(),i.onsuccess=()=>{r.continue()},i.onerror=()=>{r.continue()}},u}async filter(t){if(this.closed)throw new et;let e=(await this.db).transaction([St,Pt],"readwrite"),u=50,r=[],n=[],i=G(),s=(o=null)=>{let a=e.objectStore(Pt).getAll(o,u);a.onsuccess=()=>{let c=a.result;for(let h of c){let[l,D]=h.id.split("___");t[l]&&!t[l].has(D)&&(r.push({format:l,hash:D}),n.push(this.erase(l,D)))}if(c.length===u){let h=c[c.length-1],l=IDBKeyRange.lowerBound(h.id,!0);s(l)}else i.resolve()}};return s(),await i,await Promise.all(n),r}isClosed(){return this.closed}async close(t){if(this.closed)throw new et;t&&await this.wipe(),this.closed=!0,(await this.db).close(),await Si(20)}},$o=class{constructor(t,e){this.docDriver=new Ro(t,e),this.attachmentDriver=new Po(t,e)}};/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const Pe=[];function Pi(t,e){return{subscribe:$i(t,e).subscribe}}function $i(t,e=W){let u;const r=new Set;function n(o){if(Se(t,o)&&(t=o,u)){const a=!Pe.length;for(const c of r)c[1](),Pe.push(c,t);if(a){for(let c=0;c<Pe.length;c+=2)Pe[c][0](Pe[c+1]);Pe.length=0}}}function i(o){n(o(t))}function s(o,a=W){const c=[o,a];return r.add(c),r.size===1&&(u=e(n)||W),o(t),()=>{r.delete(c),r.size===0&&(u(),u=null)}}return{set:n,update:i,subscribe:s}}const ju=Pi({shareAddress:"+filesharing.b5measwv2ezjdw7zfrsgqpxlln4yvs5cvcefompv4gypg2ueflr3a",secret:"bkhu7fomnhbgqnecjnwstunaued7kxlvvazit43u7afizdfpvo4kq"});class Wu extends Error{constructor(e){super(e||""),this.name="EarthstarError"}}class _ extends Wu{constructor(e){super(e||"Validation error"),this.name="ValidationError"}}function j(t){return t instanceof Wu}function Oi(t){return!(t instanceof Wu)}var pu={};Object.defineProperty(pu,"__esModule",{value:!0});var Hi=pu.setInterval=Ni=pu.setTimeout=void 0;const Oo=globalThis.setTimeout;function Ho(t,e,...u){const r=Oo(t,e,...u);return typeof r=="number"?r:r[Symbol.toPrimitive]()}var Ni=pu.setTimeout=Ho;const No=globalThis.setInterval;function Uo(t,e,...u){const r=No(t,e,...u);return typeof r=="number"?r:r[Symbol.toPrimitive]()}Hi=pu.setInterval=Uo;var Ur={},rr,Fn;Object.defineProperty(Ur,"__esModule",{value:!0});var Ui=Ur.WeakRef=void 0;Ui=Ur.WeakRef=(rr=globalThis.WeakRef)!==null&&rr!==void 0?rr:(Fn=class{constructor(e){}deref(){throw new Error("WeakRef is not supported in Node 14 and below.")}},Fn);const{Blob:Lo}=window,{Request:Mo,Response:jo,Headers:Wo,fetch:Sl}=window,{ReadableStream:Fr,ReadableStreamDefaultReader:kl,ReadableStreamBYOBReader:Il,ReadableStreamBYOBRequest:Tl,ReadableByteStreamController:Rl,ReadableStreamDefaultController:Pl,TransformStream:zo,TransformStreamDefaultController:qo,WritableStream:Ko,WritableStreamDefaultWriter:Vo,WritableStreamDefaultController:$l,ByteLengthQueuingStrategy:Ol,CountQueuingStrategy:Hl,TextEncoderStream:Nl,TextDecoderStream:Ul}=window;if(!Fr.prototype[Symbol.asyncIterator]){async function*t(){const e=this.getReader();try{for(;;){const{done:u,value:r}=await e.read();if(u)return;yield r}}finally{e.releaseLock()}}Fr.prototype[Symbol.asyncIterator]=t}var Ne=null;typeof WebSocket<"u"?Ne=WebSocket:typeof MozWebSocket<"u"?Ne=MozWebSocket:typeof global<"u"?Ne=global.WebSocket||global.MozWebSocket:typeof window<"u"?Ne=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(Ne=self.WebSocket||self.MozWebSocket);const Go=Ne,{TextDecoder:Li,TextEncoder:Lr}=window;function yn(t,e){for(var u=0;u<e.length;u++){var r=e[u];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Mi(t,e,u){return e&&yn(t.prototype,e),u&&yn(t,u),t}function bn(t,e){(e==null||e>t.length)&&(e=t.length);for(var u=0,r=new Array(e);u<e;u++)r[u]=t[u];return r}function Pu(t,e){var u=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(u)return(u=u.call(t)).next.bind(u);if(Array.isArray(t)||(u=function(n,i){if(n){if(typeof n=="string")return bn(n,i);var s=Object.prototype.toString.call(n).slice(8,-1);return s==="Object"&&n.constructor&&(s=n.constructor.name),s==="Map"||s==="Set"?Array.from(n):s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?bn(n,i):void 0}}(t))||e&&t&&typeof t.length=="number"){u&&(t=u);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Zo=/(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDEC0-\uDEEB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/,Xo=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/;function Qo(t,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(t)}function ji(t,e){e===void 0&&(e=!1);for(var u=[],r=0;r<t.length;){var n=t[r],i=function(p){if(!e)throw new TypeError(p);u.push({type:"INVALID_CHAR",index:r,value:t[r++]})};if(n!=="*")if(n!=="+"&&n!=="?")if(n!=="\\")if(n!=="{")if(n!=="}")if(n!==":")if(n!=="(")u.push({type:"CHAR",index:r,value:t[r++]});else{var s=1,o="",a=r+1,c=!1;if(t[a]==="?"){i('Pattern cannot start with "?" at '+a);continue}for(;a<t.length;){if(!Qo(t[a],!1)){i("Invalid character '"+t[a]+"' at "+a+"."),c=!0;break}if(t[a]!=="\\"){if(t[a]===")"){if(--s==0){a++;break}}else if(t[a]==="("&&(s++,t[a+1]!=="?")){i("Capturing groups are not allowed at "+a),c=!0;break}o+=t[a++]}else o+=t[a++]+t[a++]}if(c)continue;if(s){i("Unbalanced pattern at "+r);continue}if(!o){i("Missing pattern at "+r);continue}u.push({type:"PATTERN",index:r,value:o}),r=a}else{for(var h="",l=r+1;l<t.length;){var D=t.substr(l,1);if(!(l===r+1&&Zo.test(D)||l!==r+1&&Xo.test(D)))break;h+=t[l++]}if(!h){i("Missing parameter name at "+r);continue}u.push({type:"NAME",index:r,value:h}),r=l}else u.push({type:"CLOSE",index:r,value:t[r++]});else u.push({type:"OPEN",index:r,value:t[r++]});else u.push({type:"ESCAPED_CHAR",index:r++,value:t[r++]});else u.push({type:"MODIFIER",index:r,value:t[r++]});else u.push({type:"ASTERISK",index:r,value:t[r++]})}return u.push({type:"END",index:r,value:""}),u}function Wi(t,e){e===void 0&&(e={});for(var u=ji(t),r=e.prefixes,n=r===void 0?"./":r,i="[^"+Ue(e.delimiter||"/#?")+"]+?",s=[],o=0,a=0,c="",h=new Set,l=function(R){if(a<u.length&&u[a].type===R)return u[a++].value},D=function(){return l("MODIFIER")||l("ASTERISK")},p=function(R){var U=l(R);if(U!==void 0)return U;var K=u[a];throw new TypeError("Unexpected "+K.type+" at "+K.index+", expected "+R)},f=function(){for(var R,U="";R=l("CHAR")||l("ESCAPED_CHAR");)U+=R;return U},d=e.encodePart||function(R){return R};a<u.length;){var A=l("CHAR"),x=l("NAME"),y=l("PATTERN");if(x||y||!l("ASTERISK")||(y=".*"),x||y){var m=A||"";n.indexOf(m)===-1&&(c+=m,m=""),c&&(s.push(d(c)),c="");var F=x||o++;if(h.has(F))throw new TypeError("Duplicate name '"+F+"'.");h.add(F),s.push({name:F,prefix:d(m),suffix:"",pattern:y||i,modifier:D()||""})}else{var g=A||l("ESCAPED_CHAR");if(g)c+=g;else if(l("OPEN")){var v=f(),b=l("NAME")||"",E=l("PATTERN")||"";b||E||!l("ASTERISK")||(E=".*");var S=f();p("CLOSE");var Z=D()||"";if(!b&&!E&&!Z){c+=v;continue}if(!b&&!E&&!v)continue;c&&(s.push(d(c)),c=""),s.push({name:b||(E?o++:""),pattern:b&&!E?i:E,prefix:d(v),suffix:d(S),modifier:Z})}else c&&(s.push(d(c)),c=""),p("END")}}return s}function Ue(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function zi(t){return t&&t.sensitive?"u":"ui"}function qi(t,e,u){u===void 0&&(u={});for(var r,n=u.strict,i=n!==void 0&&n,s=u.start,o=s===void 0||s,a=u.end,c=a===void 0||a,h=u.encode,l=h===void 0?function(g){return g}:h,D="["+Ue(u.endsWith||"")+"]|$",p="["+Ue(u.delimiter||"/#?")+"]",f=o?"^":"",d=Pu(t);!(r=d()).done;){var A=r.value;if(typeof A=="string")f+=Ue(l(A));else{var x=Ue(l(A.prefix)),y=Ue(l(A.suffix));A.pattern?(e&&e.push(A),f+=x||y?A.modifier==="+"||A.modifier==="*"?"(?:"+x+"((?:"+A.pattern+")(?:"+y+x+"(?:"+A.pattern+"))*)"+y+")"+(A.modifier==="*"?"?":""):"(?:"+x+"("+A.pattern+")"+y+")"+A.modifier:A.modifier==="+"||A.modifier==="*"?"((?:"+A.pattern+")"+A.modifier+")":"("+A.pattern+")"+A.modifier):f+="(?:"+x+y+")"+A.modifier}}if(c)i||(f+=p+"?"),f+=u.endsWith?"(?="+D+")":"$";else{var m=t[t.length-1],F=typeof m=="string"?p.indexOf(m[m.length-1])>-1:m===void 0;i||(f+="(?:"+p+"(?="+D+"))?"),F||(f+="(?="+p+"|"+D+")")}return new RegExp(f,zi(u))}function Ki(t,e,u){return t instanceof RegExp?function(r,n){if(!n)return r;for(var i=/\((?:\?<(.*?)>)?(?!\?)/g,s=0,o=i.exec(r.source);o;)n.push({name:o[1]||s++,prefix:"",suffix:"",modifier:"",pattern:""}),o=i.exec(r.source);return r}(t,e):Array.isArray(t)?function(r,n,i){var s=r.map(function(o){return Ki(o,n,i).source});return new RegExp("(?:"+s.join("|")+")",zi(i))}(t,e,u):function(r,n,i){return qi(Wi(r,i),n,i)}(t,e,u)}var de={delimiter:"",prefixes:"",sensitive:!0,strict:!0},Yo={delimiter:".",prefixes:"",sensitive:!0,strict:!0},Jo={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function Bn(t,e){return t.startsWith(e)?t.substring(e.length,t.length):t}function Vi(t){return!(!t||t.length<2||t[0]!=="["&&(t[0]!=="\\"&&t[0]!=="{"||t[1]!=="["))}var O,Gi=["ftp","file","http","https","ws","wss"];function Zi(t){if(!t)return!0;for(var e,u=Pu(Gi);!(e=u()).done;)if(t.test(e.value))return!0;return!1}function Xi(t){switch(t){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function Mr(t){if(t==="")return t;if(/^[-+.A-Za-z0-9]*$/.test(t))return t.toLowerCase();throw new TypeError("Invalid protocol '"+t+"'.")}function t0(t){if(t==="")return t;var e=new URL("https://example.com");return e.username=t,e.username}function e0(t){if(t==="")return t;var e=new URL("https://example.com");return e.password=t,e.password}function Qi(t){if(t==="")return t;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(t))throw new TypeError("Invalid hostname '"+t+"'");var e=new URL("https://example.com");return e.hostname=t,e.hostname}function Yi(t){if(t==="")return t;if(/[^0-9a-fA-F[\]:]/g.test(t))throw new TypeError("Invalid IPv6 hostname '"+t+"'");return t.toLowerCase()}function Ji(t){if(t===""||/^[0-9]*$/.test(t)&&parseInt(t)<=65535)return t;throw new TypeError("Invalid port '"+t+"'.")}function u0(t){if(t==="")return t;var e=new URL("https://example.com");return e.pathname=t[0]!=="/"?"/-"+t:t,t[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function r0(t){return t===""?t:new URL("data:"+t).pathname}function n0(t){if(t==="")return t;var e=new URL("https://example.com");return e.search=t,e.search.substring(1,e.search.length)}function i0(t){if(t==="")return t;var e=new URL("https://example.com");return e.hash=t,e.hash.substring(1,e.hash.length)}(function(t){t[t.INIT=0]="INIT",t[t.PROTOCOL=1]="PROTOCOL",t[t.AUTHORITY=2]="AUTHORITY",t[t.USERNAME=3]="USERNAME",t[t.PASSWORD=4]="PASSWORD",t[t.HOSTNAME=5]="HOSTNAME",t[t.PORT=6]="PORT",t[t.PATHNAME=7]="PATHNAME",t[t.SEARCH=8]="SEARCH",t[t.HASH=9]="HASH",t[t.DONE=10]="DONE"})(O||(O={}));var s0=function(){function t(u){this.input=void 0,this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=O.INIT,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=u}var e=t.prototype;return e.parse=function(){for(this.tokenList=ji(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===O.INIT){this.rewind(),this.isHashPrefix()?this.changeState(O.HASH,1):this.isSearchPrefix()?(this.changeState(O.SEARCH,1),this.internalResult.hash=""):(this.changeState(O.PATHNAME,0),this.internalResult.search="",this.internalResult.hash="");continue}if(this.state===O.AUTHORITY){this.rewindAndSetState(O.HOSTNAME);continue}this.changeState(O.DONE,0);break}if(this.groupDepth>0){if(!this.isGroupClose())continue;this.groupDepth-=1}if(this.isGroupOpen())this.groupDepth+=1;else switch(this.state){case O.INIT:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(O.PROTOCOL));break;case O.PROTOCOL:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();var u=O.PATHNAME,r=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(u=O.AUTHORITY,r=3):this.shouldTreatAsStandardURL&&(u=O.AUTHORITY),this.changeState(u,r)}break;case O.AUTHORITY:this.isIdentityTerminator()?this.rewindAndSetState(O.USERNAME):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(O.HOSTNAME);break;case O.USERNAME:this.isPasswordPrefix()?this.changeState(O.PASSWORD,1):this.isIdentityTerminator()&&this.changeState(O.HOSTNAME,1);break;case O.PASSWORD:this.isIdentityTerminator()&&this.changeState(O.HOSTNAME,1);break;case O.HOSTNAME:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(O.PORT,1):this.isPathnameStart()?this.changeState(O.PATHNAME,0):this.isSearchPrefix()?this.changeState(O.SEARCH,1):this.isHashPrefix()&&this.changeState(O.HASH,1);break;case O.PORT:this.isPathnameStart()?this.changeState(O.PATHNAME,0):this.isSearchPrefix()?this.changeState(O.SEARCH,1):this.isHashPrefix()&&this.changeState(O.HASH,1);break;case O.PATHNAME:this.isSearchPrefix()?this.changeState(O.SEARCH,1):this.isHashPrefix()&&this.changeState(O.HASH,1);break;case O.SEARCH:this.isHashPrefix()&&this.changeState(O.HASH,1)}}},e.changeState=function(u,r){switch(this.state){case O.INIT:break;case O.PROTOCOL:this.internalResult.protocol=this.makeComponentString();break;case O.AUTHORITY:break;case O.USERNAME:this.internalResult.username=this.makeComponentString();break;case O.PASSWORD:this.internalResult.password=this.makeComponentString();break;case O.HOSTNAME:this.internalResult.hostname=this.makeComponentString();break;case O.PORT:this.internalResult.port=this.makeComponentString();break;case O.PATHNAME:this.internalResult.pathname=this.makeComponentString();break;case O.SEARCH:this.internalResult.search=this.makeComponentString();break;case O.HASH:this.internalResult.hash=this.makeComponentString()}this.changeStateWithoutSettingComponent(u,r)},e.changeStateWithoutSettingComponent=function(u,r){this.state=u,this.componentStart=this.tokenIndex+r,this.tokenIndex+=r,this.tokenIncrement=0},e.rewind=function(){this.tokenIndex=this.componentStart,this.tokenIncrement=0},e.rewindAndSetState=function(u){this.rewind(),this.state=u},e.safeToken=function(u){return u<0&&(u=this.tokenList.length-u),u<this.tokenList.length?this.tokenList[u]:this.tokenList[this.tokenList.length-1]},e.isNonSpecialPatternChar=function(u,r){var n=this.safeToken(u);return n.value===r&&(n.type==="CHAR"||n.type==="ESCAPED_CHAR"||n.type==="INVALID_CHAR")},e.isProtocolSuffix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.nextIsAuthoritySlashes=function(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")},e.isIdentityTerminator=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")},e.isPasswordPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.isPortPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.isPathnameStart=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")},e.isSearchPrefix=function(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;var u=this.safeToken(this.tokenIndex-1);return u.type!=="NAME"&&u.type!=="PATTERN"&&u.type!=="CLOSE"&&u.type!=="ASTERISK"},e.isHashPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")},e.isGroupOpen=function(){return this.tokenList[this.tokenIndex].type=="OPEN"},e.isGroupClose=function(){return this.tokenList[this.tokenIndex].type=="CLOSE"},e.isIPv6Open=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")},e.isIPv6Close=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")},e.makeComponentString=function(){var u=this.tokenList[this.tokenIndex],r=this.safeToken(this.componentStart).index;return this.input.substring(r,u.index)},e.computeShouldTreatAsStandardURL=function(){var u={};Object.assign(u,de),u.encodePart=Mr;var r=Ki(this.makeComponentString(),void 0,u);this.shouldTreatAsStandardURL=Zi(r)},Mi(t,[{key:"result",get:function(){return this.internalResult}}]),t}(),a0=["protocol","username","password","hostname","port","pathname","search","hash"];function vn(t,e){if(typeof t!="string")throw new TypeError("parameter 1 is not of type 'string'.");var u=new URL(t,e);return{protocol:u.protocol.substring(0,u.protocol.length-1),username:u.username,password:u.password,hostname:u.hostname,port:u.port,pathname:u.pathname,search:u.search!=""?u.search.substring(1,u.search.length):void 0,hash:u.hash!=""?u.hash.substring(1,u.hash.length):void 0}}function nr(t,e,u){var r;if(typeof e.baseURL=="string")try{r=new URL(e.baseURL),t.protocol=r.protocol?r.protocol.substring(0,r.protocol.length-1):"",t.username=r.username,t.password=r.password,t.hostname=r.hostname,t.port=r.port,t.pathname=r.pathname,t.search=r.search?r.search.substring(1,r.search.length):"",t.hash=r.hash?r.hash.substring(1,r.hash.length):""}catch{throw new TypeError("invalid baseURL '"+e.baseURL+"'.")}if(typeof e.protocol=="string"&&(t.protocol=function(i,s){var o;return i=(o=i).endsWith(":")?o.substr(0,o.length-1):o,s||i===""?i:Mr(i)}(e.protocol,u)),typeof e.username=="string"&&(t.username=function(i,s){if(s||i==="")return i;var o=new URL("https://example.com");return o.username=i,o.username}(e.username,u)),typeof e.password=="string"&&(t.password=function(i,s){if(s||i==="")return i;var o=new URL("https://example.com");return o.password=i,o.password}(e.password,u)),typeof e.hostname=="string"&&(t.hostname=function(i,s){return s||i===""?i:Vi(i)?Yi(i):Qi(i)}(e.hostname,u)),typeof e.port=="string"&&(t.port=function(i,s,o){return Xi(s)===i&&(i=""),o||i===""?i:Ji(i)}(e.port,t.protocol,u)),typeof e.pathname=="string"){if(t.pathname=e.pathname,r&&!function(i,s){return!(!i.length||i[0]!=="/"&&(!s||i.length<2||i[0]!="\\"&&i[0]!="{"||i[1]!="/"))}(t.pathname,u)){var n=r.pathname.lastIndexOf("/");n>=0&&(t.pathname=r.pathname.substring(0,n+1)+t.pathname)}t.pathname=function(i,s,o){if(o||i==="")return i;if(s&&!Gi.includes(s))return new URL(s+":"+i).pathname;var a=i[0]=="/";return i=new URL(a?i:"/-"+i,"https://example.com").pathname,a||(i=i.substring(2,i.length)),i}(t.pathname,t.protocol,u)}return typeof e.search=="string"&&(t.search=function(i,s){if(i=Bn(i,"?"),s||i==="")return i;var o=new URL("https://example.com");return o.search=i,o.search?o.search.substring(1,o.search.length):""}(e.search,u)),typeof e.hash=="string"&&(t.hash=function(i,s){if(i=Bn(i,"#"),s||i==="")return i;var o=new URL("https://example.com");return o.hash=i,o.hash?o.hash.substring(1,o.hash.length):""}(e.hash,u)),t}function tu(t){return t.replace(/([+*?:{}()\\])/g,"\\$1")}function o0(t,e){for(var u="[^"+(e.delimiter||"/#?").replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")+"]+?",r=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/,n="",i=0;i<t.length;++i){var s=t[i],o=i>0?t[i-1]:null,a=i<t.length-1?t[i+1]:null;if(typeof s!="string")if(s.pattern!==""){var c=typeof s.name!="number",h=e.prefixes!==void 0?e.prefixes:"./",l=s.suffix!==""||s.prefix!==""&&(s.prefix.length!==1||!h.includes(s.prefix));l||!c||s.pattern!==u||s.modifier!==""||!a||a.prefix||a.suffix||(l=typeof a=="string"?r.test(a.length>0?a[0]:""):typeof a.name=="number"),!l&&s.prefix===""&&o&&typeof o=="string"&&o.length>0&&(l=h.includes(o[o.length-1])),l&&(n+="{"),n+=tu(s.prefix),c&&(n+=":"+s.name),s.pattern===".*"?n+=c||o&&typeof o!="string"&&!o.modifier&&!l&&s.prefix===""?"(.*)":"*":s.pattern===u?c||(n+="("+u+")"):n+="("+s.pattern+")",s.pattern===u&&c&&s.suffix!==""&&r.test(s.suffix[0])&&(n+="\\"),n+=tu(s.suffix),l&&(n+="}"),n+=s.modifier}else{if(s.modifier===""){n+=tu(s.prefix);continue}n+="{"+tu(s.prefix)+"}"+s.modifier}else n+=tu(s)}return n}var c0=function(){function t(u,r){u===void 0&&(u={}),this.pattern=void 0,this.regexp={},this.keys={},this.component_pattern={};try{if(typeof u=="string"){var n=new s0(u);if(n.parse(),u=n.result,r){if(typeof r!="string")throw new TypeError("'baseURL' parameter is not of type 'string'.");u.baseURL=r}else if(typeof u.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if(r)throw new TypeError("parameter 1 is not of type 'string'.");if(!u||typeof u!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");var i;this.pattern=nr({pathname:"*",protocol:"*",username:"*",password:"*",hostname:"*",port:"*",search:"*",hash:"*"},u,!0),Xi(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");for(var s,o=Pu(a0);!(s=o()).done;)if((i=s.value)in this.pattern){var a={},c=this.pattern[i];switch(this.keys[i]=[],i){case"protocol":Object.assign(a,de),a.encodePart=Mr;break;case"username":Object.assign(a,de),a.encodePart=t0;break;case"password":Object.assign(a,de),a.encodePart=e0;break;case"hostname":Object.assign(a,Yo),a.encodePart=Vi(c)?Yi:Qi;break;case"port":Object.assign(a,de),a.encodePart=Ji;break;case"pathname":Zi(this.regexp.protocol)?(Object.assign(a,Jo),a.encodePart=u0):(Object.assign(a,de),a.encodePart=r0);break;case"search":Object.assign(a,de),a.encodePart=n0;break;case"hash":Object.assign(a,de),a.encodePart=i0}try{var h=Wi(c,a);this.regexp[i]=qi(h,this.keys[i],a),this.component_pattern[i]=o0(h,a)}catch{throw new TypeError("invalid "+i+" pattern '"+this.pattern[i]+"'.")}}}catch(l){throw new TypeError("Failed to construct 'URLPattern': "+l.message)}}var e=t.prototype;return e.test=function(u,r){u===void 0&&(u={});var n,i={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof u!="string"&&r)throw new TypeError("parameter 1 is not of type 'string'.");if(u===void 0)return!1;try{i=nr(i,typeof u=="object"?u:vn(u,r),!1)}catch{return!1}for(n in this.pattern)if(!this.regexp[n].exec(i[n]))return!1;return!0},e.exec=function(u,r){u===void 0&&(u={});var n={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof u!="string"&&r)throw new TypeError("parameter 1 is not of type 'string'.");if(u!==void 0){try{n=nr(n,typeof u=="object"?u:vn(u,r),!1)}catch{return null}var i,s={};for(i in s.inputs=r?[u,r]:[u],this.pattern){var o=this.regexp[i].exec(n[i]);if(!o)return null;for(var a,c={},h=Pu(this.keys[i].entries());!(a=h()).done;){var l=a.value,D=l[1];typeof D.name!="string"&&typeof D.name!="number"||(c[D.name]=o[l[0]+1]||"")}s[i]={input:n[i]||"",groups:c}}return s}},Mi(t,[{key:"protocol",get:function(){return this.component_pattern.protocol}},{key:"username",get:function(){return this.component_pattern.username}},{key:"password",get:function(){return this.component_pattern.password}},{key:"hostname",get:function(){return this.component_pattern.hostname}},{key:"port",get:function(){return this.component_pattern.port}},{key:"pathname",get:function(){return this.component_pattern.pathname}},{key:"search",get:function(){return this.component_pattern.search}},{key:"hash",get:function(){return this.component_pattern.hash}}]),t}();const l0={setInterval:Hi,setTimeout:Ni,WeakRef:Ui,Blob:Lo,Request:Mo,Response:jo,Headers:Wo,WritableStream:Ko,TransformStream:zo,ReadableStream:Fr,TransformStreamDefaultController:qo,WritableStreamDefaultWriter:Vo,WebSocket:Go,TextEncoder:Lr,TextDecoder:Li,URLPattern:c0};h0(globalThis,l0);function h0(t,e){return new Proxy(t,{get(u,r,n){return r in e?e[r]:t[r]},set(u,r,n){return r in e&&delete e[r],t[r]=n,!0},deleteProperty(u,r){let n=!1;return r in e&&(delete e[r],n=!0),r in t&&(delete t[r],n=!0),n},ownKeys(u){const r=Reflect.ownKeys(t),n=Reflect.ownKeys(e),i=new Set(n);return[...r.filter(s=>!i.has(s)),...n]},defineProperty(u,r,n){return r in e&&delete e[r],Reflect.defineProperty(t,r,n),!0},getOwnPropertyDescriptor(u,r){return r in e?Reflect.getOwnPropertyDescriptor(e,r):Reflect.getOwnPropertyDescriptor(t,r)},has(u,r){return r in e||r in t}})}var Tt={};Object.defineProperty(Tt,"__esModule",{value:!0});function Ge(t,e,u){var r;if(u===void 0&&(u={}),!e.codes){e.codes={};for(var n=0;n<e.chars.length;++n)e.codes[e.chars[n]]=n}if(!u.loose&&t.length*e.bits&7)throw new SyntaxError("Invalid padding");for(var i=t.length;t[i-1]==="=";)if(--i,!u.loose&&!((t.length-i)*e.bits&7))throw new SyntaxError("Invalid padding");for(var s=new((r=u.out)!=null?r:Uint8Array)(i*e.bits/8|0),o=0,a=0,c=0,h=0;h<i;++h){var l=e.codes[t[h]];if(l===void 0)throw new SyntaxError("Invalid character "+t[h]);a=a<<e.bits|l,o+=e.bits,o>=8&&(o-=8,s[c++]=255&a>>o)}if(o>=e.bits||255&a<<8-o)throw new SyntaxError("Unexpected end of data");return s}function Ze(t,e,u){u===void 0&&(u={});for(var r=u,n=r.pad,i=n===void 0?!0:n,s=(1<<e.bits)-1,o="",a=0,c=0,h=0;h<t.length;++h)for(c=c<<8|255&t[h],a+=8;a>e.bits;)a-=e.bits,o+=e.chars[s&c>>a];if(a&&(o+=e.chars[s&c<<e.bits-a]),i)for(;o.length*e.bits&7;)o+="=";return o}var _n={chars:"0123456789ABCDEF",bits:4},xn={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},Sn={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},kn={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},In={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},D0={parse:function(e,u){return Ge(e.toUpperCase(),_n,u)},stringify:function(e,u){return Ze(e,_n,u)}},f0={parse:function(e,u){return u===void 0&&(u={}),Ge(u.loose?e.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):e,xn,u)},stringify:function(e,u){return Ze(e,xn,u)}},d0={parse:function(e,u){return Ge(e,Sn,u)},stringify:function(e,u){return Ze(e,Sn,u)}},p0={parse:function(e,u){return Ge(e,kn,u)},stringify:function(e,u){return Ze(e,kn,u)}},m0={parse:function(e,u){return Ge(e,In,u)},stringify:function(e,u){return Ze(e,In,u)}},A0={parse:Ge,stringify:Ze};Tt.base16=D0;Tt.base32=f0;Tt.base32hex=d0;Tt.base64=p0;Tt.base64url=m0;Tt.codec=A0;const C0=Tt.base16,w0=Tt.base32,E0=Tt.base32hex,g0=Tt.base64,F0=Tt.base64url,y0=Tt.codec,b0=Object.freeze(Object.defineProperty({__proto__:null,base16:C0,base32:w0,base32hex:E0,base64:g0,base64url:F0,codec:y0,default:Tt},Symbol.toStringTag,{value:"Module"}));var xe={};Object.defineProperty(xe,"__esModule",{value:!0});var ts=xe.Hash=es=xe.createHash=void 0;const B0=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],Tn={sha256:1};function v0(t){if(t&&!Tn[t]&&!Tn[t.toLowerCase()])throw new Error("Digest method not supported");return new us}var es=xe.createHash=v0;class us{constructor(){this.A=1779033703,this.B=-1150833019,this.C=1013904242,this.D=-1521486534,this.E=1359893119,this.F=-1694144372,this.G=528734635,this.H=1541459225,this._size=0,this._sp=0,(!vu||eu>=8e3)&&(vu=new ArrayBuffer(8e3),eu=0),this._byte=new Uint8Array(vu,eu,80),this._word=new Int32Array(vu,eu,20),eu+=80}update(e){if(typeof e=="string")return this._utf8(e);if(e==null)throw new TypeError("Invalid type: "+typeof e);const u=e.byteOffset,r=e.byteLength;let n=r/64|0,i=0;if(n&&!(u&3)&&!(this._size%64)){const o=new Int32Array(e.buffer,u,n*16);for(;n--;)this._int32(o,i>>2),i+=64;this._size+=i}if(e.BYTES_PER_ELEMENT!==1&&e.buffer){const o=new Uint8Array(e.buffer,u+i,r-i);return this._uint8(o)}return i===r?this:this._uint8(e,i)}_uint8(e,u){const{_byte:r,_word:n}=this,i=e.length;for(u=u|0;u<i;){const s=this._size%64;let o=s;for(;u<i&&o<64;)r[o++]=e[u++];o>=64&&this._int32(n),this._size+=o-s}return this}_utf8(e){const{_byte:u,_word:r}=this,n=e.length;let i=this._sp;for(let s=0;s<n;){const o=this._size%64;let a=o;for(;s<n&&a<64;){let c=e.charCodeAt(s++)|0;c<128?u[a++]=c:c<2048?(u[a++]=192|c>>>6,u[a++]=128|c&63):c<55296||c>57343?(u[a++]=224|c>>>12,u[a++]=128|c>>>6&63,u[a++]=128|c&63):i?(c=((i&1023)<<10)+(c&1023)+65536,u[a++]=240|c>>>18,u[a++]=128|c>>>12&63,u[a++]=128|c>>>6&63,u[a++]=128|c&63,i=0):i=c}a>=64&&(this._int32(r),r[0]=r[16]),this._size+=a-o}return this._sp=i,this}_int32(e,u){let{A:r,B:n,C:i,D:s,E:o,F:a,G:c,H:h}=this,l=0;for(u=u|0;l<16;)ye[l++]=Ut(e[u++]);for(l=16;l<64;l++)ye[l]=P0(ye[l-2])+ye[l-7]+R0(ye[l-15])+ye[l-16]|0;for(l=0;l<64;l++){const D=h+T0(o)+S0(o,a,c)+B0[l]+ye[l]|0,p=I0(r)+k0(r,n,i)|0;h=c,c=a,a=o,o=s+D|0,s=i,i=n,n=r,r=D+p|0}this.A=r+this.A|0,this.B=n+this.B|0,this.C=i+this.C|0,this.D=s+this.D|0,this.E=o+this.E|0,this.F=a+this.F|0,this.G=c+this.G|0,this.H=h+this.H|0}digest(e){const{_byte:u,_word:r}=this;let n=this._size%64|0;for(u[n++]=128;n&3;)u[n++]=0;if(n>>=2,n>14){for(;n<16;)r[n++]=0;n=0,this._int32(r)}for(;n<16;)r[n++]=0;const i=this._size*8,s=(i&4294967295)>>>0,o=(i-s)/4294967296;return o&&(r[14]=Ut(o)),s&&(r[15]=Ut(s)),this._int32(r),e==="hex"?this._hex():this._bin()}_hex(){const{A:e,B:u,C:r,D:n,E:i,F:s,G:o,H:a}=this;return he(e)+he(u)+he(r)+he(n)+he(i)+he(s)+he(o)+he(a)}_bin(){const{A:e,B:u,C:r,D:n,E:i,F:s,G:o,H:a,_byte:c,_word:h}=this;return h[0]=Ut(e),h[1]=Ut(u),h[2]=Ut(r),h[3]=Ut(n),h[4]=Ut(i),h[5]=Ut(s),h[6]=Ut(o),h[7]=Ut(a),c.slice(0,32)}}ts=xe.Hash=us;const ye=new Int32Array(64);let vu,eu=0;const he=t=>(t+4294967296).toString(16).substr(-8),_0=t=>t<<24&4278190080|t<<8&16711680|t>>8&65280|t>>24&255,x0=t=>t,Ut=$0()?x0:_0,S0=(t,e,u)=>u^t&(e^u),k0=(t,e,u)=>t&e|u&(t|e),I0=t=>(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),T0=t=>(t>>>6|t<<26)^(t>>>11|t<<21)^(t>>>25|t<<7),R0=t=>(t>>>7|t<<25)^(t>>>18|t<<14)^t>>>3,P0=t=>(t>>>17|t<<15)^(t>>>19|t<<13)^t>>>10;function $0(){return new Uint8Array(new Uint16Array([65279]).buffer)[0]===254}const O0=Fs({__proto__:null,get Hash(){return ts},get createHash(){return es},default:xe},[xe]),H0={};/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const ht=BigInt(0),q=BigInt(1),xt=BigInt(2),rs=BigInt(255),Rn=xt**BigInt(252)+BigInt("27742317777372353535851937790883648493"),tt={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:xt**rs-BigInt(19),l:Rn,n:Rn,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},ns=xt**BigInt(256),au=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");const N0=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),U0=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),L0=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),M0=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class V{constructor(e,u,r,n){this.x=e,this.y=u,this.z=r,this.t=n}static fromAffine(e){if(!(e instanceof st))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(st.ZERO)?V.ZERO:new V(e.x,e.y,q,w(e.x*e.y))}static toAffineBatch(e){const u=z0(e.map(r=>r.z));return e.map((r,n)=>r.toAffine(u[n]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){Pn(e);const{x:u,y:r,z:n}=this,{x:i,y:s,z:o}=e,a=w(u*o),c=w(i*n),h=w(r*o),l=w(s*n);return a===c&&h===l}negate(){return new V(w(-this.x),this.y,this.z,w(-this.t))}double(){const{x:e,y:u,z:r}=this,{a:n}=tt,i=w(e**xt),s=w(u**xt),o=w(xt*w(r**xt)),a=w(n*i),c=w(w((e+u)**xt)-i-s),h=a+s,l=h-o,D=a-s,p=w(c*l),f=w(h*D),d=w(c*D),A=w(l*h);return new V(p,f,A,d)}add(e){Pn(e);const{x:u,y:r,z:n,t:i}=this,{x:s,y:o,z:a,t:c}=e,h=w((r-u)*(o+s)),l=w((r+u)*(o-s)),D=w(l-h);if(D===ht)return this.double();const p=w(n*xt*c),f=w(i*xt*a),d=f+p,A=l+h,x=f-p,y=w(d*D),m=w(A*x),F=w(d*x),g=w(D*A);return new V(y,m,g,F)}subtract(e){return this.add(e.negate())}precomputeWindow(e){const u=1+256/e,r=[];let n=this,i=n;for(let s=0;s<u;s++){i=n,r.push(i);for(let o=1;o<2**(e-1);o++)i=i.add(n),r.push(i);n=i.double()}return r}wNAF(e,u){!u&&this.equals(V.BASE)&&(u=st.BASE);const r=u&&u._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let n=u&&yr.get(u);n||(n=this.precomputeWindow(r),u&&r!==1&&(n=V.normalizeZ(n),yr.set(u,n)));let i=V.ZERO,s=V.ZERO;const o=1+256/r,a=2**(r-1),c=BigInt(2**r-1),h=2**r,l=BigInt(r);for(let D=0;D<o;D++){const p=D*a;let f=Number(e&c);if(e>>=l,f>a&&(f-=h,e+=q),f===0){let d=n[p];D%2&&(d=d.negate()),s=s.add(d)}else{let d=n[p+Math.abs(f)-1];f<0&&(d=d.negate()),i=i.add(d)}}return V.normalizeZ([i,s])[0]}multiply(e,u){return this.wNAF($u(e,tt.l),u)}multiplyUnsafe(e){let u=$u(e,tt.l,!1);const r=V.BASE,n=V.ZERO;if(u===ht)return n;if(this.equals(n)||u===q)return this;if(this.equals(r))return this.wNAF(u);let i=n,s=this;for(;u>ht;)u&q&&(i=i.add(s)),s=s.double(),u>>=q;return i}isSmallOrder(){return this.multiplyUnsafe(tt.h).equals(V.ZERO)}isTorsionFree(){return this.multiplyUnsafe(tt.l).equals(V.ZERO)}toAffine(e=zu(this.z)){const{x:u,y:r,z:n}=this,i=w(u*e),s=w(r*e);if(w(n*e)!==q)throw new Error("invZ was invalid");return new st(i,s)}fromRistrettoBytes(){sr()}toRistrettoBytes(){sr()}fromRistrettoHash(){sr()}}V.BASE=new V(tt.Gx,tt.Gy,q,w(tt.Gx*tt.Gy));V.ZERO=new V(ht,q,q,ht);function Pn(t){if(!(t instanceof V))throw new TypeError("ExtendedPoint expected")}function ir(t){if(!(t instanceof Ot))throw new TypeError("RistrettoPoint expected")}function sr(){throw new Error("Legacy method: switch to RistrettoPoint")}class Ot{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){const{d:u}=tt,r=w(au*e*e),n=w((r+q)*L0);let i=BigInt(-1);const s=w((i-u*r)*w(r+u));let{isValid:o,value:a}=jr(n,s),c=w(a*e);pe(c)||(c=w(-c)),o||(a=c),o||(i=r);const h=w(i*(r-q)*M0-s),l=a*a,D=w((a+a)*s),p=w(h*N0),f=w(q-l),d=w(q+l);return new V(w(D*d),w(f*p),w(p*d),w(D*f))}static hashToCurve(e){e=Ae(e,64);const u=ar(e.slice(0,32)),r=this.calcElligatorRistrettoMap(u),n=ar(e.slice(32,64)),i=this.calcElligatorRistrettoMap(n);return new Ot(r.add(i))}static fromHex(e){e=Ae(e,32);const{a:u,d:r}=tt,n="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",i=ar(e);if(!K0(Au(i),e)||pe(i))throw new Error(n);const s=w(i*i),o=w(q+u*s),a=w(q-u*s),c=w(o*o),h=w(a*a),l=w(u*r*c-h),{isValid:D,value:p}=$n(w(l*h)),f=w(p*a),d=w(p*f*l);let A=w((i+i)*f);pe(A)&&(A=w(-A));const x=w(o*d),y=w(A*x);if(!D||pe(y)||x===ht)throw new Error(n);return new Ot(new V(A,x,q,y))}toRawBytes(){let{x:e,y:u,z:r,t:n}=this.ep;const i=w(w(r+u)*w(r-u)),s=w(e*u),{value:o}=$n(w(i*s**xt)),a=w(o*i),c=w(o*s),h=w(a*c*n);let l;if(pe(n*h)){let p=w(u*au),f=w(e*au);e=p,u=f,l=w(a*U0)}else l=c;pe(e*h)&&(u=w(-u));let D=w((r-u)*l);return pe(D)&&(D=w(-D)),Au(D)}toHex(){return Fu(this.toRawBytes())}toString(){return this.toHex()}equals(e){ir(e);const u=this.ep,r=e.ep,n=w(u.x*r.y)===w(u.y*r.x),i=w(u.y*r.y)===w(u.x*r.x);return n||i}add(e){return ir(e),new Ot(this.ep.add(e.ep))}subtract(e){return ir(e),new Ot(this.ep.subtract(e.ep))}multiply(e){return new Ot(this.ep.multiply(e))}multiplyUnsafe(e){return new Ot(this.ep.multiplyUnsafe(e))}}Ot.BASE=new Ot(V.BASE);Ot.ZERO=new Ot(V.ZERO);const yr=new WeakMap;class st{constructor(e,u){this.x=e,this.y=u}_setWindowSize(e){this._WINDOW_SIZE=e,yr.delete(this)}static fromHex(e,u=!0){const{d:r,P:n}=tt;e=Ae(e,32);const i=e.slice();i[31]=e[31]&-129;const s=Xe(i);if(u&&s>=n)throw new Error("Expected 0 < hex < P");if(!u&&s>=ns)throw new Error("Expected 0 < hex < 2**256");const o=w(s*s),a=w(o-q),c=w(r*o+q);let{isValid:h,value:l}=jr(a,c);if(!h)throw new Error("Point.fromHex: invalid y coordinate");const D=(l&q)===q;return(e[31]&128)!==0!==D&&(l=w(-l)),new st(l,s)}static async fromPrivateKey(e){return(await qu(e)).point}toRawBytes(){const e=Au(this.y);return e[31]|=this.x&q?128:0,e}toHex(){return Fu(this.toRawBytes())}toX25519(){const{y:e}=this,u=w((q+e)*zu(q-e));return Au(u)}isTorsionFree(){return V.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new st(w(-this.x),this.y)}add(e){return V.fromAffine(this).add(V.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return V.fromAffine(this).multiply(e,this).toAffine()}}st.BASE=new st(tt.Gx,tt.Gy);st.ZERO=new st(ht,q);class mu{constructor(e,u){this.r=e,this.s=u,this.assertValidity()}static fromHex(e){const u=Ae(e,64),r=st.fromHex(u.slice(0,32),!1),n=Xe(u.slice(32,64));return new mu(r,n)}assertValidity(){const{r:e,s:u}=this;if(!(e instanceof st))throw new Error("Expected Point instance");return $u(u,tt.l,!1),this}toRawBytes(){const e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(Au(this.s),32),e}toHex(){return Fu(this.toRawBytes())}}function j0(...t){if(!t.every(r=>r instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(t.length===1)return t[0];const e=t.reduce((r,n)=>r+n.length,0),u=new Uint8Array(e);for(let r=0,n=0;r<t.length;r++){const i=t[r];u.set(i,n),n+=i.length}return u}const W0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Fu(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let u=0;u<t.length;u++)e+=W0[t[u]];return e}function is(t){if(typeof t!="string")throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const e=new Uint8Array(t.length/2);for(let u=0;u<e.length;u++){const r=u*2,n=t.slice(r,r+2),i=Number.parseInt(n,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");e[u]=i}return e}function ss(t){const u=t.toString(16).padStart(64,"0");return is(u)}function Au(t){return ss(t).reverse()}function pe(t){return(w(t)&q)===q}function Xe(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+Fu(Uint8Array.from(t).reverse()))}function ar(t){return w(Xe(t)&xt**rs-q)}function w(t,e=tt.P){const u=t%e;return u>=ht?u:e+u}function zu(t,e=tt.P){if(t===ht||e<=ht)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let u=w(t,e),r=e,n=ht,i=q;for(;u!==ht;){const o=r/u,a=r%u,c=n-i*o;r=u,u=a,n=i,i=c}if(r!==q)throw new Error("invert: does not exist");return w(n,e)}function z0(t,e=tt.P){const u=new Array(t.length),r=t.reduce((i,s,o)=>s===ht?i:(u[o]=i,w(i*s,e)),q),n=zu(r,e);return t.reduceRight((i,s,o)=>s===ht?i:(u[o]=w(i*u[o],e),w(i*s,e)),n),u}function zt(t,e){const{P:u}=tt;let r=t;for(;e-- >ht;)r*=r,r%=u;return r}function q0(t){const{P:e}=tt,u=BigInt(5),r=BigInt(10),n=BigInt(20),i=BigInt(40),s=BigInt(80),a=t*t%e*t%e,c=zt(a,xt)*a%e,h=zt(c,q)*t%e,l=zt(h,u)*h%e,D=zt(l,r)*l%e,p=zt(D,n)*D%e,f=zt(p,i)*p%e,d=zt(f,s)*f%e,A=zt(d,s)*f%e,x=zt(A,r)*l%e;return{pow_p_5_8:zt(x,xt)*t%e,b2:a}}function jr(t,e){const u=w(e*e*e),r=w(u*u*e),n=q0(t*r).pow_p_5_8;let i=w(t*u*n);const s=w(e*i*i),o=i,a=w(i*au),c=s===t,h=s===w(-t),l=s===w(-t*au);return c&&(i=o),(h||l)&&(i=a),pe(i)&&(i=w(-i)),{isValid:c||h,value:i}}function $n(t){return jr(q,t)}async function br(...t){const e=await Ku.sha512(j0(...t)),u=Xe(e);return w(u,tt.l)}function K0(t,e){if(t.length!==e.length)return!1;for(let u=0;u<t.length;u++)if(t[u]!==e[u])return!1;return!0}function Ae(t,e){const u=t instanceof Uint8Array?Uint8Array.from(t):is(t);if(typeof e=="number"&&u.length!==e)throw new Error(`Expected ${e} bytes`);return u}function $u(t,e,u=!0){if(!e)throw new TypeError("Specify max value");if(typeof t=="number"&&Number.isSafeInteger(t)&&(t=BigInt(t)),typeof t=="bigint"&&t<e){if(u){if(ht<t)return t}else if(ht<=t)return t}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function V0(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}async function qu(t){if(t=typeof t=="bigint"||typeof t=="number"?ss($u(t,ns)):Ae(t),t.length!==32)throw new Error("Expected 32 bytes");const e=await Ku.sha512(t),u=V0(e.slice(0,32)),r=e.slice(32,64),n=w(Xe(u),tt.l),i=st.BASE.multiply(n),s=i.toRawBytes();return{head:u,prefix:r,scalar:n,point:i,pointBytes:s}}async function G0(t){return(await qu(t)).pointBytes}async function Z0(t,e){t=Ae(t);const{prefix:u,scalar:r,pointBytes:n}=await qu(e),i=await br(u,t),s=st.BASE.multiply(i),o=await br(s.toRawBytes(),n,t),a=w(i+o*r,tt.l);return new mu(s,a).toRawBytes()}async function X0(t,e,u){e=Ae(e),u instanceof st||(u=st.fromHex(u,!1));const{r,s:n}=t instanceof mu?t.assertValidity():mu.fromHex(t),i=V.BASE.multiplyUnsafe(n),s=await br(r.toRawBytes(),u.toRawBytes(),e),o=V.fromAffine(u).multiplyUnsafe(s);return V.fromAffine(r).add(o).subtract(i).multiplyUnsafe(tt.h).equals(V.ZERO)}st.BASE._setWindowSize(8);const De={node:H0,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},Ku={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:Fu,getExtendedPublicKey:qu,mod:w,invert:zu,hashToPrivateScalar:t=>{if(t=Ae(t),t.length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const e=w(Xe(t),tt.l);if(e===ht||e===q)throw new Error("Invalid private key");return e},randomBytes:(t=32)=>{if(De.web)return De.web.getRandomValues(new Uint8Array(t));if(De.node){const{randomBytes:e}=De.node;return new Uint8Array(e(t).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Ku.randomBytes(32),sha512:async t=>{if(De.web){const e=await De.web.subtle.digest("SHA-512",t.buffer);return new Uint8Array(e)}else{if(De.node)return Uint8Array.from(De.node.createHash("sha512").update(t).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(t=8,e=st.BASE){const u=e.equals(st.BASE)?e:new st(e.x,e.y);return u._setWindowSize(t),u.multiply(xt),u}};var M=globalThis&&globalThis.__classPrivateFieldGet||function(t,e,u,r){if(u==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return u==="m"?r:u==="a"?r.call(t):r?r.value:e.get(t)},it=globalThis&&globalThis.__classPrivateFieldSet||function(t,e,u,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(t,u):n?n.value=u:e.set(t,u),u},te,ee,ue,re,ne,ie,be,Et;const nt=11400714785074694791n,ft=14029467366897019727n,On=1609587929392839161n,uu=9650029242287828579n,Hn=2870177450012600261n,as=64n,Q0=2n**as-1n,Y0=new Lr;function Nn(t,e,u,r){return BigInt(t)|BigInt(e)<<16n|BigInt(u)<<32n|BigInt(r)<<48n}function Jt(t,e){return BigInt(t[e])|BigInt(t[e+1])<<8n|BigInt(t[e+2])<<16n|BigInt(t[e+3])<<24n|BigInt(t[e+4])<<32n|BigInt(t[e+5])<<40n|BigInt(t[e+6])<<48n|BigInt(t[e+7])<<56n}function ot(t,e){return t<<e&Q0|t>>as-e}function N(t){return BigInt.asUintN(64,t)}class J0{constructor(e=0){te.set(this,void 0),ee.set(this,void 0),ue.set(this,void 0),re.set(this,void 0),ne.set(this,void 0),ie.set(this,void 0),be.set(this,void 0),Et.set(this,void 0),this.reset(e)}reset(e=M(this,te,"f")){return it(this,te,BigInt.asUintN(32,BigInt(e)),"f"),it(this,ee,N(M(this,te,"f")+nt+ft),"f"),it(this,ue,N(M(this,te,"f")+ft),"f"),it(this,re,M(this,te,"f"),"f"),it(this,ne,N(M(this,te,"f")-nt),"f"),it(this,ie,null,"f"),it(this,be,0,"f"),it(this,Et,0,"f"),this}update(e){typeof e=="string"&&(e=Y0.encode(e));let u=0,r=e.length,n=u+r;if(r===0)return this;if(it(this,be,M(this,be,"f")+r,"f"),M(this,Et,"f")===0&&it(this,ie,new Uint8Array(32),"f"),M(this,Et,"f")+r<32)return M(this,ie,"f").set(e.subarray(0,r),M(this,Et,"f")),it(this,Et,M(this,Et,"f")+r,"f"),this;if(M(this,Et,"f")>0){M(this,ie,"f").set(e.subarray(0,32-M(this,Et,"f")),M(this,Et,"f"));let i=0,s;s=Jt(M(this,ie,"f"),i),it(this,ee,N(ot(N(M(this,ee,"f")+s*ft),31n)*nt),"f"),i+=8,s=Jt(this.memory,i),it(this,ue,N(ot(N(M(this,ue,"f")+s*ft),31n)*nt),"f"),i+=8,s=Jt(this.memory,i),it(this,re,N(ot(N(M(this,re,"f")+s*ft),31n)*nt),"f"),i+=8,s=Jt(this.memory,i),it(this,ne,N(ot(N(M(this,ne,"f")+s*ft),31n)*nt),"f"),u+=32-M(this,Et,"f"),it(this,Et,0,"f")}if(u<=n-32){const i=n-32;do{let s;s=Jt(e,u),it(this,ee,N(ot(N(M(this,ee,"f")+s*ft),31n)*nt),"f"),u+=8,s=Jt(e,u),it(this,ue,N(ot(N(M(this,ue,"f")+s*ft),31n)*nt),"f"),u+=8,s=Jt(e,u),it(this,re,N(ot(N(M(this,re,"f")+s*ft),31n)*nt),"f"),u+=8,s=Jt(e,u),it(this,ne,N(ot(N(M(this,ne,"f")+s*ft),31n)*nt),"f"),u+=8}while(u<=i)}return u<n&&(M(this,ie,"f").set(e.subarray(u,n),M(this,Et,"f")),it(this,Et,n-u,"f")),this}digest(){let e=M(this,ie,"f"),u=M(this,Et,"f"),r=0,n=0n,i=0n,s=0n;for(M(this,be,"f")>=32?(n=ot(M(this,ee,"f"),1n)+ot(M(this,ue,"f"),7n)+ot(M(this,re,"f"),12n)+ot(M(this,ne,"f"),18n),n=N(n^ot(N(M(this,ee,"f")*ft),31n)*nt),n=N(n*nt+uu),n=N(n^ot(N(M(this,ue,"f")*ft),31n)*nt),n=N(n*nt+uu),n=N(n^ot(N(M(this,re,"f")*ft),31n)*nt),n=N(n*nt+uu),n=N(n^ot(N(M(this,ne,"f")*ft),31n)*nt),n=N(n*nt+uu)):n=N(M(this,te,"f")+Hn),n+=BigInt(M(this,be,"f"));r<=u-8;)s=Jt(e,r),s=N(ot(N(s*ft),31n)*nt),n=N(ot(n^s,27n)*nt+uu),r+=8;for(r+4<=u&&(s=Nn(e[r+1]<<8|e[r],e[r+3]<<8|e[r+2],0,0),n=N(ot(n^N(s*nt),23n)*ft+On),r+=4);r<u;)s=Nn(e[r++],0,0,0),n=N(ot(n^N(s*Hn),11n)*nt);return i=N(n>>33n),n=N((n^i)*ft),i=N(n>>29n),n=N((n^i)*On),i=N(n>>32n),n=N(n^i),n}}te=new WeakMap,ee=new WeakMap,ue=new WeakMap,re=new WeakMap,ne=new WeakMap,ie=new WeakMap,be=new WeakMap,Et=new WeakMap;function tc(t,e=0){return new J0(e).update(t).digest()}globalThis&&globalThis.__classPrivateFieldGet;globalThis&&globalThis.__classPrivateFieldSet;new Li;const ec=new Lr;function Br(t){return ec.encode(t)}function uc(t){return Br(t).length}function vr(t,e){for(let u of t)if(e.indexOf(u)===-1)return!1;return!0}function Un(t){return t===""?!1:yu.indexOf(t)!==-1}const Qe="abcdefghijklmnopqrstuvwxyz",rc=Qe.toUpperCase(),yu="0123456789",le=Qe+"234567",os=Qe+yu,nc=le,cs=os+le+"@.",ls=Qe+yu,ic=Qe+yu,hs=ls+le+"+.",sc="/'()-._~!$&+,:=@%",Ds=Qe+rc+yu+sc;function ac(t,e){return`@${t}.${e}`}function oc(t,e){return`+${t}.${e}`}function Wr(t){const e=fs(t);return Oi(e)?!0:e}function zr(t){const e=ds(t);return Oi(e)?!0:e}function _r(t){return t.startsWith("@")?fs(t):t.startsWith("+")?ds(t):new _("address must start with either @ or +")}function fs(t){return ps(t,{sigil:"@",separator:".",minNameLength:4,maxNameLength:4,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:os,allowedPubkeyCharacters:nc,pubkeyMustStartWithB:!0})}function ds(t){return ps(t,{sigil:"+",separator:".",minNameLength:1,maxNameLength:15,minPubkeyLength:1,maxPubkeyLength:53,allowedNameCharacters:ls,allowedPubkeyCharacters:ic,pubkeyMustStartWithB:!1})}function ps(t,e){const{sigil:u,separator:r,minNameLength:n,maxNameLength:i,minPubkeyLength:s,maxPubkeyLength:o,allowedNameCharacters:a,allowedPubkeyCharacters:c,pubkeyMustStartWithB:h}=e;if(typeof t!="string")return new _("address must be a string");if(t.length<4)return new _("address is too short");if(t[0]!==u)return new _(`address must start with a sigil: "${u}"`);if(t.indexOf(r)===-1)return new _(`address must contain a separator character: "${r}"`);const l=t.slice(1).split(r);if(l.length!==2)return new _(`address must have exactly 2 parts separated by a "${r}" separator`);const[D,p]=l;return D.length<n||D.length>i?new _(`name must be between ${n} and ${i} characters long, but is ${D.length}`):p.length<s||p.length>o?new _(`pubkey must be between ${s} and ${o} characters long, but is ${p.length}`):vr(D,a)?vr(p,c)?Un(D[0])?new _(`name "${D}" must not start with a digit`):Un(p[0])?new _(`pubkey "${p}" must not start with a digit`):h&&p[0]!=="b"?new _(`pubkey "${p}" must start with 'b'`):{address:t,name:D,pubkey:p}:new _(`pubkey "${p}" must only have allowed characters`):new _(`name "${D}" must only have allowed characters`)}function qr(t){return!(Object.prototype.toString.call(t)!=="[object Object]"||(""+t.constructor).startsWith("class"))}function ms(t){return e=>e!==t?`expected literal value ${JSON.stringify(t)}`:null}function It(t={}){return e=>{if(t.optional!==!0&&e===void 0)return"required";if(t.optional===!0&&e===void 0)return null;let u=uc(e);return typeof e!="string"?"expected a string but got "+JSON.stringify(e):t.minLen!==void 0&&u<t.minLen?`string shorter than min length of ${t.minLen} chars`:t.maxLen!==void 0&&u>t.maxLen?`string shorter than max length of ${t.maxLen} chars`:t.len!==void 0&&u!==t.len?`string does not have required length of ${t.len} chars: ${e}`:t.allowedChars!==void 0&&!vr(e,t.allowedChars)?"contains disallowed characters":null}}function ou(t={}){return e=>t.optional!==!0&&e===void 0?"required":t.optional===!0&&e===void 0?null:t.nullable!==!0&&e===null?"not nullable":t.nullable===!0&&e===null?null:typeof e!="number"?"expected a number but got "+JSON.stringify(e):isNaN(e)?"is NaN":isFinite(e)?e!==Math.round(e)?"expected an integer":t.min!==void 0&&e<t.min?`integer too small (must be >= ${t.min})`:t.max!==void 0&&e>t.max?`integer too large (must be <= ${t.max})`:null:"is Infinity"}function As(t={}){return t.allowLiteralUndefined=t.allowLiteralUndefined??!1,t.allowExtraKeys=t.allowExtraKeys??!1,e=>{if(!qr(e))return"expected an object";if(t.allowLiteralUndefined===!1){for(let[u,r]of Object.entries(e))if(r===void 0)return`${u} is explicitly set to undefined but should be missing instead`}if(t.objSchema!==void 0){if(t.allowExtraKeys===!1){let u=Object.keys(e),r=Object.keys(t.objSchema),n=u.filter(i=>r.indexOf(i)===-1);if(n.length>0)return`object has extra keys not in the schema: ${n.join(", ")}`}for(let[u,r]of Object.entries(t.objSchema)){let n=r(e[u]);if(n!==null)return`${u}: ${n}`}}return null}}const{codec:Cs}=b0,ws={chars:"abcdefghijklmnopqrstuvwxyz234567",bits:5};function $e(t){return"b"+Cs.stringify(t,ws,{pad:!1})}function Ou(t){if(!t.startsWith("b"))throw new _("can't decode base32 string - it should start with a 'b'. "+t);if(t[t.length-1]==="=")throw new _("can't decode base32 string - it contains padding characters ('=')");return Cs.parse(t.slice(1),ws,{loose:!0})}var ae;(function(t){t[t.None=-1]="None",t[t.Error=0]="Error",t[t.Warn=1]="Warn",t[t.Log=2]="Log",t[t.Info=3]="Info",t[t.Debug=4]="Debug"})(ae||(ae={}));const cc=ae.Error;let or={_default:cc};function lc(t){return t in or?or[t]:or._default}class $t{constructor(e,u){Object.defineProperty(this,"source",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.source=e,this.color=u||"aqua"}_print(e,u,r,...n){if(e<=lc(this.source))if(u){const i=`[${this.source}]`;if(this.color!==void 0){const s=[`%c ${i}`,`color: ${this.color}`];console.log(r,...s,...n)}else console.log(r,i,...n)}else console.log(r,...n)}error(...e){this._print(ae.Error,!0,"!!",...e)}warn(...e){this._print(ae.Warn,!0,"! ",...e)}log(...e){this._print(ae.Log,!0,"  ",...e)}info(...e){this._print(ae.Info,!0,"    ",...e)}debug(...e){this._print(ae.Debug,!0,"      ",...e)}blank(){this._print(ae.Info,!1,"")}}class hc{constructor(e){Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalDigest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.hash=e.hash,this.internalUpdate=e.update,this.internalDigest=e.digest}update(e){return this.hash=this.internalUpdate(this.hash,e),this.hash}digest(){return this.internalDigest(this.hash)}}const{createHash:cr}=O0,lr=new $t("crypto-driver-noble","cyan"),Dc=class{static sha256(t){return typeof t=="string"?Promise.resolve(cr("sha256").update(t,"utf-8").digest()):Promise.resolve(cr("sha256").update(t).digest())}static updatableSha256(){return new hc({hash:cr("sha256"),update:(t,e)=>t.update(e),digest:t=>t.digest()})}static async generateKeypairBytes(){lr.debug("generateKeypairBytes");const t=Ku.randomPrivateKey();return{pubkey:await G0(t),secret:t}}static sign(t,e){return lr.debug("sign"),typeof e=="string"&&(e=Br(e)),Z0(e,t.secret)}static async verify(t,e,u){lr.debug("verify");try{return typeof u=="string"&&(u=Br(u)),await X0(e,u,t)}catch{return!1}}};function fc(){return""+Math.floor(Math.random()*1e3)+Math.floor(Math.random()*1e3)}function dc(t){try{const e=Es(t)?t.address:t.shareAddress,u=_r(e);if(j(u))return u;const r={pubkey:Ou(u.pubkey),secret:Ou(t.secret)};return r.pubkey.length!==32?new _(`pubkey bytes should be 32 bytes long, not ${r.pubkey.length} after base32 decoding.  ${e}`):r.secret.length!==32?new _(`secret bytes should be 32 bytes long, not ${r.secret.length} after base32 decoding.  ${t.secret}`):r}catch(e){return new _("crash while decoding author keypair: "+e.message)}}function Es(t){return"address"in t}new $t("crypto","cyan");let Oe=Dc,ru=new $t("crypto","cyan");const mt=class{static async sha256base32(t){const e=await Oe.sha256(t);return $e(e)}static updatableSha256(){return Oe.updatableSha256()}static async generateAuthorKeypair(t){ru.debug(`generateAuthorKeypair("${t}")`);const e=await Oe.generateKeypairBytes(),u={address:ac(t,$e(e.pubkey)),secret:$e(e.secret)},r=Wr(u.address);return j(r)?r:u}static async generateShareKeypair(t){ru.debug(`generateAuthorKeypair("${t}")`);const e=await Oe.generateKeypairBytes(),u={shareAddress:oc(t,$e(e.pubkey)),secret:$e(e.secret)},r=zr(u.shareAddress);return j(r)?r:u}static async sign(t,e){ru.debug("sign");try{const u=dc(t);if(j(u))return u;const r=await Oe.sign(u,e);return $e(r)}catch(u){return new _("unexpected error while signing: "+u.message)}}static verify(t,e,u){ru.debug("verify");try{const r=_r(t);return j(r)?Promise.resolve(!1):Oe.verify(Ou(r.pubkey),Ou(e),u)}catch{return Promise.resolve(!1)}}static async checkKeypairIsValid(t){ru.debug("checkAuthorKeypairIsValid");const e=Es(t)?t.address:t.shareAddress;try{if(typeof e!="string"||typeof t.secret!="string")return new _("address and secret must be strings");const u=_r(e);if(j(u))return u;const r="a test message to sign. "+fc(),n=await this.sign(t,r);return j(n)?n:await this.verify(e,n,r)===!1?new _("pubkey does not match secret"):!0}catch(u){return new _("unexpected error in checkAuthorKeypairIsValid: "+u.message)}}};var hr;new $t("validator es.4","red");const pc=10,mc=pc*60*1e3*1e3,Ln=1e13,Mn=9007199254740990,Ac=4e6,Cc=53,wc=104,jn={objSchema:{format:ms("es.4"),author:It({allowedChars:cs}),content:It({maxLen:Ac}),contentHash:It({allowedChars:le,len:Cc}),deleteAfter:ou({min:Ln,max:Mn,nullable:!0}),path:It({allowedChars:Ds,minLen:2,maxLen:512}),signature:It({allowedChars:le,len:wc}),timestamp:ou({min:Ln,max:Mn}),workspace:It({allowedChars:hs})},allowLiteralUndefined:!1,allowExtraKeys:!1};hr=class{static hashDocument(t){const e={...t,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},u=this._checkBasicDocumentValidity(e);return j(u)?Promise.resolve(u):mt.sha256base32(`author	${t.author}
contentHash	${t.contentHash}
`+(t.deleteAfter===null?"":`deleteAfter	${t.deleteAfter}
`)+`format	${t.format}
path	${t.path}
timestamp	${t.timestamp}
workspace	${t.workspace}
`)}static async generateDocument({input:t,keypair:e,share:u,timestamp:r}){const n={format:"es.4",author:e.address,content:t.content,contentHash:await mt.sha256base32(t.content),deleteAfter:t.deleteAfter??null,path:t.path,timestamp:r,workspace:u,signature:"?"},i=await this.signDocument(e,n);return j(i)?i:{doc:i}}static async signDocument(t,e){const u=await this.hashDocument(e);if(j(u))return u;const r=await mt.sign(t,u);return j(r)?r:{...e,signature:r}}static async wipeDocument(t,e){if(e.content.length===0)return e;const u=this.removeExtraFields(e);if(j(u))return u;const n={...u.doc,content:"",contentHash:await mt.sha256base32(""),signature:"?"};return this.signDocument(t,n)}static removeExtraFields(t){if(!qr(t))return new _("doc is not a plain javascript object");const e=new Set(Object.keys(jn.objSchema||{})),u={},r={};for(const[n,i]of Object.entries(t))if(e.has(n))u[n]=i;else{if(!n.startsWith("_"))return new _("extra document fields must have names starting with an underscore");r[n]=i}return{doc:u,extras:r}}static async checkDocumentIsValid(t,e){e===void 0&&(e=Date.now()*1e3);const u=this._checkBasicDocumentValidity(t);if(j(u))return u;const r=this._checkTimestampIsOk(t.timestamp,t.deleteAfter,e);if(j(r))return r;const n=this._checkAuthorCanWriteToPath(t.author,t.path);if(j(n))return n;const i=this._checkPathIsValid(t.path,t.deleteAfter);if(j(i))return i;const s=Wr(t.author);if(j(s))return s;const o=zr(t.workspace);if(j(o))return o;const a=await this._checkAuthorSignatureIsValid(t);if(j(a))return a;const c=await this._checkContentMatchesHash(t.content,t.contentHash);return j(c)?c:!0}static _checkBasicDocumentValidity(t){const e=As(jn)(t);return e!==null?new _(e):!0}static _checkAuthorCanWriteToPath(t,e){return e.indexOf("~")===-1||e.indexOf("~"+t)!==-1?!0:new _(`author ${t} can't write to path ${e}`)}static _checkTimestampIsOk(t,e,u){if(t>u+mc)return new _("timestamp too far in the future");if(e!==null){if(u>e)return new _("ephemeral doc has expired");if(e<=t)return new _("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(t,e){if(!t.startsWith("/"))return new _("invalid path: must start with /");if(t.endsWith("/"))return new _("invalid path: must not end with /");if(t.startsWith("/@"))return new _('invalid path: must not start with "/@"');if(t.indexOf("//")!==-1)return new _("invalid path: must not contain two consecutive slashes");if(e!==void 0){if(t.indexOf("!")===-1&&e!==null)return new _("when deleteAfter is set, path must contain '!'");if(t.indexOf("!")!==-1&&e===null)return new _("when deleteAfter is null, path must not contain '!'")}return!0}static async _checkAuthorSignatureIsValid(t){try{const e=await this.hashDocument(t);return j(e)?e:await mt.verify(t.author,t.signature,e)!==!0?new _("signature is invalid"):!0}catch{return new _("signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(t,e){return await mt.sha256base32(t)!==e?new _("content does not match contentHash"):!0}static getAttachmentInfo(t){return new _("es.4 does not support attachments")}static updateAttachmentFields(t,e,u,r){return Promise.resolve(new _("es.4 does not support attachments"))}static authorFromCredentials(t){return t.address}},Object.defineProperty(hr,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.4"});var Dr;new $t("validator es.5","red");const Ec=10,gc=Ec*60*1e3*1e3,Wn=1e13,zn=9007199254740990,Fc=8e3,qn=53,Kn=104,yc=0,bc=Number.MAX_SAFE_INTEGER,Vn={objSchema:{format:ms("es.5"),author:It({allowedChars:cs}),text:It({maxLen:Fc}),textHash:It({allowedChars:le,len:qn}),deleteAfter:ou({min:Wn,max:zn,optional:!0}),path:It({allowedChars:Ds,minLen:2,maxLen:512}),signature:It({allowedChars:le,len:Kn}),shareSignature:It({allowedChars:le,len:Kn}),timestamp:ou({min:Wn,max:zn}),share:It({allowedChars:hs}),attachmentSize:ou({min:yc,max:bc,optional:!0}),attachmentHash:It({allowedChars:le,len:qn,optional:!0})},allowLiteralUndefined:!1,allowExtraKeys:!1};Dr=class{static hashDocument(t){const e={...t,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",shareSignature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},u=this._checkBasicDocumentValidity(e);return j(u)?Promise.resolve(u):mt.sha256base32((t.attachmentHash===void 0?"":`attachmentHash	${t.attachmentHash}
`)+(t.attachmentSize===void 0?"":`attachmentSize	${t.attachmentSize}
`)+`author	${t.author}
`+(t.deleteAfter===void 0?"":`deleteAfter	${t.deleteAfter}
`)+`format	${t.format}
path	${t.path}
textHash	${t.textHash}
timestamp	${t.timestamp}
share	${t.share}
`)}static async generateDocument({input:t,keypair:e,share:u,timestamp:r,prevLatestDoc:n,config:i}){if(t.text===void 0&&(n==null?void 0:n.text)===void 0)return new _("Couldn't determine document text from given input or previous version's text.");const s=t.text!==void 0?t.text:n==null?void 0:n.text,o={...n,format:"es.5",author:e.address,text:s,textHash:await mt.sha256base32(s),path:t.path,timestamp:r,share:u,signature:"?",shareSignature:"?"};t.deleteAfter&&(o.deleteAfter=t.deleteAfter);const a=await this.signDocument(e,o,i);return j(a)?a:t.attachment?{doc:a,attachment:t.attachment}:{doc:a}}static async signDocument(t,e,u){const r=await this.hashDocument(e);if(j(r))return r;const n=await mt.sign(t,r);if(u.shareSecret===void 0)return new Wu(`Tried to write a document to ${e.share} without the secret.`);const i=await mt.sign({shareAddress:e.share,secret:u.shareSecret},r);return j(n)?n:j(i)?i:{...e,signature:n,shareSignature:i}}static async wipeDocument(t,e,u){if(e.text.length===0)return e;const r=this.removeExtraFields(e);if(j(r))return r;const n=r.doc;if(n.attachmentHash){const s={...n,text:"",textHash:await mt.sha256base32(""),signature:"?",shareSignature:"?",attachmentHash:await mt.sha256base32(""),attachmentSize:0};return this.signDocument(t,s,u)}const i={...n,text:"",textHash:await mt.sha256base32(""),signature:"?",shareSignature:"?"};return this.signDocument(t,i,u)}static removeExtraFields(t){if(!qr(t))return new _("doc is not a plain javascript object");const e=new Set(Object.keys(Vn.objSchema||{})),u={},r={};for(const[n,i]of Object.entries(t))if(e.has(n))u[n]=i;else{if(!n.startsWith("_"))return new _("extra document fields must have names starting with an underscore");r[n]=i}return{doc:u,extras:r}}static async checkDocumentIsValid(t,e){e===void 0&&(e=Date.now()*1e3);const u=this._checkBasicDocumentValidity(t);if(j(u))return u;const r=this._checkTimestampIsOk(t.timestamp,t.deleteAfter?t.deleteAfter:null,e);if(j(r))return r;const n=this._checkAuthorCanWriteToPath(t.author,t.path);if(j(n))return n;const i=this._checkAttachmentFieldsConsistent(t);if(j(i))return i;const s=this._checkPathIsValid(t.path,!!t.attachmentHash,t.deleteAfter);if(j(s))return s;const o=Wr(t.author);if(j(o))return o;const a=zr(t.share);if(j(a))return a;const c=await this._checkAuthorSignatureIsValid(t);if(j(c))return c;const h=await this._checkShareSignatureIsValid(t);if(j(h))return h;const l=await this._checkContentMatchesHash(t.text,t.textHash);return j(l)?l:!0}static _checkBasicDocumentValidity(t){const e=As(Vn)(t);return e!==null?new _(e):!0}static _checkAttachmentFieldsConsistent(t){return t.text.length===0&&t.attachmentSize&&t.attachmentSize>0?new _("Documents with attachments must have text."):(t.text.length>0&&t.attachmentSize&&t.attachmentSize,t.attachmentHash&&t.attachmentSize===void 0?new _("Attachment size is undefined while attachment hash is defined"):t.attachmentSize&&t.attachmentHash===void 0?new _("Attachment hash is undefined while attachment size is defined"):!0)}static _checkAuthorCanWriteToPath(t,e){return e.indexOf("~")===-1||e.indexOf("~"+t)!==-1?!0:new _(`author ${t} can't write to path ${e}`)}static _checkTimestampIsOk(t,e,u){if(t>u+gc)return new _("timestamp too far in the future");if(e!==null){if(u>e)return new _("ephemeral doc has expired");if(e<=t)return new _("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(t,e,u){if(!t.startsWith("/"))return new _("invalid path: must start with /");if(t.endsWith("/"))return new _("invalid path: must not end with /");if(t.startsWith("/@"))return new _('invalid path: must not start with "/@"');if(t.indexOf("//")!==-1)return new _("invalid path: must not contain two consecutive slashes");if(u!==void 0){if(t.indexOf("!")===-1&&u!==null)return new _("when deleteAfter is set, path must contain '!'");if(t.indexOf("!")!==-1&&u===null)return new _("when deleteAfter is null, path must not contain '!'")}return!Gn(t)&&e?new _("when a attachment is provided, the path must end with a file extension"):Gn(t)&&e===!1?new _("when no attachment is provided, the path cannot end with a file extension"):!0}static async _checkAuthorSignatureIsValid(t){try{const e=await this.hashDocument(t);return j(e)?e:await mt.verify(t.author,t.signature,e)!==!0?new _("signature is invalid"):!0}catch{return new _("signature is invalid (unexpected exception)")}}static async _checkShareSignatureIsValid(t){try{const e=await this.hashDocument(t);return j(e)?e:await mt.verify(t.share,t.shareSignature,e)!==!0?new _("share signature is invalid"):!0}catch{return new _("share signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(t,e){return await mt.sha256base32(t)!==e?new _("content does not match contentHash"):!0}static getAttachmentInfo(t){return t.attachmentHash&&t.attachmentSize===0?new _("This document has had its attachment wiped"):!t.attachmentHash||!t.attachmentSize?new _("This document has no attachment."):{size:t.attachmentSize,hash:t.attachmentHash}}static updateAttachmentFields(t,e,u,r,n){const i={...e,attachmentHash:r,attachmentSize:u};return this.signDocument(t,i,n)}static authorFromCredentials(t){return t.address}},Object.defineProperty(Dr,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.5"});const Bc=/^.*\.(\w+)$/,vc=/^.*~@\w{4}\.\w{53}$/;function Gn(t){if(t.indexOf(".")===-1)return!1;const e=t.match(Bc);return!(e===null||e[1].length===53&&t.match(vc))}BigInt(0);new $t("peer","orangeRed");new $t("query","green");new $t("query helpers","gold");var Zn;(function(t){t[t.LT=-1]="LT",t[t.EQ=0]="EQ",t[t.GT=1]="GT"})(Zn||(Zn={}));new $t("replica","gold");new $t("replica set","gold");new $t("replica ingest","gold");new $t("replica-cache","green");new $t("storage driver async memory","yellow");const Cu=$i({address:"",secret:""});function _c(t){return{c:W,m:W,p:W,d:W}}function xc(t){let e,u,r,n,i,s,o,a,c,h,l,D,p,f,d,A,x,y,m,F,g,v,b;return{c(){e=$("h3"),e.textContent="Identity",u=Y(`
        Your alias is `),r=$("b"),n=Y(t[2]),i=X(),s=$("br"),o=X(),a=$("br"),c=X(),h=$("b"),h.textContent="Address:",l=X(),D=Y(t[1]),p=X(),f=$("br"),d=X(),A=$("b"),A.textContent="Secret",x=Y(": "),y=Y(t[3]),m=$("br"),F=X(),g=$("button"),g.textContent="Download your identity file"},m(E,S){T(E,e,S),T(E,u,S),T(E,r,S),P(r,n),T(E,i,S),T(E,s,S),T(E,o,S),T(E,a,S),T(E,c,S),T(E,h,S),T(E,l,S),T(E,D,S),T(E,p,S),T(E,f,S),T(E,d,S),T(E,A,S),T(E,x,S),T(E,y,S),T(E,m,S),T(E,F,S),T(E,g,S),v||(b=Ft(g,"click",t[6]),v=!0)},p(E,S){S&4&&Lt(n,E[2]),S&2&&Lt(D,E[1]),S&8&&Lt(y,E[3])},d(E){E&&I(e),E&&I(u),E&&I(r),E&&I(i),E&&I(s),E&&I(o),E&&I(a),E&&I(c),E&&I(h),E&&I(l),E&&I(D),E&&I(p),E&&I(f),E&&I(d),E&&I(A),E&&I(x),E&&I(y),E&&I(m),E&&I(F),E&&I(g),v=!1,b()}}}function Sc(t){let e;return{c(){e=$("h2"),e.textContent="Loading Identity details"},m(u,r){T(u,e,r)},p:W,d(u){u&&I(e)}}}function kc(t){let e,u,r,n,i,s={ctx:t,current:null,token:null,hasCatch:!1,pending:Sc,then:xc,catch:_c,value:9};return hu(t[0](),s),{c(){e=$("div"),s.block.c(),u=X(),r=$("button"),r.textContent="Generate another random ID"},m(o,a){T(o,e,a),s.block.m(e,s.anchor=null),s.mount=()=>e,s.anchor=u,P(e,u),P(e,r),n||(i=Ft(r,"click",t[7]),n=!0)},p(o,[a]){t=o,Ir(s,t,a)},i:W,o:W,d(o){o&&I(e),s.block.d(),s.token=null,s=null,n=!1,i()}}}function Ic(){var t="",e="abcdefghijklmnopqrstuvwxyz",u=e.length,r="abcdefghijklmnopqrstuvwxyz0123456789",n=r.length;t+=e.charAt(Math.floor(Math.random()*u));for(var i=0;i<3;i++)t+=r.charAt(Math.floor(Math.random()*n));return t}function Tc(t,e,u){let r,n,i,s,o;Cu.subscribe(D=>{u(5,o=D)});function a(){let D=document.createElement("a"),p=new Blob([JSON.stringify(i)],{type:"text/plain"}),f=i.address+".json";D.href=URL.createObjectURL(p),D.download=f,D.style.display="none",document.body.appendChild(D),D.click()}async function c(){let D=await mt.generateAuthorKeypair(Ic()),p=D.address,f=D.secret;Cu.set({address:p,secret:f})}const h=()=>a(),l=()=>c();return t.$$.update=()=>{t.$$.dirty&32&&u(1,r=o.address),t.$$.dirty&32&&u(3,n=o.secret),t.$$.dirty&32&&(i=o),t.$$.dirty&2&&u(2,s=r.slice(0,5))},[c,r,s,n,a,o,h,l]}class Rc extends qe{constructor(e){super(),ze(this,e,Tc,kc,Se,{generateID:0})}get generateID(){return this.$$.ctx[0]}}let xr;ju.subscribe(t=>{xr=t});const Pc=new xo({driver:new $o(xr.shareAddress),shareSecret:xr.secret}),Vu=Pi({replica:Pc});function Xn(t){let e,u=t[0].kind+"",r;return{c(){e=$("p"),r=Y(u)},m(n,i){T(n,e,i),P(e,r)},p(n,i){i&1&&u!==(u=n[0].kind+"")&&Lt(r,u)},d(n){n&&I(e)}}}function $c(t){let e,u,r,n,i,s,o,a,c,h,l=t[0]&&Xn(t);return{c(){e=$("div"),u=$("img"),n=X(),i=$("div"),i.textContent="Upload file",s=X(),o=$("input"),a=X(),l&&l.c(),Q(u,"class","upload svelte-1nuf53a"),cu(u.src,r=Oc)||Q(u,"src",r),Q(u,"alt","Comics icons created by Freepik - Flaticon"),Q(i,"class","uploadText svelte-1nuf53a"),_s(o,"display","none"),Q(o,"type","file"),Q(o,"accept",".jpg, .jpeg, .png, .gif, .txt")},m(D,p){T(D,e,p),P(e,u),P(e,n),P(e,i),P(e,s),P(e,o),t[8](o),P(e,a),l&&l.m(e,null),c||(h=[Ft(u,"click",t[3]),Ft(u,"keypress",t[4]),Ft(i,"click",t[5]),Ft(i,"keypress",t[6]),Ft(o,"change",t[7])],c=!0)},p(D,[p]){D[0]?l?l.p(D,p):(l=Xn(D),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i:W,o:W,d(D){D&&I(e),t[8](null),l&&l.d(),c=!1,Ce(h)}}}let Oc="images/insert-picture-icon.png";function Hc(t){return new Promise((e,u)=>{let r=new FileReader;r.onload=()=>{e(r.result),console.log("typeof",r.result)},r.onerror=u,r.readAsArrayBuffer(t)})}function Nc(t,e,u){let r,n;ju.subscribe(f=>{}),Cu.subscribe(f=>{r=f}),Vu.subscribe(f=>{n=f});let i,s;async function o(f){let d=f.target.files[0],x=d.name.replace(/\s+/g,"_").replace(/[@,\/#!$%\^&\*;:{}=\-`~()]/g,"");console.log("safeName",x);let y=await Hc(d),m=(Date.now()+36e5)*1e3;console.log("fileReady",y);let F=new Uint8Array(y);return u(0,s=await n.replica.set(r,{path:`/images/${Date.now()}/!${x}`,text:"from "+r.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:F,deleteAfter:m})),console.log("Result: ",s),k(s)&&console.error(s),s}const a=()=>{i.click()},c=()=>{i.click()},h=()=>{i.click()},l=()=>{i.click()},D=f=>o(f);function p(f){fr[f?"unshift":"push"](()=>{i=f,u(1,i)})}return t.$$.update=()=>{t.$$.dirty&1&&u(0,s)},[s,i,o,a,c,h,l,D,p]}class Uc extends qe{constructor(e){super(),ze(this,e,Nc,$c,Se,{})}}function Lc(t){let e,u,r,n,i,s,o,a,c,h;return{c(){e=$("div"),u=$("button"),u.textContent="+",r=X(),n=$("button"),n.textContent="-",i=X(),s=$("p"),o=Y(t[0]),a=Y(" minutes left until deletion"),Q(u,"class","svelte-ory2b7"),Q(n,"class","svelte-ory2b7"),Q(s,"class","svelte-ory2b7"),Q(e,"id","flexcontainer"),Q(e,"class","svelte-ory2b7")},m(l,D){T(l,e,D),P(e,u),P(e,r),P(e,n),P(e,i),P(e,s),P(s,o),P(s,a),c||(h=[Ft(u,"click",t[1]),Ft(n,"click",t[2])],c=!0)},p(l,[D]){D&1&&Lt(o,l[0])},i:W,o:W,d(l){l&&I(e),c=!1,Ce(h)}}}function Mc(t,e,u){let r,n,i,s;Cu.subscribe(l=>{i=l}),Vu.subscribe(l=>{s=l});let{doc:o}=e,a=o.deleteAfter;async function c(){u(4,a+=6e7);const l=await s.replica.set(i,{path:o.path,deleteAfter:a});console.log("result ",l)}async function h(){u(4,a-=6e7);const l=await s.replica.set(i,{path:o.path,deleteAfter:a});console.log("result ",l)}return t.$$set=l=>{"doc"in l&&u(3,o=l.doc)},t.$$.update=()=>{t.$$.dirty&48&&u(0,n=Math.trunc((a/1e3-r)/6e4))},u(5,r=Date.now()),[n,c,h,o,a,r]}class jc extends qe{constructor(e){super(),ze(this,e,Mc,Lc,Se,{doc:3})}}function Wc(t){let e,u,r;function n(o,a){return o[3]?qc:Kc}let i=n(t),s=i(t);return{c(){e=$("button"),s.c()},m(o,a){T(o,e,a),s.m(e,null),u||(r=Ft(e,"click",t[7]),u=!0)},p(o,a){i!==(i=n(o))&&(s.d(1),s=i(o),s&&(s.c(),s.m(e,null)))},d(o){o&&I(e),s.d(),u=!1,r()}}}function zc(t){let e,u,r;return{c(){e=$("button"),e.textContent="Get attachment"},m(n,i){T(n,e,i),u||(r=Ft(e,"click",function(){Sr(t[5](t[0]))&&t[5](t[0]).apply(this,arguments)}),u=!0)},p(n,i){t=n},d(n){n&&I(e),u=!1,r()}}}function qc(t){let e;return{c(){e=Y("Show attachment")},m(u,r){T(u,e,r)},d(u){u&&I(e)}}}function Kc(t){let e;return{c(){e=Y("Hide attachment")},m(u,r){T(u,e,r)},d(u){u&&I(e)}}}function Vc(t){return{c:W,m:W,p:W,d:W}}function Gc(t){let e;function u(i,s){return i[3]?Zc:Xc}let r=u(t),n=r(t);return{c(){n.c(),e=Hu()},m(i,s){n.m(i,s),T(i,e,s)},p(i,s){r===(r=u(i))&&n?n.p(i,s):(n.d(1),n=r(i),n&&(n.c(),n.m(e.parentNode,e)))},d(i){n.d(i),i&&I(e)}}}function Zc(t){let e,u,r;return{c(){e=$("img"),Q(e,"class","dnone svelte-1lsp0nb"),cu(e.src,u=t[12])||Q(e,"src",u),Q(e,"alt",r=t[0].text)},m(n,i){T(n,e,i)},p(n,i){i&2&&!cu(e.src,u=n[12])&&Q(e,"src",u),i&1&&r!==(r=n[0].text)&&Q(e,"alt",r)},d(n){n&&I(e)}}}function Xc(t){let e,u,r,n,i;function s(c,h){if(c[4]==="image")return Yc;if(c[4]==="text")return Qc}let o=s(t),a=o&&o(t);return{c(){a&&a.c(),e=X(),u=$("p"),r=$("button"),r.textContent="Download attachment"},m(c,h){a&&a.m(c,h),T(c,e,h),T(c,u,h),P(u,r),n||(i=Ft(r,"click",t[8]),n=!0)},p(c,h){o===(o=s(c))&&a?a.p(c,h):(a&&a.d(1),a=o&&o(c),a&&(a.c(),a.m(e.parentNode,e)))},d(c){a&&a.d(c),c&&I(e),c&&I(u),n=!1,i()}}}function Qc(t){let e,u=t[12]+"",r;return{c(){e=$("p"),r=Y(u)},m(n,i){T(n,e,i),P(e,r)},p(n,i){i&2&&u!==(u=n[12]+"")&&Lt(r,u)},d(n){n&&I(e)}}}function Yc(t){let e,u,r;return{c(){e=$("img"),cu(e.src,u=t[12])||Q(e,"src",u),Q(e,"alt",r=t[0].text),Q(e,"class","svelte-1lsp0nb")},m(n,i){T(n,e,i)},p(n,i){i&2&&!cu(e.src,u=n[12])&&Q(e,"src",u),i&1&&r!==(r=n[0].text)&&Q(e,"alt",r)},d(n){n&&I(e)}}}function Jc(t){let e;return{c(){e=Y("Loading attachment...")},m(u,r){T(u,e,r)},p:W,d(u){u&&I(e)}}}function tl(t){let e,u,r=t[0].path.split(".")[t[0].path.split(".").length-1]+"",n,i,s,o,a=t[0].attachmentSize/1e3+"",c,h,l,D,p,f,d;function A(F,g){return F[2]?Wc:zc}let x=A(t),y=x(t),m={ctx:t,current:null,token:null,hasCatch:!1,pending:Jc,then:Gc,catch:Vc,value:12};return hu(d=t[1],m),{c(){e=$("p"),u=Y("Attachment type: "),n=Y(r),i=X(),s=$("br"),o=Y(`
Attachment size: `),c=Y(a),h=Y(" kb"),l=X(),D=$("p"),y.c(),p=X(),f=Hu(),m.block.c()},m(F,g){T(F,e,g),P(e,u),P(e,n),P(e,i),P(e,s),P(e,o),P(e,c),P(e,h),T(F,l,g),T(F,D,g),y.m(D,null),T(F,p,g),T(F,f,g),m.block.m(F,m.anchor=g),m.mount=()=>f.parentNode,m.anchor=f},p(F,[g]){t=F,g&1&&r!==(r=t[0].path.split(".")[t[0].path.split(".").length-1]+"")&&Lt(n,r),g&1&&a!==(a=t[0].attachmentSize/1e3+"")&&Lt(c,a),x===(x=A(t))&&y?y.p(t,g):(y.d(1),y=x(t),y&&(y.c(),y.m(D,null))),m.ctx=t,g&2&&d!==(d=t[1])&&hu(d,m)||Ir(m,t,g)},i:W,o:W,d(F){F&&I(e),F&&I(l),F&&I(D),y.d(),F&&I(p),F&&I(f),m.block.d(F),m.token=null,m=null}}}function el(t,e,u){let r;Vu.subscribe(d=>{r=d});let{doc:n}=e,i,s,o=!1,a=!0,c;async function h(d){const A=await r.replica.getAttachment(d);if(A!==void 0){const y=await A.bytes();console.log("docdata",y);let m=d.path.split(".")[d.path.split(".").length-1];console.log("fileExtension",m);let F=new Uint8Array(y.length);for(var x=0;x<y.length;x++)F[x]=y[x];return console.log("bytes ",F),m==="txt"?(u(4,c="text"),u(4,c),console.log(c),i=String.fromCharCode(...F),console.log("Bytes to string: ",i)):(u(4,c="image"),u(4,c),console.log(c),i=URL.createObjectURL(new Blob([F],{type:"image/png"}))),i}}function l(d){u(1,s=h(d)),u(2,o=!0),u(3,a=!1)}function D(){let d=document.createElement("a");console.log(i+"attachmentBytes"),i.split(":")[0]!=="blob"&&(console.log("attachmentBytes is a string"),i=URL.createObjectURL(new Blob([i])),console.log("attachmentBytes is now a blob")),console.log("type of attachmentBytes",typeof i);let A=i,x=n.path.split("/")[n.path.split("/").length-1];console.log("type of file",typeof A),d.href=A,d.download=x,d.style.display="none",document.body.appendChild(d),d.click()}const p=()=>u(3,a=!a),f=()=>D();return t.$$set=d=>{"doc"in d&&u(0,n=d.doc)},t.$$.update=()=>{t.$$.dirty&1&&console.log("type",n.path),t.$$.dirty&1&&console.log(n.path.split(".").length-1)},[n,s,o,a,c,l,D,p,f]}class ul extends qe{constructor(e){super(),ze(this,e,el,tl,Se,{doc:0})}}function Qn(t,e,u){const r=t.slice();return r[1]=e[u],r}function rl(t){let e,u,r,n={ctx:t,current:null,token:null,hasCatch:!1,pending:al,then:sl,catch:il,value:0,blocks:[,,,]};return hu(u=t[0],n),{c(){e=Hu(),n.block.c()},m(i,s){T(i,e,s),n.block.m(i,n.anchor=s),n.mount=()=>e.parentNode,n.anchor=e,r=!0},p(i,s){t=i,n.ctx=t,s&1&&u!==(u=t[0])&&hu(u,n)||Ir(n,t,s)},i(i){r||(ct(n.block),r=!0)},o(i){for(let s=0;s<3;s+=1){const o=n.blocks[s];At(o)}r=!1},d(i){i&&I(e),n.block.d(i),n.token=null,n=null}}}function nl(t){let e;return{c(){e=$("li"),e.textContent="No files yet",Q(e,"class","svelte-8z70ok")},m(u,r){T(u,e,r)},p:W,i:W,o:W,d(u){u&&I(e)}}}function il(t){return{c:W,m:W,p:W,i:W,o:W,d:W}}function sl(t){let e,u,r=t[0],n=[];for(let s=0;s<r.length;s+=1)n[s]=Yn(Qn(t,r,s));const i=s=>At(n[s],1,1,()=>{n[s]=null});return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=Hu()},m(s,o){for(let a=0;a<n.length;a+=1)n[a].m(s,o);T(s,e,o),u=!0},p(s,o){if(o&1){r=s[0];let a;for(a=0;a<r.length;a+=1){const c=Qn(s,r,a);n[a]?(n[a].p(c,o),ct(n[a],1)):(n[a]=Yn(c),n[a].c(),ct(n[a],1),n[a].m(e.parentNode,e))}for(Le(),a=r.length;a<n.length;a+=1)i(a);Me()}},i(s){if(!u){for(let o=0;o<r.length;o+=1)ct(n[o]);u=!0}},o(s){n=n.filter(Boolean);for(let o=0;o<n.length;o+=1)At(n[o]);u=!1},d(s){Bs(n,s),s&&I(e)}}}function Yn(t){let e,u=t[1].text+"",r,n,i,s,o,a,c;return i=new ul({props:{doc:t[1]}}),o=new jc({props:{doc:t[1]}}),{c(){e=$("li"),r=Y(u),n=X(),Du(i.$$.fragment),s=X(),Du(o.$$.fragment),a=X(),Q(e,"class","svelte-8z70ok")},m(h,l){T(h,e,l),P(e,r),P(e,n),je(i,e,null),P(e,s),je(o,e,null),P(e,a),c=!0},p(h,l){(!c||l&1)&&u!==(u=h[1].text+"")&&Lt(r,u);const D={};l&1&&(D.doc=h[1]),i.$set(D);const p={};l&1&&(p.doc=h[1]),o.$set(p)},i(h){c||(ct(i.$$.fragment,h),ct(o.$$.fragment,h),c=!0)},o(h){At(i.$$.fragment,h),At(o.$$.fragment,h),c=!1},d(h){h&&I(e),We(i),We(o)}}}function al(t){let e;return{c(){e=$("li"),e.textContent="Loading...",Q(e,"class","svelte-8z70ok")},m(u,r){T(u,e,r)},p:W,i:W,o:W,d(u){u&&I(e)}}}function ol(t){let e,u,r,n,i,s,o;const a=[nl,rl],c=[];function h(l,D){return l[0].length===0?0:1}return i=h(t),s=c[i]=a[i](t),{c(){e=$("div"),u=$("h2"),u.textContent="Files",r=X(),n=$("ul"),s.c(),Q(n,"class","svelte-8z70ok")},m(l,D){T(l,e,D),P(e,u),P(e,r),P(e,n),c[i].m(n,null),o=!0},p(l,[D]){let p=i;i=h(l),i===p?c[i].p(l,D):(Le(),At(c[p],1,1,()=>{c[p]=null}),Me(),s=c[i],s?s.p(l,D):(s=c[i]=a[i](l),s.c()),ct(s,1),s.m(n,null))},i(l){o||(ct(s),o=!0)},o(l){At(s),o=!1},d(l){l&&I(e),c[i].d()}}}function cl(t,e,u){let r,n=[],i={};ju.subscribe(a=>{}),Cu.subscribe(a=>{}),Vu.subscribe(a=>{r=a});const s=new So(r.replica),o=async()=>{u(0,n=s.queryDocs({filter:{pathStartsWith:"/images"}})),console.log("imageDocs",n)};return s.onCacheUpdated(()=>{o()}),xs(()=>{o()}),t.$$.update=()=>{t.$$.dirty&1&&u(0,n)},[n,i]}class ll extends qe{constructor(e){super(),ze(this,e,cl,ol,Se,{})}}function Jn(t){let e,u,r;return{c(){e=$("button"),e.textContent="Generate new Identity"},m(n,i){T(n,e,i),u||(r=Ft(e,"click",t[4]),u=!0)},p:W,d(n){n&&I(e),u=!1,r()}}}function hl(t){let e,u,r,n,i,s,o,a,c;const h=[dl,fl],l=[];function D(A,x){return A[3]?1:0}r=D(t),n=l[r]=h[r](t);function p(A,x){return A[3]?ml:pl}let f=p(t),d=f(t);return{c(){e=$("button"),e.textContent="Show details",u=X(),n.c(),i=X(),s=$("button"),d.c(),Q(e,"class","topleft svelte-1wdq01o"),Q(s,"class","topright svelte-1wdq01o")},m(A,x){T(A,e,x),T(A,u,x),l[r].m(A,x),T(A,i,x),T(A,s,x),d.m(s,null),o=!0,a||(c=[Ft(e,"click",t[6]),Ft(s,"click",t[7])],a=!0)},p(A,x){let y=r;r=D(A),r!==y&&(Le(),At(l[y],1,1,()=>{l[y]=null}),Me(),n=l[r],n||(n=l[r]=h[r](A),n.c()),ct(n,1),n.m(i.parentNode,i)),f!==(f=p(A))&&(d.d(1),d=f(A),d&&(d.c(),d.m(s,null)))},i(A){o||(ct(n),o=!0)},o(A){At(n),o=!1},d(A){A&&I(e),A&&I(u),l[r].d(A),A&&I(i),A&&I(s),d.d(),a=!1,Ce(c)}}}function Dl(t){let e,u,r;function n(o,a){return o[2]?Cl:Al}let i=n(t),s=i(t);return{c(){e=$("button"),s.c()},m(o,a){T(o,e,a),s.m(e,null),u||(r=Ft(e,"click",t[5]),u=!0)},p(o,a){i!==(i=n(o))&&(s.d(1),s=i(o),s&&(s.c(),s.m(e,null)))},i:W,o:W,d(o){o&&I(e),s.d(),u=!1,r()}}}function fl(t){let e,u;return e=new ll({}),{c(){Du(e.$$.fragment)},m(r,n){je(e,r,n),u=!0},i(r){u||(ct(e.$$.fragment,r),u=!0)},o(r){At(e.$$.fragment,r),u=!1},d(r){We(e,r)}}}function dl(t){let e,u;return e=new Uc({}),{c(){Du(e.$$.fragment)},m(r,n){je(e,r,n),u=!0},i(r){u||(ct(e.$$.fragment,r),u=!0)},o(r){At(e.$$.fragment,r),u=!1},d(r){We(e,r)}}}function pl(t){let e;return{c(){e=Y("Show file")},m(u,r){T(u,e,r)},d(u){u&&I(e)}}}function ml(t){let e;return{c(){e=Y("Upload file")},m(u,r){T(u,e,r)},d(u){u&&I(e)}}}function Al(t){let e;return{c(){e=Y("Hide details")},m(u,r){T(u,e,r)},d(u){u&&I(e)}}}function Cl(t){let e;return{c(){e=Y("Show details")},m(u,r){T(u,e,r)},d(u){u&&I(e)}}}function ti(t){let e,u;return e=new Rc({}),{c(){Du(e.$$.fragment)},m(r,n){je(e,r,n),u=!0},i(r){u||(ct(e.$$.fragment,r),u=!0)},o(r){At(e.$$.fragment,r),u=!1},d(r){We(e,r)}}}function wl(t){let e,u,r,n,i,s,o,a,c=t[0].shareAddress+"",h,l,D,p,f=t[0].secret+"",d,A,x,y,m,F,g,v,b=!t[1]&&Jn(t);const E=[Dl,hl],S=[];function Z(U,K){return U[1]&&!U[2]?0:U[1]&&U[2]?1:-1}~(y=Z(t))&&(m=S[y]=E[y](t));let R=t[1]&&ti();return{c(){e=$("main"),u=$("div"),r=$("div"),n=$("h3"),n.textContent="Current Share Details",i=X(),s=$("p"),o=$("b"),o.textContent="Address:",a=X(),h=Y(c),l=X(),D=$("b"),D.textContent="Secret:",p=X(),d=Y(f),A=X(),b&&b.c(),x=X(),m&&m.c(),F=X(),g=$("div"),R&&R.c(),Q(r,"class","svelte-1wdq01o"),Bu(r,"showHide",t[2]),Q(g,"class","svelte-1wdq01o"),Bu(g,"showHide",t[2]),Q(e,"class","svelte-1wdq01o")},m(U,K){T(U,e,K),P(e,u),P(u,r),P(r,n),P(r,i),P(r,s),P(s,o),P(s,a),P(s,h),P(s,l),P(s,D),P(s,p),P(s,d),P(u,A),b&&b.m(u,null),P(u,x),~y&&S[y].m(u,null),P(e,F),P(e,g),R&&R.m(g,null),v=!0},p(U,[K]){(!v||K&1)&&c!==(c=U[0].shareAddress+"")&&Lt(h,c),(!v||K&1)&&f!==(f=U[0].secret+"")&&Lt(d,f),(!v||K&4)&&Bu(r,"showHide",U[2]),U[1]?b&&(b.d(1),b=null):b?b.p(U,K):(b=Jn(U),b.c(),b.m(u,x));let jt=y;y=Z(U),y===jt?~y&&S[y].p(U,K):(m&&(Le(),At(S[jt],1,1,()=>{S[jt]=null}),Me()),~y?(m=S[y],m?m.p(U,K):(m=S[y]=E[y](U),m.c()),ct(m,1),m.m(u,null)):m=null),U[1]?R?K&2&&ct(R,1):(R=ti(),R.c(),ct(R,1),R.m(g,null)):R&&(Le(),At(R,1,1,()=>{R=null}),Me()),(!v||K&4)&&Bu(g,"showHide",U[2])},i(U){v||(ct(m),ct(R),v=!0)},o(U){At(m),At(R),v=!1},d(U){U&&I(e),b&&b.d(),~y&&S[y].d(),R&&R.d()}}}function El(t,e,u){let r;ju.subscribe(l=>{u(0,r=l)});let n=!1,i=!1,s=!1;return[r,n,i,s,()=>u(1,n=!n),()=>u(2,i=!i),()=>u(2,i=!i),()=>u(3,s=!s)]}class gl extends qe{constructor(e){super(),ze(this,e,El,wl,Se,{})}}new gl({target:document.getElementById("app")});
