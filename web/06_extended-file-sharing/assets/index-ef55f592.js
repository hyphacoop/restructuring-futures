var jr=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var z=(t,e,n)=>(jr(t,e,"read from private field"),n?n.call(t):e.get(t)),Ge=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},de=(t,e,n,r)=>(jr(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n);var hn=(t,e,n)=>(jr(t,e,"access private method"),n);function io(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function R(){}function Lt(t,e){for(const n in e)t[n]=e[n];return t}function uo(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function ku(t){return t()}function Qs(){return Object.create(null)}function zt(t){t.forEach(ku)}function $r(t){return typeof t=="function"}function ce(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let fr;function Ut(t,e){return fr||(fr=document.createElement("a")),fr.href=e,t===fr.href}function ao(t){return Object.keys(t).length===0}function vu(t,...e){if(t==null)return R;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Nt(t,e,n){t.$$.on_destroy.push(vu(e,n))}function be(t,e,n,r){if(t){const s=Bu(t,e,n,r);return t[0](s)}}function Bu(t,e,n,r){return t[1]&&r?Lt(n.ctx.slice(),t[1](r(e))):n.ctx}function Ae(t,e,n,r){if(t[2]&&r){const s=t[2](r(n));if(e.dirty===void 0)return s;if(typeof s=="object"){const i=[],u=Math.max(e.dirty.length,s.length);for(let o=0;o<u;o+=1)i[o]=e.dirty[o]|s[o];return i}return e.dirty|s}return e.dirty}function ye(t,e,n,r,s,i){if(s){const u=Bu(e,n,r,i);t.p(u,s)}}function Ce(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}function oo(t){const e={};for(const n in t)n[0]!=="$"&&(e[n]=t[n]);return e}function Ks(t,e){const n={};e=new Set(e);for(const r in t)!e.has(r)&&r[0]!=="$"&&(n[r]=t[r]);return n}function L(t,e){t.appendChild(e)}function b(t,e,n){t.insertBefore(e,n||null)}function w(t){t.parentNode&&t.parentNode.removeChild(t)}function an(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function B(t){return document.createElement(t)}function lo(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function ae(t){return document.createTextNode(t)}function X(){return ae(" ")}function oe(){return ae("")}function xe(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function M(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function co(t){return Array.from(t.childNodes)}function Le(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function ho(t,e,n,r){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function dr(t,e,n){t.classList[n?"add":"remove"](e)}function fo(t,e,{bubbles:n=!1,cancelable:r=!1}={}){const s=document.createEvent("CustomEvent");return s.initCustomEvent(t,n,r,e),s}class po{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,n,r=null){this.e||(this.is_svg?this.e=lo(n.nodeName):this.e=B(n.nodeName),this.t=n,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}i(e){for(let n=0;n<this.n.length;n+=1)b(this.t,this.n[n],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(w)}}function ge(t,e){return new t(e)}let Zn;function Tt(t){Zn=t}function ir(){if(!Zn)throw new Error("Function called outside component initialization");return Zn}function Ir(t){ir().$$.on_mount.push(t)}function xu(){const t=ir();return(e,n,{cancelable:r=!1}={})=>{const s=t.$$.callbacks[e];if(s){const i=fo(e,n,{cancelable:r});return s.slice().forEach(u=>{u.call(t,i)}),!i.defaultPrevented}return!0}}function Do(t,e){return ir().$$.context.set(t,e),e}function mo(t){return ir().$$.context.get(t)}function go(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const wn=[],hs=[],gr=[],Gs=[],wo=Promise.resolve();let fs=!1;function bo(){fs||(fs=!0,wo.then(Bs))}function ds(t){gr.push(t)}const qr=new Set;let fn=0;function Bs(){if(fn!==0)return;const t=Zn;do{try{for(;fn<wn.length;){const e=wn[fn];fn++,Tt(e),Ao(e.$$)}}catch(e){throw wn.length=0,fn=0,e}for(Tt(null),wn.length=0,fn=0;hs.length;)hs.pop()();for(let e=0;e<gr.length;e+=1){const n=gr[e];qr.has(n)||(qr.add(n),n())}gr.length=0}while(wn.length);for(;Gs.length;)Gs.pop()();fs=!1,qr.clear(),Tt(t)}function Ao(t){if(t.fragment!==null){t.update(),zt(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ds)}}const wr=new Set;let nn;function te(){nn={r:0,c:[],p:nn}}function ne(){nn.r||zt(nn.c),nn=nn.p}function y(t,e){t&&t.i&&(wr.delete(t),t.i(e))}function E(t,e,n,r){if(t&&t.o){if(wr.has(t))return;wr.add(t),nn.c.push(()=>{wr.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function Xn(t,e){const n=e.token={};function r(s,i,u,o){if(e.token!==n)return;e.resolved=o;let a=e.ctx;u!==void 0&&(a=a.slice(),a[u]=o);const l=s&&(e.current=s)(a);let c=!1;e.block&&(e.blocks?e.blocks.forEach((h,f)=>{f!==i&&h&&(te(),E(h,1,1,()=>{e.blocks[f]===h&&(e.blocks[f]=null)}),ne())}):e.block.d(1),l.c(),y(l,1),l.m(e.mount(),e.anchor),c=!0),e.block=l,e.blocks&&(e.blocks[i]=l),c&&Bs()}if(uo(t)){const s=ir();if(t.then(i=>{Tt(s),r(e.then,1,e.value,i),Tt(null)},i=>{if(Tt(s),r(e.catch,2,e.error,i),Tt(null),!e.hasCatch)throw i}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function xs(t,e,n){const r=e.slice(),{resolved:s}=t;t.current===t.then&&(r[t.value]=s),t.current===t.catch&&(r[t.error]=s),t.block.p(r,n)}function kn(t,e){const n={},r={},s={$$scope:1};let i=t.length;for(;i--;){const u=t[i],o=e[i];if(o){for(const a in u)a in o||(r[a]=1);for(const a in o)s[a]||(n[a]=o[a],s[a]=1);t[i]=o}else for(const a in u)s[a]=1}for(const u in r)u in n||(n[u]=void 0);return n}function vn(t){return typeof t=="object"&&t!==null?t:{}}function ee(t){t&&t.c()}function Y(t,e,n,r){const{fragment:s,after_update:i}=t.$$;s&&s.m(e,n),r||ds(()=>{const u=t.$$.on_mount.map(ku).filter($r);t.$$.on_destroy?t.$$.on_destroy.push(...u):zt(u),t.$$.on_mount=[]}),i.forEach(ds)}function J(t,e){const n=t.$$;n.fragment!==null&&(zt(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function yo(t,e){t.$$.dirty[0]===-1&&(wn.push(t),bo(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function he(t,e,n,r,s,i,u,o=[-1]){const a=Zn;Tt(t);const l=t.$$={fragment:null,ctx:[],props:i,update:R,not_equal:s,bound:Qs(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:Qs(),dirty:o,skip_bound:!1,root:e.target||a.$$.root};u&&u(l.root);let c=!1;if(l.ctx=n?n(t,e.props||{},(h,f,...d)=>{const p=d.length?d[0]:f;return l.ctx&&s(l.ctx[h],l.ctx[h]=p)&&(!l.skip_bound&&l.bound[h]&&l.bound[h](p),c&&yo(t,h)),f}):[],l.update(),c=!0,zt(l.before_update),l.fragment=r?r(l.ctx):!1,e.target){if(e.hydrate){const h=co(e.target);l.fragment&&l.fragment.l(h),h.forEach(w)}else l.fragment&&l.fragment.c();e.intro&&y(t.$$.fragment),Y(t,e.target,e.anchor,e.customElement),Bs()}Tt(a)}class fe{$destroy(){J(this,1),this.$destroy=R}$on(e,n){if(!$r(n))return R;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const s=r.indexOf(n);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!ao(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}var Co=Object.defineProperty,Ss=(t,e)=>{for(var n in e)Co(t,n,{get:e[n],enumerable:!0})},Ke=class extends Error{constructor(e){super(e||""),this.name="EarthstarError"}},T=class extends Ke{constructor(e){super(e||"Validation error"),this.name="ValidationError"}},we=class extends Ke{constructor(e){super(e||"a Replica or ReplicaDriver was used after being closed"),this.name="ReplicaIsClosedError"}},Gt=class extends Ke{constructor(t){super(t||"a ReplicaCache was used after being closed"),this.name="ReplicaCacheIsClosedError"}},Hn=class extends Ke{constructor(t){super(t||"Not supported"),this.name="NotSupportedError"}};function I(t){return t instanceof Ke}function Su(t){return!(t instanceof Ke)}function $u(t,e){if(t===e)return!0;if(!t||!e)return!1;var n=t.length;if(e.length!==n)return!1;for(var r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}function yr(t,e){if(t===e)return!0;if(!t||!e)return!1;var n=Object.keys(t),r=Object.keys(e),s=n.length;if(r.length!==s)return!1;for(var i=0;i<s;i++){var u=n[i];if(t[u]!==e[u]||!Object.prototype.hasOwnProperty.call(e,u))return!1}return!0}var Eo=Object.create,Iu=Object.defineProperty,_o=Object.getOwnPropertyDescriptor,Fo=Object.getOwnPropertyNames,ko=Object.getPrototypeOf,vo=Object.prototype.hasOwnProperty,Bo=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),xo=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Fo(e))!vo.call(t,s)&&s!==n&&Iu(t,s,{get:()=>e[s],enumerable:!(r=_o(e,s))||r.enumerable});return t},So=(t,e,n)=>(n=t!=null?Eo(ko(t)):{},xo(e||!t||!t.__esModule?Iu(n,"default",{value:t,enumerable:!0}):n,t)),$o=Bo((t,e)=>{e.exports=function(n,r){r||(r={}),typeof r=="function"&&(r={cmp:r});var s=typeof r.cycles=="boolean"?r.cycles:!1,i=r.cmp&&function(o){return function(a){return function(l,c){var h={key:l,value:a[l]},f={key:c,value:a[c]};return o(h,f)}}}(r.cmp),u=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a!==void 0){if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);var l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(u.indexOf(a)!==-1){if(s)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var h=u.push(a)-1,f=Object.keys(a).sort(i&&i(a));for(c="",l=0;l<f.length;l++){var d=f[l],p=o(a[d]);!p||(c&&(c+=","),c+=JSON.stringify(d)+":"+p)}return u.splice(h,1),"{"+c+"}"}}(n)}}),Io=So($o()),{default:Zs,...To}=Io,Ro=Zs!==void 0?Zs:To,Tu={};Ss(Tu,{base16:()=>qo,base32:()=>Wo,base32hex:()=>Vo,base64:()=>Qo,base64url:()=>Ko,codec:()=>Go,default:()=>Zo});var Po=Object.create,Ru=Object.defineProperty,Mo=Object.getOwnPropertyDescriptor,Oo=Object.getOwnPropertyNames,No=Object.getPrototypeOf,Lo=Object.prototype.hasOwnProperty,Uo=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),zo=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Oo(e))!Lo.call(t,s)&&s!==n&&Ru(t,s,{get:()=>e[s],enumerable:!(r=Mo(e,s))||r.enumerable});return t},Ho=(t,e,n)=>(n=t!=null?Po(No(t)):{},zo(e||!t||!t.__esModule?Ru(n,"default",{value:t,enumerable:!0}):n,t)),jo=Uo(t=>{Object.defineProperty(t,"__esModule",{value:!0});function e(p,D,g){var $;if(g===void 0&&(g={}),!D.codes){D.codes={};for(var S=0;S<D.chars.length;++S)D.codes[D.chars[S]]=S}if(!g.loose&&p.length*D.bits&7)throw new SyntaxError("Invalid padding");for(var m=p.length;p[m-1]==="=";)if(--m,!g.loose&&!((p.length-m)*D.bits&7))throw new SyntaxError("Invalid padding");for(var v=new(($=g.out)!=null?$:Uint8Array)(m*D.bits/8|0),A=0,k=0,x=0,C=0;C<m;++C){var N=D.codes[p[C]];if(N===void 0)throw new SyntaxError("Invalid character "+p[C]);k=k<<D.bits|N,A+=D.bits,A>=8&&(A-=8,v[x++]=255&k>>A)}if(A>=D.bits||255&k<<8-A)throw new SyntaxError("Unexpected end of data");return v}function n(p,D,g){g===void 0&&(g={});for(var $=g,S=$.pad,m=S===void 0?!0:S,v=(1<<D.bits)-1,A="",k=0,x=0,C=0;C<p.length;++C)for(x=x<<8|255&p[C],k+=8;k>D.bits;)k-=D.bits,A+=D.chars[v&x>>k];if(k&&(A+=D.chars[v&x<<D.bits-k]),m)for(;A.length*D.bits&7;)A+="=";return A}var r={chars:"0123456789ABCDEF",bits:4},s={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},i={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},u={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},o={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},a={parse:function(p,D){return e(p.toUpperCase(),r,D)},stringify:function(p,D){return n(p,r,D)}},l={parse:function(p,D){return D===void 0&&(D={}),e(D.loose?p.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):p,s,D)},stringify:function(p,D){return n(p,s,D)}},c={parse:function(p,D){return e(p,i,D)},stringify:function(p,D){return n(p,i,D)}},h={parse:function(p,D){return e(p,u,D)},stringify:function(p,D){return n(p,u,D)}},f={parse:function(p,D){return e(p,o,D)},stringify:function(p,D){return n(p,o,D)}},d={parse:e,stringify:n};t.base16=a,t.base32=l,t.base32hex=c,t.base64=h,t.base64url=f,t.codec=d}),on=Ho(jo(),1),qo=on.default.base16,Wo=on.default.base32,Vo=on.default.base32hex,Qo=on.default.base64,Ko=on.default.base64url,Go=on.default.codec,Zo=on.default,Pu={};Ss(Pu,{Hash:()=>al,__esModule:()=>ul,createHash:()=>ol,default:()=>cl});var Xo=Object.create,Mu=Object.defineProperty,Yo=Object.getOwnPropertyDescriptor,Jo=Object.getOwnPropertyNames,el=Object.getPrototypeOf,tl=Object.prototype.hasOwnProperty,nl=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),rl=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Jo(e))!tl.call(t,s)&&s!==n&&Mu(t,s,{get:()=>e[s],enumerable:!(r=Yo(e,s))||r.enumerable});return t},sl=(t,e,n)=>(n=t!=null?Xo(el(t)):{},rl(e||!t||!t.__esModule?Mu(n,"default",{value:t,enumerable:!0}):n,t)),il=nl(t=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Hash=t.createHash=void 0;var e=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],n={sha256:1};function r(m){if(m&&!n[m]&&!n[m.toLowerCase()])throw new Error("Digest method not supported");return new s}t.createHash=r;var s=class{constructor(){this.A=1779033703,this.B=-1150833019,this.C=1013904242,this.D=-1521486534,this.E=1359893119,this.F=-1694144372,this.G=528734635,this.H=1541459225,this._size=0,this._sp=0,(!u||o>=8e3)&&(u=new ArrayBuffer(8e3),o=0),this._byte=new Uint8Array(u,o,80),this._word=new Int32Array(u,o,20),o+=80}update(m){if(typeof m=="string")return this._utf8(m);if(m==null)throw new TypeError("Invalid type: "+typeof m);let v=m.byteOffset,A=m.byteLength,k=A/64|0,x=0;if(k&&!(v&3)&&!(this._size%64)){let C=new Int32Array(m.buffer,v,k*16);for(;k--;)this._int32(C,x>>2),x+=64;this._size+=x}if(m.BYTES_PER_ELEMENT!==1&&m.buffer){let C=new Uint8Array(m.buffer,v+x,A-x);return this._uint8(C)}return x===A?this:this._uint8(m,x)}_uint8(m,v){let{_byte:A,_word:k}=this,x=m.length;for(v=v|0;v<x;){let C=this._size%64,N=C;for(;v<x&&N<64;)A[N++]=m[v++];N>=64&&this._int32(k),this._size+=N-C}return this}_utf8(m){let{_byte:v,_word:A}=this,k=m.length,x=this._sp;for(let C=0;C<k;){let N=this._size%64,le=N;for(;C<k&&le<64;){let U=m.charCodeAt(C++)|0;U<128?v[le++]=U:U<2048?(v[le++]=192|U>>>6,v[le++]=128|U&63):U<55296||U>57343?(v[le++]=224|U>>>12,v[le++]=128|U>>>6&63,v[le++]=128|U&63):x?(U=((x&1023)<<10)+(U&1023)+65536,v[le++]=240|U>>>18,v[le++]=128|U>>>12&63,v[le++]=128|U>>>6&63,v[le++]=128|U&63,x=0):x=U}le>=64&&(this._int32(A),A[0]=A[16]),this._size+=le-N}return this._sp=x,this}_int32(m,v){let{A,B:k,C:x,D:C,E:N,F:le,G:U,H:K}=this,ie=0;for(v=v|0;ie<16;)i[ie++]=h(m[v++]);for(ie=16;ie<64;ie++)i[ie]=$(i[ie-2])+i[ie-7]+g(i[ie-15])+i[ie-16]|0;for(ie=0;ie<64;ie++){let ot=K+D(N)+f(N,le,U)+e[ie]+i[ie]|0,so=p(A)+d(A,k,x)|0;K=U,U=le,le=N,N=C+ot|0,C=x,x=k,k=A,A=ot+so|0}this.A=A+this.A|0,this.B=k+this.B|0,this.C=x+this.C|0,this.D=C+this.D|0,this.E=N+this.E|0,this.F=le+this.F|0,this.G=U+this.G|0,this.H=K+this.H|0}digest(m){let{_byte:v,_word:A}=this,k=this._size%64|0;for(v[k++]=128;k&3;)v[k++]=0;if(k>>=2,k>14){for(;k<16;)A[k++]=0;k=0,this._int32(A)}for(;k<16;)A[k++]=0;let x=this._size*8,C=(x&4294967295)>>>0,N=(x-C)/4294967296;return N&&(A[14]=h(N)),C&&(A[15]=h(C)),this._int32(A),m==="hex"?this._hex():this._bin()}_hex(){let{A:m,B:v,C:A,D:k,E:x,F:C,G:N,H:le}=this;return a(m)+a(v)+a(A)+a(k)+a(x)+a(C)+a(N)+a(le)}_bin(){let{A:m,B:v,C:A,D:k,E:x,F:C,G:N,H:le,_byte:U,_word:K}=this;return K[0]=h(m),K[1]=h(v),K[2]=h(A),K[3]=h(k),K[4]=h(x),K[5]=h(C),K[6]=h(N),K[7]=h(le),U.slice(0,32)}};t.Hash=s;var i=new Int32Array(64),u,o=0,a=m=>(m+4294967296).toString(16).substr(-8),l=m=>m<<24&4278190080|m<<8&16711680|m>>8&65280|m>>24&255,c=m=>m,h=S()?c:l,f=(m,v,A)=>A^m&(v^A),d=(m,v,A)=>m&v|A&(m|v),p=m=>(m>>>2|m<<30)^(m>>>13|m<<19)^(m>>>22|m<<10),D=m=>(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7),g=m=>(m>>>7|m<<25)^(m>>>18|m<<14)^m>>>3,$=m=>(m>>>17|m<<15)^(m>>>19|m<<13)^m>>>10;function S(){return new Uint8Array(new Uint16Array([65279]).buffer)[0]===254}}),Ou=sl(il()),ul=!0,{Hash:al,createHash:ol}=Ou,{default:Xs,...ll}=Ou,cl=Xs!==void 0?Xs:ll,jn={};Ss(jn,{CURVE:()=>De,ExtendedPoint:()=>je,Point:()=>Ne,RistrettoPoint:()=>Cr,getPublicKey:()=>yl,sign:()=>Cl,utils:()=>Pr,verify:()=>El});var $e=BigInt(0),re=BigInt(1),Ve=BigInt(2),Nu=BigInt(255),Ys=Ve**BigInt(252)+BigInt("27742317777372353535851937790883648493"),De={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:Ve**Nu-BigInt(19),l:Ys,n:Ys,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},Lu=Ve**BigInt(256),Vn=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");var hl=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),fl=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),dl=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),pl=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),Pe=class{constructor(t,e,n,r){this.x=t,this.y=e,this.z=n,this.t=r}static fromAffine(t){if(!(t instanceof Ne))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return t.equals(Ne.ZERO)?Pe.ZERO:new Pe(t.x,t.y,re,_(t.x*t.y))}static toAffineBatch(t){let e=gl(t.map(n=>n.z));return t.map((n,r)=>n.toAffine(e[r]))}static normalizeZ(t){return this.toAffineBatch(t).map(this.fromAffine)}equals(t){Js(t);let{x:e,y:n,z:r}=this,{x:s,y:i,z:u}=t,o=_(e*u),a=_(s*r),l=_(n*u),c=_(i*r);return o===a&&l===c}negate(){return new Pe(_(-this.x),this.y,this.z,_(-this.t))}double(){let{x:t,y:e,z:n}=this,{a:r}=De,s=_(t**Ve),i=_(e**Ve),u=_(Ve*_(n**Ve)),o=_(r*s),a=_(_((t+e)**Ve)-s-i),l=o+i,c=l-u,h=o-i,f=_(a*c),d=_(l*h),p=_(a*h),D=_(c*l);return new Pe(f,d,D,p)}add(t){Js(t);let{x:e,y:n,z:r,t:s}=this,{x:i,y:u,z:o,t:a}=t,l=_((n-e)*(u+i)),c=_((n+e)*(u-i)),h=_(c-l);if(h===$e)return this.double();let f=_(r*Ve*a),d=_(s*Ve*o),p=d+f,D=c+l,g=d-f,$=_(p*h),S=_(D*g),m=_(p*g),v=_(h*D);return new Pe($,S,v,m)}subtract(t){return this.add(t.negate())}precomputeWindow(t){let e=1+256/t,n=[],r=this,s=r;for(let i=0;i<e;i++){s=r,n.push(s);for(let u=1;u<2**(t-1);u++)s=s.add(r),n.push(s);r=s.double()}return n}wNAF(t,e){!e&&this.equals(Pe.BASE)&&(e=Ne.BASE);let n=e&&e._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let r=e&&ps.get(e);r||(r=this.precomputeWindow(n),e&&n!==1&&(r=Pe.normalizeZ(r),ps.set(e,r)));let s=Pe.ZERO,i=Pe.ZERO,u=1+256/n,o=2**(n-1),a=BigInt(2**n-1),l=2**n,c=BigInt(n);for(let h=0;h<u;h++){let f=h*o,d=Number(t&a);if(t>>=c,d>o&&(d-=l,t+=re),d===0){let p=r[f];h%2&&(p=p.negate()),i=i.add(p)}else{let p=r[f+Math.abs(d)-1];d<0&&(p=p.negate()),s=s.add(p)}}return Pe.normalizeZ([s,i])[0]}multiply(t,e){return this.wNAF(_r(t,De.l),e)}multiplyUnsafe(t){let e=_r(t,De.l,!1),n=Pe.BASE,r=Pe.ZERO;if(e===$e)return r;if(this.equals(r)||e===re)return this;if(this.equals(n))return this.wNAF(e);let s=r,i=this;for(;e>$e;)e&re&&(s=s.add(i)),i=i.double(),e>>=re;return s}isSmallOrder(){return this.multiplyUnsafe(De.h).equals(Pe.ZERO)}isTorsionFree(){return this.multiplyUnsafe(De.l).equals(Pe.ZERO)}toAffine(t=Tr(this.z)){let{x:e,y:n,z:r}=this,s=_(e*t),i=_(n*t);if(_(r*t)!==re)throw new Error("invZ was invalid");return new Ne(s,i)}fromRistrettoBytes(){Vr()}toRistrettoBytes(){Vr()}fromRistrettoHash(){Vr()}},je=Pe;je.BASE=new Pe(De.Gx,De.Gy,re,_(De.Gx*De.Gy)),je.ZERO=new Pe($e,re,re,$e);function Js(t){if(!(t instanceof je))throw new TypeError("ExtendedPoint expected")}function Wr(t){if(!(t instanceof Cr))throw new TypeError("RistrettoPoint expected")}function Vr(){throw new Error("Legacy method: switch to RistrettoPoint")}var St=class{constructor(t){this.ep=t}static calcElligatorRistrettoMap(t){let{d:e}=De,n=_(Vn*t*t),r=_((n+re)*dl),s=BigInt(-1),i=_((s-e*n)*_(n+e)),{isValid:u,value:o}=$s(r,i),a=_(o*t);qt(a)||(a=_(-a)),u||(o=a),u||(s=n);let l=_(s*(n-re)*pl-i),c=o*o,h=_((o+o)*i),f=_(l*hl),d=_(re-c),p=_(re+c);return new je(_(h*p),_(d*f),_(f*p),_(h*d))}static hashToCurve(t){t=Qt(t,64);let e=Qr(t.slice(0,32)),n=this.calcElligatorRistrettoMap(e),r=Qr(t.slice(32,64)),s=this.calcElligatorRistrettoMap(r);return new St(n.add(s))}static fromHex(t){t=Qt(t,32);let{a:e,d:n}=De,r="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",s=Qr(t);if(!bl(Jn(s),t)||qt(s))throw new Error(r);let i=_(s*s),u=_(re+e*i),o=_(re-e*i),a=_(u*u),l=_(o*o),c=_(e*n*a-l),{isValid:h,value:f}=ei(_(c*l)),d=_(f*o),p=_(f*d*c),D=_((s+s)*d);qt(D)&&(D=_(-D));let g=_(u*p),$=_(D*g);if(!h||qt($)||g===$e)throw new Error(r);return new St(new je(D,g,re,$))}toRawBytes(){let{x:t,y:e,z:n,t:r}=this.ep,s=_(_(n+e)*_(n-e)),i=_(t*e),{value:u}=ei(_(s*i**Ve)),o=_(u*s),a=_(u*i),l=_(o*a*r),c;if(qt(r*l)){let f=_(e*Vn),d=_(t*Vn);t=f,e=d,c=_(o*fl)}else c=a;qt(t*l)&&(e=_(-e));let h=_((n-e)*c);return qt(h)&&(h=_(-h)),Jn(h)}toHex(){return ur(this.toRawBytes())}toString(){return this.toHex()}equals(t){Wr(t);let e=this.ep,n=t.ep,r=_(e.x*n.y)===_(e.y*n.x),s=_(e.y*n.y)===_(e.x*n.x);return r||s}add(t){return Wr(t),new St(this.ep.add(t.ep))}subtract(t){return Wr(t),new St(this.ep.subtract(t.ep))}multiply(t){return new St(this.ep.multiply(t))}multiplyUnsafe(t){return new St(this.ep.multiplyUnsafe(t))}},Cr=St;Cr.BASE=new St(je.BASE),Cr.ZERO=new St(je.ZERO);var ps=new WeakMap,Yn=class{constructor(t,e){this.x=t,this.y=e}_setWindowSize(t){this._WINDOW_SIZE=t,ps.delete(this)}static fromHex(t,e=!0){let{d:n,P:r}=De;t=Qt(t,32);let s=t.slice();s[31]=t[31]&-129;let i=Bn(s);if(e&&i>=r)throw new Error("Expected 0 < hex < P");if(!e&&i>=Lu)throw new Error("Expected 0 < hex < 2**256");let u=_(i*i),o=_(u-re),a=_(n*u+re),{isValid:l,value:c}=$s(o,a);if(!l)throw new Error("Point.fromHex: invalid y coordinate");let h=(c&re)===re;return(t[31]&128)!==0!==h&&(c=_(-c)),new Yn(c,i)}static async fromPrivateKey(t){return(await Rr(t)).point}toRawBytes(){let t=Jn(this.y);return t[31]|=this.x&re?128:0,t}toHex(){return ur(this.toRawBytes())}toX25519(){let{y:t}=this,e=_((re+t)*Tr(re-t));return Jn(e)}isTorsionFree(){return je.fromAffine(this).isTorsionFree()}equals(t){return this.x===t.x&&this.y===t.y}negate(){return new Yn(_(-this.x),this.y)}add(t){return je.fromAffine(this).add(je.fromAffine(t)).toAffine()}subtract(t){return this.add(t.negate())}multiply(t){return je.fromAffine(this).multiply(t,this).toAffine()}},Ne=Yn;Ne.BASE=new Yn(De.Gx,De.Gy),Ne.ZERO=new Yn($e,re);var Er=class{constructor(t,e){this.r=t,this.s=e,this.assertValidity()}static fromHex(t){let e=Qt(t,64),n=Ne.fromHex(e.slice(0,32),!1),r=Bn(e.slice(32,64));return new Er(n,r)}assertValidity(){let{r:t,s:e}=this;if(!(t instanceof Ne))throw new Error("Expected Point instance");return _r(e,De.l,!1),this}toRawBytes(){let t=new Uint8Array(64);return t.set(this.r.toRawBytes()),t.set(Jn(this.s),32),t}toHex(){return ur(this.toRawBytes())}};function Dl(...t){if(!t.every(r=>r instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(t.length===1)return t[0];let e=t.reduce((r,s)=>r+s.length,0),n=new Uint8Array(e);for(let r=0,s=0;r<t.length;r++){let i=t[r];n.set(i,s),s+=i.length}return n}var ml=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ur(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=ml[t[n]];return e}function Uu(t){if(typeof t!="string")throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex");let e=new Uint8Array(t.length/2);for(let n=0;n<e.length;n++){let r=n*2,s=t.slice(r,r+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");e[n]=i}return e}function zu(t){let e=t.toString(16).padStart(64,"0");return Uu(e)}function Jn(t){return zu(t).reverse()}function qt(t){return(_(t)&re)===re}function Bn(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+ur(Uint8Array.from(t).reverse()))}function Qr(t){return _(Bn(t)&Ve**Nu-re)}function _(t,e=De.P){let n=t%e;return n>=$e?n:e+n}function Tr(t,e=De.P){if(t===$e||e<=$e)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=_(t,e),r=e,s=$e,i=re;for(;n!==$e;){let u=r/n,o=r%n,a=s-i*u;r=n,n=o,s=i,i=a}if(r!==re)throw new Error("invert: does not exist");return _(s,e)}function gl(t,e=De.P){let n=new Array(t.length),r=t.reduce((i,u,o)=>u===$e?i:(n[o]=i,_(i*u,e)),re),s=Tr(r,e);return t.reduceRight((i,u,o)=>u===$e?i:(n[o]=_(i*n[o],e),_(i*u,e)),s),n}function lt(t,e){let{P:n}=De,r=t;for(;e-- >$e;)r*=r,r%=n;return r}function wl(t){let{P:e}=De,n=BigInt(5),r=BigInt(10),s=BigInt(20),i=BigInt(40),u=BigInt(80),o=t*t%e*t%e,a=lt(o,Ve)*o%e,l=lt(a,re)*t%e,c=lt(l,n)*l%e,h=lt(c,r)*c%e,f=lt(h,s)*h%e,d=lt(f,i)*f%e,p=lt(d,u)*d%e,D=lt(p,u)*d%e,g=lt(D,r)*c%e;return{pow_p_5_8:lt(g,Ve)*t%e,b2:o}}function $s(t,e){let n=_(e*e*e),r=_(n*n*e),s=wl(t*r).pow_p_5_8,i=_(t*n*s),u=_(e*i*i),o=i,a=_(i*Vn),l=u===t,c=u===_(-t),h=u===_(-t*Vn);return l&&(i=o),(c||h)&&(i=a),qt(i)&&(i=_(-i)),{isValid:l||c,value:i}}function ei(t){return $s(re,t)}async function Ds(...t){let e=await Pr.sha512(Dl(...t)),n=Bn(e);return _(n,De.l)}function bl(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Qt(t,e){let n=t instanceof Uint8Array?Uint8Array.from(t):Uu(t);if(typeof e=="number"&&n.length!==e)throw new Error(`Expected ${e} bytes`);return n}function _r(t,e,n=!0){if(!e)throw new TypeError("Specify max value");if(typeof t=="number"&&Number.isSafeInteger(t)&&(t=BigInt(t)),typeof t=="bigint"&&t<e){if(n){if($e<t)return t}else if($e<=t)return t}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function Al(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}async function Rr(t){if(t=typeof t=="bigint"||typeof t=="number"?zu(_r(t,Lu)):Qt(t),t.length!==32)throw new Error("Expected 32 bytes");let e=await Pr.sha512(t),n=Al(e.slice(0,32)),r=e.slice(32,64),s=_(Bn(n),De.l),i=Ne.BASE.multiply(s),u=i.toRawBytes();return{head:n,prefix:r,scalar:s,point:i,pointBytes:u}}async function yl(t){return(await Rr(t)).pointBytes}async function Cl(t,e){t=Qt(t);let{prefix:n,scalar:r,pointBytes:s}=await Rr(e),i=await Ds(n,t),u=Ne.BASE.multiply(i),o=await Ds(u.toRawBytes(),s,t),a=_(i+o*r,De.l);return new Er(u,a).toRawBytes()}async function El(t,e,n){e=Qt(e),n instanceof Ne||(n=Ne.fromHex(n,!1));let{r,s}=t instanceof Er?t.assertValidity():Er.fromHex(t),i=je.BASE.multiplyUnsafe(s),u=await Ds(r.toRawBytes(),n.toRawBytes(),e),o=je.fromAffine(n).multiplyUnsafe(u);return je.fromAffine(r).add(o).subtract(i).multiplyUnsafe(De.h).equals(je.ZERO)}Ne.BASE._setWindowSize(8);var Pr={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:ur,getExtendedPublicKey:Rr,mod:_,invert:Tr,hashToPrivateScalar:t=>{if(t=Qt(t),t.length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");let e=_(Bn(t),De.l);if(e===$e||e===re)throw new Error("Invalid private key");return e},randomBytes:(t=32)=>crypto.getRandomValues(new Uint8Array(t)),randomPrivateKey:()=>Pr.randomBytes(32),sha512:async t=>{let e=await crypto.subtle.digest("SHA-512",t.buffer);return new Uint8Array(e)},precompute(t=8,e=Ne.BASE){let n=e.equals(Ne.BASE)?e:new Ne(e.x,e.y);return n._setWindowSize(t),n.multiply(Ve),n}},Ee=11400714785074694791n,Te=14029467366897019727n,ti=1609587929392839161n,Pn=9650029242287828579n,ni=2870177450012600261n,Hu=64n,_l=2n**Hu-1n,Fl=new TextEncoder;function ri(t,e,n,r){return BigInt(t)|BigInt(e)<<16n|BigInt(n)<<32n|BigInt(r)<<48n}function Ct(t,e){return BigInt(t[e])|BigInt(t[e+1])<<8n|BigInt(t[e+2])<<16n|BigInt(t[e+3])<<24n|BigInt(t[e+4])<<32n|BigInt(t[e+5])<<40n|BigInt(t[e+6])<<48n|BigInt(t[e+7])<<56n}function ve(t,e){return t<<e&_l|t>>Hu-e}function V(t){return BigInt.asUintN(64,t)}var ht,ft,dt,pt,Dt,mt,rn,He,_u,Is=(_u=class{constructor(t=0){Ge(this,ht,void 0);Ge(this,ft,void 0);Ge(this,dt,void 0);Ge(this,pt,void 0);Ge(this,Dt,void 0);Ge(this,mt,void 0);Ge(this,rn,void 0);Ge(this,He,void 0);this.reset(t)}reset(t=z(this,ht)){return de(this,ht,BigInt.asUintN(32,BigInt(t))),de(this,ft,V(z(this,ht)+Ee+Te)),de(this,dt,V(z(this,ht)+Te)),de(this,pt,z(this,ht)),de(this,Dt,V(z(this,ht)-Ee)),de(this,mt,null),de(this,rn,0),de(this,He,0),this}update(t){typeof t=="string"&&(t=Fl.encode(t));let e=0,n=t.length,r=e+n;if(n===0)return this;if(de(this,rn,z(this,rn)+n),z(this,He)===0&&de(this,mt,new Uint8Array(32)),z(this,He)+n<32)return z(this,mt).set(t.subarray(0,n),z(this,He)),de(this,He,z(this,He)+n),this;if(z(this,He)>0){z(this,mt).set(t.subarray(0,32-z(this,He)),z(this,He));let s=0,i;i=Ct(z(this,mt),s),de(this,ft,V(ve(V(z(this,ft)+i*Te),31n)*Ee)),s+=8,i=Ct(this.memory,s),de(this,dt,V(ve(V(z(this,dt)+i*Te),31n)*Ee)),s+=8,i=Ct(this.memory,s),de(this,pt,V(ve(V(z(this,pt)+i*Te),31n)*Ee)),s+=8,i=Ct(this.memory,s),de(this,Dt,V(ve(V(z(this,Dt)+i*Te),31n)*Ee)),e+=32-z(this,He),de(this,He,0)}if(e<=r-32){let s=r-32;do{let i;i=Ct(t,e),de(this,ft,V(ve(V(z(this,ft)+i*Te),31n)*Ee)),e+=8,i=Ct(t,e),de(this,dt,V(ve(V(z(this,dt)+i*Te),31n)*Ee)),e+=8,i=Ct(t,e),de(this,pt,V(ve(V(z(this,pt)+i*Te),31n)*Ee)),e+=8,i=Ct(t,e),de(this,Dt,V(ve(V(z(this,Dt)+i*Te),31n)*Ee)),e+=8}while(e<=s)}return e<r&&(z(this,mt).set(t.subarray(e,r),z(this,He)),de(this,He,r-e)),this}digest(){let t=z(this,mt),e=z(this,He),n=0,r=0n,s=0n,i=0n;for(z(this,rn)>=32?(r=ve(z(this,ft),1n)+ve(z(this,dt),7n)+ve(z(this,pt),12n)+ve(z(this,Dt),18n),r=V(r^ve(V(z(this,ft)*Te),31n)*Ee),r=V(r*Ee+Pn),r=V(r^ve(V(z(this,dt)*Te),31n)*Ee),r=V(r*Ee+Pn),r=V(r^ve(V(z(this,pt)*Te),31n)*Ee),r=V(r*Ee+Pn),r=V(r^ve(V(z(this,Dt)*Te),31n)*Ee),r=V(r*Ee+Pn)):r=V(z(this,ht)+ni),r+=BigInt(z(this,rn));n<=e-8;)i=Ct(t,n),i=V(ve(V(i*Te),31n)*Ee),r=V(ve(r^i,27n)*Ee+Pn),n+=8;for(n+4<=e&&(i=ri(t[n+1]<<8|t[n],t[n+3]<<8|t[n+2],0,0),r=V(ve(r^V(i*Ee),23n)*Te+ti),n+=4);n<e;)i=ri(t[n++],0,0,0),r=V(ve(r^V(i*ni),11n)*Ee);return s=V(r>>33n),r=V((r^s)*Te),s=V(r>>29n),r=V((r^s)*ti),s=V(r>>32n),r=V(r^s),r}},ht=new WeakMap,ft=new WeakMap,dt=new WeakMap,pt=new WeakMap,Dt=new WeakMap,mt=new WeakMap,rn=new WeakMap,He=new WeakMap,_u);function kl(t,e=0){return new Is(e).update(t).digest()}function ju(t,e){return t<e?-1:t>e?1:0}var yn=class{constructor(t,e){this.parent=t,this.value=e,this.left=null,this.right=null}static from(t){let e=new yn(t.parent,t.value);return e.left=t.left,e.right=t.right,e}directionFromParent(){return this.parent===null?null:this===this.parent.left?"left":this===this.parent.right?"right":null}findMinNode(){let t=this.left;for(;t!=null&&t.left;)t=t.left;return t??this}findMaxNode(){let t=this.right;for(;t!=null&&t.right;)t=t.right;return t??this}findSuccessorNode(){if(this.right!==null)return this.right.findMinNode();let t=this.parent,e=this.directionFromParent();for(;t&&e==="right";)e=t.directionFromParent(),t=t.parent;return t}},qn=class{constructor(t=ju){this.compare=t,this.root=null,this._size=0}static from(t,e){let n,r=[];if(t instanceof qn)if(n=new qn((e==null?void 0:e.compare)??t.compare),(e==null?void 0:e.compare)||(e==null?void 0:e.map))r=t;else{let i=[];for(t.root&&(n.root=yn.from(t.root),i.push(n.root));i.length;){let u=i.pop(),o=u.left?yn.from(u.left):null,a=u.right?yn.from(u.right):null;o&&(o.parent=u,i.push(o)),a&&(a.parent=u,i.push(a))}}else n=e!=null&&e.compare?new qn(e.compare):new qn,r=t;let s=e!=null&&e.map?Array.from(r,e.map,e.thisArg):r;for(let i of s)n.insert(i);return n}get size(){return this._size}findNode(t){let e=this.root;for(;e;){let n=this.compare(t,e.value);if(n===0)break;let r=n<0?"left":"right";e=e[r]}return e}rotateNode(t,e){let n=e==="left"?"right":"left";if(!t[n])throw new TypeError(`cannot rotate ${e} without ${n} child`);let r=t[n];if(t[n]=r[e]??null,r[e]&&(r[e].parent=t),r.parent=t.parent,t.parent){let s=t===t.parent[e]?e:n;t.parent[s]=r}else this.root=r;r[e]=t,t.parent=r}insertNode(t,e){if(this.root){let n=this.root;for(;;){let r=this.compare(e,n.value);if(r===0)break;let s=r<0?"left":"right";if(n[s])n=n[s];else return n[s]=new t(n,e),this._size++,n[s]}}else return this.root=new t(null,e),this._size++,this.root;return null}removeNode(t){let e=this.findNode(t);if(e){let n=!e.left||!e.right?e:e.findSuccessorNode(),r=n.left??n.right;r&&(r.parent=n.parent),n.parent?n.parent[n.directionFromParent()]=r:this.root=r,n!==e&&(e.value=n.value,e=n),this._size--}return e}insert(t){return!!this.insertNode(yn,t)}remove(t){return!!this.removeNode(t)}find(t){var e;return((e=this.findNode(t))==null?void 0:e.value)??null}min(){return this.root?this.root.findMinNode().value:null}max(){return this.root?this.root.findMaxNode().value:null}clear(){this.root=null,this._size=0}isEmpty(){return this.size===0}*lnrValues(){let t=[],e=this.root;for(;t.length||e;)e?(t.push(e),e=e.left):(e=t.pop(),yield e.value,e=e.right)}*rnlValues(){let t=[],e=this.root;for(;t.length||e;)e?(t.push(e),e=e.right):(e=t.pop(),yield e.value,e=e.left)}*nlrValues(){let t=[];for(this.root&&t.push(this.root);t.length;){let e=t.pop();yield e.value,e.right&&t.push(e.right),e.left&&t.push(e.left)}}*lrnValues(){let t=[],e=this.root,n=null;for(;t.length||e;)if(e)t.push(e),e=e.left;else{let r=t[t.length-1];r.right&&r.right!==n?e=r.right:(yield r.value,n=t.pop())}}*lvlValues(){let t=[],e=this.root;for(;e;)yield e.value,e.left&&t.push(e.left),e.right&&t.push(e.right),e=t.shift()??null}*[Symbol.iterator](){yield*this.lnrValues()}},Cn=class extends yn{constructor(t,e){super(t,e),this.red=!0}static from(t){let e=new Cn(t.parent,t.value);return e.left=t.left,e.right=t.right,e.red=t.red,e}},Wn=class extends qn{constructor(t=ju){super(t)}static from(t,e){let n,r=[];if(t instanceof Wn)if(n=new Wn((e==null?void 0:e.compare)??t.compare),(e==null?void 0:e.compare)||(e==null?void 0:e.map))r=t;else{let i=[];for(t.root&&(n.root=Cn.from(t.root),i.push(n.root));i.length;){let u=i.pop(),o=u.left?Cn.from(u.left):null,a=u.right?Cn.from(u.right):null;o&&(o.parent=u,i.push(o)),a&&(a.parent=u,i.push(a))}}else n=e!=null&&e.compare?new Wn(e.compare):new Wn,r=t;let s=e!=null&&e.map?Array.from(r,e.map,e.thisArg):r;for(let i of s)n.insert(i);return n}removeFixup(t,e){var n,r,s;for(;t&&!(e!=null&&e.red);){let i=t.left===e?"left":"right",u=i==="right"?"left":"right",o=t[u];o!=null&&o.red&&(o.red=!1,t.red=!0,this.rotateNode(t,i),o=t[u]),o&&(!((n=o.left)!=null&&n.red)&&!((r=o.right)!=null&&r.red)?(o.red=!0,e=t,t=e.parent):((s=o[u])!=null&&s.red||(o[i].red=!1,o.red=!0,this.rotateNode(o,u),o=t[u]),o.red=t.red,t.red=!1,o[u].red=!1,this.rotateNode(t,i),e=this.root,t=null))}e&&(e.red=!1)}insert(t){var n;let e=this.insertNode(Cn,t);if(e){for(;(n=e.parent)!=null&&n.red;){let r=e.parent,s=r.directionFromParent(),i=s==="right"?"left":"right",u=r.parent[i]??null;u!=null&&u.red?(r.red=!1,u.red=!1,r.parent.red=!0,e=r.parent):(e===r[i]&&(e=r,this.rotateNode(e,s),r=e.parent),r.red=!1,r.parent.red=!0,this.rotateNode(r.parent,i))}this.root.red=!1}return!!e}remove(t){let e=this.removeNode(t);return e&&!e.red&&this.removeFixup(e.parent,e.left??e.right),!!e}};function si(t,e){return{lift:n=>[t.lift(n),e.lift(n)],combine:(n,r)=>{let s=t.combine(n[0],r[0]),i=e.combine(n[1],r[1]);return[s,i]},neutral:[t.neutral,e.neutral]}}var vl={lift:t=>1,combine:(t,e)=>t+e,neutral:0},ii=class extends Cn{constructor(t,e,n){super(t,e),this.label=n.neutral,this.liftedValue=n.lift(e),this.monoid=n}updateLabel(t=!0,e){var n,r,s;this.left!==null&&this.right===null?this.label=this.monoid.combine(this.left.label,this.liftedValue):this.left===null&&this.right!==null?this.label=this.monoid.combine(this.liftedValue,this.right.label):this.left&&this.right?this.label=this.monoid.combine(((n=this.left)==null?void 0:n.label)||this.monoid.neutral,this.monoid.combine(this.liftedValue,((r=this.right)==null?void 0:r.label)||this.monoid.neutral)):this.label=this.liftedValue,t&&((s=this.parent)==null||s.updateLabel(!0,"Updated by child"))}},Bl=class extends Wn{constructor(t,e){super(e),this.monoid=si(t,si(vl,{lift:n=>[n],combine:(n,r)=>n.concat(r),neutral:[]}))}getLowestValue(){if(!this.root)throw new Error("Can't get a range from a tree with no items");return this.root.findMinNode().value}rotateNode(t,e){var s;let n=e==="left"?"right":"left";if(!t[n])throw new TypeError(`cannot rotate ${e} without ${n} child`);let r=t[n];if(t[n]=r[e]??null,r[e]&&(r[e].parent=t),r.parent=t.parent,t.parent){let i=t===t.parent[e]?e:n;t.parent[i]=r}else this.root=r;r[e]=t,t.parent=r,(s=r[e])==null||s.updateLabel(!1,"Node rotated"),console.groupEnd()}removeFixup(t,e){var n,r,s;for(;t&&!(e!=null&&e.red);){let i=t.left===e?"left":"right",u=i==="right"?"left":"right",o=t[u];o!=null&&o.red&&(o.red=!1,t.red=!0,this.rotateNode(t,i),o=t[u]),o&&(!((n=o.left)!=null&&n.red)&&!((r=o.right)!=null&&r.red)?(o.red=!0,e=t,t=e.parent):((s=o[u])!=null&&s.red||(o[i].red=!1,o.red=!0,this.rotateNode(o,u),o=t[u]),o.red=t.red,t.red=!1,o[u].red=!1,this.rotateNode(t,i),e=this.root,t=null))}e&&(e.red=!1)}insertFingerprintNode(t){if(this.root){let e=this.root;for(;;){let n=this.compare(t,e.value);if(n===0)break;let r=n<0?"left":"right";if(e[r])e=e[r];else return e[r]=new ii(e,t,this.monoid),this._size++,e[r]}}else return this.root=new ii(null,t,this.monoid),this._size++,this.root;return null}insert(t){var r;let e=this.insertFingerprintNode(t),n=e;if(n){for(;(r=n.parent)!=null&&r.red;){let s=n.parent,i=s.directionFromParent(),u=i==="right"?"left":"right",o=s.parent[u]??null;o!=null&&o.red?(s.red=!1,o.red=!1,s.parent.red=!0,n=s.parent):(n===s[u]&&(n=s,this.rotateNode(n,i),s=n.parent),s.red=!1,s.parent.red=!0,this.rotateNode(s.parent,u))}this.root.red=!1}return e==null||e.updateLabel(!0,"Node inserted"),!!n}remove(t){var n;let e=this.removeNode(t);return e&&!e.red&&this.removeFixup(e.parent,e.left??e.right),e&&((n=e.parent)==null||n.updateLabel(!0,"Child node removed")),!!e}getFingerprint(t,e,n){if(this.root===null)return{fingerprint:this.monoid.neutral[0],size:0,items:[],nextTree:null};let r=n||this.findGteNode(t),s=this.compare(t,e);if(s===0)return{fingerprint:this.root.label[0],size:this.root.label[1][0],items:this.root.label[1][1],nextTree:null};if(s<0){let{label:i,nextTree:u}=this.aggregateUntil(r,t,e);return{fingerprint:i[0],size:i[1][0],items:i[1][1],nextTree:u}}else{let i=this.root.findMinNode(),u=this.root.findMaxNode(),{label:o,nextTree:a}=this.aggregateUntil(r,t,u.value),l=this.monoid.combine(o,this.compare(u.value,t)>=0?this.monoid.lift(u.value):this.monoid.neutral);if(i.value===e)return{fingerprint:l[0],size:l[1][0],items:l[1][1],nextTree:a};let{label:c,nextTree:h}=this.aggregateUntil(i,i.value,e),f=this.monoid.combine(c,l);return{fingerprint:f[0],size:f[1][0],items:f[1][1],nextTree:h}}}findGteNode(t){let e=this.root;for(;e;){let n=this.compare(t,e.value);if(n===0)break;let r=n<0?"left":"right";if(e[r])e=e[r];else break}return e}aggregateUntil(t,e,n){let{label:r,nextTree:s}=this.aggregateUp(t,e,n);return s===null||this.compare(s.value,n)>=0?{label:r,nextTree:s}:this.aggregateDown(s.right,n,this.monoid.combine(r,s.liftedValue))}aggregateUp(t,e,n){var i;let r=this.monoid.neutral,s=t;for(;this.compare(s.findMaxNode().value,n)<0;){if(this.compare(s.value,e)>=0&&(r=this.monoid.combine(r,this.monoid.combine(s.liftedValue,((i=s.right)==null?void 0:i.label)||this.monoid.neutral))),s.parent===null)return{label:r,nextTree:null};s=s.parent}return{label:r,nextTree:s}}aggregateDown(t,e,n){var i,u;let r=t,s=n;for(;r!==null;)if(this.compare(r.value,e)<0)s=this.monoid.combine(s,this.monoid.combine(((i=r.left)==null?void 0:i.label)||this.monoid.neutral,r.liftedValue)),r=r.right;else{if(r.left===null||this.compare(r.left.findMaxNode().value,e)<0)return{label:this.monoid.combine(s,((u=r.left)==null?void 0:u.label)||this.monoid.neutral),nextTree:r};r=r.left}return{label:s,nextTree:null}}};function xl(){let t,e="pending",n=new Promise((r,s)=>{t={async resolve(i){await i,e="fulfilled",r(i)},reject(i){e="rejected",s(i)}}});return Object.defineProperty(n,"state",{get:()=>e}),Object.assign(n,t)}var Sl=class{constructor(){this.deferreds=new Set,this.state="pending"}resolve(t){if(this.state==="pending"){this.state="fulfilled";for(let e of this.deferreds)e.resolve(t)}}reject(t){if(this.state==="pending"){this.state="rejected";for(let e of this.deferreds)e.reject(t)}}tee(){let t=xl();return this.state==="fulfilled"?t.resolve():this.state==="rejected"?t.reject():this.deferreds.add(t),t}},$l=class{constructor(t){this.isDoneTee=new Sl,this.insertionCallbacks=new Set,this.lowerBoundFromPrev=null,this.collatedPayload=null,this.collatePayloads=e=>{switch(e.type){case"payload":{let n=this.collatedPayload;if(n===null&&(n={type:"payload",lowerBound:e.lowerBound,payload:[],end:{canRespond:!1,upperBound:e.payload}}),n.payload.push(e.payload),this.collatedPayload=n,e.end)return e.end.upperBound?n.end=e.end:n.end={...e.end,upperBound:e.payload},this.collatedPayload=null,n;break}default:return this.collatedPayload&&(this.collatedPayload=null),e}},this.reusableTree=void 0,this.lastAdjacentDoneUpperBound=null,this.isDoneSoFar=!0,this.tree=t.tree,this.fingerprintEquals=t.fingerprintEquals,this.encoding=t.encoding,this.payloadThreshold=t.payloadThreshold,this.rangeDivision=t.rangeDivision}decode(t){let e=this.lowerBoundFromPrev;try{return{type:"emptySet",canRespond:this.encoding.decode.emptySet(t)}}catch{}try{let n=this.encoding.decode.lowerBound(t);return this.lowerBoundFromPrev=n,{type:"lowerBound",value:n}}catch{}try{return this.encoding.decode.terminal(t),{type:"terminal"}}catch{}try{let n=this.encoding.decode.done(t);return this.lowerBoundFromPrev=n,{lowerBound:e,type:"done",upperBound:n}}catch{}try{let n=this.encoding.decode.fingerprint(t);return this.lowerBoundFromPrev=n.upperBound,{type:"fingerprint",lowerBound:e,fingerprint:n.fingerprint,upperBound:n.upperBound}}catch{}try{let n=this.encoding.decode.payload(t);return n.end&&(this.lowerBoundFromPrev=n.end.upperBound),{type:"payload",lowerBound:e,payload:n.value,...n.end?{end:n.end}:{}}}catch{}try{let n=this.encoding.decode.emptyPayload(t);return this.lowerBoundFromPrev=n,{lowerBound:e,type:"emptyPayload",upperBound:n}}catch{}return null}setReusableTree(t){this.reusableTree=t||void 0}process(t){let e=this.reusableTree;switch(t.type){case"lowerBound":case"terminal":case"done":return this.setReusableTree(null),[t];case"emptySet":{if(t.canRespond===!1&&this.isDoneTee.resolve(),this.tree.size===0)return[{type:"emptySet",canRespond:!1}];let n=this.tree.getLowestValue(),r=[{type:"lowerBound",value:n}],s=Array.from(this.tree.lnrValues());for(let i=0;i<s.length;i++){let u=s[i];i===s.length-1?r.push({type:"payload",payload:u,end:{upperBound:n,canRespond:!1}}):r.push({type:"payload",payload:u})}return r.push({type:"terminal"}),r}case"fingerprint":{let{fingerprint:n,size:r,items:s,nextTree:i}=this.tree.getFingerprint(t.lowerBound,t.upperBound,e);if(this.setReusableTree(i),this.fingerprintEquals(n,t.fingerprint))return[{type:"done",upperBound:t.upperBound}];if(r<=this.payloadThreshold){if(r===0)return[{type:"emptyPayload",upperBound:t.upperBound}];let u=[];for(let o=0;o<r;o++)u.push({type:"payload",payload:s[o],...o===s.length-1?{end:{upperBound:t.upperBound,canRespond:!0}}:{}});return u}else{let u=Math.ceil(r/this.rangeDivision),o=[];if(u<=this.payloadThreshold){for(let h=0;h<s.length;h++)o.push({type:"payload",payload:s[h],...h===s.length-1?{end:{upperBound:t.upperBound,canRespond:!0}}:{}});return o}let a,l=s,c=!1;if(t.lowerBound>=t.upperBound){let h=s.findIndex(f=>f>=t.lowerBound);if(h>0){let f=l.splice(0,h);l.push(...f),c=!0}}for(let h=0;h<r;h+=u){let f=l[h],d=l[h+u]||t.upperBound,{fingerprint:p,nextTree:D}=this.tree.getFingerprint(f,d,a);a=c?void 0:D||void 0,o.push({type:"fingerprint",fingerprint:p,upperBound:d})}return o}}case"payload":{for(let n of t.payload){this.tree.insert(n);for(let r of this.insertionCallbacks)r(n)}if(t.end.canRespond){let{items:n,size:r,nextTree:s}=this.tree.getFingerprint(t.lowerBound,t.end.upperBound,e);if(this.setReusableTree(s),r===0)return[{type:"emptyPayload",upperBound:t.end.upperBound}];let i=[];for(let u=0;u<r;u++)i.push({type:"payload",payload:n[u],...u===n.length-1?{end:{upperBound:t.end.upperBound,canRespond:!1}}:{}});return i}else return this.setReusableTree(null),[{type:"done",upperBound:t.end.upperBound}]}case"emptyPayload":{this.setReusableTree(null);let{items:n,size:r,nextTree:s}=this.tree.getFingerprint(t.lowerBound,t.upperBound);if(this.setReusableTree(s),r===0)return this.setReusableTree(null),[];let i=[];for(let u=0;u<r;u++)i.push({type:"payload",payload:n[u],...u===n.length-1?{end:{upperBound:t.upperBound,canRespond:!1}}:{}});return i}}}consolidateAdjacentDones(t){switch(t.type){case"done":{this.lastAdjacentDoneUpperBound=t.upperBound;break}default:{let e=this.lastAdjacentDoneUpperBound;return e?(this.lastAdjacentDoneUpperBound=null,[{type:"done",upperBound:e},t]):[t]}}}checkIsDone(t){var e;switch(t.type){case"emptySet":{t.canRespond&&(this.isDoneSoFar=!1);break}case"lowerBound":break;case"fingerprint":this.isDoneSoFar=!1;break;case"emptyPayload":this.isDoneSoFar=!1;break;case"payload":((e=t.end)==null?void 0:e.canRespond)===!0&&(this.isDoneSoFar=!1);break;case"terminal":this.isDoneSoFar?this.isDoneTee.resolve():this.isDoneSoFar=!0}}encode(t){let e;switch(t.type){case"emptySet":{e=this.encoding.encode.emptySet(t.canRespond);break}case"lowerBound":{e=this.encoding.encode.lowerBound(t.value);break}case"done":{e=this.encoding.encode.done(t.upperBound);break}case"fingerprint":{e=this.encoding.encode.fingerprint(t.fingerprint,t.upperBound);break}case"payload":{e=this.encoding.encode.payload(t.payload,t.end);break}case"emptyPayload":{e=this.encoding.encode.emptyPayload(t.upperBound);break}case"terminal":{e=this.encoding.encode.terminal();break}}return e}respond(t){if(this.isDone().state==="fulfilled")return[];let e=this.decode(t),n=this.collatePayloads(e);if(n===void 0)return[];let r=this.process(n||[]),s=[];for(let u of r){let o=this.consolidateAdjacentDones(u);o&&s.push(...o)}for(let u of s)this.checkIsDone(u);let i=[];for(let u of s)i.push(this.encode(u));return i}isDone(){return this.isDoneTee.tee()}initialMessages(t){let{tree:e,encoding:n,payloadThreshold:r,rangeDivision:s}=this;function*i(){if(e.size===0){yield n.encode.emptySet(!0);return}let u=e.getLowestValue();yield n.encode.lowerBound(u);let{items:o}=e.getFingerprint(u,u),a=(t||(c=>{let h=Math.ceil(c.length/s),f=[];for(let d=0;d<c.length;d+=h){let p=c.slice(d,d+h);f.push(p)}return f}))(o),l;for(let c=0;c<a.length;c++){let h=a[c+1]?a[c+1][0]:u,f=a[c];if(f.length<=r)for(let d=0;d<f.length;d++)yield n.encode.payload(f[d],d===f.length-1?{upperBound:h,canRespond:!0}:void 0);else{let d=f[0],{fingerprint:p,nextTree:D}=e.getFingerprint(d,h,l);l=D||void 0,yield n.encode.fingerprint(p,h)}}yield n.encode.terminal()}return i()}onInsertion(t){return this.insertionCallbacks.add(t),()=>{this.insertionCallbacks.delete(t)}}},ui=Symbol("Stream ended."),Kr=Symbol("Stream errored."),It,sn,gt,sr,ms,En,br,Fu,Rt=(Fu=class{constructor(t){Ge(this,sr);Ge(this,En);Ge(this,It,void 0);Ge(this,sn,void 0);Ge(this,gt,void 0);var e,n,r;de(this,It,[]),de(this,sn,null),this.push=(...s)=>{s.length?hn(this,En,br).call(this,!1,s):(hn(this,En,br).call(this,!1,[Kr]),hn(this,sr,ms).call(this,new Error("AsyncQueueError: queue.push was called with no arguments")))},this.close=({immediately:s=!1,withError:i}={})=>{i&&hn(this,sr,ms).call(this,i),hn(this,En,br).call(this,s,[i?Kr:ui]),this.push=this.close=()=>{}},(r=(n=(e=t==null?void 0:t.catch)==null?void 0:e.call(t,s=>this.close({withError:s})))==null?void 0:n.finally)==null||r.call(n,()=>this.close())}get length(){return z(this,It).length}async*[Symbol.asyncIterator](){for(;;){let t=z(this,It).length?z(this,It).shift():await new Promise(e=>{de(this,sn,e)});if(t===Kr)throw z(this,gt);if(t===ui)break;yield t}}},It=new WeakMap,sn=new WeakMap,gt=new WeakMap,sr=new WeakSet,ms=function(t){z(this,gt)instanceof AggregateError?z(this,gt).errors.push(t):z(this,gt)?de(this,gt,new AggregateError([z(this,gt),t])):de(this,gt,t)},En=new WeakSet,br=function(t,e){var n;z(this,It)[t?"unshift":"push"](...e),(n=z(this,sn))==null||n.call(this,z(this,It).shift()),de(this,sn,null)},Fu);function q(){let t,e="pending",n=new Promise((r,s)=>{t={async resolve(i){await i,e="fulfilled",r(i)},reject(i){e="rejected",s(i)}}});return Object.defineProperty(n,"state",{get:()=>e}),Object.assign(n,t)}new TextDecoder;var Il=new TextEncoder;function gs(t){return Il.encode(t)}function Tl(t){return gs(t).length}function ws(t,e){for(let n of t)if(e.indexOf(n)===-1)return!1;return!0}function ai(t){return t===""?!1:ar.indexOf(t)!==-1}var xn="abcdefghijklmnopqrstuvwxyz",Rl=xn.toUpperCase(),ar="0123456789",Pt=xn+"234567",qu=xn+ar,Pl=Pt,Wu=qu+Pt+"@.",Vu=xn+ar,Ml=xn+ar,Qu=Vu+Pt+"+.",Ol="/'()-._~!$&+,:=@%",Ku=xn+Rl+ar+Ol;function Nl(t,e){return`@${t}.${e}`}function Ll(t,e){return`+${t}.${e}`}function Ts(t){let e=Gu(t);return Su(e)?!0:e}function or(t){let e=Zu(t);return Su(e)?!0:e}function bs(t){return t.startsWith("@")?Gu(t):t.startsWith("+")?Zu(t):new T("address must start with either @ or +")}function Gu(t){return Xu(t,{sigil:"@",separator:".",minNameLength:4,maxNameLength:4,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:qu,allowedPubkeyCharacters:Pl,pubkeyMustStartWithB:!0})}function Zu(t){return Xu(t,{sigil:"+",separator:".",minNameLength:1,maxNameLength:15,minPubkeyLength:1,maxPubkeyLength:53,allowedNameCharacters:Vu,allowedPubkeyCharacters:Ml,pubkeyMustStartWithB:!1})}function Xu(t,e){let{sigil:n,separator:r,minNameLength:s,maxNameLength:i,minPubkeyLength:u,maxPubkeyLength:o,allowedNameCharacters:a,allowedPubkeyCharacters:l,pubkeyMustStartWithB:c}=e;if(typeof t!="string")return new T("address must be a string");if(t.length<4)return new T("address is too short");if(t[0]!==n)return new T(`address must start with a sigil: "${n}"`);if(t.indexOf(r)===-1)return new T(`address must contain a separator character: "${r}"`);let h=t.slice(1).split(r);if(h.length!==2)return new T(`address must have exactly 2 parts separated by a "${r}" separator`);let[f,d]=h;return f.length<s||f.length>i?new T(`name must be between ${s} and ${i} characters long, but is ${f.length}`):d.length<u||d.length>o?new T(`pubkey must be between ${u} and ${o} characters long, but is ${d.length}`):ws(f,a)?ws(d,l)?ai(f[0])?new T(`name "${f}" must not start with a digit`):ai(d[0])?new T(`pubkey "${d}" must not start with a digit`):c&&d[0]!=="b"?new T(`pubkey "${d}" must start with 'b'`):{address:t,name:f,pubkey:d}:new T(`pubkey "${d}" must only have allowed characters`):new T(`name "${f}" must only have allowed characters`)}function Rs(t){return!(Object.prototype.toString.call(t)!=="[object Object]"||(""+t.constructor).startsWith("class"))}function Yu(t){return e=>e!==t?`expected literal value ${JSON.stringify(t)}`:null}function Xe(t={}){return e=>{if(t.optional!==!0&&e===void 0)return"required";if(t.optional===!0&&e===void 0)return null;let n=Tl(e);return typeof e!="string"?"expected a string but got "+JSON.stringify(e):t.minLen!==void 0&&n<t.minLen?`string shorter than min length of ${t.minLen} chars`:t.maxLen!==void 0&&n>t.maxLen?`string shorter than max length of ${t.maxLen} chars`:t.len!==void 0&&n!==t.len?`string does not have required length of ${t.len} chars: ${e}`:t.allowedChars!==void 0&&!ws(e,t.allowedChars)?"contains disallowed characters":null}}function Qn(t={}){return e=>t.optional!==!0&&e===void 0?"required":t.optional===!0&&e===void 0?null:t.nullable!==!0&&e===null?"not nullable":t.nullable===!0&&e===null?null:typeof e!="number"?"expected a number but got "+JSON.stringify(e):isNaN(e)?"is NaN":isFinite(e)?e!==Math.round(e)?"expected an integer":t.min!==void 0&&e<t.min?`integer too small (must be >= ${t.min})`:t.max!==void 0&&e>t.max?`integer too large (must be <= ${t.max})`:null:"is Infinity"}function Ju(t={}){return t.allowLiteralUndefined=t.allowLiteralUndefined??!1,t.allowExtraKeys=t.allowExtraKeys??!1,e=>{if(!Rs(e))return"expected an object";if(t.allowLiteralUndefined===!1){for(let[n,r]of Object.entries(e))if(r===void 0)return`${n} is explicitly set to undefined but should be missing instead`}if(t.objSchema!==void 0){if(t.allowExtraKeys===!1){let n=Object.keys(e),r=Object.keys(t.objSchema),s=n.filter(i=>r.indexOf(i)===-1);if(s.length>0)return`object has extra keys not in the schema: ${s.join(", ")}`}for(let[n,r]of Object.entries(t.objSchema)){let s=r(e[n]);if(s!==null)return`${n}: ${s}`}}return null}}var{codec:ea}=Tu,ta={chars:"abcdefghijklmnopqrstuvwxyz234567",bits:5};function dn(t){return"b"+ea.stringify(t,ta,{pad:!1})}function Fr(t){if(!t.startsWith("b"))throw new T("can't decode base32 string - it should start with a 'b'. "+t);if(t[t.length-1]==="=")throw new T("can't decode base32 string - it contains padding characters ('=')");return ea.parse(t.slice(1),ta,{loose:!0})}var Ul=(t=>(t[t.None=-1]="None",t[t.Error=0]="Error",t[t.Warn=1]="Warn",t[t.Log=2]="Log",t[t.Info=3]="Info",t[t.Debug=4]="Debug",t))(Ul||{}),zl=0,Gr={_default:zl};function Hl(t){return t in Gr?Gr[t]:Gr._default}var yt=class{constructor(e,n){this.color=void 0,this.source=e,this.color=n||"aqua"}_print(e,n,r,...s){if(e<=Hl(this.source))if(n){let i=`[${this.source}]`;if(this.color!==void 0){let u=[`%c ${i}`,`color: ${this.color}`];console.log(r,...u,...s)}else console.log(r,i,...s)}else console.log(r,...s)}error(...e){this._print(0,!0,"!!",...e)}warn(...e){this._print(1,!0,"! ",...e)}log(...e){this._print(2,!0,"  ",...e)}info(...e){this._print(3,!0,"    ",...e)}debug(...e){this._print(4,!0,"      ",...e)}blank(){this._print(3,!1,"")}},jl=class{constructor(t){this.hash=t.hash,this.internalUpdate=t.update,this.internalDigest=t.digest}update(t){return this.hash=this.internalUpdate(this.hash,t),this.hash}digest(){return this.internalDigest(this.hash)}},{createHash:Zr}=Pu,Xr=new yt("crypto-driver-noble","cyan"),ql=class{static sha256(t){return typeof t=="string"?Promise.resolve(Zr("sha256").update(t,"utf-8").digest()):Promise.resolve(Zr("sha256").update(t).digest())}static updatableSha256(){return new jl({hash:Zr("sha256"),update:(t,e)=>t.update(e),digest:t=>t.digest()})}static async generateKeypairBytes(){Xr.debug("generateKeypairBytes");let t=jn.utils.randomPrivateKey();return{pubkey:await jn.getPublicKey(t),secret:t}}static sign(t,e){return Xr.debug("sign"),typeof e=="string"&&(e=gs(e)),jn.sign(e,t.secret)}static async verify(t,e,n){Xr.debug("verify");try{return typeof n=="string"&&(n=gs(n)),await jn.verify(e,n,t)}catch{return!1}}};function oi(){return Date.now()*1e3}function na(t){return new Promise(e=>{setTimeout(e,t)})}function Mt(){return""+Math.floor(Math.random()*1e3)+Math.floor(Math.random()*1e3)}function Wl(t){try{let e=ra(t)?t.address:t.shareAddress,n=bs(e);if(I(n))return n;let r={pubkey:Fr(n.pubkey),secret:Fr(t.secret)};return r.pubkey.length!==32?new T(`pubkey bytes should be 32 bytes long, not ${r.pubkey.length} after base32 decoding.  ${e}`):r.secret.length!==32?new T(`secret bytes should be 32 bytes long, not ${r.secret.length} after base32 decoding.  ${t.secret}`):r}catch(e){return new T("crash while decoding author keypair: "+e.message)}}function ra(t){return"address"in t}var Vl=ql,pn=Vl,Mn=new yt("crypto","cyan"),Se=class{static async sha256base32(e){let n=await pn.sha256(e);return dn(n)}static updatableSha256(){return pn.updatableSha256()}static async generateAuthorKeypair(e){Mn.debug(`generateAuthorKeypair("${e}")`);let n=await pn.generateKeypairBytes(),r={address:Nl(e,dn(n.pubkey)),secret:dn(n.secret)},s=Ts(r.address);return I(s)?s:r}static async generateShareKeypair(e){Mn.debug(`generateAuthorKeypair("${e}")`);let n=await pn.generateKeypairBytes(),r={shareAddress:Ll(e,dn(n.pubkey)),secret:dn(n.secret)},s=or(r.shareAddress);return I(s)?s:r}static async sign(e,n){Mn.debug("sign");try{let r=Wl(e);if(I(r))return r;let s=await pn.sign(r,n);return dn(s)}catch(r){return new T("unexpected error while signing: "+r.message)}}static verify(e,n,r){Mn.debug("verify");try{let s=bs(e);return I(s)?Promise.resolve(!1):pn.verify(Fr(s.pubkey),Fr(n),r)}catch{return Promise.resolve(!1)}}static async checkKeypairIsValid(e){Mn.debug("checkAuthorKeypairIsValid");let n=ra(e)?e.address:e.shareAddress;try{if(typeof n!="string"||typeof e.secret!="string")return new T("address and secret must be strings");let r=bs(n);if(I(r))return r;let s="a test message to sign. "+Mt(),i=await this.sign(e,s);return I(i)?i:await this.verify(n,i,s)===!1?new T("pubkey does not match secret"):!0}catch(r){return new T("unexpected error in checkAuthorKeypairIsValid: "+r.message)}}},Ql=10,Kl=Ql*60*1e3*1e3,li=1e13,ci=9007199254740990,Gl=4e6,Zl=53,Xl=104,hi={objSchema:{format:Yu("es.4"),author:Xe({allowedChars:Wu}),content:Xe({maxLen:Gl}),contentHash:Xe({allowedChars:Pt,len:Zl}),deleteAfter:Qn({min:li,max:ci,nullable:!0}),path:Xe({allowedChars:Ku,minLen:2,maxLen:512}),signature:Xe({allowedChars:Pt,len:Xl}),timestamp:Qn({min:li,max:ci}),workspace:Xe({allowedChars:Qu})},allowLiteralUndefined:!1,allowExtraKeys:!1},Yr;Yr=class{static hashDocument(t){let e={...t,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},n=this._checkBasicDocumentValidity(e);return I(n)?Promise.resolve(n):Se.sha256base32(`author	${t.author}
contentHash	${t.contentHash}
`+(t.deleteAfter===null?"":`deleteAfter	${t.deleteAfter}
`)+`format	${t.format}
path	${t.path}
timestamp	${t.timestamp}
workspace	${t.workspace}
`)}static async generateDocument({input:t,keypair:e,share:n,timestamp:r}){let s={format:"es.4",author:e.address,content:t.content,contentHash:await Se.sha256base32(t.content),deleteAfter:t.deleteAfter??null,path:t.path,timestamp:r,workspace:n,signature:"?"},i=await this.signDocument(e,s);return I(i)?i:{doc:i}}static async signDocument(t,e){let n=await this.hashDocument(e);if(I(n))return n;let r=await Se.sign(t,n);return I(r)?r:{...e,signature:r}}static async wipeDocument(t,e){if(e.content.length===0)return e;let n=this.removeExtraFields(e);if(I(n))return n;let r={...n.doc,content:"",contentHash:await Se.sha256base32(""),signature:"?"};return this.signDocument(t,r)}static removeExtraFields(t){if(!Rs(t))return new T("doc is not a plain javascript object");let e=new Set(Object.keys(hi.objSchema||{})),n={},r={};for(let[s,i]of Object.entries(t))if(e.has(s))n[s]=i;else{if(!s.startsWith("_"))return new T("extra document fields must have names starting with an underscore");r[s]=i}return{doc:n,extras:r}}static async checkDocumentIsValid(t,e){e===void 0&&(e=Date.now()*1e3);let n=this._checkBasicDocumentValidity(t);if(I(n))return n;let r=this._checkTimestampIsOk(t.timestamp,t.deleteAfter,e);if(I(r))return r;let s=this._checkAuthorCanWriteToPath(t.author,t.path);if(I(s))return s;let i=this._checkPathIsValid(t.path,t.deleteAfter);if(I(i))return i;let u=Ts(t.author);if(I(u))return u;let o=or(t.workspace);if(I(o))return o;let a=await this._checkAuthorSignatureIsValid(t);if(I(a))return a;let l=await this._checkContentMatchesHash(t.content,t.contentHash);return I(l)?l:!0}static _checkBasicDocumentValidity(t){let e=Ju(hi)(t);return e!==null?new T(e):!0}static _checkAuthorCanWriteToPath(t,e){return e.indexOf("~")===-1||e.indexOf("~"+t)!==-1?!0:new T(`author ${t} can't write to path ${e}`)}static _checkTimestampIsOk(t,e,n){if(t>n+Kl)return new T("timestamp too far in the future");if(e!==null){if(n>e)return new T("ephemeral doc has expired");if(e<=t)return new T("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(t,e){if(!t.startsWith("/"))return new T("invalid path: must start with /");if(t.endsWith("/"))return new T("invalid path: must not end with /");if(t.startsWith("/@"))return new T('invalid path: must not start with "/@"');if(t.indexOf("//")!==-1)return new T("invalid path: must not contain two consecutive slashes");if(e!==void 0){if(t.indexOf("!")===-1&&e!==null)return new T("when deleteAfter is set, path must contain '!'");if(t.indexOf("!")!==-1&&e===null)return new T("when deleteAfter is null, path must not contain '!'")}return!0}static async _checkAuthorSignatureIsValid(t){try{let e=await this.hashDocument(t);return I(e)?e:await Se.verify(t.author,t.signature,e)!==!0?new T("signature is invalid"):!0}catch{return new T("signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(t,e){return await Se.sha256base32(t)!==e?new T("content does not match contentHash"):!0}static getAttachmentInfo(t){return new T("es.4 does not support attachments")}static updateAttachmentFields(t,e,n,r){return Promise.resolve(new T("es.4 does not support attachments"))}static authorFromCredentials(t){return t.address}},Yr.id="es.4";var Yl=10,Jl=Yl*60*1e3*1e3,fi=1e13,di=9007199254740990,ec=8e3,pi=53,Di=104,tc=0,nc=Number.MAX_SAFE_INTEGER,mi={objSchema:{format:Yu("es.5"),author:Xe({allowedChars:Wu}),text:Xe({maxLen:ec}),textHash:Xe({allowedChars:Pt,len:pi}),deleteAfter:Qn({min:fi,max:di,optional:!0}),path:Xe({allowedChars:Ku,minLen:2,maxLen:512}),signature:Xe({allowedChars:Pt,len:Di}),shareSignature:Xe({allowedChars:Pt,len:Di}),timestamp:Qn({min:fi,max:di}),share:Xe({allowedChars:Qu}),attachmentSize:Qn({min:tc,max:nc,optional:!0}),attachmentHash:Xe({allowedChars:Pt,len:pi,optional:!0})},allowLiteralUndefined:!1,allowExtraKeys:!1},Jr,rc=(Jr=class{static hashDocument(t){let e={...t,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",shareSignature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},n=this._checkBasicDocumentValidity(e);return I(n)?Promise.resolve(n):Se.sha256base32((t.attachmentHash===void 0?"":`attachmentHash	${t.attachmentHash}
`)+(t.attachmentSize===void 0?"":`attachmentSize	${t.attachmentSize}
`)+`author	${t.author}
`+(t.deleteAfter===void 0?"":`deleteAfter	${t.deleteAfter}
`)+`format	${t.format}
path	${t.path}
textHash	${t.textHash}
timestamp	${t.timestamp}
share	${t.share}
`)}static async generateDocument({input:t,keypair:e,share:n,timestamp:r,prevLatestDoc:s,config:i}){if(t.text===void 0&&(s==null?void 0:s.text)===void 0)return new T("Couldn't determine document text from given input or previous version's text.");let u=t.text!==void 0?t.text:s==null?void 0:s.text,o={...s,format:"es.5",author:e.address,text:u,textHash:await Se.sha256base32(u),path:t.path,timestamp:r,share:n,signature:"?",shareSignature:"?"};t.deleteAfter&&(o.deleteAfter=t.deleteAfter);let a=await this.signDocument(e,o,i);return I(a)?a:t.attachment?{doc:a,attachment:t.attachment}:{doc:a}}static async signDocument(t,e,n){let r=await this.hashDocument(e);if(I(r))return r;let s=await Se.sign(t,r);if(n.shareSecret===void 0)return new Ke(`Tried to write a document to ${e.share} without the secret.`);let i=await Se.sign({shareAddress:e.share,secret:n.shareSecret},r);return I(s)?s:I(i)?i:{...e,signature:s,shareSignature:i}}static async wipeDocument(t,e,n){if(e.text.length===0)return e;let r=this.removeExtraFields(e);if(I(r))return r;let s=r.doc;if(s.attachmentHash){let u={...s,text:"",textHash:await Se.sha256base32(""),signature:"?",shareSignature:"?",attachmentHash:await Se.sha256base32(""),attachmentSize:0};return this.signDocument(t,u,n)}let i={...s,text:"",textHash:await Se.sha256base32(""),signature:"?",shareSignature:"?"};return this.signDocument(t,i,n)}static removeExtraFields(t){if(!Rs(t))return new T("doc is not a plain javascript object");let e=new Set(Object.keys(mi.objSchema||{})),n={},r={};for(let[s,i]of Object.entries(t))if(e.has(s))n[s]=i;else{if(!s.startsWith("_"))return new T("extra document fields must have names starting with an underscore");r[s]=i}return{doc:n,extras:r}}static async checkDocumentIsValid(t,e){e===void 0&&(e=Date.now()*1e3);let n=this._checkBasicDocumentValidity(t);if(I(n))return n;let r=this._checkTimestampIsOk(t.timestamp,t.deleteAfter?t.deleteAfter:null,e);if(I(r))return r;let s=this._checkAuthorCanWriteToPath(t.author,t.path);if(I(s))return s;let i=this._checkAttachmentFieldsConsistent(t);if(I(i))return i;let u=this._checkPathIsValid(t.path,!!t.attachmentHash,t.deleteAfter);if(I(u))return u;let o=Ts(t.author);if(I(o))return o;let a=or(t.share);if(I(a))return a;let l=await this._checkAuthorSignatureIsValid(t);if(I(l))return l;let c=await this._checkShareSignatureIsValid(t);if(I(c))return c;let h=await this._checkContentMatchesHash(t.text,t.textHash);return I(h)?h:!0}static _checkBasicDocumentValidity(t){let e=Ju(mi)(t);return e!==null?new T(e):!0}static _checkAttachmentFieldsConsistent(t){return t.text.length===0&&t.attachmentSize&&t.attachmentSize>0?new T("Documents with attachments must have text."):(t.text.length>0&&t.attachmentSize&&t.attachmentSize,t.attachmentHash&&t.attachmentSize===void 0?new T("Attachment size is undefined while attachment hash is defined"):t.attachmentSize&&t.attachmentHash===void 0?new T("Attachment hash is undefined while attachment size is defined"):!0)}static _checkAuthorCanWriteToPath(t,e){return e.indexOf("~")===-1||e.indexOf("~"+t)!==-1?!0:new T(`author ${t} can't write to path ${e}`)}static _checkTimestampIsOk(t,e,n){if(t>n+Jl)return new T("timestamp too far in the future");if(e!==null){if(n>e)return new T("ephemeral doc has expired");if(e<=t)return new T("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(t,e,n){if(!t.startsWith("/"))return new T("invalid path: must start with /");if(t.endsWith("/"))return new T("invalid path: must not end with /");if(t.startsWith("/@"))return new T('invalid path: must not start with "/@"');if(t.indexOf("//")!==-1)return new T("invalid path: must not contain two consecutive slashes");if(n!==void 0){if(t.indexOf("!")===-1&&n!==null)return new T("when deleteAfter is set, path must contain '!'");if(t.indexOf("!")!==-1&&n===null)return new T("when deleteAfter is null, path must not contain '!'")}return!gi(t)&&e?new T("when a attachment is provided, the path must end with a file extension"):gi(t)&&e===!1?new T("when no attachment is provided, the path cannot end with a file extension"):!0}static async _checkAuthorSignatureIsValid(t){try{let e=await this.hashDocument(t);return I(e)?e:await Se.verify(t.author,t.signature,e)!==!0?new T("signature is invalid"):!0}catch{return new T("signature is invalid (unexpected exception)")}}static async _checkShareSignatureIsValid(t){try{let e=await this.hashDocument(t);return I(e)?e:await Se.verify(t.share,t.shareSignature,e)!==!0?new T("share signature is invalid"):!0}catch{return new T("share signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(t,e){return await Se.sha256base32(t)!==e?new T("content does not match contentHash"):!0}static getAttachmentInfo(t){return t.attachmentHash&&t.attachmentSize===0?new T("This document has had its attachment wiped"):!t.attachmentHash||!t.attachmentSize?new T("This document has no attachment."):{size:t.attachmentSize,hash:t.attachmentHash}}static updateAttachmentFields(t,e,n,r,s){let i={...e,attachmentHash:r,attachmentSize:n};return this.signDocument(t,i,s)}static authorFromCredentials(t){return t.address}},Jr.id="es.5",Jr),sc=/^.*\.(\w+)$/,ic=/^.*~@\w{4}\.\w{53}$/;function gi(t){if(t.indexOf(".")===-1)return!1;let e=t.match(sc);return!(e===null||e[1].length===53&&t.match(ic))}var wt=rc,Mr=[wt];function wi(t){return t||wt}function _n(t){return t||Mr}function uc(t,e){let n=[];for(let r of e)t.includes(r.id)&&n.push(r);return n}function Fn(t){let e=t||Mr,n={};for(let r of e)n[r.id]=r;return n}var Or=class{constructor(){this.deferreds=new Set,this.state="pending"}resolve(t){if(this.state==="pending"){this.state="fulfilled";for(let e of this.deferreds)e.resolve(t)}}reject(t){if(this.state==="pending"){this.state="rejected";for(let e of this.deferreds)e.reject(t)}}getPromise(){let t=q();return this.state==="fulfilled"?t.resolve():this.state==="rejected"?t.reject():this.deferreds.add(t),t}},er=class{constructor(t=!1){this.promises=new Set,this.sealed=!1,this.multiDeferred=new Or,this.allowRejectedPromises=t}enrol(t){if(this.sealed)throw new Ke("Tried to enrol a promise when enrolment was already sealed.");this.promises.add(t),t.then(()=>{this.checkAllDone()}).catch(e=>{if(!this.allowRejectedPromises)throw e})}checkAllDone(){!this.sealed||(this.allowRejectedPromises?Promise.allSettled(this.promises).then(()=>{this.multiDeferred.resolve()}):Promise.all(this.promises).then(()=>{this.multiDeferred.resolve()}).catch(()=>{this.multiDeferred.reject()}))}seal(){this.sealed||(this.sealed=!0,this.checkAllDone())}isSealed(){return this.sealed}isDone(){return this.multiDeferred.getPromise()}},ac=class{constructor(){this.closed=!1,this.transform=new TransformStream({transform(t,e){e.enqueue(t)}}),this.writer=this.transform.writable.getWriter(),this.readable=this.transform.readable,this.writables=[]}checkClosed(){if(this.closed)throw"Closed"}getWritableStream(){this.checkClosed();let t=this.writer,e=new WritableStream({async write(n){await t.ready,await t.write(n)}});return this.writables.push(e),e}async close(){this.checkClosed();for(let t of this.writables)await t.abort();this.transform.writable.abort(),this.closed=!0}isClosed(){return this.closed}},oc=class{constructor(){this.transformStream=new TransformStream(new hc),this.sourceReadable=this.transformStream.readable,this.writable=this.transformStream.writable}getReadableStream(){let[t,e]=this.sourceReadable.tee();return this.sourceReadable=t,e}},lc=class{constructor(){this.closed=!1,this.subscribers=[],this.writables=[];let t=this.subscribers;this.writable=new WritableStream({write(e){let n=t.map(({writer:r})=>new Promise(s=>{r.ready.then(()=>{r.write(e).then(s)})}));Promise.all(n)}})}checkClosed(){if(this.closed)throw"Closed"}getReadableStream(){this.checkClosed();let t=new TransformStream({transform(e,n){n.enqueue(e)}});return this.subscribers.push({transform:t,writer:t.writable.getWriter()}),t.readable}async close(){this.checkClosed();for(let t of this.writables)await t.abort();for(let{transform:t}of this.subscribers)await t.writable.abort(),await t.readable.cancel();this.closed=!0}isClosed(){return this.closed}},cc=class{constructor(t){this.closed=!1,this.combineStream=new ac,t?this.cloneStream=new lc:this.cloneStream=new oc,this.combineStream.readable.pipeTo(this.cloneStream.writable)}checkClosed(){if(this.closed)throw"Closed"}getWritableStream(){return this.combineStream.getWritableStream()}getReadableStream(){return this.cloneStream.getReadableStream()}close(){this.checkClosed(),this.combineStream.close(),this.closed=!0}isClosed(){return this.closed}},sa=class{constructor(){this.callbacks=new Set}onWrite(t){return this.callbacks.add(t),()=>{this.callbacks.delete(t)}}async write(t){for(let e of this.callbacks)await e(t)}close(){this.callbacks.clear()}},ln=class{constructor(){this.callbacks=new Set,this.lock=new ia}on(t){return this.callbacks.add(t),()=>{this.callbacks.delete(t)}}async send(t){for(let e of this.callbacks)await this.lock.run(()=>e(t))}},hc=class{transform(t,e){e.enqueue(t)}},ia=class{constructor(){this.doneEnroller=new er,this.writable=new WritableStream({async write(t){await t()}}),this.writer=this.writable.getWriter(),this.closed=!1}checkClosed(){if(this.closed)throw"Closed"}async run(t){this.checkClosed(),await this.writer.ready;let e=this.writer.write(t);return this.doneEnroller.enrol(e),e}async close(){this.checkClosed(),this.doneEnroller.seal(),await this.doneEnroller.isDone(),this.writer.releaseLock(),await this.writable.abort(),this.closed=!0}isClosed(){return this.closed}},fc=class{constructor(t,e){this.channel=t,this.channelKey=e}transform(t,e){if(this.channel==="*"||this.channel===t[this.channelKey]){e.enqueue(t);return}}},dc=class{constructor(t,e){this.multistream=new cc(e),this.channelKey=t}getWritableStream(){return this.multistream.getWritableStream()}getReadableStream(t){let e=new TransformStream(new fc(t,this.channelKey));return this.multistream.getReadableStream().pipeThrough(e)}};function pc(t,e){let n=q(),r=q(),s=()=>{if(r.state==="pending"){let i;t instanceof WebSocket?i=t:i=new WebSocket(t),r.resolve(i),i.binaryType="arraybuffer",i.readyState===i.OPEN&&n.resolve(),i.onopen=()=>{n.resolve()}}};return new WritableStream({async write(i,u){s();let o=await r;await n;try{let a=e(i);o.send(a)}catch(a){u.error(a)}o.onclose=()=>{u.error("Socket closed before we were done")}},async close(){s();let i=await r;await n,i.close()},async abort(){s();let i=await r;await n,i.close()}})}function Dc(t,e){let n=q(),r=!1,s=()=>{if(n.state==="pending")if(t instanceof WebSocket)n.resolve(t);else try{let i=new WebSocket(t);n.resolve(i)}catch(i){n.reject(i)}};return new ReadableStream({async start(i){s();let u=await n;u.binaryType="arraybuffer",u.onmessage=o=>{let a=e(o);try{i.enqueue(a)}catch{}},u.onclose=()=>{if(!r)try{i.close()}catch{}},u.onerror=o=>{r=!0,i.error(o)}},async cancel(){s(),(await n).close()}})}function mc(t){let e=t.toString(16);return e.length%2&&(e="0"+e),e}function gc(t){return BigInt("0x"+t)}var wc={encode:{emptySet:t=>({type:"EMPTY_SET",canRespond:t}),lowerBound:t=>({type:"LOWER_BOUND",value:t}),payload:(t,e)=>({type:"PAYLOAD",payload:t,...e?{end:e}:{}}),emptyPayload:t=>({type:"EMPTY_PAYLOAD",upperBound:t}),done:t=>({type:"DONE",upperBound:t}),fingerprint:(t,e)=>({type:"FINGERPRINT",fingerprint:mc(t),upperBound:e}),terminal:()=>({type:"TERMINAL"})},decode:{emptySet:t=>{if(t.type==="EMPTY_SET")return t.canRespond;throw"Can't decode"},lowerBound:t=>{if(t.type==="LOWER_BOUND")return t.value;throw"Can't decode"},payload:t=>{if(t.type==="PAYLOAD")return{value:t.payload,...t.end?{end:t.end}:{}};throw"Can't decode"},emptyPayload:t=>{if(t.type==="EMPTY_PAYLOAD")return t.upperBound;throw"Can't decode"},done:t=>{if(t.type==="DONE")return t.upperBound;throw"Can't decode"},fingerprint:t=>{if(t.type==="FINGERPRINT")return{fingerprint:gc(t.fingerprint),upperBound:t.upperBound};throw"Can't decode"},terminal:t=>{if(t.type==="TERMINAL")return!0;throw"Can't decode"}}},bc=class extends $l{constructor(t,e,n){super({tree:t,encoding:wc,fingerprintEquals:(r,s)=>r===s,payloadThreshold:e,rangeDivision:n})}},Ac=class{constructor(t){this.statusBus=new ln,this.isDoneMultiDeferred=new Or,this.inboundEventQueue=new Rt,this.outboundEventQueue=new Rt,this.gossiperInboundQueue=new Rt,this.reconcilerInboundQueue=new Rt,this.hasPrepared=q(),this.hasReconciled=q(),this.hasCheckedAllExistingDocsForAttachments=q(),this.requestedCount=0,this.sentDocsCount=0,this.receivedDocsCount=0,this.counterpartId=Mt(),this.replica=t.replica,t.replica.onEvent(s=>{s.kind==="willClose"&&this.cancel()});let{treeIsReady:e}=t.syncerManager.getDocThumbnailTreeAndDocLookup(t.replica.share,_n(t.formats));e.then(()=>{this.hasPrepared.resolve()}),(async()=>{for await(let s of this.inboundEventQueue)switch(s.kind){case"RANGE_MSG":{this.reconcilerInboundQueue.push(s.message);break}default:this.gossiperInboundQueue.push(s)}})(),new Ec({outboundEventQueue:this.outboundEventQueue,formats:t.formats,replica:t.replica,counterpartId:this.counterpartId,transferManager:t.transferManager,hasCheckedAllExistingDocsForAttachments:this.hasCheckedAllExistingDocsForAttachments});let n=new _c,r=new Cc({inboundEventQueue:this.reconcilerInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:t.syncerManager,formats:t.formats,replica:t.replica,initiateMessaging:t.initiateMessaging,wantTracker:n,payloadThreshold:t.payloadThreshold,rangeDivision:t.rangeDivision,onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}});r.isDone.then(()=>{this.hasReconciled.resolve()}),new yc({inboundEventQueue:this.gossiperInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:t.syncerManager,formats:t.formats,replica:t.replica,counterpartId:this.counterpartId,transferManager:t.transferManager,cancel:this.cancel.bind(this),reconciliationIsDone:r.isDone,wantTracker:n,syncAppetite:t.syncAppetite,onDocReceived:async()=>{this.receivedDocsCount++,await this.statusBus.send(this.getStatus())},onDocSent:async()=>{this.sentDocsCount++,await this.statusBus.send(this.getStatus())},onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}}).isDone.then(async()=>{await this.hasCheckedAllExistingDocsForAttachments,this.isDoneMultiDeferred.resolve()}),this.statusBus.send(this.getStatus())}sendEvent(t){return this.inboundEventQueue.push(t)}events(){return this.outboundEventQueue}getStatus(){return{requestedCount:this.requestedCount,receivedCount:this.receivedDocsCount,sentCount:this.sentDocsCount,status:this.isDoneMultiDeferred.state==="rejected"?"aborted":this.hasPrepared.state==="pending"?"preparing":this.hasReconciled.state==="pending"?"reconciling":this.isDoneMultiDeferred.state==="fulfilled"?"done":"gossiping"}}onStatusUpdate(t){return this.statusBus.on(t)}async cancel(t){this.isDoneMultiDeferred.state==="fulfilled"||this.isDoneMultiDeferred.state==="rejected"||(this.isDoneMultiDeferred.reject(),await this.statusBus.send(this.getStatus()),this.outboundEventQueue.push({kind:"ABORT"}),this.outboundEventQueue.close(),this.inboundEventQueue.close({immediately:!0}),this.gossiperInboundQueue.close({immediately:!0}),this.reconcilerInboundQueue.close({immediately:!0}))}isDone(){return this.isDoneMultiDeferred.getPromise()}},yc=class{constructor(t){this.isPartnerFulfilled=q(),this.isFulfilled=q();let e=Fn(t.formats),n=t.syncerManager.getPlumTree(t.replica.share);if(t.syncAppetite==="continuous"){let i=t.replica.getQueryStream(void 0,"new",t.formats),u=new Is;i.pipeTo(new WritableStream({async write(o){if(o.kind==="success"&&o.sourceId!==t.counterpartId){let a=n.getMode(o.sourceId);u.reset(),u.update(`${o.doc.path} ${o.doc.author}`);let l=u.digest().toString(16),c=`${o.doc.timestamp} ${l}`;if(a==="EAGER"){let h=e[o.doc.format],f=h.getAttachmentInfo(o.doc),d=!I(f),p=!1;d&&await t.replica.getAttachment(o.doc,h)&&(p=!0),t.outboundEventQueue.push({kind:"DOC",thumbnail:c,doc:o.doc,attachmentHeld:p}),t.onDocSent()}else t.outboundEventQueue.push({kind:"HAVE",thumbnail:c})}}})).catch(()=>{})}let r=t.replica.onEvent(i=>{i.kind==="attachment_ingest"&&i.sourceId!==t.counterpartId&&t.outboundEventQueue.push({kind:"NEW_ATTACHMENT",path:i.doc.path,author:i.doc.author,format:i.doc.format,hash:i.hash})}),{lookup:s}=t.syncerManager.getDocThumbnailTreeAndDocLookup(t.replica.share,_n(t.formats));(async()=>{for await(let i of t.inboundEventQueue)switch(i.kind){case"PRUNE":{n.onPrune(t.counterpartId);break}case"HAVE":{if(t.reconciliationIsDone.state==="fulfilled"&&t.syncAppetite==="once")break;t.wantTracker.addWantedThumbnail(i.thumbnail),n.onLazyMessage(i,u=>{t.outboundEventQueue.push({kind:"WANT",thumbnail:u})}),t.onDocRequested();break}case"WANT":{n.onGraftMessage(t.counterpartId);let[,u]=i.thumbnail.split(" "),o=s[u];if(!o)return;let[,a,l]=o,c=(await t.replica.getAllDocsAtPath(a,t.formats)).find(h=>h.author===l);if(c){let h=e[c.format],f=h.getAttachmentInfo(c),d=!I(f),p=!1;d&&await t.replica.getAttachment(c,h)&&(p=!0),t.outboundEventQueue.push({kind:"DOC",thumbnail:i.thumbnail,doc:c,attachmentHeld:p}),await t.onDocSent()}else console.error("Got a WANT event for a document not on record.");break}case"DOC":{if(this.isFulfilled.state==="fulfilled"&&t.syncAppetite==="once"||(n.onEagerMessage(t.counterpartId,i)&&t.outboundEventQueue.push({kind:"PRUNE"}),t.wantTracker.isReceived(i.thumbnail)))break;let u=e[i.doc.format];if(!u){console.error(`Was sent a doc with a format we don't know about (${i.doc.format})`);break}if(i.attachmentHeld&&await t.replica.getAttachment(i.doc,e[i.doc.format])===void 0){let o=await t.transferManager.handleDownload(i.doc,t.replica,t.counterpartId);if(I(o)){let a=u.getAttachmentInfo(i.doc);t.transferManager.registerExpectedTransfer(t.replica.share,a.hash),t.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:a.hash,doc:i.doc,shareAddress:t.replica.share})}}await t.replica.ingest(u,i.doc,t.counterpartId),t.wantTracker.receivedWantedThumbnail(i.thumbnail),await t.onDocReceived();break}case"NEW_ATTACHMENT":{if(t.transferManager.isAlreadyQueued(i.hash,"download"))break;let u=e[i.format],o=(await t.replica.getAllDocsAtPath(i.path,[u])).find(a=>i.author===a.author);if(!o)break;if(await t.replica.getAttachment(o,e[o.format])===void 0){let a=await t.transferManager.handleDownload(o,t.replica,t.counterpartId);if(I(a)){let l=u.getAttachmentInfo(o);t.transferManager.registerExpectedTransfer(t.replica.share,l.hash),t.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:l.hash,doc:o,shareAddress:t.replica.share})}}break}case"FULFILLED":this.isPartnerFulfilled.resolve(!0);break;case"WANT_ATTACHMENT":t.transferManager.handleUpload(i,t.replica);break;case"ABORT":await t.cancel()}})(),t.reconciliationIsDone.then(async()=>{t.syncAppetite==="once"&&(r(),t.wantTracker.seal(),await t.wantTracker.isDone(),t.outboundEventQueue.push({kind:"FULFILLED"}),this.isFulfilled.resolve())})}get isDone(){return Promise.all([this.isPartnerFulfilled,this.isFulfilled])}},Cc=class{constructor(t){this.communicationRoundsCount=0,this.isDone=q();let{tree:e,lookup:n,treeIsReady:r}=t.syncerManager.getDocThumbnailTreeAndDocLookup(t.replica.share,_n(t.formats));t.initiateMessaging&&r.then(()=>{for(let i of s.initialMessages(u=>{let o=Date.now()-6048e5,a=u.findIndex(c=>{let[h]=c.split(" ");return parseInt(h)/1e3>o});if(a>0&&a>u.length/2)return[u.slice(0,a),u.slice(a)];let l=Math.round(u.length/2);return[u.slice(0,l),u.slice(l)]}))t.outboundEventQueue.push({kind:"RANGE_MSG",message:i})});let s=new bc(e,t.payloadThreshold,t.rangeDivision);s.onInsertion(i=>{let[u,o]=i.split(" "),a=n[o];a&&a[0]>=parseInt(u)||(t.wantTracker.addWantedThumbnail(i),t.outboundEventQueue.push({kind:"WANT",thumbnail:i}),t.onDocRequested())}),(async()=>{await r;for await(let i of t.inboundEventQueue){if(this.isDone.state==="fulfilled")return;i.type==="TERMINAL"&&this.communicationRoundsCount++;let u=s.respond(i);for(let o of u)t.outboundEventQueue.push({kind:"RANGE_MSG",message:o})}})(),s.isDone().then(()=>{this.isDone.resolve(this.communicationRoundsCount)})}},Ec=class{constructor(t){let e=t.replica.getQueryStream({orderBy:"localIndex ASC"},"existing",t.formats),n=Fn(t.formats),r=t.transferManager.handleDownload.bind(t.transferManager);e.pipeTo(new WritableStream({start(s){t.replica.onEvent(i=>{i.kind==="willClose"&&s.error()})},async write(s){if(s.kind==="existing"||s.kind==="success"){let i=n[s.doc.format],u=await t.replica.getAttachment(s.doc,i);if(I(u))return;if(u===void 0){let o=await r(s.doc,t.replica,t.counterpartId);if(I(o)){let a=i.getAttachmentInfo(s.doc);t.transferManager.registerExpectedTransfer(t.replica.share,a.hash),t.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:a.hash,doc:s.doc,shareAddress:t.replica.share})}}}}})).then(()=>{t.hasCheckedAllExistingDocsForAttachments.resolve()}).catch(()=>{t.hasCheckedAllExistingDocsForAttachments.resolve()})}},_c=class{constructor(){this.isSealed=!1,this.wantedThumbnails=new Map,this.enroller=new er,this.received=0,this.id=Mt()}addWantedThumbnail(t){if(!this.isSealed&&!this.wantedThumbnails.has(t)){let e=q();this.wantedThumbnails.set(t,e),this.enroller.enrol(e)}}receivedWantedThumbnail(t){let e=this.wantedThumbnails.get(t);e&&(e.resolve(),this.received++)}isRequested(t){return this.wantedThumbnails.has(t)}isReceived(t){let e=this.wantedThumbnails.get(t);return e?e.state==="fulfilled":!1}seal(){this.enroller.seal()}isDone(){return this.enroller.isDone()}get requestedCount(){return this.wantedThumbnails.size}get receivedCount(){return this.received}},ua=class{constructor(t,e){this.closed=!1,this.cb=t,this.ms=e,this.timeout=setTimeout(t,e)}bump(){this.closed||(clearTimeout(this.timeout),this.timeout=setTimeout(this.cb,this.ms))}close(){this.closed=!0,clearTimeout(this.timeout)}},es=class{constructor({stream:t,replica:e,doc:n,format:r,requester:s,counterpartId:i}){this.status="ready",this.loaded=0,this.statusBus=new ln,this.transferOp=q(),this.multiDeferred=new Or,this.sourceDoc=n,this.share=e.share,this.requester=s;let u=r.getAttachmentInfo(n);if(I(u))throw new T("AttachmentTransfer was given a doc which has no attachment!");this.hash=u.hash,this.expectedSize=u.size;let o=this.updateLoaded.bind(this);if(t instanceof ReadableStream){this.kind="download";let a;this.abortCb=()=>{a?a.cancel():t.cancel()};let l=null,c=new ReadableStream({async start(h){let f=t.getReader();for(a=f,l=new ua(()=>{h.error("Attachment download timed out.")},1e4);;){let{done:d,value:p}=await f.read();if(l.bump(),d)break;o(p.byteLength),h.enqueue(p)}l.close(),h.close()}});this.transferOp.resolve(()=>{let h=q();return e.ingestAttachment(r,n,c,i).then(f=>{if(I(f)&&this.loaded===0){this.changeStatus("missing_attachment");return}if(I(f)){console.warn(`Couldn't ingest the attachment for ${n.path} by ${n.author}: ${f.message}`),h.reject(f);return}h.resolve()}).catch(f=>{h.reject(f)}),h})}else this.kind="upload",this.abortCb=()=>{t.abort().catch(()=>{})},e.getAttachment(n,r).then(async a=>{if(!a){await this.changeStatus("missing_attachment"),await t.abort();return}if(I(a)){await this.changeStatus("failed"),await t.abort();return}let l=new TransformStream({transform(c,h){o(c.byteLength),h.enqueue(c)}});this.transferOp.resolve(()=>a.stream().then(c=>c.pipeThrough(l).pipeTo(t)))})}async start(){if(this.status!=="ready")return;let t=await this.transferOp;await this.changeStatus("in_progress"),t().then(async()=>{await this.changeStatus("complete")}).catch(async()=>{await this.changeStatus("failed")})}updateLoaded(t){this.loaded+=t,this.statusBus.send({status:this.status,bytesLoaded:this.loaded,totalBytes:this.expectedSize})}async changeStatus(t){this.status==="complete"||this.status==="failed"||this.status==="missing_attachment"||(this.status=t,await this.statusBus.send({status:t,bytesLoaded:this.loaded,totalBytes:this.expectedSize}),t==="complete"&&this.multiDeferred.resolve(),t==="failed"&&this.multiDeferred.reject("Attachment transfer failed"),t==="missing_attachment"&&this.multiDeferred.reject("The other peer does not have this attachment"))}get doc(){return this.sourceDoc}onProgress(t){return this.statusBus.on(t)}abort(){this.abortCb()}isDone(){return this.multiDeferred.getPromise()}},Fc=class{constructor(t){this.waiting=[],this.active=new Set,this.failed=new Set,this.completed=new Set,this.transfersRequestedByUsEnroller=new er(!0),this.reports={},this.reportBus=new ln,this.activeLimit=t}async activate(t){this.active.add(t),t.isDone().then(()=>{this.completed.add(t)}).catch(()=>{this.failed.add(t)}).finally(()=>{this.active.delete(t),this.admitNext()}),await t.start()}queue(t){this.waiting.push(t)}admitNext(){if(this.waiting.length===0||this.active.size>=this.activeLimit)return;let t=this.waiting.shift();t&&this.activate(t)}async addTransfer(t){t.onProgress(()=>{this.updateTransferStatus(t)}),t.requester==="us"&&this.transfersRequestedByUsEnroller.enrol(t.isDone()),this.active.size<this.activeLimit?await this.activate(t):this.queue(t)}gotAllTransfersRequestedByUs(){this.transfersRequestedByUsEnroller.seal()}cancel(){this.transfersRequestedByUsEnroller.seal();for(let t of this.active)t.abort()}updateTransferStatus(t){this.reports[t.share]||(this.reports[t.share]={}),this.reports[t.share][t.hash+t.kind]={author:t.doc.author,path:t.doc.path,format:t.doc.format,hash:t.hash,kind:t.kind,status:t.status,bytesLoaded:t.loaded,totalBytes:t.expectedSize},this.reportBus.send(this.getReport())}getReport(){let t={};for(let e in this.reports){let n=[],r=this.reports[e];for(let s in r){let i=r[s];n.push(i)}t[e]=n}return t}hasQueuedTransfer(t,e){for(let n of this.waiting)if(n.hash===t&&n.kind===e)return!0;for(let n of this.active)if(n.hash===t&&n.kind===e)return!0;for(let n of this.completed)if(n.hash===t&&n.kind===e)return!0;return!1}onReportUpdate(t){return this.reportBus.on(t)}transfersRequestedByUsFinished(){return this.transfersRequestedByUsEnroller.isDone()}},kc=class{constructor(t){this.otherSyncerId=q(),this.receivedAllExpectedTransfersEnroller=new er,this.madeAllAttachmentRequestsEnroller=new er(!0),this.reportDidUpdateBus=new ln,this.expectedTransferPromises=new Map,this.partner=t.partner,this.queue=new Fc(this.partner.concurrentTransfers),this.formats=t.formats,this.formatsLookup=Fn(this.formats),this.queue.onReportUpdate(async e=>{await this.reportDidUpdateBus.send(e)}),this.madeAllAttachmentRequestsEnroller.isDone().then(()=>{this.receivedAllExpectedTransfersEnroller.seal()}),this.receivedAllExpectedTransfersEnroller.isDone().then(()=>{this.queue.gotAllTransfersRequestedByUs()})}registerSyncAgent(t){this.madeAllAttachmentRequestsEnroller.enrol(t.isDone())}allSyncAgentsKnown(){this.madeAllAttachmentRequestsEnroller.seal()}registerExpectedTransfer(t,e){let n=`${t}_${e}`;if(this.expectedTransferPromises.has(n))return;let r=q();this.expectedTransferPromises.set(n,r),this.receivedAllExpectedTransfersEnroller.enrol(r)}async queueTransfer(t){this.queue.hasQueuedTransfer(t.hash,t.kind)||await this.queue.addTransfer(t)}async handleDownload(t,e,n){let r=this.formatsLookup[t.format],s=r.getAttachmentInfo(t);if(I(s))throw new Ke("TransferManager: attempted to download doc with no attachment.");let i=await this.partner.getDownload({doc:t,shareAddress:e.share,syncerId:await this.otherSyncerId,attachmentHash:s.hash});if(i===void 0)return"no_attachment";if(I(i))return i;let u=new es({replica:e,doc:t,format:r,stream:i,requester:"us",counterpartId:n});return await this.queueTransfer(u),"queued"}async handleUpload(t,e){let n=this.formatsLookup[t.doc.format];if(!await e.getAttachment(t.doc,n))return!1;let r=await this.partner.handleUploadRequest({shareAddress:t.shareAddress,syncerId:await this.otherSyncerId,doc:t.doc,attachmentHash:t.attachmentHash});if(I(r))return!1;try{let s=new es({doc:t.doc,format:n,replica:e,stream:r,requester:"them",counterpartId:"unused"});await this.queueTransfer(s)}catch{return!1}return!0}async handleTransferRequest({replica:t,path:e,author:n,source:r,kind:s,formatName:i,counterpartId:u}){let o=await this.partner.handleTransferRequest(r,s);if(o===void 0||I(o))return;let a=Fn(this.formats)[i];if(!a)return;let l=(await t.getAllDocsAtPath(e,[a])).find(h=>h.author===n);if(!l)return;let c=new es({doc:l,format:a,replica:t,stream:o,requester:s==="upload"?"us":"them",counterpartId:u});if(c.requester==="us"){let h=`${c.share}_${c.hash}`,f=this.expectedTransferPromises.get(h);f&&f.resolve()}await this.queueTransfer(c)}cancel(){this.queue.cancel()}getReport(){return this.queue.getReport()}onReportUpdate(t){return this.reportDidUpdateBus.on(t)}transfersRequestedByUsFinished(){return this.queue.transfersRequestedByUsFinished()}registerOtherSyncerId(t){this.otherSyncerId.resolve(t)}isAlreadyQueued(t,e){return this.queue.hasQueuedTransfer(t,e)}},aa=class{constructor(t){this.id=Mt(),this.syncAgents=new Map,this.syncAgentQueues=new Map,this.statusBus=new ln,this.partnerIsFulfilled=q(),this.isDoneMultiDeferred=new Or,this.manager=t.manager,this.peer=t.manager.peer,this.appetite=t.partner.syncAppetite,this.formats=_n(t.formats),this.partner=t.partner,this.transferManager=new kc({partner:this.partner,formats:this.formats}),this.transferManager.onReportUpdate(async()=>{await this.statusBus.send(this.getStatus())}),this.heartbeatInterval=setInterval(()=>{this.partner.sendEvent({kind:"HEARTBEAT"})},1e3),(async()=>{try{for await(let n of t.partner.getEvents())this.handleIncomingEvent(n)}catch(n){this.cancel(n||"Partner disconnected")}})();let e=Mt();Promise.all(this.peer.shares().map(n=>pr(e,n))).then(n=>{this.partner.sendEvent({kind:"DISCLOSE",salt:e,syncerId:this.id,shares:n,formats:this.formats?this.formats.map(r=>r.id):[wt.id],canRespond:!1})}),this.transferManager.transfersRequestedByUsFinished().then(async()=>{t.partner.syncAppetite!=="continuous"&&(await this.partner.sendEvent({kind:"SYNCER_FULFILLED"}),await this.partnerIsFulfilled,clearInterval(this.heartbeatInterval),await this.partner.closeConnection(),this.bumpingTimeout.close(),this.isDoneMultiDeferred.resolve())}),this.peer.onReplicasChange(async n=>{if(this.appetite==="once")return;let r=Array.from(n.keys());for(let[i,u]of this.syncAgents)r.includes(i)===!1&&(await u.cancel("Replica was removed from peer."),this.syncAgents.delete(i));let s=Mt();Promise.all(r.map(i=>pr(s,i))).then(i=>{this.partner.sendEvent({kind:"DISCLOSE",salt:s,syncerId:this.id,shares:i,formats:this.formats?this.formats.map(u=>u.id):[wt.id],canRespond:!0})})}),this.bumpingTimeout=new ua(()=>{this.cancel("No communication from the other peer in the last three seconds.")},1e4)}addShare(t,e,n){if(this.syncAgents.has(t))return;let r=this.peer.getReplica(t);if(!r){console.error("Couldn't get the replica for a share we had in common.");return}let s=new Ac({replica:r,formats:e,syncerManager:this.manager,transferManager:this.transferManager,initiateMessaging:n,payloadThreshold:this.partner.payloadThreshold,rangeDivision:this.partner.rangeDivision,syncAppetite:this.appetite});s.onStatusUpdate(()=>{this.statusBus.send(this.getStatus())}),this.syncAgents.set(t,s),this.transferManager.registerSyncAgent(s);let i=this.syncAgentQueues.get(t),u;if(i)u=i;else{let o=new Rt;u=o,this.syncAgentQueues.set(t,o)}(async()=>{for await(let o of u)s.sendEvent(o)})(),(async()=>{for await(let o of s.events())this.partner.sendEvent({to:t,...o})})()}async handleIncomingEvent(t){switch(this.bumpingTimeout.bump(),t.kind){case"DISCLOSE":{let e=uc(t.formats,this.formats);if(e.length===0)break;let n=new Set(t.shares),r=new Set,s=new Set;for(let u of this.peer.shares()){let o=await pr(t.salt,u);n.has(o)?r.add(u):s.add(u)}let i=this.id>t.syncerId;for(let u of r)this.addShare(u,e,i);for(let u of s){let o=this.syncAgents.get(u);o&&(o.cancel("No longer in common with the other peer."),this.syncAgents.delete(u))}if(this.transferManager.registerOtherSyncerId(t.syncerId),this.appetite==="once"&&this.transferManager.allSyncAgentsKnown(),t.canRespond){let u=Mt();Promise.all(this.peer.shares().map(o=>pr(u,o))).then(o=>{this.partner.sendEvent({kind:"DISCLOSE",salt:u,syncerId:this.id,shares:o,formats:this.formats?this.formats.map(a=>a.id):[wt.id],canRespond:!1})})}r.size===0&&this.appetite==="once"&&this.partner.sendEvent({kind:"SYNCER_FULFILLED"});break}case"SYNCER_FULFILLED":{this.partnerIsFulfilled.resolve();break}case"HEARTBEAT":break;default:{let{to:e}=t,n=this.syncAgentQueues.get(e);if(!n){let r=new Rt;r.push(t),this.syncAgentQueues.set(e,r);break}n.push(t)}}}getStatus(){let t={};for(let[e,n]of this.syncAgents)t[e]={docs:n.getStatus(),attachments:this.transferManager.getReport()[e]||[]};return t}onStatusChange(t){return this.statusBus.on(t)}async cancel(t){this.bumpingTimeout.close(),this.isDoneMultiDeferred.reject(t);for(let[e,n]of this.syncAgents)await n.cancel();clearInterval(this.heartbeatInterval),this.transferManager.cancel(),await this.partner.closeConnection()}handleTransferRequest({shareAddress:t,path:e,author:n,source:r,kind:s,formatName:i}){if(this.isDoneMultiDeferred.state==="rejected")return;let u=this.peer.getReplica(t);if(!u)return;let o="unused";if(s==="upload"){let a=this.syncAgents.get(t);a&&(o=a.counterpartId)}return this.transferManager.handleTransferRequest({replica:u,author:n,formatName:i,kind:s,path:e,source:r,counterpartId:o})}isDone(){return this.isDoneMultiDeferred.getPromise()}};function pr(t,e){return Se.sha256base32(t+e+t)}var vc=class{constructor(t,e,n,r){this.concurrentTransfers=1024,this.payloadThreshold=1,this.rangeDivision=2,this.outgoingQueue=new Rt,this.incomingQueue=new Rt,this.syncAppetite=n,this.partnerPeer=t;let{incomingQueue:s,outgoingQueue:i}=this;this.partnerSyncer=new aa({manager:t.syncerManager,formats:r,partner:{syncAppetite:n,getEvents(){return s},sendEvent(u){return i.push(u),Promise.resolve()},concurrentTransfers:1024,payloadThreshold:32,rangeDivision:32,async getDownload(u){let o=e.getReplica(u.shareAddress);if(!o)throw new T("Tried to get a receiving transfer for an unknown share.");let a=await o.replicaDriver.attachmentDriver.getAttachment(u.doc.format,u.attachmentHash);if(a&&!I(a))return await a.stream()},closeConnection(){return i.close(),Promise.resolve()},handleUploadRequest(u){return Promise.resolve(new Hn("PartnerLocal does not support uploads."))},handleTransferRequest(u,o){return Promise.resolve(new Hn("PartnerLocal does not support transfer requests."))}}})}getEvents(){return this.outgoingQueue}sendEvent(t){return this.incomingQueue.push(t),Promise.resolve()}closeConnection(){return this.incomingQueue.close(),Promise.resolve()}async getDownload(t){let e=this.partnerPeer.getReplica(t.shareAddress);if(!e)throw new T("Tried to get a receiving transfer for an unknown share.");let n=await e.replicaDriver.attachmentDriver.getAttachment(t.doc.format,t.attachmentHash);if(n&&!I(n))return await n.stream()}handleUploadRequest(t){return Promise.resolve(new Hn("PartnerLocal does not support uploads."))}handleTransferRequest(t,e){return Promise.resolve(new Hn("PartnerLocal does not support transfer requests."))}},Bc=class{constructor(t){this.concurrentTransfers=16,this.payloadThreshold=8,this.rangeDivision=8,this.incomingQueue=new Rt,this.socketIsReady=q(),this.syncAppetite=t.appetite;let e=new URL(t.url),n=`${e.host}${e.pathname==="/"?"":e.pathname}`;this.isSecure=e.protocol==="https:"||e.protocol==="wss:",this.wsUrl=`${this.isSecure?"wss://":"ws://"}${n}/'`;let r=new URL(t.appetite,this.wsUrl);this.socket=new WebSocket(r.toString()),this.socket.onopen=()=>{this.socketIsReady.resolve()},this.socket.binaryType="arraybuffer",this.socket.onmessage=s=>{this.incomingQueue.push(JSON.parse(s.data))},this.socket.onclose=()=>{this.incomingQueue.close()},this.socket.onerror=s=>{if("error"in s){this.incomingQueue.close({withError:s.error});return}this.incomingQueue.close({withError:new Ke("Websocket error.")})}}async sendEvent(t){if(await this.socketIsReady,!(this.socket.readyState===this.socket.CLOSED||this.socket.readyState===this.socket.CLOSING))return this.socket.send(JSON.stringify(t))}getEvents(){return this.incomingQueue}closeConnection(){return this.socket.close(),Promise.resolve()}getDownload(t){let e=new URL(`${t.syncerId}/download/${t.shareAddress}/${t.doc.format}/${t.doc.author}${t.doc.path}`,this.wsUrl),n=Dc(e.toString(),r=>r.data instanceof ArrayBuffer?new Uint8Array(r.data):null);return Promise.resolve(n)}handleUploadRequest(t){let e=new URL(`${t.syncerId}/upload/${t.shareAddress}/${t.doc.format}/${t.doc.author}${t.doc.path}`,this.wsUrl),n=pc(e.toString(),r=>r);return Promise.resolve(n)}handleTransferRequest(t,e){return Promise.resolve(new Hn("SyncDriverWebClient does not support external transfer requests."))}};function xc(t,e){let[n,r]=t.split(" "),[s,i]=e.split(" "),u=parseInt(n),o=parseInt(s);return u>o?1:u<o?-1:r>i?1:r<i?-1:0}var Sc={lift:t=>kl(t),combine:(t,e)=>t+e,neutral:BigInt(0)},$c=class extends Bl{constructor(){super(Sc,xc)}},Ic=class{constructor(){this.messagingModes=new Map,this.eagerMessageThumbnails=new Set,this.haveTimeouts=new Map}getMode(t){let e=this.messagingModes.get(t);if(e)return e;let n=this.messagingModes.size===0?"EAGER":"LAZY";return this.messagingModes.set(t,n),"EAGER"}onEagerMessage(t,e){let n=this.haveTimeouts.get(e.thumbnail);return n?(clearTimeout(n),!1):this.eagerMessageThumbnails.has(e.thumbnail)?(this.messagingModes.set(t,"LAZY"),!0):(this.eagerMessageThumbnails.add(e.thumbnail),!1)}onLazyMessage(t,e){if(!this.haveTimeouts.has(t.thumbnail)){let n=setTimeout(()=>{e(t.thumbnail)},5);this.haveTimeouts.set(t.thumbnail,n)}}onGraftMessage(t){this.messagingModes.set(t,"EAGER")}onPrune(t){this.messagingModes.set(t,"LAZY")}},Tc=class{constructor(t){this.syncers=new Map,this.syncerEventBus=new ln,this.docThumbnailTreeAndLookup=new Map,this.hasher=new Is,this.plumTrees=new Map,this.peer=t}addPartner(t,e,n){let r=new aa({manager:this,partner:t,formats:n});return this.syncers.set(r.id,{syncer:r,description:e}),this.syncerEventBus.send(this.syncers),r}getSyncers(){return this.syncers}getDocThumbnailTreeAndDocLookup(t,e){let n=e.map(h=>h.id),r=`${t} ${n}`,s=this.docThumbnailTreeAndLookup.get(r);if(s){let[h,f]=s;return{tree:h,lookup:f,treeIsReady:Promise.resolve(!0)}}let i=this.peer.getReplica(t);if(!i)throw new Ke("A DocThumbnailTree was requested for a share the peer doesn't know about, big problem!");let u=this.hasher,o=i.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"everything",e),a=new $c,l={},c=q();return o.pipeTo(new WritableStream({write(h){if(h.kind==="processed_all_existing"){c.resolve();return}u.reset(),u.update(`${h.doc.path} ${h.doc.author}`);let f=u.digest().toString(16),d=`${h.doc.timestamp} ${f}`;(h.kind==="existing"||h.kind==="success")&&(l[f]=[h.doc.timestamp,h.doc.path,h.doc.author],a.insert(d)),h.kind==="expire"&&(delete l[f],a.remove(d))}})),{tree:a,lookup:l,treeIsReady:c}}getPlumTree(t){let e=this.plumTrees.get(t);if(e)return e;let n=new Ic;return this.plumTrees.set(t,n),n}onSyncersChange(t){return this.syncerEventBus.on(t)}},Zt=new yt("peer","orangeRed"),On=JSON.stringify,oa=class{constructor(){this.replicaEventBus=new ln,this.replicaMap=new Map,Zt.debug("constructor"),this.syncerManager=new Tc(this)}hasShare(t){return this.replicaMap.has(t)}shares(){let t=[...this.replicaMap.keys()];return t.sort(),t}replicas(){let t=[...this.replicaMap.keys()];return t.sort(),t.map(e=>this.replicaMap.get(e))}size(){return this.replicaMap.size}getReplica(t){return this.replicaMap.get(t)}async addReplica(t){if(Zt.debug(`addReplica(${On(t.share)})`),this.replicaMap.has(t.share))throw Zt.debug("already had a replica with that share"),new Error(`Peer.addReplica: already has a replica with share ${On(t.share)}.  Don't add another one.`);this.replicaMap.set(t.share,t),await this.replicaEventBus.send(this.replicaMap),Zt.debug("    ...addReplica: done")}async removeReplicaByShare(t){Zt.debug(`removeReplicaByShare(${On(t)})`),this.replicaMap.delete(t),await this.replicaEventBus.send(this.replicaMap)}async removeReplica(t){let e=this.replicaMap.get(t.share);t===e?(Zt.debug(`removeReplica(${On(t.share)})`),await this.removeReplicaByShare(t.share)):Zt.debug(`removeReplica(${On(t.share)}) -- same share but it's a different instance now; ignoring`)}sync(t,e=!1,n){try{let r=new Bc({url:t,appetite:e?"continuous":"once"});return this.syncerManager.addPartner(r,t,n)}catch{if(t instanceof oa){let r=new vc(t,this,e?"continuous":"once",n);return this.syncerManager.addPartner(r,"Local",n)}console.error("Provided an invalid target for syncing to a peer:",t);return}}addSyncPartner(t,e,n){return this.syncerManager.addPartner(t,e,n)}getSyncers(){return this.syncerManager.getSyncers()}onReplicasChange(t){return this.replicaEventBus.on(t)}onSyncersChange(t){return this.syncerManager.onSyncersChange(t)}},Rc={historyMode:"latest",orderBy:"path ASC",startAfter:void 0,limit:void 0,filter:void 0,formats:["es.5"]},Xt=new yt("query","green");function la(t){var s,i,u,o;let e={...Rc,...t},n={query:{limit:0},isValid:!1,willMatch:"nothing"};if(e.limit!==void 0&&e.limit<0)return Xt.debug("cleanUpQuery: unreasonable limit - returning empty invalid query",n),n;if((s=e.orderBy)!=null&&s.startsWith("path")&&((i=e.startAfter)==null?void 0:i.localIndex)!==void 0)return Xt.debug('cleanUpQuery: orderBy is "path" but startAfter is not compatible - returning empty invalid query',n),n;if((u=e.orderBy)!=null&&u.startsWith("localIndex")&&((o=e.startAfter)==null?void 0:o.path)!==void 0)return Xt.debug('cleanUpQuery: orderBy is "localIndex" but startAfter is not compatible - returning empty invalid query',n),n;if(e.historyMode!==void 0&&e.historyMode!=="all"&&e.historyMode!=="latest")return Xt.debug(`cleanUpQuery: unknown historyMode ${JSON.stringify(e.historyMode)} - returning empty invalid query`,n),n;if(e.orderBy!==void 0&&["path ASC","path DESC","localIndex ASC","localIndex DESC"].indexOf(e.orderBy)===-1)return Xt.debug(`cleanUpQuery: unrecognized orderBy value ${JSON.stringify(e.orderBy)} - returning empty invalid query`,n),n;let r=e.historyMode==="all"?"all":"all-latest";if(e.filter!==void 0&&!yr(e.filter,{})&&(r="some"),e.startAfter!==void 0&&!yr(e.startAfter,{})&&(r="some"),e.limit!==void 0&&(e.limit>0&&(r="some"),e.limit===0&&(r="nothing")),e.filter!==void 0){let a=e.filter;a.path&&a.pathStartsWith&&!a.path.startsWith(a.pathStartsWith)&&(r="nothing"),a.path&&a.pathEndsWith&&!a.path.endsWith(a.pathEndsWith)&&(r="nothing"),a.timestamp&&a.timestampGt&&!(a.timestamp>a.timestampGt)&&(r="nothing"),a.timestamp&&a.timestampLt&&!(a.timestamp<a.timestampLt)&&(r="nothing"),a.timestampGt&&a.timestampLt&&!(a.timestampLt+1<a.timestampGt)&&(r="nothing")}if(r==="nothing"){let a={query:{limit:0},isValid:!0,willMatch:"nothing"};return Xt.debug("cleanUpQuery - this query will match nothing, so returning a simpler query that also matches nothing",a),a}return Xt.debug(`cleanUpQuery - query is ok!  willMatch = ${r}`),{query:e,isValid:!0,willMatch:r}}function Ps(t,e){return!(e.path!==void 0&&t.path!==e.path||e.pathStartsWith!==void 0&&!t.path.startsWith(e.pathStartsWith)||e.pathEndsWith!==void 0&&!t.path.endsWith(e.pathEndsWith)||e.author!==void 0&&t.author!==e.author||e.timestamp!==void 0&&t.timestamp!==e.timestamp||e.timestampGt!==void 0&&!(t.timestamp>e.timestampGt)||e.timestampLt!==void 0&&!(t.timestamp<e.timestampLt))}var Pc=(t=>(t[t.LT=-1]="LT",t[t.EQ=0]="EQ",t[t.GT=1]="GT",t))(Pc||{});function As(t,e,n="ASC"){if(Array.isArray(t)&&$u(t,e)||typeof t=="object"&&yr(t,e)||t===e)return 0;if(n==="ASC"||n===void 0)return t<e?-1:1;if(n==="DESC")return t>e?-1:1;throw new Error("unexpected sort order to compareBasic: "+JSON.stringify(n))}function Ms(t,e,n){let r=Math.min(t.length,e.length);for(let u=0;u<r;u++){let o=(n==null?void 0:n[u])??"ASC",a=As(t[u],e[u],o);if(a!==0)return a}if(t.length===e.length)return 0;let s=Math.min(t.length,e.length),i=(n==null?void 0:n[s])??"ASC";return As(t.length,e.length,i)}function bi(t,e="ASC"){return(n,r)=>As(n[t],r[t],e)}var Mc=JSON.stringify,qe=new yt("replica","gold"),We=new yt("replica set","gold"),Ue=new yt("replica ingest","gold");function Ai(t,e){return Ms([t.timestamp,t.signature],[e.timestamp,t.signature],["DESC","ASC"])}var Oc=class{constructor({driver:t,config:e}){var r;this._isClosed=!1,this.ingestLockStream=new ia,this.eventMultiStream=new dc("kind",!0),this.callbackSink=new sa,this.expireEventTimeouts=new Map;let n=or(t.docDriver.share);if(I(n))throw n;qe.debug(`constructor.  driver = ${(r=t==null?void 0:t.constructor)==null?void 0:r.name}`),this.replicaId="replica-"+Mt(),this.share=t.docDriver.share,this.replicaDriver=t,this.formatsConfig=e||{},this.eventWriter=this.eventMultiStream.getWritableStream().getWriter(),this.eventMultiStream.getReadableStream("*").pipeTo(new WritableStream(this.callbackSink)),this.eraseInterval=setInterval(()=>{this.isClosed()?clearInterval(this.eraseInterval):this.pruneExpiredDocsAndAttachments()},1e3*60*60)}isClosed(){return this._isClosed}async close(t){if(qe.debug("closing..."),this._isClosed)throw new we;await this.ingestLockStream.close();for(let e of this.expireEventTimeouts.values())clearTimeout(e);return qe.debug("    sending willClose blockingly..."),await this.eventWriter.write({kind:"willClose"}),qe.debug("    marking self as closed..."),t===!1&&await this.pruneExpiredDocsAndAttachments(),await this.replicaDriver.attachmentDriver.clearStaging(),this._isClosed=!0,qe.debug(`    closing ReplicaDriver (erase = ${t})...`),await this.replicaDriver.docDriver.close(t),await this.replicaDriver.attachmentDriver.close(t),clearInterval(this.eraseInterval),qe.debug("    sending didClose nonblockingly..."),await this.eventWriter.write({kind:"didClose"}),qe.debug("...closing done"),Promise.resolve()}async getConfig(t){if(this._isClosed)throw new we;return await this.replicaDriver.docDriver.getConfig(t)}async setConfig(t,e){if(this._isClosed)throw new we;return await this.replicaDriver.docDriver.setConfig(t,e)}async listConfigKeys(){if(this._isClosed)throw new we;return await this.replicaDriver.docDriver.listConfigKeys()}async deleteConfig(t){if(this._isClosed)throw new we;return await this.replicaDriver.docDriver.deleteConfig(t)}getMaxLocalIndex(){if(this._isClosed)throw new we;return this.replicaDriver.docDriver.getMaxLocalIndex()}getAllDocs(t){return qe.debug("getAllDocs()"),this.queryDocs({historyMode:"all",orderBy:"path ASC"},t)}getLatestDocs(t){return qe.debug("getLatestDocs()"),this.queryDocs({historyMode:"latest",orderBy:"path ASC"},t)}getAllDocsAtPath(t,e){return qe.debug(`getAllDocsAtPath("${t}")`),this.queryDocs({historyMode:"all",orderBy:"path ASC",filter:{path:t}},e)}async getLatestDocAtPath(t,e){qe.debug(`getLatestDocsAtPath("${t}")`);let n=await this.queryDocs({historyMode:"latest",orderBy:"path ASC",filter:{path:t}},e?[e]:void 0);if(n.length!==0)return n[0]}async queryDocs(t={},e){if(qe.debug("queryDocs",t),this._isClosed)throw new we;let n=_n(e);return await this.replicaDriver.docDriver.queryDocs({...t,formats:n.map(r=>r.id)})}async queryPaths(t={},e){let n=await this.queryDocs(t,e),r=new Set(n.map(({path:s})=>s));return Array.from(r).sort()}async queryAuthors(t={},e){let n=await this.queryDocs(t,e),r=new Set(n.map(({author:s})=>s));return Array.from(r).sort()}async set(t,e,n=wt){if(We.debug("set",e),this._isClosed)throw new we;We.debug("...deciding timestamp: getting latest doc at the same path (from any author)");let r=await this.getLatestDocAtPath(e.path),s;typeof e.timestamp=="number"?s=e.timestamp:r===void 0?s=oi():s=Math.max(oi(),r.timestamp+1),We.debug("...generating doc");let i;if(r){let a=n.removeExtraFields(r);I(a)||(i=a.doc)}let u=await n.generateDocument({keypair:t,input:{...e,format:n.id},share:this.share,timestamp:s,prevLatestDoc:i,config:this.formatsConfig[n.id]});if(I(u))return{kind:"failure",reason:"invalid_document",err:u};if(We.debug("...signature =",u.doc.signature),u.attachment){let a=await this.replicaDriver.attachmentDriver.stage(n.id,u.attachment);if(I(a))return{kind:"failure",reason:"invalid_document",err:a};let l=await n.updateAttachmentFields(t,u.doc,a.size,a.hash,this.formatsConfig[n.id]);if(I(l))return await a.reject(),{kind:"failure",reason:"invalid_document",err:l};We.debug("...ingesting attachment"),We.debug("-----------------------"),await a.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:l,hash:a.hash,size:a.size,sourceId:"local"}),We.debug("...done ingesting attachment"),We.debug("...ingesting"),We.debug("-----------------------");let c=await this.ingest(n,l,"local");return We.debug("...done ingesting"),We.debug("...set is done."),c}We.debug("...ingesting"),We.debug("-----------------------");let o=await this.ingest(n,u.doc,"local");return We.debug("...done ingesting"),We.debug("...set is done."),o}async ingest(t,e,n){if(Ue.debug("ingest",e),this._isClosed)throw new we;Ue.debug("...removing extra fields");let r=t.removeExtraFields(e);if(I(r))return{kind:"failure",reason:"invalid_document",err:r};e=r.doc;let s=r.extras;Object.keys(s).length>0&&Ue.debug(`...extra fields found: ${Mc(s)}`);let i=await t.checkDocumentIsValid(e);if(I(i))return{kind:"failure",reason:"invalid_document",err:i};let u=q();return await this.ingestLockStream.run(async()=>{Ue.debug(" >> ingest: start of protected region"),Ue.debug("  > getting other history docs at the same path by any author");let o=await this.getAllDocsAtPath(e.path,[t]);Ue.debug(`  > ...got ${o.length}`),Ue.debug("  > getting prevLatest and prevSameAuthor");let a=o[0]??null,l=o.filter(p=>p.author===e.author)[0]??null;Ue.debug("  > checking if new doc is latest at this path"),o.push(e),o.sort(Ai);let c=o[0]===e;if(Ue.debug(`  > ...isLatest: ${c}`),!c&&l!==null){Ue.debug("  > new doc is not latest and there is another one from the same author...");let p=Ai(e,l);if(p===1){Ue.debug("  > new doc is GT prevSameAuthor, so it is obsolete"),u.resolve({kind:"nothing_happened",reason:"obsolete_from_same_author",doc:e});return}if(p===0){Ue.debug("  > new doc is EQ prevSameAuthor, so it is redundant (already_had_it)"),u.resolve({kind:"nothing_happened",reason:"already_had_it",doc:e});return}}Ue.debug("  > upserting into ReplicaDriver...");let h=await this.replicaDriver.docDriver.upsert(e);Ue.debug("  > ...done upserting into ReplicaDriver"),Ue.debug("  > ...getting ReplicaDriver maxLocalIndex...");let f=await this.replicaDriver.docDriver.getMaxLocalIndex();Ue.debug(" >> ingest: end of protected region, returning a WriteEvent from the lock");let d={kind:"success",maxLocalIndex:f,doc:h,docIsLatest:c,prevDocFromSameAuthor:l,prevLatestDoc:a,sourceId:n};if(u.resolve(d),await this.eventWriter.write(d),h.deleteAfter){let p=`${h.path}|${h.author}`,D=this.expireEventTimeouts.get(p);D&&clearTimeout(D);let g=h.deleteAfter/1e3-Date.now();this.expireEventTimeouts.set(p,setTimeout(()=>{this.eventWriter.write({kind:"expire",doc:h})},g))}}),u}async overwriteAllDocsByAuthor(t,e){let n=wi(e);if(qe.debug(`overwriteAllDocsByAuthor("${t.address}")`),this._isClosed)throw new we;let r=await this.queryDocs({filter:{author:t.address},historyMode:"all"},[n]);qe.debug(`    ...found ${r.length} docs to overwrite`);let s=0,i=0;for(let u of r){let o=await this.wipeDocument(t,u,wi(e));if(I(o))return o;s+=1}return qe.debug(`    ...done; ${s} overwritten to be empty; ${i} were already empty; out of total ${r.length} docs`),s}async wipeDocAtPath(t,e,n=wt){let r=await this.getLatestDocAtPath(e,n);return r?this.wipeDocument(t,r,n):new T("No document exists at that path")}async wipeDocument(t,e,n){let r={...e,timestamp:Math.max(e.timestamp+1,Date.now()*1e3),author:t.address},s=await n.wipeDocument(t,r,this.formatsConfig[n.id]);if(I(s))return{kind:"failure",err:s,reason:"invalid_document"};let i=await this.ingest(n,s,"local");if(i.kind==="success"){let u=n.getAttachmentInfo(e);if(!I(u)){let o=await this.replicaDriver.attachmentDriver.erase(n.id,u.hash);I(o)||await this.eventWriter.write({kind:"attachment_prune",format:n.id,hash:u.hash})}}return i}async pruneExpiredDocsAndAttachments(t=Mr){let e=await this.replicaDriver.docDriver.eraseExpiredDocs();for(let i of e)await this.eventWriter.write({kind:"expire",doc:i});let n=Fn(t),r={};await this.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"existing",t).pipeTo(new WritableStream({write(i){if(i.kind==="existing"){let u=n[i.doc.format],o=u.getAttachmentInfo(i.doc);if(!I(o)){let a=r[u.id];a?a.add(o.hash):r[u.id]=new Set([o.hash])}}}}));let s=await this.replicaDriver.attachmentDriver.filter(r);for(let i of s)await this.eventWriter.write({kind:"attachment_prune",format:i.format,hash:i.hash})}getEventStream(t="*"){return this.eventMultiStream.getReadableStream(t)}getQueryStream(t={},e,n){let r=this.queryDocs.bind(this),s=this.getEventStream.bind(this);return new ReadableStream({async start(i){if(e==="existing"||e==="everything"){let o=await r(t,n);for(let a of o)i.enqueue({kind:"existing",doc:a})}if(i.enqueue({kind:"processed_all_existing"}),e==="existing"){i.close();return}let u=s().getReader();for(;;){let{done:o,value:a}=await u.read();if(o)return;if(a.kind==="expire"||a.kind==="success"){if(t.filter&&Ps(a.doc,t.filter)){i.enqueue(a);continue}i.enqueue(a);continue}a.kind==="didClose"&&i.close()}}})}onEvent(t){return this.callbackSink.onWrite(t)}async ingestAttachment(t,e,n,r){if(this._isClosed)throw new we;let s=t.removeExtraFields(e);if(I(s))return Promise.resolve(s);e=s.doc;let i=await t.checkDocumentIsValid(e);if(I(i))return Promise.resolve(i);let u=await this.getAttachment(e,t);if(u&&!I(u))return!1;let o=t.getAttachmentInfo(e);if(I(o))return Promise.resolve(o);let a=await this.replicaDriver.attachmentDriver.stage(e.format,n);return I(a)?a:a.hash!==o.hash?(await a.reject(),new T("Attachment's hash did not match the document's")):a.size!==o.size?(await a.reject(),new T("Attachment's size did not match the document's")):(await a.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:e,hash:a.hash,size:a.size,sourceId:r}),!0)}getAttachment(t,e=wt){if(t.deleteAfter&&t.deleteAfter<Date.now()*1e3)return Promise.resolve(new T("This document has expired"));let n=e.getAttachmentInfo(t);return I(n)?Promise.resolve(n):this.replicaDriver.attachmentDriver.getAttachment(t.format,n.hash)}addAttachments(t,e){let n=_n(e),r={};for(let i of n)r[i.id]=i;let s=t.map(i=>new Promise(u=>{let o=r[i.format].getAttachmentInfo(i);if(!I(o))this.replicaDriver.attachmentDriver.getAttachment(i.format,o.hash).then(a=>{u({...i,attachment:a})});else return u({...i,attachment:o})}));return Promise.all(s)}},Nc=class extends Oc{constructor(t){super({driver:t.driver,config:{"es.5":{shareSecret:t.shareSecret}}})}},Yt=new yt("replica-cache","green");function yi({_localIndex:t}){return t}function Ci(t,e){let n=[];for(let r of e)if(!(t.orderBy==="path ASC"&&t.startAfter!==void 0&&t.startAfter.path!==void 0&&r.path<=t.startAfter.path)&&!(t.orderBy==="path DESC"&&t.startAfter!==void 0&&t.startAfter.path!==void 0&&r.path>=t.startAfter.path)&&!(t.orderBy==="localIndex ASC"&&t.startAfter!==void 0&&t.startAfter.localIndex!==void 0&&(r._localIndex||0)<=t.startAfter.localIndex)&&!(t.orderBy==="localIndex DESC"&&t.startAfter!==void 0&&t.startAfter.localIndex!==void 0&&(r._localIndex||0)>=t.startAfter.localIndex)&&(n.push(r),t.limit!==void 0&&n.length>=t.limit))break;return n}var Lc=class{constructor(t,e,n){this.version=0,this.docCache=new Map,this.onCacheUpdatedCallbacks=new Set,this.closed=!1,this.onFireCacheUpdatedsWrapper=u=>u(),this.attachmentCache=new Map,this.replica=t,this.timeToLive=e||1e3,n&&(this.onFireCacheUpdatedsWrapper=n);let r=this.onReplicaEvent.bind(this),s=this.close.bind(this),i=this.isClosed.bind(this);this.replica.getEventStream("*").pipeTo(new WritableStream({async write(u){u.kind==="attachment_ingest"||u.kind==="success"||u.kind==="expire"?await r(u):u.kind==="willClose"&&!i()&&await s()}})).catch(()=>{})}async close(){if(this.closed)throw new Gt;this.closed=!0,await Promise.all(Array.from(this.docCache.values()).map(t=>t.close())),this.docCache.clear(),this.onCacheUpdatedCallbacks.clear()}isClosed(){return this.closed}getAllDocs(t){return this.queryDocs({historyMode:"all",orderBy:"path DESC"},t)}getLatestDocs(t){return this.queryDocs({historyMode:"latest",orderBy:"path DESC"},t)}getAllDocsAtPath(t,e){return this.queryDocs({historyMode:"all",orderBy:"path DESC",filter:{path:t}},e)}getLatestDocAtPath(t,e){let n=this.queryDocs({historyMode:"latest",orderBy:"path DESC",filter:{path:t}},e?[e]:void 0);if(n.length!==0)return n[0]}queryDocs(t={},e){if(this.closed)throw new Gt;if(this.replica.isClosed())throw new we;let n={...t,formats:(e||Mr).map(f=>f.id)},r=la(n);if(r.willMatch==="nothing")return[];let s=Ro(r.query),i=this.docCache.get(s);if(i)return Date.now()>i.expires&&this.replica.queryDocs(t,e).then(f=>{let d=f.map(yi).sort(),p=i.docs.map(yi).sort();$u(d,p)||(this.docCache.set(s,{stream:i.stream,close:i.close,docs:f,expires:Date.now()+this.timeToLive}),Yt.debug("Updated cache because result expired."),this.fireOnCacheUpdateds())}),i.docs;let u=this.replica.getQueryStream(t,"new",e),o=new sa,a=o.onWrite(f=>{(f.kind==="existing"||f.kind==="success")&&(Yt.debug({doc:f.doc.path,queryString:s}),this._updateCache(s,f.doc))}),l=new WritableStream(o),c=new AbortController;u.pipeTo(l,{signal:c.signal});let h=()=>{a()};return this.docCache.set(s,{stream:u,docs:[],expires:Date.now()+this.timeToLive,close:h}),this.replica.queryDocs(n).then(f=>{this.docCache.set(s,{stream:u,close:h,docs:f,expires:Date.now()+this.timeToLive}),Yt.debug("Updated cache with a new entry."),this.fireOnCacheUpdateds()}),[]}queryPaths(t={},e){let n=this.queryDocs(t,e),r=new Set(n.map(({path:s})=>s));return Array.from(r).sort()}queryAuthors(t={},e){let n=this.queryDocs(t,e),r=new Set(n.map(({author:s})=>s));return Array.from(r).sort()}_updateCache(t,e){let n=this.docCache.get(t);if(!n)return;let r=JSON.parse(t),s=()=>{let h=[...n.docs,e];this.docCache.set(t,{...n,docs:Ci(r,h)}),this.fireOnCacheUpdateds()},i=({exact:h})=>{let f=n.docs.map(d=>h&&d.path===e.path&&d.author===e.author||!h&&d.path===e.path?e:d);this.docCache.set(t,{...n,docs:Ci(r,f)}),this.fireOnCacheUpdateds()},u=n.docs.filter(h=>h.path===e.path),o=n.docs.filter(h=>h.path===e.path&&h.author===e.author);if(u.length===0){(r.filter&&Ps(e,r.filter)||!r.filter)&&(Yt.debug("Updated cache after appending a doc to a entry with matching filter."),s());return}if((r.historyMode||"latest")==="all"){if(o.length===0){Yt.debug("Updated cache after appending a version of a doc to a historyMode: all query."),s();return}Yt.debug("Updated cache after replacing a version of a doc in a historyMode: all query."),i({exact:!0});return}let a=u[0],l=e.author!==(a==null?void 0:a.author)||!yr(e,a),c=e.timestamp>a.timestamp;if(l&&c){Yt.debug("Updated cache after replacing a doc with its latest version."),i({exact:!1});return}}fireOnCacheUpdateds(){this.version++,this.onFireCacheUpdatedsWrapper(()=>{this.onCacheUpdatedCallbacks.forEach(t=>{t()})})}onCacheUpdated(t){if(this.closed)throw new Gt;if(this.replica.isClosed())throw new we;return this.onCacheUpdatedCallbacks.add(t),()=>{this.onCacheUpdatedCallbacks.delete(t)}}set(t,e,n){if(this.closed)throw new Gt;return this.replica.set(t,e,n)}overwriteAllDocsByAuthor(t,e){if(this.closed)throw new Gt;if(this.replica.isClosed())throw new we;return this.replica.overwriteAllDocsByAuthor(t,e)}wipeDocAtPath(t,e,n=wt){if(this.closed)throw new Gt;return this.replica.wipeDocAtPath(t,e,n)}async onReplicaEvent(t){let e=`${t.doc.path}|${t.doc.author}`,n=this.attachmentCache.get(e);if(!n)return;let r=await this.replica.getAttachment(t.doc,n.format);this.attachmentCache.set(e,{expires:Date.now()+this.timeToLive,attachment:r,format:n.format}),this.fireOnCacheUpdateds()}getAttachment(t,e=wt){if(this.closed)throw new Gt;if(this.replica.isClosed())throw new we;let n=e.getAttachmentInfo(t);if(I(n))return n;let r=`${t.path}|${t.author}`,s=this.attachmentCache.get(r);if(s)return Date.now()>s.expires&&this.replica.getAttachment(t,e).then(i=>{this.attachmentCache.set(r,{expires:Date.now()+this.timeToLive,attachment:i,format:e}),this.fireOnCacheUpdateds()}),t.deleteAfter&&Date.now()*1e3>t.deleteAfter?new T("This document has expired"):s.attachment;this.attachmentCache.set(r,{attachment:void 0,expires:Date.now()+this.timeToLive,format:e}),this.replica.getAttachment(t,e).then(i=>{this.attachmentCache.set(r,{expires:Date.now()+this.timeToLive,attachment:i,format:e}),this.fireOnCacheUpdateds()})}addAttachments(t,e){let n=[],r=Fn(e);for(let s of t){let i=this.getAttachment(s,r[s.format]);n.push({...s,attachment:i})}return n}};async function Uc(t){let e=new Uint8Array;return await t.pipeTo(new WritableStream({write(n){let r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),e=r}})),e}var Jt=new yt("replica driver indexeddb","gold");function zc(t,e){return Ms([t.path,t.timestamp,t.signature],[e.path,e.timestamp,t.signature],["ASC","DESC","ASC"])}function Hc(t,e){return Ms([t.path,t.timestamp,t.signature],[e.path,e.timestamp,t.signature],["DESC","DESC","ASC"])}var et="docs",st="config",jc=class{constructor(t,e){this.db=q(),this.gotInitialMaxLocalIndex=q(),this.localMaxLocalIndex=-1,this.closed=!1;let n=or(t);if(I(n))throw n;if(this.share=t,Jt.debug("constructor"),!window.indexedDB)throw new Ke("IndexedDB is not supported by this runtime.");let r=window.indexedDB.open(`earthstar:share_docs:${this.share}${e?`/${e}`:""}`,1);r.onerror=()=>{throw Jt.error(`Could not open IndexedDB for ${this.share}'s attachments.`),Jt.error(r.error),new Ke(`Could not open IndexedDB for ${this.share}'s attachments.`)},r.onupgradeneeded=function(){let s=r.result,i=s.createObjectStore(et,{keyPath:["path","author"]});i.createIndex("comboIndex",["_localIndex","timestamp","path","author"],{unique:!0}),i.createIndex("pathTimestampIndex",["path","timestamp"],{unique:!1}),i.createIndex("pathAuthorIndex",["path","author"],{unique:!0}),i.createIndex("deleteAfterIndex","deleteAfter",{unique:!1}),i.createIndex("localIndexIndex","_localIndex",{unique:!0}),s.createObjectStore(st,{keyPath:"key"}).createIndex("keyIndex",["key"],{unique:!0})},r.onsuccess=()=>{this.db.resolve(r.result);let s=r.result.transaction([et],"readonly").objectStore(et).index("localIndexIndex").openCursor(null,"prev");s.onsuccess=()=>{s.result?this.gotInitialMaxLocalIndex.resolve(s.result.value._localIndex):this.gotInitialMaxLocalIndex.resolve(-1)}},this.gotInitialMaxLocalIndex.then(s=>{this.localMaxLocalIndex=s})}isClosed(){return this.closed}async close(t){if(this.closed)throw new we;this.closed=!0;let e=q();if(t){let n=(await this.db).transaction([et,st],"readwrite"),r=q(),s=q(),i=n.objectStore(et).clear().onsuccess=()=>{r.resolve()},u=n.objectStore(st).clear().onsuccess=()=>{s.resolve()};await Promise.all([i,u]),e.resolve()}else e.resolve();return(await this.db).close(),await na(20),e}async getMaxLocalIndex(){return await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex}async queryDocs(t){var a,l,c,h,f,d,p,D,g,$,S,m,v;let e=(await this.db).transaction([et],"readonly").objectStore(et),n=q(),{query:r,willMatch:s}=la(t);if(Jt.debug(`    cleanUpQuery.  willMatch = ${s}`),s==="nothing")return[];if((a=r.filter)!=null&&a.path&&r.historyMode==="latest"){let A=IDBKeyRange.bound([r.filter.path,r.filter.timestampGt||0],[r.filter.path,r.filter.timestampLt||Number.MAX_SAFE_INTEGER]),k=e.index("pathTimestampIndex").openCursor(A,"prev");k.onsuccess=()=>{var x;(x=k.result)!=null&&x.value?n.resolve([k.result.value]):n.resolve([])}}else if((l=r.filter)!=null&&l.path&&r.historyMode==="all"){let A=e.index("pathAuthorIndex"),k=IDBKeyRange.bound([r.filter.path," "],[r.filter.path,"~"]),x=A.getAll(k);x.onsuccess=()=>{x.result?n.resolve(Array.from(x.result)):n.resolve([])}}else{let A=((c=r.startAfter)==null?void 0:c.path)||((h=r.filter)==null?void 0:h.path)||((f=r.filter)==null?void 0:f.pathStartsWith)||" ",k=((d=r.filter)==null?void 0:d.author)||" ",x=((p=r.filter)==null?void 0:p.timestamp)||((D=r.filter)==null?void 0:D.timestampGt)||0,C=((g=r.startAfter)==null?void 0:g.localIndex)||0,N=(($=r.filter)==null?void 0:$.path)||"~",le=((S=r.filter)==null?void 0:S.author)||"~",U=((m=r.filter)==null?void 0:m.timestamp)||((v=r.filter)==null?void 0:v.timestampLt)||Number.MAX_SAFE_INTEGER,K=Number.MAX_SAFE_INTEGER,ie=IDBKeyRange.bound([C,x,A,k],[K,U,N,le]),ot=e.index("comboIndex").getAll(ie);ot.onsuccess=()=>{ot.result?n.resolve(ot.result):n.resolve([])}}let i=await n;if(r.historyMode==="latest"){let A=i.splice(0,i.length),k=new Map;for(let x of A){let C=k.get(x.path);(!C||C.timestamp<x.timestamp)&&k.set(x.path,x)}i.push(...k.values())}let u=[];Jt.debug("    filtering docs");let o=Date.now()*1e3;for(let A of i)A.deleteAfter&&A.deleteAfter<o||r.filter&&!Ps(A,r.filter)||u.push(A);if(Jt.debug(`    ordering docs: ${r.orderBy}`),r.orderBy==="path ASC")u.sort(zc);else if(r.orderBy==="path DESC")u.sort(Hc);else if(r.orderBy==="localIndex ASC")u.sort(bi("_localIndex","ASC"));else if(r.orderBy==="localIndex DESC")u.sort(bi("_localIndex","DESC"));else if(r.orderBy)throw new T("unrecognized query orderBy: "+JSON.stringify(r.orderBy));return r.limit!==void 0&&i.length>=r.limit?u.slice(0,r.limit):(Jt.debug(`    queryDocs is done: found ${u.length} docs.`),u)}async upsert(t){let e=await this.db,n=e.transaction([et],"readwrite").objectStore(et).index("pathAuthorIndex"),r=q(),s=n.openCursor([t.path,t.author]);if(await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex+=1,t._localIndex=this.localMaxLocalIndex,s.onsuccess=()=>{if(s.result){let o=s.result.update(t);o.onsuccess=()=>{r.resolve(!!o.result)}}else r.resolve(!1)},await r)return t;let i=e.transaction([et],"readwrite").objectStore(et).put(t),u=q();return i.onsuccess=()=>{u.resolve()},i.onerror=()=>{throw i.error},await u,t}async eraseExpiredDocs(){let t=[],e=(await this.db).transaction([et],"readwrite").objectStore(et).index("deleteAfterIndex"),n=Date.now()*1e3,r=IDBKeyRange.bound(0,n),s=e.openCursor(r),i=q();return s.onsuccess=()=>{var u;if((u=s.result)!=null&&u.value){let o=s.result.value;if(o.deleteAfter!==null&&o.deleteAfter!==void 0){t.push(o);let a=s.result.delete();a.onsuccess=()=>{var l;(l=s.result)==null||l.continue()}}}else i.resolve()},await i,t}async getConfig(t){let e=(await this.db).transaction([st],"readonly").objectStore(st),n=q(),r=e.get(t);return r.onsuccess=()=>{var s;n.resolve((s=r.result)==null?void 0:s.value)},n}async setConfig(t,e){let n=(await this.db).transaction([st],"readwrite").objectStore(st),r=q(),s=n.put({key:t,value:e});return s.onsuccess=()=>{r.resolve()},r}async listConfigKeys(){let t=(await this.db).transaction([st],"readonly").objectStore(st),e=q(),n=t.index("keyIndex").openKeyCursor(),r=[];return n.onsuccess=()=>{n.result?(r.push(n.result.primaryKey),n.result.continue()):e.resolve(r)},e}async deleteConfig(t){let e=(await this.db).transaction([st],"readwrite").objectStore(st),n=q(),r=e.index("keyIndex"),s=IDBKeyRange.bound([t],[t]),i=r.openCursor(s);return i.onsuccess=()=>{if(i.result){let u=i.result.delete();u.onsuccess=()=>{n.resolve(!0)}}else n.resolve(!1)},n}},Ei=new yt("replica driver indexeddb","gold"),it="attachment_staging_index",tt="attachments_index",Ze="attachments_bytes",qc=class{constructor(t,e){if(this.db=q(),this.closed=!1,this.share=t,!window.indexedDB)throw new Ke("IndexedDB is not supported by this runtime.");let n=window.indexedDB.open(`earthstar:share_attachments:${this.share}${e?`/${e}`:""}`,1);n.onerror=()=>{throw Ei.error(`Could not open IndexedDB for ${this.share}'s attachments.`),Ei.error(n.error),new Ke(`Could not open IndexedDB for ${this.share}'s attachments.`)},n.onupgradeneeded=function(){let r=n.result;r.createObjectStore(Ze),r.createObjectStore(tt,{keyPath:"id"}),r.createObjectStore(it,{keyPath:"id"})},n.onsuccess=()=>{this.db.resolve(n.result)}}getIndexKey(t,e){return`${t}___${e}`}async getAttachment(t,e){if(this.closed)throw new we;let n=q(),r=this.getIndexKey(t,e),s=await this.db,i=s.transaction([tt],"readonly").objectStore(tt).get(r),u=q();return i.onerror=()=>{u.reject()},i.onsuccess=()=>{i.result===void 0?u.reject():u.resolve(i.result.blobKey)},u.then(o=>{let a=s.transaction([Ze],"readonly").objectStore(Ze).get(o);a.onsuccess=()=>{let l=new Blob([a.result]);n.resolve({bytes:async()=>new Uint8Array(await l.arrayBuffer()),stream:()=>Promise.resolve(l.stream())})},a.onerror=()=>{n.resolve(void 0)}}).catch(()=>{n.resolve(void 0)}),n}async erase(t,e){if(this.closed)throw new we;let n=q(),r=this.getIndexKey(t,e),s=await this.db,i=s.transaction([tt],"readonly").objectStore(tt).get(r),u=q();return i.onerror=()=>{u.reject()},i.onsuccess=()=>{s.transaction([tt],"readwrite").objectStore(tt).delete(r),i.result===void 0?u.reject():u.resolve(i.result.blobKey)},u.then(o=>{let a=s.transaction([Ze],"readwrite").objectStore(Ze).delete(o);a.onsuccess=()=>{n.resolve(!0)},a.onerror=()=>{n.resolve(void 0)}}).catch(()=>{n.resolve(new T("No attachment found"))}),n}async stage(t,e){if(this.closed)throw new we;let n=await this.db,r=e instanceof Uint8Array?e:await Uc(e),s=await Se.sha256base32(r),i=this.getIndexKey(t,s),u=`${i}___${Mt()}`,o=n.transaction([Ze,it],"readwrite"),a=o.objectStore(Ze).put(r,u),l=o.objectStore(it).put({id:i,blobKey:u}),c=q(),h=q();return a.onsuccess=()=>c.resolve(),l.onsuccess=()=>h.resolve(),await c,await h,{hash:s,size:r.byteLength,reject:async()=>{let f=n.transaction([Ze,it],"readwrite"),d=f.objectStore(Ze).delete(u),p=f.objectStore(it).delete(i),D=q(),g=q();d.onsuccess=()=>{D.resolve()},p.onsuccess=()=>{g.resolve()},await Promise.all([D,g])},commit:async()=>{let f=n.transaction([tt,it],"readwrite"),d=f.objectStore(it).delete(i),p=f.objectStore(tt).put({id:i,blobKey:u}),D=q(),g=q();d.onsuccess=()=>D.resolve(),p.onsuccess=()=>g.resolve(),await Promise.all([D,g])}}}async wipe(){if(this.closed)throw new we;let t=(await this.db).transaction([Ze,tt,it],"readwrite"),e=t.objectStore(Ze).clear(),n=t.objectStore(tt).clear(),r=t.objectStore(it).clear(),s=q(),i=q(),u=q();e.onsuccess=()=>s.resolve(),n.onsuccess=()=>i.resolve(),r.onsuccess=()=>u.resolve(),await Promise.all([s,i,u])}async clearStaging(){if(this.closed)throw new we;let t=(await this.db).transaction([Ze,it]),e=t.objectStore(it).openCursor(),n=q();return e.onsuccess=()=>{let r=e.result;if(!r){n.resolve();return}let s=r.value.blobKey,i=t.objectStore(Ze).delete(s);r.delete(),i.onsuccess=()=>{r.continue()},i.onerror=()=>{r.continue()}},n}async filter(t){if(this.closed)throw new we;let e=(await this.db).transaction([Ze,tt],"readwrite"),n=50,r=[],s=[],i=q(),u=(o=null)=>{let a=e.objectStore(tt).getAll(o,n);a.onsuccess=()=>{let l=a.result;for(let c of l){let[h,f]=c.id.split("___");t[h]&&!t[h].has(f)&&(r.push({format:h,hash:f}),s.push(this.erase(h,f)))}if(l.length===n){let c=l[l.length-1],h=IDBKeyRange.lowerBound(c.id,!0);u(h)}else i.resolve()}};return u(),await i,await Promise.all(s),r}isClosed(){return this.closed}async close(t){if(this.closed)throw new we;t&&await this.wipe(),this.closed=!0,(await this.db).close(),await na(20)}},Wc=class{constructor(t,e){this.docDriver=new jc(t,e),this.attachmentDriver=new qc(t,e)}};/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const Dn=[];function Nr(t,e){return{subscribe:ca(t,e).subscribe}}function ca(t,e=R){let n;const r=new Set;function s(o){if(ce(t,o)&&(t=o,n)){const a=!Dn.length;for(const l of r)l[1](),Dn.push(l,t);if(a){for(let l=0;l<Dn.length;l+=2)Dn[l][0](Dn[l+1]);Dn.length=0}}}function i(o){s(o(t))}function u(o,a=R){const l=[o,a];return r.add(l),r.size===1&&(n=e(s)||R),o(t),()=>{r.delete(l),r.size===0&&(n(),n=null)}}return{set:s,update:i,subscribe:u}}function Vc(t,e,n){const r=!Array.isArray(t),s=r?[t]:t,i=e.length<2;return Nr(n,u=>{let o=!1;const a=[];let l=0,c=R;const h=()=>{if(l)return;c();const d=e(r?a[0]:a,u);i?u(d):c=$r(d)?d:R},f=s.map((d,p)=>vu(d,D=>{a[p]=D,l&=~(1<<p),o&&h()},()=>{l|=1<<p}));return o=!0,h(),function(){zt(f),c()}})}const ha=Nr({shareAddress:"+filesharing.b5measwv2ezjdw7zfrsgqpxlln4yvs5cvcefompv4gypg2ueflr3a",secret:"bkhu7fomnhbgqnecjnwstunaued7kxlvvazit43u7afizdfpvo4kq"});let ys;ha.subscribe(t=>{ys=t});const Qc=new Nc({driver:new Wc(ys.shareAddress),shareSecret:ys.secret}),lr=Nr({replica:Qc});class Lr extends Error{constructor(e){super(e||""),this.name="EarthstarError"}}class P extends Lr{constructor(e){super(e||"Validation error"),this.name="ValidationError"}}function Z(t){return t instanceof Lr}function fa(t){return!(t instanceof Lr)}var tr={};Object.defineProperty(tr,"__esModule",{value:!0});var da=tr.setInterval=pa=tr.setTimeout=void 0;const Kc=globalThis.setTimeout;function Gc(t,e,...n){const r=Kc(t,e,...n);return typeof r=="number"?r:r[Symbol.toPrimitive]()}var pa=tr.setTimeout=Gc;const Zc=globalThis.setInterval;function Xc(t,e,...n){const r=Zc(t,e,...n);return typeof r=="number"?r:r[Symbol.toPrimitive]()}da=tr.setInterval=Xc;var Os={},ts,_i;Object.defineProperty(Os,"__esModule",{value:!0});var Da=Os.WeakRef=void 0;Da=Os.WeakRef=(ts=globalThis.WeakRef)!==null&&ts!==void 0?ts:(_i=class{constructor(e){}deref(){throw new Error("WeakRef is not supported in Node 14 and below.")}},_i);const{Blob:Yc}=window,{Request:Jc,Response:eh,Headers:th,fetch:sD}=window,{ReadableStream:Cs,ReadableStreamDefaultReader:iD,ReadableStreamBYOBReader:uD,ReadableStreamBYOBRequest:aD,ReadableByteStreamController:oD,ReadableStreamDefaultController:lD,TransformStream:nh,TransformStreamDefaultController:rh,WritableStream:sh,WritableStreamDefaultWriter:ih,WritableStreamDefaultController:cD,ByteLengthQueuingStrategy:hD,CountQueuingStrategy:fD,TextEncoderStream:dD,TextDecoderStream:pD}=window;if(!Cs.prototype[Symbol.asyncIterator]){async function*t(){const e=this.getReader();try{for(;;){const{done:n,value:r}=await e.read();if(n)return;yield r}}finally{e.releaseLock()}}Cs.prototype[Symbol.asyncIterator]=t}var bn=null;typeof WebSocket<"u"?bn=WebSocket:typeof MozWebSocket<"u"?bn=MozWebSocket:typeof global<"u"?bn=global.WebSocket||global.MozWebSocket:typeof window<"u"?bn=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(bn=self.WebSocket||self.MozWebSocket);const uh=bn,{TextDecoder:ma,TextEncoder:Ns}=window;function Fi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ga(t,e,n){return e&&Fi(t.prototype,e),n&&Fi(t,n),t}function ki(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function kr(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(s,i){if(s){if(typeof s=="string")return ki(s,i);var u=Object.prototype.toString.call(s).slice(8,-1);return u==="Object"&&s.constructor&&(u=s.constructor.name),u==="Map"||u==="Set"?Array.from(s):u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?ki(s,i):void 0}}(t))||e&&t&&typeof t.length=="number"){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ah=/(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDEC0-\uDEEB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/,oh=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/;function lh(t,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(t)}function wa(t,e){e===void 0&&(e=!1);for(var n=[],r=0;r<t.length;){var s=t[r],i=function(d){if(!e)throw new TypeError(d);n.push({type:"INVALID_CHAR",index:r,value:t[r++]})};if(s!=="*")if(s!=="+"&&s!=="?")if(s!=="\\")if(s!=="{")if(s!=="}")if(s!==":")if(s!=="(")n.push({type:"CHAR",index:r,value:t[r++]});else{var u=1,o="",a=r+1,l=!1;if(t[a]==="?"){i('Pattern cannot start with "?" at '+a);continue}for(;a<t.length;){if(!lh(t[a],!1)){i("Invalid character '"+t[a]+"' at "+a+"."),l=!0;break}if(t[a]!=="\\"){if(t[a]===")"){if(--u==0){a++;break}}else if(t[a]==="("&&(u++,t[a+1]!=="?")){i("Capturing groups are not allowed at "+a),l=!0;break}o+=t[a++]}else o+=t[a++]+t[a++]}if(l)continue;if(u){i("Unbalanced pattern at "+r);continue}if(!o){i("Missing pattern at "+r);continue}n.push({type:"PATTERN",index:r,value:o}),r=a}else{for(var c="",h=r+1;h<t.length;){var f=t.substr(h,1);if(!(h===r+1&&ah.test(f)||h!==r+1&&oh.test(f)))break;c+=t[h++]}if(!c){i("Missing parameter name at "+r);continue}n.push({type:"NAME",index:r,value:c}),r=h}else n.push({type:"CLOSE",index:r,value:t[r++]});else n.push({type:"OPEN",index:r,value:t[r++]});else n.push({type:"ESCAPED_CHAR",index:r++,value:t[r++]});else n.push({type:"MODIFIER",index:r,value:t[r++]});else n.push({type:"ASTERISK",index:r,value:t[r++]})}return n.push({type:"END",index:r,value:""}),n}function ba(t,e){e===void 0&&(e={});for(var n=wa(t),r=e.prefixes,s=r===void 0?"./":r,i="[^"+An(e.delimiter||"/#?")+"]+?",u=[],o=0,a=0,l="",c=new Set,h=function(U){if(a<n.length&&n[a].type===U)return n[a++].value},f=function(){return h("MODIFIER")||h("ASTERISK")},d=function(U){var K=h(U);if(K!==void 0)return K;var ie=n[a];throw new TypeError("Unexpected "+ie.type+" at "+ie.index+", expected "+U)},p=function(){for(var U,K="";U=h("CHAR")||h("ESCAPED_CHAR");)K+=U;return K},D=e.encodePart||function(U){return U};a<n.length;){var g=h("CHAR"),$=h("NAME"),S=h("PATTERN");if($||S||!h("ASTERISK")||(S=".*"),$||S){var m=g||"";s.indexOf(m)===-1&&(l+=m,m=""),l&&(u.push(D(l)),l="");var v=$||o++;if(c.has(v))throw new TypeError("Duplicate name '"+v+"'.");c.add(v),u.push({name:v,prefix:D(m),suffix:"",pattern:S||i,modifier:f()||""})}else{var A=g||h("ESCAPED_CHAR");if(A)l+=A;else if(h("OPEN")){var k=p(),x=h("NAME")||"",C=h("PATTERN")||"";x||C||!h("ASTERISK")||(C=".*");var N=p();d("CLOSE");var le=f()||"";if(!x&&!C&&!le){l+=k;continue}if(!x&&!C&&!k)continue;l&&(u.push(D(l)),l=""),u.push({name:x||(C?o++:""),pattern:x&&!C?i:C,prefix:D(k),suffix:D(N),modifier:le})}else l&&(u.push(D(l)),l=""),d("END")}}return u}function An(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function Aa(t){return t&&t.sensitive?"u":"ui"}function ya(t,e,n){n===void 0&&(n={});for(var r,s=n.strict,i=s!==void 0&&s,u=n.start,o=u===void 0||u,a=n.end,l=a===void 0||a,c=n.encode,h=c===void 0?function(A){return A}:c,f="["+An(n.endsWith||"")+"]|$",d="["+An(n.delimiter||"/#?")+"]",p=o?"^":"",D=kr(t);!(r=D()).done;){var g=r.value;if(typeof g=="string")p+=An(h(g));else{var $=An(h(g.prefix)),S=An(h(g.suffix));g.pattern?(e&&e.push(g),p+=$||S?g.modifier==="+"||g.modifier==="*"?"(?:"+$+"((?:"+g.pattern+")(?:"+S+$+"(?:"+g.pattern+"))*)"+S+")"+(g.modifier==="*"?"?":""):"(?:"+$+"("+g.pattern+")"+S+")"+g.modifier:g.modifier==="+"||g.modifier==="*"?"((?:"+g.pattern+")"+g.modifier+")":"("+g.pattern+")"+g.modifier):p+="(?:"+$+S+")"+g.modifier}}if(l)i||(p+=d+"?"),p+=n.endsWith?"(?="+f+")":"$";else{var m=t[t.length-1],v=typeof m=="string"?d.indexOf(m[m.length-1])>-1:m===void 0;i||(p+="(?:"+d+"(?="+f+"))?"),v||(p+="(?="+d+"|"+f+")")}return new RegExp(p,Aa(n))}function Ca(t,e,n){return t instanceof RegExp?function(r,s){if(!s)return r;for(var i=/\((?:\?<(.*?)>)?(?!\?)/g,u=0,o=i.exec(r.source);o;)s.push({name:o[1]||u++,prefix:"",suffix:"",modifier:"",pattern:""}),o=i.exec(r.source);return r}(t,e):Array.isArray(t)?function(r,s,i){var u=r.map(function(o){return Ca(o,s,i).source});return new RegExp("(?:"+u.join("|")+")",Aa(i))}(t,e,n):function(r,s,i){return ya(ba(r,i),s,i)}(t,e,n)}var Wt={delimiter:"",prefixes:"",sensitive:!0,strict:!0},ch={delimiter:".",prefixes:"",sensitive:!0,strict:!0},hh={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function vi(t,e){return t.startsWith(e)?t.substring(e.length,t.length):t}function Ea(t){return!(!t||t.length<2||t[0]!=="["&&(t[0]!=="\\"&&t[0]!=="{"||t[1]!=="["))}var j,_a=["ftp","file","http","https","ws","wss"];function Fa(t){if(!t)return!0;for(var e,n=kr(_a);!(e=n()).done;)if(t.test(e.value))return!0;return!1}function ka(t){switch(t){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function Ls(t){if(t==="")return t;if(/^[-+.A-Za-z0-9]*$/.test(t))return t.toLowerCase();throw new TypeError("Invalid protocol '"+t+"'.")}function fh(t){if(t==="")return t;var e=new URL("https://example.com");return e.username=t,e.username}function dh(t){if(t==="")return t;var e=new URL("https://example.com");return e.password=t,e.password}function va(t){if(t==="")return t;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(t))throw new TypeError("Invalid hostname '"+t+"'");var e=new URL("https://example.com");return e.hostname=t,e.hostname}function Ba(t){if(t==="")return t;if(/[^0-9a-fA-F[\]:]/g.test(t))throw new TypeError("Invalid IPv6 hostname '"+t+"'");return t.toLowerCase()}function xa(t){if(t===""||/^[0-9]*$/.test(t)&&parseInt(t)<=65535)return t;throw new TypeError("Invalid port '"+t+"'.")}function ph(t){if(t==="")return t;var e=new URL("https://example.com");return e.pathname=t[0]!=="/"?"/-"+t:t,t[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function Dh(t){return t===""?t:new URL("data:"+t).pathname}function mh(t){if(t==="")return t;var e=new URL("https://example.com");return e.search=t,e.search.substring(1,e.search.length)}function gh(t){if(t==="")return t;var e=new URL("https://example.com");return e.hash=t,e.hash.substring(1,e.hash.length)}(function(t){t[t.INIT=0]="INIT",t[t.PROTOCOL=1]="PROTOCOL",t[t.AUTHORITY=2]="AUTHORITY",t[t.USERNAME=3]="USERNAME",t[t.PASSWORD=4]="PASSWORD",t[t.HOSTNAME=5]="HOSTNAME",t[t.PORT=6]="PORT",t[t.PATHNAME=7]="PATHNAME",t[t.SEARCH=8]="SEARCH",t[t.HASH=9]="HASH",t[t.DONE=10]="DONE"})(j||(j={}));var wh=function(){function t(n){this.input=void 0,this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=j.INIT,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=n}var e=t.prototype;return e.parse=function(){for(this.tokenList=wa(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===j.INIT){this.rewind(),this.isHashPrefix()?this.changeState(j.HASH,1):this.isSearchPrefix()?(this.changeState(j.SEARCH,1),this.internalResult.hash=""):(this.changeState(j.PATHNAME,0),this.internalResult.search="",this.internalResult.hash="");continue}if(this.state===j.AUTHORITY){this.rewindAndSetState(j.HOSTNAME);continue}this.changeState(j.DONE,0);break}if(this.groupDepth>0){if(!this.isGroupClose())continue;this.groupDepth-=1}if(this.isGroupOpen())this.groupDepth+=1;else switch(this.state){case j.INIT:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(j.PROTOCOL));break;case j.PROTOCOL:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();var n=j.PATHNAME,r=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(n=j.AUTHORITY,r=3):this.shouldTreatAsStandardURL&&(n=j.AUTHORITY),this.changeState(n,r)}break;case j.AUTHORITY:this.isIdentityTerminator()?this.rewindAndSetState(j.USERNAME):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(j.HOSTNAME);break;case j.USERNAME:this.isPasswordPrefix()?this.changeState(j.PASSWORD,1):this.isIdentityTerminator()&&this.changeState(j.HOSTNAME,1);break;case j.PASSWORD:this.isIdentityTerminator()&&this.changeState(j.HOSTNAME,1);break;case j.HOSTNAME:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(j.PORT,1):this.isPathnameStart()?this.changeState(j.PATHNAME,0):this.isSearchPrefix()?this.changeState(j.SEARCH,1):this.isHashPrefix()&&this.changeState(j.HASH,1);break;case j.PORT:this.isPathnameStart()?this.changeState(j.PATHNAME,0):this.isSearchPrefix()?this.changeState(j.SEARCH,1):this.isHashPrefix()&&this.changeState(j.HASH,1);break;case j.PATHNAME:this.isSearchPrefix()?this.changeState(j.SEARCH,1):this.isHashPrefix()&&this.changeState(j.HASH,1);break;case j.SEARCH:this.isHashPrefix()&&this.changeState(j.HASH,1)}}},e.changeState=function(n,r){switch(this.state){case j.INIT:break;case j.PROTOCOL:this.internalResult.protocol=this.makeComponentString();break;case j.AUTHORITY:break;case j.USERNAME:this.internalResult.username=this.makeComponentString();break;case j.PASSWORD:this.internalResult.password=this.makeComponentString();break;case j.HOSTNAME:this.internalResult.hostname=this.makeComponentString();break;case j.PORT:this.internalResult.port=this.makeComponentString();break;case j.PATHNAME:this.internalResult.pathname=this.makeComponentString();break;case j.SEARCH:this.internalResult.search=this.makeComponentString();break;case j.HASH:this.internalResult.hash=this.makeComponentString()}this.changeStateWithoutSettingComponent(n,r)},e.changeStateWithoutSettingComponent=function(n,r){this.state=n,this.componentStart=this.tokenIndex+r,this.tokenIndex+=r,this.tokenIncrement=0},e.rewind=function(){this.tokenIndex=this.componentStart,this.tokenIncrement=0},e.rewindAndSetState=function(n){this.rewind(),this.state=n},e.safeToken=function(n){return n<0&&(n=this.tokenList.length-n),n<this.tokenList.length?this.tokenList[n]:this.tokenList[this.tokenList.length-1]},e.isNonSpecialPatternChar=function(n,r){var s=this.safeToken(n);return s.value===r&&(s.type==="CHAR"||s.type==="ESCAPED_CHAR"||s.type==="INVALID_CHAR")},e.isProtocolSuffix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.nextIsAuthoritySlashes=function(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")},e.isIdentityTerminator=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")},e.isPasswordPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.isPortPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.isPathnameStart=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")},e.isSearchPrefix=function(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;var n=this.safeToken(this.tokenIndex-1);return n.type!=="NAME"&&n.type!=="PATTERN"&&n.type!=="CLOSE"&&n.type!=="ASTERISK"},e.isHashPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")},e.isGroupOpen=function(){return this.tokenList[this.tokenIndex].type=="OPEN"},e.isGroupClose=function(){return this.tokenList[this.tokenIndex].type=="CLOSE"},e.isIPv6Open=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")},e.isIPv6Close=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")},e.makeComponentString=function(){var n=this.tokenList[this.tokenIndex],r=this.safeToken(this.componentStart).index;return this.input.substring(r,n.index)},e.computeShouldTreatAsStandardURL=function(){var n={};Object.assign(n,Wt),n.encodePart=Ls;var r=Ca(this.makeComponentString(),void 0,n);this.shouldTreatAsStandardURL=Fa(r)},ga(t,[{key:"result",get:function(){return this.internalResult}}]),t}(),bh=["protocol","username","password","hostname","port","pathname","search","hash"];function Bi(t,e){if(typeof t!="string")throw new TypeError("parameter 1 is not of type 'string'.");var n=new URL(t,e);return{protocol:n.protocol.substring(0,n.protocol.length-1),username:n.username,password:n.password,hostname:n.hostname,port:n.port,pathname:n.pathname,search:n.search!=""?n.search.substring(1,n.search.length):void 0,hash:n.hash!=""?n.hash.substring(1,n.hash.length):void 0}}function ns(t,e,n){var r;if(typeof e.baseURL=="string")try{r=new URL(e.baseURL),t.protocol=r.protocol?r.protocol.substring(0,r.protocol.length-1):"",t.username=r.username,t.password=r.password,t.hostname=r.hostname,t.port=r.port,t.pathname=r.pathname,t.search=r.search?r.search.substring(1,r.search.length):"",t.hash=r.hash?r.hash.substring(1,r.hash.length):""}catch{throw new TypeError("invalid baseURL '"+e.baseURL+"'.")}if(typeof e.protocol=="string"&&(t.protocol=function(i,u){var o;return i=(o=i).endsWith(":")?o.substr(0,o.length-1):o,u||i===""?i:Ls(i)}(e.protocol,n)),typeof e.username=="string"&&(t.username=function(i,u){if(u||i==="")return i;var o=new URL("https://example.com");return o.username=i,o.username}(e.username,n)),typeof e.password=="string"&&(t.password=function(i,u){if(u||i==="")return i;var o=new URL("https://example.com");return o.password=i,o.password}(e.password,n)),typeof e.hostname=="string"&&(t.hostname=function(i,u){return u||i===""?i:Ea(i)?Ba(i):va(i)}(e.hostname,n)),typeof e.port=="string"&&(t.port=function(i,u,o){return ka(u)===i&&(i=""),o||i===""?i:xa(i)}(e.port,t.protocol,n)),typeof e.pathname=="string"){if(t.pathname=e.pathname,r&&!function(i,u){return!(!i.length||i[0]!=="/"&&(!u||i.length<2||i[0]!="\\"&&i[0]!="{"||i[1]!="/"))}(t.pathname,n)){var s=r.pathname.lastIndexOf("/");s>=0&&(t.pathname=r.pathname.substring(0,s+1)+t.pathname)}t.pathname=function(i,u,o){if(o||i==="")return i;if(u&&!_a.includes(u))return new URL(u+":"+i).pathname;var a=i[0]=="/";return i=new URL(a?i:"/-"+i,"https://example.com").pathname,a||(i=i.substring(2,i.length)),i}(t.pathname,t.protocol,n)}return typeof e.search=="string"&&(t.search=function(i,u){if(i=vi(i,"?"),u||i==="")return i;var o=new URL("https://example.com");return o.search=i,o.search?o.search.substring(1,o.search.length):""}(e.search,n)),typeof e.hash=="string"&&(t.hash=function(i,u){if(i=vi(i,"#"),u||i==="")return i;var o=new URL("https://example.com");return o.hash=i,o.hash?o.hash.substring(1,o.hash.length):""}(e.hash,n)),t}function Nn(t){return t.replace(/([+*?:{}()\\])/g,"\\$1")}function Ah(t,e){for(var n="[^"+(e.delimiter||"/#?").replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")+"]+?",r=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/,s="",i=0;i<t.length;++i){var u=t[i],o=i>0?t[i-1]:null,a=i<t.length-1?t[i+1]:null;if(typeof u!="string")if(u.pattern!==""){var l=typeof u.name!="number",c=e.prefixes!==void 0?e.prefixes:"./",h=u.suffix!==""||u.prefix!==""&&(u.prefix.length!==1||!c.includes(u.prefix));h||!l||u.pattern!==n||u.modifier!==""||!a||a.prefix||a.suffix||(h=typeof a=="string"?r.test(a.length>0?a[0]:""):typeof a.name=="number"),!h&&u.prefix===""&&o&&typeof o=="string"&&o.length>0&&(h=c.includes(o[o.length-1])),h&&(s+="{"),s+=Nn(u.prefix),l&&(s+=":"+u.name),u.pattern===".*"?s+=l||o&&typeof o!="string"&&!o.modifier&&!h&&u.prefix===""?"(.*)":"*":u.pattern===n?l||(s+="("+n+")"):s+="("+u.pattern+")",u.pattern===n&&l&&u.suffix!==""&&r.test(u.suffix[0])&&(s+="\\"),s+=Nn(u.suffix),h&&(s+="}"),s+=u.modifier}else{if(u.modifier===""){s+=Nn(u.prefix);continue}s+="{"+Nn(u.prefix)+"}"+u.modifier}else s+=Nn(u)}return s}var yh=function(){function t(n,r){n===void 0&&(n={}),this.pattern=void 0,this.regexp={},this.keys={},this.component_pattern={};try{if(typeof n=="string"){var s=new wh(n);if(s.parse(),n=s.result,r){if(typeof r!="string")throw new TypeError("'baseURL' parameter is not of type 'string'.");n.baseURL=r}else if(typeof n.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if(r)throw new TypeError("parameter 1 is not of type 'string'.");if(!n||typeof n!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");var i;this.pattern=ns({pathname:"*",protocol:"*",username:"*",password:"*",hostname:"*",port:"*",search:"*",hash:"*"},n,!0),ka(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");for(var u,o=kr(bh);!(u=o()).done;)if((i=u.value)in this.pattern){var a={},l=this.pattern[i];switch(this.keys[i]=[],i){case"protocol":Object.assign(a,Wt),a.encodePart=Ls;break;case"username":Object.assign(a,Wt),a.encodePart=fh;break;case"password":Object.assign(a,Wt),a.encodePart=dh;break;case"hostname":Object.assign(a,ch),a.encodePart=Ea(l)?Ba:va;break;case"port":Object.assign(a,Wt),a.encodePart=xa;break;case"pathname":Fa(this.regexp.protocol)?(Object.assign(a,hh),a.encodePart=ph):(Object.assign(a,Wt),a.encodePart=Dh);break;case"search":Object.assign(a,Wt),a.encodePart=mh;break;case"hash":Object.assign(a,Wt),a.encodePart=gh}try{var c=ba(l,a);this.regexp[i]=ya(c,this.keys[i],a),this.component_pattern[i]=Ah(c,a)}catch{throw new TypeError("invalid "+i+" pattern '"+this.pattern[i]+"'.")}}}catch(h){throw new TypeError("Failed to construct 'URLPattern': "+h.message)}}var e=t.prototype;return e.test=function(n,r){n===void 0&&(n={});var s,i={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof n!="string"&&r)throw new TypeError("parameter 1 is not of type 'string'.");if(n===void 0)return!1;try{i=ns(i,typeof n=="object"?n:Bi(n,r),!1)}catch{return!1}for(s in this.pattern)if(!this.regexp[s].exec(i[s]))return!1;return!0},e.exec=function(n,r){n===void 0&&(n={});var s={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof n!="string"&&r)throw new TypeError("parameter 1 is not of type 'string'.");if(n!==void 0){try{s=ns(s,typeof n=="object"?n:Bi(n,r),!1)}catch{return null}var i,u={};for(i in u.inputs=r?[n,r]:[n],this.pattern){var o=this.regexp[i].exec(s[i]);if(!o)return null;for(var a,l={},c=kr(this.keys[i].entries());!(a=c()).done;){var h=a.value,f=h[1];typeof f.name!="string"&&typeof f.name!="number"||(l[f.name]=o[h[0]+1]||"")}u[i]={input:s[i]||"",groups:l}}return u}},ga(t,[{key:"protocol",get:function(){return this.component_pattern.protocol}},{key:"username",get:function(){return this.component_pattern.username}},{key:"password",get:function(){return this.component_pattern.password}},{key:"hostname",get:function(){return this.component_pattern.hostname}},{key:"port",get:function(){return this.component_pattern.port}},{key:"pathname",get:function(){return this.component_pattern.pathname}},{key:"search",get:function(){return this.component_pattern.search}},{key:"hash",get:function(){return this.component_pattern.hash}}]),t}();const Ch={setInterval:da,setTimeout:pa,WeakRef:Da,Blob:Yc,Request:Jc,Response:eh,Headers:th,WritableStream:sh,TransformStream:nh,ReadableStream:Cs,TransformStreamDefaultController:rh,WritableStreamDefaultWriter:ih,WebSocket:uh,TextEncoder:Ns,TextDecoder:ma,URLPattern:yh};Eh(globalThis,Ch);function Eh(t,e){return new Proxy(t,{get(n,r,s){return r in e?e[r]:t[r]},set(n,r,s){return r in e&&delete e[r],t[r]=s,!0},deleteProperty(n,r){let s=!1;return r in e&&(delete e[r],s=!0),r in t&&(delete t[r],s=!0),s},ownKeys(n){const r=Reflect.ownKeys(t),s=Reflect.ownKeys(e),i=new Set(s);return[...r.filter(u=>!i.has(u)),...s]},defineProperty(n,r,s){return r in e&&delete e[r],Reflect.defineProperty(t,r,s),!0},getOwnPropertyDescriptor(n,r){return r in e?Reflect.getOwnPropertyDescriptor(e,r):Reflect.getOwnPropertyDescriptor(t,r)},has(n,r){return r in e||r in t}})}var Je={};Object.defineProperty(Je,"__esModule",{value:!0});function Sn(t,e,n){var r;if(n===void 0&&(n={}),!e.codes){e.codes={};for(var s=0;s<e.chars.length;++s)e.codes[e.chars[s]]=s}if(!n.loose&&t.length*e.bits&7)throw new SyntaxError("Invalid padding");for(var i=t.length;t[i-1]==="=";)if(--i,!n.loose&&!((t.length-i)*e.bits&7))throw new SyntaxError("Invalid padding");for(var u=new((r=n.out)!=null?r:Uint8Array)(i*e.bits/8|0),o=0,a=0,l=0,c=0;c<i;++c){var h=e.codes[t[c]];if(h===void 0)throw new SyntaxError("Invalid character "+t[c]);a=a<<e.bits|h,o+=e.bits,o>=8&&(o-=8,u[l++]=255&a>>o)}if(o>=e.bits||255&a<<8-o)throw new SyntaxError("Unexpected end of data");return u}function $n(t,e,n){n===void 0&&(n={});for(var r=n,s=r.pad,i=s===void 0?!0:s,u=(1<<e.bits)-1,o="",a=0,l=0,c=0;c<t.length;++c)for(l=l<<8|255&t[c],a+=8;a>e.bits;)a-=e.bits,o+=e.chars[u&l>>a];if(a&&(o+=e.chars[u&l<<e.bits-a]),i)for(;o.length*e.bits&7;)o+="=";return o}var xi={chars:"0123456789ABCDEF",bits:4},Si={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},$i={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},Ii={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},Ti={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},_h={parse:function(e,n){return Sn(e.toUpperCase(),xi,n)},stringify:function(e,n){return $n(e,xi,n)}},Fh={parse:function(e,n){return n===void 0&&(n={}),Sn(n.loose?e.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):e,Si,n)},stringify:function(e,n){return $n(e,Si,n)}},kh={parse:function(e,n){return Sn(e,$i,n)},stringify:function(e,n){return $n(e,$i,n)}},vh={parse:function(e,n){return Sn(e,Ii,n)},stringify:function(e,n){return $n(e,Ii,n)}},Bh={parse:function(e,n){return Sn(e,Ti,n)},stringify:function(e,n){return $n(e,Ti,n)}},xh={parse:Sn,stringify:$n};Je.base16=_h;Je.base32=Fh;Je.base32hex=kh;Je.base64=vh;Je.base64url=Bh;Je.codec=xh;const Sh=Je.base16,$h=Je.base32,Ih=Je.base32hex,Th=Je.base64,Rh=Je.base64url,Ph=Je.codec,Mh=Object.freeze(Object.defineProperty({__proto__:null,base16:Sh,base32:$h,base32hex:Ih,base64:Th,base64url:Rh,codec:Ph,default:Je},Symbol.toStringTag,{value:"Module"}));var un={};Object.defineProperty(un,"__esModule",{value:!0});var Sa=un.Hash=$a=un.createHash=void 0;const Oh=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],Ri={sha256:1};function Nh(t){if(t&&!Ri[t]&&!Ri[t.toLowerCase()])throw new Error("Digest method not supported");return new Ia}var $a=un.createHash=Nh;class Ia{constructor(){this.A=1779033703,this.B=-1150833019,this.C=1013904242,this.D=-1521486534,this.E=1359893119,this.F=-1694144372,this.G=528734635,this.H=1541459225,this._size=0,this._sp=0,(!Dr||Ln>=8e3)&&(Dr=new ArrayBuffer(8e3),Ln=0),this._byte=new Uint8Array(Dr,Ln,80),this._word=new Int32Array(Dr,Ln,20),Ln+=80}update(e){if(typeof e=="string")return this._utf8(e);if(e==null)throw new TypeError("Invalid type: "+typeof e);const n=e.byteOffset,r=e.byteLength;let s=r/64|0,i=0;if(s&&!(n&3)&&!(this._size%64)){const o=new Int32Array(e.buffer,n,s*16);for(;s--;)this._int32(o,i>>2),i+=64;this._size+=i}if(e.BYTES_PER_ELEMENT!==1&&e.buffer){const o=new Uint8Array(e.buffer,n+i,r-i);return this._uint8(o)}return i===r?this:this._uint8(e,i)}_uint8(e,n){const{_byte:r,_word:s}=this,i=e.length;for(n=n|0;n<i;){const u=this._size%64;let o=u;for(;n<i&&o<64;)r[o++]=e[n++];o>=64&&this._int32(s),this._size+=o-u}return this}_utf8(e){const{_byte:n,_word:r}=this,s=e.length;let i=this._sp;for(let u=0;u<s;){const o=this._size%64;let a=o;for(;u<s&&a<64;){let l=e.charCodeAt(u++)|0;l<128?n[a++]=l:l<2048?(n[a++]=192|l>>>6,n[a++]=128|l&63):l<55296||l>57343?(n[a++]=224|l>>>12,n[a++]=128|l>>>6&63,n[a++]=128|l&63):i?(l=((i&1023)<<10)+(l&1023)+65536,n[a++]=240|l>>>18,n[a++]=128|l>>>12&63,n[a++]=128|l>>>6&63,n[a++]=128|l&63,i=0):i=l}a>=64&&(this._int32(r),r[0]=r[16]),this._size+=a-o}return this._sp=i,this}_int32(e,n){let{A:r,B:s,C:i,D:u,E:o,F:a,G:l,H:c}=this,h=0;for(n=n|0;h<16;)en[h++]=ut(e[n++]);for(h=16;h<64;h++)en[h]=Vh(en[h-2])+en[h-7]+Wh(en[h-15])+en[h-16]|0;for(h=0;h<64;h++){const f=c+qh(o)+zh(o,a,l)+Oh[h]+en[h]|0,d=jh(r)+Hh(r,s,i)|0;c=l,l=a,a=o,o=u+f|0,u=i,i=s,s=r,r=f+d|0}this.A=r+this.A|0,this.B=s+this.B|0,this.C=i+this.C|0,this.D=u+this.D|0,this.E=o+this.E|0,this.F=a+this.F|0,this.G=l+this.G|0,this.H=c+this.H|0}digest(e){const{_byte:n,_word:r}=this;let s=this._size%64|0;for(n[s++]=128;s&3;)n[s++]=0;if(s>>=2,s>14){for(;s<16;)r[s++]=0;s=0,this._int32(r)}for(;s<16;)r[s++]=0;const i=this._size*8,u=(i&4294967295)>>>0,o=(i-u)/4294967296;return o&&(r[14]=ut(o)),u&&(r[15]=ut(u)),this._int32(r),e==="hex"?this._hex():this._bin()}_hex(){const{A:e,B:n,C:r,D:s,E:i,F:u,G:o,H:a}=this;return Ht(e)+Ht(n)+Ht(r)+Ht(s)+Ht(i)+Ht(u)+Ht(o)+Ht(a)}_bin(){const{A:e,B:n,C:r,D:s,E:i,F:u,G:o,H:a,_byte:l,_word:c}=this;return c[0]=ut(e),c[1]=ut(n),c[2]=ut(r),c[3]=ut(s),c[4]=ut(i),c[5]=ut(u),c[6]=ut(o),c[7]=ut(a),l.slice(0,32)}}Sa=un.Hash=Ia;const en=new Int32Array(64);let Dr,Ln=0;const Ht=t=>(t+4294967296).toString(16).substr(-8),Lh=t=>t<<24&4278190080|t<<8&16711680|t>>8&65280|t>>24&255,Uh=t=>t,ut=Qh()?Uh:Lh,zh=(t,e,n)=>n^t&(e^n),Hh=(t,e,n)=>t&e|n&(t|e),jh=t=>(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),qh=t=>(t>>>6|t<<26)^(t>>>11|t<<21)^(t>>>25|t<<7),Wh=t=>(t>>>7|t<<25)^(t>>>18|t<<14)^t>>>3,Vh=t=>(t>>>17|t<<15)^(t>>>19|t<<13)^t>>>10;function Qh(){return new Uint8Array(new Uint16Array([65279]).buffer)[0]===254}const Kh=io({__proto__:null,get Hash(){return Sa},get createHash(){return $a},default:un},[un]),Gh={};/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const Ie=BigInt(0),se=BigInt(1),Qe=BigInt(2),Ta=BigInt(255),Pi=Qe**BigInt(252)+BigInt("27742317777372353535851937790883648493"),me={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:Qe**Ta-BigInt(19),l:Pi,n:Pi,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},Ra=Qe**BigInt(256),Kn=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");const Zh=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Xh=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Yh=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Jh=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class ue{constructor(e,n,r,s){this.x=e,this.y=n,this.z=r,this.t=s}static fromAffine(e){if(!(e instanceof ke))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(ke.ZERO)?ue.ZERO:new ue(e.x,e.y,se,F(e.x*e.y))}static toAffineBatch(e){const n=nf(e.map(r=>r.z));return e.map((r,s)=>r.toAffine(n[s]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){Mi(e);const{x:n,y:r,z:s}=this,{x:i,y:u,z:o}=e,a=F(n*o),l=F(i*s),c=F(r*o),h=F(u*s);return a===l&&c===h}negate(){return new ue(F(-this.x),this.y,this.z,F(-this.t))}double(){const{x:e,y:n,z:r}=this,{a:s}=me,i=F(e**Qe),u=F(n**Qe),o=F(Qe*F(r**Qe)),a=F(s*i),l=F(F((e+n)**Qe)-i-u),c=a+u,h=c-o,f=a-u,d=F(l*h),p=F(c*f),D=F(l*f),g=F(h*c);return new ue(d,p,g,D)}add(e){Mi(e);const{x:n,y:r,z:s,t:i}=this,{x:u,y:o,z:a,t:l}=e,c=F((r-n)*(o+u)),h=F((r+n)*(o-u)),f=F(h-c);if(f===Ie)return this.double();const d=F(s*Qe*l),p=F(i*Qe*a),D=p+d,g=h+c,$=p-d,S=F(D*f),m=F(g*$),v=F(D*$),A=F(f*g);return new ue(S,m,A,v)}subtract(e){return this.add(e.negate())}precomputeWindow(e){const n=1+256/e,r=[];let s=this,i=s;for(let u=0;u<n;u++){i=s,r.push(i);for(let o=1;o<2**(e-1);o++)i=i.add(s),r.push(i);s=i.double()}return r}wNAF(e,n){!n&&this.equals(ue.BASE)&&(n=ke.BASE);const r=n&&n._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let s=n&&Es.get(n);s||(s=this.precomputeWindow(r),n&&r!==1&&(s=ue.normalizeZ(s),Es.set(n,s)));let i=ue.ZERO,u=ue.ZERO;const o=1+256/r,a=2**(r-1),l=BigInt(2**r-1),c=2**r,h=BigInt(r);for(let f=0;f<o;f++){const d=f*a;let p=Number(e&l);if(e>>=h,p>a&&(p-=c,e+=se),p===0){let D=s[d];f%2&&(D=D.negate()),u=u.add(D)}else{let D=s[d+Math.abs(p)-1];p<0&&(D=D.negate()),i=i.add(D)}}return ue.normalizeZ([i,u])[0]}multiply(e,n){return this.wNAF(vr(e,me.l),n)}multiplyUnsafe(e){let n=vr(e,me.l,!1);const r=ue.BASE,s=ue.ZERO;if(n===Ie)return s;if(this.equals(s)||n===se)return this;if(this.equals(r))return this.wNAF(n);let i=s,u=this;for(;n>Ie;)n&se&&(i=i.add(u)),u=u.double(),n>>=se;return i}isSmallOrder(){return this.multiplyUnsafe(me.h).equals(ue.ZERO)}isTorsionFree(){return this.multiplyUnsafe(me.l).equals(ue.ZERO)}toAffine(e=Ur(this.z)){const{x:n,y:r,z:s}=this,i=F(n*e),u=F(r*e);if(F(s*e)!==se)throw new Error("invZ was invalid");return new ke(i,u)}fromRistrettoBytes(){ss()}toRistrettoBytes(){ss()}fromRistrettoHash(){ss()}}ue.BASE=new ue(me.Gx,me.Gy,se,F(me.Gx*me.Gy));ue.ZERO=new ue(Ie,se,se,Ie);function Mi(t){if(!(t instanceof ue))throw new TypeError("ExtendedPoint expected")}function rs(t){if(!(t instanceof rt))throw new TypeError("RistrettoPoint expected")}function ss(){throw new Error("Legacy method: switch to RistrettoPoint")}class rt{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){const{d:n}=me,r=F(Kn*e*e),s=F((r+se)*Yh);let i=BigInt(-1);const u=F((i-n*r)*F(r+n));let{isValid:o,value:a}=Us(s,u),l=F(a*e);Vt(l)||(l=F(-l)),o||(a=l),o||(i=r);const c=F(i*(r-se)*Jh-u),h=a*a,f=F((a+a)*u),d=F(c*Zh),p=F(se-h),D=F(se+h);return new ue(F(f*D),F(p*d),F(d*D),F(f*p))}static hashToCurve(e){e=Kt(e,64);const n=is(e.slice(0,32)),r=this.calcElligatorRistrettoMap(n),s=is(e.slice(32,64)),i=this.calcElligatorRistrettoMap(s);return new rt(r.add(i))}static fromHex(e){e=Kt(e,32);const{a:n,d:r}=me,s="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",i=is(e);if(!sf(rr(i),e)||Vt(i))throw new Error(s);const u=F(i*i),o=F(se+n*u),a=F(se-n*u),l=F(o*o),c=F(a*a),h=F(n*r*l-c),{isValid:f,value:d}=Oi(F(h*c)),p=F(d*a),D=F(d*p*h);let g=F((i+i)*p);Vt(g)&&(g=F(-g));const $=F(o*D),S=F(g*$);if(!f||Vt(S)||$===Ie)throw new Error(s);return new rt(new ue(g,$,se,S))}toRawBytes(){let{x:e,y:n,z:r,t:s}=this.ep;const i=F(F(r+n)*F(r-n)),u=F(e*n),{value:o}=Oi(F(i*u**Qe)),a=F(o*i),l=F(o*u),c=F(a*l*s);let h;if(Vt(s*c)){let d=F(n*Kn),p=F(e*Kn);e=d,n=p,h=F(a*Xh)}else h=l;Vt(e*c)&&(n=F(-n));let f=F((r-n)*h);return Vt(f)&&(f=F(-f)),rr(f)}toHex(){return cr(this.toRawBytes())}toString(){return this.toHex()}equals(e){rs(e);const n=this.ep,r=e.ep,s=F(n.x*r.y)===F(n.y*r.x),i=F(n.y*r.y)===F(n.x*r.x);return s||i}add(e){return rs(e),new rt(this.ep.add(e.ep))}subtract(e){return rs(e),new rt(this.ep.subtract(e.ep))}multiply(e){return new rt(this.ep.multiply(e))}multiplyUnsafe(e){return new rt(this.ep.multiplyUnsafe(e))}}rt.BASE=new rt(ue.BASE);rt.ZERO=new rt(ue.ZERO);const Es=new WeakMap;class ke{constructor(e,n){this.x=e,this.y=n}_setWindowSize(e){this._WINDOW_SIZE=e,Es.delete(this)}static fromHex(e,n=!0){const{d:r,P:s}=me;e=Kt(e,32);const i=e.slice();i[31]=e[31]&-129;const u=In(i);if(n&&u>=s)throw new Error("Expected 0 < hex < P");if(!n&&u>=Ra)throw new Error("Expected 0 < hex < 2**256");const o=F(u*u),a=F(o-se),l=F(r*o+se);let{isValid:c,value:h}=Us(a,l);if(!c)throw new Error("Point.fromHex: invalid y coordinate");const f=(h&se)===se;return(e[31]&128)!==0!==f&&(h=F(-h)),new ke(h,u)}static async fromPrivateKey(e){return(await zr(e)).point}toRawBytes(){const e=rr(this.y);return e[31]|=this.x&se?128:0,e}toHex(){return cr(this.toRawBytes())}toX25519(){const{y:e}=this,n=F((se+e)*Ur(se-e));return rr(n)}isTorsionFree(){return ue.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new ke(F(-this.x),this.y)}add(e){return ue.fromAffine(this).add(ue.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return ue.fromAffine(this).multiply(e,this).toAffine()}}ke.BASE=new ke(me.Gx,me.Gy);ke.ZERO=new ke(Ie,se);class nr{constructor(e,n){this.r=e,this.s=n,this.assertValidity()}static fromHex(e){const n=Kt(e,64),r=ke.fromHex(n.slice(0,32),!1),s=In(n.slice(32,64));return new nr(r,s)}assertValidity(){const{r:e,s:n}=this;if(!(e instanceof ke))throw new Error("Expected Point instance");return vr(n,me.l,!1),this}toRawBytes(){const e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(rr(this.s),32),e}toHex(){return cr(this.toRawBytes())}}function ef(...t){if(!t.every(r=>r instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(t.length===1)return t[0];const e=t.reduce((r,s)=>r+s.length,0),n=new Uint8Array(e);for(let r=0,s=0;r<t.length;r++){const i=t[r];n.set(i,s),s+=i.length}return n}const tf=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function cr(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=tf[t[n]];return e}function Pa(t){if(typeof t!="string")throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const e=new Uint8Array(t.length/2);for(let n=0;n<e.length;n++){const r=n*2,s=t.slice(r,r+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");e[n]=i}return e}function Ma(t){const n=t.toString(16).padStart(64,"0");return Pa(n)}function rr(t){return Ma(t).reverse()}function Vt(t){return(F(t)&se)===se}function In(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+cr(Uint8Array.from(t).reverse()))}function is(t){return F(In(t)&Qe**Ta-se)}function F(t,e=me.P){const n=t%e;return n>=Ie?n:e+n}function Ur(t,e=me.P){if(t===Ie||e<=Ie)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=F(t,e),r=e,s=Ie,i=se;for(;n!==Ie;){const o=r/n,a=r%n,l=s-i*o;r=n,n=a,s=i,i=l}if(r!==se)throw new Error("invert: does not exist");return F(s,e)}function nf(t,e=me.P){const n=new Array(t.length),r=t.reduce((i,u,o)=>u===Ie?i:(n[o]=i,F(i*u,e)),se),s=Ur(r,e);return t.reduceRight((i,u,o)=>u===Ie?i:(n[o]=F(i*n[o],e),F(i*u,e)),s),n}function ct(t,e){const{P:n}=me;let r=t;for(;e-- >Ie;)r*=r,r%=n;return r}function rf(t){const{P:e}=me,n=BigInt(5),r=BigInt(10),s=BigInt(20),i=BigInt(40),u=BigInt(80),a=t*t%e*t%e,l=ct(a,Qe)*a%e,c=ct(l,se)*t%e,h=ct(c,n)*c%e,f=ct(h,r)*h%e,d=ct(f,s)*f%e,p=ct(d,i)*d%e,D=ct(p,u)*p%e,g=ct(D,u)*p%e,$=ct(g,r)*h%e;return{pow_p_5_8:ct($,Qe)*t%e,b2:a}}function Us(t,e){const n=F(e*e*e),r=F(n*n*e),s=rf(t*r).pow_p_5_8;let i=F(t*n*s);const u=F(e*i*i),o=i,a=F(i*Kn),l=u===t,c=u===F(-t),h=u===F(-t*Kn);return l&&(i=o),(c||h)&&(i=a),Vt(i)&&(i=F(-i)),{isValid:l||c,value:i}}function Oi(t){return Us(se,t)}async function _s(...t){const e=await Hr.sha512(ef(...t)),n=In(e);return F(n,me.l)}function sf(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Kt(t,e){const n=t instanceof Uint8Array?Uint8Array.from(t):Pa(t);if(typeof e=="number"&&n.length!==e)throw new Error(`Expected ${e} bytes`);return n}function vr(t,e,n=!0){if(!e)throw new TypeError("Specify max value");if(typeof t=="number"&&Number.isSafeInteger(t)&&(t=BigInt(t)),typeof t=="bigint"&&t<e){if(n){if(Ie<t)return t}else if(Ie<=t)return t}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function uf(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}async function zr(t){if(t=typeof t=="bigint"||typeof t=="number"?Ma(vr(t,Ra)):Kt(t),t.length!==32)throw new Error("Expected 32 bytes");const e=await Hr.sha512(t),n=uf(e.slice(0,32)),r=e.slice(32,64),s=F(In(n),me.l),i=ke.BASE.multiply(s),u=i.toRawBytes();return{head:n,prefix:r,scalar:s,point:i,pointBytes:u}}async function af(t){return(await zr(t)).pointBytes}async function of(t,e){t=Kt(t);const{prefix:n,scalar:r,pointBytes:s}=await zr(e),i=await _s(n,t),u=ke.BASE.multiply(i),o=await _s(u.toRawBytes(),s,t),a=F(i+o*r,me.l);return new nr(u,a).toRawBytes()}async function lf(t,e,n){e=Kt(e),n instanceof ke||(n=ke.fromHex(n,!1));const{r,s}=t instanceof nr?t.assertValidity():nr.fromHex(t),i=ue.BASE.multiplyUnsafe(s),u=await _s(r.toRawBytes(),n.toRawBytes(),e),o=ue.fromAffine(n).multiplyUnsafe(u);return ue.fromAffine(r).add(o).subtract(i).multiplyUnsafe(me.h).equals(ue.ZERO)}ke.BASE._setWindowSize(8);const jt={node:Gh,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},Hr={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:cr,getExtendedPublicKey:zr,mod:F,invert:Ur,hashToPrivateScalar:t=>{if(t=Kt(t),t.length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const e=F(In(t),me.l);if(e===Ie||e===se)throw new Error("Invalid private key");return e},randomBytes:(t=32)=>{if(jt.web)return jt.web.getRandomValues(new Uint8Array(t));if(jt.node){const{randomBytes:e}=jt.node;return new Uint8Array(e(t).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Hr.randomBytes(32),sha512:async t=>{if(jt.web){const e=await jt.web.subtle.digest("SHA-512",t.buffer);return new Uint8Array(e)}else{if(jt.node)return Uint8Array.from(jt.node.createHash("sha512").update(t).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(t=8,e=ke.BASE){const n=e.equals(ke.BASE)?e:new ke(e.x,e.y);return n._setWindowSize(t),n.multiply(Qe),n}};var G=globalThis&&globalThis.__classPrivateFieldGet||function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},Fe=globalThis&&globalThis.__classPrivateFieldSet||function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},_t,Ft,kt,vt,Bt,xt,tn,ze;const _e=11400714785074694791n,Re=14029467366897019727n,Ni=1609587929392839161n,Un=9650029242287828579n,Li=2870177450012600261n,Oa=64n,cf=2n**Oa-1n,hf=new Ns;function Ui(t,e,n,r){return BigInt(t)|BigInt(e)<<16n|BigInt(n)<<32n|BigInt(r)<<48n}function Et(t,e){return BigInt(t[e])|BigInt(t[e+1])<<8n|BigInt(t[e+2])<<16n|BigInt(t[e+3])<<24n|BigInt(t[e+4])<<32n|BigInt(t[e+5])<<40n|BigInt(t[e+6])<<48n|BigInt(t[e+7])<<56n}function Be(t,e){return t<<e&cf|t>>Oa-e}function Q(t){return BigInt.asUintN(64,t)}class ff{constructor(e=0){_t.set(this,void 0),Ft.set(this,void 0),kt.set(this,void 0),vt.set(this,void 0),Bt.set(this,void 0),xt.set(this,void 0),tn.set(this,void 0),ze.set(this,void 0),this.reset(e)}reset(e=G(this,_t,"f")){return Fe(this,_t,BigInt.asUintN(32,BigInt(e)),"f"),Fe(this,Ft,Q(G(this,_t,"f")+_e+Re),"f"),Fe(this,kt,Q(G(this,_t,"f")+Re),"f"),Fe(this,vt,G(this,_t,"f"),"f"),Fe(this,Bt,Q(G(this,_t,"f")-_e),"f"),Fe(this,xt,null,"f"),Fe(this,tn,0,"f"),Fe(this,ze,0,"f"),this}update(e){typeof e=="string"&&(e=hf.encode(e));let n=0,r=e.length,s=n+r;if(r===0)return this;if(Fe(this,tn,G(this,tn,"f")+r,"f"),G(this,ze,"f")===0&&Fe(this,xt,new Uint8Array(32),"f"),G(this,ze,"f")+r<32)return G(this,xt,"f").set(e.subarray(0,r),G(this,ze,"f")),Fe(this,ze,G(this,ze,"f")+r,"f"),this;if(G(this,ze,"f")>0){G(this,xt,"f").set(e.subarray(0,32-G(this,ze,"f")),G(this,ze,"f"));let i=0,u;u=Et(G(this,xt,"f"),i),Fe(this,Ft,Q(Be(Q(G(this,Ft,"f")+u*Re),31n)*_e),"f"),i+=8,u=Et(this.memory,i),Fe(this,kt,Q(Be(Q(G(this,kt,"f")+u*Re),31n)*_e),"f"),i+=8,u=Et(this.memory,i),Fe(this,vt,Q(Be(Q(G(this,vt,"f")+u*Re),31n)*_e),"f"),i+=8,u=Et(this.memory,i),Fe(this,Bt,Q(Be(Q(G(this,Bt,"f")+u*Re),31n)*_e),"f"),n+=32-G(this,ze,"f"),Fe(this,ze,0,"f")}if(n<=s-32){const i=s-32;do{let u;u=Et(e,n),Fe(this,Ft,Q(Be(Q(G(this,Ft,"f")+u*Re),31n)*_e),"f"),n+=8,u=Et(e,n),Fe(this,kt,Q(Be(Q(G(this,kt,"f")+u*Re),31n)*_e),"f"),n+=8,u=Et(e,n),Fe(this,vt,Q(Be(Q(G(this,vt,"f")+u*Re),31n)*_e),"f"),n+=8,u=Et(e,n),Fe(this,Bt,Q(Be(Q(G(this,Bt,"f")+u*Re),31n)*_e),"f"),n+=8}while(n<=i)}return n<s&&(G(this,xt,"f").set(e.subarray(n,s),G(this,ze,"f")),Fe(this,ze,s-n,"f")),this}digest(){let e=G(this,xt,"f"),n=G(this,ze,"f"),r=0,s=0n,i=0n,u=0n;for(G(this,tn,"f")>=32?(s=Be(G(this,Ft,"f"),1n)+Be(G(this,kt,"f"),7n)+Be(G(this,vt,"f"),12n)+Be(G(this,Bt,"f"),18n),s=Q(s^Be(Q(G(this,Ft,"f")*Re),31n)*_e),s=Q(s*_e+Un),s=Q(s^Be(Q(G(this,kt,"f")*Re),31n)*_e),s=Q(s*_e+Un),s=Q(s^Be(Q(G(this,vt,"f")*Re),31n)*_e),s=Q(s*_e+Un),s=Q(s^Be(Q(G(this,Bt,"f")*Re),31n)*_e),s=Q(s*_e+Un)):s=Q(G(this,_t,"f")+Li),s+=BigInt(G(this,tn,"f"));r<=n-8;)u=Et(e,r),u=Q(Be(Q(u*Re),31n)*_e),s=Q(Be(s^u,27n)*_e+Un),r+=8;for(r+4<=n&&(u=Ui(e[r+1]<<8|e[r],e[r+3]<<8|e[r+2],0,0),s=Q(Be(s^Q(u*_e),23n)*Re+Ni),r+=4);r<n;)u=Ui(e[r++],0,0,0),s=Q(Be(s^Q(u*Li),11n)*_e);return i=Q(s>>33n),s=Q((s^i)*Re),i=Q(s>>29n),s=Q((s^i)*Ni),i=Q(s>>32n),s=Q(s^i),s}}_t=new WeakMap,Ft=new WeakMap,kt=new WeakMap,vt=new WeakMap,Bt=new WeakMap,xt=new WeakMap,tn=new WeakMap,ze=new WeakMap;function df(t,e=0){return new ff(e).update(t).digest()}globalThis&&globalThis.__classPrivateFieldGet;globalThis&&globalThis.__classPrivateFieldSet;new ma;const pf=new Ns;function Fs(t){return pf.encode(t)}function Df(t){return Fs(t).length}function ks(t,e){for(let n of t)if(e.indexOf(n)===-1)return!1;return!0}function zi(t){return t===""?!1:hr.indexOf(t)!==-1}const Tn="abcdefghijklmnopqrstuvwxyz",mf=Tn.toUpperCase(),hr="0123456789",Ot=Tn+"234567",Na=Tn+hr,gf=Ot,La=Na+Ot+"@.",Ua=Tn+hr,wf=Tn+hr,za=Ua+Ot+"+.",bf="/'()-._~!$&+,:=@%",Ha=Tn+mf+hr+bf;function Af(t,e){return`@${t}.${e}`}function yf(t,e){return`+${t}.${e}`}function zs(t){const e=ja(t);return fa(e)?!0:e}function Hs(t){const e=qa(t);return fa(e)?!0:e}function vs(t){return t.startsWith("@")?ja(t):t.startsWith("+")?qa(t):new P("address must start with either @ or +")}function ja(t){return Wa(t,{sigil:"@",separator:".",minNameLength:4,maxNameLength:4,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:Na,allowedPubkeyCharacters:gf,pubkeyMustStartWithB:!0})}function qa(t){return Wa(t,{sigil:"+",separator:".",minNameLength:1,maxNameLength:15,minPubkeyLength:1,maxPubkeyLength:53,allowedNameCharacters:Ua,allowedPubkeyCharacters:wf,pubkeyMustStartWithB:!1})}function Wa(t,e){const{sigil:n,separator:r,minNameLength:s,maxNameLength:i,minPubkeyLength:u,maxPubkeyLength:o,allowedNameCharacters:a,allowedPubkeyCharacters:l,pubkeyMustStartWithB:c}=e;if(typeof t!="string")return new P("address must be a string");if(t.length<4)return new P("address is too short");if(t[0]!==n)return new P(`address must start with a sigil: "${n}"`);if(t.indexOf(r)===-1)return new P(`address must contain a separator character: "${r}"`);const h=t.slice(1).split(r);if(h.length!==2)return new P(`address must have exactly 2 parts separated by a "${r}" separator`);const[f,d]=h;return f.length<s||f.length>i?new P(`name must be between ${s} and ${i} characters long, but is ${f.length}`):d.length<u||d.length>o?new P(`pubkey must be between ${u} and ${o} characters long, but is ${d.length}`):ks(f,a)?ks(d,l)?zi(f[0])?new P(`name "${f}" must not start with a digit`):zi(d[0])?new P(`pubkey "${d}" must not start with a digit`):c&&d[0]!=="b"?new P(`pubkey "${d}" must start with 'b'`):{address:t,name:f,pubkey:d}:new P(`pubkey "${d}" must only have allowed characters`):new P(`name "${f}" must only have allowed characters`)}function js(t){return!(Object.prototype.toString.call(t)!=="[object Object]"||(""+t.constructor).startsWith("class"))}function Va(t){return e=>e!==t?`expected literal value ${JSON.stringify(t)}`:null}function Ye(t={}){return e=>{if(t.optional!==!0&&e===void 0)return"required";if(t.optional===!0&&e===void 0)return null;let n=Df(e);return typeof e!="string"?"expected a string but got "+JSON.stringify(e):t.minLen!==void 0&&n<t.minLen?`string shorter than min length of ${t.minLen} chars`:t.maxLen!==void 0&&n>t.maxLen?`string shorter than max length of ${t.maxLen} chars`:t.len!==void 0&&n!==t.len?`string does not have required length of ${t.len} chars: ${e}`:t.allowedChars!==void 0&&!ks(e,t.allowedChars)?"contains disallowed characters":null}}function Gn(t={}){return e=>t.optional!==!0&&e===void 0?"required":t.optional===!0&&e===void 0?null:t.nullable!==!0&&e===null?"not nullable":t.nullable===!0&&e===null?null:typeof e!="number"?"expected a number but got "+JSON.stringify(e):isNaN(e)?"is NaN":isFinite(e)?e!==Math.round(e)?"expected an integer":t.min!==void 0&&e<t.min?`integer too small (must be >= ${t.min})`:t.max!==void 0&&e>t.max?`integer too large (must be <= ${t.max})`:null:"is Infinity"}function Qa(t={}){return t.allowLiteralUndefined=t.allowLiteralUndefined??!1,t.allowExtraKeys=t.allowExtraKeys??!1,e=>{if(!js(e))return"expected an object";if(t.allowLiteralUndefined===!1){for(let[n,r]of Object.entries(e))if(r===void 0)return`${n} is explicitly set to undefined but should be missing instead`}if(t.objSchema!==void 0){if(t.allowExtraKeys===!1){let n=Object.keys(e),r=Object.keys(t.objSchema),s=n.filter(i=>r.indexOf(i)===-1);if(s.length>0)return`object has extra keys not in the schema: ${s.join(", ")}`}for(let[n,r]of Object.entries(t.objSchema)){let s=r(e[n]);if(s!==null)return`${n}: ${s}`}}return null}}const{codec:Ka}=Mh,Ga={chars:"abcdefghijklmnopqrstuvwxyz234567",bits:5};function mn(t){return"b"+Ka.stringify(t,Ga,{pad:!1})}function Br(t){if(!t.startsWith("b"))throw new P("can't decode base32 string - it should start with a 'b'. "+t);if(t[t.length-1]==="=")throw new P("can't decode base32 string - it contains padding characters ('=')");return Ka.parse(t.slice(1),Ga,{loose:!0})}var $t;(function(t){t[t.None=-1]="None",t[t.Error=0]="Error",t[t.Warn=1]="Warn",t[t.Log=2]="Log",t[t.Info=3]="Info",t[t.Debug=4]="Debug"})($t||($t={}));const Cf=$t.Error;let us={_default:Cf};function Ef(t){return t in us?us[t]:us._default}class nt{constructor(e,n){Object.defineProperty(this,"source",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.source=e,this.color=n||"aqua"}_print(e,n,r,...s){if(e<=Ef(this.source))if(n){const i=`[${this.source}]`;if(this.color!==void 0){const u=[`%c ${i}`,`color: ${this.color}`];console.log(r,...u,...s)}else console.log(r,i,...s)}else console.log(r,...s)}error(...e){this._print($t.Error,!0,"!!",...e)}warn(...e){this._print($t.Warn,!0,"! ",...e)}log(...e){this._print($t.Log,!0,"  ",...e)}info(...e){this._print($t.Info,!0,"    ",...e)}debug(...e){this._print($t.Debug,!0,"      ",...e)}blank(){this._print($t.Info,!1,"")}}class _f{constructor(e){Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalDigest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.hash=e.hash,this.internalUpdate=e.update,this.internalDigest=e.digest}update(e){return this.hash=this.internalUpdate(this.hash,e),this.hash}digest(){return this.internalDigest(this.hash)}}const{createHash:as}=Kh,os=new nt("crypto-driver-noble","cyan"),Ff=class{static sha256(t){return typeof t=="string"?Promise.resolve(as("sha256").update(t,"utf-8").digest()):Promise.resolve(as("sha256").update(t).digest())}static updatableSha256(){return new _f({hash:as("sha256"),update:(t,e)=>t.update(e),digest:t=>t.digest()})}static async generateKeypairBytes(){os.debug("generateKeypairBytes");const t=Hr.randomPrivateKey();return{pubkey:await af(t),secret:t}}static sign(t,e){return os.debug("sign"),typeof e=="string"&&(e=Fs(e)),of(e,t.secret)}static async verify(t,e,n){os.debug("verify");try{return typeof n=="string"&&(n=Fs(n)),await lf(e,n,t)}catch{return!1}}};function kf(){return""+Math.floor(Math.random()*1e3)+Math.floor(Math.random()*1e3)}function vf(t){try{const e=Za(t)?t.address:t.shareAddress,n=vs(e);if(Z(n))return n;const r={pubkey:Br(n.pubkey),secret:Br(t.secret)};return r.pubkey.length!==32?new P(`pubkey bytes should be 32 bytes long, not ${r.pubkey.length} after base32 decoding.  ${e}`):r.secret.length!==32?new P(`secret bytes should be 32 bytes long, not ${r.secret.length} after base32 decoding.  ${t.secret}`):r}catch(e){return new P("crash while decoding author keypair: "+e.message)}}function Za(t){return"address"in t}new nt("crypto","cyan");let gn=Ff,zn=new nt("crypto","cyan");const Me=class{static async sha256base32(t){const e=await gn.sha256(t);return mn(e)}static updatableSha256(){return gn.updatableSha256()}static async generateAuthorKeypair(t){zn.debug(`generateAuthorKeypair("${t}")`);const e=await gn.generateKeypairBytes(),n={address:Af(t,mn(e.pubkey)),secret:mn(e.secret)},r=zs(n.address);return Z(r)?r:n}static async generateShareKeypair(t){zn.debug(`generateAuthorKeypair("${t}")`);const e=await gn.generateKeypairBytes(),n={shareAddress:yf(t,mn(e.pubkey)),secret:mn(e.secret)},r=Hs(n.shareAddress);return Z(r)?r:n}static async sign(t,e){zn.debug("sign");try{const n=vf(t);if(Z(n))return n;const r=await gn.sign(n,e);return mn(r)}catch(n){return new P("unexpected error while signing: "+n.message)}}static verify(t,e,n){zn.debug("verify");try{const r=vs(t);return Z(r)?Promise.resolve(!1):gn.verify(Br(r.pubkey),Br(e),n)}catch{return Promise.resolve(!1)}}static async checkKeypairIsValid(t){zn.debug("checkAuthorKeypairIsValid");const e=Za(t)?t.address:t.shareAddress;try{if(typeof e!="string"||typeof t.secret!="string")return new P("address and secret must be strings");const n=vs(e);if(Z(n))return n;const r="a test message to sign. "+kf(),s=await this.sign(t,r);return Z(s)?s:await this.verify(e,s,r)===!1?new P("pubkey does not match secret"):!0}catch(n){return new P("unexpected error in checkAuthorKeypairIsValid: "+n.message)}}};var ls;new nt("validator es.4","red");const Bf=10,xf=Bf*60*1e3*1e3,Hi=1e13,ji=9007199254740990,Sf=4e6,$f=53,If=104,qi={objSchema:{format:Va("es.4"),author:Ye({allowedChars:La}),content:Ye({maxLen:Sf}),contentHash:Ye({allowedChars:Ot,len:$f}),deleteAfter:Gn({min:Hi,max:ji,nullable:!0}),path:Ye({allowedChars:Ha,minLen:2,maxLen:512}),signature:Ye({allowedChars:Ot,len:If}),timestamp:Gn({min:Hi,max:ji}),workspace:Ye({allowedChars:za})},allowLiteralUndefined:!1,allowExtraKeys:!1};ls=class{static hashDocument(t){const e={...t,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},n=this._checkBasicDocumentValidity(e);return Z(n)?Promise.resolve(n):Me.sha256base32(`author	${t.author}
contentHash	${t.contentHash}
`+(t.deleteAfter===null?"":`deleteAfter	${t.deleteAfter}
`)+`format	${t.format}
path	${t.path}
timestamp	${t.timestamp}
workspace	${t.workspace}
`)}static async generateDocument({input:t,keypair:e,share:n,timestamp:r}){const s={format:"es.4",author:e.address,content:t.content,contentHash:await Me.sha256base32(t.content),deleteAfter:t.deleteAfter??null,path:t.path,timestamp:r,workspace:n,signature:"?"},i=await this.signDocument(e,s);return Z(i)?i:{doc:i}}static async signDocument(t,e){const n=await this.hashDocument(e);if(Z(n))return n;const r=await Me.sign(t,n);return Z(r)?r:{...e,signature:r}}static async wipeDocument(t,e){if(e.content.length===0)return e;const n=this.removeExtraFields(e);if(Z(n))return n;const s={...n.doc,content:"",contentHash:await Me.sha256base32(""),signature:"?"};return this.signDocument(t,s)}static removeExtraFields(t){if(!js(t))return new P("doc is not a plain javascript object");const e=new Set(Object.keys(qi.objSchema||{})),n={},r={};for(const[s,i]of Object.entries(t))if(e.has(s))n[s]=i;else{if(!s.startsWith("_"))return new P("extra document fields must have names starting with an underscore");r[s]=i}return{doc:n,extras:r}}static async checkDocumentIsValid(t,e){e===void 0&&(e=Date.now()*1e3);const n=this._checkBasicDocumentValidity(t);if(Z(n))return n;const r=this._checkTimestampIsOk(t.timestamp,t.deleteAfter,e);if(Z(r))return r;const s=this._checkAuthorCanWriteToPath(t.author,t.path);if(Z(s))return s;const i=this._checkPathIsValid(t.path,t.deleteAfter);if(Z(i))return i;const u=zs(t.author);if(Z(u))return u;const o=Hs(t.workspace);if(Z(o))return o;const a=await this._checkAuthorSignatureIsValid(t);if(Z(a))return a;const l=await this._checkContentMatchesHash(t.content,t.contentHash);return Z(l)?l:!0}static _checkBasicDocumentValidity(t){const e=Qa(qi)(t);return e!==null?new P(e):!0}static _checkAuthorCanWriteToPath(t,e){return e.indexOf("~")===-1||e.indexOf("~"+t)!==-1?!0:new P(`author ${t} can't write to path ${e}`)}static _checkTimestampIsOk(t,e,n){if(t>n+xf)return new P("timestamp too far in the future");if(e!==null){if(n>e)return new P("ephemeral doc has expired");if(e<=t)return new P("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(t,e){if(!t.startsWith("/"))return new P("invalid path: must start with /");if(t.endsWith("/"))return new P("invalid path: must not end with /");if(t.startsWith("/@"))return new P('invalid path: must not start with "/@"');if(t.indexOf("//")!==-1)return new P("invalid path: must not contain two consecutive slashes");if(e!==void 0){if(t.indexOf("!")===-1&&e!==null)return new P("when deleteAfter is set, path must contain '!'");if(t.indexOf("!")!==-1&&e===null)return new P("when deleteAfter is null, path must not contain '!'")}return!0}static async _checkAuthorSignatureIsValid(t){try{const e=await this.hashDocument(t);return Z(e)?e:await Me.verify(t.author,t.signature,e)!==!0?new P("signature is invalid"):!0}catch{return new P("signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(t,e){return await Me.sha256base32(t)!==e?new P("content does not match contentHash"):!0}static getAttachmentInfo(t){return new P("es.4 does not support attachments")}static updateAttachmentFields(t,e,n,r){return Promise.resolve(new P("es.4 does not support attachments"))}static authorFromCredentials(t){return t.address}},Object.defineProperty(ls,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.4"});var cs;new nt("validator es.5","red");const Tf=10,Rf=Tf*60*1e3*1e3,Wi=1e13,Vi=9007199254740990,Pf=8e3,Qi=53,Ki=104,Mf=0,Of=Number.MAX_SAFE_INTEGER,Gi={objSchema:{format:Va("es.5"),author:Ye({allowedChars:La}),text:Ye({maxLen:Pf}),textHash:Ye({allowedChars:Ot,len:Qi}),deleteAfter:Gn({min:Wi,max:Vi,optional:!0}),path:Ye({allowedChars:Ha,minLen:2,maxLen:512}),signature:Ye({allowedChars:Ot,len:Ki}),shareSignature:Ye({allowedChars:Ot,len:Ki}),timestamp:Gn({min:Wi,max:Vi}),share:Ye({allowedChars:za}),attachmentSize:Gn({min:Mf,max:Of,optional:!0}),attachmentHash:Ye({allowedChars:Ot,len:Qi,optional:!0})},allowLiteralUndefined:!1,allowExtraKeys:!1};cs=class{static hashDocument(t){const e={...t,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",shareSignature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},n=this._checkBasicDocumentValidity(e);return Z(n)?Promise.resolve(n):Me.sha256base32((t.attachmentHash===void 0?"":`attachmentHash	${t.attachmentHash}
`)+(t.attachmentSize===void 0?"":`attachmentSize	${t.attachmentSize}
`)+`author	${t.author}
`+(t.deleteAfter===void 0?"":`deleteAfter	${t.deleteAfter}
`)+`format	${t.format}
path	${t.path}
textHash	${t.textHash}
timestamp	${t.timestamp}
share	${t.share}
`)}static async generateDocument({input:t,keypair:e,share:n,timestamp:r,prevLatestDoc:s,config:i}){if(t.text===void 0&&(s==null?void 0:s.text)===void 0)return new P("Couldn't determine document text from given input or previous version's text.");const u=t.text!==void 0?t.text:s==null?void 0:s.text,o={...s,format:"es.5",author:e.address,text:u,textHash:await Me.sha256base32(u),path:t.path,timestamp:r,share:n,signature:"?",shareSignature:"?"};t.deleteAfter&&(o.deleteAfter=t.deleteAfter);const a=await this.signDocument(e,o,i);return Z(a)?a:t.attachment?{doc:a,attachment:t.attachment}:{doc:a}}static async signDocument(t,e,n){const r=await this.hashDocument(e);if(Z(r))return r;const s=await Me.sign(t,r);if(n.shareSecret===void 0)return new Lr(`Tried to write a document to ${e.share} without the secret.`);const i=await Me.sign({shareAddress:e.share,secret:n.shareSecret},r);return Z(s)?s:Z(i)?i:{...e,signature:s,shareSignature:i}}static async wipeDocument(t,e,n){if(e.text.length===0)return e;const r=this.removeExtraFields(e);if(Z(r))return r;const s=r.doc;if(s.attachmentHash){const u={...s,text:"",textHash:await Me.sha256base32(""),signature:"?",shareSignature:"?",attachmentHash:await Me.sha256base32(""),attachmentSize:0};return this.signDocument(t,u,n)}const i={...s,text:"",textHash:await Me.sha256base32(""),signature:"?",shareSignature:"?"};return this.signDocument(t,i,n)}static removeExtraFields(t){if(!js(t))return new P("doc is not a plain javascript object");const e=new Set(Object.keys(Gi.objSchema||{})),n={},r={};for(const[s,i]of Object.entries(t))if(e.has(s))n[s]=i;else{if(!s.startsWith("_"))return new P("extra document fields must have names starting with an underscore");r[s]=i}return{doc:n,extras:r}}static async checkDocumentIsValid(t,e){e===void 0&&(e=Date.now()*1e3);const n=this._checkBasicDocumentValidity(t);if(Z(n))return n;const r=this._checkTimestampIsOk(t.timestamp,t.deleteAfter?t.deleteAfter:null,e);if(Z(r))return r;const s=this._checkAuthorCanWriteToPath(t.author,t.path);if(Z(s))return s;const i=this._checkAttachmentFieldsConsistent(t);if(Z(i))return i;const u=this._checkPathIsValid(t.path,!!t.attachmentHash,t.deleteAfter);if(Z(u))return u;const o=zs(t.author);if(Z(o))return o;const a=Hs(t.share);if(Z(a))return a;const l=await this._checkAuthorSignatureIsValid(t);if(Z(l))return l;const c=await this._checkShareSignatureIsValid(t);if(Z(c))return c;const h=await this._checkContentMatchesHash(t.text,t.textHash);return Z(h)?h:!0}static _checkBasicDocumentValidity(t){const e=Qa(Gi)(t);return e!==null?new P(e):!0}static _checkAttachmentFieldsConsistent(t){return t.text.length===0&&t.attachmentSize&&t.attachmentSize>0?new P("Documents with attachments must have text."):(t.text.length>0&&t.attachmentSize&&t.attachmentSize,t.attachmentHash&&t.attachmentSize===void 0?new P("Attachment size is undefined while attachment hash is defined"):t.attachmentSize&&t.attachmentHash===void 0?new P("Attachment hash is undefined while attachment size is defined"):!0)}static _checkAuthorCanWriteToPath(t,e){return e.indexOf("~")===-1||e.indexOf("~"+t)!==-1?!0:new P(`author ${t} can't write to path ${e}`)}static _checkTimestampIsOk(t,e,n){if(t>n+Rf)return new P("timestamp too far in the future");if(e!==null){if(n>e)return new P("ephemeral doc has expired");if(e<=t)return new P("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(t,e,n){if(!t.startsWith("/"))return new P("invalid path: must start with /");if(t.endsWith("/"))return new P("invalid path: must not end with /");if(t.startsWith("/@"))return new P('invalid path: must not start with "/@"');if(t.indexOf("//")!==-1)return new P("invalid path: must not contain two consecutive slashes");if(n!==void 0){if(t.indexOf("!")===-1&&n!==null)return new P("when deleteAfter is set, path must contain '!'");if(t.indexOf("!")!==-1&&n===null)return new P("when deleteAfter is null, path must not contain '!'")}return!Zi(t)&&e?new P("when a attachment is provided, the path must end with a file extension"):Zi(t)&&e===!1?new P("when no attachment is provided, the path cannot end with a file extension"):!0}static async _checkAuthorSignatureIsValid(t){try{const e=await this.hashDocument(t);return Z(e)?e:await Me.verify(t.author,t.signature,e)!==!0?new P("signature is invalid"):!0}catch{return new P("signature is invalid (unexpected exception)")}}static async _checkShareSignatureIsValid(t){try{const e=await this.hashDocument(t);return Z(e)?e:await Me.verify(t.share,t.shareSignature,e)!==!0?new P("share signature is invalid"):!0}catch{return new P("share signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(t,e){return await Me.sha256base32(t)!==e?new P("content does not match contentHash"):!0}static getAttachmentInfo(t){return t.attachmentHash&&t.attachmentSize===0?new P("This document has had its attachment wiped"):!t.attachmentHash||!t.attachmentSize?new P("This document has no attachment."):{size:t.attachmentSize,hash:t.attachmentHash}}static updateAttachmentFields(t,e,n,r,s){const i={...e,attachmentHash:r,attachmentSize:n};return this.signDocument(t,i,s)}static authorFromCredentials(t){return t.address}},Object.defineProperty(cs,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.5"});const Nf=/^.*\.(\w+)$/,Lf=/^.*~@\w{4}\.\w{53}$/;function Zi(t){if(t.indexOf(".")===-1)return!1;const e=t.match(Nf);return!(e===null||e[1].length===53&&t.match(Lf))}BigInt(0);new nt("peer","orangeRed");new nt("query","green");new nt("query helpers","gold");var Xi;(function(t){t[t.LT=-1]="LT",t[t.EQ=0]="EQ",t[t.GT=1]="GT"})(Xi||(Xi={}));new nt("replica","gold");new nt("replica set","gold");new nt("replica ingest","gold");new nt("replica-cache","green");new nt("storage driver async memory","yellow");const xr=ca({address:"",secret:""});function Uf(t){return{c:R,m:R,p:R,d:R}}function zf(t){let e,n,r,s,i,u,o,a,l,c,h,f,d,p,D,g,$,S,m,v,A,k,x;return{c(){e=B("h3"),e.textContent="Identity",n=ae(`
        Your alias is `),r=B("b"),s=ae(t[2]),i=X(),u=B("br"),o=X(),a=B("br"),l=X(),c=B("b"),c.textContent="Address:",h=X(),f=ae(t[1]),d=X(),p=B("br"),D=X(),g=B("b"),g.textContent="Secret",$=ae(": "),S=ae(t[3]),m=B("br"),v=X(),A=B("button"),A.textContent="Download your identity file"},m(C,N){b(C,e,N),b(C,n,N),b(C,r,N),L(r,s),b(C,i,N),b(C,u,N),b(C,o,N),b(C,a,N),b(C,l,N),b(C,c,N),b(C,h,N),b(C,f,N),b(C,d,N),b(C,p,N),b(C,D,N),b(C,g,N),b(C,$,N),b(C,S,N),b(C,m,N),b(C,v,N),b(C,A,N),k||(x=xe(A,"click",t[6]),k=!0)},p(C,N){N&4&&Le(s,C[2]),N&2&&Le(f,C[1]),N&8&&Le(S,C[3])},d(C){C&&w(e),C&&w(n),C&&w(r),C&&w(i),C&&w(u),C&&w(o),C&&w(a),C&&w(l),C&&w(c),C&&w(h),C&&w(f),C&&w(d),C&&w(p),C&&w(D),C&&w(g),C&&w($),C&&w(S),C&&w(m),C&&w(v),C&&w(A),k=!1,x()}}}function Hf(t){let e;return{c(){e=B("h2"),e.textContent="Loading Identity details"},m(n,r){b(n,e,r)},p:R,d(n){n&&w(e)}}}function jf(t){let e,n,r,s,i,u={ctx:t,current:null,token:null,hasCatch:!1,pending:Hf,then:zf,catch:Uf,value:9};return Xn(t[0](),u),{c(){e=B("div"),u.block.c(),n=X(),r=B("button"),r.textContent="Generate new Identity"},m(o,a){b(o,e,a),u.block.m(e,u.anchor=null),u.mount=()=>e,u.anchor=n,L(e,n),L(e,r),s||(i=xe(r,"click",t[7]),s=!0)},p(o,[a]){t=o,xs(u,t,a)},i:R,o:R,d(o){o&&w(e),u.block.d(),u.token=null,u=null,s=!1,i()}}}function qf(){var t="",e="abcdefghijklmnopqrstuvwxyz",n=e.length,r="abcdefghijklmnopqrstuvwxyz0123456789",s=r.length;t+=e.charAt(Math.floor(Math.random()*n));for(var i=0;i<3;i++)t+=r.charAt(Math.floor(Math.random()*s));return t}function Wf(t,e,n){let r,s,i,u,o;xr.subscribe(f=>{n(5,o=f)});function a(){let f=document.createElement("a"),d=new Blob([JSON.stringify(i)],{type:"text/plain"}),p=i.address+".json";f.href=URL.createObjectURL(d),f.download=p,f.style.display="none",document.body.appendChild(f),f.click()}async function l(){let f=await Me.generateAuthorKeypair(qf()),d=f.address,p=f.secret;xr.set({address:d,secret:p})}Ir(()=>{l()});const c=()=>a(),h=()=>l();return t.$$.update=()=>{t.$$.dirty&32&&n(1,r=o.address),t.$$.dirty&32&&n(3,s=o.secret),t.$$.dirty&32&&(i=o),t.$$.dirty&2&&n(2,u=r.slice(0,5))},[l,r,u,s,a,o,c,h]}class Vf extends fe{constructor(e){super(),he(this,e,Wf,jf,ce,{generateID:0})}get generateID(){return this.$$.ctx[0]}}function Yi(t){let e,n,r=t[0].kind+"",s,i,u,o=t[0].kind==="success"&&Ji(t);return{c(){e=B("p"),n=B("strong"),s=ae(r),i=X(),o&&o.c(),u=oe()},m(a,l){b(a,e,l),L(e,n),L(n,s),b(a,i,l),o&&o.m(a,l),b(a,u,l)},p(a,l){l&1&&r!==(r=a[0].kind+"")&&Le(s,r),a[0].kind==="success"?o||(o=Ji(a),o.c(),o.m(u.parentNode,u)):o&&(o.d(1),o=null)},d(a){a&&w(e),a&&w(i),o&&o.d(a),a&&w(u)}}}function Ji(t){let e,n,r,s;return{c(){e=B("p"),n=B("button"),n.textContent="See uploaded file"},m(i,u){b(i,e,u),L(e,n),r||(s=xe(n,"click",t[3]),r=!0)},d(i){i&&w(e),r=!1,s()}}}function Qf(t){let e,n,r,s,i,u,o,a,l,c,h=t[0]&&Yi(t);return{c(){e=B("div"),n=B("img"),s=X(),i=B("div"),i.textContent="Upload file",u=X(),o=B("input"),a=X(),h&&h.c(),M(n,"class","upload svelte-1nuf53a"),Ut(n.src,r=Kf)||M(n,"src",r),M(n,"alt","Comics icons created by Freepik - Flaticon"),M(i,"class","uploadText svelte-1nuf53a"),ho(o,"display","none"),M(o,"type","file"),M(o,"accept",".jpg, .jpeg, .png, .gif, .txt, .pdf, .md, .webm, .mp3, .ogg, .wav")},m(f,d){b(f,e,d),L(e,n),L(e,s),L(e,i),L(e,u),L(e,o),t[9](o),L(e,a),h&&h.m(e,null),l||(c=[xe(n,"click",t[4]),xe(n,"keypress",t[5]),xe(i,"click",t[6]),xe(i,"keypress",t[7]),xe(o,"change",t[8])],l=!0)},p(f,[d]){f[0]?h?h.p(f,d):(h=Yi(f),h.c(),h.m(e,null)):h&&(h.d(1),h=null)},i:R,o:R,d(f){f&&w(e),t[9](null),h&&h.d(),l=!1,zt(c)}}}let Kf="images/insert-picture-icon.png";function Gf(t){return new Promise((e,n)=>{let r=new FileReader;r.onload=()=>{e(r.result),console.log("typeof",r.result)},r.onerror=n,r.readAsArrayBuffer(t)})}function Zf(t,e,n){let r,s;Nt(t,xr,D=>n(10,r=D)),Nt(t,lr,D=>n(11,s=D));let i,u;async function o(D){let g=D.target.files[0],S=g.name.replace(/\s+/g,"_").replace(/[@,\/#!$%\^&\*;:{}=\-`~()]/g,"");console.log("safeName",S);let m=await Gf(g),v=(Date.now()+36e5)*1e3;console.log("fileReady",m);let A=new Uint8Array(m);return n(0,u=await s.replica.set(r,{path:`/documents/${Date.now()}/!${S}`,text:"from "+r.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:A,deleteAfter:v})),console.log("Result: ",u),I(u)&&console.error(u),u}function a(D){go.call(this,t,D)}const l=()=>{i.click()},c=()=>{i.click()},h=()=>{i.click()},f=()=>{i.click()},d=D=>o(D);function p(D){hs[D?"unshift":"push"](()=>{i=D,n(1,i)})}return t.$$.update=()=>{t.$$.dirty&1&&n(0,u)},[u,i,o,a,l,c,h,f,d,p]}class Xf extends fe{constructor(e){super(),he(this,e,Zf,Qf,ce,{})}}const Yf=Nr(new Date,function(e){const n=setInterval(()=>{e(new Date)},1e3);return function(){clearInterval(n)}}),Jf=new Date,e0=Vc(Yf,t=>Math.round((Number(t)-Number(Jf))/1e3));function eu(t){let e,n,r,s,i,u,o=Math.trunc((t[1]/1e3-(t[2]*1e3+t[3]))/1e3)+"",a,l,c,h,f,d;return{c(){e=B("div"),n=B("button"),n.textContent="+",r=X(),s=B("button"),s.textContent="-",i=X(),u=B("p"),a=ae(o),l=ae(" seconds left until deletion"),c=X(),h=B("button"),h.textContent="x",M(n,"class","svelte-ory2b7"),M(s,"class","svelte-ory2b7"),M(u,"class","svelte-ory2b7"),M(h,"class","svelte-ory2b7"),M(e,"id","flexcontainer"),M(e,"class","svelte-ory2b7")},m(p,D){b(p,e,D),L(e,n),L(e,r),L(e,s),L(e,i),L(e,u),L(u,a),L(u,l),L(e,c),L(e,h),f||(d=[xe(n,"click",t[4]),xe(s,"click",t[5]),xe(h,"click",t[9])],f=!0)},p(p,D){D&6&&o!==(o=Math.trunc((p[1]/1e3-(p[2]*1e3+p[3]))/1e3)+"")&&Le(a,o)},d(p){p&&w(e),f=!1,zt(d)}}}function t0(t){let e,n=t[0]?"":"",r,s,i,u,o,a=t[0]&&eu(t);return{c(){e=B("button"),r=ae(n),s=X(),a&&a.c(),i=oe(),M(e,"class","svelte-ory2b7")},m(l,c){b(l,e,c),L(e,r),b(l,s,c),a&&a.m(l,c),b(l,i,c),u||(o=xe(e,"click",t[8]),u=!0)},p(l,[c]){c&1&&n!==(n=l[0]?"":"")&&Le(r,n),l[0]?a?a.p(l,c):(a=eu(l),a.c(),a.m(i.parentNode,i)):a&&(a.d(1),a=null)},i:R,o:R,d(l){l&&w(e),l&&w(s),a&&a.d(l),l&&w(i),u=!1,o()}}}function n0(t,e,n){let r,s,i;Nt(t,xr,g=>n(10,r=g)),Nt(t,lr,g=>n(11,s=g)),Nt(t,e0,g=>n(2,i=g));const u=xu();let o=Date.now(),a=!1,{doc:l}=e,c=l.deleteAfter;async function h(){n(1,c+=6e7);const g=await s.replica.set(r,{path:l.path,deleteAfter:c});console.log("result ",g)}async function f(){n(1,c-=6e7);const g=await s.replica.set(r,{path:l.path,deleteAfter:c});console.log("result ",g)}async function d(){u("update");const g=await s.replica.set(r,{path:l.path,deleteAfter:(Date.now()+1e3)*1e3});console.log("result ",g)}const p=()=>n(0,a=!a),D=()=>d();return t.$$set=g=>{"doc"in g&&n(7,l=g.doc)},[a,c,i,o,h,f,d,l,p,D]}class r0 extends fe{constructor(e){super(),he(this,e,n0,t0,ce,{doc:7})}}function s0(){const t=console.warn;console.warn=e=>{e.includes("unknown prop")||e.includes("unexpected slot")||t(e)},Ir(()=>{console.warn=t})}function tu(t,e,n){const r=t.slice();return r[18]=e[n],r}function nu(t,e,n){const r=t.slice();return r[18]=e[n],r}function ru(t,e,n){const r=t.slice();return r[10]=e[n],r}function su(t,e,n){const r=t.slice();return r[13]=e[n],r[15]=n,r}function iu(t,e,n){const r=t.slice();return r[16]=e[n],r[15]=n,r}function uu(t,e,n){const r=t.slice();return r[7]=e[n],r}function i0(t){let e,n,r,s;const i=[l0,o0,a0],u=[];function o(a,l){return a[0]==="table"?0:a[0]==="list"?1:2}return e=o(t),n=u[e]=i[e](t),{c(){n.c(),r=oe()},m(a,l){u[e].m(a,l),b(a,r,l),s=!0},p(a,l){let c=e;e=o(a),e===c?u[e].p(a,l):(te(),E(u[c],1,1,()=>{u[c]=null}),ne(),n=u[e],n?n.p(a,l):(n=u[e]=i[e](a),n.c()),y(n,1),n.m(r.parentNode,r))},i(a){s||(y(n),s=!0)},o(a){E(n),s=!1},d(a){u[e].d(a),a&&w(r)}}}function u0(t){let e,n,r=t[1],s=[];for(let u=0;u<r.length;u+=1)s[u]=fu(uu(t,r,u));const i=u=>E(s[u],1,1,()=>{s[u]=null});return{c(){for(let u=0;u<s.length;u+=1)s[u].c();e=oe()},m(u,o){for(let a=0;a<s.length;a+=1)s[a].m(u,o);b(u,e,o),n=!0},p(u,o){if(o&34){r=u[1];let a;for(a=0;a<r.length;a+=1){const l=uu(u,r,a);s[a]?(s[a].p(l,o),y(s[a],1)):(s[a]=fu(l),s[a].c(),y(s[a],1),s[a].m(e.parentNode,e))}for(te(),a=r.length;a<s.length;a+=1)i(a);ne()}},i(u){if(!n){for(let o=0;o<r.length;o+=1)y(s[o]);n=!0}},o(u){s=s.filter(Boolean);for(let o=0;o<s.length;o+=1)E(s[o]);n=!1},d(u){an(s,u),u&&w(e)}}}function a0(t){let e,n,r;const s=[t[6]];var i=t[5][t[0]];function u(o){let a={$$slots:{default:[f0]},$$scope:{ctx:o}};for(let l=0;l<s.length;l+=1)a=Lt(a,s[l]);return{props:a}}return i&&(e=ge(i,u(t))),{c(){e&&ee(e.$$.fragment),n=oe()},m(o,a){e&&Y(e,o,a),b(o,n,a),r=!0},p(o,a){const l=a&64?kn(s,[vn(o[6])]):{};if(a&8388706&&(l.$$scope={dirty:a,ctx:o}),i!==(i=o[5][o[0]])){if(e){te();const c=e;E(c.$$.fragment,1,0,()=>{J(c,1)}),ne()}i?(e=ge(i,u(o)),ee(e.$$.fragment),y(e.$$.fragment,1),Y(e,n.parentNode,n)):e=null}else i&&e.$set(l)},i(o){r||(e&&y(e.$$.fragment,o),r=!0)},o(o){e&&E(e.$$.fragment,o),r=!1},d(o){o&&w(n),e&&J(e,o)}}}function o0(t){let e,n,r,s;const i=[p0,d0],u=[];function o(a,l){return a[4]?0:1}return e=o(t),n=u[e]=i[e](t),{c(){n.c(),r=oe()},m(a,l){u[e].m(a,l),b(a,r,l),s=!0},p(a,l){let c=e;e=o(a),e===c?u[e].p(a,l):(te(),E(u[c],1,1,()=>{u[c]=null}),ne(),n=u[e],n?n.p(a,l):(n=u[e]=i[e](a),n.c()),y(n,1),n.m(r.parentNode,r))},i(a){s||(y(n),s=!0)},o(a){E(n),s=!1},d(a){u[e].d(a),a&&w(r)}}}function l0(t){let e,n,r;var s=t[5].table;function i(u){return{props:{$$slots:{default:[F0]},$$scope:{ctx:u}}}}return s&&(e=ge(s,i(t))),{c(){e&&ee(e.$$.fragment),n=oe()},m(u,o){e&&Y(e,u,o),b(u,n,o),r=!0},p(u,o){const a={};if(o&8388716&&(a.$$scope={dirty:o,ctx:u}),s!==(s=u[5].table)){if(e){te();const l=e;E(l.$$.fragment,1,0,()=>{J(l,1)}),ne()}s?(e=ge(s,i(u)),ee(e.$$.fragment),y(e.$$.fragment,1),Y(e,n.parentNode,n)):e=null}else s&&e.$set(a)},i(u){r||(e&&y(e.$$.fragment,u),r=!0)},o(u){e&&E(e.$$.fragment,u),r=!1},d(u){u&&w(n),e&&J(e,u)}}}function c0(t){let e=t[6].raw+"",n;return{c(){n=ae(e)},m(r,s){b(r,n,s)},p(r,s){s&64&&e!==(e=r[6].raw+"")&&Le(n,e)},i:R,o:R,d(r){r&&w(n)}}}function h0(t){let e,n;return e=new cn({props:{tokens:t[1],renderers:t[5]}}),{c(){ee(e.$$.fragment)},m(r,s){Y(e,r,s),n=!0},p(r,s){const i={};s&2&&(i.tokens=r[1]),s&32&&(i.renderers=r[5]),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){J(e,r)}}}function f0(t){let e,n,r,s;const i=[h0,c0],u=[];function o(a,l){return a[1]?0:1}return e=o(t),n=u[e]=i[e](t),{c(){n.c(),r=oe()},m(a,l){u[e].m(a,l),b(a,r,l),s=!0},p(a,l){let c=e;e=o(a),e===c?u[e].p(a,l):(te(),E(u[c],1,1,()=>{u[c]=null}),ne(),n=u[e],n?n.p(a,l):(n=u[e]=i[e](a),n.c()),y(n,1),n.m(r.parentNode,r))},i(a){s||(y(n),s=!0)},o(a){E(n),s=!1},d(a){u[e].d(a),a&&w(r)}}}function d0(t){let e,n,r;const s=[{ordered:t[4]},t[6]];var i=t[5].list;function u(o){let a={$$slots:{default:[m0]},$$scope:{ctx:o}};for(let l=0;l<s.length;l+=1)a=Lt(a,s[l]);return{props:a}}return i&&(e=ge(i,u(t))),{c(){e&&ee(e.$$.fragment),n=oe()},m(o,a){e&&Y(e,o,a),b(o,n,a),r=!0},p(o,a){const l=a&80?kn(s,[a&16&&{ordered:o[4]},a&64&&vn(o[6])]):{};if(a&8388704&&(l.$$scope={dirty:a,ctx:o}),i!==(i=o[5].list)){if(e){te();const c=e;E(c.$$.fragment,1,0,()=>{J(c,1)}),ne()}i?(e=ge(i,u(o)),ee(e.$$.fragment),y(e.$$.fragment,1),Y(e,n.parentNode,n)):e=null}else i&&e.$set(l)},i(o){r||(e&&y(e.$$.fragment,o),r=!0)},o(o){e&&E(e.$$.fragment,o),r=!1},d(o){o&&w(n),e&&J(e,o)}}}function p0(t){let e,n,r;const s=[{ordered:t[4]},t[6]];var i=t[5].list;function u(o){let a={$$slots:{default:[w0]},$$scope:{ctx:o}};for(let l=0;l<s.length;l+=1)a=Lt(a,s[l]);return{props:a}}return i&&(e=ge(i,u(t))),{c(){e&&ee(e.$$.fragment),n=oe()},m(o,a){e&&Y(e,o,a),b(o,n,a),r=!0},p(o,a){const l=a&80?kn(s,[a&16&&{ordered:o[4]},a&64&&vn(o[6])]):{};if(a&8388704&&(l.$$scope={dirty:a,ctx:o}),i!==(i=o[5].list)){if(e){te();const c=e;E(c.$$.fragment,1,0,()=>{J(c,1)}),ne()}i?(e=ge(i,u(o)),ee(e.$$.fragment),y(e.$$.fragment,1),Y(e,n.parentNode,n)):e=null}else i&&e.$set(l)},i(o){r||(e&&y(e.$$.fragment,o),r=!0)},o(o){e&&E(e.$$.fragment,o),r=!1},d(o){o&&w(n),e&&J(e,o)}}}function D0(t){let e,n,r;return e=new cn({props:{tokens:t[18].tokens,renderers:t[5]}}),{c(){ee(e.$$.fragment),n=X()},m(s,i){Y(e,s,i),b(s,n,i),r=!0},p(s,i){const u={};i&64&&(u.tokens=s[18].tokens),i&32&&(u.renderers=s[5]),e.$set(u)},i(s){r||(y(e.$$.fragment,s),r=!0)},o(s){E(e.$$.fragment,s),r=!1},d(s){J(e,s),s&&w(n)}}}function au(t){let e,n,r;const s=[t[18]];var i=t[5].unorderedlistitem||t[5].listitem;function u(o){let a={$$slots:{default:[D0]},$$scope:{ctx:o}};for(let l=0;l<s.length;l+=1)a=Lt(a,s[l]);return{props:a}}return i&&(e=ge(i,u(t))),{c(){e&&ee(e.$$.fragment),n=oe()},m(o,a){e&&Y(e,o,a),b(o,n,a),r=!0},p(o,a){const l=a&64?kn(s,[vn(o[18])]):{};if(a&8388704&&(l.$$scope={dirty:a,ctx:o}),i!==(i=o[5].unorderedlistitem||o[5].listitem)){if(e){te();const c=e;E(c.$$.fragment,1,0,()=>{J(c,1)}),ne()}i?(e=ge(i,u(o)),ee(e.$$.fragment),y(e.$$.fragment,1),Y(e,n.parentNode,n)):e=null}else i&&e.$set(l)},i(o){r||(e&&y(e.$$.fragment,o),r=!0)},o(o){e&&E(e.$$.fragment,o),r=!1},d(o){o&&w(n),e&&J(e,o)}}}function m0(t){let e,n,r=t[6].items,s=[];for(let u=0;u<r.length;u+=1)s[u]=au(tu(t,r,u));const i=u=>E(s[u],1,1,()=>{s[u]=null});return{c(){for(let u=0;u<s.length;u+=1)s[u].c();e=oe()},m(u,o){for(let a=0;a<s.length;a+=1)s[a].m(u,o);b(u,e,o),n=!0},p(u,o){if(o&96){r=u[6].items;let a;for(a=0;a<r.length;a+=1){const l=tu(u,r,a);s[a]?(s[a].p(l,o),y(s[a],1)):(s[a]=au(l),s[a].c(),y(s[a],1),s[a].m(e.parentNode,e))}for(te(),a=r.length;a<s.length;a+=1)i(a);ne()}},i(u){if(!n){for(let o=0;o<r.length;o+=1)y(s[o]);n=!0}},o(u){s=s.filter(Boolean);for(let o=0;o<s.length;o+=1)E(s[o]);n=!1},d(u){an(s,u),u&&w(e)}}}function g0(t){let e,n,r;return e=new cn({props:{tokens:t[18].tokens,renderers:t[5]}}),{c(){ee(e.$$.fragment),n=X()},m(s,i){Y(e,s,i),b(s,n,i),r=!0},p(s,i){const u={};i&64&&(u.tokens=s[18].tokens),i&32&&(u.renderers=s[5]),e.$set(u)},i(s){r||(y(e.$$.fragment,s),r=!0)},o(s){E(e.$$.fragment,s),r=!1},d(s){J(e,s),s&&w(n)}}}function ou(t){let e,n,r;const s=[t[18]];var i=t[5].orderedlistitem||t[5].listitem;function u(o){let a={$$slots:{default:[g0]},$$scope:{ctx:o}};for(let l=0;l<s.length;l+=1)a=Lt(a,s[l]);return{props:a}}return i&&(e=ge(i,u(t))),{c(){e&&ee(e.$$.fragment),n=oe()},m(o,a){e&&Y(e,o,a),b(o,n,a),r=!0},p(o,a){const l=a&64?kn(s,[vn(o[18])]):{};if(a&8388704&&(l.$$scope={dirty:a,ctx:o}),i!==(i=o[5].orderedlistitem||o[5].listitem)){if(e){te();const c=e;E(c.$$.fragment,1,0,()=>{J(c,1)}),ne()}i?(e=ge(i,u(o)),ee(e.$$.fragment),y(e.$$.fragment,1),Y(e,n.parentNode,n)):e=null}else i&&e.$set(l)},i(o){r||(e&&y(e.$$.fragment,o),r=!0)},o(o){e&&E(e.$$.fragment,o),r=!1},d(o){o&&w(n),e&&J(e,o)}}}function w0(t){let e,n,r=t[6].items,s=[];for(let u=0;u<r.length;u+=1)s[u]=ou(nu(t,r,u));const i=u=>E(s[u],1,1,()=>{s[u]=null});return{c(){for(let u=0;u<s.length;u+=1)s[u].c();e=oe()},m(u,o){for(let a=0;a<s.length;a+=1)s[a].m(u,o);b(u,e,o),n=!0},p(u,o){if(o&96){r=u[6].items;let a;for(a=0;a<r.length;a+=1){const l=nu(u,r,a);s[a]?(s[a].p(l,o),y(s[a],1)):(s[a]=ou(l),s[a].c(),y(s[a],1),s[a].m(e.parentNode,e))}for(te(),a=r.length;a<s.length;a+=1)i(a);ne()}},i(u){if(!n){for(let o=0;o<r.length;o+=1)y(s[o]);n=!0}},o(u){s=s.filter(Boolean);for(let o=0;o<s.length;o+=1)E(s[o]);n=!1},d(u){an(s,u),u&&w(e)}}}function b0(t){let e,n,r;return e=new cn({props:{tokens:t[16].tokens,renderers:t[5]}}),{c(){ee(e.$$.fragment),n=X()},m(s,i){Y(e,s,i),b(s,n,i),r=!0},p(s,i){const u={};i&4&&(u.tokens=s[16].tokens),i&32&&(u.renderers=s[5]),e.$set(u)},i(s){r||(y(e.$$.fragment,s),r=!0)},o(s){E(e.$$.fragment,s),r=!1},d(s){J(e,s),s&&w(n)}}}function lu(t){let e,n,r;var s=t[5].tablecell;function i(u){return{props:{header:!0,align:u[6].align[u[15]]||"center",$$slots:{default:[b0]},$$scope:{ctx:u}}}}return s&&(e=ge(s,i(t))),{c(){e&&ee(e.$$.fragment),n=oe()},m(u,o){e&&Y(e,u,o),b(u,n,o),r=!0},p(u,o){const a={};if(o&64&&(a.align=u[6].align[u[15]]||"center"),o&8388644&&(a.$$scope={dirty:o,ctx:u}),s!==(s=u[5].tablecell)){if(e){te();const l=e;E(l.$$.fragment,1,0,()=>{J(l,1)}),ne()}s?(e=ge(s,i(u)),ee(e.$$.fragment),y(e.$$.fragment,1),Y(e,n.parentNode,n)):e=null}else s&&e.$set(a)},i(u){r||(e&&y(e.$$.fragment,u),r=!0)},o(u){e&&E(e.$$.fragment,u),r=!1},d(u){u&&w(n),e&&J(e,u)}}}function A0(t){let e,n,r=t[2],s=[];for(let u=0;u<r.length;u+=1)s[u]=lu(iu(t,r,u));const i=u=>E(s[u],1,1,()=>{s[u]=null});return{c(){for(let u=0;u<s.length;u+=1)s[u].c();e=oe()},m(u,o){for(let a=0;a<s.length;a+=1)s[a].m(u,o);b(u,e,o),n=!0},p(u,o){if(o&100){r=u[2];let a;for(a=0;a<r.length;a+=1){const l=iu(u,r,a);s[a]?(s[a].p(l,o),y(s[a],1)):(s[a]=lu(l),s[a].c(),y(s[a],1),s[a].m(e.parentNode,e))}for(te(),a=r.length;a<s.length;a+=1)i(a);ne()}},i(u){if(!n){for(let o=0;o<r.length;o+=1)y(s[o]);n=!0}},o(u){s=s.filter(Boolean);for(let o=0;o<s.length;o+=1)E(s[o]);n=!1},d(u){an(s,u),u&&w(e)}}}function y0(t){let e,n,r;var s=t[5].tablerow;function i(u){return{props:{$$slots:{default:[A0]},$$scope:{ctx:u}}}}return s&&(e=ge(s,i(t))),{c(){e&&ee(e.$$.fragment),n=oe()},m(u,o){e&&Y(e,u,o),b(u,n,o),r=!0},p(u,o){const a={};if(o&8388708&&(a.$$scope={dirty:o,ctx:u}),s!==(s=u[5].tablerow)){if(e){te();const l=e;E(l.$$.fragment,1,0,()=>{J(l,1)}),ne()}s?(e=ge(s,i(u)),ee(e.$$.fragment),y(e.$$.fragment,1),Y(e,n.parentNode,n)):e=null}else s&&e.$set(a)},i(u){r||(e&&y(e.$$.fragment,u),r=!0)},o(u){e&&E(e.$$.fragment,u),r=!1},d(u){u&&w(n),e&&J(e,u)}}}function C0(t){let e,n;return e=new cn({props:{tokens:t[13].tokens,renderers:t[5]}}),{c(){ee(e.$$.fragment)},m(r,s){Y(e,r,s),n=!0},p(r,s){const i={};s&8&&(i.tokens=r[13].tokens),s&32&&(i.renderers=r[5]),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){J(e,r)}}}function cu(t){let e,n,r;var s=t[5].tablecell;function i(u){return{props:{header:!1,align:u[6].align[u[15]]||"center",$$slots:{default:[C0]},$$scope:{ctx:u}}}}return s&&(e=ge(s,i(t))),{c(){e&&ee(e.$$.fragment),n=oe()},m(u,o){e&&Y(e,u,o),b(u,n,o),r=!0},p(u,o){const a={};if(o&64&&(a.align=u[6].align[u[15]]||"center"),o&8388648&&(a.$$scope={dirty:o,ctx:u}),s!==(s=u[5].tablecell)){if(e){te();const l=e;E(l.$$.fragment,1,0,()=>{J(l,1)}),ne()}s?(e=ge(s,i(u)),ee(e.$$.fragment),y(e.$$.fragment,1),Y(e,n.parentNode,n)):e=null}else s&&e.$set(a)},i(u){r||(e&&y(e.$$.fragment,u),r=!0)},o(u){e&&E(e.$$.fragment,u),r=!1},d(u){u&&w(n),e&&J(e,u)}}}function E0(t){let e,n,r=t[10],s=[];for(let u=0;u<r.length;u+=1)s[u]=cu(su(t,r,u));const i=u=>E(s[u],1,1,()=>{s[u]=null});return{c(){for(let u=0;u<s.length;u+=1)s[u].c();e=X()},m(u,o){for(let a=0;a<s.length;a+=1)s[a].m(u,o);b(u,e,o),n=!0},p(u,o){if(o&104){r=u[10];let a;for(a=0;a<r.length;a+=1){const l=su(u,r,a);s[a]?(s[a].p(l,o),y(s[a],1)):(s[a]=cu(l),s[a].c(),y(s[a],1),s[a].m(e.parentNode,e))}for(te(),a=r.length;a<s.length;a+=1)i(a);ne()}},i(u){if(!n){for(let o=0;o<r.length;o+=1)y(s[o]);n=!0}},o(u){s=s.filter(Boolean);for(let o=0;o<s.length;o+=1)E(s[o]);n=!1},d(u){an(s,u),u&&w(e)}}}function hu(t){let e,n,r;var s=t[5].tablerow;function i(u){return{props:{$$slots:{default:[E0]},$$scope:{ctx:u}}}}return s&&(e=ge(s,i(t))),{c(){e&&ee(e.$$.fragment),n=oe()},m(u,o){e&&Y(e,u,o),b(u,n,o),r=!0},p(u,o){const a={};if(o&8388712&&(a.$$scope={dirty:o,ctx:u}),s!==(s=u[5].tablerow)){if(e){te();const l=e;E(l.$$.fragment,1,0,()=>{J(l,1)}),ne()}s?(e=ge(s,i(u)),ee(e.$$.fragment),y(e.$$.fragment,1),Y(e,n.parentNode,n)):e=null}else s&&e.$set(a)},i(u){r||(e&&y(e.$$.fragment,u),r=!0)},o(u){e&&E(e.$$.fragment,u),r=!1},d(u){u&&w(n),e&&J(e,u)}}}function _0(t){let e,n,r=t[3],s=[];for(let u=0;u<r.length;u+=1)s[u]=hu(ru(t,r,u));const i=u=>E(s[u],1,1,()=>{s[u]=null});return{c(){for(let u=0;u<s.length;u+=1)s[u].c();e=oe()},m(u,o){for(let a=0;a<s.length;a+=1)s[a].m(u,o);b(u,e,o),n=!0},p(u,o){if(o&104){r=u[3];let a;for(a=0;a<r.length;a+=1){const l=ru(u,r,a);s[a]?(s[a].p(l,o),y(s[a],1)):(s[a]=hu(l),s[a].c(),y(s[a],1),s[a].m(e.parentNode,e))}for(te(),a=r.length;a<s.length;a+=1)i(a);ne()}},i(u){if(!n){for(let o=0;o<r.length;o+=1)y(s[o]);n=!0}},o(u){s=s.filter(Boolean);for(let o=0;o<s.length;o+=1)E(s[o]);n=!1},d(u){an(s,u),u&&w(e)}}}function F0(t){let e,n,r,s,i;var u=t[5].tablehead;function o(c){return{props:{$$slots:{default:[y0]},$$scope:{ctx:c}}}}u&&(e=ge(u,o(t)));var a=t[5].tablebody;function l(c){return{props:{$$slots:{default:[_0]},$$scope:{ctx:c}}}}return a&&(r=ge(a,l(t))),{c(){e&&ee(e.$$.fragment),n=X(),r&&ee(r.$$.fragment),s=oe()},m(c,h){e&&Y(e,c,h),b(c,n,h),r&&Y(r,c,h),b(c,s,h),i=!0},p(c,h){const f={};if(h&8388708&&(f.$$scope={dirty:h,ctx:c}),u!==(u=c[5].tablehead)){if(e){te();const p=e;E(p.$$.fragment,1,0,()=>{J(p,1)}),ne()}u?(e=ge(u,o(c)),ee(e.$$.fragment),y(e.$$.fragment,1),Y(e,n.parentNode,n)):e=null}else u&&e.$set(f);const d={};if(h&8388712&&(d.$$scope={dirty:h,ctx:c}),a!==(a=c[5].tablebody)){if(r){te();const p=r;E(p.$$.fragment,1,0,()=>{J(p,1)}),ne()}a?(r=ge(a,l(c)),ee(r.$$.fragment),y(r.$$.fragment,1),Y(r,s.parentNode,s)):r=null}else a&&r.$set(d)},i(c){i||(e&&y(e.$$.fragment,c),r&&y(r.$$.fragment,c),i=!0)},o(c){e&&E(e.$$.fragment,c),r&&E(r.$$.fragment,c),i=!1},d(c){e&&J(e,c),c&&w(n),c&&w(s),r&&J(r,c)}}}function fu(t){let e,n;const r=[t[7],{renderers:t[5]}];let s={};for(let i=0;i<r.length;i+=1)s=Lt(s,r[i]);return e=new cn({props:s}),{c(){ee(e.$$.fragment)},m(i,u){Y(e,i,u),n=!0},p(i,u){const o=u&34?kn(r,[u&2&&vn(i[7]),u&32&&{renderers:i[5]}]):{};e.$set(o)},i(i){n||(y(e.$$.fragment,i),n=!0)},o(i){E(e.$$.fragment,i),n=!1},d(i){J(e,i)}}}function k0(t){let e,n,r,s;const i=[u0,i0],u=[];function o(a,l){return a[0]?a[5][a[0]]?1:-1:0}return~(e=o(t))&&(n=u[e]=i[e](t)),{c(){n&&n.c(),r=oe()},m(a,l){~e&&u[e].m(a,l),b(a,r,l),s=!0},p(a,[l]){let c=e;e=o(a),e===c?~e&&u[e].p(a,l):(n&&(te(),E(u[c],1,1,()=>{u[c]=null}),ne()),~e?(n=u[e],n?n.p(a,l):(n=u[e]=i[e](a),n.c()),y(n,1),n.m(r.parentNode,r)):n=null)},i(a){s||(y(n),s=!0)},o(a){E(n),s=!1},d(a){~e&&u[e].d(a),a&&w(r)}}}function v0(t,e,n){const r=["type","tokens","header","rows","ordered","renderers"];let s=Ks(e,r),{type:i=void 0}=e,{tokens:u=void 0}=e,{header:o=void 0}=e,{rows:a=void 0}=e,{ordered:l=!1}=e,{renderers:c}=e;return s0(),t.$$set=h=>{e=Lt(Lt({},e),oo(h)),n(6,s=Ks(e,r)),"type"in h&&n(0,i=h.type),"tokens"in h&&n(1,u=h.tokens),"header"in h&&n(2,o=h.header),"rows"in h&&n(3,a=h.rows),"ordered"in h&&n(4,l=h.ordered),"renderers"in h&&n(5,c=h.renderers)},[i,u,o,a,l,c,s]}let cn=class extends fe{constructor(e){super(),he(this,e,v0,k0,ce,{type:0,tokens:1,header:2,rows:3,ordered:4,renderers:5})}};function Xa(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let Rn=Xa();function B0(t){Rn=t}const Ya=/[&<>"']/,x0=new RegExp(Ya.source,"g"),Ja=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,S0=new RegExp(Ja.source,"g"),$0={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},du=t=>$0[t];function Oe(t,e){if(e){if(Ya.test(t))return t.replace(x0,du)}else if(Ja.test(t))return t.replace(S0,du);return t}const I0=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function eo(t){return t.replace(I0,(e,n)=>(n=n.toLowerCase(),n==="colon"?":":n.charAt(0)==="#"?n.charAt(1)==="x"?String.fromCharCode(parseInt(n.substring(2),16)):String.fromCharCode(+n.substring(1)):""))}const T0=/(^|[^\[])\^/g;function pe(t,e){t=typeof t=="string"?t:t.source,e=e||"";const n={replace:(r,s)=>(s=s.source||s,s=s.replace(T0,"$1"),t=t.replace(r,s),n),getRegex:()=>new RegExp(t,e)};return n}const R0=/[^\w:]/g,P0=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function pu(t,e,n){if(t){let r;try{r=decodeURIComponent(eo(n)).replace(R0,"").toLowerCase()}catch{return null}if(r.indexOf("javascript:")===0||r.indexOf("vbscript:")===0||r.indexOf("data:")===0)return null}e&&!P0.test(n)&&(n=L0(e,n));try{n=encodeURI(n).replace(/%25/g,"%")}catch{return null}return n}const mr={},M0=/^[^:]+:\/*[^/]*$/,O0=/^([^:]+:)[\s\S]*$/,N0=/^([^:]+:\/*[^/]*)[\s\S]*$/;function L0(t,e){mr[" "+t]||(M0.test(t)?mr[" "+t]=t+"/":mr[" "+t]=Ar(t,"/",!0)),t=mr[" "+t];const n=t.indexOf(":")===-1;return e.substring(0,2)==="//"?n?e:t.replace(O0,"$1")+e:e.charAt(0)==="/"?n?e:t.replace(N0,"$1")+e:t+e}const Sr={exec:function(){}};function at(t){let e=1,n,r;for(;e<arguments.length;e++){n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}function Du(t,e){const n=t.replace(/\|/g,(i,u,o)=>{let a=!1,l=u;for(;--l>=0&&o[l]==="\\";)a=!a;return a?"|":" |"}),r=n.split(/ \|/);let s=0;if(r[0].trim()||r.shift(),r.length>0&&!r[r.length-1].trim()&&r.pop(),r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;s<r.length;s++)r[s]=r[s].trim().replace(/\\\|/g,"|");return r}function Ar(t,e,n){const r=t.length;if(r===0)return"";let s=0;for(;s<r;){const i=t.charAt(r-s-1);if(i===e&&!n)s++;else if(i!==e&&n)s++;else break}return t.slice(0,r-s)}function U0(t,e){if(t.indexOf(e[1])===-1)return-1;const n=t.length;let r=0,s=0;for(;s<n;s++)if(t[s]==="\\")s++;else if(t[s]===e[0])r++;else if(t[s]===e[1]&&(r--,r<0))return s;return-1}function to(t){t&&t.sanitize&&!t.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function mu(t,e){if(e<1)return"";let n="";for(;e>1;)e&1&&(n+=t),e>>=1,t+=t;return n+t}function gu(t,e,n,r){const s=e.href,i=e.title?Oe(e.title):null,u=t[1].replace(/\\([\[\]])/g,"$1");if(t[0].charAt(0)!=="!"){r.state.inLink=!0;const o={type:"link",raw:n,href:s,title:i,text:u,tokens:r.inlineTokens(u)};return r.state.inLink=!1,o}return{type:"image",raw:n,href:s,title:i,text:Oe(u)}}function z0(t,e){const n=t.match(/^(\s+)(?:```)/);if(n===null)return e;const r=n[1];return e.split(`
`).map(s=>{const i=s.match(/^\s+/);if(i===null)return s;const[u]=i;return u.length>=r.length?s.slice(r.length):s}).join(`
`)}class qs{constructor(e){this.options=e||Rn}space(e){const n=this.rules.block.newline.exec(e);if(n&&n[0].length>0)return{type:"space",raw:n[0]}}code(e){const n=this.rules.block.code.exec(e);if(n){const r=n[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:n[0],codeBlockStyle:"indented",text:this.options.pedantic?r:Ar(r,`
`)}}}fences(e){const n=this.rules.block.fences.exec(e);if(n){const r=n[0],s=z0(r,n[3]||"");return{type:"code",raw:r,lang:n[2]?n[2].trim().replace(this.rules.inline._escapes,"$1"):n[2],text:s}}}heading(e){const n=this.rules.block.heading.exec(e);if(n){let r=n[2].trim();if(/#$/.test(r)){const s=Ar(r,"#");(this.options.pedantic||!s||/ $/.test(s))&&(r=s.trim())}return{type:"heading",raw:n[0],depth:n[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(e){const n=this.rules.block.hr.exec(e);if(n)return{type:"hr",raw:n[0]}}blockquote(e){const n=this.rules.block.blockquote.exec(e);if(n){const r=n[0].replace(/^ *>[ \t]?/gm,""),s=this.lexer.state.top;this.lexer.state.top=!0;const i=this.lexer.blockTokens(r);return this.lexer.state.top=s,{type:"blockquote",raw:n[0],tokens:i,text:r}}}list(e){let n=this.rules.block.list.exec(e);if(n){let r,s,i,u,o,a,l,c,h,f,d,p,D=n[1].trim();const g=D.length>1,$={type:"list",raw:"",ordered:g,start:g?+D.slice(0,-1):"",loose:!1,items:[]};D=g?`\\d{1,9}\\${D.slice(-1)}`:`\\${D}`,this.options.pedantic&&(D=g?D:"[*+-]");const S=new RegExp(`^( {0,3}${D})((?:[	 ][^\\n]*)?(?:\\n|$))`);for(;e&&(p=!1,!(!(n=S.exec(e))||this.rules.block.hr.test(e)));){if(r=n[0],e=e.substring(r.length),c=n[2].split(`
`,1)[0].replace(/^\t+/,v=>" ".repeat(3*v.length)),h=e.split(`
`,1)[0],this.options.pedantic?(u=2,d=c.trimLeft()):(u=n[2].search(/[^ ]/),u=u>4?1:u,d=c.slice(u),u+=n[1].length),a=!1,!c&&/^ *$/.test(h)&&(r+=h+`
`,e=e.substring(h.length+1),p=!0),!p){const v=new RegExp(`^ {0,${Math.min(3,u-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),A=new RegExp(`^ {0,${Math.min(3,u-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),k=new RegExp(`^ {0,${Math.min(3,u-1)}}(?:\`\`\`|~~~)`),x=new RegExp(`^ {0,${Math.min(3,u-1)}}#`);for(;e&&(f=e.split(`
`,1)[0],h=f,this.options.pedantic&&(h=h.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(k.test(h)||x.test(h)||v.test(h)||A.test(e)));){if(h.search(/[^ ]/)>=u||!h.trim())d+=`
`+h.slice(u);else{if(a||c.search(/[^ ]/)>=4||k.test(c)||x.test(c)||A.test(c))break;d+=`
`+h}!a&&!h.trim()&&(a=!0),r+=f+`
`,e=e.substring(f.length+1),c=h.slice(u)}}$.loose||(l?$.loose=!0:/\n *\n *$/.test(r)&&(l=!0)),this.options.gfm&&(s=/^\[[ xX]\] /.exec(d),s&&(i=s[0]!=="[ ] ",d=d.replace(/^\[[ xX]\] +/,""))),$.items.push({type:"list_item",raw:r,task:!!s,checked:i,loose:!1,text:d}),$.raw+=r}$.items[$.items.length-1].raw=r.trimRight(),$.items[$.items.length-1].text=d.trimRight(),$.raw=$.raw.trimRight();const m=$.items.length;for(o=0;o<m;o++)if(this.lexer.state.top=!1,$.items[o].tokens=this.lexer.blockTokens($.items[o].text,[]),!$.loose){const v=$.items[o].tokens.filter(k=>k.type==="space"),A=v.length>0&&v.some(k=>/\n.*\n/.test(k.raw));$.loose=A}if($.loose)for(o=0;o<m;o++)$.items[o].loose=!0;return $}}html(e){const n=this.rules.block.html.exec(e);if(n){const r={type:"html",raw:n[0],pre:!this.options.sanitizer&&(n[1]==="pre"||n[1]==="script"||n[1]==="style"),text:n[0]};if(this.options.sanitize){const s=this.options.sanitizer?this.options.sanitizer(n[0]):Oe(n[0]);r.type="paragraph",r.text=s,r.tokens=this.lexer.inline(s)}return r}}def(e){const n=this.rules.block.def.exec(e);if(n){const r=n[1].toLowerCase().replace(/\s+/g," "),s=n[2]?n[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",i=n[3]?n[3].substring(1,n[3].length-1).replace(this.rules.inline._escapes,"$1"):n[3];return{type:"def",tag:r,raw:n[0],href:s,title:i}}}table(e){const n=this.rules.block.table.exec(e);if(n){const r={type:"table",header:Du(n[1]).map(s=>({text:s})),align:n[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:n[3]&&n[3].trim()?n[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(r.header.length===r.align.length){r.raw=n[0];let s=r.align.length,i,u,o,a;for(i=0;i<s;i++)/^ *-+: *$/.test(r.align[i])?r.align[i]="right":/^ *:-+: *$/.test(r.align[i])?r.align[i]="center":/^ *:-+ *$/.test(r.align[i])?r.align[i]="left":r.align[i]=null;for(s=r.rows.length,i=0;i<s;i++)r.rows[i]=Du(r.rows[i],r.header.length).map(l=>({text:l}));for(s=r.header.length,u=0;u<s;u++)r.header[u].tokens=this.lexer.inline(r.header[u].text);for(s=r.rows.length,u=0;u<s;u++)for(a=r.rows[u],o=0;o<a.length;o++)a[o].tokens=this.lexer.inline(a[o].text);return r}}}lheading(e){const n=this.rules.block.lheading.exec(e);if(n)return{type:"heading",raw:n[0],depth:n[2].charAt(0)==="="?1:2,text:n[1],tokens:this.lexer.inline(n[1])}}paragraph(e){const n=this.rules.block.paragraph.exec(e);if(n){const r=n[1].charAt(n[1].length-1)===`
`?n[1].slice(0,-1):n[1];return{type:"paragraph",raw:n[0],text:r,tokens:this.lexer.inline(r)}}}text(e){const n=this.rules.block.text.exec(e);if(n)return{type:"text",raw:n[0],text:n[0],tokens:this.lexer.inline(n[0])}}escape(e){const n=this.rules.inline.escape.exec(e);if(n)return{type:"escape",raw:n[0],text:Oe(n[1])}}tag(e){const n=this.rules.inline.tag.exec(e);if(n)return!this.lexer.state.inLink&&/^<a /i.test(n[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(n[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(n[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(n[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:n[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(n[0]):Oe(n[0]):n[0]}}link(e){const n=this.rules.inline.link.exec(e);if(n){const r=n[2].trim();if(!this.options.pedantic&&/^</.test(r)){if(!/>$/.test(r))return;const u=Ar(r.slice(0,-1),"\\");if((r.length-u.length)%2===0)return}else{const u=U0(n[2],"()");if(u>-1){const a=(n[0].indexOf("!")===0?5:4)+n[1].length+u;n[2]=n[2].substring(0,u),n[0]=n[0].substring(0,a).trim(),n[3]=""}}let s=n[2],i="";if(this.options.pedantic){const u=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(s);u&&(s=u[1],i=u[3])}else i=n[3]?n[3].slice(1,-1):"";return s=s.trim(),/^</.test(s)&&(this.options.pedantic&&!/>$/.test(r)?s=s.slice(1):s=s.slice(1,-1)),gu(n,{href:s&&s.replace(this.rules.inline._escapes,"$1"),title:i&&i.replace(this.rules.inline._escapes,"$1")},n[0],this.lexer)}}reflink(e,n){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){let s=(r[2]||r[1]).replace(/\s+/g," ");if(s=n[s.toLowerCase()],!s){const i=r[0].charAt(0);return{type:"text",raw:i,text:i}}return gu(r,s,r[0],this.lexer)}}emStrong(e,n,r=""){let s=this.rules.inline.emStrong.lDelim.exec(e);if(!s||s[3]&&r.match(/[\p{L}\p{N}]/u))return;const i=s[1]||s[2]||"";if(!i||i&&(r===""||this.rules.inline.punctuation.exec(r))){const u=s[0].length-1;let o,a,l=u,c=0;const h=s[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(h.lastIndex=0,n=n.slice(-1*e.length+u);(s=h.exec(n))!=null;){if(o=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!o)continue;if(a=o.length,s[3]||s[4]){l+=a;continue}else if((s[5]||s[6])&&u%3&&!((u+a)%3)){c+=a;continue}if(l-=a,l>0)continue;a=Math.min(a,a+l+c);const f=e.slice(0,u+s.index+(s[0].length-o.length)+a);if(Math.min(u,a)%2){const p=f.slice(1,-1);return{type:"em",raw:f,text:p,tokens:this.lexer.inlineTokens(p)}}const d=f.slice(2,-2);return{type:"strong",raw:f,text:d,tokens:this.lexer.inlineTokens(d)}}}}codespan(e){const n=this.rules.inline.code.exec(e);if(n){let r=n[2].replace(/\n/g," ");const s=/[^ ]/.test(r),i=/^ /.test(r)&&/ $/.test(r);return s&&i&&(r=r.substring(1,r.length-1)),r=Oe(r,!0),{type:"codespan",raw:n[0],text:r}}}br(e){const n=this.rules.inline.br.exec(e);if(n)return{type:"br",raw:n[0]}}del(e){const n=this.rules.inline.del.exec(e);if(n)return{type:"del",raw:n[0],text:n[2],tokens:this.lexer.inlineTokens(n[2])}}autolink(e,n){const r=this.rules.inline.autolink.exec(e);if(r){let s,i;return r[2]==="@"?(s=Oe(this.options.mangle?n(r[1]):r[1]),i="mailto:"+s):(s=Oe(r[1]),i=s),{type:"link",raw:r[0],text:s,href:i,tokens:[{type:"text",raw:s,text:s}]}}}url(e,n){let r;if(r=this.rules.inline.url.exec(e)){let s,i;if(r[2]==="@")s=Oe(this.options.mangle?n(r[0]):r[0]),i="mailto:"+s;else{let u;do u=r[0],r[0]=this.rules.inline._backpedal.exec(r[0])[0];while(u!==r[0]);s=Oe(r[0]),r[1]==="www."?i="http://"+r[0]:i=r[0]}return{type:"link",raw:r[0],text:s,href:i,tokens:[{type:"text",raw:s,text:s}]}}}inlineText(e,n){const r=this.rules.inline.text.exec(e);if(r){let s;return this.lexer.state.inRawBlock?s=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):Oe(r[0]):r[0]:s=Oe(this.options.smartypants?n(r[0]):r[0]),{type:"text",raw:r[0],text:s}}}}const H={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:Sr,lheading:/^((?:.|\n(?!\n))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};H._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;H._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;H.def=pe(H.def).replace("label",H._label).replace("title",H._title).getRegex();H.bullet=/(?:[*+-]|\d{1,9}[.)])/;H.listItemStart=pe(/^( *)(bull) */).replace("bull",H.bullet).getRegex();H.list=pe(H.list).replace(/bull/g,H.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+H.def.source+")").getRegex();H._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";H._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;H.html=pe(H.html,"i").replace("comment",H._comment).replace("tag",H._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();H.paragraph=pe(H._paragraph).replace("hr",H.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",H._tag).getRegex();H.blockquote=pe(H.blockquote).replace("paragraph",H.paragraph).getRegex();H.normal=at({},H);H.gfm=at({},H.normal,{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"});H.gfm.table=pe(H.gfm.table).replace("hr",H.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",H._tag).getRegex();H.gfm.paragraph=pe(H._paragraph).replace("hr",H.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",H.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",H._tag).getRegex();H.pedantic=at({},H.normal,{html:pe(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",H._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Sr,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:pe(H.normal._paragraph).replace("hr",H.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",H.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});const O={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:Sr,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^(?:[^_*\\]|\\.)*?\_\_(?:[^_*\\]|\\.)*?\*(?:[^_*\\]|\\.)*?(?=\_\_)|(?:[^*\\]|\\.)+(?=[^*])|[punct_](\*+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|(?:[^punct*_\s\\]|\\.)(\*+)(?=[^punct*_\s])/,rDelimUnd:/^(?:[^_*\\]|\\.)*?\*\*(?:[^_*\\]|\\.)*?\_(?:[^_*\\]|\\.)*?(?=\*\*)|(?:[^_\\]|\\.)+(?=[^_])|[punct*](\_+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:Sr,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};O._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~";O.punctuation=pe(O.punctuation).replace(/punctuation/g,O._punctuation).getRegex();O.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;O.escapedEmSt=/(?:^|[^\\])(?:\\\\)*\\[*_]/g;O._comment=pe(H._comment).replace("(?:-->|$)","-->").getRegex();O.emStrong.lDelim=pe(O.emStrong.lDelim).replace(/punct/g,O._punctuation).getRegex();O.emStrong.rDelimAst=pe(O.emStrong.rDelimAst,"g").replace(/punct/g,O._punctuation).getRegex();O.emStrong.rDelimUnd=pe(O.emStrong.rDelimUnd,"g").replace(/punct/g,O._punctuation).getRegex();O._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;O._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;O._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;O.autolink=pe(O.autolink).replace("scheme",O._scheme).replace("email",O._email).getRegex();O._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;O.tag=pe(O.tag).replace("comment",O._comment).replace("attribute",O._attribute).getRegex();O._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;O._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;O._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;O.link=pe(O.link).replace("label",O._label).replace("href",O._href).replace("title",O._title).getRegex();O.reflink=pe(O.reflink).replace("label",O._label).replace("ref",H._label).getRegex();O.nolink=pe(O.nolink).replace("ref",H._label).getRegex();O.reflinkSearch=pe(O.reflinkSearch,"g").replace("reflink",O.reflink).replace("nolink",O.nolink).getRegex();O.normal=at({},O);O.pedantic=at({},O.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:pe(/^!?\[(label)\]\((.*?)\)/).replace("label",O._label).getRegex(),reflink:pe(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",O._label).getRegex()});O.gfm=at({},O.normal,{escape:pe(O.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/});O.gfm.url=pe(O.gfm.url,"i").replace("email",O.gfm._extended_email).getRegex();O.breaks=at({},O.gfm,{br:pe(O.br).replace("{2,}","*").getRegex(),text:pe(O.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});function H0(t){return t.replace(/---/g,"").replace(/--/g,"").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1").replace(/'/g,"").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1").replace(/"/g,"").replace(/\.{3}/g,"")}function wu(t){let e="",n,r;const s=t.length;for(n=0;n<s;n++)r=t.charCodeAt(n),Math.random()>.5&&(r="x"+r.toString(16)),e+="&#"+r+";";return e}class At{constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Rn,this.options.tokenizer=this.options.tokenizer||new qs,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const n={block:H.normal,inline:O.normal};this.options.pedantic?(n.block=H.pedantic,n.inline=O.pedantic):this.options.gfm&&(n.block=H.gfm,this.options.breaks?n.inline=O.breaks:n.inline=O.gfm),this.tokenizer.rules=n}static get rules(){return{block:H,inline:O}}static lex(e,n){return new At(n).lex(e)}static lexInline(e,n){return new At(n).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);let n;for(;n=this.inlineQueue.shift();)this.inlineTokens(n.src,n.tokens);return this.tokens}blockTokens(e,n=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(o,a,l)=>a+"    ".repeat(l.length));let r,s,i,u;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(o=>(r=o.call({lexer:this},e,n))?(e=e.substring(r.raw.length),n.push(r),!0):!1))){if(r=this.tokenizer.space(e)){e=e.substring(r.raw.length),r.raw.length===1&&n.length>0?n[n.length-1].raw+=`
`:n.push(r);continue}if(r=this.tokenizer.code(e)){e=e.substring(r.raw.length),s=n[n.length-1],s&&(s.type==="paragraph"||s.type==="text")?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue[this.inlineQueue.length-1].src=s.text):n.push(r);continue}if(r=this.tokenizer.fences(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.heading(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.hr(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.blockquote(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.list(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.html(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.def(e)){e=e.substring(r.raw.length),s=n[n.length-1],s&&(s.type==="paragraph"||s.type==="text")?(s.raw+=`
`+r.raw,s.text+=`
`+r.raw,this.inlineQueue[this.inlineQueue.length-1].src=s.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title});continue}if(r=this.tokenizer.table(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.lheading(e)){e=e.substring(r.raw.length),n.push(r);continue}if(i=e,this.options.extensions&&this.options.extensions.startBlock){let o=1/0;const a=e.slice(1);let l;this.options.extensions.startBlock.forEach(function(c){l=c.call({lexer:this},a),typeof l=="number"&&l>=0&&(o=Math.min(o,l))}),o<1/0&&o>=0&&(i=e.substring(0,o+1))}if(this.state.top&&(r=this.tokenizer.paragraph(i))){s=n[n.length-1],u&&s.type==="paragraph"?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):n.push(r),u=i.length!==e.length,e=e.substring(r.raw.length);continue}if(r=this.tokenizer.text(e)){e=e.substring(r.raw.length),s=n[n.length-1],s&&s.type==="text"?(s.raw+=`
`+r.raw,s.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):n.push(r);continue}if(e){const o="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){let r,s,i,u=e,o,a,l;if(this.tokens.links){const c=Object.keys(this.tokens.links);if(c.length>0)for(;(o=this.tokenizer.rules.inline.reflinkSearch.exec(u))!=null;)c.includes(o[0].slice(o[0].lastIndexOf("[")+1,-1))&&(u=u.slice(0,o.index)+"["+mu("a",o[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(o=this.tokenizer.rules.inline.blockSkip.exec(u))!=null;)u=u.slice(0,o.index)+"["+mu("a",o[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(o=this.tokenizer.rules.inline.escapedEmSt.exec(u))!=null;)u=u.slice(0,o.index+o[0].length-2)+"++"+u.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex),this.tokenizer.rules.inline.escapedEmSt.lastIndex--;for(;e;)if(a||(l=""),a=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(c=>(r=c.call({lexer:this},e,n))?(e=e.substring(r.raw.length),n.push(r),!0):!1))){if(r=this.tokenizer.escape(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.tag(e)){e=e.substring(r.raw.length),s=n[n.length-1],s&&r.type==="text"&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):n.push(r);continue}if(r=this.tokenizer.link(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(r.raw.length),s=n[n.length-1],s&&r.type==="text"&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):n.push(r);continue}if(r=this.tokenizer.emStrong(e,u,l)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.codespan(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.br(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.del(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.autolink(e,wu)){e=e.substring(r.raw.length),n.push(r);continue}if(!this.state.inLink&&(r=this.tokenizer.url(e,wu))){e=e.substring(r.raw.length),n.push(r);continue}if(i=e,this.options.extensions&&this.options.extensions.startInline){let c=1/0;const h=e.slice(1);let f;this.options.extensions.startInline.forEach(function(d){f=d.call({lexer:this},h),typeof f=="number"&&f>=0&&(c=Math.min(c,f))}),c<1/0&&c>=0&&(i=e.substring(0,c+1))}if(r=this.tokenizer.inlineText(i,H0)){e=e.substring(r.raw.length),r.raw.slice(-1)!=="_"&&(l=r.raw.slice(-1)),a=!0,s=n[n.length-1],s&&s.type==="text"?(s.raw+=r.raw,s.text+=r.text):n.push(r);continue}if(e){const c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return n}}class Ws{constructor(e){this.options=e||Rn}code(e,n,r){const s=(n||"").match(/\S*/)[0];if(this.options.highlight){const i=this.options.highlight(e,s);i!=null&&i!==e&&(r=!0,e=i)}return e=e.replace(/\n$/,"")+`
`,s?'<pre><code class="'+this.options.langPrefix+Oe(s)+'">'+(r?e:Oe(e,!0))+`</code></pre>
`:"<pre><code>"+(r?e:Oe(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e){return e}heading(e,n,r,s){if(this.options.headerIds){const i=this.options.headerPrefix+s.slug(r);return`<h${n} id="${i}">${e}</h${n}>
`}return`<h${n}>${e}</h${n}>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(e,n,r){const s=n?"ol":"ul",i=n&&r!==1?' start="'+r+'"':"";return"<"+s+i+`>
`+e+"</"+s+`>
`}listitem(e){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(e){return`<p>${e}</p>
`}table(e,n){return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+n+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,n){const r=n.header?"th":"td";return(n.align?`<${r} align="${n.align}">`:`<${r}>`)+e+`</${r}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(e){return`<del>${e}</del>`}link(e,n,r){if(e=pu(this.options.sanitize,this.options.baseUrl,e),e===null)return r;let s='<a href="'+e+'"';return n&&(s+=' title="'+n+'"'),s+=">"+r+"</a>",s}image(e,n,r){if(e=pu(this.options.sanitize,this.options.baseUrl,e),e===null)return r;let s=`<img src="${e}" alt="${r}"`;return n&&(s+=` title="${n}"`),s+=this.options.xhtml?"/>":">",s}text(e){return e}}class no{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,n,r){return""+r}image(e,n,r){return""+r}br(){return""}}class Vs{constructor(){this.seen={}}serialize(e){return e.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(e,n){let r=e,s=0;if(this.seen.hasOwnProperty(r)){s=this.seen[e];do s++,r=e+"-"+s;while(this.seen.hasOwnProperty(r))}return n||(this.seen[e]=s,this.seen[r]=0),r}slug(e,n={}){const r=this.serialize(e);return this.getNextSafeSlug(r,n.dryrun)}}class bt{constructor(e){this.options=e||Rn,this.options.renderer=this.options.renderer||new Ws,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new no,this.slugger=new Vs}static parse(e,n){return new bt(n).parse(e)}static parseInline(e,n){return new bt(n).parseInline(e)}parse(e,n=!0){let r="",s,i,u,o,a,l,c,h,f,d,p,D,g,$,S,m,v,A,k;const x=e.length;for(s=0;s<x;s++){if(d=e[s],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[d.type]&&(k=this.options.extensions.renderers[d.type].call({parser:this},d),k!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(d.type))){r+=k||"";continue}switch(d.type){case"space":continue;case"hr":{r+=this.renderer.hr();continue}case"heading":{r+=this.renderer.heading(this.parseInline(d.tokens),d.depth,eo(this.parseInline(d.tokens,this.textRenderer)),this.slugger);continue}case"code":{r+=this.renderer.code(d.text,d.lang,d.escaped);continue}case"table":{for(h="",c="",o=d.header.length,i=0;i<o;i++)c+=this.renderer.tablecell(this.parseInline(d.header[i].tokens),{header:!0,align:d.align[i]});for(h+=this.renderer.tablerow(c),f="",o=d.rows.length,i=0;i<o;i++){for(l=d.rows[i],c="",a=l.length,u=0;u<a;u++)c+=this.renderer.tablecell(this.parseInline(l[u].tokens),{header:!1,align:d.align[u]});f+=this.renderer.tablerow(c)}r+=this.renderer.table(h,f);continue}case"blockquote":{f=this.parse(d.tokens),r+=this.renderer.blockquote(f);continue}case"list":{for(p=d.ordered,D=d.start,g=d.loose,o=d.items.length,f="",i=0;i<o;i++)S=d.items[i],m=S.checked,v=S.task,$="",S.task&&(A=this.renderer.checkbox(m),g?S.tokens.length>0&&S.tokens[0].type==="paragraph"?(S.tokens[0].text=A+" "+S.tokens[0].text,S.tokens[0].tokens&&S.tokens[0].tokens.length>0&&S.tokens[0].tokens[0].type==="text"&&(S.tokens[0].tokens[0].text=A+" "+S.tokens[0].tokens[0].text)):S.tokens.unshift({type:"text",text:A}):$+=A),$+=this.parse(S.tokens,g),f+=this.renderer.listitem($,v,m);r+=this.renderer.list(f,p,D);continue}case"html":{r+=this.renderer.html(d.text);continue}case"paragraph":{r+=this.renderer.paragraph(this.parseInline(d.tokens));continue}case"text":{for(f=d.tokens?this.parseInline(d.tokens):d.text;s+1<x&&e[s+1].type==="text";)d=e[++s],f+=`
`+(d.tokens?this.parseInline(d.tokens):d.text);r+=n?this.renderer.paragraph(f):f;continue}default:{const C='Token with "'+d.type+'" type was not found.';if(this.options.silent){console.error(C);return}else throw new Error(C)}}}return r}parseInline(e,n){n=n||this.renderer;let r="",s,i,u;const o=e.length;for(s=0;s<o;s++){if(i=e[s],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[i.type]&&(u=this.options.extensions.renderers[i.type].call({parser:this},i),u!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type))){r+=u||"";continue}switch(i.type){case"escape":{r+=n.text(i.text);break}case"html":{r+=n.html(i.text);break}case"link":{r+=n.link(i.href,i.title,this.parseInline(i.tokens,n));break}case"image":{r+=n.image(i.href,i.title,i.text);break}case"strong":{r+=n.strong(this.parseInline(i.tokens,n));break}case"em":{r+=n.em(this.parseInline(i.tokens,n));break}case"codespan":{r+=n.codespan(i.text);break}case"br":{r+=n.br();break}case"del":{r+=n.del(this.parseInline(i.tokens,n));break}case"text":{r+=n.text(i.text);break}default:{const a='Token with "'+i.type+'" type was not found.';if(this.options.silent){console.error(a);return}else throw new Error(a)}}}return r}}function W(t,e,n){if(typeof t>"u"||t===null)throw new Error("marked(): input parameter is undefined or null");if(typeof t!="string")throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected");if(typeof e=="function"&&(n=e,e=null),e=at({},W.defaults,e||{}),to(e),n){const s=e.highlight;let i;try{i=At.lex(t,e)}catch(a){return n(a)}const u=function(a){let l;if(!a)try{e.walkTokens&&W.walkTokens(i,e.walkTokens),l=bt.parse(i,e)}catch(c){a=c}return e.highlight=s,a?n(a):n(null,l)};if(!s||s.length<3||(delete e.highlight,!i.length))return u();let o=0;W.walkTokens(i,function(a){a.type==="code"&&(o++,setTimeout(()=>{s(a.text,a.lang,function(l,c){if(l)return u(l);c!=null&&c!==a.text&&(a.text=c,a.escaped=!0),o--,o===0&&u()})},0))}),o===0&&u();return}function r(s){if(s.message+=`
Please report this to https://github.com/markedjs/marked.`,e.silent)return"<p>An error occurred:</p><pre>"+Oe(s.message+"",!0)+"</pre>";throw s}try{const s=At.lex(t,e);if(e.walkTokens){if(e.async)return Promise.all(W.walkTokens(s,e.walkTokens)).then(()=>bt.parse(s,e)).catch(r);W.walkTokens(s,e.walkTokens)}return bt.parse(s,e)}catch(s){r(s)}}W.options=W.setOptions=function(t){return at(W.defaults,t),B0(W.defaults),W};W.getDefaults=Xa;W.defaults=Rn;W.use=function(...t){const e=W.defaults.extensions||{renderers:{},childTokens:{}};t.forEach(n=>{const r=at({},n);if(r.async=W.defaults.async||r.async,n.extensions&&(n.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if(s.renderer){const i=e.renderers[s.name];i?e.renderers[s.name]=function(...u){let o=s.renderer.apply(this,u);return o===!1&&(o=i.apply(this,u)),o}:e.renderers[s.name]=s.renderer}if(s.tokenizer){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");e[s.level]?e[s.level].unshift(s.tokenizer):e[s.level]=[s.tokenizer],s.start&&(s.level==="block"?e.startBlock?e.startBlock.push(s.start):e.startBlock=[s.start]:s.level==="inline"&&(e.startInline?e.startInline.push(s.start):e.startInline=[s.start]))}s.childTokens&&(e.childTokens[s.name]=s.childTokens)}),r.extensions=e),n.renderer){const s=W.defaults.renderer||new Ws;for(const i in n.renderer){const u=s[i];s[i]=(...o)=>{let a=n.renderer[i].apply(s,o);return a===!1&&(a=u.apply(s,o)),a}}r.renderer=s}if(n.tokenizer){const s=W.defaults.tokenizer||new qs;for(const i in n.tokenizer){const u=s[i];s[i]=(...o)=>{let a=n.tokenizer[i].apply(s,o);return a===!1&&(a=u.apply(s,o)),a}}r.tokenizer=s}if(n.walkTokens){const s=W.defaults.walkTokens;r.walkTokens=function(i){let u=[];return u.push(n.walkTokens.call(this,i)),s&&(u=u.concat(s.call(this,i))),u}}W.setOptions(r)})};W.walkTokens=function(t,e){let n=[];for(const r of t)switch(n=n.concat(e.call(W,r)),r.type){case"table":{for(const s of r.header)n=n.concat(W.walkTokens(s.tokens,e));for(const s of r.rows)for(const i of s)n=n.concat(W.walkTokens(i.tokens,e));break}case"list":{n=n.concat(W.walkTokens(r.items,e));break}default:W.defaults.extensions&&W.defaults.extensions.childTokens&&W.defaults.extensions.childTokens[r.type]?W.defaults.extensions.childTokens[r.type].forEach(function(s){n=n.concat(W.walkTokens(r[s],e))}):r.tokens&&(n=n.concat(W.walkTokens(r.tokens,e)))}return n};W.parseInline=function(t,e){if(typeof t>"u"||t===null)throw new Error("marked.parseInline(): input parameter is undefined or null");if(typeof t!="string")throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected");e=at({},W.defaults,e||{}),to(e);try{const n=At.lexInline(t,e);return e.walkTokens&&W.walkTokens(n,e.walkTokens),bt.parseInline(n,e)}catch(n){if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,e.silent)return"<p>An error occurred:</p><pre>"+Oe(n.message+"",!0)+"</pre>";throw n}};W.Parser=bt;W.parser=bt.parse;W.Renderer=Ws;W.TextRenderer=no;W.Lexer=At;W.lexer=At.lex;W.Tokenizer=qs;W.Slugger=Vs;W.parse=W;W.options;W.setOptions;W.use;W.walkTokens;W.parseInline;bt.parse;At.lex;const ro={};function j0(t){let e;return{c(){e=ae(t[1])},m(n,r){b(n,e,r)},p(n,r){r&2&&Le(e,n[1])},i:R,o:R,d(n){n&&w(e)}}}function q0(t){let e,n;const r=t[5].default,s=be(r,t,t[4],null);return{c(){e=B("h6"),s&&s.c(),M(e,"id",t[2])},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,u){s&&s.p&&(!n||u&16)&&ye(s,r,i,i[4],n?Ae(r,i[4],u,null):Ce(i[4]),null),(!n||u&4)&&M(e,"id",i[2])},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function W0(t){let e,n;const r=t[5].default,s=be(r,t,t[4],null);return{c(){e=B("h5"),s&&s.c(),M(e,"id",t[2])},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,u){s&&s.p&&(!n||u&16)&&ye(s,r,i,i[4],n?Ae(r,i[4],u,null):Ce(i[4]),null),(!n||u&4)&&M(e,"id",i[2])},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function V0(t){let e,n;const r=t[5].default,s=be(r,t,t[4],null);return{c(){e=B("h4"),s&&s.c(),M(e,"id",t[2])},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,u){s&&s.p&&(!n||u&16)&&ye(s,r,i,i[4],n?Ae(r,i[4],u,null):Ce(i[4]),null),(!n||u&4)&&M(e,"id",i[2])},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function Q0(t){let e,n;const r=t[5].default,s=be(r,t,t[4],null);return{c(){e=B("h3"),s&&s.c(),M(e,"id",t[2])},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,u){s&&s.p&&(!n||u&16)&&ye(s,r,i,i[4],n?Ae(r,i[4],u,null):Ce(i[4]),null),(!n||u&4)&&M(e,"id",i[2])},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function K0(t){let e,n;const r=t[5].default,s=be(r,t,t[4],null);return{c(){e=B("h2"),s&&s.c(),M(e,"id",t[2])},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,u){s&&s.p&&(!n||u&16)&&ye(s,r,i,i[4],n?Ae(r,i[4],u,null):Ce(i[4]),null),(!n||u&4)&&M(e,"id",i[2])},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function G0(t){let e,n;const r=t[5].default,s=be(r,t,t[4],null);return{c(){e=B("h1"),s&&s.c(),M(e,"id",t[2])},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,u){s&&s.p&&(!n||u&16)&&ye(s,r,i,i[4],n?Ae(r,i[4],u,null):Ce(i[4]),null),(!n||u&4)&&M(e,"id",i[2])},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function Z0(t){let e,n,r,s;const i=[G0,K0,Q0,V0,W0,q0,j0],u=[];function o(a,l){return a[0]===1?0:a[0]===2?1:a[0]===3?2:a[0]===4?3:a[0]===5?4:a[0]===6?5:6}return e=o(t),n=u[e]=i[e](t),{c(){n.c(),r=oe()},m(a,l){u[e].m(a,l),b(a,r,l),s=!0},p(a,[l]){let c=e;e=o(a),e===c?u[e].p(a,l):(te(),E(u[c],1,1,()=>{u[c]=null}),ne(),n=u[e],n?n.p(a,l):(n=u[e]=i[e](a),n.c()),y(n,1),n.m(r.parentNode,r))},i(a){s||(y(n),s=!0)},o(a){E(n),s=!1},d(a){u[e].d(a),a&&w(r)}}}function X0(t,e,n){let r,{$$slots:s={},$$scope:i}=e,{depth:u}=e,{raw:o}=e,{text:a}=e;const{slug:l,getOptions:c}=mo(ro),h=c();return t.$$set=f=>{"depth"in f&&n(0,u=f.depth),"raw"in f&&n(1,o=f.raw),"text"in f&&n(3,a=f.text),"$$scope"in f&&n(4,i=f.$$scope)},t.$$.update=()=>{t.$$.dirty&8&&n(2,r=h.headerIds?h.headerPrefix+l(a):void 0)},[u,o,r,a,i,s]}class Y0 extends fe{constructor(e){super(),he(this,e,X0,Z0,ce,{depth:0,raw:1,text:3})}}function J0(t){let e,n;const r=t[1].default,s=be(r,t,t[0],null);return{c(){e=B("p"),s&&s.c()},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,[u]){s&&s.p&&(!n||u&1)&&ye(s,r,i,i[0],n?Ae(r,i[0],u,null):Ce(i[0]),null)},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function ed(t,e,n){let{$$slots:r={},$$scope:s}=e;return t.$$set=i=>{"$$scope"in i&&n(0,s=i.$$scope)},[s,r]}class td extends fe{constructor(e){super(),he(this,e,ed,J0,ce,{})}}function nd(t){let e;const n=t[3].default,r=be(n,t,t[2],null);return{c(){r&&r.c()},m(s,i){r&&r.m(s,i),e=!0},p(s,[i]){r&&r.p&&(!e||i&4)&&ye(r,n,s,s[2],e?Ae(n,s[2],i,null):Ce(s[2]),null)},i(s){e||(y(r,s),e=!0)},o(s){E(r,s),e=!1},d(s){r&&r.d(s)}}}function rd(t,e,n){let{$$slots:r={},$$scope:s}=e,{text:i}=e,{raw:u}=e;return t.$$set=o=>{"text"in o&&n(0,i=o.text),"raw"in o&&n(1,u=o.raw),"$$scope"in o&&n(2,s=o.$$scope)},[i,u,s,r]}class sd extends fe{constructor(e){super(),he(this,e,rd,nd,ce,{text:0,raw:1})}}function id(t){let e,n;return{c(){e=B("img"),Ut(e.src,n=t[0])||M(e,"src",n),M(e,"title",t[1]),M(e,"alt",t[2])},m(r,s){b(r,e,s)},p(r,[s]){s&1&&!Ut(e.src,n=r[0])&&M(e,"src",n),s&2&&M(e,"title",r[1]),s&4&&M(e,"alt",r[2])},i:R,o:R,d(r){r&&w(e)}}}function ud(t,e,n){let{href:r=""}=e,{title:s=void 0}=e,{text:i=""}=e;return t.$$set=u=>{"href"in u&&n(0,r=u.href),"title"in u&&n(1,s=u.title),"text"in u&&n(2,i=u.text)},[r,s,i]}class ad extends fe{constructor(e){super(),he(this,e,ud,id,ce,{href:0,title:1,text:2})}}function od(t){let e,n;const r=t[3].default,s=be(r,t,t[2],null);return{c(){e=B("a"),s&&s.c(),M(e,"href",t[0]),M(e,"title",t[1])},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,[u]){s&&s.p&&(!n||u&4)&&ye(s,r,i,i[2],n?Ae(r,i[2],u,null):Ce(i[2]),null),(!n||u&1)&&M(e,"href",i[0]),(!n||u&2)&&M(e,"title",i[1])},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function ld(t,e,n){let{$$slots:r={},$$scope:s}=e,{href:i=""}=e,{title:u=void 0}=e;return t.$$set=o=>{"href"in o&&n(0,i=o.href),"title"in o&&n(1,u=o.title),"$$scope"in o&&n(2,s=o.$$scope)},[i,u,s,r]}class cd extends fe{constructor(e){super(),he(this,e,ld,od,ce,{href:0,title:1})}}function hd(t){let e,n;const r=t[1].default,s=be(r,t,t[0],null);return{c(){e=B("em"),s&&s.c()},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,[u]){s&&s.p&&(!n||u&1)&&ye(s,r,i,i[0],n?Ae(r,i[0],u,null):Ce(i[0]),null)},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function fd(t,e,n){let{$$slots:r={},$$scope:s}=e;return t.$$set=i=>{"$$scope"in i&&n(0,s=i.$$scope)},[s,r]}class dd extends fe{constructor(e){super(),he(this,e,fd,hd,ce,{})}}function pd(t){let e,n;const r=t[1].default,s=be(r,t,t[0],null);return{c(){e=B("del"),s&&s.c()},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,[u]){s&&s.p&&(!n||u&1)&&ye(s,r,i,i[0],n?Ae(r,i[0],u,null):Ce(i[0]),null)},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function Dd(t,e,n){let{$$slots:r={},$$scope:s}=e;return t.$$set=i=>{"$$scope"in i&&n(0,s=i.$$scope)},[s,r]}class md extends fe{constructor(e){super(),he(this,e,Dd,pd,ce,{})}}function gd(t){let e,n=t[0].replace(/`/g,"")+"",r;return{c(){e=B("code"),r=ae(n)},m(s,i){b(s,e,i),L(e,r)},p(s,[i]){i&1&&n!==(n=s[0].replace(/`/g,"")+"")&&Le(r,n)},i:R,o:R,d(s){s&&w(e)}}}function wd(t,e,n){let{raw:r}=e;return t.$$set=s=>{"raw"in s&&n(0,r=s.raw)},[r]}class bd extends fe{constructor(e){super(),he(this,e,wd,gd,ce,{raw:0})}}function Ad(t){let e,n;const r=t[1].default,s=be(r,t,t[0],null);return{c(){e=B("strong"),s&&s.c()},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,[u]){s&&s.p&&(!n||u&1)&&ye(s,r,i,i[0],n?Ae(r,i[0],u,null):Ce(i[0]),null)},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function yd(t,e,n){let{$$slots:r={},$$scope:s}=e;return t.$$set=i=>{"$$scope"in i&&n(0,s=i.$$scope)},[s,r]}class Cd extends fe{constructor(e){super(),he(this,e,yd,Ad,ce,{})}}function Ed(t){let e,n;const r=t[1].default,s=be(r,t,t[0],null);return{c(){e=B("table"),s&&s.c()},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,[u]){s&&s.p&&(!n||u&1)&&ye(s,r,i,i[0],n?Ae(r,i[0],u,null):Ce(i[0]),null)},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function _d(t,e,n){let{$$slots:r={},$$scope:s}=e;return t.$$set=i=>{"$$scope"in i&&n(0,s=i.$$scope)},[s,r]}class Fd extends fe{constructor(e){super(),he(this,e,_d,Ed,ce,{})}}function kd(t){let e,n;const r=t[1].default,s=be(r,t,t[0],null);return{c(){e=B("thead"),s&&s.c()},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,[u]){s&&s.p&&(!n||u&1)&&ye(s,r,i,i[0],n?Ae(r,i[0],u,null):Ce(i[0]),null)},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function vd(t,e,n){let{$$slots:r={},$$scope:s}=e;return t.$$set=i=>{"$$scope"in i&&n(0,s=i.$$scope)},[s,r]}class Bd extends fe{constructor(e){super(),he(this,e,vd,kd,ce,{})}}function xd(t){let e,n;const r=t[1].default,s=be(r,t,t[0],null);return{c(){e=B("tbody"),s&&s.c()},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,[u]){s&&s.p&&(!n||u&1)&&ye(s,r,i,i[0],n?Ae(r,i[0],u,null):Ce(i[0]),null)},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function Sd(t,e,n){let{$$slots:r={},$$scope:s}=e;return t.$$set=i=>{"$$scope"in i&&n(0,s=i.$$scope)},[s,r]}class $d extends fe{constructor(e){super(),he(this,e,Sd,xd,ce,{})}}function Id(t){let e,n;const r=t[1].default,s=be(r,t,t[0],null);return{c(){e=B("tr"),s&&s.c()},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,[u]){s&&s.p&&(!n||u&1)&&ye(s,r,i,i[0],n?Ae(r,i[0],u,null):Ce(i[0]),null)},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function Td(t,e,n){let{$$slots:r={},$$scope:s}=e;return t.$$set=i=>{"$$scope"in i&&n(0,s=i.$$scope)},[s,r]}class Rd extends fe{constructor(e){super(),he(this,e,Td,Id,ce,{})}}function Pd(t){let e,n;const r=t[3].default,s=be(r,t,t[2],null);return{c(){e=B("td"),s&&s.c(),M(e,"align",t[1])},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,u){s&&s.p&&(!n||u&4)&&ye(s,r,i,i[2],n?Ae(r,i[2],u,null):Ce(i[2]),null),(!n||u&2)&&M(e,"align",i[1])},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function Md(t){let e,n;const r=t[3].default,s=be(r,t,t[2],null);return{c(){e=B("th"),s&&s.c(),M(e,"align",t[1])},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,u){s&&s.p&&(!n||u&4)&&ye(s,r,i,i[2],n?Ae(r,i[2],u,null):Ce(i[2]),null),(!n||u&2)&&M(e,"align",i[1])},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function Od(t){let e,n,r,s;const i=[Md,Pd],u=[];function o(a,l){return a[0]?0:1}return e=o(t),n=u[e]=i[e](t),{c(){n.c(),r=oe()},m(a,l){u[e].m(a,l),b(a,r,l),s=!0},p(a,[l]){let c=e;e=o(a),e===c?u[e].p(a,l):(te(),E(u[c],1,1,()=>{u[c]=null}),ne(),n=u[e],n?n.p(a,l):(n=u[e]=i[e](a),n.c()),y(n,1),n.m(r.parentNode,r))},i(a){s||(y(n),s=!0)},o(a){E(n),s=!1},d(a){u[e].d(a),a&&w(r)}}}function Nd(t,e,n){let{$$slots:r={},$$scope:s}=e,{header:i}=e,{align:u}=e;return t.$$set=o=>{"header"in o&&n(0,i=o.header),"align"in o&&n(1,u=o.align),"$$scope"in o&&n(2,s=o.$$scope)},[i,u,s,r]}class Ld extends fe{constructor(e){super(),he(this,e,Nd,Od,ce,{header:0,align:1})}}function Ud(t){let e,n;const r=t[3].default,s=be(r,t,t[2],null);return{c(){e=B("ul"),s&&s.c()},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,u){s&&s.p&&(!n||u&4)&&ye(s,r,i,i[2],n?Ae(r,i[2],u,null):Ce(i[2]),null)},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function zd(t){let e,n;const r=t[3].default,s=be(r,t,t[2],null);return{c(){e=B("ol"),s&&s.c(),M(e,"start",t[1])},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,u){s&&s.p&&(!n||u&4)&&ye(s,r,i,i[2],n?Ae(r,i[2],u,null):Ce(i[2]),null),(!n||u&2)&&M(e,"start",i[1])},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function Hd(t){let e,n,r,s;const i=[zd,Ud],u=[];function o(a,l){return a[0]?0:1}return e=o(t),n=u[e]=i[e](t),{c(){n.c(),r=oe()},m(a,l){u[e].m(a,l),b(a,r,l),s=!0},p(a,[l]){let c=e;e=o(a),e===c?u[e].p(a,l):(te(),E(u[c],1,1,()=>{u[c]=null}),ne(),n=u[e],n?n.p(a,l):(n=u[e]=i[e](a),n.c()),y(n,1),n.m(r.parentNode,r))},i(a){s||(y(n),s=!0)},o(a){E(n),s=!1},d(a){u[e].d(a),a&&w(r)}}}function jd(t,e,n){let{$$slots:r={},$$scope:s}=e,{ordered:i}=e,{start:u}=e;return t.$$set=o=>{"ordered"in o&&n(0,i=o.ordered),"start"in o&&n(1,u=o.start),"$$scope"in o&&n(2,s=o.$$scope)},[i,u,s,r]}class qd extends fe{constructor(e){super(),he(this,e,jd,Hd,ce,{ordered:0,start:1})}}function Wd(t){let e,n;const r=t[1].default,s=be(r,t,t[0],null);return{c(){e=B("li"),s&&s.c()},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,[u]){s&&s.p&&(!n||u&1)&&ye(s,r,i,i[0],n?Ae(r,i[0],u,null):Ce(i[0]),null)},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function Vd(t,e,n){let{$$slots:r={},$$scope:s}=e;return t.$$set=i=>{"$$scope"in i&&n(0,s=i.$$scope)},[s,r]}class Qd extends fe{constructor(e){super(),he(this,e,Vd,Wd,ce,{})}}function Kd(t){let e;return{c(){e=B("hr")},m(n,r){b(n,e,r)},p:R,i:R,o:R,d(n){n&&w(e)}}}class Gd extends fe{constructor(e){super(),he(this,e,null,Kd,ce,{})}}function Zd(t){let e,n;return{c(){e=new po(!1),n=oe(),e.a=n},m(r,s){e.m(t[0],r,s),b(r,n,s)},p(r,[s]){s&1&&e.p(r[0])},i:R,o:R,d(r){r&&w(n),r&&e.d()}}}function Xd(t,e,n){let{text:r}=e;return t.$$set=s=>{"text"in s&&n(0,r=s.text)},[r]}class Yd extends fe{constructor(e){super(),he(this,e,Xd,Zd,ce,{text:0})}}function Jd(t){let e,n;const r=t[1].default,s=be(r,t,t[0],null);return{c(){e=B("blockquote"),s&&s.c()},m(i,u){b(i,e,u),s&&s.m(e,null),n=!0},p(i,[u]){s&&s.p&&(!n||u&1)&&ye(s,r,i,i[0],n?Ae(r,i[0],u,null):Ce(i[0]),null)},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function ep(t,e,n){let{$$slots:r={},$$scope:s}=e;return t.$$set=i=>{"$$scope"in i&&n(0,s=i.$$scope)},[s,r]}class tp extends fe{constructor(e){super(),he(this,e,ep,Jd,ce,{})}}function np(t){let e,n,r;return{c(){e=B("pre"),n=B("code"),r=ae(t[1]),M(e,"class",t[0])},m(s,i){b(s,e,i),L(e,n),L(n,r)},p(s,[i]){i&2&&Le(r,s[1]),i&1&&M(e,"class",s[0])},i:R,o:R,d(s){s&&w(e)}}}function rp(t,e,n){let{lang:r}=e,{text:s}=e;return t.$$set=i=>{"lang"in i&&n(0,r=i.lang),"text"in i&&n(1,s=i.text)},[r,s]}class sp extends fe{constructor(e){super(),he(this,e,rp,np,ce,{lang:0,text:1})}}function ip(t){let e,n;const r=t[1].default,s=be(r,t,t[0],null);return{c(){e=B("br"),s&&s.c()},m(i,u){b(i,e,u),s&&s.m(i,u),n=!0},p(i,[u]){s&&s.p&&(!n||u&1)&&ye(s,r,i,i[0],n?Ae(r,i[0],u,null):Ce(i[0]),null)},i(i){n||(y(s,i),n=!0)},o(i){E(s,i),n=!1},d(i){i&&w(e),s&&s.d(i)}}}function up(t,e,n){let{$$slots:r={},$$scope:s}=e;return t.$$set=i=>{"$$scope"in i&&n(0,s=i.$$scope)},[s,r]}class ap extends fe{constructor(e){super(),he(this,e,up,ip,ce,{})}}const op={heading:Y0,paragraph:td,text:sd,image:ad,link:cd,em:dd,strong:Cd,codespan:bd,del:md,table:Fd,tablehead:Bd,tablebody:$d,tablerow:Rd,tablecell:Ld,list:qd,orderedlistitem:null,unorderedlistitem:null,listitem:Qd,hr:Gd,html:Yd,blockquote:tp,code:sp,br:ap},lp={baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,xhtml:!1};function cp(t){let e,n;return e=new cn({props:{tokens:t[0],renderers:t[1]}}),{c(){ee(e.$$.fragment)},m(r,s){Y(e,r,s),n=!0},p(r,[s]){const i={};s&1&&(i.tokens=r[0]),s&2&&(i.renderers=r[1]),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){J(e,r)}}}function hp(t,e,n){let r,s,i,u,{source:o=[]}=e,{renderers:a={}}=e,{options:l={}}=e,{isInline:c=!1}=e;const h=xu();let f,d,p;return Do(ro,{slug:D=>s?s.slug(D):"",getOptions:()=>i}),Ir(()=>{n(7,p=!0)}),t.$$set=D=>{"source"in D&&n(2,o=D.source),"renderers"in D&&n(3,a=D.renderers),"options"in D&&n(4,l=D.options),"isInline"in D&&n(5,c=D.isInline)},t.$$.update=()=>{t.$$.dirty&4&&n(8,r=Array.isArray(o)),t.$$.dirty&4&&(s=o?new Vs:void 0),t.$$.dirty&16&&n(9,i={...lp,...l}),t.$$.dirty&869&&(r?n(0,f=o):(n(6,d=new At(i)),n(0,f=c?d.inlineTokens(o):d.lex(o)),h("parsed",{tokens:f}))),t.$$.dirty&8&&n(1,u={...op,...a}),t.$$.dirty&385&&p&&!r&&h("parsed",{tokens:f})},[f,u,o,a,l,c,d,p,r,i]}class fp extends fe{constructor(e){super(),he(this,e,hp,cp,ce,{source:2,renderers:3,options:4,isInline:5})}}function bu(t){let e,n,r=t[0].path.split(".")[t[0].path.split(".").length-1]+"",s,i,u,o,a=t[0].attachmentSize/1e3+"",l,c,h,f,d,p,D,g;function $(A,k){return A[2]?dp:pp}let S=$(t),m=S(t),v={ctx:t,current:null,token:null,hasCatch:!1,pending:vp,then:wp,catch:gp,value:16,blocks:[,,,]};return Xn(D=t[1],v),{c(){e=B("p"),n=ae("Attachment type: "),s=ae(r),i=X(),u=B("br"),o=ae(`
    Attachment size: `),l=ae(a),c=ae(" kb"),h=X(),f=B("p"),m.c(),d=X(),p=oe(),v.block.c()},m(A,k){b(A,e,k),L(e,n),L(e,s),L(e,i),L(e,u),L(e,o),L(e,l),L(e,c),b(A,h,k),b(A,f,k),m.m(f,null),b(A,d,k),b(A,p,k),v.block.m(A,v.anchor=k),v.mount=()=>p.parentNode,v.anchor=p,g=!0},p(A,k){t=A,(!g||k&1)&&r!==(r=t[0].path.split(".")[t[0].path.split(".").length-1]+"")&&Le(s,r),(!g||k&1)&&a!==(a=t[0].attachmentSize/1e3+"")&&Le(l,a),S===(S=$(t))&&m?m.p(t,k):(m.d(1),m=S(t),m&&(m.c(),m.m(f,null))),v.ctx=t,k&2&&D!==(D=t[1])&&Xn(D,v)||xs(v,t,k)},i(A){g||(y(v.block),g=!0)},o(A){for(let k=0;k<3;k+=1){const x=v.blocks[k];E(x)}g=!1},d(A){A&&w(e),A&&w(h),A&&w(f),m.d(),A&&w(d),A&&w(p),v.block.d(A),v.token=null,v=null}}}function dp(t){let e,n,r;function s(o,a){return o[3]?Dp:mp}let i=s(t),u=i(t);return{c(){e=B("button"),u.c()},m(o,a){b(o,e,a),u.m(e,null),n||(r=xe(e,"click",t[9]),n=!0)},p(o,a){i!==(i=s(o))&&(u.d(1),u=i(o),u&&(u.c(),u.m(e,null)))},d(o){o&&w(e),u.d(),n=!1,r()}}}function pp(t){let e,n,r;return{c(){e=B("button"),e.textContent="Get attachment"},m(s,i){b(s,e,i),n||(r=xe(e,"click",function(){$r(t[6](t[0]))&&t[6](t[0]).apply(this,arguments)}),n=!0)},p(s,i){t=s},d(s){s&&w(e),n=!1,r()}}}function Dp(t){let e;return{c(){e=ae("Show attachment")},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function mp(t){let e;return{c(){e=ae("Hide attachment")},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function gp(t){return{c:R,m:R,p:R,i:R,o:R,d:R}}function wp(t){let e,n,r,s;const i=[Ap,bp],u=[];function o(a,l){return a[3]?1:0}return e=o(t),n=u[e]=i[e](t),{c(){n.c(),r=oe()},m(a,l){u[e].m(a,l),b(a,r,l),s=!0},p(a,l){let c=e;e=o(a),e===c?u[e].p(a,l):(te(),E(u[c],1,1,()=>{u[c]=null}),ne(),n=u[e],n?n.p(a,l):(n=u[e]=i[e](a),n.c()),y(n,1),n.m(r.parentNode,r))},i(a){s||(y(n),s=!0)},o(a){E(n),s=!1},d(a){u[e].d(a),a&&w(r)}}}function bp(t){let e,n,r;return{c(){e=B("img"),M(e,"class","dnone svelte-1qahnoq"),Ut(e.src,n=t[16])||M(e,"src",n),M(e,"alt",r=t[0].text)},m(s,i){b(s,e,i)},p(s,i){i&2&&!Ut(e.src,n=s[16])&&M(e,"src",n),i&1&&r!==(r=s[0].text)&&M(e,"alt",r)},i:R,o:R,d(s){s&&w(e)}}}function Ap(t){let e,n,r,s,i,u,o,a;const l=[kp,Fp,_p,Ep,Cp,yp],c=[];function h(f,d){return f[4]==="image"?0:f[4]==="text"?1:f[4]==="audio"?2:f[4]==="markdown"?3:f[4]==="pdf"?4:5}return e=h(t),n=c[e]=l[e](t),{c(){n.c(),r=X(),s=B("p"),i=B("button"),i.textContent="Download attachment"},m(f,d){c[e].m(f,d),b(f,r,d),b(f,s,d),L(s,i),u=!0,o||(a=xe(i,"click",t[10]),o=!0)},p(f,d){let p=e;e=h(f),e===p?c[e].p(f,d):(te(),E(c[p],1,1,()=>{c[p]=null}),ne(),n=c[e],n?n.p(f,d):(n=c[e]=l[e](f),n.c()),y(n,1),n.m(r.parentNode,r))},i(f){u||(y(n),u=!0)},o(f){E(n),u=!1},d(f){c[e].d(f),f&&w(r),f&&w(s),o=!1,a()}}}function yp(t){let e;return{c(){e=B("p"),e.textContent="This file is not supported."},m(n,r){b(n,e,r)},p:R,i:R,o:R,d(n){n&&w(e)}}}function Cp(t){let e;return{c(){e=B("p"),e.textContent="Pdf preview to come"},m(n,r){b(n,e,r)},p:R,i:R,o:R,d(n){n&&w(e)}}}function Ep(t){let e,n,r;return n=new fp({props:{source:t[16]}}),{c(){e=B("div"),ee(n.$$.fragment),M(e,"class","markdown svelte-1qahnoq")},m(s,i){b(s,e,i),Y(n,e,null),r=!0},p(s,i){const u={};i&2&&(u.source=s[16]),n.$set(u)},i(s){r||(y(n.$$.fragment,s),r=!0)},o(s){E(n.$$.fragment,s),r=!1},d(s){s&&w(e),J(n)}}}function _p(t){let e,n;return{c(){e=B("audio"),Ut(e.src,n=t[16])||M(e,"src",n),e.controls=!0,M(e,"class","svelte-1qahnoq")},m(r,s){b(r,e,s)},p(r,s){s&2&&!Ut(e.src,n=r[16])&&M(e,"src",n)},i:R,o:R,d(r){r&&w(e)}}}function Fp(t){let e,n=t[16]+"",r;return{c(){e=B("p"),r=ae(n)},m(s,i){b(s,e,i),L(e,r)},p(s,i){i&2&&n!==(n=s[16]+"")&&Le(r,n)},i:R,o:R,d(s){s&&w(e)}}}function kp(t){let e,n,r;return{c(){e=B("img"),Ut(e.src,n=t[16])||M(e,"src",n),M(e,"alt",r=t[0].text),M(e,"class","svelte-1qahnoq")},m(s,i){b(s,e,i)},p(s,i){i&2&&!Ut(e.src,n=s[16])&&M(e,"src",n),i&1&&r!==(r=s[0].text)&&M(e,"alt",r)},i:R,o:R,d(s){s&&w(e)}}}function vp(t){let e;return{c(){e=ae("Loading attachment...")},m(n,r){b(n,e,r)},p:R,i:R,o:R,d(n){n&&w(e)}}}function Bp(t){let e,n=t[5]?"":"",r,s,i,u,o,a,l=t[5]&&bu(t);return{c(){e=B("button"),r=ae(n),s=X(),l&&l.c(),i=oe()},m(c,h){b(c,e,h),L(e,r),b(c,s,h),l&&l.m(c,h),b(c,i,h),u=!0,o||(a=xe(e,"click",t[8]),o=!0)},p(c,[h]){(!u||h&32)&&n!==(n=c[5]?"":"")&&Le(r,n),c[5]?l?(l.p(c,h),h&32&&y(l,1)):(l=bu(c),l.c(),y(l,1),l.m(i.parentNode,i)):l&&(te(),E(l,1,1,()=>{l=null}),ne())},i(c){u||(y(l),u=!0)},o(c){E(l),u=!1},d(c){c&&w(e),c&&w(s),l&&l.d(c),c&&w(i),o=!1,a()}}}function xp(t){btoa(Array(t.length).fill("").map((e,n)=>String.fromCharCode(t[n])).join(""))}function Sp(t,e,n){let r;Nt(t,lr,m=>n(13,r=m));let{doc:s}=e,i,u,o=!1,a=!0,l,c,h=s.path.split(".")[s.path.split(".").length-1],f=!1;async function d(m){const v=await r.replica.getAttachment(m);if(v!==void 0){console.log("fileExtension",h);const x=await v.bytes();console.log("docdata",x);let C=new Uint8Array(x.length);for(var A=0;A<x.length;A++)C[A]=x[A];if(console.log("bytes ",C),h==="docx")n(4,l="docx"),n(4,l),i=new Blob([C],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});else if(h==="mp3")n(4,l="audio"),c="audio/"+h,n(4,l),console.log(l+c),i=URL.createObjectURL(new Blob([C],{type:c}));else if(h==="md")n(4,l="markdown"),n(4,l),i=String.fromCharCode(...C);else if(h==="pdf")n(4,l="pdf"),i=xp(C);else if(h==="txt"){n(4,l="text"),n(4,l),console.log(l);var k=new TextDecoder("utf-8");i=k.decode(Uint8Array.from(C)),console.log("Bytes to string: ",i)}else h==="png"&&(n(4,l="image"),c="image/"+h,n(4,l),console.log(l),i=URL.createObjectURL(new Blob([C],{type:c})));return i}}function p(m){n(1,u=d(m)),n(2,o=!0),n(3,a=!1)}function D(){let m=document.createElement("a");console.log(i+"attachmentBytes"),i.split(":")[0]!=="blob"&&(console.log("attachmentBytes is a string"),i=URL.createObjectURL(new Blob([i])),console.log("attachmentBytes is now a blob")),console.log("type of attachmentBytes",typeof i);let v=i,A=s.path.split("/")[s.path.split("/").length-1];console.log("type of file",typeof v),m.href=v,m.download=A.slice(1),m.style.display="none",document.body.appendChild(m),m.click()}const g=()=>n(5,f=!f),$=()=>n(3,a=!a),S=()=>D();return t.$$set=m=>{"doc"in m&&n(0,s=m.doc)},t.$$.update=()=>{t.$$.dirty&1&&console.log(s.path.split(".")[s.path.split(".").length-1])},[s,u,o,a,l,f,p,D,g,$,S]}class $p extends fe{constructor(e){super(),he(this,e,Sp,Bp,ce,{doc:0})}}function Au(t,e,n){const r=t.slice();return r[5]=e[n],r[7]=n,r}function Ip(t){let e,n,r,s={ctx:t,current:null,token:null,hasCatch:!1,pending:Mp,then:Pp,catch:Rp,value:0,blocks:[,,,]};return Xn(n=t[0],s),{c(){e=oe(),s.block.c()},m(i,u){b(i,e,u),s.block.m(i,s.anchor=u),s.mount=()=>e.parentNode,s.anchor=e,r=!0},p(i,u){t=i,s.ctx=t,u&1&&n!==(n=t[0])&&Xn(n,s)||xs(s,t,u)},i(i){r||(y(s.block),r=!0)},o(i){for(let u=0;u<3;u+=1){const o=s.blocks[u];E(o)}r=!1},d(i){i&&w(e),s.block.d(i),s.token=null,s=null}}}function Tp(t){let e;return{c(){e=B("li"),e.textContent="No files yet",M(e,"class","svelte-8z70ok")},m(n,r){b(n,e,r)},p:R,i:R,o:R,d(n){n&&w(e)}}}function Rp(t){return{c:R,m:R,p:R,i:R,o:R,d:R}}function Pp(t){let e,n,r=t[0],s=[];for(let u=0;u<r.length;u+=1)s[u]=yu(Au(t,r,u));const i=u=>E(s[u],1,1,()=>{s[u]=null});return{c(){for(let u=0;u<s.length;u+=1)s[u].c();e=oe()},m(u,o){for(let a=0;a<s.length;a+=1)s[a].m(u,o);b(u,e,o),n=!0},p(u,o){if(o&3){r=u[0];let a;for(a=0;a<r.length;a+=1){const l=Au(u,r,a);s[a]?(s[a].p(l,o),y(s[a],1)):(s[a]=yu(l),s[a].c(),y(s[a],1),s[a].m(e.parentNode,e))}for(te(),a=r.length;a<s.length;a+=1)i(a);ne()}},i(u){if(!n){for(let o=0;o<r.length;o+=1)y(s[o]);n=!0}},o(u){s=s.filter(Boolean);for(let o=0;o<s.length;o+=1)E(s[o]);n=!1},d(u){an(s,u),u&&w(e)}}}function yu(t){let e,n=t[5].text+"",r,s,i,u,o,a,l;return i=new $p({props:{doc:t[5]}}),o=new r0({props:{doc:t[5]}}),o.$on("update",t[1]),{c(){e=B("li"),r=ae(n),s=X(),ee(i.$$.fragment),u=X(),ee(o.$$.fragment),a=X(),M(e,"class","svelte-8z70ok")},m(c,h){b(c,e,h),L(e,r),L(e,s),Y(i,e,null),L(e,u),Y(o,e,null),L(e,a),l=!0},p(c,h){(!l||h&1)&&n!==(n=c[5].text+"")&&Le(r,n);const f={};h&1&&(f.doc=c[5]),i.$set(f);const d={};h&1&&(d.doc=c[5]),o.$set(d)},i(c){l||(y(i.$$.fragment,c),y(o.$$.fragment,c),l=!0)},o(c){E(i.$$.fragment,c),E(o.$$.fragment,c),l=!1},d(c){c&&w(e),J(i),J(o)}}}function Mp(t){let e;return{c(){e=B("li"),e.textContent="Loading...",M(e,"class","svelte-8z70ok")},m(n,r){b(n,e,r)},p:R,i:R,o:R,d(n){n&&w(e)}}}function Op(t){let e,n,r,s,i,u,o;const a=[Tp,Ip],l=[];function c(h,f){return h[0].length===0?0:1}return i=c(t),u=l[i]=a[i](t),{c(){e=B("div"),n=B("h2"),n.textContent="Files",r=X(),s=B("ul"),u.c(),M(s,"class","svelte-8z70ok")},m(h,f){b(h,e,f),L(e,n),L(e,r),L(e,s),l[i].m(s,null),o=!0},p(h,[f]){let d=i;i=c(h),i===d?l[i].p(h,f):(te(),E(l[d],1,1,()=>{l[d]=null}),ne(),u=l[i],u?u.p(h,f):(u=l[i]=a[i](h),u.c()),y(u,1),u.m(s,null))},i(h){o||(y(u),o=!0)},o(h){E(u),o=!1},d(h){h&&w(e),l[i].d()}}}function Np(t,e,n){let r;Nt(t,lr,a=>n(2,r=a));let s=[];const i=new Lc(r.replica),u=async()=>{n(0,s=i.queryDocs({filter:{pathStartsWith:"/documents"}})),console.log("Docs",s)};i.onCacheUpdated(()=>{u()}),Ir(()=>{u()});function o(){setTimeout(()=>{u()},1e3),console.log("UI updated")}return t.$$.update=()=>{t.$$.dirty&1&&n(0,s)},[s,o]}class Lp extends fe{constructor(e){super(),he(this,e,Np,Op,ce,{})}}function Cu(t){let e,n,r;return{c(){e=B("button"),e.textContent="Generate new Identity"},m(s,i){b(s,e,i),n||(r=xe(e,"click",t[4]),n=!0)},p:R,d(s){s&&w(e),n=!1,r()}}}function Up(t){let e,n,r,s,i,u,o,a,l;const c=[jp,Hp],h=[];function f(g,$){return g[2]?1:0}r=f(t),s=h[r]=c[r](t);function d(g,$){return g[2]?Wp:qp}let p=d(t),D=p(t);return{c(){e=B("button"),e.textContent="Show details",n=X(),s.c(),i=X(),u=B("button"),D.c(),M(e,"class","topleft svelte-qapw26"),M(u,"class","topright svelte-qapw26")},m(g,$){b(g,e,$),b(g,n,$),h[r].m(g,$),b(g,i,$),b(g,u,$),D.m(u,null),o=!0,a||(l=[xe(e,"click",t[6]),xe(u,"click",t[8])],a=!0)},p(g,$){let S=r;r=f(g),r===S?h[r].p(g,$):(te(),E(h[S],1,1,()=>{h[S]=null}),ne(),s=h[r],s?s.p(g,$):(s=h[r]=c[r](g),s.c()),y(s,1),s.m(i.parentNode,i)),p!==(p=d(g))&&(D.d(1),D=p(g),D&&(D.c(),D.m(u,null)))},i(g){o||(y(s),o=!0)},o(g){E(s),o=!1},d(g){g&&w(e),g&&w(n),h[r].d(g),g&&w(i),g&&w(u),D.d(),a=!1,zt(l)}}}function zp(t){let e,n,r;function s(o,a){return o[1]?Qp:Vp}let i=s(t),u=i(t);return{c(){e=B("button"),u.c()},m(o,a){b(o,e,a),u.m(e,null),n||(r=xe(e,"click",t[5]),n=!0)},p(o,a){i!==(i=s(o))&&(u.d(1),u=i(o),u&&(u.c(),u.m(e,null)))},i:R,o:R,d(o){o&&w(e),u.d(),n=!1,r()}}}function Hp(t){let e,n;return e=new Lp({}),{c(){ee(e.$$.fragment)},m(r,s){Y(e,r,s),n=!0},p:R,i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){J(e,r)}}}function jp(t){let e,n;return e=new Xf({}),e.$on("click",t[7]),{c(){ee(e.$$.fragment)},m(r,s){Y(e,r,s),n=!0},p:R,i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){J(e,r)}}}function qp(t){let e;return{c(){e=ae("Show file")},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function Wp(t){let e;return{c(){e=ae("Upload file")},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function Vp(t){let e;return{c(){e=ae("Hide details")},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function Qp(t){let e;return{c(){e=ae("Show details")},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function Eu(t){let e,n;return e=new Vf({}),{c(){ee(e.$$.fragment)},m(r,s){Y(e,r,s),n=!0},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){J(e,r)}}}function Kp(t){let e,n,r,s,i,u,o,a,l=t[3].shareAddress+"",c,h,f,d,p=t[3].secret+"",D,g,$,S,m,v,A,k,x=!t[0]&&Cu(t);const C=[zp,Up],N=[];function le(K,ie){return K[0]&&!K[1]?0:K[0]&&K[1]?1:-1}~(S=le(t))&&(m=N[S]=C[S](t));let U=t[0]&&Eu();return{c(){e=B("main"),n=B("div"),r=B("div"),s=B("h3"),s.textContent="Current Share Details",i=X(),u=B("p"),o=B("b"),o.textContent="Address:",a=X(),c=ae(l),h=X(),f=B("b"),f.textContent="Secret:",d=X(),D=ae(p),g=X(),x&&x.c(),$=X(),m&&m.c(),v=X(),A=B("div"),U&&U.c(),M(r,"class","svelte-qapw26"),dr(r,"showDetails",t[1]),M(A,"class","svelte-qapw26"),dr(A,"showDetails",t[1]),M(e,"class","svelte-qapw26")},m(K,ie){b(K,e,ie),L(e,n),L(n,r),L(r,s),L(r,i),L(r,u),L(u,o),L(u,a),L(u,c),L(u,h),L(u,f),L(u,d),L(u,D),L(n,g),x&&x.m(n,null),L(n,$),~S&&N[S].m(n,null),L(e,v),L(e,A),U&&U.m(A,null),k=!0},p(K,[ie]){(!k||ie&8)&&l!==(l=K[3].shareAddress+"")&&Le(c,l),(!k||ie&8)&&p!==(p=K[3].secret+"")&&Le(D,p),(!k||ie&2)&&dr(r,"showDetails",K[1]),K[0]?x&&(x.d(1),x=null):x?x.p(K,ie):(x=Cu(K),x.c(),x.m(n,$));let ot=S;S=le(K),S===ot?~S&&N[S].p(K,ie):(m&&(te(),E(N[ot],1,1,()=>{N[ot]=null}),ne()),~S?(m=N[S],m?m.p(K,ie):(m=N[S]=C[S](K),m.c()),y(m,1),m.m(n,null)):m=null),K[0]?U?ie&1&&y(U,1):(U=Eu(),U.c(),y(U,1),U.m(A,null)):U&&(te(),E(U,1,1,()=>{U=null}),ne()),(!k||ie&2)&&dr(A,"showDetails",K[1])},i(K){k||(y(m),y(U),k=!0)},o(K){E(m),E(U),k=!1},d(K){K&&w(e),x&&x.d(),~S&&N[S].d(),U&&U.d()}}}function Gp(t,e,n){let r,s;Nt(t,lr,D=>n(9,r=D)),Nt(t,ha,D=>n(3,s=D));let i=!0,u=!0,o=!0;const a=new oa;a.addReplica(r.replica);const l=a.sync("https://earthstar-server.fly.dev/sync",!0);return l.onStatusChange(D=>{console.log(D)}),l.isDone().then(()=>{console.log("Sync complete")}).catch(D=>{console.error("Sync failed",D)}),[i,u,o,s,()=>n(0,i=!i),()=>n(1,u=!u),()=>n(1,u=!u),()=>n(2,o=!o),()=>n(2,o=!o)]}class Zp extends fe{constructor(e){super(),he(this,e,Gp,Kp,ce,{})}}new Zp({target:document.getElementById("app")});
